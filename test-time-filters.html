<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ - TASK-083</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #34495e;
        }
        .result {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
        .success {
            border-left: 4px solid #28a745;
        }
        .error {
            border-left: 4px solid #dc3545;
        }
        .warning {
            border-left: 4px solid #ffc107;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .ticket-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e1e8ed;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
        }
        .ticket-item {
            padding: 5px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 12px;
        }
        .ticket-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ - TASK-083</h1>

        <div class="test-section">
            <h3>üìã –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
            <p>–°–æ–∑–¥–∞–Ω–æ <span id="test-data-count">0</span> —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ —Å–æ–∑–¥–∞–Ω–∏—è:</p>
            <div id="test-data-list" class="ticket-list"></div>
        </div>

        <div class="test-section">
            <h3>üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</h3>
            <button onclick="runAllTests()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
            <button onclick="testOneMonth()">–û–¥–∏–Ω –º–µ—Å—è—Ü</button>
            <button onclick="testTwoMonths()">–î–≤–∞ –º–µ—Å—è—Ü–∞</button>
            <button onclick="testSixMonthsPlus()">–ë–æ–ª–µ–µ –ø–æ–ª—É–≥–æ–¥–∞</button>
            <button onclick="testOneYearPlus()">–ë–æ–ª–µ–µ –≥–æ–¥–∞</button>
            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h3>‚ö° –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h3>
            <button onclick="runPerformanceTest()">–¢–µ—Å—Ç —Å 1000 —Ç–∏–∫–µ—Ç–∞–º–∏</button>
            <div id="performance-result"></div>
        </div>

        <div class="test-section">
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤</h3>
            <div id="all-filters-result"></div>
        </div>
    </div>

    <script type="module">
        // –ò–º–ø–æ—Ä—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ—É–Ω–∫—Ü–∏–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        import { testTickets, generateTestTickets } from './vue-app/src/test-data.js';
        import { filterTicketsByTimePeriod, TIME_FILTERS, TIME_FILTER_LABELS, getTicketsCountByPeriods } from './vue-app/src/utils/time-filters.js';

        let currentTestData = testTickets;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            displayTestData();
        });

        function displayTestData() {
            const countElement = document.getElementById('test-data-count');
            const listElement = document.getElementById('test-data-list');

            countElement.textContent = currentTestData.length;

            listElement.innerHTML = currentTestData.map(ticket => `
                <div class="ticket-item">
                    <strong>${ticket.id}</strong> -
                    ${new Date(ticket.created_at).toLocaleDateString('ru-RU')}
                    (${getDaysAgo(ticket.created_at)} –¥–Ω–µ–π –Ω–∞–∑–∞–¥)
                </div>
            `).join('');
        }

        function getDaysAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        function runAllTests() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<h4>–í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–µ—Å—Ç—ã...</h4>';

            setTimeout(() => {
                const testResults = [];

                // –¢–µ—Å—Ç "–û–¥–∏–Ω –º–µ—Å—è—Ü"
                const oneMonthResult = filterTicketsByTimePeriod(currentTestData, TIME_FILTERS.ONE_MONTH);
                testResults.push({
                    name: '–û–¥–∏–Ω –º–µ—Å—è—Ü (‚â§30 –¥–Ω–µ–π)',
                    expected: 1,
                    actual: oneMonthResult.length,
                    success: oneMonthResult.length === 1,
                    tickets: oneMonthResult
                });

                // –¢–µ—Å—Ç "–î–≤–∞ –º–µ—Å—è—Ü–∞"
                const twoMonthsResult = filterTicketsByTimePeriod(currentTestData, TIME_FILTERS.TWO_MONTHS);
                testResults.push({
                    name: '–î–≤–∞ –º–µ—Å—è—Ü–∞ (‚â§60 –¥–Ω–µ–π)',
                    expected: 2,
                    actual: twoMonthsResult.length,
                    success: twoMonthsResult.length === 2,
                    tickets: twoMonthsResult
                });

                // –¢–µ—Å—Ç "–ë–æ–ª–µ–µ –ø–æ–ª—É–≥–æ–¥–∞"
                const sixMonthsResult = filterTicketsByTimePeriod(currentTestData, TIME_FILTERS.SIX_MONTHS_PLUS);
                testResults.push({
                    name: '–ë–æ–ª–µ–µ –ø–æ–ª—É–≥–æ–¥–∞ (>180 –¥–Ω–µ–π)',
                    expected: 2,
                    actual: sixMonthsResult.length,
                    success: sixMonthsResult.length === 2,
                    tickets: sixMonthsResult
                });

                // –¢–µ—Å—Ç "–ë–æ–ª–µ–µ –≥–æ–¥–∞"
                const oneYearResult = filterTicketsByTimePeriod(currentTestData, TIME_FILTERS.ONE_YEAR_PLUS);
                testResults.push({
                    name: '–ë–æ–ª–µ–µ –≥–æ–¥–∞ (>365 –¥–Ω–µ–π)',
                    expected: 1,
                    actual: oneYearResult.length,
                    success: oneYearResult.length === 1,
                    tickets: oneYearResult
                });

                displayTestResults(testResults);
            }, 100);
        }

        function testOneMonth() {
            runSingleTest(TIME_FILTERS.ONE_MONTH, 1);
        }

        function testTwoMonths() {
            runSingleTest(TIME_FILTERS.TWO_MONTHS, 2);
        }

        function testSixMonthsPlus() {
            runSingleTest(TIME_FILTERS.SIX_MONTHS_PLUS, 2);
        }

        function testOneYearPlus() {
            runSingleTest(TIME_FILTERS.ONE_YEAR_PLUS, 1);
        }

        function runSingleTest(filterType, expectedCount) {
            const startTime = performance.now();
            const result = filterTicketsByTimePeriod(currentTestData, filterType);
            const endTime = performance.now();

            const results = document.getElementById('test-results');
            results.innerHTML = `
                <div class="result ${result.length === expectedCount ? 'success' : 'error'}">
                    <h4>${TIME_FILTER_LABELS[filterType]}</h4>
                    <p><strong>–û–∂–∏–¥–∞–ª–æ—Å—å:</strong> ${expectedCount} —Ç–∏–∫–µ—Ç–æ–≤</p>
                    <p><strong>–ü–æ–ª—É—á–µ–Ω–æ:</strong> ${result.length} —Ç–∏–∫–µ—Ç–æ–≤</p>
                    <p><strong>–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</strong> ${(endTime - startTime).toFixed(2)}ms</p>
                    <div class="ticket-list">
                        ${result.map(ticket =>
                            `<div class="ticket-item">${ticket.id} - ${new Date(ticket.created_at).toLocaleDateString('ru-RU')}</div>`
                        ).join('')}
                    </div>
                </div>
            `;
        }

        function displayTestResults(testResults) {
            const results = document.getElementById('test-results');

            results.innerHTML = testResults.map(test => `
                <div class="result ${test.success ? 'success' : 'error'}">
                    <h4>${test.name}</h4>
                    <p><strong>–û–∂–∏–¥–∞–ª–æ—Å—å:</strong> ${test.expected} —Ç–∏–∫–µ—Ç–æ–≤</p>
                    <p><strong>–ü–æ–ª—É—á–µ–Ω–æ:</strong> ${test.actual} —Ç–∏–∫–µ—Ç–æ–≤</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${test.success ? '‚úÖ –ü—Ä–æ–π–¥–µ–Ω' : '‚ùå –ü—Ä–æ–≤–∞–ª'}</p>
                    <div class="ticket-list">
                        ${test.tickets.map(ticket =>
                            `<div class="ticket-item">${ticket.id} - ${new Date(ticket.created_at).toLocaleDateString('ru-RU')}</div>`
                        ).join('')}
                    </div>
                </div>
            `).join('');
        }

        function runPerformanceTest() {
            const resultElement = document.getElementById('performance-result');

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
            const largeDataset = generateTestTickets({ count: 1000 });

            resultElement.innerHTML = '<p>–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...</p>';

            setTimeout(() => {
                const startTime = performance.now();

                // –í—ã–ø–æ–ª–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
                const results = {};
                Object.values(TIME_FILTERS).forEach(filterType => {
                    results[filterType] = filterTicketsByTimePeriod(largeDataset, filterType);
                });

                const endTime = performance.now();
                const totalTime = endTime - startTime;

                resultElement.innerHTML = `
                    <div class="result ${totalTime < 500 ? 'success' : 'warning'}">
                        <h4>–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (1000 —Ç–∏–∫–µ—Ç–æ–≤)</h4>
                        <p><strong>–û–±—â–µ–µ –≤—Ä–µ–º—è:</strong> ${totalTime.toFixed(2)}ms</p>
                        <p><strong>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ —Ñ–∏–ª—å—Ç—Ä:</strong> ${(totalTime / Object.keys(TIME_FILTERS).length).toFixed(2)}ms</p>
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${totalTime < 500 ? '‚úÖ –•–æ—Ä–æ—à–æ' : '‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–æ'}</p>
                        <ul>
                            ${Object.entries(results).map(([filterType, tickets]) =>
                                `<li>${TIME_FILTER_LABELS[filterType]}: ${tickets.length} —Ç–∏–∫–µ—Ç–æ–≤</li>`
                            ).join('')}
                        </ul>
                    </div>
                `;
            }, 100);
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function updateAllFiltersResult() {
            const resultElement = document.getElementById('all-filters-result');
            const counts = getTicketsCountByPeriods(currentTestData);

            resultElement.innerHTML = `
                <div class="result success">
                    <h4>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º</h4>
                    <ul>
                        ${Object.entries(counts).map(([filterType, count]) =>
                            `<li><strong>${TIME_FILTER_LABELS[filterType]}:</strong> ${count} —Ç–∏–∫–µ—Ç–æ–≤</li>`
                        ).join('')}
                    </ul>
                    <p><strong>–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤:</strong> ${currentTestData.length}</p>
                </div>
            `;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(updateAllFiltersResult, 100);

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        window.runAllTests = runAllTests;
        window.testOneMonth = testOneMonth;
        window.testTwoMonths = testTwoMonths;
        window.testSixMonthsPlus = testSixMonthsPlus;
        window.testOneYearPlus = testOneYearPlus;
        window.runPerformanceTest = runPerformanceTest;
    </script>
</body>
</html>