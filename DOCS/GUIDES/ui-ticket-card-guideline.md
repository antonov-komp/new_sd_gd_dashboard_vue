# Гайдлайн: Карточка тикета в канбан-сетке (Дашборд Сектор 1С)

**Дата создания:** 2025-12-11 20:00 (UTC+3, Брест)  
**Версия:** 1.0  
**Роль:** UX/UI-дизайнер  
**Компонент:** TicketCard.vue  
**Контекст:** Дашборд Сектор 1С — канбан-сетка тикетов

---

## Описание

Карточка тикета — основной элемент отображения тикетов в канбан-сетке дашборда сектора 1С. Карточка отображает ключевую информацию о тикете и обеспечивает интерактивность (клик для открытия деталей, drag & drop для перемещения).

**Используется в:**
- `EmployeeColumn.vue` — колонка сотрудника (тикеты назначенные сотруднику)
- `ZeroPoint.vue` — нулевая точка (входящие тикеты)

---

## ASCII-схема карточки тикета

### Базовая структура (все элементы)

```
┌─────────────────────────────────────────────────────────────┐
│  [ЛЕВАЯ ГРАНИЦА]  ┌──────────────────────────────────────┐  │
│  [4px, цвет      │  🎫 #12345                            │  │
│   приоритета]    │  ────────────────────────────────────  │  │
│                  │                                        │  │
│                  │  Тема тикета из UF_SUBJECT            │  │
│                  │  (или title, если UF_SUBJECT пусто)   │  │
│                  │                                        │  │
│                  │  ┌──────────┐  ┌──────────┐          │  │
│                  │  │ Приоритет │  │ Сервис   │          │  │
│                  │  │  (чип)   │  │  (чип)   │          │  │
│                  │  └──────────┘  └──────────┘          │  │
│                  │                                        │  │
│                  │  ┌──────────────────────────┐        │  │
│                  │  │ UF_ACTION_STR (чип)       │        │  │
│                  │  │ (опционально)             │        │  │
│                  │  └──────────────────────────┘        │  │
│                  │                                        │  │
│                  │  Описание тикета (опционально)       │  │
│                  │  Максимум 2 строки, обрезка ...       │  │
│                  │                                        │  │
│                  └──────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### Детальная разметка с размерами

```
┌─────────────────────────────────────────────────────────────┐
│  [4px]  ┌────────────────────────────────────────────────┐  │
│  [Цвет] │  ┌────┐  ┌──────┐                             │  │
│  [Прио] │  │ 🎫 │  │#12345│  ← ticket-header            │  │
│  [ритет]│  └────┘  └──────┘    gap: 8px                  │  │
│         │           font-size: 12px                      │  │
│         │           color: #666                          │  │
│         │           font-weight: 600                      │  │
│         │                                                  │  │
│         │  ┌──────────────────────────────────────────┐   │  │
│         │  │ Тема тикета из UF_SUBJECT               │   │  │
│         │  │ (или title, если UF_SUBJECT пусто)       │   │  │
│         │  │                                          │   │  │
│         │  │ ← ticket-title                          │   │  │
│         │  │ font-size: 14px                          │   │  │
│         │  │ font-weight: 600                        │   │  │
│         │  │ color: #333                             │   │  │
│         │  │ line-height: 1.4                        │   │  │
│         │  │ margin-bottom: 8px                       │   │  │
│         │  └──────────────────────────────────────────┘   │  │
│         │                                                  │  │
│         │  ┌──────────────┐  ┌──────────────┐           │  │
│         │  │  Приоритет   │  │   Сервис     │           │  │
│         │  │   (чип)      │  │    (чип)     │           │  │
│         │  │              │  │              │           │  │
│         │  │ ← ticket-meta│  │ gap: 8px     │           │  │
│         │  │              │  │ flex-wrap    │           │  │
│         │  │ ← ticket-    │  │              │           │  │
│         │  │   priority   │  │ ← ticket-    │           │  │
│         │  │              │  │   service    │           │  │
│         │  │ font-size:   │  │              │           │  │
│         │  │   11px       │  │ font-size:   │           │  │
│         │  │ padding:     │  │   11px       │           │  │
│         │  │   2px 8px    │  │ padding:     │           │  │
│         │  │ border-      │  │   2px 8px    │           │  │
│         │  │   radius:    │  │ border-     │           │  │
│         │  │   12px       │  │   radius:   │           │  │
│         │  │              │  │   12px      │           │  │
│         │  │ Цвета из     │  │             │           │  │
│         │  │ priority-    │  │ Цвета из    │           │  │
│         │  │ Colors       │  │ service-    │           │  │
│         │  │              │  │ Colors      │           │  │
│         │  └──────────────┘  └──────────────┘           │  │
│         │                                                  │  │
│         │  ┌──────────────────────────────────────┐      │  │
│         │  │  UF_ACTION_STR (чип)                 │      │  │
│         │  │  (опционально, если заполнено)        │      │  │
│         │  │                                      │      │  │
│         │  │  ← ticket-action                     │      │  │
│         │  │     ticket-action-chip               │      │  │
│         │  │                                      │      │  │
│         │  │  font-size: 11px                     │      │  │
│         │  │  padding: 2px 8px                    │      │  │
│         │  │  border-radius: 12px               │      │  │
│         │  │  border: 1px solid                   │      │  │
│         │  │                                      │      │  │
│         │  │  Цвета: NEUTRAL_ACTION_COLORS        │      │  │
│         │  │  - color: #dee2e6                    │      │  │
│         │  │  - backgroundColor: #f8f9fa          │      │  │
│         │  │  - textColor: #6c757d                │      │  │
│         │  └──────────────────────────────────────┘      │  │
│         │                                                  │  │
│         │  ┌──────────────────────────────────────────┐   │  │
│         │  │ Описание тикета (опционально)            │   │  │
│         │  │ Максимум 2 строки, обрезка ...          │   │  │
│         │  │                                          │   │  │
│         │  │ ← ticket-description                    │   │  │
│         │  │ font-size: 12px                         │   │  │
│         │  │ color: #666                             │   │  │
│         │  │ line-height: 1.4                        │   │  │
│         │  │ margin-top: 8px                         │   │  │
│         │  │ overflow: hidden                        │   │  │
│         │  │ text-overflow: ellipsis                 │   │  │
│         │  │ -webkit-line-clamp: 2                   │   │  │
│         │  │ line-clamp: 2                           │   │  │
│         │  └──────────────────────────────────────────┘   │  │
│         │                                                  │  │
│         └──────────────────────────────────────────────────┘  │
│                                                               │
│  padding: 12px (все стороны)                                  │
│  border-radius: 4px                                          │
│  background: white                                           │
│  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1)                    │
│  cursor: pointer (или grab, если draggable)                 │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

---

## Элементы карточки

### 1. Левая граница (border-left)

**Стили:**
- `width`: 4px
- `color`: Динамический (из `priorityColors.color`)
- `fallback`: `#ddd` (если приоритет не указан)

**Назначение:**
- Визуальная индикация приоритета тикета
- Быстрое сканирование приоритетов в списке

**Цвета приоритетов:**
- Высокий: Красный оттенок
- Средний: Жёлтый оттенок
- Низкий: Зелёный оттенок
- Не указано: Серый (#ced4da)

---

### 2. Шапка карточки (ticket-header)

**Структура:**
```
┌────┐  ┌──────┐
│ 🎫 │  │#12345│
└────┘  └──────┘
```

**Элементы:**

#### 2.1. Иконка тикета (ticket-icon)
- **Эмодзи:** 🎫
- **Размер:** `font-size: 18px`
- **Расположение:** Слева в шапке

#### 2.2. ID тикета (ticket-id)
- **Формат:** `#12345` (префикс `#` + ID)
- **Размер:** `font-size: 12px`
- **Цвет:** `#666`
- **Вес:** `font-weight: 600`
- **Расположение:** Справа от иконки
- **Отступ:** `gap: 8px` между иконкой и ID

**Стили контейнера:**
- `display: flex`
- `align-items: center`
- `gap: 8px`
- `margin-bottom: 8px`

---

### 3. Заголовок тикета (ticket-title)

**Содержимое:**
- **Приоритет 1:** `ticket.ufSubject` (пользовательское поле UF_SUBJECT)
- **Приоритет 2:** `ticket.title` (fallback)
- **Приоритет 3:** `'Без названия'` (если оба пусты)

**Стили:**
- `font-size: 14px`
- `font-weight: 600`
- `color: #333`
- `line-height: 1.4`
- `margin-bottom: 8px`

**Особенности:**
- Многострочный текст (перенос по словам)
- Без обрезки (полный текст)

---

### 4. Мета-информация (ticket-meta)

**Структура:**
```
┌──────────────┐  ┌──────────────┐
│  Приоритет   │  │   Сервис     │
│   (чип)      │  │    (чип)     │
└──────────────┘  └──────────────┘
```

**Стили контейнера:**
- `display: flex`
- `gap: 8px`
- `margin-bottom: 8px`
- `flex-wrap: wrap` (перенос на новую строку при нехватке места)

#### 4.1. Чип приоритета (ticket-priority)

**Стили:**
- `font-size: 11px`
- `padding: 2px 8px`
- `border-radius: 12px`
- `font-weight: 500`
- `border: 1px solid transparent`

**Цвета (динамические из `priorityColors`):**
- `color`: `textColor` (цвет текста)
- `backgroundColor`: `backgroundColor` (фон)
- `borderColor`: `color` (граница)

**Fallback (если приоритет не указан):**
- `color: #6c757d`
- `backgroundColor: #f1f3f5`
- `borderColor: #ced4da`

**Текст:**
- `ticket.priorityLabel` или `'Не указано'`

#### 4.2. Чип сервиса (ticket-service)

**Стили:**
- `font-size: 11px`
- `padding: 2px 8px`
- `border-radius: 12px`
- `font-weight: 500`
- `border: 1px solid transparent`

**Цвета (динамические из `serviceColors`):**
- `color`: `textColor` (цвет текста)
- `backgroundColor`: `backgroundColor` (фон)
- `borderColor`: `color` (граница)

**Fallback (если сервис не указан):**
- `color: #6c757d`
- `backgroundColor: #f8f9fa`
- `borderColor: #ced4da`

**Текст:**
- `ticket.serviceLabel` или `'Не указано'`

---

### 5. Дополнительное действие (ticket-action) — опционально

**Условие отображения:**
- Отображается только если `ticket.actionStr` заполнено (не null, не пустая строка)

**Структура:**
```
┌──────────────────────────────────────┐
│  UF_ACTION_STR (чип)                 │
│  (динамичная строка из Bitrix24)     │
└──────────────────────────────────────┘
```

**Стили контейнера:**
- `display: flex`
- `gap: 8px`
- `margin-top: 4px`
- `margin-bottom: 8px`
- `flex-wrap: wrap`

**Стили чипа (ticket-action-chip):**
- `font-size: 11px`
- `padding: 2px 8px`
- `border-radius: 12px`
- `font-weight: 500`
- `border: 1px solid`

**Цвета (фиксированные, нейтральные):**
- `color: #6c757d` (текст)
- `backgroundColor: #f8f9fa` (фон)
- `borderColor: #dee2e6` (граница)

**Текст:**
- `ticket.actionStr` (значение из UF_ACTION_STR)

---

### 6. Описание тикета (ticket-description) — опционально

**Условие отображения:**
- Отображается только если `ticket.description` заполнено

**Стили:**
- `font-size: 12px`
- `color: #666`
- `line-height: 1.4`
- `margin-top: 8px`
- `overflow: hidden`
- `text-overflow: ellipsis`
- `display: -webkit-box`
- `-webkit-line-clamp: 2` (максимум 2 строки)
- `line-clamp: 2`
- `-webkit-box-orient: vertical`

**Особенности:**
- Обрезка текста после 2 строк с многоточием (`...`)
- Многострочный текст с переносом

---

## Стили карточки (ticket-card)

### Базовые стили

```css
.ticket-card {
  background: white;
  border-radius: 4px;
  padding: 12px;
  border-left: 4px solid #ddd; /* Динамический цвет из priorityColors */
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}
```

### Состояния

#### 1. Обычное состояние (default)
- `background: white`
- `box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1)`
- `cursor: pointer`

#### 2. Hover (наведение)
```css
.ticket-card:hover {
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  transform: translateY(-2px);
}
```
- Увеличенная тень
- Поднятие карточки на 2px вверх
- Плавная анимация (`transition: all 0.3s ease`)

#### 3. Draggable (перетаскиваемый)
```css
.ticket-card[draggable="true"] {
  cursor: grab;
}

.ticket-card[draggable="true"]:active {
  cursor: grabbing;
}
```
- Курсор `grab` при наведении
- Курсор `grabbing` при активном перетаскивании

#### 4. Перетаскивание (isDragging)
- Внутреннее состояние `isDragging: true`
- Предотвращает клик во время перетаскивания

---

## Интерактивность

### 1. Клик по карточке

**Действие:**
- Открытие детальной информации о тикете в новой вкладке браузера

**URL:**
```
https://bitrix24.kompo.by/page/servisdeskitotdel/servisdesk/type/140/details/{ticketId}/
```

**Реализация:**
```javascript
window.open(iframeUrl, '_blank');
```

**Обработка:**
- Предотвращение клика во время перетаскивания (`if (isDragging.value) return;`)
- Эмит события `@click` с объектом тикета

---

### 2. Drag & Drop (перетаскивание)

**Условие:**
- Включено только если `DISABLE_TICKET_DRAG = false` и `draggable = true`

**События:**
- `@dragstart` — начало перетаскивания
  - Сохранение данных тикета в `dataTransfer`
  - Установка `isDragging = true`
  - Эмит события `drag-start`
- `@dragend` — окончание перетаскивания
  - Установка `isDragging = false`
  - Эмит события `drag-end`

**Визуальная обратная связь:**
- Курсор меняется на `grab` / `grabbing`
- Карточка может быть визуально выделена (зависит от реализации drag & drop в родительском компоненте)

---

## Размеры и отступы

### Общие отступы карточки
- `padding: 12px` (все стороны)

### Отступы между элементами
- `ticket-header`: `margin-bottom: 8px`
- `ticket-title`: `margin-bottom: 8px`
- `ticket-meta`: `margin-bottom: 8px`
- `ticket-action`: `margin-top: 4px`, `margin-bottom: 8px`
- `ticket-description`: `margin-top: 8px`

### Внутренние отступы элементов
- `ticket-header`: `gap: 8px` (между иконкой и ID)
- `ticket-meta`: `gap: 8px` (между чипами)
- Чипы: `padding: 2px 8px` (вертикальный 2px, горизонтальный 8px)

---

## Цветовая схема

### Основные цвета

**Фон карточки:**
- `background: white`

**Текст:**
- Заголовок: `#333`
- ID тикета: `#666`
- Описание: `#666`

**Границы:**
- Левая граница: Динамический (из `priorityColors.color`)
- Fallback: `#ddd`

**Тени:**
- Обычное состояние: `0 1px 3px rgba(0, 0, 0, 0.1)`
- Hover: `0 2px 6px rgba(0, 0, 0, 0.15)`

### Цвета приоритетов (динамические)

**Источник:** `ticket.priorityColors` (из конфигурации приоритетов)

**Структура:**
```javascript
{
  color: '#dc3545',           // Цвет границы и чипа
  backgroundColor: '#fff5f5', // Фон чипа
  textColor: '#721c24'        // Цвет текста чипа
}
```

**Fallback (если приоритет не указан):**
```javascript
{
  color: '#ced4da',
  backgroundColor: '#f1f3f5',
  textColor: '#6c757d'
}
```

### Цвета сервисов (динамические)

**Источник:** `ticket.serviceColors` (из конфигурации сервисов)

**Fallback (если сервис не указан):**
```javascript
{
  color: '#ced4da',
  backgroundColor: '#f8f9fa',
  textColor: '#6c757d'
}
```

### Цвета действия (фиксированные, нейтральные)

**UF_ACTION_STR чип:**
```javascript
{
  color: '#dee2e6',
  backgroundColor: '#f8f9fa',
  textColor: '#6c757d'
}
```

---

## Типографика

### Шрифты
- **Семейство:** Системный шрифт (наследуется от родителя)
- **Размеры:**
  - ID тикета: `12px`
  - Заголовок: `14px`
  - Описание: `12px`
  - Чипы: `11px`

### Веса шрифтов
- ID тикета: `600` (semi-bold)
- Заголовок: `600` (semi-bold)
- Чипы: `500` (medium)
- Описание: `400` (normal, по умолчанию)

### Высота строк
- Заголовок: `1.4`
- Описание: `1.4`

---

## Адаптивность

### Минимальная ширина карточки
- Зависит от контейнера (колонка сотрудника)
- Минимум: ~200px (для комфортного отображения)

### Перенос элементов
- Чипы в `ticket-meta`: `flex-wrap: wrap` (переносятся на новую строку при нехватке места)
- Описание: Обрезка после 2 строк с многоточием

---

## Состояния отображения

### 1. Полная карточка (все элементы)

```
┌─────────────────────────────────────┐
│ [4px] 🎫 #12345                     │
│       Тема тикета                   │
│       [Приоритет] [Сервис]          │
│       [UF_ACTION_STR]               │
│       Описание тикета...            │
└─────────────────────────────────────┘
```

### 2. Без описания

```
┌─────────────────────────────────────┐
│ [4px] 🎫 #12345                     │
│       Тема тикета                   │
│       [Приоритет] [Сервис]          │
│       [UF_ACTION_STR]               │
└─────────────────────────────────────┘
```

### 3. Без UF_ACTION_STR

```
┌─────────────────────────────────────┐
│ [4px] 🎫 #12345                     │
│       Тема тикета                   │
│       [Приоритет] [Сервис]          │
│       Описание тикета...            │
└─────────────────────────────────────┘
```

### 4. Минимальная карточка (только обязательные элементы)

```
┌─────────────────────────────────────┐
│ [4px] 🎫 #12345                     │
│       Тема тикета                   │
│       [Приоритет] [Сервис]          │
└─────────────────────────────────────┘
```

### 5. Без приоритета/сервиса (fallback)

```
┌─────────────────────────────────────┐
│ [4px] 🎫 #12345                     │
│       Тема тикета                   │
│       [Не указано] [Не указано]    │
└─────────────────────────────────────┘
```

---

## Примеры визуализации

### Пример 1: Тикет с высоким приоритетом

```
┌─────────────────────────────────────┐
│ [🔴] 🎫 #5025                       │
│       Настройка интеграции 1С       │
│       [Высокий] [1С:Бухгалтерия]   │
│       [Требуется срочно]           │
│       Необходимо настроить...      │
└─────────────────────────────────────┘
```

**Цвета:**
- Левая граница: Красный (#dc3545)
- Чип приоритета: Красный фон, тёмно-красный текст
- Чип сервиса: Цвета сервиса
- Чип действия: Нейтральный серый

### Пример 2: Тикет со средним приоритетом

```
┌─────────────────────────────────────┐
│ [🟡] 🎫 #5026                       │
│       Обновление справочников       │
│       [Средний] [1С:УТ]            │
│       Обновить справочники...       │
└─────────────────────────────────────┘
```

**Цвета:**
- Левая граница: Жёлтый (#ffc107)
- Чип приоритета: Жёлтый фон, тёмно-жёлтый текст

### Пример 3: Тикет с низким приоритетом

```
┌─────────────────────────────────────┐
│ [🟢] 🎫 #5027                       │
│       Консультация по настройке     │
│       [Низкий] [1С:ЗУП]             │
└─────────────────────────────────────┘
```

**Цвета:**
- Левая граница: Зелёный (#28a745)
- Чип приоритета: Зелёный фон, тёмно-зелёный текст

---

## Технические детали

### Vue.js компонент

**Файл:** `vue-app/src/components/dashboard/TicketCard.vue`

**Props:**
- `ticket` (Object, required) — объект тикета
- `draggable` (Boolean, default: true) — можно ли перетаскивать

**Emits:**
- `@click` — клик по карточке
- `@drag-start` — начало перетаскивания
- `@drag-end` — окончание перетаскивания

**Computed свойства:**
- `isDragEnabled` — включено ли перетаскивание
- `priorityChipStyle` — стили чипа приоритета
- `priorityBorderStyle` — стили левой границы
- `serviceChipStyle` — стили чипа сервиса
- `actionChipStyle` — стили чипа действия
- `displayPriorityLabel` — отображаемый текст приоритета
- `displayServiceLabel` — отображаемый текст сервиса
- `actionStrValue` — значение UF_ACTION_STR (или null)

---

## Рекомендации для дизайнера

### 1. Цветовая консистентность
- Использовать цвета из конфигурации приоритетов/сервисов
- Не создавать новые цвета без обновления конфигурации

### 2. Отступы и размеры
- Соблюдать модульную сетку 4px/8px
- Не уменьшать отступы менее 4px
- Чипы должны быть компактными, но читаемыми

### 3. Текст
- Заголовок должен быть читаемым (минимум 14px)
- Описание обрезается после 2 строк (не менять без обоснования)
- ID тикета — вторичная информация (меньший размер, серый цвет)

### 4. Интерактивность
- Hover-эффект обязателен (поднятие карточки)
- Курсор должен меняться на `pointer` или `grab`
- Плавные переходы (0.3s ease)

### 5. Адаптивность
- Карточка должна работать на всех размерах экрана
- Чипы переносятся на новую строку при нехватке места
- Описание обрезается, не ломая макет

---

## История изменений

- **2025-12-11 20:00 (UTC+3, Брест):** Создан гайдлайн для карточки тикета
  - Добавлена детальная ASCII-схема
  - Описаны все элементы и их стили
  - Указаны размеры, отступы, цвета
  - Добавлены примеры визуализации

---

## Связанные документы

- `DOCS/TASKS/TASK-023-ticket-card-uf-subject-and-iframe.md` — задача по обновлению карточки
- `UIX/ascii-schemas/dashboard-sector-1c.txt` — общая схема дашборда
- `vue-app/src/components/dashboard/TicketCard.vue` — компонент карточки
- `vue-app/src/services/dashboard-sector-1c/mappers/ticket-mapper.js` — маппер тикетов

