# Решение проблемы с API трудозатрат

**Дата создания:** 2025-12-17 16:00 (UTC+3, Брест)  
**Проблема:** Методы `tasks.elapseditem.*` не существуют в версии Bitrix24

---

## Проблема

Методы API `tasks.elapseditem.getlist`, `tasks.elapseditem.list` и другие варианты возвращают ошибку `ERROR_METHOD_NOT_FOUND`.

## Решение

Использовать альтернативный подход через метод `tasks.task.list` / `tasks.task.get`:

### 1. Получение задач с трудозатратами

**Метод:** `tasks.task.list` или `tasks.task.get`

**Поля:**
- `timeSpentInLogs` - общее время в секундах (агрегированное)
- `createdDate` - дата создания задачи
- `changedDate` - дата последнего изменения
- `ufCrmTask` - связь с тикетом (формат: `["T8c_3093"]`, где `8c` = 140 в hex, `3093` = ID тикета)

### 2. Ограничения

- **Нет детальных записей:** `timeSpentInLogs` - это агрегированное значение, нельзя определить точное время фиксации трудозатраты
- **Неделя определяется по дате задачи:** Используем `createdDate` или `changedDate` задачи, а не дату фиксации трудозатраты
- **Нет связи с конкретными записями:** Нельзя показать, когда именно было зафиксировано время

### 3. Альтернативные варианты

#### Вариант A: Использовать `timeSpentInLogs` с датой задачи

**Плюсы:**
- Работает с текущим API
- Можно получить общее время по задачам
- Можно связать с тикетами через `ufCrmTask`

**Минусы:**
- Нельзя определить точную дату фиксации трудозатраты
- Неделя определяется по дате задачи, а не по дате трудозатраты
- Нет детализации по записям

#### Вариант B: Использовать коробочную версию Bitrix24 с D7 ORM

**Плюсы:**
- Прямой доступ к таблице БД `b_tasks_elapsed_time`
- Можно получить детальные записи с точными датами
- Полный контроль над данными

**Минусы:**
- Требуется коробочная версия Bitrix24
- Нужен доступ к БД
- Не работает для облачной версии

#### Вариант C: Использовать другой метод API (если существует)

**Требуется проверить:**
- Документацию Bitrix24 на наличие других методов
- Возможно, метод называется по-другому в вашей версии
- Возможно, нужны специальные права доступа

---

## Рекомендация

**Для текущей ситуации (облачная версия Bitrix24):**

Использовать **Вариант A** - получать задачи через `tasks.task.list` и использовать:
- `timeSpentInLogs` для общего времени (в секундах)
- `createdDate` или `changedDate` для определения недели
- `ufCrmTask` для связи с тикетами

**Ограничения:**
- Неделя будет определяться по дате задачи, а не по дате фиксации трудозатраты
- Нельзя показать детальные записи трудозатрат
- Данные будут менее точными

**Для будущего (если нужна точность):**

Рассмотреть возможность:
1. Перехода на коробочную версию Bitrix24
2. Использования D7 ORM для прямого доступа к таблице
3. Поиска других методов API в документации Bitrix24

---

## История правок

- **2025-12-17 16:00 (UTC+3, Брест):** Создан документ с решением проблемы API

