# ะััะธัะตะบัััะฐ ัะพัะบะธ ะฒัะพะดะฐ REST ะฟัะธะปะพะถะตะฝะธั

**ะะฐัะฐ ัะพะทะดะฐะฝะธั:** 2025-12-23 08:11 (UTC+3, ะัะตัั)  
**ะะตััะธั:** 1.0  
**ะกัะฐััั:** ๐ข ะะบัะธะฒะตะฝ  
**ะขะธะฟ ะดะพะบัะผะตะฝัะฐ:** ะััะธัะตะบัััะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

---

## ๐ฏ ะะฐะทะฝะฐัะตะฝะธะต ะดะพะบัะผะตะฝัะฐ

ะญัะพั ะดะพะบัะผะตะฝั ะพะฟะธััะฒะฐะตั, ะบะฐะบ ัะฐะฑะพัะฐะตั REST ะฟัะธะปะพะถะตะฝะธะต ั ัะพัะบะธ ะทัะตะฝะธั ัััะฐะฝะธัั ะพัะฝะพะฒะฝะพะณะพ ะฒัะพะดะฐ (`index.php`). ะะพะบัะผะตะฝั ะฟัะตะดะฝะฐะทะฝะฐัะตะฝ ะดะปั ะฟะพะฝะธะผะฐะฝะธั ะฐััะธัะตะบัััั ะฟัะธะปะพะถะตะฝะธั, ัะฐะฑะพัะฐััะตะณะพ ะฝะฐ VPS ัะตัะฒะตัะต ะฟะพะด root.

## ๐ ะะตะฐะปัะฝัะน URL ะฟัะธะปะพะถะตะฝะธั

**Production URL:** `https://back.kompo.by/rest_api_aps/sd_it_gen_plan/index.php`

ะญัะพ ะฟััะผะฐั ัััะปะบะฐ ะฝะฐ ัะพัะบั ะฒัะพะดะฐ ะฟัะธะปะพะถะตะฝะธั. ะัะธ ะพัะบัััะธะธ ััะพะณะพ URL:
1. ะะฐะณััะถะฐะตััั `index.php`
2. ะะฝะธัะธะฐะปะธะทะธััะตััั Vue.js ะฟัะธะปะพะถะตะฝะธะต
3. ะัะพะฑัะฐะถะฐะตััั ะณะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ (IndexPage.vue) ะธะปะธ ัััะฐะฝะธัะฐ ัััะฐะฝะพะฒะบะธ (ะตัะปะธ ะฟัะธะปะพะถะตะฝะธะต ะฝะต ัััะฐะฝะพะฒะปะตะฝะพ)

**ะะปััะตัะฝะฐัะธะฒะฝัะต URL:**
- `https://back.kompo.by/rest_api_aps/sd_it_gen_plan/` โ ะตัะปะธ ะฝะฐัััะพะตะฝ .htaccess ะดะปั ัะตะดะธัะตะบัะฐ
- `https://back.kompo.by/rest_api_aps/sd_it_gen_plan/install.php` โ ัััะฐะฝะธัะฐ ัััะฐะฝะพะฒะบะธ ะฟัะธะปะพะถะตะฝะธั

---

## ๐ ะะณะปะฐะฒะปะตะฝะธะต

1. [ะะฑัะฐั ััะตะผะฐ ัะฐะฑะพัั](#ะพะฑัะฐั-ััะตะผะฐ-ัะฐะฑะพัั)
2. [ะขะพัะบะฐ ะฒัะพะดะฐ: index.php](#ัะพัะบะฐ-ะฒัะพะดะฐ-indexphp)
3. [ะะธะฑะปะธะพัะตะบะฐ CRest](#ะฑะธะฑะปะธะพัะตะบะฐ-crest)
4. [Vue.js ะฟัะธะปะพะถะตะฝะธะต](#vuejs-ะฟัะธะปะพะถะตะฝะธะต)
5. [ะะพััะธะฝะณ ะธ ะฝะฐะฒะธะณะฐัะธั](#ัะพััะธะฝะณ-ะธ-ะฝะฐะฒะธะณะฐัะธั)
6. [API endpoints](#api-endpoints)
7. [ะะพัะพะบ ะดะฐะฝะฝัั](#ะฟะพัะพะบ-ะดะฐะฝะฝัั)
8. [ะะพะฝัะธะณััะฐัะธั ัะตัะฒะตัะฐ](#ะบะพะฝัะธะณััะฐัะธั-ัะตัะฒะตัะฐ)

---

## ๐๏ธ ะะฑัะฐั ััะตะผะฐ ัะฐะฑะพัั

### ะััะธัะตะบัััะฝะฐั ััะตะผะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    VPS ะกะตัะฒะตั (root)                         โ
โ                                                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  ะะตะฑ-ัะตัะฒะตั (Apache/Nginx)                           โ   โ
โ  โ  URL: https://back.kompo.by/rest_api_aps/sd_it_gen_plan/ โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                        โ                                     โ
โ                        โผ                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  index.php (ะขะพัะบะฐ ะฒัะพะดะฐ)                              โ   โ
โ  โ  - ะะพะดะบะปััะฐะตั crest.php                               โ   โ
โ  โ  - ะะฐะณััะถะฐะตั Vue.js ะฟัะธะปะพะถะตะฝะธะต ะธะท /dist/              โ   โ
โ  โ  - ะะฝะธัะธะฐะปะธะทะธััะตั Bitrix24 API                        โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                        โ                                     โ
โ        โโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโ                     โ
โ        โผ                               โผ                     โ
โ  โโโโโโโโโโโโโโโ              โโโโโโโโโโโโโโโโ              โ
โ  โ  crest.php  โ              โ  Vue.js App  โ              โ
โ  โ  (CRest)    โ              โ  (Frontend)  โ              โ
โ  โโโโโโโโโโโโโโโ              โโโโโโโโโโโโโโโโ              โ
โ        โ                               โ                     โ
โ        โ                               โ                     โ
โ        โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ                     โ
โ                        โผ                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  API Endpoints (/api/*.php)                           โ   โ
โ  โ  - bitrix24.php (ะฟัะพะบัะธ ะดะปั CRest)                    โ   โ
โ  โ  - webhook-handler.php (ะพะฑัะฐะฑะพัะบะฐ ะฒะตะฑััะบะพะฒ)           โ   โ
โ  โ  - webhook-logs.php (ะปะพะณะธ ะฒะตะฑััะบะพะฒ)                   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                        โ                                     โ
โ                        โผ                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  Bitrix24 REST API                                    โ   โ
โ  โ  (ะะฝะตัะฝะธะน ัะตัะฒะธั)                                     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ช ะขะพัะบะฐ ะฒัะพะดะฐ: index.php

### ะะฐัะฟะพะปะพะถะตะฝะธะต

**ะคะฐะนะป:** `/var/www/app/public/rest_api_aps/sd_it_gen_plan/index.php`  
**URL (Production):** `https://back.kompo.by/rest_api_aps/sd_it_gen_plan/index.php`  
**ะะปััะตัะฝะฐัะธะฒะฝัะน URL:** `https://back.kompo.by/rest_api_aps/sd_it_gen_plan/` (ัะตัะตะท .htaccess, ะตัะปะธ ะฝะฐัััะพะตะฝะพ)

**ะะฐะถะฝะพ:** ะญัะพ ะฟััะผะฐั ัััะปะบะฐ ะฝะฐ ัะพัะบั ะฒัะพะดะฐ ะฟัะธะปะพะถะตะฝะธั. ะัะธ ะพัะบัััะธะธ ััะพะณะพ URL ะทะฐะณััะถะฐะตััั Vue.js ะฟัะธะปะพะถะตะฝะธะต ั ะณะปะฐะฒะฝะพะน ัััะฐะฝะธัะตะน.

### ะกัััะบัััะฐ ัะฐะนะปะฐ

```1:72:index.php
<?php
require_once(__DIR__ . '/crest.php');
?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitrix24 REST Application</title>
    <?php
    // ะะฟัะตะดะตะปัะตะผ ะฑะฐะทะพะฒัะน ะฟััั ะดะปั ัะตะณะฐ <base>
    $scriptName = $_SERVER['SCRIPT_NAME'] ?? '';
    $basePath = dirname($scriptName);
    if ($basePath === '.') {
        $basePath = '';
    }
    if ($basePath && $basePath[0] !== '/') {
        $basePath = '/' . $basePath;
    }
    // ะะพะฑะฐะฒะปัะตะผ /dist/ ะบ ะฑะฐะทะพะฒะพะผั ะฟััะธ ะดะปั ะฟัะฐะฒะธะปัะฝะพะณะพ ัะฐะทัะตัะตะฝะธั ะฟััะตะน ะบ ัะตััััะฐะผ
    $baseHref = $basePath . '/dist/';
    ?>
    <base href="<?= htmlspecialchars($baseHref) ?>">
    <script src="//api.bitrix24.com/api/v1/"></script>
    <!-- ะ production ะธัะฟะพะปัะทัะนัะต ัะพะฑัะฐะฝะฝัะต ัะฐะนะปั ะธะท /dist -->
    <!-- ะะปั ัะฐะทัะฐะฑะพัะบะธ ะธัะฟะพะปัะทัะนัะต Vite dev server -->
    <?php 
    $distIndexPath = __DIR__ . '/dist/index.html';
    if (file_exists($distIndexPath)) { 
        // ะงะธัะฐะตะผ dist/index.html ะธ ะธะทะฒะปะตะบะฐะตะผ ะฟััะธ ะบ ัะบัะธะฟัะฐะผ ะธ ััะธะปัะผ
        $distHtml = file_get_contents($distIndexPath);
        // ะัะตะผ ัะบัะธะฟั ั type="module" (Vue.js), ะฐ ะฝะต Bitrix24 API ัะบัะธะฟั
        preg_match('/<script[^>]+type=["\']module["\'][^>]+src="([^"]+)"[^>]*>/i', $distHtml, $scriptMatch);
        // ะัะปะธ ะฝะต ะฝะฐัะปะธ, ะธัะตะผ ะปัะฑะพะน ัะบัะธะฟั ั crossorigin (Vite ัะฑะพัะบะฐ)
        if (empty($scriptMatch[1])) {
            preg_match('/<script[^>]+crossorigin[^>]+src="([^"]+)"[^>]*>/i', $distHtml, $scriptMatch);
        }
        preg_match('/<link[^>]+href="([^"]+)"[^>]*>/i', $distHtml, $styleMatch);
        
        // ะะฐะทะพะฒัะน ะฟััั ะดะปั ัะตััััะพะฒ (ะพะฟัะตะดะตะปัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฝะฐ ะพัะฝะพะฒะต ัะตะบััะตะณะพ ะฟััะธ)
        $scriptName = $_SERVER['SCRIPT_NAME'] ?? '';
        $basePath = dirname($scriptName);
        // ะฃะฑะธัะฐะตะผ ัะพัะบั, ะตัะปะธ ะฟััั ะบะพัะฝะตะฒะพะน
        if ($basePath === '.') {
            $basePath = '';
        }
        // ะฃะฑะตะถะดะฐะตะผัั, ััะพ ะฟััั ะฝะฐัะธะฝะฐะตััั ั /
        if ($basePath && $basePath[0] !== '/') {
            $basePath = '/' . $basePath;
        }
        
        if (!empty($scriptMatch[1])) {
            // ะััะธ ัะตะฟะตัั ะพัะฝะพัะธัะตะปัะฝัะต (./assets/...), ัะตะณ <base> ะพะฑัะฐะฑะพัะฐะตั ะธั ะฟัะฐะฒะธะปัะฝะพ
            // ะัะพััะพ ะฒัะฒะพะดะธะผ ะฟััั ะบะฐะบ ะตััั
            echo '<script type="module" crossorigin src="' . htmlspecialchars($scriptMatch[1]) . '"></script>' . "\n";
        }
        
        if (!empty($styleMatch[1])) {
            // ะััะธ ัะตะฟะตัั ะพัะฝะพัะธัะตะปัะฝัะต (./assets/...), ัะตะณ <base> ะพะฑัะฐะฑะพัะฐะตั ะธั ะฟัะฐะฒะธะปัะฝะพ
            // ะัะพััะพ ะฒัะฒะพะดะธะผ ะฟััั ะบะฐะบ ะตััั
            echo '<link rel="stylesheet" crossorigin href="' . htmlspecialchars($styleMatch[1]) . '">' . "\n";
        }
    } else { ?>
        <!-- ะ ัะตะถะธะผะต ัะฐะทัะฐะฑะพัะบะธ ะธัะฟะพะปัะทัะนัะต Vite dev server -->
        <script type="module" src="http://localhost:3000/src/main.js"></script>
    <?php } ?>
</head>
<body>
    <div id="app"></div>
</body>
</html>
```

### ะงัะพ ะดะตะปะฐะตั index.php

1. **ะะพะดะบะปััะตะฝะธะต ะฑะธะฑะปะธะพัะตะบะธ CRest:**
   ```php
   require_once(__DIR__ . '/crest.php');
   ```
   - ะะฐะณััะถะฐะตั ะบะปะฐัั `CRest` ะดะปั ัะฐะฑะพัั ั Bitrix24 REST API
   - ะะฝะธัะธะฐะปะธะทะธััะตั ะฝะฐัััะพะนะบะธ ะธะท `settings.php` ะธ `settings.json`

2. **ะะฟัะตะดะตะปะตะฝะธะต ะฑะฐะทะพะฒะพะณะพ ะฟััะธ:**
   - ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปัะตั ะฟััั ะบ ะฟัะธะปะพะถะตะฝะธั ะฝะฐ ะพัะฝะพะฒะต `$_SERVER['SCRIPT_NAME']`
   - ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั ัะตะณ `<base href="...">` ะดะปั ะฟัะฐะฒะธะปัะฝะพะณะพ ัะฐะทัะตัะตะฝะธั ะฟััะตะน ะบ ัะตััััะฐะผ

3. **ะะพะดะบะปััะตะฝะธะต Bitrix24 API:**
   ```html
   <script src="//api.bitrix24.com/api/v1/"></script>
   ```
   - ะะฐะณััะถะฐะตั ะพัะธัะธะฐะปัะฝัะน JavaScript SDK Bitrix24
   - ะัะตะดะพััะฐะฒะปัะตั ะณะปะพะฑะฐะปัะฝัะน ะพะฑัะตะบั `BX` ะดะปั ัะฐะฑะพัั ั Bitrix24 ะธะท ะฑัะฐัะทะตัะฐ

4. **ะะฐะณััะทะบะฐ Vue.js ะฟัะธะปะพะถะตะฝะธั:**
   - **Production ัะตะถะธะผ:** ะงะธัะฐะตั `/dist/index.html` ะธ ะธะทะฒะปะตะบะฐะตั ะฟััะธ ะบ ัะพะฑัะฐะฝะฝัะผ ัะฐะนะปะฐะผ
   - **Development ัะตะถะธะผ:** ะะพะดะบะปััะฐะตั Vite dev server ะฝะฐ `http://localhost:3000`

5. **ะะฝะธัะธะฐะปะธะทะฐัะธั Vue.js:**
   - ะกะพะทะดะฐัั ะบะพะฝัะตะนะฝะตั `<div id="app"></div>` ะดะปั ะผะพะฝัะธัะพะฒะฐะฝะธั Vue.js ะฟัะธะปะพะถะตะฝะธั

---

## ๐ ะะธะฑะปะธะพัะตะบะฐ CRest

### ะะฐัะฟะพะปะพะถะตะฝะธะต

**ะคะฐะนะป:** `/var/www/app/public/rest_api_aps/sd_it_gen_plan/crest.php`  
**ะะตััะธั:** 1.36  
**ะะฐะทะฝะฐัะตะฝะธะต:** ะะธะฑะปะธะพัะตะบะฐ ะดะปั ัะฐะฑะพัั ั Bitrix24 REST API

### ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ

1. **ะฃััะฐะฝะพะฒะบะฐ ะฟัะธะปะพะถะตะฝะธั:**
   ```php
   CRest::installApp()
   ```
   - ะะฑัะฐะฑะฐััะฒะฐะตั ัััะฐะฝะพะฒะบั ะฟัะธะปะพะถะตะฝะธั ะฒ Bitrix24
   - ะกะพััะฐะฝัะตั ัะพะบะตะฝั OAuth ะฒ `settings.json`

2. **ะัะทะพะฒ ะผะตัะพะดะพะฒ Bitrix24 REST API:**
   ```php
   CRest::call('crm.lead.list', ['filter' => [...], 'select' => [...]])
   ```
   - ะัะฟะพะปะฝัะตั HTTP-ะทะฐะฟัะพัั ะบ Bitrix24 REST API
   - ะะฒัะพะผะฐัะธัะตัะบะธ ะดะพะฑะฐะฒะปัะตั ัะพะบะตะฝ ะฐะฒัะพัะธะทะฐัะธะธ
   - ะะฑัะฐะฑะฐััะฒะฐะตั ะพะฑะฝะพะฒะปะตะฝะธะต ัะพะบะตะฝะพะฒ (refresh token)

3. **ะะฐะบะตัะฝัะต ะทะฐะฟัะพัั:**
   ```php
   CRest::callBatch([...])
   ```
   - ะัะฟะพะปะฝัะตั ะฝะตัะบะพะปัะบะพ ะทะฐะฟัะพัะพะฒ ะฒ ะพะดะฝะพะผ ะฒัะทะพะฒะต
   - ะะฐะบัะธะผัะผ 50 ะทะฐะฟัะพัะพะฒ ะฒ ะพะดะฝะพะผ batch

4. **ะะพะณะธัะพะฒะฐะฝะธะต:**
   - ะะฒัะพะผะฐัะธัะตัะบะธ ะปะพะณะธััะตั ะฒัะต ะทะฐะฟัะพัั ะฒ `/logs/YYYY-MM-DD/H/timestamp_type_log.json`
   - ะะพะถะฝะพ ะพัะบะปััะธัั ัะตัะตะท `C_REST_BLOCK_LOG`

### ะะพะฝัะธะณััะฐัะธั

**ะคะฐะนะป:** `/var/www/app/public/rest_api_aps/sd_it_gen_plan/settings.php`

```1:11:settings.php
<?php
define('C_REST_CLIENT_ID','local.69330b1ace2c65.27410382');//Application ID
define('C_REST_CLIENT_SECRET','vFlBSvoCUtpUv1PBEokj342DBiPxCBqZu300Zgmj0g7z7qu2TX');//Application key
// or
// define('C_REST_WEB_HOOK_URL','https://rest-course.bitrix24.ru/rest/1/j0nzq02mzvzmx9lx/');//url on creat Webhook

//define('C_REST_CURRENT_ENCODING','windows-1251');
//define('C_REST_IGNORE_SSL',true);//turn off validate ssl by curl
//define('C_REST_LOG_TYPE_DUMP',true); //logs save var_export for viewing convenience
//define('C_REST_BLOCK_LOG',true);//turn off default logs
//define('C_REST_LOGS_DIR', __DIR__ .'/logs/'); //directory path to save the log
```

**ะะฐะถะฝะพ:** ะกะตะบัะตัั ะดะพะปะถะฝั ะฑััั ะทะฐัะธัะตะฝั. ะ production ะธัะฟะพะปัะทัะนัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะธะปะธ ัะฐะนะปั ะฒะฝะต ะฒะตะฑ-ะบะพัะฝั.

---

## ๐จ Vue.js ะฟัะธะปะพะถะตะฝะธะต

### ะกัััะบัััะฐ

```
vue-app/
โโโ src/
โ   โโโ main.js              # ะขะพัะบะฐ ะฒัะพะดะฐ Vue.js
โ   โโโ App.vue              # ะะพัะฝะตะฒะพะน ะบะพะผะฟะพะฝะตะฝั
โ   โโโ router/              # ะะพััะธะฝะณ
โ   โ   โโโ index.js         # ะะพะฝัะธะณััะฐัะธั ะผะฐัััััะพะฒ
โ   โโโ components/          # Vue ะบะพะผะฟะพะฝะตะฝัั
โ   โ   โโโ IndexPage.vue    # ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
โ   โ   โโโ InstallPage.vue # ะกััะฐะฝะธัะฐ ัััะฐะฝะพะฒะบะธ
โ   โโโ pages/                # ะกััะฐะฝะธัั ะฟัะธะปะพะถะตะฝะธั
โ   โ   โโโ WebhookLogsPage.vue
โ   โโโ services/             # ะกะตัะฒะธัั ะดะปั API
โ   โ   โโโ access-control-service.js
โ   โโโ styles/               # ะกัะธะปะธ
โโโ dist/                     # ะกะพะฑัะฐะฝะฝัะต ัะฐะนะปั (production)
โโโ package.json
```

### ะขะพัะบะฐ ะฒัะพะดะฐ: main.js

```1:57:vue-app/src/main.js
import { createApp } from 'vue';
import App from './App.vue';
import router from './router';
import './styles/bitrix24-ui-variables.css';
import './styles/main.css';
// ะะผะฟะพัั ะบะพะฝัะธะณััะฐัะธะธ Chart.js ะดะปั ะณะปะพะฑะฐะปัะฝะพะน ัะตะณะธัััะฐัะธะธ
import '@/utils/chart-config.js';
import { getApiUrl } from '@/utils/path-utils.js';

const app = createApp(App);

app.use(router);

// ะะตะทะพะฟะฐัะฝะฐั ัะตัะธะฐะปะธะทะฐัะธั ะดะปั ะปะพะณะธัะพะฒะฐะฝะธั
const safeStringifyForLog = (obj) => {
  try {
    const seen = new WeakSet();
    return JSON.stringify(obj, (key, value) => {
      if (typeof value === 'object' && value !== null) {
        if (seen.has(value)) {
          return '[Circular]';
        }
        seen.add(value);
      }
      if (typeof value === 'function' || value === undefined) {
        return null;
      }
      return value;
    });
  } catch (e) {
    return String(obj);
  }
};

// ะะปะพะฑะฐะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
app.config.errorHandler = (err, instance, info) => {
  console.error('Vue error:', err, info);

  // ะะพะณะธัะพะฒะฐะฝะธะต ะฒ Bitrix24 (ะตัะปะธ ะดะพัััะฟะฝะพ)
  if (typeof BX !== 'undefined' && BX.ajax) {
    try {
      BX.ajax({
        url: getApiUrl('/api/log-error.php'),
        method: 'POST',
        data: {
          error: err?.message || String(err),
          info: typeof info === 'string' ? info : safeStringifyForLog(info),
          component: instance?.$options?.name || 'Unknown'
        }
      });
    } catch (e) {
      console.error('Failed to log error:', e);
    }
  }
};

app.mount('#app');
```

### ะงัะพ ะดะตะปะฐะตั main.js

1. **ะกะพะทะดะฐะฝะธะต Vue.js ะฟัะธะปะพะถะตะฝะธั:**
   - ะะผะฟะพััะธััะตั ะบะพัะฝะตะฒะพะน ะบะพะผะฟะพะฝะตะฝั `App.vue`
   - ะกะพะทะดะฐัั ัะบะทะตะผะฟะปัั ะฟัะธะปะพะถะตะฝะธั ัะตัะตะท `createApp()`

2. **ะะพะดะบะปััะตะฝะธะต ัะพััะตัะฐ:**
   - ะะตะณะธัััะธััะตั Vue Router ะดะปั ะฝะฐะฒะธะณะฐัะธะธ
   - ะะฐัััััั ะพะฟัะตะดะตะปะตะฝั ะฒ `router/index.js`

3. **ะะปะพะฑะฐะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ:**
   - ะะตัะตัะฒะฐััะฒะฐะตั ะฒัะต ะพัะธะฑะบะธ Vue.js
   - ะะพะณะธััะตั ะธั ัะตัะตะท Bitrix24 API (ะตัะปะธ ะดะพัััะฟะฝะพ)

4. **ะะพะฝัะธัะพะฒะฐะฝะธะต ะฟัะธะปะพะถะตะฝะธั:**
   - ะะพะฝัะธััะตั ะฟัะธะปะพะถะตะฝะธะต ะฒ ัะปะตะผะตะฝั `#app` (ัะพะทะดะฐะฝะฝัะน ะฒ `index.php`)

---

## ๐งญ ะะพััะธะฝะณ ะธ ะฝะฐะฒะธะณะฐัะธั

### ะะพะฝัะธะณััะฐัะธั ัะพััะตัะฐ

**ะคะฐะนะป:** `/var/www/app/public/rest_api_aps/sd_it_gen_plan/vue-app/src/router/index.js`

### ะัะฝะพะฒะฝัะต ะผะฐัััััั

1. **`/install`** โ ะกััะฐะฝะธัะฐ ัััะฐะฝะพะฒะบะธ ะฟัะธะปะพะถะตะฝะธั
   - ะะพะผะฟะพะฝะตะฝั: `InstallPage.vue`
   - ะะฐะทะฝะฐัะตะฝะธะต: ะฃััะฐะฝะพะฒะบะฐ ะฟัะธะปะพะถะตะฝะธั ะฒ Bitrix24

2. **`/`** โ ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
   - ะะพะผะฟะพะฝะตะฝั: `IndexPage.vue`
   - ะะฐะทะฝะฐัะตะฝะธะต: ะัะพะฑัะฐะถะตะฝะธะต ะดะฐัะฑะพัะดะฐ ั ะบะฝะพะฟะบะฐะผะธ ะพััััะพะฒ

3. **`/admin/webhook-logs`** โ ะะพะณะธ ะฒะตะฑััะบะพะฒ
   - ะะพะผะฟะพะฝะตะฝั: `WebhookLogsPage.vue`
   - ะขัะตะฑัะตั ะฐะฒัะพัะธะทะฐัะธะธ: `requiresAuth: true`
   - ะขะพะปัะบะพ ะดะปั ะฐะดะผะธะฝะธัััะฐัะพัะพะฒ: `adminOnly: true`

4. **`/dashboard/sector-1c`** โ ะะฐัะฑะพัะด ัะตะบัะพัะฐ 1ะก
   - ะะพะผะฟะพะฝะตะฝั: `DashboardSector1C.vue`
   - ะะตะฝะธะฒะฐั ะทะฐะณััะทะบะฐ (lazy loading)

### ะะฐะฒะธะณะฐัะธั

ะะพััะตั ะธัะฟะพะปัะทัะตั **hash mode** (`createWebHashHistory`), ััะพ ะพะทะฝะฐัะฐะตั:
- URL ะฒัะณะปัะดะธั ะบะฐะบ: `https://domain.com/#/dashboard/sector-1c`
- ะะต ััะตะฑัะตั ะฝะฐัััะพะนะบะธ ัะตัะฒะตัะฐ ะดะปั SPA

### ะะฑัะฐะฑะพัะบะฐ ะดะพัััะฟะฐ

ะะพััะตั ะฟัะพะฒะตััะตั ะดะพัััะฟ ัะตัะตะท `AccessControlService`:
- ะัะพะฒะตัะบะฐ ะฐะฒัะพัะธะทะฐัะธะธ ะฟะพะปัะทะพะฒะฐัะตะปั
- ะัะพะฒะตัะบะฐ ะฟัะฐะฒ ะฐะดะผะธะฝะธัััะฐัะพัะฐ
- ะะตะดะธัะตะบั ะฝะฐ ัััะฐะฝะธัั ัััะฐะฝะพะฒะบะธ, ะตัะปะธ ะฟัะธะปะพะถะตะฝะธะต ะฝะต ัััะฐะฝะพะฒะปะตะฝะพ

---

## ๐ API Endpoints

### ะะฐัะฟะพะปะพะถะตะฝะธะต

**ะะฐะฟะบะฐ:** `/var/www/app/public/rest_api_aps/sd_it_gen_plan/api/`

### ะัะฝะพะฒะฝัะต endpoints

#### 1. `api/bitrix24.php`

**ะะฐะทะฝะฐัะตะฝะธะต:** ะัะพะบัะธ ะดะปั ะฒัะทะพะฒะฐ Bitrix24 REST API ะธะท Vue.js

**ะะตัะพะด:** POST

**ะคะพัะผะฐั ะทะฐะฟัะพัะฐ:**
```json
{
  "method": "crm.lead.list",
  "params": {
    "filter": {...},
    "select": [...]
  }
}
```

**ะคะพัะผะฐั ะพัะฒะตัะฐ:**
```json
{
  "result": [...],
  "total": 100
}
```

**ะะฐะบ ัะฐะฑะพัะฐะตั:**
1. Vue.js ะพัะฟัะฐะฒะปัะตั POST-ะทะฐะฟัะพั ั ะผะตัะพะดะพะผ Bitrix24 ะธ ะฟะฐัะฐะผะตััะฐะผะธ
2. `bitrix24.php` ะฒัะทัะฒะฐะตั `CRest::call()` ั ะฟะตัะตะดะฐะฝะฝัะผะธ ะฟะฐัะฐะผะตััะฐะผะธ
3. ะะตะทัะปััะฐั ะฒะพะทะฒัะฐัะฐะตััั ะฒ JSON ัะพัะผะฐัะต

#### 2. `api/webhook-handler.php`

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะฑัะฐะฑะพััะธะบ ะธััะพะดััะธั ะฒะตะฑััะบะพะฒ ะพั Bitrix24

**ะะตัะพะด:** POST

**ะะฐะบ ัะฐะฑะพัะฐะตั:**
1. Bitrix24 ะพัะฟัะฐะฒะปัะตั ะฒะตะฑััะบ ะฟัะธ ัะพะฑััะธะธ (ะฝะฐะฟัะธะผะตั, ัะพะทะดะฐะฝะธะต ะทะฐะดะฐัะธ)
2. `webhook-handler.php` ะฟะพะปััะฐะตั ะดะฐะฝะฝัะต
3. ะะพะณะธััะตั ัะพะฑััะธะต ะฒ ัะฐะนะป ัะตัะตะท `WebhookLogs\Service\WebhookHandlerService`
4. ะะพะทะฒัะฐัะฐะตั ะพัะฒะตั Bitrix24

#### 3. `api/webhook-logs.php`

**ะะฐะทะฝะฐัะตะฝะธะต:** API ะดะปั ะฟะพะปััะตะฝะธั ะปะพะณะพะฒ ะฒะตะฑััะบะพะฒ

**ะะตัะพะด:** GET

**ะะฐัะฐะผะตััั:**
- `category` โ ะบะฐัะตะณะพัะธั (tasks, smart-processes, errors)
- `dateFrom` โ ะดะฐัะฐ ะฝะฐัะฐะปะฐ
- `dateTo` โ ะดะฐัะฐ ะพะบะพะฝัะฐะฝะธั
- `page` โ ะฝะพะผะตั ัััะฐะฝะธัั
- `limit` โ ะบะพะปะธัะตััะฒะพ ะทะฐะฟะธัะตะน

---

## ๐ ะะพัะพะบ ะดะฐะฝะฝัั

### ะกัะตะฝะฐัะธะน 1: ะะฐะณััะทะบะฐ ะณะปะฐะฒะฝะพะน ัััะฐะฝะธัั

```
1. ะะพะปัะทะพะฒะฐัะตะปั ะพัะบััะฒะฐะตั: https://back.kompo.by/rest_api_aps/sd_it_gen_plan/index.php
   โ
   โผ
2. ะะตะฑ-ัะตัะฒะตั ะพะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั โ index.php
   โ
   โผ
3. index.php:
   - ะะพะดะบะปััะฐะตั crest.php
   - ะะฟัะตะดะตะปัะตั ะฑะฐะทะพะฒัะน ะฟััั
   - ะะฐะณััะถะฐะตั Bitrix24 API ัะบัะธะฟั
   - ะะฐะณััะถะฐะตั Vue.js ะธะท /dist/
   โ
   โผ
4. ะัะฐัะทะตั ะทะฐะณััะถะฐะตั Vue.js ะฟัะธะปะพะถะตะฝะธะต:
   - main.js ะธะฝะธัะธะฐะปะธะทะธััะตั ะฟัะธะปะพะถะตะฝะธะต
   - ะะพััะตั ะพะฟัะตะดะตะปัะตั ะผะฐััััั (/)
   โ
   โผ
5. IndexPage.vue ะทะฐะณััะถะฐะตััั:
   - ะัะพะฒะตััะตั ะดะพัััะฟ ัะตัะตะท AccessControlService
   - ะะฐะณััะถะฐะตั ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั ัะตัะตะท Bitrix24 API
   - ะัะพะฑัะฐะถะฐะตั ะดะฐัะฑะพัะด ั ะบะฝะพะฟะบะฐะผะธ ะพััััะพะฒ
```

### ะกัะตะฝะฐัะธะน 2: ะะฐะฟัะพั ะดะฐะฝะฝัั ะธะท Vue.js

```
1. Vue.js ะบะพะผะฟะพะฝะตะฝั ะฒัะทัะฒะฐะตั API:
   fetch('https://back.kompo.by/rest_api_aps/sd_it_gen_plan/api/bitrix24.php', {
     method: 'POST',
     body: JSON.stringify({
       method: 'crm.lead.list',
       params: {...}
     })
   })
   โ
   โผ
2. api/bitrix24.php:
   - ะะพะปััะฐะตั ะดะฐะฝะฝัะต ะทะฐะฟัะพัะฐ
   - ะัะทัะฒะฐะตั CRest::call('crm.lead.list', {...})
   โ
   โผ
3. CRest::call():
   - ะงะธัะฐะตั ะฝะฐัััะพะนะบะธ ะธะท settings.json
   - ะคะพัะผะธััะตั URL: https://domain.bitrix24.ru/rest/crm.lead.list.json
   - ะะพะฑะฐะฒะปัะตั ัะพะบะตะฝ ะฐะฒัะพัะธะทะฐัะธะธ
   - ะัะฟะพะปะฝัะตั HTTP-ะทะฐะฟัะพั ัะตัะตะท cURL
   โ
   โผ
4. Bitrix24 REST API:
   - ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั
   - ะะพะทะฒัะฐัะฐะตั ะดะฐะฝะฝัะต ะฒ JSON
   โ
   โผ
5. CRest ะพะฑัะฐะฑะฐััะฒะฐะตั ะพัะฒะตั:
   - ะะฐััะธั JSON
   - ะัะพะฒะตััะตั ะฝะฐ ะพัะธะฑะบะธ (expired_token, etc.)
   - ะะฑะฝะพะฒะปัะตั ัะพะบะตะฝ, ะตัะปะธ ะฝัะถะฝะพ
   โ
   โผ
6. api/bitrix24.php ะฒะพะทะฒัะฐัะฐะตั ัะตะทัะปััะฐั ะฒ Vue.js
   โ
   โผ
7. Vue.js ะบะพะผะฟะพะฝะตะฝั ะพะฑะฝะพะฒะปัะตั UI
```

### ะกัะตะฝะฐัะธะน 3: ะะฑัะฐะฑะพัะบะฐ ะฒะตะฑััะบะฐ ะพั Bitrix24

```
1. Bitrix24 ะพัะฟัะฐะฒะปัะตั ะฒะตะฑััะบ:
   POST https://back.kompo.by/rest_api_aps/sd_it_gen_plan/api/webhook-handler.php
   Body: {
     "event": "ONTASKADD",
     "data": {...}
   }
   โ
   โผ
2. api/webhook-handler.php:
   - ะะพะปััะฐะตั ะดะฐะฝะฝัะต ะฒะตะฑััะบะฐ
   - ะะฐะปะธะดะธััะตั ะฟะพะดะฟะธัั (ะตัะปะธ ะฝะฐัััะพะตะฝะพ)
   - ะัะทัะฒะฐะตั WebhookHandlerService
   โ
   โผ
3. WebhookHandlerService:
   - ะะฟัะตะดะตะปัะตั ะบะฐัะตะณะพัะธั ัะพะฑััะธั
   - ะะทะฒะปะตะบะฐะตั ะดะตัะฐะปะธ ัะพะฑััะธั
   - ะกะพััะฐะฝัะตั ะปะพะณ ะฒ ัะฐะนะป
   โ
   โผ
4. ะะพะทะฒัะฐัะฐะตั ะพัะฒะตั Bitrix24:
   {
     "success": true,
     "event": "ONTASKADD",
     "timestamp": "..."
   }
```

---

## โ๏ธ ะะพะฝัะธะณััะฐัะธั ัะตัะฒะตัะฐ

### VPS ัะตัะฒะตั

**ะะบััะถะตะฝะธะต:** VPS ัะตัะฒะตั ะฟะพะด root  
**ะััั ะบ ะฟัะธะปะพะถะตะฝะธั:** `/var/www/app/public/rest_api_aps/sd_it_gen_plan/`

### ะัะฐะฒะฐ ะดะพัััะฟะฐ

**ะะตะบะพะผะตะฝะดัะตะผัะต ะฟัะฐะฒะฐ:**
- ะะฐะฟะบะธ: `775` (drwxrwxr-x)
- ะคะฐะนะปั: `664` (-rw-rw-r--)

**ะัะธัะธัะฝัะต ัะฐะนะปั:**
- `settings.json` โ ะดะพะปะถะตะฝ ะฑััั ะทะฐัะธััะฝ (ะฟัะฐะฒะฐ `600`)
- `settings.php` โ ัะพะดะตัะถะธั ัะตะบัะตัั (ะฟัะฐะฒะฐ `600`)
- `logs/` โ ะดะพะปะถะฝะฐ ะฑััั ะดะพัััะฟะฝะฐ ะดะปั ะทะฐะฟะธัะธ

### ะะตะฑ-ัะตัะฒะตั

#### Apache (.htaccess)

ะัะปะธ ะธัะฟะพะปัะทัะตััั Apache, ัะพะทะดะฐะนัะต `.htaccess` ะฒ ะบะพัะฝะต ะฟัะธะปะพะถะตะฝะธั:

```apache
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /rest_api_aps/sd_it_gen_plan/
    
    # ะะฐะทัะตัะฐะตะผ ะดะพัััะฟ ะบ ััะฐัะธัะตัะบะธะผ ัะฐะนะปะฐะผ
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    
    # ะะตัะตะฝะฐะฟัะฐะฒะปัะตะผ ะฝะฐ index.php ะดะปั Vue Router
    RewriteRule ^(.*)$ index.php [L,QSA]
</IfModule>
```

#### Nginx

ะัะปะธ ะธัะฟะพะปัะทัะตััั Nginx, ะดะพะฑะฐะฒััะต ะฒ ะบะพะฝัะธะณััะฐัะธั:

```nginx
location /rest_api_aps/sd_it_gen_plan/ {
    root /var/www/app/public;
    try_files $uri $uri/ /rest_api_aps/sd_it_gen_plan/index.php?$query_string;
    
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}
```

### PHP ััะตะฑะพะฒะฐะฝะธั

- **PHP ะฒะตััะธั:** 8.3+ (ัะตะบะพะผะตะฝะดัะตััั 8.4)
- **ะะฐััะธัะตะฝะธั:**
  - `curl` โ ะดะปั HTTP-ะทะฐะฟัะพัะพะฒ ะบ Bitrix24
  - `json` โ ะดะปั ัะฐะฑะพัั ั JSON
  - `mbstring` โ ะดะปั ัะฐะฑะพัั ั ะบะพะดะธัะพะฒะบะฐะผะธ

### ะัะพะฒะตัะบะฐ ัะตัะฒะตัะฐ

ะัะฟะพะปัะทัะนัะต `checkserver.php` ะดะปั ะฟัะพะฒะตัะบะธ:

```bash
php checkserver.php
```

ะัะพะฒะตััะตั:
- ะะฐะปะธัะธะต ะฑะธะฑะปะธะพัะตะบะธ cURL
- ะัะฐะฒะฐ ะฝะฐ ัะพะทะดะฐะฝะธะต ัะฐะนะปะพะฒ
- ะัะฐะฒะฐ ะฝะฐ ัะพะทะดะฐะฝะธะต ะปะพะณะพะฒ

---

## ๐ ะะตะทัะผะต

### ะะปััะตะฒัะต ะผะพะผะตะฝัั

1. **ะขะพัะบะฐ ะฒัะพะดะฐ:** `index.php` โ ะตะดะธะฝััะฒะตะฝะฝะฐั ัะพัะบะฐ ะฒัะพะดะฐ ะดะปั ะฒะตะฑ-ะธะฝัะตััะตะนัะฐ
2. **Backend:** `crest.php` โ ะฑะธะฑะปะธะพัะตะบะฐ ะดะปั ัะฐะฑะพัั ั Bitrix24 REST API
3. **Frontend:** Vue.js ะฟัะธะปะพะถะตะฝะธะต ะฒ `/dist/` (production) ะธะปะธ Vite dev server (development)
4. **API:** Endpoints ะฒ `/api/` ะพะฑัะฐะฑะฐััะฒะฐัั ะทะฐะฟัะพัั ะพั Vue.js ะธ ะฒะตะฑััะบะธ ะพั Bitrix24
5. **ะะพััะธะฝะณ:** Vue Router ั hash mode ะดะปั ะฝะฐะฒะธะณะฐัะธะธ ะฑะตะท ะฟะตัะตะทะฐะณััะทะบะธ ัััะฐะฝะธัั

### ะะพัะพะบ ัะฐะฑะพัั

```
ะะพะปัะทะพะฒะฐัะตะปั โ ะะตะฑ-ัะตัะฒะตั โ index.php โ Vue.js โ API endpoints โ CRest โ Bitrix24
```

### ะะตะทะพะฟะฐัะฝะพััั

- ะกะตะบัะตัั ััะฐะฝัััั ะฒ `settings.php` ะธ `settings.json`
- ะัะฐะฒะฐ ะดะพัััะฟะฐ ะฝะฐัััะพะตะฝั ะดะปั ะทะฐัะธัั ะบะพะฝัะธะดะตะฝัะธะฐะปัะฝัั ะดะฐะฝะฝัั
- ะะฐะปะธะดะฐัะธั ะฒะตะฑััะบะพะฒ ัะตัะตะท ะฟะพะดะฟะธัั (ะตัะปะธ ะฝะฐัััะพะตะฝะพ)

---

## ๐ ะกะฒัะทะฐะฝะฝัะต ะดะพะบัะผะตะฝัั

- [API Endpoints](../API-REFERENCES/README.md) โ ะดะพะบัะผะตะฝัะฐัะธั ะฟะพ API endpoints
- [Webhook Handler](../USER-GUIDE/logs-webhooks/04-webhook-handler.md) โ ะพะฑัะฐะฑะพัะบะฐ ะฒะตะฑััะบะพะฒ
- [Vue.js ะฟัะธะปะพะถะตะฝะธะต](../VUE/README.md) โ ะดะพะบัะผะตะฝัะฐัะธั ะฟะพ Vue.js ะฟัะธะปะพะถะตะฝะธั
- [Deployment](../DEPLOYMENT/README.md) โ ะธะฝััััะบัะธะธ ะฟะพ ัะฐะทะฒััััะฒะฐะฝะธั

---

**ะััะพัะธั ะฟัะฐะฒะพะบ:**
- 2025-12-23 08:11 (UTC+3, ะัะตัั): ะกะพะทะดะฐะฝ ะดะพะบัะผะตะฝั

