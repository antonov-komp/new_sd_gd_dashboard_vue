# TASK-025-05: Этап 5 — Тестирование, интеграция и регрессия по приоритетам

**Дата создания:** 2025-12-11 14:47 (UTC+3, Брест)  
**Статус:** Новая  
**Приоритет:** Высокий  
**Исполнитель:** Bitrix24 Программист (Vue.js)  
**Родительская задача:** TASK-025  

## Цель этапа

Провести финальное тестирование и интеграцию изменений по системе приоритетов `UF_CRM_7_UF_PRIORITY`: проверить корректность конфигурации, маппера, UI (TicketCard и другие компоненты), fallback-логику для неизвестных значений, экспорт/фильтры, регрессию drag & drop и производительность.

## Контекст

- Этапы 25-01..25-04 реализуют конфиг, маппер, UI и обработку unknown.  
- Нужно убедиться, что вся цепочка работает: Bitrix24 данные → маппер → компоненты → фильтры/экспорт → логирование.  
- Смарт-процесс 140, поле `UF_CRM_7_UF_PRIORITY`, useOriginalUfNames: 'Y'.

---

## Область работ этапа

1) Функциональное тестирование приоритетов (все 7 значений + unknown).  
2) Интеграционное тестирование цепочки данных из Bitrix24.  
3) UI-тестирование TicketCard и связанных компонентов/списков/фильтров/экспорта.  
4) Проверка fallback, логирования и отсутствия ошибок в прод-режиме.  
5) Проверка производительности и отсутствия лишних перерисовок.  
6) Обновление документации и чек-листов.  

---

## Детальный план (шаги)

### Шаг 1. Подготовка данных
- Получить тестовые тикеты для всех приоритетов:  
  - Генеральский  
  - Внешние обстоятельства  
  - Задачи правления и совета директоров  
  - Ошибки/сбои  
  - Текущая деятельность  
  - Проекты  
  - Оптимизация  
- Создать/выбрать тикет с пустым/нестандартным значением приоритета для проверки fallback.
- Убедиться, что API возвращает поле `UF_CRM_7_UF_PRIORITY` (select: ['*'] или явный список).

### Шаг 2. Функциональное тестирование маппера
- Проверить, что `mapTicket` отдаёт:  
  - `priorityId`, `priorityLabel`, `priorityColors` для всех 7 значений.  
  - unknown → fallback (`Не указано`, нейтральные цвета).  
- Проверить `mapPriorityToBitrix`:  
  - Для каждого `priorityId` возвращается корректный `bitrixValue`.  
  - unknown → default/fallback текст.
- Проверить нормализацию регистра/пробелов.

### Шаг 3. UI-тесты компонентов (ручные/визуальные)
- `TicketCard.vue`:  
  - Чип текста/цветов для всех 7 приоритетов, проверка контраста и бордера.  
  - Unknown → «Не указано» + нейтральные цвета.  
  - Hover/drag эффекты не сбивают цвета.  
- Списки/таблицы/виджеты, где отображается приоритет:  
  - Текст/цвета корректны, unknown показывает fallback.  
  - Нет жёстких классов high/medium/low в рендере.  
- Фильтры/сортировки (если есть):  
  - Неизвестные в отдельной группе/в конце.  
  - Нет падений при пустом значении.

### Шаг 4. Интеграция с данными Bitrix24
- Прогнать загрузку `crm.item.list` в реальном стенде (dev/stage):  
  - Убедиться, что приходят значения, маппер не падает.  
  - Проверить кеш/обновление данных (если есть).  
- Проверить `crm.item.update`/создание:  
  - Обратный маппинг приоритета в Bitrix24 поле (текст).  
  - Нет расхождений с UI.

### Шаг 5. Логирование и dev/prod режимы
- Dev: неизвестные значения логируются `console.warn` не более одного раза на уникальное значение (или отключаемо флагом).  
- Prod: нет лишних логов/ошибок в консоли.  
- Если включена диагностическая панель — опционально выводить там (флагом).

### Шаг 6. Экспорт/логи
- `useLogsExport.js` и другие экспорты:  
  - Поле «Приоритет» заполняется label или «Не указано».  
  - Нет пустых/undefined.  
- Webhook logs (если есть) — аналогично.

### Шаг 7. Производительность
- Проверить, что динамические стили не вызывают заметных перерисовок в списках.  
- Нет дергания FPS при drag & drop.  
- Размер бандла не растёт существенно (конфиг небольшой).

### Шаг 8. Документация и чек-листы
- Обновить `TASK-025` родительский (краткий статус).  
- При необходимости обновить `TASK-024-03-unify-colors-chart.md`, если цвета скорректированы.  
- Добавить результаты тестов в Wiki/README (кратко).

---

## Артефакты этапа

- Отметки в чек-листах/задачах о прохождении тестов.  
- Обновлённые экспорты/фильтры (если правились) с поддержкой fallback.  
- Обновлённая документация по цветам/приоритетам (при изменениях).

---

## Критерии приёмки этапа

- [ ] Все 7 приоритетов отображаются корректно (текст, цвет, бордер) во всех компонентах.  
- [ ] Unknown/пустое значение отображается как «Не указано» с нейтральными цветами без ошибок.  
- [ ] Маппер корректно конвертирует туда/обратно (UF → id/label/цвета, id → UF текст).  
- [ ] Нет ошибок в прод-консоли; в dev логируются только неизвестные значения (не спамят).  
- [ ] Экспорт/логи/фильтры работают, неизвестные значения не ломают отчёты.  
- [ ] Drag & drop и остальные функции карточек работают без регрессии.  
- [ ] Документация обновлена при необходимости.

---

## Риски и допущения

- Возможно, появятся новые значения приоритета — покрыто fallback, но требуется мониторинг логов в dev.  
- Цвета могут потребовать корректировки после UX/QA — предусмотреть быструю правку в конфиге.  
- Если найдутся места со старым полем `priority`, их нужно добить и перевести на новый формат.

---

## Завершение задачи

- После выполнения этапа обновить статус в родительской TASK-025.  
- При необходимости зафиксировать итоговые цвета/решения в `TASK-024-03-unify-colors-chart.md`.  

