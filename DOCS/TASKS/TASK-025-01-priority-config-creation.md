# TASK-025-01: Этап 1 — Создание конфигурации приоритетов (UF_CRM_7_UF_PRIORITY)

**Дата создания:** 2025-12-11 14:47 (UTC+3, Брест)  
**Статус:** Новая  
**Приоритет:** Высокий  
**Исполнитель:** Bitrix24 Программист (Vue.js)  
**Родительская задача:** TASK-025  

## Цель этапа

Создать централизованную конфигурацию приоритетов на основе значения пользовательского поля Bitrix24 `UF_CRM_7_UF_PRIORITY`, чтобы обеспечить единообразное отображение (цвета, текст, порядок) во всех компонентах дашборда и готовить данные для дальнейшего маппинга в компоненты.

## Контекст

- Источник данных: пользовательское поле смарт-процесса `UF_CRM_7_UF_PRIORITY` (текстовые значения).  
- Устойчивые значения (из ТЗ):  
  - Генеральский  
  - Внешние обстоятельства  
  - Задачи правления и совета директоров  
  - Ошибки/сбои  
  - Текущая деятельность  
  - Проекты  
  - Оптимизация  
- Требуется конфиг с визуальными параметрами (цвет/фон/текст), порядком сортировки и fallback для пустых/неидентифицированных значений.

---

## Область работ этапа

1) Создать файл конфигурации приоритетов.  
2) Описать структуру объекта приоритета.  
3) Добавить утилиты для получения/валидации приоритетов.  
4) Задать визуальные параметры (цвета чипов) и порядок сортировки.  
5) Добавить fallback приоритет для пустых/неизвестных значений.  
6) Задокументировать формат и правила расширения.

---

## Детальный план (шаги)

### Шаг 1. Создать файл конфига
- Путь: `vue-app/src/config/priority-config.js`.
- Экспортировать:
  - `PRIORITY_CONFIG` — словарь по ключу `bitrixValue` или `id`.
  - `PRIORITY_LIST` — массив для итераций/сортировки.
  - `DEFAULT_PRIORITY_ID` — id fallback-приоритета.

### Шаг 2. Определить структуру приоритета
- Поля объекта (минимум):
  - `id` — внутренний id (kebab/camel: `general`, `external`, ...).
  - `label` — отображаемый текст.
  - `bitrixValue` — исходное значение из `UF_CRM_7_UF_PRIORITY`.
  - `color` — основной цвет (граница чипа).
  - `backgroundColor` — фон чипа.
  - `textColor` — цвет текста чипа.
  - `order` — число для сортировки/отображения.
  - `description` — краткое описание (опционально).

### Шаг 3. Задать значения для всех приоритетов
- Добавить 7 приоритетов из списка ТЗ.
- Подобрать цвета (читаемость на светлом фоне, достаточный контраст):
  - Предложение:  
    - Генеральский — тёмно-фиолетовый/бордовый (высший приоритет).  
    - Внешние обстоятельства — красный/оранжевый.  
    - Задачи правления и совета директоров — насыщенный синий.  
    - Ошибки/сбои — красный.  
    - Текущая деятельность — серо-синий.  
    - Проекты — зелёный/бирюзовый.  
    - Оптимизация — жёлтый/оливковый.  
- Определить порядок (order) от самого высокого к низшему; при равенстве — по алфавиту/бизнес-логике.

### Шаг 4. Добавить fallback-приоритет
- Добавить приоритет `unknown`/`unspecified`:
  - `bitrixValue`: `null` или `'__unknown__'`.
  - `label`: «Не указано».
  - Нейтральные цвета (серый фон, тёмный текст).
  - Наименьший порядок (самый низкий).
- Использовать его при:
  - Пустом значении.
  - Значении, отсутствующем в конфиге.

### Шаг 5. Утилиты для работы с приоритетами
- Экспортировать функции:
  - `getPriorityByBitrixValue(value)` — возврат объекта приоритета или fallback.
  - `getPriorityById(id)` — возврат объекта или fallback.
  - `getPriorityList()` — отсортированный массив для UI.
  - `isKnownPriority(value)` — boolean.
  - (Опц.) `getPriorityColors(id|value)` — удобный доступ к цветам.
- Требования:
  - Нормализовать вход: trim, строка, сравнение регистронезависимое.
  - Логировать неизвестные значения (console.warn в dev).

### Шаг 6. Совместимость и подготовка к интеграции
- Не менять существующие константы в `utils/constants.js` на этом этапе — только добавить новый конфиг.
- Подготовить короткую инструкцию использования:
  - Импортировать `getPriorityByBitrixValue` в маппере.
  - Передавать `priority.id`/`priority.label`/`priority.color` в компоненты.

### Шаг 7. Документация внутри файла
- Добавить JSDoc к объектам и функциям.
- В комментарии указать источник значений: Bitrix24 `UF_CRM_7_UF_PRIORITY`, документация: https://context7.com/bitrix24/rest/.

---

## Артефакты этапа

- `vue-app/src/config/priority-config.js` — основной конфиг и утилиты.
- (Опционально) `README`-блок в начале файла с примерами использования.

---

## Критерии приёмки этапа

- [ ] Все 7 приоритетов из ТЗ внесены с уникальными `id`, `bitrixValue`, цветами и порядком.
- [ ] Добавлен fallback-приоритет «Не указано» с нейтральным стилем.
- [ ] Есть утилиты получения приоритета по `bitrixValue`/`id`, список и проверка известности.
- [ ] Нормализация входного значения (trim, регистр) и защита от `null/undefined`.
- [ ] Документация в файле: структура, пример использования, ссылка на Bitrix24 REST.
- [ ] Конфиг не ломает существующий код (пока не используется в рантайме).

---

## Риски и допущения

- Значения `UF_CRM_7_UF_PRIORITY` могут прийти в другом регистре — учтено нормализацией.
- Возможны новые значения приоритета — обработка через fallback, нужно логировать.
- Цвета могут потребовать корректировки после UX-ревью (контраст/стили бренда Bitrix24).

---

## Следующие шаги после этапа

- Этап 2 (TASK-025-02): интегрировать конфиг в `ticket-mapper.js`, использовать `UF_CRM_7_UF_PRIORITY`.
- Этап 3 (TASK-025-03): применить конфиг в `TicketCard.vue` (чипы и цвета).
- Этап 4 (TASK-025-04): валидация/обработка неизвестных значений в рантайме.
- Этап 5 (TASK-025-05): регрессионное тестирование UI и обновление документации.

---

## Результаты выполнения (2025-12-11, UTC+3, Брест)

- Создан конфиг приоритетов `vue-app/src/config/priority-config.js` с 7 значениями UF_CRM_7_UF_PRIORITY и fallback «Не указано».
- Добавлены утилиты: `getPriorityByBitrixValue`, `getPriorityById`, `getPriorityList`, `getPriorityColors`, `isKnownPriority`, нормализация входа и dev-логирование неизвестных значений.
- Заданы цвета/порядок/описания для всех приоритетов, настроен нейтральный стиль fallback.
