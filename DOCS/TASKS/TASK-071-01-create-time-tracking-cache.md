# TASK-071-01: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞ TimeTrackingCache

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-23 18:03 (UTC+3, –ë—Ä–µ—Å—Ç)  
**–°—Ç–∞—Ç—É—Å:** –ù–æ–≤–∞—è  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** Backend Developer (PHP)  
**–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞:** [TASK-071: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–æ–¥—É–ª—è "–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"](./TASK-071-cache-time-tracking-sector-1c.md)  
**–ü–æ–¥–∑–∞–¥–∞—á–∞:** –≠—Ç–∞–ø 1 –∏–∑ TASK-071

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `TimeTrackingCache` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤—ã–º –∫–µ—à–µ–º, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `GraphAdmissionClosureCache` –∏–∑ –º–æ–¥—É–ª—è "–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π". –ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ—á–∏—Å—Ç–∫—É –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å TTL 5 –º–∏–Ω—É—Ç.

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°".

---

## üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

- –ú–æ–¥—É–ª—å "–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°" –Ω–µ –∏–º–µ–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: `GraphAdmissionClosureCache` –≤ `api/cache/GraphAdmissionClosureCache.php`

### –¢—Ä–µ–±—É–µ—Ç—Å—è:

- –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `TimeTrackingCache` –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å `GraphAdmissionClosureCache`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤—ã–º –∫–µ—à–µ–º
- –û–±–µ—Å–ø–µ—á–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–ª—é—á–µ–π –∫–µ—à–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
- –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üèóÔ∏è –ú–æ–¥—É–ª–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:

- `api/cache/TimeTrackingCache.php` ‚Äî –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤—ã–º –∫–µ—à–µ–º

### –ù–æ–≤—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

- `api/cache/time-tracking-sector-1c/` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∫–µ—à–∞

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **–û—Ç –∑–∞–¥–∞—á:** 
  - TASK-071: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–æ–¥—É–ª—è "–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"
- **–û—Ç –º–æ–¥—É–ª–µ–π:** 
  - –ö–ª–∞—Å—Å: `GraphAdmissionClosureCache` (–∫–∞–∫ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å)
- **–û—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫:** 
  - PHP 8.4+ (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏)

---

## üéØ –°—Ç—É–ø–µ–Ω—á–∞—Ç—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.1: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–µ—à–∞

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∫–µ—à–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.

**–®–∞–≥–∏:**

1. **–°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∫–µ—à–∞**
   ```bash
   # –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
   mkdir -p api/cache/time-tracking-sector-1c
   
   # –ò–ª–∏ –ø–æ–ª–Ω—ã–π –ø—É—Ç—å
   mkdir -p /var/www/app/public/rest_api_aps/sd_it_gen_plan/api/cache/time-tracking-sector-1c
   ```
   - **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ—Ç–æ–¥–æ–º `ensureCacheDirectory()`, –Ω–æ –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**
   ```bash
   chmod 755 api/cache/time-tracking-sector-1c
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
   ls -la api/cache/
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: drwxr-xr-x time-tracking-sector-1c
   ```
   - **–í–∞–∂–Ω–æ:** –í–µ–±-—Å–µ—Ä–≤–µ—Ä (www-data –∏–ª–∏ nginx) –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å

3. **–î–æ–±–∞–≤–∏—Ç—å `.gitkeep` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ Git**
   ```bash
   touch api/cache/time-tracking-sector-1c/.gitkeep
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
   ls -la api/cache/time-tracking-sector-1c/
   # –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∞–π–ª .gitkeep
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (755)
- [ ] `.gitkeep` –¥–æ–±–∞–≤–ª–µ–Ω

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.2: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–ª–∞—Å—Å–∞ TimeTrackingCache

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `TimeTrackingCache` —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏ –∏ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

**–®–∞–≥–∏:**

1. **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `api/cache/TimeTrackingCache.php`**

2. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–ª–∞—Å—Å–∞:**
   ```php
   <?php
   /**
    * –§–∞–π–ª–æ–≤—ã–π –∫–µ—à –¥–ª—è API endpoint tickets-time-tracking-sector-1c.php
    * 
    * TASK-071-01: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞ TimeTrackingCache
    * 
    * –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: api/cache/TimeTrackingCache.php
    * 
    * –£–ø—Ä–∞–≤–ª—è–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏
    * –ü—Ä–∏–Ω—Ü–∏–ø —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω GraphAdmissionClosureCache
    */
   class TimeTrackingCache
   {
       /**
        * –ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞
        * –§–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ api/cache/, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º __DIR__ –Ω–∞–ø—Ä—è–º—É—é
        */
       private const CACHE_BASE_DIR = __DIR__ . '/time-tracking-sector-1c';
       
       /**
        * TTL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (5 –º–∏–Ω—É—Ç)
        */
       private const DEFAULT_TTL = 300;
   }
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –§–∞–π–ª `TimeTrackingCache.php` —Å–æ–∑–¥–∞–Ω
- [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ TASK-071-01

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ get()

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `get()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–µ—à–∞.

**–®–∞–≥–∏:**

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `get()`**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
   - –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
   - –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JSON
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç—ë–∫—à–∏—Ö —Ñ–∞–π–ª–æ–≤

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```php
/**
 * –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞
 * 
 * @param string $key –ö–ª—é—á –∫–µ—à–∞
 * @return array|null –î–∞–Ω–Ω—ã–µ –∏–ª–∏ null, –µ—Å–ª–∏ –∫–µ—à –Ω–µ –Ω–∞–π–¥–µ–Ω/–∏—Å—Ç—ë–∫
 */
public static function get(string $key): ?array
{
    $cachePath = self::getCachePath($key);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
    if (!file_exists($cachePath)) {
        return null;
    }
    
    // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
    $content = @file_get_contents($cachePath);
    if ($content === false) {
        error_log("[TimeTrackingCache] Failed to read cache file: {$cachePath}");
        return null;
    }
    
    // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JSON
    $data = @json_decode($content, true);
    if ($data === null || !is_array($data)) {
        error_log("[TimeTrackingCache] Failed to decode cache file: {$cachePath}");
        return null;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
    if (!isset($data['metadata']['expires_at'])) {
        error_log("[TimeTrackingCache] Invalid cache structure: {$cachePath}");
        return null;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
    if (time() > $data['metadata']['expires_at']) {
        // –ö–µ—à –∏—Å—Ç—ë–∫, —É–¥–∞–ª—è–µ–º —Ñ–∞–π–ª
        @unlink($cachePath);
        return null;
    }
    
    return $data['data'] ?? null;
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ú–µ—Ç–æ–¥ `get()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç—ë–∫—à–∏—Ö —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.4: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ set()

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `set()` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –∫–µ—à.

**–®–∞–≥–∏:**

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `set()`**
   - –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
   - –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ JSON
   - –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
   - –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```php
/**
 * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –∫–µ—à
 * 
 * @param string $key –ö–ª—é—á –∫–µ—à–∞
 * @param array $data –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
 * @param int $ttl TTL –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5 –º–∏–Ω—É—Ç)
 * @return bool true –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
 */
public static function set(string $key, array $data, int $ttl = self::DEFAULT_TTL): bool
{
    // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if (!self::ensureCacheDirectory()) {
        return false;
    }
    
    $cachePath = self::getCachePath($key);
    $now = time();
    
    // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
    $cacheData = [
        'data' => $data,
        'metadata' => [
            'created_at' => $now,
            'expires_at' => $now + $ttl,
            'ttl' => $ttl
        ]
    ];
    
    // –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ JSON
    $json = json_encode($cacheData, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
    if ($json === false) {
        error_log("[TimeTrackingCache] Failed to encode cache data for key: {$key}");
        return false;
    }
    
    // –ó–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª (–∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª)
    $tempPath = $cachePath . '.tmp';
    if (@file_put_contents($tempPath, $json, LOCK_EX) === false) {
        error_log("[TimeTrackingCache] Failed to write cache file: {$tempPath}");
        return false;
    }
    
    // –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
    if (!@rename($tempPath, $cachePath)) {
        error_log("[TimeTrackingCache] Failed to rename cache file: {$tempPath} -> {$cachePath}");
        @unlink($tempPath);
        return false;
    }
    
    return true;
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ú–µ—Ç–æ–¥ `set()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.5: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–µ—à–µ–º.

**–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **`getCachePath(string $key): string`** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É –∫–µ—à–∞
2. **`ensureCacheDirectory(): bool`** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞
3. **`delete(string $key): bool`** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –∫–µ—à–∞
4. **`clear(): bool`** ‚Äî –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫–µ—à–∞
5. **`clearExpired(): int`** ‚Äî –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
6. **`isExpired(string $key): bool`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```php
/**
 * –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–µ—à–∞
 * 
 * @param string $key –ö–ª—é—á –∫–µ—à–∞
 * @return string –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
 */
private static function getCachePath(string $key): string
{
    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è)
    $safeKey = preg_replace('/[^a-zA-Z0-9_-]/', '_', $key);
    
    return self::CACHE_BASE_DIR . '/' . $safeKey . '.json';
}

/**
 * –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∫–µ—à–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
 * 
 * @return bool true –µ—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∞
 */
private static function ensureCacheDirectory(): bool
{
    $cacheDir = self::CACHE_BASE_DIR;
    
    if (is_dir($cacheDir)) {
        return is_writable($cacheDir);
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
    if (!@mkdir($cacheDir, 0755, true)) {
        error_log("[TimeTrackingCache] Failed to create cache directory: {$cacheDir}");
        return false;
    }
    
    return true;
}

/**
 * –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ –∫–µ—à–∞
 * 
 * @param string $key –ö–ª—é—á –∫–µ—à–∞
 * @return bool true –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
 */
public static function delete(string $key): bool
{
    $cachePath = self::getCachePath($key);
    
    if (file_exists($cachePath)) {
        return @unlink($cachePath);
    }
    
    return true; // –§–∞–π–ª —É–∂–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
}

/**
 * –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à
 * 
 * @return bool true –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
 */
public static function clear(): bool
{
    $cacheDir = self::CACHE_BASE_DIR;
    
    if (!is_dir($cacheDir)) {
        return true; // –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    }
    
    $files = glob($cacheDir . '/*.json');
    $success = true;
    
    foreach ($files as $file) {
        if (!@unlink($file)) {
            error_log("[TimeTrackingCache] Failed to delete cache file: {$file}");
            $success = false;
        }
    }
    
    return $success;
}

/**
 * –û—á–∏—Å—Ç–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏
 * 
 * @return int –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
 */
public static function clearExpired(): int
{
    $cacheDir = self::CACHE_BASE_DIR;
    
    if (!is_dir($cacheDir)) {
        return 0;
    }
    
    $files = glob($cacheDir . '/*.json');
    $deleted = 0;
    $now = time();
    
    foreach ($files as $file) {
        $content = @file_get_contents($file);
        if ($content === false) {
            continue;
        }
        
        $data = @json_decode($content, true);
        if ($data === null || !is_array($data)) {
            continue;
        }
        
        $expiresAt = $data['metadata']['expires_at'] ?? 0;
        if ($now > $expiresAt) {
            if (@unlink($file)) {
                $deleted++;
            }
        }
    }
    
    return $deleted;
}

/**
 * –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –∫–µ—à–∞
 * 
 * @param string $key –ö–ª—é—á –∫–µ—à–∞
 * @return bool true –µ—Å–ª–∏ –∫–µ—à –∏—Å—Ç—ë–∫ –∏–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
 */
public static function isExpired(string $key): bool
{
    $cachePath = self::getCachePath($key);
    
    if (!file_exists($cachePath)) {
        return true;
    }
    
    $content = @file_get_contents($cachePath);
    if ($content === false) {
        return true;
    }
    
    $data = @json_decode($content, true);
    if ($data === null || !is_array($data)) {
        return true;
    }
    
    $expiresAt = $data['metadata']['expires_at'] ?? 0;
    return time() > $expiresAt;
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –í—Å–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∞

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.6: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ generateKey()

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `generateKey()` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–∞ –∫–µ—à–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞.

**–®–∞–≥–∏:**

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `generateKey()`**
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è MD5 —Ö–µ—à–∞ –æ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ –∫–ª—é—á:**
- `product` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: '1C')
- `weekStartUtc` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `weekEndUtc` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `includeTaskDetails` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: false)
- `taskIds` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–∞—Å—Å–∏–≤ ID –∑–∞–¥–∞—á) ‚Äî **–≤–∞–∂–Ω–æ:** —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- `page` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1)
- `perPage` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10)

**–í–∞–∂–Ω–æ:** `forceRefresh` –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–ª—é—á –∫–µ—à–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–µ—à–∞).

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```php
/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∫–µ—à–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
 * 
 * @param array $params –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
 * @return string –ö–ª—é—á –∫–µ—à–∞
 */
public static function generateKey(array $params): string
{
    // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–∞
    $normalized = [
        'product' => $params['product'] ?? '1C',
        'weekStartUtc' => $params['weekStartUtc'] ?? null,
        'weekEndUtc' => $params['weekEndUtc'] ?? null,
        'includeTaskDetails' => $params['includeTaskDetails'] ?? false,
        'taskIds' => isset($params['taskIds']) && is_array($params['taskIds']) 
            ? (function($ids) {
                sort($ids); // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
                return $ids;
            })($params['taskIds'])
            : null,
        'page' => $params['page'] ?? 1,
        'perPage' => $params['perPage'] ?? 10
    ];
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è MD5 —Ö–µ—à–∞ –æ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    // –í–∞–∂–Ω–æ: json_encode —Å JSON_UNESCAPED_UNICODE –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
    $keyString = json_encode($normalized, JSON_UNESCAPED_UNICODE);
    $hash = md5($keyString);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
    return 'time_tracking_' . $hash;
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ú–µ—Ç–æ–¥ `generateKey()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- [ ] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ `taskIds` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–µ—à–∞:

```php
[
    'data' => [
        'success' => true,
        'meta' => [...],
        'data' => [...]
    ],
    'metadata' => [
        'created_at' => 1234567890,  // Unix timestamp
        'expires_at' => 1234567890,  // Unix timestamp
        'ttl' => 300                 // TTL –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    ]
]
```

### TTL:
- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥)
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π:** —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä –º–µ—Ç–æ–¥–∞ `set()`

### –§–æ—Ä–º–∞—Ç –∫–ª—é—á–∞ –∫–µ—à–∞:
- **–ü—Ä–µ—Ñ–∏–∫—Å:** `time_tracking_`
- **–•–µ—à:** MD5 –æ—Ç JSON-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **–ü—Ä–∏–º–µ—Ä:** `time_tracking_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6`

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

### –û–±—â–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏:
- [ ] –ö–ª–∞—Å—Å `TimeTrackingCache` —Å–æ–∑–¥–∞–Ω
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∫–µ—à–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–µ—à–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—É
- [ ] –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∫–µ—à–∞ —Å–æ–∑–¥–∞–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ (755)
- [ ] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º PSR-12
- [ ] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ TASK-071-01

### –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–ª–∞—Å—Å–∞:**
```php
// –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
private const CACHE_BASE_DIR = __DIR__ . '/time-tracking-sector-1c';
private const DEFAULT_TTL = 300;
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–æ–≤:**
- `get(string $key): ?array` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `set(string $key, array $data, int $ttl = 300): bool` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `delete(string $key): bool` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- `clear(): bool` ‚Äî –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫–µ—à–∞
- `clearExpired(): int` ‚Äî –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
- `generateKey(array $params): string` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞
- `isExpired(string $key): bool` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- `getCachePath(string $key): string` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏ (private)
- `ensureCacheDirectory(): bool` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (private)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. **–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   ```php
   $key = 'time_tracking_test_key';
   $data = ['test' => 'data'];
   TimeTrackingCache::set($key, $data, 60);
   $cached = TimeTrackingCache::get($key);
   assert($cached === $data, 'Cache get/set failed');
   ```

2. **–¢–µ—Å—Ç –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è:**
   ```php
   $key = 'time_tracking_expired_key';
   $data = ['test' => 'data'];
   TimeTrackingCache::set($key, $data, 1); // TTL 1 —Å–µ–∫—É–Ω–¥–∞
   sleep(2);
   $cached = TimeTrackingCache::get($key);
   assert($cached === null, 'Expired cache should return null');
   ```

3. **–¢–µ—Å—Ç –æ—á–∏—Å—Ç–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π:**
   ```php
   $deleted = TimeTrackingCache::clearExpired();
   assert($deleted >= 0, 'clearExpired should return count');
   ```

4. **–¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–∞:**
   ```php
   $key1 = TimeTrackingCache::generateKey(['product' => '1C', 'page' => 1]);
   $key2 = TimeTrackingCache::generateKey(['product' => '1C', 'page' => 1]);
   assert($key1 === $key2, 'Same params should generate same key');
   
   $key3 = TimeTrackingCache::generateKey(['product' => '1C', 'page' => 2]);
   assert($key1 !== $key3, 'Different params should generate different keys');
   ```

5. **–¢–µ—Å—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ taskIds:**
   ```php
   $key1 = TimeTrackingCache::generateKey(['taskIds' => [3, 1, 2]]);
   $key2 = TimeTrackingCache::generateKey(['taskIds' => [1, 2, 3]]);
   assert($key1 === $key2, 'taskIds should be sorted for consistency');
   ```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–ª–∞—Å—Å–∞ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞):

```php
<?php
/**
 * –§–∞–π–ª–æ–≤—ã–π –∫–µ—à –¥–ª—è API endpoint tickets-time-tracking-sector-1c.php
 * 
 * TASK-071-01: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞ TimeTrackingCache
 * 
 * –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: api/cache/TimeTrackingCache.php
 * 
 * –£–ø—Ä–∞–≤–ª—è–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏
 * –ü—Ä–∏–Ω—Ü–∏–ø —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω GraphAdmissionClosureCache
 */
class TimeTrackingCache
{
    private const CACHE_BASE_DIR = __DIR__ . '/time-tracking-sector-1c';
    private const DEFAULT_TTL = 300;
    
    public static function get(string $key): ?array { /* ... */ }
    public static function set(string $key, array $data, int $ttl = self::DEFAULT_TTL): bool { /* ... */ }
    public static function delete(string $key): bool { /* ... */ }
    public static function clear(): bool { /* ... */ }
    public static function clearExpired(): int { /* ... */ }
    public static function generateKey(array $params): string { /* ... */ }
    public static function isExpired(string $key): bool { /* ... */ }
    private static function getCachePath(string $key): string { /* ... */ }
    private static function ensureCacheDirectory(): bool { /* ... */ }
}
```

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ taskIds –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–∞—Å—Å–∏–≤ `taskIds` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω –≤ —Ä–∞–∑–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, —á—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ —Ä–∞–∑–Ω—ã–º –∫–ª—é—á–∞–º –∫–µ—à–∞ –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Å—Å–∏–≤ `taskIds` –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–ª—é—á–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sort()` –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é

**–ü—Ä–∏–º–µ—Ä:**
```php
'taskIds' => isset($params['taskIds']) && is_array($params['taskIds']) 
    ? (function($ids) {
        sort($ids);
        return $ids;
    })($params['taskIds'])
    : null
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `time-tracking-sector-1c/` –º–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
- –ú–µ—Ç–æ–¥ `ensureCacheDirectory()` –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ race condition.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—É—é –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª (`.tmp`)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `LOCK_EX` –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–∞
- –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `rename()`

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [TASK-071: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–æ–¥—É–ª—è "–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"](./TASK-071-cache-time-tracking-sector-1c.md)
- [TASK-059-05: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–≥–æ –∫–µ—à–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ 3 –º–µ—Å—è—Ü–∞](./TASK-059-05-file-cache-implementation.md) (—Ä–µ—Ñ–µ—Ä–µ–Ω—Å)
- [TASK-068-01: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ GraphAdmissionClosureCache –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–∂–∏–º–∞ "weeks"](./TASK-068-01-extend-cache-for-weeks.md) (—Ä–µ—Ñ–µ—Ä–µ–Ω—Å)

---

## üìä –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∞–≤–æ–∫

- **2025-12-23 18:03 (UTC+3, –ë—Ä–µ—Å—Ç):** –°–æ–∑–¥–∞–Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∞ TASK-071-01 –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞—Å—Å–∞ TimeTrackingCache

---

**–ê–≤—Ç–æ—Ä:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0

