# TASK-028-05: Этап 5 — Тестирование, регрессия и приёмка фильтров графика состояния сектора 1С

**Дата создания:** 2025-12-11 13:25 (UTC+3, Брест)  
**Статус:** Новая  
**Приоритет:** Высокий  
**Исполнитель:** Bitrix24 Программист (Vue.js)  
**Родительская задача:** TASK-028

## Цель этапа

Провести комплексное тестирование реализованных компонентов фильтров, выполнить регрессионную проверку существующего функционала, оптимизировать производительность, обновить документацию и подготовить решение к приёмке.

## Контекст

- Этап 28-01: проанализирован текущий UI  
- Этап 28-02: спроектирован UX/UI  
- Этап 28-03: определено техническое решение  
- Этап 28-04: реализованы компоненты (`StageChips`, `EmployeeSelect`, API-слой)  
- На этом этапе выполняется финальное тестирование, регрессия, оптимизация и документация.

---

## Область работ этапа

1) Функциональное тестирование всех компонентов фильтров (StageChips, EmployeeSelect, интеграция).  
2) Регрессионное тестирование существующего функционала графика состояния.  
3) Тестирование производительности (дебаунс, кэширование, оптимизация запросов).  
4) Тестирование доступности (ARIA, навигация с клавиатуры, screen readers).  
5) Кросс-браузерное и адаптивное тестирование (десктоп, планшет, мобильный).  
6) Обновление документации (README, комментарии в коде, API-документация).  
7) Финальная проверка соответствия требованиям задачи TASK-028.

---

## Детальный план тестирования

### Шаг 1. Функциональное тестирование компонентов

#### 1.1. Тестирование StageChips.vue

**Чек-лист:**

- [ ] **Отображение стадий:**
  - [ ] Все стадии отображаются с корректными названиями
  - [ ] Контейнер имеет фон (`#f8f9fa`) и бордер (`#e5e7eb`)
  - [ ] Стадии выровнены по сетке 8px
  - [ ] Отсутствуют «висящие в воздухе» кнопки

- [ ] **Выбор стадий (multiple mode):**
  - [ ] Можно выбрать одну стадию
  - [ ] Можно выбрать несколько стадий
  - [ ] Можно снять выбор со стадии
  - [ ] Можно выбрать все стадии
  - [ ] Можно снять все стадии

- [ ] **Выбор стадий (single mode):**
  - [ ] Можно выбрать только одну стадию
  - [ ] При выборе новой стадии предыдущая снимается
  - [ ] Можно снять выбор (клик по активной стадии)

- [ ] **Состояния визуальные:**
  - [ ] Default: белый фон, серый бордер
  - [ ] Hover: усиление бордера, лёгкая тень
  - [ ] Active: синий фон (`#3b82f6`), белый текст
  - [ ] Disabled: серый фон, пониженная прозрачность

- [ ] **Счётчик тикетов (если передан):**
  - [ ] Отображается число в правом углу чипа
  - [ ] Стили счётчика корректны (белый/тёмный в зависимости от состояния)

- [ ] **События:**
  - [ ] При изменении выбора эмитится `update:modelValue`
  - [ ] При изменении выбора эмитится `change`
  - [ ] При наведении эмитится `hover` с ID стадии

**Тестовые сценарии:**

```javascript
// Тест 1: Выбор одной стадии
1. Открыть график состояния сектора 1С
2. Кликнуть на стадию "Сформировано обращение"
3. Проверить: стадия выделена (синий фон), эмитится событие change

// Тест 2: Выбор нескольких стадий
1. Кликнуть на "Сформировано обращение"
2. Кликнуть на "Рассмотрение ТЗ"
3. Кликнуть на "Исполнение"
4. Проверить: все три стадии выделены, график обновлён

// Тест 3: Снятие выбора
1. Выбрать все стадии
2. Кликнуть на активную стадию "Сформировано обращение"
3. Проверить: стадия снята, график обновлён

// Тест 4: Визуальный контейнер
1. Открыть график состояния
2. Проверить: стадии находятся в контейнере с фоном и бордером
3. Проверить: нет «висящих в воздухе» кнопок
```

#### 1.2. Тестирование EmployeeSelect.vue

**Чек-лист:**

- [ ] **Загрузка сотрудников:**
  - [ ] При фокусе на поле загружаются сотрудники сектора 1С
  - [ ] Показывается лоадер во время загрузки
  - [ ] Список сотрудников отображается после загрузки
  - [ ] Кэширование работает (повторный фокус не делает запрос)

- [ ] **Поиск сотрудников:**
  - [ ] Поиск работает с дебаунсом 300 мс
  - [ ] При вводе 2+ символов выполняется поиск
  - [ ] Результаты фильтруются по имени и должности
  - [ ] Не более 1 запроса на ввод (дебаунс работает)

- [ ] **Выбор сотрудника:**
  - [ ] Можно выбрать сотрудника из списка
  - [ ] Имя сотрудника подставляется в поле
  - [ ] Выпадающий список закрывается после выбора
  - [ ] Эмитится событие `update:modelValue` с ID сотрудника

- [ ] **Очистка выбора:**
  - [ ] Кнопка "×" очищает выбор
  - [ ] Поле очищается, эмитится `null` в `update:modelValue`

- [ ] **Состояния:**
  - [ ] Loading: показывается спиннер
  - [ ] Empty: показывается "Нет сотрудников сектора 1С" или "Не найдено по запросу"
  - [ ] Error: показывается сообщение об ошибке и кнопка "Повторить"
  - [ ] Retry: при клике на "Повторить" повторяется запрос

- [ ] **Отображение данных:**
  - [ ] Показывается имя сотрудника
  - [ ] Показывается должность (если есть)
  - [ ] Список отсортирован по алфавиту

**Тестовые сценарии:**

```javascript
// Тест 1: Загрузка сотрудников
1. Открыть график состояния сектора 1С
2. Кликнуть на поле "Сотрудник"
3. Проверить: показывается лоадер
4. Проверить: через 1-2 сек отображается список сотрудников

// Тест 2: Поиск сотрудников
1. Ввести в поле "Сотрудник" "Иван"
2. Подождать 300 мс
3. Проверить: выполнен 1 запрос к API
4. Проверить: отображаются только сотрудники с именем "Иван"

// Тест 3: Выбор сотрудника
1. Открыть список сотрудников
2. Кликнуть на "Иванов Иван Иванович"
3. Проверить: имя подставлено в поле, список закрыт
4. Проверить: график обновлён с фильтром по сотруднику

// Тест 4: Ошибка загрузки
1. Отключить сеть / симулировать ошибку API
2. Кликнуть на поле "Сотрудник"
3. Проверить: показывается сообщение об ошибке
4. Проверить: есть кнопка "Повторить"
5. Включить сеть, кликнуть "Повторить"
6. Проверить: сотрудники загружаются

// Тест 5: Пустой результат поиска
1. Ввести в поле "Сотрудник" "НесуществующийСотрудник123"
2. Подождать 300 мс
3. Проверить: показывается "Не найдено по запросу"
```

#### 1.3. Тестирование интеграции в GraphStateDashboard.vue

**Чек-лист:**

- [ ] **Интеграция компонентов:**
  - [ ] `StageChips` отображается в панели фильтров
  - [ ] `EmployeeSelect` отображается в панели фильтров
  - [ ] Компоненты работают совместно

- [ ] **Обновление графика:**
  - [ ] При изменении фильтра стадий график обновляется
  - [ ] При изменении фильтра сотрудника график обновляется
  - [ ] При сбросе фильтров график обновляется

- [ ] **Сброс фильтров:**
  - [ ] Кнопка "Сбросить фильтры" очищает все фильтры
  - [ ] Стадии снимаются
  - [ ] Сотрудник очищается
  - [ ] График обновляется

- [ ] **Сохранение состояния (если реализовано):**
  - [ ] Фильтры сохраняются в localStorage/sessionStorage
  - [ ] При перезагрузке страницы фильтры восстанавливаются

**Тестовые сценарии:**

```javascript
// Тест 1: Комплексный фильтр
1. Выбрать стадии "Сформировано обращение" и "Рассмотрение ТЗ"
2. Выбрать сотрудника "Иванов Иван"
3. Проверить: график обновлён с учётом обоих фильтров

// Тест 2: Сброс фильтров
1. Выбрать стадии и сотрудника
2. Кликнуть "Сбросить фильтры"
3. Проверить: все фильтры очищены, график обновлён

// Тест 3: Последовательное изменение фильтров
1. Выбрать стадию "Сформировано обращение"
2. Проверить: график обновлён
3. Добавить стадию "Рассмотрение ТЗ"
4. Проверить: график обновлён
5. Выбрать сотрудника
6. Проверить: график обновлён с учётом всех фильтров
```

---

### Шаг 2. Регрессионное тестирование

#### 2.1. Проверка существующего функционала графика

**Чек-лист:**

- [ ] **График состояния:**
  - [ ] График отображается корректно
  - [ ] Данные загружаются без ошибок
  - [ ] Периоды (начало недели, конец недели, текущее состояние) работают
  - [ ] Экспорт в PDF работает
  - [ ] Создание снимков (snapshots) работает

- [ ] **Фильтр по датам:**
  - [ ] Выбор периода работает (последняя неделя, 2 недели, месяц)
  - [ ] Произвольный период работает
  - [ ] Валидация дат работает (начало не позже конца)

- [ ] **Навигация:**
  - [ ] Breadcrumbs работают
  - [ ] Кнопка "Назад" работает
  - [ ] Переходы между страницами работают

- [ ] **Мобильная версия:**
  - [ ] Мобильное меню фильтров работает
  - [ ] График адаптируется под мобильный экран
  - [ ] Все элементы доступны на мобильном

**Тестовые сценарии:**

```javascript
// Тест 1: График без фильтров
1. Открыть график состояния сектора 1С
2. Не применять фильтры
3. Проверить: график отображается со всеми данными

// Тест 2: График с фильтром по датам
1. Выбрать период "Последняя неделя"
2. Проверить: график обновлён с данными за неделю

// Тест 3: Экспорт в PDF
1. Применить фильтры
2. Кликнуть "Экспорт в PDF"
3. Проверить: PDF сгенерирован с учётом фильтров

// Тест 4: Создание снимка
1. Применить фильтры
2. Кликнуть "Создать снимок"
3. Проверить: снимок создан с текущими фильтрами
```

#### 2.2. Проверка совместимости с другими модулями

**Чек-лист:**

- [ ] **Дашборд сектора 1С:**
  - [ ] Переход с дашборда на график состояния работает
  - [ ] Данные синхронизируются между модулями

- [ ] **Другие компоненты:**
  - [ ] Нет конфликтов с другими Vue-компонентами
  - [ ] Нет дублирования стилей
  - [ ] Нет конфликтов с глобальными стилями

---

### Шаг 3. Тестирование производительности

#### 3.1. Оптимизация запросов

**Чек-лист:**

- [ ] **Дебаунс поиска:**
  - [ ] При быстром вводе выполняется только последний запрос
  - [ ] Задержка дебаунса 300 мс
  - [ ] Отменяются устаревшие запросы

- [ ] **Кэширование:**
  - [ ] Результаты поиска кэшируются
  - [ ] Повторный поиск по тому же запросу не делает запрос
  - [ ] Кэш очищается через 5 минут (или при изменении сектора)

- [ ] **Оптимизация рендеринга:**
  - [ ] Компоненты не перерисовываются без необходимости
  - [ ] Используется `v-memo` или `computed` где возможно
  - [ ] Нет лишних вычислений при изменении фильтров

**Метрики производительности:**

```javascript
// Тест 1: Дебаунс поиска
1. Открыть DevTools → Network
2. Быстро ввести "Иван" (5 символов за 200 мс)
3. Проверить: выполнен только 1 запрос (последний)

// Тест 2: Кэширование
1. Ввести "Иван", дождаться результатов
2. Очистить поле
3. Снова ввести "Иван"
4. Проверить: запрос не выполнен, данные из кэша

// Тест 3: Производительность рендеринга
1. Открыть DevTools → Performance
2. Записать профиль при изменении фильтров
3. Проверить: время рендеринга < 16 мс (60 FPS)
```

#### 3.2. Оптимизация памяти

**Чек-лист:**

- [ ] **Очистка ресурсов:**
  - [ ] Таймеры дебаунса очищаются при размонтировании
  - [ ] Слушатели событий удаляются
  - [ ] Кэш не растёт бесконечно (TTL или лимит размера)

- [ ] **Утечки памяти:**
  - [ ] Нет утечек при многократном открытии/закрытии компонентов
  - [ ] Нет накопления событий в памяти

**Тестовый сценарий:**

```javascript
// Тест: Утечки памяти
1. Открыть DevTools → Memory
2. Сделать heap snapshot
3. Многократно открыть/закрыть фильтры (10 раз)
4. Сделать heap snapshot
5. Проверить: размер heap не увеличился значительно
```

---

### Шаг 4. Тестирование доступности

#### 4.1. ARIA-атрибуты

**Чек-лист:**

- [ ] **StageChips:**
  - [ ] `role="group"` на контейнере
  - [ ] `aria-label` на контейнере
  - [ ] `aria-pressed` на кнопках стадий
  - [ ] `aria-label` на кнопках (название + счётчик)

- [ ] **EmployeeSelect:**
  - [ ] `aria-expanded` на инпуте
  - [ ] `aria-haspopup="true"` на инпуте
  - [ ] `aria-controls` указывает на выпадающий список
  - [ ] `role="listbox"` на выпадающем списке
  - [ ] `role="option"` на опциях
  - [ ] `aria-selected` на выбранной опции

#### 4.2. Навигация с клавиатуры

**Чек-лист:**

- [ ] **StageChips:**
  - [ ] Tab переключает фокус между стадиями
  - [ ] Enter/Space активирует стадию
  - [ ] Стрелки влево/вправо переключают стадии (опционально)

- [ ] **EmployeeSelect:**
  - [ ] Tab переключает фокус на поле
  - [ ] Enter открывает список (если закрыт)
  - [ ] Escape закрывает список
  - [ ] Стрелки вверх/вниз навигируют по списку
  - [ ] Enter выбирает опцию

**Тестовые сценарии:**

```javascript
// Тест 1: Навигация с клавиатуры (StageChips)
1. Нажать Tab до первой стадии
2. Нажать Enter
3. Проверить: стадия выбрана
4. Нажать Tab до следующей стадии
5. Нажать Space
6. Проверить: обе стадии выбраны

// Тест 2: Навигация с клавиатуры (EmployeeSelect)
1. Нажать Tab до поля "Сотрудник"
2. Начать вводить "Иван"
3. Нажать стрелку вниз
4. Проверить: фокус на первой опции
5. Нажать Enter
6. Проверить: сотрудник выбран
```

#### 4.3. Screen readers

**Чек-лист:**

- [ ] **NVDA/JAWS (Windows):**
  - [ ] Названия стадий читаются корректно
  - [ ] Состояние выбора читается ("выбрано" / "не выбрано")
  - [ ] Названия сотрудников читаются корректно
  - [ ] Состояния (loading/error/empty) читаются

- [ ] **VoiceOver (macOS/iOS):**
  - [ ] Все элементы доступны
  - [ ] Навигация работает
  - [ ] Состояния объявляются

**Тестовый сценарий:**

```javascript
// Тест: Screen reader
1. Включить NVDA/JAWS/VoiceOver
2. Навигация по фильтрам с помощью Tab
3. Проверить: все элементы объявляются корректно
4. Взаимодействие с фильтрами
5. Проверить: изменения объявляются
```

---

### Шаг 5. Кросс-браузерное и адаптивное тестирование

#### 5.1. Браузеры

**Чек-лист:**

- [ ] **Chrome/Edge (последние версии):**
  - [ ] Все функции работают
  - [ ] Стили отображаются корректно

- [ ] **Firefox (последняя версия):**
  - [ ] Все функции работают
  - [ ] Стили отображаются корректно

- [ ] **Safari (последняя версия):**
  - [ ] Все функции работают
  - [ ] Стили отображаются корректно

- [ ] **Mobile Safari (iOS):**
  - [ ] Все функции работают
  - [ ] Адаптивность работает

- [ ] **Chrome Mobile (Android):**
  - [ ] Все функции работают
  - [ ] Адаптивность работает

#### 5.2. Разрешения экрана

**Чек-лист:**

- [ ] **Десктоп (1920x1080, 1366x768):**
  - [ ] Все элементы видны
  - [ ] Фильтры не перекрываются
  - [ ] График отображается полностью

- [ ] **Планшет (768x1024, 1024x768):**
  - [ ] Фильтры адаптируются
  - [ ] График масштабируется
  - [ ] Все элементы доступны

- [ ] **Мобильный (375x667, 414x896):**
  - [ ] Мобильное меню фильтров работает
  - [ ] График адаптируется
  - [ ] Все элементы доступны
  - [ ] Нет горизонтальной прокрутки

**Тестовые сценарии:**

```javascript
// Тест 1: Десктоп
1. Открыть на разрешении 1920x1080
2. Проверить: все элементы видны, фильтры выровнены

// Тест 2: Планшет
1. Открыть на разрешении 768x1024
2. Проверить: фильтры адаптированы, график масштабирован

// Тест 3: Мобильный
1. Открыть на разрешении 375x667
2. Проверить: мобильное меню работает
3. Проверить: график адаптирован
```

---

### Шаг 6. Обновление документации

#### 6.1. Комментарии в коде

**Чек-лист:**

- [ ] **JSDoc комментарии:**
  - [ ] Все функции/методы документированы
  - [ ] Указаны типы параметров и возвращаемых значений
  - [ ] Указаны ссылки на документацию Bitrix24 API

- [ ] **Inline комментарии:**
  - [ ] Сложная логика прокомментирована
  - [ ] Указаны причины выбора решений

**Пример:**

```javascript
/**
 * Загрузка сотрудников сектора 1С
 * 
 * Используется метод Bitrix24 REST API: user.get
 * Документация: https://context7.com/bitrix24/rest/user.get
 * 
 * @param {Object} params - Параметры запроса
 * @param {string} params.search - Поисковый запрос (имя/должность)
 * @param {number} params.limit - Лимит результатов (по умолчанию 20)
 * @param {string|number} params.sectorId - ID сектора 1С
 * @returns {Promise<Array>} Массив сотрудников [{ id, name, position, department }]
 * @throws {Error} При ошибке загрузки
 */
export async function fetchEmployees({ search = '', limit = DEFAULT_LIMIT, sectorId = null }) {
  // ...
}
```

#### 6.2. README и документация проекта

**Чек-лист:**

- [ ] **README.md:**
  - [ ] Описаны новые компоненты фильтров
  - [ ] Указаны API-методы и их параметры
  - [ ] Добавлены примеры использования

- [ ] **DOCS/GUIDES/ui-standards.md:**
  - [ ] Обновлены стандарты UI для фильтров
  - [ ] Добавлены примеры компонентов

- [ ] **DOCS/API-REFERENCES/bitrix24-ui-kit.md:**
  - [ ] Описаны используемые компоненты Bitrix24 UI
  - [ ] Добавлены ссылки на документацию

**Пример обновления README:**

```markdown
## Компоненты фильтров графика состояния

### StageChips
Компонент для выбора стадий с поддержкой multiple/single select.

**Использование:**
```vue
<StageChips
  v-model="selectedStages"
  :options="stageOptions"
  :multiple="true"
  @change="handleStagesChange"
/>
```

### EmployeeSelect
Компонент для выбора сотрудника сектора 1С с поиском и дебаунсом.

**Использование:**
```vue
<EmployeeSelect
  v-model="selectedEmployee"
  :sector-id="sector1cId"
  @change="handleEmployeeChange"
/>
```

**API:**
- Метод: `fetchEmployees({ search, limit, sectorId })`
- Источник: Bitrix24 REST API `user.get`
- Документация: https://context7.com/bitrix24/rest/user.get
```

---

### Шаг 7. Финальная проверка соответствия требованиям

#### 7.1. Проверка критериев приёмки TASK-028

**Чек-лист из TASK-028:**

- [ ] Кнопки стадий помещены в визуальный контейнер (фон/бордер), выровнены, имеют состояния hover/active
- [ ] Фильтры сгруппированы, поля подписаны, плейсхолдеры понятны, отступы выровнены по сетке 8px
- [ ] В поле «Сотрудник» отображается реальный список сотрудников сектора 1С; поиск работает, есть empty/error состояния
- [ ] Нет ошибок/ворнингов в консоли при загрузке и взаимодействии с фильтрами
- [ ] Добавлены комментарии в коде/README о выбранном источнике данных и параметрах API

#### 7.2. Проверка соответствия UX/UI требованиям

**Чек-лист из этапа 28-02:**

- [ ] Контейнер стадий имеет фон и бордер
- [ ] Стадии выровнены по сетке 8px
- [ ] Поле сотрудника имеет поиск с дебаунсом
- [ ] Все состояния (loading/error/empty) обработаны
- [ ] Стили соответствуют Bitrix24 UI

---

## Артефакты этапа

- Отчёт о тестировании (функциональное, регрессионное, производительность, доступность)
- Список найденных багов (если есть) с приоритетами
- Обновлённая документация (README, комментарии в коде, API-документация)
- Оптимизации производительности (если были внесены)
- Финальный чек-лист приёмки

---

## Критерии приёмки этапа

- [ ] Все функциональные тесты пройдены (StageChips, EmployeeSelect, интеграция)
- [ ] Регрессионные тесты пройдены (график состояния, фильтры по датам, навигация)
- [ ] Тесты производительности пройдены (дебаунс, кэширование, оптимизация)
- [ ] Тесты доступности пройдены (ARIA, навигация с клавиатуры, screen readers)
- [ ] Кросс-браузерное тестирование пройдено (Chrome, Firefox, Safari, мобильные)
- [ ] Адаптивное тестирование пройдено (десктоп, планшет, мобильный)
- [ ] Документация обновлена (README, комментарии в коде, API-документация)
- [ ] Все критерии приёмки TASK-028 выполнены
- [ ] Нет критических багов
- [ ] Код готов к деплою

---

## Риски и митигация

### Риск 1: Производительность при большом количестве сотрудников
**Митигация:** Ограничение лимита результатов (20), пагинация, виртуализация списка (если нужно)

### Риск 2: Конфликты стилей с другими компонентами
**Митигация:** Использование scoped styles, проверка на конфликты при регрессионном тестировании

### Риск 3: Проблемы доступности на мобильных устройствах
**Митигация:** Тестирование на реальных устройствах, использование touch-событий

---

## Вопросы для уточнения

1. **Приоритет багов:** Как обрабатывать найденные баги (исправлять сразу или в отдельной задаче)?  
2. **Деплой:** Нужна ли отдельная задача на деплой или это часть этапа 5?  
3. **Метрики производительности:** Какие конкретные метрики считать приемлемыми (время загрузки, FPS)?  
4. **Документация для пользователей:** Нужна ли отдельная документация для конечных пользователей (инструкция по использованию фильтров)?

---

## История правок

- 2025-12-11 13:25 (UTC+3, Брест): Создан документ этапа 5 — тестирование, регрессия и приёмка

