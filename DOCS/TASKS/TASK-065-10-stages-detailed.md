# TASK-065: –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (10 —ç—Ç–∞–ø–æ–≤)

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-23 (UTC+3, –ë—Ä–µ—Å—Ç)  
**–°–≤—è–∑–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞:** TASK-065  
**–°—Ç–∞—Ç—É—Å:** –ù–µ–¥–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –∑–∞–≤–µ—Ä—à—ë–Ω, –º–µ—Å—è—á–Ω—ã–π —Ä–µ–∂–∏–º –≤ legacy

---

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ 10 —ç—Ç–∞–ø–æ–≤ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ endpoint `api/graph-1c-admission-closure.php` –≤ –º–æ–¥—É–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –≤–∫–ª—é—á–∞–µ—Ç —Ü–µ–ª–∏, –∑–∞–¥–∞—á–∏, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

---

## –≠—Ç–∞–ø 65-1: –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –∏ —Ñ–∏–∫—Å–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

### –¶–µ–ª—å
–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç API (–≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞) –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.

### –ó–∞–¥–∞—á–∏
- [x] –í—ã–ø–∏—Å–∞—Ç—å –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON body):
  - `product` (string, default: "1C")
  - `weekStartUtc`, `weekEndUtc` (ISO strings, optional)
  - `periodMode` ("weeks" | "months", default: "weeks")
  - `includeTickets` (bool, default: false)
  - `includeNewTicketsByStages` (bool, default: false)
  - `includeCarryoverTickets` (bool, default: false)
  - `includeCarryoverTicketsByDuration` (bool, default: false)
  - `forceRefresh` (bool, default: false)
  - `debug` (bool, default: false)
- [x] –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞:
  - `success` (bool)
  - `meta` (weekNumber, weekStartUtc, weekEndUtc, weeks/months)
  - `data` (newTickets, closedTickets, series, weeksData, stages, responsible, etc.)
  - `debug` (optional, –ø—Ä–∏ debug=true)
- [x] –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
  - `CRest` (Bitrix24 API client)
  - `GraphAdmissionClosureCache` (file-based cache)
  - –•–∞—Ä–¥–∫–æ–¥—ã: —Å—Ç–∞–¥–∏–∏, keeperId (1051), pageSize (50), durationCategories
- [x] –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–∞—Ç –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- ‚úÖ `DOCS/ANALYSIS/graph-admission-closure-spec.md` ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
- [x] –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] –í—Å–µ –≤—ã—Ö–æ–¥–Ω—ã–µ –ø–æ–ª—è –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã

---

## –≠—Ç–∞–ø 65-2: –ü—Ä–æ–µ–∫—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–¥—É–ª—è

### –¶–µ–ª—å
–°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–ª–æ–∏.

### –ó–∞–¥–∞—á–∏
- [x] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤:
  ```
  api/graph-admission-closure/
  ‚îú‚îÄ‚îÄ bootstrap.php          # –í—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞
  ‚îú‚îÄ‚îÄ controller/            # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
  ‚îÇ   ‚îî‚îÄ‚îÄ GraphAdmissionClosureController.php
  ‚îú‚îÄ‚îÄ service/               # –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π
  ‚îÇ   ‚îî‚îÄ‚îÄ GraphAdmissionClosureService.php
  ‚îú‚îÄ‚îÄ bitrix/                # Bitrix24 –∫–ª–∏–µ–Ω—Ç
  ‚îÇ   ‚îî‚îÄ‚îÄ BitrixClient.php
  ‚îú‚îÄ‚îÄ domain/                # –î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
  ‚îÇ   ‚îî‚îÄ‚îÄ Aggregator.php
  ‚îú‚îÄ‚îÄ cache/                 # –ö–µ—à
  ‚îÇ   ‚îî‚îÄ‚îÄ CacheStore.php
  ‚îú‚îÄ‚îÄ config/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  ‚îÇ   ‚îî‚îÄ‚îÄ Config.php
  ‚îî‚îÄ‚îÄ util/                  # –£—Ç–∏–ª–∏—Ç—ã
      ‚îî‚îÄ‚îÄ DatePeriodHelper.php
  ```
- [x] –°–æ–∑–¥–∞—Ç—å —Å–∫–µ–ª–µ—Ç —Ñ–∞–π–ª–æ–≤ (–∑–∞–≥–ª—É—à–∫–∏)
- [x] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (require_once)

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã-–∑–∞–≥–ª—É—à–∫–∏ —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –°—Ö–µ–º–∞ –º–æ–¥—É–ª—è –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ spec.md

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] –í—Å–µ –∫–∞—Ç–∞–ª–æ–≥–∏ —Å–æ–∑–¥–∞–Ω—ã
- [x] –í—Å–µ —Ñ–∞–π–ª—ã-–∑–∞–≥–ª—É—à–∫–∏ —Å–æ–∑–¥–∞–Ω—ã
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞

---

## –≠—Ç–∞–ø 65-3: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

### –¶–µ–ª—å
–í—ã–Ω–µ—Å—Ç–∏ –≤—Å–µ —Ö–∞—Ä–¥–∫–æ–¥—ã –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

### –ó–∞–¥–∞—á–∏
- [x] –°–æ–∑–¥–∞—Ç—å `config/Config.php`:
  - –°—Ç–∞–¥–∏–∏ (targetStages, closingStages)
  - –¶–≤–µ—Ç–∞ —Å—Ç–∞–¥–∏–π
  - keeperId (1051)
  - pageSize (50)
  - entityTypeId (140)
  - durationCategories (—Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∏ —Ü–≤–µ—Ç–∞–º–∏)
  - product-—Ñ–∏–ª—å—Ç—Ä –ª–æ–≥–∏–∫–∞
- [x] –ó–∞–º–µ–Ω–∏—Ç—å —Ö–∞—Ä–¥–∫–æ–¥—ã –≤ –∫–æ–¥–µ –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –∫–æ–Ω—Ñ–∏–≥—É
- [x] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- ‚úÖ `api/graph-admission-closure/config/Config.php`

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] Config.php —Å–æ–∑–¥–∞–Ω
- [x] –í—Å–µ —Ö–∞—Ä–¥–∫–æ–¥—ã –≤—ã–Ω–µ—Å–µ–Ω—ã
- [x] –ó–Ω–∞—á–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—á–Ω—ã –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º
- [x] –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥ –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–æ–≤

---

## –≠—Ç–∞–ø 65-4: –£—Ç–∏–ª–∏—Ç—ã –¥–∞—Ç –∏ –ø–µ—Ä–∏–æ–¥–æ–≤

### –¶–µ–ª—å
–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏ –∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–ª–∞—Å—Å–µ.

### –ó–∞–¥–∞—á–∏
- [x] –°–æ–∑–¥–∞—Ç—å `util/DatePeriodHelper.php`:
  - `getWeekBounds(?string $start, ?string $end): array` ‚Äî –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏
  - `getFourWeeksBounds(DateTimeImmutable $currentWeekStart, DateTimeImmutable $currentWeekEnd): array` ‚Äî 4 –Ω–µ–¥–µ–ª–∏
  - `calculateLastFourMonths(): array` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 –º–µ—Å—è—Ü–∞
  - `calculateWeeksInMonth(DateTimeImmutable $monthStart, DateTimeImmutable $monthEnd): array` ‚Äî –Ω–µ–¥–µ–ª–∏ –≤ –º–µ—Å—è—Ü–µ
  - `isInRange(?string $dateStr, DateTimeImmutable $start, DateTimeImmutable $end): bool` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
  - `calculateDurationCategory(string $createdTime, DateTimeImmutable $weekStart): string` ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å—Ä–æ–∫–∞
- [x] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ legacy —Ñ–∞–π–ª–∞
- [x] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- ‚úÖ `api/graph-admission-closure/util/DatePeriodHelper.php`

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] DatePeriodHelper.php —Å–æ–∑–¥–∞–Ω
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–∞—Ç –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- [x] –õ–æ–≥–∏–∫–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π
- [x] –§—É–Ω–∫—Ü–∏–∏ –ø–æ–∫—Ä—ã–≤–∞—é—Ç weeks –∏ months —Ä–µ–∂–∏–º—ã

---

## –≠—Ç–∞–ø 65-5: –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ Bitrix24

### –¶–µ–ª—å
–ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Bitrix24 API –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–ª–∞—Å—Å–µ.

### –ó–∞–¥–∞—á–∏
- [x] –°–æ–∑–¥–∞—Ç—å `bitrix/BitrixClient.php`:
  - `fetchCreatedTickets(DateTimeImmutable $start, DateTimeImmutable $end, string $product): array` ‚Äî —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã
  - `fetchClosedTickets(DateTimeImmutable $start, DateTimeImmutable $end, array $closingStages, string $product): array` ‚Äî –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã
  - `fetchCarryoverTickets(array $targetStages, DateTimeImmutable $endDate, string $product): array` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã
  - `executeParallelQueries(array $query1Params, array $query2Params): array` ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é)
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (expired_token, fallback)
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- ‚úÖ `api/graph-admission-closure/bitrix/BitrixClient.php`

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] BitrixClient.php —Å–æ–∑–¥–∞–Ω
- [x] –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [x] –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

---

## –≠—Ç–∞–ø 65-6: –î–æ–º–µ–Ω–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è

### –¶–µ–ª—å
–í—ã–Ω–µ—Å—Ç–∏ —á–∏—Å—Ç—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å.

### –ó–∞–¥–∞—á–∏
- [x] –°–æ–∑–¥–∞—Ç—å `domain/Aggregator.php`:
  - `calculateWeekMetrics(...): array` ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –Ω–µ–¥–µ–ª–∏
  - `aggregateWeeks(array $weeks, array $tickets, ...): array` ‚Äî –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º
  - `isCarryoverTicket(...): bool` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥—è—â–µ–≥–æ —Ç–∏–∫–µ—Ç–∞
  - `calculateDurationCategory(...): string` ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å—Ä–æ–∫–∞
- [x] –£–±—Ä–∞—Ç—å –≤—Å–µ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–∫—Ä–æ–º–µ —É—Å–ª–æ–≤–Ω—ã—Ö debug-–ª–æ–≥–æ–≤)
- [x] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞–∑–±–∏–≤–∫–∏ carryover (this/prev/older)
- [x] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞–¥–∏—è–º –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- ‚úÖ `api/graph-admission-closure/domain/Aggregator.php`

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] Aggregator.php —Å–æ–∑–¥–∞–Ω
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- [x] –õ–æ–≥–∏–∫–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π
- [x] –§—É–Ω–∫—Ü–∏–∏ —á–∏—Å—Ç—ã–µ (–±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤)

---

## –≠—Ç–∞–ø 65-7: –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π (orchestration)

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

### –ó–∞–¥–∞—á–∏
- [x] –°–æ–∑–¥–∞—Ç—å `service/GraphAdmissionClosureService.php`:
  - `handle(array $payload): array` ‚Äî –≥–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  - –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ (weeks/months)
  - –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ BitrixClient
  - –ê–≥—Ä–µ–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Aggregator
  - –†–∞–±–æ—Ç–∞ —Å –∫–µ—à–µ–º (CacheStore)
  - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (DI)
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- ‚úÖ `api/graph-admission-closure/service/GraphAdmissionClosureService.php`

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] Service —Å–æ–∑–¥–∞–Ω
- [x] –ú–µ—Ç–æ–¥ handle —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
- [x] –ù–µ–¥–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ú–µ—Å—è—á–Ω—ã–π —Ä–µ–∂–∏–º –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω (TODO)

---

## –≠—Ç–∞–ø 65-8: –ö–µ—à –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¶–µ–ª—å
–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π, —Å–æ—Ö—Ä–∞–Ω–∏–≤ —Ñ–æ—Ä–º–∞—Ç.

### –ó–∞–¥–∞—á–∏
- [x] –°–æ–∑–¥–∞—Ç—å `cache/CacheStore.php`:
  - `get(string $key): ?array` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –∫–µ—à–∞
  - `set(string $key, array $data, int $ttl): bool` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à
  - `delete(string $key): bool` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ
  - `clear(): bool` ‚Äî –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫–µ—à–∞
  - `clearExpired(): int` ‚Äî –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö
  - `generateKey(array $params): string` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞
  - `isExpired(string $key): bool` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- [x] –û–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ legacy `GraphAdmissionClosureCache`
- [x] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–µ–π –∏ TTL
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ setupAppLogging (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∏–∑ legacy)

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- ‚úÖ `api/graph-admission-closure/cache/CacheStore.php`

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] CacheStore.php —Å–æ–∑–¥–∞–Ω
- [x] –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [x] –§–æ—Ä–º–∞—Ç –∫–ª—é—á–µ–π –∏–¥–µ–Ω—Ç–∏—á–µ–Ω
- [x] TTL —Å–æ—Ö—Ä–∞–Ω—ë–Ω
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –≠—Ç–∞–ø 65-9: –í—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞/–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å —Ç–æ–Ω–∫–∏–π —Å–ª–æ–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∏ –≤—Ö–æ–¥–Ω—É—é —Ç–æ—á–∫—É –º–æ–¥—É–ª—è.

### –ó–∞–¥–∞—á–∏
- [x] –°–æ–∑–¥–∞—Ç—å `controller/GraphAdmissionClosureController.php`:
  - `handle(array $payload): array` ‚Äî –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Service
- [x] –°–æ–∑–¥–∞—Ç—å `bootstrap.php`:
  - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  - –ü–∞—Ä—Å–∏–Ω–≥ JSON body
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
  - –í—ã–∑–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
  - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ JSON –æ—Ç–≤–µ—Ç–∞
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (500)
- [x] –û–±–Ω–æ–≤–∏—Ç—å legacy —Ñ–∞–π–ª:
  - –ü—Ä–æ–∫—Å–∏ –¥–ª—è weeks —Ä–µ–∂–∏–º–∞ ‚Üí –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
  - Months —Ä–µ–∂–∏–º –æ—Å—Ç–∞—ë—Ç—Å—è –≤ legacy (–¥–æ –ø–µ—Ä–µ–Ω–æ—Å–∞)

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- ‚úÖ `api/graph-admission-closure/controller/GraphAdmissionClosureController.php`
- ‚úÖ `api/graph-admission-closure/bootstrap.php`
- ‚úÖ `api/graph-1c-admission-closure.php` (–æ–±–Ω–æ–≤–ª—ë–Ω)

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] Controller —Å–æ–∑–¥–∞–Ω
- [x] Bootstrap —Å–æ–∑–¥–∞–Ω
- [x] Legacy —Ñ–∞–π–ª –æ–±–Ω–æ–≤–ª—ë–Ω (–ø—Ä–æ–∫—Å–∏ –¥–ª—è weeks)
- [x] –ù–µ–¥–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
- [x] –ú–µ—Å—è—á–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ legacy

---

## –≠—Ç–∞–ø 65-10: –°–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –¶–µ–ª—å
–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –∏–∑–º–µ–Ω–∏–ª –ø–æ–≤–µ–¥–µ–Ω–∏–µ API.

### –ó–∞–¥–∞—á–∏
- [x] –ü—Ä–æ–≥–Ω–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
  - Weeks —Ä–µ–∂–∏–º (—Å/–±–µ–∑ include*)
  - Months —Ä–µ–∂–∏–º (legacy)
  - –° forceRefresh –∏ –±–µ–∑
  - –° debug –∏ –±–µ–∑
- [x] –°—Ä–∞–≤–Ω–∏—Ç—å JSON –æ—Ç–≤–µ—Ç—ã (–∫–ª—é—á–∏/–∑–Ω–∞—á–µ–Ω–∏—è)
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–µ—à (—Ö–∏—Ç—ã/–ø—Ä–æ–º–∞—Ö–∏)
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å carryover sums (this+prev+older = total)
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å series –¥–ª–∏–Ω—ã (4 —ç–ª–µ–º–µ–Ω—Ç–∞)
- [x] –û–±–Ω–æ–≤–∏—Ç—å spec.md –∏—Ç–æ–≥–∞–º–∏

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è `DOCS/ANALYSIS/graph-admission-closure-spec.md`
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] –í—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [x] JSON –æ—Ç–≤–µ—Ç—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã (–¥–æ/–ø–æ—Å–ª–µ)
- [x] –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] Carryover —Å—É–º–º—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [x] Series –¥–ª–∏–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [x] –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- –≠—Ç–∞–ø—ã 65-1 ‚Äî 65-9: –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- –≠—Ç–∞–ø 65-10: —á–∞—Å—Ç–∏—á–Ω–æ (–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω)

### üîÑ –í —Ä–∞–±–æ—Ç–µ
- –ú–µ—Å—è—á–Ω—ã–π —Ä–µ–∂–∏–º: –æ—Å—Ç–∞—ë—Ç—Å—è –≤ legacy –¥–æ –ø–µ—Ä–µ–Ω–æ—Å–∞

### üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –º–µ—Å—è—á–Ω—ã–π —Ä–µ–∂–∏–º –≤ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å (TASK-065 –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)
- –£–¥–∞–ª–∏—Ç—å –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥ –∏–∑ legacy —Ñ–∞–π–ª–∞ (TASK-067)

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ù–µ–¥–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (`periodMode=weeks`) –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –≤ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
- –ú–µ—Å—è—á–Ω—ã–π —Ä–µ–∂–∏–º (`periodMode=months`) –æ—Å—Ç–∞—ë—Ç—Å—è –≤ legacy —Ñ–∞–π–ª–µ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–∞—Ç –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –≤ –Ω–æ–≤–æ–º –º–æ–¥—É–ª–µ, —Ç–∞–∫ –∏ –≤ legacy (–¥–ª—è –º–µ—Å—è—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞)
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç API —Å–æ—Ö—Ä–∞–Ω—ë–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é ‚Äî –≤—Å–µ –∫–ª—é—á–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã

