# TASK-026-04: Обработка пустых и неидентифицированных значений "В работе" (UF_SLA_SERVICE_STR, сектор 1С)

**Дата создания:** 2025-12-11 19:15 (UTC+3, Брест)  
**Дата завершения:** 2025-12-11 13:26 (UTC+3, Брест)  
**Статус:** ✅ Завершена  
**Приоритет:** Высокий  
**Исполнитель:** Bitrix24 Программист (Vue.js)  
**Родитель:** TASK-026 (Система конфигурации значения "В работе" для сектора 1С)

## Цель
Реализовать устойчивую обработку пустых и неидентифицированных значений поля `UF_SLA_SERVICE_STR` (плашка "В работе") для сектора 1С: fallback-значение, нейтральное визуальное отображение, логирование (dev), чтобы UI оставался консистентным и понятным.

## Контекст
- Источник данных: `UF_SLA_SERVICE_STR` (Bitrix24, текст).  
- Конфиг: `service-config.js` (этап 026-01) содержит устойчивые значения и fallback.  
- Маппер: `ticket-mapper.js` (этап 026-02) должен подставлять fallback при неизвестных/пустых значениях.  
- UI: `TicketCard.vue` (этап 026-03) должен корректно отображать fallback.  
- Важно: только для сектора 1С. Другие секторы — отдельные конфиги/компоненты.

## Область работ и файлы
- **Основные для проверки/добавления логики:**
  - `vue-app/src/config/service-config.js` — убедиться, что fallback задан и документирован.
  - `vue-app/src/services/dashboard-sector-1c/mappers/ticket-mapper.js` — проверка/добавление fallback-логики и (опционально) логирования.
  - `vue-app/src/components/dashboard/TicketCard.vue` — корректное отображение fallback (цвета/лейбл).
- **Ссылочно:**  
  - `vue-app/src/services/dashboard-sector-1c/utils/constants.js` — убрать дублирующиеся статические цвета/классы, если остались.

## Требования к fallback-обработке
- Fallback-значение должно быть определено в конфиге:  
  - Нейтральная палитра (серый фон, контрастный текст).  
  - Текст по умолчанию: "Не указано" (или другой утверждённый вариант).  
  - Порядок сортировки — в конце списка.  
- Нормализация входных данных: `trim + toLowerCase` перед поиском в конфиге.  
- Условия fallback:  
  - Значение пустое (`null`, `undefined`, `''`).  
  - Значение не найдено в конфиге после нормализации.  
- Логирование (dev):  
  - При неизвестном значении можно логировать в консоль/лог только в DEV; в прод — тихий fallback.  
  - Добавить комментарий или условие по `process.env.NODE_ENV === 'development'`.

## Подзадачи
1. Проверить `service-config.js`: наличие fallback-объекта, нейтральной палитры, текст "Не указано", порядок в конце.  
2. В маппере `ticket-mapper.js`:  
   - Убедиться, что используется `getServiceByBitrixValue` с fallback.  
   - Добавить/проверить нормализацию (trim + lower).  
   - Добавить (опционально dev) лог неизвестных значений под условие окружения.  
3. В `TicketCard.vue`:  
   - Убедиться, что при приходе fallback-объекта корректно отображаются лейбл и цвета.  
   - Предусмотреть, что текст fallback не ломает макет (ellipsis/word-wrap при необходимости).  
4. Самопроверка: сборка не ломается, нет побочных регрессий.

## Критерии приёмки (для этапа 026-04) ✅
- [x] Fallback-значение в конфиге присутствует, имеет нейтральную палитру и текст ("Не указано").  
- [x] Маппер всегда возвращает fallback при пустых/неизвестных значениях, регистронезависимо.  
- [x] Логирование неизвестных значений ограничено DEV (или оставлен комментарий-напоминание).  
- [x] `TicketCard.vue` отображает fallback без артефактов, макет не ломается.  
- [x] Порядок сортировки: fallback в конце списка значений.  
- [x] Сборка успешна, консоль без новых ошибок.

## Тестирование (быстрый чек)
- Значение `UF_SLA_SERVICE_STR = ''`/`null`/`undefined` → отображается "Не указано", серый фон, без ошибок в консоли.  
- Значение `UF_SLA_SERVICE_STR = 'UnknownValue'` → fallback, при DEV — лог, при PROD — тихо.  
- Нормализация: `uf_sla_service_str: '  1с.документооборот  '` → корректное значение из конфига.  
- Длинный/случайный текст → fallback, макет не ломается (обрезка/перенос).  
- Сборка `npm run build` — без ошибок по импортам/типам.

## Зависимости/заметки
- Требует завершённых этапов 026-01 (конфиг) и 026-02 (маппер), а также совместимости с 026-03 (UI).  
- Только для сектора 1С; другие секторы — отдельные fallback’и и цвета.  
- При расширении списка значений: не забывать обновлять fallback и порядок.

## История правок
- 2025-12-11 19:15 (UTC+3, Брест): Создана задача 026-04.
- 2025-12-11 13:26 (UTC+3, Брест): ✅ Этап успешно выполнен. Fallback-обработка реализована во всех компонентах. Пустые/неизвестные значения корректно обрабатываются с нейтральным отображением.

