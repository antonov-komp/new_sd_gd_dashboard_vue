# TASK-037: Исправить переполнение графика состояния сектора 1С

**Дата создания:** 2025-12-15 12:00 (UTC+3, Брест)  
**Статус:** Новая  
**Приоритет:** Средний  
**Исполнитель:** Bitrix24 Программист (Vue.js)

## Цель
Устранить переполнение контента графика состояния сектора 1С: при переключении между линейным, столбчатым и круговым видами контент (canvas, подписи сотрудников/стадий, легенда) выходит за подложку `div.graph-state-chart`.

## Контекст
- В `vue-app/src/components/graph-state/GraphStateChart.vue` подложка `graph-state-chart` визуально меньше, чем вложенные контейнеры графика.  
- Сейчас `.chart-container` жёстко задана `height: 400px`, а вложенный `.chart-canvas-container` — `min/max/height: 450px` + `overflow: visible`. Родитель на уровне дашборда (`GraphStateDashboard.vue`) имеет `min-height: 400px`. Из-за несогласованных высот подписи и canvas выходят за фон/тень подложки.  
- Проблема выражена сильнее для линейного и столбчатого видов (подписи сотрудников, подписи стадий, легенда), но затрагивает и круговой.

## Требования
- Привести размеры контейнеров графика к согласованным значениям или сделать их адаптивными, чтобы фон `graph-state-chart` покрывал весь визуальный контент.
- Сохранить отображение подписей сотрудников (столбчатый) и подписей стадий/легенды без обрезания.  
- Сохранить текущие плагины Chart.js (overlappingPointsPlugin, pointJitterPlugin, pointLabelsPlugin) и поведение кликов/тултипов.  
- Адаптивность: корректное отображение на desktop/tablet/mobile без горизонтальной прокрутки; не допускать вырезания элементов при узких экранах.  
- Экспорт в PDF (`exportToPDF` в `GraphStateDashboard.vue`) не должен ломаться: захватываемый элемент должен полностью содержать график и подписи.
- Не изменять бизнес-логику загрузки данных/сравнения — только верстка/стили/опции Chart.js, влияющие на размеры/отступы.

## API‑методы Bitrix24
Не используются (правка фронтенд-рендера графиков).

## Модули и файлы
- `vue-app/src/components/graph-state/GraphStateChart.vue` — основная правка стилей/верстки/опций размеров.
- `vue-app/src/components/graph-state/GraphStateDashboard.vue` — проверить контейнер обёртки и экспорта в PDF (при необходимости скорректировать высоты/класс контейнера).
- При необходимости: общие CSS/переменные, если высота будет вынесена в токены.

## Подзадачи
1. Проанализировать текущие размеры: `graph-state-chart`, `.chart-container`, `.chart-canvas-container`, `.chart-wrapper`, а также родительский `.chart-container` в `GraphStateDashboard.vue`.
2. Выбрать стратегию:  
   - либо синхронизированные фиксированные значения (например, `min-height`/`height` на одном уровне),  
   - либо адаптивная высота (например, `min-height` + `auto` + доп. нижний padding под подписи).  
3. Обновить стили, чтобы фон и тень подложки покрывали график и подписи, без выхода контента наружу. Учесть разные типы графиков:  
   - line/bar: больше вертикального места из-за подписей и легенды;  
   - doughnut: может иметь меньшую высоту, но не должен ломать layout.  
4. Проверить и при необходимости подправить опции Chart.js `layout.padding`/`maintainAspectRatio`/`height` так, чтобы подписи и тултипы не уходили за рамки.
5. Проверить экспорт в PDF: элемент, передаваемый в `html2canvas`, должен содержать весь график. При необходимости скорректировать селектор или внешние отступы.
6. Протестировать на desktop и мобильном: переключение типов (line → bar → doughnut), наличие подписей сотрудников/стадий, отсутствие вертикальных/горизонтальных скроллов и обрезания.

## Критерии приёмки
- При любом типе графика контент целиком помещается внутри подложки `graph-state-chart`; нет визуального выхода за фон/тень.
- Подписи сотрудников (бар) и подписи стадий отображаются и читаемы; легенда не обрезается.
- Линейный график: точки/подписи/тултипы не обрезаются по нижнему или верхнему краю.
- Круговая диаграмма: подписи/легенда не выходят за границы контейнера.
- На ширине < 768px нет горизонтального скролла из-за графика; вертикальные отступы достаточны.
- Экспорт в PDF формирует изображение без обрезанных частей графика/подписей.
- Не затронута логика загрузки/сравнения данных.

## Тестирование
1. Открыть дашборд сектора 1С, загрузить данные, переключить типы: Line → Bar → Doughnut. Убедиться, что фон подложки покрывает график и подписи.
2. Проверить на desktop (≥1024px) и mobile (<768px): нет горизонтального скролла, подписи видимы.
3. Для Bar: подписи сотрудников и стадий читаемы, не обрезаны по низу; тултипы отображаются полностью.
4. Для Line: точки/подписи/тултипы не выходят за пределы контейнера.
5. Для Doughnut: легенда и сектора не обрезаны; курсор/клики работают.
6. Выполнить экспорт в PDF — убедиться, что в итоговом PDF график/подписи не обрезаны.

## Вопросы/ответы
- Q: Допустимо ли уменьшать высоту doughnut отдельно от line/bar?  
  A: Да, если это не ломает общий layout и экспорт в PDF.
- Q: Можно ли увеличить общий вертикальный padding подложки вместо фиксированной высоты?  
  A: Да, если это решает переполнение и сохраняет адаптивность.
