# TASK-019-02-02: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ SnapshotService (–≤–∞–ª–∏–¥–∞—Ü–∏—è, —É–¥–∞–ª–µ–Ω–∏–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-08 08:54 (UTC+3, –ë—Ä–µ—Å—Ç)  
**–°—Ç–∞—Ç—É—Å:** –ù–æ–≤–∞—è  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** Bitrix24 –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç (Vue.js)  
**–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞:** TASK-019-00 (–≠—Ç–∞–ø 2, —á–∞—Å—Ç—å 2)

---

## üìã –¶–µ–ª—å –∑–∞–¥–∞—á–∏

–†–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞ `SnapshotService.js`, –¥–æ–±–∞–≤–∏–≤ –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö, –º–µ—Ç–æ–¥—ã —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–µ–ø–∫–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ª–µ–ø–∫–∞–º–∏.

---

## üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (TASK-019-02-01) –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å:
- –í–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–ª–µ–ø–∫–∞
- –ú–µ—Ç–æ–¥—ã —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–µ–ø–∫–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫—É —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏ –∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–µ–ø–∫–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- TASK-019-02-01 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω (–±–∞–∑–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞–Ω)
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å–ª–µ–ø–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ (TASK-019-01-01)
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ (TASK-019-01-02)

---

## ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ú–µ—Ç–æ–¥ `validateSnapshot(snapshot)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–ª–µ–ø–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `snapshot` (Object) ‚Äî –æ–±—ä–µ–∫—Ç —Å–ª–µ–ø–∫–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Object` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```javascript
{
  isValid: boolean,
  errors: Array<string>, // –ú–∞—Å—Å–∏–≤ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  warnings: Array<string> // –ú–∞—Å—Å–∏–≤ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
}
```

**–ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

1. **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è):**
   - `metadata.version` ‚Äî –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞, –Ω–µ –ø—É—Å—Ç–∞—è
   - `metadata.createdAt` ‚Äî –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω–∞—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601
   - `metadata.type` ‚Äî –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–¥–Ω–∞ –∏–∑: `'week_start' | 'week_end' | 'manual' | 'current'`
   - `metadata.sectorId` ‚Äî –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞, –Ω–µ –ø—É—Å—Ç–∞—è
   - `metadata.createdBy` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ `id` –∏ `name`

2. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è):**
   - `statistics.stages` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ `formed`, `review`, `execution`, `total`
   - `statistics.employees` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤
   - `statistics.zeroPoint` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ `unassigned`, `keeper`, `total`

3. **–¢–∏–∫–µ—Ç—ã:**
   - `ticketIds` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª
   - `tickets` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ (id, title, assignedTo, createdAt, updatedAt)

4. **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–µ—Ç–æ–≤ –≤ `statistics.stages.total` –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Å—É–º–º–æ–π –ø–æ —ç—Ç–∞–ø–∞–º
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–µ—Ç–æ–≤ –≤ `ticketIds` –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤ `tickets`
   - ID —Ç–∏–∫–µ—Ç–æ–≤ –≤ `ticketIds` –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å ID –≤ –º–∞—Å—Å–∏–≤–µ `tickets`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```javascript
const validation = SnapshotService.validateSnapshot(snapshot);

if (!validation.isValid) {
  console.error('–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', validation.errors);
  throw new Error('–°–ª–µ–ø–æ–∫ –Ω–µ –ø—Ä–æ—à—ë–ª –≤–∞–ª–∏–¥–∞—Ü–∏—é');
}

if (validation.warnings.length > 0) {
  console.warn('–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:', validation.warnings);
}
```

---

### –ú–µ—Ç–æ–¥ `validateSectorData(sectorData)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–ª–µ–ø–∫–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `sectorData` (Object) ‚Äî –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞ –∏–∑ `DashboardSector1CService.getSectorData()`

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Object` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `validateSnapshot`)

**–ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (`stages`, `employees`, `zeroPoint`, `tickets`)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å–ª–µ–ø–∫–æ–≤

### –ú–µ—Ç–æ–¥ `deleteSnapshot(date, type)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–ª–µ–ø–æ–∫ –ø–æ –¥–∞—Ç–µ –∏ —Ç–∏–ø—É.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `date` (String | Date) ‚Äî –¥–∞—Ç–∞ —Å–ª–µ–ø–∫–∞
- `type` (String) ‚Äî —Ç–∏–ø —Å–ª–µ–ø–∫–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Promise<boolean>` ‚Äî `true` –µ—Å–ª–∏ —É–¥–∞–ª—ë–Ω, `false` –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```javascript
// –£–¥–∞–ª–∏—Ç—å —Å–ª–µ–ø–æ–∫ –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏ –æ—Ç 2025-12-01
const deleted = await SnapshotService.deleteSnapshot('2025-12-01', 'week_start');

if (deleted) {
  console.log('–°–ª–µ–ø–æ–∫ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω');
} else {
  console.log('–°–ª–µ–ø–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
}
```

**–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞:**
1. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç `YYYY-MM-DD`
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å DELETE-–∑–∞–ø—Ä–æ—Å –∫ Laravel API
3. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç (404 = –Ω–µ –Ω–∞–π–¥–µ–Ω, 200 = —É–¥–∞–ª—ë–Ω)
4. –í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –≤–µ—Ä–Ω—É—Ç—å `false` (–Ω–µ –æ—à–∏–±–∫–∞)
- –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ ‚Üí –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
- –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ ‚Üí –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ

---

### –ú–µ—Ç–æ–¥ `deleteSnapshotsByPeriod(period)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–ª–µ–ø–∫–∏ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `period` (Object) ‚Äî –ø–µ—Ä–∏–æ–¥ —É–¥–∞–ª–µ–Ω–∏—è
  - `startDate` (String | Date) ‚Äî –Ω–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞
  - `endDate` (String | Date) ‚Äî –∫–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞
  - `type` (String, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Promise<number>` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Å–ª–µ–ø–∫–æ–≤

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```javascript
// –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–ª–µ–ø–∫–∏ –∑–∞ –¥–µ–∫–∞–±—Ä—å 2025
const deletedCount = await SnapshotService.deleteSnapshotsByPeriod({
  startDate: '2025-12-01',
  endDate: '2025-12-31'
});

console.log(`–£–¥–∞–ª–µ–Ω–æ —Å–ª–µ–ø–∫–æ–≤: ${deletedCount}`);
```

**–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–ª–µ–ø–∫–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥ —á–µ—Ä–µ–∑ `getAllSnapshots()`
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–µ–ø–∫–∞ –≤—ã–∑–≤–∞—Ç—å `deleteSnapshot()`
3. –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö
4. –í–µ—Ä–Ω—É—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ ‚Üí –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
- –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–ª–µ–ø–∫–∞ ‚Üí –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏

---

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞

### –ú–µ—Ç–æ–¥ `migrateSnapshot(snapshot, targetVersion)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–µ–ø–æ–∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ –≤ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Ñ–æ—Ä–º–∞—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `snapshot` (Object) ‚Äî —Å–ª–µ–ø–æ–∫ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
- `targetVersion` (String, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —Ü–µ–ª–µ–≤–∞—è –≤–µ—Ä—Å–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Promise<Object>` ‚Äî –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–µ–ø–æ–∫

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```javascript
// –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–µ–ø–æ–∫ –≤–µ—Ä—Å–∏–∏ 1.0 –≤ –≤–µ—Ä—Å–∏—é 2.0 (–µ—Å–ª–∏ –±—É–¥–µ—Ç)
const migratedSnapshot = await SnapshotService.migrateSnapshot(oldSnapshot, '2.0');
```

**–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞:**
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é —Å–ª–µ–ø–∫–∞ –∏–∑ `metadata.version`
2. –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ü–µ–ª–µ–≤–æ–π ‚Üí –≤–µ—Ä–Ω—É—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è —Å—Ç–∞—Ä—à–µ ‚Üí –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∞–¥–∞–ø—Ç–µ—Ä—ã –º–∏–≥—Ä–∞—Ü–∏–∏
4. –û–±–Ω–æ–≤–∏—Ç—å `metadata.version` –Ω–∞ —Ü–µ–ª–µ–≤—É—é –≤–µ—Ä—Å–∏—é
5. –í–µ—Ä–Ω—É—Ç—å –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–µ–ø–æ–∫

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ù–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç (–≤–µ—Ä—Å–∏—è 1.0) –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –Ω–æ –º–µ—Ç–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –∫ –±—É–¥—É—â–∏–º –≤–µ—Ä—Å–∏—è–º.

---

### –ú–µ—Ç–æ–¥ `getSnapshotVersion(snapshot)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –≤–µ—Ä—Å–∏—é —Ñ–æ—Ä–º–∞—Ç–∞ —Å–ª–µ–ø–∫–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `snapshot` (Object) ‚Äî —Å–ª–µ–ø–æ–∫

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `String` ‚Äî –≤–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'1.0'`)

---

## üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏ –∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏

### –ú–µ—Ç–æ–¥ `getWeekNumber(date)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏ –≥–æ–¥–∞ –ø–æ ISO 8601.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `date` (String | Date) ‚Äî –¥–∞—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Object` ‚Äî `{ year: number, week: number }`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```javascript
const weekInfo = SnapshotService.getWeekNumber('2025-12-08');
// { year: 2025, week: 50 }
```

---

### –ú–µ—Ç–æ–¥ `getWeekStartDate(date)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫) –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∞—Ç—ã.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `date` (String | Date) ‚Äî –¥–∞—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Date` ‚Äî –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 00:00)

---

### –ú–µ—Ç–æ–¥ `getWeekEndDate(date)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—É –∫–æ–Ω—Ü–∞ –Ω–µ–¥–µ–ª–∏ (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ) –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∞—Ç—ã.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `date` (String | Date) ‚Äî –¥–∞—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Date` ‚Äî –¥–∞—Ç–∞ –∫–æ–Ω—Ü–∞ –Ω–µ–¥–µ–ª–∏ (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 23:59:59)

---

### –ú–µ—Ç–æ–¥ `getSnapshotsForWeek(date)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–ª–µ–ø–∫–∏ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `date` (String | Date) ‚Äî –ª—é–±–∞—è –¥–∞—Ç–∞ –Ω–µ–¥–µ–ª–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Promise<Object>` ‚Äî –æ–±—ä–µ–∫—Ç —Å —Å–ª–µ–ø–∫–∞–º–∏ –Ω–µ–¥–µ–ª–∏
```javascript
{
  weekStart: Object | null,  // –°–ª–µ–ø–æ–∫ –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏
  weekEnd: Object | null,     // –°–ª–µ–ø–æ–∫ –∫–æ–Ω—Ü–∞ –Ω–µ–¥–µ–ª–∏
  manual: Array<Object>,      // –†—É—á–Ω—ã–µ —Å–ª–µ–ø–∫–∏ –∑–∞ –Ω–µ–¥–µ–ª—é
  weekInfo: { year, week }   // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–µ–¥–µ–ª–µ
}
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```javascript
const weekSnapshots = await SnapshotService.getSnapshotsForWeek('2025-12-08');

if (weekSnapshots.weekStart && weekSnapshots.weekEnd) {
  // –ú–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏
  console.log('–ù–µ–¥–µ–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç–∞ —Å–ª–µ–ø–∫–∞–º–∏');
}
```

---

## üíæ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ú–µ—Ç–æ–¥ `getSnapshotCached(date, type, ttl)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–ø–æ–∫ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `date` (String | Date) ‚Äî –¥–∞—Ç–∞ —Å–ª–µ–ø–∫–∞
- `type` (String) ‚Äî —Ç–∏–ø —Å–ª–µ–ø–∫–∞
- `ttl` (Number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–µ—à–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5 –º–∏–Ω—É—Ç)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Promise<Object | null>` ‚Äî —Å–ª–µ–ø–æ–∫ –∏–∑ –∫–µ—à–∞ –∏–ª–∏ API

**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–µ—à (localStorage –∏–ª–∏ memory cache)
- –ï—Å–ª–∏ –µ—Å—Ç—å –≤ –∫–µ—à–µ –∏ –Ω–µ –∏—Å—Ç—ë–∫ TTL ‚Üí –≤–µ—Ä–Ω—É—Ç—å –∏–∑ –∫–µ—à–∞
- –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫–µ—à–µ –∏–ª–∏ –∏—Å—Ç—ë–∫ TTL ‚Üí –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ API –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–µ—à

---

### –ú–µ—Ç–æ–¥ `clearSnapshotCache(date, type)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–ª–µ–ø–∫–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `date` (String | Date, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –¥–∞—Ç–∞ —Å–ª–µ–ø–∫–∞ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ ‚Äî –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à)
- `type` (String, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —Ç–∏–ø —Å–ª–µ–ø–∫–∞

---

## üö® –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ö–ª–∞—Å—Å –æ—à–∏–±–æ–∫ `SnapshotError`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Å –æ—à–∏–±–æ–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ª–µ–ø–∫–∞–º–∏.

```javascript
class SnapshotError extends Error {
  constructor(message, code, details = {}) {
    super(message);
    this.name = 'SnapshotError';
    this.code = code; // 'VALIDATION_ERROR', 'NOT_FOUND', 'API_ERROR', etc.
    this.details = details;
  }
}
```

**–¢–∏–ø—ã –æ—à–∏–±–æ–∫:**
- `VALIDATION_ERROR` ‚Äî –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- `NOT_FOUND` ‚Äî —Å–ª–µ–ø–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω
- `API_ERROR` ‚Äî –æ—à–∏–±–∫–∞ API (—Å–µ—Ç—å, —Å–µ—Ä–≤–µ—Ä)
- `VERSION_MISMATCH` ‚Äî –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –≤–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞
- `PERMISSION_DENIED` ‚Äî –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

---

### –ú–µ—Ç–æ–¥ `handleError(error)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É –∏ –≤–µ—Ä–Ω—É—Ç—å –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `error` (Error) ‚Äî –æ–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Object` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞
```javascript
{
  message: string,
  code: string,
  details: object
}
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –ú–µ—Ç–æ–¥ `getSnapshotsStatistics(period)`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å–ª–µ–ø–∫–∞–º –∑–∞ –ø–µ—Ä–∏–æ–¥.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `period` (Object, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –ø–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Promise<Object>` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```javascript
{
  total: number,              // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–µ–ø–∫–æ–≤
  byType: {                   // –ü–æ —Ç–∏–ø–∞–º
    week_start: number,
    week_end: number,
    manual: number,
    current: number
  },
  byWeek: Array<{             // –ü–æ –Ω–µ–¥–µ–ª—è–º
    year: number,
    week: number,
    count: number
  }>,
  oldest: Object | null,      // –°–∞–º—ã–π —Å—Ç–∞—Ä—ã–π —Å–ª–µ–ø–æ–∫
  newest: Object | null        // –°–∞–º—ã–π –Ω–æ–≤—ã–π —Å–ª–µ–ø–æ–∫
}
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

- [ ] –ú–µ—Ç–æ–¥ `validateSnapshot()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–æ –≤—Å–µ–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- [ ] –ú–µ—Ç–æ–¥ `validateSectorData()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `deleteSnapshot()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ú–µ—Ç–æ–¥ `deleteSnapshotsByPeriod()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `migrateSnapshot()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –±—É–¥—É—â–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π)
- [ ] –ú–µ—Ç–æ–¥ `getSnapshotVersion()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (`getWeekNumber`, `getWeekStartDate`, `getWeekEndDate`, `getSnapshotsForWeek`)
- [ ] –ö–ª–∞—Å—Å –æ—à–∏–±–æ–∫ `SnapshotError` —Å–æ–∑–¥–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `handleError()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `getSnapshotsStatistics()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã –ø–æ–∫—Ä—ã—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- [ ] JSDoc-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ –≤—Å–µ–º –º–µ—Ç–æ–¥–∞–º
- [ ] –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –≤—Ä—É—á–Ω—É—é

---

## üìù –î–µ–π—Å—Ç–≤–∏—è

1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `validateSnapshot()` —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –ø—Ä–∞–≤–∏–ª –≤–∞–ª–∏–¥–∞—Ü–∏–∏
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `validateSectorData()` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `deleteSnapshot()` —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Laravel API
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `deleteSnapshotsByPeriod()` –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
5. –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `SnapshotError` –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `handleError()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `migrateSnapshot()` (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –±—É–¥—É—â–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π)
8. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏ (`getWeekNumber`, `getWeekStartDate`, `getWeekEndDate`)
9. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `getSnapshotsForWeek()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–ø–∫–æ–≤ –Ω–µ–¥–µ–ª–∏
10. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `getSnapshotsStatistics()` –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
11. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–µ–ø–∫–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
12. –î–æ–±–∞–≤–∏—Ç—å JSDoc-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫–æ –≤—Å–µ–º –Ω–æ–≤—ã–º –º–µ—Ç–æ–¥–∞–º
13. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –º–µ—Ç–æ–¥—ã –≤—Ä—É—á–Ω—É—é

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞:** `DOCS/TASKS/TASK-019-00-plan.md`
- **–ü—Ä–µ–¥—ã–¥—É—â–∞—è –∑–∞–¥–∞—á–∞:** `DOCS/TASKS/TASK-019-02-01.md` (–±–∞–∑–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:** `DOCS/TASKS/TASK-019-01-01.md`
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è:** `DOCS/TASKS/TASK-019-01-02.md`
- **–°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞:** `DOCS/TASKS/TASK-019-03.md` (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–∞—à–±–æ—Ä–¥–æ–º)

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–ª–µ–ø–∫–∞

```javascript
/**
 * –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–ª–µ–ø–∫–∞
 * 
 * @param {Object} snapshot - –û–±—ä–µ–∫—Ç —Å–ª–µ–ø–∫–∞
 * @returns {Object} –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
 */
static validateSnapshot(snapshot) {
  const errors = [];
  const warnings = [];

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
  if (!snapshot.metadata) {
    errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–ª–µ–ø–∫–∞');
  } else {
    if (!snapshot.metadata.version || typeof snapshot.metadata.version !== 'string') {
      errors.push('–ù–µ–≤–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö');
    }
    if (!snapshot.metadata.createdAt || !this.isValidISODate(snapshot.metadata.createdAt)) {
      errors.push('–ù–µ–≤–µ—Ä–Ω–∞—è –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è');
    }
    if (!['week_start', 'week_end', 'manual', 'current'].includes(snapshot.metadata.type)) {
      errors.push('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø —Å–ª–µ–ø–∫–∞');
    }
    if (!snapshot.metadata.sectorId || typeof snapshot.metadata.sectorId !== 'string') {
      errors.push('–ù–µ–≤–µ—Ä–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ–∫—Ç–æ—Ä–∞');
    }
    if (!snapshot.metadata.createdBy || !snapshot.metadata.createdBy.id || !snapshot.metadata.createdBy.name) {
      errors.push('–ù–µ–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞—Ç–µ–ª–µ');
    }
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  if (!snapshot.statistics) {
    errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞');
  } else {
    if (!snapshot.statistics.stages) {
      errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —ç—Ç–∞–ø–∞–º');
    } else {
      const stages = snapshot.statistics.stages;
      const total = (stages.formed?.count || 0) + (stages.review?.count || 0) + (stages.execution?.count || 0);
      if (stages.total !== total) {
        warnings.push(`–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–µ—Ç–æ–≤: –æ–∂–∏–¥–∞–µ—Ç—Å—è ${total}, —É–∫–∞–∑–∞–Ω–æ ${stages.total}`);
      }
    }
    if (!Array.isArray(snapshot.statistics.employees)) {
      errors.push('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º');
    }
    if (!snapshot.statistics.zeroPoint) {
      errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω—É–ª–µ–≤–æ–π —Ç–æ—á–∫–∏');
    }
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤
  if (!Array.isArray(snapshot.ticketIds)) {
    errors.push('ticketIds –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º');
  }
  if (!Array.isArray(snapshot.tickets)) {
    errors.push('tickets –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º');
  } else {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ ID
    const ticketIds = new Set(snapshot.ticketIds);
    const ticketsIds = new Set(snapshot.tickets.map(t => t.id));
    
    if (ticketIds.size !== ticketsIds.size) {
      warnings.push('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ ID –≤ ticketIds –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–∏–∫–µ—Ç–æ–≤');
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Ç–∏–∫–µ—Ç–æ–≤
    snapshot.tickets.forEach((ticket, index) => {
      if (!ticket.id) {
        errors.push(`–¢–∏–∫–µ—Ç #${index}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ID`);
      }
      if (!ticket.title) {
        errors.push(`–¢–∏–∫–µ—Ç #${index}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫`);
      }
      if (!ticket.assignedTo || !ticket.assignedTo.id) {
        errors.push(`–¢–∏–∫–µ—Ç #${index}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π`);
      }
      if (!ticket.createdAt) {
        errors.push(`–¢–∏–∫–µ—Ç #${index}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è`);
      }
      if (!ticket.updatedAt) {
        errors.push(`–¢–∏–∫–µ—Ç #${index}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è`);
      }
    });
  }

  return {
    isValid: errors.length === 0,
    errors,
    warnings
  };
}
```

### –£–¥–∞–ª–µ–Ω–∏–µ —Å–ª–µ–ø–∫–∞

```javascript
/**
 * –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–ª–µ–ø–æ–∫
 * 
 * @param {String|Date} date - –î–∞—Ç–∞ —Å–ª–µ–ø–∫–∞
 * @param {String} type - –¢–∏–ø —Å–ª–µ–ø–∫–∞
 * @returns {Promise<boolean>} true –µ—Å–ª–∏ —É–¥–∞–ª—ë–Ω, false –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
 */
static async deleteSnapshot(date, type) {
  try {
    const dateStr = this.formatDate(date);
    const url = `${this.apiBaseUrl}${this.snapshotsEndpoint}/${dateStr}/${type}`;

    const response = await fetch(url, {
      method: 'DELETE',
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    });

    if (response.status === 404) {
      return false; // –°–ª–µ–ø–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω
    }

    if (!response.ok) {
      throw new SnapshotError(
        `–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–µ–ø–∫–∞: ${response.statusText}`,
        'API_ERROR',
        { status: response.status }
      );
    }

    const result = await response.json();

    if (!result.success) {
      throw new SnapshotError(
        result.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–µ–ø–∫–∞',
        'API_ERROR'
      );
    }

    // –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    this.clearSnapshotCache(dateStr, type);

    return true;
  } catch (error) {
    if (error instanceof SnapshotError) {
      throw error;
    }
    throw new SnapshotError(
      `–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–ª–µ–ø–∫–∞: ${error.message}`,
      'API_ERROR',
      { originalError: error }
    );
  }
}
```

### –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –Ω–µ–¥–µ–ª–∏

```javascript
/**
 * –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏ –≥–æ–¥–∞ –ø–æ ISO 8601
 * 
 * @param {String|Date} date - –î–∞—Ç–∞
 * @returns {Object} { year: number, week: number }
 */
static getWeekNumber(date) {
  const d = new Date(date);
  d.setHours(0, 0, 0, 0);
  
  // ISO 8601: –Ω–µ–¥–µ–ª—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
  // –ü–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è –≥–æ–¥–∞ ‚Äî —Ç–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –µ—Å—Ç—å 4 —è–Ω–≤–∞—Ä—è
  const dayOfWeek = d.getDay() || 7; // 1 = –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 7 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
  d.setDate(d.getDate() + 4 - dayOfWeek); // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –Ω–µ–¥–µ–ª–∏
  
  const yearStart = new Date(d.getFullYear(), 0, 1);
  const weekNumber = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
  
  return {
    year: d.getFullYear(),
    week: weekNumber
  };
}
```

---

## ‚è±Ô∏è –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

**3-4 —á–∞—Å–∞**

---

## üîó –°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ —ç—Ç–∞–ø 2 –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω. –ü–µ—Ä–µ–π—Ç–∏ –∫ **TASK-019-03: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –¥–∞—à–±–æ—Ä–¥–æ–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞**.

---

## –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∞–≤–æ–∫

- **2025-12-08 08:54 (UTC+3, –ë—Ä–µ—Å—Ç):** –°–æ–∑–¥–∞–Ω–∞ –∑–∞–¥–∞—á–∞

---

**–ê–≤—Ç–æ—Ä:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0

