# TASK-028-03: Этап 3 — Техническое решение (Vue) для фильтров/стадий «График состояния сектора 1С»

**Дата создания:** 2025-12-11 13:07 (UTC+3, Брест)  
**Статус:** Новая  
**Приоритет:** Средний  
**Исполнитель:** Bitrix24 Программист (Vue.js)  
**Родительская задача:** TASK-028  

## Цель этапа

Спроектировать техническое решение (API компонентов, сервисы, состояния) для реализации улучшенного UX фильтров и блока стадий, включая подгрузку сотрудников сектора 1С.

## Контекст

- Этап 28-02 задал UX/UI требования (контейнеры, состояния, поиск сотрудников).  
- На этом этапе нужно определить структуру компонентов, их пропсы/события, API-слой и требования к состояниям/кэшированию/дебаунсу для последующей реализации.

## Область работ этапа

1) Специфицировать API компонентов (`FiltersPanel`, `StageChips`, `EmployeeSelect`): пропсы, события, состояния.  
2) Определить API-слой для сотрудников сектора 1С: URL, параметры, дебаунс, кэширование.  
3) Описать состояния и обработку ошибок для фильтров/стадий/селекта сотрудников.  
4) Зафиксировать требования к стилям (кратко) и доступности (ARIA, фокус).  

## Предлагаемое решение

### Компоненты и их API

- `FiltersPanel`  
  - Пропсы:  
    - `modelValue` (object) — значения фильтров.  
    - `schema` (array) — описание полей (type, key, label, placeholder, options loader).  
    - `columns` (number|string) — кол-во колонок / брейкпоинты.  
  - События: `update:modelValue`, `apply`, `reset`.  
  - Слоты: опционально для кастомных полей.  

- `StageChips`  
  - Пропсы:  
    - `options` (array) — [{ id, label, count? }];  
    - `modelValue` (string|array) — выбранные стадии;  
    - `multiple` (bool) — режим выбора;  
    - `disabled` (bool).  
  - События: `update:modelValue`, `hover`.  
  - Состояния: default / hover / active / disabled; поддержка счётчика (если решено в 28-02).  

- `EmployeeSelect`  
  - Пропсы:  
    - `modelValue` (string|number|null);  
    - `placeholder` (string) — «Выберите сотрудника сектора 1С»;  
    - `loader` (function searchTerm -> Promise<array>);  
    - `disabled` (bool).  
  - События: `update:modelValue`, `search`, `retry`, `focus`, `blur`.  
  - Состояния: loading / empty / error / default.  

### API-слой (сотрудники сектора 1С)

- Клиент: `vue-app/src/api/sector1cEmployees.js`  
  - Метод: `fetchEmployees({ search, limit = 20, sectorId })` → Promise<[ { id, name, position } ]>.  
  - Дебаунс поиска на UI: 200–300 мс.  
  - Кэширование по ключу (search, sectorId) на сессию (in-memory).  
  - Обработка ошибок: выбрасывать Error с кодом/сообщением; UI показывает retry.  
  - Источник (уточнить):  
    - Bitrix24 `user.get` с фильтром по подразделению сектора 1С (https://context7.com/bitrix24/rest/user.get), или  
    - Внутренний API `/api/sector1c/employees?search=...&limit=20`.  

### Состояния и ошибки

- Для `EmployeeSelect`:  
  - loading — спиннер/лоадер;  
  - empty — текст «Нет сотрудников сектора 1С»;  
  - error — текст + кнопка «Повторить» (генерирует `retry`);  
  - success — список опций;  
  - debounce запросов, отмена устаревших промисов (optional).  
- Для `StageChips`:  
  - disabled — серый текст/бордер, курсор default;  
  - active — фон+бордер выделены;  
  - hover — лёгкое усиление бордера/фона.  

### Стили и доступность (кратко)

- Сетка 8px, фон контейнера стадий `#f8f9fa`, бордер `#e5e7eb`, радиус 6–8px.  
- Фокус для интерактивных элементов: outline/box-shadow с контрастом.  
- ARIA: `role="listbox"` для селекта, `role="option"` для пунктов, `aria-pressed` для стадийных кнопок.  

## Шаги выполнения

1. Финализировать API компонентов (пропсы/события), согласовать multiple/single для стадий (берём решение 28-02).  
2. Описать интерфейсы типов (TS/JS Doc) для опций стадий и сотрудников.  
3. Описать контракт API сотрудников (параметры, пример ответа, коды ошибок).  
4. Зафиксировать требования к дебаунсу/кэшированию, поведению при ошибках.  
5. Сохранить описание в этом документе, при необходимости приложить схемы/ссылки.  

## Артефакты этапа

- Описание API компонентов (`FiltersPanel`, `StageChips`, `EmployeeSelect`).  
- Контракт API для загрузки сотрудников сектора 1С.  
- Решения по состояниям и стилям (кратко).  

## Критерии приёмки

- [ ] Задокументированы пропсы/события/состояния для всех трёх компонентов.  
- [ ] Описан контракт API сотрудников: параметры, пример ответа, обработка ошибок.  
- [ ] Зафиксированы требования к дебаунсу и кэшированию поиска.  
- [ ] Описаны состояния (loading/empty/error/active/hover/disabled) и базовые стили.  
- [ ] Учтено решение 28-02 по single/multi-select стадий.  

## Вопросы для уточнения

1. Окончательный источник данных сотрудников: Bitrix24 `user.get` или внутренний сервис?  
2. Нужна ли локальная сортировка по алфавиту после загрузки или полагаться на API?  
3. Требуется ли отображать должность/отдел в списке сотрудников (поле `position`)?  
4. Нужна ли локализация текстов состояний (empty/error/loading)?  
5. Допустима ли in-memory кэшировка или нужна persist (localStorage) для списка?  

