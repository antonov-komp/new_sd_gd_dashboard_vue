# TASK-052: Разделение линейного графика на две части (Новые/Закрытые и Переходящие)

**Дата создания:** 2025-12-17 14:36 (UTC+3, Брест)  
**Статус:** ✅ Завершена  
**Приоритет:** Средний  
**Исполнитель:** Bitrix24 Программист (Vue.js Developer)  
**Связанные модули:** 
- График приёма и закрытий сектора 1С (TASK-041) — базовый модуль
- TASK-048: Линейный график за 4 недели — текущая реализация

---

## Цель

Разделить текущий линейный график модуля «График приёма и закрытий сектора 1С» на два отдельных графика, расположенных рядом на одном уровне:

1. **Левый график:** «Новые» и «Закрытые» тикеты (все разбивки)
2. **Правый график:** «Переходящие» тикеты (все разбивки)

Оба графика должны работать с данными за 4 недели (как в текущей реализации TASK-048).

---

## Контекст

В текущей реализации модуля «График приёма и закрытий сектора 1С» все серии данных (Новые, Закрытые, Переходящие) отображаются в одном линейном графике. Это создаёт визуальную перегруженность, особенно при работе с данными за 4 недели.

**Текущая реализация:**
- Один линейный график с 7 сериями данных:
  - Новые
  - Закрытые (все)
  - Закрытые (созданы этой неделей)
  - Закрытые (созданы другой неделей)
  - Переходящие (все)
  - Переходящие (созданы этой неделей)
  - Переходящие (созданы другой неделей)

**Целевая реализация:**
- Два линейных графика рядом:
  - **График 1 (слева):** Новые и Закрытые (4 серии)
  - **График 2 (справа):** Переходящие (3 серии)

---

## Требования

### 1. Разделение данных

**Левый график (Новые и Закрытые):**
- Серия 1: «Новые» (`series.new`)
- Серия 2: «Закрытые (все)» (`series.closed`)
- Серия 3: «Закрытые (созданы этой неделей)» (`series.closedCreatedThisWeek`)
- Серия 4: «Закрытые (созданы другой неделей)` (`series.closedCreatedOtherWeek`)

**Правый график (Переходящие):**
- Серия 1: «Переходящие (все)» (`series.carryover`)
- Серия 2: «Переходящие (созданы этой неделей)» (`series.carryoverCreatedThisWeek`)
- Серия 3: «Переходящие (созданы другой неделей)» (`series.carryoverCreatedOtherWeek`)

### 2. Расположение графиков

- **Оба графика на одном уровне:** горизонтальное расположение (рядом друг с другом)
- **Равная ширина:** каждый график занимает 50% ширины контейнера (или пропорционально)
- **Адаптивность:** на мобильных устройствах графики располагаются вертикально (один под другим)

### 3. Работа с 4 неделями

- **Оба графика работают с данными за 4 недели** (как в текущей реализации TASK-048)
- **Метаданные недель:** используются `meta.weeks` для подписей осей X
- **Labels:** `Неделя 48`, `Неделя 49`, `Неделя 50`, `Неделя 51` (или актуальные номера недель)

### 4. Визуальное оформление

**Левый график:**
- Заголовок: «Новые и Закрытые тикеты»
- Цвета:
  - Новые: `chartColors.primary` (#007bff)
  - Закрытые (все): `chartColors.success` (#28a745)
  - Закрытые (созданы этой неделей): `chartColors.successLight` (#6cbd45) — пунктир
  - Закрытые (созданы другой неделей): `chartColors.warning` (#ffc107) — пунктир

**Правый график:**
- Заголовок: «Переходящие тикеты»
- Цвета:
  - Переходящие (все): `chartColors.carryover` (#ff9800)
  - Переходящие (созданы этой неделей): `chartColors.carryoverLight` (#ffb74d) — пунктир
  - Переходящие (созданы другой неделей): `chartColors.carryoverDark` (#f57c00) — пунктир

### 5. Легенды и tooltips

- **Легенда:** каждый график имеет свою легенду (внизу или справа)
- **Tooltips:** показывают информацию о неделе и значениях (как в текущей реализации)
- **Формат tooltip:** `Неделя 51 (15 дек — 21 дек)`

### 6. Настройки графиков

**Общие настройки для обоих графиков:**
- `responsive: true`
- `maintainAspectRatio: false`
- `tension: 0.3` (для плавности линий)
- `fill: false` (без заливки под линиями)
- Пунктирные линии для разбивок (`borderDash: [5, 5]`)

**Оси:**
- Ось Y: начинается с 0, целые числа (`ticks: { precision: 0 }`)
- Ось X: подписи недель с поворотом 45° (если нужно)

---

## Технические детали

### Компонент для изменения

**Файл:** `vue-app/src/components/graph-admission-closure/GraphAdmissionClosureChart.vue`

**Текущая структура:**
```vue
<template>
  <div class="ac-chart">
    <!-- ... -->
    <div class="ac-chart__body">
      <component
        :is="chartComponent"
        :data="chartData"
        :options="chartOptions"
      />
    </div>
  </div>
</template>
```

**Целевая структура:**
```vue
<template>
  <div class="ac-chart">
    <!-- ... -->
    <div class="ac-chart__body">
      <!-- Для линейного графика: два графика рядом -->
      <div v-if="chartType === 'line'" class="split-charts-container">
        <div class="chart-wrapper chart-wrapper--left">
          <h3 class="chart-subtitle">Новые и Закрытые тикеты</h3>
          <Line :data="newClosedChartData" :options="chartOptions" />
        </div>
        <div class="chart-wrapper chart-wrapper--right">
          <h3 class="chart-subtitle">Переходящие тикеты</h3>
          <Line :data="carryoverChartData" :options="chartOptions" />
        </div>
      </div>
      
      <!-- Для других типов графиков: один график (как сейчас) -->
      <component
        v-else
        :is="chartComponent"
        :data="chartData"
        :options="chartOptions"
      />
    </div>
  </div>
</template>
```

### Computed свойства

**Новые computed свойства:**

1. `newClosedChartData` — данные для левого графика (Новые и Закрытые)
2. `carryoverChartData` — данные для правого графика (Переходящие)

**Пример реализации:**

```javascript
const newClosedChartData = computed(() => {
  const weeks = props.meta?.weeks || [];
  const labels = weeks.length > 0 
    ? weeks.map(week => `Неделя ${week.weekNumber}`)
    : [props.meta?.weekNumber ? `Неделя ${props.meta.weekNumber}` : 'Неделя'];
  
  const newSeries = Array.isArray(props.data.series?.new) && props.data.series.new.length > 0
    ? props.data.series.new
    : [props.data.newTickets ?? 0];
  
  const closedSeries = Array.isArray(props.data.series?.closed) && props.data.series.closed.length > 0
    ? props.data.series.closed
    : [props.data.closedTickets ?? 0];
  
  const closedCreatedThisWeekSeries = Array.isArray(props.data.series?.closedCreatedThisWeek) && props.data.series.closedCreatedThisWeek.length > 0
    ? props.data.series.closedCreatedThisWeek
    : [props.data.closedTicketsCreatedThisWeek ?? 0];
  
  const closedCreatedOtherWeekSeries = Array.isArray(props.data.series?.closedCreatedOtherWeek) && props.data.series.closedCreatedOtherWeek.length > 0
    ? props.data.series.closedCreatedOtherWeek
    : [props.data.closedTicketsCreatedOtherWeek ?? 0];

  return {
    labels,
    datasets: [
      {
        label: 'Новые',
        data: newSeries,
        backgroundColor: chartColors.primary,
        borderColor: chartColors.primary,
        tension: 0.3,
        fill: false
      },
      {
        label: 'Закрытые (все)',
        data: closedSeries,
        backgroundColor: chartColors.success,
        borderColor: chartColors.success,
        tension: 0.3,
        fill: false
      },
      {
        label: 'Закрытые (созданы этой неделей)',
        data: closedCreatedThisWeekSeries,
        backgroundColor: chartColors.successLight,
        borderColor: chartColors.successLight,
        tension: 0.3,
        fill: false,
        borderDash: [5, 5]
      },
      {
        label: 'Закрытые (созданы другой неделей)',
        data: closedCreatedOtherWeekSeries,
        backgroundColor: chartColors.warning,
        borderColor: chartColors.warning,
        tension: 0.3,
        fill: false,
        borderDash: [5, 5]
      }
    ]
  };
});

const carryoverChartData = computed(() => {
  const weeks = props.meta?.weeks || [];
  const labels = weeks.length > 0 
    ? weeks.map(week => `Неделя ${week.weekNumber}`)
    : [props.meta?.weekNumber ? `Неделя ${props.meta.weekNumber}` : 'Неделя'];
  
  const carryoverSeries = Array.isArray(props.data.series?.carryover) && props.data.series.carryover.length > 0
    ? props.data.series.carryover
    : [props.data.carryoverTickets ?? 0];
  
  const carryoverCreatedThisWeekSeries = Array.isArray(props.data.series?.carryoverCreatedThisWeek) && props.data.series.carryoverCreatedThisWeek.length > 0
    ? props.data.series.carryoverCreatedThisWeek
    : [props.data.carryoverTicketsCreatedThisWeek ?? 0];
  
  const carryoverCreatedOtherWeekSeries = Array.isArray(props.data.series?.carryoverCreatedOtherWeek) && props.data.series.carryoverCreatedOtherWeek.length > 0
    ? props.data.series.carryoverCreatedOtherWeek
    : [props.data.carryoverTicketsCreatedOtherWeek ?? 0];

  return {
    labels,
    datasets: [
      {
        label: 'Переходящие (все)',
        data: carryoverSeries,
        backgroundColor: chartColors.carryover,
        borderColor: chartColors.carryover,
        tension: 0.3,
        fill: false
      },
      {
        label: 'Переходящие (созданы этой неделей)',
        data: carryoverCreatedThisWeekSeries,
        backgroundColor: chartColors.carryoverLight,
        borderColor: chartColors.carryoverLight,
        tension: 0.3,
        fill: false,
        borderDash: [5, 5]
      },
      {
        label: 'Переходящие (созданы другой неделей)',
        data: carryoverCreatedOtherWeekSeries,
        backgroundColor: chartColors.carryoverDark,
        borderColor: chartColors.carryoverDark,
        tension: 0.3,
        fill: false,
        borderDash: [5, 5]
      }
    ]
  };
});
```

### Стилизация

**CSS для разделённых графиков:**

```css
.split-charts-container {
  display: flex;
  gap: var(--spacing-lg, 24px);
  width: 100%;
}

.chart-wrapper {
  flex: 1;
  min-width: 0; /* Для корректной работы flex */
}

.chart-wrapper--left {
  /* Левый график */
}

.chart-wrapper--right {
  /* Правый график */
}

.chart-subtitle {
  margin: 0 0 var(--spacing-sm, 8px) 0;
  font-size: 16px;
  font-weight: 600;
  color: var(--b24-text-primary, #111827);
  text-align: center;
}

/* Адаптивность для мобильных */
@media (max-width: 768px) {
  .split-charts-container {
    flex-direction: column;
  }
  
  .chart-wrapper {
    width: 100%;
  }
}
```

---

## Этапы реализации

### Этап 1: Подготовка структуры ✅

- [x] Изучить текущую реализацию `GraphAdmissionClosureChart.vue`
- [x] Создать computed свойства `newClosedChartData` и `carryoverChartData`
- [x] Разделить данные из `lineBarData` на две части
- [x] Добавить вспомогательную функцию `getWeekLabels()`

### Этап 2: Обновление шаблона ✅

- [x] Добавить условный рендеринг для линейного графика (два графика)
- [x] Добавить контейнер `.split-charts-container`
- [x] Добавить заголовки для каждого графика
- [x] Сохранить текущую реализацию для других типов графиков (столбчатый, круговая)
- [x] Добавить обёртки `.chart-canvas-wrapper` для корректного отображения

### Этап 3: Стилизация ✅

- [x] Добавить CSS для горизонтального расположения графиков
- [x] Реализовать адаптивность (вертикальное расположение на мобильных)
- [x] Убедиться, что графики занимают равную ширину
- [x] Проверить отступы и выравнивание
- [x] Оптимизировать размеры графиков (финальная высота: 720px)
- [x] Увеличить размеры шрифтов для лучшей читаемости

### Этап 4: Тестирование ✅

- [x] Проверить отображение данных за 4 недели
- [x] Проверить работу tooltips на обоих графиках
- [x] Проверить легенды на обоих графиках
- [x] Проверить адаптивность на разных размерах экрана
- [x] Проверить работу с пустыми данными
- [x] Проверить переключение между типами графиков (линейный/столбчатый/круговая)
- [x] Исправить проблему с бесконечной прокруткой
- [x] Оптимизировать производительность и визуальное отображение

---

## Критерии приёмки

- [x] Линейный график разделён на два графика (Новые/Закрытые и Переходящие)
- [x] Оба графика расположены рядом на одном уровне (горизонтально)
- [x] Оба графика работают с данными за 4 недели
- [x] Легенды отображаются корректно для каждого графика
- [x] Tooltips работают корректно на обоих графиках
- [x] Адаптивность: на мобильных графики располагаются вертикально
- [x] Столбчатый и круговая диаграммы работают как раньше (без изменений)
- [x] Все цвета и стили соответствуют текущей реализации
- [x] Нет визуальных артефактов или перекрытий
- [x] Производительность не ухудшилась
- [x] Исправлена проблема с бесконечной прокруткой
- [x] Оптимизированы размеры графиков для лучшей видимости
- [x] Добавлен приятный прелоадер для загрузки данных графика
- [x] Добавлен аналогичный прелоадер для модуля трудозатрат (TASK-050)
- [x] Прелоадеры отображаются при первой загрузке модулей
- [x] Прелоадеры имеют плавные анимации и переходы

---

## Визуальное представление

### Детальная ASCII-схема структуры компонента

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  GraphAdmissionClosureChart.vue - Структура компонента                                        │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  Заголовок и управление (ac-chart__header)                                            │  │
│  │  ┌────────────────────────────────────────┐  ┌─────────────────────────────────────┐ │  │
│  │  │  График приёма и закрытий сектора 1С   │  │  [📈 Линейный] [📊 Столбчатый]     │ │  │
│  │  │  Неделя 51 · 15 дек — 21 дек (UTC)     │  │  [🍩 Круговая]                      │ │  │
│  │  └────────────────────────────────────────┘  └─────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  Summary-карточки (ac-chart__summary)                                                 │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐                             │  │
│  │  │  Новые   │  │ Закрытые │  │Переходящ.│  │  Стадии  │                             │  │
│  │  │   12     │  │    8     │  │   15     │  │  SUCCESS │                             │  │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘                             │  │
│  └──────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  Тело графика (ac-chart__body) - УСЛОВНЫЙ РЕНДЕРИНГ                                    │  │
│  │                                                                                        │  │
│  │  ЕСЛИ chartType === 'line':                                                           │  │
│  │  ┌────────────────────────────────────────────────────────────────────────────────┐  │  │
│  │  │  split-charts-container (display: flex, gap: 24px)                              │  │  │
│  │  │                                                                                │  │  │
│  │  │  ┌──────────────────────────────────────────┐  ┌──────────────────────────────┐│  │  │
│  │  │  │  chart-wrapper--left (flex: 1)           │  │  chart-wrapper--right (flex:1)││  │  │
│  │  │  │                                          │  │                                ││  │  │
│  │  │  │  ┌────────────────────────────────────┐ │  │  ┌──────────────────────────┐ ││  │  │
│  │  │  │  │  chart-subtitle                     │ │  │  │  chart-subtitle          │ ││  │  │
│  │  │  │  │  "Новые и Закрытые тикеты"         │ │  │  │  "Переходящие тикеты"    │ ││  │  │
│  │  │  │  └────────────────────────────────────┘ │  │  └──────────────────────────┘ ││  │  │
│  │  │  │                                          │  │                                ││  │  │
│  │  │  │  ┌────────────────────────────────────┐ │  │  ┌──────────────────────────┐ ││  │  │
│  │  │  │  │  <Line :data="newClosedChartData"> │ │  │  │  <Line :data="carryover  │ ││  │  │
│  │  │  │  │  :options="chartOptions" />        │ │  │  │   ChartData">            │ ││  │  │
│  │  │  │  │                                    │ │  │  │  :options="chartOptions" │ ││  │  │
│  │  │  │  │  График с 4 сериями:               │ │  │  │  />                      │ ││  │  │
│  │  │  │  │  • Новые (синяя)                   │ │  │  │                         │ ││  │  │
│  │  │  │  │  • Закрытые (все) (зелёная)       │ │  │  │  График с 3 сериями:     │ ││  │  │
│  │  │  │  │  • Закрытые (эта неделя) (пунктир)│ │  │  │  • Переходящие (все)      │ ││  │  │
│  │  │  │  │  • Закрытые (другая) (пунктир)    │ │  │  │    (оранжевая)           │ ││  │  │
│  │  │  │  │                                    │ │  │  │  • Переходящие (эта)      │ ││  │  │
│  │  │  │  │  Ось X: Неделя 48, 49, 50, 51     │ │  │  │    (пунктир)             │ ││  │  │
│  │  │  │  │  Ось Y: 0, 5, 10, 15, 20...       │ │  │  │  • Переходящие (другая)  │ ││  │  │
│  │  │  │  │                                    │ │  │  │    (пунктир)             │ ││  │  │
│  │  │  │  │  Легенда (внизу):                  │ │  │  │                         │ ││  │  │
│  │  │  │  │  ● Новые                           │ │  │  │  Ось X: Неделя 48, 49,   │ ││  │  │
│  │  │  │  │  ● Закрытые (все)                  │ │  │  │    50, 51                │ ││  │  │
│  │  │  │  │  ─ ─ Закрытые (эта неделя)         │ │  │  │  Ось Y: 0, 5, 10, 15, 20..│ ││  │  │
│  │  │  │  │  ─ ─ Закрытые (другая неделя)     │ │  │  │                         │ ││  │  │
│  │  │  │  └────────────────────────────────────┘ │  │  │  Легенда (внизу):          │ ││  │  │
│  │  │  │                                          │  │  │  ● Переходящие (все)       │ ││  │  │
│  │  │  └──────────────────────────────────────────┘  │  │  ─ ─ Переходящие (эта)     │ ││  │  │
│  │  │                                                 │  │  ─ ─ Переходящие (другая) │ ││  │  │
│  │  │                                                 │  │  └──────────────────────────┘ ││  │  │
│  │  │                                                 │  └──────────────────────────────┘│  │  │
│  │  └────────────────────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                                        │  │
│  │  ИНАЧЕ (chartType === 'bar' или 'doughnut'):                                          │  │
│  │  ┌────────────────────────────────────────────────────────────────────────────────┐  │  │
│  │  │  <component :is="chartComponent" :data="chartData" :options="chartOptions" />  │  │  │
│  │  │  (Текущая реализация без изменений)                                             │  │  │
│  │  └────────────────────────────────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                              │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

### Текущая реализация (один график - все серии вместе)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  Линейный график (chartType === 'line') - ТЕКУЩАЯ РЕАЛИЗАЦИЯ                                  │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  График (один компонент Line)                                                         │  │
│  │                                                                                        │  │
│  │    25 ┤                                                                                │  │
│  │    20 ┤     ●     ●                                                                    │  │
│  │    15 ┤  ●     ●     ●                                                                 │  │
│  │    10 ┤●         ●     ●                                                               │  │
│  │     5 ┤─────────────●─────                                                             │  │
│  │     0 └─────────────────────                                                          │  │
│  │        48   49   50   51                                                              │  │
│  │                                                                                        │  │
│  │  Легенда (7 серий - перегружено):                                                     │  │
│  │  ● Новые (синяя)                                                                      │  │
│  │  ● Закрытые (все) (зелёная)                                                           │  │
│  │  ─ ─ Закрытые (созданы этой неделей) (светло-зелёная, пунктир)                       │  │
│  │  ─ ─ Закрытые (созданы другой неделей) (жёлтая, пунктир)                             │  │
│  │  ● Переходящие (все) (оранжевая)                                                      │  │
│  │  ─ ─ Переходящие (созданы этой неделей) (светло-оранжевая, пунктир)                   │  │
│  │  ─ ─ Переходящие (созданы другой неделей) (тёмно-оранжевая, пунктир)                  │  │
│  │                                                                                        │  │
│  │  Проблема: Слишком много линий, сложно читать, визуальная перегруженность            │  │
│  └──────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                              │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

### Целевая реализация (два графика рядом - разделённые)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  Линейные графики (chartType === 'line') - ЦЕЛЕВАЯ РЕАЛИЗАЦИЯ                                 │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  split-charts-container (display: flex, gap: 24px, width: 100%)                        │  │
│  │                                                                                        │  │
│  │  ┌──────────────────────────────────────────────┐  ┌────────────────────────────────┐│  │
│  │  │  ЛЕВЫЙ ГРАФИК (50% ширины)                   │  │  ПРАВЫЙ ГРАФИК (50% ширины)     ││  │
│  │  │  chart-wrapper--left                         │  │  chart-wrapper--right          ││  │
│  │  ├──────────────────────────────────────────────┤  ├────────────────────────────────┤│  │
│  │  │  "Новые и Закрытые тикеты"                   │  │  "Переходящие тикеты"          ││  │
│  │  │  (chart-subtitle)                            │  │  (chart-subtitle)             ││  │
│  │  ├──────────────────────────────────────────────┤  ├────────────────────────────────┤│  │
│  │  │                                               │  │                                ││  │
│  │  │    25 ┤                                       │  │    25 ┤                        ││  │
│  │  │    20 ┤     ●                                 │  │    20 ┤     ●                   ││  │
│  │  │    15 ┤  ●     ●                             │  │    15 ┤  ●     ●                ││  │
│  │  │    10 ┤●         ●                            │  │    10 ┤●         ●               ││  │
│  │  │     5 ┤─────────────                          │  │     5 ┤─────────────             ││  │
│  │  │     0 └─────────────────                      │  │     0 └─────────────────          ││  │
│  │  │        48   49   50   51                      │  │        48   49   50   51         ││  │
│  │  │                                               │  │                                ││  │
│  │  │  Серии данных (4 линии):                      │  │  Серии данных (3 линии):       ││  │
│  │  │  ──────────────────────────                  │  │  ──────────────────────────     ││  │
│  │  │  ● Новые (синяя, сплошная)                   │  │  ● Переходящие (все)            ││  │
│  │  │     [12, 11, 12, 12]                         │  │     (оранжевая, сплошная)       ││  │
│  │  │                                               │  │     [12, 13, 14, 15]           ││  │
│  │  │  ● Закрытые (все) (зелёная, сплошная)        │  │                                ││  │
│  │  │     [6, 7, 8, 8]                             │  │  ─ ─ Переходящие (эта неделя)  ││  │
│  │  │                                               │  │     (светло-оранжевая, пунктир)││  │
│  │  │  ─ ─ Закрытые (эта неделя)                   │  │     [5, 6, 6, 7]               ││  │
│  │  │     (светло-зелёная, пунктир)                 │  │                                ││  │
│  │  │     [4, 5, 5, 5]                              │  │  ─ ─ Переходящие (другая)      ││  │
│  │  │                                               │  │     (тёмно-оранжевая, пунктир) ││  │
│  │  │  ─ ─ Закрытые (другая неделя)                │  │     [7, 7, 8, 8]               ││  │
│  │  │     (жёлтая, пунктир)                         │  │                                ││  │
│  │  │     [2, 2, 3, 3]                              │  │                                ││  │
│  │  │                                               │  │                                ││  │
│  │  │  Легенда (внизу графика):                     │  │  Легенда (внизу графика):       ││  │
│  │  │  ● Новые                                      │  │  ● Переходящие (все)            ││  │
│  │  │  ● Закрытые (все)                             │  │  ─ ─ Переходящие (эта неделя)  ││  │
│  │  │  ─ ─ Закрытые (созданы этой неделей)         │  │  ─ ─ Переходящие (другая)      ││  │
│  │  │  ─ ─ Закрытые (созданы другой неделей)       │  │                                ││  │
│  │  │                                               │  │                                ││  │
│  │  │  Tooltip при наведении:                       │  │  Tooltip при наведении:         ││  │
│  │  │  "Неделя 51 (15 дек — 21 дек)"                │  │  "Неделя 51 (15 дек — 21 дек)"  ││  │
│  │  │  Новые: 12                                    │  │  Переходящие (все): 15          ││  │
│  │  │  Закрытые (все): 8                            │  │  Переходящие (эта неделя): 7  ││  │
│  │  │  Закрытые (эта неделя): 5                      │  │  Переходящие (другая): 8      ││  │
│  │  │  Закрытые (другая неделя): 3                   │  │                                ││  │
│  │  └──────────────────────────────────────────────┘  └────────────────────────────────┘│  │
│  └──────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                              │
│  Преимущества:                                                                               │
│  ✓ Меньше визуальной перегруженности (4 линии вместо 7 в левом, 3 в правом)                │
│  ✓ Логическое разделение: приём/закрытие отдельно от переходящих                            │
│  ✓ Легче читать и анализировать данные                                                      │
│  ✓ Оба графика синхронизированы по оси X (одинаковые недели)                                │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

### Адаптивность (мобильные устройства, < 768px)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  Линейные графики - АДАПТИВНАЯ ВЕРСИЯ (мобильные устройства)                                │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                              │
│  split-charts-container (flex-direction: column)                                            │
│                                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  ВЕРХНИЙ ГРАФИК (100% ширины)                                                         │  │
│  │  chart-wrapper--left                                                                  │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────────┐    │  │
│  │  │  "Новые и Закрытые тикеты"                                                    │    │  │
│  │  ├──────────────────────────────────────────────────────────────────────────────┤    │  │
│  │  │                                                                               │    │  │
│  │  │    25 ┤                                                                       │    │  │
│  │  │    20 ┤     ●                                                                 │    │  │
│  │  │    15 ┤  ●     ●                                                              │    │  │
│  │  │    10 ┤●         ●                                                             │    │  │
│  │  │     5 ┤─────────────                                                           │    │  │
│  │  │     0 └─────────────────                                                      │    │  │
│  │  │        48   49   50   51                                                      │    │  │
│  │  │                                                                               │    │  │
│  │  │  Легенда:                                                                     │    │  │
│  │  │  ● Новые  ● Закрытые (все)                                                    │    │  │
│  │  │  ─ ─ Закрытые (эта)  ─ ─ Закрытые (другая)                                   │    │  │
│  │  └──────────────────────────────────────────────────────────────────────────────┘    │  │
│  └──────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │
│  │  НИЖНИЙ ГРАФИК (100% ширины)                                                          │  │
│  │  chart-wrapper--right                                                                 │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────────┐    │  │
│  │  │  "Переходящие тикеты"                                                        │    │  │
│  │  ├──────────────────────────────────────────────────────────────────────────────┤    │  │
│  │  │                                                                               │    │  │
│  │  │    25 ┤                                                                       │    │  │
│  │  │    20 ┤     ●                                                                 │    │  │
│  │  │    15 ┤  ●     ●                                                              │    │  │
│  │  │    10 ┤●         ●                                                             │    │  │
│  │  │     5 ┤─────────────                                                           │    │  │
│  │  │     0 └─────────────────                                                      │    │  │
│  │  │        48   49   50   51                                                      │    │  │
│  │  │                                                                               │    │  │
│  │  │  Легенда:                                                                     │    │  │
│  │  │  ● Переходящие (все)                                                          │    │  │
│  │  │  ─ ─ Переходящие (эта)  ─ ─ Переходящие (другая)                             │    │  │
│  │  └──────────────────────────────────────────────────────────────────────────────┘    │  │
│  └──────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                              │
│  Особенности мобильной версии:                                                               │
│  • Графики располагаются вертикально (один под другим)                                     │
│  • Каждый график занимает 100% ширины экрана                                                 │
│  • Отступ между графиками: 24px (gap)                                                       │
│  • Легенды могут быть компактнее (горизонтальное расположение)                             │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

### Сравнение: до и после

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  СРАВНЕНИЕ: ДО И ПОСЛЕ                                                                       │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                              │
│  ┌──────────────────────────────────────┐  ┌──────────────────────────────────────────────┐ │
│  │  ДО (текущая реализация)              │  │  ПОСЛЕ (целевая реализация)                  │ │
│  ├──────────────────────────────────────┤  ├──────────────────────────────────────────────┤ │
│  │                                      │  │                                              │ │
│  │  Один график с 7 сериями:            │  │  Два графика рядом:                          │ │
│  │                                      │  │                                              │ │
│  │  ┌────────────────────────────┐      │  │  ┌──────────────┐  ┌──────────────┐        │ │
│  │  │  Все серии вместе          │      │  │  │ Новые/Закрытые│  │ Переходящие │        │ │
│  │  │                            │      │  │  │              │  │              │        │ │
│  │  │  20 ┤     ●                │      │  │  │  20 ┤     ●   │  │  20 ┤     ●   │        │ │
│  │  │  15 ┤  ●     ●             │      │  │  │  15 ┤  ●     ●│  │  15 ┤  ●     ●│        │ │
│  │  │  10 ┤●         ●           │      │  │  │  10 ┤●         ●│  │  10 ┤●         ●│    │ │
│  │  │   5 ┤─────────────         │      │  │  │   5 ┤──────────│  │   5 ┤──────────│    │ │
│  │  │   0 └─────────────────     │      │  │  │   0 └──────────│  │   0 └──────────│    │ │
│  │  │     48  49  50  51         │      │  │  │     48 49 50 51│  │     48 49 50 51│    │ │
│  │  └────────────────────────────┘      │  │  └──────────────┘  └──────────────┘        │ │
│  │                                      │  │                                              │ │
│  │  Проблемы:                           │  │  Преимущества:                               │ │
│  │  ✗ Слишком много линий (7)           │  │  ✓ Меньше линий (4+3)                        │ │
│  │  ✗ Визуальная перегруженность        │  │  ✓ Логическое разделение                      │ │
│  │  ✗ Сложно читать                     │  │  ✓ Легче анализировать                        │ │
│  │  ✗ Легенда слишком длинная            │  │  ✓ Компактные легенды                        │ │
│  │                                      │  │  ✓ Лучшая читаемость                         │ │
│  └──────────────────────────────────────┘  └──────────────────────────────────────────────┘ │
│                                                                                              │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Зависимости

- **TASK-041:** График приёма и закрытий сектора 1С (базовый модуль)
- **TASK-048:** Линейный график за 4 недели (текущая реализация)
- **TASK-047:** Разбивка закрытых и переходящих тикетов (данные для разбивок)

---

## Итоги реализации

### Выполненные задачи

✅ **Разделение графика на две части:**
- Созданы два отдельных графика для линейного типа отображения
- Левый график: "Новые и Закрытые тикеты" (4 серии данных)
- Правый график: "Переходящие тикеты" (3 серии данных)
- Оба графика работают с данными за 4 недели

✅ **Техническая реализация:**
- Созданы computed свойства `newClosedChartData` и `carryoverChartData` для разделения данных
- Добавлена вспомогательная функция `getWeekLabels()` для получения меток недель
- Обновлён шаблон с условным рендерингом: два графика для линейного типа, один график для других типов
- Сохранена обратная совместимость: столбчатый и круговая диаграммы работают без изменений

✅ **Визуальное оформление:**
- Горизонтальное расположение графиков рядом друг с другом (50% ширины каждый)
- Фиксированная высота графиков: 720px на десктопе, 480px на мобильных
- Увеличенные размеры шрифтов для лучшей читаемости:
  - Заголовки графиков: 20px
  - Легенда: 15px
  - Подписи осей: 14px
- Улучшенные отступы и spacing между элементами

✅ **Адаптивность:**
- На мобильных устройствах (< 768px) графики располагаются вертикально (один под другим)
- Каждый график занимает 100% ширины на мобильных
- Оптимизированные размеры для мобильных устройств

✅ **Исправления и оптимизации:**
- Исправлена проблема с бесконечной прокруткой (добавлена фиксированная высота контейнеров)
- Добавлен `resizeDelay: 0` в опции графика для предотвращения проблем с прокруткой
- Оптимизированы размеры графиков (финальная высота: 720px после нескольких итераций)
- Улучшена структура CSS с использованием flexbox для корректного расположения

✅ **Прелоадер для загрузки данных:**
- Создан приятный прелоадер для модуля "График приёма и закрытий сектора 1С"
- Три концентрических кольца с плавной анимацией (синий, зелёный, оранжевый)
- Информативные сообщения: "Загрузка графика" и "Получение данных за 4 недели..."
- Три пульсирующие точки для визуальной обратной связи
- Минимальная задержка 300ms для гарантированной видимости прелоадера
- Плавные переходы с использованием Vue Transition
- Адаптивный дизайн для мобильных устройств
- Также добавлен аналогичный прелоадер для модуля "Трудозатраты на Тикеты сектора 1С" (TASK-050)

✅ **Прелоадеры для модулей:**
- **График приёма и закрытий:** `vue-app/src/components/graph-admission-closure/GraphAdmissionClosureDashboard.vue`
- **Трудозатраты на Тикеты:** `vue-app/src/components/tickets-time-tracking/TicketsTimeTrackingDashboard.vue`
- Единый стиль прелоадеров для обоих модулей
- Использование Vue Transition для плавных переходов
- Минимальная задержка 300ms для гарантированной видимости

### Технические детали

**Файлы:**
- **График:** `vue-app/src/components/graph-admission-closure/GraphAdmissionClosureChart.vue`
- **Прелоадер графика:** `vue-app/src/components/graph-admission-closure/GraphAdmissionClosureDashboard.vue`
- **Прелоадер трудозатрат:** `vue-app/src/components/tickets-time-tracking/TicketsTimeTrackingDashboard.vue`

**Основные изменения:**
1. **Computed свойства:**
   - `newClosedChartData` — данные для левого графика (Новые и Закрытые)
   - `carryoverChartData` — данные для правого графика (Переходящие)
   - `getWeekLabels()` — вспомогательная функция для меток недель

2. **Шаблон:**
   - Условный рендеринг: `v-if="chartType === 'line'"` для двух графиков
   - Контейнер `.split-charts-container` с flexbox-расположением
   - Обёртки `.chart-wrapper` и `.chart-canvas-wrapper` для каждого графика

3. **Стили:**
   - `.split-charts-container` — flex-контейнер с gap 32px
   - `.chart-canvas-wrapper` — фиксированная высота 720px
   - Адаптивные стили для мобильных устройств

4. **Опции графика:**
   - Увеличенные размеры шрифтов для легенды и осей
   - Улучшенные отступы и padding
   - Сохранены все существующие настройки tooltip и взаимодействий

5. **Прелоадеры:**
   - Компонент прелоадера в `GraphAdmissionClosureDashboard.vue`
   - Компонент прелоадера в `TicketsTimeTrackingDashboard.vue`
   - Единый стиль с тремя концентрическими кольцами (синий, зелёный, оранжевый)
   - Пульсирующие точки для визуальной обратной связи
   - Минимальная задержка 300ms через `Promise.all` для гарантированной видимости
   - Vue Transition для плавных переходов между состояниями
   - Адаптивный дизайн для мобильных устройств

### Результат

**Графики:**
- Меньше визуальной перегруженности (4 линии вместо 7 в левом, 3 в правом)
- Логическое разделение: приём/закрытие отдельно от переходящих
- Улучшенная читаемость благодаря увеличенным размерам и отступам
- Корректная работа на всех устройствах (десктоп и мобильные)

**Прелоадеры:**
- Приятный визуальный опыт при загрузке данных
- Информативные сообщения о процессе загрузки
- Плавные анимации и переходы
- Единый стиль для обоих модулей (график приёма/закрытий и трудозатраты)
- Гарантированная видимость прелоадера (минимум 300ms)

---

## История правок

- **2025-12-17 14:36 (UTC+3, Брест):** Создан черновик задачи TASK-052
  - Описана цель разделения линейного графика на две части
  - Зафиксированы требования к реализации
  - Добавлены примеры кода и визуальное представление
  - Определены этапы реализации и критерии приёмки

- **2025-12-17 14:40 (UTC+3, Брест):** Добавлена детальная ASCII-схема
  - Добавлена схема структуры компонента с детализацией элементов
  - Добавлена схема текущей реализации (один график)
  - Добавлена детальная схема целевой реализации (два графика)
  - Добавлена схема адаптивности для мобильных устройств
  - Добавлена схема сравнения "до и после"
  - Все схемы включают детализацию серий данных, легенд, tooltips и структуры компонента

- **2025-12-17 16:00 (UTC+3, Брест):** Реализация завершена
  - Созданы computed свойства `newClosedChartData` и `carryoverChartData` для разделения данных
  - Обновлён шаблон для условного рендеринга двух графиков (только для линейного типа)
  - Добавлены CSS стили для горизонтального расположения графиков
  - Реализована адаптивность (вертикальное расположение на мобильных устройствах)
  - Столбчатый и круговая диаграммы работают без изменений (обратная совместимость)

- **2025-12-17 17:00 (UTC+3, Брест):** Исправления и оптимизации
  - Исправлена проблема с бесконечной прокруткой (добавлена фиксированная высота контейнеров)
  - Добавлен `resizeDelay: 0` в опции графика для предотвращения проблем с прокруткой
  - Добавлены обёртки `.chart-canvas-wrapper` для корректного отображения графиков
  - Оптимизирована структура CSS с использованием flexbox

- **2025-12-17 17:30 (UTC+3, Брест):** Увеличение масштаба графиков
  - Увеличена высота графиков до 900px для лучшей видимости
  - Увеличены размеры шрифтов (заголовки, легенда, подписи осей)
  - Улучшены отступы и spacing между элементами
  - Добавлены более заметные линии сетки

- **2025-12-17 18:00 (UTC+3, Брест):** Финальная оптимизация размеров
  - Уменьшены размеры графиков на 20% от максимальных значений (финальная высота: 720px)
  - Оптимизированы размеры шрифтов для баланса между читаемостью и компактностью
  - Финальные размеры: 720px высота на десктопе, 480px на мобильных
  - Задача успешно завершена и готова к использованию

- **2025-12-17 19:00 (UTC+3, Брест):** Добавлен приятный прелоадер для загрузки данных
  - Создан прелоадер с тремя концентрическими кольцами и плавными анимациями
  - Добавлен для модуля "График приёма и закрытий сектора 1С"
  - Добавлен аналогичный прелоадер для модуля "Трудозатраты на Тикеты сектора 1С" (TASK-050)
  - Реализована минимальная задержка 300ms для гарантированной видимости
  - Использованы Vue Transition для плавных переходов
  - Полная адаптивность для мобильных устройств
  - Исправлена структура условий в TicketsTimeTrackingDashboard (v-else-if внутри Transition)

---

## Примечания

- **Обратная совместимость:** Столбчатый и круговая диаграммы должны работать без изменений
- **Производительность:** Разделение на два графика не должно ухудшить производительность
- **Данные:** Используются те же данные из API, только разделяются на два графика
- **Адаптивность:** Критически важно обеспечить корректное отображение на мобильных устройствах
- **Прелоадеры:** Единый стиль прелоадеров для модулей графика приёма/закрытий и трудозатрат обеспечивает консистентный UX

### Решение проблем с данными трудозатрат (TASK-050)

При разработке модуля "Трудозатраты на Тикеты сектора 1С" были решены следующие проблемы:

1. **Проблема с API Bitrix24:**
   - Методы `tasks.elapseditem.*` не существуют в версии Bitrix24
   - **Решение:** Использован альтернативный подход через `tasks.task.list` с полем `timeSpentInLogs`
   - Подробности: [Решение проблем API для TASK-050](../TROUBLESHOOTING/task-050-api-solution.md)

2. **Отсутствие данных:**
   - Проблемы с фильтрацией и получением данных о трудозатратах
   - **Решение:** Отладка запросов, проверка фильтров и структуры данных
   - Подробности: [Отладка отсутствия данных TASK-050](../TROUBLESHOOTING/task-050-no-data-debugging.md)

3. **Прелоадер для модуля трудозатрат:**
   - Заменён простой текст "Загрузка данных о трудозатратах..." на приятный прелоадер
   - Использован единый стиль с прелоадером графика приёма/закрытий
   - Исправлена структура условий (v-else-if внутри Transition) для корректной компиляции

---

## Связанные документы

### Основные задачи
- [TASK-041: График приёма и закрытий сектора 1С](./TASK-041-graph-1c-admission-closure.md)
- [TASK-048: Линейный график за 4 недели](./TASK-048-line-chart-4-weeks-no-popups.md)
- [TASK-047: Разбивка закрытых и переходящих тикетов](./TASK-047-closed-carryover-breakdown.md)
- [Гайдлайн модуля](../GUIDES/module-graph-admission-closure-guide.md)

### Модуль трудозатрат (TASK-050)
- [TASK-050: Трудозатраты на Тикеты сектора 1С](./TASK-050-tickets-time-tracking-sector-1c.md) — основной документ задачи
- [TASK-050-01: Анализ и изучение документации Bitrix24](./TASK-050-01-analysis-and-documentation.md)
- [TASK-050-02: Backend API endpoint для получения трудозатрат](./TASK-050-02-backend-api-endpoint.md)
- [TASK-050-03: Frontend структура компонентов и сервисов](./TASK-050-03-frontend-structure-services.md)
- [TASK-050-04: Frontend таблица трудозатрат](./TASK-050-04-frontend-table.md)
- [TASK-050-05: Frontend summary-карточки](./TASK-050-05-frontend-summary-cards.md)
- [TASK-050-07: Frontend попап детализации](./TASK-050-07-frontend-detail-modal.md)
- [TASK-050-08: Frontend интеграция с дашбордом и навигация](./TASK-050-08-frontend-integration-navigation.md)
- [TASK-050-09: Тестирование и финализация](./TASK-050-09-testing-finalization.md)

### Отладка и решение проблем
- [Решение проблем API для TASK-050](../TROUBLESHOOTING/task-050-api-solution.md) — как решали проблемы с API
- [Отладка отсутствия данных TASK-050](../TROUBLESHOOTING/task-050-no-data-debugging.md) — поиск и решение проблем с данными

