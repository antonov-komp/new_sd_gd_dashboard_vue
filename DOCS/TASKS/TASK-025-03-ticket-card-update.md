# TASK-025-03: Этап 3 — Обновление TicketCard.vue под новый конфиг приоритетов

**Дата создания:** 2025-12-11 14:47 (UTC+3, Брест)  
**Статус:** Новая  
**Приоритет:** Высокий  
**Исполнитель:** Bitrix24 Программист (Vue.js)  
**Родительская задача:** TASK-025  

## Цель этапа

Перевести компонент карточки тикета (`TicketCard.vue`) на использование нового формата приоритетов из `priority-config.js` (id/label/цвета), обеспечить корректное визуальное отображение всех приоритетов `UF_CRM_7_UF_PRIORITY`, добавить обработку неизвестных/пустых значений, сохранить совместимость с существующим функционалом.

## Контекст

- Этап 25-01 создал конфиг приоритетов (`priority-config.js`).
- Этап 25-02 обновит маппер, чтобы возвращать `priorityId/priorityLabel/priorityColors` (и, при необходимости, legacy `priority`).
- Текущий UI использует классы `priority-high/medium/low` с жёстко заданными цветами. Теперь нужно динамически брать цвета из конфига и показывать корректные метки.

---

## Область работ этапа

1) Обновить пропсы/данные компонента под новый формат приоритета.  
2) Отрисовывать метку приоритета из `priorityLabel` и применять динамические цвета из конфига.  
3) Добавить fallback для неизвестных/пустых значений (текст «Не указано», нейтральные цвета).  
4) Обновить стили: уйти от жёстких классов `priority-high/medium/low`, перейти на CSS-переменные или inline-стили.  
5) Проверить совместимость с drag & drop и существующими обработчиками.  
6) Обновить JSDoc, примеры и текущее описание компонента.

---

## Детальный план (шаги)

### Шаг 1. Анализ текущего компонента
- Файл: `vue-app/src/components/dashboard/TicketCard.vue`.
- Найти места:
  - Шаблон: вывод приоритета (`ticket.priority`), классы `priority-${ticket.priority}`.
  - Функция `getPriorityLabel` — сейчас возвращает статические label для high/medium/low.
  - Стили: классы `.priority-high/.priority-medium/.priority-low`, цвета и бордер.

### Шаг 2. Обновление модели данных
- Ожидаемый формат от маппера после этапа 25-02:
  - `ticket.priorityId`
  - `ticket.priorityLabel`
  - `ticket.priorityColors` `{ color, backgroundColor, textColor }`
  - (Опционально) `ticket.priority` как legacy id — оставить поддерживающим.
- Обновить пропсы/внутренние вычисления: использовать `priorityId/priorityLabel/priorityColors`.

### Шаг 3. Обновление отображения приоритета
- В шаблоне заменить вывод чипа:
  - Текст: `ticket.priorityLabel || 'Не указано'`.
  - Цвета: через inline-style или CSS vars:
    ```vue
    :style="{
      color: ticket.priorityColors?.textColor,
      backgroundColor: ticket.priorityColors?.backgroundColor,
      borderColor: ticket.priorityColors?.color
    }"
    ```
- Сохранить fallback: если цветов нет — использовать нейтральный серый.
- При необходимости добавить tooltip с `priorityId` или `bitrixValue` (опц.).

### Шаг 4. Обновление стилей
- Удалить/минимизировать жёсткие классы `priority-high/medium/low`.
- Перейти на единый класс чипа, цвета через CSS-переменные или inline-style.
- Обновить border слева карточки:  
  - Ранее `border-left-color` зависел от класса.  
  - Теперь задавать через `style` из `priorityColors.color` (fallback: #ddd).

### Шаг 5. Обработка неизвестных/пустых приоритетов
- Если `priorityId` отсутствует или `priorityLabel` пуст:
  - Текст: «Не указано».  
  - Цвета: нейтральные (`#adb5bd` фон, `#6c757d` текст, border #ced4da).  
- Не бросать ошибок, не ломать рендер.

### Шаг 6. Совместимость и минимальные правки логики
- События `click`, `drag-start`, `drag-end` оставить без изменений.  
- Проп `ticket` остаётся обязательным; структура расширена, но не ломает старые поля.  
- Проверить, что `draggable` и dnd-данные не зависят от старого поля `priority`.

### Шаг 7. Документация и описания
- Обновить JSDoc в `TicketCard.vue`:
  - Описать новые поля `priorityId`, `priorityLabel`, `priorityColors`.  
  - Ссылка на `priority-config.js` и Bitrix24 REST `crm.item.list`: https://context7.com/bitrix24/rest/crm.item.list
- Добавить короткий блок комментариев в шаблоне/скрипте для будущих разработчиков (указать источник данных).

### Шаг 8. Чек-лист визуальной проверки
- Все 7 приоритетов отобразить на тестовых данных — убедиться в корректности цветов/подписей.  
- Пустой/неизвестный приоритет → «Не указано» и нейтральные цвета.  
- Hover/drag стили не конфликтуют с inline-цветами.  
- Контраст текста достаточен (проверить на светлом фоне).

---

## Артефакты этапа

- Обновлён `vue-app/src/components/dashboard/TicketCard.vue`:
  - Шаблон: новый вывод чипа приоритета.
  - Скрипт: получение label/цветов из `ticket.priority*`.
  - Стили: динамические цвета, нейтральный fallback.
- Обновлён JSDoc и комментарии в компоненте.

---

## Критерии приёмки этапа

- [ ] Компонент берёт данные приоритета из `ticket.priorityId/priorityLabel/priorityColors`.  
- [ ] Чип приоритета отображает корректный текст и цвета для всех 7 приоритетов.  
- [ ] Пустые/неизвестные значения показываются как «Не указано» с нейтральными цветами.  
- [ ] Левый бордер карточки окрашен в цвет приоритета (или нейтральный, если неизвестен).  
- [ ] Убраны жёсткие классы high/medium/low, используется динамическая стилизация.  
- [ ] JSDoc/комментарии обновлены, ссылка на Bitrix24 REST добавлена.  
- [ ] DnD/клики/остальной функционал не пострадали (регрессии нет).

---

## Риски и допущения

- Возможна потребность подправить цвета после UX-ревью (этап 25-04/05).  
- Если какие-то компоненты всё ещё ждут `priority` в старом виде, их нужно будет обновить позже (этап 25-05).

---

## Следующие шаги после этапа

- Этап 25-04: унификация обработки неизвестных значений в UI (общий fallback/логирование).  
- Этап 25-05: регрессионное тестирование всех компонентов и обновление документации.  

