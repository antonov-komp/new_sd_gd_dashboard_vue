# TASK-041-04: Графики с недельной агрегацией для модуля «График приёма и закрытий сектора 1С»

**Дата создания:** 2025-12-15 12:37 (UTC+0300, Brest)  
**Дата завершения:** 2025-12-15 18:00 (UTC+0300, Brest)  
**Статус:** ✅ Завершено  
**Приоритет:** Высокий  
**Исполнитель:** Bitrix24 Программист (Vue.js Developer)  
**Связь с задачей:** Шаг 4 из TASK-041

## Цель этапа
Интегрировать данные недельной агрегации в линейный, столбчатый и круговой графики нового модуля, с сохранением визуального стиля модуля «График состояния сектора 1С» и без селектора этапов. Обеспечить корректные легенды/тултипы и устойчивость при пустых данных.

## Контекст
- Бэкенд возвращает агрегаты за неделю в UTC: `series.new[]`, `series.closed[]`, `stages[]`, `newTickets`, `closedTickets`.  
- Неделя: ISO-8601 (пн–вс), вычисляется на бэкенде; даты уже нормализованы к UTC.  
- Селектор этапов отсутствует; все стадии отображаются сразу.  
- Круговая диаграмма: «Новые» vs «Закрытые».

## Задачи этапа
1) Линейный график (неделя)  
   - Отобразить одну точку на неделю для `new` и `closed`.  
   - Сохранить цвета/лейблы как в текущем модуле, без селектора этапов.  
   - Тултипы: показывать значения new/closed и номер недели (из meta.weekNumber).

2) Столбчатый график (неделя)  
   - Отобразить одну колонку на неделю для new/closed.  
   - Цвета/легенды — как в текущем модуле; убрать зависимость от селектора этапов.  
   - Подписи/оси: неделя (номер), значения — суммы за неделю.

3) Круговая диаграмма  
   - Две категории: «Новые» (newTickets) и «Закрытые» (closedTickets).  
   - Цвета — согласовать с текущей палитрой (например, новые — основной, закрытые — акцент).  
   - Легенда/тултипы отображают абсолютные значения.

4) Легенды, тултипы, пустые состояния  
   - Убедиться, что легенды не зависят от селектора; отображают две серии (new/closed).  
   - Пустые данные: показывать нули/плейсхолдер, графики не ломаются.  
   - Проверить корректность форматирования дат/номера недели в тултипах.

5) Согласование цветов и стадий  
   - При наличии цветовой кодировки стадий в `stages[]` (закрывающие стадии) убедиться, что она не конфликтует с основной палитрой new/closed.  
   - При необходимости оставить цвета стадий только для распределения закрытых (если используется в легендах/подсказках), без селектора.

## Ожидаемые результаты этапа
- Линейный и столбчатый графики работают на агрегатах недели (new/closed), одна точка/колонка.  
- Круговая диаграмма показывает новые vs закрытые за неделю.  
- Легенды/тултипы корректны без селектора этапов; даты/неделя отображаются корректно.  
- Пустые состояния обрабатываются (нет данных — нули, без ошибок).

## Критерии приёмки этапа
- Графики отображаются с недельной агрегацией (new/closed) и без селектора этапов.  
- Цвета/легенды/тултипы согласованы и не зависят от выбора этапов.  
- Круговая диаграмма содержит две категории: Новые и Закрытые.  
- Пустые состояния не ломают UI; числа и подписи показываются корректно.  

## Дополнительные уточнения
- Использовать `meta.weekNumber` и границы недели в тултипах/подписях (например, «Неделя 51 (15–21 Dec)»), форматировать даты в UTC.  
- При отсутствии данных — подставлять 0 в series.new/series.closed, чтобы библиотека графиков не падала.  
- Цвета: сохранить соответствие действующим сериям (new = основной цвет, closed = акцент/вторичный), синхронизировать с легендой.  
- Если stages-данные используются для подсказок, отображать их как доп. инфо, но не вводить новый селектор.  
- Проверить адаптивность: подписи осей/легенд не должны обрезаться при одной точке.

