# TASK-041-07: Тестирование и валидация для модуля «График приёма и закрытий сектора 1С»

**Дата создания:** 2025-12-15 12:41 (UTC+0300, Brest)  
**Дата завершения:** 2025-12-15 18:00 (UTC+0300, Brest)  
**Статус:** ✅ Завершено  
**Приоритет:** Высокий  
**Исполнитель:** Bitrix24 Программист (Vue.js Developer)  
**Связь с задачей:** Шаг 7 из TASK-041

## Цель этапа
Проверить корректность данных, отображения графиков и попапа, отсутствие регрессий после удаления селектора этапов, а также устойчивость к пустым данным и edge-кейсам. Подтвердить соответствие контракту бэкенда и требованиям UTC/недельной агрегации.

## Контекст
- Модуль «График приёма и закрытий сектора 1С» (TASK-041).  
-,weekStartUtc/weekEndUtc и weekNumber рассчитываются на бэкенде (UTC, ISO-8601).  
- Данные агрегируются за неделю: `newTickets`, `closedTickets`, `series.new[]/closed[]`, `stages[]`, `responsible[]`.  
- Селектор этапов удалён; попап 1-го уровня — изолированный.

## Задачи этапа
1) Данные и контракт  
   - Проверить, что ответы бэкенда соответствуют ожидаемой схеме (meta + data + series + stages + responsible), даты в UTC.  
   - Сверить по логам `logs/` наличие полей (`createdTime`, `movedTime`, `stageId`, `UF_CRM_7_TYPE_PRODUCT`, `assignedById`) и корректность фильтра по продукту 1С.

2) Графики  
   - Линейный/бар: агрегаты за неделю (одна точка/колонка). Проверить значения для кейсов: нет новых, нет закрытых, один тип закрытия, смешанные данные.  
   - Круговая: Новые vs Закрытые. Проверить отображение нулей и нормальных данных.

3) Попап 1-го уровня (ответственные)  
   - Проверить открытие/закрытие, передачу `responsible[]`.  
   - Проверить поведение при пустом списке, только keeper/без ответственного, нормальных данных.  
   - Проверить сортировку и отображение count/имён; локализацию.

4) Фильтры и навигация  
   - Изменение фильтров должно обновлять графики/попап без ошибок.  
   - Роутинг/пункт меню должен работать; доступы — как у базового модуля.

5) Загрузки/ошибки/пустые состояния  
   - Проверить отображение состояний загрузки и ошибок (API недоступно, пустой ответ).  
   - Убедиться, что UI не ломается при нулевых/пустых данных.

## Ожидаемые результаты этапа
- Подтверждена корректность API-ответов (UTC, структура, фильтр на 1С, закрывающие стадии).  
- Графики корректно отражают агрегаты недели, пустые кейсы отображаются как нули/плейсхолдеры.  
- Попап 1-го уровня работает с ответственными, обрабатывает пустые/keeper кейсы.  
- Фильтры/навигация/доступы работают без регрессий.  
- Ошибки/загрузка отображаются корректно, UI устойчив.

## Критерии приёмки этапа
- Пройден чек по контракту бэкенда и полям из логов.  
- Линейный/бар/круговая диаграммы отображают данные корректно во всех тест-кейсах.  
- Попап 1-го уровня корректно показывает ответственных и пустые состояния.  
- Фильтры и роутинг работают, доступы сохранены.  
- UI устойчив к ошибкам и пустым данным; нет регрессий.  

## Дополнительные уточнения
- Тесты по времени: проверить, что неделя считается по UTC (пн–вс) и данные с разными смещениями (`+02:00`, `+03:00`) попадают в нужные границы после нормализации.  
- Проверить контракт на примере реального лога `logs/YYYY-MM-DD/HH/*log.json` (наличие полей createdTime/movedTime/stageId/product/assigned).  
- Нагрузочные кейсы: отсутствие new/closed, только один тип закрытия, большое число ответственных.  
- UI: проверить легенды/тултипы после удаления селектора этапов; попап открыть на всех типах точек/серий, где он ожидается.  
- Ошибки: эмулировать недоступный API/пустой ответ; убедиться, что отображается сообщение и UI не ломается.

