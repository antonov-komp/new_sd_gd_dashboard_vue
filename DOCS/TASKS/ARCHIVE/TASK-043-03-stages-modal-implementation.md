# TASK-043-03: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ø–∞–ø–∞ ¬´–ü–æ —Å—Ç–∞–¥–∏—è–º¬ª –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-16 13:28 (UTC+3, –ë—Ä–µ—Å—Ç)  
**–°—Ç–∞—Ç—É—Å:** –ù–æ–≤–∞—è  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** Bitrix24 –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç (Vue.js Developer)  
**–°–≤—è–∑—å —Å –∑–∞–¥–∞—á–µ–π:** –≠—Ç–∞–ø 3 –∏–∑ TASK-043

## –¶–µ–ª—å —ç—Ç–∞–ø–∞
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ø–∞–ø `StagesModal.vue`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Å—Ç–∞–¥–∏—è–º, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 2 –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç–∞–¥–∏–∏.

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
- **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ù–µ—Ç –ø–æ–ø–∞–ø–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —Å—Ç–∞–¥–∏—è–º
- **–¢—Ä–µ–±—É–µ—Ç—Å—è:** –°–æ–∑–¥–∞—Ç—å –ø–æ–ø–∞–ø `StagesModal.vue` —Å –¥–≤—É–º—è —É—Ä–æ–≤–Ω—è–º–∏:
  - –£—Ä–æ–≤–µ–Ω—å 1: –°–ø–∏—Å–æ–∫ —Å—Ç–∞–¥–∏–π —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–∏–∫–µ—Ç–æ–≤
  - –£—Ä–æ–≤–µ–Ω—å 2: –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 
  - TASK-043-01: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–ª–∏–∫–æ–≤ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)
  - TASK-043-02: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ API –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —Å—Ç–∞–¥–∏—è–º (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)

## –ó–∞–¥–∞—á–∏ —ç—Ç–∞–ø–∞

### 1) –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ StagesModal
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `vue-app/src/components/graph-admission-closure/StagesModal.vue`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –¥–≤—É–º—è —É—Ä–æ–≤–Ω—è–º–∏ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `ResponsibleModal.vue`)
- –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è: `popupLevel`, `selectedStage`, `tickets`, `isLoadingTickets`

### 2) –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è 1: –°–ø–∏—Å–æ–∫ —Å—Ç–∞–¥–∏–π
- –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑ 6 —Å—Ç–∞–¥–∏–π —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–∏–∫–µ—Ç–æ–≤
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `ResponsibleModal` (—Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤)
- –î–æ–±–∞–≤–∏—Ç—å —Ü–≤–µ—Ç–Ω—É—é –ª–µ–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–∞–¥–∏–∏
- –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–µ–ª–∫—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö —Å—Ç–∞–¥–∏–π

### 3) –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è 2: –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Ç–∞–¥–∏—é –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 2
- –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ç–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏ –∏–∑ API (–ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
- –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ç–∏–∫–µ—Ç—ã —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `TicketCard`
- –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É ¬´–ù–∞–∑–∞–¥¬ª –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 1

### 4) –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API
- –†–∞—Å—à–∏—Ä–∏—Ç—å `admissionClosureService.js` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `includeNewTicketsByStages`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è: –∑–∞–≥—Ä—É–∑–∫–∞, –æ—à–∏–±–∫–∞, –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### 5) –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ TicketCard
- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `TicketCard` –∏–∑ `@/components/dashboard/TicketCard.vue`
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–∏–∫–µ—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–ª–∏–∫–∞ –Ω–∞ —Ç–∏–∫–µ—Ç (–æ—Ç–∫—Ä—ã—Ç–∏–µ –≤ Bitrix24)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

**–§–∞–π–ª:** `vue-app/src/components/graph-admission-closure/StagesModal.vue`

```vue
<template>
  <div v-if="isVisible" class="modal-backdrop">
    <div class="modal">
      <Transition name="level" mode="out-in">
        <!-- –£—Ä–æ–≤–µ–Ω—å 1: –°–ø–∏—Å–æ–∫ —Å—Ç–∞–¥–∏–π -->
        <div v-if="popupLevel === 1" key="level-1" class="level-1">
          <header class="modal__header">
            <h3 class="modal__title">–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ç–∞–¥–∏—è–º</h3>
            <button class="modal__close" @click="$emit('close')">‚úï</button>
          </header>
          
          <section class="modal__body">
            <Transition name="loading" mode="out-in">
              <div v-if="isLoadingStages" key="loading" class="loading-state">
                <div class="loading-spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–π...</p>
              </div>
              
              <p v-else-if="!hasData" key="empty" class="modal__empty">
                –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é
              </p>
              
              <ul v-else key="list" class="stages-list">
                <li
                  v-for="stage in stages"
                  :key="stage.stageId"
                  class="stages-list__item"
                  :class="{ 'stages-list__item--clickable': stage.count > 0 }"
                  @click="(e) => handleStageClick(stage, e)"
                  title="–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏"
                >
                  <span class="stages-list__color" :style="{ backgroundColor: stage.color }"></span>
                  <span class="stages-list__name">{{ stage.stageName }}</span>
                  <span class="stages-list__count">
                    {{ stage.count }} —Ç–∏–∫–µ—Ç–æ–≤
                  </span>
                  <span v-if="stage.count > 0" class="stages-list__arrow">‚Üí</span>
                </li>
              </ul>
            </Transition>
          </section>
        </div>
        
        <!-- –£—Ä–æ–≤–µ–Ω—å 2: –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏ -->
        <div v-else-if="popupLevel === 2" key="level-2" class="level-2">
          <header class="modal__header">
            <button class="btn-back" @click="goBack">‚Üê –ù–∞–∑–∞–¥</button>
            <h3 class="modal__title">
              –¢–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏: {{ selectedStage?.stageName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' }}
            </h3>
            <button class="modal__close" @click="$emit('close')">‚úï</button>
          </header>
          
          <section class="modal__body">
            <Transition name="loading" mode="out-in">
              <div v-if="isLoadingTickets" key="loading" class="loading-state">
                <div class="loading-spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...</p>
              </div>
              
              <div v-else-if="error" key="error" class="error-state">
                <div class="error-icon">‚ö†Ô∏è</div>
                <p class="error-title">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>
                <p class="error-message">{{ error }}</p>
                <button class="btn btn-retry" @click="retryLoadTickets">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
              </div>
              
              <div v-else-if="tickets.length === 0" key="empty" class="empty-state">
                <div class="empty-state-icon">üìã</div>
                <p class="empty-state-message">
                  –ù–∞ —Å—Ç–∞–¥–∏–∏ ¬´{{ selectedStage?.stageName }}¬ª –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é
                </p>
              </div>
              
              <div v-else key="tickets" class="tickets-list-container">
                <TransitionGroup name="ticket" tag="div" class="tickets-list">
                  <TicketCard
                    v-for="(ticket, index) in tickets"
                    :key="ticket.id"
                    :ticket="ticket"
                    :draggable="false"
                    :style="{ '--ticket-index': index }"
                    @click="handleTicketClick"
                  />
                </TransitionGroup>
              </div>
            </Transition>
          </section>
        </div>
      </Transition>
    </div>
  </div>
</template>
```

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞

**–§–∞–π–ª:** `vue-app/src/services/graph-admission-closure/admissionClosureService.js`

```javascript
export async function fetchAdmissionClosureStats(params = {}) {
  const {
    endpoint = DEFAULT_ENDPOINT,
    product = '1C',
    weekStartUtc = null,
    weekEndUtc = null,
    useCache = true,
    forceRefresh = false,
    includeTickets = false,
    includeNewTicketsByStages = false  // –Ω–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
  } = params;

  const body = {
    product,
    weekStartUtc,
    weekEndUtc,
    useCache,
    forceRefresh,
    includeTickets,
    includeNewTicketsByStages  // –ø–µ—Ä–µ–¥–∞—Ç—å –≤ API
  };

  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
}
```

## –°—Ç—É–ø–µ–Ω—á–∞—Ç—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ StagesModal**
   - –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `StagesModal.vue`
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ `ResponsibleModal.vue`
   - –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–π

2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è 1: –°–ø–∏—Å–æ–∫ —Å—Ç–∞–¥–∏–π**
   - –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ `stages` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞–¥–∏–π
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç–∞–¥–∏–π –∏–∑ API
   - –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ç–∞–¥–∏–π —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º
   - –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —Å—Ç–∞–¥–∏—é

3. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è 2: –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤**
   - –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ `selectedStage` –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `loadStageTickets(stageId)`
   - –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–∏–∫–µ—Ç—ã —á–µ—Ä–µ–∑ `TicketCard`
   - –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É ¬´–ù–∞–∑–∞–¥¬ª

4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API**
   - –†–∞—Å—à–∏—Ä–∏—Ç—å `admissionClosureService.js`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç–∞–¥–∏–π —Å `includeNewTicketsByStages: true`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏ —Å `includeTickets: true`

5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ TicketCard**
   - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `TicketCard`
   - –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–∏–∫–µ—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–ª–∏–∫–∞ –Ω–∞ —Ç–∏–∫–µ—Ç

6. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –¥–∞—à–±–æ—Ä–¥**
   - –í `GraphAdmissionClosureDashboard.vue` –¥–æ–±–∞–≤–∏—Ç—å `StagesModal`
   - –ü–æ–¥–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `@open-stages`
   - –ü–µ—Ä–µ–¥–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ props

7. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø—É—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   - –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å—Ç–∞–¥–∏–π
   - –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏
   - –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å –∫–Ω–æ–ø–∫–æ–π ¬´–ü–æ–≤—Ç–æ—Ä–∏—Ç—å¬ª

## –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π

```javascript
// –í StagesModal.vue
import { ref, computed, watch } from 'vue';
import { fetchAdmissionClosureStats } from '@/services/graph-admission-closure/admissionClosureService.js';
import { getTicketIframeUrl } from '@/services/dashboard-sector-1c/utils/constants.js';
import TicketCard from '@/components/dashboard/TicketCard.vue';

const props = defineProps({
  isVisible: Boolean,
  stages: Array,  // newTicketsByStages –∏–∑ API
  weekStartUtc: String,
  weekEndUtc: String
});

const popupLevel = ref(1);
const selectedStage = ref(null);
const tickets = ref([]);
const isLoadingTickets = ref(false);
const isLoadingStages = ref(false);
const error = ref(null);

const hasData = computed(() => (props.stages || []).length > 0);

/**
 * –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –Ω–∞ —Å—Ç–∞–¥–∏—é
 * –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 2 –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤
 */
async function handleStageClick(stage, event = null) {
  if (!stage || stage.count === 0) {
    return;
  }
  
  // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
  if (event && event.currentTarget) {
    event.currentTarget.style.transform = 'scale(0.98)';
    setTimeout(() => {
      if (event.currentTarget) {
        event.currentTarget.style.transform = '';
      }
    }, 150);
  }
  
  selectedStage.value = stage;
  popupLevel.value = 2;
  await loadStageTickets(stage.stageId);
}

/**
 * –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏ –∏–∑ API
 */
async function loadStageTickets(stageId) {
  isLoadingTickets.value = true;
  error.value = null;
  
  try {
    if (!props.weekStartUtc || !props.weekEndUtc) {
      throw new Error('–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏');
    }
    
    const response = await fetchAdmissionClosureStats({
      product: '1C',
      weekStartUtc: props.weekStartUtc,
      weekEndUtc: props.weekEndUtc,
      includeNewTicketsByStages: true,
      includeTickets: true
    });
    
    const stage = response.data.newTicketsByStages?.find(s => s.stageId === stageId);
    const stageTickets = stage?.tickets || [];
    
    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    tickets.value = stageTickets.map(ticket => ({
      id: ticket.id,
      title: ticket.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
      ufSubject: ticket.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
      createdTime: ticket.createdTime,
      createdAt: ticket.createdTime,
      stageId: ticket.stageId,
      assignedById: ticket.assignedById,
      priorityId: 'medium',
      priorityLabel: '–°—Ä–µ–¥–Ω–∏–π',
      priorityColors: {
        color: '#ffc107',
        backgroundColor: '#fff3cd',
        textColor: '#856404'
      },
      priority: 'medium'
    }));
    
    if (tickets.value.length === 0) {
      error.value = null; // –ù–µ –æ—à–∏–±–∫–∞, –ø—Ä–æ—Å—Ç–æ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤
    }
  } catch (err) {
    error.value = err.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤';
    console.error('[StagesModal] Error loading tickets:', err);
    tickets.value = [];
  } finally {
    isLoadingTickets.value = false;
  }
}

function goBack() {
  popupLevel.value = 1;
  selectedStage.value = null;
  tickets.value = [];
  error.value = null;
}

function handleTicketClick(ticket) {
  const url = getTicketIframeUrl(ticket.id);
  window.open(url, '_blank');
}

function retryLoadTickets() {
  if (selectedStage.value) {
    loadStageTickets(selectedStage.value.stageId);
  }
}

// –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–ø–∞–ø–∞
watch(() => props.isVisible, (newValue) => {
  if (!newValue) {
    popupLevel.value = 1;
    selectedStage.value = null;
    tickets.value = [];
    error.value = null;
  }
});
```

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ —ç—Ç–∞–ø–∞

- [ ] –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ ¬´–ù–æ–≤—ã–µ¬ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è `StagesModal`
- [ ] –í –ø–æ–ø–∞–ø–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ 6 —Å—Ç–∞–¥–∏–π —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–∏–∫–µ—Ç–æ–≤
- [ ] –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Ç–∞–¥–∏—é –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å 2 —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–∏–∫–µ—Ç–æ–≤
- [ ] –¢–∏–∫–µ—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `TicketCard`
- [ ] –ö–Ω–æ–ø–∫–∞ ¬´–ù–∞–∑–∞–¥¬ª –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 1
- [ ] –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–ø–∞–ø–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: ¬´–¢–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏: [–ù–∞–∑–≤–∞–Ω–∏–µ]¬ª
- [ ] –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ
- [ ] –ü—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å –∫–Ω–æ–ø–∫–æ–π ¬´–ü–æ–≤—Ç–æ—Ä–∏—Ç—å¬ª
- [ ] –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ç–∏–∫–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ Bitrix24
- [ ] –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –∏ –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç–∞—é—Ç (–∫–∞–∫ –≤ TASK-042-04)
- [ ] –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `ResponsibleModal`

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è

### –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–π
- –¶–≤–µ—Ç–Ω–∞—è –ª–µ–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ (`border-left: 3px solid`) —Å —Ü–≤–µ—Ç–æ–º —Å—Ç–∞–¥–∏–∏
- –§–æ–Ω: `var(--b24-bg-light, #f3f4f6)`
- –ü—Ä–∏ hover: `transform: translateX(2px)`, `box-shadow`
- –°—Ç—Ä–µ–ª–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è —Å—Ç–∞–¥–∏–π —Å `count > 0`

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ –¥–ª—è TicketCard
- –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É –∏–∑ `ResponsibleModal`
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–æ—Ä–º–∞—Ç —Ç–∏–∫–µ—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º `TicketCard`

### –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –∏–∑ `ResponsibleModal.vue`
- –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–π
- –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏–ª–∏ –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–π –≥—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞–¥–∏–π

## –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∞–≤–æ–∫

- 2025-12-16 13:28 (UTC+3, –ë—Ä–µ—Å—Ç): –°–æ–∑–¥–∞–Ω —ç—Ç–∞–ø 3 –∑–∞–¥–∞—á–∏ TASK-043

