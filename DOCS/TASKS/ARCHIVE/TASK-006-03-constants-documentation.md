# TASK-006-03: Добавление константы и обновление документации

**Дата создания:** 2025-12-06 13:12 (UTC+3, Брест)  
**Статус:** Завершена  
**Приоритет:** Средний  
**Исполнитель:** Bitrix24 Программист (Vue.js)  
**Родительская задача:** TASK-006

---

## Описание

Создать общую константу для ID ответственного "Хранитель объектов" (1051) и обновить документацию в коде и в папке `DOCS/`.

---

## Контекст

**Проблема:**
- Константа `KEEPER_OBJECTS_ID = 1051` дублируется в двух функциях:
  - `getZeroPointTickets()` (TASK-006-01)
  - `groupTicketsByStages()` (TASK-006-02)

**Решение:**
- Вынести константу в общий файл конфигурации или в начало файла `ticket-grouper.js`
- Обновить комментарии в коде
- Обновить документацию в `DOCS/`

---

## Модули и компоненты

### Файлы для изменения:

1. **`vue-app/src/services/dashboard-sector-1c/groupers/ticket-grouper.js`**
   - Вынести константу `KEEPER_OBJECTS_ID` в начало файла
   - Обновить комментарии к функциям

2. **`DOCS/ARCHITECTURE/dashboard-sector-1c.md`** (если существует)
   - Добавить описание логики нулевой точки с ответственным 1051

3. **`DOCS/ARCHITECTURE/cache-mechanism-dashboard-sector-1c.md`** (опционально)
   - Обновить описание, если нужно

---

## Зависимости

### От других задач:
- **TASK-006** — родительская задача
- **TASK-006-01** — должна быть выполнена (используется константа)
- **TASK-006-02** — должна быть выполнена (используется константа)

---

## Ступенчатые подзадачи

### 1. Создать общую константу

**Вариант 1: В начале файла `ticket-grouper.js`**
```javascript
/**
 * Константы для группировки тикетов
 */

/**
 * ID ответственного "Хранитель объектов"
 * 
 * Тикеты с этим ответственным попадают в нулевую точку,
 * а не в колонки сотрудников
 */
export const KEEPER_OBJECTS_ID = 1051;
```

**Вариант 2: В отдельном файле конфигурации**
```javascript
// vue-app/src/services/dashboard-sector-1c/config/constants.js

/**
 * Константы для дашборда сектора 1С
 */

/**
 * ID ответственного "Хранитель объектов"
 * 
 * Тикеты с этим ответственным попадают в нулевую точку,
 * а не в колонки сотрудников
 */
export const KEEPER_OBJECTS_ID = 1051;
```

**Рекомендация:** Использовать вариант 1 (в начале файла `ticket-grouper.js`), так как константа используется только в этом файле.

### 2. Обновить функции для использования общей константы

**В `getZeroPointTickets()`:**
```javascript
import { KEEPER_OBJECTS_ID } from './ticket-grouper.js'; // Если константа в отдельном файле
// Или просто использовать KEEPER_OBJECTS_ID, если константа в том же файле
```

**В `groupTicketsByStages()`:**
```javascript
// Использовать KEEPER_OBJECTS_ID вместо локальной константы
```

### 3. Обновить комментарии в коде

**Добавить комментарии к константе:**
```javascript
/**
 * ID ответственного "Хранитель объектов"
 * 
 * Тикеты с этим ответственным попадают в нулевую точку,
 * а не в колонки сотрудников.
 * 
 * Используется в:
 * - getZeroPointTickets() — для включения тикетов в нулевую точку
 * - groupTicketsByStages() — для исключения тикетов из колонок сотрудников
 */
export const KEEPER_OBJECTS_ID = 1051;
```

### 4. Обновить документацию

**Создать или обновить файл:**
- `DOCS/ARCHITECTURE/dashboard-sector-1c-zero-point.md` (новый файл)
- Или обновить существующий файл архитектуры

**Содержание документации:**
```markdown
# Логика нулевой точки в дашборде сектора 1С

**Дата создания:** 2025-12-06 13:12 (UTC+3, Брест)  
**Версия:** 1.0  
**Статус:** Актуально  
**Связанная задача:** TASK-006

## Описание

Нулевая точка в дашборде сектора 1С — это блок для отображения тикетов, которые не должны попадать в колонки сотрудников.

## Логика определения нулевой точки

Нулевая точка включает тикеты:

1. **Без назначенного сотрудника** (`assignedById === null`)
2. **С ответственным 1051 "Хранитель объектов"** (`assignedById === 1051`)

## Константа

```javascript
export const KEEPER_OBJECTS_ID = 1051; // ID ответственного "Хранитель объектов"
```

**Расположение:** `vue-app/src/services/dashboard-sector-1c/groupers/ticket-grouper.js`

## Функции

### `getZeroPointTickets(tickets)`

Определяет, какие тикеты попадают в нулевую точку.

**Логика:**
- Фильтрует тикеты без ответственного (`assignedById === null`)
- Фильтрует тикеты с ответственным 1051 (`assignedById === 1051`)
- Распределяет тикеты по этапам

### `groupTicketsByStages(tickets, employees)`

Распределяет тикеты по этапам и сотрудникам.

**Логика:**
- Исключает тикеты с ответственным 1051 из колонок сотрудников
- Распределяет остальные тикеты по колонкам сотрудников

## Примеры

### Тикет без ответственного
```javascript
{
  id: 1,
  stageId: 'DT140_12:UC_0VHWE2',
  assignedById: null
}
// → Попадает в нулевую точку
```

### Тикет с ответственным 1051
```javascript
{
  id: 2,
  stageId: 'DT140_12:UC_0VHWE2',
  assignedById: 1051
}
// → Попадает в нулевую точку
```

### Тикет с другим ответственным
```javascript
{
  id: 3,
  stageId: 'DT140_12:UC_0VHWE2',
  assignedById: 10
}
// → Попадает в колонку сотрудника с ID 10
```

## История изменений

- **2025-12-06 13:12 (UTC+3, Брест):** Добавлена поддержка тикетов с ответственным 1051 в нулевую точку (TASK-006)
```

---

## Критерии приёмки

- [ ] Константа `KEEPER_OBJECTS_ID` вынесена в общее место (начало файла или отдельный файл)
- [ ] Функции `getZeroPointTickets()` и `groupTicketsByStages()` используют общую константу
- [ ] Комментарии к константе добавлены
- [ ] Комментарии к функциям обновлены
- [ ] Документация в `DOCS/` создана или обновлена
- [ ] Документация содержит описание логики нулевой точки
- [ ] Документация содержит примеры использования
- [ ] Код соответствует стандартам JavaScript/ES6

---

## Тестирование

### Проверка константы:

1. Открыть файл `ticket-grouper.js`
2. Проверить, что константа `KEEPER_OBJECTS_ID` определена в начале файла
3. Проверить, что обе функции используют эту константу

### Проверка документации:

1. Открыть файл документации в `DOCS/ARCHITECTURE/`
2. Проверить, что описание логики нулевой точки актуально
3. Проверить, что примеры корректны

---

## Примеры кода

### Обновлённый файл `ticket-grouper.js` (начало):

```javascript
/**
 * Группер для группировки тикетов по этапам и сотрудникам
 * 
 * Создаёт структуру этапов с сотрудниками и распределяет тикеты
 */

import { mapStageId } from '../mappers/stage-mapper.js';
import { mapTicket } from '../mappers/ticket-mapper.js';
import { mapEmployee } from '../mappers/employee-mapper.js';

/**
 * Константы для группировки тикетов
 */

/**
 * ID ответственного "Хранитель объектов"
 * 
 * Тикеты с этим ответственным попадают в нулевую точку,
 * а не в колонки сотрудников.
 * 
 * Используется в:
 * - getZeroPointTickets() — для включения тикетов в нулевую точку
 * - groupTicketsByStages() — для исключения тикетов из колонок сотрудников
 */
export const KEEPER_OBJECTS_ID = 1051;

// ... остальной код ...
```

---

## История правок

- **2025-12-06 13:12 (UTC+3, Брест):** Создана подзадача TASK-006-03
- **2025-12-06 13:33 (UTC+3, Брест):** Подзадача успешно завершена

---

**Автор:** Технический писатель  
**Статус:** Завершена ✅

