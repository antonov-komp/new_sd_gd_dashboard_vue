# TASK-068-01: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ GraphAdmissionClosureCache –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–∂–∏–º–∞ "weeks"

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-23 15:01 (UTC+3, –ë—Ä–µ—Å—Ç)  
**–°—Ç–∞—Ç—É—Å:** –ù–æ–≤–∞—è  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** Backend Developer (PHP)  
**–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞:** [TASK-068: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "4 –Ω–µ–¥–µ–ª–∏"](./TASK-068-cache-for-weeks-mode.md)  
**–ü–æ–¥–∑–∞–¥–∞—á–∞:** –≠—Ç–∞–ø 1 –∏–∑ TASK-068

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–†–∞—Å—à–∏—Ä–∏—Ç—å –∫–ª–∞—Å—Å `GraphAdmissionClosureCache` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–∂–∏–º–∞ "weeks" —Å –æ—Ç–¥–µ–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π –∫–µ—à–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–æ–∏–º–∏ —Ä–µ–∂–∏–º–∞–º–∏.

**–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–µ—à–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ "4 –Ω–µ–¥–µ–ª–∏", –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ä–µ–∂–∏–º—É "3 –º–µ—Å—è—Ü–∞".

---

## üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

- –ö–ª–∞—Å—Å `GraphAdmissionClosureCache` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∂–∏–º "months"
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∫–µ—à–∞: `api/cache/graph-admission-closure/months/`
- –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å –æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π
- **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
  - –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `CACHE_MONTHS_DIR` (—Å—Ç—Ä–æ–∫–∞ 22): `self::CACHE_BASE_DIR . '/months'`
  - –ú–µ—Ç–æ–¥ `getCachePath()` (—Å—Ç—Ä–æ–∫–∞ 214): –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `CACHE_MONTHS_DIR`
  - –ú–µ—Ç–æ–¥ `ensureCacheDirectory()` (—Å—Ç—Ä–æ–∫–∞ 284): –≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç `CACHE_MONTHS_DIR`
  - –ú–µ—Ç–æ–¥ `clearExpired()` (—Å—Ç—Ä–æ–∫–∞ 174): –æ—á–∏—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ `CACHE_MONTHS_DIR`

### –¢—Ä–µ–±—É–µ—Ç—Å—è:

- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∂–∏–º–∞ "weeks"
- –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é: `api/cache/graph-admission-closure/weeks/`
- –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–µ–∏–º–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏
- **–í–∞–∂–Ω–æ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–ª—è —Ä–µ–∂–∏–º–∞ "months"

---

## üèóÔ∏è –ú–æ–¥—É–ª–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã:

- `api/cache/GraphAdmissionClosureCache.php` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞

### –ù–æ–≤—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

- `api/cache/graph-admission-closure/weeks/` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∫–µ—à–∞ —Ä–µ–∂–∏–º–∞ "weeks"

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **–û—Ç –∑–∞–¥–∞—á:** 
  - TASK-068: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "4 –Ω–µ–¥–µ–ª–∏"
- **–û—Ç –º–æ–¥—É–ª–µ–π:** 
  - –ö–ª–∞—Å—Å: `GraphAdmissionClosureCache`
- **–û—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫:** 
  - PHP 8.4+ (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏)

---

## üéØ –°—Ç—É–ø–µ–Ω—á–∞—Ç—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã CACHE_WEEKS_DIR

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞ —Ä–µ–∂–∏–º–∞ "weeks".

**–®–∞–≥–∏:**

1. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –≤ –∫–ª–∞—Å—Å `GraphAdmissionClosureCache`**
   - **–§–∞–π–ª:** `api/cache/GraphAdmissionClosureCache.php`
   - **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 22 (–ø–æ—Å–ª–µ `CACHE_MONTHS_DIR`)
   ```php
   /**
    * –ü–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "weeks"
    */
   private const CACHE_WEEKS_DIR = self::CACHE_BASE_DIR . '/weeks';
   ```
   - **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `CACHE_BASE_DIR` –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –Ω–∞ —Å—Ç—Ä–æ–∫–µ 17 –∫–∞–∫ `__DIR__ . '/graph-admission-closure'`
   - **–ü–æ–ª–Ω—ã–π –ø—É—Ç—å:** `api/cache/graph-admission-closure/weeks/`

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
   - –ü—É—Ç—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: `{CACHE_BASE_DIR}/weeks`
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π `CACHE_MONTHS_DIR` (—Å—Ç—Ä–æ–∫–∞ 22)
   - **–ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏:** `/var/www/app/public/rest_api_aps/sd_it_gen_plan/api/cache/graph-admission-closure/weeks/`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `CACHE_WEEKS_DIR` –¥–æ–±–∞–≤–ª–µ–Ω–∞
- [ ] –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ getCachePath() –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤

**–¶–µ–ª—å:** –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `getCachePath()` –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞.

**–®–∞–≥–∏:**

1. **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `getCachePath()`**
   - **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∞ 214-220 –≤ `GraphAdmissionClosureCache.php`
   - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `$periodMode` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 'months' –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
   - –í—ã–±–∏—Ä–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞:
     ```php
     /**
      * –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–µ—à–∞
      * 
      * @param string $key –ö–ª—é—á –∫–µ—à–∞
      * @param string $periodMode –†–µ–∂–∏–º –ø–µ—Ä–∏–æ–¥–∞ ('weeks' –∏–ª–∏ 'months')
      * @return string –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
      */
     private static function getCachePath(string $key, string $periodMode = 'months'): string
     {
         // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è)
         $safeKey = preg_replace('/[^a-zA-Z0-9_-]/', '_', $key);
         
         // –í—ã–±–æ—Ä –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
         $cacheDir = $periodMode === 'weeks' 
             ? self::CACHE_WEEKS_DIR 
             : self::CACHE_MONTHS_DIR;
         
         return $cacheDir . '/' . $safeKey . '.json';
     }
     ```
   - **–í–∞–∂–Ω–æ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (—Å—Ç—Ä–æ–∫–∞ 217)

2. **–û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã `getCachePath()`**
   - **–¢–µ–∫—É—â–∏–µ –≤—ã–∑–æ–≤—ã:**
     - `get()` (—Å—Ç—Ä–æ–∫–∞ 37): `self::getCachePath($key)`
     - `set()` (—Å—Ç—Ä–æ–∫–∞ 89): `self::getCachePath($key)`
     - `delete()` (—Å—Ç—Ä–æ–∫–∞ 134): `self::getCachePath($key)`
     - `isExpired()` (—Å—Ç—Ä–æ–∫–∞ 259): `self::getCachePath($key)`
   - **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∏–∑ –∫–ª—é—á–∞:**
     - –ï—Å–ª–∏ –∫–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `weeks_` ‚Üí —Ä–µ–∂–∏–º 'weeks'
     - –ï—Å–ª–∏ –∫–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `months_` ‚Üí —Ä–µ–∂–∏–º 'months'
     - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Üí —Ä–µ–∂–∏–º 'months' (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
   - **–ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
     ```php
     // –í –º–µ—Ç–æ–¥–µ get()
     $periodMode = strpos($key, 'weeks_') === 0 ? 'weeks' : 'months';
     $cachePath = self::getCachePath($key, $periodMode);
     ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ú–µ—Ç–æ–¥ `getCachePath()` –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ get() –∏ set() –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–∂–∏–º–∞ "weeks"

**–¶–µ–ª—å:** –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã `get()` –∏ `set()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–æ–∏–º–∏ —Ä–µ–∂–∏–º–∞–º–∏.

**–®–∞–≥–∏:**

1. **–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get()`**
   - **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∏ 35-72 –≤ `GraphAdmissionClosureCache.php`
   - –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–µ–∂–∏–º –∏–∑ –∫–ª—é—á–∞ –∫–µ—à–∞ (–ø—Ä–µ—Ñ–∏–∫—Å `weeks_` –∏–ª–∏ `months_`)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
   ```php
   public static function get(string $key): ?array
   {
       // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞
       $periodMode = strpos($key, 'weeks_') === 0 ? 'weeks' : 'months';
       $cachePath = self::getCachePath($key, $periodMode);
       
       // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ (—Å—Ç—Ä–æ–∫–∞ 40)
       if (!file_exists($cachePath)) {
           return null;
       }
       
       // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ (—Å—Ç—Ä–æ–∫–∞ 45)
       $content = @file_get_contents($cachePath);
       if ($content === false) {
           error_log("[Cache] Failed to read cache file: {$cachePath}");
           return null;
       }
       
       // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JSON (—Å—Ç—Ä–æ–∫–∞ 52)
       $data = @json_decode($content, true);
       if ($data === null || !is_array($data)) {
           error_log("[Cache] Failed to decode cache file: {$cachePath}");
           return null;
       }
       
       // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (—Å—Ç—Ä–æ–∫–∞ 59)
       if (!isset($data['metadata']['expires_at'])) {
           error_log("[Cache] Invalid cache structure: {$cachePath}");
           return null;
       }
       
       // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è (—Å—Ç—Ä–æ–∫–∞ 65)
       if (time() > $data['metadata']['expires_at']) {
           // –ö–µ—à –∏—Å—Ç—ë–∫, —É–¥–∞–ª—è–µ–º —Ñ–∞–π–ª
           @unlink($cachePath);
           return null;
       }
       
       return $data['data'] ?? null;
   }
   ```
   - **–í–∞–∂–Ω–æ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

2. **–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `set()`**
   - **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∏ 82-124 –≤ `GraphAdmissionClosureCache.php`
   - –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–µ–∂–∏–º –∏–∑ –∫–ª—é—á–∞ –∫–µ—à–∞
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
   - –û–±–Ω–æ–≤–∏—Ç—å `ensureCacheDirectory()` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤
   ```php
   public static function set(string $key, array $data, int $ttl = self::DEFAULT_TTL): bool
   {
       // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞
       $periodMode = strpos($key, 'weeks_') === 0 ? 'weeks' : 'months';
       
       // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (—Å—Ç—Ä–æ–∫–∞ 85)
       if (!self::ensureCacheDirectory($periodMode)) {
           return false;
       }
       
       $cachePath = self::getCachePath($key, $periodMode);
       $now = time();
       
       // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (—Å—Ç—Ä–æ–∫–∞ 93)
       $cacheData = [
           'data' => $data,
           'metadata' => [
               'created_at' => $now,
               'expires_at' => $now + $ttl,
               'ttl' => $ttl
           ]
       ];
       
       // –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ JSON (—Å—Ç—Ä–æ–∫–∞ 103)
       $json = json_encode($cacheData, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
       if ($json === false) {
           error_log("[Cache] Failed to encode cache data for key: {$key}");
           return false;
       }
       
       // –ó–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª (–∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª) (—Å—Ç—Ä–æ–∫–∞ 110)
       $tempPath = $cachePath . '.tmp';
       if (@file_put_contents($tempPath, $json, LOCK_EX) === false) {
           error_log("[Cache] Failed to write cache file: {$tempPath}");
           return false;
       }
       
       // –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∞ 117)
       if (!@rename($tempPath, $cachePath)) {
           error_log("[Cache] Failed to rename cache file: {$tempPath} -> {$cachePath}");
           @unlink($tempPath);
           return false;
       }
       
       return true;
   }
   ```
   - **–í–∞–∂–Ω–æ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—É—é –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race conditions

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ú–µ—Ç–æ–¥ `get()` –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] –ú–µ—Ç–æ–¥ `set()` –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ ensureCacheDirectory() –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤

**–¶–µ–ª—å:** –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `ensureCacheDirectory()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤.

**–®–∞–≥–∏:**

1. **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `ensureCacheDirectory()`**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `$periodMode`
   - –í—ã–±–∏—Ä–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
   ```php
   private static function ensureCacheDirectory(string $periodMode = 'months'): bool
   {
       $cacheDir = $periodMode === 'weeks' 
           ? self::CACHE_WEEKS_DIR 
           : self::CACHE_MONTHS_DIR;
       
       if (is_dir($cacheDir)) {
           return is_writable($cacheDir);
       }
       
       // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
       if (!@mkdir($cacheDir, 0755, true)) {
           error_log("[Cache] Failed to create cache directory: {$cacheDir}");
           return false;
       }
       
       return true;
   }
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã `ensureCacheDirectory()`**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `$periodMode`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ú–µ—Ç–æ–¥ `ensureCacheDirectory()` –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ clearExpired() –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–µ–∏–º–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏

**–¶–µ–ª—å:** –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `clearExpired()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π –≤ –æ–±–µ–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö.

**–®–∞–≥–∏:**

1. **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `clearExpired()`**
   - **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∏ 174-206 –≤ `GraphAdmissionClosureCache.php`
   - –û—á–∏—â–∞—Ç—å –∫–µ—à–∏ –≤ –æ–±–µ–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö (weeks –∏ months)
   - –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
   - **–°–æ–∑–¥–∞—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥** –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
   ```php
   /**
    * –û—á–∏—Å—Ç–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏
    * 
    * @return int –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–∏–∑ –æ–±–µ–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π)
    */
   public static function clearExpired(): int
   {
       $deleted = 0;
       $now = time();
       
       // –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π —Ä–µ–∂–∏–º–∞ "weeks"
       $deleted += self::clearExpiredInDirectory(self::CACHE_WEEKS_DIR, $now);
       
       // –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π —Ä–µ–∂–∏–º–∞ "months"
       $deleted += self::clearExpiredInDirectory(self::CACHE_MONTHS_DIR, $now);
       
       return $deleted;
   }
   
   /**
    * –û—á–∏—Å—Ç–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    * 
    * @param string $cacheDir –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞
    * @param int $now –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (Unix timestamp)
    * @return int –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    */
   private static function clearExpiredInDirectory(string $cacheDir, int $now): int
   {
       if (!is_dir($cacheDir)) {
           return 0;
       }
       
       $files = glob($cacheDir . '/*.json');
       $deleted = 0;
       
       foreach ($files as $file) {
           $content = @file_get_contents($file);
           if ($content === false) {
               continue;
           }
           
           $data = @json_decode($content, true);
           if ($data === null || !is_array($data)) {
               continue;
           }
           
           $expiresAt = $data['metadata']['expires_at'] ?? 0;
           if ($now > $expiresAt) {
               if (@unlink($file)) {
                   $deleted++;
               }
           }
       }
       
       return $deleted;
   }
   ```
   - **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `clearExpiredInDirectory()` –≤—ã–Ω–æ—Å–∏—Ç –æ–±—â—É—é –ª–æ–≥–∏–∫—É –æ—á–∏—Å—Ç–∫–∏

2. **–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `clear()` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ**
   - **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∏ 148-167 –≤ `GraphAdmissionClosureCache.php`
   - –û—á–∏—â–∞—Ç—å –∫–µ—à–∏ –≤ –æ–±–µ–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
   ```php
   /**
    * –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à
    * 
    * @return bool true –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
    */
   public static function clear(): bool
   {
       $success = true;
       
       // –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π —Ä–µ–∂–∏–º–∞ "weeks"
       if (!self::clearDirectory(self::CACHE_WEEKS_DIR)) {
           $success = false;
       }
       
       // –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π —Ä–µ–∂–∏–º–∞ "months"
       if (!self::clearDirectory(self::CACHE_MONTHS_DIR)) {
           $success = false;
       }
       
       return $success;
   }
   
   /**
    * –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    * 
    * @param string $cacheDir –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞
    * @return bool true –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
    */
   private static function clearDirectory(string $cacheDir): bool
   {
       if (!is_dir($cacheDir)) {
           return true; // –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
       }
       
       $files = glob($cacheDir . '/*.json');
       $success = true;
       
       foreach ($files as $file) {
           if (!@unlink($file)) {
               error_log("[Cache] Failed to delete cache file: {$file}");
               $success = false;
           }
       }
       
       return $success;
   }
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ú–µ—Ç–æ–¥ `clearExpired()` –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] –û—á–∏—Å—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–±–µ–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- [ ] –ú–µ—Ç–æ–¥ `clear()` –æ–±–Ω–æ–≤–ª—ë–Ω –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.6: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ "weeks"

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∫–µ—à–∞ —Ä–µ–∂–∏–º–∞ "weeks" –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.

**–®–∞–≥–∏:**

1. **–°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∫–µ—à–∞**
   ```bash
   # –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
   mkdir -p api/cache/graph-admission-closure/weeks
   
   # –ò–ª–∏ –ø–æ–ª–Ω—ã–π –ø—É—Ç—å
   mkdir -p /var/www/app/public/rest_api_aps/sd_it_gen_plan/api/cache/graph-admission-closure/weeks
   ```
   - **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ—Ç–æ–¥–æ–º `ensureCacheDirectory()`, –Ω–æ –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**
   ```bash
   chmod 755 api/cache/graph-admission-closure/weeks
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
   ls -la api/cache/graph-admission-closure/
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: drwxr-xr-x weeks
   ```
   - **–í–∞–∂–Ω–æ:** –í–µ–±-—Å–µ—Ä–≤–µ—Ä (www-data –∏–ª–∏ nginx) –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å

3. **–î–æ–±–∞–≤–∏—Ç—å `.gitkeep` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ Git**
   ```bash
   touch api/cache/graph-admission-closure/weeks/.gitkeep
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
   ls -la api/cache/graph-admission-closure/weeks/
   # –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∞–π–ª .gitkeep
   ```
   - **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `months/`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (755)
- [ ] `.gitkeep` –¥–æ–±–∞–≤–ª–µ–Ω

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:

1. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É:**
   ```php
   private const CACHE_WEEKS_DIR = self::CACHE_BASE_DIR . '/weeks';
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã:**
   - `getCachePath()` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `$periodMode`
   - `get()` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–µ–∂–∏–º –∏–∑ –∫–ª—é—á–∞
   - `set()` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–µ–∂–∏–º –∏–∑ –∫–ª—é—á–∞
   - `ensureCacheDirectory()` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `$periodMode`
   - `clearExpired()` ‚Äî –æ—á–∏—â–∞—Ç—å –æ–±–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
   - `clear()` ‚Äî –æ—á–∏—â–∞—Ç—å –æ–±–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

3. **–î–æ–±–∞–≤–∏—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥:**
   ```php
   private static function clearExpiredInDirectory(string $cacheDir, int $now): int
   ```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

### –û–±—â–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏:
- [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `CACHE_WEEKS_DIR` –¥–æ–±–∞–≤–ª–µ–Ω–∞ (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 22)
- [ ] –ú–µ—Ç–æ–¥ `getCachePath()` –æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤ (–¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `$periodMode`)
- [ ] –ú–µ—Ç–æ–¥—ã `get()` –∏ `set()` —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–±–æ–∏–º–∏ —Ä–µ–∂–∏–º–∞–º–∏ (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∏–∑ –∫–ª—é—á–∞)
- [ ] –ú–µ—Ç–æ–¥ `ensureCacheDirectory()` —Å–æ–∑–¥–∞—ë—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤ (–¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `$periodMode`)
- [ ] –ú–µ—Ç–æ–¥ `clearExpired()` –æ—á–∏—â–∞–µ—Ç –∫–µ—à–∏ –≤ –æ–±–µ–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `clearExpiredInDirectory()`)
- [ ] –ú–µ—Ç–æ–¥ `clear()` –æ—á–∏—â–∞–µ—Ç –∫–µ—à–∏ –≤ –æ–±–µ–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `clearDirectory()`)
- [ ] –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `weeks/` —Å–æ–∑–¥–∞–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ (755)
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ (—Ä–µ–∂–∏–º "months" —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ)
- [ ] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º PSR-12
- [ ] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ TASK-068-01

### –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
```php
// –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 22
private const CACHE_WEEKS_DIR = self::CACHE_BASE_DIR . '/weeks';
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞:**
```php
// –í –º–µ—Ç–æ–¥–∞—Ö get() –∏ set()
$periodMode = strpos($key, 'weeks_') === 0 ? 'weeks' : 'months';
// –î–æ–ª–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–µ–∂–∏–º –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:**
```php
// –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–µ—à–∏ "months" –¥–æ–ª–∂–Ω—ã —á–∏—Ç–∞—Ç—å—Å—è
$monthsKey = 'months_abc123...';
$data = GraphAdmissionClosureCache::get($monthsKey);
// –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. **–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**
   ```php
   // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   $key = 'weeks_test_key';
   GraphAdmissionClosureCache::set($key, ['test' => 'data'], 60);
   assert(is_dir(CACHE_WEEKS_DIR), 'Weeks cache directory should be created');
   ```

2. **–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è:**
   ```php
   // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à —Ä–µ–∂–∏–º–∞ "weeks"
   $key = 'weeks_test_key';
   $data = ['test' => 'data'];
   GraphAdmissionClosureCache::set($key, $data, 60);
   
   // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –∫–µ—à–∞
   $cached = GraphAdmissionClosureCache::get($key);
   assert($cached === $data, 'Cache get/set should work for weeks mode');
   ```

3. **–¢–µ—Å—Ç –æ—á–∏—Å—Ç–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π:**
   ```php
   // –°–æ–∑–¥–∞—Ç—å –∏—Å—Ç—ë–∫—à–∏–π –∫–µ—à
   $key = 'weeks_expired_key';
   GraphAdmissionClosureCache::set($key, ['test' => 'data'], 1);
   sleep(2);
   
   // –û—á–∏—Å—Ç–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ
   $deleted = GraphAdmissionClosureCache::clearExpired();
   assert($deleted >= 1, 'clearExpired should delete expired cache');
   ```

4. **–¢–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ä–µ–∂–∏–º–æ–≤:**
   ```php
   // –ö–µ—à —Ä–µ–∂–∏–º–∞ "weeks"
   $weeksKey = 'weeks_test_key';
   GraphAdmissionClosureCache::set($weeksKey, ['mode' => 'weeks'], 60);
   
   // –ö–µ—à —Ä–µ–∂–∏–º–∞ "months"
   $monthsKey = 'months_test_key';
   GraphAdmissionClosureCache::set($monthsKey, ['mode' => 'months'], 60);
   
   // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–µ—à–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã
   $weeksData = GraphAdmissionClosureCache::get($weeksKey);
   $monthsData = GraphAdmissionClosureCache::get($monthsKey);
   assert($weeksData['mode'] === 'weeks', 'Weeks cache should be independent');
   assert($monthsData['mode'] === 'months', 'Months cache should be independent');
   ```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –º–µ—Ç–æ–¥ getCachePath():

```php
/**
 * –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–µ—à–∞
 * 
 * @param string $key –ö–ª—é—á –∫–µ—à–∞
 * @param string $periodMode –†–µ–∂–∏–º –ø–µ—Ä–∏–æ–¥–∞ ('weeks' –∏–ª–∏ 'months')
 * @return string –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
 */
private static function getCachePath(string $key, string $periodMode = 'months'): string
{
    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è)
    $safeKey = preg_replace('/[^a-zA-Z0-9_-]/', '_', $key);
    
    // –í—ã–±–æ—Ä –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
    $cacheDir = $periodMode === 'weeks' 
        ? self::CACHE_WEEKS_DIR 
        : self::CACHE_MONTHS_DIR;
    
    return $cacheDir . '/' . $safeKey . '.json';
}
```

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –º–µ—Ç–æ–¥ get():

```php
/**
 * –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞
 * 
 * @param string $key –ö–ª—é—á –∫–µ—à–∞
 * @return array|null –î–∞–Ω–Ω—ã–µ –∏–ª–∏ null, –µ—Å–ª–∏ –∫–µ—à –Ω–µ –Ω–∞–π–¥–µ–Ω/–∏—Å—Ç—ë–∫
 */
public static function get(string $key): ?array
{
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞
    $periodMode = strpos($key, 'weeks_') === 0 ? 'weeks' : 'months';
    $cachePath = self::getCachePath($key, $periodMode);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
    if (!file_exists($cachePath)) {
        return null;
    }
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
}
```

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∏–∑ –∫–ª—é—á–∞ –∫–µ—à–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥—ã `get()` –∏ `set()` –¥–æ–ª–∂–Ω—ã –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–µ–∂–∏–º –∏–∑ –∫–ª—é—á–∞ –∫–µ—à–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å –∫–ª—é—á–∞: `weeks_` –∏–ª–∏ `months_`
- –ü—Ä–æ–≤–µ—Ä–∫–∞: `strpos($key, 'weeks_') === 0`
- **–í–∞–∂–Ω–æ:** –ü—Ä–µ—Ñ–∏–∫—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –Ω–∞—á–∞–ª–µ –∫–ª—é—á–∞ (–ø–æ–∑–∏—Ü–∏—è 0)

**–ü—Ä–∏–º–µ—Ä:**
```php
$periodMode = strpos($key, 'weeks_') === 0 ? 'weeks' : 'months';
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–µ—à–∏ —Ä–µ–∂–∏–º–∞ "months" –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º 'months' –≤ `getCachePath()` (–ø–∞—Ä–∞–º–µ—Ç—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ï—Å–ª–∏ –∫–ª—é—á –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `weeks_`, —Å—á–∏—Ç–∞—Ç—å –µ–≥–æ —Ä–µ–∂–∏–º–æ–º "months"
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–µ—à–∏ "months" —á–∏—Ç–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `weeks/` –º–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
- –ú–µ—Ç–æ–¥ `ensureCacheDirectory()` –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [TASK-068: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "4 –Ω–µ–¥–µ–ª–∏"](./TASK-068-cache-for-weeks-mode.md)
- [TASK-059-05: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–≥–æ –∫–µ—à–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ 3 –º–µ—Å—è—Ü–∞](./TASK-059-05-file-cache-implementation.md)
- [–ê–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª—è](../../ARCHITECTURE/graph-admission-closure-analysis.md)

---

## üìä –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∞–≤–æ–∫

- **2025-12-23 15:01 (UTC+3, –ë—Ä–µ—Å—Ç):** –°–æ–∑–¥–∞–Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è GraphAdmissionClosureCache

---

**–ê–≤—Ç–æ—Ä:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0

