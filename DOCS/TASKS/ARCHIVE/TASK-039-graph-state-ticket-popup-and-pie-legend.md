# TASK-039: Попап по точкам линейного графика и улучшение круговой диаграммы (Сектор 1С)

**Дата создания:** 2025-12-15 12:00 (UTC+3, Брест)  
**Статус:** Завершена  
**Приоритет:** Высокий  
**Исполнитель:** Bitrix24 Программист (Vue.js)

## Цель
Исправить всплытие попапа 1-го уровня по клику на точки линейного графика и улучшить круговой график сектора 1С: добавить информативный центр с заголовком и количеством тикетов, а также расширенную легенду с количеством тикетов по стадиям и увеличенными размерами.

## Контекст
- Модуль: «График состояния сектора 1С» (Vue).
- Линейный график должен открывать существующий попап 1 уровня (тикеты стадии) при клике на любую точку графика, но сейчас попап не появляется.
- Круговой график в центре имеет пустоту — требуется добавить читаемый заголовок с количеством тикетов «Всего в секторе 1С тикетов в работе: N».
- Легенда кругового графика должна отображать количество тикетов в названии стадии и стать крупнее.

## Требования
1) Линейный график  
   - По клику на любую точку (value point) открыть действующий попап 1 уровня Тикетов этой стадии.  
   - Причина отсутствия попапа должна быть выявлена и устранена (событие клика, данные, связь со всплывающим компонентом).  
   - Попап должен получать корректный идентификатор стадии/тикетов, соответствующий точке.

2) Круговой график — центр (donut hole)  
   - Заполнить центр заголовком вида:  
     «Всего в секторе 1С тикетов в работе: {count}»  
   - Заголовок должен быть многострочным/с переносом (UIX friendly), адаптивным и читабельным на всех разрешениях.

3) Круговой график — легенда  
   - В названии каждой стадии в легенде добавить в скобках количество тикетов по стадии: `Название стадии (count)`.  
   - Увеличить легенду примерно на 20% по шрифтам и размерам элементов (иконки/плашки, отступы), сохранив вёрстку и читаемость.  
   - Обеспечить корректный рендер при узких ширинах (не ломать сетку).

## Затронутые модули/файлы (предварительно)
- `vue-app/src/components/graph-state/GraphStateChart.vue` — отрисовка линейного и кругового графиков.
- `vue-app/src/utils/graph-state/stageLevel1Loader.js` — загрузка данных стадий/тикетов (попап 1 уровня).
- Стили для графиков/легенды (по месту в компонентах или общих стилях).

## Подзадачи
1. Исследовать линейный график: проверить обработчик клика по точке, какие данные передаются в попап, нет ли перехвата события/ошибок в консолях.  
2. Исправить логику вызова попапа 1 уровня: убедиться, что при клике уходит корректный payload (stageId/filters) и компонент попапа монтируется.  
3. Добавить/обновить центр donut: вывести заголовок с числом тикетов, обеспечить перенос строк и адаптивную типографику.  
4. Обновить легенду кругового графика: добавить `(count)` к названию стадии, увеличить размеры ~на 20% (шрифт, маркеры, отступы), проверить адаптив.  
5. Протестировать: клики по точкам → попап; проверка центра и легенды на разных данных и ширинах; отсутствие регрессий.

## UI/UX требования
- Центр donut: многострочный заголовок, читаемый на малых ширинах; не перекрывать сегменты.  
- Легенда: увеличенный шрифт/маркеры (~20%), корректные отступы; при сужении — перенос строк без наложений.  
- Попап: должен открываться без задержек; при ошибке — лог/уведомление в консоль (dev).

## Технические детали и данные
- Использовать существующий компонент попапа 1 уровня (не менять его контракт, если не требуется).  
- Передавать stageId/filters, соответствующие точке линейного графика.  
- Количество тикетов для центра и легенды брать из текущих данных круговой диаграммы (без дополнительных запросов, если данные уже есть).  
- Стараться не ломать текущую типографику — только увеличивать/масштабировать легенду.

## Критерии приёмки
- [ ] Клик по точке линейного графика всегда открывает попап 1 уровня с тикетами выбранной стадии.  
- [ ] В центр donut выведен заголовок «Всего в секторе 1С тикетов в работе: N», корректно переносится и читабелен.  
- [ ] Легенда показывает названия стадий с количеством в скобках и визуально увеличена ~на 20% (шрифт, маркеры, отступы).  
- [ ] Адаптив: легенда и центр не ломают вёрстку на разных ширинах; попап открывается в существующем флоу.  
- [ ] Нет ошибок в консоли браузера; не нарушена работа других частей модуля графика.

## Тестирование
1. Открыть страницу модуля «График состояния сектора 1С».  
2. Кликнуть по нескольким точкам линейного графика разных стадий — попап 1 уровня должен открыться с правильными данными.  
3. Проверить центр donut: отображается заголовок с актуальным total, текст переносится.  
4. Проверить легенду: названия со скобками и количеством, увеличенный размер, без наложений на узких ширинах.  
5. Регрессия: убедиться, что переключение стадий/фильтров не ломает отображение и попапы.

## Вопросы/ответы (оставить для уточнений)
- Нужны ли точные размеры/шрифт для легенды или ориентируемся на +20% от текущих?  
- Допустимо ли подправить контракт данных для попапа, если причина в отсутствии нужного ключа?

