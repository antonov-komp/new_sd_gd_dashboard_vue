# TASK-068-04: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ "4 –Ω–µ–¥–µ–ª–∏"

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-23 15:01 (UTC+3, –ë—Ä–µ—Å—Ç)  
**–°—Ç–∞—Ç—É—Å:** –ù–æ–≤–∞—è  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** Backend Developer (PHP)  
**–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞:** [TASK-068: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "4 –Ω–µ–¥–µ–ª–∏"](./TASK-068-cache-for-weeks-mode.md)  
**–ü–æ–¥–∑–∞–¥–∞—á–∞:** –≠—Ç–∞–ø 4 –∏–∑ TASK-068

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "4 –Ω–µ–¥–µ–ª–∏" (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ä–µ–∂–∏–º—É "3 –º–µ—Å—è—Ü–∞"), —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è.

**–¶–µ–ª—å:** –û–±–µ—Å–ø–µ—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∂–∏–º–∞ "4 –Ω–µ–¥–µ–ª–∏" —á–µ—Ä–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.

---

## üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

- **–†–µ–∂–∏–º "3 –º–µ—Å—è—Ü–∞"** —É–∂–µ –∏–º–µ–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Å—Ç—Ä–æ–∫–∏ 234, 258-260, 489-490 –≤ `GraphAdmissionClosureService.php`):
  - `[MONTHS-PERFORMANCE] Total execution time (from cache): X.XXX seconds` (—Å—Ç—Ä–æ–∫–∞ 260)
  - `[MONTHS-PERFORMANCE] Total execution time: XX.XX seconds` (—Å—Ç—Ä–æ–∫–∞ 490)
  - –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–µ 234: `$monthsModeStartTime = microtime(true);`
- **–†–µ–∂–∏–º "4 –Ω–µ–¥–µ–ª–∏"** –Ω–µ –∏–º–µ–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ "weeks":** –ù–µ—Ç –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –¢—Ä–µ–±—É–µ—Ç—Å—è:

- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "4 –Ω–µ–¥–µ–ª–∏"
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ –≤ –∫–µ—à (cache hit)
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –ø—Ä–∏ –ø—Ä–æ–º–∞—Ö–µ –∫–µ—à–∞ (cache miss)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ä–µ–∂–∏–º—É "3 –º–µ—Å—è—Ü–∞"

---

## üèóÔ∏è –ú–æ–¥—É–ª–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã:

- `api/graph-admission-closure/service/GraphAdmissionClosureService.php` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç–æ–¥ `handle()`

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **–û—Ç –∑–∞–¥–∞—á:** 
  - TASK-068-03: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è GraphAdmissionClosureService –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **–û—Ç –º–æ–¥—É–ª–µ–π:** 
  - –ö–ª–∞—Å—Å: `GraphAdmissionClosureService`

---

## üéØ –°—Ç—É–ø–µ–Ω—á–∞—Ç—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 4.1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ "weeks".

**–®–∞–≥–∏:**

1. **–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
   - **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ "weeks" (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 54 –≤ `GraphAdmissionClosureService.php`)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `microtime(true)` –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç float –≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
   - **–í–∞–∂–Ω–æ:** –ò–∑–º–µ—Ä–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è –î–û –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–µ—à–∞, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–µ—à–∞ –≤ –æ–±—â–µ–µ –≤—Ä–µ–º—è
   ```php
   // –ù–µ–¥–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
   $weeksModeStartTime = microtime(true); // TASK-068-04: –ù–∞—á–∞–ª–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
   
   [$weekStart, $weekEnd] = $this->dateHelper->getWeekBounds($weekStartParam, $weekEndParam);
   $weeks = $this->dateHelper->getFourWeeksBounds($weekStart, $weekEnd);
   ```
   - **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ä–µ–∂–∏–º—É "months" (—Å—Ç—Ä–æ–∫–∞ 234 –≤ `handleMonthsMode()`)

2. **–î–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö**
   - –í –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–µ—à–∞) ‚Äî —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤—ã—à–µ
   - –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∏–∑ –∫–µ—à–∞ (cache hit) ‚Äî –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ cache hit
   - –ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ (cache miss) ‚Äî –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [ ] –í—Ä–µ–º—è –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- [ ] –í—Ä–µ–º—è –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –≤ –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–∫–∞—Ö

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 4.2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ –≤ –∫–µ—à (cache hit)

**–¶–µ–ª—å:** –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–µ—à–∞.

**–®–∞–≥–∏:**

1. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ cache hit**
   - –í—ã—á–∏—Å–ª–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: `microtime(true) - $weeksModeStartTime`
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ: `[WEEKS-PERFORMANCE] Total execution time (from cache): X.XXX seconds`
   ```php
   if ($cachedData !== null) {
       $cacheResponseTime = microtime(true) - $weeksModeStartTime;
       error_log("[Cache] Cache hit for key: {$cacheKey}");
       error_log("[WEEKS-PERFORMANCE] Total execution time (from cache): " . round($cacheResponseTime, 3) . " seconds");
       return $cachedData;
   }
   ```

2. **–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ 3 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `round($time, 3)` –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Å —Ä–µ–∂–∏–º–æ–º "months"

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ cache hit –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [ ] –§–æ—Ä–º–∞—Ç –ª–æ–≥–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∂–∏–º—É "months"
- [ ] –í—Ä–µ–º—è –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –¥–æ 3 –∑–Ω–∞–∫–æ–≤

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 4.3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–º–∞—Ö–µ –∫–µ—à–∞ (cache miss)

**–¶–µ–ª—å:** –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ (–±–µ–∑ –∫–µ—à–∞).

**–®–∞–≥–∏:**

1. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏**
   - –í—ã—á–∏—Å–ª–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: `microtime(true) - $weeksModeStartTime`
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ: `[WEEKS-PERFORMANCE] Total execution time: XX.XX seconds`
   ```php
   // –ü–æ—Å–ª–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
   $weeksModeTotalTime = microtime(true) - $weeksModeStartTime;
   error_log("[WEEKS-PERFORMANCE] Total execution time: " . round($weeksModeTotalTime, 2) . " seconds");
   ```

2. **–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `round($time, 2)` –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Å —Ä–µ–∂–∏–º–æ–º "months"

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ cache miss –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [ ] –§–æ—Ä–º–∞—Ç –ª–æ–≥–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∂–∏–º—É "months"
- [ ] –í—Ä–µ–º—è –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –¥–æ 2 –∑–Ω–∞–∫–æ–≤

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 4.4: –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –ª–æ–≥–æ–≤

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ —Ä–µ–∂–∏–º–∞ "weeks" —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç—É —Ä–µ–∂–∏–º–∞ "months".

**–®–∞–≥–∏:**

1. **–°—Ä–∞–≤–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç—ã –ª–æ–≥–æ–≤**
   - –†–µ–∂–∏–º "months":
     - `[MONTHS-PERFORMANCE] Total execution time (from cache): X.XXX seconds`
     - `[MONTHS-PERFORMANCE] Total execution time: XX.XX seconds`
   - –†–µ–∂–∏–º "weeks":
     - `[WEEKS-PERFORMANCE] Total execution time (from cache): X.XXX seconds`
     - `[WEEKS-PERFORMANCE] Total execution time: XX.XX seconds`

2. **–£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏**
   - –ü—Ä–µ—Ñ–∏–∫—Å: `[WEEKS-PERFORMANCE]` vs `[MONTHS-PERFORMANCE]`
   - –§–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π
   - –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ: –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–µ–Ω
- [ ] –ü—Ä–µ—Ñ–∏–∫—Å—ã —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –ø–æ —Ä–µ–∂–∏–º–∞–º
- [ ] –§–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤:

**–ü—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ –≤ –∫–µ—à (cache hit):**
```
[Cache] Cache hit for key: weeks_abc123def456...
[WEEKS-PERFORMANCE] Total execution time (from cache): 0.023 seconds
```
- **–§–∞–π–ª –ª–æ–≥–∞:** `logs/app/graph-admission-closure-YYYY-MM-DD.log`
- **–í—Ä–µ–º—è:** –û–∫—Ä—É–≥–ª–µ–Ω–æ –¥–æ 3 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
- **–û–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** 0.01-0.05 —Å–µ–∫—É–Ω–¥

**–ü—Ä–∏ –ø—Ä–æ–º–∞—Ö–µ –∫–µ—à–∞ (cache miss):**
```
[Cache] Cache miss for key: weeks_abc123def456...
... (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Bitrix24) ...
[Cache] Cache saved for key: weeks_abc123def456...
[WEEKS-PERFORMANCE] Total execution time: 3.45 seconds
```
- **–§–∞–π–ª –ª–æ–≥–∞:** `logs/app/graph-admission-closure-YYYY-MM-DD.log`
- **–í—Ä–µ–º—è:** –û–∫—Ä—É–≥–ª–µ–Ω–æ –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π (—Å–æ—Ç—ã–µ –¥–æ–ª–∏ —Å–µ–∫—É–Ω–¥—ã)
- **–û–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** 2-5 —Å–µ–∫—É–Ω–¥

**–ü—Ä–∏ forceRefresh:**
```
[Cache] Force refresh requested, skipping cache check
... (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Bitrix24) ...
[Cache] Cache saved for key: weeks_abc123def456...
[WEEKS-PERFORMANCE] Total execution time: 3.52 seconds
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ä–µ–∂–∏–º–æ–º "months":

| –†–µ–∂–∏–º | Cache Hit | Cache Miss | –§–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏ |
|-------|-----------|------------|----------------|
| weeks | `[WEEKS-PERFORMANCE] Total execution time (from cache): X.XXX seconds` | `[WEEKS-PERFORMANCE] Total execution time: XX.XX seconds` | 3 –∑–Ω–∞–∫–∞ / 2 –∑–Ω–∞–∫–∞ |
| months | `[MONTHS-PERFORMANCE] Total execution time (from cache): X.XXX seconds` | `[MONTHS-PERFORMANCE] Total execution time: XX.XX seconds` | 3 –∑–Ω–∞–∫–∞ / 2 –∑–Ω–∞–∫–∞ |

### –¢–æ—á–Ω–æ—Å—Ç—å –∏–∑–º–µ—Ä–µ–Ω–∏—è:

- **–ü—Ä–∏ cache hit:** 3 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
- **–ü—Ä–∏ cache miss:** 2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π (—Å–æ—Ç—ã–µ –¥–æ–ª–∏ —Å–µ–∫—É–Ω–¥—ã)

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

### –û–±—â–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏:
- [ ] –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ cache hit –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ cache miss –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [ ] –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∂–∏–º—É "months"
- [ ] –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (3 –∑–Ω–∞–∫–∞ –¥–ª—è cache hit, 2 –∑–Ω–∞–∫–∞ –¥–ª—è cache miss)
- [ ] –ü—Ä–µ—Ñ–∏–∫—Å –ª–æ–≥–æ–≤: `[WEEKS-PERFORMANCE]`
- [ ] –õ–æ–≥–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–∞–π–ª (logs/app/graph-admission-closure-YYYY-MM-DD.log)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. **–¢–µ—Å—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ cache hit:**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å `periodMode: 'weeks'` (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
   - –î–æ–∂–¥–∞—Ç—å—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –∫–µ—à (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å: `[Cache] Cache saved`)
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
     ```bash
     tail -f logs/app/graph-admission-closure-$(date +%Y-%m-%d).log | grep -E "Cache|WEEKS-PERFORMANCE"
     ```
   - –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:
     - `[Cache] Cache hit for key: weeks_...`
     - `[WEEKS-PERFORMANCE] Total execution time (from cache): X.XXX seconds`
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞:** –í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ `X.XXX` (3 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π)
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è:** –í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 0.1 —Å–µ–∫—É–Ω–¥—ã

2. **–¢–µ—Å—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ cache miss:**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å `periodMode: 'weeks'` –∏ `forceRefresh: true`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
     ```bash
     tail -f logs/app/graph-admission-closure-$(date +%Y-%m-%d).log | grep -E "Cache|WEEKS-PERFORMANCE"
     ```
   - –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:
     - `[Cache] Force refresh requested, skipping cache check`
     - `[WEEKS-PERFORMANCE] Total execution time: XX.XX seconds`
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞:** –í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ `XX.XX` (2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π)
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è:** –í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 2-5 —Å–µ–∫—É–Ω–¥
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:** –õ–æ–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ü–û–°–õ–ï –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–µ—à–µ–º

3. **–¢–µ—Å—Ç —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Ä–µ–º—è –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∂–∏–º—É "months"
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è:**
     ```php
     // Cache hit: 3 –∑–Ω–∞–∫–∞
     round(0.023456, 3); // 0.023
     
     // Cache miss: 2 –∑–Ω–∞–∫–∞
     round(3.456789, 2); // 3.46
     ```
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –ª–æ–≥–∏:**
     ```bash
     # –ò–∑–≤–ª–µ—á—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ –ª–æ–≥–æ–≤
     grep "WEEKS-PERFORMANCE" logs/app/graph-admission-closure-*.log | \
       sed 's/.*: \([0-9.]*\) seconds/\1/' | \
       awk '{if ($1 < 0.1) print "cache hit: " $1; else print "cache miss: " $1}'
     ```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç–æ–¥ handle():

```php
public function handle(array $payload): array
{
    // ... –ø–∞—Ä—Å–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ...
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∂–∏–º–∞ months
    if ($periodMode === 'months') {
        return $this->handleMonthsMode($payload);
    }

    // –ù–µ–¥–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
    $weeksModeStartTime = microtime(true); // TASK-068-04: –ù–∞—á–∞–ª–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
    
    [$weekStart, $weekEnd] = $this->dateHelper->getWeekBounds($weekStartParam, $weekEndParam);
    $weeks = $this->dateHelper->getFourWeeksBounds($weekStart, $weekEnd);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞
    if (!$forceRefresh) {
        $cacheKey = $this->getCacheKeyForWeeks($payload, $weekStart, $weekEnd);
        
        $cachedData = $this->cacheStore->get($cacheKey);
        if ($cachedData !== null) {
            // TASK-068-04: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ cache hit
            $cacheResponseTime = microtime(true) - $weeksModeStartTime;
            error_log("[Cache] Cache hit for key: {$cacheKey}");
            error_log("[WEEKS-PERFORMANCE] Total execution time (from cache): " . round($cacheResponseTime, 3) . " seconds");
            return $cachedData;
        }
        
        error_log("[Cache] Cache miss for key: {$cacheKey}");
    } else {
        error_log("[Cache] Force refresh requested, skipping cache check");
    }

    // ... –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24 ...
    // ... –∞–≥—Ä–µ–≥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ ...
    // ... —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ ...

    $response = [
        'success' => true,
        'meta' => [...],
        'data' => [...]
    ];

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à
    $cacheKey = $this->getCacheKeyForWeeks($payload, $weekStart, $weekEnd);
    if ($this->cacheStore->set($cacheKey, $response, 120)) {
        error_log("[Cache] Cache saved for key: {$cacheKey}");
    }

    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π
    if (rand(1, 10) === 1) {
        $deleted = $this->cacheStore->clearExpired();
        if ($deleted > 0) {
            error_log("[Cache] Cleared {$deleted} expired cache entries");
        }
    }

    // TASK-068-04: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ cache miss
    $weeksModeTotalTime = microtime(true) - $weeksModeStartTime;
    error_log("[WEEKS-PERFORMANCE] Total execution time: " . round($weeksModeTotalTime, 2) . " seconds");

    return $response;
}
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [TASK-068: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "4 –Ω–µ–¥–µ–ª–∏"](./TASK-068-cache-for-weeks-mode.md)
- [TASK-068-03: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è GraphAdmissionClosureService –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è](./TASK-068-03-add-cache-to-service.md)

---

## üìä –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∞–≤–æ–∫

- **2025-12-23 15:01 (UTC+3, –ë—Ä–µ—Å—Ç):** –°–æ–∑–¥–∞–Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

**–ê–≤—Ç–æ—Ä:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0

