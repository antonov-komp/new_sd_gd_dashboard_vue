# TASK-091-02-01: –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–æ–¥—É–ª—è "–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è"

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-12 19:00 (UTC+3, –ë—Ä–µ—Å—Ç)
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ üìã
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** Frontend Developer (Vue.js) + Bitrix24 Developer
**–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞:** [TASK-091-02: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –º–æ–¥—É–ª—è "–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è"](./TASK-091-02-graph-state-module-analysis.md)
**–°–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:** TASK-091-01 (–∞–Ω–∞–ª–∏–∑ DashboardSector1C)
**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** 8 —á–∞—Å–æ–≤

---

## üéØ –¶–µ–ª—å –∑–∞–¥–∞—á–∏

–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–¥—É–ª—è "–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è", –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –≤ –º–Ω–æ–≥–æ—Å–µ–∫—Ç–æ—Ä–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

---

## üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞

### üîç **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞—É–¥–∏—Ç –∑–∞–≤–µ—Ä—à–µ–Ω**
- [x] –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö Vue –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [x] –ê—É–¥–∏—Ç JavaScript/TypeScript —Å–µ—Ä–≤–∏—Å–æ–≤
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ PHP backend —Å–µ—Ä–≤–∏—Å–æ–≤
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- [x] –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- [x] –ê–Ω–∞–ª–∏–∑ —Ç–æ—á–µ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

### üìä **–ö–ª—é—á–µ–≤—ã–µ findings:**

#### 1. **–ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
- `GraphStateChart.vue`: 2000+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
- –°–º–µ—à–∏–≤–∞–Ω–∏–µ 4 —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤ –æ–¥–Ω–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
- 50+ –ø—Ä–æ–ø—Å–æ–≤ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- 30+ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–¥—É–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

#### 2. **–ñ–µ—Å—Ç–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–µ–∫—Ç–æ—Ä—É 1–°**
```javascript
// –ñ–µ—Å—Ç–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ GraphStateService.php
public static function loadSnapshotData(string $type, bool $forceRefresh = false): array
{
    $sectorData = DashboardSector1CService::getSectorDataCached([
        'forceRefresh' => $forceRefresh,
        'ttl' => 600
    ]);
    // –¢–æ–ª—å–∫–æ —Å–µ–∫—Ç–æ—Ä 1–°!
}
```

#### 3. **–°–ª–æ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–ª–µ–ø–∫–æ–≤**
- **4 —Ç–∏–ø–∞ —Å–ª–µ–ø–∫–æ–≤:** `week_start`, `week_end`, `manual`, `current`
- **–ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:** creator, timestamp, version, source
- **JSON —Ö—Ä–∞–Ω–µ–Ω–∏–µ:** –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ–º –ø–æ —Ç–∏–ø—É –∏ –¥–∞—Ç–µ
- **API endpoints:** –°–æ–∑–¥–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–ª–µ–ø–∫–æ–≤

#### 4. **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è**
```php
// Backend –∫–µ—à (PHP)
class GraphStateCache {
    const TTL_CURRENT = 600;    // 10 –º–∏–Ω—É—Ç –¥–ª—è current
    const TTL_SNAPSHOTS = 3600; // 1 —á–∞—Å –¥–ª—è snapshots
    const TTL_WEEK_DATA = 7200; // 2 —á–∞—Å–∞ –¥–ª—è –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
}
```
```javascript
// Frontend –∫–µ—à (Vue composable)
const cacheConfig = {
  tickets: { ttl: 300 },      // 5 –º–∏–Ω—É—Ç
  snapshots: { ttl: 1800 },   // 30 –º–∏–Ω—É—Ç
  chartData: { ttl: 600 }     // 10 –º–∏–Ω—É—Ç
};
```

#### 5. **4 —Ç–∏–ø–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π –≥—Ä–∞—Ñ–∏–∫–æ–≤**
- **–õ–∏–Ω–µ–π–Ω—ã–π:** –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- **–°—Ç–æ–ª–±—á–∞—Ç—ã–π:** –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º/—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
- **–ö–æ–ª—å—Ü–µ–≤–æ–π:** –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞–¥–∏—è–º
- **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π:** –°–æ—á–µ—Ç–∞–Ω–∏–µ –ª–∏–Ω–µ–π–Ω–æ–≥–æ –∏ —Å—Ç–æ–ª–±—á–∞—Ç–æ–≥–æ

#### 6. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
- **Chart.js:** –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (–≤–µ—Ä—Å–∏—è, –ø–ª–∞–≥–∏–Ω—ã)
- **Date handling:** moment.js –∏–ª–∏ date-fns
- **Color schemes:** –¢–µ–º–∏–∑–∞—Ü–∏—è –∏ —Ü–≤–µ—Ç–æ–≤—ã–µ –ø–∞–ª–∏—Ç—Ä—ã
- **Animation settings:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∏–º–∞—Ü–∏–π –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

#### 7. **API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã**
```typescript
interface SnapshotData {
  meta: SnapshotMeta;
  data: SectorData;
}

interface SnapshotMeta {
  type: 'week_start' | 'week_end' | 'manual' | 'current';
  created_at: string;
  version: string;
  source: string;
  createdBy: { id: number; name: string };
  sectorId?: string; // –ù–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –º—É–ª—å—Ç–∏—Å–µ–∫—Ç–æ—Ä–Ω–æ—Å—Ç–∏
}
```

#### 8. **–¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏**
- **DashboardSector1C:** –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞
- **Navigation system:** Breadcrumbs, back button
- **Cache system:** –û–±—â–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä –∫–µ—à–∞
- **Logging system:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Access control:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

---

## üèóÔ∏è **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
GraphStateDashboard.vue (–≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
‚îú‚îÄ‚îÄ LoadingSpinner.vue (–ø—Ä–µ–ª–æ–∞–¥–µ—Ä)
‚îú‚îÄ‚îÄ Error handling (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π)
‚îú‚îÄ‚îÄ Breadcrumbs (–Ω–∞–≤–∏–≥–∞—Ü–∏—è)
‚îú‚îÄ‚îÄ BackButton (–∫–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥)
‚îú‚îÄ‚îÄ GraphStateChart.vue (–û–°–ù–û–í–ù–û–ô –ö–û–ú–ü–û–ù–ï–ù–¢ - 2000+ —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ Chart type selector (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–∏–ø–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ Comparison type selector (—Ç–∏–ø —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ Chart canvas (–æ–±–ª–∞—Å—Ç—å —Ä–∏—Å–æ–≤–∞–Ω–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ Legend (–ª–µ–≥–µ–Ω–¥–∞)
‚îÇ   ‚îî‚îÄ‚îÄ Tooltips (–≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏)
‚îú‚îÄ‚îÄ LoggerControl (–æ—Ç–ª–∞–¥–∫–∞)
‚îî‚îÄ‚îÄ DiagnosticsPanel (–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
```

### –î–µ—Ç–∞–ª—å–Ω–∞—è —Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

#### Frontend Services Layer
```
vue-app/src/services/graph-state/
‚îú‚îÄ‚îÄ useGraphState.js (–≥–ª–∞–≤–Ω—ã–π composable)
‚îÇ   ‚îú‚îÄ‚îÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–ª–µ–ø–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–ª–µ–ø–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ SnapshotService.js (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–µ–ø–∫–∞–º–∏)
‚îÇ   ‚îú‚îÄ‚îÄ createSnapshot(data, type, metadata)
‚îÇ   ‚îú‚îÄ‚îÄ getSnapshotsByTypes(types[])
‚îÇ   ‚îú‚îÄ‚îÄ getSnapshotById(id)
‚îÇ   ‚îî‚îÄ‚îÄ deleteSnapshot(id)
‚îú‚îÄ‚îÄ SectorDataAdapter.js (–∞–¥–∞–ø—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
‚îÇ   ‚îú‚îÄ‚îÄ adaptSectorData(sectorData)
‚îÇ   ‚îú‚îÄ‚îÄ normalizeStages(stages)
‚îÇ   ‚îî‚îÄ‚îÄ calculateMetrics(data)
‚îú‚îÄ‚îÄ snapshot-normalizer.js (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ normalizeSnapshotData(data, type)
‚îÇ   ‚îú‚îÄ‚îÄ validateSnapshotStructure(data)
‚îÇ   ‚îî‚îÄ‚îÄ enrichSnapshotMetadata(data, metadata)
‚îî‚îÄ‚îÄ chart/
    ‚îú‚îÄ‚îÄ ChartDataProcessor.js (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤)
    ‚îú‚îÄ‚îÄ ChartConfigBuilder.js (–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤)
    ‚îî‚îÄ‚îÄ ChartRenderer.js (—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥—Ä–∞—Ñ–∏–∫–æ–≤)
```

#### Backend Services Layer
```
api/services/
‚îú‚îÄ‚îÄ GraphStateService.php (–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚îÇ   ‚îú‚îÄ‚îÄ getSnapshotDataCached(params)
‚îÇ   ‚îú‚îÄ‚îÄ loadSnapshotData(type, forceRefresh)
‚îÇ   ‚îî‚îÄ‚îÄ normalizeSectorDataToSnapshot(sectorData, type)
‚îú‚îÄ‚îÄ GraphStateCache.php (—Ñ–∞–π–ª–æ–≤—ã–π –∫–µ—à)
‚îÇ   ‚îú‚îÄ‚îÄ CACHE_DIR = '/cache/graph-state/'
‚îÇ   ‚îú‚îÄ‚îÄ setSnapshotData(data, type, ttl)
‚îÇ   ‚îú‚îÄ‚îÄ getSnapshotData(type)
‚îÇ   ‚îî‚îÄ‚îÄ invalidateCache()
‚îî‚îÄ‚îÄ DashboardSector1CService.php (–ñ–ï–°–¢–ö–ê–Ø –ó–ê–í–ò–°–ò–ú–û–°–¢–¨)
    ‚îú‚îÄ‚îÄ ENTITY_TYPE_ID = 140
    ‚îú‚îÄ‚îÄ SECTOR_TAG = '1C'
    ‚îî‚îÄ‚îÄ getSectorDataCached(params)
```

#### API Endpoints
```php
// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–ª–µ–ø–∫–æ–≤ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
GET|POST /api/graph-state/snapshots
- type: string (current|week_start|week_end)
- forceRefresh: boolean
- sectorId?: string (–¥–ª—è –º—É–ª—å—Ç–∏—Å–µ–∫—Ç–æ—Ä–Ω–æ—Å—Ç–∏)

// –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–ª–µ–ø–∫–∞
POST /api/graph-state/create-snapshot
{
  "sectorData": {...},
  "type": "week_start",
  "metadata": {
    "createdBy": {"id": 123, "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"},
    "sectorId": "1C"
  }
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Å–ª–µ–ø–∫–∞
DELETE /api/graph-state/snapshot/{id}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö —Å–ª–µ–ø–∫–æ–≤
GET /api/graph-state/snapshots-meta
- sectorId?: string
```

### API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
```typescript
// –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–µ–ø–∫–∞
POST /api/graph-state/create-snapshot
{
  sectorData: SectorData,
  type: 'week_start' | 'week_end' | 'manual' | 'current',
  metadata: {
    createdBy: { id: number, name: string },
    sectorId: string
  }
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–µ–ø–∫–æ–≤ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
GET /api/graph-state/snapshots?sector=1c&type[]=week_start&type[]=week_end
```

---

## ‚ö†Ô∏è **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**

### üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥)

#### 1. **–ñ–µ—Å—Ç–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ DashboardSector1CService**
```javascript
// –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ GraphStateService.php
public static function loadSnapshotData(string $type, bool $forceRefresh = false): array
{
    // –ñ–ï–°–¢–ö–ê–Ø –ó–ê–í–ò–°–ò–ú–û–°–¢–¨ - —Ç–æ–ª—å–∫–æ —Å–µ–∫—Ç–æ—Ä 1–°!
    $sectorData = DashboardSector1CService::getSectorDataCached([
        'forceRefresh' => $forceRefresh,
        'ttl' => 600
    ]);

    return self::normalizeSectorDataToSnapshot($sectorData, $type);
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ–∫—Ç–æ—Ä–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è API

#### 2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ UF_CRM_7_TYPE_PRODUCT = '1C'**
```javascript
// –í DashboardSector1CService.php
const SECTOR_TAG = '1C';
// –§–∏–ª—å—Ç—Ä: UF_CRM_7_TYPE_PRODUCT = '1C'
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –î–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–∏—Ö —Å–µ–∫—Ç–æ—Ä–æ–≤ –±—É–¥—É—Ç –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### 3. **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏ —Å–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å–∞ 140**
```javascript
// –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°
const STAGES = {
  FORMED: { id: 'DT140_12:UC_0VHWE2', name: '–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ' },
  REVIEW: { id: 'DT140_12:PREPARATION', name: '–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó' },
  EXECUTION: { id: 'DT140_12:CLIENT', name: '–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ' }
};
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –¥—Ä—É–≥–∏–µ —Å–µ–∫—Ç–æ—Ä–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç–∞–¥–∏—è–º–∏

#### 4. **–°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞ 1–°**
```javascript
// –û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
{
  stages: {
    'DT140_12:UC_0VHWE2': { tickets: [...], employees: [...] },
    'DT140_12:PREPARATION': { tickets: [...], employees: [...] },
    'DT140_12:CLIENT': { tickets: [...], employees: [...] }
  },
  employees: [...],
  zeroPointTickets: [...]
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –î—Ä—É–≥–∏–µ —Å–µ–∫—Ç–æ—Ä–∞ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –¥—Ä—É–≥—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö

### ‚ö†Ô∏è –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

#### 5. **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Chart.js**
- –í–µ—Ä—Å–∏—è: –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –ü–ª–∞–≥–∏–Ω—ã: –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
- –¢–µ–º–∏–∑–∞—Ü–∏—è: –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ü–≤–µ—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã

#### 6. **–°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è**
```javascript
// –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- GraphStateCache.php (Backend, —Ñ–∞–π–ª—ã)
- useGraphState.js (Frontend, memory)
- Browser Cache API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

#### 7. **–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**
- LoggerControl.vue (–æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Logger
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

#### 8. **–ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**
- Breadcrumbs: –ì–ª–∞–≤–Ω–∞—è / –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- BackButton: –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥
- Route guards: –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤

### ‚úÖ –ù–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

#### 9. **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- LoadingSpinner.vue (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å)
- Error handling (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º)
- Modal dialogs (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ)

#### 10. **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã**
- Date formatting (moment.js ‚Üí date-fns)
- Color utilities (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å)
- Animation helpers (CSS transitions)

### –ù–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- Chart.js library (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å)
- Moment.js (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ date-fns)
- –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

---

## üìã **–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞**

### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ (2 –¥–Ω—è)

#### 1.1 –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
```typescript
// IGraphStateService.ts - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
interface IGraphStateService {
  getSectorData(options?: any): Promise<SectorData>;
  createSnapshot(type: string, metadata: any): Promise<Snapshot>;
  getSnapshots(types: string[]): Promise<Snapshot[]>;
  getStagesConfig(): StageConfig[];
  getMetricsConfig(): MetricConfig[];
}

// ISectorDataAdapter.ts - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö
interface ISectorDataAdapter {
  adaptSectorData(sectorData: any): AdaptedSectorData;
  normalizeStages(stages: any[]): NormalizedStage[];
  calculateMetrics(data: any): MetricsData;
  getStagesConfig(): StageConfig[];
  getFilterConfig(): FilterConfig;
}
```

#### 1.2 Feature flags –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
```javascript
// config/feature-flags.js
export const GRAPH_STATE_FEATURE_FLAGS = {
  MULTI_SECTOR_SUPPORT: false,    // –í–∫–ª—é—á–µ–Ω–∏–µ –º—É–ª—å—Ç–∏—Å–µ–∫—Ç–æ—Ä–Ω–æ—Å—Ç–∏
  NEW_CHART_COMPONENTS: false,    // –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤
  UNIVERSAL_API: false,           // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π API
  SNAPSHOT_MIGRATION: false       // –ú–∏–≥—Ä–∞—Ü–∏—è —Å–ª–µ–ø–∫–æ–≤
};

// –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
if (GRAPH_STATE_FEATURE_FLAGS.MULTI_SECTOR_SUPPORT) {
  // –ù–æ–≤–∞—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
  return UniversalGraphStateService.getSectorData(sectorId);
} else {
  // –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  return DashboardSector1CService.getSectorData();
}
```

#### 1.3 –°–æ–∑–¥–∞–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã—Ö –∞–¥–∞–ø—Ç–µ—Ä–æ–≤
```javascript
// AbstractSectorAdapter.js
export class AbstractSectorAdapter {
  constructor(sectorConfig) {
    this.sectorConfig = sectorConfig;
  }

  // –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã
  adaptSectorData(sectorData) {
    throw new Error('adaptSectorData must be implemented');
  }

  getStagesConfig() {
    throw new Error('getStagesConfig must be implemented');
  }

  getFilterConfig() {
    return {
      field: this.sectorConfig.filterField || 'UF_CRM_7_TYPE_PRODUCT',
      value: this.sectorConfig.sectorTag,
      altValues: this.sectorConfig.altTags || []
    };
  }

  // –û–±—â–∏–µ –º–µ—Ç–æ–¥—ã
  normalizeStages(stages) {
    return stages.map(stage => ({
      id: stage.id,
      name: stage.name || stage.id,
      color: stage.color || '#666',
      ticketsCount: stage.tickets?.length || 0,
      employeesCount: stage.employees?.length || 0
    }));
  }
}

// Sector1CAdapter.js - –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
export class Sector1CAdapter extends AbstractSectorAdapter {
  adaptSectorData(sectorData) {
    // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ–¥ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    return {
      stages: sectorData.stages,
      employees: sectorData.employees,
      zeroPointTickets: sectorData.zeroPointTickets,
      metrics: this.calculateSector1CMetrics(sectorData)
    };
  }

  getStagesConfig() {
    return [
      { id: 'DT140_12:UC_0VHWE2', name: '–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ', color: '#007bff' },
      { id: 'DT140_12:PREPARATION', name: '–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó', color: '#ffc107' },
      { id: 'DT140_12:CLIENT', name: '–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ', color: '#28a745' }
    ];
  }

  calculateSector1CMetrics(data) {
    // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°
    return {
      totalTickets: data.zeroPointTickets.length + Object.values(data.stages).reduce((sum, stage) => sum + stage.tickets.length, 0),
      activeEmployees: data.employees.length,
      stagesCount: Object.keys(data.stages).length
    };
  }
}
```

### –§–∞–∑–∞ 2: –ú–æ–¥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (3 –¥–Ω—è)

#### 2.1 –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è GraphStateChart.vue
```javascript
// –ò—Å—Ö–æ–¥–Ω—ã–π –º–æ–Ω–æ–ª–∏—Ç (2000+ —Å—Ç—Ä–æ–∫)
export default {
  name: 'GraphStateChart',
  props: ['snapshots', 'chartType', 'comparisonType', /* 50+ props */],
  methods: {
    // 30+ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
    prepareLineChartData() { /* 50 —Å—Ç—Ä–æ–∫ */ },
    prepareBarChartData() { /* 40 —Å—Ç—Ä–æ–∫ */ },
    prepareDoughnutChartData() { /* 30 —Å—Ç—Ä–æ–∫ */ },
    renderLineChart() { /* 80 —Å—Ç—Ä–æ–∫ */ },
    renderBarChart() { /* 60 —Å—Ç—Ä–æ–∫ */ },
    // ...
  }
}

// –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏
// components/graph-state/charts/
‚îú‚îÄ‚îÄ BaseChart.vue           // –ë–∞–∑–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≥—Ä–∞—Ñ–∏–∫–∞ (50 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ LineChart.vue           // –õ–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ (30 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ BarChart.vue            // –°—Ç–æ–ª–±—á–∞—Ç—ã–π –≥—Ä–∞—Ñ–∏–∫ (25 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ DoughnutChart.vue       // –ö–æ–ª—å—Ü–µ–≤–æ–π –≥—Ä–∞—Ñ–∏–∫ (20 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ ComboChart.vue          // –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ (40 —Å—Ç—Ä–æ–∫)

// components/graph-state/controls/
‚îú‚îÄ‚îÄ ChartTypeSelector.vue   // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–∏–ø–æ–≤ (15 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ ComparisonSelector.vue  // –í—ã–±–æ—Ä —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (20 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ ChartSettings.vue       // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (25 —Å—Ç—Ä–æ–∫)

// components/graph-state/ui/
‚îú‚îÄ‚îÄ ChartContainer.vue      // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (35 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ ChartLegend.vue         // –õ–µ–≥–µ–Ω–¥–∞ (30 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ ChartTooltip.vue        // –ü–æ–¥—Å–∫–∞–∑–∫–∏ (25 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ ChartZoom.vue           // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (20 —Å—Ç—Ä–æ–∫)
```

#### 2.2 –°–æ–∑–¥–∞–Ω–∏–µ ChartFactory —Å –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π
```javascript
// ChartFactory.js
export class ChartFactory {
  static chartComponents = new Map();
  static preloadedComponents = new Set();

  static registerChart(type, componentLoader) {
    this.chartComponents.set(type, componentLoader);
  }

  static async createChartComponent(type, props = {}) {
    const componentLoader = this.chartComponents.get(type);

    if (!componentLoader) {
      throw new Error(`Chart type "${type}" not registered`);
    }

    try {
      // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
      const module = await componentLoader();
      return module.default;
    } catch (error) {
      console.error(`Failed to load chart component "${type}":`, error);
      // Fallback to base chart
      return (await import('./charts/BaseChart.vue')).default;
    }
  }

  static preloadChart(type) {
    // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    if (this.preloadedComponents.has(type)) return;

    const componentLoader = this.chartComponents.get(type);
    if (componentLoader) {
      componentLoader().then(() => {
        this.preloadedComponents.add(type);
      }).catch(error => {
        console.warn(`Failed to preload chart component "${type}":`, error);
      });
    }
  }

  static preloadCommonCharts() {
    // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–∏–±–æ–ª–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
    ['line', 'bar', 'combo'].forEach(type => this.preloadChart(type));
  }
}

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
ChartFactory.registerChart('line', () => import('./charts/LineChart.vue'));
ChartFactory.registerChart('bar', () => import('./charts/BarChart.vue'));
ChartFactory.registerChart('doughnut', () => import('./charts/DoughnutChart.vue'));
ChartFactory.registerChart('combo', () => import('./charts/ComboChart.vue'));
```

### –§–∞–∑–∞ 3: –£–Ω–∏–≤–µ—Ä—Å–∞–ª–∏–∑–∞—Ü–∏—è API (3 –¥–Ω—è)

#### 3.1 –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
```javascript
// UniversalGraphStateService.js
export class UniversalGraphStateService {
  constructor(sectorId) {
    this.sectorId = sectorId;
    this.sectorConfig = SectorConfigFactory.getConfig(sectorId);
    this.adapter = this.createAdapter(sectorId);
    this.snapshotService = new UniversalSnapshotService(sectorId);
    this.cache = new SectorAwareCache(sectorId);
  }

  createAdapter(sectorId) {
    // –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–∞–ø—Ç–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ —Å–µ–∫—Ç–æ—Ä–∞
    const adapterMap = {
      '1c': () => new Sector1CAdapter(this.sectorConfig),
      'pdm': () => new SectorPDMAdapter(this.sectorConfig),
      'bitrix24': () => new SectorBitrix24Adapter(this.sectorConfig),
      'infrastructure': () => new SectorInfrastructureAdapter(this.sectorConfig)
    };

    const adapterFactory = adapterMap[sectorId];
    if (!adapterFactory) {
      throw new Error(`Unknown sector: ${sectorId}`);
    }

    return adapterFactory();
  }

  async getSectorData(options = {}) {
    const cacheKey = `sectorData:${JSON.stringify(options)}`;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à
    if (!options.forceRefresh) {
      const cached = this.cache.get(cacheKey);
      if (cached) return cached;
    }

    try {
      // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π API
      const rawData = await SectorDataService.getSectorData(this.sectorId, options);

      // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥ –Ω—É–∂–¥—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤
      const adaptedData = this.adapter.adaptSectorData(rawData);

      // –ö–µ—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      this.cache.set(cacheKey, adaptedData, 300); // 5 –º–∏–Ω—É—Ç

      return adaptedData;
    } catch (error) {
      console.error(`Failed to get sector data for ${this.sectorId}:`, error);
      throw error;
    }
  }

  async createSnapshot(type, metadata = {}) {
    const sectorData = await this.getSectorData();
    const snapshotData = this.adapter.normalizeForSnapshot(sectorData, type);

    return this.snapshotService.createSnapshot(snapshotData, {
      ...metadata,
      sectorId: this.sectorId,
      createdAt: new Date().toISOString()
    });
  }

  async getSnapshotsForChart(types) {
    return this.snapshotService.getSnapshotsByTypes(types, this.sectorId);
  }

  getStagesConfig() {
    return this.adapter.getStagesConfig();
  }

  getMetricsConfig() {
    return this.adapter.getMetricsConfig();
  }

  // –ú–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞ —Å–µ–∫—Ç–æ—Ä–∞
  clearCache() {
    this.cache.clear();
  }
}
```

#### 3.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ useGraphState composable
```javascript
// useUniversalGraphState.js
import { ref, computed } from 'vue';
import { UniversalGraphStateService } from '@/services/graph-state/UniversalGraphStateService.js';
import { useNotifications } from './useNotifications.js';

export function useUniversalGraphState(sectorId) {
  const service = ref(null);
  const isLoading = ref(false);
  const error = ref(null);
  const notifications = useNotifications();

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
  const initService = () => {
    if (!service.value) {
      service.value = new UniversalGraphStateService(sectorId);
    }
    return service.value;
  };

  // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –ª—é–±–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞
  const loadSectorData = async (options = {}) => {
    const svc = initService();
    isLoading.value = true;
    error.value = null;

    try {
      const data = await svc.getSectorData(options);
      return data;
    } catch (err) {
      error.value = err;
      notifications.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞', err.message);
      throw err;
    } finally {
      isLoading.value = false;
    }
  };

  const createSnapshot = async (type, metadata = {}) => {
    const svc = initService();

    try {
      const snapshot = await svc.createSnapshot(type, metadata);
      notifications.success('–°–ª–µ–ø–æ–∫ —Å–æ–∑–¥–∞–Ω', `–°–ª–µ–ø–æ–∫ "${type}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`);
      return snapshot;
    } catch (err) {
      notifications.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞', err.message);
      throw err;
    }
  };

  const getSnapshotsForChart = async (types) => {
    const svc = initService();

    try {
      return await svc.getSnapshotsForChart(types);
    } catch (err) {
      notifications.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–µ–ø–∫–æ–≤', err.message);
      throw err;
    }
  };

  // –í—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
  const stagesConfig = computed(() => {
    const svc = service.value;
    return svc ? svc.getStagesConfig() : [];
  });

  const metricsConfig = computed(() => {
    const svc = service.value;
    return svc ? svc.getMetricsConfig() : {};
  });

  const clearCache = () => {
    const svc = service.value;
    if (svc) svc.clearCache();
  };

  return {
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ
    isLoading: readonly(isLoading),
    error: readonly(error),

    // –ú–µ—Ç–æ–¥—ã
    loadSectorData,
    createSnapshot,
    getSnapshotsForChart,
    clearCache,

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    stagesConfig,
    metricsConfig
  };
}
```

### –§–∞–∑–∞ 4: –ú–∏–≥—Ä–∞—Ü–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (2 –¥–Ω—è)

#### 4.1 –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–ª–µ–ø–∫–æ–≤
```javascript
// SnapshotMigrationService.js
export class SnapshotMigrationService {
  static async migrateExistingSnapshots() {
    const existingSnapshots = await this.getAllExistingSnapshots();
    let migratedCount = 0;
    let errorCount = 0;

    console.log(`Starting migration of ${existingSnapshots.length} snapshots...`);

    for (const snapshot of existingSnapshots) {
      try {
        if (!snapshot.meta.sectorId) {
          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Å–ª–µ–ø–∫–æ–≤
          snapshot.meta.sectorId = await this.detectSector(snapshot.data);
          snapshot.meta.migrated = true;
          snapshot.meta.migratedAt = new Date().toISOString();
          snapshot.meta.version = '2.0'; // –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞

          await this.saveMigratedSnapshot(snapshot);
          migratedCount++;
        }
      } catch (error) {
        console.error(`Failed to migrate snapshot ${snapshot.id}:`, error);
        errorCount++;
      }
    }

    console.log(`Migration completed: ${migratedCount} migrated, ${errorCount} errors`);
    return { migratedCount, errorCount };
  }

  static async detectSectorFromSnapshot(snapshot) {
    // –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö —Å–ª–µ–ø–∫–∞
    const data = snapshot.data;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å—Ç–∞–¥–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã—Ö –¥–ª—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°
    if (data.stages && data.stages['DT140_12:UC_0VHWE2']) {
      return '1C';
    }

    // –ê–Ω–∞–ª–∏–∑ –¥—Ä—É–≥–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
    if (data.zeroPointTickets && Array.isArray(data.zeroPointTickets)) {
      // –¢–∏–ø–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°
      return '1C';
    }

    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —Å–µ–∫—Ç–æ—Ä 1–° –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    return '1C';
  }

  static async getAllExistingSnapshots() {
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–ª–µ–ø–∫–æ–≤ –∏–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
    return SnapshotService.getAllSnapshots();
  }

  static async saveMigratedSnapshot(snapshot) {
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ª–µ–ø–∫–∞
    const fileName = this.generateMigratedFileName(snapshot);
    const filePath = `/cache/graph-state/${fileName}`;

    await this.writeJsonFile(filePath, snapshot);
  }

  static generateMigratedFileName(snapshot) {
    const type = snapshot.meta.type;
    const timestamp = new Date(snapshot.meta.created_at).getTime();
    const sectorId = snapshot.meta.sectorId;

    return `snapshot_${sectorId}_${type}_${timestamp}_v2.json`;
  }
}
```

#### 4.2 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```javascript
// PerformanceOptimizer.js
export class GraphPerformanceOptimizer {
  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–æ–ª—å—à–∏—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
  static optimizeChartData(data, maxPoints = 1000) {
    if (!Array.isArray(data) || data.length <= maxPoints) {
      return data;
    }

    // –°–µ–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫
    const step = Math.floor(data.length / maxPoints);
    const optimized = [];

    for (let i = 0; i < data.length; i += step) {
      optimized.push(data[i]);
    }

    // –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç–æ—á–∫—É
    if (optimized[optimized.length - 1] !== data[data.length - 1]) {
      optimized.push(data[data.length - 1]);
    }

    return optimized;
  }

  // –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö
  static createVirtualizedData(data, viewportSize = 100) {
    return new VirtualizedChartData(data, {
      viewportSize,
      itemHeight: 20, // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è –≤—ã—Å–æ—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
      containerHeight: 400
    });
  }

  // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≥—Ä–∞—Ñ–∏–∫–æ–≤
  static preloadChartComponents(types = ['line', 'bar', 'doughnut', 'combo']) {
    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–∏–±–æ–ª–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    const preloadPromises = types.map(type => {
      return ChartFactory.preloadChart(type).catch(error => {
        console.warn(`Failed to preload chart ${type}:`, error);
      });
    });

    return Promise.allSettled(preloadPromises);
  }

  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ Chart.js
  static optimizeChartRendering(chart, options = {}) {
    const { animation = false, responsive = true } = options;

    // –û—Ç–∫–ª—é—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    if (!animation) {
      chart.options.animation = false;
    }

    // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å
    if (responsive) {
      chart.options.responsive = true;
      chart.options.maintainAspectRatio = false;
    }

    // –£–º–µ–Ω—å—à–∞–µ–º —á–∞—Å—Ç–æ—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
    chart.options.interaction = {
      ...chart.options.interaction,
      throttle: 100 // ms
    };
  }

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
  static cleanupChart(chart) {
    if (chart) {
      chart.destroy();
    }
  }
}
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–æ–¥—É–ª—è
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- [x] –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- [x] –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤
- [x] –í—ã–¥–µ–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [x] –û—Ü–µ–Ω–µ–Ω—ã —Ä–∏—Å–∫–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- [x] –ü—Ä–µ–¥–ª–æ–∂–µ–Ω—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É
- [x] –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è TASK-091-02-02 –≥–æ—Ç–æ–≤–∞
- [x] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] –ü–ª–∞–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –î–∞—Ç–∞ | –ê–≤—Ç–æ—Ä | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-------|-----------|
| 2026-01-12 | AI Assistant | –°–æ–∑–¥–∞–Ω –∞–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–¥—É–ª—è "–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è" |