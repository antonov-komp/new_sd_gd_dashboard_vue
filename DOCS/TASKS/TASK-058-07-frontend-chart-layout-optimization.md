# TASK-058-07: Frontend — оптимизация расположения элементов графиков

**Дата создания:** 2025-12-18 10:00 (UTC+3, Брест)  
**Статус:** 📝 Черновик  
**Приоритет:** Средний  
**Исполнитель:** Bitrix24 Программист (Vue.js Developer)  
**Родительская задача:** [TASK-058: Улучшение модуля "График приема и закрытий сектора 1С" — режим 3 месяца](./TASK-058-enrichment-3-months-mode.md)  
**Этап:** 7 из 7  
**Зависимости:** TASK-058-04, TASK-058-05 (Графики должны иметь сводные итоги)

---

## 📋 Описание

Оптимизировать визуальное расположение элементов графиков "Новые и Закрытые тикеты" и "Переходящие тикеты" для более эффективного использования пространства экрана. Уменьшить размер графиков на 60%, сохранить размер легенды, и разместить сводные итоги справа от графиков вместо под ними.

---

## 🎯 Контекст

### Текущее состояние

**Файл:** `vue-app/src/components/graph-admission-closure/LineChartMonths.vue`

**Текущая структура визуала:**

```
┌─────────────────────────────────────────────────┐
│ Новые и Закрытые тикеты (Октябрь – Декабрь 2025)│
├─────────────────────────────────────────────────┤
│                                                 │
│  [Легенда]  │  [Сам график]                    │
│  (слева)    │  (занимает всю ширину)            │
│             │                                   │
│             │                                   │
├─────────────────────────────────────────────────┤
│ Сводный итог                                    │
│ (под графиком, занимает всю ширину)            │
└─────────────────────────────────────────────────┘
```

**Проблемы:**
- График занимает слишком много места по вертикали
- Сводный итог расположен под графиком, что увеличивает общую высоту секции
- Неэффективное использование горизонтального пространства
- Сводные итоги и график не видны одновременно без прокрутки

### Требуемое состояние

**Новая структура визуала:**

```
┌─────────────────────────────────────────────────────────┐
│ Новые и Закрытые тикеты (Октябрь – Декабрь 2025)        │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  [Легенда]  │  [Сам график]  │  [Сводный итог]         │
│  (слева)    │  (уменьшен     │  (справа от графика)     │
│  (тот же    │   на 60%)      │                          │
│   размер)   │               │  • Новые: ...            │
│             │               │  • Закрытые: ...          │
│             │               │  • Анализ: ...             │
└─────────────────────────────────────────────────────────┘
```

**Преимущества:**
- Экономия вертикального пространства (график уменьшен на 60%)
- Сводный итог и график видны одновременно
- Более эффективное использование горизонтального пространства
- Объективная оценка данных в одном месте (график + итоги рядом)

---

## 🔍 Детализация требований

### 1. Уменьшение размера графиков

**Требования:**
- Высота графика должна быть уменьшена на 60%
- Текущая высота: `400px` → Новая высота: `160px` (400 × 0.4 = 160)
- Ширина графика должна занимать ~60% доступного пространства (остальное для сводного итога)
- График должен оставаться читаемым и функциональным

**Техническая реализация:**
- Изменить `height` в `.chart-container` с `400px` на `160px`
- Использовать flexbox для размещения графика и сводного итога рядом
- График должен занимать ~60% ширины контейнера

### 2. Сохранение размера легенды

**Требования:**
- Легенда должна оставаться того же размера
- Размер шрифта, отступы, иконки — без изменений
- Легенда остается слева от графика

**Техническая реализация:**
- Не изменять конфигурацию легенды в `chartOptions`
- Легенда автоматически подстроится под уменьшенный график

### 3. Размещение сводного итога справа

**Требования:**
- Сводный итог должен быть размещен справа от графика
- Ширина сводного итога: ~35-40% от ширины контейнера
- Сводный итог должен быть выровнен по верхнему краю с графиком
- Вертикальное выравнивание: по верхнему краю

**Техническая реализация:**
- Создать flex-контейнер для графика и сводного итога
- Использовать `display: flex` с `flex-direction: row`
- График: `flex: 0 0 60%` или `width: 60%`
- Сводный итог: `flex: 0 0 35%` или `width: 35%`
- Добавить `gap` между элементами

### 4. Применение к обоим графикам

**Требования:**
- Изменения должны быть применены к обоим графикам:
  - "Новые и Закрытые тикеты"
  - "Переходящие тикеты"

**Техническая реализация:**
- Использовать общие стили для обоих графиков
- Применить одинаковую структуру разметки

---

## 🔧 Техническая реализация

### Структура разметки

**Текущая структура:**
```vue
<div class="chart-section">
  <h3 class="chart-title">...</h3>
  <div class="chart-container">
    <Line :data="..." :options="..." />
  </div>
  <div class="chart-summary">
    <!-- Сводный итог -->
  </div>
</div>
```

**Новая структура:**
```vue
<div class="chart-section">
  <h3 class="chart-title">...</h3>
  <div class="chart-wrapper">
    <div class="chart-container">
      <Line :data="..." :options="..." />
    </div>
    <div class="chart-summary">
      <!-- Сводный итог -->
    </div>
  </div>
</div>
```

### Стили

**Текущие стили:**
```css
.chart-container {
  width: 100%;
  height: 400px;
  position: relative;
}

.chart-summary {
  margin-top: 24px;
  padding: 20px;
  /* ... */
}
```

**Новые стили:**
```css
.chart-wrapper {
  display: flex;
  flex-direction: row;
  gap: 20px;
  align-items: flex-start;
}

.chart-container {
  flex: 0 0 60%;
  width: 60%;
  height: 160px; /* Уменьшено на 60%: 400px × 0.4 = 160px */
  position: relative;
}

.chart-summary {
  flex: 0 0 35%;
  width: 35%;
  margin-top: 0; /* Убрать отступ сверху */
  padding: 20px;
  /* ... */
}
```

### Адаптивность

**Для мобильных устройств:**
```css
@media (max-width: 768px) {
  .chart-wrapper {
    flex-direction: column; /* Вертикальная компоновка на мобильных */
  }
  
  .chart-container {
    flex: 0 0 100%;
    width: 100%;
    height: 200px; /* Немного больше на мобильных для читаемости */
  }
  
  .chart-summary {
    flex: 0 0 100%;
    width: 100%;
    margin-top: 16px; /* Вернуть отступ сверху на мобильных */
  }
}
```

---

## 📐 Визуальная схема

### До изменений:
```
┌────────────────────────────────────────────┐
│ Заголовок                                  │
├────────────────────────────────────────────┤
│                                            │
│  [Легенда]  │  [График 400px высота]      │
│             │                              │
│             │                              │
│             │                              │
├────────────────────────────────────────────┤
│ Сводный итог (полная ширина)              │
│ • Новые: ...                               │
│ • Закрытые: ...                            │
│ • Анализ: ...                              │
└────────────────────────────────────────────┘
Общая высота: ~600px
```

### После изменений:
```
┌──────────────────────────────────────────────────────┐
│ Заголовок                                            │
├──────────────────────────────────────────────────────┤
│                                                      │
│  [Легенда]  │  [График 160px]  │  [Сводный итог]    │
│             │  (60% ширины)    │  (35% ширины)      │
│             │                  │  • Новые: ...       │
│             │                  │  • Закрытые: ...    │
│             │                  │  • Анализ: ...      │
└──────────────────────────────────────────────────────┘
Общая высота: ~250px (экономия ~350px)
```

---

## ✅ Критерии приёмки

- [ ] Размер графиков уменьшен на 60% (высота: 400px → 160px)
- [ ] Легенда осталась того же размера (шрифт, отступы, иконки)
- [ ] Сводный итог размещен справа от графика
- [ ] График и сводный итог видны одновременно без прокрутки
- [ ] Изменения применены к обоим графикам:
  - [ ] "Новые и Закрытые тикеты"
  - [ ] "Переходящие тикеты"
- [ ] График остается читаемым и функциональным
- [ ] Адаптивность работает корректно на мобильных устройствах
- [ ] Нет визуальных артефактов или перекрытий
- [ ] Вертикальное пространство экономится эффективно

---

## 🔧 Детальная реализация

### Шаг 1: Обновить структуру разметки для графика "Новые и Закрытые тикеты"

**Файл:** `vue-app/src/components/graph-admission-closure/LineChartMonths.vue`

```vue
<!-- График "Новые и Закрытые тикеты" -->
<div class="chart-section">
  <h3 class="chart-title">
    Новые и Закрытые тикеты
    <span v-if="chartPeriod" class="chart-period">({{ chartPeriod }})</span>
  </h3>
  <!-- TASK-058-07: Обертка для графика и сводного итога -->
  <div class="chart-wrapper">
    <div class="chart-container">
      <Line :data="newClosedChartData" :options="chartOptions" />
    </div>
    <!-- TASK-058-07: Сводный итог справа от графика -->
    <div class="chart-summary">
      <h4 class="summary-title">Сводный итог</h4>
      <div class="summary-numbers">
        <div class="summary-row">
          <span class="summary-label">Новые:</span>
          <span class="summary-values">{{ summaryNumbers.new }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Закрытые:</span>
          <span class="summary-values">{{ summaryNumbers.closed }}</span>
        </div>
      </div>
      <div class="summary-analysis">
        <p v-for="(analysis, index) in summaryAnalysis" :key="index">
          {{ analysis }}
        </p>
      </div>
    </div>
  </div>
</div>
```

### Шаг 2: Обновить структуру разметки для графика "Переходящие тикеты"

```vue
<!-- График "Переходящие тикеты" -->
<div class="chart-section">
  <h3 class="chart-title">
    Переходящие тикеты
    <span v-if="carryoverChartPeriod" class="chart-period">({{ carryoverChartPeriod }})</span>
  </h3>
  <!-- TASK-058-07: Обертка для графика и анализа -->
  <div class="chart-wrapper">
    <div class="chart-container">
      <Line :data="carryoverChartData" :options="chartOptions" />
    </div>
    <!-- TASK-058-07: Анализ справа от графика -->
    <div class="chart-analysis">
      <h4 class="analysis-title">Анализ</h4>
      <div class="analysis-content">
        <p v-for="(analysis, index) in carryoverAnalysis" :key="index">
          {{ analysis }}
        </p>
      </div>
    </div>
  </div>
</div>
```

### Шаг 3: Обновить стили

```css
/* TASK-058-07: Обертка для графика и сводного итога */
.chart-wrapper {
  display: flex;
  flex-direction: row;
  gap: 20px;
  align-items: flex-start;
  width: 100%;
}

.chart-container {
  flex: 0 0 60%;
  width: 60%;
  height: 160px; /* TASK-058-07: Уменьшено на 60% (было 400px) */
  position: relative;
}

.chart-summary {
  flex: 0 0 35%;
  width: 35%;
  margin-top: 0; /* TASK-058-07: Убрать отступ сверху, так как теперь справа */
  padding: 20px;
  background-color: var(--b24-bg-light, #f9fafb);
  border-radius: 8px;
  border: 1px solid var(--b24-border-light, #e5e7eb);
}

.chart-analysis {
  flex: 0 0 35%;
  width: 35%;
  margin-top: 0; /* TASK-058-07: Убрать отступ сверху, так как теперь справа */
  padding: 20px;
  background-color: var(--b24-bg-light, #f9fafb);
  border-radius: 8px;
  border: 1px solid var(--b24-border-light, #e5e7eb);
}

/* Адаптивность */
@media (max-width: 768px) {
  .chart-wrapper {
    flex-direction: column; /* Вертикальная компоновка на мобильных */
  }
  
  .chart-container {
    flex: 0 0 100%;
    width: 100%;
    height: 200px; /* Немного больше на мобильных для читаемости */
  }
  
  .chart-summary,
  .chart-analysis {
    flex: 0 0 100%;
    width: 100%;
    margin-top: 16px; /* Вернуть отступ сверху на мобильных */
  }
}
```

---

## 🎨 Визуальные улучшения

### Преимущества новой компоновки:

1. **Экономия пространства:**
   - Вертикальное пространство: ~350px (с ~600px до ~250px)
   - Горизонтальное пространство используется эффективнее

2. **Улучшенная читаемость:**
   - График и сводный итог видны одновременно
   - Не нужно прокручивать страницу для просмотра итогов
   - Объективная оценка данных в одном месте

3. **Лучший UX:**
   - Пользователь видит график и анализ одновременно
   - Быстрее восприятие информации
   - Меньше когнитивной нагрузки

---

## ⚠️ Примечания

- **Важно:** График должен оставаться читаемым после уменьшения размера
- **Важно:** Легенда должна оставаться того же размера для читаемости
- **Адаптивность:** На мобильных устройствах компоновка должна быть вертикальной
- **Тестирование:** Обязательно протестировать на разных размерах экрана
- **Производительность:** Изменения не должны влиять на производительность отрисовки графиков

---

## 🐛 Типичные ошибки и их решения

### Ошибка 1: График слишком маленький и нечитаемый

**Причина:** Слишком большое уменьшение размера

**Решение:**
- Проверить, что высота не меньше 160px
- Убедиться, что шрифты и элементы графика масштабируются корректно
- При необходимости увеличить высоту до 180-200px

### Ошибка 2: Сводный итог перекрывает график

**Причина:** Неправильная ширина flex-элементов

**Решение:**
- Проверить, что сумма ширин не превышает 100%
- Использовать `flex: 0 0 60%` и `flex: 0 0 35%` вместо фиксированных значений
- Добавить `gap` между элементами

### Ошибка 3: На мобильных устройствах элементы не переносятся

**Причина:** Неправильные медиа-запросы

**Решение:**
- Проверить, что `flex-direction: column` применяется на мобильных
- Убедиться, что ширина элементов становится 100% на мобильных
- Проверить отступы и зазоры

---

## 📝 История правок

- **2025-12-18 10:00 (UTC+3, Брест):** Создана задача TASK-058-07
  - Описана проблема с неэффективным использованием пространства
  - Предложена новая компоновка с графиком и сводным итогом рядом
  - Добавлены детальные инструкции по реализации
  - Добавлены визуальные схемы до/после

---

## 🔗 Зависимости

- **TASK-058-04:** График "Новые и закрытые тикеты" должен иметь сводный итог
- **TASK-058-05:** График "Переходящие тикеты" должен иметь анализ
- **TASK-058-06:** Легенда должна быть размещена слева

---

## 📊 Оценка времени выполнения

**Ориентировочно:** 2-3 часа

**Разбивка:**
- Изменение структуры разметки: 30 минут
- Обновление стилей: 1 час
- Тестирование и отладка: 30 минут - 1 час
- Адаптивность: 30 минут

---

**Статус:** 📝 Готово к реализации

