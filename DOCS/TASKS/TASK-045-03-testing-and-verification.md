# TASK-045-03: Тестирование и проверка обогащения данных тикетов

**Дата создания:** 2025-12-16 20:00 (UTC+3, Брест)  
**Статус:** В работе  
**Приоритет:** Высокий  
**Исполнитель:** Bitrix24 Программист (Vue.js Developer)  
**Связь с задачей:** TASK-045

## Цель

Провести полное тестирование обогащения данных тикетов в попапах `ResponsibleModal` и `StagesModal`, убедиться, что все поля загружаются корректно и визуальное отображение идентично модулю «График состояния».

## Контекст

**После выполнения TASK-045-01 и TASK-045-02:**
- Оба компонента используют `prepareTicketsForDisplay()` для обогащения данных
- Необходимо проверить, что все поля загружаются корректно
- Убедиться, что визуальное отображение соответствует ожиданиям
- Проверить производительность и обработку ошибок

## Области тестирования

### 1. Функциональное тестирование

**ResponsibleModal:**
- [ ] Открытие попапа при клике на «Закрытые» на графике
- [ ] Отображение списка сотрудников с полными именами
- [ ] Переход на уровень 2 при клике на сотрудника
- [ ] Отображение тикетов с полной информацией:
  - [ ] `departmentHead` (отдел заказчика) в правом верхнем углу
  - [ ] `ufSubject` (полное название) вместо только `title`
  - [ ] `actionStr` (если есть) как чип
  - [ ] `description` (если есть)
  - [ ] Правильные приоритеты с цветами
  - [ ] Правильные сервисы с цветами
- [ ] Кнопка «Назад» возвращает на уровень 1
- [ ] Обработка пустого списка тикетов

**StagesModal:**
- [ ] Открытие попапа при клике на «Новые» на графике
- [ ] Отображение списка стадий с количеством тикетов
- [ ] Переход на уровень 2 при клике на стадию
- [ ] Отображение тикетов с полной информацией:
  - [ ] `departmentHead` (отдел заказчика) в правом верхнем углу
  - [ ] `ufSubject` (полное название) вместо только `title`
  - [ ] `actionStr` (если есть) как чип
  - [ ] `description` (если есть)
  - [ ] Правильные приоритеты с цветами
  - [ ] Правильные сервисы с цветами
- [ ] Кнопка «Назад» возвращает на уровень 1
- [ ] Обработка пустого списка тикетов

### 2. Визуальное тестирование

**Сравнение с модулем «График состояния»:**
- [ ] Визуальное отображение тикетов идентично `EmployeeDetailsModal`
- [ ] Карточки тикетов (`TicketCard`) отображаются одинаково
- [ ] Цвета приоритетов и сервисов соответствуют конфигурации
- [ ] Отступы и стили соответствуют дизайн-системе
- [ ] Анимации и переходы работают плавно

### 3. Тестирование производительности

- [ ] Загрузка тикетов не занимает более 2-3 секунд
- [ ] Используется кеш `TicketDetailsService` (проверить в консоли)
- [ ] Батч-загрузка работает корректно (один запрос для нескольких тикетов)
- [ ] Нет лишних запросов к API при повторном открытии попапа

### 4. Тестирование обработки ошибок

**Сценарии ошибок:**
- [ ] Ошибка загрузки тикетов из API (fallback на исходные тикеты)
- [ ] Ошибка подготовки тикетов через `prepareTicketsForDisplay()` (fallback)
- [ ] Отсутствие данных в API (пустой массив тикетов)
- [ ] Частичное отсутствие данных (например, нет `departmentHead`)

**Проверка:**
- [ ] Ошибки логируются в консоль
- [ ] Пользователю показывается понятное сообщение (если требуется)
- [ ] Приложение не падает при ошибках
- [ ] Fallback работает корректно

### 5. Тестирование граничных случаев

- [ ] Тикеты без `departmentHead` (не отображается, не ломает UI)
- [ ] Тикеты без `ufSubject` (используется `title` как fallback)
- [ ] Тикеты без `actionStr` (чип не отображается)
- [ ] Тикеты без `description` (описание не отображается)
- [ ] Тикеты с неопределённым приоритетом (используется fallback)
- [ ] Тикеты с неопределённым сервисом (используется fallback)
- [ ] Большое количество тикетов (50+)
- [ ] Пустой список тикетов

## Чек-лист проверки полей тикетов

Для каждого тикета проверить наличие полей:

- [ ] `id` — ID тикета
- [ ] `ufSubject` — полное название (приоритетное поле)
- [ ] `title` — название (fallback для `ufSubject`)
- [ ] `departmentHead` — отдел заказчика (короткое название)
- [ ] `departmentHeadFull` — отдел заказчика (полное название)
- [ ] `actionStr` — действие (если есть)
- [ ] `description` — описание (если есть)
- [ ] `priorityId` — ID приоритета
- [ ] `priorityLabel` — название приоритета
- [ ] `priorityColors` — цвета приоритета (color, backgroundColor, textColor)
- [ ] `serviceId` — ID сервиса (если есть)
- [ ] `serviceLabel` — название сервиса (если есть)
- [ ] `serviceColors` — цвета сервиса (если есть)
- [ ] `createdAt` — дата создания (форматированная)
- [ ] `updatedAt` — дата обновления (форматированная)
- [ ] `assignedTo` — объект с `id` и `name` сотрудника
- [ ] `stageId` — ID стадии

## Сравнение с эталоном

**Эталон:** Модуль «График состояния сектора 1С» (`EmployeeDetailsModal.vue`)

**Проверить:**
- [ ] Структура данных тикетов идентична
- [ ] Визуальное отображение идентично
- [ ] Поведение при ошибках идентично
- [ ] Производительность сопоставима

## Инструменты для тестирования

1. **Консоль браузера:**
   - Проверка логов загрузки данных
   - Проверка производительности (`console.time` / `console.timeEnd`)
   - Проверка ошибок

2. **DevTools:**
   - Network tab — проверка запросов к API
   - Performance tab — проверка производительности
   - Elements tab — проверка структуры DOM

3. **Ручное тестирование:**
   - Открытие попапов в разных сценариях
   - Проверка визуального отображения
   - Проверка интерактивности

## Критерии приёмки

- [ ] Все функциональные тесты пройдены
- [ ] Визуальное отображение идентично модулю «График состояния»
- [ ] Производительность соответствует требованиям
- [ ] Обработка ошибок работает корректно
- [ ] Граничные случаи обработаны
- [ ] Все поля тикетов загружаются и отображаются корректно
- [ ] Нет регрессий в существующей функциональности

## История правок

- 2025-12-16 20:00 (UTC+3, Брест): Создана подзадача для тестирования и проверки обогащения данных тикетов

