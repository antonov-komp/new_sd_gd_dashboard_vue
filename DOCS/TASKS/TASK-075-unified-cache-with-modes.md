# TASK-075: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–µ—à–∞ ‚Äî –ø–µ—Ä–µ–¥–µ–ª–∫–∞ 4 –º–æ–¥—É–ª–µ–π –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø —Å —Ä–µ–∂–∏–º–∞–º–∏

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-24 14:52 (UTC+3, –ë—Ä–µ—Å—Ç)  
**–°—Ç–∞—Ç—É—Å:** –ß–µ—Ä–Ω–æ–≤–∏–∫ (Draft)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** Bitrix24 –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç (Vue.js)  
**–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞:** –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–µ—à–∞ (DOCS/ANALYSIS/cache-usage-analysis.md)

---

## üìå –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

**–ß—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è:**
- –ü–µ—Ä–µ–¥–µ–ª–∫–∞ –∫–µ—à–∞ –¥–ª—è 4 –º–æ–¥—É–ª–µ–π –Ω–∞ –µ–¥–∏–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∂–∏–º–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–∞–ª–æ–Ω–∞ `GraphAdmissionClosureCache` –∫–∞–∫ –æ–±—Ä–∞–∑—Ü–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–∂–∏–º–æ–≤ —á–µ—Ä–µ–∑ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –†–∞–∑–Ω—ã–µ TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
- –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- **4 –º–æ–¥—É–ª—è –¥–ª—è –ø–µ—Ä–µ–¥–µ–ª–∫–∏:**
  1. `TimeTrackingCache` ‚Äî –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∂–∏–º–æ–≤ (default, detailed, summary)
  2. `UsersManagementCache` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∂–∏–º–æ–≤ (departments, users, config)
  3. `UserActivityCache` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∂–∏–º–æ–≤ (stats, list, filters)
  4. `WebhookLogsCache` ‚Äî –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∂–∏–º–æ–≤ (api, realtime, stats)

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã (–∏–∑ —ç—Ç–∞–ª–æ–Ω–∞ GraphAdmissionClosureCache):**
- –†–µ–∂–∏–º—ã —á–µ—Ä–µ–∑ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: `{module-name}/{mode}/`
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞: `{mode}_{hash}`
- –†–∞–∑–Ω—ã–µ TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ —è–≤–Ω–æ)
- –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~16-24 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è-–í—ã—Å–æ–∫–∞—è

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –∫–µ—à –¥–ª—è 4 –º–æ–¥—É–ª–µ–π –Ω–∞ –µ–¥–∏–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∂–∏–º–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—è `GraphAdmissionClosureCache` –∫–∞–∫ —ç—Ç–∞–ª–æ–Ω. –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∑–∞–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤.

**–¶–µ–ª—å:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö, —É–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

---

## üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:

**–≠—Ç–∞–ª–æ–Ω (GraphAdmissionClosureCache):**
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∂–∏–º–æ–≤ —á–µ—Ä–µ–∑ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (`months/`, `weeks/`)
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞ (`weeks_` –∏–ª–∏ `months_`)
- ‚úÖ –†–∞–∑–Ω—ã–µ TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ (5 –º–∏–Ω –¥–ª—è months, 2 –º–∏–Ω –¥–ª—è weeks)
- ‚úÖ –ú–µ—Ç–æ–¥ `clearByMode()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
- ‚úÖ –ú–µ—Ç–æ–¥ `generateKey()` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π —Å —É—á–µ—Ç–æ–º —Ä–µ–∂–∏–º–∞

**–ú–æ–¥—É–ª–∏ –¥–ª—è –ø–µ—Ä–µ–¥–µ–ª–∫–∏:**

1. **TimeTrackingCache** ‚Äî —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
   - ‚ùå –û–¥–∏–Ω —Ä–µ–∂–∏–º (–Ω–µ—Ç –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π)
   - ‚ùå –û–¥–∏–Ω TTL (5 –º–∏–Ω—É—Ç)
   - ‚ùå –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–∂–∏–º–æ–≤

2. **UsersManagementCache** ‚Äî –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
   - ‚ùå –ö–µ—à –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
   - ‚ùå –ú–æ–¥—É–ª—å "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏" –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à

3. **UserActivityCache** ‚Äî –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
   - ‚ùå –ö–µ—à –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
   - ‚ùå –ú–æ–¥—É–ª—å "–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏" –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à

4. **WebhookLogsCache** ‚Äî —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):
   - ‚ùå –í–æ–∑–º–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥
   - ‚ùå –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–µ—Ä–µ–¥–µ–ª–∫–∏

### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

- **–≠—Ç–∞–ª–æ–Ω:** `api/cache/GraphAdmissionClosureCache.php`
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∂–∏–º–æ–≤ `months` –∏ `weeks`
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `api/cache/graph-admission-closure/{mode}/`
  - –ú–µ—Ç–æ–¥—ã: `get()`, `set()`, `clear()`, `clearByMode()`, `generateKey()`

---

## üèóÔ∏è –ú–æ–¥—É–ª–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ú–æ–¥—É–ª—å 1: TimeTrackingCache

**–¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª:** `api/cache/TimeTrackingCache.php`  
**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `api/cache/TimeTrackingCache.php` (–ø–µ—Ä–µ–¥–µ–ª–∫–∞)

**–†–µ–∂–∏–º—ã:**
- `default` ‚Äî —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (TTL: 5 –º–∏–Ω—É—Ç)
- `detailed` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (TTL: 2 –º–∏–Ω—É—Ç—ã)
- `summary` ‚Äî —Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (TTL: 10 –º–∏–Ω—É—Ç)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–µ—à–∞:**
```
api/cache/time-tracking-sector-1c/
‚îú‚îÄ‚îÄ default/          # –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îú‚îÄ‚îÄ detailed/         # –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îî‚îÄ‚îÄ summary/          # –°–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º
    ‚îî‚îÄ‚îÄ *.json
```

---

### –ú–æ–¥—É–ª—å 2: UsersManagementCache

**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `api/cache/UsersManagementCache.php` (—Å–æ–∑–¥–∞—Ç—å)

**–†–µ–∂–∏–º—ã:**
- `departments` ‚Äî –∫–µ—à —Å–ø–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–æ–≤ (TTL: 1 —á–∞—Å)
- `users` ‚Äî –∫–µ—à —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (TTL: 30 –º–∏–Ω—É—Ç)
- `config` ‚Äî –∫–µ—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π (TTL: 5 –º–∏–Ω—É—Ç)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–µ—à–∞:**
```
api/cache/users-management/
‚îú‚îÄ‚îÄ departments/      # –ö–µ—à –æ—Ç–¥–µ–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îú‚îÄ‚îÄ users/            # –ö–µ—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îî‚îÄ‚îÄ config/           # –ö–µ—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    ‚îî‚îÄ‚îÄ *.json
```

---

### –ú–æ–¥—É–ª—å 3: UserActivityCache

**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `api/cache/UserActivityCache.php` (—Å–æ–∑–¥–∞—Ç—å)

**–†–µ–∂–∏–º—ã:**
- `stats` ‚Äî –∫–µ—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (TTL: 5 –º–∏–Ω—É—Ç)
- `list` ‚Äî –∫–µ—à —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (TTL: 2 –º–∏–Ω—É—Ç—ã)
- `filters` ‚Äî –∫–µ—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (TTL: 1 –º–∏–Ω—É—Ç–∞)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–µ—à–∞:**
```
api/cache/user-activity/
‚îú‚îÄ‚îÄ stats/            # –ö–µ—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îú‚îÄ‚îÄ list/             # –ö–µ—à —Å–ø–∏—Å–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îî‚îÄ‚îÄ filters/          # –ö–µ—à —Ñ–∏–ª—å—Ç—Ä–æ–≤
    ‚îî‚îÄ‚îÄ *.json
```

---

### –ú–æ–¥—É–ª—å 4: WebhookLogsCache (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

**–¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª:** `src/WebhookLogs/Service/WebhookLogsApiCache.php`  
**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `api/cache/WebhookLogsCache.php` (–ø–µ—Ä–µ–¥–µ–ª–∫–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ)

**–†–µ–∂–∏–º—ã:**
- `api` ‚Äî –∫–µ—à API –∑–∞–ø—Ä–æ—Å–æ–≤ (TTL: 5 –º–∏–Ω—É—Ç)
- `realtime` ‚Äî –∫–µ—à realtime –¥–∞–Ω–Ω—ã—Ö (TTL: 1 –º–∏–Ω—É—Ç–∞)
- `stats` ‚Äî –∫–µ—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (TTL: 10 –º–∏–Ω—É—Ç)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–µ—à–∞:**
```
api/cache/webhook-logs/
‚îú‚îÄ‚îÄ api/              # –ö–µ—à API –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îú‚îÄ‚îÄ realtime/         # –ö–µ—à realtime –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îî‚îÄ‚îÄ stats/            # –ö–µ—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    ‚îî‚îÄ‚îÄ *.json
```

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –û—Ç –∑–∞–¥–∞—á:

- TASK-072: –ú–æ–¥—É–ª—å "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏" (–¥–ª—è UsersManagementCache)
- TASK-073: –ú–æ–¥—É–ª—å "–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏" (–¥–ª—è UserActivityCache)
- TASK-074: –ú–æ–¥—É–ª—å "–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º" (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π)

### –û—Ç –º–æ–¥—É–ª–µ–π:

- `GraphAdmissionClosureCache` ‚Äî —ç—Ç–∞–ª–æ–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- `TimeTrackingCache` ‚Äî —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–ø–µ—Ä–µ–¥–µ–ª–∫–∞)
- `WebhookLogsApiCache` ‚Äî —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–¥–µ–ª–∫–∞)

### –û—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

- `DOCS/ANALYSIS/cache-usage-analysis.md` ‚Äî –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–µ—à–∞

---

## üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –û–±–∑–æ—Ä —ç—Ç–∞–ø–æ–≤

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ **5 –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤**, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ø–æ–¥—ç—Ç–∞–ø—ã:

1. **–≠—Ç–∞–ø 1:** –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
2. **–≠—Ç–∞–ø 2:** –ü–µ—Ä–µ–¥–µ–ª–∫–∞ TimeTrackingCache –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∂–∏–º–æ–≤
3. **–≠—Ç–∞–ø 3:** –°–æ–∑–¥–∞–Ω–∏–µ UsersManagementCache —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∂–∏–º–æ–≤
4. **–≠—Ç–∞–ø 4:** –°–æ–∑–¥–∞–Ω–∏–µ UserActivityCache —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∂–∏–º–æ–≤
5. **–≠—Ç–∞–ø 5:** –ü–µ—Ä–µ–¥–µ–ª–∫–∞/—Å–æ–∑–¥–∞–Ω–∏–µ WebhookLogsCache –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π):**
1. –≠—Ç–∞–ø 1: –ê–Ω–∞–ª–∏–∑ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º)
2. –≠—Ç–∞–ø 2: TimeTrackingCache (—É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω—É–∂–Ω–∞ –ø–µ—Ä–µ–¥–µ–ª–∫–∞)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í—ã—Å–æ–∫–∏–π):**
3. –≠—Ç–∞–ø 3: UsersManagementCache (–Ω–æ–≤—ã–π –º–æ–¥—É–ª—å)
4. –≠—Ç–∞–ø 4: UserActivityCache (–Ω–æ–≤—ã–π –º–æ–¥—É–ª—å)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–°—Ä–µ–¥–Ω–∏–π):**
5. –≠—Ç–∞–ø 5: WebhookLogsCache (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å TimeTrackingCache –∫–∞–∫ –Ω–∞–∏–±–æ–ª–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –º–æ–¥—É–ª—è, –∑–∞—Ç–µ–º —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏, –∏ –≤ –∫–æ–Ω—Ü–µ –æ–±–Ω–æ–≤–∏—Ç—å –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

---

## üìù –≠—Ç–∞–ø 1: –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

**–¶–µ–ª—å:** –ò–∑—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–µ—à–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è.

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~2-3 —á–∞—Å–∞  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

### –ü–æ–¥—ç—Ç–∞–ø 1.1: –ê–Ω–∞–ª–∏–∑ TimeTrackingCache

**–ó–∞–¥–∞—á–∞:** –ò–∑—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ–∂–∏–º—ã.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `api/cache/TimeTrackingCache.php`**

2. **–ò–∑—É—á–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞:**
   - –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `TimeTrackingCache::get()` –∏ `TimeTrackingCache::set()`
   - –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∫–µ—à–∏—Ä—É—é—Ç—Å—è
   - –ö–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–ª–∏—è—é—Ç –Ω–∞ –∫–ª—é—á –∫–µ—à–∞

3. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º—ã:**
   - `default` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç
   - `detailed` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
   - `summary` ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å–≤–æ–¥–∫–∞)

4. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å TTL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞:**
   - `default`: 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥)
   - `detailed`: 2 –º–∏–Ω—É—Ç—ã (120 —Å–µ–∫—É–Ω–¥) ‚Äî –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—è—é—Ç—Å—è —á–∞—â–µ
   - `summary`: 10 –º–∏–Ω—É—Ç (600 —Å–µ–∫—É–Ω–¥) ‚Äî –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –†–µ–∂–∏–º—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] TTL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [ ] –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–µ—à–∞

---

### –ü–æ–¥—ç—Ç–∞–ø 1.2: –ê–Ω–∞–ª–∏–∑ –º–æ–¥—É–ª—è "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"

**–ó–∞–¥–∞—á–∞:** –ò–∑—É—á–∏—Ç—å –º–æ–¥—É–ª—å –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º—ã –¥–ª—è UsersManagementCache.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–ò–∑—É—á–∏—Ç—å `vue-app/src/pages/UsersManagementPage.vue`**

2. **–ò–∑—É—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:**
   - `vue-app/src/services/access-management-service.js`
   - `vue-app/src/services/modules-management-service.js`

3. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º—ã:**
   - `departments` ‚Äî —Å–ø–∏—Å–æ–∫ –æ—Ç–¥–µ–ª–æ–≤ —Å –¥–æ—Å—Ç—É–ø–æ–º
   - `users` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - `config` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π

4. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å TTL:**
   - `departments`: 1 —á–∞—Å (3600 —Å–µ–∫—É–Ω–¥) ‚Äî —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è
   - `users`: 30 –º–∏–Ω—É—Ç (1800 —Å–µ–∫—É–Ω–¥) ‚Äî –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è —á–∞—â–µ
   - `config`: 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥) ‚Äî –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –†–µ–∂–∏–º—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] TTL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [ ] –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

### –ü–æ–¥—ç—Ç–∞–ø 1.3: –ê–Ω–∞–ª–∏–∑ –º–æ–¥—É–ª—è "–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"

**–ó–∞–¥–∞—á–∞:** –ò–∑—É—á–∏—Ç—å –º–æ–¥—É–ª—å –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º—ã –¥–ª—è UserActivityCache.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–ò–∑—É—á–∏—Ç—å `vue-app/src/components/users/UserActivityList.vue`**

2. **–ò–∑—É—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:**
   - `vue-app/src/services/user-activity-service.js`
   - `vue-app/src/services/activity-logging-service.js`

3. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º—ã:**
   - `stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
   - `list` ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   - `filters` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

4. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å TTL:**
   - `stats`: 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥) ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö
   - `list`: 2 –º–∏–Ω—É—Ç—ã (120 —Å–µ–∫—É–Ω–¥) ‚Äî –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—è—é—Ç—Å—è —á–∞—Å—Ç–æ
   - `filters`: 1 –º–∏–Ω—É—Ç–∞ (60 —Å–µ–∫—É–Ω–¥) ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –±—ã—Å—Ç—Ä–æ —É—Å—Ç–∞—Ä–µ–≤–∞—é—Ç

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –†–µ–∂–∏–º—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] TTL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [ ] –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

### –ü–æ–¥—ç—Ç–∞–ø 1.4: –ê–Ω–∞–ª–∏–∑ WebhookLogsCache

**–ó–∞–¥–∞—á–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –∫–µ—à –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤, –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º—ã.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–ò–∑—É—á–∏—Ç—å `src/WebhookLogs/Service/WebhookLogsApiCache.php`**

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
   - –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–µ—à
   - –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∫–µ—à–∏—Ä—É—é—Ç—Å—è

3. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º—ã (–µ—Å–ª–∏ –∫–µ—à –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):**
   - `api` ‚Äî –∫–µ—à API –∑–∞–ø—Ä–æ—Å–æ–≤
   - `realtime` ‚Äî –∫–µ—à realtime –¥–∞–Ω–Ω—ã—Ö
   - `stats` ‚Äî –∫–µ—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

4. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å TTL:**
   - `api`: 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥)
   - `realtime`: 1 –º–∏–Ω—É—Ç–∞ (60 —Å–µ–∫—É–Ω–¥) ‚Äî –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—è—é—Ç—Å—è –æ—á–µ–Ω—å —á–∞—Å—Ç–æ
   - `stats`: 10 –º–∏–Ω—É—Ç (600 —Å–µ–∫—É–Ω–¥) ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –∫–µ—à –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤
- [ ] –†–µ–∂–∏–º—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã (–µ—Å–ª–∏ –∫–µ—à –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- [ ] TTL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã

---

## üìù –≠—Ç–∞–ø 2: –ü–µ—Ä–µ–¥–µ–ª–∫–∞ TimeTrackingCache –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∂–∏–º–æ–≤

**–¶–µ–ª—å:** –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å `TimeTrackingCache` –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∂–∏–º–∞–º–∏, –∫–∞–∫ –≤ `GraphAdmissionClosureCache`.

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~4-5 —á–∞—Å–æ–≤  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

### –ü–æ–¥—ç—Ç–∞–ø 2.1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–ª–∞—Å—Å–∞

**–§–∞–π–ª:** `api/cache/TimeTrackingCache.php`

**–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∂–∏–º–æ–≤ —á–µ—Ä–µ–∑ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ –æ–±—Ä–∞–∑—Ü—É `GraphAdmissionClosureCache`.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–µ–∂–∏–º–æ–≤ (–ø–æ –æ–±—Ä–∞–∑—Ü—É GraphAdmissionClosureCache):**
   ```php
   /**
    * –ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞
    * –§–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ api/cache/, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º __DIR__ –Ω–∞–ø—Ä—è–º—É—é
    */
   private const CACHE_BASE_DIR = __DIR__ . '/time-tracking-sector-1c';
   
   /**
    * –ü–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "default"
    */
   private const CACHE_DEFAULT_DIR = self::CACHE_BASE_DIR . '/default';
   
   /**
    * –ü–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "detailed"
    */
   private const CACHE_DETAILED_DIR = self::CACHE_BASE_DIR . '/detailed';
   
   /**
    * –ü–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "summary"
    */
   private const CACHE_SUMMARY_DIR = self::CACHE_BASE_DIR . '/summary';
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã TTL (–ø–æ –æ–±—Ä–∞–∑—Ü—É GraphAdmissionClosureCache):**
   ```php
   /**
    * TTL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (5 –º–∏–Ω—É—Ç)
    */
   private const DEFAULT_TTL = 300;
   
   /**
    * TTL –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (2 –º–∏–Ω—É—Ç—ã)
    */
   private const DETAILED_TTL = 120;
   
   /**
    * TTL –¥–ª—è —Å–≤–æ–¥–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (10 –º–∏–Ω—É—Ç)
    */
   private const SUMMARY_TTL = 600;
   ```

3. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ (–ø–æ –æ–±—Ä–∞–∑—Ü—É GraphAdmissionClosureCache):**
   ```php
   /**
    * –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞
    * 
    * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache::getModeFromKey()
    * 
    * @param string $key –ö–ª—é—á –∫–µ—à–∞ (—Ñ–æ—Ä–º–∞—Ç: {mode}_{hash})
    * @return string –†–µ–∂–∏–º ('default', 'detailed', 'summary')
    */
   private static function getModeFromKey(string $key): string
   {
       // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å—ã –≤ –ø–æ—Ä—è–¥–∫–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ—Å—Ç–∏
       if (strpos($key, 'detailed_') === 0) {
           return 'detailed';
       }
       if (strpos($key, 'summary_') === 0) {
           return 'summary';
       }
       // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —Ä–µ–∂–∏–º default
       return 'default';
   }
   ```

**–í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–∑ —ç—Ç–∞–ª–æ–Ω–∞:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `__DIR__` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –ü—Ä–µ—Ñ–∏–∫—Å—ã –∫–ª—é—á–µ–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `{mode}_`
- –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –≤–∞–∂–µ–Ω (—Å–Ω–∞—á–∞–ª–∞ –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–µ–∂–∏–º–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω—ã (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache)
- [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã TTL –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- [ ] –ú–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —ç—Ç–∞–ª–æ–Ω—É)
- [ ] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∞–Ω–∞–ª–æ–≥–∏–∏ —Å —ç—Ç–∞–ª–æ–Ω–æ–º

---

### –ü–æ–¥—ç—Ç–∞–ø 2.2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ get() –∏ set()

**–§–∞–π–ª:** `api/cache/TimeTrackingCache.php`

**–ó–∞–¥–∞—á–∞:** –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–∂–∏–º–æ–≤ –ø–æ –æ–±—Ä–∞–∑—Ü—É `GraphAdmissionClosureCache`.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get()` (–ø–æ–ª–Ω—ã–π –∫–æ–¥ –ø–æ –æ–±—Ä–∞–∑—Ü—É —ç—Ç–∞–ª–æ–Ω–∞):**
   ```php
   /**
    * –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞
    * 
    * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache::get()
    * 
    * @param string $key –ö–ª—é—á –∫–µ—à–∞
    * @return array|null –î–∞–Ω–Ω—ã–µ –∏–ª–∏ null, –µ—Å–ª–∏ –∫–µ—à –Ω–µ –Ω–∞–π–¥–µ–Ω/–∏—Å—Ç—ë–∫
    */
   public static function get(string $key): ?array
   {
       // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞
       $mode = self::getModeFromKey($key);
       $cachePath = self::getCachePath($key, $mode);
       
       // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
       if (!file_exists($cachePath)) {
           return null;
       }
       
       // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
       $content = @file_get_contents($cachePath);
       if ($content === false) {
           error_log("[TimeTrackingCache] Failed to read cache file: {$cachePath}");
           return null;
       }
       
       // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JSON
       $data = @json_decode($content, true);
       if ($data === null || !is_array($data)) {
           error_log("[TimeTrackingCache] Failed to decode cache file: {$cachePath}");
           return null;
       }
       
       // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
       if (!isset($data['metadata']['expires_at'])) {
           error_log("[TimeTrackingCache] Invalid cache structure: {$cachePath}");
           return null;
       }
       
       // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
       if (time() > $data['metadata']['expires_at']) {
           // –ö–µ—à –∏—Å—Ç—ë–∫, —É–¥–∞–ª—è–µ–º —Ñ–∞–π–ª
           @unlink($cachePath);
           return null;
       }
       
       return $data['data'] ?? null;
   }
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `set()` (–ø–æ–ª–Ω—ã–π –∫–æ–¥ —Å –∞—Ç–æ–º–∞—Ä–Ω–æ–π –∑–∞–ø–∏—Å—å—é):**
   ```php
   /**
    * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –∫–µ—à
    * 
    * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache::set()
    * 
    * @param string $key –ö–ª—é—á –∫–µ—à–∞
    * @param array $data –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
    * @param int|null $ttl TTL –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (null = –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø–æ —Ä–µ–∂–∏–º—É)
    * @return bool true –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
    */
   public static function set(string $key, array $data, ?int $ttl = null): bool
   {
       // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞
       $mode = self::getModeFromKey($key);
       
       // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ TTL –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω —è–≤–Ω–æ)
       if ($ttl === null) {
           $ttl = self::getTTLForMode($mode);
       }
       
       // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
       if (!self::ensureCacheDirectory($mode)) {
           return false;
       }
       
       $cachePath = self::getCachePath($key, $mode);
       $now = time();
       
       // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —ç—Ç–∞–ª–æ–Ω—É)
       $cacheData = [
           'data' => $data,
           'metadata' => [
               'created_at' => $now,
               'expires_at' => $now + $ttl,
               'ttl' => $ttl,
               'mode' => $mode  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∂–∏–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
           ]
       ];
       
       // –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ JSON
       $json = json_encode($cacheData, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
       if ($json === false) {
           error_log("[TimeTrackingCache] Failed to encode cache data for key: {$key}");
           return false;
       }
       
       // –ó–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª (–∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª)
       // –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏
       $tempPath = $cachePath . '.tmp';
       if (@file_put_contents($tempPath, $json, LOCK_EX) === false) {
           error_log("[TimeTrackingCache] Failed to write cache file: {$tempPath}");
           return false;
       }
       
       // –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
       if (!@rename($tempPath, $cachePath)) {
           error_log("[TimeTrackingCache] Failed to rename cache file: {$tempPath} -> {$cachePath}");
           @unlink($tempPath);
           return false;
       }
       
       return true;
   }
   ```

3. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `getTTLForMode()`:**
   ```php
   /**
    * –ü–æ–ª—É—á–∏—Ç—å TTL –¥–ª—è —Ä–µ–∂–∏–º–∞
    * 
    * @param string $mode –†–µ–∂–∏–º ('default', 'detailed', 'summary')
    * @return int TTL –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    */
   private static function getTTLForMode(string $mode): int
   {
       switch ($mode) {
           case 'detailed':
               return self::DETAILED_TTL;
           case 'summary':
               return self::SUMMARY_TTL;
           default:
               return self::DEFAULT_TTL;
       }
   }
   ```

**–í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–∑ —ç—Ç–∞–ª–æ–Ω–∞:**
- **–ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (`.tmp`) –∏ `rename()` –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏
- **LOCK_EX:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `LOCK_EX` –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `error_log()`
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç—ë–∫—à–∏—Ö —Ñ–∞–π–ª–æ–≤:** –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏—Å—Ç—ë–∫—à–µ–≥–æ –∫–µ—à–∞ —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:** `{data: {...}, metadata: {created_at, expires_at, ttl, mode}}`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ú–µ—Ç–æ–¥ `get()` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —ç—Ç–∞–ª–æ–Ω—É)
- [ ] –ú–µ—Ç–æ–¥ `set()` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –∞—Ç–æ–º–∞—Ä–Ω–æ–π –∑–∞–ø–∏—Å—å—é
- [ ] –ú–µ—Ç–æ–¥ `getTTLForMode()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª

---

### –ü–æ–¥—ç—Ç–∞–ø 2.3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∂–∏–º–∞–º–∏

**–§–∞–π–ª:** `api/cache/TimeTrackingCache.php`

**–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã `clearByMode()`, `generateKey()`, `getCachePath()`.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `clearByMode()`:**
   ```php
   /**
    * –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
    * 
    * @param string $mode –†–µ–∂–∏–º ('default', 'detailed', 'summary')
    * @return bool true –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
    */
   public static function clearByMode(string $mode): bool
   {
       $cacheDir = self::getCacheDirForMode($mode);
       return self::clearDirectory($cacheDir);
   }
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `generateKey()` (–ø–æ –æ–±—Ä–∞–∑—Ü—É GraphAdmissionClosureCache):**
   ```php
   /**
    * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∫–µ—à–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
    * 
    * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache::generateKey()
    * 
    * @param array $params –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
    * @param string $mode –†–µ–∂–∏–º ('default', 'detailed', 'summary')
    * @return string –ö–ª—é—á –∫–µ—à–∞ (—Ñ–æ—Ä–º–∞—Ç: {mode}_{hash})
    */
   public static function generateKey(array $params, string $mode = 'default'): string
   {
       // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–∞
       // –í–∞–∂–Ω–æ: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Å—Å–∏–≤—ã –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
       $normalized = [
           'product' => $params['product'] ?? '1C',
           'weekStartUtc' => $params['weekStartUtc'] ?? null,
           'weekEndUtc' => $params['weekEndUtc'] ?? null,
           'includeTaskDetails' => $params['includeTaskDetails'] ?? false,
           'taskIds' => isset($params['taskIds']) && is_array($params['taskIds']) 
               ? sort($params['taskIds']) ? $params['taskIds'] : [] 
               : [],
           'page' => $params['page'] ?? 1,
           'perPage' => $params['perPage'] ?? 10
       ];
       
       // –î–ª—è —Ä–µ–∂–∏–º–∞ "detailed" –≤–∫–ª—é—á–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
       if ($mode === 'detailed') {
           $normalized['includeEmployeeDetails'] = $params['includeEmployeeDetails'] ?? false;
           $normalized['includeTaskHistory'] = $params['includeTaskHistory'] ?? false;
       }
       
       // –î–ª—è —Ä–µ–∂–∏–º–∞ "summary" –∞–≥—Ä–µ–≥–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
       if ($mode === 'summary') {
           // –í summary —Ä–µ–∂–∏–º–µ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é
           unset($normalized['includeTaskDetails']);
           unset($normalized['taskIds']);
           unset($normalized['page']);
           unset($normalized['perPage']);
       }
       
       // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è MD5 —Ö–µ—à–∞ –æ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
       // –í–∞–∂–Ω–æ: json_encode —Å JSON_UNESCAPED_UNICODE –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
       $keyString = json_encode($normalized, JSON_UNESCAPED_UNICODE);
       $hash = md5($keyString);
       
       // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
       return $mode . '_' . $hash;
   }
   ```
   
   **–í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–∑ —ç—Ç–∞–ª–æ–Ω–∞:**
   - **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:** –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è (–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤:** –ú–∞—Å—Å–∏–≤—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–π
   - **–†–µ–∂–∏–º-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:** –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - **MD5 —Ö–µ—à:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è MD5 –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –∫–ª—é—á–∞
   - **–ü—Ä–µ—Ñ–∏–∫—Å —Ä–µ–∂–∏–º–∞:** –ü—Ä–µ—Ñ–∏–∫—Å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –∫–ª—é—á–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞

3. **–î–æ–±–∞–≤–∏—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã (–ø–æ –æ–±—Ä–∞–∑—Ü—É —ç—Ç–∞–ª–æ–Ω–∞):**
   ```php
   /**
    * –ü–æ–ª—É—á–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∫–µ—à–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞
    * 
    * @param string $mode –†–µ–∂–∏–º ('default', 'detailed', 'summary')
    * @return string –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞
    */
   private static function getCacheDirForMode(string $mode): string
   {
       switch ($mode) {
           case 'detailed':
               return self::CACHE_DETAILED_DIR;
           case 'summary':
               return self::CACHE_SUMMARY_DIR;
           default:
               return self::CACHE_DEFAULT_DIR;
       }
   }
   
   /**
    * –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–µ—à–∞
    * 
    * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache::getCachePath()
    * 
    * @param string $key –ö–ª—é—á –∫–µ—à–∞
    * @param string $mode –†–µ–∂–∏–º ('default', 'detailed', 'summary')
    * @return string –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
    */
   private static function getCachePath(string $key, string $mode): string
   {
       // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è)
       // –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
       $safeKey = preg_replace('/[^a-zA-Z0-9_-]/', '_', $key);
       
       // –í—ã–±–æ—Ä –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
       $cacheDir = self::getCacheDirForMode($mode);
       
       return $cacheDir . '/' . $safeKey . '.json';
   }
   
   /**
    * –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∫–µ—à–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    * 
    * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache::ensureCacheDirectory()
    * 
    * @param string $mode –†–µ–∂–∏–º ('default', 'detailed', 'summary')
    * @return bool true –µ—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∞
    */
   private static function ensureCacheDirectory(string $mode): bool
   {
       $cacheDir = self::getCacheDirForMode($mode);
       
       if (is_dir($cacheDir)) {
           return is_writable($cacheDir);
       }
       
       // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
       if (!@mkdir($cacheDir, 0755, true)) {
           error_log("[TimeTrackingCache] Failed to create cache directory: {$cacheDir}");
           return false;
       }
       
       return true;
   }
   
   /**
    * –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    * 
    * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache::clearDirectory()
    * 
    * @param string $cacheDir –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞
    * @return bool true –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
    */
   private static function clearDirectory(string $cacheDir): bool
   {
       if (!is_dir($cacheDir)) {
           return true; // –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
       }
       
       $files = glob($cacheDir . '/*.json');
       $success = true;
       
       foreach ($files as $file) {
           if (!@unlink($file)) {
               error_log("[TimeTrackingCache] Failed to delete cache file: {$file}");
               $success = false;
           }
       }
       
       return $success;
   }
   
   /**
    * –û—á–∏—Å—Ç–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    * 
    * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache::clearExpiredInDirectory()
    * 
    * @param string $cacheDir –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞
    * @param int $now –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (Unix timestamp)
    * @return int –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    */
   private static function clearExpiredInDirectory(string $cacheDir, int $now): int
   {
       if (!is_dir($cacheDir)) {
           return 0;
       }
       
       $files = glob($cacheDir . '/*.json');
       $deleted = 0;
       
       foreach ($files as $file) {
           $content = @file_get_contents($file);
           if ($content === false) {
               continue;
           }
           
           $data = @json_decode($content, true);
           if ($data === null || !is_array($data)) {
               continue;
           }
           
           $expiresAt = $data['metadata']['expires_at'] ?? 0;
           if ($now > $expiresAt) {
               if (@unlink($file)) {
                   $deleted++;
               }
           }
       }
       
       return $deleted;
   }
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ú–µ—Ç–æ–¥ `clearByMode()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `generateKey()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

---

### –ü–æ–¥—ç—Ç–∞–ø 2.4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ clear() –∏ clearExpired()

**–§–∞–π–ª:** `api/cache/TimeTrackingCache.php`

**–ó–∞–¥–∞—á–∞:** –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤ –ø–æ –æ–±—Ä–∞–∑—Ü—É —ç—Ç–∞–ª–æ–Ω–∞.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `clear()` (–ø–æ –æ–±—Ä–∞–∑—Ü—É GraphAdmissionClosureCache):**
   ```php
   /**
    * –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à
    * 
    * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache::clear()
    * –û—á–∏—â–∞–µ—Ç –≤—Å–µ —Ä–µ–∂–∏–º—ã (default, detailed, summary)
    * 
    * @return bool true –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
    */
   public static function clear(): bool
   {
       $success = true;
       
       // –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
       $modes = ['default', 'detailed', 'summary'];
       foreach ($modes as $mode) {
           if (!self::clearByMode($mode)) {
               $success = false;
           }
       }
       
       return $success;
   }
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `clearExpired()` (–ø–æ –æ–±—Ä–∞–∑—Ü—É —ç—Ç–∞–ª–æ–Ω–∞):**
   ```php
   /**
    * –û—á–∏—Å—Ç–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏
    * 
    * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache::clearExpired()
    * –û—á–∏—â–∞–µ—Ç –∏—Å—Ç—ë–∫—à–∏–µ –∑–∞–ø–∏—Å–∏ –≤–æ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–∞—Ö
    * 
    * @return int –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–∏–∑ –≤—Å–µ—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π)
    */
   public static function clearExpired(): int
   {
       $deleted = 0;
       $now = time();
       
       // –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
       $modes = ['default', 'detailed', 'summary'];
       foreach ($modes as $mode) {
           $cacheDir = self::getCacheDirForMode($mode);
           $deleted += self::clearExpiredInDirectory($cacheDir, $now);
       }
       
       return $deleted;
   }
   ```

3. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `isExpired()` (–ø–æ –æ–±—Ä–∞–∑—Ü—É —ç—Ç–∞–ª–æ–Ω–∞):**
   ```php
   /**
    * –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –∫–µ—à–∞
    * 
    * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureCache::isExpired()
    * 
    * @param string $key –ö–ª—é—á –∫–µ—à–∞
    * @return bool true –µ—Å–ª–∏ –∫–µ—à –∏—Å—Ç—ë–∫ –∏–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    */
   public static function isExpired(string $key): bool
   {
       // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞
       $mode = self::getModeFromKey($key);
       $cachePath = self::getCachePath($key, $mode);
       
       if (!file_exists($cachePath)) {
           return true;
       }
       
       $content = @file_get_contents($cachePath);
       if ($content === false) {
           return true;
       }
       
       $data = @json_decode($content, true);
       if ($data === null || !is_array($data)) {
           return true;
       }
       
       $expiresAt = $data['metadata']['expires_at'] ?? 0;
       return time() > $expiresAt;
   }
   ```

**–í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–∑ —ç—Ç–∞–ª–æ–Ω–∞:**
- **–û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤:** –ú–µ—Ç–æ–¥ `clear()` –æ—á–∏—â–∞–µ—Ç –≤—Å–µ —Ä–µ–∂–∏–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:** –ú–µ—Ç–æ–¥ `clearExpired()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ (–∫–∞–∂–¥—ã–π 10-–π –∑–∞–ø—Ä–æ—Å)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è:** –ú–µ—Ç–æ–¥ `isExpired()` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–µ—á–µ–Ω–∏–µ –±–µ–∑ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ú–µ—Ç–æ–¥ `clear()` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
- [ ] –ú–µ—Ç–æ–¥ `clearExpired()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —ç—Ç–∞–ª–æ–Ω—É)
- [ ] –ú–µ—Ç–æ–¥ `isExpired()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —ç—Ç–∞–ª–æ–Ω—É)
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ –≤—Å–µ–º–∏ —Ä–µ–∂–∏–º–∞–º–∏

---

### –ü–æ–¥—ç—Ç–∞–ø 2.5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö

**–§–∞–π–ª:** `api/tickets-time-tracking-sector-1c/service/TimeTrackingService.php`

**–ó–∞–¥–∞—á–∞:** –û–±–Ω–æ–≤–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–µ–∂–∏–º–æ–≤ –ø–æ –æ–±—Ä–∞–∑—Ü—É `GraphAdmissionClosureService`.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–ù–∞–π—Ç–∏ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–µ—à–∞ –≤ `TimeTrackingService.php`**

2. **–û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–ø–æ –æ–±—Ä–∞–∑—Ü—É GraphAdmissionClosureService):**
   ```php
   // –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç–æ–¥–µ getTimeTrackingData()
   
   // TASK-075: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤
   $forceRefresh = $params['forceRefresh'] ?? false;
   
   // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
   $mode = 'default'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
   if (isset($params['includeTaskDetails']) && $params['includeTaskDetails']) {
       $mode = 'detailed'; // –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
   } elseif (isset($params['summary']) && $params['summary']) {
       $mode = 'summary'; // –°–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   }
   
   if (!$forceRefresh && $this->cacheStore !== null) {
       // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∫–µ—à–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–µ–∂–∏–º–∞
       $cacheKey = $this->cacheStore->generateKey($params, $mode);
       
       // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞
       $cachedData = $this->cacheStore->get($cacheKey);
       if ($cachedData !== null) {
           error_log("[TimeTrackingService] Cache hit for key: {$cacheKey} (mode: {$mode})");
           return $cachedData;
       }
       
       error_log("[TimeTrackingService] Cache miss for key: {$cacheKey} (mode: {$mode})");
   } else if ($forceRefresh) {
       error_log("[TimeTrackingService] Force refresh requested, skipping cache");
   }
   
   // ... –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Bitrix24 API ...
   
   // TASK-075: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
   if (!$forceRefresh && $this->cacheStore !== null) {
       $cacheKey = $this->cacheStore->generateKey($params, $mode);
       
       // TTL –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–µ–∂–∏–º—É –≤ TimeTrackingCache::set()
       if ($this->cacheStore->set($cacheKey, $response)) {
           error_log("[TimeTrackingService] Cache saved for key: {$cacheKey} (mode: {$mode})");
       } else {
           error_log("[TimeTrackingService] Failed to save cache for key: {$cacheKey}");
       }
       
       // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π (–∫–∞–∂–¥—ã–π 10-–π –∑–∞–ø—Ä–æ—Å)
       // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ GraphAdmissionClosureService
       if (rand(1, 10) === 1) {
           $deleted = $this->cacheStore->clearExpired();
           if ($deleted > 0) {
               error_log("[TimeTrackingService] Cleared {$deleted} expired cache entries");
           }
       }
   }
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å CacheStore wrapper (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):**
   ```php
   // –§–∞–π–ª: api/tickets-time-tracking-sector-1c/cache/CacheStore.php
   
   // –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ generateKey() –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–∂–∏–º–æ–≤
   public function generateKey(array $params, string $mode = 'default'): string
   {
       return TimeTrackingCache::generateKey($params, $mode);
   }
   ```

**–í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–∑ —ç—Ç–∞–ª–æ–Ω–∞:**
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞:** –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–µ—à–µ–º –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (cache hit, cache miss, cache saved)
- **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:** –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ (–∫–∞–∂–¥—ã–π 10-–π –∑–∞–ø—Ä–æ—Å)
- **Force refresh:** –ü–∞—Ä–∞–º–µ—Ç—Ä `forceRefresh` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–æ–π—Ç–∏ –∫–µ—à
- **TTL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π:** TTL –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–µ–∂–∏–º—É (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –í—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–µ—à–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–µ–∂–∏–º–∞
- [ ] –ö–ª—é—á–∏ –∫–µ—à–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `generateKey()` —Å —Ä–µ–∂–∏–º–æ–º
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–µ—à–µ–º
- [ ] –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `forceRefresh` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] CacheStore wrapper –æ–±–Ω–æ–≤–ª–µ–Ω (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

---

## üìù –≠—Ç–∞–ø 3: –°–æ–∑–¥–∞–Ω–∏–µ UsersManagementCache —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∂–∏–º–æ–≤

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å `UsersManagementCache` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∂–∏–º–æ–≤.

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~3-4 —á–∞—Å–∞  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

### –ü–æ–¥—ç—Ç–∞–ø 3.1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–ª–∞—Å—Å–∞

**–§–∞–π–ª:** `api/cache/UsersManagementCache.php` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å –ø–æ –æ–±—Ä–∞–∑—Ü—É `GraphAdmissionClosureCache` —Å –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `api/cache/UsersManagementCache.php`**

2. **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ `GraphAdmissionClosureCache.php`**

3. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
   ```php
   /**
    * –ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞
    */
   private const CACHE_BASE_DIR = __DIR__ . '/users-management';
   
   /**
    * –ü–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "departments"
    */
   private const CACHE_DEPARTMENTS_DIR = self::CACHE_BASE_DIR . '/departments';
   
   /**
    * –ü–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "users"
    */
   private const CACHE_USERS_DIR = self::CACHE_BASE_DIR . '/users';
   
   /**
    * –ü–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ "config"
    */
   private const CACHE_CONFIG_DIR = self::CACHE_BASE_DIR . '/config';
   
   /**
    * TTL –¥–ª—è —Ä–µ–∂–∏–º–∞ "departments" (1 —á–∞—Å)
    */
   private const DEPARTMENTS_TTL = 3600;
   
   /**
    * TTL –¥–ª—è —Ä–µ–∂–∏–º–∞ "users" (30 –º–∏–Ω—É—Ç)
    */
   private const USERS_TTL = 1800;
   
   /**
    * TTL –¥–ª—è —Ä–µ–∂–∏–º–∞ "config" (5 –º–∏–Ω—É—Ç)
    */
   private const CONFIG_TTL = 300;
   ```

4. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `getModeFromKey()`:**
   ```php
   /**
    * –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞
    * 
    * @param string $key –ö–ª—é—á –∫–µ—à–∞
    * @return string –†–µ–∂–∏–º ('departments', 'users', 'config')
    */
   private static function getModeFromKey(string $key): string
   {
       if (strpos($key, 'users_') === 0) {
           return 'users';
       }
       if (strpos($key, 'config_') === 0) {
           return 'config';
       }
       // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —Ä–µ–∂–∏–º departments
       return 'departments';
   }
   ```

5. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `generateKey()`:**
   ```php
   /**
    * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∫–µ—à–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
    * 
    * @param array $params –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
    * @param string $mode –†–µ–∂–∏–º ('departments', 'users', 'config')
    * @return string –ö–ª—é—á –∫–µ—à–∞
    */
   public static function generateKey(array $params, string $mode = 'departments'): string
   {
       // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
       $normalized = [];
       
       // –î–ª—è —Ä–µ–∂–∏–º–∞ "departments"
       if ($mode === 'departments') {
           $normalized = [
               'includeInactive' => $params['includeInactive'] ?? false,
               'sortBy' => $params['sortBy'] ?? 'name'
           ];
       }
       
       // –î–ª—è —Ä–µ–∂–∏–º–∞ "users"
       if ($mode === 'users') {
           $normalized = [
               'departmentIds' => isset($params['departmentIds']) && is_array($params['departmentIds'])
                   ? sort($params['departmentIds']) ? $params['departmentIds'] : []
                   : [],
               'includeInactive' => $params['includeInactive'] ?? false,
               'search' => $params['search'] ?? null
           ];
       }
       
       // –î–ª—è —Ä–µ–∂–∏–º–∞ "config"
       if ($mode === 'config') {
           $normalized = [
               'configType' => $params['configType'] ?? 'all', // 'access', 'reports', 'all'
               'includeDefaults' => $params['includeDefaults'] ?? false
           ];
       }
       
       // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è MD5 —Ö–µ—à–∞
       $keyString = json_encode($normalized, JSON_UNESCAPED_UNICODE);
       $hash = md5($keyString);
       
       // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å —Ä–µ–∂–∏–º–∞
       return $mode . '_' . $hash;
   }
   ```

6. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ –º–µ—Ç–æ–¥—ã –ø–æ –æ–±—Ä–∞–∑—Ü—É —ç—Ç–∞–ª–æ–Ω–∞:**
   - `get()`, `set()`, `delete()`, `clear()`, `clearByMode()`
   - `getCachePath()`, `getCacheDirForMode()`, `ensureCacheDirectory()`
   - `clearDirectory()`, `clearExpired()`, `clearExpiredInDirectory()`
   - `isExpired()`, `getTTLForMode()`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –§–∞–π–ª `UsersManagementCache.php` —Å–æ–∑–¥–∞–Ω
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (–ø–æ–ª–Ω—ã–π –∫–æ–¥ –ø–æ –æ–±—Ä–∞–∑—Ü—É —ç—Ç–∞–ª–æ–Ω–∞)
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —ç—Ç–∞–ª–æ–Ω—É `GraphAdmissionClosureCache`
- [ ] –ú–µ—Ç–æ–¥ `generateKey()` —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

### –ü–æ–¥—ç—Ç–∞–ø 3.2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –º–æ–¥—É–ª—å "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"

**–§–∞–π–ª—ã:**
- `vue-app/src/services/access-management-service.js`
- `vue-app/src/services/modules-management-service.js`

**–ó–∞–¥–∞—á–∞:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à –≤ —Å–µ—Ä–≤–∏—Å—ã –º–æ–¥—É–ª—è.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–°–æ–∑–¥–∞—Ç—å PHP API endpoint –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–µ—à–µ–º:**
   - `api/users-management/get-departments.php` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–¥–µ–ª–æ–≤ (—Å –∫–µ—à–µ–º)
   - `api/users-management/get-users.php` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å –∫–µ—à–µ–º)
   - `api/users-management/get-config.php` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—Å –∫–µ—à–µ–º)

2. **–û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã Vue.js:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ API endpoints
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∫–µ—à–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] API endpoints —Å–æ–∑–¥–∞–Ω—ã
- [ ] –°–µ—Ä–≤–∏—Å—ã Vue.js –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìù –≠—Ç–∞–ø 4: –°–æ–∑–¥–∞–Ω–∏–µ UserActivityCache —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∂–∏–º–æ–≤

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å `UserActivityCache` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∂–∏–º–æ–≤.

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~3-4 —á–∞—Å–∞  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

### –ü–æ–¥—ç—Ç–∞–ø 4.1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–ª–∞—Å—Å–∞

**–§–∞–π–ª:** `api/cache/UserActivityCache.php` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å –ø–æ –æ–±—Ä–∞–∑—Ü—É `GraphAdmissionClosureCache`.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `api/cache/UserActivityCache.php`**

2. **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ `GraphAdmissionClosureCache.php`**

3. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
   ```php
   private const CACHE_BASE_DIR = __DIR__ . '/user-activity';
   private const CACHE_STATS_DIR = self::CACHE_BASE_DIR . '/stats';
   private const CACHE_LIST_DIR = self::CACHE_BASE_DIR . '/list';
   private const CACHE_FILTERS_DIR = self::CACHE_BASE_DIR . '/filters';
   
   private const STATS_TTL = 300;      // 5 –º–∏–Ω—É—Ç
   private const LIST_TTL = 120;        // 2 –º–∏–Ω—É—Ç—ã
   private const FILTERS_TTL = 60;      // 1 –º–∏–Ω—É—Ç–∞
   ```

4. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `UsersManagementCache`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –§–∞–π–ª `UserActivityCache.php` —Å–æ–∑–¥–∞–Ω
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —ç—Ç–∞–ª–æ–Ω—É

---

### –ü–æ–¥—ç—Ç–∞–ø 4.2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –º–æ–¥—É–ª—å "–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"

**–§–∞–π–ª—ã:**
- `vue-app/src/services/user-activity-service.js`
- `vue-app/src/services/activity-logging-service.js`

**–ó–∞–¥–∞—á–∞:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à –≤ —Å–µ—Ä–≤–∏—Å—ã –º–æ–¥—É–ª—è.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–°–æ–∑–¥–∞—Ç—å PHP API endpoint –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–µ—à–µ–º:**
   - `api/user-activity/get-stats.php` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Å –∫–µ—à–µ–º)
   - `api/user-activity/get-list.php` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ (—Å –∫–µ—à–µ–º)
   - `api/user-activity/get-filtered.php` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å –∫–µ—à–µ–º)

2. **–û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã Vue.js:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ API endpoints
   - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –ø—Ä–∏ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] API endpoints —Å–æ–∑–¥–∞–Ω—ã
- [ ] –°–µ—Ä–≤–∏—Å—ã Vue.js –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üìù –≠—Ç–∞–ø 5: –ü–µ—Ä–µ–¥–µ–ª–∫–∞/—Å–æ–∑–¥–∞–Ω–∏–µ WebhookLogsCache –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–¶–µ–ª—å:** –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å `WebhookLogsCache` –∏ –æ–±–Ω–æ–≤–∏—Ç—å –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–µ–º.

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~4-5 —á–∞—Å–æ–≤  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π

### –ü–æ–¥—ç—Ç–∞–ø 5.1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–¥–µ–ª–∫–∞ WebhookLogsCache

**–§–∞–π–ª:** `api/cache/WebhookLogsCache.php` (–Ω–æ–≤—ã–π –∏–ª–∏ –ø–µ—Ä–µ–¥–µ–ª–∫–∞)

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –∫–µ—à –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∫–µ—à–∞:**
   - –ò–∑—É—á–∏—Ç—å `src/WebhookLogs/Service/WebhookLogsApiCache.php`
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞—Ç—å

2. **–°–æ–∑–¥–∞—Ç—å `api/cache/WebhookLogsCache.php`** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∂–∏–º–æ–≤:**
   - `api` ‚Äî –∫–µ—à API –∑–∞–ø—Ä–æ—Å–æ–≤
   - `realtime` ‚Äî –∫–µ—à realtime –¥–∞–Ω–Ω—ã—Ö
   - `stats` ‚Äî –∫–µ—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –ö–µ—à –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤ –ø–µ—Ä–µ–¥–µ–ª–∞–Ω –∏–ª–∏ —Å–æ–∑–¥–∞–Ω
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∂–∏–º–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

---

### –ü–æ–¥—ç—Ç–∞–ø 5.2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–µ–º

**–§–∞–π–ª:** `api/admin/cache-status.php`

**–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –≤ —Å–ø–∏—Å–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö –∫–µ—à–µ–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∂–∏–º–æ–≤.

**–î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏:**

1. **–û–±–Ω–æ–≤–∏—Ç—å `api/admin/cache-status.php` (–¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏):**
   ```php
   // –ú–æ–¥—É–ª—å 4: –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–° (—Å —Ä–µ–∂–∏–º–∞–º–∏)
   $timeTrackingBaseDir = __DIR__ . '/../cache/time-tracking-sector-1c';
   $timeTrackingModes = [
       [
           'id' => 'time-tracking-default',
           'name' => '–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)',
           'cache_dir' => $timeTrackingBaseDir . '/default',
           'ttl' => 300
       ],
       [
           'id' => 'time-tracking-detailed',
           'name' => '–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)',
           'cache_dir' => $timeTrackingBaseDir . '/detailed',
           'ttl' => 120
       ],
       [
           'id' => 'time-tracking-summary',
           'name' => '–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)',
           'cache_dir' => $timeTrackingBaseDir . '/summary',
           'ttl' => 600
       ]
   ];
   
   foreach ($timeTrackingModes as $mode) {
       $cacheInfo = getCacheInfo($mode['cache_dir'], $mode['ttl']);
       $modules[] = [
           'id' => $mode['id'],
           'name' => $mode['name'],
           'cache_dir' => 'api/cache/time-tracking-sector-1c/' . basename($mode['cache_dir']),
           'status' => $cacheInfo['status'],
           'file_count' => $cacheInfo['file_count'],
           'total_size' => $cacheInfo['total_size'],
           'ttl' => $mode['ttl'],
           'created_at' => $cacheInfo['created_at'],
           'expires_at' => $cacheInfo['expires_at'],
           'status_text' => $cacheInfo['status_text']
       ];
   }
   
   // –ú–æ–¥—É–ª—å 5: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (—Å —Ä–µ–∂–∏–º–∞–º–∏)
   $usersManagementBaseDir = __DIR__ . '/../cache/users-management';
   $usersManagementModes = [
       [
           'id' => 'users-management-departments',
           'name' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–æ—Ç–¥–µ–ª—ã)',
           'cache_dir' => $usersManagementBaseDir . '/departments',
           'ttl' => 3600
       ],
       [
           'id' => 'users-management-users',
           'name' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)',
           'cache_dir' => $usersManagementBaseDir . '/users',
           'ttl' => 1800
       ],
       [
           'id' => 'users-management-config',
           'name' => '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)',
           'cache_dir' => $usersManagementBaseDir . '/config',
           'ttl' => 300
       ]
   ];
   
   foreach ($usersManagementModes as $mode) {
       $cacheInfo = getCacheInfo($mode['cache_dir'], $mode['ttl']);
       $modules[] = [
           'id' => $mode['id'],
           'name' => $mode['name'],
           'cache_dir' => 'api/cache/users-management/' . basename($mode['cache_dir']),
           'status' => $cacheInfo['status'],
           'file_count' => $cacheInfo['file_count'],
           'total_size' => $cacheInfo['total_size'],
           'ttl' => $mode['ttl'],
           'created_at' => $cacheInfo['created_at'],
           'expires_at' => $cacheInfo['expires_at'],
           'status_text' => $cacheInfo['status_text']
       ];
   }
   
   // –ú–æ–¥—É–ª—å 6: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—Å —Ä–µ–∂–∏–º–∞–º–∏)
   $userActivityBaseDir = __DIR__ . '/../cache/user-activity';
   $userActivityModes = [
       [
           'id' => 'user-activity-stats',
           'name' => '–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)',
           'cache_dir' => $userActivityBaseDir . '/stats',
           'ttl' => 300
       ],
       [
           'id' => 'user-activity-list',
           'name' => '–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—Å–ø–∏—Å–æ–∫)',
           'cache_dir' => $userActivityBaseDir . '/list',
           'ttl' => 120
       ],
       [
           'id' => 'user-activity-filters',
           'name' => '–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—Ñ–∏–ª—å—Ç—Ä—ã)',
           'cache_dir' => $userActivityBaseDir . '/filters',
           'ttl' => 60
       ]
   ];
   
   foreach ($userActivityModes as $mode) {
       $cacheInfo = getCacheInfo($mode['cache_dir'], $mode['ttl']);
       $modules[] = [
           'id' => $mode['id'],
           'name' => $mode['name'],
           'cache_dir' => 'api/cache/user-activity/' . basename($mode['cache_dir']),
           'status' => $cacheInfo['status'],
           'file_count' => $cacheInfo['file_count'],
           'total_size' => $cacheInfo['total_size'],
           'ttl' => $mode['ttl'],
           'created_at' => $cacheInfo['created_at'],
           'expires_at' => $cacheInfo['expires_at'],
           'status_text' => $cacheInfo['status_text']
       ];
   }
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å `api/admin/cache-clear.php` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–∂–∏–º–æ–≤:**
   ```php
   // –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
   case 'time-tracking-default':
       TimeTrackingCache::clearByMode('default');
       $clearedModules[] = $moduleId;
       break;
   
   case 'time-tracking-detailed':
       TimeTrackingCache::clearByMode('detailed');
       $clearedModules[] = $moduleId;
       break;
   
   case 'time-tracking-summary':
       TimeTrackingCache::clearByMode('summary');
       $clearedModules[] = $moduleId;
       break;
   
   // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –º–æ–¥—É–ª—è (–≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤)
   case 'time-tracking-sector-1c':
       TimeTrackingCache::clear();
       $clearedModules[] = 'time-tracking-default';
       $clearedModules[] = 'time-tracking-detailed';
       $clearedModules[] = 'time-tracking-summary';
       break;
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `getCacheInfo()`:**
   - –§—É–Ω–∫—Ü–∏—è —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
   - –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—É—Å—Ç—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- [ ] –í—Å–µ –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –º–æ–¥—É–ª–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] –í—Å–µ —Ä–µ–∂–∏–º—ã –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- [ ] –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ä–µ–∂–∏–º–∞–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
- [ ] –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –º–æ–¥—É–ª—è –æ—á–∏—â–∞–µ—Ç –≤—Å–µ —Ä–µ–∂–∏–º—ã

---

## üîó API-–º–µ—Ç–æ–¥—ã

### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∫–µ—à–∞:

1. **`get(string $key): ?array`** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–µ—à–∞
2. **`set(string $key, array $data, int $ttl = null): bool`** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–µ—à
3. **`delete(string $key): bool`** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –∫–µ—à–∞
4. **`clear(): bool`** ‚Äî –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫–µ—à–∞
5. **`clearByMode(string $mode): bool`** ‚Äî –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
6. **`clearExpired(): int`** ‚Äî –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç—ë–∫—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
7. **`generateKey(array $params, string $mode): string`** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∫–µ—à–∞
8. **`isExpired(string $key): bool`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è

---

## üé® –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–µ—à–∞:

**–ï–¥–∏–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π:**
```
api/cache/{module-name}/
‚îú‚îÄ‚îÄ {mode1}/          # –†–µ–∂–∏–º 1
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îú‚îÄ‚îÄ {mode2}/          # –†–µ–∂–∏–º 2
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îî‚îÄ‚îÄ {mode3}/          # –†–µ–∂–∏–º 3
    ‚îî‚îÄ‚îÄ *.json
```

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞:

- –ò–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞: `{mode}_{hash}`
- –ß–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä –º–µ—Ç–æ–¥–∞: `generateKey($params, $mode)`

### TTL –¥–ª—è —Ä–µ–∂–∏–º–æ–≤:

- –ö–∞–∂–¥—ã–π —Ä–µ–∂–∏–º –∏–º–µ–µ—Ç —Å–≤–æ–π TTL
- TTL –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `set()`

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:

- [ ] –í—Å–µ 4 –º–æ–¥—É–ª—è –ø–µ—Ä–µ–¥–µ–ª–∞–Ω—ã –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∂–∏–º–æ–≤
- [ ] –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
- [ ] –†–∞–∑–Ω—ã–µ TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ú–µ—Ç–æ–¥ `clearByMode()` —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- [ ] –ú–µ—Ç–æ–¥ `generateKey()` —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- [ ] –ú–µ—Ç–æ–¥ `isExpired()` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ú–µ—Ç–æ–¥ `clearExpired()` –æ—á–∏—â–∞–µ—Ç –∏—Å—Ç—ë–∫—à–∏–µ –∑–∞–ø–∏—Å–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:

- [ ] –í—Å–µ –º–æ–¥—É–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∂–∏–º–∞–º–∏
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —ç—Ç–∞–ª–æ–Ω—É
- [ ] –ö–ª—é—á–∏ –∫–µ—à–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–µ–∂–∏–º–∞
- [ ] –ü—Ä–µ—Ñ–∏–∫—Å—ã –∫–ª—é—á–µ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
- [ ] –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:

- [ ] –í—Å–µ –º–æ–¥—É–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–µ–º
- [ ] –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ä–µ–∂–∏–º–∞–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
- [ ] –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –º–æ–¥—É–ª—è –æ—á–∏—â–∞–µ—Ç –≤—Å–µ —Ä–µ–∂–∏–º—ã
- [ ] CacheStore wrapper –æ–±–Ω–æ–≤–ª–µ–Ω (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö:

- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–µ—à–µ–º
- [ ] –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `forceRefresh` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

- [ ] –í—Å–µ —Ä–µ–∂–∏–º—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] TTL —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
- [ ] –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∏–∑ –∫–ª—é—á–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–ª—è TimeTrackingCache)

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

- [ ] –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ (–≤—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–∞ < 10ms)
- [ ] –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- [ ] –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ –∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è (TimeTrackingCache, UsersManagementCache, UserActivityCache, WebhookLogsCache):

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞:**
- [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
- [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã TTL –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
- [ ] –ú–µ—Ç–æ–¥ `getModeFromKey()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `getTTLForMode()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `getCacheDirForMode()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- [ ] –ú–µ—Ç–æ–¥ `get()` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —ç—Ç–∞–ª–æ–Ω—É)
- [ ] –ú–µ—Ç–æ–¥ `set()` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –∞—Ç–æ–º–∞—Ä–Ω–æ–π –∑–∞–ø–∏—Å—å—é
- [ ] –ú–µ—Ç–æ–¥ `delete()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `clear()` –æ—á–∏—â–∞–µ—Ç –≤—Å–µ —Ä–µ–∂–∏–º—ã
- [ ] –ú–µ—Ç–æ–¥ `clearByMode()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `clearExpired()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `isExpired()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

**–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- [ ] –ú–µ—Ç–æ–¥ `getCachePath()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `ensureCacheDirectory()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `clearDirectory()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–µ—Ç–æ–¥ `clearExpiredInDirectory()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π:**
- [ ] –ú–µ—Ç–æ–¥ `generateKey()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –†–µ–∂–∏–º-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è
- [ ] –ü—Ä–µ—Ñ–∏–∫—Å —Ä–µ–∂–∏–º–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–ª—é—á

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- [ ] CacheStore wrapper –æ–±–Ω–æ–≤–ª–µ–Ω (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- [ ] –°–µ—Ä–≤–∏—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- [ ] –í—Å–µ —Ä–µ–∂–∏–º—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] TTL —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û—á–∏—Å—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–ª—è TimeTrackingCache)

**–ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- [ ] –ú–æ–¥—É–ª—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ `cache-status.php`
- [ ] –í—Å–µ —Ä–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- [ ] –û—á–∏—Å—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
- [ ] –û—á–∏—Å—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ–≥–æ –º–æ–¥—É–ª—è

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–µ—à–∞ —Å —Ä–µ–∂–∏–º–∞–º–∏

### –ü—Ä–∏–º–µ—Ä 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–µ (TimeTrackingService)

**–ü–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–ø–æ –æ–±—Ä–∞–∑—Ü—É GraphAdmissionClosureService):**

```php
// –í –º–µ—Ç–æ–¥–µ getTimeTrackingData()

// 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
$mode = 'default';
if ($params['includeTaskDetails'] ?? false) {
    $mode = 'detailed';
} elseif ($params['summary'] ?? false) {
    $mode = 'summary';
}

// 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ (–µ—Å–ª–∏ –Ω–µ forceRefresh)
if (!$forceRefresh && $this->cacheStore !== null) {
    $cacheKey = $this->cacheStore->generateKey($params, $mode);
    $cachedData = $this->cacheStore->get($cacheKey);
    
    if ($cachedData !== null) {
        error_log("[TimeTrackingService] Cache hit: {$cacheKey} (mode: {$mode})");
        return $cachedData;
    }
    
    error_log("[TimeTrackingService] Cache miss: {$cacheKey} (mode: {$mode})");
}

// 3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Bitrix24 API
// ... –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ...

// 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à
if (!$forceRefresh && $this->cacheStore !== null) {
    $cacheKey = $this->cacheStore->generateKey($params, $mode);
    // TTL –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–µ–∂–∏–º—É
    if ($this->cacheStore->set($cacheKey, $response)) {
        error_log("[TimeTrackingService] Cache saved: {$cacheKey} (mode: {$mode})");
    }
    
    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ (–∫–∞–∂–¥—ã–π 10-–π –∑–∞–ø—Ä–æ—Å)
    if (rand(1, 10) === 1) {
        $deleted = $this->cacheStore->clearExpired();
        if ($deleted > 0) {
            error_log("[TimeTrackingService] Cleared {$deleted} expired entries");
        }
    }
}
```

### –ü—Ä–∏–º–µ—Ä 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤

**–†–µ–∂–∏–º "default":**
```php
$params = [
    'product' => '1C',
    'weekStartUtc' => '2025-12-01T00:00:00Z',
    'weekEndUtc' => '2025-12-07T23:59:59Z'
];
$key = TimeTrackingCache::generateKey($params, 'default');
// –†–µ–∑—É–ª—å—Ç–∞—Ç: "default_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
```

**–†–µ–∂–∏–º "detailed":**
```php
$params = [
    'product' => '1C',
    'weekStartUtc' => '2025-12-01T00:00:00Z',
    'weekEndUtc' => '2025-12-07T23:59:59Z',
    'includeTaskDetails' => true,
    'includeEmployeeDetails' => true
];
$key = TimeTrackingCache::generateKey($params, 'detailed');
// –†–µ–∑—É–ª—å—Ç–∞—Ç: "detailed_x9y8z7w6v5u4t3s2r1q0p9o8n7m6"
```

**–†–µ–∂–∏–º "summary":**
```php
$params = [
    'product' => '1C',
    'summary' => true
];
$key = TimeTrackingCache::generateKey($params, 'summary');
// –†–µ–∑—É–ª—å—Ç–∞—Ç: "summary_m1n2o3p4q5r6s7t8u9v0w1x2y3z4"
```

### –ü—Ä–∏–º–µ—Ä 3: –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

```php
// –û—á–∏—Å—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
TimeTrackingCache::clearByMode('detailed');

// –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
TimeTrackingCache::clear();

// –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç—ë–∫—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
$deleted = TimeTrackingCache::clearExpired();
error_log("Cleared {$deleted} expired cache entries");
```

### –ü—Ä–∏–º–µ—Ä 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CacheStore wrapper

```php
// –°–æ–∑–¥–∞–Ω–∏–µ CacheStore
require_once __DIR__ . '/cache/CacheStore.php';
$cacheStore = new CacheStore();

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–µ
$cacheKey = $cacheStore->generateKey($params, 'default');
$cached = $cacheStore->get($cacheKey);

if ($cached === null) {
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    $data = fetchDataFromAPI($params);
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à
    $cacheStore->set($cacheKey, $data);
}
```

---

## üîç –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–∏–∑ —ç—Ç–∞–ª–æ–Ω–∞)

### 1. –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å race conditions.

**–†–µ—à–µ–Ω–∏–µ (–∏–∑ GraphAdmissionClosureCache):**
```php
// –ó–∞–ø–∏—Å—å –≤ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
$tempPath = $cachePath . '.tmp';
if (@file_put_contents($tempPath, $json, LOCK_EX) === false) {
    error_log("[Cache] Failed to write cache file: {$tempPath}");
    return false;
}

// –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
if (!@rename($tempPath, $cachePath)) {
    error_log("[Cache] Failed to rename cache file: {$tempPath} -> {$cachePath}");
    @unlink($tempPath);
    return false;
}
```

**–í–∞–∂–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `LOCK_EX` –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏
- –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `rename()` (–∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –§–°)
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ

### 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞

**–ü–∞—Ç—Ç–µ—Ä–Ω (–∏–∑ GraphAdmissionClosureCache):**
```php
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫–ª—é—á–∞
$periodMode = strpos($key, 'weeks_') === 0 ? 'weeks' : 'months';
```

**–í–∞–∂–Ω–æ:**
- –ü—Ä–µ—Ñ–∏–∫—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
- –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–∂–µ–Ω (—Å–Ω–∞—á–∞–ª–∞ –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã)
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π —Ä–µ–∂–∏–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'months' –∏–ª–∏ 'default')

### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π

**–ü–∞—Ç—Ç–µ—Ä–Ω (–∏–∑ GraphAdmissionClosureCache::generateKey()):**
```php
// –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
$normalized = [
    'product' => $params['product'] ?? '1C',
    'periodMode' => $params['periodMode'] ?? 'months',
    // ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
];

// –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
if ($normalized['periodMode'] === 'weeks') {
    $normalized['weekStartUtc'] = $params['weekStartUtc'] ?? null;
    $normalized['weekEndUtc'] = $params['weekEndUtc'] ?? null;
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è MD5 —Ö–µ—à–∞
$keyString = json_encode($normalized, JSON_UNESCAPED_UNICODE);
$hash = md5($keyString);

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞ —Ä–µ–∂–∏–º–∞
$prefix = $normalized['periodMode'] === 'weeks' ? 'weeks' : 'months';
return $prefix . '_' . $hash;
```

**–í–∞–∂–Ω–æ:**
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:** –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è (–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤:** –ú–∞—Å—Å–∏–≤—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- **JSON_UNESCAPED_UNICODE:** –î–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–π
- **–†–µ–∂–∏–º-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:** –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### 4. –†–∞–∑–Ω—ã–µ TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤

**–ü–∞—Ç—Ç–µ—Ä–Ω (–∏–∑ GraphAdmissionClosureCache):**
```php
// –í –º–µ—Ç–æ–¥–µ set() TTL –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —è–≤–Ω–æ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
public static function set(string $key, array $data, int $ttl = self::DEFAULT_TTL): bool
{
    $periodMode = strpos($key, 'weeks_') === 0 ? 'weeks' : 'months';
    
    // –î–ª—è —Ä–µ–∂–∏–º–∞ "weeks" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ–Ω—å—à–∏–π TTL (2 –º–∏–Ω—É—Ç—ã)
    // –î–ª—è —Ä–µ–∂–∏–º–∞ "months" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–æ–ª—å—à–∏–π TTL (5 –º–∏–Ω—É—Ç)
    // TTL –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–µ—Ç–æ–¥–∞
}
```

**–í–∞–∂–Ω–æ:**
- TTL –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–µ–∂–∏–º—É (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω —è–≤–Ω–æ)
- –î–ª—è —Ä–µ–∂–∏–º–æ–≤ —Å –±–æ–ª–µ–µ —á–∞—Å—Ç—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ–Ω—å—à–∏–π TTL
- TTL –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `set()`

### 5. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π

**–ü–∞—Ç—Ç–µ—Ä–Ω (–∏–∑ GraphAdmissionClosureService):**
```php
// –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π (–∫–∞–∂–¥—ã–π 10-–π –∑–∞–ø—Ä–æ—Å)
if (rand(1, 10) === 1) {
    $deleted = $this->cacheStore->clearExpired();
    if ($deleted > 0) {
        error_log("[Cache] Cleared {$deleted} expired cache entries");
    }
}
```

**–í–∞–∂–Ω–æ:**
- –û—á–∏—Å—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ (–∫–∞–∂–¥—ã–π 10-–π –∑–∞–ø—Ä–æ—Å) –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- –ú–µ—Ç–æ–¥ `clearExpired()` –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º —Ñ–∞–π–ª–∞–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `expires_at`
- –ò—Å—Ç—ë–∫—à–∏–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–µ—à–µ–º

**–ü–∞—Ç—Ç–µ—Ä–Ω (–∏–∑ GraphAdmissionClosureService):**
```php
// Cache hit
error_log("[Cache] Cache hit for key: {$cacheKey}");

// Cache miss
error_log("[Cache] Cache miss for key: {$cacheKey}");

// Force refresh
error_log("[Cache] Force refresh requested, skipping cache check");

// Cache saved
error_log("[Cache] Cache saved for key: {$cacheKey}");

// Cache failed
error_log("[Cache] Failed to save cache for key: {$cacheKey}");
```

**–í–∞–∂–Ω–æ:**
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ü—Ä–µ—Ñ–∏–∫—Å `[Cache]` –∏–ª–∏ `[ModuleNameCache]` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

1. **–≠—Ç–∞–ª–æ–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `GraphAdmissionClosureCache.php` –∫–∞–∫ –æ–±—Ä–∞–∑–µ—Ü
   - –°–ª–µ–¥–æ–≤–∞—Ç—å —Ç–æ–π –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º
   - –í—Å–µ –º–µ—Ç–æ–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é (–Ω–µ –∑–∞–≥–ª—É—à–∫–∏)

2. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
   - –î–ª—è `TimeTrackingCache` –æ–±–µ—Å–ø–µ—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
   - –°—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ —Ä–µ–∂–∏–º–∞ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ `default`
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Å—Ç–∞—Ä—ã—Ö –∫–ª—é—á–µ–π –≤ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `default/`

3. **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   - –ü—Ä–∏ –ø–µ—Ä–µ–¥–µ–ª–∫–µ `TimeTrackingCache` —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –∫–µ—à–∞ –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å
   - –ò–ª–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `default/`
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (–æ–Ω–∏ –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–¥—É—Ç—Å—è)

4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ö–µ—à –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–æ
   - –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—É—é –∑–∞–ø–∏—Å—å –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É

5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

6. **–û—Ç–ª–∞–¥–∫–∞:**
   - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
   - –ü—Ä–µ—Ñ–∏–∫—Å—ã –ª–æ–≥–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üìö –î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–ª–∞—Å—Å–∞ TimeTrackingCache

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞ (–ø–æ –æ–±—Ä–∞–∑—Ü—É GraphAdmissionClosureCache):**

```php
<?php
/**
 * –§–∞–π–ª–æ–≤—ã–π –∫–µ—à –¥–ª—è API endpoint tickets-time-tracking-sector-1c.php
 * 
 * TASK-075: –ü–µ—Ä–µ–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∂–∏–º–æ–≤ (default, detailed, summary)
 * 
 * –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: api/cache/TimeTrackingCache.php
 * 
 * –£–ø—Ä–∞–≤–ª—è–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö
 */
class TimeTrackingCache
{
    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
    private const CACHE_BASE_DIR = __DIR__ . '/time-tracking-sector-1c';
    private const CACHE_DEFAULT_DIR = self::CACHE_BASE_DIR . '/default';
    private const CACHE_DETAILED_DIR = self::CACHE_BASE_DIR . '/detailed';
    private const CACHE_SUMMARY_DIR = self::CACHE_BASE_DIR . '/summary';
    
    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã TTL
    private const DEFAULT_TTL = 300;      // 5 –º–∏–Ω—É—Ç
    private const DETAILED_TTL = 120;     // 2 –º–∏–Ω—É—Ç—ã
    private const SUMMARY_TTL = 600;      // 10 –º–∏–Ω—É—Ç
    
    // –í—Å–µ –º–µ—Ç–æ–¥—ã –ø–æ –æ–±—Ä–∞–∑—Ü—É GraphAdmissionClosureCache
    // (get, set, delete, clear, clearByMode, generateKey, etc.)
}
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–µ—Ä–≤–∏—Å–µ

**–ü–∞—Ç—Ç–µ—Ä–Ω (–∏–∑ GraphAdmissionClosureService):**

```php
// –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ —Å–µ—Ä–≤–∏—Å–∞
$this->cacheStore = new CacheStore();

// –í –º–µ—Ç–æ–¥–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
public function handle(array $payload): array
{
    $forceRefresh = $payload['forceRefresh'] ?? false;
    
    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞
    $mode = 'default';
    if ($payload['includeTaskDetails'] ?? false) {
        $mode = 'detailed';
    } elseif ($payload['summary'] ?? false) {
        $mode = 'summary';
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞
    if (!$forceRefresh) {
        $cacheKey = $this->cacheStore->generateKey($payload, $mode);
        $cachedData = $this->cacheStore->get($cacheKey);
        
        if ($cachedData !== null) {
            error_log("[TimeTrackingService] Cache hit: {$cacheKey} (mode: {$mode})");
            return $cachedData;
        }
        
        error_log("[TimeTrackingService] Cache miss: {$cacheKey} (mode: {$mode})");
    }
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    $data = $this->fetchDataFromAPI($payload);
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à
    if (!$forceRefresh) {
        $cacheKey = $this->cacheStore->generateKey($payload, $mode);
        if ($this->cacheStore->set($cacheKey, $data)) {
            error_log("[TimeTrackingService] Cache saved: {$cacheKey} (mode: {$mode})");
        }
        
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
        if (rand(1, 10) === 1) {
            $deleted = $this->cacheStore->clearExpired();
            if ($deleted > 0) {
                error_log("[TimeTrackingService] Cleared {$deleted} expired entries");
            }
        }
    }
    
    return $data;
}
```

---

## üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ "–î–æ" –∏ "–ü–æ—Å–ª–µ"

### –î–æ –ø–µ—Ä–µ–¥–µ–ª–∫–∏ (TimeTrackingCache):

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
api/cache/time-tracking-sector-1c/
‚îî‚îÄ‚îÄ *.json           # –í—Å–µ —Ñ–∞–π–ª—ã –≤ –æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```php
// –û–¥–∏–Ω —Ä–µ–∂–∏–º, –æ–¥–∏–Ω TTL
$cacheKey = 'time-tracking_' . md5(json_encode($params));
$cached = TimeTrackingCache::get($cacheKey);
if ($cached === null) {
    $data = fetchData();
    TimeTrackingCache::set($cacheKey, $data, 300); // –í—Å–µ–≥–¥–∞ 5 –º–∏–Ω—É—Ç
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ —Ä–µ–∂–∏–º–∞–º
- ‚ùå –û–¥–∏–Ω TTL –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ù–µ—Ç —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

### –ü–æ—Å–ª–µ –ø–µ—Ä–µ–¥–µ–ª–∫–∏ (TimeTrackingCache):

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
api/cache/time-tracking-sector-1c/
‚îú‚îÄ‚îÄ default/          # –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (TTL: 5 –º–∏–Ω)
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îú‚îÄ‚îÄ detailed/          # –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (TTL: 2 –º–∏–Ω)
‚îÇ   ‚îî‚îÄ‚îÄ *.json
‚îî‚îÄ‚îÄ summary/           # –°–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º (TTL: 10 –º–∏–Ω)
    ‚îî‚îÄ‚îÄ *.json
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```php
// –†–∞–∑–Ω—ã–µ —Ä–µ–∂–∏–º—ã, —Ä–∞–∑–Ω—ã–µ TTL
$mode = $params['includeTaskDetails'] ? 'detailed' : 'default';
$cacheKey = TimeTrackingCache::generateKey($params, $mode);
$cached = TimeTrackingCache::get($cacheKey);
if ($cached === null) {
    $data = fetchData();
    // TTL –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–µ–∂–∏–º—É
    TimeTrackingCache::set($cacheKey, $data);
}

// –û—á–∏—Å—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
TimeTrackingCache::clearByMode('detailed');
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–µ–∂–∏–º–∞–º —á–µ—Ä–µ–∑ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- ‚úÖ –†–∞–∑–Ω—ã–µ TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—á–∏—Å—Ç–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
- ‚úÖ –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏
- ‚úÖ –ï–¥–∏–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

---

## ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### –û—à–∏–±–∫–∞ 1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
private static function getModeFromKey(string $key): string
{
    if (strpos($key, 'default_') === 0) {  // default –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º
        return 'default';
    }
    if (strpos($key, 'detailed_') === 0) {
        return 'detailed';
    }
    // detailed_ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω, –µ—Å–ª–∏ –∫–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å default_
}
```

**–†–µ—à–µ–Ω–∏–µ:**
```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –°–Ω–∞—á–∞–ª–∞ –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã
private static function getModeFromKey(string $key): string
{
    if (strpos($key, 'detailed_') === 0) {  // –°–Ω–∞—á–∞–ª–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ
        return 'detailed';
    }
    if (strpos($key, 'summary_') === 0) {
        return 'summary';
    }
    return 'default';  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –∫–æ–Ω—Ü–µ
}
```

### –û—à–∏–±–∫–∞ 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ú–∞—Å—Å–∏–≤—ã –Ω–µ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
$normalized = [
    'employeeIds' => $params['employeeIds'] ?? []  // –ú–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
];
$keyString = json_encode($normalized);
```

**–†–µ—à–µ–Ω–∏–µ:**
```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
$normalized = [
    'employeeIds' => isset($params['employeeIds']) && is_array($params['employeeIds'])
        ? sort($params['employeeIds']) ? $params['employeeIds'] : []
        : []
];
$keyString = json_encode($normalized, JSON_UNESCAPED_UNICODE);
```

### –û—à–∏–±–∫–∞ 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞—Ç–æ–º–∞—Ä–Ω–æ–π –∑–∞–ø–∏—Å–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ü—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö)
file_put_contents($cachePath, $json);
```

**–†–µ—à–µ–Ω–∏–µ:**
```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
$tempPath = $cachePath . '.tmp';
if (@file_put_contents($tempPath, $json, LOCK_EX) === false) {
    return false;
}
if (!@rename($tempPath, $cachePath)) {
    @unlink($tempPath);
    return false;
}
```

### –û—à–∏–±–∫–∞ 4: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TTL

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω TTL
TimeTrackingCache::set($key, $data, 300);  // –í—Å–µ–≥–¥–∞ 5 –º–∏–Ω—É—Ç
```

**–†–µ—à–µ–Ω–∏–µ:**
```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: TTL –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–µ–∂–∏–º—É
$mode = self::getModeFromKey($key);
$ttl = self::getTTLForMode($mode);  // –†–∞–∑–Ω—ã–µ TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
TimeTrackingCache::set($key, $data, $ttl);
// –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ:
TimeTrackingCache::set($key, $data);  // TTL –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### –û—à–∏–±–∫–∞ 5: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
$cached = TimeTrackingCache::get($key);
```

**–†–µ—à–µ–Ω–∏–µ:**
```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
$cached = TimeTrackingCache::get($key);
if ($cached !== null) {
    error_log("[TimeTrackingCache] Cache hit for key: {$key}");
} else {
    error_log("[TimeTrackingCache] Cache miss for key: {$key}");
}
```

---

## üîÑ –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∞–≤–æ–∫

- 2025-12-24 14:52 (UTC+3, –ë—Ä–µ—Å—Ç): –°–æ–∑–¥–∞–Ω —á–µ—Ä–Ω–æ–≤–∏–∫ –∑–∞–¥–∞—á–∏ TASK-075
- 2025-12-24 15:00 (UTC+3, –ë—Ä–µ—Å—Ç): –î–æ–ø–æ–ª–Ω–µ–Ω–∞ –¥–µ—Ç–∞–ª—è–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∂–∏–º–∞–º–∏
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–∞—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã CacheStore wrapper
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã generateKey() —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–¥—É–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–µ–º
  - –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π
  - –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º —ç—Ç–∞–ª–æ–Ω–∞
  - –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –î–æ –∏ –ü–æ—Å–ª–µ"
  - –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è"
  - –î–æ–±–∞–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∫–µ—à–∞ —Å —Ä–µ–∂–∏–º–∞–º–∏

**1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π:**
```php
// –¢–µ—Å—Ç 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ "default"
$params = ['product' => '1C', 'weekStartUtc' => '2025-12-01T00:00:00Z'];
$key1 = TimeTrackingCache::generateKey($params, 'default');
// –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: "default_{hash}"
assert(strpos($key1, 'default_') === 0);

// –¢–µ—Å—Ç 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ "detailed"
$params['includeTaskDetails'] = true;
$key2 = TimeTrackingCache::generateKey($params, 'detailed');
// –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: "detailed_{hash}"
assert(strpos($key2, 'detailed_') === 0);

// –¢–µ—Å—Ç 3: –†–∞–∑–Ω—ã–µ —Ä–µ–∂–∏–º—ã –¥–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏
assert($key1 !== $key2);
```

**2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞:**
```php
// –¢–µ—Å—Ç 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∏–∑ –∫–ª—é—á–∞
$mode1 = TimeTrackingCache::getModeFromKey('default_abc123');
assert($mode1 === 'default');

$mode2 = TimeTrackingCache::getModeFromKey('detailed_xyz789');
assert($mode2 === 'detailed');

$mode3 = TimeTrackingCache::getModeFromKey('summary_def456');
assert($mode3 === 'summary');
```

**3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∫–µ—à–∞:**
```php
// –¢–µ—Å—Ç 1: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
$key = TimeTrackingCache::generateKey(['product' => '1C'], 'default');
$data = ['test' => 'data'];

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
$saved = TimeTrackingCache::set($key, $data);
assert($saved === true);

// –ü–æ–ª—É—á–µ–Ω–∏–µ
$cached = TimeTrackingCache::get($key);
assert($cached === $data);

// –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ TTL
$key2 = TimeTrackingCache::generateKey(['product' => '1C'], 'detailed');
TimeTrackingCache::set($key2, $data, 60); // TTL: 60 —Å–µ–∫—É–Ω–¥

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
sleep(61);
$expired = TimeTrackingCache::isExpired($key2);
assert($expired === true);

// –¢–µ—Å—Ç 3: –û—á–∏—Å—Ç–∫–∞ –ø–æ —Ä–µ–∂–∏–º—É
TimeTrackingCache::set($key, $data); // default —Ä–µ–∂–∏–º
TimeTrackingCache::set($key2, $data); // detailed —Ä–µ–∂–∏–º

TimeTrackingCache::clearByMode('detailed');

// –ü—Ä–æ–≤–µ—Ä–∫–∞: default —Ä–µ–∂–∏–º –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è
$cached1 = TimeTrackingCache::get($key);
assert($cached1 !== null);

// –ü—Ä–æ–≤–µ—Ä–∫–∞: detailed —Ä–µ–∂–∏–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—á–∏—â–µ–Ω
$cached2 = TimeTrackingCache::get($key2);
assert($cached2 === null);
```

**4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
ls -la api/cache/time-tracking-sector-1c/
# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# default/
# detailed/
# summary/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∫–µ—à–∞
ls -la api/cache/time-tracking-sector-1c/default/
# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: *.json —Ñ–∞–π–ª—ã
```

**5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –º–æ–¥—É–ª–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–µ–º:**
- –û—Ç–∫—Ä—ã—Ç—å `/admin/cache` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–∏—Å—Ç–∫—É –∫–µ—à–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–∏—Å—Ç–∫—É –≤—Å–µ–≥–æ –º–æ–¥—É–ª—è (–≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤)

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —ç—Ç–∞–ª–æ–Ω–∞ GraphAdmissionClosureCache

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

**1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞:**
```php
// –ò–∑ GraphAdmissionClosureCache::get()
$periodMode = strpos($key, 'weeks_') === 0 ? 'weeks' : 'months';
```
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ—Ñ–∏–∫—Å–∞ `weeks_` –≤ –Ω–∞—á–∞–ª–µ –∫–ª—é—á–∞
- –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `months`
- –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–∂–µ–Ω (—Å–Ω–∞—á–∞–ª–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã)

**2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞:**
```php
// –ò–∑ GraphAdmissionClosureCache::generateKey()
$normalized = [
    'product' => $params['product'] ?? '1C',
    'periodMode' => $params['periodMode'] ?? 'months',
    // ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
];

// –î–ª—è —Ä–µ–∂–∏–º–∞ "weeks" –≤–∫–ª—é—á–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
if ($normalized['periodMode'] === 'weeks') {
    $normalized['weekStartUtc'] = $params['weekStartUtc'] ?? null;
    $normalized['weekEndUtc'] = $params['weekEndUtc'] ?? null;
}

$keyString = json_encode($normalized, JSON_UNESCAPED_UNICODE);
$hash = md5($keyString);
$prefix = $normalized['periodMode'] === 'weeks' ? 'weeks' : 'months';
return $prefix . '_' . $hash;
```
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –†–µ–∂–∏–º-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∫–ª—é—á–∞—é—Ç—Å—è —É—Å–ª–æ–≤–Ω–æ
- MD5 —Ö–µ—à –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –∫–ª—é—á–∞
- –ü—Ä–µ—Ñ–∏–∫—Å —Ä–µ–∂–∏–º–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ

**3. –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å:**
```php
// –ò–∑ GraphAdmissionClosureCache::set()
$tempPath = $cachePath . '.tmp';
if (@file_put_contents($tempPath, $json, LOCK_EX) === false) {
    error_log("[Cache] Failed to write cache file: {$tempPath}");
    return false;
}

if (!@rename($tempPath, $cachePath)) {
    error_log("[Cache] Failed to rename cache file: {$tempPath} -> {$cachePath}");
    @unlink($tempPath);
    return false;
}
```
- –ó–∞–ø–∏—Å—å –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π `LOCK_EX`
- –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `rename()`
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ

**4. –û—á–∏—Å—Ç–∫–∞ –ø–æ —Ä–µ–∂–∏–º–∞–º:**
```php
// –ò–∑ GraphAdmissionClosureCache::clear()
$success = true;

if (!self::clearDirectory(self::CACHE_WEEKS_DIR)) {
    $success = false;
}

if (!self::clearDirectory(self::CACHE_MONTHS_DIR)) {
    $success = false;
}

return $success;
```
- –û—á–∏—Å—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
- –í–æ–∑–≤—Ä–∞—Ç `false` –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–µ–∂–∏–º –Ω–µ –æ—á–∏—Å—Ç–∏–ª—Å—è

**5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–µ:**
```php
// –ò–∑ GraphAdmissionClosureService::handle()
if (!$forceRefresh) {
    $cacheKey = $this->getCacheKeyForWeeks($payload, $weekStart, $weekEnd);
    $cachedData = $this->cacheStore->get($cacheKey);
    
    if ($cachedData !== null) {
        error_log("[Cache] Cache hit for key: {$cacheKey}");
        return $cachedData;
    }
    
    error_log("[Cache] Cache miss for key: {$cacheKey}");
}

// ... –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ...

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à
$cacheKey = $this->cacheStore->generateKey([...]);
if ($this->cacheStore->set($cacheKey, $response, 300)) {
    error_log("[Cache] Cache saved for key: {$cacheKey}");
}

// –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
if (rand(1, 10) === 1) {
    $deleted = $this->cacheStore->clearExpired();
    if ($deleted > 0) {
        error_log("[Cache] Cleared {$deleted} expired cache entries");
    }
}
```
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `forceRefresh` –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–µ—à–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–µ—à–µ–π

---

## ‚ùì FAQ (–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã)

### Q1: –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–æ–π —Ä–µ–∂–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

**A:** –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞:
- **default** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **detailed** ‚Äî –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `includeTaskDetails: true`)
- **summary** ‚Äî –∫–æ–≥–¥–∞ –Ω—É–∂–Ω—ã –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `summary: true`)

**–ü—Ä–∏–º–µ—Ä:**
```php
$mode = 'default';
if ($params['includeTaskDetails'] ?? false) {
    $mode = 'detailed';
} elseif ($params['summary'] ?? false) {
    $mode = 'summary';
}
```

### Q2: –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –∫–ª—é—á–∞–º–∏ –∫–µ—à–∞ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ —Ä–µ–∂–∏–º–∞?

**A:** –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–µ–∂–∏–º `default`:
```php
private static function getModeFromKey(string $key): string
{
    // –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å–∞ —Ä–µ–∂–∏–º–∞ - —ç—Ç–æ —Ä–µ–∂–∏–º default
    if (strpos($key, 'detailed_') !== 0 && strpos($key, 'summary_') !== 0) {
        return 'default';
    }
    // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}
```

### Q3: –ú–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å TTL –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞?

**A:** –î–∞, TTL –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `set()`:
```php
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π TTL –ø–æ —Ä–µ–∂–∏–º—É
TimeTrackingCache::set($key, $data);

// –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ TTL
TimeTrackingCache::set($key, $data, 600); // 10 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö 5
```

### Q4: –ö–∞–∫ —á–∞—Å—Ç–æ –Ω—É–∂–Ω–æ –æ—á–∏—â–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–µ—à–∏?

**A:** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ (–∫–∞–∂–¥—ã–π 10-–π –∑–∞–ø—Ä–æ—Å):
```php
if (rand(1, 10) === 1) {
    $deleted = $cacheStore->clearExpired();
}
```
–≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∏ –Ω–µ –∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É.

### Q5: –ù—É–∂–Ω–æ –ª–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –∫–µ—à–∞?

**A:** –ù–µ—Ç, —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å. –û–Ω–∏ –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–¥—É—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö. –ò–ª–∏ –º–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `default/`:
```php
// –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
$oldFiles = glob(self::CACHE_BASE_DIR . '/*.json');
foreach ($oldFiles as $file) {
    $newPath = self::CACHE_DEFAULT_DIR . '/' . basename($file);
    @rename($file, $newPath);
}
```

### Q6: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ?

**A:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É:
```php
// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
error_log("[Cache] Cache hit for key: {$key}");
error_log("[Cache] Cache miss for key: {$key}");

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
$cached = TimeTrackingCache::get($key);
if ($cached !== null) {
    // –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
$expired = TimeTrackingCache::isExpired($key);
```

### Q7: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Ä–µ–∂–∏–º –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤?

**A:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –¥–∞, –Ω–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è. –†–∞–∑–Ω—ã–µ —Ä–µ–∂–∏–º—ã –ø–æ–∑–≤–æ–ª—è—é—Ç:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –û—á–∏—â–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `DOCS/ANALYSIS/cache-usage-analysis.md` ‚Äî –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–µ—à–∞
- `api/cache/GraphAdmissionClosureCache.php` ‚Äî —ç—Ç–∞–ª–æ–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- `api/cache/TimeTrackingCache.php` ‚Äî —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–ø–µ—Ä–µ–¥–µ–ª–∫–∞)
- `api/graph-admission-closure/service/GraphAdmissionClosureService.php` ‚Äî –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–µ—à–∞
- `api/graph-admission-closure/cache/CacheStore.php` ‚Äî –ø—Ä–∏–º–µ—Ä CacheStore wrapper
- `api/tickets-time-tracking-sector-1c/service/TimeTrackingService.php` ‚Äî —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞
- `api/tickets-time-tracking-sector-1c/cache/CacheStore.php` ‚Äî —Ç–µ–∫—É—â–∏–π CacheStore wrapper
- `DOCS/TASKS/TASK-072-users-management-module.md` ‚Äî –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `DOCS/TASKS/TASK-073-user-activity-tracking.md` ‚Äî –º–æ–¥—É–ª—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `DOCS/TASKS/TASK-074-cache-management-module.md` ‚Äî –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–µ–º

