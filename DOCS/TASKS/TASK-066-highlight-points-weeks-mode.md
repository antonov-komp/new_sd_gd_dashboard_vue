# TASK-066: Подсветка точек в линейных графиках (режим 4 недели)

**Дата создания:** 2025-12-23 13:27 (UTC+3, Брест)  
**Статус:** Завершена  
**Приоритет:** Средний  
**Исполнитель:** Bitrix24 Программист (Vue.js)

## Цель
Унифицировать визуал точек линейных графиков в недельном режиме (4 недели) с тем, как подсветка реализована в соседнем режиме «3 месяца»: точки должны быть видимыми и иметь одинаковый формат подсветки/лейблов.

## Контекст
- В режиме «3 месяца» (`LineChartMonths.vue`) точки линий видимы и сопровождаются datalabels с фоном/бордером (Chart.js + `chartjs-plugin-datalabels`).
- В недельном режиме (`GraphAdmissionClosureChart.vue`, chartType=line/lineBar) точки скрыты (`pointRadius: 0`), подсветка появляется только при hover, без datalabels.
- Нужно привести линейные графики 4-недельного режима к тому же формату подсветки точек, что и месячный режим, без изменения данных/контракта API.

## Требования
- Проанализировать реализацию подсветки в `LineChartMonths.vue`: подключение `chartjs-plugin-datalabels`, настройки `datalabels` (anchor/align, offset, фон/бордер, formatter), видимые точки (radius по умолчанию).
- Внедрить аналогичный формат подсветки точек для линейных графиков недельного режима в `GraphAdmissionClosureChart.vue` (chartType `line`/`lineBar`):
  - Показать маркеры точек на основных сериях (Новые, Закрытые, Переходящие) и вспомогательных линиях (созданы этой/предыдущей/остальными неделями) — радиус >0, цвет точки в цвет линии, белая обводка на hover.
  - Добавить datalabels с теми же стилями, что в режиме «3 месяца» (фон, бордер, скругление, anchor/align top/bottom для разделения серий, offset для читаемости).
  - Не ломать переключение типов графика (bar/doughnut) — подсветка точек и datalabels активны только в линейном представлении.
  - Формат чисел/нулей брать из текущей логики (formatter, `formatNumber`, защита от null/NaN).
- Сохранить существующий функционал легенды, tooltip, анимаций; не менять контракт данных.

## Область работ / файлы
- `vue-app/src/components/graph-admission-closure/GraphAdmissionClosureChart.vue` — линейные графики недельного режима (datasets `lineBarData`, options).
- `vue-app/src/components/graph-admission-closure/LineChartMonths.vue` — источник эталонного визуала подсветки точек (для повторного использования настроек).
- При необходимости: `chart-config.js` (цвета) — без изменения палитры, только реюз.

## План работ
1. Изучить настройки подсветки/лейблов в `LineChartMonths.vue` (ChartDataLabels, anchor/align, фон/бордер).
2. Подключить `chartjs-plugin-datalabels` в недельном компоненте (если ещё не подключен) и активировать его только для line-графика.
3. Настроить видимые точки в datasets недельного режима: задать `pointRadius`, `pointBorderWidth/Color`, `pointHover*`, различая основные и вспомогательные серии (радиусы можно сделать меньше для вспомогательных).
4. Добавить `datalabels` в datasets недельного режима по аналогии с месячным (отдельные anchor/align для новых/закрытых/переходящих, фон/бордер/offset).
5. Проверить, что bar/doughnut режим не затронут (условное включение плагина/опций).
6. Визуальный самотест: 4 недели — точки видимы, лейблы читаемы; 3 месяца — без регрессий.

## Критерии приёмки
- В недельном режиме линии отображают видимые точки (не скрыты `pointRadius: 0`), подсветка соответствует месячному режиму.
- Значения на точках выводятся через datalabels с фоном/бордером, anchor/align разделяют серии (например, новые — сверху, закрытые — снизу).
- Hover/tooltip и легенда работают как раньше; bar/doughnut режим не изменился.
- Месячный режим без регрессий.

## API-методы Bitrix24
- Не применимо: фронтенд-визуал, данные уже приходят из существующего API.

## Сроки
- Не заданы (указать после оценки).

## Вопросы/ответы
- Q: Нужно ли показывать лейблы для вспомогательных пунктирных линий?  
  A: Предлагается да, но с уменьшенным радиусом/offset; подтвердить с заказчиком.
- Q: Нужна ли опция отключения datalabels при переполнении?  
  A: Если будет наложение, добавить флаг в meta/props или отключать при малой ширине контейнера.

## История правок
- 2025-12-23 13:45 (UTC+3, Брест): Задача выполнена
  - Унифицированы настройки datalabels для недельного режима с месячным
  - Исправлен offset для переходящих тикетов с 8 на 4 (соответствие месячному режиму)
  - Проверена видимость точек для всех серий (основные: pointRadius: 4, вспомогательные: pointRadius: 3)
  - Подтверждено, что datalabels отключаются для bar/doughnut режима через проверку chartKind !== 'line'
  - Все настройки datalabels соответствуют месячному режиму:
    - Новые: anchor: 'end', align: 'top', offset: 10
    - Закрытые: anchor: 'start', align: 'bottom', offset: 10
    - Переходящие: anchor: 'end', align: 'top', offset: 4


