const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ticketListUtils-BfgHuqVX.js","assets/priority-config-DSBfLh-T.js","assets/main-CdghbI9g.js","assets/main-hkNOQW78.css","assets/priority-config-Bxxce_5E.css","assets/ticket-mapper-AuZ0dW5_.js"])))=>i.map(i=>d[i]);
var ye=Object.defineProperty;var me=(f,e,t)=>e in f?ye(f,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[e]=t;var K=(f,e,t)=>me(f,typeof e!="symbol"?e+"":e,t);import{_ as Z,g as h,c as B,a as y,o as c,b as s,t as I,F as L,e as Y,n as X,d as N,f as F,G as _e,H as P,I as q,j as $,k as A,B as M,T as ee,l as G,J as te,m as ve,S as pe,z as ge,r as ke,y as ne,L as fe}from"./main-CdghbI9g.js";import{F as he}from"./FiltersPanel-DnkmebqG.js";import{L as ie,D as Te,B as we}from"./index-C50BotPg.js";import{B as H,g as ce,a as be,b as de,D as Ie,T as se,c as ae}from"./priority-config-DSBfLh-T.js";const Ce={class:"ac-chart"},Ee={class:"ac-chart__header"},Se={class:"ac-chart__subtitle"},De={class:"ac-chart__controls"},$e={class:"chart-type-selector"},Ue=["onClick"],Ae={class:"chart-type-icon"},Be={class:"chart-type-label"},Re={class:"ac-chart__summary"},Ne={class:"summary-card__value"},Pe={class:"summary-card__value"},Me={class:"summary-card__value"},Oe={class:"summary-card summary-card--stages"},Le={class:"summary-card__tags"},Ye={key:0,class:"stage-tag stage-tag--empty"},Ve={class:"ac-chart__body"},Fe={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:null},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(f,{emit:e}){const t=f,r=e,o=[{value:"line",label:"Ð›Ð¸Ð½ÐµÐ¹Ð½Ñ‹Ð¹",icon:"ðŸ“ˆ"},{value:"bar",label:"Ð¡Ñ‚Ð¾Ð»Ð±Ñ‡Ð°Ñ‚Ñ‹Ð¹",icon:"ðŸ“Š"},{value:"doughnut",label:"ÐšÑ€ÑƒÐ³Ð¾Ð²Ð°Ñ",icon:"ðŸ©"}],d=h("line"),k=B(()=>{var w;return((w=t.meta)==null?void 0:w.weekNumber)??"â€”"}),u=B(()=>{var a,l,_;const w=["Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð½ÐµÐ´ÐµÐ»Ñ"],m=Array.isArray((a=t.data.series)==null?void 0:a.new)?t.data.series.new:[t.data.newTickets||0],b=Array.isArray((l=t.data.series)==null?void 0:l.closed)?t.data.series.closed:[t.data.closedTickets||0],v=Array.isArray((_=t.data.series)==null?void 0:_.carryover)?t.data.series.carryover:[t.data.carryoverTickets||0];return{labels:w,datasets:[{label:"ÐÐ¾Ð²Ñ‹Ðµ",data:m,backgroundColor:P.primary,borderColor:P.primary,tension:.3,fill:!1},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ",data:b,backgroundColor:P.success,borderColor:P.success,tension:.3,fill:!1},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",data:v,backgroundColor:P.carryover,borderColor:P.carryover,tension:.3,fill:!1}]}}),i=B(()=>({labels:["ÐÐ¾Ð²Ñ‹Ðµ","Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ","ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ"],datasets:[{data:[t.data.newTickets||0,t.data.closedTickets||0,t.data.carryoverTickets||0],backgroundColor:[P.primary,P.success,P.carryover],borderWidth:1}]})),p=B(()=>{switch(d.value){case"line":return ie;case"bar":return we;case"doughnut":return Te;default:return ie}}),E=B(()=>d.value==="doughnut"?i.value:u.value),U=B(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{enabled:!0},legend:{position:"top"}},onClick:(w,m,b)=>{var _,n,C;if(m.length===0)return;const a=m[0].datasetIndex,l=b.data.datasets[a];!l||!l.label||(l.label==="Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ"?(((_=t.data)==null?void 0:_.responsible)||[]).length>0&&r("open-responsible"):l.label==="ÐÐ¾Ð²Ñ‹Ðµ"?(((n=t.data)==null?void 0:n.newTickets)||0)>0&&r("open-stages"):l.label==="ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ"&&(((C=t.data)==null?void 0:C.carryoverTickets)||0)>0&&r("open-carryover"))},scales:d.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0}}}})),S=w=>{var m,b,v,a;w==="new"&&(((m=t.data)==null?void 0:m.newTickets)||0)>0?r("open-stages"):w==="closed"&&(((b=t.data)==null?void 0:b.closedTickets)||0)>0?(((v=t.data)==null?void 0:v.responsible)||[]).length>0&&r("open-responsible"):w==="carryover"&&(((a=t.data)==null?void 0:a.carryoverTickets)||0)>0&&r("open-carryover")};return(w,m)=>{var b,v;return c(),y("div",Ce,[s("header",Ee,[s("div",null,[m[3]||(m[3]=s("h2",{class:"ac-chart__title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),s("p",Se," ÐÐµÐ´ÐµÐ»Ñ "+I(k.value)+" Â· "+I(((b=f.meta)==null?void 0:b.weekStartUtc)||"â€”")+" â€” "+I(((v=f.meta)==null?void 0:v.weekEndUtc)||"â€”")+" (UTC) ",1)]),s("div",De,[s("div",$e,[(c(),y(L,null,Y(o,a=>s("button",{key:a.value,class:X(["chart-type-btn",{active:d.value===a.value}]),onClick:l=>d.value=a.value},[s("span",Ae,I(a.icon),1),s("span",Be,I(a.label),1)],10,Ue)),64))])])]),s("section",Re,[s("div",{class:"summary-card summary-card--new",onClick:m[0]||(m[0]=a=>S("new"))},[m[4]||(m[4]=s("div",{class:"summary-card__label"},"ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),s("div",Ne,I(f.data.newTickets??0),1)]),s("div",{class:"summary-card summary-card--closed",onClick:m[1]||(m[1]=a=>S("closed"))},[m[5]||(m[5]=s("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),s("div",Pe,I(f.data.closedTickets??0),1)]),s("div",{class:"summary-card summary-card--carryover",onClick:m[2]||(m[2]=a=>S("carryover"))},[m[6]||(m[6]=s("div",{class:"summary-card__label"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",-1)),s("div",Me,I(f.data.carryoverTickets??0),1)]),s("div",Oe,[m[7]||(m[7]=s("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),s("div",Le,[(c(!0),y(L,null,Y(f.data.stages||[],a=>(c(),y("span",{key:a.stageId,class:"stage-tag"},I(a.stageName||a.stageId)+" â€” "+I(a.count),1))),128)),!f.data.stages||f.data.stages.length===0?(c(),y("span",Ye," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):N("",!0)])])]),s("div",Ve,[(c(),F(_e(p.value),{data:E.value,options:U.value},null,8,["data","options"]))])])}}},Ge=Z(Fe,[["__scopeId","data-v-6690166f"]]);class Q{static async getSectorData(){try{const e=await this.getAllTickets();console.log("Total tickets loaded:",e.length);const t=this.extractUniqueEmployeeIds(e);console.log("Unique employee IDs:",t);const r=await this.getEmployeesByIds(t);return console.log("Loaded employees:",r.length),{stages:this.groupTicketsByStages(e,r),employees:r,zeroPointTickets:this.getZeroPointTickets(e)}}catch(e){throw console.error("Error getting sector data:",e),e}}static async getAllTickets(){const e=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],t=[];for(const r of e){console.log(`Loading tickets for stage: ${r}`);const o=await this.getTicketsByStage(r);t.push(...o),console.log(`Loaded ${o.length} tickets for stage ${r}`)}return t}static async getTicketsByStage(e){const t=[];let r=0;const o=50;let d=!0;for(;d;)try{const u=await H.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:e},select:["*"],order:{id:"DESC"},start:r,useOriginalUfNames:"Y"});let i=[];u&&u.result&&(Array.isArray(u.result)?i=u.result:u.result.items&&Array.isArray(u.result.items)?i=u.result.items:u.result.data&&Array.isArray(u.result.data)&&(i=u.result.data)),i.length>0?(t.push(...i),r+=i.length,d=i.length===o):d=!1}catch(u){console.error(`Error loading tickets batch for stage ${e} (start: ${r}):`,u),d=!1}t.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(t[0],null,2)),console.log("Sample ticket keys:",Object.keys(t[0])),console.log("Sample ticket assignedById variants:",{assignedById:t[0].assignedById,assignedByIdId:t[0].assignedByIdId,ASSIGNED_BY_ID:t[0].ASSIGNED_BY_ID}));const k=t.filter(u=>{const i=u.UF_CRM_7_TYPE_PRODUCT||u.uf_crm_7_type_product||u.ufCrm7TypeProduct||u.UF_CRM_7_TYPE_PRODUCT||u.uf_crm_7_type_product;return Array.isArray(i)?i.includes(this.SECTOR_TAG):typeof i=="object"&&i!==null?i.value===this.SECTOR_TAG||i===this.SECTOR_TAG:i===this.SECTOR_TAG});return console.log(`Filtered ${k.length} tickets from ${t.length} for stage ${e} (sector tag: ${this.SECTOR_TAG})`),k}static extractUniqueEmployeeIds(e){if(!Array.isArray(e))return[];const t=new Set;return e.forEach(r=>{const o=r.assignedById||r.assignedByIdId||r.ASSIGNED_BY_ID||r.assignedById||r.assignedById&&typeof r.assignedById=="object"&&(r.assignedById.id||r.assignedById.ID)||r.assignedById&&typeof r.assignedById=="object"&&r.assignedById.value;if(o){const d=parseInt(o);d&&!isNaN(d)&&d>0&&t.add(d)}}),e.length>0&&(console.log("Sample ticket for employee extraction:",e[0]),console.log("Sample ticket assignedById variants:",{assignedById:e[0].assignedById,assignedByIdId:e[0].assignedByIdId,ASSIGNED_BY_ID:e[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(t))),Array.from(t)}static async getEmployeesByIds(e){if(!Array.isArray(e)||e.length===0)return[];try{const t=await H.call("user.get",{filter:{ID:e}});let r=[];return t&&t.result&&(Array.isArray(t.result)?r=t.result:console.warn("Unexpected user.get result format:",t)),r.map(o=>({id:parseInt(o.ID||o.id||0),name:`${o.NAME||o.name||""} ${o.LAST_NAME||o.lastName||""}`.trim()||o.EMAIL||o.email||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹",position:o.WORK_POSITION||o.workPosition||"Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº",email:o.EMAIL||o.email||"",tickets:[]}))}catch(t){return console.error("Error getting employees by IDs:",t),[]}}static groupTicketsByStages(e,t){Array.isArray(e)||(console.warn("Tickets is not an array:",e),e=[]),Array.isArray(t)||(console.warn("Employees is not an array:",t),t=[]);const r=[{id:"formed",name:"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ",color:"#007bff",employees:t.map(o=>({...o,tickets:[]}))},{id:"review",name:"Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—",color:"#ffc107",employees:t.map(o=>({...o,tickets:[]}))},{id:"execution",name:"Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ",color:"#28a745",employees:t.map(o=>({...o,tickets:[]}))}];return e.forEach(o=>{const d=this.mapStageId(o.stageId||o.STAGE_ID||""),k=r.find(u=>u.id===d);if(k){const u=o.assignedById||o.ASSIGNED_BY_ID||null,i=u?parseInt(u):null;if(i){let p=k.employees.find(E=>E.id===i);p||(p={id:i,name:`Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº #${i}`,position:"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾",email:"",tickets:[]},k.employees.push(p)),p.tickets.push(this.mapTicket(o))}}}),r}static mapStageId(e){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[e]||"formed"}static mapStageIdToBitrix(e){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[e]||"DT140_12:UC_0VHWE2"}static mapTicket(e){const t=parseInt(e.id||e.ID||0),r=e.title||e.TITLE||"Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ",o=e.stageId||e.STAGE_ID||"",d=e.assignedById||e.ASSIGNED_BY_ID||null,k=e.createdTime||e.CREATED_DATE||e.CREATED_TIME||"",u=e.updatedTime||e.MODIFY_DATE||e.UPDATED_TIME||"",i=e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.ufCrm7UfPriority||e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.priority||e.PRIORITY||null,p=ce(i),E=be(p);return{id:t,title:r,priorityId:p.id,priorityLabel:p.label,priorityColors:E,priority:p.id,priorityBitrixValue:p.bitrixValue||null,status:this.mapStatus(o),assigneeId:d?parseInt(d):null,stageId:this.mapStageId(o),createdAt:k,modifiedAt:u,amount:e.opportunity||e.OPPORTUNITY||0,currency:e.currencyId||e.CURRENCY_ID||"RUB",description:e.comments||e.COMMENTS||""}}static mapPriority(e){return ce(e).id}static mapPriorityToBitrix(e){if(e&&typeof e=="object")return e.bitrixValue||null;const t=de(e);if(t&&t.bitrixValue)return t.bitrixValue;const r={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return r[e]?r[e]:de(Ie).bitrixValue}static mapStatus(e){return"in_progress"}static getZeroPointTickets(e){const t={formed:[],review:[],execution:[]};return Array.isArray(e)?(e.filter(r=>!(r.assignedById||r.ASSIGNED_BY_ID)).forEach(r=>{const o=this.mapStageId(r.stageId||r.STAGE_ID||"");t[o]&&t[o].push(this.mapTicket(r))}),t):(console.warn("Tickets is not an array in getZeroPointTickets:",e),t)}static async assignTicket(e,t,r){try{const o=this.mapStageIdToBitrix(r);return(await H.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:e,fields:{assignedById:t,stageId:o}})).result===!0}catch(o){throw console.error("Error assigning ticket:",o),o}}static async createTicket(e){try{const t=await H.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:e.title,assignedById:e.employeeId,stageId:this.mapStageIdToBitrix(e.stageId)}});return t.result?parseInt(t.result):0}catch(t){throw console.error("Error creating ticket:",t),t}}static async getTicket(e){try{const t=await H.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:e});return this.mapTicket(t.result)}catch(t){throw console.error("Error getting ticket:",t),t}}static async addComment(e,t){try{return(await H.call("crm.timeline.comment.add",{fields:{entityId:e,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:t}})).result!==void 0}catch(r){throw console.error("Error adding comment:",r),r}}}K(Q,"ENTITY_TYPE_ID",140),K(Q,"SECTOR_TAG","1C");const We="/api/graph-1c-admission-closure.php";function je(f){var t,r,o,d,k,u,i,p,E,U,S,w,m,b,v,a;if(!f)return{meta:null,data:{newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}};const e=f.data||f.result||f;return{meta:e.meta||f.meta||null,data:{newTickets:((t=e.data)==null?void 0:t.newTickets)??e.newTickets??0,closedTickets:((r=e.data)==null?void 0:r.closedTickets)??e.closedTickets??0,carryoverTickets:((o=e.data)==null?void 0:o.carryoverTickets)??e.carryoverTickets??0,series:{new:((k=(d=e.data)==null?void 0:d.series)==null?void 0:k.new)??((u=e.series)==null?void 0:u.new)??[0],closed:((p=(i=e.data)==null?void 0:i.series)==null?void 0:p.closed)??((E=e.series)==null?void 0:E.closed)??[0],carryover:((S=(U=e.data)==null?void 0:U.series)==null?void 0:S.carryover)??((w=e.series)==null?void 0:w.carryover)??[0]},stages:((m=e.data)==null?void 0:m.stages)??e.stages??[],responsible:((b=e.data)==null?void 0:b.responsible)??e.responsible??[],newTicketsByStages:((v=e.data)==null?void 0:v.newTicketsByStages)??e.newTicketsByStages??null,carryoverTicketsByDuration:((a=e.data)==null?void 0:a.carryoverTicketsByDuration)??e.carryoverTicketsByDuration??null}}}async function z(f={}){const{endpoint:e=We,product:t="1C",weekStartUtc:r=null,weekEndUtc:o=null,useCache:d=!0,forceRefresh:k=!1,includeTickets:u=!1,includeNewTicketsByStages:i=!1,includeCarryoverTickets:p=!0,includeCarryoverTicketsByDuration:E=!1}=f,S=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({product:t,weekStartUtc:r,weekEndUtc:o,useCache:d,forceRefresh:k,includeTickets:u,includeNewTicketsByStages:i,includeCarryoverTickets:p,includeCarryoverTicketsByDuration:E})});if(!S.ok)throw new Error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° (${S.status})`);const w=await S.json();if((w==null?void 0:w.success)===!1)throw new Error(w.message||"Ð‘ÑÐºÐµÐ½Ð´ Ð²ÐµÑ€Ð½ÑƒÐ» Ð¾ÑˆÐ¸Ð±ÐºÑƒ");return je(w)}const He={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},qe={class:"modal"},ze={key:"level-1",class:"level-1"},xe={class:"modal__header"},Je={class:"modal__body"},Ze={key:"loading",class:"loading-names"},Xe={key:"empty",class:"modal__empty"},Ke={key:"list",class:"responsible-list"},Qe=["onClick"],et={class:"responsible-list__name"},tt={class:"responsible-list__count"},st={key:0,class:"responsible-list__arrow"},at={class:"modal__footer"},lt={key:"level-2",class:"level-2"},ot={class:"modal__header"},rt={class:"modal__title"},nt={class:"modal__body"},it={key:"loading",class:"loading-state"},ct={key:"error",class:"error-state"},dt={class:"error-message"},ut={key:"empty",class:"empty-state"},yt={key:"tickets",class:"tickets-list-container"},mt={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(f){const e=f,t=h(1),r=h(null),o=h([]),d=h(!1),k=h(null),u=h([]),i=h(!1);async function p(v){const a=v.filter(l=>l.id!==null&&l.id!==void 0).map(l=>l.id);if(a.length===0)return v;try{const l=await Q.getEmployeesByIds(a),_=new Map;return l.forEach(n=>{_.set(n.id,n.name)}),v.map(n=>n.id&&_.has(n.id)?{...n,name:_.get(n.id)}:n)}catch(l){return console.error("[ResponsibleModal] Error enriching names:",l),v}}q(()=>e.responsible,async v=>{if(!v||v.length===0){u.value=[];return}i.value=!0;try{u.value=await p(v)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),u.value=v}finally{i.value=!1}},{immediate:!0});const E=B(()=>(u.value||[]).length>0);async function U(v,a=null){!v||!v.id||v.count===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),r.value=v,t.value=2,await S(v.id))}async function S(v){d.value=!0,k.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const l=(await z({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeTickets:!0})).data.responsible.find(n=>n.id===v),_=(l==null?void 0:l.tickets)||[];try{const{prepareTicketsForDisplay:n}=await te(async()=>{const{prepareTicketsForDisplay:C}=await import("./ticketListUtils-BfgHuqVX.js").then(D=>D.t);return{prepareTicketsForDisplay:C}},__vite__mapDeps([0,1,2,3,4,5]));o.value=await n(_,null,null)}catch(n){console.error("[ResponsibleModal] Error preparing tickets:",n),o.value=_}o.value.length===0&&(k.value=null)}catch(a){k.value=a.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets:",a),o.value=[]}finally{d.value=!1}}function w(){t.value=1,r.value=null,o.value=[],k.value=null}function m(v){const a=ae(v.id);window.open(a,"_blank")}function b(){r.value&&S(r.value.id)}return q(()=>e.isVisible,v=>{v||(t.value=1,r.value=null,o.value=[],k.value=null)}),(v,a)=>f.isVisible?(c(),y("div",He,[s("div",qe,[$(M,{name:"level",mode:"out-in"},{default:A(()=>{var l;return[t.value===1?(c(),y("div",ze,[s("header",xe,[a[3]||(a[3]=s("h3",{class:"modal__title"},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),s("button",{class:"modal__close",onClick:a[0]||(a[0]=_=>v.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Je,[$(M,{name:"loading",mode:"out-in"},{default:A(()=>[i.value?(c(),y("div",Ze,[...a[4]||(a[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð¼Ñ‘Ð½ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²...",-1)])])):E.value?(c(),y("ul",Ke,[(c(!0),y(L,null,Y(u.value,_=>(c(),y("li",{key:_.id||_.name,class:X(["responsible-list__item",{"responsible-list__item--clickable":_.id&&_.count>0}]),onClick:n=>U(_,n),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°"},[s("span",et,I(_.name||"ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½"),1),s("span",tt,I(_.count??0)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),_.id&&_.count>0?(c(),y("span",st,"â†’")):N("",!0)],10,Qe))),128))])):(c(),y("p",Xe,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¼"))]),_:1})]),s("footer",at,[s("button",{class:"btn",onClick:a[1]||(a[1]=_=>v.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):t.value===2?(c(),y("div",lt,[s("header",ot,[s("button",{class:"btn-back",onClick:w,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",rt,"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+I(((l=r.value)==null?void 0:l.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),s("button",{class:"modal__close",onClick:a[2]||(a[2]=_=>v.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",nt,[$(M,{name:"loading",mode:"out-in"},{default:A(()=>[d.value?(c(),y("div",it,[...a[5]||(a[5]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):k.value?(c(),y("div",ct,[a[6]||(a[6]=s("div",{class:"error-icon"},"âš ï¸",-1)),a[7]||(a[7]=s("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),s("p",dt,I(k.value),1),s("button",{class:"btn btn-retry",onClick:b},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):o.value.length===0?(c(),y("div",ut,[...a[8]||(a[8]=[s("div",{class:"empty-state-icon"},"ðŸ“‹",-1),s("p",{class:"empty-state-message"},"Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)])])):(c(),y("div",yt,[$(ee,{name:"ticket",tag:"div",class:"tickets-list"},{default:A(()=>[(c(!0),y(L,null,Y(o.value,(_,n)=>(c(),F(se,{key:_.id,ticket:_,draggable:!1,style:G({"--ticket-index":n}),onClick:m},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):N("",!0)]}),_:1})])])):N("",!0)}},_t=Z(mt,[["__scopeId","data-v-595c147a"]]),vt={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},pt={class:"modal"},gt={key:"level-1",class:"level-1"},kt={class:"modal__header"},ft={class:"modal__body"},ht={key:"loading",class:"loading-names"},Tt={key:"empty",class:"modal__empty"},wt={key:"list",class:"stages-list"},bt=["onClick"],It={class:"stages-list__name"},Ct={class:"stages-list__count"},Et={key:0,class:"stages-list__arrow"},St={class:"modal__footer"},Dt={key:"level-2",class:"level-2"},$t={class:"modal__header"},Ut={class:"modal__title"},At={class:"modal__body"},Bt={key:"loading",class:"loading-state"},Rt={key:"error",class:"error-state"},Nt={class:"error-message"},Pt={key:"empty",class:"empty-state"},Mt={class:"empty-state-message"},Ot={key:"tickets",class:"tickets-list-container"},Lt={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:e}){const t=f,r=h(1),o=h(null),d=h([]),k=h(!1),u=h(!1),i=h(null),p=h([]),E=B(()=>p.value.length>0&&p.value.some(a=>a.count>0));async function U(){if(!t.weekStartUtc||!t.weekEndUtc){p.value=[];return}u.value=!0,i.value=null;try{const a=await z({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0});p.value=a.data.newTicketsByStages||[]}catch(a){i.value=a.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÑ‚Ð°Ð´Ð¸Ð¹",console.error("[StagesModal] Error loading stages:",a),p.value=[]}finally{u.value=!1}}async function S(a,l=null){!a||a.count===0||(l&&l.currentTarget&&(l.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{l.currentTarget&&(l.currentTarget.style.transform="")},150)),o.value=a,r.value=2,await w(a.stageId))}async function w(a){var l;k.value=!0,i.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const n=(l=(await z({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:l.find(D=>D.stageId===a),C=(n==null?void 0:n.tickets)||[];try{const{prepareTicketsForDisplay:D}=await te(async()=>{const{prepareTicketsForDisplay:x}=await import("./ticketListUtils-BfgHuqVX.js").then(W=>W.t);return{prepareTicketsForDisplay:x}},__vite__mapDeps([0,1,2,3,4,5]));d.value=await D(C,null,null)}catch(D){console.error("[StagesModal] Error preparing tickets:",D),d.value=C}d.value.length===0&&(i.value=null)}catch(_){i.value=_.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[StagesModal] Error loading tickets:",_),d.value=[]}finally{k.value=!1}}function m(){r.value=1,o.value=null,d.value=[],i.value=null}function b(a){const l=ae(a.id);window.open(l,"_blank")}function v(){o.value&&w(o.value.stageId)}return q(()=>t.isVisible,a=>{a?U():(r.value=1,o.value=null,d.value=[],i.value=null,p.value=[])}),q([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&U()}),(a,l)=>f.isVisible?(c(),y("div",vt,[s("div",pt,[$(M,{name:"level",mode:"out-in"},{default:A(()=>{var _;return[r.value===1?(c(),y("div",gt,[s("header",kt,[l[3]||(l[3]=s("h3",{class:"modal__title"},"ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),s("button",{class:"modal__close",onClick:l[0]||(l[0]=n=>a.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",ft,[$(M,{name:"loading",mode:"out-in"},{default:A(()=>[u.value?(c(),y("div",ht,[...l[4]||(l[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÑ‚Ð°Ð´Ð¸Ð¹...",-1)])])):E.value?(c(),y("ul",wt,[(c(!0),y(L,null,Y(p.value,n=>(c(),y("li",{key:n.stageId,class:X(["stages-list__item",{"stages-list__item--clickable":n.count>0}]),style:G({"--stage-color":n.color}),onClick:C=>S(n,C),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÑ‚Ð°Ð´Ð¸Ð¸"},[s("span",{class:"stages-list__color",style:G({backgroundColor:n.color})},null,4),s("span",It,I(n.stageName),1),s("span",Ct,I(n.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),n.count>0?(c(),y("span",Et,"â†’")):N("",!0)],14,bt))),128))])):(c(),y("p",Tt," ÐÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),s("footer",St,[s("button",{class:"btn",onClick:l[1]||(l[1]=n=>a.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):r.value===2?(c(),y("div",Dt,[s("header",$t,[s("button",{class:"btn-back",onClick:m,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",Ut," Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÑ‚Ð°Ð´Ð¸Ð¸: "+I(((_=o.value)==null?void 0:_.stageName)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),s("button",{class:"modal__close",onClick:l[2]||(l[2]=n=>a.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",At,[$(M,{name:"loading",mode:"out-in"},{default:A(()=>{var n;return[k.value?(c(),y("div",Bt,[...l[5]||(l[5]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):i.value?(c(),y("div",Rt,[l[6]||(l[6]=s("div",{class:"error-icon"},"âš ï¸",-1)),l[7]||(l[7]=s("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),s("p",Nt,I(i.value),1),s("button",{class:"btn btn-retry",onClick:v},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):d.value.length===0?(c(),y("div",Pt,[l[8]||(l[8]=s("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),s("p",Mt," ÐÐ° ÑÑ‚Ð°Ð´Ð¸Ð¸ Â«"+I((n=o.value)==null?void 0:n.stageName)+"Â» Ð½ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ ",1)])):(c(),y("div",Ot,[$(ee,{name:"ticket",tag:"div",class:"tickets-list"},{default:A(()=>[(c(!0),y(L,null,Y(d.value,(C,D)=>(c(),F(se,{key:C.id,ticket:C,draggable:!1,style:G({"--ticket-index":D}),onClick:b},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):N("",!0)]}),_:1})])])):N("",!0)}},Yt=Z(Lt,[["__scopeId","data-v-d15a3c66"]]),Vt={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Ft={class:"modal"},Gt={key:"level-1",class:"level-1"},Wt={class:"modal__header"},jt={class:"modal__body"},Ht={key:"loading",class:"loading-names"},qt={key:"empty",class:"modal__empty"},zt={key:"list",class:"duration-list"},xt=["onClick"],Jt={class:"duration-list__name"},Zt={class:"duration-list__count"},Xt={key:0,class:"duration-list__arrow"},Kt={class:"modal__footer"},Qt={key:"level-2",class:"level-2"},es={class:"modal__header"},ts={class:"modal__title"},ss={class:"modal__body"},as={key:"loading",class:"loading-state"},ls={key:"error",class:"error-state"},os={class:"error-message"},rs={key:"empty",class:"empty-state"},ns={class:"empty-state-message"},is={key:"tickets",class:"tickets-list-container"},cs={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:e}){const t=f,r=h(1),o=h(null),d=h([]),k=h(!1),u=h(!1),i=h(null),p=h([]),E=B(()=>p.value.length>0&&p.value.some(a=>a.count>0));async function U(){if(!t.weekStartUtc||!t.weekEndUtc){p.value=[];return}u.value=!0,i.value=null;try{const a=await z({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});p.value=a.data.carryoverTicketsByDuration||[]}catch(a){i.value=a.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹",console.error("[CarryoverDurationModal] Error loading categories:",a),p.value=[]}finally{u.value=!1}}async function S(a,l=null){!a||a.count===0||(l&&l.currentTarget&&(l.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{l.currentTarget&&(l.currentTarget.style.transform="")},150)),o.value=a,r.value=2,await w(a.durationCategory))}async function w(a){var l;k.value=!0,i.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const n=(l=(await z({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})).data.carryoverTicketsByDuration)==null?void 0:l.find(D=>D.durationCategory===a),C=(n==null?void 0:n.tickets)||[];try{const{prepareTicketsForDisplay:D}=await te(async()=>{const{prepareTicketsForDisplay:x}=await import("./ticketListUtils-BfgHuqVX.js").then(W=>W.t);return{prepareTicketsForDisplay:x}},__vite__mapDeps([0,1,2,3,4,5]));d.value=await D(C,null,null)}catch(D){console.error("[CarryoverDurationModal] Error preparing tickets:",D),d.value=C}d.value.length===0&&(i.value=null)}catch(_){i.value=_.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[CarryoverDurationModal] Error loading tickets:",_),d.value=[]}finally{k.value=!1}}function m(){r.value=1,o.value=null,d.value=[],i.value=null}function b(a){const l=ae(a.id);window.open(l,"_blank")}function v(){o.value&&w(o.value.durationCategory)}return q(()=>t.isVisible,a=>{a?U():(r.value=1,o.value=null,d.value=[],i.value=null,p.value=[])}),q([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&U()}),(a,l)=>f.isVisible?(c(),y("div",Vt,[s("div",Ft,[$(M,{name:"level",mode:"out-in"},{default:A(()=>{var _;return[r.value===1?(c(),y("div",Gt,[s("header",Wt,[l[3]||(l[3]=s("h3",{class:"modal__title"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ€Ð¾ÐºÐ°Ð¼",-1)),s("button",{class:"modal__close",onClick:l[0]||(l[0]=n=>a.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",jt,[$(M,{name:"loading",mode:"out-in"},{default:A(()=>[u.value?(c(),y("div",Ht,[...l[4]||(l[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹...",-1)])])):E.value?(c(),y("ul",zt,[(c(!0),y(L,null,Y(p.value,n=>(c(),y("li",{key:n.durationCategory,class:X(["duration-list__item",{"duration-list__item--clickable":n.count>0}]),style:G({"--duration-color":n.color}),onClick:C=>S(n,C),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"},[s("span",{class:"duration-list__color",style:G({backgroundColor:n.color})},null,4),s("span",Jt,I(n.durationLabel),1),s("span",Zt,I(n.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),n.count>0?(c(),y("span",Xt,"â†’")):N("",!0)],14,xt))),128))])):(c(),y("p",qt," ÐÐµÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),s("footer",Kt,[s("button",{class:"btn",onClick:l[1]||(l[1]=n=>a.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):r.value===2?(c(),y("div",Qt,[s("header",es,[s("button",{class:"btn-back",onClick:m,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",ts," Ð¢Ð¸ÐºÐµÑ‚Ñ‹: "+I(((_=o.value)==null?void 0:_.durationLabel)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),s("button",{class:"modal__close",onClick:l[2]||(l[2]=n=>a.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",ss,[$(M,{name:"loading",mode:"out-in"},{default:A(()=>{var n;return[k.value?(c(),y("div",as,[...l[5]||(l[5]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):i.value?(c(),y("div",ls,[l[6]||(l[6]=s("div",{class:"error-icon"},"âš ï¸",-1)),l[7]||(l[7]=s("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),s("p",os,I(i.value),1),s("button",{class:"btn btn-retry",onClick:v},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):d.value.length===0?(c(),y("div",rs,[l[8]||(l[8]=s("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),s("p",ns," Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Â«"+I((n=o.value)==null?void 0:n.durationLabel)+"Â» Ð½ÐµÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1)])):(c(),y("div",is,[$(ee,{name:"ticket",tag:"div",class:"tickets-list"},{default:A(()=>[(c(!0),y(L,null,Y(d.value,(C,D)=>(c(),F(se,{key:C.id,ticket:C,draggable:!1,style:G({"--ticket-index":D}),onClick:b},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):N("",!0)]}),_:1})])])):N("",!0)}},ds=Z(cs,[["__scopeId","data-v-83a6f8c8"]]),us={class:"ac-dashboard"},ys={key:1},ms={class:"dashboard-header"},_s={class:"header-content"},vs={class:"breadcrumbs-row"},ps=["aria-label","aria-disabled","data-fallback","disabled"],gs={class:"breadcrumbs","aria-label":"ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ"},ks={class:"dashboard-layout"},fs={class:"filters-container"},hs={class:"chart-container"},Ts={__name:"GraphAdmissionClosureDashboard",setup(f){const e=ge(),t=h(!0),r=h(null),o=h(null),d=h({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),k=h(!1),u=h(!1),i=h(!1),p=h(!1),E=B(()=>typeof window>"u"?!1:window.history.length>1),U=B(()=>E.value?"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ":"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"),S={name:"dashboard-sector-1c"};function w(T){var g;if((g=T==null?void 0:T.preventDefault)==null||g.call(T),!p.value){p.value=!0;try{if(E.value){e.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),e.push(S)}finally{p.value=!1}}}const m=h({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),b=h(null),v=B(()=>{const T=m.value.customDateRange.startDate||m.value.customDateRange.endDate,g=m.value.employees.length===1&&m.value.employees.includes("all");return T||!g});async function a(){t.value=!0,r.value=null;try{let T,g;if(b.value)T=b.value.startUtc,g=b.value.endUtc;else{const O=ue();T=O.weekStartUtc,g=O.weekEndUtc}const{meta:R,data:j}=await z({product:"1C",weekStartUtc:T,weekEndUtc:g});o.value=R,d.value=j,!b.value&&R&&(b.value={weekNumber:R.weekNumber,startUtc:R.weekStartUtc,endUtc:R.weekEndUtc})}catch(T){r.value=T instanceof Error?T:new Error("ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸"),console.error("[GraphAdmissionClosureDashboard] loadData error:",T)}finally{t.value=!1}}function l(T){m.value.stages=T}function _(T){m.value.employees=T}function n(T){m.value.dateRange=T}function C(T){m.value.customDateRange=T}function D(T){b.value=T}function x(){m.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},W()}function W(){a()}ve(()=>{a()});function ue(){const T=new Date,g=new Date(Date.UTC(T.getUTCFullYear(),T.getUTCMonth(),T.getUTCDate())),R=g.getUTCDay(),j=g.getUTCDate()-R+(R===0?-6:1),O=new Date(Date.UTC(g.getUTCFullYear(),g.getUTCMonth(),j,0,0,0)),V=new Date(O);return V.setUTCDate(V.getUTCDate()+6),V.setUTCHours(23,59,59,999),{weekStartUtc:O.toISOString(),weekEndUtc:V.toISOString()}}return(T,g)=>{var j,O,V,le,oe,re;const R=ke("router-link");return c(),y("div",us,[t.value?(c(),F(fe,{key:0,message:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…..."})):(c(),y("div",ys,[s("div",ms,[s("div",_s,[s("div",vs,[s("button",{class:"btn-back-link",type:"button",onClick:w,"aria-label":U.value,"aria-disabled":!E.value,"data-fallback":!E.value,disabled:p.value,title:"ÐÐ°Ð·Ð°Ð´"}," â† ",8,ps),s("nav",gs,[$(R,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:A(()=>[...g[6]||(g[6]=[ne(" Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡ ",-1)])]),_:1}),g[8]||(g[8]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),$(R,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:A(()=>[...g[7]||(g[7]=[ne(" Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ",-1)])]),_:1}),g[9]||(g[9]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),g[10]||(g[10]=s("span",{class:"breadcrumb-current"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹",-1))])]),g[11]||(g[11]=s("h1",{class:"dashboard-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),g[12]||(g[12]=s("p",{class:"dashboard-subtitle"}," Ð”Ð¾ÑÑ‚ÑƒÐ¿Ñ‹ Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ñ‹ Â«Ð“Ñ€Ð°Ñ„Ð¸ÐºÑƒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑÂ», ÑÐµÐ»ÐµÐºÑ‚Ð¾Ñ€ ÑÑ‚Ð°Ð¿Ð¾Ð² ÑÐºÑ€Ñ‹Ñ‚. ",-1))])]),s("div",ks,[s("div",fs,[$(he,{stages:m.value.stages,employees:m.value.employees,dateRange:m.value.dateRange,customDateRange:m.value.customDateRange,hasActiveFilters:v.value,hideStages:!0,weekPickerMode:!0,selectedWeek:b.value,weeksCount:52,"onUpdate:stages":l,"onUpdate:employees":_,"onUpdate:dateRange":n,"onUpdate:customDateRange":C,"onUpdate:selectedWeek":D,onReset:x,onApply:W},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","selectedWeek"])]),s("div",hs,[r.value?(c(),F(pe,{key:0,type:"error",title:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",message:r.value.message},null,8,["message"])):(c(),F(Ge,{key:1,meta:o.value,data:d.value,onOpenResponsible:g[0]||(g[0]=J=>k.value=!0),onOpenStages:g[1]||(g[1]=J=>u.value=!0),onOpenCarryover:g[2]||(g[2]=J=>i.value=!0)},null,8,["meta","data"]))])])])),$(_t,{"is-visible":k.value,responsible:d.value.responsible||[],"week-start-utc":((j=o.value)==null?void 0:j.weekStartUtc)||null,"week-end-utc":((O=o.value)==null?void 0:O.weekEndUtc)||null,onClose:g[3]||(g[3]=J=>k.value=!1)},null,8,["is-visible","responsible","week-start-utc","week-end-utc"]),$(Yt,{"is-visible":u.value,"week-start-utc":((V=o.value)==null?void 0:V.weekStartUtc)||null,"week-end-utc":((le=o.value)==null?void 0:le.weekEndUtc)||null,onClose:g[4]||(g[4]=J=>u.value=!1)},null,8,["is-visible","week-start-utc","week-end-utc"]),$(ds,{"is-visible":i.value,"week-start-utc":((oe=o.value)==null?void 0:oe.weekStartUtc)||null,"week-end-utc":((re=o.value)==null?void 0:re.weekEndUtc)||null,onClose:g[5]||(g[5]=J=>i.value=!1)},null,8,["is-visible","week-start-utc","week-end-utc"])])}}},Ss=Z(Ts,[["__scopeId","data-v-3357c8ee"]]);export{Ss as default};
