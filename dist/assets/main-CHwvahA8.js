const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./direct-access-config-DyjRQU9Q.js","./chunk-DcqeLMgh.js","./chunk-CBCOylN3.js","./access-config-async-DTU6Qc6F.js","./chunk-J8T_k_VI.js","./chunk-VAsKgZ2K.js","./chunk-CxpfhxJR.js","./WebhookLogsDashboard.vue-D_lecgx-.js","./WebhookLogDetails.vue-BG8wKvsa.js","./DashboardSector1C.vue-BIq972iJ.js","./chunk-DvrmYH2U.js","./chunk-GzXj2FKY.js","./chunk-grR2_8NA.js","./chunk-DD6VC0Bt.js","./GraphAdmissionClosureDashboard.vue-D_MI1ooQ.js","./chunk-BVDuNF2H.js","./dashboard-sector-1c-service-IafdWM11.js","./GraphStateDashboard.vue-lsU1poJR.js","./TicketsTimeTrackingDashboard.vue-uHgbTri4.js"])))=>i.map(i=>d[i]);
var Kt=Object.defineProperty;var Yt=(n,e,s)=>e in n?Kt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var Me=(n,e,s)=>Yt(n,typeof e!="symbol"?e+"":e,s);import{r as X,c as d,o as c,a as G,b as x,d as Gt,t as m,n as B,e as a,f as oe,g as y,h as le,w as _e,i as Q,F as W,j as q,k as pe,l as C,u as Ke,m as ee,p as Qt,T as Ie,q as H,v as Ge,s as Ve,x as xe,y as we,z as Se,A as re,B as Be,C as Zt,D as xt,E as At,G as tt,H as Ue,I as dt,L as ut,P as Et,J as Mt,K as mt,M as gt,N as ft,O as It,Q as Lt,R as Pt,S as Ft,U as es,V as ts,W as ss,X as as,Y as os,Z as ns,_ as rs,$ as is}from"./chunk-J8T_k_VI.js";import{a as Ut,_ as ve,g as Te}from"./chunk-DcqeLMgh.js";import{C as Ct}from"./chunk-VAsKgZ2K.js";import{A as ls}from"./chunk-CxpfhxJR.js";import"./chunk-CBCOylN3.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();const K=(n,e)=>{const s=n.__vccOpts||n;for(const[t,r]of e)s[t]=r;return s},cs={name:"App"},ds={id:"app"};function us(n,e,s,t,r,i){const o=X("router-view");return c(),d("div",ds,[G(o)])}const ms=K(cs,[["render",us]]),gs={name:"StatusMessage",props:{type:{type:String,required:!0,validator:n=>["success","error","info","warning"].includes(n)},title:{type:String,default:null},message:{type:String,default:null}}},fs={key:0},hs={key:1};function vs(n,e,s,t,r,i){return c(),d("div",{class:B(["status-message",`status-message--${s.type}`])},[s.title?(c(),d("strong",fs,m(s.title),1)):x("",!0),s.message?(c(),d("p",hs,m(s.message),1)):x("",!0),Gt(n.$slots,"default",{},void 0)],2)}const Rt=K(gs,[["render",vs],["__scopeId","data-v-7f15d2d7"]]),ps={name:"LoadingSpinner",props:{message:{type:String,default:"–ó–∞–≥—Ä—É–∑–∫–∞..."}}},ys={class:"loading-spinner"},_s={key:0,class:"message"};function bs(n,e,s,t,r,i){return c(),d("div",ys,[e[0]||(e[0]=a("div",{class:"spinner"},null,-1)),s.message?(c(),d("p",_s,m(s.message),1)):x("",!0)])}const Nt=K(ps,[["render",bs],["__scopeId","data-v-375eac16"]]);function $e(){try{if(window.self===window.top)return!1;if(typeof BX24<"u")return!0;try{const n=window.parent.location.origin;return n.includes("bitrix24")||n.includes("kompo.by")}catch{return!1}}catch(n){return console.warn("Error checking Bitrix24 context:",n),!1}}function ws(){return typeof BX24<"u"}class Le{static init(e){return new Promise((s,t)=>{if(!$e()){console.log("Not inside Bitrix24, skipping BX24.init()"),e&&e(),s();return}if(typeof BX24>"u"){t(new Error("Bitrix24 API not loaded. Make sure script is included: //api.bitrix24.com/api/v1/"));return}const r=setTimeout(()=>{t(new Error("BX24.init() timeout: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥"))},5e3);try{BX24.init(()=>{clearTimeout(r),e&&e(),s()})}catch(i){clearTimeout(r),t(i)}})}static installFinish(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}try{BX24.installFinish(),e()}catch(t){s(t)}})}static callMethod(e,s={}){return new Promise((t,r)=>{if(typeof BX24>"u"){r(new Error("Bitrix24 API not loaded"));return}const i=setTimeout(()=>{r(new Error(`BX24.callMethod(${e}) timeout: –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—ã—Å–∏–ª 10 —Å–µ–∫—É–Ω–¥`))},1e4);try{BX24.callMethod(e,s,o=>{if(clearTimeout(i),o.error()){const l=o.error();r(new Error(l.error_description||l.error||"Unknown error"))}else t(o.data())})}catch(o){clearTimeout(i),r(o)}})}static async getCurrentUser(){if($e()&&ws())try{const e=await Promise.race([this.callMethod("user.current",{}),new Promise((s,t)=>setTimeout(()=>t(new Error("Timeout")),5e3))]);return console.log("Got user from BX24.callMethod() (interface user):",e?.ID||"unknown"),e}catch(e){console.warn("BX24.callMethod() failed, using proxy API as fallback:",e);try{const t=await new Ct().getCurrentUser();return console.log("Got user from proxy API (token owner, fallback):",t),t}catch(s){throw console.error("Both BX24 API and proxy API failed:",s),e.message&&e.message.includes("timeout")?new Error("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Bitrix24 API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç."):new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}else return console.warn("Not inside Bitrix24, using proxy API (will return token owner, not interface user)"),await new Ct().getCurrentUser()}static getUser(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}if(typeof BX24.getUser!="function"){s(new Error("BX24.getUser is not available"));return}BX24.getUser(t=>{e(t)})})}static getAuth(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}BX24.getAuth(t=>{e(t)})})}}const ks={name:"InstallPage",components:{StatusMessage:Rt,LoadingSpinner:Nt},setup(){const n=y(!0),e=y(null),s=y(null);return le(async()=>{try{let t=null;if(window.INSTALL_RESULT)t=window.INSTALL_RESULT;else{const r=Ut("/install.php"),i=await fetch(`${r}?get_result=1`);i.ok&&(t=await i.json())}if(!t)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏");if(s.value=t,t.rest_only===!1)if(t.install===!0){e.value={type:"success",title:"‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!",message:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24."};try{await Le.init(()=>{Le.installFinish()})}catch(r){console.error("Error finishing installation:",r)}}else e.value={type:"error",title:"‚úó –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."};else e.value={type:"info",title:"REST-only —Ä–µ–∂–∏–º",message:"–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ REST API, –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."}}catch(t){console.error("Error loading install result:",t),e.value={type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ."}}finally{n.value=!1}}),{loading:n,installStatus:e,installInfo:s}}},Cs={class:"install-page"},Ss={class:"container"},Ds={key:1,class:"info"};function Ts(n,e,s,t,r,i){const o=X("StatusMessage"),l=X("LoadingSpinner");return c(),d("div",Cs,[a("div",Ss,[e[1]||(e[1]=a("h1",null,"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1)),t.installStatus?(c(),oe(o,{key:0,type:t.installStatus.type,title:t.installStatus.title,message:t.installStatus.message},null,8,["type","title","message"])):x("",!0),t.installInfo?(c(),d("div",Ds,[e[0]||(e[0]=a("h3",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:",-1)),a("pre",null,m(JSON.stringify(t.installInfo,null,2)),1)])):x("",!0),t.loading?(c(),oe(l,{key:2,message:"–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."})):x("",!0)])])}const xs=K(ks,[["render",Ts],["__scopeId","data-v-d082ec9e"]]),je={allowedDepartmentIds:[369,366,7],adminDepartmentIds:[369]};function Ot(n){return!n||typeof n!="number"?!1:je.allowedDepartmentIds.includes(n)}function Bt(n){if(!n||!n.UF_DEPARTMENT)return!1;const e=Array.isArray(n.UF_DEPARTMENT)?n.UF_DEPARTMENT:[];return e.length===0?!1:e.some(s=>je.adminDepartmentIds.includes(s))}const De={USER_NOT_DETERMINED:"USER_NOT_DETERMINED",ACCESS_DENIED:"ACCESS_DENIED",API_ERROR:"API_ERROR"};class Ae{constructor(e,s=null,t=null,r=null){this.allowed=e,this.errorCode=s,this.errorMessage=t,this.user=r}}class Re{static async checkAccess(){try{const e=$e();if(console.log("AccessControlService.checkAccess - isInsideBitrix24:",e),console.log("AccessControlService.checkAccess - window.self === window.top:",window.self===window.top),console.log("AccessControlService.checkAccess - typeof BX24:",typeof BX24),e)console.log("AccessControlService.checkAccess - Inside Bitrix24, skipping direct access check");else{console.log("AccessControlService.checkAccess - Not inside Bitrix24, checking direct access config...");const{isDirectAccessAllowed:i,getDenyMessage:o}=await ve(async()=>{const{isDirectAccessAllowed:u,getDenyMessage:f}=await import("./direct-access-config-DyjRQU9Q.js");return{isDirectAccessAllowed:u,getDenyMessage:f}},__vite__mapDeps([0,1]),import.meta.url),l=await i();if(console.log("AccessControlService.checkAccess - allowDirectAccess:",l),!l){const u=await o();return console.warn("Direct access denied: Application opened directly in browser, but direct access is disabled in config"),console.warn("Deny message:",u),new Ae(!1,De.ACCESS_DENIED,u,null)}console.log("Direct access allowed: Using primary administrator token from settings.php")}if(e)try{await Promise.race([Le.init(),new Promise((i,o)=>setTimeout(()=>o(new Error("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥")),5e3))])}catch(i){console.warn("BX24.init() failed, will try proxy API:",i)}let s;try{s=await Promise.race([Le.getCurrentUser(),new Promise((i,o)=>setTimeout(()=>o(new Error("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø—Ä–µ–≤—ã—Å–∏–ª–æ 10 —Å–µ–∫—É–Ω–¥")),1e4))])}catch(i){console.warn("Bitrix24BxApi.getCurrentUser() failed, trying proxy API:",i);const{Bitrix24ApiProvider:o}=await ve(async()=>{const{Bitrix24ApiProvider:l}=await import("./chunk-CBCOylN3.js").then(u=>u.b);return{Bitrix24ApiProvider:l}},__vite__mapDeps([2,1]),import.meta.url);try{const l=await o.getInstance();s=await Promise.race([l.getCurrentUser(),new Promise((u,f)=>setTimeout(()=>f(new Error("–ü—Ä–æ–∫—Å–∏ API –ø—Ä–µ–≤—ã—Å–∏–ª–æ 5 —Å–µ–∫—É–Ω–¥")),5e3))]),console.log("Got user from proxy API:",s?.ID||"unknown")}catch(l){throw console.error("Both BX24 API and proxy API failed:",l),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}if(!s||!s.ID)return console.warn("AccessControlService.checkAccess - user not determined:",s),new Ae(!1,De.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.");console.log("AccessControlService.checkAccess - user determined:",{id:s.ID,name:s.NAME,departments:s.UF_DEPARTMENT});const t=s.UF_DEPARTMENT||[];if(console.log("AccessControlService.checkAccess - departmentIds:",t),!Array.isArray(t)||t.length===0){if(console.log("AccessControlService.checkAccess - user has no departments"),!e){const{isDirectAccessAllowed:i}=await ve(async()=>{const{isDirectAccessAllowed:l}=await import("./direct-access-config-DyjRQU9Q.js");return{isDirectAccessAllowed:l}},__vite__mapDeps([0,1]),import.meta.url);if(await i())return console.log("AccessControlService.checkAccess - Direct access allowed, granting access despite no departments"),new Ae(!0,null,null,s)}return console.warn("AccessControlService.checkAccess - Access denied: user has no departments"),new Ae(!1,De.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ—Ç–¥–µ–ª—É.")}const r=t.some(i=>Ot(i));return console.log("AccessControlService.checkAccess - hasAccess:",r),r?(console.log("AccessControlService.checkAccess - Access granted"),new Ae(!0,null,null,s)):(console.warn("AccessControlService.checkAccess - Access denied: no allowed departments"),new Ae(!1,De.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"))}catch(e){return console.error("AccessControlService.checkAccess error:",e),e.message&&(e.message.includes("CORS")||e.message.includes("blocked")||e.message.includes("ERR_FAILED")||e.message.includes("unknown address space"))&&$e()?(console.error("CORS error inside Bitrix24: Cannot determine interface user."),new Ae(!1,De.API_ERROR,"–û—à–∏–±–∫–∞ CORS: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")):e.message&&e.message.includes("not loaded")?new Ae(!1,De.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."):new Ae(!1,De.API_ERROR,"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}static async getCurrentUser(){try{return $e()&&await Le.init(),await Le.getCurrentUser()}catch(e){return console.error("AccessControlService.getCurrentUser error:",e),null}}}class Qe{static async logAppEntry(e,s=null){if(!e||!e.ID)return console.warn("[ActivityLoggingService] Invalid user object for app entry logging"),!1;const t={timestamp:new Date().toISOString(),type:"app_entry",user_id:e.ID,user_name:this.getUserName(e),user_email:e.EMAIL||null,ip:s||this.getClientIp(),user_agent:navigator.userAgent,session_id:this.getSessionId()};return await this.saveLog(t)}static async logPageVisit(e,s,t=null){if(!s||!s.ID)return console.warn("[ActivityLoggingService] Invalid user object for page visit logging"),!1;if(!e||!e.path)return console.warn("[ActivityLoggingService] Invalid route object for page visit logging"),!1;const r={timestamp:new Date().toISOString(),type:"page_visit",user_id:s.ID,user_name:this.getUserName(s),route_path:e.path,route_name:e.name||null,route_title:e.meta?.title||null,from_path:t?.path||null,from_name:t?.name||null,session_id:this.getSessionId()};return await this.saveLog(r)}static async saveLog(e){try{const s=Te("/api/user-activity-log.php"),t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)});if(!t.ok){const i=await t.text();return console.error("[ActivityLoggingService] Failed to save log:",{status:t.status,statusText:t.statusText,error:i}),!1}const r=await t.json();return r.success?!0:(console.error("[ActivityLoggingService] API returned error:",r.error),!1)}catch(s){return s.name==="AbortError"?console.warn("[ActivityLoggingService] Request timeout (activity logging skipped)"):console.error("[ActivityLoggingService] Error saving log:",s),!1}}static getSessionId(){const e="activity_session_id";if(sessionStorage.getItem(e))return sessionStorage.getItem(e);const s=this.generateSessionId();return sessionStorage.setItem(e,s),s}static generateSessionId(){const e=Date.now(),s=Math.random().toString(36).substring(2,11);return`${e}-${s}`}static getUserName(e){const s=e.NAME||"",t=e.LAST_NAME||"";return`${s} ${t}`.trim()||e.EMAIL||`User #${e.ID}`}static getClientIp(){return null}static isAppEntryLogged(){return sessionStorage.getItem("app_entry_logged")==="true"}static markAppEntryLogged(){sessionStorage.setItem("app_entry_logged","true")}}const As={reports:[{id:1,title:"–û—Ç—á—ë—Ç –ø–æ —Ç–∏–∫–µ—Ç–∞–º",icon:"üìä",route:"/reports/tickets",description:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º",active:!1},{id:2,title:"–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",icon:"üìà",route:"/reports/performance",description:"–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞",active:!1},{id:3,title:"–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º",icon:"üìâ",route:"/reports/deadlines",description:"–ê–Ω–∞–ª–∏–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á",active:!1},{id:4,title:"–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç",icon:"üìã",route:"/reports/summary",description:"–û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",active:!1},{id:5,title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",route:"/dashboard/sector-1c",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0},{id:6,title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",icon:"üìä",route:"/dashboard/graph-state",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–° –≤–æ –≤—Ä–µ–º–µ–Ω–∏",active:!0,category:"analytics",order:6},{id:7,title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–°",icon:"üìà",route:"/dashboard/graph-admission-closure",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0,category:"analytics",order:7},{id:8,title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"‚è±",route:"/dashboard/tickets-time-tracking",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",active:!0,category:"analytics",order:8}]};function Es(){return As.reports.filter(n=>n.active===!0)}const Ms={adminInterfaces:[{id:1,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"üë•",route:"/admin/users",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"},{id:2,title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã",icon:"‚öôÔ∏è",route:"/admin/settings",description:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:3,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",icon:"üìã",route:"/admin/webhook-logs",description:"–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤"},{id:4,title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",icon:"üìä",route:"/admin/usage-stats",description:"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:5,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",icon:"üóëÔ∏è",route:"/admin/cache",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –º–æ–¥—É–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"}]};function Is(){return[...Ms.adminInterfaces]}const Ls={name:"IndexPage",components:{StatusMessage:Rt,LoadingSpinner:Nt},beforeCreate(){console.log("[IndexPage] beforeCreate() called")},created(){console.log("[IndexPage] created() called")},beforeMount(){console.log("[IndexPage] beforeMount() called")},setup(){console.log("[IndexPage] setup() called");const n=Ke(),e=y(!0),s=y(null),t=y(!1),r=y(!1),i=y(""),o=y(null),l=y(null),u=y(!1);console.log("[IndexPage] Initial state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value});const f=y(Es()),p=y(!1),g=y(Is()),S=C(()=>o.value?Bt(o.value):!1),D=C(()=>{if(!o.value)return"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";const k=o.value.FIRST_NAME?o.value.FIRST_NAME.trim():"",_=o.value.LAST_NAME?o.value.LAST_NAME.trim():"",b=o.value.NAME?o.value.NAME.trim():"";return k&&_?`${k} ${_}`:b&&_&&b!==_?`${b} ${_}`:k&&b&&k!==b?`${k} ${b}`:b&&b.includes(" ")?b:k||_||b||`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${o.value.ID}`}),E=C(()=>s.value?s.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ":"–û—à–∏–±–∫–∞ API":null),T=C(()=>s.value?s.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É.":s.value:null),I=C(()=>s.value&&s.value.includes("no_install_app")),h=C(()=>Ut("/install.php"));le(async()=>{console.log("[IndexPage] onMounted() called");try{console.log("[IndexPage] Calling AccessControlService.checkAccess()...");const k=await Re.checkAccess();if(console.log("[IndexPage] Access result:",{allowed:k.allowed,hasUser:!!k.user,user:k.user,errorCode:k.errorCode,errorMessage:k.errorMessage}),k.allowed){if(console.log("[IndexPage] Setting accessAllowed to true"),t.value=!0,o.value=k.user,console.log("[IndexPage] Access allowed, setting state:",{accessAllowed:t.value,hasUser:!!o.value,loading:e.value,accessDenied:r.value}),!Qe.isAppEntryLogged())try{k.user&&await Qe.logAppEntry(k.user)&&Qe.markAppEntryLogged()}catch(_){console.error("[IndexPage] Error logging app entry:",_)}}else{r.value=!0;const _=$e(),b=!_&&k.errorCode===De.ACCESS_DENIED&&k.errorMessage&&k.errorMessage.includes("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø");if(console.log("IndexPage - accessResult:",{errorCode:k.errorCode,errorMessage:k.errorMessage,isInsideB24:_,isDirectAccessDeniedCheck:b}),u.value=b,b&&(i.value=k.errorMessage,console.log("IndexPage - Set direct access denied message:",k.errorMessage)),console.log("IndexPage - State after check:",{accessDenied:r.value,isDirectAccessDenied:u.value,accessErrorMessage:i.value}),!b){if(k.user){const{getAllowedDepartmentIds:P}=await ve(async()=>{const{getAllowedDepartmentIds:z}=await import("./access-config-async-DTU6Qc6F.js");return{getAllowedDepartmentIds:z}},__vite__mapDeps([3,4,1,5,6,2]),import.meta.url);l.value={userId:k.user.ID,departmentIds:k.user.UF_DEPARTMENT||[],allowedIds:P()}}k.errorCode===De.USER_NOT_DETERMINED?i.value="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.":k.errorCode===De.ACCESS_DENIED?i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω":i.value=k.errorMessage||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."}}}catch(k){s.value=k.message,console.error("Error checking access:",k)}finally{e.value=!1,console.log("[IndexPage] Final state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value,hasUser:!!o.value,error:s.value})}});const v=k=>{if(!k){console.error("Route is not defined for report");return}n.push(k)},w=()=>{p.value=!0},U=()=>{p.value=!1};return{loading:e,error:s,accessAllowed:t,accessDenied:r,accessErrorMessage:i,currentUser:o,userName:D,debugInfo:l,isDirectAccessDenied:u,errorTitle:E,errorMessage:T,showInstallLink:I,installPageUrl:h,reportsButtons:f,navigateToReport:v,isAdmin:S,showAdminPopup:p,adminButtons:g,openAdminPopup:w,closeAdminPopup:U,navigateToAdmin:k=>{if(!k){console.error("Route is not defined for admin interface");return}n.push(k),U()}}}},Ps={class:"index-page"},Fs={class:"container"},Us={key:0,class:"install-link"},Rs=["href"],Ns={key:0,class:"direct-access-denied-info",style:{"margin-top":"15px",padding:"15px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px"}},Os={key:1,class:"debug-info",style:{"margin-top":"15px",padding:"10px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px","font-size":"12px"}},Bs={key:3,class:"main-content"},Vs={class:"greeting-section"},js={class:"greeting-header"},zs={class:"greeting-header-content"},$s={class:"greeting-text"},Ws={class:"reports-section"},qs={class:"reports-grid"},Hs=["onClick"],Xs={class:"report-icon"},Js={class:"report-title"},Ks={key:0,class:"report-description"},Ys={class:"admin-popup-header"},Gs={class:"admin-popup-content"},Qs={class:"admin-buttons-grid"},Zs=["onClick"],ea={class:"admin-icon"},ta={class:"admin-title"},sa={key:0,class:"admin-description"};function aa(n,e,s,t,r,i){const o=X("StatusMessage"),l=X("LoadingSpinner");return c(),d("div",Ps,[a("div",Fs,[t.error?(c(),oe(o,{key:0,type:"error",title:t.errorTitle,message:t.errorMessage},{default:_e(()=>[t.showInstallLink?(c(),d("div",Us,[a("a",{href:t.installPageUrl},"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",8,Rs)])):x("",!0)]),_:1},8,["title","message"])):x("",!0),t.loading?(c(),oe(l,{key:1,message:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞..."})):x("",!0),!t.loading&&t.accessDenied?(c(),oe(o,{key:2,type:"error",title:"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",message:t.accessErrorMessage},{default:_e(()=>[t.isDirectAccessDenied?(c(),d("div",Ns,[...e[4]||(e[4]=[a("p",{style:{margin:"0 0 10px 0","font-weight":"600",color:"#856404"}},[a("strong",null,"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")],-1),a("ol",{style:{margin:"0","padding-left":"20px",color:"#856404"}},[a("li",null,"–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24"),a("li",null,"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Bitrix24 (placement, –≤–∏–¥–∂–µ—Ç –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É)")],-1)])])):t.debugInfo?(c(),d("div",Os,[e[5]||(e[5]=a("strong",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e[6]||(e[6]=a("br",null,null,-1)),Q(" ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+m(t.debugInfo.userId),1),e[7]||(e[7]=a("br",null,null,-1)),Q(" ID –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+m(t.debugInfo.departmentIds),1),e[8]||(e[8]=a("br",null,null,-1)),Q(" –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ID –æ—Ç–¥–µ–ª–æ–≤: "+m(t.debugInfo.allowedIds),1),e[9]||(e[9]=a("br",null,null,-1)),e[10]||(e[10]=a("small",{style:{color:"#856404"}},"–î–æ–±–∞–≤—å—Ç–µ ID –æ—Ç–¥–µ–ª–∞ –≤ —Ñ–∞–π–ª vue-app/src/config/access-config.js",-1))])):x("",!0)]),_:1},8,["message"])):x("",!0),!t.loading&&!t.accessDenied&&t.accessAllowed?(c(),d("div",Bs,[a("div",Vs,[a("div",js,[a("div",zs,[e[13]||(e[13]=a("h2",{class:"greeting-title"},"–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ò–¢ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –ü–ª–∞–Ω–µ—Ä–∫–∏ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ü–∏–∏",-1)),a("p",$s,[e[11]||(e[11]=Q(" –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",-1)),a("strong",null,m(t.userName),1),e[12]||(e[12]=Q("! ",-1))])]),t.isAdmin?(c(),d("button",{key:0,class:"admin-button-header",onClick:e[0]||(e[0]=(...u)=>t.openAdminPopup&&t.openAdminPopup(...u)),title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"}," ‚öôÔ∏è ")):x("",!0)])]),a("div",Ws,[a("div",qs,[(c(!0),d(W,null,q(t.reportsButtons,u=>(c(),d("div",{key:u.id,class:"report-button",onClick:f=>t.navigateToReport(u.route)},[a("div",Xs,m(u.icon),1),a("div",Js,m(u.title),1),u.description?(c(),d("div",Ks,m(u.description),1)):x("",!0)],8,Hs))),128))])]),t.showAdminPopup&&t.isAdmin?(c(),d("div",{key:0,class:"admin-popup-overlay",onClick:e[3]||(e[3]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))},[a("div",{class:"admin-popup",onClick:e[2]||(e[2]=pe(()=>{},["stop"]))},[a("div",Ys,[e[14]||(e[14]=a("h3",{class:"admin-popup-title"},"‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",-1)),a("button",{class:"admin-popup-close",onClick:e[1]||(e[1]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))}," ‚úï ")]),a("div",Gs,[a("div",Qs,[(c(!0),d(W,null,q(t.adminButtons,u=>(c(),d("div",{key:u.id,class:"admin-interface-button",onClick:f=>t.navigateToAdmin(u.route)},[a("div",ea,m(u.icon),1),a("div",ta,m(u.title),1),u.description?(c(),d("div",sa,m(u.description),1)):x("",!0)],8,Zs))),128))])])])])):x("",!0)])):x("",!0)])])}const oa=K(Ls,[["render",aa],["__scopeId","data-v-6cc28966"]]),ye=y(new Map),ke=y({hits:0,misses:0,sets:0,invalidations:0}),rt={defaultTTL:5*60*1e3,maxSize:100,enableStats:!0};function na(n={}){const{ttl:e=rt.defaultTTL,maxSize:s=rt.maxSize,enableStats:t=rt.enableStats}=n,r=I=>{const h=new WeakSet;return JSON.stringify(I,(v,w)=>{if(typeof w=="object"&&w!==null){if(h.has(w))return"[Circular]";h.add(w)}return typeof w=="function"||w===void 0?null:w})},i=(I,h={})=>{const v=Object.keys(h).sort().reduce((w,U)=>{const R=h[U];if(R==null)w[U]=null;else if(typeof R=="object")try{w[U]=r(R)}catch{w[U]=String(R)}else w[U]=R;return w},{});try{return`${I}_${r(v)}`}catch{const U=Object.keys(v).sort().map(R=>`${R}=${v[R]}`).join("&");return`${I}_${U}`}},o=I=>{const h=ye.value.get(I);return h?Date.now()-h.timestamp>h.ttl?(ye.value.delete(I),t&&ke.value.misses++,null):(h.lastAccessed=Date.now(),t&&ke.value.hits++,h.data):(t&&ke.value.misses++,null)},l=(I,h,v=null)=>{ye.value.size>=s&&u(),ye.value.set(I,{data:h,timestamp:Date.now(),lastAccessed:Date.now(),ttl:v||e}),t&&ke.value.sets++},u=()=>{let I=null,h=1/0;for(const[v,w]of ye.value.entries())w.lastAccessed<h&&(h=w.lastAccessed,I=v);I&&ye.value.delete(I)},f=()=>{ye.value.clear(),t&&(ke.value={hits:0,misses:0,sets:0,invalidations:0})},p=I=>{const h=typeof I=="string"?new RegExp(I):I;let v=0;for(const w of ye.value.keys())h.test(w)&&(ye.value.delete(w),v++);return t&&(ke.value.invalidations+=v),v},g=()=>{const I=Date.now();let h=0;for(const[v,w]of ye.value.entries())I-w.timestamp>w.ttl&&(ye.value.delete(v),h++);return h},S=()=>{const I=ke.value.hits+ke.value.misses,h=I>0?(ke.value.hits/I*100).toFixed(2):0;return{...ke.value,size:ye.value.size,hitRate:`${h}%`}};let D=null;const E=(I=5*60*1e3)=>{D&&clearInterval(D),D=setInterval(()=>{g()},I)},T=()=>{D&&(clearInterval(D),D=null)};return E(),{get:o,set:l,clear:f,invalidate:p,cleanup:g,getCacheKey:i,getStats:S,startAutoCleanup:E,stopAutoCleanup:T}}function Ee(n){if(!n||typeof n!="object"||!n.timestamp||typeof n.timestamp!="string"||!n.event||typeof n.event!="string"||!n.category||typeof n.category!="string"||!["tasks","smart-processes","errors"].includes(n.category))return!1;try{new Date(n.timestamp)}catch{return!1}return!0}function ra(n){if(!n||typeof n!="object")return!1;for(const[e,s]of Object.entries(n))if(typeof s=="function")return!1;return!0}function qe(n){if(!Ee(n))return null;const e={timestamp:n.timestamp,event:n.event,category:n.category};return n.ip&&typeof n.ip=="string"&&(e.ip=n.ip),n.payload&&typeof n.payload=="object"&&(e.payload=n.payload),n.details&&ra(n.details)&&(e.details=n.details),e}function ht(n){return Array.isArray(n)?n.map(e=>qe(e)).filter(e=>e!==null):[]}const{get:ia,set:la,getCacheKey:ca,invalidate:St}=na({ttl:2*60*1e3,maxSize:50});class Dt{static getBaseUrl(){return Te("/api/webhook-logs.php")}static get BASE_URL(){return this.getBaseUrl()}static async getLogs(e={},s=1,t=50,r=!1){if(s<1)throw new Error("Page must be greater than 0");if(t<1||t>1e3)throw new Error("Limit must be between 1 and 1000");const i={category:e.category||null,event:e.event||null,date:e.date||null,hour:e.hour!==void 0?e.hour:null,dateFrom:e.dateFrom||null,dateTo:e.dateTo||null,ip:e.ip||null,status:e.status||null},o=this.getBaseUrl(),l=ca(o,{filters:i,page:s,limit:t});if(!r){const f=ia(l);if(f)return console.log("[WebhookLogsApiService] Cache hit:",l.substring(0,50)+"..."),f}console.log("[WebhookLogsApiService] Cache miss:",l.substring(0,50)+"...");const u=new URLSearchParams({page:s.toString(),limit:t.toString()});i.category&&u.append("category",i.category),i.event&&u.append("event",i.event),i.date&&u.append("date",i.date),i.hour!==null&&u.append("hour",i.hour.toString()),i.dateFrom&&u.append("dateFrom",i.dateFrom),i.dateTo&&u.append("dateTo",i.dateTo),i.ip&&u.append("ip",i.ip),i.status&&u.append("status",i.status);try{const f=this.getBaseUrl(),p=await fetch(`${f}?${u.toString()}`);if(!p.ok){const E=await p.text();let T;try{T=JSON.parse(E)}catch{T={error:E}}throw new Error(T.error_description||T.error||`HTTP error! status: ${p.status}`)}const g=await p.json();if(console.log("[WebhookLogsApiService] API response:",{success:g.success,logsCount:g.logs?.length||0,pagination:g.pagination,hasError:!!g.error}),g.error)throw new Error(g.error_description||g.error);if(!g.success)throw console.warn("[WebhookLogsApiService] API returned success=false:",g),new Error("API request failed");if(!Array.isArray(g.logs))throw console.error("[WebhookLogsApiService] Invalid logs format:",g.logs),new Error("Invalid logs format: expected array");const S=ht(g.logs);(!g.pagination||typeof g.pagination!="object")&&(console.warn("[WebhookLogsApiService] Invalid pagination format:",g.pagination),g.pagination={page:s,limit:t,total:S.length,pages:Math.ceil(S.length/t)});const D={success:!0,logs:S,pagination:{page:g.pagination.page||s,limit:g.pagination.limit||t,total:g.pagination.total||S.length,pages:g.pagination.pages||Math.ceil((g.pagination.total||S.length)/t)}};return la(l,D),D}catch(f){throw console.error("[WebhookLogsApiService] Error:",f),f}}static invalidateCacheOnFilterChange(e={},s={}){const t=St(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Invalidated ${t} entries on filter change`)}static clearCache(){const e=St(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Cleared ${e} entries`)}static async getLogDetails(e,s=null){const t={};return s&&(t.date=s),(await this.getLogs(t,1,1e3)).logs.find(o=>`${o.timestamp}_${o.event}`===e)||null}static async getErrors(e={},s=1,t=50){return this.getLogs({...e,category:"errors"},s,t)}static async getStats(e={}){const s=await this.getLogs(e,1,1e3),t={total:s.pagination.total||s.logs.length,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}};return s.logs.forEach(r=>{r.category==="tasks"?t.tasks++:r.category==="smart-processes"?t.smartProcesses++:r.category==="errors"&&t.errors++,t.byEvent[r.event]||(t.byEvent[r.event]=0),t.byEvent[r.event]++;const i=r.timestamp.split("T")[0];t.byDate[i]||(t.byDate[i]=0),t.byDate[i]++}),t}}function da(){const n=Qt(),e=Ke(),s=new Date().toISOString().split("T")[0],t=y({category:null,event:null,dateFrom:s,dateTo:null,hour:null,ip:null,search:null,status:null}),r=()=>{const f=n.query;t.value={category:f.category||null,event:f.event||null,dateFrom:f.dateFrom||f.date||s,dateTo:f.dateTo||null,hour:f.hour?parseInt(f.hour):null,ip:f.ip||null,search:f.search||null,status:f.status||null}},i=f=>{if(u)return;const p={...n.query};Object.keys(f).forEach(S=>{const D=f[S];D!==null&&D!==""&&D!==void 0?p[S]=D.toString():delete p[S]}),JSON.stringify(p)!==JSON.stringify(n.query)&&(u=!0,e.replace({path:n.path,query:p}).finally(()=>{setTimeout(()=>{u=!1},100)}))},o=f=>{const p={...t.value,...f};JSON.stringify(t.value)!==JSON.stringify(p)&&(t.value=p,i(t.value))},l=()=>{t.value={category:null,event:null,dateFrom:s,dateTo:null,hour:null,ip:null,search:null,status:null},i(t.value)};le(()=>{r()});let u=!1;return ee(()=>n.query,(f,p)=>{if(u)return;JSON.stringify(f)!==JSON.stringify(p)&&r()},{deep:!0}),{filters:t,updateFilters:o,clearFilters:l,loadFiltersFromUrl:r}}function ua(n,e,s={}){if(!e||!e.trim())return n;const{caseSensitive:t=!1,searchInEvent:r=!0,searchInPayload:i=!0,searchInDetails:o=!0,searchInIp:l=!0,searchInTimestamp:u=!1}=s,f=t?e.trim():e.trim().toLowerCase();return n.filter(p=>{if(r&&p.event&&(t?p.event:p.event.toLowerCase()).includes(f))return!0;if(i&&p.payload)try{const g=JSON.stringify(p.payload);if((t?g:g.toLowerCase()).includes(f))return!0}catch(g){console.warn("Error searching in payload:",g)}if(o&&p.details)try{const g=JSON.stringify(p.details);if((t?g:g.toLowerCase()).includes(f))return!0}catch(g){console.warn("Error searching in details:",g)}return!!(l&&p.ip&&(t?p.ip:p.ip.toLowerCase()).includes(f)||u&&p.timestamp&&(t?p.timestamp:p.timestamp.toLowerCase()).includes(f))})}function ct(n){if(!n||typeof n!="object"||n.category!==void 0&&n.category!==null&&!["tasks","smart-processes","errors"].includes(n.category)||n.date!==void 0&&n.date!==null&&!/^\d{4}-\d{2}-\d{2}$/.test(n.date))return!1;if(n.hour!==void 0&&n.hour!==null){const e=parseInt(n.hour,10);if(isNaN(e)||e<0||e>23)return!1}return!(n.ip!==void 0&&n.ip!==null&&(typeof n.ip!="string"||n.ip.length===0))}function ma(n){if(!n||typeof n!="object")return!1;const e=parseInt(n.page,10),s=parseInt(n.limit,10),t=parseInt(n.total,10),r=parseInt(n.pages,10);return!(isNaN(e)||e<1||isNaN(s)||s<1||s>1e3||isNaN(t)||t<0||isNaN(r)||r<0)}function Tt(n){if(n==null)return"";const e=String(n),s=e.replace(/"/g,'""');return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${s}"`:s}function ga(n){return n==null?"":typeof n=="object"?JSON.stringify(n):String(n)}function fa(n,e="webhook-logs.csv",s={}){return new Promise((t,r)=>{try{if(!Array.isArray(n)||n.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{columns:i=null,onProgress:o=null}=s,l=i||Object.keys(n[0]),f=[l.map(E=>Tt(E)).join(",")],p=n.length,g=1e3;for(let E=0;E<p;E+=g){const T=n.slice(E,E+g);if(T.forEach(I=>{const h=l.map(v=>{const w=I[v];return Tt(ga(w))});f.push(h.join(","))}),o){const I=Math.min(100,Math.round((E+T.length)/p*100));o(I)}}const S="\uFEFF"+f.join(`
`),D=new Blob([S],{type:"text/csv;charset=utf-8;"});Vt(D,e),o&&o(100),t()}catch(i){r(i)}})}function ha(n,e="webhook-logs.json",s={}){return new Promise((t,r)=>{try{if(!Array.isArray(n)||n.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{pretty:i=!0,onProgress:o=null}=s,l=i?JSON.stringify(n,null,2):JSON.stringify(n);o&&o(50);const u=new Blob([l],{type:"application/json;charset=utf-8;"});Vt(u,e),o&&o(100),t()}catch(i){r(i)}})}function Vt(n,e){const s=URL.createObjectURL(n),t=document.createElement("a");t.href=s,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(s)},100)}function va(n,e={},s=0){const t=new Date().toISOString().split("T")[0],r=new Date().toTimeString().split(" ")[0].replace(/:/g,"-");let i=`webhook-logs_${t}_${r}`;const o=[];return e.category&&o.push(`cat-${e.category}`),e.event&&o.push(`evt-${e.event.substring(0,10)}`),e.dateFrom&&o.push(`from-${e.dateFrom}`),e.dateTo&&o.push(`to-${e.dateTo}`),o.length>0&&(i+=`_${o.join("-")}`),s>0&&(i+=`_${s}records`),`${i}.${n}`}function pa(n){const e=[];if(!Array.isArray(n))return e.push("–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),{valid:!1,errors:e,estimatedSize:0};if(n.length===0)return e.push("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"),{valid:!1,errors:e,estimatedSize:0};const s=JSON.stringify(n).length,t=50*1024*1024;return s>t&&e.push(`–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö (${Math.round(s/1024/1024)} MB). –≠–∫—Å–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è.`),{valid:e.length===0,errors:e,estimatedSize:s}}function vt(n,e="short"){if(!n)return"‚Äî";try{const s=new Date(n);if(isNaN(s.getTime()))return"Invalid date";switch(e){case"short":return s.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});case"long":return s.toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});case"relative":return ya(s);default:return s.toLocaleString("ru-RU")}}catch{return"Invalid date"}}function ya(n){const s=new Date-n,t=Math.floor(s/1e3),r=Math.floor(t/60),i=Math.floor(r/60),o=Math.floor(i/24);return t<60?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":r<60?`${r} ${it(r,"–º–∏–Ω—É—Ç—É","–º–∏–Ω—É—Ç—ã","–º–∏–Ω—É—Ç")} –Ω–∞–∑–∞–¥`:i<24?`${i} ${it(i,"—á–∞—Å","—á–∞—Å–∞","—á–∞—Å–æ–≤")} –Ω–∞–∑–∞–¥`:o<7?`${o} ${it(o,"–¥–µ–Ω—å","–¥–Ω—è","–¥–Ω–µ–π")} –Ω–∞–∑–∞–¥`:vt(n.toISOString(),"short")}function it(n,e,s,t){const r=n%10,i=n%100;return r===1&&i!==11?e:r>=2&&r<=4&&(i<10||i>=20)?s:t}function He(n){return n?n.replace(/^ON/,"").split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):"‚Äî"}function Pe(n){return{tasks:"–ó–∞–¥–∞—á–∏","smart-processes":"–°–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å—ã",errors:"–û—à–∏–±–∫–∏"}[n]||n}function pt(n){if(!n||typeof n!="object")return"‚Äî";const e=[];if(n.task_id&&e.push(`–ó–∞–¥–∞—á–∞ #${n.task_id}`),n.entity_id&&e.push(`–°—É—â–Ω–æ—Å—Ç—å #${n.entity_id}`),n.task_title&&e.push(`"${n.task_title}"`),n.title&&e.push(`"${n.title}"`),n.comment_text){const s=n.comment_text.length>50?n.comment_text.substring(0,50)+"...":n.comment_text;e.push(`–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${s}`)}return e.length>0?e.join(" ‚Ä¢ "):"‚Äî"}const _a={name:"WebhookLogsExport",props:{logs:{type:Array,default:()=>[]},selectedLogs:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},totalCount:{type:Number,default:0}},emits:["export-start","export-complete","export-error"],setup(n,{emit:e}){const s=y(!1),t=y("csv"),r=y("all"),i=y(!0),o=y(!1),l=y(0),u=y([]),f=y(null),p=C(()=>n.selectedLogs.length),g=C(()=>n.logs.length>0||n.totalCount>0),S=C(()=>n.filters.category||n.filters.event||n.filters.dateFrom||n.filters.dateTo),D=C(()=>r.value==="selected"?p.value:n.logs.length||n.totalCount),E=C(()=>r.value==="selected"?p.value>0:g.value),T=()=>{l.value=0,u.value=[],f.value=null,p.value>0?r.value="selected":r.value="all",s.value=!0,h()},I=()=>{o.value||(s.value=!1)},h=()=>{const R=v(),k=pa(R);u.value=k.errors,f.value=k.estimatedSize},v=()=>(r.value==="selected"?n.selectedLogs:n.logs).map(_=>qe(_)).filter(_=>Ee(_)?!0:(console.warn("[WebhookLogsExport] Skipping invalid log:",_),!1)),w=async()=>{try{o.value=!0,l.value=0;let R=v();if(R.length===0)throw new Error("–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const k=R.map(P=>({timestamp:P.timestamp,event:P.event,category:P.category,ip:P.ip||null,details:P.details||null,payload:P.payload||null,formatted:{timestamp:vt(P.timestamp),event:He(P.event),category:Pe(P.category),details:pt(P.details)}}));e("export-start",{format:t.value,scope:r.value,count:k.length});const _=va(t.value,n.filters,k.length),b=P=>{l.value=P};t.value==="csv"?await fa(k,_,{onProgress:b}):await ha(k,_,{pretty:i.value,onProgress:b}),e("export-complete",{format:t.value,filename:_,count:k.length}),setTimeout(()=>{o.value=!1,s.value=!1,l.value=0},500)}catch(R){console.error("[WebhookLogsExport] Export error:",R),e("export-error",R),o.value=!1,l.value=0,alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${R.message}`)}},U=R=>R<1024?`${R} B`:R<1024*1024?`${(R/1024).toFixed(2)} KB`:`${(R/1024/1024).toFixed(2)} MB`;return ee([r,()=>n.logs,()=>n.selectedLogs],()=>{s.value&&h()}),{showExportModal:s,exportFormat:t,exportScope:r,jsonPretty:i,exporting:o,exportProgress:l,exportWarnings:u,estimatedSize:f,selectedCount:p,hasAllLogs:g,hasFilters:S,exportCount:D,canExport:E,openExportModal:T,closeExportModal:I,handleExport:w,formatSize:U}}},ba={class:"webhook-logs-export"},wa=["disabled","title"],ka={key:0,class:"selected-badge"},Ca={class:"export-modal-header"},Sa={class:"export-modal-body"},Da={class:"export-section"},Ta={class:"radio-group"},xa={class:"export-section"},Aa={class:"radio-group"},Ea=["disabled"],Ma={class:"radio-label"},Ia={key:0},La={key:1},Pa=["disabled"],Fa={class:"radio-label"},Ua={key:0,class:"export-section"},Ra={class:"checkbox-option"},Na={class:"export-info"},Oa={class:"info-item"},Ba={class:"info-value"},Va={key:0,class:"info-item"},ja={class:"info-value"},za={key:1,class:"export-warnings"},$a={key:0,class:"export-progress"},Wa={class:"progress-bar"},qa={class:"progress-text"},Ha={class:"export-modal-footer"},Xa=["disabled"],Ja={key:0},Ka={key:1},Ya=["disabled"];function Ga(n,e,s,t,r,i){return c(),d("div",ba,[a("button",{onClick:e[0]||(e[0]=(...o)=>t.openExportModal&&t.openExportModal(...o)),class:"btn-export",disabled:!t.canExport,title:t.canExport?"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"},[e[11]||(e[11]=a("span",{class:"btn-icon"},"üì•",-1)),e[12]||(e[12]=a("span",{class:"btn-text"},"–≠–∫—Å–ø–æ—Ä—Ç",-1)),t.selectedCount>0?(c(),d("span",ka,m(t.selectedCount),1)):x("",!0)],8,wa),G(Ie,{name:"modal"},{default:_e(()=>[t.showExportModal?(c(),d("div",{key:0,class:"export-modal-overlay",onClick:e[10]||(e[10]=(...o)=>t.closeExportModal&&t.closeExportModal(...o))},[a("div",{class:"export-modal",onClick:e[9]||(e[9]=pe(()=>{},["stop"]))},[a("div",Ca,[e[13]||(e[13]=a("h3",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",-1)),a("button",{onClick:e[1]||(e[1]=(...o)=>t.closeExportModal&&t.closeExportModal(...o)),class:"btn-close"},"‚úï")]),a("div",Sa,[a("div",Da,[e[16]||(e[16]=a("h4",null,"–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞",-1)),a("div",Ta,[a("label",{class:B(["radio-option",{active:t.exportFormat==="csv"}])},[H(a("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=o=>t.exportFormat=o),value:"csv",class:"radio-input"},null,512),[[Ge,t.exportFormat]]),e[14]||(e[14]=a("span",{class:"radio-label"},[a("strong",null,"CSV"),a("small",null,"–î–ª—è Excel, LibreOffice")],-1))],2),a("label",{class:B(["radio-option",{active:t.exportFormat==="json"}])},[H(a("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=o=>t.exportFormat=o),value:"json",class:"radio-input"},null,512),[[Ge,t.exportFormat]]),e[15]||(e[15]=a("span",{class:"radio-label"},[a("strong",null,"JSON"),a("small",null,"–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, API")],-1))],2)])]),a("div",xa,[e[19]||(e[19]=a("h4",null,"–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",-1)),a("div",Aa,[a("label",{class:B(["radio-option",{active:t.exportScope==="all",disabled:!t.hasAllLogs}])},[H(a("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=o=>t.exportScope=o),value:"all",disabled:!t.hasAllLogs,class:"radio-input"},null,8,Ea),[[Ge,t.exportScope]]),a("span",Ma,[e[17]||(e[17]=a("strong",null,"–í—Å–µ –∑–∞–ø–∏—Å–∏",-1)),t.hasFilters?(c(),d("small",Ia,"–° –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ ("+m(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π)",1)):(c(),d("small",La,"–í—Å–µ–≥–æ: "+m(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π",1))])],2),a("label",{class:B(["radio-option",{active:t.exportScope==="selected",disabled:t.selectedCount===0}])},[H(a("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=o=>t.exportScope=o),value:"selected",disabled:t.selectedCount===0,class:"radio-input"},null,8,Pa),[[Ge,t.exportScope]]),a("span",Fa,[e[18]||(e[18]=a("strong",null,"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏",-1)),a("small",null,m(t.selectedCount)+" –∑–∞–ø–∏—Å–µ–π –≤—ã–±—Ä–∞–Ω–æ",1)])],2)])]),t.exportFormat==="json"?(c(),d("div",Ua,[e[21]||(e[21]=a("h4",null,"–û–ø—Ü–∏–∏ JSON",-1)),a("label",Ra,[H(a("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=o=>t.jsonPretty=o),class:"checkbox-input"},null,512),[[Ve,t.jsonPretty]]),e[20]||(e[20]=a("span",{class:"checkbox-label"},"–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)",-1))])])):x("",!0),a("div",Na,[a("div",Oa,[e[22]||(e[22]=a("span",{class:"info-label"},"–ó–∞–ø–∏—Å–µ–π –∫ —ç–∫—Å–ø–æ—Ä—Ç—É:",-1)),a("span",Ba,m(t.exportCount),1)]),t.estimatedSize?(c(),d("div",Va,[e[23]||(e[23]=a("span",{class:"info-label"},"–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä:",-1)),a("span",ja,m(t.formatSize(t.estimatedSize)),1)])):x("",!0)]),t.exportWarnings.length>0?(c(),d("div",za,[(c(!0),d(W,null,q(t.exportWarnings,(o,l)=>(c(),d("div",{key:l,class:"warning-item"}," ‚ö†Ô∏è "+m(o),1))),128))])):x("",!0)]),t.exporting?(c(),d("div",$a,[a("div",Wa,[a("div",{class:"progress-fill",style:xe({width:`${t.exportProgress}%`})},null,4)]),a("div",qa," –≠–∫—Å–ø–æ—Ä—Ç: "+m(t.exportProgress)+"% ",1)])):x("",!0),a("div",Ha,[a("button",{onClick:e[7]||(e[7]=(...o)=>t.handleExport&&t.handleExport(...o)),disabled:t.exporting||!t.canExport,class:"btn-primary"},[t.exporting?(c(),d("span",Ja,"–≠–∫—Å–ø–æ—Ä—Ç...")):(c(),d("span",Ka,"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"))],8,Xa),a("button",{onClick:e[8]||(e[8]=(...o)=>t.closeExportModal&&t.closeExportModal(...o)),disabled:t.exporting,class:"btn-secondary"}," –û—Ç–º–µ–Ω–∞ ",8,Ya)])])])):x("",!0)]),_:1})])}const Qa=K(_a,[["render",Ga],["__scopeId","data-v-7ae66f8c"]]);function jt(n,e=300){let s;return function(...r){const i=()=>{clearTimeout(s),n(...r)};clearTimeout(s),s=setTimeout(i,e)}}const Za={name:"WebhookLogSearch",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","search"],setup(n,{emit:e}){const s=y(n.modelValue||""),t=y(!1),r=y(null),i=jt(D=>{t.value=!1,e("search",D)},400),o=()=>{t.value=!0,e("update:modelValue",s.value),i(s.value)},l=()=>{t.value=!1,e("search",s.value)},u=()=>{s.value="",t.value=!1,r.value=null,e("update:modelValue",""),e("search","")};return ee(()=>n.modelValue,D=>{D!==s.value&&(s.value=D)}),{searchQuery:s,isSearching:t,searchResultsCount:r,handleSearchInput:o,handleSearch:l,clearSearch:u,setResultsCount:D=>{r.value=D},getResultsText:D=>{const E=D%10,T=D%100;return T>=11&&T<=19?"–∑–∞–ø–∏—Å–µ–π":E===1?"–∑–∞–ø–∏—Å—å":E>=2&&E<=4?"–∑–∞–ø–∏—Å–∏":"–∑–∞–ø–∏—Å–µ–π"},performSearch:(D,E)=>{if(!D||!E||!Array.isArray(E))return[];const T=D.toLowerCase().trim();return T.length===0?E:E.map(h=>qe(h)).filter(h=>Ee(h)).filter(h=>{if(h.event&&h.event.toLowerCase().includes(T)||h.category&&h.category.toLowerCase().includes(T)||h.ip&&h.ip.toLowerCase().includes(T)||h.details&&typeof h.details=="object"&&(h.details.task_id&&String(h.details.task_id).includes(T)||h.details.task_title&&h.details.task_title.toLowerCase().includes(T)||h.details.entity_id&&String(h.details.entity_id).includes(T)||h.details.title&&h.details.title.toLowerCase().includes(T)||h.details.comment_text&&h.details.comment_text.toLowerCase().includes(T)))return!0;if(h.payload&&typeof h.payload=="object")try{if(JSON.stringify(h.payload).toLowerCase().includes(T))return!0}catch{}return!1})},formatSearchResult:D=>{const E=[];if(D.event&&E.push(He(D.event)),D.category&&E.push(Pe(D.category)),D.details){const T=pt(D.details);T!=="‚Äî"&&E.push(T)}return E.join(" ‚Ä¢ ")}}}},eo={class:"webhook-search"},to={class:"search-wrapper"},so={key:0,class:"search-indicator"},ao={key:1,class:"search-results"};function oo(n,e,s,t,r,i){return c(),d("div",eo,[a("div",to,[e[5]||(e[5]=a("span",{class:"search-icon"},"üîç",-1)),H(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.searchQuery=o),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ª–æ–≥–æ–≤ (—Å–æ–±—ã—Ç–∏–µ, payload, IP, –¥–µ—Ç–∞–ª–∏)...",class:"search-input",onInput:e[1]||(e[1]=(...o)=>t.handleSearchInput&&t.handleSearchInput(...o)),onKeyup:[e[2]||(e[2]=Se((...o)=>t.handleSearch&&t.handleSearch(...o),["enter"])),e[3]||(e[3]=Se((...o)=>t.clearSearch&&t.clearSearch(...o),["esc"]))]},null,544),[[we,t.searchQuery]]),t.searchQuery?(c(),d("button",{key:0,onClick:e[4]||(e[4]=(...o)=>t.clearSearch&&t.clearSearch(...o)),class:"clear-button",title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ (Esc)","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):x("",!0)]),t.isSearching?(c(),d("div",so,[...e[6]||(e[6]=[a("span",{class:"spinner"},null,-1),Q(" –ü–æ–∏—Å–∫... ",-1)])])):x("",!0),t.searchQuery&&t.searchResultsCount!==null?(c(),d("div",ao," –ù–∞–π–¥–µ–Ω–æ: "+m(t.searchResultsCount)+" "+m(t.getResultsText(t.searchResultsCount)),1)):x("",!0)])}const no=K(Za,[["render",oo],["__scopeId","data-v-db228863"]]);function ro(n,e=null){const s=()=>{try{const o=localStorage.getItem(n);return o?JSON.parse(o):e}catch(o){return console.error(`Error loading ${n} from localStorage:`,o),e}},t=o=>{try{localStorage.setItem(n,JSON.stringify(o))}catch(l){console.error(`Error saving ${n} to localStorage:`,l)}},r=()=>{try{localStorage.removeItem(n)}catch(o){console.error(`Error clearing ${n} from localStorage:`,o)}},i=y(s());return ee(i,o=>{t(o)},{deep:!0}),{value:i,save:t,load:s,clear:r}}const io={name:"WebhookLogFilters",props:{filters:{type:Object,required:!0}},emits:["update:filters","reset"],setup(n,{emit:e}){const s=y(null),t=ro("webhook-filters",{category:null,event:null,dateFrom:null,dateTo:null,hour:null,ip:null,status:null}),r=_=>(s.value=null,ct(_)?(e("update:filters",_),!0):(s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",console.error("[WebhookLogFilters] Validation error:",s.value),!1)),i=new Date().toISOString().split("T")[0],o=y({category:t.value.category||n.filters.category||null,event:t.value.event||n.filters.event||null,dateFrom:t.value.dateFrom||n.filters.dateFrom||n.filters.date||i,dateTo:t.value.dateTo||n.filters.dateTo||null,hour:t.value.hour!==void 0?t.value.hour:n.filters.hour!==void 0?n.filters.hour:null,ip:t.value.ip||n.filters.ip||null,status:t.value.status||n.filters.status||null}),l=y(null),u=[{id:"today",label:"–°–µ–≥–æ–¥–Ω—è",getDates:()=>({from:i,to:i})},{id:"yesterday",label:"–í—á–µ—Ä–∞",getDates:()=>{const _=new Date;_.setDate(_.getDate()-1);const b=_.toISOString().split("T")[0];return{from:b,to:b}}},{id:"last7days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",getDates:()=>{const _=new Date;return _.setDate(_.getDate()-7),{from:_.toISOString().split("T")[0],to:i}}},{id:"last30days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π",getDates:()=>{const _=new Date;return _.setDate(_.getDate()-30),{from:_.toISOString().split("T")[0],to:i}}}],f=_=>{const b=u.find(P=>P.id===_);if(b){const P=b.getDates();o.value.dateFrom=P.from,o.value.dateTo=P.to,l.value=_,R()}};ee(()=>n.filters,_=>{o.value={category:_.category||null,event:_.event||null,dateFrom:_.dateFrom||_.date||i,dateTo:_.dateTo||null,hour:_.hour!==void 0?_.hour:null,ip:_.ip||null,status:_.status||null}},{deep:!0}),ee(o,_=>{t.value={..._},e("update:filters",{..._})},{deep:!0});const p=C(()=>{const _={};return o.value.category&&(_.category=o.value.category),o.value.event&&(_.event=o.value.event),o.value.hour!==null&&(_.hour=o.value.hour),o.value.ip&&(_.ip=o.value.ip),o.value.status&&(_.status=o.value.status),o.value.dateFrom&&o.value.dateFrom!==i&&(_.dateFrom=o.value.dateFrom),o.value.dateTo&&(_.dateTo=o.value.dateTo),_}),g=C(()=>Object.keys(p.value).length>0),S=_=>({category:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è",event:"–°–æ–±—ã—Ç–∏–µ",hour:"–ß–∞—Å",ip:"IP –∞–¥—Ä–µ—Å",status:"–°—Ç–∞—Ç—É—Å",dateFrom:"–î–∞—Ç–∞ –æ—Ç",dateTo:"–î–∞—Ç–∞ –¥–æ"})[_]||_,D=(_,b)=>_==="category"?Pe(b)||b:_==="hour"?`${String(b).padStart(2,"0")}:00`:_==="event"?He(b)||b:_==="status"&&{success:"–£—Å–ø–µ—à–Ω–æ",error:"–û—à–∏–±–∫–∞",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"}[b]||b,E=C(()=>[{value:null,label:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},{value:"tasks",label:Pe("tasks")},{value:"smart-processes",label:Pe("smart-processes")},{value:"errors",label:Pe("errors")}]),T=C(()=>[{value:null,label:"–í—Å–µ —Å–æ–±—ã—Ç–∏—è"},...["ONTASKADD","ONTASKUPDATE","ONTASKDELETE","ONTASKCOMMENTADD","ONTASKCOMMENTUPDATE","ONTASKCOMMENTDELETE","ONCRMDYNAMICITEMADD","ONCRMDYNAMICITEMUPDATE","ONCRMDYNAMICITEMDELETE"].map(b=>({value:b,label:He(b)}))]),I=_=>{_==="hour"?o.value[_]=null:_==="dateFrom"?o.value[_]=i:o.value[_]=null,l.value=null},h=_=>{const b={...o.value,category:_||null};r(b)&&(o.value.category=_)},v=_=>{const b={...o.value,event:_||null};r(b)&&(o.value.event=_)},w=(_,b)=>{if(_&&!/^\d{4}-\d{2}-\d{2}$/.test(_)){console.error("[WebhookLogFilters] Invalid date format:",_),s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã";return}const P={...o.value,[b]:_||null};r(P)&&(o.value[b]=_)},U=_=>{if(_!=null){const P=parseInt(_,10);if(isNaN(P)||P<0||P>23){console.error("[WebhookLogFilters] Invalid hour:",_),s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∞—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23)";return}}const b={...o.value,hour:_!=null?parseInt(_,10):null};r(b)&&(o.value.hour=_!=null?parseInt(_,10):null)},R=()=>{r({...o.value})},k=()=>{o.value={category:null,event:null,dateFrom:i,dateTo:null,hour:null,ip:null,status:null},l.value=null,t.clear(),e("reset")};return le(()=>{t.value&&Object.keys(t.value).length>0&&e("update:filters",{...t.value})}),{localFilters:o,activeFilters:p,hasActiveFilters:g,getFilterLabel:S,getFilterValue:D,clearFilter:I,handleFilterChange:R,handleCategoryChange:h,handleEventChange:v,handleDateChange:w,handleHourChange:U,handleReset:k,quickFilters:u,activeQuickFilter:l,applyQuickFilter:f,categoryOptions:E,eventOptions:T,validationError:s}}},lo={class:"webhook-log-filters"},co={key:0,class:"active-filters-indicator"},uo=["onClick"],mo={key:1,class:"validation-error"},go={class:"quick-filters"},fo=["onClick"],ho={class:"filters-row"},vo={class:"filter-group"},po=["value"],yo={class:"filter-group"},_o=["value"],bo={class:"filter-group"},wo={class:"filter-group"},ko={class:"filter-group"},Co={class:"filter-group"},So={class:"filter-group"};function Do(n,e,s,t,r,i){return c(),d("div",lo,[t.hasActiveFilters?(c(),d("div",co,[e[14]||(e[14]=a("span",{class:"indicator-text"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(W,null,q(t.activeFilters,(o,l)=>(c(),d("span",{key:l,class:"filter-badge"},[Q(m(t.getFilterLabel(l))+": "+m(t.getFilterValue(l,o))+" ",1),a("button",{onClick:u=>t.clearFilter(l),class:"filter-badge-remove",title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"}," √ó ",8,uo)]))),128)),a("button",{onClick:e[0]||(e[0]=(...o)=>t.handleReset&&t.handleReset(...o)),class:"btn-clear-all"}," –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ ")])):x("",!0),t.validationError?(c(),d("div",mo," ‚ö†Ô∏è "+m(t.validationError),1)):x("",!0),a("div",go,[e[15]||(e[15]=a("span",{class:"quick-filters-label"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(W,null,q(t.quickFilters,o=>(c(),d("button",{key:o.id,onClick:l=>t.applyQuickFilter(o.id),class:B(["quick-filter-btn",{active:t.activeQuickFilter===o.id}])},m(o.label),11,fo))),128))]),a("div",ho,[a("div",vo,[e[16]||(e[16]=a("label",{for:"category-filter"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è:",-1)),H(a("select",{id:"category-filter","onUpdate:modelValue":e[1]||(e[1]=o=>t.localFilters.category=o),onChange:e[2]||(e[2]=o=>t.handleCategoryChange(t.localFilters.category)),class:"filter-select"},[(c(!0),d(W,null,q(t.categoryOptions,o=>(c(),d("option",{key:o.value,value:o.value},m(o.label),9,po))),128))],544),[[re,t.localFilters.category]])]),a("div",yo,[e[17]||(e[17]=a("label",{for:"event-filter"},"–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:",-1)),H(a("select",{id:"event-filter","onUpdate:modelValue":e[3]||(e[3]=o=>t.localFilters.event=o),onChange:e[4]||(e[4]=o=>t.handleEventChange(t.localFilters.event)),class:"filter-select"},[(c(!0),d(W,null,q(t.eventOptions,o=>(c(),d("option",{key:o.value,value:o.value},m(o.label),9,_o))),128))],544),[[re,t.localFilters.event]])]),a("div",bo,[e[18]||(e[18]=a("label",{for:"date-from-filter"},"–î–∞—Ç–∞ –æ—Ç:",-1)),H(a("input",{id:"date-from-filter","onUpdate:modelValue":e[5]||(e[5]=o=>t.localFilters.dateFrom=o),type:"date",onChange:e[6]||(e[6]=o=>t.handleDateChange(t.localFilters.dateFrom,"dateFrom")),class:"filter-input"},null,544),[[we,t.localFilters.dateFrom]])]),a("div",wo,[e[19]||(e[19]=a("label",{for:"date-to-filter"},"–î–∞—Ç–∞ –¥–æ:",-1)),H(a("input",{id:"date-to-filter","onUpdate:modelValue":e[7]||(e[7]=o=>t.localFilters.dateTo=o),type:"date",onChange:e[8]||(e[8]=o=>t.handleDateChange(t.localFilters.dateTo,"dateTo")),class:"filter-input"},null,544),[[we,t.localFilters.dateTo]])]),a("div",ko,[e[20]||(e[20]=a("label",{for:"ip-filter"},"IP –∞–¥—Ä–µ—Å:",-1)),H(a("input",{id:"ip-filter","onUpdate:modelValue":e[9]||(e[9]=o=>t.localFilters.ip=o),type:"text",placeholder:"192.168.1.1",onInput:e[10]||(e[10]=(...o)=>t.handleFilterChange&&t.handleFilterChange(...o)),class:"filter-input"},null,544),[[we,t.localFilters.ip]])]),a("div",Co,[e[22]||(e[22]=a("label",{for:"status-filter"},"–°—Ç–∞—Ç—É—Å:",-1)),H(a("select",{id:"status-filter","onUpdate:modelValue":e[11]||(e[11]=o=>t.localFilters.status=o),onChange:e[12]||(e[12]=(...o)=>t.handleFilterChange&&t.handleFilterChange(...o)),class:"filter-select"},[...e[21]||(e[21]=[a("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),a("option",{value:"success"},"–£—Å–ø–µ—à–Ω–æ",-1),a("option",{value:"error"},"–û—à–∏–±–∫–∞",-1),a("option",{value:"warning"},"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",-1)])],544),[[re,t.localFilters.status]])]),a("div",So,[a("button",{onClick:e[13]||(e[13]=(...o)=>t.handleReset&&t.handleReset(...o)),class:"btn-reset"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])])}const To=K(io,[["render",Do],["__scopeId","data-v-2a150a46"]]),xo={name:"WebhookLogList",props:{logs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null},pagination:{type:Object,default:null},selectedLogs:{type:Array,default:()=>[]}},emits:["select-log","page-change","update:selectedLogs"],setup(n,{emit:e}){const s=C(()=>!n.logs||!Array.isArray(n.logs)?(console.warn("[WebhookLogList] Invalid logs prop:",n.logs),[]):n.logs.map(b=>qe(b)).filter(b=>Ee(b)?!0:(console.warn("[WebhookLogList] Invalid log entry:",b),!1))),t=y("timestamp"),r=y("desc"),i=b=>{t.value===b?r.value=r.value==="asc"?"desc":"asc":(t.value=b,r.value="desc")},o=C(()=>!s.value||s.value.length===0?[]:[...s.value].sort((P,z)=>{let O,A;switch(t.value){case"timestamp":O=new Date(P.timestamp||0).getTime(),A=new Date(z.timestamp||0).getTime();break;case"event":O=(P.event||"").toLowerCase(),A=(z.event||"").toLowerCase();break;case"category":O=(P.category||"").toLowerCase(),A=(z.category||"").toLowerCase();break;case"ip":O=(P.ip||"").toLowerCase(),A=(z.ip||"").toLowerCase();break;default:return 0}return O<A?r.value==="asc"?-1:1:O>A?r.value==="asc"?1:-1:0})),l=b=>t.value!==b?"‚ÜïÔ∏è":r.value==="asc"?"‚Üë":"‚Üì",u=b=>b.category==="errors"?"status-error":"status-success",f=b=>b.category==="errors"?"‚ùå":"‚úÖ",p=b=>b.category==="errors"?"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏":"–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ",g=b=>`${b.timestamp}_${b.event}_${b.ip||"unknown"}`,S=b=>b?vt(b,"short"):"‚Äî",D=b=>b?He(b):"‚Äî",E=b=>b?Pe(b):"‚Äî",T=b=>!b||typeof b!="object"?"‚Äî":pt(b),I=b=>`category-${b}`,h=b=>b?.startsWith("ONTASK")?"event-task":b?.startsWith("ONCRMDYNAMIC")?"event-smart-process":"event-other",v=b=>{e("select-log",b)},w=b=>{b>=1&&b<=n.pagination.pages&&e("page-change",b)},U=b=>n.selectedLogs.some(P=>g(P)===g(b)),R=(b,P)=>{P.stopPropagation();const z=[...n.selectedLogs],O=g(b),A=z.findIndex(j=>g(j)===O);P.target.checked?A===-1&&z.push(b):A!==-1&&z.splice(A,1),e("update:selectedLogs",z)},k=b=>{b.target.checked?e("update:selectedLogs",[...n.logs]):e("update:selectedLogs",[])},_=C(()=>s.value.length>0&&s.value.every(b=>U(b)));return ee(()=>n.logs,b=>{if(b&&Array.isArray(b)){const P=b.filter(z=>!Ee(z)).length;P>0&&console.warn(`[WebhookLogList] Received ${P} invalid log entries out of ${b.length}`)}},{immediate:!0}),{validatedLogs:s,sortBy:t,sortOrder:r,sortedLogs:o,handleSort:i,getSortIcon:l,getStatusClass:u,getStatusIcon:f,getStatusTitle:p,getLogId:g,formatTimestamp:S,formatEvent:D,formatCategoryLabel:E,formatDetailsPreview:T,getCategoryClass:I,getEventClass:h,handleLogClick:v,handlePageChange:w,isSelected:U,handleSelectLog:R,handleSelectAll:k,allSelected:_}}},Ao={class:"webhook-log-list"},Eo={key:0,class:"logs-table-container"},Mo={class:"logs-table"},Io={class:"checkbox-header"},Lo=["checked"],Po={class:"sort-icon"},Fo={class:"sort-icon"},Uo={class:"sort-icon"},Ro={class:"sort-icon"},No=["onClick"],Oo=["checked","onChange"],Bo=["title"],Vo={class:"details-preview"},jo=["onClick"],zo={key:0,class:"pagination"},$o=["disabled"],Wo={class:"pagination-info"},qo=["disabled"];function Ho(n,e,s,t,r,i){return c(),d("div",Ao,[s.logs.length>0?(c(),d("div",Eo,[a("table",Mo,[a("thead",null,[a("tr",null,[a("th",Io,[a("input",{type:"checkbox",checked:t.allSelected,onChange:e[0]||(e[0]=(...o)=>t.handleSelectAll&&t.handleSelectAll(...o)),onClick:e[1]||(e[1]=pe(()=>{},["stop"])),class:"checkbox-input",title:"–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"},null,40,Lo)]),a("th",{onClick:e[2]||(e[2]=o=>t.handleSort("timestamp")),class:B(["sortable",{"sort-asc":t.sortBy==="timestamp"&&t.sortOrder==="asc","sort-desc":t.sortBy==="timestamp"&&t.sortOrder==="desc"}])},[e[9]||(e[9]=Q(" –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è ",-1)),a("span",Po,m(t.getSortIcon("timestamp")),1)],2),a("th",{onClick:e[3]||(e[3]=o=>t.handleSort("event")),class:B(["sortable",{"sort-asc":t.sortBy==="event"&&t.sortOrder==="asc","sort-desc":t.sortBy==="event"&&t.sortOrder==="desc"}])},[e[10]||(e[10]=Q(" –¢–∏–ø —Å–æ–±—ã—Ç–∏—è ",-1)),a("span",Fo,m(t.getSortIcon("event")),1)],2),a("th",{onClick:e[4]||(e[4]=o=>t.handleSort("category")),class:B(["sortable",{"sort-asc":t.sortBy==="category"&&t.sortOrder==="asc","sort-desc":t.sortBy==="category"&&t.sortOrder==="desc"}])},[e[11]||(e[11]=Q(" –ö–∞—Ç–µ–≥–æ—Ä–∏—è ",-1)),a("span",Uo,m(t.getSortIcon("category")),1)],2),a("th",{onClick:e[5]||(e[5]=o=>t.handleSort("ip")),class:B(["sortable",{"sort-asc":t.sortBy==="ip"&&t.sortOrder==="asc","sort-desc":t.sortBy==="ip"&&t.sortOrder==="desc"}])},[e[12]||(e[12]=Q(" IP ",-1)),a("span",Ro,m(t.getSortIcon("ip")),1)],2),e[13]||(e[13]=a("th",null,"–î–µ—Ç–∞–ª–∏",-1)),e[14]||(e[14]=a("th",null,"–î–µ–π—Å—Ç–≤–∏—è",-1))])]),a("tbody",null,[(c(!0),d(W,null,q(t.sortedLogs,o=>(c(),d("tr",{key:t.getLogId(o),onClick:l=>t.handleLogClick(o),class:B(["log-row",{"row-selected":t.isSelected(o)}])},[a("td",{onClick:e[6]||(e[6]=pe(()=>{},["stop"]))},[a("input",{type:"checkbox",checked:t.isSelected(o),onChange:l=>t.handleSelectLog(o,l),class:"checkbox-input"},null,40,Oo)]),a("td",null,m(t.formatTimestamp(o.timestamp)),1),a("td",null,[a("span",{class:B(["status-indicator",t.getStatusClass(o)]),title:t.getStatusTitle(o)},m(t.getStatusIcon(o)),11,Bo),a("span",{class:B(["event-badge",t.getEventClass(o.event)])},m(t.formatEvent(o.event)),3)]),a("td",null,[a("span",{class:B(["category-badge",t.getCategoryClass(o.category)])},m(t.formatCategoryLabel(o.category)),3)]),a("td",null,m(o.ip||"N/A"),1),a("td",null,[a("div",Vo,m(t.formatDetailsPreview(o.details)),1)]),a("td",null,[a("button",{onClick:pe(l=>t.handleLogClick(o),["stop"]),class:"btn-view"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,jo)])],10,No))),128))])]),s.pagination&&s.pagination.pages>1?(c(),d("div",zo,[a("button",{onClick:e[7]||(e[7]=o=>t.handlePageChange(s.pagination.page-1)),disabled:s.pagination.page<=1,class:"btn-pagination"}," –ù–∞–∑–∞–¥ ",8,$o),a("span",Wo," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+m(s.pagination.page)+" –∏–∑ "+m(s.pagination.pages)+" (–≤—Å–µ–≥–æ: "+m(s.pagination.total)+") ",1),a("button",{onClick:e[8]||(e[8]=o=>t.handlePageChange(s.pagination.page+1)),disabled:s.pagination.page>=s.pagination.pages,class:"btn-pagination"}," –í–ø–µ—Ä—ë–¥ ",8,qo)])):x("",!0)])):x("",!0)])}const Xo=K(xo,[["render",Ho],["__scopeId","data-v-fddd3018"]]),Jo={name:"LoadingSkeleton",props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"20px"},variant:{type:String,default:"rect",validator:n=>["rect","circle","text","table-row"].includes(n)},animated:{type:Boolean,default:!0},borderRadius:{type:String,default:null}},setup(n){return{skeletonStyle:C(()=>{const s={width:typeof n.width=="number"?`${n.width}px`:n.width,height:typeof n.height=="number"?`${n.height}px`:n.height};return n.borderRadius&&(s.borderRadius=n.borderRadius),s})}}},Ko={key:0,class:"skeleton-shimmer"};function Yo(n,e,s,t,r,i){return c(),d("div",{class:B(["skeleton",[`skeleton-${s.variant}`,{"skeleton-animated":s.animated}]]),style:xe(t.skeletonStyle)},[s.animated?(c(),d("div",Ko)):x("",!0)],6)}const Go=K(Jo,[["render",Yo],["__scopeId","data-v-014f86e6"]]),Qo={name:"SkeletonLogList",components:{LoadingSkeleton:Go},props:{rows:{type:Number,default:5}},setup(){return{getColumnWidth:e=>["40px","15%","20%","15%","15%","20%","15%"][e-1]||"100%"}}},Zo={class:"skeleton-log-list"},en={class:"skeleton-table-header"};function tn(n,e,s,t,r,i){const o=X("LoadingSkeleton");return c(),d("div",Zo,[a("div",en,[(c(),d(W,null,q(7,l=>G(o,{key:l,width:"120px",height:"16px",variant:"text"})),64))]),(c(!0),d(W,null,q(s.rows,l=>(c(),d("div",{key:l,class:"skeleton-table-row"},[(c(),d(W,null,q(7,u=>G(o,{key:u,width:"100%",height:"20px",variant:"text",style:xe({width:t.getColumnWidth(u)})},null,8,["style"])),64))]))),128))])}const sn=K(Qo,[["render",tn],["__scopeId","data-v-475c4e73"]]),an={name:"EmptyState",props:{icon:{type:String,default:"üì≠"},title:{type:String,required:!0},description:{type:String,required:!0},actionLabel:{type:String,default:null},actions:{type:Array,default:null},hints:{type:Array,default:()=>[]},variant:{type:String,default:"default",validator:n=>["default","error","warning","info"].includes(n)}},emits:["action","action-click"]},on={class:"empty-icon"},nn={class:"empty-title"},rn={class:"empty-description"},ln={key:0,class:"empty-hints"},cn={key:1,class:"empty-actions"},dn=["onClick"];function un(n,e,s,t,r,i){return c(),d("div",{class:B(["empty-state",`empty-state-${s.variant}`])},[a("div",on,m(s.icon),1),a("h3",nn,m(s.title),1),a("p",rn,m(s.description),1),s.hints&&s.hints.length>0?(c(),d("div",ln,[(c(!0),d(W,null,q(s.hints,(o,l)=>(c(),d("div",{key:l,class:"hint-item"}," üí° "+m(o),1))),128))])):x("",!0),s.actionLabel||s.actions?(c(),d("div",cn,[s.actionLabel?(c(),d("button",{key:0,onClick:e[0]||(e[0]=o=>n.$emit("action")),class:"btn-primary"},m(s.actionLabel),1)):x("",!0),(c(!0),d(W,null,q(s.actions,(o,l)=>(c(),d("button",{key:l,onClick:u=>n.$emit("action-click",o.id),class:B(["btn",`btn-${o.variant||"secondary"}`])},m(o.label),11,dn))),128))])):x("",!0)],2)}const mn=K(an,[["render",un],["__scopeId","data-v-081c13b9"]]),gn={name:"ErrorDisplay",props:{title:{type:String,default:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"},message:{type:String,required:!0},details:{type:String,default:null},severity:{type:String,default:"error",validator:n=>["error","warning","critical"].includes(n)},retryable:{type:Boolean,default:!1}},emits:["retry"],setup(){return{showDetails:y(!1)}}},fn={class:"error-icon"},hn={class:"error-content"},vn={class:"error-title"},pn={class:"error-message"},yn={key:0,class:"error-details"},_n={class:"error-actions"};function bn(n,e,s,t,r,i){return c(),d("div",{class:B(["error-display",`error-${s.severity}`])},[a("div",fn,m(s.severity==="critical"?"üö®":"‚ö†Ô∏è"),1),a("div",hn,[a("h4",vn,m(s.title),1),a("p",pn,m(s.message),1),s.details&&t.showDetails?(c(),d("div",yn,[a("pre",null,m(s.details),1)])):x("",!0),a("div",_n,[s.retryable?(c(),d("button",{key:0,onClick:e[0]||(e[0]=o=>n.$emit("retry")),class:"btn-retry"}," üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")):x("",!0),s.details?(c(),d("button",{key:1,onClick:e[1]||(e[1]=o=>t.showDetails=!t.showDetails),class:"btn-details"},m(t.showDetails?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å")+" –¥–µ—Ç–∞–ª–∏ ",1)):x("",!0)])])],2)}const wn=K(gn,[["render",bn],["__scopeId","data-v-3f2f4c14"]]),Xe=y([]);let kn=0;function zt(){const n=(l,u="info",f=3e3)=>{const p=++kn,g={id:p,message:l,type:u,duration:f,timestamp:Date.now()};return Xe.value.push(g),f>0&&setTimeout(()=>{e(p)},f),p},e=l=>{const u=Xe.value.findIndex(f=>f.id===l);u>-1&&Xe.value.splice(u,1)};return{notifications:Xe,showNotification:n,removeNotification:e,clearNotifications:()=>{Xe.value=[]},success:(l,u=3e3)=>n(l,"success",u),error:(l,u=5e3)=>n(l,"error",u),warning:(l,u=4e3)=>n(l,"warning",u),info:(l,u=3e3)=>n(l,"info",u)}}const Cn={name:"Notification",props:{notification:{type:Object,required:!0}},emits:["close"],setup(n,{emit:e}){const s=y(100),t=C(()=>n.notification.duration>0);let r=null;const i={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},o=C(()=>i[n.notification.type]||"‚ÑπÔ∏è"),l=()=>{e("close")},u=()=>{n.notification.onClick&&n.notification.onClick()};return le(()=>{if(t.value&&n.notification.duration>0){const f=Date.now(),p=n.notification.duration;r=setInterval(()=>{const g=Date.now()-f;s.value=Math.max(0,100-g/p*100),s.value<=0&&(clearInterval(r),l())},50)}}),Be(()=>{r&&clearInterval(r)}),{icon:o,progress:s,showProgress:t,close:l,handleClick:u}}},Sn={class:"notification-content"},Dn={class:"notification-icon"},Tn={class:"notification-message"},xn={key:0,class:"notification-progress"};function An(n,e,s,t,r,i){return c(),d("div",{class:B(["notification",`notification-${s.notification.type}`]),onClick:e[1]||(e[1]=(...o)=>t.handleClick&&t.handleClick(...o))},[a("div",Sn,[a("span",Dn,m(t.icon),1),a("span",Tn,m(s.notification.message),1)]),a("button",{onClick:e[0]||(e[0]=pe((...o)=>t.close&&t.close(...o),["stop"])),class:"notification-close"},"‚úï"),t.showProgress?(c(),d("div",xn,[a("div",{class:"progress-bar",style:xe({width:`${t.progress}%`})},null,4)])):x("",!0)],2)}const En=K(Cn,[["render",An],["__scopeId","data-v-1b602bdf"]]),Mn={name:"NotificationContainer",components:{Notification:En},setup(){const{notifications:n,removeNotification:e}=zt();return{notifications:n,removeNotification:e}}},In={class:"notification-container"};function Ln(n,e,s,t,r,i){const o=X("Notification");return c(),oe(xt,{to:"body"},[a("div",In,[G(Zt,{name:"notification",tag:"div"},{default:_e(()=>[(c(!0),d(W,null,q(t.notifications,l=>(c(),oe(o,{key:l.id,notification:l,onClose:u=>t.removeNotification(l.id)},null,8,["notification","onClose"]))),128))]),_:1})])])}const Pn=K(Mn,[["render",Ln],["__scopeId","data-v-dd8772c8"]]),Fn={name:"RealtimeControls",props:{enabled:{type:Boolean,default:!1},connectionState:{type:String,default:"disconnected"},error:{type:String,default:null}},emits:["toggle"],setup(n,{emit:e}){const s=y(n.enabled);ee(()=>n.enabled,g=>{s.value=g});const t=C(()=>n.connectionState==="connecting"),r=C(()=>!!n.error),i=C(()=>({"status-connected":n.connectionState==="connected","status-connecting":n.connectionState==="connecting","status-disconnected":n.connectionState==="disconnected","status-error":n.connectionState==="error"})),o=C(()=>{switch(n.connectionState){case"connected":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";case"connecting":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...";case"disconnected":return"–û—Ç–∫–ª—é—á–µ–Ω–æ";case"error":return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}}),l=C(()=>o.value),u=C(()=>({"status-connected":n.connectionState==="connected","status-connecting":n.connectionState==="connecting","status-disconnected":n.connectionState==="disconnected","status-error":n.connectionState==="error"})),f=C(()=>n.error?typeof n.error=="string"?n.error:n.error.message?n.error.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞":null);return{localEnabled:s,isConnecting:t,hasError:r,statusClass:i,statusText:o,connectionStatusText:l,connectionStatusClass:u,displayError:f,handleToggle:()=>{e("toggle",s.value)}}}},Un={class:"realtime-controls"},Rn={class:"control-toggle"},Nn=["disabled"],On={class:"status-text"},Bn={key:0,class:"error-message"};function Vn(n,e,s,t,r,i){return c(),d("div",Un,[a("label",Rn,[H(a("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=o=>t.localEnabled=o),onChange:e[1]||(e[1]=(...o)=>t.handleToggle&&t.handleToggle(...o)),disabled:t.isConnecting},null,40,Nn),[[Ve,t.localEnabled]]),e[2]||(e[2]=a("span",{class:"toggle-label"},"–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",-1))]),a("div",{class:B(["status-indicator",t.statusClass])},[e[3]||(e[3]=a("span",{class:"status-dot"},null,-1)),a("span",On,m(t.statusText),1)],2),t.hasError&&t.displayError?(c(),d("div",Bn," ‚ö†Ô∏è "+m(t.displayError),1)):x("",!0)])}const jn=K(Fn,[["render",Vn],["__scopeId","data-v-af36f073"]]),zn={name:"NewLogsIndicator",props:{count:{type:Number,default:0},newLogs:{type:Array,default:()=>[]}},emits:["apply","dismiss"],setup(n,{emit:e}){const s=(o,l,u,f)=>{const p=o%10,g=o%100;return g>=11&&g<=19?f:p===1?l:p>=2&&p<=4?u:f},t=C(()=>!n.newLogs||!Array.isArray(n.newLogs)||n.newLogs.length===0?[]:n.newLogs.map(l=>qe(l)).filter(l=>Ee(l)).slice(0,5).map(l=>({...l,formatted:{event:He(l.event),category:Pe(l.category)}})));return{pluralize:s,newLogsPreview:t,handleApply:()=>{if(!n.newLogs||n.newLogs.length===0)return;const o=n.newLogs.map(l=>qe(l)).filter(l=>Ee(l));if(o.length===0){console.warn("[NewLogsIndicator] No valid logs to apply");return}e("apply",o)},handleDismiss:()=>{e("dismiss")}}}},$n={key:0,class:"new-logs-indicator"},Wn={class:"indicator-content"},qn={class:"indicator-text"},Hn={class:"indicator-actions"};function Xn(n,e,s,t,r,i){return c(),oe(Ie,{name:"slide-down"},{default:_e(()=>[s.count>0?(c(),d("div",$n,[a("div",Wn,[e[2]||(e[2]=a("span",{class:"indicator-icon"},"üîî",-1)),a("span",qn,m(s.count)+" "+m(t.pluralize(s.count,"–Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π")),1),a("div",Hn,[a("button",{onClick:e[0]||(e[0]=(...o)=>t.handleApply&&t.handleApply(...o)),class:"btn-apply"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å "),a("button",{onClick:e[1]||(e[1]=(...o)=>t.handleDismiss&&t.handleDismiss(...o)),class:"btn-dismiss"}," ‚úï ")])])])):x("",!0)]),_:1})}const Jn=K(zn,[["render",Xn],["__scopeId","data-v-19791dbc"]]);class Kn{constructor(e,s={}){this.url=e,this.options={reconnectInterval:3e3,maxReconnectAttempts:10,reconnectDelay:1e3,lastTimestamp:null,...s},this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.reconnectTimer=null,this.isManualDisconnect=!1,this.connectionState="disconnected"}updateOptions(e){this.options={...this.options,...e}}connect(){if(this.connectionState==="connected"||this.connectionState==="connecting"){console.warn("[RealtimeService] Already connected or connecting");return}this.isManualDisconnect=!1,this.connectionState="connecting",this.notifyListeners("state-change",{state:this.connectionState});try{let e=this.url;if(!e.startsWith("http://")&&!e.startsWith("https://")){const s=new URL(e,window.location.origin);this.options.lastTimestamp&&s.searchParams.set("last_timestamp",this.options.lastTimestamp),e=s.toString()}else{const s=new URL(e);this.options.lastTimestamp&&s.searchParams.set("last_timestamp",this.options.lastTimestamp),e=s.toString()}console.log("[RealtimeService] Connecting to:",e),this.eventSource=new EventSource(e),this.eventSource.onopen=()=>{console.log("[RealtimeService] EventSource opened"),this.notifyListeners("open",{timestamp:new Date().toISOString()})},this.eventSource.onmessage=s=>{try{const t=JSON.parse(s.data);this.notifyListeners("message",t)}catch(t){console.error("[RealtimeService] Error parsing message:",t)}},this.eventSource.addEventListener("connected",s=>{try{const t=JSON.parse(s.data);console.log("[RealtimeService] Connected event received:",t),this.connectionState="connected",this.reconnectAttempts=0,this.notifyListeners("connected",t),this.notifyListeners("state-change",{state:this.connectionState})}catch(t){console.error("[RealtimeService] Error parsing connected event:",t)}}),this.eventSource.addEventListener("new_logs",s=>{const t=JSON.parse(s.data);if(t.logs&&t.logs.length>0){const r=t.logs[t.logs.length-1];r.timestamp&&(this.options.lastTimestamp=r.timestamp)}this.notifyListeners("new_logs",t)}),this.eventSource.addEventListener("error",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("error",t)}catch{this.notifyListeners("error",{message:"Server error"})}}),this.eventSource.addEventListener("timeout",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("timeout",t)}catch{this.notifyListeners("timeout",{message:"Connection timeout"})}this.reconnect()}),this.eventSource.addEventListener("closed",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("closed",t)}catch{this.notifyListeners("closed",{message:"Connection closed"})}this.isManualDisconnect||this.reconnect()}),this.eventSource.onerror=s=>{console.error("[RealtimeService] Connection error:",s),console.error("[RealtimeService] EventSource readyState:",this.eventSource?.readyState),this.eventSource?.readyState===EventSource.CLOSED?(console.log("[RealtimeService] EventSource closed by server"),this.connectionState="disconnected",this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()):this.eventSource?.readyState===EventSource.CONNECTING?console.log("[RealtimeService] Still connecting..."):(this.connectionState="error",this.notifyListeners("error",{error:s,type:"connection",message:"Failed to connect to realtime stream",readyState:this.eventSource?.readyState}),this.notifyListeners("state-change",{state:this.connectionState}),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isManualDisconnect||this.reconnect())}}catch(e){console.error("[RealtimeService] Error creating EventSource:",e),this.connectionState="error",this.notifyListeners("error",{error:e,type:"initialization"}),this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()}}reconnect(){if(this.isManualDisconnect)return;if(this.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("[RealtimeService] Max reconnect attempts reached"),this.notifyListeners("max-reconnect-attempts",{attempts:this.reconnectAttempts});return}this.reconnectAttempts++;const e=Math.min(this.options.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.options.reconnectInterval);console.log(`[RealtimeService] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},e)}disconnect(){this.isManualDisconnect=!0,this.connectionState="disconnected",this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.notifyListeners("disconnected",{timestamp:new Date().toISOString()}),this.notifyListeners("state-change",{state:this.connectionState})}on(e,s){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(s)}off(e,s){if(this.listeners.has(e)){const t=this.listeners.get(e),r=t.indexOf(s);r>-1&&t.splice(r,1)}}notifyListeners(e,s){this.listeners.has(e)&&this.listeners.get(e).forEach(t=>{try{t(s)}catch(r){console.error(`[RealtimeService] Error in listener for ${e}:`,r)}})}getState(){return this.connectionState}isConnected(){return this.connectionState==="connected"}}function Yn(n,e={}){const{autoConnect:s=!1,enableSound:t=!1,onNewLogs:r=null,validateLogs:i=!0}=e,o=new Kn(n,e),l=y("disconnected"),u=y([]),f=y(0),p=y(null),g=y(null),S=y(0),D=C(()=>l.value==="connected"),E=C(()=>l.value==="connecting"),T=C(()=>l.value==="error"),I=C(()=>f.value>0),h=O=>{l.value=O.state,O.state==="connected"&&(S.value=0,g.value=null)},v=O=>{let A=O.logs||[];if(i){A=ht(A);const j=A.filter(fe=>Ee(fe));j.length!==A.length&&console.warn("[useRealtime] Filtered out invalid logs:",A.length-j.length),A=j}A.length!==0&&(u.value.push(...A),f.value+=A.length,p.value=new Date().toISOString(),t&&A.length>0&&z(),r&&r(A))},w=O=>{const A=O.message||O.error?.message||"Connection error";g.value=A,l.value="error",console.error("[useRealtime] Error:",O)},U=O=>{console.warn("[useRealtime] Connection timeout:",O)},R=O=>{g.value=`Max reconnect attempts reached (${O.attempts})`,console.error("[useRealtime] Max reconnect attempts:",O)},k=(O={})=>{g.value=null,O.lastTimestamp!==void 0&&o.updateOptions({lastTimestamp:O.lastTimestamp}),o.on("state-change",h),o.on("new_logs",v),o.on("error",w),o.on("timeout",U),o.on("max-reconnect-attempts",R),o.connect()},_=()=>{o.off("state-change",h),o.off("new_logs",v),o.off("error",w),o.off("timeout",U),o.off("max-reconnect-attempts",R),o.disconnect()},b=()=>{u.value=[],f.value=0},P=O=>{O&&Array.isArray(O)&&(O.unshift(...u.value),b())},z=()=>{try{const O=new Audio("/sounds/notification.mp3");O.volume=.3,O.play().catch(A=>{console.warn("[useRealtime] Failed to play sound:",A)})}catch(O){console.warn("[useRealtime] Sound not available:",O)}};return s&&le(()=>{k()}),Be(()=>{_()}),{connectionState:l,isConnected:D,isConnecting:E,hasError:T,newLogs:u,newLogsCount:f,hasNewLogs:I,lastUpdateTime:p,error:g,reconnectAttempts:S,connect:k,disconnect:_,clearNewLogs:b,applyNewLogs:P}}const Gn=At(()=>ve(()=>import("./WebhookLogsDashboard.vue-D_lecgx-.js"),__vite__mapDeps([7,4,1,5,6,2]),import.meta.url)),Qn=At(()=>ve(()=>import("./WebhookLogDetails.vue-BG8wKvsa.js"),__vite__mapDeps([8,4,1,5,6,2]),import.meta.url)),Zn={name:"WebhookLogsPage",components:{WebhookLogsDashboard:Gn,WebhookLogsExport:Qa,WebhookLogSearch:no,WebhookLogFilters:To,WebhookLogList:Xo,WebhookLogDetails:Qn,SkeletonLogList:sn,EmptyState:mn,ErrorDisplay:wn,NotificationContainer:Pn,RealtimeControls:jn,NewLogsIndicator:Jn},setup(){const n=Ke(),{success:e,error:s}=zt(),t=y(!1),r=y(!1),i=y(null),o=y(null),l=y([]),u=(L,M=2)=>{if(L==null)return String(L);if(typeof L=="string")return L;const $=(V,Z=0)=>{if(Z>10)return"[Max Depth]";if(V==null||typeof V!="object")return V;if(Array.isArray(V))return V.map(me=>$(me,Z+1));const ue={};try{for(const me in V)if(Object.prototype.hasOwnProperty.call(V,me))try{const Ye=V[me];if(typeof Ye=="function"||Ye===void 0)continue;ue[me]=$(Ye,Z+1)}catch{ue[me]="[Error reading property]"}}catch{return"[Error reading object]"}return ue};try{const V=$(L),Z=new WeakSet;return JSON.stringify(V,(ue,me)=>{if(typeof me=="object"&&me!==null){if(Z.has(me))return"[Circular]";Z.add(me)}return me},M)}catch(V){return console.error("[WebhookLogsPage] Error in safeStringify:",V),`[Error: ${V.message}]`}},f=y(null),p=y([]),g=y(""),S=y(null),D=y(null),E=y(!1),{connectionState:T,newLogsCount:I,error:h,connect:v,disconnect:w,applyNewLogs:U,clearNewLogs:R}=Yn(Te("/api/webhook-realtime.php"),{autoConnect:!1,enableSound:!0,validateLogs:!0,onNewLogs:L=>{console.log("[WebhookLogsPage] New logs received:",L.length),L.length>0&&(l.value.unshift(...L),P.value.total+=L.length,e(`–ü–æ–ª—É—á–µ–Ω–æ ${L.length} –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π`))}}),{filters:k,updateFilters:_,clearFilters:b}=da(),P=y({page:1,limit:50,total:0,pages:0}),z=C(()=>{let L=[...l.value];return g.value&&g.value.trim()&&(L=ua(L,g.value,{caseSensitive:!1,searchInEvent:!0,searchInPayload:!0,searchInDetails:!0,searchInIp:!0})),k.value.category&&(L=L.filter(M=>M.category===k.value.category)),k.value.event&&(L=L.filter(M=>M.event===k.value.event)),k.value.ip&&(L=L.filter(M=>M.ip&&M.ip.includes(k.value.ip))),k.value.status&&(L=L.filter(M=>k.value.status==="error"?M.category==="errors":k.value.status==="success"?M.category!=="errors":!0)),k.value.dateFrom&&(L=L.filter(M=>M.timestamp?new Date(M.timestamp).toISOString().split("T")[0]>=k.value.dateFrom:!1)),k.value.dateTo&&(L=L.filter(M=>M.timestamp?new Date(M.timestamp).toISOString().split("T")[0]<=k.value.dateTo:!1)),k.value.hour!==null&&(L=L.filter(M=>M.timestamp?new Date(M.timestamp).getHours()===k.value.hour:!1)),L});ee(z,L=>{S.value&&g.value&&S.value.setResultsCount(L.length)});const O=async()=>{try{await Le.init();const L=await Le.getCurrentUser();if(console.log("[WebhookLogsPage] User data:",L),!L||!L.ID){console.warn("[WebhookLogsPage] User not determined"),o.value=u({error:"User not determined",userId:L?.ID||null,userName:L?`${L.NAME||""} ${L.LAST_NAME||""}`.trim():null}),t.value=!1;return}const M=L?.UF_DEPARTMENT||[];if(console.log("[WebhookLogsPage] User departments:",M),console.log("[WebhookLogsPage] Allowed departments:",je.allowedDepartmentIds),M.length>0){const $=M.some(V=>Ot(V));console.log("[WebhookLogsPage] Has access:",$),t.value=$,$||(o.value=u({userId:L.ID,userName:`${L.NAME||""} ${L.LAST_NAME||""}`.trim(),userDepartments:M,allowedDepartments:je.allowedDepartmentIds,message:"User departments do not match allowed departments"}))}else console.warn("[WebhookLogsPage] User has no departments"),o.value=u({userId:L.ID,userName:`${L.NAME||""} ${L.LAST_NAME||""}`.trim(),userDepartments:[],allowedDepartments:je.allowedDepartmentIds,message:"User has no departments assigned"}),t.value=!1}catch(L){console.error("[WebhookLogsPage] Error checking access:",L),o.value=u({error:L.message,stack:L.stack}),t.value=!1}},A=C(()=>je.allowedDepartmentIds.join(", ")),j=async(L=!1)=>{if(t.value&&!(Y&&!L)){Y=!0,r.value=!0,i.value=null;try{const M=new Date().toISOString().split("T")[0],$={category:k.value.category||null,event:k.value.event||null,date:k.value.dateFrom||M,hour:k.value.hour!==null&&k.value.hour!==void 0?k.value.hour:null,ip:k.value.ip||null,status:k.value.status||null,dateFrom:k.value.dateFrom||M,dateTo:k.value.dateTo||null};if(!ct($))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");console.log("[WebhookLogsPage] Loading logs with filters:",$);const V=await Dt.getLogs($,P.value.page,P.value.limit,L);if(console.log("[WebhookLogsPage] API result:",V),console.log("[WebhookLogsPage] Logs count:",V?.logs?.length||0),console.log("[WebhookLogsPage] Pagination:",V?.pagination),!V.success)throw new Error(V.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤");ma(V.pagination)?P.value=V.pagination:(console.warn("[WebhookLogsPage] Invalid pagination format, using defaults"),P.value={page:P.value.page,limit:P.value.limit,total:V.logs.length,pages:Math.ceil(V.logs.length/P.value.limit)});const Z=ht(V.logs),ue=Z.filter(me=>Ee(me));ue.length!==Z.length&&console.warn("[WebhookLogsPage] Filtered out invalid logs:",Z.length-ue.length),l.value=ue,L&&e("–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")}catch(M){fe(M)}finally{r.value=!1,Y=!1}}},fe=L=>{console.error("[WebhookLogsPage] API Error:",L),L.status===403?(i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",s("–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º –≤–µ–±—Ö—É–∫–æ–≤")):L.status===404?(i.value="–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",s("–õ–æ–≥–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")):L.status>=500?(i.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",s("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")):(i.value=L.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",s(i.value)),L.status>=500&&(l.value=[])},N=L=>{g.value=L,_({search:L||null})};let Y=!1;const F=L=>{if(!ct(L)){s("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");return}const M={category:k.value.category,event:k.value.event,dateFrom:k.value.dateFrom,dateTo:k.value.dateTo,hour:k.value.hour,ip:k.value.ip,status:k.value.status},$={category:L?.category||null,event:L?.event||null,dateFrom:L?.dateFrom||null,dateTo:L?.dateTo||null,hour:L?.hour!==void 0?L.hour:null,ip:L?.ip||null,status:L?.status||null},V=Object.keys($).some(Z=>{const ue=M[Z],me=$[Z];return ue!==me});if(!(!V&&!Y)){if(_($),P.value.page=1,V)try{Dt.invalidateCacheOnFilterChange(M,$)}catch(Z){console.error("[WebhookLogsPage] Error invalidating cache:",Z)}Y||(Y=!0,j(!0).finally(()=>{Y=!1}))}},J=()=>{b(),g.value="",P.value.page=1,j()},te=L=>{f.value=L},ne=()=>{f.value=null},se=L=>{P.value.page=L,j()},ie=()=>{try{n.push("/")}catch(L){console.error("Navigation error:",L),window.location.hash="#/"}},de=L=>{p.value=L},he=L=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—á–∞—Ç:",L)},ot=L=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω:",L),e(`–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω: ${L.count} –∑–∞–ø–∏—Å–µ–π –≤ —Ñ–∞–π–ª–µ ${L.filename}`)},nt=L=>{console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:",L),s(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${L.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`)},_t=()=>{g.value="",J()},bt=L=>{if(console.log("[WebhookLogsPage] Toggle auto-update:",L),E.value=L,L){let M=null;if(l.value.length>0){const $=l.value[0];$.timestamp&&(M=$.timestamp,console.log("[WebhookLogsPage] Using lastTimestamp:",M))}v({lastTimestamp:M})}else w()},wt=()=>{U(l.value),e("–ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")},kt=()=>{R()};return le(async()=>{await O(),t.value&&(k.value.search&&(g.value=k.value.search),await j())}),{hasAccess:t,loading:r,error:i,logs:l,filteredLogs:z,selectedLog:f,selectedLogs:p,filters:k,searchQuery:g,searchComponent:S,pagination:P,previousPeriodStats:D,handleFiltersUpdate:F,handleFiltersReset:J,handleSearch:N,handleLogSelect:te,handleLogClose:ne,handlePageChange:se,handleSelectedLogsUpdate:de,handleExportStart:he,handleExportComplete:ot,handleExportError:nt,handleClearSearch:_t,autoUpdateEnabled:E,connectionState:T,newLogsCount:I,realtimeError:h,handleToggleAutoUpdate:bt,handleApplyNewLogs:wt,handleDismissNewLogs:kt,allowedDepartmentsText:A,accessDebugInfo:o,goBack:ie}}},er={class:"webhook-logs-page"},tr={class:"page-header"},sr={class:"page-header-top"},ar={key:0,class:"access-denied"},or={class:"access-denied-content"},nr={class:"access-hint"},rr={key:0,class:"access-debug"},ir={key:1,class:"page-content"},lr={class:"actions-bar"};function cr(n,e,s,t,r,i){const o=X("WebhookLogsDashboard"),l=X("WebhookLogsExport"),u=X("WebhookLogSearch"),f=X("RealtimeControls"),p=X("NewLogsIndicator"),g=X("WebhookLogFilters"),S=X("SkeletonLogList"),D=X("WebhookLogList"),E=X("EmptyState"),T=X("ErrorDisplay"),I=X("WebhookLogDetails"),h=X("NotificationContainer");return c(),d("div",er,[a("div",tr,[a("div",sr,[a("button",{onClick:e[0]||(e[0]=(...v)=>t.goBack&&t.goBack(...v)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[3]||(e[3]=[a("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),a("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[4]||(e[4]=a("h1",null,"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ Bitrix24",-1))]),t.hasAccess?(c(),d("div",ir,[G(o,{logs:t.logs,pagination:t.pagination,"previous-period-stats":t.previousPeriodStats},null,8,["logs","pagination","previous-period-stats"]),a("div",lr,[G(l,{logs:t.filteredLogs,"selected-logs":t.selectedLogs,filters:t.filters,"total-count":t.filteredLogs.length,onExportStart:t.handleExportStart,onExportComplete:t.handleExportComplete,onExportError:t.handleExportError},null,8,["logs","selected-logs","filters","total-count","onExportStart","onExportComplete","onExportError"]),G(u,{modelValue:t.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=v=>t.searchQuery=v),onSearch:t.handleSearch,ref:"searchComponent"},null,8,["modelValue","onSearch"])]),G(f,{enabled:t.autoUpdateEnabled,"connection-state":t.connectionState,error:t.realtimeError,onToggle:t.handleToggleAutoUpdate},null,8,["enabled","connection-state","error","onToggle"]),G(p,{count:t.newLogsCount,onApply:t.handleApplyNewLogs,onDismiss:t.handleDismissNewLogs},null,8,["count","onApply","onDismiss"]),G(g,{filters:t.filters,"onUpdate:filters":t.handleFiltersUpdate,onReset:t.handleFiltersReset},null,8,["filters","onUpdate:filters","onReset"]),G(Ie,{name:"fade"},{default:_e(()=>[t.loading&&t.logs.length===0?(c(),oe(S,{key:0,rows:5})):x("",!0)]),_:1}),G(Ie,{name:"fade"},{default:_e(()=>[!t.loading&&t.filteredLogs.length>0?(c(),oe(D,{key:0,logs:t.filteredLogs,loading:!1,error:null,pagination:t.pagination,"selected-logs":t.selectedLogs,onSelectLog:t.handleLogSelect,onPageChange:t.handlePageChange,"onUpdate:selectedLogs":t.handleSelectedLogsUpdate},null,8,["logs","pagination","selected-logs","onSelectLog","onPageChange","onUpdate:selectedLogs"])):x("",!0)]),_:1}),G(Ie,{name:"fade"},{default:_e(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length===0?(c(),oe(E,{key:0,icon:"üì≠",title:"–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",description:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Bitrix24.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è","–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",onAction:t.handleFiltersReset},null,8,["onAction"])):x("",!0)]),_:1}),G(Ie,{name:"fade"},{default:_e(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length>0?(c(),oe(E,{key:0,icon:"üîç",title:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",description:"–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã","–û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",onAction:t.handleClearSearch},null,8,["onAction"])):x("",!0)]),_:1}),G(Ie,{name:"fade"},{default:_e(()=>[t.error?(c(),oe(T,{key:0,title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤",message:t.error,retryable:!0,onRetry:n.loadLogs},null,8,["message","onRetry"])):x("",!0)]),_:1}),t.selectedLog?(c(),d("div",{key:0,class:"modal-overlay",onClick:e[2]||(e[2]=(...v)=>t.handleLogClose&&t.handleLogClose(...v))})):x("",!0),G(Ie,{name:"modal"},{default:_e(()=>[t.selectedLog?(c(),oe(I,{key:0,log:t.selectedLog,onClose:t.handleLogClose},null,8,["log","onClose"])):x("",!0)]),_:1})])):(c(),d("div",ar,[a("div",or,[e[7]||(e[7]=a("h2",null,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",-1)),e[8]||(e[8]=a("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤.",-1)),a("p",nr,[e[5]||(e[5]=Q(" –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ –æ—Ç–¥–µ–ª–æ–≤: ",-1)),a("strong",null,m(t.allowedDepartmentsText),1)]),e[9]||(e[9]=a("p",{class:"access-hint"}," –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã. ",-1)),t.accessDebugInfo?(c(),d("details",rr,[e[6]||(e[6]=a("summary",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",-1)),a("pre",null,m(t.accessDebugInfo),1)])):x("",!0)])])),G(h)])}const dr=K(Zn,[["render",cr],["__scopeId","data-v-628bf174"]]);class Ne{static analyzeUsagePatterns(e){return!Array.isArray(e)||e.length===0?this.getEmptyPatterns():{peakHours:this.calculatePeakHours(e),sessionDuration:this.calculateAverageSession(e),userRetention:this.calculateRetention(e),popularPaths:this.findPopularPaths(e),deviceBreakdown:this.analyzeDevices(e),browserStats:this.analyzeBrowsers(e)}}static groupActivity(e,s){if(!Array.isArray(e))return[];const t=new Map;e.forEach(i=>{let o;switch(s){case"hour":o=i.timestamp?new Date(i.timestamp).getHours():"unknown";break;case"day":o=i.timestamp?new Date(i.timestamp).toISOString().split("T")[0]:"unknown";break;case"week":const l=i.timestamp?new Date(i.timestamp):new Date;o=new Date(l.setDate(l.getDate()-l.getDay())).toISOString().split("T")[0];break;case"month":o=i.timestamp?new Date(i.timestamp).toISOString().substring(0,7):"unknown";break;case"user":o=i.user_id||"unknown";break;case"page":o=i.route_path||i.route_title||i.route_name||"unknown";break;case"session":o=this.calculateSessionId(i);break;default:o="all"}t.has(o)||t.set(o,{key:o,entries:[],count:0,metadata:this.getGroupMetadata(o,s)}),t.get(o).entries.push(i),t.get(o).count++});const r=Array.from(t.values());return this.sortGroups(r,s)}static calculateDashboardMetrics(e,s=[]){const t=this.calculateMetrics(e),r=s.length>0?this.calculateMetrics(s):{},i={};return Object.keys(t).forEach(o=>{const l=t[o],u=r[o]||0;i[o]={value:l,previousValue:u,change:l-u,changePercent:u>0?(l-u)/u*100:0,trend:l>u?"up":l<u?"down":"neutral"}}),i}static analyzeUserSessions(e){if(!Array.isArray(e)||e.length===0)return[];const s=[...e].sort((o,l)=>new Date(o.timestamp)-new Date(l.timestamp)),t=[];let r=null;const i=30*60*1e3;return s.forEach(o=>{if(!o||typeof o!="object"||!o.timestamp)return;const l=new Date(o.timestamp).getTime();(!r||l-r.endTime>i)&&(r={id:`session_${t.length+1}`,startTime:l,endTime:l,entries:[],duration:0,pages:new Set,device:o.user_agent,actions:new Map},t.push(r)),r.entries.push(o),r.endTime=l,o.route_path&&r.pages.add(o.route_path);const u=o.type||"unknown";r.actions.set(u,(r.actions.get(u)||0)+1)}),t.forEach(o=>{o.duration=o.endTime-o.startTime,o.pageCount=o.pages.size,o.entriesCount=o.entries.length,o.actions=Object.fromEntries(o.actions)}),t}static calculateUserStats(e){if(!Array.isArray(e)||e.length===0)return this.getEmptyUserStats();const s=this.analyzeUserSessions(e),t=s.reduce((o,l)=>o+l.duration,0),r=this.groupActivity(e,"day"),i=this.findFavoritePages(e);return{total_actions:e.length,total_sessions:s.length,avg_session_duration:s.length>0?t/s.length:0,total_duration:t,favorite_page:i[0]?.page||null,peak_hour:this.calculateUserPeakHour(e),device_preference:this.calculateDevicePreference(e),activity_by_day:r.map(o=>({date:o.key,count:o.count,sessions:this.analyzeUserSessions(o.entries).length})),retention_days:this.calculateUserRetention(e)}}static calculatePeakHours(e){const s=new Array(24).fill(0);return e.forEach(t=>{if(t.timestamp){const r=new Date(t.timestamp).getHours();s[r]++}}),s.map((t,r)=>({hour:r,count:t}))}static calculateAverageSession(e){const s=this.analyzeUserSessions(e);return s.length===0?0:s.reduce((r,i)=>r+i.duration,0)/s.length}static calculateRetention(e){if(e.length===0)return{"1d":0,"7d":0,"30d":0};const s=new Map,t=new Map;e.forEach(u=>{const f=u.user_id,p=new Date(u.timestamp).getTime();(!s.has(f)||p<s.get(f))&&s.set(f,p),(!t.has(f)||p>t.get(f))&&t.set(f,p)});let r=0,i=0,o=0;const l=s.size;return t.forEach((u,f)=>{const p=s.get(f),g=(u-p)/(1e3*60*60*24);g>=1&&r++,g>=7&&i++,g>=30&&o++}),{"1d":l>0?r/l*100:0,"7d":l>0?i/l*100:0,"30d":l>0?o/l*100:0}}static findPopularPaths(e){if(!Array.isArray(e))return new Map;const s=new Map;return e.filter(t=>t&&t.type==="page_visit").forEach(t=>{const r=t.route_path||t.route_name||"unknown";s.set(r,(s.get(r)||0)+1)}),Array.from(s.entries()).sort((t,r)=>r[1]-t[1]).slice(0,10).map(([t,r])=>({path:t,count:r}))}static analyzeDevices(e){const s={desktop:0,mobile:0,tablet:0,unknown:0};return e.forEach(t=>{const r=this.detectDevice(t.user_agent);s[r]++}),s}static analyzeBrowsers(e){const s=new Map;return e.forEach(t=>{const r=this.detectBrowser(t.user_agent);s.set(r,(s.get(r)||0)+1)}),Object.fromEntries(s)}static detectDevice(e){if(!e)return"unknown";const s=e.toLowerCase();return s.includes("mobile")||s.includes("android")||s.includes("iphone")?"mobile":s.includes("tablet")||s.includes("ipad")?"tablet":"desktop"}static detectBrowser(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const s=e.toLowerCase();return s.includes("chrome")&&!s.includes("edg")?"Chrome":s.includes("firefox")?"Firefox":s.includes("safari")&&!s.includes("chrome")?"Safari":s.includes("edg")?"Edge":s.includes("opera")?"Opera":"–î—Ä—É–≥–æ–µ"}static calculateSessionId(e){const s=e.user_id||"unknown",t=e.timestamp?new Date(e.timestamp).toISOString().split("T")[0]:"unknown";return`${s}_${t}`}static getGroupMetadata(e,s){switch(s){case"hour":return{label:`${e}:00`,type:"hour"};case"day":return{label:this.formatDate(e),type:"day"};case"week":return{label:`–ù–µ–¥–µ–ª—è ${e}`,type:"week"};case"month":return{label:this.formatMonth(e),type:"month"};case"user":return{label:`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${e}`,type:"user"};case"page":return{label:e,type:"page"};case"session":return{label:`–°–µ—Å—Å–∏—è ${e}`,type:"session"};default:return{label:e,type:"unknown"}}}static sortGroups(e,s){return e.sort((t,r)=>["day","week","month"].includes(s)?new Date(r.key)-new Date(t.key):r.count-t.count)}static calculateMetrics(e){return Array.isArray(e)?{total_entries:e.length,unique_users:new Set(e.map(t=>t.user_id).filter(t=>t)).size,total_app_entries:e.filter(t=>t.type==="app_entry").length,total_page_visits:e.filter(t=>t.type==="page_visit").length,total_sessions:this.analyzeUserSessions(e).length}:this.getEmptyMetrics()}static findFavoritePages(e){if(!Array.isArray(e))return[];const s=new Map;return e.filter(t=>t&&t.type==="page_visit").forEach(t=>{const r=t.route_path||t.route_title||t.route_name||"unknown";s.set(r,(s.get(r)||0)+1)}),Array.from(s.entries()).sort((t,r)=>r[1]-t[1]).map(([t,r])=>({page:t,count:r}))}static calculateUserPeakHour(e){const s=new Array(24).fill(0);e.forEach(r=>{if(r.timestamp){const i=new Date(r.timestamp).getHours();s[i]++}});const t=Math.max(...s);return t>0?s.indexOf(t):0}static calculateDevicePreference(e){const s={desktop:0,mobile:0,tablet:0};e.forEach(r=>{const i=this.detectDevice(r.user_agent);s.hasOwnProperty(i)&&s[i]++});const t=Object.keys(s).reduce((r,i)=>s[r]>s[i]?r:i);return s[t]>0?t:"unknown"}static calculateUserRetention(e){if(e.length===0)return 0;const s=e.map(o=>new Date(o.timestamp).getTime()).sort((o,l)=>o-l),t=s[0],i=(s[s.length-1]-t)/(1e3*60*60*24);return Math.max(0,Math.floor(i))}static formatDate(e){try{return new Date(e).toLocaleDateString("ru-RU")}catch{return e}}static formatMonth(e){try{const[s,t]=e.split("-");return new Date(s,t-1,1).toLocaleDateString("ru-RU",{year:"numeric",month:"long"})}catch{return e}}static getEmptyPatterns(){return{peakHours:new Array(24).fill(0).map((e,s)=>({hour:s,count:0})),sessionDuration:0,userRetention:{"1d":0,"7d":0,"30d":0},popularPaths:[],deviceBreakdown:{desktop:0,mobile:0,tablet:0,unknown:0},browserStats:{}}}static getEmptyMetrics(){return{total_entries:0,unique_users:0,total_app_entries:0,total_page_visits:0,total_sessions:0}}static getEmptyUserStats(){return{total_actions:0,total_sessions:0,avg_session_duration:0,total_duration:0,favorite_page:null,peak_hour:0,device_preference:"unknown",activity_by_day:[],retention_days:0}}}const Je=new Map,ur=5*60*1e3;class Fe{static validateAndCleanActivityData(e){return Array.isArray(e)?e.filter(s=>{if(!s||typeof s!="object"||s===null)return console.warn("[UserActivityService] Invalid entry: not an object or null",s),!1;if(!s.user_id&&s.user_id!==0)return console.warn("[UserActivityService] Invalid entry: missing user_id",s),!1;if(!s.timestamp)return console.warn("[UserActivityService] Invalid entry: missing timestamp",s),!1;try{const t=new Date(s.timestamp);if(isNaN(t.getTime()))return console.warn("[UserActivityService] Invalid entry: invalid timestamp",s.timestamp),!1}catch(t){return console.warn("[UserActivityService] Invalid entry: timestamp parse error",s.timestamp,t),!1}return!0}).map(s=>{try{return{...s,user_id:Number(s.user_id)||0,timestamp:s.timestamp,type:s.type||"unknown",route_path:s.route_path||null,route_title:s.route_title||null,route_name:s.route_name||null,user_name:s.user_name||null,user_agent:s.user_agent||null}}catch(t){return console.warn("[UserActivityService] Error normalizing entry:",s,t),null}}).filter(s=>s!==null):(console.warn("[UserActivityService] Invalid data format: not an array"),[])}static createCacheKey(e){return JSON.stringify({userId:e.userId,dateFrom:e.dateFrom,dateTo:e.dateTo,type:e.type,limit:e.limit})}static clearCache(){Je.clear()}static async getActivity(e={}){const{userId:s=null,dateFrom:t=null,dateTo:r=null,type:i=null,limit:o=1e3,useCache:l=!0}=e,u=this.createCacheKey({userId:s,dateFrom:t,dateTo:r,type:i,limit:o});if(l&&Je.has(u)){const p=Je.get(u);if(Date.now()-p.timestamp<ur)return p.data;Je.delete(u)}const f=new URLSearchParams;s&&f.append("user_id",s),t&&f.append("date_from",t),r&&f.append("date_to",r),i&&f.append("type",i),o&&f.append("limit",o);try{const p=Te("/api/user-activity-get.php"),g=await fetch(`${p}?${f.toString()}`);if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);const S=await g.json();if(S.success){let D=S.data||[];return D=D.filter(E=>E!=null),D=this.validateAndCleanActivityData(D),D=D.filter(E=>E&&typeof E=="object"&&E.user_id&&E.timestamp&&typeof E.type=="string"&&E.type.trim()!==""),l&&Je.set(u,{data:D,timestamp:Date.now()}),D}else throw new Error(S.error||"Failed to get activity")}catch(p){throw console.error("[UserActivityService] Error getting activity:",p),p}}static async getActivityStats(e={}){const s=await this.getActivity(e),t={total_entries:s.length,total_app_entries:0,total_page_visits:0,unique_users:new Set,pages_visited:{},activity_by_date:{},activity_by_hour:{}};return s.forEach(r=>{if(!(!r||typeof r!="object")){if(r.type==="app_entry")t.total_app_entries++,r.user_id&&t.unique_users.add(r.user_id);else if(r.type==="page_visit"){t.total_page_visits++;const i=r.route_title||r.route_path||r.route_name||"unknown";t.pages_visited[i]=(t.pages_visited[i]||0)+1}if(r.timestamp)try{const i=new Date(r.timestamp).toISOString().split("T")[0];t.activity_by_date[i]=(t.activity_by_date[i]||0)+1;const o=new Date(r.timestamp).getHours();t.activity_by_hour[o]=(t.activity_by_hour[o]||0)+1}catch{console.warn("[UserActivityService] Invalid timestamp:",r.timestamp)}}}),t.unique_users_count=t.unique_users.size,t.unique_users=Array.from(t.unique_users),t}static async getUserActivity(e,s={}){return await this.getActivity({...s,userId:e})}static async getDashboardMetrics(e={}){try{const s=await this.getActivity({...e,limit:1e4}),t=this.getPreviousPeriodFilters(e),r=await this.getActivity({...t,limit:1e4});return Ne.calculateDashboardMetrics(s,r)}catch(s){throw console.error("[UserActivityService] Error getting dashboard metrics:",s),s}}static async getUserProfileAnalytics(e,s={}){try{const t=await this.getUserInfo(e),r=await this.getUserActivity(e,s),i=Ne.calculateUserStats(r),o=Ne.analyzeUserSessions(r);return{user:t,activity:r,analytics:i,sessions:o}}catch(t){throw console.error("[UserActivityService] Error getting user profile analytics:",t),t}}static async getUserInfo(e){return{id:e,name:`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${e}`,email:`user${e}@example.com`,departments:["–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª"],first_visit:null,last_visit:null}}static getPreviousPeriodFilters(e){const s={...e};if(s.dateFrom&&s.dateTo){const t=new Date(s.dateFrom),i=new Date(s.dateTo)-t,o=new Date(t.getTime()-i),l=new Date(t.getTime()-1);s.dateFrom=o.toISOString().split("T")[0],s.dateTo=l.toISOString().split("T")[0]}else{const t=new Date,r=new Date(t.getTime()-7*24*60*60*1e3),i=new Date(t.getTime()-14*24*60*60*1e3);s.dateFrom=i.toISOString().split("T")[0],s.dateTo=r.toISOString().split("T")[0]}return s}static exportData(e,s="json"){switch(s){case"csv":return this.exportToCSV(e);case"json":default:return JSON.stringify(e,null,2)}}static exportToCSV(e){if(!e||e.length===0)return"";const s=["timestamp","user_id","user_name","type","route_path","route_title","user_agent"];return[s.join(","),...e.map(r=>s.map(i=>{const o=r[i]||"";return`"${String(o).replace(/"/g,'""')}"`}).join(","))].join(`
`)}}const at="hidden_users_list";function We(){try{const n=localStorage.getItem(at);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e.map(s=>Number(s)):[]}catch(n){return console.error("[HiddenUsersManager] Error reading hidden users:",n),[]}}function mr(n){const e=We(),s=Number(n);if(!e.includes(s)){e.push(s);try{localStorage.setItem(at,JSON.stringify(e))}catch(t){console.error("[HiddenUsersManager] Error saving hidden users:",t)}}}function gr(n){const e=We(),s=Number(n),t=e.filter(r=>r!==s);if(t.length!==e.length)try{localStorage.setItem(at,JSON.stringify(t))}catch(r){console.error("[HiddenUsersManager] Error saving hidden users:",r)}}function fr(){try{localStorage.removeItem(at)}catch(n){console.error("[HiddenUsersManager] Error clearing hidden users:",n)}}function hr(n){const e=new Map;return n.forEach(s=>{if(s.user_id){const t=Number(s.user_id);e.has(t)||e.set(t,{id:t,name:s.user_name||`User #${t}`,count:0}),e.get(t).count++}}),Array.from(e.values()).sort((s,t)=>t.count-s.count)}function $t(n){const e=We();return e.length===0?n:n.filter(s=>s.user_id?!e.includes(Number(s.user_id)):!0)}const vr={name:"UserActivityCard",props:{entry:{type:Object,required:!0,validator:n=>n&&typeof n=="object"&&n!==null&&n.user_id&&n.timestamp&&typeof n.type=="string"}},computed:{isValidEntry(){return this.entry&&typeof this.entry=="object"&&this.entry!==null&&this.entry.user_id&&this.entry.timestamp&&typeof this.entry.type=="string"&&this.entry.type.trim()!==""},safeEntry(){return this.isValidEntry?{...this.entry,user_id:this.entry.user_id||"unknown",user_name:this.entry.user_name||`User #${this.entry.user_id}`,timestamp:this.entry.timestamp||new Date().toISOString(),type:this.entry.type||"unknown",route_title:this.entry.route_title||null,route_path:this.entry.route_path||null,route_name:this.entry.route_name||null,from_path:this.entry.from_path||null,from_name:this.entry.from_name||null}:{user_id:"unknown",user_name:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",timestamp:new Date().toISOString(),type:"unknown",route_title:null,route_path:null,route_name:null,from_path:null,from_name:null}},cardClass(){return this.isValidEntry?{"activity-entry":this.safeEntry.type==="app_entry","activity-visit":this.safeEntry.type==="page_visit"}:{}}},methods:{formatTime(n){if(!n)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{const e=new Date(n);return isNaN(e.getTime())?"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ":e.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}}}},pr={class:"activity-icon"},yr={key:0},_r={key:1},br={key:2},wr={class:"activity-content"},kr={class:"activity-header"},Cr={class:"user-name"},Sr={class:"activity-time"},Dr={class:"activity-details"},Tr={key:0,class:"activity-type"},xr={key:1,class:"activity-type"},Ar={key:2,class:"activity-type"},Er={key:0,class:"activity-from"},Mr={key:1,class:"user-activity-card error-card"};function Ir(n,e,s,t,r,i){return i.isValidEntry?(c(),d("div",{key:0,class:B(["user-activity-card",i.cardClass])},[a("div",pr,[i.safeEntry.type==="app_entry"?(c(),d("span",yr,"üö™")):i.safeEntry.type==="page_visit"?(c(),d("span",_r,"üìÑ")):(c(),d("span",br,"‚ùì"))]),a("div",wr,[a("div",kr,[a("span",Cr,m(i.safeEntry.user_name||`User #${i.safeEntry.user_id}`),1),a("span",Sr,m(i.formatTime(i.safeEntry.timestamp)),1)]),a("div",Dr,[i.safeEntry.type==="app_entry"?(c(),d("span",Tr," –û—Ç–∫—Ä—ã–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ")):i.safeEntry.type==="page_visit"?(c(),d("span",xr," –û—Ç–∫—Ä—ã–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É: "+m(i.safeEntry.route_title||i.safeEntry.route_path||i.safeEntry.route_name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"),1)):(c(),d("span",Ar," –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ "))]),i.safeEntry.type==="page_visit"&&i.safeEntry.from_path?(c(),d("div",Er," –°: "+m(i.safeEntry.from_name||i.safeEntry.from_path),1)):x("",!0)])],2)):(c(),d("div",Mr,[...e[0]||(e[0]=[a("div",{class:"activity-icon"},"‚ö†Ô∏è",-1),a("div",{class:"activity-content"},[a("div",{class:"activity-details"},[a("span",{class:"activity-type error"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö")])],-1)])]))}const Lr=K(vr,[["render",Ir],["__scopeId","data-v-cd4e1fda"]]),Pr={name:"HiddenUsersManager",props:{filters:{type:Object,default:()=>({})}},emits:["hidden-users-changed"],setup(n,{emit:e}){const s=y(!1),t=y(null),r=y([]),i=y([]),o=C(()=>hr(r.value)),l=C(()=>{const g=We();return o.value.filter(S=>g.includes(S.id))}),u=async()=>{s.value=!0,t.value=null;try{const g={...n.filters,limit:1e3};r.value=await Fe.getActivity(g);const S=We();i.value=S.filter(D=>o.value.some(E=>E.id===D))}catch(g){t.value=g.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",console.error("[HiddenUsersManager] Error loading activity:",g)}finally{s.value=!1}},f=()=>{const g=We(),S=i.value.map(D=>Number(D));S.forEach(D=>{g.includes(D)||mr(D)}),g.forEach(D=>{S.includes(D)||gr(D)}),e("hidden-users-changed"),window.dispatchEvent(new CustomEvent("hidden-users-changed"))},p=()=>{fr(),i.value=[],e("hidden-users-changed"),window.dispatchEvent(new CustomEvent("hidden-users-changed"))};return le(()=>{u()}),ee(()=>n.filters,()=>{u()},{deep:!0}),ee(()=>l.value,g=>{i.value=g.map(S=>S.id)},{deep:!0}),{loading:s,error:t,availableUsers:o,hiddenUsers:l,selectedUsers:i,applySelection:f,showAll:p}}},Fr={class:"hidden-users-manager"},Ur={class:"manager-controls"},Rr={class:"dropdown-wrapper"},Nr=["disabled"],Or=["value"],Br={key:0,class:"empty-hint"},Vr={class:"actions"},jr=["disabled"],zr=["disabled"],$r={key:0,class:"loading"},Wr={key:1,class:"error"};function qr(n,e,s,t,r,i){return c(),d("div",Fr,[a("div",Ur,[a("div",Rr,[e[3]||(e[3]=a("label",{class:"dropdown-label"}," üëÅÔ∏è –°–∫—Ä—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ",-1)),H(a("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.selectedUsers=o),multiple:"",class:"users-dropdown",disabled:t.loading||t.availableUsers.length===0,size:"5"},[(c(!0),d(W,null,q(t.availableUsers,o=>(c(),d("option",{key:o.id,value:o.id},m(o.name)+" ("+m(o.count)+" "+m(o.count===1?"–∑–∞–ø–∏—Å—å":"–∑–∞–ø–∏—Å–µ–π")+") ",9,Or))),128))],8,Nr),[[re,t.selectedUsers]]),t.availableUsers.length===0&&!t.loading?(c(),d("div",Br," –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∑–∞–ø–∏—Å—è—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ")):x("",!0)]),a("div",Vr,[a("button",{onClick:e[1]||(e[1]=(...o)=>t.applySelection&&t.applySelection(...o)),class:"apply-btn",disabled:t.loading,title:"–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å ",8,jr),t.hiddenUsers.length>0?(c(),d("button",{key:0,onClick:e[2]||(e[2]=(...o)=>t.showAll&&t.showAll(...o)),class:"show-all-btn",disabled:t.loading,title:"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"}," –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö ("+m(t.hiddenUsers.length)+") ",9,zr)):x("",!0)])]),t.loading?(c(),d("div",$r," –ó–∞–≥—Ä—É–∑–∫–∞... ")):x("",!0),t.error?(c(),d("div",Wr,m(t.error),1)):x("",!0)])}const Wt=K(Pr,[["render",qr],["__scopeId","data-v-4fdc2eaa"]]),Hr={name:"UserActivityFilters",props:{filters:{type:Object,default:()=>({})},users:{type:Array,default:()=>[]}},emits:["update-filters"],setup(n,{emit:e}){const s=y({userId:n.filters.userId||null,type:n.filters.type||null,dateFrom:n.filters.dateFrom||null,dateTo:n.filters.dateTo||null}),t=()=>{e("update-filters",{...s.value})},r=()=>{s.value={userId:null,type:null,dateFrom:null,dateTo:null},t()},i=o=>{const l=o.NAME||"",u=o.LAST_NAME||"";return`${l} ${u}`.trim()||o.EMAIL||`User #${o.ID}`};return ee(()=>n.filters,o=>{s.value={...o}},{deep:!0}),{localFilters:s,updateFilters:t,resetFilters:r,getUserName:i}}},Xr={class:"user-activity-filters"},Jr={class:"filter-group"},Kr=["value"],Yr={class:"filter-group"},Gr={class:"filter-group"},Qr={class:"filter-group"};function Zr(n,e,s,t,r,i){return c(),d("div",Xr,[a("div",Jr,[e[10]||(e[10]=a("label",null,"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:",-1)),H(a("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.localFilters.userId=o),onChange:e[1]||(e[1]=(...o)=>t.updateFilters&&t.updateFilters(...o))},[e[9]||(e[9]=a("option",{value:null},"–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",-1)),(c(!0),d(W,null,q(s.users,o=>(c(),d("option",{key:o.ID,value:o.ID},m(t.getUserName(o)),9,Kr))),128))],544),[[re,t.localFilters.userId]])]),a("div",Yr,[e[12]||(e[12]=a("label",null,"–¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:",-1)),H(a("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.localFilters.type=o),onChange:e[3]||(e[3]=(...o)=>t.updateFilters&&t.updateFilters(...o))},[...e[11]||(e[11]=[a("option",{value:null},"–í—Å–µ —Ç–∏–ø—ã",-1),a("option",{value:"app_entry"},"–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1),a("option",{value:"page_visit"},"–ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",-1)])],544),[[re,t.localFilters.type]])]),a("div",Gr,[e[13]||(e[13]=a("label",null,"–î–∞—Ç–∞ –æ—Ç:",-1)),H(a("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=o=>t.localFilters.dateFrom=o),onChange:e[5]||(e[5]=(...o)=>t.updateFilters&&t.updateFilters(...o))},null,544),[[we,t.localFilters.dateFrom]])]),a("div",Qr,[e[14]||(e[14]=a("label",null,"–î–∞—Ç–∞ –¥–æ:",-1)),H(a("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=o=>t.localFilters.dateTo=o),onChange:e[7]||(e[7]=(...o)=>t.updateFilters&&t.updateFilters(...o))},null,544),[[we,t.localFilters.dateTo]])]),a("button",{onClick:e[8]||(e[8]=(...o)=>t.resetFilters&&t.resetFilters(...o)),class:"btn-reset"},"–°–±—Ä–æ—Å–∏—Ç—å")])}const qt=K(Hr,[["render",Zr],["__scopeId","data-v-f4c5efa9"]]),ei={name:"UserActivityStats",props:{filters:{type:Object,default:()=>({})}},setup(n){const e=y({total_entries:0,unique_users_count:0,total_app_entries:0,total_page_visits:0,pages_visited:{}}),s=y(!1),t=y(null),r=C(()=>e.value),i=async()=>{s.value=!0,t.value=null;try{const u=await Fe.getActivity({...n.filters,limit:1e4}),f=$t(u);e.value=await Fe.getActivityStats({...n.filters});const p={total_entries:f.length,unique_users_count:new Set(f.filter(g=>g&&g.user_id).map(g=>g.user_id)).size,total_app_entries:f.filter(g=>g&&g.type==="app_entry").length,total_page_visits:f.filter(g=>g&&g.type==="page_visit").length,pages_visited:{}};f.filter(g=>g&&g.type==="page_visit"&&g.route_path).forEach(g=>{const S=g.route_title||g.route_path||g.route_name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞";p.pages_visited[S]=(p.pages_visited[S]||0)+1}),e.value=p}catch(u){t.value=u.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏",console.error("[UserActivityStats] Error loading stats:",u)}finally{s.value=!1}},o=C(()=>{const u=r.value.pages_visited||{};return Object.entries(u).sort((f,p)=>p[1]-f[1]).slice(0,10).reduce((f,[p,g])=>(f[p]=g,f),{})}),l=()=>{i()};return le(()=>{i(),window.addEventListener("hidden-users-changed",l)}),Be(()=>{window.removeEventListener("hidden-users-changed",l)}),ee(()=>n.filters,()=>{i()},{deep:!0}),{stats:r,loading:s,error:t,sortedPages:o}}},ti={class:"user-activity-stats"},si={key:0,class:"loading"},ai={key:1,class:"error"},oi={key:2},ni={class:"stats-grid"},ri={class:"stat-card"},ii={class:"stat-value"},li={class:"stat-card"},ci={class:"stat-value"},di={class:"stat-card"},ui={class:"stat-value"},mi={class:"stat-card"},gi={class:"stat-value"},fi={key:0,class:"pages-stats"};function hi(n,e,s,t,r,i){return c(),d("div",ti,[t.loading?(c(),d("div",si," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏... ")):t.error?(c(),d("div",ai,m(t.error),1)):(c(),d("div",oi,[a("div",ni,[a("div",ri,[a("div",ii,m(t.stats.total_entries),1),e[0]||(e[0]=a("div",{class:"stat-label"},"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",-1))]),a("div",li,[a("div",ci,m(t.stats.unique_users_count),1),e[1]||(e[1]=a("div",{class:"stat-label"},"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1))]),a("div",di,[a("div",ui,m(t.stats.total_app_entries),1),e[2]||(e[2]=a("div",{class:"stat-label"},"–û—Ç–∫—Ä—ã—Ç–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1))]),a("div",mi,[a("div",gi,m(t.stats.total_page_visits),1),e[3]||(e[3]=a("div",{class:"stat-label"},"–ü–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",-1))])]),Object.keys(t.stats.pages_visited).length>0?(c(),d("div",fi,[e[5]||(e[5]=a("h3",null,"–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:",-1)),a("ul",null,[(c(!0),d(W,null,q(t.sortedPages,(o,l)=>(c(),d("li",{key:l},[Q(m(l)+": ",1),a("strong",null,m(o),1),e[4]||(e[4]=Q(" –ø–æ—Å–µ—â–µ–Ω–∏–π ",-1))]))),128))])])):x("",!0)]))])}const Ht=K(ei,[["render",hi],["__scopeId","data-v-5b235ed4"]]),vi={name:"MetricCard",props:{metric:{type:Object,required:!0,validator:n=>n.id&&n.title&&typeof n.value<"u"},interactive:{type:Boolean,default:!0},showTrend:{type:Boolean,default:!0},showComparison:{type:Boolean,default:!1},drillDown:{type:Boolean,default:!1}},emits:["click","drill-down"],computed:{title(){return this.metric.title||""},value(){return this.metric.value||0},previousValue(){return this.metric.previousValue},change(){return this.metric.change||0},changePercent(){return this.metric.changePercent||0},trend(){return this.metric.trend||"neutral"},icon(){return this.metric.icon||"üìä"},color(){return this.metric.color||"#2196F3"},drillDownRoute(){return this.metric.drillDownRoute},subtitle(){return this.metric.subtitle},formattedValue(){return this.formatValue(this.value)},formattedPreviousValue(){return this.formatValue(this.previousValue)},formattedChange(){const n=Math.abs(this.change),e=Math.abs(this.changePercent);return e!==0?`${this.change>=0?"+":"-"}${e.toFixed(1)}%`:n!==0?this.formatValue(n,!0):""},formattedChangePercent(){return`${this.changePercent>=0?"+":""}${this.changePercent.toFixed(1)}%`},trendClass(){return{"trend-up":this.trend==="up","trend-down":this.trend==="down","trend-neutral":this.trend==="neutral",interactive:this.interactive,"has-drill-down":this.drillDown}},trendIcon(){switch(this.trend){case"up":return"üìà";case"down":return"üìâ";default:return"‚û°Ô∏è"}}},methods:{formatValue(n,e=!1){return n==null?"0":typeof n=="string"&&(n.includes("–º")||n.includes("—Å")||n.includes("—á"))?n:typeof n=="number"?n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":Number.isInteger(n)?n.toLocaleString("ru-RU"):n.toFixed(1):String(n)},handleClick(){this.interactive&&this.$emit("click",this.metric)},handleDrillDown(){this.$emit("drill-down",this.metric)}}},pi={class:"metric-header"},yi={class:"metric-icon"},_i={key:0,class:"metric-trend"},bi={class:"trend-icon"},wi={class:"trend-value"},ki={class:"metric-content"},Ci={class:"metric-title"},Si={key:0,class:"metric-subtitle"},Di={key:1,class:"metric-comparison"},Ti={class:"comparison-value"},xi={key:0,class:"metric-actions"},Ai={key:1,class:"metric-hover-overlay"},Ei={class:"hover-content"},Mi={key:0,class:"hover-subtitle"};function Ii(n,e,s,t,r,i){return c(),d("div",{class:B(["metric-card",i.trendClass]),onClick:e[1]||(e[1]=(...o)=>i.handleClick&&i.handleClick(...o))},[a("div",pi,[a("div",yi,[a("span",null,m(i.icon),1)]),s.showTrend&&(i.change!==0||i.changePercent!==0)?(c(),d("div",_i,[a("span",bi,m(i.trendIcon),1),a("span",wi,m(i.formattedChange),1)])):x("",!0)]),a("div",ki,[a("div",{class:"metric-value",style:xe({color:i.color})},m(i.formattedValue),5),a("div",Ci,m(i.title),1),i.subtitle?(c(),d("div",Si,m(i.subtitle),1)):x("",!0),s.showComparison&&i.previousValue!==void 0?(c(),d("div",Di,[e[2]||(e[2]=a("span",{class:"comparison-label"},"vs –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–µ—Ä–∏–æ–¥:",-1)),a("span",Ti,m(i.formattedPreviousValue),1)])):x("",!0)]),s.drillDown?(c(),d("div",xi,[a("button",{class:"drill-down-btn",onClick:e[0]||(e[0]=pe((...o)=>i.handleDrillDown&&i.handleDrillDown(...o),["stop"]))}," –ü–æ–¥—Ä–æ–±–Ω–µ–µ ")])):x("",!0),s.interactive?(c(),d("div",Ai,[a("div",Ei,[e[3]||(e[3]=a("div",{class:"hover-title"},"–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π",-1)),i.changePercent!==0?(c(),d("div",Mi," –ò–∑–º–µ–Ω–µ–Ω–∏–µ: "+m(i.formattedChangePercent),1)):x("",!0)])])):x("",!0)],2)}const Li=K(vi,[["render",Ii],["__scopeId","data-v-0e808c5a"]]),Pi={name:"AdvancedFilters",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(n,{emit:e}){const s=y(!1),t=y(!1),r=y(""),i=y("all"),o=y("all"),l=y({timeRange:{type:"preset",preset:"week",custom:{from:null,to:null}},activityTypes:[],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"day",sortBy:"timestamp",sortOrder:"desc"}),u=[{key:"today",name:"–°–µ–≥–æ–¥–Ω—è",description:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ —Å–µ–≥–æ–¥–Ω—è",icon:"üìÖ",filters:{timeRange:{type:"preset",preset:"today"},activityTypes:[],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"hour",sortBy:"timestamp",sortOrder:"desc"}},{key:"active_users",name:"–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",description:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –≤—ã—Å–æ–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é",icon:"üöÄ",filters:{timeRange:{type:"preset",preset:"week"},activityTypes:["app_entry","page_visit"],departments:[],userActivity:"active",devices:[],browsers:[],groupBy:"user",sortBy:"timestamp",sortOrder:"desc"}},{key:"problem_sessions",name:"–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–µ—Å—Å–∏–∏",description:"–ö–æ—Ä–æ—Ç–∫–∏–µ —Å–µ—Å—Å–∏–∏ –∏ —á–∞—Å—Ç—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã",icon:"‚ö†Ô∏è",filters:{timeRange:{type:"preset",preset:"3days"},activityTypes:["app_entry"],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"session",sortBy:"timestamp",sortOrder:"desc"}},{key:"new_traffic",name:"–ù–æ–≤—ã–π —Ç—Ä–∞—Ñ–∏–∫",description:"–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ",icon:"üÜï",filters:{timeRange:{type:"preset",preset:"month"},activityTypes:[],departments:[],userActivity:"new",devices:[],browsers:[],groupBy:"day",sortBy:"timestamp",sortOrder:"desc"}}],f=[{value:"app_entry",label:"–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",icon:"üö™"},{value:"page_visit",label:"–ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",icon:"üìÑ"}],p=[{value:"desktop",label:"–ö–æ–º–ø—å—é—Ç–µ—Ä",icon:"üñ•Ô∏è"},{value:"mobile",label:"–¢–µ–ª–µ—Ñ–æ–Ω",icon:"üì±"},{value:"tablet",label:"–ü–ª–∞–Ω—à–µ—Ç",icon:"üì±"}],g=[{value:"chrome",label:"Chrome",icon:"üåê"},{value:"firefox",label:"Firefox",icon:"ü¶ä"},{value:"safari",label:"Safari",icon:"üß≠"},{value:"edge",label:"Edge",icon:"‚ö°"},{value:"opera",label:"Opera",icon:"üé≠"}],S=[{id:369,name:"–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª"},{id:366,name:"–°–µ–∫—Ç–æ—Ä 1–°"}],D=y([]);ee(()=>n.modelValue,P=>{P&&Object.keys(P).length>0&&(l.value={...P})},{deep:!0,immediate:!0});const E=()=>{try{const P=localStorage.getItem("activity_filter_presets");P&&(D.value=JSON.parse(P))}catch(P){console.error("[AdvancedFilters] Error loading saved filters:",P)}},T=()=>{try{localStorage.setItem("activity_filter_presets",JSON.stringify(D.value))}catch(P){console.error("[AdvancedFilters] Error saving filters:",P)}},I=()=>{l.value.timeRange.type==="preset"&&(l.value.timeRange.preset="week",h())},h=()=>{const P=l.value.timeRange.preset,z=new Date;let O,A;switch(P){case"today":O=new Date(z.getFullYear(),z.getMonth(),z.getDate()),A=new Date(z.getFullYear(),z.getMonth(),z.getDate(),23,59,59);break;case"yesterday":const j=new Date(z);j.setDate(j.getDate()-1),O=new Date(j.getFullYear(),j.getMonth(),j.getDate()),A=new Date(j.getFullYear(),j.getMonth(),j.getDate(),23,59,59);break;case"3days":O=new Date(z),O.setDate(O.getDate()-3),A=z;break;case"week":O=new Date(z),O.setDate(O.getDate()-7),A=z;break;case"month":O=new Date(z),O.setMonth(O.getMonth()-1),A=z;break;case"quarter":O=new Date(z),O.setMonth(O.getMonth()-3),A=z;break;case"year":O=new Date(z),O.setFullYear(O.getFullYear()-1),A=z;break}l.value.timeRange.custom.from=O.toISOString().split("T")[0],l.value.timeRange.custom.to=A.toISOString().split("T")[0]},v=P=>{l.value={...P.filters},s.value=!1,w()},w=()=>{const P={dateFrom:null,dateTo:null,userId:null,type:l.value.activityTypes.length>0?l.value.activityTypes:null,departments:l.value.departments,userActivity:l.value.userActivity,devices:l.value.devices,browsers:l.value.browsers,groupBy:l.value.groupBy,sortBy:l.value.sortBy,sortOrder:l.value.sortOrder};l.value.timeRange.type,l.value.timeRange.custom.from&&(P.dateFrom=l.value.timeRange.custom.from),l.value.timeRange.custom.to&&(P.dateTo=l.value.timeRange.custom.to),e("update:modelValue",P),e("change",P)},U=()=>{l.value={timeRange:{type:"preset",preset:"week",custom:{from:null,to:null}},activityTypes:[],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"day",sortBy:"timestamp",sortOrder:"desc"},i.value="all",o.value="all",w()},R=()=>{if(!r.value.trim())return;const P={id:Date.now().toString(),name:r.value.trim(),filters:{...l.value},createdAt:new Date().toISOString()};D.value.push(P),T(),r.value="",t.value=!1},k=P=>{l.value={...P.filters},w()},_=P=>{D.value=D.value.filter(z=>z.id!==P),T()},b=P=>{try{return new Date(P).toLocaleDateString("ru-RU")}catch{return P}};return E(),{showPresets:s,showSaveDialog:t,saveFilterName:r,localFilters:l,selectedDepartmentMode:i,selectedBrowserMode:o,filterPresets:u,activityTypeOptions:f,deviceOptions:p,browserOptions:g,availableDepartments:S,savedFilters:D,handleTimeRangeTypeChange:I,applyTimePreset:h,applyPreset:v,applyFilters:w,resetFilters:U,saveCurrentFilter:R,loadSavedFilter:k,deleteSavedFilter:_,formatDate:b}}},Fi={class:"advanced-filters"},Ui={class:"filters-header"},Ri={class:"filters-actions"},Ni={key:0,class:"presets-panel"},Oi={class:"presets-grid"},Bi=["onClick"],Vi={class:"preset-icon"},ji={class:"preset-content"},zi={class:"preset-name"},$i={class:"preset-description"},Wi={class:"filters-content"},qi={class:"filter-group time-range"},Hi={class:"time-range-controls"},Xi={key:0,class:"preset-options"},Ji={key:1,class:"custom-range"},Ki={class:"filter-group activity-types"},Yi={class:"checkbox-group"},Gi=["value"],Qi={class:"checkbox-label"},Zi={class:"type-icon"},el={class:"filter-group departments"},tl={class:"departments-controls"},sl={key:0,class:"departments-list"},al={class:"department-checkbox"},ol=["value"],nl={class:"checkbox-label"},rl={class:"filter-group usage-frequency"},il={class:"filter-group devices"},ll={class:"checkbox-group"},cl=["value"],dl={class:"checkbox-label"},ul={class:"device-icon"},ml={class:"filter-group browsers"},gl={class:"browsers-controls"},fl={key:0,class:"browsers-list"},hl={class:"browser-checkbox"},vl=["value"],pl={class:"checkbox-label"},yl={class:"browser-icon"},_l={class:"filter-group grouping"},bl={class:"grouping-controls"},wl={class:"group-by-control"},kl={class:"sort-control"},Cl={class:"saved-filters"},Sl={class:"saved-filters-header"},Dl={key:0,class:"saved-filters-list"},Tl={class:"filter-info"},xl={class:"filter-name"},Al={class:"filter-date"},El={class:"filter-actions"},Ml=["onClick"],Il=["onClick"],Ll={key:1,class:"no-saved-filters"},Pl={class:"dialog-content"},Fl={class:"dialog-actions"},Ul=["disabled"];function Rl(n,e,s,t,r,i){return c(),d("div",Fi,[a("div",Ui,[e[26]||(e[26]=a("h4",{class:"filters-title"},"üîç –§–∏–ª—å—Ç—Ä—ã –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞",-1)),a("div",Ri,[a("button",{onClick:e[0]||(e[0]=o=>t.showPresets=!t.showPresets),class:"presets-btn"}," üìã –®–∞–±–ª–æ–Ω—ã "),a("button",{onClick:e[1]||(e[1]=(...o)=>t.resetFilters&&t.resetFilters(...o)),class:"reset-btn"}," üîÑ –°–±—Ä–æ—Å "),a("button",{onClick:e[2]||(e[2]=(...o)=>t.applyFilters&&t.applyFilters(...o)),class:"apply-btn"}," ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å ")])]),t.showPresets?(c(),d("div",Ni,[a("div",Oi,[(c(!0),d(W,null,q(t.filterPresets,o=>(c(),d("button",{key:o.key,onClick:l=>t.applyPreset(o),class:"preset-btn"},[a("div",Vi,m(o.icon),1),a("div",ji,[a("div",zi,m(o.name),1),a("div",$i,m(o.description),1)])],8,Bi))),128))])])):x("",!0),a("div",Wi,[a("div",qi,[e[30]||(e[30]=a("label",{class:"filter-label"},"üìÖ –í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω",-1)),a("div",Hi,[H(a("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.localFilters.timeRange.type=o),onChange:e[4]||(e[4]=(...o)=>t.handleTimeRangeTypeChange&&t.handleTimeRangeTypeChange(...o)),class:"range-type-select"},[...e[27]||(e[27]=[a("option",{value:"preset"},"–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞",-1),a("option",{value:"custom"},"–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π",-1)])],544),[[re,t.localFilters.timeRange.type]]),t.localFilters.timeRange.type==="preset"?(c(),d("div",Xi,[H(a("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>t.localFilters.timeRange.preset=o),onChange:e[6]||(e[6]=(...o)=>t.applyTimePreset&&t.applyTimePreset(...o)),class:"time-preset-select"},[...e[28]||(e[28]=[tt('<option value="today" data-v-22b9cf1c>–°–µ–≥–æ–¥–Ω—è</option><option value="yesterday" data-v-22b9cf1c>–í—á–µ—Ä–∞</option><option value="3days" data-v-22b9cf1c>3 –¥–Ω—è</option><option value="week" data-v-22b9cf1c>–ù–µ–¥–µ–ª—è</option><option value="month" data-v-22b9cf1c>–ú–µ—Å—è—Ü</option><option value="quarter" data-v-22b9cf1c>–ö–≤–∞—Ä—Ç–∞–ª</option><option value="year" data-v-22b9cf1c>–ì–æ–¥</option>',7)])],544),[[re,t.localFilters.timeRange.preset]])])):(c(),d("div",Ji,[H(a("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=o=>t.localFilters.timeRange.custom.from=o),class:"date-input",placeholder:"–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞"},null,512),[[we,t.localFilters.timeRange.custom.from]]),e[29]||(e[29]=a("span",{class:"date-separator"},"‚Äî",-1)),H(a("input",{type:"date","onUpdate:modelValue":e[8]||(e[8]=o=>t.localFilters.timeRange.custom.to=o),class:"date-input",placeholder:"–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è"},null,512),[[we,t.localFilters.timeRange.custom.to]])]))])]),a("div",Ki,[e[31]||(e[31]=a("label",{class:"filter-label"},"üéØ –¢–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),a("div",Yi,[(c(!0),d(W,null,q(t.activityTypeOptions,o=>(c(),d("label",{key:o.value,class:"checkbox-item"},[H(a("input",{type:"checkbox",value:o.value,"onUpdate:modelValue":e[9]||(e[9]=l=>t.localFilters.activityTypes=l),class:"checkbox-input"},null,8,Gi),[[Ve,t.localFilters.activityTypes]]),a("span",Qi,[a("span",Zi,m(o.icon),1),Q(" "+m(o.label),1)])]))),128))])]),a("div",el,[e[33]||(e[33]=a("label",{class:"filter-label"},"üè¢ –û—Ç–¥–µ–ª—ã",-1)),a("div",tl,[H(a("select",{"onUpdate:modelValue":e[10]||(e[10]=o=>t.selectedDepartmentMode=o),class:"mode-select"},[...e[32]||(e[32]=[a("option",{value:"all"},"–í—Å–µ –æ—Ç–¥–µ–ª—ã",-1),a("option",{value:"specific"},"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –æ—Ç–¥–µ–ª—ã",-1)])],512),[[re,t.selectedDepartmentMode]]),t.selectedDepartmentMode==="specific"?(c(),d("div",sl,[(c(!0),d(W,null,q(t.availableDepartments,o=>(c(),d("div",{class:"department-item",key:o.id},[a("label",al,[H(a("input",{type:"checkbox",value:o.id,"onUpdate:modelValue":e[11]||(e[11]=l=>t.localFilters.departments=l),class:"checkbox-input"},null,8,ol),[[Ve,t.localFilters.departments]]),a("span",nl,m(o.name),1)])]))),128))])):x("",!0)])]),a("div",rl,[e[35]||(e[35]=a("label",{class:"filter-label"},"üìä –ß–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",-1)),H(a("select",{"onUpdate:modelValue":e[12]||(e[12]=o=>t.localFilters.userActivity=o),class:"frequency-select"},[...e[34]||(e[34]=[a("option",{value:"all"},"–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",-1),a("option",{value:"new"},"–ù–æ–≤—ã–µ (–ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –∑–∞ –ø–µ—Ä–∏–æ–¥)",-1),a("option",{value:"active"},"–ê–∫—Ç–∏–≤–Ω—ã–µ (‚â•5 –¥–µ–π—Å—Ç–≤–∏–π)",-1),a("option",{value:"inactive"},"–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ (<5 –¥–µ–π—Å—Ç–≤–∏–π)",-1)])],512),[[re,t.localFilters.userActivity]])]),a("div",il,[e[36]||(e[36]=a("label",{class:"filter-label"},"üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞",-1)),a("div",ll,[(c(!0),d(W,null,q(t.deviceOptions,o=>(c(),d("label",{key:o.value,class:"checkbox-item"},[H(a("input",{type:"checkbox",value:o.value,"onUpdate:modelValue":e[13]||(e[13]=l=>t.localFilters.devices=l),class:"checkbox-input"},null,8,cl),[[Ve,t.localFilters.devices]]),a("span",dl,[a("span",ul,m(o.icon),1),Q(" "+m(o.label),1)])]))),128))])]),a("div",ml,[e[38]||(e[38]=a("label",{class:"filter-label"},"üåê –ë—Ä–∞—É–∑–µ—Ä—ã",-1)),a("div",gl,[H(a("select",{"onUpdate:modelValue":e[14]||(e[14]=o=>t.selectedBrowserMode=o),class:"mode-select"},[...e[37]||(e[37]=[a("option",{value:"all"},"–í—Å–µ –±—Ä–∞—É–∑–µ—Ä—ã",-1),a("option",{value:"specific"},"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã",-1)])],512),[[re,t.selectedBrowserMode]]),t.selectedBrowserMode==="specific"?(c(),d("div",fl,[(c(!0),d(W,null,q(t.browserOptions,o=>(c(),d("div",{class:"browser-item",key:o.value},[a("label",hl,[H(a("input",{type:"checkbox",value:o.value,"onUpdate:modelValue":e[15]||(e[15]=l=>t.localFilters.browsers=l),class:"checkbox-input"},null,8,vl),[[Ve,t.localFilters.browsers]]),a("span",pl,[a("span",yl,m(o.icon),1),Q(" "+m(o.label),1)])])]))),128))])):x("",!0)])]),a("div",_l,[e[44]||(e[44]=a("label",{class:"filter-label"},"üìã –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞",-1)),a("div",bl,[a("div",wl,[e[40]||(e[40]=a("label",{class:"sub-label"},"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ:",-1)),H(a("select",{"onUpdate:modelValue":e[16]||(e[16]=o=>t.localFilters.groupBy=o),class:"group-by-select"},[...e[39]||(e[39]=[tt('<option value="day" data-v-22b9cf1c>–î–Ω—è–º</option><option value="week" data-v-22b9cf1c>–ù–µ–¥–µ–ª—è–º</option><option value="month" data-v-22b9cf1c>–ú–µ—Å—è—Ü–∞–º</option><option value="user" data-v-22b9cf1c>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</option><option value="page" data-v-22b9cf1c>–°—Ç—Ä–∞–Ω–∏—Ü–∞–º</option><option value="session" data-v-22b9cf1c>–°–µ—Å—Å–∏—è–º</option>',6)])],512),[[re,t.localFilters.groupBy]])]),a("div",kl,[e[43]||(e[43]=a("label",{class:"sub-label"},"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:",-1)),H(a("select",{"onUpdate:modelValue":e[17]||(e[17]=o=>t.localFilters.sortBy=o),class:"sort-by-select"},[...e[41]||(e[41]=[a("option",{value:"timestamp"},"–ü–æ –≤—Ä–µ–º–µ–Ω–∏",-1),a("option",{value:"user"},"–ü–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é",-1),a("option",{value:"type"},"–ü–æ —Ç–∏–ø—É",-1),a("option",{value:"page"},"–ü–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ",-1)])],512),[[re,t.localFilters.sortBy]]),H(a("select",{"onUpdate:modelValue":e[18]||(e[18]=o=>t.localFilters.sortOrder=o),class:"sort-order-select"},[...e[42]||(e[42]=[a("option",{value:"desc"},"–£–±—ã–≤–∞–Ω–∏–µ",-1),a("option",{value:"asc"},"–í–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ",-1)])],512),[[re,t.localFilters.sortOrder]])])])])]),a("div",Cl,[a("div",Sl,[e[45]||(e[45]=a("h5",{class:"saved-title"},"üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã",-1)),a("button",{onClick:e[19]||(e[19]=o=>t.showSaveDialog=!0),class:"save-current-btn"}," –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π ")]),t.savedFilters.length>0?(c(),d("div",Dl,[(c(!0),d(W,null,q(t.savedFilters,o=>(c(),d("div",{key:o.id,class:"saved-filter-item"},[a("div",Tl,[a("div",xl,m(o.name),1),a("div",Al,"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: "+m(t.formatDate(o.createdAt)),1)]),a("div",El,[a("button",{onClick:l=>t.loadSavedFilter(o),class:"load-btn"},"–ó–∞–≥—Ä—É–∑–∏—Ç—å",8,Ml),a("button",{onClick:l=>t.deleteSavedFilter(o.id),class:"delete-btn"},"–£–¥–∞–ª–∏—Ç—å",8,Il)])]))),128))])):(c(),d("div",Ll," –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ "))]),t.showSaveDialog?(c(),d("div",{key:1,class:"save-dialog-overlay",onClick:e[25]||(e[25]=o=>t.showSaveDialog=!1)},[a("div",{class:"save-dialog",onClick:e[24]||(e[24]=pe(()=>{},["stop"]))},[e[47]||(e[47]=a("h4",null,"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä",-1)),a("div",Pl,[e[46]||(e[46]=a("label",{class:"dialog-label"},"–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞:",-1)),H(a("input",{"onUpdate:modelValue":e[20]||(e[20]=o=>t.saveFilterName=o),type:"text",class:"save-name-input",placeholder:"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ...",onKeyup:e[21]||(e[21]=Se((...o)=>t.saveCurrentFilter&&t.saveCurrentFilter(...o),["enter"]))},null,544),[[we,t.saveFilterName]])]),a("div",Fl,[a("button",{onClick:e[22]||(e[22]=o=>t.showSaveDialog=!1),class:"cancel-btn"},"–û—Ç–º–µ–Ω–∞"),a("button",{onClick:e[23]||(e[23]=(...o)=>t.saveCurrentFilter&&t.saveCurrentFilter(...o)),disabled:!t.saveFilterName.trim(),class:"save-btn"},"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",8,Ul)])])])):x("",!0)])}const Nl=K(Pi,[["render",Rl],["__scopeId","data-v-22b9cf1c"]]);class ce{static prepareTimeChartData(e,s="day",t={}){if(!Array.isArray(e))return this.getEmptyTimeChartData();const{ActivityAnalyticsService:r}=t,i=r?r.groupActivity(e,s):this.fallbackGroupByTime(e,s);return{labels:i.map(o=>this.formatGroupLabel(o.key,s)),datasets:[{label:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",data:i.map(o=>o.count),borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"#2196F3",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]}}static prepareDistributionChartData(e,s,t="doughnut"){try{if(!Array.isArray(e))return console.warn("[VisualizationHelpers] prepareDistributionChartData: activity is not an array"),this.getEmptyDistributionData();if(e.length===0)return this.getEmptyDistributionData();if(!e.every(l=>typeof l=="object"&&l!==null))return console.warn("[VisualizationHelpers] prepareDistributionChartData: some items are not objects"),this.getEmptyDistributionData();const r=this.calculateDistribution(e,s),i=this.generateColors(Object.keys(r).length),o={labels:Object.keys(r),datasets:[{data:Object.values(r),backgroundColor:i,borderColor:i.map(l=>this.adjustColorBrightness(l,-20)),borderWidth:t==="doughnut"?2:1,hoverBorderWidth:t==="doughnut"?3:2}]};return t==="bar"&&(o.datasets[0].borderRadius=4,o.datasets[0].borderSkipped=!1),o}catch(r){return console.error("[VisualizationHelpers] prepareDistributionChartData error:",r),this.getEmptyDistributionData()}}static prepareUserRankingData(e,s=10){if(!Array.isArray(e))return[];const t=new Map;return e.forEach(r=>{if(!r||typeof r!="object")return;const i=r.user_id;if(!i)return;t.has(i)||t.set(i,{id:i,name:r.user_name||`User #${i}`,count:0,app_entries:0,page_visits:0,last_activity:r.timestamp});const o=t.get(i);o.count++,r.type==="app_entry"?o.app_entries++:r.type==="page_visit"&&o.page_visits++,r.timestamp&&(!o.last_activity||r.timestamp>o.last_activity)&&(o.last_activity=r.timestamp)}),Array.from(t.values()).sort((r,i)=>i.count-r.count).slice(0,s).map((r,i)=>({...r,rank:i+1,lastActivityFormatted:this.formatTimestamp(r.last_activity)}))}static prepareSessionTimelineData(e){return Array.isArray(e)?e.map(s=>({id:s.id,startTime:s.startTime,endTime:s.endTime,duration:s.duration,pageCount:s.pageCount,entriesCount:s.entriesCount,actions:s.actions,device:s.device,formattedStartTime:this.formatTimestamp(new Date(s.startTime)),formattedDuration:this.formatDuration(s.duration),color:this.getSessionColor(s)})):[]}static formatActivityData(e){return Array.isArray(e)?e.map(s=>({...s,formattedTimestamp:this.formatTimestamp(s.timestamp),formattedDuration:s.duration?this.formatDuration(s.duration):null,userDisplayName:s.user_name||`User #${s.user_id}`,pageDisplayName:this.formatPageName(s),deviceInfo:this.parseUserAgent(s.user_agent),actionIcon:this.getActionIcon(s.type),actionColor:this.getActionColor(s.type)})):[]}static prepareComparisonChartData(e,s,t="day"){const r=this.prepareTimeChartData(e,t),i=this.prepareTimeChartData(s,t),o=new Set([...r.labels,...i.labels]),l=Array.from(o).sort(),u=new Map(r.labels.map((p,g)=>[p,r.datasets[0].data[g]])),f=new Map(i.labels.map((p,g)=>[p,i.datasets[0].data[g]]));return{labels:l,datasets:[{label:"–¢–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥",data:l.map(p=>u.get(p)||0),borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",fill:!0,tension:.4},{label:"–ü—Ä–µ–¥—ã–¥—É—â–∏–π –ø–µ—Ä–∏–æ–¥",data:l.map(p=>f.get(p)||0),borderColor:"#FF9800",backgroundColor:"rgba(255, 152, 0, 0.1)",fill:!0,tension:.4}]}}static calculateDistribution(e,s){if(!Array.isArray(e))return console.warn("[VisualizationHelpers] calculateDistribution: activity is not an array",e),{};const t={};return e.forEach(r=>{if(!r||typeof r!="object"){console.warn("[VisualizationHelpers] calculateDistribution: invalid entry",r);return}let i;switch(s){case"activity_types":i=r.type||"unknown";break;case"devices":i=this.detectDevice(r.user_agent);break;case"browsers":i=this.detectBrowser(r.user_agent);break;case"departments":i=r.user_department||"–ù–µ —É–∫–∞–∑–∞–Ω";break;case"pages":i=r.route_path||r.route_title||r.route_name||"unknown";break;default:i="–î—Ä—É–≥–æ–µ"}t[i]=(t[i]||0)+1}),t}static fallbackGroupByTime(e,s){if(!Array.isArray(e))return[];const t=new Map;return e.forEach(r=>{if(!r||!r.timestamp)return;let i;const o=new Date(r.timestamp);switch(s){case"hour":i=o.getHours();break;case"day":i=o.toISOString().split("T")[0];break;case"week":i=new Date(o.setDate(o.getDate()-o.getDay())).toISOString().split("T")[0];break;case"month":i=o.toISOString().substring(0,7);break;default:i="all"}t.has(i)||t.set(i,{key:i,entries:[],count:0}),t.get(i).entries.push(r),t.get(i).count++}),Array.from(t.values()).sort((r,i)=>["day","week","month"].includes(s)?new Date(i.key)-new Date(r.key):i.count-r.count)}static formatGroupLabel(e,s){switch(s){case"hour":return`${e}:00`;case"day":return this.formatDate(e);case"week":return`–ù–µ–¥–µ–ª—è ${e}`;case"month":return this.formatMonth(e);default:return e}}static detectDevice(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const s=e.toLowerCase();return s.includes("mobile")||s.includes("android")||s.includes("iphone")?"Mobile":s.includes("tablet")||s.includes("ipad")?"Tablet":"Desktop"}static detectBrowser(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const s=e.toLowerCase();return s.includes("chrome")&&!s.includes("edg")?"Chrome":s.includes("firefox")?"Firefox":s.includes("safari")&&!s.includes("chrome")?"Safari":s.includes("edg")?"Edge":s.includes("opera")?"Opera":"–î—Ä—É–≥–æ–µ"}static parseUserAgent(e){return e?{device:this.detectDevice(e),browser:this.detectBrowser(e),os:this.detectOS(e)}:{device:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",browser:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",os:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}}static detectOS(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const s=e.toLowerCase();return s.includes("windows")?"Windows":s.includes("macintosh")||s.includes("mac os x")?"macOS":s.includes("linux")?"Linux":s.includes("android")?"Android":s.includes("ios")||s.includes("iphone")||s.includes("ipad")?"iOS":"–î—Ä—É–≥–æ–µ"}static generateColors(e){const s=["#2196F3","#4CAF50","#FF9800","#F44336","#9C27B0","#00BCD4","#8BC34A","#FFC107","#795548","#607D8B"];if(e<=s.length)return s.slice(0,e);const t=[];for(let r=s.length;r<e;r++)t.push(this.generateRandomColor());return[...s,...t]}static generateRandomColor(){return`hsl(${Math.floor(Math.random()*360)}, 70%, 50%)`}static adjustColorBrightness(e,s){if(e.startsWith("#")){const t=e[0]==="#",r=t?e.slice(1):e,i=parseInt(r,16);let o=(i>>16)+s,l=(i>>8&255)+s,u=(i&255)+s;return o=o>255?255:o<0?0:o,l=l>255?255:l<0?0:l,u=u>255?255:u<0?0:u,(t?"#":"")+(o<<16|l<<8|u).toString(16)}return e}static formatDate(e){try{return new Date(e).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return e}}static formatMonth(e){try{const[s,t]=e.split("-");return new Date(s,t-1,1).toLocaleDateString("ru-RU",{year:"numeric",month:"long"})}catch{return e}}static formatTimestamp(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{return new Date(e).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return e}}static formatDuration(e){if(!e||e<0)return"0—Å";const s=Math.floor(e/1e3),t=Math.floor(s/60),r=Math.floor(t/60);return r>0?`${r}—á ${t%60}–º`:t>0?`${t}–º ${s%60}—Å`:`${s}—Å`}static formatPageName(e){return e&&(e.route_title||e.route_path||e.route_name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}static getActionIcon(e){switch(e){case"app_entry":return"üö™";case"page_visit":return"üìÑ";default:return"‚ùì"}}static getActionColor(e){switch(e){case"app_entry":return"#4CAF50";case"page_visit":return"#2196F3";default:return"#9E9E9E"}}static getSessionColor(e){const s=e.duration||0;return s<5*60*1e3?"#4CAF50":s<15*60*1e3?"#FF9800":"#F44336"}static getEmptyTimeChartData(){return{labels:[],datasets:[{label:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",data:[],borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",fill:!0,tension:.4}]}}static getEmptyDistributionData(){return{labels:[],datasets:[{data:[],backgroundColor:[],borderColor:[],borderWidth:2}]}}}Ue.register(dt,ut,Et,Mt,mt,gt,ft,It);const Ol={name:"TimeChart",props:{data:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},title:{type:String,default:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏"},height:{type:Number,default:300},interactive:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},groupBy:{type:String,default:"day",validator:n=>["hour","day","week","month"].includes(n)}},emits:["time-range-change","data-point-click"],setup(n,{emit:e}){const s=y(null),t=y(null),r=y(!1),i=y(null),o=y(n.groupBy),l=C(()=>{try{if(!Array.isArray(n.data)||n.data.length===0)return ce.getEmptyTimeChartData();if(!n.data.every(w=>typeof w=="object"&&w!==null))return console.warn("[TimeChart] Invalid data format, some items are not objects"),ce.getEmptyTimeChartData();const h=n.data.filter(w=>w&&typeof w=="object"&&w!==null&&w.timestamp&&typeof w.type=="string");if(h.length===0)return ce.getEmptyTimeChartData();const v=ce.prepareTimeChartData(h,o.value,{ActivityAnalyticsService:Ne});return!v||!v.labels||!v.datasets?(console.warn("[TimeChart] Prepared data is invalid"),ce.getEmptyTimeChartData()):v}catch(h){return console.error("[TimeChart] Error preparing chart data:",h),i.value="–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞",ce.getEmptyTimeChartData()}}),u=C(()=>!l.value.datasets||l.value.datasets.length===0?0:Math.max(...l.value.datasets[0].data)),f=C(()=>{if(!l.value.datasets||l.value.datasets.length===0)return 0;const h=l.value.datasets[0].data;return h.length>0?h.reduce((v,w)=>v+w,0)/h.length:0}),p=()=>{if(!s.value||!l.value)return;I();const h=s.value.getContext("2d");if(!h){console.error("[TimeChart] Canvas context not available"),i.value="–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞";return}try{t.value=new Ue(h,{type:"line",data:l.value,options:{responsive:!0,maintainAspectRatio:!1,devicePixelRatio:1,animation:{duration:0},plugins:{legend:{display:!0,position:"top"},tooltip:{enabled:n.interactive,mode:"index",intersect:!1,callbacks:{label:v=>{const w=v.dataset.label||"",U=v.parsed.y;return`${w}: ${U}`},title:v=>v.length===0?"":v[0].label}}},scales:{x:{display:!0,title:{display:!0,text:D()}},y:{display:!0,beginAtZero:!0,title:{display:!0,text:"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π"},ticks:{precision:0}}},interaction:{intersect:!1,mode:"index"},onClick:n.interactive?g:null,onHover:n.interactive?S:null}})}catch(v){console.error("[TimeChart] Error creating chart:",v),i.value="–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞",t.value=null}},g=(h,v)=>{if(v.length>0){const w=v[0].index,U=l.value.labels[w],R=l.value.datasets[0].data[w];e("data-point-click",{label:U,value:R,groupBy:o.value,index:w})}},S=(h,v)=>{h.native.target.style.cursor=v.length>0?"pointer":"default"},D=()=>{switch(o.value){case"hour":return"–ß–∞—Å—ã";case"day":return"–î–Ω–∏";case"week":return"–ù–µ–¥–µ–ª–∏";case"month":return"–ú–µ—Å—è—Ü—ã";default:return"–í—Ä–µ–º—è"}},E=async()=>{if(t.value&&l.value){r.value=!0,i.value=null;try{const h=t.value.data,v=l.value;JSON.stringify(h)!==JSON.stringify(v)&&(t.value.data=v,t.value.options.scales.x.title.text=D(),t.value.update("none"))}catch(h){console.error("[TimeChart] Error updating chart:",h),i.value="–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞"}finally{r.value=!1}}},T=async()=>{t.value&&I(),await Lt(),p()},I=()=>{t.value&&(t.value.destroy(),t.value=null)};return ee(()=>n.data,(h,v)=>{JSON.stringify(h)!==JSON.stringify(v)&&T()},{deep:!0}),ee(()=>o.value,(h,v)=>{h!==v&&T()}),ee(()=>n.groupBy,h=>{o.value=h}),le(()=>{p()}),Be(()=>{I()}),{chartCanvas:s,chartData:l,loading:r,error:i,selectedGroupBy:o,maxValue:u,averageValue:f,updateChart:E}}},Bl={class:"time-chart-container"},Vl={class:"chart-header"},jl={class:"chart-title"},zl={class:"chart-controls"},$l={key:0,class:"chart-loading"},Wl={key:1,class:"chart-error"},ql={key:2,class:"chart-canvas-container"},Hl={ref:"chartCanvas"},Xl={key:0,class:"chart-stats"},Jl={class:"stat-item"},Kl={class:"stat-value"},Yl={class:"stat-item"},Gl={class:"stat-value"},Ql={class:"stat-item"},Zl={class:"stat-value"};function ec(n,e,s,t,r,i){return c(),d("div",Bl,[a("div",Vl,[a("h3",jl,m(s.title),1),a("div",zl,[H(a("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.selectedGroupBy=o),onChange:e[1]||(e[1]=(...o)=>t.updateChart&&t.updateChart(...o)),class:"group-by-select"},[...e[2]||(e[2]=[a("option",{value:"hour"},"–ü–æ —á–∞—Å–∞–º",-1),a("option",{value:"day"},"–ü–æ –¥–Ω—è–º",-1),a("option",{value:"week"},"–ü–æ –Ω–µ–¥–µ–ª—è–º",-1),a("option",{value:"month"},"–ü–æ –º–µ—Å—è—Ü–∞–º",-1)])],544),[[re,t.selectedGroupBy]])])]),a("div",{class:B(["chart-wrapper",{loading:t.loading}])},[t.loading?(c(),d("div",$l," –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞... ")):t.error?(c(),d("div",Wl,m(t.error),1)):(c(),d("div",ql,[a("canvas",Hl,null,512)]))],2),s.showStats&&t.chartData.labels.length>0?(c(),d("div",Xl,[a("div",Jl,[e[3]||(e[3]=a("span",{class:"stat-label"},"–í—Å–µ–≥–æ —Ç–æ—á–µ–∫:",-1)),a("span",Kl,m(t.chartData.labels.length),1)]),a("div",Yl,[e[4]||(e[4]=a("span",{class:"stat-label"},"–ú–∞–∫—Å–∏–º—É–º:",-1)),a("span",Gl,m(t.maxValue),1)]),a("div",Ql,[e[5]||(e[5]=a("span",{class:"stat-label"},"–°—Ä–µ–¥–Ω–µ–µ:",-1)),a("span",Zl,m(t.averageValue.toFixed(1)),1)])])):x("",!0)])}const Xt=K(Ol,[["render",ec],["__scopeId","data-v-f4245347"]]);Ue.register(dt,ut,Pt,Ft,mt,gt,ft);const tc={name:"DistributionChart",props:{data:{type:Array,default:()=>[]},type:{type:String,default:"activity_types",validator:n=>["activity_types","devices","browsers","departments","pages"].includes(n)},chartType:{type:String,default:"doughnut",validator:n=>["doughnut","bar","pie"].includes(n)},title:{type:String,default:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ"},height:{type:Number,default:300},showLegend:{type:Boolean,default:!0},maxItems:{type:Number,default:10}},emits:["segment-click","type-change"],setup(n,{emit:e}){const s=y(null),t=y(null),r=y(!1),i=y(null),o=y(n.type),l=y(n.chartType),u=C(()=>{try{if(!Array.isArray(n.data)||n.data.length===0)return ce.getEmptyDistributionData();const h=n.data.filter(v=>v&&typeof v=="object"&&v!==null&&typeof v.type=="string");return h.length===0?ce.getEmptyDistributionData():ce.prepareDistributionChartData(h,o.value,l.value)}catch(h){return console.error("[DistributionChart] Error preparing chart data:",h),i.value="–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º—ã",ce.getEmptyDistributionData()}}),f=C(()=>u.value.datasets&&u.value.datasets.length>0&&u.value.datasets[0].data&&u.value.datasets[0].data.length>0&&u.value.datasets[0].data.some(h=>h>0)),p=C(()=>{if(!f.value||!u.value.labels)return[];const h=u.value.labels,v=u.value.datasets[0].data,w=u.value.datasets[0].backgroundColor,U=v.reduce((R,k)=>R+k,0);return h.map((R,k)=>({label:R.length>20?R.substring(0,20)+"...":R,fullLabel:R,value:v[k],percentage:U>0?v[k]/U*100:0,color:w[k]})).sort((R,k)=>k.value-R.value)}),g=()=>{if(!s.value||!f.value)return;I();const h=s.value.getContext("2d");if(!h){console.error("[DistributionChart] Canvas context not available"),i.value="–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã";return}try{const v=S(l.value);t.value=new v({ctx:h,data:u.value,options:D()})}catch(v){console.error("[DistributionChart] Error creating chart:",v),i.value="–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã",t.value=null}},S=h=>{switch(h){case"bar":return ss;case"pie":return ts;case"doughnut":default:return es}},D=()=>{const h={responsive:!1,devicePixelRatio:1,maintainAspectRatio:!1,animation:{duration:0},maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:v=>{const w=v.label||"",U=v.parsed,R=v.dataset.data.reduce((_,b)=>_+b,0),k=R>0?(U/R*100).toFixed(1):0;return`${w}: ${U} (${k}%)`}}}},onClick:E};return l.value==="bar"&&(h.scales={y:{beginAtZero:!0,ticks:{precision:0}}}),(l.value==="doughnut"||l.value==="pie")&&(h.plugins.tooltip.callbacks.title=v=>v[0]?.label||""),h},E=(h,v)=>{if(v.length>0){const w=v[0].index,U=u.value.labels[w],R=u.value.datasets[0].data[w];e("segment-click",{type:o.value,label:U,value:R,index:w})}},T=async()=>{r.value=!0,i.value=null;try{await Lt(),I(),g()}catch(h){console.error("[DistributionChart] Error updating chart:",h),i.value="–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã"}finally{r.value=!1}},I=()=>{t.value&&(t.value.destroy(),t.value=null)};return ee(()=>n.data,()=>{T()},{deep:!0}),ee(()=>n.type,h=>{o.value=h}),ee(()=>n.chartType,h=>{l.value=h}),le(()=>{g()}),Be(()=>{I()}),{chartCanvas:s,chartData:u,loading:r,error:i,selectedType:o,selectedChartType:l,hasData:f,legendItems:p,updateChart:T}}},sc={class:"distribution-chart-container"},ac={class:"chart-header"},oc={class:"chart-title"},nc={class:"chart-controls"},rc={key:0,class:"chart-loading"},ic={key:1,class:"chart-error"},lc={key:2,class:"chart-empty"},cc={key:3,class:"chart-canvas-container"},dc={ref:"chartCanvas"},uc={key:0,class:"chart-legend"},mc={class:"legend-label"},gc={class:"legend-value"};function fc(n,e,s,t,r,i){return c(),d("div",sc,[a("div",ac,[a("h3",oc,m(s.title),1),a("div",nc,[H(a("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.selectedType=o),onChange:e[1]||(e[1]=(...o)=>t.updateChart&&t.updateChart(...o)),class:"chart-type-select"},[...e[4]||(e[4]=[tt('<option value="activity_types" data-v-9185ae08>–¢–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</option><option value="devices" data-v-9185ae08>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</option><option value="browsers" data-v-9185ae08>–ë—Ä–∞—É–∑–µ—Ä—ã</option><option value="departments" data-v-9185ae08>–û—Ç–¥–µ–ª—ã</option><option value="pages" data-v-9185ae08>–°—Ç—Ä–∞–Ω–∏—Ü—ã</option>',5)])],544),[[re,t.selectedType]]),H(a("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.selectedChartType=o),onChange:e[3]||(e[3]=(...o)=>t.updateChart&&t.updateChart(...o)),class:"chart-style-select"},[...e[5]||(e[5]=[a("option",{value:"doughnut"},"–ö—Ä—É–≥–æ–≤–∞—è",-1),a("option",{value:"bar"},"–°—Ç–æ–ª–±—á–∞—Ç–∞—è",-1),a("option",{value:"pie"},"–°–µ–∫—Ç–æ—Ä–Ω–∞—è",-1)])],544),[[re,t.selectedChartType]])])]),a("div",{class:B(["chart-wrapper",{loading:t.loading}])},[t.loading?(c(),d("div",rc," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã... ")):t.error?(c(),d("div",ic,m(t.error),1)):t.hasData?(c(),d("div",cc,[a("canvas",dc,null,512)])):(c(),d("div",lc," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "))],2),s.showLegend&&t.legendItems.length>0?(c(),d("div",uc,[(c(!0),d(W,null,q(t.legendItems,o=>(c(),d("div",{class:"legend-item",key:o.label},[a("div",{class:"legend-color",style:xe({backgroundColor:o.color})},null,4),a("span",mc,m(o.label),1),a("span",gc,m(o.value)+" ("+m(o.percentage.toFixed(1))+"%)",1)]))),128))])):x("",!0)])}const hc=K(tc,[["render",fc],["__scopeId","data-v-9185ae08"]]),vc={name:"UserRanking",props:{data:{type:Array,default:()=>[]},limit:{type:Number,default:10},title:{type:String,default:"–¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},showPagination:{type:Boolean,default:!1},itemsPerPage:{type:Number,default:10}},emits:["user-select"],setup(n,{emit:e}){const s=y("count"),t=y(!0),r=y(!1),i=y(null),o=y(1),l=C(()=>{try{if(!Array.isArray(n.data)||n.data.length===0)return[];const v=n.data.filter(U=>!(!U||typeof U!="object"||U===null||!U.user_id||!U.timestamp||typeof U.type!="string"||!U.type.trim()));if(v.length===0)return[];let w=ce.prepareUserRankingData(v,n.limit*3);return w.sort((U,R)=>{switch(s.value){case"sessions":return(R.sessions||0)-(U.sessions||0);case"recent":return new Date(R.lastActivityFormatted)-new Date(U.lastActivityFormatted);case"count":default:return R.count-U.count}}),w.slice(0,n.limit)}catch(v){return console.error("[UserRanking] Error preparing ranking data:",v),i.value="–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–π—Ç–∏–Ω–≥–∞",[]}}),u=C(()=>Math.ceil(l.value.length/n.itemsPerPage)),f=C(()=>{if(!n.showPagination)return l.value;const v=(o.value-1)*n.itemsPerPage,w=v+n.itemsPerPage;return l.value.slice(v,w)}),p=v=>{v>=1&&v<=u.value&&(o.value=v)},g=()=>{t.value=!t.value},S=()=>{o.value=1},D=v=>{e("user-select",v)},E=v=>v===1?"rank-gold":v===2?"rank-silver":v===3?"rank-bronze":"rank-normal",T=v=>{const w=["#2196F3","#4CAF50","#FF9800","#F44336","#9C27B0","#00BCD4","#8BC34A","#FFC107","#795548","#607D8B"],U=Math.abs(v)%w.length;return w[U]},I=v=>{if(!v)return"?";const w=v.split(" ");return w.length>=2?(w[0][0]+w[1][0]).toUpperCase():v.substring(0,2).toUpperCase()},h=v=>{if(!v||v==="–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{const w=new Date(v),R=new Date-w,k=Math.floor(R/(1e3*60*60*24));return k===0?"–°–µ–≥–æ–¥–Ω—è":k===1?"–í—á–µ—Ä–∞":k<7?`${k} –¥–Ω–µ–π –Ω–∞–∑–∞–¥`:w.toLocaleDateString("ru-RU")}catch{return v}};return ee(()=>n.data,()=>{o.value=1},{deep:!0}),{sortBy:s,showAsList:t,loading:r,error:i,currentPage:o,users:l,displayedUsers:f,totalPages:u,goToPage:p,toggleView:g,updateRanking:S,viewUserProfile:D,getRankClass:E,getAvatarColor:T,getUserInitials:I,formatLastActivity:h}}},pc={class:"user-ranking-container"},yc={class:"ranking-header"},_c={class:"ranking-title"},bc={class:"ranking-controls"},wc={key:0,class:"ranking-loading"},kc={key:1,class:"ranking-error"},Cc={key:2,class:"ranking-empty"},Sc={key:3,class:"ranking-list"},Dc={class:"user-info"},Tc={class:"user-name"},xc={class:"user-stats"},Ac={class:"stat-item"},Ec={class:"stat-item"},Mc={class:"user-actions"},Ic=["onClick"],Lc={key:4,class:"ranking-cards"},Pc={class:"card-header"},Fc={class:"card-content"},Uc={class:"user-name-large"},Rc={class:"user-stats-large"},Nc={class:"stat-large"},Oc={class:"stat-value"},Bc={class:"stat-large"},Vc={class:"stat-value"},jc={class:"last-activity"},zc={class:"card-actions"},$c=["onClick"],Wc={key:0,class:"ranking-pagination"},qc=["disabled"],Hc={class:"page-info"},Xc=["disabled"];function Jc(n,e,s,t,r,i){return c(),d("div",pc,[a("div",yc,[a("h3",_c,m(s.title),1),a("div",bc,[H(a("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.sortBy=o),onChange:e[1]||(e[1]=(...o)=>t.updateRanking&&t.updateRanking(...o)),class:"sort-select"},[...e[5]||(e[5]=[a("option",{value:"count"},"–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–µ–π—Å—Ç–≤–∏–π",-1),a("option",{value:"sessions"},"–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–µ—Å—Å–∏–π",-1),a("option",{value:"recent"},"–ü–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)])],544),[[re,t.sortBy]]),a("button",{onClick:e[2]||(e[2]=(...o)=>t.toggleView&&t.toggleView(...o)),class:"view-toggle-btn"},m(t.showAsList?"–ö–∞—Ä—Ç–æ—á–∫–∏":"–°–ø–∏—Å–æ–∫"),1)])]),a("div",{class:B(["ranking-content",{loading:t.loading}])},[t.loading?(c(),d("div",wc," –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞... ")):t.error?(c(),d("div",kc,m(t.error),1)):t.users.length===0?(c(),d("div",Cc," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö ")):t.showAsList?(c(),d("div",Sc,[(c(!0),d(W,null,q(t.displayedUsers,o=>(c(),d("div",{class:"ranking-item",key:o.id},[a("div",{class:B(["rank-badge",t.getRankClass(o.rank)])},m(o.rank),3),a("div",{class:"user-avatar",style:xe({backgroundColor:t.getAvatarColor(o.id)})},m(t.getUserInitials(o.name)),5),a("div",Dc,[a("div",Tc,m(o.name),1),a("div",xc,[a("span",Ac,[e[6]||(e[6]=a("i",{class:"stat-icon"},"üìä",-1)),Q(" "+m(o.count)+" –¥–µ–π—Å—Ç–≤–∏–π ",1)]),a("span",Ec,[e[7]||(e[7]=a("i",{class:"stat-icon"},"‚è∞",-1)),Q(" "+m(t.formatLastActivity(o.lastActivityFormatted)),1)])])]),a("div",Mc,[a("button",{onClick:l=>t.viewUserProfile(o),class:"profile-btn",title:"–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"}," üë§ ",8,Ic)])]))),128))])):(c(),d("div",Lc,[(c(!0),d(W,null,q(t.displayedUsers,o=>(c(),d("div",{class:"ranking-card",key:o.id},[a("div",Pc,[a("div",{class:B(["rank-badge-large",t.getRankClass(o.rank)])}," #"+m(o.rank),3),a("div",{class:"user-avatar-large",style:xe({backgroundColor:t.getAvatarColor(o.id)})},m(t.getUserInitials(o.name)),5)]),a("div",Fc,[a("h4",Uc,m(o.name),1),a("div",Rc,[a("div",Nc,[a("div",Oc,m(o.count),1),e[8]||(e[8]=a("div",{class:"stat-label"},"–¥–µ–π—Å—Ç–≤–∏–π",-1))]),a("div",Bc,[a("div",Vc,m(o.sessions||0),1),e[9]||(e[9]=a("div",{class:"stat-label"},"—Å–µ—Å—Å–∏–π",-1))])]),a("div",jc," –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: "+m(t.formatLastActivity(o.lastActivityFormatted)),1)]),a("div",zc,[a("button",{onClick:l=>t.viewUserProfile(o),class:"profile-btn-large"}," –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ",8,$c)])]))),128))]))],2),s.showPagination&&t.totalPages>1?(c(),d("div",Wc,[a("button",{onClick:e[3]||(e[3]=o=>t.goToPage(t.currentPage-1)),disabled:t.currentPage===1,class:"page-btn"}," ‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,qc),a("span",Hc," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+m(t.currentPage)+" –∏–∑ "+m(t.totalPages),1),a("button",{onClick:e[4]||(e[4]=o=>t.goToPage(t.currentPage+1)),disabled:t.currentPage===t.totalPages,class:"page-btn"}," –°–ª–µ–¥—É—é—â–∞—è ‚Ä∫ ",8,Xc)])):x("",!0)])}const Kc=K(vc,[["render",Jc],["__scopeId","data-v-66e695d4"]]),Yc={name:"ActivityDataTable",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},filters:{type:Object,default:()=>({})},pageSize:{type:Number,default:25},maxPagesShown:{type:Number,default:7}},emits:["sort-change","row-click","export","filter-change"],setup(n,{emit:e}){const s=y(""),t=y(""),r=y("table"),i=y("timestamp"),o=y("desc"),l=y(1),u=[{key:"timestamp",label:"–í—Ä–µ–º—è",sortable:!0,width:"150px",component:"span"},{key:"user_name",label:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",sortable:!0,width:"200px",component:"span"},{key:"type",label:"–î–µ–π—Å—Ç–≤–∏–µ",sortable:!0,width:"120px",component:"span"},{key:"route_title",label:"–°—Ç—Ä–∞–Ω–∏—Ü–∞",sortable:!0,width:"250px",component:"span"},{key:"device",label:"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ",sortable:!1,width:"100px",component:"span"}],f=C(()=>u),p=jt(F=>{s.value=F},300),g=C(()=>{try{if(!Array.isArray(n.data))return[];let F=[...n.data];if(F=F.filter(J=>J&&typeof J=="object"&&J!==null&&J.user_id&&J.timestamp&&typeof J.type=="string"),s.value.trim()){const J=s.value.toLowerCase();F=F.filter(te=>te?(te.user_name||"").toLowerCase().includes(J)||(te.route_title||"").toLowerCase().includes(J)||(te.route_path||"").toLowerCase().includes(J)||(te.type||"").toLowerCase().includes(J):!1)}return F.sort((J,te)=>{if(!J||!te)return 0;let ne=J[i.value],se=te[i.value];return i.value==="timestamp"&&(ne=new Date(ne).getTime(),se=new Date(se).getTime()),typeof ne=="string"&&(ne=ne.toLowerCase()),typeof se=="string"&&(se=se.toLowerCase()),ne<se?o.value==="asc"?-1:1:ne>se?o.value==="asc"?1:-1:0}),F}catch(F){return console.warn("[ActivityDataTable] Error filtering data:",F),[]}}),S=C(()=>g.value.length),D=C(()=>Math.ceil(S.value/n.pageSize)),E=C(()=>{try{if(!Array.isArray(g.value))return[];const F=(l.value-1)*n.pageSize,J=F+n.pageSize;return g.value.slice(F,J)}catch(F){return console.warn("[ActivityDataTable] Error paginating data:",F),[]}}),T=C(()=>E.value),I=C(()=>{const F=D.value,J=l.value,te=n.maxPagesShown;if(F<=te)return Array.from({length:F},(de,he)=>he+1);const ne=Math.floor(te/2);let se=Math.max(1,J-ne),ie=Math.min(F,se+te-1);return ie-se+1<te&&(se=Math.max(1,ie-te+1)),Array.from({length:ie-se+1},(de,he)=>se+he)}),h=C(()=>Object.values(n.filters).some(F=>F!=null&&F!=="")||s.value.trim()),v=C(()=>{const F=[];return n.filters.dateFrom&&F.push({key:"dateFrom",label:"–î–∞—Ç–∞ –æ—Ç",value:n.filters.dateFrom}),n.filters.dateTo&&F.push({key:"dateTo",label:"–î–∞—Ç–∞ –¥–æ",value:n.filters.dateTo}),n.filters.userId&&F.push({key:"userId",label:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",value:`ID ${n.filters.userId}`}),n.filters.type&&F.push({key:"type",label:"–¢–∏–ø",value:n.filters.type}),s.value.trim()&&F.push({key:"search",label:"–ü–æ–∏—Å–∫",value:s.value}),F}),w=F=>{i.value===F?o.value=o.value==="asc"?"desc":"asc":(i.value=F,o.value="asc"),e("sort-change",{sortBy:i.value,sortOrder:o.value})},U=F=>{e("row-click",F)},R=()=>{e("export",{data:g.value,filters:n.filters,searchQuery:s.value})},k=F=>{p(F.target.value)},_=F=>{F==="search"?(s.value="",t.value=""):e("filter-change",{...n.filters,[F]:null})},b=F=>{F>=1&&F<=D.value&&(l.value=F)},P=F=>F?`${F.timestamp||"no-timestamp"}-${F.user_id||"no-user"}-${F.type||"no-type"}-${F.route_path||""}`:"undefined-entry",z=F=>F?{"row-app-entry":F.type==="app_entry","row-page-visit":F.type==="page_visit"}:{},O=(F,J)=>{switch(F.key){case"timestamp":return N(J.timestamp);case"user_name":return J.user_name||`User #${J.user_id}`;case"type":return fe(J);case"route_title":return J.route_title||J.route_path||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞";case"device":return Y(J.user_agent).device;default:return J[F.key]||""}},A=(F,J)=>({}),j=F=>F?ce.getActionIcon(F):"‚ùì",fe=F=>{if(!F)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ";switch(F.type){case"app_entry":return"–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è";case"page_visit":return"–ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º";default:return F.type||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ"}},N=F=>ce.formatTimestamp(F),Y=F=>ce.parseUserAgent(F);return ee(()=>n.data,()=>{l.value=1}),ee(s,()=>{l.value=1}),{searchQuery:s,searchInput:t,viewMode:r,sortBy:i,sortOrder:o,currentPage:l,visibleColumns:f,filteredData:g,totalCount:S,totalPages:D,paginatedData:E,displayedData:T,visiblePages:I,filtersApplied:h,activeFilters:v,handleSort:w,handleRowClick:U,handleExport:R,handleSearchInput:k,removeFilter:_,goToPage:b,getEntryKey:P,getRowClass:z,getCellValue:O,getCellProps:A,getActionIcon:j,getActionDescription:fe,formatTimestamp:N,parseUserAgent:Y}}},Gc={class:"activity-data-table"},Qc={class:"table-header"},Zc={class:"table-info"},ed={class:"table-subtitle"},td={key:0,class:"filters-indicator"},sd={class:"table-actions"},ad={class:"view-options"},od={class:"table-filters"},nd={class:"search-container"},rd={class:"filter-badges"},id=["onClick"],ld={key:0,class:"table-loading"},cd={key:1,class:"table-empty"},dd={key:2,class:"data-table"},ud=["onClick"],md={class:"column-header"},gd={key:0,class:"sort-icon"},fd={key:0},hd={key:1},vd={key:2},pd=["onClick"],yd={key:1,class:"cards-container"},_d=["onClick"],bd={class:"card-header"},wd={class:"card-icon"},kd={class:"card-timestamp"},Cd={class:"card-content"},Sd={class:"card-user"},Dd={class:"card-action"},Td={key:0,class:"card-page"},xd={key:1,class:"card-device"},Ad={key:2,class:"table-pagination"},Ed={class:"pagination-info"},Md={class:"pagination-controls"},Id=["disabled"],Ld=["disabled"],Pd={class:"page-numbers"},Fd=["onClick"],Ud=["disabled"],Rd=["disabled"];function Nd(n,e,s,t,r,i){return c(),d("div",Gc,[a("div",Qc,[a("div",Zc,[e[9]||(e[9]=a("h3",{class:"table-title"},"–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1)),a("p",ed,[Q(" –ü–æ–∫–∞–∑–∞–Ω–æ "+m(t.displayedData.length)+" –∏–∑ "+m(t.totalCount)+" –∑–∞–ø–∏—Å–µ–π ",1),t.filtersApplied?(c(),d("span",td,"‚Ä¢ –§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")):x("",!0)])]),a("div",sd,[a("div",ad,[a("button",{onClick:e[0]||(e[0]=o=>t.viewMode="table"),class:B([{active:t.viewMode==="table"},"view-btn"])}," üìã –¢–∞–±–ª–∏—Ü–∞ ",2),a("button",{onClick:e[1]||(e[1]=o=>t.viewMode="cards"),class:B([{active:t.viewMode==="cards"},"view-btn"])}," üÉè –ö–∞—Ä—Ç–æ—á–∫–∏ ",2)]),a("button",{onClick:e[2]||(e[2]=(...o)=>t.handleExport&&t.handleExport(...o)),class:"export-btn"}," üì• –≠–∫—Å–ø–æ—Ä—Ç ")])]),a("div",od,[a("div",nd,[H(a("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.searchInput=o),onInput:e[4]||(e[4]=(...o)=>t.handleSearchInput&&t.handleSearchInput(...o)),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏—é...",class:"search-input"},null,544),[[we,t.searchInput]]),e[10]||(e[10]=a("span",{class:"search-icon"},"üîç",-1))]),a("div",rd,[(c(!0),d(W,null,q(t.activeFilters,o=>(c(),d("span",{key:o.key,class:"filter-badge"},[Q(m(o.label)+": "+m(o.value)+" ",1),a("button",{onClick:l=>t.removeFilter(o.key),class:"remove-filter"},"√ó",8,id)]))),128))])]),t.viewMode==="table"?(c(),d("div",{key:0,class:B(["table-container",{loading:s.loading}])},[s.loading?(c(),d("div",ld," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):t.displayedData.length===0?(c(),d("div",cd," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ")):(c(),d("table",dd,[a("thead",null,[a("tr",null,[(c(!0),d(W,null,q(t.visibleColumns,o=>(c(),d("th",{key:o.key,class:B({sortable:o.sortable}),onClick:l=>o.sortable&&t.handleSort(o.key)},[a("div",md,[a("span",null,m(o.label),1),o.sortable?(c(),d("span",gd,[t.sortBy===o.key&&t.sortOrder==="asc"?(c(),d("span",fd,"‚Üë")):t.sortBy===o.key&&t.sortOrder==="desc"?(c(),d("span",hd,"‚Üì")):(c(),d("span",vd,"‚Üï"))])):x("",!0)])],10,ud))),128))])]),a("tbody",null,[(c(!0),d(W,null,q(t.paginatedData,o=>(c(),d("tr",{key:t.getEntryKey(o),class:B(t.getRowClass(o)),onClick:l=>t.handleRowClick(o)},[(c(!0),d(W,null,q(t.visibleColumns,l=>(c(),d("td",{key:l.key},[a("div",{class:B(["cell-content",`cell-${l.key}`])},[(c(),oe(os(l.component||"span"),as({ref_for:!0},t.getCellProps(l,o)),{default:_e(()=>[Q(m(t.getCellValue(l,o)),1)]),_:2},1040))],2)]))),128))],10,pd))),128))])]))],2)):t.viewMode==="cards"?(c(),d("div",yd,[n.entry&&typeof n.entry=="object"&&n.entry.user_id&&n.entry.timestamp&&typeof n.entry.type=="string"?(c(!0),d(W,{key:0},q(t.paginatedData,o=>(c(),d("div",{key:t.getEntryKey(o),class:B(["activity-card",t.getRowClass(o)]),onClick:l=>t.handleRowClick(o)},[a("div",bd,[a("div",wd,m(t.getActionIcon(o.type)),1),a("div",kd,m(t.formatTimestamp(o.timestamp)),1)]),a("div",Cd,[a("div",Sd,[a("strong",null,m(o.user_name||`User #${o.user_id}`),1)]),a("div",Dd,m(t.getActionDescription(o)),1),o.route_path?(c(),d("div",Td," –°—Ç—Ä–∞–Ω–∏—Ü–∞: "+m(o.route_title||o.route_path),1)):x("",!0),o.user_agent?(c(),d("div",xd," –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: "+m(t.parseUserAgent(o.user_agent).device),1)):x("",!0)])],10,_d))),128)):x("",!0)])):x("",!0),t.totalPages>1?(c(),d("div",Ad,[a("div",Ed," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+m(t.currentPage)+" –∏–∑ "+m(t.totalPages)+" ("+m(t.totalCount)+" –∑–∞–ø–∏—Å–µ–π) ",1),a("div",Md,[a("button",{onClick:e[5]||(e[5]=o=>t.goToPage(1)),disabled:t.currentPage===1,class:"page-btn"}," ¬´¬´ –ü–µ—Ä–≤–∞—è ",8,Id),a("button",{onClick:e[6]||(e[6]=o=>t.goToPage(t.currentPage-1)),disabled:t.currentPage===1,class:"page-btn"}," ‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,Ld),a("div",Pd,[(c(!0),d(W,null,q(t.visiblePages,o=>(c(),d("button",{key:o,onClick:l=>t.goToPage(o),class:B([{active:o===t.currentPage},"page-number"])},m(o),11,Fd))),128))]),a("button",{onClick:e[7]||(e[7]=o=>t.goToPage(t.currentPage+1)),disabled:t.currentPage===t.totalPages,class:"page-btn"}," –°–ª–µ–¥—É—é—â–∞—è ‚Ä∫ ",8,Ud),a("button",{onClick:e[8]||(e[8]=o=>t.goToPage(t.totalPages)),disabled:t.currentPage===t.totalPages,class:"page-btn"}," –ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª¬ª ",8,Rd)])])):x("",!0)])}const Jt=K(Yc,[["render",Nd],["__scopeId","data-v-79b44005"]]),Od={name:"ActivityDashboard",components:{MetricCard:Li,AdvancedFilters:Nl,TimeChart:Xt,DistributionChart:hc,UserRanking:Kc,ActivityDataTable:Jt},props:{initialFilters:{type:Object,default:()=>({dateFrom:null,dateTo:null,userId:null,type:null})},refreshInterval:{type:Number,default:3e5}},emits:["user-profile-request","filters-changed"],setup(n,{emit:e}){const s=y([]),t=y([]),r=()=>[{id:"total_entries",title:"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",value:0,previousValue:0,change:0,changePercent:0,trend:"neutral",icon:"üìä",color:"#2196F3",drillDownRoute:"activity-details"},{id:"unique_users",title:"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",value:0,previousValue:0,change:0,changePercent:0,trend:"neutral",icon:"üë•",color:"#4CAF50",drillDownRoute:"user-list"},{id:"total_sessions",title:"–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π",value:0,previousValue:0,change:0,changePercent:0,trend:"neutral",icon:"üéØ",color:"#FF9800",drillDownRoute:"session-analysis"},{id:"avg_session_duration",title:"–°—Ä. –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏",value:"0—Å",previousValue:"0—Å",change:0,changePercent:0,trend:"neutral",icon:"‚è±Ô∏è",color:"#9C27B0",drillDownRoute:"session-details"}],i=y(r()),o=y(!1),l=y(null),u=y({...n.initialFilters}),f=y("day"),p=y("activity_types"),g=y(!1),S=y(""),D=y(null);let E=null;const T=C(()=>{const N=u.value.dateFrom||"–Ω–∞—á–∞–ª–∞",Y=u.value.dateTo||"—Å–µ–π—á–∞—Å";return`${N} –ø–æ ${Y}`});C(()=>{try{return(Array.isArray(s.value)?s.value:[]).filter(Y=>{if(!Y||typeof Y!="object"||Y===null||!Y.user_id||typeof Y.user_id!="number"||!Y.timestamp||typeof Y.type!="string"||!Y.type.trim())return!1;try{const F=new Date(Y.timestamp);if(isNaN(F.getTime()))return!1}catch{return!1}return!0})}catch(N){return console.error("[ActivityDashboard] Error in safeActivityData:",N),[]}});const I=async()=>{o.value=!0,l.value=null;try{s.value=await Fe.getActivity({...u.value,limit:1e4}),t.value=s.value;const N=Ne.calculateDashboardMetrics(t.value),Y=h(N);i.value=Y}catch(N){l.value=N.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞",console.error("[ActivityDashboard] Error loading dashboard data:",N),i.value=r()}finally{o.value=!1}},h=N=>{if(!N||typeof N!="object")return console.warn("[ActivityDashboard] Invalid metrics format, using defaults"),r();try{return[{id:"total_entries",title:"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",value:N.total_entries?.value||0,previousValue:N.total_entries?.previousValue||0,change:N.total_entries?.change||0,changePercent:N.total_entries?.changePercent||0,trend:N.total_entries?.trend||"neutral",icon:"üìä",color:"#2196F3",drillDownRoute:"activity-details"},{id:"unique_users",title:"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",value:N.unique_users?.value||0,previousValue:N.unique_users?.previousValue||0,change:N.unique_users?.change||0,changePercent:N.unique_users?.changePercent||0,trend:N.unique_users?.trend||"neutral",icon:"üë•",color:"#4CAF50",drillDownRoute:"user-list"},{id:"total_sessions",title:"–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π",value:N.total_sessions?.value||0,previousValue:N.total_sessions?.previousValue||0,change:N.total_sessions?.change||0,changePercent:N.total_sessions?.changePercent||0,trend:N.total_sessions?.trend||"neutral",icon:"üéØ",color:"#FF9800",drillDownRoute:"session-analysis"},{id:"avg_session_duration",title:"–°—Ä. –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏",value:v(N.total_sessions?.value||0),previousValue:v(N.total_sessions?.previousValue||0),change:0,changePercent:0,trend:"neutral",icon:"‚è±Ô∏è",color:"#9C27B0",drillDownRoute:"session-details"}]}catch(Y){return console.error("[ActivityDashboard] Error formatting metrics:",Y),r()}},v=N=>{if(!N)return"0—Å";const Y=Math.floor(N/60),F=N%60;return Y>0?`${Y}–º ${F}—Å`:`${F}—Å`},w=N=>{u.value={...N},e("filters-changed",u.value),I()},U=N=>{g.value=!0,S.value=`–î–µ—Ç–∞–ª–∏: ${N.title}`,D.value={metric:N,filters:u.value,timestamp:new Date().toISOString()}},R=N=>{console.log("Time range changed:",N)},k=N=>{g.value=!0,S.value=`–î–µ—Ç–∞–ª–∏ —Å–µ–≥–º–µ–Ω—Ç–∞: ${N.label}`,D.value=N},_=N=>{e("user-profile-request",N)},b=N=>{console.log("Sort changed:",N)},P=N=>{console.log("Table export:",N)},z=()=>{g.value=!1,S.value="",D.value=null},O=()=>{I()},A=()=>{const N={filters:u.value,metrics:i.value,activityCount:t.value.length,timestamp:new Date().toISOString()},Y=JSON.stringify(N,null,2),F=new Blob([Y],{type:"application/json"}),J=URL.createObjectURL(F),te=document.createElement("a");te.href=J,te.download=`activity-dashboard-${new Date().toISOString().split("T")[0]}.json`,te.click()},j=()=>{E&&clearInterval(E),n.refreshInterval>0&&(E=setInterval(()=>{o.value||I()},n.refreshInterval))};return le(()=>{I(),j()}),ee(()=>n.initialFilters,N=>{u.value={...N},I()},{deep:!0}),{activityData:s,filteredActivityData:t,dashboardMetrics:i,loading:o,error:l,filters:u,timeGroupBy:f,distributionType:p,showDetailsModal:g,detailsModalTitle:S,detailsModalData:D,formatDateRange:T,handleFiltersChange:w,handleMetricDrillDown:U,handleTimeRangeChange:R,handleSegmentClick:k,handleUserSelect:_,handleSortChange:b,handleTableExport:P,closeDetailsModal:z,refresh:O,exportData:A,cleanup:()=>{E&&clearInterval(E)}}},beforeUnmount(){this.cleanup()}},Bd={class:"activity-dashboard"},Vd={class:"dashboard-header"},jd={class:"header-content"},zd={class:"dashboard-subtitle"},$d={class:"header-actions"},Wd=["disabled"],qd={key:0},Hd={key:1},Xd={class:"metrics-section"},Jd={class:"metrics-grid"},Kd={class:"filters-section"},Yd={class:"charts-section"},Gd={class:"chart-row"},Qd={class:"chart-container time-chart"},Zd={class:"chart-row"},eu={class:"chart-container distribution-chart"},tu={class:"chart-container user-ranking"},su={class:"data-table-section"},au={class:"modal-header"},ou={class:"modal-content"};function nu(n,e,s,t,r,i){const o=X("MetricCard"),l=X("AdvancedFilters"),u=X("TimeChart"),f=X("DistributionChart"),p=X("UserRanking"),g=X("ActivityDataTable");return c(),d("div",Bd,[a("div",Vd,[a("div",jd,[e[6]||(e[6]=a("h1",{class:"dashboard-title"},"üìä –î–∞—à–±–æ—Ä–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),a("p",zd," –ê–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å "+m(t.formatDateRange),1)]),a("div",$d,[a("button",{onClick:e[0]||(e[0]=(...S)=>t.refresh&&t.refresh(...S)),disabled:t.loading,class:"refresh-btn"},[t.loading?(c(),d("span",qd,"‚è≥")):(c(),d("span",Hd,"üîÑ")),Q(" "+m(t.loading?"–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...":"–û–±–Ω–æ–≤–∏—Ç—å"),1)],8,Wd),a("button",{onClick:e[1]||(e[1]=(...S)=>t.exportData&&t.exportData(...S)),class:"export-btn"}," üì• –≠–∫—Å–ø–æ—Ä—Ç ")])]),a("div",Xd,[a("div",Jd,[(c(!0),d(W,null,q(t.dashboardMetrics,S=>(c(),oe(o,{key:S.id,metric:S,onDrillDown:t.handleMetricDrillDown},null,8,["metric","onDrillDown"]))),128))])]),a("div",Kd,[G(l,{modelValue:t.filters,"onUpdate:modelValue":e[2]||(e[2]=S=>t.filters=S),onChange:t.handleFiltersChange},null,8,["modelValue","onChange"])]),a("div",Yd,[a("div",Gd,[a("div",Qd,[G(u,{data:n.safeActivityData,"group-by":t.timeGroupBy,filters:t.filters,title:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏",onTimeRangeChange:t.handleTimeRangeChange},null,8,["data","group-by","filters","onTimeRangeChange"])])]),a("div",Zd,[a("div",eu,[G(f,{data:n.safeActivityData,type:t.distributionType,title:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",onSegmentClick:t.handleSegmentClick},null,8,["data","type","onSegmentClick"])]),a("div",tu,[G(p,{data:n.safeActivityData,limit:10,title:"–¢–æ–ø –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",onUserSelect:t.handleUserSelect},null,8,["data","onUserSelect"])])])]),a("div",su,[G(g,{data:n.safeActivityData,loading:t.loading,filters:t.filters,onSortChange:t.handleSortChange,onExport:t.handleTableExport},null,8,["data","loading","filters","onSortChange","onExport"])]),t.showDetailsModal?(c(),d("div",{key:0,class:"details-modal-overlay",onClick:e[5]||(e[5]=(...S)=>t.closeDetailsModal&&t.closeDetailsModal(...S))},[a("div",{class:"details-modal",onClick:e[4]||(e[4]=pe(()=>{},["stop"]))},[a("div",au,[a("h3",null,m(t.detailsModalTitle),1),a("button",{onClick:e[3]||(e[3]=(...S)=>t.closeDetailsModal&&t.closeDetailsModal(...S)),class:"close-btn"},"‚úï")]),a("div",ou,[a("pre",null,m(JSON.stringify(t.detailsModalData,null,2)),1)])])])):x("",!0)])}const ru=K(Od,[["render",nu],["__scopeId","data-v-2711895c"]]),iu={name:"UserProfileAnalysis",components:{TimeChart:Xt,ActivityDataTable:Jt},props:{userId:{type:Number,required:!0},filters:{type:Object,default:()=>({})}},emits:["back","export"],setup(n,{emit:e}){const s=y(null),t=y([]),r=y(!1),i=y(null),o=y("day"),l=y("timeline"),u=y("week"),f=y(null),p=C(()=>s.value?.sessions?[...s.value.sessions].sort((A,j)=>new Date(j.startTime)-new Date(A.startTime)):[]),g=C(()=>s.value?.sessions?.length?s.value.sessions.reduce((j,fe)=>j+fe.duration,0)/s.value.sessions.length:0),S=async()=>{r.value=!0,i.value=null;try{const A=await Fe.getUserProfileAnalytics(n.userId,n.filters);s.value=A,t.value=A.activity,await D()}catch(A){i.value=A.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",console.error("[UserProfileAnalysis] Error loading user profile:",A),s.value={user:{name:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",id:n.userId},analytics:{total_actions:0,total_sessions:0,avg_session_duration:0,favorite_page:null,peak_hour:0,device_preference:"unknown",first_visit:null,last_visit:null},sessions:[]},t.value=[]}finally{r.value=!1}},D=async()=>{try{const A=new Date;let j,fe,N,Y;switch(u.value){case"week":j=new Date(A.getTime()-7*24*60*60*1e3),fe=A,N=new Date(A.getTime()-14*24*60*60*1e3),Y=new Date(A.getTime()-7*24*60*60*1e3);break;case"month":j=new Date(A.getFullYear(),A.getMonth(),1),fe=A,N=new Date(A.getFullYear(),A.getMonth()-1,1),Y=new Date(A.getFullYear(),A.getMonth(),0);break;case"quarter":const de=Math.floor(A.getMonth()/3);j=new Date(A.getFullYear(),de*3,1),fe=A,N=new Date(A.getFullYear(),(de-1)*3,1),Y=new Date(A.getFullYear(),de*3,0);break}const F={...n.filters,dateFrom:j.toISOString().split("T")[0],dateTo:fe.toISOString().split("T")[0]},J={...n.filters,dateFrom:N.toISOString().split("T")[0],dateTo:Y.toISOString().split("T")[0]},[te,ne]=await Promise.all([Fe.getUserActivity(n.userId,F),Fe.getUserActivity(n.userId,J)]),se=Ne.analyzeUserSessions(te),ie=Ne.analyzeUserSessions(ne);f.value={current:{actions:te.length,sessions:se.length,avgDuration:se.length>0?se.reduce((de,he)=>de+he.duration,0)/se.length:0},previous:{actions:ne.length,sessions:ie.length,avgDuration:ie.length>0?ie.reduce((de,he)=>de+he.duration,0)/ie.length:0},change:{actions:te.length-ne.length,sessions:se.length-ie.length,avgDuration:(se.length>0?se.reduce((de,he)=>de+he.duration,0)/se.length:0)-(ie.length>0?ie.reduce((de,he)=>de+he.duration,0)/ie.length:0)},changePercent:{actions:ne.length>0?(te.length-ne.length)/ne.length*100:0,sessions:ie.length>0?(se.length-ie.length)/ie.length*100:0,avgDuration:0}}}catch(A){console.error("[UserProfileAnalysis] Error loading comparison data:",A)}},E=()=>{const A={userId:n.userId,profile:s.value,activity:t.value,filters:n.filters,timestamp:new Date().toISOString()};e("export",A)},T=A=>{console.log("Time range changed:",A)},I=A=>{console.log("Sort changed:",A)},h=A=>{console.log("Export data:",A)},v=A=>{if(!A)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{return new Date(A).toLocaleDateString("ru-RU")}catch{return A}},w=A=>ce.formatTimestamp(A),U=A=>ce.formatDuration(A),R=A=>({desktop:"–ö–æ–º–ø—å—é—Ç–µ—Ä",mobile:"–ú–æ–±–∏–ª—å–Ω—ã–π",tablet:"–ü–ª–∞–Ω—à–µ—Ç",unknown:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"})[A]||A||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",k=A=>A==null?"–ù–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω":`${A}:00`,_=A=>{const j=A.duration||0;return j<5*60*1e3?"session-short":j<15*60*1e3?"session-medium":"session-long"},b=A=>ce.getSessionColor(A),P=A=>{switch(A){case"app_entry":return"–í—Ö–æ–¥";case"page_visit":return"–ü–µ—Ä–µ—Ö–æ–¥";default:return A}},z=A=>A>0?"positive":A<0?"negative":"neutral",O=A=>A===0?"0%":`${A>0?"+":""}${A.toFixed(1)}%`;return ee(()=>n.userId,()=>{S()}),ee(()=>n.filters,()=>{S()},{deep:!0}),ee(u,()=>{D()}),le(()=>{S()}),{userProfile:s,userActivity:t,loading:r,error:i,chartGroupBy:o,sessionViewMode:l,comparisonPeriod:u,comparisonData:f,sortedSessions:p,avgSessionDuration:g,loadUserProfile:S,exportProfile:E,handleTimeRangeChange:T,handleSortChange:I,handleExport:h,formatDate:v,formatTimestamp:w,formatDuration:U,formatDevice:R,formatHour:k,getSessionClass:_,getSessionColor:b,getActionLabel:P,getChangeClass:z,formatChange:O}}},lu={class:"user-profile-analysis"},cu={class:"profile-header"},du={class:"header-content"},uu={class:"user-info"},mu={class:"user-name"},gu={class:"user-details"},fu={key:0},hu={class:"header-actions"},vu={key:0,class:"profile-summary"},pu={class:"summary-cards"},yu={class:"summary-card"},_u={class:"card-content"},bu={class:"card-value"},wu={class:"summary-card"},ku={class:"card-content"},Cu={class:"card-value"},Su={class:"summary-card"},Du={class:"card-content"},Tu={class:"card-value"},xu={class:"summary-card"},Au={class:"card-content"},Eu={class:"card-value"},Mu={key:1,class:"profile-stats"},Iu={class:"stats-grid"},Lu={class:"stat-item"},Pu={class:"stat-value"},Fu={class:"stat-item"},Uu={class:"stat-value"},Ru={class:"stat-item"},Nu={class:"stat-value"},Ou={class:"stat-item"},Bu={class:"stat-value"},Vu={class:"stat-item"},ju={class:"stat-value"},zu={class:"stat-item"},$u={class:"stat-value"},Wu={class:"activity-chart-section"},qu={class:"chart-container"},Hu={key:1,class:"no-data"},Xu={key:2,class:"sessions-section"},Ju={class:"sessions-controls"},Ku={class:"session-stats"},Yu={class:"stat"},Gu={class:"stat"},Qu={key:0,class:"sessions-timeline"},Zu={class:"timeline-container"},em={class:"timeline-content"},tm={class:"session-header"},sm={class:"session-time"},am={class:"session-duration"},om={class:"session-details"},nm={class:"session-stats"},rm={key:0,class:"session-actions"},im={key:1,class:"sessions-list"},lm={class:"session-info"},cm={class:"session-time-range"},dm={class:"session-meta"},um={class:"session-device"},mm={class:"detailed-activity-section"},gm={class:"comparison-section"},fm={class:"comparison-controls"},hm={key:0,class:"comparison-results"},vm={class:"comparison-metrics"},pm={class:"metric-comparison"},ym={class:"metric-values"},_m={class:"current"},bm={class:"previous"},wm={class:"metric-comparison"},km={class:"metric-values"},Cm={class:"current"},Sm={class:"previous"},Dm={class:"metric-comparison"},Tm={class:"metric-values"},xm={class:"current"},Am={class:"previous"},Em={key:3,class:"loading-overlay"},Mm={key:4,class:"error-message"};function Im(n,e,s,t,r,i){const o=X("TimeChart"),l=X("ActivityDataTable");return c(),d("div",lu,[a("div",cu,[a("div",du,[a("button",{onClick:e[0]||(e[0]=u=>n.$emit("back")),class:"back-btn"},"‚Üê –ù–∞–∑–∞–¥"),a("div",uu,[a("h1",mu,m(t.userProfile?.user?.name||"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"),1),a("p",gu,[Q(" ID: "+m(s.userId)+" ",1),t.userProfile?.user?.email?(c(),d("span",fu,"‚Ä¢ "+m(t.userProfile.user.email),1)):x("",!0)])])]),a("div",hu,[a("button",{onClick:e[1]||(e[1]=(...u)=>t.exportProfile&&t.exportProfile(...u)),class:"export-btn"}," üì• –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ—Ñ–∏–ª—è ")])]),t.userProfile&&t.userProfile.analytics?(c(),d("div",vu,[a("div",pu,[a("div",yu,[e[6]||(e[6]=a("div",{class:"card-icon"},"üìÖ",-1)),a("div",_u,[a("div",bu,m(t.userProfile.analytics.first_visit?t.formatDate(t.userProfile.analytics.first_visit):"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e[5]||(e[5]=a("div",{class:"card-label"},"–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥",-1))])]),a("div",wu,[e[8]||(e[8]=a("div",{class:"card-icon"},"‚è∞",-1)),a("div",ku,[a("div",Cu,m(t.userProfile.analytics.last_visit?t.formatDate(t.userProfile.analytics.last_visit):"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e[7]||(e[7]=a("div",{class:"card-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥",-1))])]),a("div",Su,[e[10]||(e[10]=a("div",{class:"card-icon"},"üéØ",-1)),a("div",Du,[a("div",Tu,m(t.userProfile.analytics.total_sessions||0),1),e[9]||(e[9]=a("div",{class:"card-label"},"–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π",-1))])]),a("div",xu,[e[12]||(e[12]=a("div",{class:"card-icon"},"üìä",-1)),a("div",Au,[a("div",Eu,m(t.userProfile.analytics.total_actions||0),1),e[11]||(e[11]=a("div",{class:"card-label"},"–í—Å–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–π",-1))])])])])):x("",!0),t.userProfile&&t.userProfile.analytics?(c(),d("div",Mu,[e[19]||(e[19]=a("h2",{class:"section-title"},"üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),a("div",Iu,[a("div",Lu,[e[13]||(e[13]=a("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–∏",-1)),a("div",Pu,m(t.formatDuration(t.userProfile.analytics.avg_session_duration||0)),1)]),a("div",Fu,[e[14]||(e[14]=a("div",{class:"stat-label"},"–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ",-1)),a("div",Uu,m(t.formatDevice(t.userProfile.analytics.device_preference||"unknown")),1)]),a("div",Ru,[e[15]||(e[15]=a("div",{class:"stat-label"},"–õ—é–±–∏–º–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",-1)),a("div",Nu,m(t.userProfile.analytics.favorite_page||"–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞"),1)]),a("div",Ou,[e[16]||(e[16]=a("div",{class:"stat-label"},"–ü–∏–∫–æ–≤—ã–π —á–∞—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),a("div",Bu,m(t.formatHour(t.userProfile.analytics.peak_hour||0)),1)]),a("div",Vu,[e[17]||(e[17]=a("div",{class:"stat-label"},"–û–±—â–µ–µ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",-1)),a("div",ju,m(t.formatDuration(t.userProfile.analytics.total_duration||0)),1)]),a("div",zu,[e[18]||(e[18]=a("div",{class:"stat-label"},"Retention (–¥–Ω–∏)",-1)),a("div",$u,m(t.userProfile.analytics.retention_days||0)+" –¥–Ω–µ–π",1)])])])):x("",!0),a("div",Wu,[e[20]||(e[20]=a("h2",{class:"section-title"},"üìà –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),a("div",qu,[t.userActivity.length>0?(c(),oe(o,{key:0,data:t.userActivity,"group-by":t.chartGroupBy,title:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏",onTimeRangeChange:t.handleTimeRangeChange},null,8,["data","group-by","onTimeRangeChange"])):(c(),d("div",Hu," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ "))])]),t.userProfile&&t.userProfile.sessions&&t.userProfile.sessions.length>0?(c(),d("div",Xu,[e[22]||(e[22]=a("h2",{class:"section-title"},"üé≠ –°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",-1)),a("div",Ju,[H(a("select",{"onUpdate:modelValue":e[2]||(e[2]=u=>t.sessionViewMode=u),class:"view-mode-select"},[...e[21]||(e[21]=[a("option",{value:"timeline"},"–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è",-1),a("option",{value:"list"},"–°–ø–∏—Å–æ–∫",-1)])],512),[[re,t.sessionViewMode]]),a("div",Ku,[a("span",Yu,"–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π: "+m(t.userProfile.sessions.length),1),a("span",Gu,"–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: "+m(t.formatDuration(t.avgSessionDuration)),1)])]),t.sessionViewMode==="timeline"?(c(),d("div",Qu,[a("div",Zu,[(c(!0),d(W,null,q(t.sortedSessions,u=>(c(),d("div",{key:u.id,class:B(["timeline-item",t.getSessionClass(u)])},[a("div",{class:"timeline-marker",style:xe({backgroundColor:t.getSessionColor(u)})},null,4),a("div",em,[a("div",tm,[a("div",sm,m(t.formatTimestamp(u.startTime)),1),a("div",am,m(t.formatDuration(u.duration)),1)]),a("div",om,[a("div",nm,[a("span",null,m(u.entriesCount)+" –¥–µ–π—Å—Ç–≤–∏–π",1),a("span",null,m(u.pageCount)+" —Å—Ç—Ä–∞–Ω–∏—Ü",1),a("span",null,m(u.device||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),u.actions?(c(),d("div",rm,[(c(!0),d(W,null,q(Object.entries(u.actions),([f,p],g)=>(c(),d("span",{key:f,class:"action-badge"},m(t.getActionLabel(f))+": "+m(p),1))),128))])):x("",!0)])])],2))),128))])])):(c(),d("div",im,[(c(!0),d(W,null,q(t.sortedSessions,u=>(c(),d("div",{class:"session-item",key:u.id},[a("div",lm,[a("div",cm,m(t.formatTimestamp(u.startTime))+" ‚Äî "+m(t.formatTimestamp(u.endTime)),1),a("div",dm," –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: "+m(t.formatDuration(u.duration))+" | –î–µ–π—Å—Ç–≤–∏–π: "+m(u.entriesCount)+" | –°—Ç—Ä–∞–Ω–∏—Ü: "+m(u.pageCount),1)]),a("div",um,m(u.device||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]))),128))]))])):x("",!0),a("div",mm,[e[23]||(e[23]=a("h2",{class:"section-title"},"üìã –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1)),G(l,{data:t.userActivity,loading:t.loading,onSortChange:t.handleSortChange,onExport:t.handleExport},null,8,["data","loading","onSortChange","onExport"])]),a("div",gm,[e[31]||(e[31]=a("h2",{class:"section-title"},"‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤",-1)),a("div",fm,[H(a("select",{"onUpdate:modelValue":e[3]||(e[3]=u=>t.comparisonPeriod=u),class:"period-select"},[...e[24]||(e[24]=[a("option",{value:"week"},"–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è vs –ø—Ä–µ–¥—ã–¥—É—â–∞—è",-1),a("option",{value:"month"},"–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü vs –ø—Ä–µ–¥—ã–¥—É—â–∏–π",-1),a("option",{value:"quarter"},"–¢–µ–∫—É—â–∏–π –∫–≤–∞—Ä—Ç–∞–ª vs –ø—Ä–µ–¥—ã–¥—É—â–∏–π",-1)])],512),[[re,t.comparisonPeriod]])]),t.comparisonData?(c(),d("div",hm,[a("div",vm,[a("div",pm,[e[26]||(e[26]=a("div",{class:"metric-name"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π",-1)),a("div",ym,[a("span",_m,m(t.comparisonData.current?.actions||0),1),e[25]||(e[25]=a("span",{class:"vs"},"vs",-1)),a("span",bm,m(t.comparisonData.previous?.actions||0),1),a("span",{class:B(["change",t.getChangeClass(t.comparisonData.change?.actions||0)])},m(t.formatChange(t.comparisonData.changePercent?.actions||0)),3)])]),a("div",wm,[e[28]||(e[28]=a("div",{class:"metric-name"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π",-1)),a("div",km,[a("span",Cm,m(t.comparisonData.current?.sessions||0),1),e[27]||(e[27]=a("span",{class:"vs"},"vs",-1)),a("span",Sm,m(t.comparisonData.previous?.sessions||0),1),a("span",{class:B(["change",t.getChangeClass(t.comparisonData.change?.sessions||0)])},m(t.formatChange(t.comparisonData.changePercent?.sessions||0)),3)])]),a("div",Dm,[e[30]||(e[30]=a("div",{class:"metric-name"},"–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏",-1)),a("div",Tm,[a("span",xm,m(t.formatDuration(t.comparisonData.current?.avgDuration||0)),1),e[29]||(e[29]=a("span",{class:"vs"},"vs",-1)),a("span",Am,m(t.formatDuration(t.comparisonData.previous?.avgDuration||0)),1),a("span",{class:B(["change",t.getChangeClass(t.comparisonData.change?.avgDuration||0)])},m(t.formatChange(t.comparisonData.changePercent?.avgDuration||0)),3)])])])])):x("",!0)]),t.loading?(c(),d("div",Em,[...e[32]||(e[32]=[a("div",{class:"loading-content"},[a("div",{class:"loading-spinner"}),a("div",{class:"loading-text"},"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...")],-1)])])):x("",!0),t.error?(c(),d("div",Mm,[Q(m(t.error)+" ",1),a("button",{onClick:e[4]||(e[4]=(...u)=>t.loadUserProfile&&t.loadUserProfile(...u)),class:"retry-btn"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):x("",!0)])}const Lm=K(iu,[["render",Im],["__scopeId","data-v-e987c9ec"]]),Pm={name:"UserActivityList",components:{UserActivityCard:Lr,HiddenUsersManager:Wt,UserActivityFilters:qt,UserActivityStats:Ht,ActivityDashboard:ru,UserProfileAnalysis:Lm},props:{userId:{type:Number,default:null},dateFrom:{type:String,default:null},dateTo:{type:String,default:null},type:{type:String,default:null}},emits:["view-details"],setup(n,{emit:e}){const s=y("list"),t=y(null),r=y([]),i=y(!1),o=y(null),l=y({userId:n.userId,dateFrom:n.dateFrom,dateTo:n.dateTo,type:n.type}),u=y([]),f=C(()=>{try{if(!Array.isArray(r.value))return[];const w=r.value.filter(U=>U&&typeof U=="object"&&U!==null&&U.user_id&&U.timestamp&&typeof U.type=="string");return $t(w)}catch(w){return console.warn("[UserActivityList] Error filtering activity:",w),[]}}),p=async()=>{i.value=!0,o.value=null;try{r.value=await Fe.getActivity(l.value);const w=new Map;r.value.forEach(U=>{U.user_id&&!w.has(U.user_id)&&w.set(U.user_id,{ID:U.user_id,NAME:U.user_name||"",LAST_NAME:"",EMAIL:U.user_email||""})}),u.value=Array.from(w.values())}catch(w){o.value=w.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",console.error("[UserActivityList] Error:",w)}finally{i.value=!1}},g=()=>{s.value="dashboard"},S=w=>{t.value=w.id,s.value="profile"},D=()=>{s.value="list"},E=w=>{e("view-details",w)},T=w=>{l.value={...w},p()},I=w=>{console.log("Export profile:",w)},h=w=>w?`${w.timestamp||"no-timestamp"}-${w.user_id||"no-user"}-${w.type||"no-type"}-${w.route_path||""}`:"undefined-entry",v=()=>{p()};return le(()=>{p(),window.addEventListener("hidden-users-changed",v)}),Be(()=>{window.removeEventListener("hidden-users-changed",v)}),ee(()=>[n.userId,n.dateFrom,n.dateTo,n.type],()=>{l.value={userId:n.userId,dateFrom:n.dateFrom,dateTo:n.dateTo,type:n.type},p()},{deep:!0}),{viewMode:s,selectedUserId:t,activity:f,loading:i,error:o,filters:l,availableUsers:u,switchToDashboard:g,switchToUserProfile:S,switchToList:D,handleViewDetails:E,handleFiltersUpdate:T,handleProfileExport:I,getEntryKey:h}}},Fm={class:"user-activity-container"},Um={key:0,class:"user-activity-list"},Rm={class:"list-header"},Nm={class:"header-actions"},Om={class:"filters-section"},Bm={key:0,class:"loading"},Vm={key:1,class:"error"},jm={key:2,class:"empty"},zm={key:3,class:"activity-items"},$m={key:1,class:"analysis-dashboard"},Wm={key:1,class:"loading-state"},qm={key:2,class:"user-profile"},Hm={key:1,class:"loading-state"};function Xm(n,e,s,t,r,i){const o=X("HiddenUsersManager"),l=X("UserActivityFilters"),u=X("UserActivityStats"),f=X("UserActivityCard"),p=X("ActivityDashboard"),g=X("UserProfileAnalysis");return c(),d("div",Fm,[t.viewMode==="list"?(c(),d("div",Um,[a("div",Rm,[e[1]||(e[1]=a("div",{class:"header-info"},[a("h2",{class:"list-title"},"üìã –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),a("p",{class:"list-subtitle"}," –ê–Ω–∞–ª–∏–∑ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ ")],-1)),a("div",Nm,[a("button",{onClick:e[0]||(e[0]=(...S)=>t.switchToDashboard&&t.switchToDashboard(...S)),class:"dashboard-btn"}," üìä –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏–∑–∞ ")])]),a("div",Om,[G(o,{filters:t.filters},null,8,["filters"]),G(l,{filters:t.filters,users:t.availableUsers,onUpdateFilters:t.handleFiltersUpdate},null,8,["filters","users","onUpdateFilters"])]),G(u,{filters:t.filters},null,8,["filters"]),t.loading?(c(),d("div",Bm," –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏... ")):t.error?(c(),d("div",Vm,m(t.error),1)):t.activity.length===0?(c(),d("div",jm," –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ")):(c(),d("div",zm,[n.entry&&typeof n.entry=="object"&&n.entry.user_id&&n.entry.timestamp&&typeof n.entry.type=="string"?(c(!0),d(W,{key:0},q(t.activity,S=>(c(),oe(f,{key:t.getEntryKey(S),entry:S,onClick:D=>t.handleViewDetails(S)},null,8,["entry","onClick"]))),128)):x("",!0)]))])):t.viewMode==="dashboard"?(c(),d("div",$m,[t.loading?(c(),d("div",Wm," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞ –∞–Ω–∞–ª–∏–∑–∞... ")):(c(),oe(p,{key:0,"initial-filters":t.filters,onUserProfileRequest:t.switchToUserProfile},null,8,["initial-filters","onUserProfileRequest"]))])):t.viewMode==="profile"?(c(),d("div",qm,[t.selectedUserId&&!t.loading?(c(),oe(g,{key:0,"user-id":t.selectedUserId,filters:t.filters,onBack:t.switchToDashboard,onExport:t.handleProfileExport},null,8,["user-id","filters","onBack","onExport"])):(c(),d("div",Hm," –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è... "))])):x("",!0)])}const Jm=K(Pm,[["render",Xm],["__scopeId","data-v-7bae796b"]]),Km={name:"UsersManagementPage",components:{UserActivityList:Jm,UserActivityFilters:qt,UserActivityStats:Ht,HiddenUsersManager:Wt},setup(){const n=Ke(),e=y([]),s=y({userId:null,type:null,dateFrom:null,dateTo:null}),t=async()=>{try{const f=await new ls().getUsersList();e.value=f}catch(u){console.error("[UsersManagementPage] Error loading users:",u)}},r=u=>{s.value={...u}},i=u=>{console.log("View activity details:",u)},o=()=>{window.dispatchEvent(new CustomEvent("hidden-users-changed"))},l=()=>{n.push("/")};return le(async()=>{try{if(!(await Re.checkAccess()).allowed){n.push("/");return}if(!await Re.getCurrentUser()){n.push("/");return}await t()}catch(u){console.error("[UsersManagementPage] Error:",u),n.push("/")}}),{users:e,activityFilters:s,handleFiltersUpdate:r,handleViewActivityDetails:i,handleHiddenUsersChanged:o,goBack:l}}},Ym={class:"users-management-page"},Gm={class:"page-header"},Qm={class:"page-header-top"},Zm={class:"page-content"},eg={class:"activity-section"};function tg(n,e,s,t,r,i){const o=X("UserActivityFilters"),l=X("HiddenUsersManager"),u=X("UserActivityStats"),f=X("UserActivityList");return c(),d("div",Ym,[a("div",Gm,[a("div",Qm,[a("button",{onClick:e[0]||(e[0]=(...p)=>t.goBack&&t.goBack(...p)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[a("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),a("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=a("h1",null,"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",-1))]),a("div",Zm,[a("div",eg,[e[3]||(e[3]=a("h2",null,"üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),G(o,{filters:t.activityFilters,users:t.users,onUpdateFilters:t.handleFiltersUpdate},null,8,["filters","users","onUpdateFilters"]),G(l,{filters:t.activityFilters,onHiddenUsersChanged:t.handleHiddenUsersChanged},null,8,["filters","onHiddenUsersChanged"]),G(u,{filters:t.activityFilters},null,8,["filters"]),G(f,{userId:t.activityFilters.userId,dateFrom:t.activityFilters.dateFrom,dateTo:t.activityFilters.dateTo,type:t.activityFilters.type,onViewDetails:t.handleViewActivityDetails},null,8,["userId","dateFrom","dateTo","type","onViewDetails"])])])])}const sg=K(Km,[["render",tg],["__scopeId","data-v-d7aa0377"]]);class ae{static async getCacheStatus(){try{const e=Te("/api/admin/cache-status.php"),s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok){const r=await s.text();throw new Error(`HTTP error! status: ${s.status}, message: ${r}`)}const t=await s.json();if(t.success){const r=t.modules||[];return r.length===0?{primaryModules:[],secondaryModules:[],metadata:{totalModules:0,primaryCount:0,secondaryCount:0}}:this.categorizeAndSortModules(r)}else throw new Error(t.error||"Failed to get cache status")}catch(e){throw console.error("[CacheManagementService] Error getting cache status:",e),e}}static async clearCache(e){try{const s=Te("/api/admin/cache-clear.php"),t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,confirm:!0})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return!0;throw new Error(r.error||"Failed to clear cache")}catch(s){throw console.error("[CacheManagementService] Error clearing cache:",s),s}}static async getCacheStats(){try{const e=Te("/api/admin/cache-stats.php"),s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();if(t.success)return t.stats||{};throw new Error(t.error||"Failed to get cache stats")}catch(e){throw console.error("[CacheManagementService] Error getting cache stats:",e),e}}static formatCacheSize(e){if(e===0)return"0 B";const s=1024,t=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(s));return Math.round(e/Math.pow(s,r)*100)/100+" "+t[r]}static categorizeAndSortModules(e,s={}){const t=this.generateCacheKey(e),r=this.getCachedResult(t);if(r&&!s.forceRefresh)return r;const i=performance.now(),o=this.performCategorization(e),l=performance.now();return o.metadata={processingTime:l-i,totalModules:e.length,primaryCount:o.primaryModules.length,secondaryCount:o.secondaryModules.length,cached:!1},this.setCachedResult(t,o),o}static performCategorization(e){const s=[],t=[];return e.forEach(r=>{this.validateModule(r),this.PRIMARY_MODULE_IDS.includes(r.id)?s.push({...r,category:"primary",priority:this.PRIMARY_MODULE_PRIORITIES[r.id]||999}):t.push({...r,category:"secondary",groupType:this.getModuleType(r.id)})}),{primaryModules:this.sortPrimaryModules(s),secondaryModules:this.sortSecondaryModules(t)}}static sortPrimaryModules(e){return e.sort((s,t)=>{const r=this.PRIMARY_MODULE_PRIORITIES[s.id]||999,i=this.PRIMARY_MODULE_PRIORITIES[t.id]||999;return r-i})}static sortSecondaryModules(e){return e.sort((s,t)=>{const r=this.getModuleType(s.id),i=this.getModuleType(t.id);return r!==i?this.compareModuleTypes(r,i):s.name.localeCompare(t.name)})}static compareModuleTypes(e,s){const t=["users","activity","webhooks","other"],r=t.indexOf(e),i=t.indexOf(s);return(r===-1?999:r)-(i===-1?999:i)}static getModuleType(e){for(const[s,t]of Object.entries(this.SECONDARY_MODULE_TYPES))if(e.startsWith(t.prefix))return s;return e.includes("time-tracking")?"time-tracking":e.includes("graph")?"graphs":e.includes("dashboard")?"dashboards":"other"}static getModuleTypeConfig(e){return this.SECONDARY_MODULE_TYPES[e]||{title:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏",description:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã"}}static validateModule(e){if(!e||typeof e!="object")throw new Error("Module must be an object");if(!e.id||typeof e.id!="string")throw new Error("Module must have a valid id");if(!e.name||typeof e.name!="string")throw new Error("Module must have a valid name");return!0}static generateCacheKey(e){const s=e.map(t=>t.id).sort().join(",");return btoa(s).substring(0,16)}static getCachedResult(e){const s=this.categorizationCache.get(e);return s?Date.now()-s.timestamp>this.CACHE_TTL?(this.categorizationCache.delete(e),null):{...s.data,metadata:{...s.data.metadata,cached:!0}}:null}static setCachedResult(e,s){if(this.categorizationCache.set(e,{data:{...s,metadata:{...s.metadata,cached:!1}},timestamp:Date.now()}),this.categorizationCache.size>10){const t=this.categorizationCache.keys().next().value;this.categorizationCache.delete(t)}}static clearCategorizationCache(){this.categorizationCache.clear()}static getCategorizationStats(){return{cacheSize:this.categorizationCache.size,cacheEntries:Array.from(this.categorizationCache.entries()).map(([e,s])=>({key:e,age:Date.now()-s.timestamp,modulesCount:s.data.primaryModules.length+s.data.secondaryModules.length}))}}static formatTTL(e){return e<60?`${e} —Å–µ–∫`:e<3600?`${Math.floor(e/60)} –º–∏–Ω`:`${Math.floor(e/3600)} —á`}static formatCreationTime(e){return e<1e3?`${Math.round(e)}–º—Å`:e<6e4?`${Math.round(e/1e3*10)/10}—Å–µ–∫`:`${Math.round(e/6e4*10)/10}–º–∏–Ω`}static formatCacheHitRatio(e){return`${Math.round(e*100)}%`}static formatDataFreshness(e){return`${Math.round(e*100)}%`}static getExpiryColor(e){if(!e)return"gray";const s=Date.now()/1e3,t=(e-s)/3600;return t>2?"green":t>.5?"yellow":"red"}static getEfficiencyColor(e){return e>=.85?"green":e>=.7?"yellow":"red"}static getCreationTimeColor(e){return e<=2e3?"green":e<=1e4?"yellow":"red"}static getFreshnessColor(e){return e>=.9?"green":e>=.7?"yellow":"red"}static generateModuleMetadata(e){const s=Math.floor(Date.now()/1e3),t=e.metadata||{},r=this.PRIMARY_MODULE_IDS.includes(e.id);return{version:t.version||"1.0",module_id:e.id,module_name:e.name,created_at:t.created_at||s-Math.random()*86400*7,created_by:t.created_by||(Math.random()>.5?"system":"cron"),creation_time_ms:t.creation_time_ms||500+Math.random()*9500,last_accessed_at:t.last_accessed_at||s-Math.random()*3600,access_count:t.access_count||Math.floor(Math.random()*100)+1,expires_at:t.expires_at||s+(e.ttl||3600),ttl_seconds:e.ttl||3600,file_size_bytes:e.total_size||Math.floor(Math.random()*1e7)+1e6,compression_ratio:t.compression_ratio||.7+Math.random()*.3,data_version:t.data_version||`2026.01.12.v${Math.floor(Math.random()*10)+1}`,source_params:t.source_params||{period:r?Math.random()>.5?"weeks":"months":"default",sector_id:e.id.includes("sector-1c")?"1c":"all",filters:Math.random()>.5?["active_only"]:[],limit:Math.floor(Math.random()*1e3)+500},performance_metrics:t.performance_metrics||{avg_response_time_ms:20+Math.random()*80,cache_hit_ratio:.7+Math.random()*.3,data_freshness_score:.8+Math.random()*.2}}}static enrichModulesWithMetadata(e){return e.map(s=>({...s,metadata:this.generateModuleMetadata(s)}))}}Me(ae,"PRIMARY_MODULE_IDS",["dashboard-sector-1c","graph-state","graph-admission-closure-weeks","graph-admission-closure-months","time-tracking-default","time-tracking-detailed","time-tracking-summary"]),Me(ae,"PRIMARY_MODULE_PRIORITIES",{"dashboard-sector-1c":1,"graph-state":2,"graph-admission-closure-weeks":3,"graph-admission-closure-months":4,"time-tracking-default":5,"time-tracking-detailed":6,"time-tracking-summary":7}),Me(ae,"SECONDARY_MODULE_TYPES",{users:{prefix:"users-management",title:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –æ—Ç–¥–µ–ª–∞–º–∏"},activity:{prefix:"user-activity",title:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",description:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},webhooks:{prefix:"webhook-logs",title:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",description:"–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±—Ö—É–∫–æ–≤"}}),Me(ae,"categorizationCache",new Map),Me(ae,"CACHE_TTL",3e4);function ag(n){const e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),s=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-s);const t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}class lt{static async createCache(e,s=null,t={}){try{const r=Te("/api/admin/cache-create.php"),i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,mode:s,params:t})});if(!i.ok){const l=await i.json().catch(()=>({}));throw new Error(l.error||`HTTP error! status: ${i.status}`)}const o=await i.json();if(o.success)return o;throw new Error(o.error||"Failed to create cache")}catch(r){throw console.error("[CacheCreationService] Error creating cache:",r),r}}static async getCreationStatus(e){try{const s=Te(`/api/admin/cache-create-status.php?task_id=${e}`),t=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return r;throw new Error(r.error||"Failed to get creation status")}catch(s){throw console.error("[CacheCreationService] Error getting creation status:",s),s}}static getDefaultParams(e){if(e.includes("graph-admission-closure"))if((e.includes("weeks")?"weeks":"months")==="weeks"){const t=new Date,r=t.getUTCFullYear(),i=ag(t),o=new Date(r,0,1+(i-1)*7),l=o.getUTCDay(),u=o.getUTCDate()-l+(l===0?-6:1);o.setUTCDate(u),o.setUTCHours(0,0,0,0);const f=new Date(o);return f.setUTCDate(o.getUTCDate()+6),f.setUTCHours(23,59,59,999),{product:"1C",periodMode:"weeks",weekStartUtc:o.toISOString(),weekEndUtc:f.toISOString(),includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,useCache:!0,forceRefresh:!0}}else return{product:"1C",periodMode:"months",includeTickets:!0,includeNewTicketsByStages:!1,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!1};if(e.includes("dashboard-sector-1c"))return{forceRefresh:!0,ttl:600};if(e.includes("graph-state"))return{type:"current",forceRefresh:!0,ttl:3600};if(e.includes("time-tracking")){const s=e.includes("detailed")?"detailed":e.includes("summary")?"summary":"default";return{product:"1C",includeTaskDetails:s==="detailed",summary:s==="summary"}}return{}}}class Ze{static notifyCacheCreationStarted(e){this.showNotification({content:`–ù–∞—á–∞—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}"...`,type:"info",autoHideDelay:3e3})}static notifyCacheCreationSuccess(e){this.showNotification({content:`‚úÖ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,type:"success",autoHideDelay:5e3})}static notifyCacheCreationError(e,s){this.showNotification({content:`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}": ${s}`,type:"error",autoHideDelay:7e3})}static notifyCacheUpdated(e,s="auto"){const t=s==="manual"?"–≤—Ä—É—á–Ω—É—é":"–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏";this.showNotification({content:`üîÑ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" –æ–±–Ω–æ–≤–ª—ë–Ω ${t}`,type:"info",autoHideDelay:4e3})}static notifyCacheUsed(e){this.showNotification({content:`‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}"`,type:"success",autoHideDelay:3e3})}static showNotification(e){typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:e.content,autoHideDelay:e.autoHideDelay||3e3}):console.log("[CacheNotification]",e.content)}}const fv=Object.freeze(Object.defineProperty({__proto__:null,CacheNotificationService:Ze},Symbol.toStringTag,{value:"Module"})),og={name:"CacheCreateProgress",props:{progress:{type:Number,required:!0,validator:n=>n>=0&&n<=100},message:{type:String,default:"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞..."}}},ng={class:"cache-create-progress"},rg={class:"progress-bar"},ig={class:"progress-text"};function lg(n,e,s,t,r,i){return c(),d("div",ng,[a("div",rg,[a("div",{class:"progress-fill",style:xe({width:s.progress+"%"})},null,4)]),a("div",ig,m(s.progress)+"% - "+m(s.message),1)])}const cg=K(og,[["render",lg],["__scopeId","data-v-7071de3b"]]),dg={name:"CacheCreateModal",components:{CacheCreateProgress:cg},props:{module:{type:Object,required:!0}},emits:["close","create"],setup(n,{emit:e}){const s=y(!1),t=y(0),r=y(""),i=y(null),o=y(""),l=C(()=>n.module.id.includes("graph-admission-closure")||n.module.id.includes("time-tracking")),u=C(()=>n.module.id.includes("graph-admission-closure")?["months","weeks"]:n.module.id.includes("time-tracking")?["default","detailed","summary"]:[]),f=()=>{e("close")},p=S=>{S.target===S.currentTarget&&f()},g=async()=>{s.value=!0,t.value=0,r.value="–ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞...";try{let S={};if(o.value.trim())try{S=JSON.parse(o.value)}catch{throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")}else S=lt.getDefaultParams(n.module.id);Ze.notifyCacheCreationStarted(n.module.name),t.value=25,r.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24...";const D=await lt.createCache(n.module.id,i.value,S);t.value=75,r.value="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∞...",await new Promise(E=>setTimeout(E,500)),t.value=100,r.value="–ö–µ—à —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",Ze.notifyCacheCreationSuccess(n.module.name),setTimeout(()=>{e("create",D),f()},1e3)}catch(S){console.error("[CacheCreateModal] Error creating cache:",S),Ze.notifyCacheCreationError(n.module.name,S.message),s.value=!1}};return le(()=>{u.value.length>0&&(i.value=u.value[0]);const S=lt.getDefaultParams(n.module.id);o.value=JSON.stringify(S,null,2)}),{creating:s,progress:t,progressMessage:r,selectedMode:i,paramsJson:o,supportsModes:l,availableModes:u,close:f,handleOverlayClick:p,handleCreate:g}}},ug={class:"modal-header"},mg={class:"modal-body"},gg={key:1,class:"create-form"},fg={key:0,class:"form-group"},hg=["value"],vg={class:"form-group"},pg={class:"modal-footer"},yg=["disabled"],_g=["disabled"],bg={key:0},wg={key:1};function kg(n,e,s,t,r,i){const o=X("CacheCreateProgress");return c(),d("div",{class:"modal-overlay",onClick:e[6]||(e[6]=(...l)=>t.handleOverlayClick&&t.handleOverlayClick(...l))},[a("div",{class:"modal-content",onClick:e[5]||(e[5]=pe(()=>{},["stop"]))},[a("div",ug,[a("h2",null,"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞: "+m(s.module.name),1),a("button",{onClick:e[0]||(e[0]=(...l)=>t.close&&t.close(...l)),class:"btn-close"},"√ó")]),a("div",mg,[t.creating?(c(),oe(o,{key:0,progress:t.progress,message:t.progressMessage},null,8,["progress","message"])):(c(),d("div",gg,[t.supportsModes?(c(),d("div",fg,[e[7]||(e[7]=a("label",null,"–†–µ–∂–∏–º –∫–µ—à–∞:",-1)),H(a("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.selectedMode=l),class:"form-control"},[(c(!0),d(W,null,q(t.availableModes,l=>(c(),d("option",{key:l,value:l},m(l),9,hg))),128))],512),[[re,t.selectedMode]])])):x("",!0),a("div",vg,[e[8]||(e[8]=a("label",null,"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):",-1)),H(a("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.paramsJson=l),placeholder:'{"product": "1C", ...}',rows:"5",class:"form-control"},null,512),[[we,t.paramsJson]]),e[9]||(e[9]=a("small",{class:"form-text"},"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",-1))])]))]),a("div",pg,[a("button",{onClick:e[3]||(e[3]=(...l)=>t.close&&t.close(...l)),class:"btn-cancel",disabled:t.creating},"–û—Ç–º–µ–Ω–∞",8,yg),a("button",{onClick:e[4]||(e[4]=(...l)=>t.handleCreate&&t.handleCreate(...l)),disabled:t.creating,class:"btn-create"},[t.creating?(c(),d("span",bg,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",wg,"–°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],8,_g)])])])}const Cg=K(dg,[["render",kg],["__scopeId","data-v-da24811e"]]),Sg={name:"CacheCreateButton",components:{CacheCreateModal:Cg},props:{module:{type:Object,required:!0}},emits:["created"],setup(n,{emit:e}){const s=y(!1),t=y(!1);return{showModal:s,creating:t,openModal:()=>{s.value=!0},closeModal:()=>{s.value=!1},handleCreate:async l=>{t.value=!0;try{e("created",l)}finally{t.value=!1}}}}},Dg={class:"cache-create-button"},Tg=["disabled"],xg={key:0},Ag={key:1};function Eg(n,e,s,t,r,i){const o=X("CacheCreateModal");return c(),d("div",Dg,[a("button",{onClick:e[0]||(e[0]=(...l)=>t.openModal&&t.openModal(...l)),disabled:t.creating,class:B(["btn-create",{"btn-disabled":t.creating}])},[t.creating?(c(),d("span",xg,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",Ag,"‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],10,Tg),t.showModal?(c(),oe(o,{key:0,module:s.module,onClose:t.closeModal,onCreate:t.handleCreate},null,8,["module","onClose","onCreate"])):x("",!0)])}const Mg=K(Sg,[["render",Eg],["__scopeId","data-v-177605d5"]]);class be{static success(e,s,t={}){this.show("success",e,s,t)}static error(e,s,t={}){this.show("error",e,s,t)}static warning(e,s,t={}){this.show("warning",e,s,t)}static info(e,s,t={}){this.show("info",e,s,t)}static show(e,s,t,r={}){const i={autoHideDelay:r.autoHideDelay||5e3,position:r.position||"top-right",...r};this.isBitrix24Available()?this.showBitrix24Notification(e,s,t,i):this.showFallbackNotification(e,s,t,i)}static isBitrix24Available(){return typeof window<"u"&&window.BX&&window.BX.UI&&window.BX.UI.Notification&&window.BX.UI.Notification.Center&&typeof window.BX.UI.Notification.Center.notify=="function"}static showBitrix24Notification(e,s,t,r){try{const o={success:"success",error:"error",warning:"warning",info:"info"}[e]||"info",l=s?`${s}: ${t}`:t;window.BX.UI.Notification.Center.notify({content:l,autoHideDelay:r.autoHideDelay,category:`cache-management-${e}`,position:r.position}),console.log(`[NotificationSystem] Bitrix24 notification shown: ${e}`,{title:s,message:t,config:r})}catch(i){console.error("[NotificationSystem] Error showing Bitrix24 notification:",i),this.showFallbackNotification(e,s,t,r)}}static showFallbackNotification(e,s,t,r){if("Notification"in window&&Notification.permission==="granted")try{const i=new Notification(s||"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",{body:t,icon:this.getIconForType(e),tag:`cache-management-${e}`});setTimeout(()=>{i.close()},r.autoHideDelay),console.log(`[NotificationSystem] Browser notification shown: ${e}`,{title:s,message:t});return}catch(i){console.warn("[NotificationSystem] Browser notification failed:",i)}this.showCustomNotification(e,s,t,r)}static showCustomNotification(e,s,t,r){let i=document.getElementById("notification-container");if(!i){i=document.createElement("div"),i.id="notification-container",i.className="notification-container",document.body.appendChild(i);const u=document.createElement("style");u.textContent=this.getNotificationStyles(),document.head.appendChild(u)}const o=document.createElement("div");o.className=`custom-notification notification-${e}`,o.innerHTML=`
      <div class="notification-content">
        <div class="notification-title">${s||""}</div>
        <div class="notification-message">${t}</div>
      </div>
      <button class="notification-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">√ó</button>
    `,o.querySelector(".notification-close").addEventListener("click",()=>{this.removeCustomNotification(o)}),i.appendChild(o),setTimeout(()=>{this.removeCustomNotification(o)},r.autoHideDelay),console.log(`[NotificationSystem] Custom notification shown: ${e}`,{title:s,message:t})}static removeCustomNotification(e){e&&e.parentNode&&(e.classList.add("notification-hiding"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}static getIconForType(e){const s={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};return s[e]||s.info}static getNotificationStyles(){return`
      .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        pointer-events: none;
      }

      .custom-notification {
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 10px;
        min-width: 300px;
        max-width: 500px;
        pointer-events: auto;
        opacity: 0;
        transform: translateX(100%);
        animation: notificationSlideIn 0.3s ease forwards;
        border-left: 4px solid;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        padding: 16px;
        gap: 12px;
      }

      .custom-notification.notification-success {
        border-left-color: #28a745;
      }

      .custom-notification.notification-error {
        border-left-color: #dc3545;
      }

      .custom-notification.notification-warning {
        border-left-color: #ffc107;
      }

      .custom-notification.notification-info {
        border-left-color: #17a2b8;
      }

      .notification-content {
        flex: 1;
      }

      .notification-title {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
        color: #333;
      }

      .notification-message {
        font-size: 13px;
        color: #666;
        line-height: 1.4;
      }

      .notification-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #999;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        flex-shrink: 0;
      }

      .notification-close:hover {
        color: #333;
      }

      .notification-hiding {
        animation: notificationSlideOut 0.3s ease forwards;
      }

      @keyframes notificationSlideIn {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes notificationSlideOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(100%);
        }
      }

      @media (max-width: 768px) {
        .notification-container {
          left: 10px;
          right: 10px;
          top: 10px;
        }

        .custom-notification {
          min-width: auto;
          max-width: none;
        }
      }
    `}static clearAll(){try{this.isBitrix24Available()&&window.BX.UI.Notification.Center.clearAll&&window.BX.UI.Notification.Center.clearAll()}catch(s){console.warn("[NotificationSystem] Error clearing Bitrix24 notifications:",s)}const e=document.getElementById("notification-container");if(e&&(e.innerHTML=""),"Notification"in window&&"getNotifications"in Notification)try{Notification.getNotifications().forEach(t=>{t.tag&&t.tag.startsWith("cache-management-")&&t.close()})}catch(s){console.warn("[NotificationSystem] Error clearing browser notifications:",s)}}}be.show.bind(be);be.success.bind(be);be.error.bind(be);be.warning.bind(be);be.info.bind(be);let ge=null,Ce=null;const ze=class ze{static show(e={}){return new Promise((s,t)=>{Ce=s,ge||(ge=this.createModal(),document.body.appendChild(ge)),this.configureModal(e),this.showModal()})}static hide(){ge&&(this.hideModal(),Ce&&(Ce(!1),Ce=null))}static createModal(){const e=document.createElement("div");return e.className="cache-confirmation-modal",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","confirmation-title"),e.setAttribute("aria-describedby","confirmation-message"),e.innerHTML=`
      <div class="modal-backdrop" data-action="cancel"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="confirmation-title" class="modal-title"></h3>
          <button
            class="modal-close"
            data-action="cancel"
            aria-label="–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"
          >
            √ó
          </button>
        </div>

        <div class="modal-body">
          <div class="modal-icon">
            <span class="icon-symbol"></span>
          </div>
          <p id="confirmation-message" class="modal-message"></p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-cancel" data-action="cancel"></button>
          <button class="btn btn-confirm" data-action="confirm"></button>
        </div>
      </div>
    `,this.attachEventListeners(e),this.addStyles(),e}static configureModal(e){const{title:s="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",message:t="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ?",type:r="warning",confirmText:i="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",cancelText:o="–û—Ç–º–µ–Ω–∞",showCancel:l=!0}=e,u=ge.querySelector(".modal-title");u.textContent=s;const f=ge.querySelector(".modal-message");f.textContent=t;const p=ge.querySelector(".icon-symbol"),g={danger:"‚ö†Ô∏è",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è",success:"‚úÖ"};p.textContent=g[r]||g.warning;const S=ge.querySelector(".btn-cancel"),D=ge.querySelector(".btn-confirm");S.textContent=o,D.textContent=i,l?S.style.display="inline-block":S.style.display="none",ge.className=`cache-confirmation-modal modal-${r}`}static showModal(){document.body.style.overflow="hidden",ge.style.display="flex",ge.classList.add("modal-visible"),setTimeout(()=>{const e=ge.querySelector(".btn-confirm");e&&e.focus()},100),document.addEventListener("keydown",this.handleKeyDown)}static hideModal(){document.body.style.overflow="",ge.classList.remove("modal-visible"),document.removeEventListener("keydown",this.handleKeyDown),setTimeout(()=>{ge&&(ge.style.display="none")},300)}static attachEventListeners(e){e.addEventListener("click",s=>{const t=s.target.closest("[data-action]")?.getAttribute("data-action");t==="confirm"?this.handleConfirm():t==="cancel"&&this.handleCancel()})}static handleConfirm(){Ce&&(Ce(!0),Ce=null),this.hideModal()}static handleCancel(){Ce&&(Ce(!1),Ce=null),this.hideModal()}static handleTabNavigation(e){const t=ge.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),r=t[0],i=t[t.length-1];e.shiftKey?document.activeElement===r&&(e.preventDefault(),i.focus()):document.activeElement===i&&(e.preventDefault(),r.focus())}static addStyles(){if(document.getElementById("cache-confirmation-styles"))return;const e=document.createElement("style");e.id="cache-confirmation-styles",e.textContent=`
      .cache-confirmation-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        align-items: center;
        justify-content: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      .cache-confirmation-modal.modal-visible {
        display: flex;
      }

      .modal-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(2px);
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        z-index: 10001;
        animation: modalSlideIn 0.3s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px 16px;
        border-bottom: 1px solid #e0e0e0;
      }

      .modal-title {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: #333;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .modal-close:hover {
        background: #f0f0f0;
        color: #333;
      }

      .modal-body {
        padding: 24px;
        text-align: center;
      }

      .modal-icon {
        margin-bottom: 16px;
      }

      .icon-symbol {
        font-size: 48px;
        display: block;
      }

      .modal-message {
        margin: 0;
        font-size: 16px;
        color: #555;
        line-height: 1.5;
      }

      .modal-footer {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        padding: 16px 24px 24px;
        border-top: 1px solid #e0e0e0;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
        min-width: 80px;
      }

      .btn:focus {
        outline: 2px solid #007bff;
        outline-offset: 2px;
      }

      .btn-cancel {
        background: #f8f9fa;
        color: #6c757d;
        border: 1px solid #dee2e6;
      }

      .btn-cancel:hover {
        background: #e9ecef;
        border-color: #adb5bd;
      }

      .btn-confirm {
        background: #007bff;
        color: white;
      }

      .btn-confirm:hover {
        background: #0056b3;
      }

      /* –¢–∏–ø—ã –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
      .modal-danger .btn-confirm {
        background: #dc3545;
      }

      .modal-danger .btn-confirm:hover {
        background: #c82333;
      }

      .modal-warning .btn-confirm {
        background: #ffc107;
        color: #212529;
      }

      .modal-warning .btn-confirm:hover {
        background: #e0a800;
      }

      .modal-info .btn-confirm {
        background: #17a2b8;
      }

      .modal-info .btn-confirm:hover {
        background: #138496;
      }

      .modal-success .btn-confirm {
        background: #28a745;
      }

      .modal-success .btn-confirm:hover {
        background: #1e7e34;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
      @media (max-width: 480px) {
        .modal-content {
          margin: 20px;
          width: calc(100% - 40px);
        }

        .modal-header,
        .modal-body,
        .modal-footer {
          padding-left: 20px;
          padding-right: 20px;
        }

        .modal-footer {
          flex-direction: column-reverse;
        }

        .btn {
          width: 100%;
        }
      }

      /* –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å */
      @media (prefers-reduced-motion: reduce) {
        .modal-content,
        .modal-close,
        .btn {
          animation: none;
          transition: none;
        }
      }

      /* –í—ã—Å–æ–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç */
      @media (prefers-contrast: high) {
        .modal-content {
          border: 2px solid #000;
        }

        .btn-cancel {
          border: 2px solid #000;
        }

        .btn-confirm {
          border: 2px solid #000;
        }
      }
    `,document.head.appendChild(e)}};Me(ze,"handleKeyDown",e=>{switch(e.key){case"Enter":e.preventDefault(),ze.handleConfirm();break;case"Escape":e.preventDefault(),ze.handleCancel();break;case"Tab":ze.handleTabNavigation(e);break}});let Oe=ze;Oe.show.bind(Oe);Oe.hide.bind(Oe);const Ig={name:"CacheModuleCard",components:{CacheCreateButton:Mg},props:{module:{type:Object,required:!0,validator:n=>n&&typeof n.id=="string"&&typeof n.name=="string"},isPrimary:{type:Boolean,default:!1},priority:{type:Number,default:999},groupType:{type:String,default:null}},emits:["clear","refresh","details"],setup(n,{emit:e}){const s=y(!1),t=y(!1),r=y(!1),i=y(!1),o=M=>{if(!M.target.closest(".action-button"))switch(M.key){case"Enter":case" ":M.preventDefault();const $=M.currentTarget.querySelector(".action-button:not([disabled])");$&&$.focus();break}};le(()=>{const M=()=>{i.value=window.innerWidth<768};M(),window.addEventListener("resize",M);const $=document.querySelector(`[data-module-id="${n.module.id}"]`);$&&$.addEventListener("keydown",o)}),Be(()=>{const M=document.querySelector(`[data-module-id="${n.module.id}"]`);M&&M.removeEventListener("keydown",o)});const l=C(()=>({"cache-module-card":!0,"primary-module":n.isPrimary,"secondary-module":!n.isPrimary,"high-priority":n.priority<=3,"expiring-soon":T.value,"empty-cache":D.value,loading:s.value||t.value,[ne.value]:!0})),u=C(()=>n.isPrimary?"üèÜ":{users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"}[n.groupType]||"üîß"),f=C(()=>({"primary-icon":n.isPrimary,"secondary-icon":!n.isPrimary})),p=C(()=>n.isPrimary?"–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å":n.groupType?ae.getModuleTypeConfig(n.groupType).title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞":""),g=C(()=>n.priority?`priority-${n.priority}`:""),S=C(()=>`status-${n.module.status||"empty"}`),D=C(()=>(n.module.file_count||0)===0),E=C(()=>n.module.expires_at?new Date(n.module.expires_at*1e3)<=new Date:!1),T=C(()=>{if(!n.module.expires_at)return!1;const V=(new Date(n.module.expires_at*1e3)-new Date)/(1e3*60*60);return V>0&&V<=2}),I=C(()=>{const M=n.module.status;return M==="active"?"–ê–∫—Ç–∏–≤–µ–Ω":M==="expired"?"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω":M==="empty"?"–ü—É—Å—Ç":"–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}),h=C(()=>ae.formatCacheSize(n.module.total_size||0)),v=C(()=>ae.formatTTL(n.module.ttl||0)),w=C(()=>{if(!n.module.cache_dir)return"";const M=n.module.cache_dir.split("/");return M.length>2?"..."+M.slice(-2).join("/"):n.module.cache_dir}),U=C(()=>n.module.metadata?.creation_time_ms?ae.formatCreationTime(n.module.metadata.creation_time_ms):"‚Äî"),R=C(()=>{if(!n.module.metadata?.last_accessed_at)return"‚Äî";const M=new Date(n.module.metadata.last_accessed_at*1e3),V=new Date-M;return V<6e4?"–¢–æ–ª—å–∫–æ —á—Ç–æ":V<36e5?`${Math.floor(V/6e4)} –º–∏–Ω –Ω–∞–∑–∞–¥`:M.toLocaleString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),k=C(()=>n.module.metadata?.access_count||0),_=C(()=>n.module.metadata?.performance_metrics?.cache_hit_ratio?ae.formatCacheHitRatio(n.module.metadata.performance_metrics.cache_hit_ratio):"‚Äî"),b=C(()=>n.module.metadata?.performance_metrics?.data_freshness_score?ae.formatDataFreshness(n.module.metadata.performance_metrics.data_freshness_score):"‚Äî"),P=C(()=>n.module.expires_at?`metric-${ae.getExpiryColor(n.module.expires_at)}`:""),z=C(()=>n.module.metadata?.creation_time_ms?`metric-${ae.getCreationTimeColor(n.module.metadata.creation_time_ms)}`:""),O=C(()=>n.module.metadata?.performance_metrics?.cache_hit_ratio?`metric-${ae.getEfficiencyColor(n.module.metadata.performance_metrics.cache_hit_ratio)}`:""),A=C(()=>n.module.metadata?.performance_metrics?.data_freshness_score?`metric-${ae.getFreshnessColor(n.module.metadata.performance_metrics.data_freshness_score)}`:""),j=C(()=>{if(!n.module.expires_at)return null;const M=new Date(n.module.expires_at*1e3);return Math.max(0,Math.floor((M-new Date)/1e3))}),fe=C(()=>{if(j.value===null)return"‚Äî";if(j.value<=0)return"–ò—Å—Ç–µ–∫";const M=Math.floor(j.value/3600),$=Math.floor(j.value%3600/60),V=j.value%60;return M>0?`${M}—á ${$}–º`:$>0?`${$}–º ${V}—Å`:`${V}—Å`}),N=C(()=>j.value===null?"":j.value<=0||j.value<=1800?"metric-red":j.value<=7200?"metric-orange":"metric-green"),Y=M=>{if(M===0)return"0 B";const $=1024,V=["B","KB","MB","GB","TB"],Z=Math.floor(Math.log(M)/Math.log($));return parseFloat((M/Math.pow($,Z)).toFixed(1))+" "+V[Z]},F=M=>M<60?`${M}—Å`:M<3600?`${Math.floor(M/60)}–º`:M<86400?`${Math.floor(M/3600)}—á`:`${Math.floor(M/86400)}–¥`,J=C(()=>{if(D.value)return"empty";if(E.value)return"expired";const M=j.value;return M===null?"fresh":M<=0?"expired":M<=30*60*1e3?"critical":M<=2*60*60*1e3?"warning":"fresh"}),te=C(()=>{const M=J.value;return{fresh:"–°–≤–µ–∂–∏–π –∫–µ—à",warning:"–ò—Å—Ç–µ–∫–∞–µ—Ç —Å–∫–æ—Ä–æ",critical:"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç",expired:"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω",empty:"–ö–µ—à –ø—É—Å—Ç"}[M]||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}),ne=C(()=>`cache-state-${J.value}`),se=C(()=>({fresh:"üü¢",warning:"üü°",critical:"üî¥",expired:"‚ö´",empty:"‚ö™"})[J.value]||"‚ùì"),ie=C(()=>!D.value&&!s.value),de=C(()=>n.isPrimary&&!D.value),he=C(()=>D.value?"–ö–µ—à –º–æ–¥—É–ª—è –ø—É—Å—Ç":`–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è ${n.module.name}`),ot=C(()=>{if(!n.module.created_at)return"‚Äî";const M=new Date(n.module.created_at*1e3),$=new Date,V=$-M;if(V<6e4)return"–¢–æ–ª—å–∫–æ —á—Ç–æ";if(V<36e5){const ue=Math.floor(V/6e4);return`${ue} ${ue===1?"–º–∏–Ω—É—Ç—É":ue<5?"–º–∏–Ω—É—Ç—ã":"–º–∏–Ω—É—Ç"} –Ω–∞–∑–∞–¥`}if(M.toDateString()===$.toDateString())return`–°–µ–≥–æ–¥–Ω—è –≤ ${M.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`;const Z=new Date($);return Z.setDate(Z.getDate()-1),M.toDateString()===Z.toDateString()?`–í—á–µ—Ä–∞ –≤ ${M.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:M.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),nt=C(()=>{if(!n.module.expires_at)return"‚Äî";const M=new Date(n.module.expires_at*1e3),V=M-new Date;if(V<0)return`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω (${M.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})`;const Z=Math.floor(V/6e4),ue=Math.floor(Z/60);return ue>0?`${ue} —á ${Z%60} –º–∏–Ω`:Z>0?`${Z} –º–∏–Ω`:"–ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã"});return{clearing:s,creating:t,showDetailModal:r,isMobile:i,moduleClasses:l,moduleIcon:u,iconClass:f,moduleTypeText:p,priorityClass:g,statusClass:S,isEmpty:D,isExpired:E,isExpiringSoon:T,statusText:I,formattedSize:h,formattedTTL:v,shortCacheDir:w,formattedCreationTime:U,formattedLastAccess:R,accessCount:k,cacheEfficiency:_,dataFreshness:b,expiresClass:P,creationTimeClass:z,cacheEfficiencyClass:O,dataFreshnessClass:A,cacheState:J,cacheStateText:te,cacheStateClass:ne,cacheStateIcon:se,timeToExpiry:j,formatTimeToExpiry:fe,timeToExpiryClass:N,formatBytes:Y,formatTTL:F,canClear:ie,canShowDetails:de,clearButtonLabel:he,formattedCreatedAt:ot,formattedExpiresAt:nt,handleClear:async()=>{if(ie.value)try{if(!await Oe.show({title:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",message:`–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${n.module.name}"?

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`,type:"danger",confirmText:"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à",cancelText:"–û—Ç–º–µ–Ω–∞"}))return;s.value=!0,await ae.clearCache(n.module.id),e("clear",n.module.id),be.success("–ö–µ—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω",`–ö–µ—à –º–æ–¥—É–ª—è "${n.module.name}" –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω`)}catch(M){console.error("[CacheModuleCard] Error clearing cache:",M),be.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${n.module.name}": ${M.message}`)}finally{s.value=!1}},handleCacheCreated:()=>{e("refresh")},handleCreatingState:M=>{t.value=M},showDetails:()=>{r.value=!0,e("details",n.module)},closeDetails:()=>{r.value=!1}}}},Lg=["aria-labelledby","aria-describedby","data-module-id"],Pg={class:"card-header"},Fg={class:"module-identity"},Ug={class:"module-info"},Rg=["id"],Ng={class:"module-type"},Og={class:"header-meta"},Bg=["id"],Vg={class:"card-content"},jg={class:"data-grid",role:"region","aria-label":"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–µ—à–µ"},zg={class:"data-section statistics"},$g={class:"data-items"},Wg={class:"data-item"},qg={class:"data-value"},Hg={class:"data-item"},Xg={class:"data-value"},Jg={key:0,class:"data-item full-width"},Kg=["title"],Yg={class:"data-section lifetime"},Gg={class:"data-items"},Qg={class:"data-item"},Zg={class:"data-value"},ef={key:0,class:"data-item"},tf={class:"data-value"},sf={key:1,class:"data-item"},af={class:"data-section cache-state"},of={class:"section-header"},nf=["aria-label"],rf={class:"data-items"},lf={class:"data-value cache-state-text"},cf={key:0,class:"data-section performance"},df={class:"data-items"},uf={key:0,class:"data-item"},mf={key:1,class:"data-item"},gf={class:"data-value"},ff={key:2,class:"data-item"},hf={class:"data-value"},vf={key:3,class:"data-item"},pf={key:4,class:"data-item"},yf={key:5,class:"data-item"},_f={class:"data-value"},bf={key:6,class:"data-item"},wf={class:"data-value"},kf={key:7,class:"data-item"},Cf=["aria-label"],Sf={class:"primary-actions"},Df={class:"secondary-actions"},Tf=["disabled","aria-label"],xf={key:0,class:"button-content"},Af={key:1,class:"button-content"},Ef={key:2,class:"button-content"},Mf=["aria-label"],If={class:"detail-modal",role:"dialog","aria-modal":"true"},Lf={class:"modal-header"},Pf={class:"modal-content"},Ff={class:"json-data"};function Uf(n,e,s,t,r,i){const o=X("CacheCreateButton");return c(),d("article",{class:B(["cache-module-card",t.moduleClasses]),role:"article","aria-labelledby":`module-${s.module.id}-title`,"aria-describedby":`module-${s.module.id}-status`,"data-module-id":s.module.id,tabindex:"0"},[a("div",Pg,[a("div",Fg,[a("div",{class:B(["module-icon",t.iconClass])},m(t.moduleIcon),3),a("div",Ug,[a("h3",{class:"module-name",id:`module-${s.module.id}-title`},m(s.module.name),9,Rg),a("span",Ng,m(t.moduleTypeText),1)])]),a("div",Og,[s.isPrimary&&s.priority?(c(),d("span",{key:0,class:B(["priority-badge",t.priorityClass])},m(s.priority),3)):x("",!0),a("span",{class:B(["status-badge",t.statusClass]),id:`module-${s.module.id}-status`,role:"status"},m(t.statusText),11,Bg)])]),a("div",Vg,[a("div",jg,[a("div",zg,[e[14]||(e[14]=a("div",{class:"section-header"},[a("span",{class:"section-icon","aria-hidden":"true"},"üìä"),a("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],-1)),a("div",$g,[a("div",Wg,[e[11]||(e[11]=a("span",{class:"data-label"},"–§–∞–π–ª–æ–≤:",-1)),a("span",qg,m(s.module.file_count||0),1)]),a("div",Hg,[e[12]||(e[12]=a("span",{class:"data-label"},"–†–∞–∑–º–µ—Ä:",-1)),a("span",Xg,m(t.formattedSize),1)]),s.module.cache_dir?(c(),d("div",Jg,[e[13]||(e[13]=a("span",{class:"data-label"},"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:",-1)),a("span",{class:"data-value cache-dir",title:s.module.cache_dir},m(t.shortCacheDir),9,Kg)])):x("",!0)])]),a("div",Yg,[e[18]||(e[18]=a("div",{class:"section-header"},[a("span",{class:"section-icon","aria-hidden":"true"},"‚è∞"),a("h4",{class:"section-title"},"–í—Ä–µ–º—è –∂–∏–∑–Ω–∏")],-1)),a("div",Gg,[a("div",Qg,[e[15]||(e[15]=a("span",{class:"data-label"},"TTL:",-1)),a("span",Zg,m(t.formattedTTL),1)]),s.module.created_at?(c(),d("div",ef,[e[16]||(e[16]=a("span",{class:"data-label"},"–°–æ–∑–¥–∞–Ω:",-1)),a("span",tf,m(t.formattedCreatedAt),1)])):x("",!0),s.module.expires_at?(c(),d("div",sf,[e[17]||(e[17]=a("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç:",-1)),a("span",{class:B(["data-value",t.expiresClass])},m(t.formattedExpiresAt),3)])):x("",!0)])]),a("div",af,[a("div",of,[a("span",{class:"section-icon","aria-label":t.cacheStateText,"aria-hidden":"false"},m(t.cacheStateIcon),9,nf),e[19]||(e[19]=a("h4",{class:"section-title"},"–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–µ—à–∞",-1))]),a("div",rf,[a("div",{class:B(["data-item cache-state-indicator",t.cacheStateClass])},[e[20]||(e[20]=a("span",{class:"data-label"},"–°—Ç–∞—Ç—É—Å:",-1)),a("span",lf,m(t.cacheStateText),1)],2)])]),s.module.metadata||s.module.created_at?(c(),d("div",cf,[e[29]||(e[29]=a("div",{class:"section-header"},[a("span",{class:"section-icon","aria-hidden":"true"},"‚ö°"),a("h4",{class:"section-title"},"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")],-1)),a("div",df,[t.formattedCreationTime?(c(),d("div",uf,[e[21]||(e[21]=a("span",{class:"data-label"},"–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:",-1)),a("span",{class:B(["data-value",t.creationTimeClass])},m(t.formattedCreationTime),3)])):x("",!0),t.formattedLastAccess?(c(),d("div",mf,[e[22]||(e[22]=a("span",{class:"data-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—Å—Ç—É–ø:",-1)),a("span",gf,m(t.formattedLastAccess),1)])):x("",!0),t.accessCount!==null?(c(),d("div",ff,[e[23]||(e[23]=a("span",{class:"data-label"},"–û–±—Ä–∞—â–µ–Ω–∏–π:",-1)),a("span",hf,m(t.accessCount),1)])):x("",!0),t.cacheEfficiency?(c(),d("div",vf,[e[24]||(e[24]=a("span",{class:"data-label"},"–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),a("span",{class:B(["data-value",t.cacheEfficiencyClass])},m(t.cacheEfficiency),3)])):x("",!0),t.dataFreshness?(c(),d("div",pf,[e[25]||(e[25]=a("span",{class:"data-label"},"–°–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:",-1)),a("span",{class:B(["data-value",t.dataFreshnessClass])},m(t.dataFreshness),3)])):x("",!0),s.module.total_size?(c(),d("div",yf,[e[26]||(e[26]=a("span",{class:"data-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:",-1)),a("span",_f,m(t.formatBytes(s.module.total_size)),1)])):x("",!0),s.module.ttl?(c(),d("div",bf,[e[27]||(e[27]=a("span",{class:"data-label"},"TTL:",-1)),a("span",wf,m(t.formatTTL(s.module.ttl)),1)])):x("",!0),t.timeToExpiry!==null?(c(),d("div",kf,[e[28]||(e[28]=a("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑:",-1)),a("span",{class:B(["data-value",t.timeToExpiryClass])},m(t.formatTimeToExpiry),3)])):x("",!0)])])):x("",!0)])]),a("div",{class:B(["card-actions",{"mobile-layout":t.isMobile}]),role:"group","aria-label":`–î–µ–π—Å—Ç–≤–∏—è —Å –∫–µ—à–µ–º ${s.module.name}`},[a("div",Sf,[G(o,{module:s.module,disabled:t.creating,onCreated:t.handleCacheCreated,onCreating:t.handleCreatingState,class:B(["action-button create-button",{loading:t.creating}])},null,8,["module","disabled","onCreated","onCreating","class"])]),a("div",Df,[a("button",{onClick:e[0]||(e[0]=(...l)=>t.handleClear&&t.handleClear(...l)),onKeydown:[e[1]||(e[1]=Se((...l)=>t.handleClear&&t.handleClear(...l),["enter"])),e[2]||(e[2]=Se(pe((...l)=>t.handleClear&&t.handleClear(...l),["prevent"]),["space"]))],disabled:!t.canClear,class:B(["action-button clear-button",{disabled:!t.canClear,loading:t.clearing}]),"aria-label":t.clearButtonLabel,tabindex:"0"},[t.clearing?(c(),d("span",xf,[...e[30]||(e[30]=[a("span",{class:"spinner"},null,-1),Q(" –û—á–∏—Å—Ç–∫–∞... ",-1)])])):t.isEmpty?(c(),d("span",Af," üìÅ –ö–µ—à –ø—É—Å—Ç ")):(c(),d("span",Ef," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å "))],42,Tf),t.canShowDetails?(c(),d("button",{key:0,onClick:e[3]||(e[3]=(...l)=>t.showDetails&&t.showDetails(...l)),onKeydown:[e[4]||(e[4]=Se((...l)=>t.showDetails&&t.showDetails(...l),["enter"])),e[5]||(e[5]=Se(pe((...l)=>t.showDetails&&t.showDetails(...l),["prevent"]),["space"]))],class:"action-button details-button","aria-label":`–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞ ${s.module.name}`,title:"–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞",tabindex:"0"}," üìä ",40,Mf)):x("",!0)])],10,Cf),(c(),oe(xt,{to:"body"},[t.showDetailModal?(c(),d("div",{key:0,class:"detail-modal-overlay",onClick:e[9]||(e[9]=pe((...l)=>t.closeDetails&&t.closeDetails(...l),["self"])),onKeydown:e[10]||(e[10]=Se((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))},[a("div",If,[a("div",Lf,[a("h3",null,"–î–µ—Ç–∞–ª–∏ –∫–µ—à–∞: "+m(s.module.name),1),a("button",{onClick:e[6]||(e[6]=(...l)=>t.closeDetails&&t.closeDetails(...l)),onKeydown:[e[7]||(e[7]=Se((...l)=>t.closeDetails&&t.closeDetails(...l),["enter"])),e[8]||(e[8]=Se((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))],class:"close-button","aria-label":"–ó–∞–∫—Ä—ã—Ç—å",tabindex:"0"}," ‚úï ",32)]),a("div",Pf,[a("pre",Ff,m(JSON.stringify(s.module,null,2)),1)])])],32)):x("",!0)]))],10,Lg)}const Rf=K(Ig,[["render",Uf],["__scopeId","data-v-d761d34d"]]),Nf={name:"CacheStats",props:{modules:{type:Array,required:!1,default:()=>[]}},setup(n){console.log("[CacheStats] setup called with modules:",n.modules);const e=C(()=>n.modules||[]),s=C(()=>{console.log("[CacheStats] Computing primaryModules, total modules:",e.value?.length||0);const E=e.value.filter(T=>ae.PRIMARY_MODULE_IDS.includes(T.id));return console.log("[CacheStats] Primary modules count:",E.length),E}),t=C(()=>{console.log("[CacheStats] Computing secondaryModules, total modules:",e.value?.length||0);const E=e.value.filter(T=>!ae.PRIMARY_MODULE_IDS.includes(T.id));return console.log("[CacheStats] Secondary modules count:",E.length),E}),r=C(()=>s.value?.length||0),i=C(()=>t.value?.length||0),o=C(()=>e.value?.length||0),l=C(()=>e.value.reduce((E,T)=>E+(T.file_count||0),0)),u=C(()=>(n.modules||[]).reduce((E,T)=>E+(T.total_size||0),0)),f=C(()=>ae.formatCacheSize(u.value)),p=C(()=>{const E=n.modules||[];if(E.length===0)return"0 –º–∏–Ω";const T=E.reduce((h,v)=>h+(v.ttl||0),0),I=Math.round(T/E.length);return ae.formatTTL(I)}),g=C(()=>(e.value||[]).filter(E=>E.status==="active").length),S=C(()=>{if((i.value||0)===0)return[];const E={};(t.value||[]).forEach(I=>{const h=ae.getModuleType(I.id);if(!E[h]){const v=ae.getModuleTypeConfig(h);E[h]={type:h,title:v.title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞",icon:D(h),count:0}}E[h].count++});const T=i.value||0;return Object.values(E).map(I=>({...I,percentage:T>0?Math.round(I.count/T*100):0})).sort((I,h)=>h.count-I.count)}),D=E=>{const T={users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"};return T[E]||T.other};return{modules:e,primaryModulesCount:r,secondaryModulesCount:i,totalModules:o,totalFiles:l,totalSizeFormatted:f,avgTTL:p,activeModules:g,groupStats:S}}},Of={key:0,class:"cache-stats"},Bf={class:"stats-overview"},Vf={class:"overview-grid"},jf={class:"overview-card primary"},zf={class:"overview-content"},$f={class:"overview-value"},Wf={class:"overview-card secondary"},qf={class:"overview-content"},Hf={class:"overview-value"},Xf={class:"overview-card total"},Jf={class:"overview-content"},Kf={class:"overview-value"},Yf={class:"detailed-stats"},Gf={class:"stats-grid"},Qf={class:"stat-card"},Zf={class:"stat-content"},eh={class:"stat-value"},th={class:"stat-card"},sh={class:"stat-content"},ah={class:"stat-value"},oh={class:"stat-card"},nh={class:"stat-content"},rh={class:"stat-value"},ih={class:"stat-card"},lh={class:"stat-content"},ch={class:"stat-value"},dh={key:0,class:"group-distribution"},uh={class:"distribution-grid"},mh={class:"group-icon"},gh={class:"group-info"},fh={class:"group-name"},hh={class:"group-count"},vh={class:"group-percentage"},ph={key:1,class:"cache-stats-loading"};function yh(n,e,s,t,r,i){return(t.modules||[]).length>0?(c(),d("div",Of,[e[18]||(e[18]=a("h2",{class:"stats-title"},"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",-1)),a("div",Bf,[a("div",Vf,[a("div",jf,[e[2]||(e[2]=a("div",{class:"overview-icon"},"üèÜ",-1)),a("div",zf,[a("div",$f,m(t.primaryModulesCount),1),e[0]||(e[0]=a("div",{class:"overview-label"},"–û—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[1]||(e[1]=a("div",{class:"overview-desc"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ",-1))])]),a("div",Wf,[e[5]||(e[5]=a("div",{class:"overview-icon"},"üîß",-1)),a("div",qf,[a("div",Hf,m(t.secondaryModulesCount),1),e[3]||(e[3]=a("div",{class:"overview-label"},"–ü–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[4]||(e[4]=a("div",{class:"overview-desc"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),a("div",Xf,[e[8]||(e[8]=a("div",{class:"overview-icon"},"üì¶",-1)),a("div",Jf,[a("div",Kf,m(t.totalModules),1),e[6]||(e[6]=a("div",{class:"overview-label"},"–í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π",-1)),e[7]||(e[7]=a("div",{class:"overview-desc"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö",-1))])])])]),a("div",Yf,[a("div",Gf,[a("div",Qf,[e[10]||(e[10]=a("div",{class:"stat-icon"},"üìÑ",-1)),a("div",Zf,[a("div",eh,m(t.totalFiles),1),e[9]||(e[9]=a("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤",-1))])]),a("div",th,[e[12]||(e[12]=a("div",{class:"stat-icon"},"üíæ",-1)),a("div",sh,[a("div",ah,m(t.totalSizeFormatted),1),e[11]||(e[11]=a("div",{class:"stat-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä",-1))])]),a("div",oh,[e[14]||(e[14]=a("div",{class:"stat-icon"},"‚è±Ô∏è",-1)),a("div",nh,[a("div",rh,m(t.avgTTL),1),e[13]||(e[13]=a("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–∏–π TTL",-1))])]),a("div",ih,[e[16]||(e[16]=a("div",{class:"stat-icon"},"‚ö°",-1)),a("div",lh,[a("div",ch,m(t.activeModules),1),e[15]||(e[15]=a("div",{class:"stat-label"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–µ—à–µ–π",-1))])])])]),t.secondaryModulesCount>0?(c(),d("div",dh,[e[17]||(e[17]=a("h3",{class:"distribution-title"},"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),a("div",uh,[(c(!0),d(W,null,q(t.groupStats,o=>(c(),d("div",{key:o.type,class:"distribution-item"},[a("div",mh,m(o.icon),1),a("div",gh,[a("div",fh,m(o.title),1),a("div",hh,m(o.count)+" –º–æ–¥—É–ª–µ–π",1)]),a("div",vh,m(o.percentage)+"%",1)]))),128))])])):x("",!0)])):(c(),d("div",ph,[...e[19]||(e[19]=[a("p",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])]))}const _h=K(Nf,[["render",yh],["__scopeId","data-v-9fa190bb"]]),bh={name:"CacheManagement",components:{CacheModuleCard:Rf,CacheStats:_h},setup(){const n=y([]),e=y([]),s=y(!0),t=y(null),r=C(()=>(n.value?.length||0)+(e.value?.length||0)),i=C(()=>{const T=o.value?.length||0,I=(l.value?.length||0)>0?1:0;return T+I}),o=C(()=>{const T=(n.value||[]).filter(I=>!I.id.includes("time-tracking"));return console.log("[CacheManagement] individualPrimaryModules:",T.length,T.map(I=>I.id)),T}),l=C(()=>{const T=(n.value||[]).filter(I=>I.id.includes("time-tracking")).sort((I,h)=>{const v=["time-tracking-default","time-tracking-detailed","time-tracking-summary"];return v.indexOf(I.id)-v.indexOf(h.id)});return console.log("[CacheManagement] timeTrackingModules:",T.length,T.map(I=>I.id)),T}),u=C(()=>{const T={};return(e.value||[]).forEach(h=>{const v=ae.getModuleType(h.id);T[v]||(T[v]={type:v,title:p(v),modules:[]}),T[v].modules.push(h)}),Object.values(T).sort((h,v)=>{const w=["users","activity","webhooks","other"],U=w.indexOf(h.type),R=w.indexOf(v.type);return(U===-1?999:U)-(R===-1?999:R)})}),f=async()=>{s.value=!0,t.value=null;try{const T=[{id:"dashboard-sector-1c",name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",status:"active",file_count:5,total_size:1024e3,ttl:600,created_at:Math.floor(Date.now()/1e3)-7200,expires_at:Math.floor(Date.now()/1e3)+1800,cache_dir:"/var/cache/dashboard/sector-1c",metadata:{version:"1.0",module_id:"dashboard-sector-1c",module_name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",created_at:Math.floor(Date.now()/1e3)-7200,created_by:"system",creation_time_ms:1250,last_accessed_at:Math.floor(Date.now()/1e3)-300,access_count:45,expires_at:Math.floor(Date.now()/1e3)+1800,ttl_seconds:600,file_size_bytes:1024e3,compression_ratio:.75,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only"],limit:1e3},performance_metrics:{avg_response_time_ms:45,cache_hit_ratio:.92,data_freshness_score:.95}}},{id:"graph-state",name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",status:"active",file_count:3,total_size:512e3,ttl:3600,created_at:Math.floor(Date.now()/1e3)-10800,expires_at:Math.floor(Date.now()/1e3)+7200,cache_dir:"/var/cache/graphs/state",metadata:{version:"1.0",module_id:"graph-state",module_name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",created_at:Math.floor(Date.now()/1e3)-10800,created_by:"cron",creation_time_ms:890,last_accessed_at:Math.floor(Date.now()/1e3)-600,access_count:23,expires_at:Math.floor(Date.now()/1e3)+7200,ttl_seconds:3600,file_size_bytes:512e3,compression_ratio:.82,data_version:"2026.01.12.v2",source_params:{period:"months",sector_id:"all",filters:[],limit:500},performance_metrics:{avg_response_time_ms:32,cache_hit_ratio:.88,data_freshness_score:.91}}},{id:"graph-admission-closure-weeks",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",status:"active",file_count:8,total_size:2048e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-1800,expires_at:Math.floor(Date.now()/1e3)+120,cache_dir:"/var/cache/graphs/admission-closure/weeks",metadata:{version:"1.0",module_id:"graph-admission-closure-weeks",module_name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",created_at:Math.floor(Date.now()/1e3)-1800,created_by:"system",creation_time_ms:2100,last_accessed_at:Math.floor(Date.now()/1e3)-60,access_count:67,expires_at:Math.floor(Date.now()/1e3)+120,ttl_seconds:300,file_size_bytes:2048e3,compression_ratio:.68,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only","resolved_only"],limit:2e3},performance_metrics:{avg_response_time_ms:78,cache_hit_ratio:.95,data_freshness_score:.98}}},{id:"graph-admission-closure-months",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",status:"active",file_count:12,total_size:3072e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-3600,expires_at:Math.floor(Date.now()/1e3)+240,cache_dir:"/var/cache/graphs/admission-closure/months",metadata:{version:"1.0",module_id:"graph-admission-closure-months",module_name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",created_at:Math.floor(Date.now()/1e3)-3600,created_by:"cron",creation_time_ms:3400,last_accessed_at:Math.floor(Date.now()/1e3)-120,access_count:34,expires_at:Math.floor(Date.now()/1e3)+240,ttl_seconds:300,file_size_bytes:3072e3,compression_ratio:.71,data_version:"2026.01.12.v3",source_params:{period:"months",sector_id:"1c",filters:["active_only"],limit:3e3},performance_metrics:{avg_response_time_ms:92,cache_hit_ratio:.89,data_freshness_score:.93}}},{id:"time-tracking-default",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",status:"active",file_count:4,total_size:768e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-900,expires_at:Math.floor(Date.now()/1e3)+2100,cache_dir:"/var/cache/time-tracking/default",metadata:{version:"1.0",module_id:"time-tracking-default",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",created_at:Math.floor(Date.now()/1e3)-900,created_by:"system",creation_time_ms:560,last_accessed_at:Math.floor(Date.now()/1e3)-180,access_count:12,expires_at:Math.floor(Date.now()/1e3)+2100,ttl_seconds:300,file_size_bytes:768e3,compression_ratio:.79,data_version:"2026.01.12.v2",source_params:{period:"weeks",sector_id:"1c",filters:["active_only"],limit:800},performance_metrics:{avg_response_time_ms:28,cache_hit_ratio:.96,data_freshness_score:.97}}},{id:"time-tracking-detailed",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:6,total_size:1536e3,ttl:120,created_at:Math.floor(Date.now()/1e3)-600,expires_at:Math.floor(Date.now()/1e3)+3540,cache_dir:"/var/cache/time-tracking/detailed",metadata:{version:"1.0",module_id:"time-tracking-detailed",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",created_at:Math.floor(Date.now()/1e3)-600,created_by:"user",creation_time_ms:890,last_accessed_at:Math.floor(Date.now()/1e3)-90,access_count:8,expires_at:Math.floor(Date.now()/1e3)+3540,ttl_seconds:120,file_size_bytes:1536e3,compression_ratio:.74,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only","detailed_view"],limit:1500},performance_metrics:{avg_response_time_ms:45,cache_hit_ratio:.91,data_freshness_score:.94}}},{id:"time-tracking-summary",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:2,total_size:384e3,ttl:600,created_at:Math.floor(Date.now()/1e3)-1800,expires_at:Math.floor(Date.now()/1e3)+4200,cache_dir:"/var/cache/time-tracking/summary",metadata:{version:"1.0",module_id:"time-tracking-summary",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",created_at:Math.floor(Date.now()/1e3)-1800,created_by:"cron",creation_time_ms:340,last_accessed_at:Math.floor(Date.now()/1e3)-240,access_count:19,expires_at:Math.floor(Date.now()/1e3)+4200,ttl_seconds:600,file_size_bytes:384e3,compression_ratio:.85,data_version:"2026.01.12.v3",source_params:{period:"months",sector_id:"1c",filters:["summary_view"],limit:300},performance_metrics:{avg_response_time_ms:18,cache_hit_ratio:.98,data_freshness_score:.99}}},{id:"users-management-departments",name:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–æ—Ç–¥–µ–ª—ã)",status:"active",file_count:2,total_size:256e3,ttl:3600,created_at:Math.floor(Date.now()/1e3)-7200,expires_at:Math.floor(Date.now()/1e3)+28800,cache_dir:"/var/cache/users/departments"},{id:"webhook-logs-api",name:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ (API –∑–∞–ø—Ä–æ—Å—ã)",status:"active",file_count:15,total_size:512e4,ttl:300,created_at:Math.floor(Date.now()/1e3)-3600,expires_at:Math.floor(Date.now()/1e3)+2400,cache_dir:"/var/cache/webhooks/api"}],I=ae.enrichModulesWithMetadata(T),h=ae.categorizeAndSortModules(I);n.value=h.primaryModules||[],e.value=h.secondaryModules||[],console.log("[CacheManagement] Primary modules:",n.value.length,n.value.map(v=>({id:v.id,name:v.name}))),console.log("[CacheManagement] Secondary modules:",e.value.length,e.value.map(v=>({id:v.id,name:v.name})))}catch(T){console.error("[CacheManagement] Error loading modules:",T),t.value=T.message}finally{s.value=!1}},p=T=>{const I={users:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",activity:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",webhooks:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",other:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏"};return I[T]||I.other},g=async T=>{console.log(`[CacheManagement] Clearing module: ${T}`),await f()},S=async T=>{console.log(`[CacheManagement] Creating cache for: ${T.name} (${T.id})`),alert(`–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${T.name}
ID: ${T.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},D=async T=>{console.log(`[CacheManagement] Clearing cache for: ${T.name} (${T.id})`),alert(`–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${T.name}
ID: ${T.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},E=()=>{f()};return le(()=>{f()}),{primaryModules:n,secondaryModules:e,loading:s,error:t,totalModules:r,groupedSecondaryModules:u,individualPrimaryModules:o,timeTrackingModules:l,logicalPrimaryCount:i,handleModuleClear:g,handleCreateMock:S,handleClearMock:D,refreshModules:E}}},wh={class:"cache-management"},kh={key:0,class:"header-section"},Ch={class:"stats-bar"},Sh={class:"stat-item"},Dh={class:"stat-item"},Th={class:"stat-item"},xh={class:"section-header"},Ah={class:"section-meta"},Eh={class:"module-count","aria-label":"{{ logicalPrimaryCount }} –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},Mh={key:0,class:"modules-container"},Ih={style:{background:"#f0f8ff",padding:"10px",margin:"10px 0",border:"1px solid #007bff","border-radius":"4px"}},Lh={key:0,class:"modules-grid"},Ph={key:1,class:"time-tracking-group"},Fh={class:"modules-grid"},Uh={key:1,class:"empty-state"},Rh={key:2,class:"section-divider"},Nh={key:3,class:"cache-section secondary-modules","aria-labelledby":"secondary-modules-heading"},Oh={class:"section-header"},Bh={class:"section-meta"},Vh={class:"module-count","aria-label":"{{ (secondaryModules || []).length }} –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},jh={class:"grouped-modules"},zh={class:"group-header"},$h={class:"group-title"},Wh={class:"group-badge secondary"},qh={class:"modules-grid"},Hh={key:4,class:"error-message",role:"alert","aria-live":"assertive"},Xh={key:5,class:"loading-overlay",role:"status","aria-live":"polite","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"};function Jh(n,e,s,t,r,i){const o=X("CacheModuleCard");return c(),d("div",wh,[!t.loading&&!t.error?(c(),d("div",kh,[e[5]||(e[5]=a("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1)),e[6]||(e[6]=a("p",{class:"description"}," –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º —Å–∏—Å—Ç–µ–º—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è ",-1)),a("div",Ch,[a("span",Sh,[a("strong",null,m(t.totalModules),1),e[2]||(e[2]=Q(" –≤—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π ",-1))]),a("span",Dh,[a("strong",null,m(t.logicalPrimaryCount),1),e[3]||(e[3]=Q(" –æ—Å–Ω–æ–≤–Ω—ã—Ö ",-1))]),a("span",Th,[a("strong",null,m((t.secondaryModules||[]).length),1),e[4]||(e[4]=Q(" –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ",-1))])])])):x("",!0),!t.loading&&!t.error?(c(),d("section",{key:1,class:B(["cache-section primary-modules",{empty:(t.primaryModules||[]).length===0}]),"aria-labelledby":"primary-modules-heading"},[a("div",xh,[e[8]||(e[8]=a("h2",{id:"primary-modules-heading"},"üèÜ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),a("div",Ah,[a("span",Eh,m(t.logicalPrimaryCount),1),e[7]||(e[7]=a("span",{class:"section-badge primary",role:"status","aria-label":"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",-1))])]),e[16]||(e[16]=a("p",{class:"section-description"}," 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã: –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°, –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏–µ–º–∞-–∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°. ",-1)),(t.primaryModules||[]).length>0?(c(),d("div",Mh,[a("div",Ih,[a("strong",null,"DEBUG: Primary modules loaded: "+m(t.primaryModules.length),1),e[9]||(e[9]=a("br",null,null,-1)),a("strong",null,"Individual modules: "+m(t.individualPrimaryModules.length),1),e[10]||(e[10]=a("br",null,null,-1)),a("strong",null,"Time tracking modules: "+m(t.timeTrackingModules.length),1),e[11]||(e[11]=a("br",null,null,-1)),e[12]||(e[12]=a("strong",null,"IDs:",-1)),Q(" "+m(t.primaryModules.map(l=>l.id).join(", ")),1)]),t.individualPrimaryModules.length>0?(c(),d("div",Lh,[(c(!0),d(W,null,q(t.individualPrimaryModules,l=>(c(),d("div",{key:l.id,class:"module-wrapper"},[G(o,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])):x("",!0),(t.timeTrackingModules||[]).length>0?(c(),d("div",Ph,[e[13]||(e[13]=a("div",{class:"group-header"},[a("h3",{class:"group-title"},"‚è±Ô∏è –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"),a("span",{class:"group-badge"},"–û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞")],-1)),e[14]||(e[14]=a("p",{class:"group-description"},"–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),a("div",Fh,[(c(!0),d(W,null,q(t.timeTrackingModules,l=>(c(),d("div",{key:l.id,class:"module-wrapper"},[G(o,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])])):x("",!0)])):(c(),d("div",Uh,[e[15]||(e[15]=a("p",null,"‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)),a("button",{onClick:e[0]||(e[0]=(...l)=>t.refreshModules&&t.refreshModules(...l)),class:"refresh-btn"},"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫")]))],2)):x("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("div",Rh,[...e[17]||(e[17]=[tt('<div class="divider-line" data-v-02719b2e></div><div class="divider-content" data-v-02719b2e><span class="divider-icon" data-v-02719b2e>üîß</span><span class="divider-text" data-v-02719b2e>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏</span><span class="divider-subtitle" data-v-02719b2e>–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</span></div><div class="divider-line" data-v-02719b2e></div>',3)])])):x("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("section",Nh,[a("div",Oh,[e[19]||(e[19]=a("h2",{id:"secondary-modules-heading"},"üîß –ü–æ–±–æ—á–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),a("div",Bh,[a("span",Vh,m((t.secondaryModules||[]).length),1),e[18]||(e[18]=a("span",{class:"section-badge secondary",role:"status","aria-label":"–°–ª—É–∂–µ–±–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),e[20]||(e[20]=a("p",{class:"section-description"}," –ú–æ–¥—É–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã. ",-1)),a("div",jh,[(c(!0),d(W,null,q(t.groupedSecondaryModules,l=>(c(),d("div",{key:l.type,class:B(["module-group",`group-${l.type}`])},[a("div",zh,[a("h3",$h,m(l.title),1),a("span",Wh,m(l.modules.length),1)]),a("div",qh,[(c(!0),d(W,null,q(l.modules,u=>(c(),d("div",{key:u.id,class:"module-wrapper"},[G(o,{module:u,"is-primary":!1,"group-type":l.type,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","group-type","onClear","onRefresh"])]))),128))])],2))),128))])])):x("",!0),t.error?(c(),d("div",Hh,[e[21]||(e[21]=a("h3",null,"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞",-1)),a("p",null,m(t.error),1),a("button",{onClick:e[1]||(e[1]=(...l)=>n.loadModules&&n.loadModules(...l)),class:"retry-btn","aria-label":"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):x("",!0),t.loading?(c(),d("div",Xh,[...e[22]||(e[22]=[a("div",{class:"loading-spinner","aria-hidden":"true"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞...",-1)])])):x("",!0)])}const Kh=K(bh,[["render",Jh],["__scopeId","data-v-02719b2e"]]),Yh={name:"CacheManagementPage",components:{CacheManagement:Kh},beforeCreate(){console.log("[CacheManagementPage] beforeCreate() called")},created(){console.log("[CacheManagementPage] created() called")},beforeMount(){console.log("[CacheManagementPage] beforeMount() called")},setup(){console.log("[CacheManagementPage] setup() called with new hierarchical UI");const n=Ke(),e=y(!1),s=y(null),t=()=>{n.push({name:"index"})};return le(()=>{console.log("[CacheManagementPage] onMounted() called - hierarchical cache management ready")}),{loading:e,error:s,goBack:t}}},Gh={class:"cache-management-page"},Qh={class:"page-header"},Zh={class:"page-header-top"},ev={key:0,class:"loading"},tv={key:1,class:"error"},sv={key:2,class:"cache-content"};function av(n,e,s,t,r,i){const o=X("CacheManagement");return c(),d("div",Gh,[a("div",Qh,[a("div",Zh,[a("button",{onClick:e[0]||(e[0]=(...l)=>t.goBack&&t.goBack(...l)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[a("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),a("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=a("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1))]),t.loading?(c(),d("div",ev," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–µ—à–∞... ")):t.error?(c(),d("div",tv,m(t.error),1)):(c(),d("div",sv,[G(o)]))])}const ov=K(Yh,[["render",av],["__scopeId","data-v-a20ded38"]]),nv=[{path:"/install",name:"install",component:xs},{path:"/",name:"index",component:oa},{path:"/webhook-logs",name:"webhook-logs",redirect:"/admin/webhook-logs"},{path:"/admin/webhook-logs",name:"admin-webhook-logs",component:dr,meta:{requiresAuth:!0,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",adminOnly:!0}},{path:"/admin/users",name:"admin-users",component:sg,meta:{requiresAuth:!0,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",adminOnly:!0}},{path:"/admin/cache",name:"admin-cache",component:ov,meta:{requiresAuth:!0,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",adminOnly:!0}},{path:"/dashboard/sector-1c",name:"dashboard-sector-1c",component:()=>ve(()=>import("./DashboardSector1C.vue-BIq972iJ.js"),__vite__mapDeps([9,4,10,11,12,6,2,1,13,5]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector1c"}},{path:"/dashboard/graph-admission-closure",name:"dashboard-graph-admission-closure",component:()=>ve(()=>import("./GraphAdmissionClosureDashboard.vue-D_MI1ooQ.js"),__vite__mapDeps([14,4,15,12,6,2,1,11,16,10,5]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–æ–≤—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",requiresAuth:!0,chunk:"admission-dashboard"}},{path:"/dashboard/graph-state",name:"dashboard-graph-state",component:()=>ve(()=>import("./GraphStateDashboard.vue-lsU1poJR.js"),__vite__mapDeps([17,4,1,13,12,6,2,11,10,15,5]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏",requiresAuth:!0,chunk:"graph-state"}},{path:"/dashboard/tickets-time-tracking",name:"dashboard-tickets-time-tracking",component:()=>ve(()=>import("./TicketsTimeTrackingDashboard.vue-uHgbTri4.js"),__vite__mapDeps([18,4,1,5,6,2]),import.meta.url),meta:{title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",requiresAuth:!0,chunk:"tickets-tracking"}}],st=ns({history:rs(),routes:nv});st.beforeEach(async(n,e,s)=>{if(console.log("[Router] beforeEach:",{to:n.path,from:e.path,name:n.name}),n.meta.title&&(document.title=`${n.meta.title} - Bitrix24 Dashboard`),n.meta.requiresAuth){console.log("[Router] requiresAuth check for:",n.path);try{const t=await Re.checkAccess();if(!t.allowed){console.warn("Unauthorized access attempt to:",n.path,t.errorMessage),s({name:"index"});return}}catch(t){console.error("Error checking access in navigation guard:",t),s();return}}if(n.meta.adminOnly)try{const t=await Re.getCurrentUser();if(!t||!Bt(t)){console.warn("Admin access required for:",n.path),s({name:"index"});return}}catch(t){console.error("Error checking admin access in navigation guard:",t),s({name:"index"});return}if(e.name!==null&&n.path!==e.path)try{if((await Re.checkAccess()).allowed){const r=await Re.getCurrentUser();r&&Qe.logPageVisit(n,r,e).catch(i=>{console.error("[Router] Error logging page visit:",i)})}}catch(t){console.error("[Router] Error in activity logging:",t)}if(n.name==="index"&&!e.name&&setTimeout(()=>{ve(()=>import("./DashboardSector1C.vue-BIq972iJ.js"),__vite__mapDeps([9,4,10,11,12,6,2,1,13,5]),import.meta.url)},1e3),n.meta.chunk)switch(n.meta.chunk){case"dashboard-sector1c":setTimeout(()=>{ve(()=>import("./dashboard-sector-1c-service-IafdWM11.js"),__vite__mapDeps([16,12,6,2,1,11]),import.meta.url)},500);break;case"admission-dashboard":setTimeout(()=>{ve(()=>import("./chunk-CBCOylN3.js").then(t=>t.l),__vite__mapDeps([2,1]),import.meta.url)},500);break}console.log("[Router] Allowing navigation to:",n.path),s()});setTimeout(()=>{const n=window.location.pathname,e=window.location.hash;e&&e!=="#/"||(n.includes("install.php")?st.replace("/install"):st.replace("/"))},0);Ue.register(dt,ut,Et,Mt,Ft,Pt,mt,gt,ft,It);Ue.defaults.responsive=!0;Ue.defaults.maintainAspectRatio=!1;Ue.defaults.plugins.legend.display=!0;Ue.defaults.plugins.legend.position="top";const hv={primary:"#007bff",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8",carryover:"#ff9800",successLight:"#6cbf47",carryoverLight:"#ffb74d",carryoverDark:"#f57c00"};class et{static startBundleLoad(){this.metrics.bundleLoadTime=performance.now()}static endBundleLoad(e){const s=performance.now()-this.metrics.bundleLoadTime;this.metrics.chunkLoadTimes.set(e,s),console.log(`üì¶ Chunk "${e}" loaded in ${s.toFixed(2)}ms`),window.gtag&&window.gtag("event","bundle_load",{chunk_name:e,load_time:s}),s>1e3&&console.warn(`üêå Slow chunk load: ${e} took ${s.toFixed(2)}ms`)}static trackComponentLoad(e,s){const t=performance.now()-s;this.metrics.componentLoadTime.set(e,t),console.log(`üß© Component "${e}" loaded in ${t.toFixed(2)}ms`),t>500&&console.warn(`üêå Slow component load: ${e} took ${t.toFixed(2)}ms`)}static trackApiCall(e,s){this.metrics.apiResponseTime.set(e,s),s>1e3&&console.warn(`üêå Slow API call to ${e}: ${s}ms`)}static getReport(){const e=Array.from(this.metrics.componentLoadTime.values()),s=Array.from(this.metrics.apiResponseTime.values()),t=Array.from(this.metrics.chunkLoadTimes.values());return{totalChunks:this.metrics.chunkLoadTimes.size,totalComponents:this.metrics.componentLoadTime.size,totalApiCalls:this.metrics.apiResponseTime.size,averageComponentLoadTime:e.length>0?e.reduce((r,i)=>r+i,0)/e.length:0,averageApiResponseTime:s.length>0?s.reduce((r,i)=>r+i,0)/s.length:0,averageChunkLoadTime:t.length>0?t.reduce((r,i)=>r+i,0)/t.length:0,slowestComponents:Array.from(this.metrics.componentLoadTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i})),slowestApiCalls:Array.from(this.metrics.apiResponseTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({endpoint:r,time:i})),slowestChunks:Array.from(this.metrics.chunkLoadTimes.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i}))}}static clearMetrics(){this.metrics.bundleLoadTime=0,this.metrics.componentLoadTime.clear(),this.metrics.apiResponseTime.clear(),this.metrics.chunkLoadTimes.clear()}}Me(et,"metrics",{bundleLoadTime:0,componentLoadTime:new Map,apiResponseTime:new Map,chunkLoadTimes:new Map});class rv{static init(){this.initChunkLoadErrorHandling(),this.initUnhandledErrorHandling(),this.initNetworkErrorHandling()}static initChunkLoadErrorHandling(){if(window.addEventListener("error",e=>{e.target.tagName==="SCRIPT"&&(console.error("‚ùå Chunk loading error:",e.target.src),this.reportError("chunk_load_error",{url:e.target.src,message:e.message||"Script load failed"}))}),"PerformanceObserver"in window)try{new PerformanceObserver(s=>{for(const t of s.getEntries())if(t.entryType==="resource"&&t.name.includes(".js")){const r=t.responseEnd-t.requestStart;et.trackApiCall(t.name,r)}}).observe({entryTypes:["resource"]})}catch{console.warn("PerformanceObserver not supported")}}static initUnhandledErrorHandling(){window.addEventListener("unhandledrejection",e=>{console.error("‚ùå Unhandled promise rejection:",e.reason),this.reportError("unhandled_rejection",{reason:e.reason?.message||String(e.reason),stack:e.reason?.stack})}),window.addEventListener("error",e=>{e.error&&e.filename&&(console.error("‚ùå Unhandled error:",e.error),this.reportError("unhandled_error",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error.stack}))})}static initNetworkErrorHandling(){const e=window.fetch;window.fetch=function(...s){const t=performance.now();return e.apply(this,s).then(r=>{const i=performance.now()-t;return et.trackApiCall(s[0],i),r.ok||console.warn(`üö® API error: ${r.status} ${r.statusText} for ${s[0]}`),r}).catch(r=>{const i=performance.now()-t;throw console.error(`‚ùå Network error for ${s[0]}:`,r),et.trackApiCall(s[0],i),this.reportError("network_error",{url:s[0],message:r.message,loadTime:i}),r})}}static reportError(e,s){const t={type:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...s};if(console.error("üìä Error report:",t),window.Sentry&&window.Sentry.captureException(new Error(`${e}: ${JSON.stringify(s)}`)),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:"/api/log-error.php",method:"POST",data:t})}catch(r){console.error("Failed to send error report to Bitrix24:",r)}window.gtag&&window.gtag("event","exception",{description:`${e}: ${s.message||"Unknown error"}`,fatal:!1})}static getErrorStats(){return{chunkLoadErrors:0,networkErrors:0,unhandledErrors:0,totalErrors:0}}}const yt=is(ms);yt.use(st);const iv=n=>{try{const e=new WeakSet;return JSON.stringify(n,(s,t)=>{if(typeof t=="object"&&t!==null){if(e.has(t))return"[Circular]";e.add(t)}return typeof t=="function"||t===void 0?null:t})}catch{return String(n)}};yt.config.errorHandler=(n,e,s)=>{if(n instanceof TypeError&&n.message.includes("Cannot read properties of undefined (reading 'type')")){console.warn("Caught undefined.type error:",{error:n.message,component:e?.$options?.name||"Unknown",info:s,stack:n.stack});return}if(console.error("Vue error:",n,s),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:Te("/api/log-error.php"),method:"POST",data:{error:n?.message||String(n),info:typeof s=="string"?s:iv(s),component:e?.$options?.name||"Unknown"}})}catch(t){console.error("Failed to log error:",t)}};yt.mount("#app");rv.init();export{Re as A,Ze as C,Nt as L,Rt as S,K as _,je as a,Pe as b,hv as c,Ee as d,ra as e,He as f,vt as g,fv as h,Bt as i,qe as n,zt as u};
