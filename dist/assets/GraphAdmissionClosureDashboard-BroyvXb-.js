const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ticketListUtils-Dm8xchCs.js","assets/priority-config-BhUzcFvi.js","assets/main-Rc665X3L.js","assets/main-hkNOQW78.css","assets/priority-config-Bxxce_5E.css","assets/ticket-mapper-DcCEXN8u.js"])))=>i.map(i=>d[i]);
var De=Object.defineProperty;var Se=(T,e,t)=>e in T?De(T,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):T[e]=t;var ce=(T,e,t)=>Se(T,typeof e!="symbol"?e+"":e,t);import{_ as oe,g as E,c as H,a as c,o as n,b as s,t as C,F as J,e as Z,n as K,d as V,f as Q,G as Ue,H as j,I as te,j as M,k as q,y as le,B as x,T as ne,l as ee,J as re,m as Ae,S as Oe,z as Be,r as Re,L as Ne}from"./main-Rc665X3L.js";import{F as Me}from"./FiltersPanel-D1WZZuUb.js";import{L as Ee,D as Pe,B as Le}from"./index-CUsye_xR.js";import{B as ae,g as Ie,a as Fe,b as $e,D as Ye,T as ie,c as ue}from"./priority-config-BhUzcFvi.js";const Ge={class:"ac-chart"},Ve={class:"ac-chart__header"},je={class:"ac-chart__subtitle"},He={class:"ac-chart__controls"},qe={class:"chart-type-selector"},ze=["onClick"],Je={class:"chart-type-icon"},Ze={class:"chart-type-label"},xe={class:"ac-chart__summary"},Xe={class:"summary-card__value"},Ke={class:"summary-card__value-main"},Qe={class:"summary-card__breakdown"},et={class:"breakdown-item breakdown-item--this-week"},tt={class:"breakdown-item__value"},st={class:"breakdown-item breakdown-item--other-week"},at={class:"breakdown-item__value"},lt={class:"summary-card__value-main"},rt={class:"summary-card__breakdown"},ot={class:"breakdown-item breakdown-item--this-week"},nt={class:"breakdown-item__value"},it={class:"breakdown-item breakdown-item--other-week"},ct={class:"breakdown-item__value"},dt={class:"summary-card summary-card--stages"},ut={class:"summary-card__tags"},kt={key:0,class:"stage-tag stage-tag--empty"},vt={class:"ac-chart__body"},mt={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(T,{emit:e}){const t=T,r=e,o=[{value:"line",label:"Ð›Ð¸Ð½ÐµÐ¹Ð½Ñ‹Ð¹",icon:"ðŸ“ˆ"},{value:"bar",label:"Ð¡Ñ‚Ð¾Ð»Ð±Ñ‡Ð°Ñ‚Ñ‹Ð¹",icon:"ðŸ“Š"},{value:"doughnut",label:"ÐšÑ€ÑƒÐ³Ð¾Ð²Ð°Ñ",icon:"ðŸ©"}],i=E("line");H(()=>{var f;return((f=t.meta)==null?void 0:f.weekNumber)??"â€”"});const W=H(()=>{var P,L,z,b,p,O,Y,l,a;const f=((P=t.meta)==null?void 0:P.weeks)||[],u=f.length>0?f.map(k=>`ÐÐµÐ´ÐµÐ»Ñ ${k.weekNumber}`):[(L=t.meta)!=null&&L.weekNumber?`ÐÐµÐ´ÐµÐ»Ñ ${t.meta.weekNumber}`:"ÐÐµÐ´ÐµÐ»Ñ"],N=Array.isArray((z=t.data.series)==null?void 0:z.new)&&t.data.series.new.length>0?t.data.series.new:[t.data.newTickets??0],m=Array.isArray((b=t.data.series)==null?void 0:b.closed)&&t.data.series.closed.length>0?t.data.series.closed:[t.data.closedTickets??0],d=Array.isArray((p=t.data.series)==null?void 0:p.closedCreatedThisWeek)&&t.data.series.closedCreatedThisWeek.length>0?t.data.series.closedCreatedThisWeek:[t.data.closedTicketsCreatedThisWeek??0],$=Array.isArray((O=t.data.series)==null?void 0:O.closedCreatedOtherWeek)&&t.data.series.closedCreatedOtherWeek.length>0?t.data.series.closedCreatedOtherWeek:[t.data.closedTicketsCreatedOtherWeek??0],g=Array.isArray((Y=t.data.series)==null?void 0:Y.carryover)&&t.data.series.carryover.length>0?t.data.series.carryover:[t.data.carryoverTickets??0],S=Array.isArray((l=t.data.series)==null?void 0:l.carryoverCreatedThisWeek)&&t.data.series.carryoverCreatedThisWeek.length>0?t.data.series.carryoverCreatedThisWeek:[t.data.carryoverTicketsCreatedThisWeek??0],U=Array.isArray((a=t.data.series)==null?void 0:a.carryoverCreatedOtherWeek)&&t.data.series.carryoverCreatedOtherWeek.length>0?t.data.series.carryoverCreatedOtherWeek:[t.data.carryoverTicketsCreatedOtherWeek??0];return{labels:u,datasets:[{label:"ÐÐ¾Ð²Ñ‹Ðµ",data:N,backgroundColor:j.primary,borderColor:j.primary,tension:.3,fill:!1},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (Ð²ÑÐµ)",data:m,backgroundColor:j.success,borderColor:j.success,tension:.3,fill:!1},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:d,backgroundColor:j.successLight,borderColor:j.successLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:$,backgroundColor:j.warning,borderColor:j.warning,tension:.3,fill:!1,borderDash:[5,5]},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (Ð²ÑÐµ)",data:g,backgroundColor:j.carryover,borderColor:j.carryover,tension:.3,fill:!1},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:S,backgroundColor:j.carryoverLight,borderColor:j.carryoverLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:U,backgroundColor:j.carryoverDark,borderColor:j.carryoverDark,tension:.3,fill:!1,borderDash:[5,5]}]}}),v=H(()=>({labels:["ÐÐ¾Ð²Ñ‹Ðµ","Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ","ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ"],datasets:[{data:[t.data.newTickets??0,t.data.closedTickets??0,t.data.carryoverTickets??0],backgroundColor:[j.primary,j.success,j.carryover],borderWidth:1}]})),_=H(()=>{switch(i.value){case"line":return Ee;case"bar":return Le;case"doughnut":return Pe;default:return Ee}}),h=H(()=>i.value==="doughnut"?v.value:W.value),I=f=>{if(!f)return"â€”";try{return new Date(f).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return f}},R=H(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{enabled:!0,callbacks:{title:f=>{var g,S,U,P,L,z;const u=(g=f[0])==null?void 0:g.dataIndex,N=((S=t.meta)==null?void 0:S.weeks)||[];if(N.length>0&&u!==void 0&&N[u]){const b=N[u];return`ÐÐµÐ´ÐµÐ»Ñ ${b.weekNumber} (${I(b.weekStartUtc)} â€” ${I(b.weekEndUtc)})`}const m=(U=t.meta)==null?void 0:U.weekNumber,d=(P=t.meta)==null?void 0:P.weekStartUtc,$=(L=t.meta)==null?void 0:L.weekEndUtc;return m&&d&&$?`ÐÐµÐ´ÐµÐ»Ñ ${m} (${I(d)} â€” ${I($)})`:((z=f[0])==null?void 0:z.label)||""}}},legend:{position:"top"}},scales:i.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0}},x:{ticks:{maxRotation:45,minRotation:45}}}})),D=H(()=>{var f,u;return(f=t.data)!=null&&f.currentWeek?t.data.currentWeek:(u=t.data)!=null&&u.weeksData&&t.data.weeksData.length>0?t.data.weeksData[t.data.weeksData.length-1]:t.data}),B=f=>{var $;const u=D.value,N=(u==null?void 0:u.newTickets)??0,m=(u==null?void 0:u.closedTickets)??0,d=(u==null?void 0:u.carryoverTickets)??0;f==="new"&&N>0?r("open-stages"):f==="closed"&&m>0?((($=t.data)==null?void 0:$.responsible)||[]).length>0&&r("open-responsible"):f==="carryover"&&d>0&&r("open-carryover")};return(f,u)=>{var N,m,d,$,g,S,U,P,L,z,b,p,O,Y,l,a;return n(),c("div",Ge,[s("header",Ve,[s("div",null,[u[3]||(u[3]=s("h2",{class:"ac-chart__title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),s("p",je," ÐÐµÐ´ÐµÐ»Ñ "+C(((m=(N=T.meta)==null?void 0:N.currentWeek)==null?void 0:m.weekNumber)??((d=T.meta)==null?void 0:d.weekNumber)??"â€”")+" Â· "+C((((g=($=T.meta)==null?void 0:$.currentWeek)==null?void 0:g.weekStartUtc)??((S=T.meta)==null?void 0:S.weekStartUtc))||"â€”")+" â€” "+C((((P=(U=T.meta)==null?void 0:U.currentWeek)==null?void 0:P.weekEndUtc)??((L=T.meta)==null?void 0:L.weekEndUtc))||"â€”")+" (UTC) ",1)]),s("div",He,[s("div",qe,[(n(),c(J,null,Z(o,k=>s("button",{key:k.value,class:K(["chart-type-btn",{active:i.value===k.value}]),onClick:w=>i.value=k.value},[s("span",Je,C(k.icon),1),s("span",Ze,C(k.label),1)],10,ze)),64))])])]),s("section",xe,[s("div",{class:"summary-card summary-card--new",onClick:u[0]||(u[0]=k=>B("new"))},[u[4]||(u[4]=s("div",{class:"summary-card__label"},"ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),s("div",Xe,C(((z=D.value)==null?void 0:z.newTickets)??0),1)]),s("div",{class:"summary-card summary-card--closed-breakdown",onClick:u[1]||(u[1]=k=>B("closed"))},[u[9]||(u[9]=s("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),s("div",Ke,C(((b=D.value)==null?void 0:b.closedTickets)??0),1),s("div",Qe,[s("div",et,[u[5]||(u[5]=s("span",{class:"breakdown-item__icon"},"âœ“",-1)),s("span",tt,C(((p=D.value)==null?void 0:p.closedTicketsCreatedThisWeek)??0),1),u[6]||(u[6]=s("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))]),s("div",st,[u[7]||(u[7]=s("span",{class:"breakdown-item__icon"},"â†»",-1)),s("span",at,C(((O=D.value)==null?void 0:O.closedTicketsCreatedOtherWeek)??0),1),u[8]||(u[8]=s("span",{class:"breakdown-item__label"},"Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))])])]),s("div",{class:"summary-card summary-card--carryover-breakdown",onClick:u[2]||(u[2]=k=>B("carryover"))},[u[14]||(u[14]=s("div",{class:"summary-card__label"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",-1)),s("div",lt,C(((Y=D.value)==null?void 0:Y.carryoverTickets)??0),1),s("div",rt,[s("div",ot,[u[10]||(u[10]=s("span",{class:"breakdown-item__icon"},"âœ“",-1)),s("span",nt,C(((l=D.value)==null?void 0:l.carryoverTicketsCreatedThisWeek)??0),1),u[11]||(u[11]=s("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),s("div",it,[u[12]||(u[12]=s("span",{class:"breakdown-item__icon"},"â†»",-1)),s("span",ct,C(((a=D.value)==null?void 0:a.carryoverTicketsCreatedOtherWeek)??0),1),u[13]||(u[13]=s("span",{class:"breakdown-item__label"},"Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ…",-1))])])]),s("div",dt,[u[15]||(u[15]=s("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),s("div",ut,[(n(!0),c(J,null,Z(T.data.stages||[],k=>(n(),c("span",{key:k.stageId,class:"stage-tag"},C(k.stageName||k.stageId)+" â€” "+C(k.count),1))),128)),!T.data.stages||T.data.stages.length===0?(n(),c("span",kt," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):V("",!0)])])]),s("div",vt,[(n(),Q(Ue(_.value),{data:h.value,options:R.value},null,8,["data","options"]))])])}}},_t=oe(mt,[["__scopeId","data-v-5643a823"]]);class de{static async getSectorData(){try{const e=await this.getAllTickets();console.log("Total tickets loaded:",e.length);const t=this.extractUniqueEmployeeIds(e);console.log("Unique employee IDs:",t);const r=await this.getEmployeesByIds(t);return console.log("Loaded employees:",r.length),{stages:this.groupTicketsByStages(e,r),employees:r,zeroPointTickets:this.getZeroPointTickets(e)}}catch(e){throw console.error("Error getting sector data:",e),e}}static async getAllTickets(){const e=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],t=[];for(const r of e){console.log(`Loading tickets for stage: ${r}`);const o=await this.getTicketsByStage(r);t.push(...o),console.log(`Loaded ${o.length} tickets for stage ${r}`)}return t}static async getTicketsByStage(e){const t=[];let r=0;const o=50;let i=!0;for(;i;)try{const v=await ae.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:e},select:["*"],order:{id:"DESC"},start:r,useOriginalUfNames:"Y"});let _=[];v&&v.result&&(Array.isArray(v.result)?_=v.result:v.result.items&&Array.isArray(v.result.items)?_=v.result.items:v.result.data&&Array.isArray(v.result.data)&&(_=v.result.data)),_.length>0?(t.push(..._),r+=_.length,i=_.length===o):i=!1}catch(v){console.error(`Error loading tickets batch for stage ${e} (start: ${r}):`,v),i=!1}t.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(t[0],null,2)),console.log("Sample ticket keys:",Object.keys(t[0])),console.log("Sample ticket assignedById variants:",{assignedById:t[0].assignedById,assignedByIdId:t[0].assignedByIdId,ASSIGNED_BY_ID:t[0].ASSIGNED_BY_ID}));const W=t.filter(v=>{const _=v.UF_CRM_7_TYPE_PRODUCT||v.uf_crm_7_type_product||v.ufCrm7TypeProduct||v.UF_CRM_7_TYPE_PRODUCT||v.uf_crm_7_type_product;return Array.isArray(_)?_.includes(this.SECTOR_TAG):typeof _=="object"&&_!==null?_.value===this.SECTOR_TAG||_===this.SECTOR_TAG:_===this.SECTOR_TAG});return console.log(`Filtered ${W.length} tickets from ${t.length} for stage ${e} (sector tag: ${this.SECTOR_TAG})`),W}static extractUniqueEmployeeIds(e){if(!Array.isArray(e))return[];const t=new Set;return e.forEach(r=>{const o=r.assignedById||r.assignedByIdId||r.ASSIGNED_BY_ID||r.assignedById||r.assignedById&&typeof r.assignedById=="object"&&(r.assignedById.id||r.assignedById.ID)||r.assignedById&&typeof r.assignedById=="object"&&r.assignedById.value;if(o){const i=parseInt(o);i&&!isNaN(i)&&i>0&&t.add(i)}}),e.length>0&&(console.log("Sample ticket for employee extraction:",e[0]),console.log("Sample ticket assignedById variants:",{assignedById:e[0].assignedById,assignedByIdId:e[0].assignedByIdId,ASSIGNED_BY_ID:e[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(t))),Array.from(t)}static async getEmployeesByIds(e){if(!Array.isArray(e)||e.length===0)return[];try{const t=await ae.call("user.get",{filter:{ID:e}});let r=[];return t&&t.result&&(Array.isArray(t.result)?r=t.result:console.warn("Unexpected user.get result format:",t)),r.map(o=>({id:parseInt(o.ID||o.id||0),name:`${o.NAME||o.name||""} ${o.LAST_NAME||o.lastName||""}`.trim()||o.EMAIL||o.email||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹",position:o.WORK_POSITION||o.workPosition||"Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº",email:o.EMAIL||o.email||"",tickets:[]}))}catch(t){return console.error("Error getting employees by IDs:",t),[]}}static groupTicketsByStages(e,t){Array.isArray(e)||(console.warn("Tickets is not an array:",e),e=[]),Array.isArray(t)||(console.warn("Employees is not an array:",t),t=[]);const r=[{id:"formed",name:"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ",color:"#007bff",employees:t.map(o=>({...o,tickets:[]}))},{id:"review",name:"Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—",color:"#ffc107",employees:t.map(o=>({...o,tickets:[]}))},{id:"execution",name:"Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ",color:"#28a745",employees:t.map(o=>({...o,tickets:[]}))}];return e.forEach(o=>{const i=this.mapStageId(o.stageId||o.STAGE_ID||""),W=r.find(v=>v.id===i);if(W){const v=o.assignedById||o.ASSIGNED_BY_ID||null,_=v?parseInt(v):null;if(_){let h=W.employees.find(I=>I.id===_);h||(h={id:_,name:`Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº #${_}`,position:"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾",email:"",tickets:[]},W.employees.push(h)),h.tickets.push(this.mapTicket(o))}}}),r}static mapStageId(e){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[e]||"formed"}static mapStageIdToBitrix(e){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[e]||"DT140_12:UC_0VHWE2"}static mapTicket(e){const t=parseInt(e.id||e.ID||0),r=e.title||e.TITLE||"Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ",o=e.stageId||e.STAGE_ID||"",i=e.assignedById||e.ASSIGNED_BY_ID||null,W=e.createdTime||e.CREATED_DATE||e.CREATED_TIME||"",v=e.updatedTime||e.MODIFY_DATE||e.UPDATED_TIME||"",_=e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.ufCrm7UfPriority||e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.priority||e.PRIORITY||null,h=Ie(_),I=Fe(h);return{id:t,title:r,priorityId:h.id,priorityLabel:h.label,priorityColors:I,priority:h.id,priorityBitrixValue:h.bitrixValue||null,status:this.mapStatus(o),assigneeId:i?parseInt(i):null,stageId:this.mapStageId(o),createdAt:W,modifiedAt:v,amount:e.opportunity||e.OPPORTUNITY||0,currency:e.currencyId||e.CURRENCY_ID||"RUB",description:e.comments||e.COMMENTS||""}}static mapPriority(e){return Ie(e).id}static mapPriorityToBitrix(e){if(e&&typeof e=="object")return e.bitrixValue||null;const t=$e(e);if(t&&t.bitrixValue)return t.bitrixValue;const r={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return r[e]?r[e]:$e(Ye).bitrixValue}static mapStatus(e){return"in_progress"}static getZeroPointTickets(e){const t={formed:[],review:[],execution:[]};return Array.isArray(e)?(e.filter(r=>!(r.assignedById||r.ASSIGNED_BY_ID)).forEach(r=>{const o=this.mapStageId(r.stageId||r.STAGE_ID||"");t[o]&&t[o].push(this.mapTicket(r))}),t):(console.warn("Tickets is not an array in getZeroPointTickets:",e),t)}static async assignTicket(e,t,r){try{const o=this.mapStageIdToBitrix(r);return(await ae.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:e,fields:{assignedById:t,stageId:o}})).result===!0}catch(o){throw console.error("Error assigning ticket:",o),o}}static async createTicket(e){try{const t=await ae.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:e.title,assignedById:e.employeeId,stageId:this.mapStageIdToBitrix(e.stageId)}});return t.result?parseInt(t.result):0}catch(t){throw console.error("Error creating ticket:",t),t}}static async getTicket(e){try{const t=await ae.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:e});return this.mapTicket(t.result)}catch(t){throw console.error("Error getting ticket:",t),t}}static async addComment(e,t){try{return(await ae.call("crm.timeline.comment.add",{fields:{entityId:e,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:t}})).result!==void 0}catch(r){throw console.error("Error adding comment:",r),r}}}ce(de,"ENTITY_TYPE_ID",140),ce(de,"SECTOR_TAG","1C");const yt="/api/graph-1c-admission-closure.php";function ht(T){var r,o,i,W,v,_,h,I,R,D,B,f,u,N,m,d,$,g,S,U,P,L,z,b,p,O,Y,l,a,k,w,A,F,y,G,X,ke,ve,me,_e,ye,he,pe,ge,be,Te,fe,we,Ce,We;if(!T)return{meta:null,data:{currentWeek:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0},newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},weeksData:[],stages:[],responsible:[],responsibleCreatedThisWeek:[],responsibleCreatedOtherWeek:[]}};const e=T.data||T.result||T,t=e.meta||T.meta||null;return{meta:{...t,currentWeek:(t==null?void 0:t.currentWeek)||(t?{weekNumber:t.weekNumber,weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc}:null),weeks:(t==null?void 0:t.weeks)||[]},data:{currentWeek:((r=e.data)==null?void 0:r.currentWeek)||(e.data?{newTickets:e.data.newTickets??0,closedTickets:e.data.closedTickets??0,closedTicketsCreatedThisWeek:e.data.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:e.data.closedTicketsCreatedOtherWeek??0,carryoverTickets:e.data.carryoverTickets??0,carryoverTicketsCreatedThisWeek:e.data.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:e.data.carryoverTicketsCreatedOtherWeek??0}:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0}),newTickets:((i=(o=e.data)==null?void 0:o.currentWeek)==null?void 0:i.newTickets)??((W=e.data)==null?void 0:W.newTickets)??e.newTickets??0,closedTickets:((_=(v=e.data)==null?void 0:v.currentWeek)==null?void 0:_.closedTickets)??((h=e.data)==null?void 0:h.closedTickets)??e.closedTickets??0,closedTicketsCreatedThisWeek:((R=(I=e.data)==null?void 0:I.currentWeek)==null?void 0:R.closedTicketsCreatedThisWeek)??((D=e.data)==null?void 0:D.closedTicketsCreatedThisWeek)??e.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:((f=(B=e.data)==null?void 0:B.currentWeek)==null?void 0:f.closedTicketsCreatedOtherWeek)??((u=e.data)==null?void 0:u.closedTicketsCreatedOtherWeek)??e.closedTicketsCreatedOtherWeek??0,carryoverTickets:((m=(N=e.data)==null?void 0:N.currentWeek)==null?void 0:m.carryoverTickets)??((d=e.data)==null?void 0:d.carryoverTickets)??e.carryoverTickets??0,carryoverTicketsCreatedThisWeek:((g=($=e.data)==null?void 0:$.currentWeek)==null?void 0:g.carryoverTicketsCreatedThisWeek)??((S=e.data)==null?void 0:S.carryoverTicketsCreatedThisWeek)??e.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:((P=(U=e.data)==null?void 0:U.currentWeek)==null?void 0:P.carryoverTicketsCreatedOtherWeek)??((L=e.data)==null?void 0:L.carryoverTicketsCreatedOtherWeek)??e.carryoverTicketsCreatedOtherWeek??0,series:{new:((b=(z=e.data)==null?void 0:z.series)==null?void 0:b.new)??((p=e.series)==null?void 0:p.new)??[0],closed:((Y=(O=e.data)==null?void 0:O.series)==null?void 0:Y.closed)??((l=e.series)==null?void 0:l.closed)??[0],closedCreatedThisWeek:((k=(a=e.data)==null?void 0:a.series)==null?void 0:k.closedCreatedThisWeek)??((w=e.series)==null?void 0:w.closedCreatedThisWeek)??[0],closedCreatedOtherWeek:((F=(A=e.data)==null?void 0:A.series)==null?void 0:F.closedCreatedOtherWeek)??((y=e.series)==null?void 0:y.closedCreatedOtherWeek)??[0],carryover:((X=(G=e.data)==null?void 0:G.series)==null?void 0:X.carryover)??((ke=e.series)==null?void 0:ke.carryover)??[0],carryoverCreatedThisWeek:((me=(ve=e.data)==null?void 0:ve.series)==null?void 0:me.carryoverCreatedThisWeek)??((_e=e.series)==null?void 0:_e.carryoverCreatedThisWeek)??[0],carryoverCreatedOtherWeek:((he=(ye=e.data)==null?void 0:ye.series)==null?void 0:he.carryoverCreatedOtherWeek)??((pe=e.series)==null?void 0:pe.carryoverCreatedOtherWeek)??[0]},weeksData:((ge=e.data)==null?void 0:ge.weeksData)??e.weeksData??[],stages:((be=e.data)==null?void 0:be.stages)??e.stages??[],responsible:((Te=e.data)==null?void 0:Te.responsible)??e.responsible??[],responsibleCreatedThisWeek:((fe=e.data)==null?void 0:fe.responsibleCreatedThisWeek)??e.responsibleCreatedThisWeek??[],responsibleCreatedOtherWeek:((we=e.data)==null?void 0:we.responsibleCreatedOtherWeek)??e.responsibleCreatedOtherWeek??[],newTicketsByStages:((Ce=e.data)==null?void 0:Ce.newTicketsByStages)??e.newTicketsByStages??null,carryoverTicketsByDuration:((We=e.data)==null?void 0:We.carryoverTicketsByDuration)??e.carryoverTicketsByDuration??null}}}async function se(T={}){const{endpoint:e=yt,product:t="1C",weekStartUtc:r=null,weekEndUtc:o=null,useCache:i=!0,forceRefresh:W=!1,includeTickets:v=!1,includeNewTicketsByStages:_=!1,includeCarryoverTickets:h=!0,includeCarryoverTicketsByDuration:I=!1}=T,D=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({product:t,weekStartUtc:r,weekEndUtc:o,useCache:i,forceRefresh:W,includeTickets:v,includeNewTicketsByStages:_,includeCarryoverTickets:h,includeCarryoverTicketsByDuration:I})});if(!D.ok)throw new Error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° (${D.status})`);const B=await D.json();if((B==null?void 0:B.success)===!1)throw new Error(B.message||"Ð‘ÑÐºÐµÐ½Ð´ Ð²ÐµÑ€Ð½ÑƒÐ» Ð¾ÑˆÐ¸Ð±ÐºÑƒ");return ht(B)}const pt={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},gt={class:"modal"},bt={key:0,class:"modal__tabs"},Tt={key:"level-0-categories",class:"level-0"},ft={class:"modal__header"},wt={class:"modal__title"},Ct={key:0},Wt={class:"modal__body"},Et={class:"categories-list"},It=["onClick"],$t={class:"category-item"},Dt={class:"category-item__icon"},St={key:0},Ut={key:1},At={class:"category-item__content"},Ot={class:"category-item__label"},Bt={class:"category-item__count"},Rt={key:0,class:"category-item__arrow"},Nt={class:"modal__footer"},Mt={key:"level-1-categories",class:"level-1"},Pt={class:"modal__header"},Lt={class:"modal__body"},Ft={key:"loading",class:"loading-names"},Yt={key:"empty",class:"modal__empty"},Gt={key:"list",class:"responsible-list"},Vt=["onClick"],jt={class:"responsible-list__name"},Ht={class:"responsible-list__count"},qt={key:0,class:"responsible-list__arrow"},zt={class:"modal__footer"},Jt={key:"level-2-categories",class:"level-2"},Zt={class:"modal__header"},xt={class:"modal__title"},Xt={class:"modal__body"},Kt={key:"loading",class:"loading-state"},Qt={key:"error",class:"error-state"},es={class:"error-message"},ts={key:"empty",class:"empty-state"},ss={key:"tickets",class:"tickets-list-container"},as={key:"level-0-employees",class:"level-0"},ls={class:"modal__header"},rs={class:"modal__title"},os={key:0},ns={class:"modal__body"},is={key:"loading",class:"loading-names"},cs={key:"empty",class:"modal__empty"},ds={key:"list",class:"responsible-list"},us=["onClick"],ks={class:"responsible-list__name"},vs={class:"responsible-list__count"},ms={key:0,class:"responsible-list__arrow"},_s={class:"modal__footer"},ys={key:"level-1-employees",class:"level-1"},hs={class:"modal__header"},ps={class:"modal__title"},gs={class:"modal__body"},bs={class:"categories-list"},Ts=["onClick"],fs={class:"category-item"},ws={class:"category-item__icon"},Cs={key:0},Ws={key:1},Es={class:"category-item__content"},Is={class:"category-item__label"},$s={class:"category-item__count"},Ds={key:0,class:"category-item__arrow"},Ss={class:"modal__footer"},Us={key:"level-2-employees",class:"level-2"},As={class:"modal__header"},Os={class:"modal__title"},Bs={class:"modal__body"},Rs={key:"loading",class:"loading-state"},Ns={key:"error",class:"error-state"},Ms={class:"error-message"},Ps={key:"empty",class:"empty-state"},Ls={class:"empty-state-message"},Fs={key:"tickets",class:"tickets-list-container"},Ys={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(T){const e=T,t=E(0),r=E("categories"),o=E(null),i=E(null),W=E(null),v=E([]),_=E(!1),h=E(null),I=E([]),R=E([]),D=E(!1),B=H(()=>[{id:"created-this-week",label:"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ",count:e.closedTicketsCreatedThisWeek??0,responsible:e.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ€Ð°Ð½ÐµÐµ",count:e.closedTicketsCreatedOtherWeek??0,responsible:e.responsibleCreatedOtherWeek??[]}]),f=H(()=>{const l=new Map;return(e.responsibleCreatedThisWeek||[]).forEach(a=>{const k=a.id??"unassigned";l.has(k)||l.set(k,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const w=l.get(k);w.thisWeekCount=a.count??0,w.thisWeekTickets=a.tickets||[],w.totalCount+=w.thisWeekCount}),(e.responsibleCreatedOtherWeek||[]).forEach(a=>{const k=a.id??"unassigned";l.has(k)||l.set(k,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const w=l.get(k);w.otherWeekCount=a.count??0,w.otherWeekTickets=a.tickets||[],w.totalCount+=w.otherWeekCount}),Array.from(l.values())}),u=H(()=>{if(!i.value)return[];const l=i.value.thisWeekTickets||[],a=i.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:i.value.id,name:i.value.name,thisWeekCount:i.value.thisWeekCount,otherWeekCount:i.value.otherWeekCount,thisWeekTickets:l.length,otherWeekTickets:a.length,employee:i.value}),[{id:"this-week",label:"ÐÐ° ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ðµ",count:i.value.thisWeekCount??0,tickets:l,employeeId:i.value.id},{id:"other-week",label:"ÐÐ° Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ðµ",count:i.value.otherWeekCount??0,tickets:a,employeeId:i.value.id}]}),N=H(()=>(R.value||[]).length>0);async function m(l){const a=l.filter(k=>k.id!==null&&k.id!==void 0).map(k=>k.id);if(a.length===0)return l;try{const k=await de.getEmployeesByIds(a),w=new Map;return k.forEach(A=>{w.set(A.id,A.name)}),l.map(A=>A.id&&w.has(A.id)?{...A,name:w.get(A.id)}:A)}catch(k){return console.error("[ResponsibleModal] Error enriching names:",k),l}}te([()=>r.value,()=>f.value],async([l,a])=>{if(!(l!=="employees"||t.value!==0)){if(!a||a.length===0){R.value=[];return}D.value=!0;try{R.value=await m(a)}catch(k){console.error("[ResponsibleModal] Error loading employee names:",k),R.value=a}finally{D.value=!1}}},{immediate:!0}),te(()=>e.responsible,async l=>{if(!(t.value!==0||o.value||r.value!=="categories")){if(!l||l.length===0){I.value=[];return}D.value=!0;try{I.value=await m(l)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),I.value=l}finally{D.value=!1}}},{immediate:!1});const d=H(()=>(I.value||[]).length>0);function $(l){r.value!==l&&(r.value=l,t.value=0,o.value=null,i.value=null,W.value=null,v.value=[],h.value=null,I.value=[],R.value=[])}async function g(l){if(!(!l||l.count===0)){o.value=l,t.value=1,D.value=!0;try{I.value=await m(l.responsible)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),I.value=l.responsible}finally{D.value=!1}}}async function S(l,a=null){var k,w;!l||!l.id||l.totalCount===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:l.id,name:l.name,thisWeekCount:l.thisWeekCount,otherWeekCount:l.otherWeekCount,thisWeekTickets:((k=l.thisWeekTickets)==null?void 0:k.length)||0,otherWeekTickets:((w=l.otherWeekTickets)==null?void 0:w.length)||0,employee:l}),i.value={...l,thisWeekTickets:l.thisWeekTickets||[],otherWeekTickets:l.otherWeekTickets||[]},t.value=1)}async function U(l){var k;if(!l||l.count===0)return;W.value=l,t.value=2;const a=l.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:l.id,label:l.label,count:l.count,ticketsInGradation:a.length,selectedEmployee:(k=i.value)==null?void 0:k.id}),a.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",a.length),await P(a)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await L(l))}async function P(l){_.value=!0,h.value=null;try{try{const{prepareTicketsForDisplay:a}=await re(async()=>{const{prepareTicketsForDisplay:k}=await import("./ticketListUtils-Dm8xchCs.js").then(w=>w.t);return{prepareTicketsForDisplay:k}},__vite__mapDeps([0,1,2,3,4,5]));v.value=await a(l,null,null)}catch(a){console.error("[ResponsibleModal] Error preparing tickets:",a),v.value=l}v.value.length===0&&(h.value=null)}catch(a){h.value=a.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets:",a),v.value=[]}finally{_.value=!1}}async function L(l){_.value=!0,h.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc||!i.value)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸ Ð¸Ð»Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº");const a=await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeTickets:!0}),k=l.id==="this-week"?a.data.responsibleCreatedThisWeek:a.data.responsibleCreatedOtherWeek,w=k==null?void 0:k.find(F=>F.id===i.value.id),A=(w==null?void 0:w.tickets)||[];try{const{prepareTicketsForDisplay:F}=await re(async()=>{const{prepareTicketsForDisplay:y}=await import("./ticketListUtils-Dm8xchCs.js").then(G=>G.t);return{prepareTicketsForDisplay:y}},__vite__mapDeps([0,1,2,3,4,5]));v.value=await F(A,null,null)}catch(F){console.error("[ResponsibleModal] Error preparing tickets:",F),v.value=A}v.value.length===0&&(h.value=null)}catch(a){h.value=a.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets from API:",a),v.value=[]}finally{_.value=!1}}async function z(l,a=null){!l||!l.id||l.count===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),i.value=l,t.value=2,await b(l.id))}async function b(l){var a;_.value=!0,h.value=null;try{let k=[];if(o.value&&o.value.responsible){const w=o.value.responsible.find(A=>A.id===l);k=(w==null?void 0:w.tickets)||[]}if(k.length===0&&e.weekStartUtc&&e.weekEndUtc){const w=await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeTickets:!0}),A=((a=o.value)==null?void 0:a.id)==="created-this-week"?w.data.responsibleCreatedThisWeek:w.data.responsibleCreatedOtherWeek,F=A==null?void 0:A.find(y=>y.id===l);k=(F==null?void 0:F.tickets)||[]}try{const{prepareTicketsForDisplay:w}=await re(async()=>{const{prepareTicketsForDisplay:A}=await import("./ticketListUtils-Dm8xchCs.js").then(F=>F.t);return{prepareTicketsForDisplay:A}},__vite__mapDeps([0,1,2,3,4,5]));v.value=await w(k,null,null)}catch(w){console.error("[ResponsibleModal] Error preparing tickets:",w),v.value=k}v.value.length===0&&(h.value=null)}catch(k){h.value=k.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets:",k),v.value=[]}finally{_.value=!1}}function p(){t.value===2?(t.value=1,r.value==="categories"?i.value=null:W.value=null,v.value=[],h.value=null):t.value===1&&(t.value=0,r.value==="categories"?(o.value=null,I.value=[]):i.value=null)}function O(l){const a=ue(l.id);window.open(a,"_blank")}function Y(){r.value==="employees"&&W.value?P(W.value.tickets):r.value==="categories"&&i.value&&b(i.value.id)}return te(()=>e.isVisible,l=>{l||(t.value=0,r.value="categories",o.value=null,i.value=null,W.value=null,v.value=[],h.value=null,I.value=[],R.value=[])}),(l,a)=>T.isVisible?(n(),c("div",pt,[s("div",gt,[t.value===0?(n(),c("div",bt,[s("button",{class:K(["modal__tab",{"modal__tab--active":r.value==="categories"}]),onClick:a[0]||(a[0]=k=>$("categories"))}," ÐŸÐ¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼ ",2),s("button",{class:K(["modal__tab",{"modal__tab--active":r.value==="employees"}]),onClick:a[1]||(a[1]=k=>$("employees"))}," ÐŸÐ¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼ ",2)])):V("",!0),M(x,{name:"level",mode:"out-in"},{default:q(()=>{var k,w,A,F;return[r.value==="categories"&&t.value===0?(n(),c("div",Tt,[s("header",ft,[s("h3",wt,[a[12]||(a[12]=le(" Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),T.weekNumber?(n(),c("span",Ct," Â· ÐÐµÐ´ÐµÐ»Ñ "+C(T.weekNumber),1)):V("",!0)]),s("button",{class:"modal__close",onClick:a[2]||(a[2]=y=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Wt,[s("ul",Et,[(n(!0),c(J,null,Z(B.value,y=>(n(),c("li",{key:y.id,class:K(["categories-list__item",{"categories-list__item--clickable":y.count>0}]),onClick:G=>g(y)},[s("div",$t,[s("div",Dt,[y.id==="created-this-week"?(n(),c("span",St,"âœ“")):(n(),c("span",Ut,"â†»"))]),s("div",At,[s("div",Ot,C(y.label),1),s("div",Bt,C(y.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1)]),y.count>0?(n(),c("span",Rt,"â†’")):V("",!0)])],10,It))),128))])]),s("footer",Nt,[s("button",{class:"btn",onClick:a[3]||(a[3]=y=>l.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):r.value==="categories"&&t.value===1?(n(),c("div",Mt,[s("header",Pt,[s("button",{class:"btn-back",onClick:p,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),a[13]||(a[13]=s("h3",{class:"modal__title"},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),s("button",{class:"modal__close",onClick:a[4]||(a[4]=y=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Lt,[M(x,{name:"loading",mode:"out-in"},{default:q(()=>[D.value?(n(),c("div",Ft,[...a[14]||(a[14]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð¼Ñ‘Ð½ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²...",-1)])])):d.value?(n(),c("ul",Gt,[(n(!0),c(J,null,Z(I.value,y=>(n(),c("li",{key:y.id||y.name,class:K(["responsible-list__item",{"responsible-list__item--clickable":y.id&&y.count>0}]),onClick:G=>z(y,G),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°"},[s("span",jt,C(y.name||"ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½"),1),s("span",Ht,C(y.count??0)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),y.id&&y.count>0?(n(),c("span",qt,"â†’")):V("",!0)],10,Vt))),128))])):(n(),c("p",Yt,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¼"))]),_:1})]),s("footer",zt,[s("button",{class:"btn",onClick:a[5]||(a[5]=y=>l.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):r.value==="categories"&&t.value===2?(n(),c("div",Jt,[s("header",Zt,[s("button",{class:"btn-back",onClick:p,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",xt,"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+C(((k=i.value)==null?void 0:k.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),s("button",{class:"modal__close",onClick:a[6]||(a[6]=y=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Xt,[M(x,{name:"loading",mode:"out-in"},{default:q(()=>[_.value?(n(),c("div",Kt,[...a[15]||(a[15]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):h.value?(n(),c("div",Qt,[a[16]||(a[16]=s("div",{class:"error-icon"},"âš ï¸",-1)),a[17]||(a[17]=s("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),s("p",es,C(h.value),1),s("button",{class:"btn btn-retry",onClick:Y},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):v.value.length===0?(n(),c("div",ts,[...a[18]||(a[18]=[s("div",{class:"empty-state-icon"},"ðŸ“‹",-1),s("p",{class:"empty-state-message"},"Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)])])):(n(),c("div",ss,[M(ne,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(n(!0),c(J,null,Z(v.value,(y,G)=>(n(),Q(ie,{key:y.id,ticket:y,draggable:!1,style:ee({"--ticket-index":G}),onClick:O},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):r.value==="employees"&&t.value===0?(n(),c("div",as,[s("header",ls,[s("h3",rs,[a[19]||(a[19]=le(" Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),T.weekNumber?(n(),c("span",os," Â· ÐÐµÐ´ÐµÐ»Ñ "+C(T.weekNumber),1)):V("",!0)]),s("button",{class:"modal__close",onClick:a[7]||(a[7]=y=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",ns,[M(x,{name:"loading",mode:"out-in"},{default:q(()=>[D.value?(n(),c("div",is,[...a[20]||(a[20]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð¼Ñ‘Ð½ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²...",-1)])])):N.value?(n(),c("ul",ds,[(n(!0),c(J,null,Z(R.value,y=>(n(),c("li",{key:y.id||y.name,class:K(["responsible-list__item",{"responsible-list__item--clickable":y.id&&y.totalCount>0}]),onClick:G=>S(y,G),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð³Ñ€Ð°Ð´Ð°Ñ†Ð¸Ð¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°"},[s("span",ks,C(y.name||"ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½"),1),s("span",vs,C(y.totalCount??0)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),y.id&&y.totalCount>0?(n(),c("span",ms,"â†’")):V("",!0)],10,us))),128))])):(n(),c("p",cs,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼"))]),_:1})]),s("footer",_s,[s("button",{class:"btn",onClick:a[8]||(a[8]=y=>l.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):r.value==="employees"&&t.value===1?(n(),c("div",ys,[s("header",hs,[s("button",{class:"btn-back",onClick:p,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",ps,"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+C(((w=i.value)==null?void 0:w.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),s("button",{class:"modal__close",onClick:a[9]||(a[9]=y=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",gs,[s("ul",bs,[(n(!0),c(J,null,Z(u.value,y=>(n(),c("li",{key:y.id,class:K(["categories-list__item",{"categories-list__item--clickable":y.count>0}]),onClick:G=>U(y)},[s("div",fs,[s("div",ws,[y.id==="this-week"?(n(),c("span",Cs,"âœ“")):(n(),c("span",Ws,"â†»"))]),s("div",Es,[s("div",Is,C(y.label),1),s("div",$s,C(y.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1)]),y.count>0?(n(),c("span",Ds,"â†’")):V("",!0)])],10,Ts))),128))])]),s("footer",Ss,[s("button",{class:"btn",onClick:a[10]||(a[10]=y=>l.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):r.value==="employees"&&t.value===2?(n(),c("div",Us,[s("header",As,[s("button",{class:"btn-back",onClick:p,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",Os," Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+C(((A=i.value)==null?void 0:A.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾")+" ("+C(((F=W.value)==null?void 0:F.label)||"")+") ",1),s("button",{class:"modal__close",onClick:a[11]||(a[11]=y=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Bs,[M(x,{name:"loading",mode:"out-in"},{default:q(()=>{var y;return[_.value?(n(),c("div",Rs,[...a[21]||(a[21]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):h.value?(n(),c("div",Ns,[a[22]||(a[22]=s("div",{class:"error-icon"},"âš ï¸",-1)),a[23]||(a[23]=s("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),s("p",Ms,C(h.value),1),s("button",{class:"btn btn-retry",onClick:Y},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):v.value.length===0?(n(),c("div",Ps,[a[24]||(a[24]=s("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),s("p",Ls,C(r.value==="employees"?`Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${((y=W.value)==null?void 0:y.label)||""}"`:"Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ"),1)])):(n(),c("div",Fs,[M(ne,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(n(!0),c(J,null,Z(v.value,(G,X)=>(n(),Q(ie,{key:G.id,ticket:G,draggable:!1,style:ee({"--ticket-index":X}),onClick:O},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):V("",!0)]}),_:1})])])):V("",!0)}},Gs=oe(Ys,[["__scopeId","data-v-3b229bb4"]]),Vs={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},js={class:"modal"},Hs={key:"level-1",class:"level-1"},qs={class:"modal__header"},zs={class:"modal__title"},Js={key:0},Zs={class:"modal__body"},xs={key:"loading",class:"loading-names"},Xs={key:"empty",class:"modal__empty"},Ks={key:"list",class:"stages-list"},Qs=["onClick"],ea={class:"stages-list__name"},ta={class:"stages-list__count"},sa={key:0,class:"stages-list__arrow"},aa={class:"modal__footer"},la={key:"level-2",class:"level-2"},ra={class:"modal__header"},oa={class:"modal__title"},na={class:"modal__body"},ia={key:"loading",class:"loading-state"},ca={key:"error",class:"error-state"},da={class:"error-message"},ua={key:"empty",class:"empty-state"},ka={class:"empty-state-message"},va={key:"tickets",class:"tickets-list-container"},ma={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(T,{emit:e}){const t=T,r=E(1),o=E(null),i=E([]),W=E(!1),v=E(!1),_=E(null),h=E([]),I=H(()=>h.value.length>0&&h.value.some(m=>m.count>0));async function R(){if(!t.weekStartUtc||!t.weekEndUtc){h.value=[];return}v.value=!0,_.value=null;try{const m=await se({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0});h.value=m.data.newTicketsByStages||[]}catch(m){_.value=m.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÑ‚Ð°Ð´Ð¸Ð¹",console.error("[StagesModal] Error loading stages:",m),h.value=[]}finally{v.value=!1}}async function D(m,d=null){!m||m.count===0||(d&&d.currentTarget&&(d.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{d.currentTarget&&(d.currentTarget.style.transform="")},150)),o.value=m,r.value=2,await B(m.stageId))}async function B(m){var d;W.value=!0,_.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const g=(d=(await se({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:d.find(U=>U.stageId===m),S=(g==null?void 0:g.tickets)||[];try{const{prepareTicketsForDisplay:U}=await re(async()=>{const{prepareTicketsForDisplay:P}=await import("./ticketListUtils-Dm8xchCs.js").then(L=>L.t);return{prepareTicketsForDisplay:P}},__vite__mapDeps([0,1,2,3,4,5]));i.value=await U(S,null,null)}catch(U){console.error("[StagesModal] Error preparing tickets:",U),i.value=S}i.value.length===0&&(_.value=null)}catch($){_.value=$.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[StagesModal] Error loading tickets:",$),i.value=[]}finally{W.value=!1}}function f(){r.value=1,o.value=null,i.value=[],_.value=null}function u(m){const d=ue(m.id);window.open(d,"_blank")}function N(){o.value&&B(o.value.stageId)}return te(()=>t.isVisible,m=>{m?R():(r.value=1,o.value=null,i.value=[],_.value=null,h.value=[])}),te([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&R()}),(m,d)=>T.isVisible?(n(),c("div",Vs,[s("div",js,[M(x,{name:"level",mode:"out-in"},{default:q(()=>{var $;return[r.value===1?(n(),c("div",Hs,[s("header",qs,[s("h3",zs,[d[3]||(d[3]=le(" ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),T.weekNumber?(n(),c("span",Js," Â· ÐÐµÐ´ÐµÐ»Ñ "+C(T.weekNumber),1)):V("",!0)]),s("button",{class:"modal__close",onClick:d[0]||(d[0]=g=>m.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Zs,[M(x,{name:"loading",mode:"out-in"},{default:q(()=>[v.value?(n(),c("div",xs,[...d[4]||(d[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÑ‚Ð°Ð´Ð¸Ð¹...",-1)])])):I.value?(n(),c("ul",Ks,[(n(!0),c(J,null,Z(h.value,g=>(n(),c("li",{key:g.stageId,class:K(["stages-list__item",{"stages-list__item--clickable":g.count>0}]),style:ee({"--stage-color":g.color}),onClick:S=>D(g,S),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÑ‚Ð°Ð´Ð¸Ð¸"},[s("span",{class:"stages-list__color",style:ee({backgroundColor:g.color})},null,4),s("span",ea,C(g.stageName),1),s("span",ta,C(g.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),g.count>0?(n(),c("span",sa,"â†’")):V("",!0)],14,Qs))),128))])):(n(),c("p",Xs," ÐÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),s("footer",aa,[s("button",{class:"btn",onClick:d[1]||(d[1]=g=>m.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):r.value===2?(n(),c("div",la,[s("header",ra,[s("button",{class:"btn-back",onClick:f,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",oa," Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÑ‚Ð°Ð´Ð¸Ð¸: "+C((($=o.value)==null?void 0:$.stageName)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),s("button",{class:"modal__close",onClick:d[2]||(d[2]=g=>m.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",na,[M(x,{name:"loading",mode:"out-in"},{default:q(()=>{var g;return[W.value?(n(),c("div",ia,[...d[5]||(d[5]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):_.value?(n(),c("div",ca,[d[6]||(d[6]=s("div",{class:"error-icon"},"âš ï¸",-1)),d[7]||(d[7]=s("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),s("p",da,C(_.value),1),s("button",{class:"btn btn-retry",onClick:N},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):i.value.length===0?(n(),c("div",ua,[d[8]||(d[8]=s("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),s("p",ka," ÐÐ° ÑÑ‚Ð°Ð´Ð¸Ð¸ Â«"+C((g=o.value)==null?void 0:g.stageName)+"Â» Ð½ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ ",1)])):(n(),c("div",va,[M(ne,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(n(!0),c(J,null,Z(i.value,(S,U)=>(n(),Q(ie,{key:S.id,ticket:S,draggable:!1,style:ee({"--ticket-index":U}),onClick:u},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):V("",!0)]}),_:1})])])):V("",!0)}},_a=oe(ma,[["__scopeId","data-v-4af0cfce"]]),ya={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},ha={class:"modal"},pa={key:"level-1",class:"level-1"},ga={class:"modal__header"},ba={class:"modal__title"},Ta={key:0},fa={class:"modal__body"},wa={key:"loading",class:"loading-names"},Ca={key:"empty",class:"modal__empty"},Wa={key:"list",class:"duration-list"},Ea=["onClick"],Ia={class:"duration-list__name"},$a={class:"duration-list__count"},Da={key:0,class:"duration-list__arrow"},Sa={class:"modal__footer"},Ua={key:"level-2",class:"level-2"},Aa={class:"modal__header"},Oa={class:"modal__title"},Ba={class:"modal__body"},Ra={key:"loading",class:"loading-state"},Na={key:"error",class:"error-state"},Ma={class:"error-message"},Pa={key:"empty",class:"empty-state"},La={class:"empty-state-message"},Fa={key:"tickets",class:"tickets-list-container"},Ya={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(T,{emit:e}){const t=T,r=E(1),o=E(null),i=E([]),W=E(!1),v=E(!1),_=E(null),h=E([]),I=H(()=>h.value.length>0&&h.value.some(m=>m.count>0));async function R(){if(!t.weekStartUtc||!t.weekEndUtc){h.value=[];return}v.value=!0,_.value=null;try{const m=await se({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});h.value=m.data.carryoverTicketsByDuration||[]}catch(m){_.value=m.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹",console.error("[CarryoverDurationModal] Error loading categories:",m),h.value=[]}finally{v.value=!1}}async function D(m,d=null){!m||m.count===0||(d&&d.currentTarget&&(d.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{d.currentTarget&&(d.currentTarget.style.transform="")},150)),o.value=m,r.value=2,await B(m.durationCategory))}async function B(m){var d;W.value=!0,_.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const g=(d=(await se({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})).data.carryoverTicketsByDuration)==null?void 0:d.find(U=>U.durationCategory===m),S=(g==null?void 0:g.tickets)||[];try{const{prepareTicketsForDisplay:U}=await re(async()=>{const{prepareTicketsForDisplay:P}=await import("./ticketListUtils-Dm8xchCs.js").then(L=>L.t);return{prepareTicketsForDisplay:P}},__vite__mapDeps([0,1,2,3,4,5]));i.value=await U(S,null,null)}catch(U){console.error("[CarryoverDurationModal] Error preparing tickets:",U),i.value=S}i.value.length===0&&(_.value=null)}catch($){_.value=$.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[CarryoverDurationModal] Error loading tickets:",$),i.value=[]}finally{W.value=!1}}function f(){r.value=1,o.value=null,i.value=[],_.value=null}function u(m){const d=ue(m.id);window.open(d,"_blank")}function N(){o.value&&B(o.value.durationCategory)}return te(()=>t.isVisible,m=>{m?R():(r.value=1,o.value=null,i.value=[],_.value=null,h.value=[])}),te([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&R()}),(m,d)=>T.isVisible?(n(),c("div",ya,[s("div",ha,[M(x,{name:"level",mode:"out-in"},{default:q(()=>{var $;return[r.value===1?(n(),c("div",pa,[s("header",ga,[s("h3",ba,[d[3]||(d[3]=le(" ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ€Ð¾ÐºÐ°Ð¼",-1)),T.weekNumber?(n(),c("span",Ta," Â· ÐÐµÐ´ÐµÐ»Ñ "+C(T.weekNumber),1)):V("",!0)]),s("button",{class:"modal__close",onClick:d[0]||(d[0]=g=>m.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",fa,[M(x,{name:"loading",mode:"out-in"},{default:q(()=>[v.value?(n(),c("div",wa,[...d[4]||(d[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹...",-1)])])):I.value?(n(),c("ul",Wa,[(n(!0),c(J,null,Z(h.value,g=>(n(),c("li",{key:g.durationCategory,class:K(["duration-list__item",{"duration-list__item--clickable":g.count>0}]),style:ee({"--duration-color":g.color}),onClick:S=>D(g,S),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"},[s("span",{class:"duration-list__color",style:ee({backgroundColor:g.color})},null,4),s("span",Ia,C(g.durationLabel),1),s("span",$a,C(g.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),g.count>0?(n(),c("span",Da,"â†’")):V("",!0)],14,Ea))),128))])):(n(),c("p",Ca," ÐÐµÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),s("footer",Sa,[s("button",{class:"btn",onClick:d[1]||(d[1]=g=>m.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):r.value===2?(n(),c("div",Ua,[s("header",Aa,[s("button",{class:"btn-back",onClick:f,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",Oa," Ð¢Ð¸ÐºÐµÑ‚Ñ‹: "+C((($=o.value)==null?void 0:$.durationLabel)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),s("button",{class:"modal__close",onClick:d[2]||(d[2]=g=>m.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Ba,[M(x,{name:"loading",mode:"out-in"},{default:q(()=>{var g;return[W.value?(n(),c("div",Ra,[...d[5]||(d[5]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):_.value?(n(),c("div",Na,[d[6]||(d[6]=s("div",{class:"error-icon"},"âš ï¸",-1)),d[7]||(d[7]=s("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),s("p",Ma,C(_.value),1),s("button",{class:"btn btn-retry",onClick:N},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):i.value.length===0?(n(),c("div",Pa,[d[8]||(d[8]=s("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),s("p",La," Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Â«"+C((g=o.value)==null?void 0:g.durationLabel)+"Â» Ð½ÐµÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1)])):(n(),c("div",Fa,[M(ne,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(n(!0),c(J,null,Z(i.value,(S,U)=>(n(),Q(ie,{key:S.id,ticket:S,draggable:!1,style:ee({"--ticket-index":U}),onClick:u},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):V("",!0)]}),_:1})])])):V("",!0)}},Ga=oe(Ya,[["__scopeId","data-v-c26f06c2"]]),Va={class:"ac-dashboard"},ja={key:1},Ha={class:"dashboard-header"},qa={class:"header-content"},za={class:"breadcrumbs-row"},Ja=["aria-label","aria-disabled","data-fallback","disabled"],Za={class:"breadcrumbs","aria-label":"ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ"},xa={class:"dashboard-layout"},Xa={class:"filters-container"},Ka={class:"chart-container"},Qa={__name:"GraphAdmissionClosureDashboard",setup(T){const e=Be(),t=E(!0),r=E(null),o=E(null),i=E({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),W=E(!1),v=E(!1),_=E(!1),h=E(!1),I=H(()=>typeof window>"u"?!1:window.history.length>1),R=H(()=>I.value?"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ":"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"),D={name:"dashboard-sector-1c"};function B(b){var p;if((p=b==null?void 0:b.preventDefault)==null||p.call(b),!h.value){h.value=!0;try{if(I.value){e.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),e.push(D)}finally{h.value=!1}}}const f=E({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),u=E(null),N=H(()=>{const b=f.value.customDateRange.startDate||f.value.customDateRange.endDate,p=f.value.employees.length===1&&f.value.employees.includes("all");return b||!p});async function m(){t.value=!0,r.value=null;try{let b,p;if(u.value)b=u.value.startUtc,p=u.value.endUtc;else{const l=z();b=l.weekStartUtc,p=l.weekEndUtc}const{meta:O,data:Y}=await se({product:"1C",weekStartUtc:b,weekEndUtc:p,includeTickets:!0});o.value=O,i.value=Y,!u.value&&O&&(u.value={weekNumber:O.weekNumber,startUtc:O.weekStartUtc,endUtc:O.weekEndUtc})}catch(b){r.value=b instanceof Error?b:new Error("ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸"),console.error("[GraphAdmissionClosureDashboard] loadData error:",b)}finally{t.value=!1}}function d(b){f.value.stages=b}function $(b){f.value.employees=b}function g(b){f.value.dateRange=b}function S(b){f.value.customDateRange=b}function U(b){u.value=b}function P(){f.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},L()}function L(){m()}Ae(()=>{m()});function z(){const b=new Date,p=new Date(Date.UTC(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate())),O=p.getUTCDay(),Y=p.getUTCDate()-O+(O===0?-6:1),l=new Date(Date.UTC(p.getUTCFullYear(),p.getUTCMonth(),Y,0,0,0)),a=new Date(l);return a.setUTCDate(a.getUTCDate()+6),a.setUTCHours(23,59,59,999),{weekStartUtc:l.toISOString(),weekEndUtc:a.toISOString()}}return(b,p)=>{var Y,l,a,k,w,A,F,y,G;const O=Re("router-link");return n(),c("div",Va,[t.value?(n(),Q(Ne,{key:0,message:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…..."})):(n(),c("div",ja,[s("div",Ha,[s("div",qa,[s("div",za,[s("button",{class:"btn-back-link",type:"button",onClick:B,"aria-label":R.value,"aria-disabled":!I.value,"data-fallback":!I.value,disabled:h.value,title:"ÐÐ°Ð·Ð°Ð´"}," â† ",8,Ja),s("nav",Za,[M(O,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:q(()=>[...p[6]||(p[6]=[le(" Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡ ",-1)])]),_:1}),p[8]||(p[8]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),M(O,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:q(()=>[...p[7]||(p[7]=[le(" Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ",-1)])]),_:1}),p[9]||(p[9]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),p[10]||(p[10]=s("span",{class:"breadcrumb-current"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹",-1))])]),p[11]||(p[11]=s("h1",{class:"dashboard-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),p[12]||(p[12]=s("p",{class:"dashboard-subtitle"}," Ð”Ð¾ÑÑ‚ÑƒÐ¿Ñ‹ Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ñ‹ Â«Ð“Ñ€Ð°Ñ„Ð¸ÐºÑƒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑÂ», ÑÐµÐ»ÐµÐºÑ‚Ð¾Ñ€ ÑÑ‚Ð°Ð¿Ð¾Ð² ÑÐºÑ€Ñ‹Ñ‚. ",-1))])]),s("div",xa,[s("div",Xa,[M(Me,{stages:f.value.stages,employees:f.value.employees,dateRange:f.value.dateRange,customDateRange:f.value.customDateRange,hasActiveFilters:N.value,hideStages:!0,weekPickerMode:!0,selectedWeek:u.value,weeksCount:52,"onUpdate:stages":d,"onUpdate:employees":$,"onUpdate:dateRange":g,"onUpdate:customDateRange":S,"onUpdate:selectedWeek":U,onReset:P,onApply:L},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","selectedWeek"])]),s("div",Ka,[r.value?(n(),Q(Oe,{key:0,type:"error",title:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",message:r.value.message},null,8,["message"])):(n(),Q(_t,{key:1,meta:o.value,data:i.value,onOpenResponsible:p[0]||(p[0]=X=>W.value=!0),onOpenStages:p[1]||(p[1]=X=>v.value=!0),onOpenCarryover:p[2]||(p[2]=X=>_.value=!0)},null,8,["meta","data"]))])])])),M(Gs,{"is-visible":W.value,responsible:i.value.responsible||[],"closed-tickets-created-this-week":i.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":i.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":i.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":i.value.responsibleCreatedOtherWeek||[],"week-number":((Y=o.value)==null?void 0:Y.weekNumber)||null,"week-start-utc":((l=o.value)==null?void 0:l.weekStartUtc)||null,"week-end-utc":((a=o.value)==null?void 0:a.weekEndUtc)||null,onClose:p[3]||(p[3]=X=>W.value=!1)},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),M(_a,{"is-visible":v.value,"week-number":((k=o.value)==null?void 0:k.weekNumber)||null,"week-start-utc":((w=o.value)==null?void 0:w.weekStartUtc)||null,"week-end-utc":((A=o.value)==null?void 0:A.weekEndUtc)||null,onClose:p[4]||(p[4]=X=>v.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"]),M(Ga,{"is-visible":_.value,"week-number":((F=o.value)==null?void 0:F.weekNumber)||null,"week-start-utc":((y=o.value)==null?void 0:y.weekStartUtc)||null,"week-end-utc":((G=o.value)==null?void 0:G.weekEndUtc)||null,onClose:p[5]||(p[5]=X=>_.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"])])}}},rl=oe(Qa,[["__scopeId","data-v-2a1bd13f"]]);export{rl as default};
