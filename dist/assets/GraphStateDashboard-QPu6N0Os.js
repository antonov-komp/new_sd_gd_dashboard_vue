import{_ as we,a as _,o as b,d as i,F as ue,f as pe,j as ae,n as ke,t as B,r as $,c as J,G as Oe,m as Te,g as Me,b as Z,k as re,l as Be,i as ie,B as Ge,H as Ht,I as At,u as xe,J as kt,p as Ue,K as et,x as Bt,L as xt,M as It,C as $t,N as Ye,D as Pt,O as Lt,P as Wt,y as je,Q as Ie,z as Ut,e as jt}from"./main-C9Hd2Rrq.js";import{L as wt,D as zt,B as Vt}from"./index-Bcpkjpjk.js";import{S as tt,h as at,K as Kt,d as St,B as ot,m as bt,j as ze,k as le,D as Dt,a as Gt,l as Et}from"./index-BLJceQby.js";const he={apiBaseUrl:"",snapshotsEndpoint:"/api/snapshots.php",defaultSectorId:"1C",snapshotVersion:"1.0",timeout:3e4};class ye{static getApiBaseUrl(){const t=window.location.pathname;return t.substring(0,t.lastIndexOf("/"))}static async createSnapshot(t,e,s={}){try{if(!t||typeof t!="object")throw new _e("sectorData Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð¼","VALIDATION_ERROR");if(!e||!["week_start","week_end","manual","current"].includes(e))throw new _e("type Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ð´Ð½Ð¸Ð¼ Ð¸Ð·: week_start, week_end, manual, current","VALIDATION_ERROR");const a=this.validateSectorData(t);if(!a.isValid)throw new _e(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐµÐºÑ‚Ð¾Ñ€Ð°: ${a.errors.join(", ")}`,"VALIDATION_ERROR",{validation:a});const n=this.normalizeSectorData(t),l={metadata:this.generateSnapshotMetadata(e,s.createdBy,s.sectorId||he.defaultSectorId),statistics:n.statistics,ticketIds:n.ticketIds,tickets:n.tickets},r=this.validateSnapshot(l);if(!r.isValid)throw new _e(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ ÑÐ»ÐµÐ¿ÐºÐ°: ${r.errors.join(", ")}`,"VALIDATION_ERROR",{validation:r});r.warnings.length>0&&console.warn("ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¸ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ ÑÐ»ÐµÐ¿ÐºÐ°:",r.warnings);const d=this.getApiBaseUrl(),p=await fetch(`${d}${he.snapshotsEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({action:"create",snapshot:l,type:e,date:this.formatDate(new Date)})});if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);const g=await p.json();if(!g.success)throw new Error(g.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°");return g.data.snapshot}catch(a){throw console.error("SnapshotService.createSnapshot error:",a),a instanceof _e?a:new _e(`ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°: ${a.message}`,"API_ERROR",{originalError:a})}}static async getSnapshot(t,e){try{const s=this.formatDate(t),n=`${this.getApiBaseUrl()}${he.snapshotsEndpoint}?action=get&date=${s}&type=${e}`,o=await fetch(n,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(o.status===404)return null;if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const l=await o.json();if(!l.success){if(l.message&&l.message.includes("Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"))return null;throw new Error(l.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°")}return l.data.snapshot}catch(s){throw console.error("SnapshotService.getSnapshot error:",s),s}}static async getAllSnapshots(t={}){try{const e=new URLSearchParams;e.append("action","list"),t.startDate&&e.append("startDate",this.formatDate(t.startDate)),t.endDate&&e.append("endDate",this.formatDate(t.endDate)),t.type&&e.append("type",t.type),t.sectorId?e.append("sectorId",t.sectorId):e.append("sectorId",he.defaultSectorId);const a=`${this.getApiBaseUrl()}${he.snapshotsEndpoint}?${e.toString()}`,n=await fetch(a,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=await n.json();if(!o.success)throw new Error(o.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ¿Ð¸ÑÐºÐ° ÑÐ»ÐµÐ¿ÐºÐ¾Ð²");return(await Promise.all(o.data.snapshots.map(async r=>{try{return await this.getSnapshot(r.date,r.type)}catch(d){return console.warn(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐ»ÐµÐ¿ÐºÐ° ${r.date}/${r.type}:`,d),null}}))).filter(r=>r!==null).sort((r,d)=>new Date(r.metadata.createdAt)-new Date(d.metadata.createdAt))}catch(e){throw console.error("SnapshotService.getAllSnapshots error:",e),e}}static normalizeSectorData(t){const{stages:e=[],employees:s=[],zeroPointTickets:a={}}=t,n={formed:{count:0,stageId:"DT140_12:UC_0VHWE2",stageName:"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ"},review:{count:0,stageId:"DT140_12:PREPARATION",stageName:"Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—"},execution:{count:0,stageId:"DT140_12:CLIENT",stageName:"Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ"}},o=[],l=[],r=[];e.forEach(g=>{const u=g.id;if(n[u]){let y=0;g.employees.forEach(w=>{const h=w.tickets||[];y+=h.length;let m=o.find(k=>k.id===w.id);m||(m={id:w.id,name:w.name,ticketsByStage:{formed:0,review:0,execution:0},totalTickets:0},o.push(m)),h.forEach(k=>{l.push(k.id),r.push({id:k.id,title:k.title||"Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ",assignedTo:{id:w.id,name:w.name},createdAt:k.createdAt||"",updatedAt:k.modifiedAt||k.updatedAt||""}),m.ticketsByStage[u]=(m.ticketsByStage[u]||0)+1,m.totalTickets+=1})}),n[u].count=y}});const d={unassigned:0,keeper:0,total:0};Object.values(a).forEach(g=>{Array.isArray(g)&&g.forEach(u=>{d.total+=1,u.assigneeId===1051||u.assignedById===1051?d.keeper+=1:d.unassigned+=1,l.push(u.id),r.push({id:u.id,title:u.title||"Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ",assignedTo:u.assignedTo||u.assignedById?{id:u.assignedById||u.assigneeId,name:"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹"}:null,createdAt:u.createdAt||"",updatedAt:u.modifiedAt||u.updatedAt||""})})});const p=Object.values(n).reduce((g,u)=>g+u.count,0)+d.total;return{statistics:{stages:{...n,total:p},employees:o,zeroPoint:d},ticketIds:[...new Set(l)],tickets:r}}static generateSnapshotMetadata(t,e,s){const a=new Date,n=-a.getTimezoneOffset(),o=Math.floor(n/60),l=n%60,r=`${o>=0?"+":""}${String(o).padStart(2,"0")}:${String(l).padStart(2,"0")}`,d=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}T${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}${r}`;return{version:he.snapshotVersion,createdAt:d,createdBy:e||{id:0,name:"Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð°"},type:t,sectorId:s,sectorName:s==="1C"?"Ð¡ÐµÐºÑ‚Ð¾Ñ€ 1Ð¡":`Ð¡ÐµÐºÑ‚Ð¾Ñ€ ${s}`}}static formatDate(t){if(t||(t=new Date),typeof t=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;t=new Date(t)}if(!(t instanceof Date)||isNaN(t.getTime()))throw new Error("ÐÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ Ð´Ð°Ñ‚Ð°");const e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${s}-${a}`}static buildFilePath(t,e){const s=typeof t=="string"?new Date(t):t,a=s.getFullYear(),n=this.getWeekNumber(s),o=this.formatDate(t);let l;if(e==="current"){const r=new Date,d=`${String(r.getHours()).padStart(2,"0")}-${String(r.getMinutes()).padStart(2,"0")}-${String(r.getSeconds()).padStart(2,"0")}`;l=`current-state-${o}-${d}.json`}else if(e==="manual"){const r=new Date,d=`${String(r.getHours()).padStart(2,"0")}-${String(r.getMinutes()).padStart(2,"0")}-${String(r.getSeconds()).padStart(2,"0")}`;l=`manual-${o}-${d}.json`}else l=`${e}-${o}.json`;return e==="current"?`current/${l}`:`${a}/week-${n}/${l}`}static getWeekNumber(t){const e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),s=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-s);const a=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-a)/864e5+1)/7)}static validateSnapshot(t){var a,n,o;const e=[],s=[];if(t.metadata?((!t.metadata.version||typeof t.metadata.version!="string")&&e.push("ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…"),(!t.metadata.createdAt||!this.isValidISODate(t.metadata.createdAt))&&e.push("ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ Ð´Ð°Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ"),["week_start","week_end","manual","current"].includes(t.metadata.type)||e.push("ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ‚Ð¸Ð¿ ÑÐ»ÐµÐ¿ÐºÐ°"),(!t.metadata.sectorId||typeof t.metadata.sectorId!="string")&&e.push("ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ ÑÐµÐºÑ‚Ð¾Ñ€Ð°"),(!t.metadata.createdBy||!t.metadata.createdBy.id||!t.metadata.createdBy.name)&&e.push("ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ ÑÐ¾Ð·Ð´Ð°Ñ‚ÐµÐ»Ðµ")):e.push("ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ»ÐµÐ¿ÐºÐ°"),!t.statistics)e.push("ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°");else{if(!t.statistics.stages)e.push("ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾ ÑÑ‚Ð°Ð¿Ð°Ð¼");else{const l=t.statistics.stages,r=(((a=l.formed)==null?void 0:a.count)||0)+(((n=l.review)==null?void 0:n.count)||0)+(((o=l.execution)==null?void 0:o.count)||0);l.total!==r&&s.push(`ÐÐµÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð¾Ð±Ñ‰ÐµÐ³Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚ÑÑ ${r}, ÑƒÐºÐ°Ð·Ð°Ð½Ð¾ ${l.total}`)}if(Array.isArray(t.statistics.employees)||e.push("Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð¼Ð°ÑÑÐ¸Ð²Ð¾Ð¼"),!t.statistics.zeroPoint)e.push("ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð½ÑƒÐ»ÐµÐ²Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸");else{const l=t.statistics.zeroPoint,r=(l.unassigned||0)+(l.keeper||0);l.total!==r&&s.push(`ÐÐµÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð½ÑƒÐ»ÐµÐ²Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸: Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚ÑÑ ${r}, ÑƒÐºÐ°Ð·Ð°Ð½Ð¾ ${l.total}`)}}if(Array.isArray(t.ticketIds)||e.push("ticketIds Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¼Ð°ÑÑÐ¸Ð²Ð¾Ð¼"),!Array.isArray(t.tickets))e.push("tickets Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¼Ð°ÑÑÐ¸Ð²Ð¾Ð¼");else{const l=new Set(t.ticketIds),r=new Set(t.tickets.map(d=>d.id));l.size!==r.size&&s.push("ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ID Ð² ticketIds Ð½Ðµ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°ÐµÑ‚ Ñ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾Ð¼ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²"),t.tickets.forEach((d,p)=>{d.id||e.push(`Ð¢Ð¸ÐºÐµÑ‚ #${p}: Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ ID`),d.title||e.push(`Ð¢Ð¸ÐºÐµÑ‚ #${p}: Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº`),(!d.assignedTo||!d.assignedTo.id)&&s.push(`Ð¢Ð¸ÐºÐµÑ‚ #${p}: Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ (Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð² Ð½ÑƒÐ»ÐµÐ²Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐµ)`),d.createdAt||e.push(`Ð¢Ð¸ÐºÐµÑ‚ #${p}: Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ð´Ð°Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ`),d.updatedAt||e.push(`Ð¢Ð¸ÐºÐµÑ‚ #${p}: Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ð´Ð°Ñ‚Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ`)})}return{isValid:e.length===0,errors:e,warnings:s}}static validateSectorData(t){const e=[],s=[];return!t||typeof t!="object"?(e.push("sectorData Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð¼"),{isValid:!1,errors:e,warnings:s}):(Array.isArray(t.stages)||e.push("stages Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¼Ð°ÑÑÐ¸Ð²Ð¾Ð¼"),Array.isArray(t.employees)||e.push("employees Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¼Ð°ÑÑÐ¸Ð²Ð¾Ð¼"),(!t.zeroPointTickets||typeof t.zeroPointTickets!="object")&&e.push("zeroPointTickets Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð¼"),{isValid:e.length===0,errors:e,warnings:s})}static isValidISODate(t){if(typeof t!="string")return!1;const e=new Date(t);return!isNaN(e.getTime())&&t.includes("T")}static async deleteSnapshot(t,e){try{const s=this.formatDate(t),n=`${this.getApiBaseUrl()}${he.snapshotsEndpoint}`,o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({action:"delete",date:s,type:e})});if(o.status===404)return!1;if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const l=await o.json();if(!l.success)throw new Error(l.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°");return!0}catch(s){throw console.error("SnapshotService.deleteSnapshot error:",s),s}}static async deleteSnapshotsByPeriod(t){try{const e=await this.getAllSnapshots(t);let s=0;for(const a of e)try{await this.deleteSnapshot(a.metadata.createdAt.split("T")[0],a.metadata.type)&&s++}catch(n){console.warn(`ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ° ${a.metadata.createdAt}:`,n)}return s}catch(e){throw console.error("SnapshotService.deleteSnapshotsByPeriod error:",e),e}}static getSnapshotVersion(t){var e;return((e=t==null?void 0:t.metadata)==null?void 0:e.version)||"unknown"}static async migrateSnapshot(t,e=he.snapshotVersion){const s=this.getSnapshotVersion(t);return s===e||s==="1.0"&&e==="1.0"?t:(console.warn(`ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð²ÐµÑ€ÑÐ¸Ð¸ ${s} Ð½Ð° ${e} Ð¿Ð¾ÐºÐ° Ð½Ðµ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð°`),{...t,metadata:{...t.metadata,version:e}})}static getWeekNumberInfo(t){const e=typeof t=="string"?new Date(t):t,s=this.getWeekNumber(e);return{year:e.getFullYear(),week:s}}static getWeekStartDate(t){const e=typeof t=="string"?new Date(t):t,a=(e.getDay()||7)-1,n=new Date(e);return n.setDate(e.getDate()-a),n.setHours(0,0,0,0),n}static getWeekEndDate(t){const e=typeof t=="string"?new Date(t):t,a=7-(e.getDay()||7),n=new Date(e);return n.setDate(e.getDate()+a),n.setHours(23,59,59,999),n}static async getSnapshotsForWeek(t){try{const e=this.getWeekStartDate(t),s=this.getWeekEndDate(t),a=this.getWeekNumberInfo(t),n=await this.getAllSnapshots({startDate:e,endDate:s}),o=n.find(d=>d.metadata.type==="week_start")||null,l=n.find(d=>d.metadata.type==="week_end")||null,r=n.filter(d=>d.metadata.type==="manual");return{weekStart:o,weekEnd:l,manual:r,weekInfo:a}}catch(e){throw console.error("SnapshotService.getSnapshotsForWeek error:",e),e}}static handleError(t){if(t instanceof _e)return{message:t.message,code:t.code,details:t.details};let e="UNKNOWN_ERROR";return t.message.includes("Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†")?e="VALIDATION_ERROR":t.message.includes("404")||t.message.includes("Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½")?e="NOT_FOUND":t.message.includes("HTTP")||t.message.includes("API")?e="API_ERROR":t.message.includes("Ð²ÐµÑ€ÑÐ¸Ñ")||t.message.includes("version")?e="VERSION_MISMATCH":(t.message.includes("Ð´Ð¾ÑÑ‚ÑƒÐ¿")||t.message.includes("permission"))&&(e="PERMISSION_DENIED"),{message:t.message||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°",code:e,details:{originalError:t}}}static async getSnapshotsStatistics(t={}){try{const e=await this.getAllSnapshots(t),s={week_start:0,week_end:0,manual:0,current:0},a=new Map;let n=null,o=null;e.forEach(r=>{const d=r.metadata.type;s.hasOwnProperty(d)&&s[d]++;const p=this.getWeekNumberInfo(r.metadata.createdAt),g=`${p.year}-W${p.week}`;a.set(g,(a.get(g)||0)+1);const u=new Date(r.metadata.createdAt);(!n||u<new Date(n.metadata.createdAt))&&(n=r),(!o||u>new Date(o.metadata.createdAt))&&(o=r)});const l=Array.from(a.entries()).map(([r,d])=>{const[p,g]=r.split("-W");return{year:parseInt(p),week:parseInt(g),count:d}}).sort((r,d)=>r.year!==d.year?r.year-d.year:r.week-d.week);return{total:e.length,byType:s,byWeek:l,oldest:n,newest:o}}catch(e){throw console.error("SnapshotService.getSnapshotsStatistics error:",e),e}}}class _e extends Error{constructor(t,e,s={}){super(t),this.name="SnapshotError",this.code=e,this.details=s}}const ve={formed:{bitrixId:at.formed,name:tt.FORMED.name},review:{bitrixId:at.review,name:tt.REVIEW.name},execution:{bitrixId:at.execution,name:tt.EXECUTION.name}},He=Kt;function Yt(c){if(!c||typeof c!="object")throw new Error("Invalid sector data: sectorData must be an object");if(!c.stages||!Array.isArray(c.stages))throw new Error("Invalid sector data: stages are required and must be an array");const t=qt(c.stages),e=Jt(c.stages),s=Xt(c.zeroPointTickets||{}),a=Zt(c.zeroPointTickets||{}),n=Qt(c.stages,c.zeroPointTickets||{});return{statistics:{stages:t,employees:e,zeroPoint:s,zeroPointByStage:a},ticketIds:n.ticketIds,tickets:n.tickets}}function qt(c){const t={formed:{count:0,stageId:ve.formed.bitrixId,stageName:ve.formed.name},review:{count:0,stageId:ve.review.bitrixId,stageName:ve.review.name},execution:{count:0,stageId:ve.execution.bitrixId,stageName:ve.execution.name},total:0};return c.forEach(e=>{if(!ve[e.id]){console.warn(`Unknown stage ID: ${e.id}`);return}let s=0;e.employees&&Array.isArray(e.employees)&&e.employees.forEach(a=>{a.tickets&&Array.isArray(a.tickets)&&(s+=a.tickets.length)}),t[e.id].count=s,t.total+=s}),t}function Jt(c){const t=new Map;return c.forEach(e=>{!e.employees||!Array.isArray(e.employees)||e.employees.forEach(s=>{if(!s||!s.id)return;t.has(s.id)||t.set(s.id,{id:s.id,name:s.name||`Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº #${s.id}`,ticketsByStage:{formed:0,review:0,execution:0},totalTickets:0});const a=t.get(s.id),n=s.tickets&&Array.isArray(s.tickets)?s.tickets.length:0;ve[e.id]&&(a.ticketsByStage[e.id]=(a.ticketsByStage[e.id]||0)+n),a.totalTickets+=n})}),Array.from(t.values())}function Xt(c){let t=0,e=0;return!c||typeof c!="object"?{unassigned:0,keeper:0,total:0}:(Object.values(c).forEach(s=>{Array.isArray(s)&&s.forEach(a=>{if(!a)return;const n=a.assignedTo||a.assignedById;!n||n===null?t++:(typeof n=="object"?n.id:n)===He?e++:t++})}),{unassigned:t,keeper:e,total:t+e})}function Zt(c){const t={formed:{keeper:0,unassigned:0,total:0},review:{keeper:0,unassigned:0,total:0},execution:{keeper:0,unassigned:0,total:0}};return!c||typeof c!="object"||Object.keys(t).forEach(e=>{const s=c[e];Array.isArray(s)&&s.forEach(a=>{if(!a)return;const n=a.assignedTo||a.assignedById;!n||n===null?t[e].unassigned++:(typeof n=="object"?n.id:n)===He?t[e].keeper++:t[e].unassigned++,t[e].total++})}),t}function Qt(c,t){const e=new Set,s=new Map;return Array.isArray(c)&&c.forEach(a=>{!a.employees||!Array.isArray(a.employees)||a.employees.forEach(n=>{!n.tickets||!Array.isArray(n.tickets)||n.tickets.forEach(o=>{if(!o||!o.id){console.warn("Ticket without ID found:",o);return}const l=parseInt(o.id);if(isNaN(l)){console.warn("Invalid ticket ID:",o.id);return}e.add(l);let r=o.assignedTo;!r&&n.id&&(r={id:n.id,name:n.name||`Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº #${n.id}`}),s.set(l,{id:l,title:o.title||"Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ",assignedTo:r||null,createdAt:We(o.createdAt||o.createdTime),updatedAt:We(o.updatedAt||o.modifiedAt||o.updatedTime)})})})}),t&&typeof t=="object"&&Object.values(t).forEach(a=>{Array.isArray(a)&&a.forEach(n=>{if(!n||!n.id){console.warn("Ticket without ID found in zero point:",n);return}const o=parseInt(n.id);if(isNaN(o)){console.warn("Invalid ticket ID in zero point:",n.id);return}e.add(o);let l=n.assignedTo;if(!l&&n.assignedById){const r=typeof n.assignedById=="object"?n.assignedById.id||n.assignedById.value:n.assignedById;r&&r!==He?l={id:r,name:"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹"}:r===He&&(l={id:He,name:"Ð¥Ñ€Ð°Ð½Ð¸Ñ‚ÐµÐ»ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð²"})}s.set(o,{id:o,title:n.title||"Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ",assignedTo:l||null,createdAt:We(n.createdAt||n.createdTime),updatedAt:We(n.updatedAt||n.modifiedAt||n.updatedTime)})})}),{ticketIds:Array.from(e).sort((a,n)=>a-n),tickets:Array.from(s.values())}}function We(c){if(!c)return null;if(c instanceof Date)return c.toISOString();if(typeof c=="string"){if(c.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/))return c;const t=new Date(c);if(!isNaN(t.getTime()))return t.toISOString()}return console.warn("Invalid date format:",c),null}class lt{static async getSectorDataForSnapshot(t={}){const{useCache:e=!0,onProgress:s=null,normalize:a=!0,includeTicketDetails:n=!1}=t;try{const o=await St.getSectorData(e,s);return a?Yt(o):(n&&console.warn("includeTicketDetails Ð¿Ð¾ÐºÐ° Ð½Ðµ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾"),o)}catch(o){throw console.error("SectorDataAdapter.getSectorDataForSnapshot error:",o),o}}static async isDataAvailable(){try{const t=await St.getSectorData(!0);return t!=null}catch{return!1}}}class st{static compareTwoSnapshots(t,e,s={}){const{includeTickets:a=!1,includeEmployees:n=!0}=s,o=this.validateSnapshot(t),l=this.validateSnapshot(e);if(!o.valid||!l.valid)throw new Error("Invalid snapshot structure: "+[...o.errors,...l.errors].join(", "));const r=this.buildComparisonMetadata(t,e),d=this.compareStages(t.statistics.stages,e.statistics.stages),p=n?this.compareEmployees(t.statistics.employees||[],e.statistics.employees||[]):[],g=this.compareZeroPoint(t.statistics.zeroPoint||{},e.statistics.zeroPoint||{}),u=a?this.compareTickets(t.ticketIds||[],e.ticketIds||[],t.tickets||[],e.tickets||[]):null,y=this.buildSummary(d,p,g,u);return{metadata:r,stages:d,employees:p,zeroPoint:g,tickets:u,summary:y}}static calculateDelta(t,e){const s=this.normalizeValue(t),a=this.normalizeValue(e),n=a-s;let o=0;s!==0?o=n/s*100:a!==0&&(o=a>0?1/0:-1/0);const l=this.getTrend(n);return{value1:s,value2:a,delta:n,deltaPercent:Math.round(o*100)/100,trend:l}}static normalizeValue(t){return t==null||isNaN(t)?0:Number(t)}static getTrend(t){return t>0?"increase":t<0?"decrease":"stable"}static compareStages(t,e){var l,r;const s=["formed","review","execution"],a={};for(const d of s){const p=((l=t[d])==null?void 0:l.count)||0,g=((r=e[d])==null?void 0:r.count)||0;a[d]=this.calculateDelta(p,g)}const n=t.total||0,o=e.total||0;return a.total=this.calculateDelta(n,o),a}static compareEmployees(t,e){var l,r;const s=new Map(t.map(d=>[d.id,d])),a=new Map(e.map(d=>[d.id,d])),n=new Set([...s.keys(),...a.keys()]),o=[];for(const d of n){const p=s.get(d)||null,g=a.get(d)||null;if(!p||!g){o.push({id:d,name:(p==null?void 0:p.name)||(g==null?void 0:g.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹",snapshot1:p?{ticketsByStage:p.ticketsByStage||{},totalTickets:p.totalTickets||0}:null,snapshot2:g?{ticketsByStage:g.ticketsByStage||{},totalTickets:g.totalTickets||0}:null,delta:this.calculateEmployeeDelta(p,g),trend:p?"removed":"new"});continue}const u={},y=["formed","review","execution"];for(const h of y){const m=((l=p.ticketsByStage)==null?void 0:l[h])||0,k=((r=g.ticketsByStage)==null?void 0:r[h])||0;u[h]=this.calculateDelta(m,k)}const w=this.calculateDelta(p.totalTickets||0,g.totalTickets||0);o.push({id:d,name:p.name,snapshot1:{ticketsByStage:p.ticketsByStage||{},totalTickets:p.totalTickets||0},snapshot2:{ticketsByStage:g.ticketsByStage||{},totalTickets:g.totalTickets||0},delta:{ticketsByStage:u,totalTickets:w},trend:w.trend})}return o}static calculateEmployeeDelta(t,e){var o,l;if(!t&&!e)return{ticketsByStage:{},totalTickets:{delta:0,trend:"stable"}};const s={},a=["formed","review","execution"];for(const r of a){const d=((o=t==null?void 0:t.ticketsByStage)==null?void 0:o[r])||0,p=((l=e==null?void 0:e.ticketsByStage)==null?void 0:l[r])||0;s[r]=this.calculateDelta(d,p)}const n=this.calculateDelta((t==null?void 0:t.totalTickets)||0,(e==null?void 0:e.totalTickets)||0);return{ticketsByStage:s,totalTickets:n}}static compareZeroPoint(t,e){return{unassigned:this.calculateDelta((t==null?void 0:t.unassigned)||0,(e==null?void 0:e.unassigned)||0),keeper:this.calculateDelta((t==null?void 0:t.keeper)||0,(e==null?void 0:e.keeper)||0),total:this.calculateDelta((t==null?void 0:t.total)||0,(e==null?void 0:e.total)||0)}}static compareTickets(t,e,s,a){var y,w;const n=new Set(t),o=new Set(e),l=e.filter(h=>!n.has(h)),r=t.filter(h=>!o.has(h)),d=[],p=[],g=new Map(s.map(h=>[h.id,h])),u=new Map(a.map(h=>[h.id,h]));for(const h of t){if(!o.has(h))continue;const m=g.get(h),k=u.get(h);if(!m||!k)continue;const A=(((y=m.assignedTo)==null?void 0:y.id)||null)!==(((w=k.assignedTo)==null?void 0:w.id)||null),z=(m.stageId||null)!==(k.stageId||null);A||z?d.push(h):p.push(h)}return{new:l,removed:r,changed:d,unchanged:p}}static buildComparisonMetadata(t,e){const s=new Date(t.metadata.createdAt),a=new Date(e.metadata.createdAt),n=new Date,o=a.getTime()-s.getTime(),l=Math.floor(o/(1e3*60*60*24)),r=Math.floor(o%(1e3*60*60*24)/(1e3*60*60)),d=Math.floor(o%(1e3*60*60)/(1e3*60));return{snapshot1Date:t.metadata.createdAt,snapshot2Date:e.metadata.createdAt,comparisonDate:n.toISOString(),timeDiff:{days:l,hours:r,minutes:d,totalMinutes:Math.floor(o/(1e3*60))}}}static buildSummary(t,e,s,a){var d,p,g;const n=t.total.delta,o=Object.keys(t).filter(u=>u==="total"?!1:t[u].delta!==0).length,l=e.filter(u=>u.trend==="new"||u.trend==="removed"?!0:u.delta.totalTickets.delta!==0).length,r=n!==0||o>0||l>0;return{totalDelta:n,stagesChanged:o,employeesChanged:l,hasChanges:r,newTicketsCount:((d=a==null?void 0:a.new)==null?void 0:d.length)||0,removedTicketsCount:((p=a==null?void 0:a.removed)==null?void 0:p.length)||0,changedTicketsCount:((g=a==null?void 0:a.changed)==null?void 0:g.length)||0}}static validateSnapshot(t){const e=[],s=[];if(!t)return e.push("Snapshot is null or undefined"),{valid:!1,errors:e,warnings:s};if(t.metadata?(t.metadata.createdAt||e.push("Missing metadata.createdAt"),t.metadata.type||e.push("Missing metadata.type")):e.push("Missing metadata field"),!t.statistics)e.push("Missing statistics field");else{if(!t.statistics.stages)e.push("Missing statistics.stages");else{const a=["formed","review","execution"];for(const n of a)t.statistics.stages[n]||s.push(`Missing stage: ${n}`)}t.statistics.employees||s.push("Missing statistics.employees (may be empty array)"),t.statistics.zeroPoint||s.push("Missing statistics.zeroPoint")}return{valid:e.length===0,errors:e,warnings:s}}static compareMultipleSnapshots(t,e={}){if(!Array.isArray(t)||t.length<2)throw new Error("At least 2 snapshots required for comparison");for(const o of t){const l=this.validateSnapshot(o);if(!l.valid)throw new Error("Invalid snapshot: "+l.errors.join(", "))}const s=[...t].sort((o,l)=>{const r=new Date(o.metadata.createdAt),d=new Date(l.metadata.createdAt);return r-d}),a=[];for(let o=0;o<s.length-1;o++)a.push({from:o,to:o+1,result:this.compareTwoSnapshots(s[o],s[o+1],e)});const n=this.buildTrends(s);return{snapshots:s.map((o,l)=>({index:l,date:o.metadata.createdAt,type:o.metadata.type,data:o})),comparisons:a,trends:n}}static buildTrends(t){var s,a,n,o,l,r,d,p,g,u;const e={stages:{formed:[],review:[],execution:[],total:[]},zeroPoint:{unassigned:[],keeper:[],total:[]}};for(const y of t){const w=y.statistics;e.stages.formed.push(((a=(s=w.stages)==null?void 0:s.formed)==null?void 0:a.count)||0),e.stages.review.push(((o=(n=w.stages)==null?void 0:n.review)==null?void 0:o.count)||0),e.stages.execution.push(((r=(l=w.stages)==null?void 0:l.execution)==null?void 0:r.count)||0),e.stages.total.push(((d=w.stages)==null?void 0:d.total)||0),e.zeroPoint.unassigned.push(((p=w.zeroPoint)==null?void 0:p.unassigned)||0),e.zeroPoint.keeper.push(((g=w.zeroPoint)==null?void 0:g.keeper)||0),e.zeroPoint.total.push(((u=w.zeroPoint)==null?void 0:u.total)||0)}return e}}const ea={class:"stages-container"},ta={class:"stages-chips"},aa=["checked","disabled","onChange"],sa={class:"stage-chip-label"},na={__name:"StageChips",props:{stages:{type:Array,required:!0,validator:c=>c.every(t=>t.id&&t.name&&t.color)},selected:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},emits:["update:selected","change"],setup(c,{emit:t}){const e=c,s=t;function a(n,o){const l={...e.selected};l[n]=o,s("update:selected",l),s("change",n,o)}return(n,o)=>(b(),_("div",ea,[o[0]||(o[0]=i("h4",{class:"stages-title"},"Ð­Ñ‚Ð°Ð¿Ñ‹ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ:",-1)),i("div",ta,[(b(!0),_(ue,null,pe(c.stages,l=>(b(),_("label",{key:l.id,class:ae(["stage-chip",{"stage-chip--active":c.selected[l.id],"stage-chip--disabled":c.disabled}])},[i("input",{type:"checkbox",checked:c.selected[l.id],disabled:c.disabled,onChange:r=>a(l.id,r.target.checked)},null,40,aa),i("span",{class:"stage-chip-color",style:ke({backgroundColor:l.color})},null,4),i("span",sa,B(l.name),1)],2))),128))])]))}},oa=we(na,[["__scopeId","data-v-fe03c03c"]]),nt=140,$e=new Map;class Mt{static async getTicketDetails(t){if(!t)return console.warn("Ticket ID is required"),null;try{const e=await ot.call("crm.item.list",{entityTypeId:nt,filter:{id:t},select:["*"],useOriginalUfNames:"Y"});let s=[];if(e&&e.result&&(Array.isArray(e.result)?s=e.result:e.result.items&&Array.isArray(e.result.items)?s=e.result.items:e.result.data&&Array.isArray(e.result.data)&&(s=e.result.data)),!s||s.length===0)return console.warn(`[TicketDetailsService] Ticket with ID ${t} not found`),null;const a=s[0];console.log("[TicketDetailsService] Bitrix24 ticket response:",{id:a.id,hasUF_CRM_7_DEPARTMENT_HEAD:!!a.UF_CRM_7_DEPARTMENT_HEAD,UF_CRM_7_DEPARTMENT_HEAD:a.UF_CRM_7_DEPARTMENT_HEAD,allKeys:Object.keys(a),ticketSample:JSON.stringify(a).substring(0,500)});const n=bt(a),o=a.UF_CRM_7_DEPARTMENT_HEAD||a.uf_crm_7_department_head||a.ufCrm7DepartmentHead||a.UF_CRM_7_DEPARTMENT_HEAD||a.uf_crm_7_department_head||a.ufCrm7DepartmentHead||null;console.log("[TicketDetailsService] Extracted departmentHead:",{ufDepartmentHead:o,mappedDepartmentHead:n.departmentHead,departmentHeadFull:o?String(o).trim():null});let l=null;if(o){const r=String(o).trim();r.length>0&&(l=r)}return{...n,departmentHeadFull:l}}catch(e){return console.error(`[TicketDetailsService] Error loading ticket details for ID ${t}:`,e),console.error("[TicketDetailsService] Error details:",{message:e.message,stack:e.stack,ticketId:t}),null}}static async getTicketsDetails(t){if(!t||!Array.isArray(t)||t.length===0)return[];const e=[],s=[];if(t.forEach(a=>{$e.has(a)?e.push($e.get(a)):s.push(a)}),s.length===0)return e;try{console.log("[TicketDetailsService] Loading tickets via API:",{ticketIdsCount:s.length,ticketIdsSample:s.slice(0,5),entityTypeId:nt});const a=await ot.call("crm.item.list",{entityTypeId:nt,filter:{id:s},select:["*"],useOriginalUfNames:"Y"});console.log("[TicketDetailsService] API response received:",{hasResult:!!a,resultType:typeof a,resultKeys:a?Object.keys(a):[],hasResultResult:!!(a!=null&&a.result),resultResultType:typeof(a==null?void 0:a.result),isArray:Array.isArray(a==null?void 0:a.result),resultResultLength:Array.isArray(a==null?void 0:a.result)?a.result.length:"not array",fullResult:a});let n=[];if(a&&a.result&&(Array.isArray(a.result)?n=a.result:a.result.items&&Array.isArray(a.result.items)?n=a.result.items:a.result.data&&Array.isArray(a.result.data)&&(n=a.result.data)),!n||n.length===0)return console.warn("[TicketDetailsService] No tickets in API response:",{hasResult:!!a,hasResultResult:!!(a!=null&&a.result),resultType:typeof(a==null?void 0:a.result),result:a,resultKeys:a?Object.keys(a):[]}),e;const o=n.map((l,r)=>{r===0&&console.log("[TicketDetailsService] Batch response sample (first ticket):",{id:l.id,hasUF_CRM_7_DEPARTMENT_HEAD:!!l.UF_CRM_7_DEPARTMENT_HEAD,UF_CRM_7_DEPARTMENT_HEAD:l.UF_CRM_7_DEPARTMENT_HEAD,allKeys:Object.keys(l).filter(y=>y.toLowerCase().includes("department")||y.toLowerCase().includes("uf_crm")),sampleTicketKeys:Object.keys(l).slice(0,20)});const d=bt(l);r===0&&console.log("[TicketDetailsService] After mapTicket:",{ticketId:d.id,hasDepartmentHead:!!d.departmentHead,departmentHead:d.departmentHead,mappedTicketKeys:Object.keys(d).filter(y=>y.toLowerCase().includes("department"))});const p=l.UF_CRM_7_DEPARTMENT_HEAD||l.uf_crm_7_department_head||l.ufCrm7DepartmentHead||l.UF_CRM_7_DEPARTMENT_HEAD||l.uf_crm_7_department_head||l.ufCrm7DepartmentHead||null;r===0&&console.log("[TicketDetailsService] Extracting departmentHead from bitrixTicket:",{ufDepartmentHead:p,hasUF_CRM_7_DEPARTMENT_HEAD:!!l.UF_CRM_7_DEPARTMENT_HEAD,bitrixTicketKeys:Object.keys(l).filter(y=>y.toLowerCase().includes("department")||y.toLowerCase().includes("uf_crm"))});let g=null;if(p){const y=String(p).trim();y.length>0&&(g=y)}!g&&d.departmentHead&&(g=d.departmentHead);const u={...d,departmentHeadFull:g||d.departmentHead||null};return r===0&&console.log("[TicketDetailsService] Final ticket details:",{ticketId:u.id,departmentHead:u.departmentHead,departmentHeadFull:u.departmentHeadFull}),u.id&&$e.set(u.id,u),u});return[...e,...o]}catch(a){return console.error("[TicketDetailsService] Error loading tickets details batch:",a),console.error("[TicketDetailsService] Error details:",{message:a.message,stack:a.stack,ticketIdsCount:t.length,ticketIdsSample:t.slice(0,5)}),e}}static clearCache(t=1e3){$e.size>t&&$e.clear()}static getCacheSize(){return $e.size}}async function la(c,t,e,s=null){var d;if(console.log("[popupNavigationUtils] getEmployeeTicketsForStage called:",{employeeId:c,stageId:t,hasSnapshot:!!e,snapshotType:e?typeof e:"null",snapshotKeys:e?Object.keys(e):[],hasTickets:!!(e!=null&&e.tickets),ticketsIsArray:Array.isArray(e==null?void 0:e.tickets),ticketsLength:((d=e==null?void 0:e.tickets)==null?void 0:d.length)||0}),!c||!t)return console.warn("[popupNavigationUtils] Employee ID and stage ID are required"),[];if(!e)return console.warn("[popupNavigationUtils] Snapshot is null or undefined"),[];if(!e.tickets)return console.warn("[popupNavigationUtils] Snapshot.tickets is missing. Snapshot keys:",Object.keys(e)),[];if(!Array.isArray(e.tickets))return console.warn("[popupNavigationUtils] Snapshot.tickets is not an array. Type:",typeof e.tickets),[];const a=e.tickets.filter(p=>{const g=p.assignedTo;return g?(typeof g=="object"?g.id:g)===c:!1});if(a.length===0)return[];const n=!a[0].stageId||!a[0].departmentHead;let o=null;if(n){const p=a.map(g=>g.id);if(s&&typeof s=="object")o=s;else try{const g=await Mt.getTicketsDetails(p);o=new Map,g.forEach(u=>{u&&u.id&&o.set(u.id,u)})}catch(g){console.warn("[popupNavigationUtils] Failed to load ticket details from API, using snapshot data:",g),o=null}}return a.map(p=>{const g=p.id,u={id:g,title:p.title||"Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ",assignedTo:p.assignedTo,createdAt:p.createdAt,updatedAt:p.updatedAt};if(o){const y=o instanceof Map?o.get(g):o[g];y?(u.stageId=y.stageId||null,u.departmentHead=y.departmentHead||null,u.departmentHeadFull=y.departmentHeadFull||y.departmentHead||null):(u.stageId=null,u.departmentHead=null)}else u.stageId=p.stageId||null,u.departmentHead=p.departmentHead||null,u.departmentHeadFull=p.departmentHeadFull||p.departmentHead||null;return u}).filter(p=>p.stageId?ze(p.stageId)===t:!0)}function _t(c,t=new Date){if(!c||c.length===0)return[];const e=c.length,s={};return Object.values(le).forEach(n=>{s[n]={category:n,label:Dt[n].label,count:0,tickets:[],percentage:0,progressBarWidth:0,progressBarColor:Dt[n].color}}),c.forEach(n=>{if(!n.createdAt){s[le.MORE_THAN_YEAR].count++,s[le.MORE_THAN_YEAR].tickets.push(n);return}const o=Gt(n.createdAt,t);s[o]&&(s[o].count++,s[o].tickets.push(n))}),Object.values(s).filter(n=>n.count>0).map(n=>{const o=e>0?parseFloat((n.count/e*100).toFixed(1)):0;return{...n,percentage:o,progressBarWidth:o}}).sort((n,o)=>{const l=[le.TODAY,le.YESTERDAY,le.THIS_WEEK,le.LAST_WEEK,le.MORE_THAN_TWO_WEEKS,le.UP_TO_ONE_MONTH,le.MORE_THAN_TWO_MONTHS,le.MORE_THAN_HALF_YEAR,le.MORE_THAN_YEAR];return l.indexOf(n.category)-l.indexOf(o.category)})}function Tt(c){if(!c||c.length===0)return[];const t={};c.forEach(s=>{let a=s.departmentHeadFull||s.departmentHead;c.indexOf(s)<3&&console.log("[popupNavigationUtils] groupTicketsByDepartment - ticket sample:",{ticketId:s.id,departmentHead:s.departmentHead,departmentHeadFull:s.departmentHeadFull,allKeys:Object.keys(s).filter(n=>n.toLowerCase().includes("department"))}),a?(a=String(a).trim(),a.length===0&&(a="Ð‘ÐµÐ· Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°")):a="Ð‘ÐµÐ· Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°",t[a]||(t[a]={departmentName:a,count:0}),t[a].count++});const e=Object.values(t);return e.sort((s,a)=>a.count!==s.count?a.count-s.count:s.departmentName.localeCompare(a.departmentName,"ru")),e}const ra={class:"modal-content"},ia={key:"level-1",class:"level-1"},ca={class:"modal-header"},da={class:"modal-total"},ua={class:"view-switcher"},pa={class:"modal-body"},ga={key:0},fa={key:0,class:"no-employees"},ma={key:1,class:"employees-list"},ha=["onClick"],va={class:"employee-name"},ya={class:"employee-progress"},ka={class:"employee-count"},wa={key:0,class:"employee-item employee-others"},Sa={class:"employee-name"},ba={class:"employee-progress"},Da={class:"employee-count"},Ea={key:1,class:"view-time"},_a={key:0,class:"no-data"},Ta={key:1,class:"date-categories-list"},Ca=["onClick"],Aa={class:"category-label"},Ia={class:"category-progress"},$a={class:"category-count"},Ma={key:2,class:"view-departments"},Na={key:0,class:"no-data"},Ra={key:1,class:"departments-table-container"},Fa={class:"departments-table"},Oa={class:"col-department"},Ha={class:"department-name"},Ba={class:"col-count"},xa={class:"count-value"},Pa={key:"level-2",class:"level-2"},La={class:"modal-header"},Wa={class:"modal-total"},Ua={class:"modal-body"},ja={class:"stage-info"},za={class:"stage-badge"},Va={key:0,class:"no-data"},Ka={key:1,class:"date-categories-list"},Ga=["onClick"],Ya={class:"category-label"},qa={class:"category-progress"},Ja={class:"category-count"},Xa={key:"level-3",class:"level-3"},Za={class:"modal-header"},Qa={class:"header-info"},es={class:"header-badges"},ts={class:"date-badge"},as={class:"stage-badge"},ss={class:"modal-total"},ns={class:"modal-body"},os={key:0,class:"no-data"},ls={key:1,class:"departments-table-container"},rs={class:"departments-table"},is={class:"col-department"},cs={class:"department-name"},ds={class:"col-count"},us={class:"count-value"},ps={__name:"EmployeeDetailsModal",props:{isVisible:{type:Boolean,default:!1},stageName:{type:String,required:!0},stageId:{type:String,default:""},totalCount:{type:Number,required:!0},employees:{type:Array,default:()=>[]},others:{type:Object,default:null},snapshot:{type:Object,default:null},ticketDetails:{type:Object,default:null}},emits:["close"],setup(c,{emit:t}){const e=c,s=t,a=xe(),n=$(1),o=$("employees"),l=$(null),r=$([]),d=$([]),p=$(null),g=$(null);J(()=>n.value>1),J(()=>{var T,N,S,M;switch(n.value){case 1:return((T=l.value)==null?void 0:T.stageName)||e.stageName;case 2:return((N=p.value)==null?void 0:N.employeeName)||"";case 3:return`${((S=p.value)==null?void 0:S.employeeName)||""} â€” ${((M=g.value)==null?void 0:M.dateCategoryLabel)||""}`;default:return""}});function u(){var T,N,S;console.log("[EmployeeDetailsModal] Initializing level 1 with props:",{stageName:e.stageName,stageId:e.stageId,totalCount:e.totalCount,employeesCount:((T=e.employees)==null?void 0:T.length)||0,hasSnapshot:!!e.snapshot,snapshotTicketIds:((S=(N=e.snapshot)==null?void 0:N.ticketIds)==null?void 0:S.length)||0,hasTicketDetails:!!e.ticketDetails,snapshotKeys:e.snapshot?Object.keys(e.snapshot):[]}),l.value={stageName:e.stageName,stageId:e.stageId,totalCount:e.totalCount,employees:e.employees||[],others:e.others||null,snapshot:e.snapshot||null,ticketDetails:e.ticketDetails||null},console.log("[EmployeeDetailsModal] Level 1 data initialized:",{stageId:l.value.stageId,hasSnapshot:!!l.value.snapshot,employeesCount:l.value.employees.length,snapshotType:l.value.snapshot?typeof l.value.snapshot:"null"}),p.value=null,g.value=null,n.value=1,o.value="employees",y(),console.log("[EmployeeDetailsModal] Popup level set to 1, ready for clicks")}async function y(){if(!l.value||!l.value.snapshot||!l.value.stageId){console.warn("[EmployeeDetailsModal] Cannot load level 1 view data - missing required data");return}try{const T=l.value.snapshot.tickets||[],N=l.value.stageId;console.log("[EmployeeDetailsModal] Loading level 1 view data:",{totalSnapshotTickets:T.length,currentStageId:N,sampleTicket:T[0]?{id:T[0].id,stageId:T[0].stageId,hasDepartmentHead:!!T[0].departmentHead,departmentHead:T[0].departmentHead,hasDepartmentHeadFull:!!T[0].departmentHeadFull,departmentHeadFull:T[0].departmentHeadFull,allKeys:Object.keys(T[0])}:null});let S=T.filter(P=>P.stageId?ze(P.stageId)===N:!0);console.log("[EmployeeDetailsModal] Filtered tickets by stage:",{beforeFilter:T.length,afterFilter:S.length,stageId:N,ticketsWithStageId:S.filter(P=>P.stageId).length,ticketsWithoutStageId:S.filter(P=>!P.stageId).length});const M=S.filter(P=>!P.departmentHead&&!P.departmentHeadFull);if(M.length>0){console.log("[EmployeeDetailsModal] DepartmentHead missing for some tickets, loading via API...",{ticketsNeedingDetails:M.length,totalTickets:S.length,ticketsWithDepartment:S.filter(G=>G.departmentHead||G.departmentHeadFull).length});const P=M.map(G=>G.id).filter(G=>G);try{console.log("[EmployeeDetailsModal] Loading details for tickets:",{ticketIdsCount:P.length,ticketIdsSample:P.slice(0,10)});const G=await Mt.getTicketsDetails(P),ne=new Map;G.forEach(I=>{I&&I.id&&ne.set(I.id,I)}),console.log("[EmployeeDetailsModal] Details loaded from API:",{detailsCount:G.length,detailsMapSize:ne.size,sampleDetail:G[0]?{id:G[0].id,departmentHead:G[0].departmentHead,departmentHeadFull:G[0].departmentHeadFull}:null}),S=S.map(I=>{const se=ne.get(I.id);return se?{...I,stageId:se.stageId||I.stageId||null,departmentHead:se.departmentHead||I.departmentHead||null,departmentHeadFull:se.departmentHeadFull||se.departmentHead||I.departmentHead||null}:I}),S=S.filter(I=>I.stageId?ze(I.stageId)===N:!0),console.log("[EmployeeDetailsModal] Ticket details merged (before stage filter):",{totalTickets:S.length,ticketsWithDepartment:S.filter(I=>I.departmentHead||I.departmentHeadFull).length,ticketsWithoutDepartment:S.filter(I=>!I.departmentHead&&!I.departmentHeadFull).length,ticketsWithStageId:S.filter(I=>I.stageId).length,ticketsWithoutStageId:S.filter(I=>!I.stageId).length});const ge=S.length;S=S.filter(I=>I.stageId?ze(I.stageId)===N:!0),console.log("[EmployeeDetailsModal] Ticket details merged (after stage filter):",{beforeStageFilter:ge,afterStageFilter:S.length,filteredOut:ge-S.length,currentStageId:N,ticketsWithDepartment:S.filter(I=>I.departmentHead||I.departmentHeadFull).length,ticketsWithoutDepartment:S.filter(I=>!I.departmentHead&&!I.departmentHeadFull).length,sampleWithDepartment:S.find(I=>I.departmentHead||I.departmentHeadFull)?{id:S.find(I=>I.departmentHead||I.departmentHeadFull).id,departmentHead:S.find(I=>I.departmentHead||I.departmentHeadFull).departmentHead,departmentHeadFull:S.find(I=>I.departmentHead||I.departmentHeadFull).departmentHeadFull}:null})}catch(G){console.warn("[EmployeeDetailsModal] Failed to load ticket details via API, using snapshot data:",G),console.error("[EmployeeDetailsModal] Error details:",{message:G.message,stack:G.stack})}}else console.log("[EmployeeDetailsModal] All tickets have departmentHead, skipping API load");console.log("[EmployeeDetailsModal] Final tickets for grouping (only current stage):",{totalTickets:S.length,currentStageId:N,ticketsWithStageId:S.filter(P=>P.stageId).length,ticketsWithoutStageId:S.filter(P=>!P.stageId).length,ticketsWithDepartment:S.filter(P=>P.departmentHead||P.departmentHeadFull).length,ticketsWithoutDepartment:S.filter(P=>!P.departmentHead&&!P.departmentHeadFull).length});const H=_t(S);r.value=H;const V=Tt(S);d.value=V;const X=H.reduce((P,G)=>P+G.count,0),te=V.reduce((P,G)=>P+G.count,0);console.log("[EmployeeDetailsModal] Level 1 view data loaded (only current stage):",{currentStageId:N,totalTicketsForGrouping:S.length,timeCategoriesCount:H.length,totalTicketsInTimeCategories:X,departmentsCount:V.length,totalTicketsInDepartments:te,departmentsSample:V.slice(0,5),ticketsWithDepartment:S.filter(P=>P.departmentHead||P.departmentHeadFull).length,ticketsWithoutDepartment:S.filter(P=>!P.departmentHead&&!P.departmentHeadFull).length,consistencyCheck:{totalTickets:S.length,timeCategoriesTotal:X,departmentsTotal:te,isConsistent:S.length===X&&S.length===te}})}catch(T){console.error("[EmployeeDetailsModal] Error loading level 1 view data:",T),console.error("[EmployeeDetailsModal] Error stack:",T.stack)}}function w(T){if(!T||T.count===0){a.info(`Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${(T==null?void 0:T.label)||"Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ"}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`);return}a.info(`Ð”ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${T.label}" Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ð² ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¹ Ð²ÐµÑ€ÑÐ¸Ð¸`)}Oe(()=>e.isVisible,T=>{T?u():A()}),Te(()=>{e.isVisible&&u()});async function h(T,N=null){var S,M,H;if(console.log("[EmployeeDetailsModal] ====== handleEmployeeClick START ======"),console.log("[EmployeeDetailsModal] Employee clicked:",T),console.log("[EmployeeDetailsModal] Current popup level:",n.value),N&&N.currentTarget&&(N.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{N.currentTarget&&(N.currentTarget.style.transform="")},150)),!T||!T.id){console.warn("[EmployeeDetailsModal] Invalid employee data:",T);return}if(l.value||(console.log("[EmployeeDetailsModal] Level 1 data not found, initializing from props"),l.value={stageName:e.stageName,stageId:e.stageId,totalCount:e.totalCount,employees:e.employees||[],others:e.others||null,snapshot:e.snapshot||null,ticketDetails:e.ticketDetails||null}),console.log("[EmployeeDetailsModal] Level 1 data:",{stageId:l.value.stageId,stageName:l.value.stageName,hasSnapshot:!!l.value.snapshot,snapshotType:l.value.snapshot?typeof l.value.snapshot:"null",snapshotKeys:l.value.snapshot?Object.keys(l.value.snapshot):[]}),!l.value.stageId){console.error("[EmployeeDetailsModal] ERROR: ID ÑÑ‚Ð°Ð´Ð¸Ð¸ Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½"),a.warning("ID ÑÑ‚Ð°Ð´Ð¸Ð¸ Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½");return}if(!l.value.snapshot){console.error("[EmployeeDetailsModal] ERROR: Ð¡Ð»ÐµÐ¿Ð¾Ðº Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½"),console.error("[EmployeeDetailsModal] Props snapshot:",e.snapshot),a.warning("Ð¡Ð»ÐµÐ¿Ð¾Ðº Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½");return}try{console.log("[EmployeeDetailsModal] Loading tickets for employee:",T.id,"stage:",l.value.stageId);const V=await la(T.id,l.value.stageId,l.value.snapshot,l.value.ticketDetails);if(console.log("[EmployeeDetailsModal] Loaded tickets:",(V==null?void 0:V.length)||0,V),!V||V.length===0){console.warn("[EmployeeDetailsModal] No tickets found for employee"),a.info(`Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° "${T.name}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð½Ð° ÑÑ‚Ð°Ð´Ð¸Ð¸ "${l.value.stageName}"`);return}const X=_t(V);console.log("[EmployeeDetailsModal] Date categories:",(X==null?void 0:X.length)||0,X),p.value={employeeId:T.id,employeeName:T.name,stageId:l.value.stageId,stageName:l.value.stageName,totalCount:V.length,dateCategories:X,snapshot:l.value.snapshot,ticketDetails:l.value.ticketDetails},console.log("[EmployeeDetailsModal] Level 2 data set:",{employeeName:p.value.employeeName,totalCount:p.value.totalCount,dateCategoriesCount:p.value.dateCategories.length}),console.log("[EmployeeDetailsModal] Transitioning to level 2"),console.log("[EmployeeDetailsModal] Level 2 data before set:",p.value),n.value=2,console.log("[EmployeeDetailsModal] Popup level set to:",n.value),console.log("[EmployeeDetailsModal] Level 2 data after set:",p.value),console.log("[EmployeeDetailsModal] Level 2 data check:",{hasLevel2Data:!!p.value,employeeName:(S=p.value)==null?void 0:S.employeeName,dateCategoriesCount:((H=(M=p.value)==null?void 0:M.dateCategories)==null?void 0:H.length)||0}),setTimeout(()=>{console.log("[EmployeeDetailsModal] After timeout - popupLevel:",n.value),console.log("[EmployeeDetailsModal] After timeout - level2Data:",p.value)},100),console.log("[EmployeeDetailsModal] ====== handleEmployeeClick END ======")}catch(V){console.error("[EmployeeDetailsModal] ERROR loading employee tickets:",V),console.error("[EmployeeDetailsModal] Error stack:",V.stack),a.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ Ñ‚Ð¸ÐºÐµÑ‚Ð°Ñ…: "+V.message)}}function m(T){if(!T||T.count===0){a.info(`Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${(T==null?void 0:T.label)||"Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ"}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`);return}if(!T.tickets||T.tickets.length===0){a.info(`Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${T.label}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`);return}if(!p.value){console.error("Level 2 data not found");return}const N=Tt(T.tickets);g.value={employeeId:p.value.employeeId,employeeName:p.value.employeeName,stageId:p.value.stageId,stageName:p.value.stageName,dateCategory:T.category,dateCategoryLabel:T.label,totalCount:T.count,departments:N,snapshot:p.value.snapshot,ticketDetails:p.value.ticketDetails},n.value=3}function k(){n.value===3?(n.value=2,g.value=null):n.value===2&&(n.value=1,p.value=null,g.value=null)}function A(){n.value=1,l.value=null,p.value=null,g.value=null}function z(){A(),s("close")}return(T,N)=>(b(),Me(At,{to:"body"},[c.isVisible?(b(),_("div",{key:0,class:"employee-details-modal",onClick:ie(z,["self"]),onKeydown:Ht(z,["esc"])},[i("div",ra,[re(Ge,{name:"level",mode:"out-in"},{default:Be(()=>{var S,M,H,V,X,te,P,G,ne,ge,I,se,Ce;return[n.value===1?(b(),_("div",ia,[i("div",ca,[i("h3",null,B(((S=l.value)==null?void 0:S.stageName)||c.stageName),1),i("span",da,"Ð’ÑÐµÐ³Ð¾: "+B(((M=l.value)==null?void 0:M.totalCount)||c.totalCount)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1),i("button",{class:"modal-close",onClick:z,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"},"Ã—")]),i("div",ua,[i("button",{class:ae(["view-switch-btn",{active:o.value==="employees"}]),onClick:N[0]||(N[0]=W=>o.value="employees"),title:"ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼"}," ðŸ‘¥ ÐŸÐ¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼ ",2),i("button",{class:ae(["view-switch-btn",{active:o.value==="time"}]),onClick:N[1]||(N[1]=W=>o.value="time"),title:"ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼ Ð³Ñ€Ð°Ð´Ð°Ñ†Ð¸ÑÐ¼"}," ðŸ“… ÐŸÐ¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ ",2),i("button",{class:ae(["view-switch-btn",{active:o.value==="departments"}]),onClick:N[2]||(N[2]=W=>o.value="departments"),title:"ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°Ð¼"}," ðŸ¢ ÐŸÐ¾ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°Ð¼ ",2)]),i("div",pa,[o.value==="employees"?(b(),_("div",ga,[(((H=l.value)==null?void 0:H.employees)||c.employees).length===0&&(!((V=l.value)!=null&&V.others||c.others)||(((X=l.value)==null?void 0:X.others)||c.others).count===0)?(b(),_("div",fa," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ñ… ")):(b(),_("div",ma,[(b(!0),_(ue,null,pe(((te=l.value)==null?void 0:te.employees)||c.employees,W=>(b(),_("div",{key:W.id,class:ae(["employee-item",{"employee-keeper":W.isKeeper}]),onClick:ie(oe=>h(W,oe),["stop"]),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼ Ð³Ñ€Ð°Ð´Ð°Ñ†Ð¸ÑÐ¼"},[i("span",va,B(W.name),1),i("div",ya,[i("div",{class:"progress-bar",style:ke({width:W.progressBarWidth+"%",backgroundColor:W.progressBarColor})},null,4)]),i("span",ka,B(W.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ("+B(W.percentage)+"%) ",1),N[3]||(N[3]=i("span",{class:"employee-arrow"},"â†’",-1))],10,ha))),128)),((P=l.value)!=null&&P.others||c.others)&&(((G=l.value)==null?void 0:G.others)||c.others).count>0?(b(),_("div",wa,[i("span",Sa,"Ð”Ñ€ÑƒÐ³Ð¸Ðµ ("+B((((ne=l.value)==null?void 0:ne.others)||c.others).employeeCount)+")",1),i("div",ba,[i("div",{class:"progress-bar",style:ke({width:(((ge=l.value)==null?void 0:ge.others)||c.others).progressBarWidth+"%",backgroundColor:(((I=l.value)==null?void 0:I.others)||c.others).progressBarColor})},null,4)]),i("span",Da,B((((se=l.value)==null?void 0:se.others)||c.others).count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ("+B((((Ce=l.value)==null?void 0:Ce.others)||c.others).percentage)+"%) ",1)])):Z("",!0)]))])):o.value==="time"?(b(),_("div",Ea,[r.value.length===0?(b(),_("div",_a," Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…... ")):(b(),_("div",Ta,[(b(!0),_(ue,null,pe(r.value,W=>(b(),_("div",{key:W.category,class:"category-item",onClick:ie(oe=>w(W),["stop"])},[i("span",Aa,B(W.label),1),i("div",Ia,[i("div",{class:"progress-bar",style:ke({width:W.progressBarWidth+"%",backgroundColor:W.progressBarColor})},null,4)]),i("span",$a,B(W.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ("+B(W.percentage)+"%) ",1),N[4]||(N[4]=i("span",{class:"category-arrow"},"â†’",-1))],8,Ca))),128))]))])):o.value==="departments"?(b(),_("div",Ma,[d.value.length===0?(b(),_("div",Na," Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…... ")):(b(),_("div",Ra,[i("table",Fa,[N[5]||(N[5]=i("thead",null,[i("tr",null,[i("th",{class:"col-department"},"Ð—Ð°ÐºÐ°Ð·Ñ‡Ð¸Ðº"),i("th",{class:"col-count"},"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²")])],-1)),i("tbody",null,[(b(!0),_(ue,null,pe(d.value,(W,oe)=>(b(),_("tr",{key:oe,class:"department-row"},[i("td",Oa,[i("span",Ha,B(W.departmentName),1)]),i("td",Ba,[i("span",xa,B(W.count),1)])]))),128))])])]))])):Z("",!0)])])):n.value===2&&p.value?(b(),_("div",Pa,[i("div",La,[i("button",{class:"btn-back",onClick:k,"aria-label":"ÐÐ°Ð·Ð°Ð´"}," â† "),i("h3",null,B(p.value.employeeName),1),i("span",Wa,"Ð’ÑÐµÐ³Ð¾: "+B(p.value.totalCount)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1),i("button",{class:"modal-close",onClick:z,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"},"Ã—")]),i("div",Ua,[i("div",ja,[i("span",za,B(p.value.stageName),1)]),p.value.dateCategories.length===0?(b(),_("div",Va," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ Ñ‚Ð¸ÐºÐµÑ‚Ð°Ñ… ")):(b(),_("div",Ka,[(b(!0),_(ue,null,pe(p.value.dateCategories,W=>(b(),_("div",{key:W.category,class:"category-item",onClick:ie(oe=>m(W),["stop"])},[i("span",Ya,B(W.label),1),i("div",qa,[i("div",{class:"progress-bar",style:ke({width:W.progressBarWidth+"%",backgroundColor:W.progressBarColor})},null,4)]),i("span",Ja,B(W.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ("+B(W.percentage)+"%) ",1)],8,Ga))),128))]))])])):n.value===3&&g.value?(b(),_("div",Xa,[i("div",Za,[i("button",{class:"btn-back",onClick:k,"aria-label":"ÐÐ°Ð·Ð°Ð´"}," â† "),i("div",Qa,[i("h3",null,B(g.value.employeeName),1),i("div",es,[i("span",ts,B(g.value.dateCategoryLabel),1),i("span",as,B(g.value.stageName),1)])]),i("span",ss,"Ð’ÑÐµÐ³Ð¾: "+B(g.value.totalCount)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1),i("button",{class:"modal-close",onClick:z,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"},"Ã—")]),i("div",ns,[g.value.departments.length===0?(b(),_("div",os," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°Ñ… ")):(b(),_("div",ls,[i("table",rs,[N[6]||(N[6]=i("thead",null,[i("tr",null,[i("th",{class:"col-department"},"Ð—Ð°ÐºÐ°Ð·Ñ‡Ð¸Ðº"),i("th",{class:"col-count"},"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²")])],-1)),i("tbody",null,[(b(!0),_(ue,null,pe(g.value.departments,(W,oe)=>(b(),_("tr",{key:oe,class:"department-row"},[i("td",is,[i("span",cs,B(W.departmentName),1)]),i("td",ds,[i("span",us,B(W.count),1)])]))),128))])])]))])])):Z("",!0)]}),_:1})])],32)):Z("",!0)]))}},gs=we(ps,[["__scopeId","data-v-6bad41c7"]]),Ne=10;function Ve(c,t){if(!t||!t.statistics)return[];const e=[];t.statistics.employees&&Array.isArray(t.statistics.employees)&&t.statistics.employees.filter(a=>a.ticketsByStage&&a.ticketsByStage[c]>0).forEach(a=>{e.push({id:a.id,name:a.name,count:a.ticketsByStage[c]||0})});const s=fs(c,t);return s>0&&e.push({id:1051,name:"Ð¥Ñ€Ð°Ð½Ð¸Ñ‚ÐµÐ»ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð² (ÐÐµÑ€Ð°Ð·Ð¾Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ)",count:s,isKeeper:!0}),e.sort((a,n)=>n.count-a.count)}function fs(c,t){if(!t||!t.statistics)return 0;if(t.statistics.zeroPointByStage&&t.statistics.zeroPointByStage[c])return t.statistics.zeroPointByStage[c].keeper||0;if(t.statistics.zeroPoint){const e=t.statistics.zeroPoint.keeper||0;return Math.floor(e/3)}return 0}function Nt(c,t){var e;return!t||!t.statistics||!t.statistics.stages?0:((e=t.statistics.stages[c])==null?void 0:e.count)||0}function Ke(c,t=Ne){if(!c||c.length===0)return{visible:[],others:{employees:[],count:0,employeeCount:0}};const e=[...c].sort((o,l)=>l.count-o.count),s=e.slice(0,t),a=e.slice(t),n=a.reduce((o,l)=>o+l.count,0);return{visible:s,others:{employees:a,count:n,employeeCount:a.length}}}function Rt(c,t){return!c||c.length===0?[]:t===0?c.map(e=>({...e,percentage:0})):c.map(e=>({...e,percentage:parseFloat((e.count/t*100).toFixed(1))}))}function Ft(c,t,e="#007bff",s=Ne){if(!c||c.length===0)return{employees:[],others:null};const{visible:a,others:n}=Ke(c,s),o=Rt(a,t).map(r=>({...r,progressBarWidth:r.percentage,progressBarColor:r.isKeeper?"#f59e0b":e}));let l=null;if(n.count>0){const r=parseFloat((n.count/t*100).toFixed(1));l={...n,percentage:r,progressBarWidth:r,progressBarColor:"#6c757d"}}return{employees:o,others:l}}function ms(c,t){const e={weekStart:[],weekEnd:[],current:[],others:{weekStart:{count:0,employeeCount:0},weekEnd:{count:0,employeeCount:0},current:{count:0,employeeCount:0}}};return["weekStart","weekEnd","current"].forEach(a=>{const n=t[a];if(!n)return;const o=Ve(c,n),l=Nt(c,n);if(o.length===0)return;const{visible:r,others:d}=Ke(o,Ne),p=Rt(r,l);e[a]=p,d.count>0&&(e.others[a]={count:d.count,employeeCount:d.employeeCount,percentage:parseFloat((d.count/l*100).toFixed(1))})}),e}function hs(c,t="current",e=[]){const s=c[t];if(!s)return{labels:[],datasets:[]};const a=new Map;e.forEach(g=>{Ve(g.id,s).forEach(y=>{a.has(y.id)||a.set(y.id,{id:y.id,name:y.name,isKeeper:y.isKeeper||!1,ticketsByStage:{}}),a.get(y.id).ticketsByStage[g.id]=y.count})});const n=Array.from(a.values()).map(g=>{const u=Object.values(g.ticketsByStage).reduce((y,w)=>y+w,0);return{...g,totalTickets:u}});n.sort((g,u)=>u.totalTickets-g.totalTickets);const{visible:o,others:l}=Ke(n,Ne),r=e.map(()=>""),d={};e.forEach(g=>{const u=Ve(g.id,s),{visible:y}=Ke(u,Ne);d[g.id]=y.map(w=>({id:w.id,name:w.name,count:w.count}))});const p=o.map((g,u)=>{const y=e.map(h=>g.ticketsByStage[h.id]||0),w=e.map(h=>{if((g.ticketsByStage[h.id]||0)===0)return"transparent";const A=h.color.replace("#",""),z=parseInt(A.substring(0,2),16),T=parseInt(A.substring(2,4),16),N=parseInt(A.substring(4,6),16),S=.6+u*.05;return`rgba(${z}, ${T}, ${N}, ${Math.min(S,.95)})`});return{label:g.name,data:y,backgroundColor:w,borderColor:e.map(h=>{const m=h.color.replace("#",""),k=parseInt(m.substring(0,2),16),A=parseInt(m.substring(2,4),16),z=parseInt(m.substring(4,6),16);return`rgba(${k}, ${A}, ${z}, 0.8)`}),borderWidth:1,meta:{employeeId:g.id,employeeName:g.name}}});if(l.count>0){const g=e.map(u=>l.employees.reduce((y,w)=>y+(w.ticketsByStage[u.id]||0),0));p.push({label:`Ð”Ñ€ÑƒÐ³Ð¸Ðµ (${l.employeeCount})`,data:g,backgroundColor:"rgba(108, 117, 125, 0.5)",borderColor:"#6c757d",borderWidth:1})}return{labels:r,datasets:p,meta:{employeesByStage:d}}}function vs(c,t,e=[]){if(!t)return{stageName:"",totalCount:0,employees:[],others:null};const s=e.find(d=>d.id===c),a=s?s.name:"",n=s?s.color:"#007bff",o=Ve(c,t),l=Nt(c,t);if(o.length===0)return{stageName:a,totalCount:0,employees:[],others:null};const r=Ft(o,l,n,Ne);return{stageName:a,totalCount:l,employees:r.employees,others:r.others}}function ys(c,t,e=.5){if(!t||!Array.isArray(t)||t.length===0||typeof c!="number"||c<0)return 0;(typeof e!="number"||e<=0)&&(console.warn("getOverlapCount: threshold Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼ Ñ‡Ð¸ÑÐ»Ð¾Ð¼, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ 0.5"),e=.5);const s=[];if(t.forEach((o,l)=>{if(!o||!o.data||!Array.isArray(o.data))return;const r=o.data[c];r!=null&&!isNaN(r)&&s.push({datasetIndex:l,value:Number(r),y:Number(r)})}),s.length<2)return 0;const a=[];return s.forEach(o=>{let l=!1;for(const r of a){const d=r.y;if(Math.abs(o.y-d)<e){r.points.push(o),r.y=r.points.reduce((g,u)=>g+u.y,0)/r.points.length,l=!0;break}}l||a.push({points:[o],y:o.y})}),a.length===0?0:a.reduce((o,l)=>l.points.length>o.points.length?l:o,a[0]).points.length}function ks(c,t){const e=[];return c.forEach(s=>{let a=!1;for(const n of e){const o=n.y;if(Math.abs(s.value-o)<t){n.points.push(s),n.y=n.points.reduce((l,r)=>l+r.value,0)/n.points.length,a=!0;break}}a||e.push({points:[s],y:s.value})}),e}function ws(c,t=.5){var n,o;if(!c)return console.warn("findOverlappingPoints: chart Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½"),[];if(!c.config||c.config.type!=="line")return[];const e=(n=c.data)==null?void 0:n.datasets,s=((o=c.data)==null?void 0:o.labels)||[];if(!e||!Array.isArray(e)||e.length===0)return[];if(!Array.isArray(s)||s.length===0)return[];(typeof t!="number"||t<=0)&&(console.warn("findOverlappingPoints: threshold Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼ Ñ‡Ð¸ÑÐ»Ð¾Ð¼, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ 0.5"),t=.5);const a=[];return s.forEach((l,r)=>{try{if(ys(r,e,t)<2)return;const p=[];if(e.forEach((h,m)=>{if(!h||!h.data||!Array.isArray(h.data))return;const k=h.data[r];k==null||isNaN(k)||p.push({datasetIndex:m,value:Number(k),label:h.label||`Dataset ${m}`})}),p.length<2)return;const g=ks(p,t);if(g.length===0)return;const u=g.reduce((h,m)=>m.points.length>h.points.length?m:h,g[0]);if(u.points.length<2)return;let y=null,w=null;for(let h=0;h<e.length;h++)try{const m=c.getDatasetMeta(h);if(m&&m.data&&m.data[r]){y=m,w=m.data[r];break}}catch{continue}if(!w||typeof w.x!="number"||typeof w.y!="number")return;a.push({position:r,count:u.points.length,x:w.x,y:w.y,value:u.y,points:u.points.map(h=>({datasetIndex:h.datasetIndex,value:h.value,label:h.label}))})}catch(d){console.warn(`findOverlappingPoints: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ ${r}:`,d)}}),a}const Ss=.5,Ct=6,bs=2;function Ds(c){return typeof c!="number"||c<2?Ct:Ct+(c-1)*bs}function Es(c,t){if(!c||!c.ctx){console.warn("drawEnlargedPoint: chart Ð¸Ð»Ð¸ ctx Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½");return}if(!t||typeof t.x!="number"||typeof t.y!="number"){console.warn("drawEnlargedPoint: Ð½ÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ñ‹Ðµ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹ overlap",t);return}const e=t.count;if(typeof e!="number"||e<2)return;const s=c.ctx,{x:a,y:n,points:o}=t,l=Ds(e);if(s.canvas){s.save();try{s.beginPath(),s.arc(a,n,l,0,2*Math.PI);let d="rgba(128, 128, 128, 0.3)";if(o&&o.length>0&&c.data&&c.data.datasets){const p=o[0].datasetIndex,g=c.data.datasets[p];if(g&&g.pointBackgroundColor){const u=Array.isArray(g.pointBackgroundColor)?g.pointBackgroundColor[t.position]||g.pointBackgroundColor[0]:g.pointBackgroundColor;if(u)if(u.startsWith("#")){const y=parseInt(u.slice(1,3),16),w=parseInt(u.slice(3,5),16),h=parseInt(u.slice(5,7),16);d=`rgba(${y}, ${w}, ${h}, 0.4)`}else u.startsWith("rgba")?d=u.replace(/rgba?\(([^)]+)\)/,(y,w)=>{const h=w.split(",").map(m=>m.trim());return`rgba(${h[0]}, ${h[1]}, ${h[2]}, 0.4)`}):d=u+"66"}}s.fillStyle=d,s.fill(),s.strokeStyle=d.replace("0.4","0.6").replace("66","99"),s.lineWidth=1,s.stroke()}catch(d){console.warn("drawEnlargedPoint: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐµ ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð½Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸:",d)}finally{s.restore()}}}const _s={id:"overlappingPointsPlugin",afterDatasetsDraw:c=>{if(!(!c||!c.config||c.config.type!=="line")&&c.ctx)try{const t=ws(c,Ss);if(!Array.isArray(t)||t.length===0)return;t.filter(s=>!(!s||typeof s!="object"||typeof s.count!="number"||s.count<2||typeof s.x!="number"||typeof s.y!="number"||!isFinite(s.x)||!isFinite(s.y))).forEach(s=>{try{Es(c,s)}catch(a){console.warn(`overlappingPointsPlugin: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐµ ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð½Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð´Ð»Ñ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ ${s.position}:`,a)}})}catch(t){console.warn("overlappingPointsPlugin: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð² afterDatasetsDraw:",t)}}},Ts={class:"graph-state-chart"},Cs={class:"chart-header"},As={class:"chart-type-selector"},Is=["onClick","title"],$s={class:"chart-type-icon"},Ms={class:"chart-type-label"},Ns={key:0,class:"comparison-type-selector"},Rs={class:"radio-group"},Fs={key:0},Os={key:1},Hs={key:2,class:"graph-legend"},Bs={key:4,class:"error-container"},xs={class:"error-message"},Ps={key:5,class:"chart-container"},Ls={class:"chart-wrapper"},Ws={class:"chart-canvas-container"},Us={key:0,class:"bar-chart-stage-labels"},js={key:6,class:"no-data"},zs={__name:"GraphStateChart",props:{period:{type:Object,default:null},showCurrentState:{type:Boolean,default:!0}},emits:["data-loaded","error"],setup(c,{emit:t}){const e=(D,f)=>typeof window>"u"?f:getComputedStyle(document.documentElement).getPropertyValue(D).trim()||f,s=c,a=t,n=$(!1),o=$(null),l=$(null),r=$({weekStart:null,weekEnd:null,current:null}),d=$(null),p=$("weekStartToWeekEnd"),g=[{value:"line",label:"Ð›Ð¸Ð½ÐµÐ¹Ð½Ñ‹Ð¹",icon:"ðŸ“ˆ"},{value:"bar",label:"Ð¡Ñ‚Ð¾Ð»Ð±Ñ‡Ð°Ñ‚Ñ‹Ð¹",icon:"ðŸ“Š"},{value:"doughnut",label:"ÐšÑ€ÑƒÐ³Ð¾Ð²Ð°Ñ",icon:"ðŸ©"}],u=$("line"),y=$(!1),w=$(""),h=$(""),m=$(0),k=$([]),A=$(null),z=$(null),T=$(null),N=$([]),S=J(()=>{switch(u.value){case"line":return wt;case"bar":return Vt;case"doughnut":return zt;default:return wt}}),M={formed:e("--b24-primary","#007bff"),review:e("--b24-warning","#ffc107"),execution:e("--b24-success","#28a745")},H=[{id:"formed",name:"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ",color:M.formed},{id:"review",name:"Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—",color:M.review},{id:"execution",name:"Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ",color:M.execution}],V=["circle","triangle","rect","rectRot","star","cross","crossRot"],X=$({formed:!0,review:!0,execution:!0}),te=xe(),P={id:"employeeLabelsPlugin",afterDatasetsDraw:D=>{if(D.config.type==="bar")try{const f=D.ctx;if(!D.data||!D.data.datasets)return;const v=D.data.datasets,E=D.scales.y;v.forEach((C,F)=>{const R=D.getDatasetMeta(F);if(!R||R.hidden)return;const j=C.label||"";if(!j||j.includes("Ð”Ñ€ÑƒÐ³Ð¸Ðµ"))return;const U=j.trim().split(/\s+/);let x="";if(U.length===1)x=U[0];else{const L=U[0],q=U.slice(1).join(" ");x=`${L}
${q}`}const Y=x.split(`
`);C.data.forEach((L,q)=>{if(L===0||!L)return;const Q=R.data[q];if(!Q||typeof Q.x!="number"||typeof Q.y!="number")return;const de=Q.x,be=Q.y+Q.height+25;f.save(),f.font="bold 9px Arial, sans-serif",f.fillStyle="#6b7280",f.textAlign="center",f.textBaseline="top",f.translate(de,be),f.rotate(-12*Math.PI/180),Y.forEach((me,De)=>{const Ee=me.trim();Ee&&f.fillText(Ee,0,De*11)}),f.restore()})})}catch(f){console.error("Error in employeeLabelsPlugin:",f)}}};kt.register(P);function G(){const D=new Map;[r.value.weekStart,r.value.weekEnd,r.value.current].forEach(f=>{!f||!f.statistics||!f.statistics.employees||f.statistics.employees.forEach(v=>{D.has(v.id)||D.set(v.id,{id:v.id,name:v.name})})}),N.value=Array.from(D.values()).sort((f,v)=>f.name.localeCompare(v.name))}function ne(D,f="background"){var E;return((E={increase:{background:e("--b24-success","#28a745"),border:e("--b24-success-hover","#218838"),point:e("--b24-success","#28a745")},decrease:{background:e("--b24-danger","#dc3545"),border:e("--b24-danger-hover","#c82333"),point:e("--b24-danger","#dc3545")},stable:{background:e("--b24-text-muted","#9ca3af"),border:e("--b24-text-secondary","#6b7280"),point:e("--b24-text-muted","#9ca3af")}}[D])==null?void 0:E[f])||e("--b24-text-secondary","#6c757d")}function ge(){if(!(!r.value.weekStart||!r.value.weekEnd))try{const D=st.compareTwoSnapshots(r.value.weekStart,r.value.weekEnd,{includeTickets:!1,includeEmployees:!0});let f=null,v=null;r.value.current&&(f=st.compareTwoSnapshots(r.value.weekEnd,r.value.current,{includeTickets:!1,includeEmployees:!0}),v=st.compareTwoSnapshots(r.value.weekStart,r.value.current,{includeTickets:!1,includeEmployees:!0})),d.value={weekStartToWeekEnd:D,weekEndToCurrent:f,weekStartToCurrent:v}}catch(D){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ¾Ð²:",D),te.warning("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ÑÐ»ÐµÐ¿ÐºÐ¾Ð²: "+D.message)}}function I(D){return{"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ":"formed","Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—":"review",Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ:"execution"}[D]||"formed"}function se(D){return I(D)}function Ce(D){return D===0?"weekStart":D===1?"weekEnd":D===2?"current":"weekEnd"}function W(D){return r.value[D]||null}function oe(D,f,v,E,C=null,F=null,R=null){var j;console.log("[GraphStateChart] openEmployeeDetailsModal called:",{stageName:D,stageId:f,totalCount:v,employeesCount:(E==null?void 0:E.length)||0,hasSnapshot:!!F,snapshotTicketIds:((j=F==null?void 0:F.ticketIds)==null?void 0:j.length)||0}),w.value=D,h.value=f||"",m.value=v,k.value=E||[],A.value=C&&C.count>0?C:null,z.value=F,T.value=R,y.value=!0,console.log("[GraphStateChart] Modal state set:",{modalStageId:h.value,hasCurrentSnapshot:!!z.value})}function Pe(D,f,v){var j,U,x,Y,L,q;console.log("[GraphStateChart] openEmployeeDetailsModalForLine:",{stageId:D,timePoint:f,employeeDataCount:v==null?void 0:v.length});const E=H.find(Q=>Q.id===D);if(!E){console.warn("[GraphStateChart] Stage not found:",D);return}const C=W(f);if(console.log("[GraphStateChart] Snapshot for timePoint:",f,C?"found":"not found"),!C){console.warn("[GraphStateChart] Snapshot not found for timePoint:",f),console.warn("[GraphStateChart] Available snapshots:",{weekStart:!!r.value.weekStart,weekEnd:!!r.value.weekEnd,current:!!r.value.current});return}if(console.log("[GraphStateChart] Snapshot structure:",{hasTickets:!!C.tickets,ticketsIsArray:Array.isArray(C.tickets),ticketsLength:((j=C.tickets)==null?void 0:j.length)||0,hasTicketIds:!!C.ticketIds,ticketIdsLength:((U=C.ticketIds)==null?void 0:U.length)||0,hasMetadata:!!C.metadata,hasStatistics:!!C.statistics,snapshotKeys:Object.keys(C),snapshotType:typeof C}),!C.tickets||!Array.isArray(C.tickets)){console.error("[GraphStateChart] ERROR: Snapshot does not have tickets array!"),console.error("[GraphStateChart] Snapshot:",C),te.warning("Ð¡Ð»ÐµÐ¿Ð¾Ðº Ð½Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ Ñ‚Ð¸ÐºÐµÑ‚Ð°Ñ…");return}const F=((L=(Y=(x=C.statistics)==null?void 0:x.stages)==null?void 0:Y[D])==null?void 0:L.count)||0;console.log("[GraphStateChart] Total count for stage:",F);const R=Ft(v,F,E.color,10);console.log("[GraphStateChart] Opening modal with:",{stageName:E.name,stageId:D,totalCount:F,employeesCount:((q=R.employees)==null?void 0:q.length)||0,hasSnapshot:!!C,snapshotHasTickets:!!C.tickets}),oe(E.name,D,F,R.employees,R.others,C,null)}function qe(D,f){if(!f||!f.employees||f.employees.length===0){te.warning("ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ñ… Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ ÑÑ‚Ð°Ð¿Ð°");return}const v=r.value.current||r.value.weekEnd||r.value.weekStart;oe(f.stageName,D,f.totalCount,f.employees,f.others,v,null)}function O(){y.value=!1,w.value="",h.value="",m.value=0,k.value=[],A.value=null,z.value=null,T.value=null}function K(D,f,v){var Y,L;if(u.value!=="line"||f.length===0)return;const E=f[0],C=E.datasetIndex,F=E.index,R=v.data.datasets[C];if(!R||!R.meta)return;const j=se(R.label),U=Ce(F),x=(L=(Y=R.meta)==null?void 0:Y.employees)==null?void 0:L[U];!x||x.length===0||Pe(j,U,x)}function fe(D,f,v){var Y,L;if(u.value!=="doughnut"||f.length===0)return;const C=f[0].index,F=v.data,R=F.labels[C],j=se(R),U=(L=(Y=F.datasets[0])==null?void 0:Y.meta)==null?void 0:L.employees,x=U==null?void 0:U[j];if(!x){console.warn("Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ñ… Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ Ð´Ð»Ñ ÑÑ‚Ð°Ð¿Ð°:",j);return}qe(j,x)}function Le(D){var E;const f=H[D];if(!f)return 0;const v=r.value.current||r.value.weekEnd||r.value.weekStart;return!v||!v.statistics||!v.statistics.stages?0:((E=v.statistics.stages[f.id])==null?void 0:E.count)||0}function ce(D){var C;const f=H.find(F=>F.id===D);if(!f)return"";const v=r.value.current||r.value.weekEnd||r.value.weekStart;if(!v||!v.statistics||!v.statistics.stages)return f.name;const E=((C=v.statistics.stages[D])==null?void 0:C.count)||0;return`${f.name} (${E})`}const Re=J(()=>{if(!l.value)return null;if(u.value==="doughnut"||u.value==="bar")return l.value;const D=l.value.datasets.filter(f=>{const v=H.find(E=>E.name===f.label);return v?X.value[v.id]:!0});return{...l.value,datasets:D}});J(()=>u.value!=="bar"||!l.value||!l.value.meta?null:l.value.meta.employeesByStage||null);const Je=J(()=>{const D={responsive:!0,maintainAspectRatio:!1,resizeDelay:0,layout:{padding:u.value==="bar"?{bottom:80}:{}},onClick:(f,v,E)=>{u.value==="line"?K(f,v,E):u.value==="doughnut"&&fe(f,v,E)},onHover:(f,v,E)=>{u.value==="doughnut"&&(f.native.target.style.cursor=v.length>0?"pointer":"default")},plugins:{legend:{display:u.value!=="bar",position:u.value==="doughnut"?"right":"top",onClick:(f,v,E)=>{if(u.value==="bar"){const F=v.datasetIndex;if(F!==void 0){const R=E.chart.getDatasetMeta(F);R.hidden=!R.hidden,E.chart.update()}return}const C=v.datasetIndex;if(C!==void 0){const F=E.chart.getDatasetMeta(C);F.hidden=!F.hidden,E.chart.update()}}},tooltip:{enabled:!0,mode:"index",intersect:!1,callbacks:{title:f=>{if(u.value==="bar"){const v=f[0].dataIndex,E=H[v];return E?E.name:""}return f[0].label||""},label:f=>{var F,R,j,U,x,Y;const v=f.dataset.label||"",E=f.parsed.y||f.parsed||0,C=f.dataIndex;if(u.value==="bar"){const L=f.dataset,q=f.dataIndex,Q=H[q],de=Q?Q.name:"";return`${L.label}: ${E} Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð½Ð° ÑÑ‚Ð°Ð¿Ðµ "${de}"`}if(u.value==="doughnut"){const L=f.dataset.data.reduce((Q,de)=>Q+de,0),q=L>0?(E/L*100).toFixed(1):0;return`${v}: ${E} Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² (${q}%)`}else{if(!d.value||C===0)return`${v}: ${E} Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`;let L=null;const q=I(v);if(p.value==="weekStartToWeekEnd"&&C===1?L=(R=(F=d.value.weekStartToWeekEnd)==null?void 0:F.stages)==null?void 0:R[q]:p.value==="weekEndToCurrent"&&C===2&&r.value.current?L=(U=(j=d.value.weekEndToCurrent)==null?void 0:j.stages)==null?void 0:U[q]:p.value==="weekStartToCurrent"&&C===2&&r.value.current&&(L=(Y=(x=d.value.weekStartToCurrent)==null?void 0:x.stages)==null?void 0:Y[q]),!L)return`${v}: ${E} Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`;const Q=L.delta,de=L.deltaPercent,be=L.trend;let me=`${v}: ${E} Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`;if(Q!==0){const De=Q>0?"+":"",Ee=be==="increase"?"â†‘":be==="decrease"?"â†“":"â†’";me+=` (${De}${Q}, ${De}${de.toFixed(1)}%) ${Ee}`}else me+=" (Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹)";return me}},afterBody:f=>{if(u.value==="bar"&&f.length>0){const F=f[0];F.dataset;const R=F.parsed.y||0,j=F.dataIndex,U=Le(j);return[`${U>0?(R/U*100).toFixed(1):0}% Ð¾Ñ‚ Ð¾Ð±Ñ‰ÐµÐ³Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° ÑÑ‚Ð°Ð¿Ð°`]}if(u.value==="doughnut"&&f.length>0)return["ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼"];if(u.value==="line"){const F=[];if(d.value){const R=f[0].dataIndex;if(R!==0){let j=null;if(I(f[0].dataset.label||""),p.value==="weekStartToWeekEnd"&&R===1?j=d.value.weekStartToWeekEnd:p.value==="weekEndToCurrent"&&R===2?j=d.value.weekEndToCurrent:p.value==="weekStartToCurrent"&&R===2&&(j=d.value.weekStartToCurrent),j&&j.metadata){const U=j.metadata.timeDiff;F.push(`ÐŸÐµÑ€Ð¸Ð¾Ð´: ${U.days} Ð´Ð½. ${U.hours} Ñ‡. ${U.minutes} Ð¼Ð¸Ð½.`)}}}return F.push("ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼"),F}if(!d.value)return[];const v=f[0].dataIndex;if(v===0)return[];let E=null;if(I(f[0].dataset.label||""),p.value==="weekStartToWeekEnd"&&v===1?E=d.value.weekStartToWeekEnd:p.value==="weekEndToCurrent"&&v===2?E=d.value.weekEndToCurrent:p.value==="weekStartToCurrent"&&v===2&&(E=d.value.weekStartToCurrent),!E||!E.metadata)return[];const C=E.metadata.timeDiff;return[`ÐŸÐµÑ€Ð¸Ð¾Ð´: ${C.days} Ð´Ð½. ${C.hours} Ñ‡. ${C.minutes} Ð¼Ð¸Ð½.`]}}},title:{display:!1}}};return u.value==="line"||u.value==="bar"?{...D,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}:u.value==="doughnut"?{...D,cutout:"60%"}:D});function Ae(D){const f=new Date(D),v=f.getFullYear(),E=String(f.getMonth()+1).padStart(2,"0"),C=String(f.getDate()).padStart(2,"0");return`${v}-${E}-${C}`}function Xe(D){const{current:f,weekEnd:v}=D,E=f||v;if(!E||!E.statistics||!E.statistics.stages)return null;const C=[],F=[],R=[],j=[],U={};return H.forEach(x=>{var L;const Y=((L=E.statistics.stages[x.id])==null?void 0:L.count)||0;if(Y>0){C.push(x.name),F.push(Y),R.push(x.color+"80"),j.push(x.color);const q=vs(x.id,E,H);q&&q.employees&&(U[x.id]=q)}}),F.length===0?null:{labels:C,datasets:[{label:"Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÑÑ‚Ð°Ð¿Ð°Ð¼",data:F,backgroundColor:R,borderColor:j,borderWidth:2,meta:{employees:U}}]}}function Ze(D){if(u.value==="doughnut")return Xe(D);if(u.value==="bar"){const R=s.showCurrentState&&D.current?"current":D.weekEnd?"weekEnd":"weekStart";return hs(D,R,H)}const{weekStart:f,weekEnd:v,current:E}=D,C=[],F=[];return H.forEach((R,j)=>{var de,be,me,De,Ee,rt,it,ct,dt,ut,pt,gt,ft,mt,ht,vt,yt;const U=[];if(f&&f.statistics&&f.statistics.stages){const ee=f.statistics.stages[R.id];if(C.length===0){const Fe=(de=f.metadata)!=null&&de.createdAt?new Date(f.metadata.createdAt):null;C.push(Fe?Ae(Fe):"ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸")}U.push((ee==null?void 0:ee.count)||0)}else C.length===0&&C.push("ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸"),U.push(0);if(v&&v.statistics&&v.statistics.stages){const ee=v.statistics.stages[R.id];if(C.length===1){const Fe=(be=v.metadata)!=null&&be.createdAt?new Date(v.metadata.createdAt):null;C.push(Fe?Ae(Fe):"ÐšÐ¾Ð½ÐµÑ† Ð½ÐµÐ´ÐµÐ»Ð¸")}U.push((ee==null?void 0:ee.count)||0)}else C.length===1&&C.push("ÐšÐ¾Ð½ÐµÑ† Ð½ÐµÐ´ÐµÐ»Ð¸"),U.push(0);if(E&&s.showCurrentState&&E.statistics&&E.statistics.stages){const ee=E.statistics.stages[R.id];C.length===2&&C.push("Ð¢ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ"),U.push((ee==null?void 0:ee.count)||0)}const x=["stable"];d.value?p.value==="weekStartToWeekEnd"?(x.push(((Ee=(De=(me=d.value.weekStartToWeekEnd)==null?void 0:me.stages)==null?void 0:De[R.id])==null?void 0:Ee.trend)||"stable"),E&&x.push(((ct=(it=(rt=d.value.weekStartToCurrent)==null?void 0:rt.stages)==null?void 0:it[R.id])==null?void 0:ct.trend)||"stable")):p.value==="weekEndToCurrent"&&E?(x.push("stable"),x.push(((pt=(ut=(dt=d.value.weekEndToCurrent)==null?void 0:dt.stages)==null?void 0:ut[R.id])==null?void 0:pt.trend)||"stable")):p.value==="weekStartToCurrent"&&E?(x.push(((mt=(ft=(gt=d.value.weekStartToWeekEnd)==null?void 0:gt.stages)==null?void 0:ft[R.id])==null?void 0:mt.trend)||"stable"),x.push(((yt=(vt=(ht=d.value.weekStartToCurrent)==null?void 0:ht.stages)==null?void 0:vt[R.id])==null?void 0:yt.trend)||"stable")):(x.push("stable"),E&&x.push("stable")):(x.push("stable"),E&&x.push("stable"));let Y,L,q;d.value&&u.value!=="doughnut"?(Y=x.map(ee=>ne(ee,"background")+"40"),L=x.map(ee=>ne(ee,"border")),q=x.map(ee=>ne(ee,"point"))):(Y=R.color+"40",L=R.color,q=R.color);let Q=null;u.value==="line"&&(Q={employees:ms(R.id,D)}),F.push({label:R.name,data:U,backgroundColor:(Array.isArray(Y),Y),borderColor:(Array.isArray(L),L),borderWidth:2,...u.value==="line"&&{pointStyle:V[j%V.length]},pointBackgroundColor:(Array.isArray(q),q),pointBorderColor:(Array.isArray(L),L),pointRadius:6,pointHoverRadius:8,fill:u.value!=="line",tension:u.value==="line"?.4:0,meta:Q})}),C.length===0&&(C.push("ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸","ÐšÐ¾Ð½ÐµÑ† Ð½ÐµÐ´ÐµÐ»Ð¸"),s.showCurrentState&&C.push("Ð¢ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ")),{labels:C,datasets:F}}const Qe=async()=>{var D,f,v;n.value=!0,o.value=null;try{const E=(D=s.period)!=null&&D.endDate?new Date(s.period.endDate):new Date,C=(f=s.period)!=null&&f.startDate?new Date(s.period.startDate):ye.getWeekStartDate(E),F=(v=s.period)!=null&&v.endDate?new Date(s.period.endDate):ye.getWeekEndDate(E),R=ye.formatDate(C),j=ye.formatDate(F),[U,x]=await Promise.all([ye.getSnapshot(R,"week_start"),ye.getSnapshot(j,"week_end")]);let Y=null;s.showCurrentState&&(Y=await lt.getSectorDataForSnapshot({useCache:!1,normalize:!0})),r.value={weekStart:U,weekEnd:x,current:Y},G(),ge(),Se(),a("data-loaded",{weekStart:U,weekEnd:x,current:Y})}catch(E){console.error("Error loading chart data:",E),o.value=E.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°",te.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°: "+o.value),a("error",o.value)}finally{n.value=!1}};Te(()=>{kt.register(_s),Qe()});function Ot(D){X.value=D}const Se=()=>{var f;const D=Ze({weekStart:r.value.weekStart,weekEnd:r.value.weekEnd,current:r.value.current});if(!l.value||!l.value.labels||l.value.labels.length!==((f=D==null?void 0:D.labels)==null?void 0:f.length))l.value=D;else if(D){const v=JSON.stringify(l.value),E=JSON.stringify(D);v!==E&&(l.value=D)}};return Oe(()=>[s.period,s.showCurrentState],()=>{Qe()},{deep:!0}),Oe(u,()=>{(r.value.weekStart||r.value.weekEnd||r.value.current)&&Se()}),Oe(p,()=>{(r.value.weekStart||r.value.weekEnd||r.value.current)&&Se()}),(D,f)=>(b(),_("div",Ts,[i("div",Cs,[f[3]||(f[3]=i("h3",{class:"chart-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),i("div",As,[(b(),_(ue,null,pe(g,v=>i("button",{key:v.value,onClick:E=>u.value=v.value,class:ae(["chart-type-btn",{active:u.value===v.value}]),title:v.label},[i("span",$s,B(v.icon),1),i("span",Ms,B(v.label),1)],10,Is)),64))])]),!n.value&&!o.value&&d.value&&u.value!=="doughnut"?(b(),_("div",Ns,[f[7]||(f[7]=i("h4",{class:"comparison-title"},"Ð¢Ð¸Ð¿ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ:",-1)),i("div",Rs,[i("label",null,[Ue(i("input",{type:"radio","onUpdate:modelValue":f[0]||(f[0]=v=>p.value=v),value:"weekStartToWeekEnd",onChange:Se},null,544),[[et,p.value]]),f[4]||(f[4]=i("span",null,"ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸ â†’ ÐšÐ¾Ð½ÐµÑ† Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),r.value.current?(b(),_("label",Fs,[Ue(i("input",{type:"radio","onUpdate:modelValue":f[1]||(f[1]=v=>p.value=v),value:"weekEndToCurrent",onChange:Se},null,544),[[et,p.value]]),f[5]||(f[5]=i("span",null,"ÐšÐ¾Ð½ÐµÑ† Ð½ÐµÐ´ÐµÐ»Ð¸ â†’ Ð¢ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ",-1))])):Z("",!0),r.value.current?(b(),_("label",Os,[Ue(i("input",{type:"radio","onUpdate:modelValue":f[2]||(f[2]=v=>p.value=v),value:"weekStartToCurrent",onChange:Se},null,544),[[et,p.value]]),f[6]||(f[6]=i("span",null,"ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸ â†’ Ð¢ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ",-1))])):Z("",!0)])])):Z("",!0),!n.value&&!o.value&&l.value?(b(),Me(oa,{key:1,stages:H,selected:X.value,"onUpdate:selected":Ot,onChange:Se},null,8,["selected"])):Z("",!0),!n.value&&!o.value&&d.value&&u.value!=="doughnut"?(b(),_("div",Hs,[...f[8]||(f[8]=[Bt('<h4 class="legend-title" data-v-8956dc9f>Ð›ÐµÐ³ÐµÐ½Ð´Ð°:</h4><div class="legend-items" data-v-8956dc9f><div class="legend-item" data-v-8956dc9f><span class="legend-color legend-increase" data-v-8956dc9f></span><span data-v-8956dc9f>Ð—ÐµÐ»Ñ‘Ð½Ñ‹Ð¹ â€” Ñ€Ð¾ÑÑ‚ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²</span></div><div class="legend-item" data-v-8956dc9f><span class="legend-color legend-decrease" data-v-8956dc9f></span><span data-v-8956dc9f>ÐšÑ€Ð°ÑÐ½Ñ‹Ð¹ â€” ÑÐ½Ð¸Ð¶ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²</span></div><div class="legend-item" data-v-8956dc9f><span class="legend-color legend-stable" data-v-8956dc9f></span><span data-v-8956dc9f>Ð¡ÐµÑ€Ñ‹Ð¹ â€” Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹</span></div></div>',2)])])):Z("",!0),n.value?(b(),Me(It,{key:3,message:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°..."})):o.value?(b(),_("div",Bs,[i("p",xs,"âŒ "+B(o.value),1),i("button",{onClick:Qe,class:"btn-retry"},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ")])):Re.value?(b(),_("div",Ps,[i("div",Ls,[i("div",Ws,[(b(),Me(xt(S.value),{data:Re.value,options:Je.value},null,8,["data","options"]))]),u.value==="bar"?(b(),_("div",Us,[(b(),_(ue,null,pe(H,v=>i("div",{key:v.id,class:"stage-label-item"},B(ce(v.id)),1)),64))])):Z("",!0)])])):(b(),_("div",js,[...f[9]||(f[9]=[i("p",null,"ðŸ“Š ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ",-1),i("p",{class:"no-data-hint"},"Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÑÐ»ÐµÐ¿ÐºÐ¸ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°",-1)])])),re(gs,{"is-visible":y.value,"stage-name":w.value,"stage-id":h.value,"total-count":m.value,employees:k.value,others:A.value,snapshot:z.value,"ticket-details":T.value,onClose:O},null,8,["is-visible","stage-name","stage-id","total-count","employees","others","snapshot","ticket-details"])]))}},Vs=we(zs,[["__scopeId","data-v-8956dc9f"]]),Ks={key:0,class:"create-snapshot-button-container"},Gs=["disabled"],Ys={class:"modal-content"},qs={class:"modal-header"},Js=["disabled"],Xs={class:"modal-body"},Zs={key:0,class:"progress-container"},Qs={class:"progress-bar-wrapper"},en={class:"progress-text"},tn={class:"progress-percent"},an={class:"progress-description"},sn={key:1},nn={class:"modal-footer"},on=["disabled"],ln=["disabled"],rn={key:0},cn={key:0},dn={key:1},un={key:2},pn={key:1},gn={__name:"CreateSnapshotButton",props:{user:{type:Object,default:null}},emits:["snapshot-created"],setup(c,{emit:t}){const e=c,s=t,a=$(e.user),n=$(!1),o=$(!1),l=$(0),r=$("idle"),d=$(""),p=xe(),g=J(()=>a.value?Pt(a.value):!1);Te(async()=>{if(!e.user)try{const m=await $t.checkAccess();m.allowed&&(a.value=m.user)}catch(m){console.error("Error loading user:",m)}});const u=()=>{if(!g.value){p.warning("Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñ‹ Ð¼Ð¾Ð³ÑƒÑ‚ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿ÐºÐ¸");return}n.value=!0},y=()=>{o.value||(n.value=!1,r.value="idle",l.value=0,d.value="")},w=async()=>{if(!o.value){if(!g.value){p.warning("Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñ‹ Ð¼Ð¾Ð³ÑƒÑ‚ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿ÐºÐ¸");return}o.value=!0,r.value="loading_data",l.value=0,d.value="Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…...";try{d.value="Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐµÐºÑ‚Ð¾Ñ€Ð° Ð¸Ð· Bitrix24...";const m=await lt.getSectorDataForSnapshot({useCache:!0,normalize:!0,onProgress:z=>{var N;const T=Math.min(80,(z.progress||0)*.8);l.value=T,r.value="loading_data",d.value=z.description||((N=z.details)==null?void 0:N.description)||"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐµÐºÑ‚Ð¾Ñ€Ð°..."}});r.value="creating_snapshot",l.value=85,d.value="Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐ»ÐµÐ¿ÐºÐ°...";const k=a.value;if(!k)throw new Error("ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½");const A=await ye.createSnapshot(m,"manual",{createdBy:{id:k.ID,name:`${k.NAME||""} ${k.LAST_NAME||""}`.trim()||k.EMAIL||`User ${k.ID}`},sectorId:"1C"});r.value="success",l.value=100,d.value="Ð¡Ð»ÐµÐ¿Ð¾Ðº ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½!",p.success("Ð¡Ð»ÐµÐ¿Ð¾Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½"),s("snapshot-created",A),setTimeout(()=>{y()},1500)}catch(m){r.value="error",l.value=0,d.value="ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°",console.error("Error creating snapshot:",m);let k="ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°";m.message&&(m.message.includes("Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…")||m.message.includes("sector data")?k="ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐµÐºÑ‚Ð¾Ñ€Ð°. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Bitrix24.":m.message.includes("ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°")||m.message.includes("snapshot")?k="ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿Ð¾Ðº. ÐžÐ±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ð² Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ.":m.message.includes("Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†")||m.message.includes("validation")?k="ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐµÐºÑ‚Ð¾Ñ€Ð°.":k=m.message),p.error(k)}finally{o.value=!1}}},h=m=>{m.key==="Escape"&&n.value&&!o.value&&y()};return Te(()=>{window.addEventListener("keydown",h)}),Ye(()=>{window.removeEventListener("keydown",h)}),(m,k)=>g.value?(b(),_("div",Ks,[i("button",{class:"create-snapshot-btn",onClick:u,disabled:o.value,title:"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿Ð¾Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð°"},[...k[1]||(k[1]=[i("span",{class:"btn-icon"},"ðŸ“¸",-1),i("span",{class:"btn-text"},"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿Ð¾Ðº",-1)])],8,Gs),(b(),Me(At,{to:"body"},[re(Ge,{name:"modal"},{default:Be(()=>[n.value?(b(),_("div",{key:0,class:"modal-overlay",onClick:k[0]||(k[0]=ie(A=>!o.value&&y(),["self"]))},[i("div",Ys,[i("div",qs,[k[2]||(k[2]=i("h3",{class:"modal-title"},"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿Ð¾Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð°",-1)),i("button",{class:"modal-close",onClick:y,disabled:o.value,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ",8,Js)]),i("div",Xs,[r.value!=="idle"?(b(),_("div",Zs,[i("div",Qs,[i("div",{class:"progress-bar",style:ke({width:`${l.value}%`})},null,4)]),i("div",en,[i("span",tn,B(Math.round(l.value))+"%",1),i("span",an,B(d.value),1)])])):(b(),_("div",sn,[...k[3]||(k[3]=[i("p",{class:"modal-description"},' Ð‘ÑƒÐ´ÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð½ ÑÐ»ÐµÐ¿Ð¾Ðº Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡. Ð¡Ð»ÐµÐ¿Ð¾Ðº Ð±ÑƒÐ´ÐµÑ‚ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½ Ñ Ñ‚Ð¸Ð¿Ð¾Ð¼ "manual" (Ñ€ÑƒÑ‡Ð½Ð¾Ð¹). ',-1),i("p",{class:"modal-warning"}," âš ï¸ ÐŸÑ€Ð¾Ñ†ÐµÑÑ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ° Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚ÑŒ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ. ",-1)])]))]),i("div",nn,[i("button",{class:"btn btn-secondary",onClick:y,disabled:o.value}," ÐžÑ‚Ð¼ÐµÐ½Ð° ",8,on),i("button",{class:"btn btn-primary",onClick:w,disabled:o.value},[o.value?(b(),_("span",rn,[r.value==="loading_data"?(b(),_("span",cn,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…...")):r.value==="creating_snapshot"?(b(),_("span",dn,"Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ...")):(b(),_("span",un,"ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°..."))])):(b(),_("span",pn,"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ"))],8,ln)])])])):Z("",!0)]),_:1})]))])):Z("",!0)}},fn=we(gn,[["__scopeId","data-v-09bccee2"]]),mn=20,hn=5*60*1e3;async function vn({search:c="",limit:t=mn,sectorDepartmentId:e=Et.SECTOR_1C}={}){const s=`sector1c_employees_${c}_${t}_${e||"all"}`,a=sessionStorage.getItem(s);if(a)try{const{data:n,timestamp:o}=JSON.parse(a);if(Date.now()-o<hn)return n}catch(n){console.warn("[sector1cEmployees] Cache parse error:",n)}try{const n={ACTIVE:"Y"};e?Array.isArray(e)?n.UF_DEPARTMENT=e:n.UF_DEPARTMENT=[e]:n.UF_DEPARTMENT=[Et.SECTOR_1C],c&&c.length>=2&&(n["%NAME"]=c,n["%LAST_NAME"]=c,n["%WORK_POSITION"]=c);const r=((await ot.call("user.get",{filter:n,select:["ID","NAME","LAST_NAME","SECOND_NAME","WORK_POSITION","UF_DEPARTMENT"],order:{LAST_NAME:"ASC",NAME:"ASC"},start:0})).result||[]).slice(0,t).map(d=>({id:parseInt(d.ID),name:yn(d),position:d.WORK_POSITION||"",department:d.UF_DEPARTMENT||null}));try{sessionStorage.setItem(s,JSON.stringify({data:r,timestamp:Date.now()}))}catch(d){console.warn("[sector1cEmployees] Cache write error:",d)}return r}catch(n){throw console.error("[sector1cEmployees] ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²:",n),new Error(`ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²: ${n.message}`)}}function yn(c){const t=[c.LAST_NAME,c.NAME,c.SECOND_NAME].filter(Boolean);return t.length>0?t.join(" "):c.NAME||"Ð‘ÐµÐ· Ð¸Ð¼ÐµÐ½Ð¸"}const kn={class:"employee-select-field-text"},wn={key:0,class:"employee-select-dropdown"},Sn={class:"employee-select-dropdown-search"},bn={key:0,class:"employee-select-state"},Dn={key:1,class:"employee-select-state employee-select-state--error"},En={key:2,class:"employee-select-state"},_n=["checked"],Tn=["checked","onChange"],Cn={class:"employee-select-item-content"},An={class:"employee-select-item-name"},In={key:0,class:"employee-select-item-position"},$n={__name:"EmployeeSelect",props:{selected:{type:Array,default:()=>["all"]},multiple:{type:Boolean,default:!0},placeholder:{type:String,default:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð² ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡"},maxHeight:{type:Number,default:300}},emits:["update:selected","search","error"],setup(c,{emit:t}){const e=c,s=t,a=$(null),n=$(null),o=$(""),l=$([]),r=$(!1),d=$(null),p=$(!1),g=J(()=>{if(!o.value)return l.value;const S=o.value.toLowerCase();return l.value.filter(M=>M.name.toLowerCase().includes(S)||M.position&&M.position.toLowerCase().includes(S))}),u=J(()=>{if(e.selected.includes("all")||e.selected.length===0)return e.placeholder;if(e.selected.length===1){const S=l.value.find(M=>M.id===e.selected[0]);return S?S.name:e.placeholder}return`Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð¾: ${e.selected.length} ${T(e.selected.length,"ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°","ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²","ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²")}`});async function y(S=""){r.value=!0,d.value=null;try{l.value=await vn({search:S})}catch(M){d.value=M,s("error",M)}finally{r.value=!1}}function w(){s("search",o.value)}function h(){r.value||(p.value=!p.value,p.value?(l.value.length===0&&y(),Wt(()=>{n.value&&n.value.focus()})):o.value="")}function m(S){a.value&&!a.value.contains(S.target)&&(p.value=!1,o.value="")}function k(S){const M=[...e.selected],H=M.indexOf(S);if(S==="all")if(H>-1)M.splice(H,1);else return s("update:selected",["all"]);else if(H>-1)M.splice(H,1);else{const V=M.indexOf("all");V>-1&&M.splice(V,1),M.push(S)}s("update:selected",M)}function A(S){return S==="all"?e.selected.includes("all"):e.selected.includes(S)||e.selected.includes("all")}const z=J(()=>o.value?`ÐÐµÑ‚ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð² Ð¿Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ "${o.value}"`:"ÐÐµÑ‚ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð² ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡");function T(S,M,H,V){const X=S%10,te=S%100;return te>=11&&te<=19?V:X===1?M:X>=2&&X<=4?H:V}function N(){y(o.value)}return Oe(()=>e.selected,S=>{(!S||S.length===0)&&s("update:selected",["all"])},{immediate:!0}),Te(()=>{document.addEventListener("click",m),(!e.selected||e.selected.length===0)&&s("update:selected",["all"])}),Ye(()=>{document.removeEventListener("click",m)}),(S,M)=>(b(),_("div",{class:"employee-select",ref_key:"selectContainer",ref:a},[i("div",{class:ae(["employee-select-field",{"employee-select-field--open":p.value,"employee-select-field--disabled":r.value}]),onClick:h},[i("span",kn,B(u.value),1),i("span",{class:ae(["employee-select-field-icon",{open:p.value}])},"â–¼",2)],2),re(Ge,{name:"dropdown-fade"},{default:Be(()=>[p.value?(b(),_("div",wn,[i("div",Sn,[Ue(i("input",{"onUpdate:modelValue":M[0]||(M[0]=H=>o.value=H),type:"text",placeholder:"ðŸ” ÐŸÐ¾Ð¸ÑÐº ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°...",class:"employee-select-search-input",onInput:w,onClick:M[1]||(M[1]=ie(()=>{},["stop"])),ref_key:"searchInput",ref:n},null,544),[[Lt,o.value]])]),r.value?(b(),_("div",bn,[...M[6]||(M[6]=[i("span",{class:"spinner"},"â³",-1),i("span",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð² ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡...",-1)])])):d.value?(b(),_("div",Dn,[i("span",null,"âŒ "+B(d.value.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²"),1),i("button",{onClick:[N,M[2]||(M[2]=ie(()=>{},["stop"]))],class:"btn-retry"},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):!r.value&&g.value.length===0&&!d.value?(b(),_("div",En,[i("span",null,"ðŸ“­ "+B(z.value),1)])):(b(),_("div",{key:3,class:"employee-select-list",style:ke({maxHeight:`${c.maxHeight}px`})},[i("label",{class:ae(["employee-select-item",{"employee-select-item--selected":A("all")}]),onClick:M[4]||(M[4]=ie(()=>{},["stop"]))},[i("input",{type:"checkbox",checked:A("all"),onChange:M[3]||(M[3]=H=>k("all"))},null,40,_n),M[7]||(M[7]=i("div",{class:"employee-select-item-content"},[i("span",{class:"employee-select-item-name"},"Ð’ÑÐµ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¸")],-1))],2),(b(!0),_(ue,null,pe(g.value,H=>(b(),_("label",{key:H.id,class:ae(["employee-select-item",{"employee-select-item--selected":A(H.id)}]),onClick:M[5]||(M[5]=ie(()=>{},["stop"]))},[i("input",{type:"checkbox",checked:A(H.id),onChange:V=>k(H.id)},null,40,Tn),i("div",Cn,[i("span",An,B(H.name),1),H.position?(b(),_("span",In,B(H.position),1)):Z("",!0)])],2))),128))],4))])):Z("",!0)]),_:1})],512))}},Mn=we($n,[["__scopeId","data-v-6b8c949b"]]),Nn={class:"stage-select-field-text"},Rn={key:0,class:"stage-select-dropdown"},Fn={class:"stage-select-list"},On=["checked"],Hn=["checked","onChange"],Bn={class:"stage-select-item-content"},xn={class:"stage-select-item-name"},Pn={__name:"StageSelect",props:{selected:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},stages:{type:Array,required:!0,default:()=>[{id:"formed",name:"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ",color:"#007bff"},{id:"review",name:"Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—",color:"#ffc107"},{id:"execution",name:"Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ",color:"#28a745"}]},placeholder:{type:String,default:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ð¿Ñ‹"}},emits:["update:selected","change"],setup(c,{emit:t}){const e=c,s=t,a=$(null),n=$(!1),o=J(()=>Object.values(e.selected).every(u=>u===!0)),l=J(()=>{if(o.value)return e.placeholder;const u=e.stages.filter(y=>e.selected[y.id]);return u.length===0?"Ð­Ñ‚Ð°Ð¿Ñ‹ Ð½Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ñ‹":u.length===1?u[0].name:`Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð¾: ${u.length} ÑÑ‚Ð°Ð¿Ð°(Ð¾Ð²)`});function r(){n.value=!n.value,n.value}function d(u){a.value&&!a.value.contains(u.target)&&(n.value=!1)}function p(u,y){const w={...e.selected};w[u]=y,s("update:selected",w),s("change",u,y)}function g(){const u=o.value,y={};e.stages.forEach(w=>{y[w.id]=!u}),s("update:selected",y),s("change","all",!u)}return Te(()=>{document.addEventListener("click",d)}),Ye(()=>{document.removeEventListener("click",d)}),(u,y)=>(b(),_("div",{class:"stage-select",ref_key:"selectContainer",ref:a},[i("div",{class:ae(["stage-select-field",{"stage-select-field--open":n.value,"stage-select-field--disabled":!1}]),onClick:r},[i("span",Nn,B(l.value),1),i("span",{class:ae(["stage-select-field-icon",{open:n.value}])},"â–¼",2)],2),re(Ge,{name:"dropdown-fade"},{default:Be(()=>[n.value?(b(),_("div",Rn,[i("div",Fn,[i("label",{class:ae(["stage-select-item",{"stage-select-item--selected":o.value}]),onClick:y[0]||(y[0]=ie(()=>{},["stop"]))},[i("input",{type:"checkbox",checked:o.value,onChange:g},null,40,On),y[2]||(y[2]=i("div",{class:"stage-select-item-content"},[i("span",{class:"stage-select-item-name"},"Ð’ÑÐµ ÑÑ‚Ð°Ð¿Ñ‹")],-1))],2),(b(!0),_(ue,null,pe(c.stages,w=>(b(),_("label",{key:w.id,class:ae(["stage-select-item",{"stage-select-item--selected":c.selected[w.id]}]),onClick:y[1]||(y[1]=ie(()=>{},["stop"]))},[i("input",{type:"checkbox",checked:c.selected[w.id],onChange:h=>p(w.id,h.target.checked)},null,40,Hn),i("div",Bn,[i("span",{class:"stage-select-item-color",style:ke({backgroundColor:w.color})},null,4),i("span",xn,B(w.name),1)])],2))),128))])])):Z("",!0)]),_:1})],512))}},Ln=we(Pn,[["__scopeId","data-v-ce2229b2"]]),Wn={class:"filters-panel"},Un={class:"filters-header"},jn=["disabled"],zn={class:"filters-content"},Vn={class:"filter-section"},Kn={class:"section-content"},Gn={class:"filter-section"},Yn={class:"section-content"},qn={class:"filter-section"},Jn={class:"section-content"},Xn=["value"],Zn={key:0,class:"custom-date-range"},Qn={class:"date-range-inputs"},eo={class:"date-input-group"},to=["value","max"],ao={class:"date-input-group"},so=["value","min","max"],no={key:0,class:"filter-error"},oo={key:1,class:"filter-hint"},lo={__name:"FiltersPanel",props:{stages:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},employees:{type:Array,default:()=>["all"]},dateRange:{type:String,default:"last-week"},customDateRange:{type:Object,default:()=>({startDate:null,endDate:null})},hasActiveFilters:{type:Boolean,default:!1}},emits:["update:stages","update:employees","update:dateRange","update:customDateRange","reset","apply"],setup(c,{emit:t}){const e=c,s=t,a=[{id:"formed",name:"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ",color:"var(--b24-primary, #007bff)"},{id:"review",name:"Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—",color:"var(--b24-warning, #ffc107)"},{id:"execution",name:"Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ",color:"var(--b24-success, #28a745)"}],n=$(null),o=J(()=>{const w=new Date;return w.setFullYear(w.getFullYear()-1),w.toISOString().split("T")[0]}),l=J(()=>new Date().toISOString().split("T")[0]);function r(w){s("update:stages",w),s("apply")}function d(w,h){s("apply")}function p(w){s("update:employees",w),s("apply")}function g(w){s("update:dateRange",w),n.value=null,s("apply")}function u(w,h){const m={...e.customDateRange};if(m[w]=h,m.startDate&&m.endDate){const k=new Date(m.startDate),A=new Date(m.endDate);if(k>A){n.value="ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ð°Ñ Ð´Ð°Ñ‚Ð° Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ ÐºÐ¾Ð½ÐµÑ‡Ð½Ð¾Ð¹";return}if(Math.ceil((A-k)/(1e3*60*60*24))>365){n.value="ÐŸÐµÑ€Ð¸Ð¾Ð´ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°Ñ‚ÑŒ 365 Ð´Ð½ÐµÐ¹";return}}n.value=null,s("update:customDateRange",m),s("apply")}function y(){n.value=null,s("reset")}return(w,h)=>(b(),_("div",Wn,[i("div",Un,[h[3]||(h[3]=i("h2",null,"Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹",-1)),i("button",{onClick:y,class:"btn-reset-filters",disabled:!c.hasActiveFilters}," Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ ",8,jn)]),i("div",zn,[i("div",Vn,[h[4]||(h[4]=i("h3",{class:"section-title"},[i("span",{class:"section-icon"},"ðŸ“Š"),je(" Ð­Ñ‚Ð°Ð¿Ñ‹ ")],-1)),i("div",Kn,[re(Ln,{selected:c.stages,stages:a,placeholder:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ð¿Ñ‹","onUpdate:selected":r,onChange:d},null,8,["selected"])])]),i("div",Gn,[h[5]||(h[5]=i("h3",{class:"section-title"},[i("span",{class:"section-icon"},"ðŸ‘¥"),je(" Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡ ")],-1)),i("div",Yn,[re(Mn,{selected:c.employees,"onUpdate:selected":p},null,8,["selected"])])]),i("div",qn,[h[9]||(h[9]=i("h3",{class:"section-title"},[i("span",{class:"section-icon"},"ðŸ“…"),je(" ÐŸÐµÑ€Ð¸Ð¾Ð´ ")],-1)),i("div",Jn,[i("select",{value:c.dateRange,onChange:h[0]||(h[0]=m=>g(m.target.value)),class:"date-range-select"},[...h[6]||(h[6]=[i("option",{value:"last-week"},"ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð½ÐµÐ´ÐµÐ»Ñ",-1),i("option",{value:"last-2-weeks"},"ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 2 Ð½ÐµÐ´ÐµÐ»Ð¸",-1),i("option",{value:"last-month"},"ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð¼ÐµÑÑÑ†",-1),i("option",{value:"custom"},"ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´",-1)])],40,Xn),c.dateRange==="custom"?(b(),_("div",Zn,[i("div",Qn,[i("div",eo,[h[7]||(h[7]=i("label",null,"Ð¡:",-1)),i("input",{type:"date",value:c.customDateRange.startDate,onChange:h[1]||(h[1]=m=>u("startDate",m.target.value)),max:c.customDateRange.endDate||l.value,class:"date-input"},null,40,to)]),i("div",ao,[h[8]||(h[8]=i("label",null,"ÐŸÐ¾:",-1)),i("input",{type:"date",value:c.customDateRange.endDate,onChange:h[2]||(h[2]=m=>u("endDate",m.target.value)),min:c.customDateRange.startDate||o.value,max:l.value,class:"date-input"},null,40,so)])]),n.value?(b(),_("small",no,B(n.value),1)):(b(),_("small",oo," Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½ÑƒÑŽ Ð¸ ÐºÐ¾Ð½ÐµÑ‡Ð½ÑƒÑŽ Ð´Ð°Ñ‚Ñƒ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… "))])):Z("",!0)])])])]))}},ro=we(lo,[["__scopeId","data-v-4b7456a2"]]);function io(){const c=$(!1),t=$(null),e=$(null),s=$(0),a=xe(),n=async(m=!0,k=null)=>{c.value=!0,t.value=null,s.value=0;try{const A=await lt.getSectorDataForSnapshot({useCache:m,onProgress:z=>{z&&typeof z.progress=="number"&&(s.value=z.progress),k&&k(z)},normalize:!0});return e.value=A,A}catch(A){throw t.value=A.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐµÐºÑ‚Ð¾Ñ€Ð°",a.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐµÐºÑ‚Ð¾Ñ€Ð°: "+t.value),A}finally{c.value=!1,s.value=100}},o=async(m,k={})=>{if(!e.value){const A="Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐµÐºÑ‚Ð¾Ñ€Ð° Ñ‡ÐµÑ€ÐµÐ· loadSectorDataForSnapshot()";throw t.value=A,a.error(A),new Error(A)}c.value=!0,t.value=null;try{if(!["week_start","week_end","manual","current"].includes(m))throw new Error(`ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ‚Ð¸Ð¿ ÑÐ»ÐµÐ¿ÐºÐ°: ${m}. Ð”Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ: week_start, week_end, manual, current`);const A=await ye.createSnapshot(e.value,m,k);return a.success("Ð¡Ð»ÐµÐ¿Ð¾Ðº ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½"),A}catch(A){throw t.value=A.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°",a.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°: "+t.value),A}finally{c.value=!1}},l=()=>{c.value=!1,t.value=null,e.value=null,s.value=0},r=J(()=>e.value!==null&&e.value!==void 0),d=$({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),p=J(()=>{const m=new Date;let k,A;switch(d.value.dateRange){case"last-week":k=new Date(m),k.setDate(m.getDate()-7),A=m;break;case"last-2-weeks":k=new Date(m),k.setDate(m.getDate()-14),A=m;break;case"last-month":k=new Date(m),k.setMonth(m.getMonth()-1),A=m;break;case"custom":k=d.value.customDateRange.startDate?new Date(d.value.customDateRange.startDate):null,A=d.value.customDateRange.endDate?new Date(d.value.customDateRange.endDate):null;break;default:k=new Date(m),k.setDate(m.getDate()-7),A=m}return{startDate:k?k.toISOString().split("T")[0]:null,endDate:A?A.toISOString().split("T")[0]:null}}),g=()=>{y()},u=()=>{d.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},y()},y=()=>{try{localStorage.setItem("graphStateFilters",JSON.stringify(d.value))}catch(m){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð² Ð² localStorage:",m)}},w=()=>{try{const m=localStorage.getItem("graphStateFilters");if(m){const k=JSON.parse(m);k&&typeof k=="object"&&(d.value={stages:k.stages||{formed:!0,review:!0,execution:!0},employees:k.employees||["all"],dateRange:k.dateRange||"last-week",customDateRange:k.customDateRange||{startDate:null,endDate:null}})}}catch(m){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð² Ð¸Ð· localStorage:",m)}},h=J(()=>{const m=Object.values(d.value.stages).some(z=>!z),k=!d.value.employees.includes("all"),A=d.value.dateRange!=="last-week";return m||k||A});return{isLoading:c,error:t,currentSectorData:e,loadingProgress:s,hasSectorData:r,filters:d,selectedPeriod:p,hasActiveFilters:h,loadSectorDataForSnapshot:n,createSnapshot:o,resetState:l,applyFilters:g,resetFilters:u,saveFiltersToLocalStorage:y,loadFiltersFromLocalStorage:w}}const co={class:"graph-state-dashboard"},uo={key:1,class:"error-message-container"},po={class:"error-message"},go={class:"error-text"},fo={key:0,class:"error-details"},mo={class:"dashboard-header"},ho={class:"header-content"},vo={class:"breadcrumbs-row"},yo=["aria-disabled","data-fallback","disabled"],ko={class:"breadcrumbs","aria-label":"ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ"},wo={class:"header-actions"},So=["disabled"],bo={key:0},Do={key:1},Eo={key:3,class:"dashboard-content"},_o={class:"chart-container"},To="ÐÐ°Ð·Ð°Ð´",Co={__name:"GraphStateDashboard",setup(c){const t=(O,K)=>typeof window>"u"?K:getComputedStyle(document.documentElement).getPropertyValue(O).trim()||K,e=xe(),s=Ut(),a={name:"dashboard-sector-1c"},{filters:n,selectedPeriod:o,hasActiveFilters:l,applyFilters:r,resetFilters:d,loadFiltersFromLocalStorage:p}=io(),g=$(null),u=$(!0),y=$(!1),w=$("Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…..."),h=$(null),m=$(!1),k=$(!1),A=$(typeof window<"u"?window.innerWidth:1024),z=$(null),T=$(!1),N=J(()=>A.value<768);J(()=>A.value>=768&&A.value<1024),J(()=>A.value>=1024);const S=J(()=>typeof window>"u"?!1:window.history.length>1);J(()=>{const O=new Date;return O.setFullYear(O.getFullYear()-1),O.toISOString().split("T")[0]}),J(()=>new Date().toISOString().split("T")[0]);function M(O){n.value.stages=O}function H(O){n.value.employees=O}function V(O){n.value.dateRange=O}function X(O){n.value.customDateRange=O}function te(){r()}function P(){d(),z.value=null,te(),e.info("Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ ÑÐ±Ñ€Ð¾ÑˆÐµÐ½Ñ‹")}function G(O){e.success("Ð¡Ð»ÐµÐ¿Ð¾Ðº ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½")}function ne(O){y.value=!1,w.value="",console.log("Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹:",O)}function ge(O){y.value=!1,I({message:O||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°",details:null,type:"error"})}function I(O){h.value={message:O.message||"ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ°",details:O.details||null,type:O.type||"error",timestamp:new Date},console.error("Dashboard error:",h.value),e.error(h.value.message)}function se(){h.value=null}function Ce(){h.value=null,y.value=!0,w.value="ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…..."}async function W(){if(typeof window>"u"||!window.jsPDF||!window.html2canvas){e.warning("Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð² PDF Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½. ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ¸ jspdf Ð¸ html2canvas."),console.warn("Ð”Ð»Ñ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð° Ð² PDF ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ: npm install jspdf html2canvas");return}m.value=!0;try{const O=document.querySelector(".chart-container");if(!O)throw new Error("Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½");const K=window.html2canvas,fe=await K(O,{scale:2,useCORS:!0,logging:!1,backgroundColor:t("--b24-bg-white","#ffffff")}),Le=window.jsPDF,ce=new Le("landscape","mm","a4"),Re=297,Je=fe.height*Re/fe.width;ce.setFontSize(18),ce.text("Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",148.5,15,{align:"center"});const Ae=new Date().toLocaleDateString("ru-RU");ce.setFontSize(10);const Xe=o.value.startDate&&o.value.endDate?`ÐŸÐµÑ€Ð¸Ð¾Ð´: ${o.value.startDate} - ${o.value.endDate}`:"ÐŸÐµÑ€Ð¸Ð¾Ð´: Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½";ce.text(Xe,148.5,25,{align:"center"}),ce.text(`Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð¾Ñ‚ ${Ae}`,148.5,30,{align:"center"}),ce.addImage(fe.toDataURL("image/png"),"PNG",10,35,Re-20,Je-20),ce.setProperties({title:"Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",subject:`Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð¾Ñ‚ ${Ae}`,author:"Bitrix24 Dashboard"});const Ze=`graph-state-${Ae.replace(/\//g,"-")}.pdf`;ce.save(Ze),e.success("Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð² PDF")}catch(O){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð° Ð² PDF:",O),I({message:"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð° Ð² PDF: "+(O.message||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°"),details:O.stack,type:"error"})}finally{m.value=!1}}function oe(O){var K;if((K=O==null?void 0:O.preventDefault)==null||K.call(O),!T.value){T.value=!0;try{if(S.value){s.back();return}console.warn("GraphStateDashboard: fallback navigation to dashboard-sector-1c"),s.push(a)}finally{T.value=!1}}}function Pe(){typeof window<"u"&&(A.value=window.innerWidth)}async function qe(){try{const O=await $t.checkAccess();O.allowed&&(g.value=O.user)}catch(O){console.error("Error loading user:",O)}}return Te(()=>{p(),qe(),typeof window<"u"&&(A.value=window.innerWidth,window.addEventListener("resize",Pe))}),Ye(()=>{typeof window<"u"&&window.removeEventListener("resize",Pe)}),(O,K)=>{const fe=jt("router-link");return b(),_("div",co,[y.value?(b(),Me(It,{key:0,message:w.value},null,8,["message"])):Z("",!0),h.value?(b(),_("div",uo,[i("div",po,[i("div",{class:"error-header"},[K[1]||(K[1]=i("span",{class:"error-icon"},"âŒ",-1)),K[2]||(K[2]=i("h3",null,"ÐžÑˆÐ¸Ð±ÐºÐ°",-1)),i("button",{onClick:se,class:"error-close","aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"},"âœ•")]),i("p",go,B(h.value.message),1),h.value.details?(b(),_("div",fo,[i("details",null,[K[3]||(K[3]=i("summary",null,"Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸",-1)),i("pre",null,B(h.value.details),1)])])):Z("",!0),i("div",{class:"error-actions"},[i("button",{onClick:Ce,class:"btn-retry"},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÑƒ")])])])):Z("",!0),i("div",mo,[i("div",ho,[i("div",vo,[i("button",{class:"btn-back-link",type:"button",onClick:oe,"aria-label":To,"aria-disabled":!S.value,"data-fallback":!S.value,disabled:T.value,title:"ÐÐ°Ð·Ð°Ð´"}," â† ",8,yo),i("nav",ko,[re(fe,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:Be(()=>[...K[4]||(K[4]=[je(" Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡ ",-1)])]),_:1}),K[5]||(K[5]=i("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),K[6]||(K[6]=i("span",{class:"breadcrumb-current"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ",-1))])]),K[7]||(K[7]=i("h1",{class:"dashboard-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),K[8]||(K[8]=i("p",{class:"dashboard-subtitle"}," Ð’Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° Ð²Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ ",-1))]),i("div",wo,[i("button",{onClick:W,class:"btn-export-pdf",disabled:m.value||y.value,title:"Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð³Ñ€Ð°Ñ„Ð¸Ðº Ð² PDF"},[m.value?(b(),_("span",Do,"â³ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚...")):(b(),_("span",bo,"ðŸ“„ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð² PDF"))],8,So),re(fn,{user:g.value,onSnapshotCreated:G},null,8,["user"])])]),N.value?(b(),_("button",{key:2,class:"mobile-filters-toggle",onClick:K[0]||(K[0]=Le=>k.value=!k.value)},[K[9]||(K[9]=i("span",null,"Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹",-1)),i("span",{class:ae(["toggle-icon",{open:k.value}])},"â–¼",2)])):Z("",!0),i("div",{class:ae({"mobile-open":k.value&&N.value,"mobile-closed":!k.value&&N.value})},[re(ro,{stages:Ie(n).stages,employees:Ie(n).employees,dateRange:Ie(n).dateRange,customDateRange:Ie(n).customDateRange,hasActiveFilters:Ie(l),"onUpdate:stages":M,"onUpdate:employees":H,"onUpdate:dateRange":V,"onUpdate:customDateRange":X,onReset:P,onApply:te},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])],2),!y.value&&!h.value?(b(),_("div",Eo,[i("div",_o,[re(Vs,{period:Ie(o),"show-current-state":u.value,onDataLoaded:ne,onError:ge},null,8,["period","show-current-state"])])])):Z("",!0)])}}},Mo=we(Co,[["__scopeId","data-v-e995acfd"]]);export{Mo as default};
