import{B as c}from"./chunk-yzaUG9vQ.js";class m extends c{constructor(){super("core",10*60*1e3)}async getCurrentUser(){try{const t=(await this.call("user.current",{select:["ID","NAME","LAST_NAME","SECOND_NAME","EMAIL","ACTIVE","DATE_REGISTER","TIMESTAMP_X","PERSONAL_PHONE","WORK_PHONE","PERSONAL_PHOTO","WORK_POSITION","WORK_COMPANY","UF_DEPARTMENT","USER_TYPE","EXTERNAL_AUTH_ID"]})).result||null;return t&&(t.fullName=[t.NAME,t.SECOND_NAME,t.LAST_NAME].filter(Boolean).join(" "),t.isAdmin=t.USER_TYPE==="employee"&&t.ID==="1"),t}catch(e){return console.warn("Failed to get current user:",e.message),null}}async getSystemInfo(){try{const[e,t,r]=await Promise.all([this.getCurrentUser(),this.getDepartments({limit:100}),this.getStatusList()]);return{currentUser:e,departments:{total:t.length,active:t.filter(s=>s.ACTIVE!=="N").length},statuses:r,timestamp:new Date().toISOString(),cache:this.getMetrics()}}catch(e){throw console.error("Failed to get system info:",e),e}}async getDepartments(e={}){const{limit:t=100,includeInactive:r=!1}=e,s={select:["ID","NAME","UF_HEAD","PARENT","SORT","ACTIVE"],order:{SORT:"ASC"},start:0},a=(await this.call("department.get",s)).result||[];return(r?a:a.filter(l=>l.ACTIVE!=="N")).slice(0,t)}async getStatusList(e="LEAD"){try{return(await this.call("crm.status.list",{filter:{ENTITY_ID:e},select:["ID","NAME","SORT","COLOR","SEMANTICS"]})).result||[]}catch(t){return console.warn(`Failed to get ${e} statuses:`,t.message),[]}}async getLeadTypes(){try{const e=await this.call("crm.lead.userfield.list",{filter:{FIELD_NAME:"TYPE_ID"}});return e.result&&e.result[0]?.LIST?e.result[0].LIST:[]}catch(e){return console.warn("Failed to get lead types:",e.message),[]}}async getLeadSources(){try{const e=await this.call("crm.lead.userfield.list",{filter:{FIELD_NAME:"SOURCE_ID"}});return e.result&&e.result[0]?.LIST?e.result[0].LIST:[]}catch(e){return console.warn("Failed to get lead sources:",e.message),[]}}async checkApiAvailability(){const e=performance.now();try{await this.call("user.current",{select:["ID"]});const t=performance.now()-e;return{available:!0,responseTime:Math.round(t),timestamp:new Date().toISOString()}}catch(t){const r=performance.now()-e;return{available:!1,error:t.message,responseTime:Math.round(r),timestamp:new Date().toISOString()}}}async getUsersByType(e="employee",t={}){const{limit:r=100,activeOnly:s=!0}=t,n={USER_TYPE:e,...s&&{ACTIVE:"Y"}};return((await this.call("user.get",{filter:n,select:["ID","NAME","LAST_NAME","EMAIL","ACTIVE","WORK_POSITION","UF_DEPARTMENT","USER_TYPE"],order:{NAME:"ASC"},start:0})).result||[]).slice(0,r)}async getAdministrators(){try{return(await this.getUsersByType("employee",{limit:10})).filter(r=>r.ID==="1"||r.WORK_POSITION?.toLowerCase().includes("админ")||r.WORK_POSITION?.toLowerCase().includes("admin"))}catch(e){return console.warn("Failed to get administrators:",e.message),[]}}async getAppSettings(){try{return(await this.call("app.option.get",{})).result||{}}catch(e){return console.warn("Failed to get app settings:",e.message),{}}}async getAvailableMethods(){try{return(await this.call("methods",{})).result||[]}catch(e){return console.warn("Methods list not available:",e.message),[]}}async getLicenseInfo(){try{return(await this.call("app.info",{})).result||{}}catch(e){return console.warn("License info not available:",e.message),{}}}clearCoreCache(){["user.current","department.get","crm.status.list","user.get"].forEach(t=>{super.clearCache(t)})}async getFullSystemDiagnostics(){try{const[e,t,r,s]=await Promise.all([this.checkApiAvailability(),this.getCurrentUser(),this.getSystemInfo(),this.getLicenseInfo()]);return{api:e,user:t,system:r,license:s,diagnostics:{timestamp:new Date().toISOString(),facadeMetrics:this.getMetrics(),cacheSize:this.cache.size,uptime:performance.now()}}}catch(e){throw console.error("Failed to get full system diagnostics:",e),e}}}export{m as C};
