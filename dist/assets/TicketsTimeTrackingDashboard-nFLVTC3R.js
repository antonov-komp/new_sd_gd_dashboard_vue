import{_ as ae,c as N,a as r,o,b as e,t as i,F as I,e as j,n as q,y as S,i as oe,L as M,g as W,G as re,f as te,d as U,j as z,k as H,B as ie,T as ke,a3 as ve,I as pe,m as ye,z as _e,r as be}from"./main-B5cssHjJ.js";const ce="/api/tickets-time-tracking-sector-1c.php";function ge(s){var T,k,c,b,g;if(!s)return{meta:null,data:{totalElapsedTime:0,totalElapsedTimeUnit:"hours",totalRecordsCount:0,weeks:[],employeesSummary:[]}};const _=s.data||s.result||s,a=_.meta||s.meta||null;return{meta:{weekNumber:(a==null?void 0:a.weekNumber)??null,weekStartUtc:(a==null?void 0:a.weekStartUtc)??null,weekEndUtc:(a==null?void 0:a.weekEndUtc)??null,totalWeeks:(a==null?void 0:a.totalWeeks)??0,sector1CEmployeesCount:(a==null?void 0:a.sector1CEmployeesCount)??0},data:{totalElapsedTime:((T=_.data)==null?void 0:T.totalElapsedTime)??_.totalElapsedTime??0,totalElapsedTimeUnit:((k=_.data)==null?void 0:k.totalElapsedTimeUnit)??_.totalElapsedTimeUnit??"hours",totalRecordsCount:((c=_.data)==null?void 0:c.totalRecordsCount)??_.totalRecordsCount??0,weeks:((b=_.data)==null?void 0:b.weeks)??_.weeks??[],employeesSummary:((g=_.data)==null?void 0:g.employeesSummary)??_.employeesSummary??[]}}}async function fe(s={}){const{product:_="1C",weekStartUtc:a=null,weekEndUtc:T=null,weeksCount:k=4}=s;try{const c=await fetch(ce,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:_,weekStartUtc:a,weekEndUtc:T,weeksCount:k})});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const b=await c.json();if(b.error)throw new Error(b.error_description||b.error||"Unknown error");return ge(b)}catch(c){throw console.error("[TimeTrackingService] Error fetching time tracking data:",c),c}}async function we({taskIds:s,employeeId:_,weekNumber:a,page:T=1,perPage:k=10}){if(!s||!Array.isArray(s)||s.length===0)return{tasks:[],pagination:{totalTasks:0,currentPage:1,perPage:k,totalPages:0}};try{const c=await fetch(ce,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:"1C",includeTaskDetails:!0,taskIds:s,employeeId:_||void 0,weekNumber:a||void 0,page:T,perPage:k})});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const b=await c.json();if(!b.success)throw new Error(b.error||b.error_description||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–¥–∞—á–∞—Ö");return{tasks:b.data.tasks||[],pagination:b.data.pagination||{totalTasks:0,currentPage:1,perPage:k,totalPages:0}}}catch(c){throw console.error("[timeTrackingService] Error loading tasks details:",c),c}}const de={getTimeTrackingData:fe,getTasksDetails:we};function P(s,_=1){return typeof s!="number"||isNaN(s)?"0 —á":`${s.toFixed(_)} —á`}function ee(s,_){if(!s||!_)return`–ù–µ–¥–µ–ª—è ${s||"?"}`;try{const a=new Date(_),T=new Date(a);T.setDate(T.getDate()+6);const k=a.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}),c=T.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"});return`–ù–µ–¥–µ–ª—è ${s} (${k} - ${c})`}catch(a){return console.error("[TimeTrackingUtils] Error formatting week label:",a),`–ù–µ–¥–µ–ª—è ${s}`}}function Te(s){return!s||!s.data?!1:s.data.totalRecordsCount>0||s.data.weeks&&s.data.weeks.length>0}const he={class:"ttt-summary"},De={class:"summary-cards"},$e={class:"summary-card summary-card--total"},Ce={class:"summary-card__content"},Ne={class:"summary-card__value"},Pe={class:"summary-card summary-card--employees"},Ee={class:"summary-card__content"},Se={class:"summary-card__value"},Ue={class:"summary-card summary-card--average"},We={class:"summary-card__content"},Me={class:"summary-card__value"},xe={__name:"TicketsTimeTrackingSummary",props:{data:{type:Object,required:!0}},setup(s){const _=s,a=N(()=>{var g,v;return((v=(g=_.data)==null?void 0:g.data)==null?void 0:v.totalElapsedTime)||0}),T=N(()=>{var g,v;return((v=(g=_.data)==null?void 0:g.meta)==null?void 0:v.sector1CEmployeesCount)||0}),k=N(()=>{const g=a.value,v=T.value;return v>0?g/v:0}),c=N(()=>a.value===0?"0.0 —á":P(a.value,1)),b=N(()=>k.value===0?"0.00 —á":P(k.value,2));return(g,v)=>(o(),r("div",he,[e("div",De,[e("div",$e,[v[1]||(v[1]=e("div",{class:"summary-card__icon"},"‚è±",-1)),e("div",Ce,[v[0]||(v[0]=e("div",{class:"summary-card__label"},"–û–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç",-1)),e("div",Ne,i(c.value),1)])]),e("div",Pe,[v[3]||(v[3]=e("div",{class:"summary-card__icon"},"üë•",-1)),e("div",Ee,[v[2]||(v[2]=e("div",{class:"summary-card__label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ —Å–µ–∫—Ç–æ—Ä–µ",-1)),e("div",Se,i(T.value),1)])]),e("div",Ue,[v[5]||(v[5]=e("div",{class:"summary-card__icon"},"üìä",-1)),e("div",We,[v[4]||(v[4]=e("div",{class:"summary-card__label"},"–°—Ä–µ–¥–Ω—è—è –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞",-1)),e("div",Me,i(b.value),1)])])])]))}},Le=ae(xe,[["__scopeId","data-v-51b124c7"]]),Ie={class:"ttt-table-container"},je={key:0,class:"ttt-table-loading"},Oe={key:1,class:"ttt-table-error"},Re={key:2,class:"ttt-table-empty"},Ae={key:3,class:"ttt-table-wrapper"},Be={class:"ttt-table"},Ve=["onClick"],Fe={class:"ttt-table__header-week-date"},qe=["onClick"],ze={class:"ttt-table__cell-employee"},He=["onClick"],Ge={class:"ttt-table__cell-total"},Je={class:"ttt-table__row-total"},Ke=["onClick"],Qe={class:"ttt-table__cell-total"},Xe={__name:"TicketsTimeTrackingTable",props:{data:{type:Object,required:!0},loading:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["cell-click","employee-click","week-click"],setup(s,{emit:_}){const a=s,T=_,k=N(()=>{var w,d;return((d=(w=a.data)==null?void 0:w.data)==null?void 0:d.weeks)||[]}),c=N(()=>{if(!a.data||!a.data.data||!a.data.data.weeks)return null;const w=a.data.data.weeks||[],m=(a.data.data.employeesSummary||[]).map(u=>{const E={};let x=0;return w.forEach(O=>{var X;const K=(X=O.employees)==null?void 0:X.find(Y=>Y.id===u.id),Q=(K==null?void 0:K.elapsedTime)||0;E[O.weekNumber]=Q,x+=Q}),{id:u.id,name:u.name,weeks:E,total:x}}),y={};let D=0;return w.forEach(u=>{y[u.weekNumber]=u.totalElapsedTime||0,D+=u.totalElapsedTime||0}),{employees:m,weekTotals:y,grandTotal:D}}),b=(w,d)=>{var y;const m=(y=c.value)==null?void 0:y.employees.find(D=>D.id===w);return(m==null?void 0:m.weeks[d])||0},g=w=>{var d;return((d=c.value)==null?void 0:d.weekTotals[w])||0},v=w=>{if(!w)return"";try{return new Date(w).toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}catch{return""}},G=(w,d)=>{var D,u,E,x;const m=(D=c.value)==null?void 0:D.employees.find(O=>O.id===w),y=(x=(E=(u=a.data)==null?void 0:u.data)==null?void 0:E.weeks)==null?void 0:x.find(O=>O.weekNumber===d);m&&y&&T("cell-click",{employee:m,week:y,elapsedTime:b(w,d)})},J=w=>{var m;const d=(m=c.value)==null?void 0:m.employees.find(y=>y.id===w);d&&T("employee-click",{employee:d,weeks:k.value.map(y=>({week:y,elapsedTime:b(w,y.weekNumber)}))})},F=w=>{var m;const d=k.value.find(y=>y.weekNumber===w);d&&T("week-click",{week:d,employees:(m=c.value)==null?void 0:m.employees.map(y=>({employee:y,elapsedTime:b(y.id,w)})).filter(y=>y.elapsedTime>0)})};return(w,d)=>(o(),r("div",Ie,[s.loading?(o(),r("div",je," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):s.error?(o(),r("div",Oe,i(s.error),1)):!c.value||c.value.employees.length===0?(o(),r("div",Re," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ")):(o(),r("div",Ae,[e("table",Be,[e("thead",null,[e("tr",null,[d[1]||(d[1]=e("th",{class:"ttt-table__header-employee"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",-1)),(o(!0),r(I,null,j(k.value,m=>(o(),r("th",{key:m.weekNumber,class:q(["ttt-table__header-week",{"ttt-table__header--clickable":!0}]),onClick:y=>F(m.weekNumber)},[S(" –ù–µ–¥–µ–ª—è "+i(m.weekNumber),1),d[0]||(d[0]=e("br",null,null,-1)),e("span",Fe,i(v(m.weekStartUtc)),1)],8,Ve))),128)),d[2]||(d[2]=e("th",{class:"ttt-table__header-total"},"–ò—Ç–æ–≥–æ",-1))])]),e("tbody",null,[(o(!0),r(I,null,j(c.value.employees,m=>(o(),r("tr",{key:m.id,class:q(["ttt-table__row",{"ttt-table__row--clickable":!0}]),onClick:y=>J(m.id)},[e("td",ze,i(m.name),1),(o(!0),r(I,null,j(k.value,y=>(o(),r("td",{key:`${m.id}-${y.weekNumber}`,class:q(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:oe(D=>G(m.id,y.weekNumber),["stop"])},i(M(P)(b(m.id,y.weekNumber))),9,He))),128)),e("td",Ge,[e("strong",null,i(M(P)(m.total)),1)])],8,qe))),128)),e("tr",Je,[d[3]||(d[3]=e("td",{class:"ttt-table__cell-employee"},[e("strong",null,"–í–°–ï–ì–û")],-1)),(o(!0),r(I,null,j(k.value,m=>(o(),r("td",{key:`total-${m.weekNumber}`,class:q(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:y=>F(m.weekNumber)},[e("strong",null,i(M(P)(g(m.weekNumber))),1)],8,Ke))),128)),e("td",Qe,[e("strong",null,i(M(P)(c.value.grandTotal)),1)])])])])]))]))}},Ye=ae(Xe,[["__scopeId","data-v-8021e5e4"]]),Ze={class:"modal-header"},et={class:"modal-body"},tt={key:"level-1",class:"detail-cell"},at={class:"detail-info"},st={key:0,class:"tasks-list"},lt={class:"task-header"},nt={class:"task-label"},ot={class:"task-time"},it={key:0,class:"ticket-info"},rt={class:"ticket-label"},ct=["title"],dt={key:1,class:"ticket-title"},ut={key:1,class:"ticket-info ticket-info--no-ticket"},mt={class:"detail-total"},kt={key:0,class:"detail-actions"},vt={key:"level-2",class:"tasks-list-level"},pt={class:"tasks-list-header"},yt={class:"tasks-list-title"},_t={class:"tasks-list-content"},bt={key:"loading",class:"loading-state"},gt={key:"error",class:"error-state"},ft={class:"error-message"},wt={key:"empty",class:"empty-state"},Tt={key:"tasks",class:"tasks-cards-container"},ht=["onClick"],Dt={class:"task-card__header"},$t={class:"task-card__number"},Ct={key:0,class:"task-card__time"},Nt={class:"task-card__title"},Pt={class:"task-card__dates"},Et={class:"task-card__date-item"},St={class:"date-value"},Ut={class:"task-card__date-item"},Wt={class:"task-card__date-item"},Mt={class:"date-value"},xt={key:0,class:"task-card__ticket"},Lt={class:"ticket-header"},It={class:"ticket-header__left"},jt={class:"ticket-id"},Ot=["title"],Rt={class:"ticket-title"},At={class:"ticket-meta"},Bt={class:"ticket-meta__row"},Vt={class:"ticket-meta__item"},Ft={class:"meta-value"},qt={class:"ticket-meta__item"},zt={class:"meta-value"},Ht={class:"ticket-meta__row"},Gt={class:"ticket-meta__item"},Jt={class:"meta-value"},Kt={class:"ticket-meta__item"},Qt={class:"meta-value"},Xt={class:"ticket-dates"},Yt={class:"ticket-date-item"},Zt={class:"date-value"},ea={key:1,class:"task-card__no-ticket"},ta={key:0,class:"tasks-pagination"},aa=["disabled"],sa={class:"pagination-pages"},la=["onClick"],na=["disabled"],oa={key:"employee",class:"detail-employee"},ia={class:"detail-info"},ra={class:"weeks-list"},ca={class:"week-header"},da={class:"week-label"},ua={class:"week-time"},ma={key:"week",class:"detail-week"},ka={class:"detail-info"},va={class:"employees-list"},pa={class:"employee-header"},ya={class:"employee-label"},_a={class:"employee-time"},ba={__name:"TimeTrackingDetailModal",props:{cellData:{type:Object,default:null}},emits:["close"],setup(s,{emit:_}){const a=s,T=_,k=W(1),c=W([]),b=W(!1),g=W(null),v=W(1),G=W(10),J=N(()=>{var C,$,R,A,B,V;if(!a.cellData)return"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç";if(k.value===2)return`–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: ${((C=a.cellData.employee)==null?void 0:C.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}, –ù–µ–¥–µ–ª—è ${(($=a.cellData.week)==null?void 0:$.weekNumber)||"?"}`;if(a.cellData.type==="employee")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${((R=a.cellData.employee)==null?void 0:R.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}`;if(a.cellData.type==="week")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: –ù–µ–¥–µ–ª—è ${((A=a.cellData.week)==null?void 0:A.weekNumber)||"?"}`;const l=((B=a.cellData.employee)==null?void 0:B.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",t=((V=a.cellData.week)==null?void 0:V.weekNumber)||"?",p=P(a.cellData.elapsedTime||0);return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${l}, –ù–µ–¥–µ–ª—è ${t} (${p})`}),F=N(()=>{var t,p;if(!((p=(t=a.cellData)==null?void 0:t.week)!=null&&p.employees))return 0;const l=a.cellData.week.employees.find(C=>{var $;return C.id===(($=a.cellData.employee)==null?void 0:$.id)});return(l==null?void 0:l.tasksCount)||0}),w=N(()=>{var t,p;if(!((p=(t=a.cellData)==null?void 0:t.week)!=null&&p.employees))return 0;const l=a.cellData.week.employees.find(C=>{var $;return C.id===(($=a.cellData.employee)==null?void 0:$.id)});return(l==null?void 0:l.ticketsCount)||0});N(()=>{var l,t;return((t=(l=a.cellData)==null?void 0:l.week)==null?void 0:t.weekNumber)||null});const d=W({totalTasks:0,currentPage:1,perPage:10,totalPages:0}),m=N(()=>d.value.totalPages),y=N(()=>c.value),D=N(()=>{const l=[];let p=Math.max(1,d.value.currentPage-Math.floor(2.5)),C=Math.min(m.value,p+5-1);C-p<4&&(p=Math.max(1,C-5+1));for(let $=p;$<=C;$++)l.push($);return l}),u=l=>{if(!l||l.length===0)return"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω";if(l.length===1)return ee(l[0].week.weekNumber,l[0].week.weekStartUtc);const t=l[0].week,p=l[l.length-1].week;return`${ee(t.weekNumber,t.weekStartUtc)} - ${ee(p.weekNumber,p.weekStartUtc)}`},E=l=>l?ee(l.weekNumber,l.weekStartUtc):"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω",x=l=>{if(!l)return"-";try{const t=new Date(l);return isNaN(t.getTime())?"-":t.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return console.warn("[TimeTrackingDetailModal] Error formatting date:",l,t),"-"}},O=(l,t)=>{if(t)try{const p=new Date(t);if(!isNaN(p.getTime()))return!1}catch{}if(!l)return!1;try{const p=new Date(l);return isNaN(p.getTime())?!1:new Date>p}catch(p){return console.warn("[TimeTrackingDetailModal] Error checking overdue:",l,p),!1}},K=l=>{const t=l.closedDate?new Date(l.closedDate):null,p=O(l.deadline,l.closedDate);return{"task-card--completed":!!t,"task-card--overdue":p,"task-card--in-progress":!t&&!p}},Q=async()=>{k.value=2,await se()},X=()=>{k.value=1,c.value=[],g.value=null,v.value=1,d.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0}},Y=l=>!l||typeof l!="object"?!1:!l.id||typeof l.id!="number"?(console.warn("[TimeTrackingDetailModal] Invalid task (no ID):",l),!1):!0,se=async()=>{var l,t,p,C,$,R,A,B,V;if(!((t=(l=a.cellData)==null?void 0:l.week)!=null&&t.employees)||!a.cellData.employee){g.value="–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á";return}b.value=!0,g.value=null;try{const L=a.cellData.week.employees.find(h=>{var ne;return h.id===((ne=a.cellData.employee)==null?void 0:ne.id)});if(!L){c.value=[];return}let n=[];if(Array.isArray(L.tasks)&&L.tasks.length>0&&(n=L.tasks.map(h=>typeof h=="object"&&h!==null&&h.id?h.id:typeof h=="number"?h:null).filter(h=>h!==null&&h>0)),n.length===0){c.value=[];return}const f=await de.getTasksDetails({taskIds:n,employeeId:a.cellData.employee.id,weekNumber:a.cellData.week.weekNumber,page:v.value,perPage:G.value});if(!f||!Array.isArray(f.tasks)){console.error("[TimeTrackingDetailModal] Invalid response format:",f),g.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞",c.value=[];return}c.value=f.tasks.filter(Y),d.value=f.pagination||{totalTasks:0,currentPage:1,perPage:G.value,totalPages:0},v.value=d.value.currentPage}catch(L){console.error("[TimeTrackingDetailModal] Error loading tasks details:",{error:L,taskIds:((A=(R=($=(C=(p=a.cellData)==null?void 0:p.week)==null?void 0:C.employees)==null?void 0:$.find(f=>{var h;return f.id===((h=a.cellData.employee)==null?void 0:h.id)}))==null?void 0:R.tasks)==null?void 0:A.map(f=>f.id))||[],employeeId:(B=a.cellData.employee)==null?void 0:B.id,weekNumber:(V=a.cellData.week)==null?void 0:V.weekNumber,timestamp:new Date().toISOString()});const n=L.message||"";n.includes("network")||n.includes("fetch")||n.includes("Failed to fetch")?g.value="–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.":n.includes("timeout")?g.value="–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":n.includes("403")||n.includes("401")?g.value="–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.":n.includes("404")?g.value="–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.":n.includes("500")?g.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":g.value=n||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á",c.value=[]}finally{b.value=!1}},ue=()=>{v.value=1,se()};re(v,()=>{k.value===2&&se()});const le=l=>{if(l>=1&&l<=m.value&&l!==v.value){v.value=l;const t=document.querySelector(".tasks-cards-container");t&&(t.scrollTop=0)}},me=l=>{console.log("[TimeTrackingDetailModal] Task clicked:",l.id)},Z=()=>{T("close")};return re(()=>a.cellData,l=>{l||(k.value=1,c.value=[],g.value=null,v.value=1,d.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0})}),(l,t)=>(o(),te(pe,{to:"body"},[s.cellData?(o(),r("div",{key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:oe(Z,["self"]),onKeydown:ve(Z,["esc"])},[e("div",{class:"modal-content",onClick:t[2]||(t[2]=oe(()=>{},["stop"]))},[e("div",Ze,[e("h2",null,i(J.value),1),e("button",{class:"close-button",onClick:Z,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),e("div",et,[z(ie,{name:"level",mode:"out-in"},{default:H(()=>{var p,C,$,R,A,B,V,L;return[k.value===1&&(s.cellData.type==="cell"||!s.cellData.type&&s.cellData.employee&&s.cellData.week)?(o(),r("div",tt,[e("div",at,[e("p",null,[t[3]||(t[3]=e("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),S(" "+i(((p=s.cellData.employee)==null?void 0:p.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),S(" "+i(((C=s.cellData.week)==null?void 0:C.weekNumber)||"?"),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),S(" "+i(M(P)(s.cellData.elapsedTime||0)),1)])]),($=s.cellData.week)!=null&&$.employees?(o(),r("div",st,[t[8]||(t[8]=e("h3",null,"–ó–∞–¥–∞—á–∏ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã:",-1)),(o(!0),r(I,null,j(s.cellData.week.employees.filter(n=>{var f;return n.id===((f=s.cellData.employee)==null?void 0:f.id)}),n=>(o(),r("div",{key:n.id,class:"employee-tasks"},[(o(!0),r(I,null,j(n.tasks,(f,h)=>(o(),r("div",{class:"task-item",key:h},[e("div",lt,[e("span",nt,"–ó–∞–¥–∞—á–∞ #"+i(f.id||h+1),1),e("span",ot,i(M(P)(f.elapsedTime||0)),1)]),f.ticket?(o(),r("div",it,[e("span",rt,"–¢–∏–∫–µ—Ç #"+i(f.ticket.id),1),f.ticket.createdWeek&&f.ticket.createdWeek!==s.cellData.week.weekNumber?(o(),r("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${f.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${s.cellData.week.weekNumber}`}," (—Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ "+i(f.ticket.createdWeek)+") ",9,ct)):U("",!0),f.ticket.title?(o(),r("div",dt,i(f.ticket.title),1)):U("",!0)])):(o(),r("div",ut,[...t[6]||(t[6]=[e("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])]))]))),128))]))),128)),e("div",mt,[e("p",null,[t[7]||(t[7]=e("strong",null,"–ò—Ç–æ–≥–æ:",-1)),S(" "+i(M(P)(s.cellData.elapsedTime||0))+" ("+i(F.value)+" –∑–∞–¥–∞—á, "+i(w.value)+" —Ç–∏–∫–µ—Ç–æ–≤) ",1)])]),F.value>0?(o(),r("div",kt,[e("button",{class:"btn btn-primary btn-tasks-list",onClick:Q}," üìã –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á ")])):U("",!0)])):U("",!0)])):k.value===2?(o(),r("div",vt,[e("div",pt,[e("button",{class:"btn-back",onClick:X,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê –ù–∞–∑–∞–¥ "),e("h3",yt," –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: "+i(((R=s.cellData.employee)==null?void 0:R.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫")+", –ù–µ–¥–µ–ª—è "+i(((A=s.cellData.week)==null?void 0:A.weekNumber)||"?"),1)]),e("div",_t,[z(ie,{name:"loading",mode:"out-in"},{default:H(()=>[b.value?(o(),r("div",bt,[...t[9]||(t[9]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...",-1)])])):g.value?(o(),r("div",gt,[t[10]||(t[10]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),t[11]||(t[11]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",ft,i(g.value),1),e("button",{class:"btn btn-retry",onClick:ue},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):c.value.length===0?(o(),r("div",wt,[...t[12]||(t[12]=[e("div",{class:"empty-state-icon"},"üìã",-1),e("p",{class:"empty-state-message"},"–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)])])):(o(),r("div",Tt,[z(ke,{name:"task-card",tag:"div",class:"tasks-cards-list"},{default:H(()=>[(o(!0),r(I,null,j(y.value.filter(Y),n=>{var f,h;return o(),r("div",{key:n.id,class:q(["task-card",K(n)]),onClick:ne=>me(n)},[e("div",Dt,[e("span",$t,"–ó–∞–¥–∞—á–∞ #"+i(n.id),1),n.elapsedTime?(o(),r("span",Ct,i(M(P)(n.elapsedTime)),1)):U("",!0)]),e("div",Nt,i(n.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),e("div",Pt,[e("div",Et,[t[13]||(t[13]=e("span",{class:"date-icon"},"üìÖ",-1)),t[14]||(t[14]=e("span",{class:"date-label"},"–ù–∞—á–∞–ª–æ:",-1)),e("span",St,i(x(n.startDate)),1)]),e("div",Ut,[t[15]||(t[15]=e("span",{class:"date-icon"},"‚è∞",-1)),t[16]||(t[16]=e("span",{class:"date-label"},"–î–µ–¥–ª–∞–π–Ω:",-1)),e("span",{class:q(["date-value",{"date-value--overdue":O(n.deadline,n.closedDate)}])},i(x(n.deadline)||"-"),3)]),e("div",Wt,[t[17]||(t[17]=e("span",{class:"date-icon"},"‚úì",-1)),t[18]||(t[18]=e("span",{class:"date-label"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ:",-1)),e("span",Mt,i(x(n.closedDate)||"-"),1)])]),n.ticket?(o(),r("div",xt,[e("div",Lt,[e("div",It,[e("span",jt,"–¢–∏–∫–µ—Ç #"+i(n.ticket.id),1),n.ticket.createdWeek&&n.ticket.createdWeek!==((f=s.cellData.week)==null?void 0:f.weekNumber)?(o(),r("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${n.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${(h=s.cellData.week)==null?void 0:h.weekNumber}`}," –°–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥. "+i(n.ticket.createdWeek),9,Ot)):U("",!0)])]),e("div",Rt,i(n.ticket.title||n.ticket.ufSubject||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),e("div",At,[e("div",Bt,[e("div",Vt,[t[19]||(t[19]=e("span",{class:"meta-label"},"–°–µ–∫—Ç–æ—Ä:",-1)),e("span",Ft,i(n.ticket.ufSlaBlockStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)]),e("div",qt,[t[20]||(t[20]=e("span",{class:"meta-label"},"–°–µ—Ä–≤–∏—Å:",-1)),e("span",zt,i(n.ticket.ufSlaServiceStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])]),e("div",Ht,[e("div",Gt,[t[21]||(t[21]=e("span",{class:"meta-label"},"–î–µ–π—Å—Ç–≤–∏–µ:",-1)),e("span",Jt,i(n.ticket.ufActionStr||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),1)]),e("div",Kt,[t[22]||(t[22]=e("span",{class:"meta-label"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:",-1)),e("span",Qt,i(n.ticket.ufCrm7UfPriority||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])])]),e("div",Xt,[e("div",Yt,[t[23]||(t[23]=e("span",{class:"date-icon"},"üìÖ",-1)),t[24]||(t[24]=e("span",{class:"date-label"},"–°–æ–∑–¥–∞–Ω:",-1)),e("span",Zt,i(x(n.ticket.createdTime)),1)])])])):(o(),r("div",ea,[...t[25]||(t[25]=[e("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])])),t[26]||(t[26]=e("div",{class:"task-card__status-placeholder"},null,-1))],10,ht)}),128))]),_:1}),m.value>1?(o(),r("div",ta,[e("button",{class:"pagination-btn",disabled:d.value.currentPage===1,onClick:t[0]||(t[0]=n=>le(d.value.currentPage-1))}," ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,aa),e("div",sa,[(o(!0),r(I,null,j(D.value,n=>(o(),r("button",{key:n,class:q(["pagination-page",{"pagination-page--active":n===d.value.currentPage}]),onClick:f=>le(n)},i(n),11,la))),128))]),e("button",{class:"pagination-btn",disabled:d.value.currentPage===m.value,onClick:t[1]||(t[1]=n=>le(d.value.currentPage+1))}," –°–ª–µ–¥—É—é—â–∞—è ‚Üí ",8,na)])):U("",!0)]))]),_:1})])])):k.value===1&&s.cellData.type==="employee"?(o(),r("div",oa,[e("div",ia,[e("p",null,[t[27]||(t[27]=e("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),S(" "+i(((B=s.cellData.employee)==null?void 0:B.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),e("p",null,[t[28]||(t[28]=e("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),S(" "+i(u(s.cellData.weeks)),1)])]),e("div",ra,[t[29]||(t[29]=e("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –Ω–µ–¥–µ–ª—è–º:",-1)),(o(!0),r(I,null,j(s.cellData.weeks,n=>(o(),r("div",{key:n.week.weekNumber,class:"week-item"},[e("div",ca,[e("span",da,"–ù–µ–¥–µ–ª—è "+i(n.week.weekNumber),1),e("span",ua,i(M(P)(n.elapsedTime||0)),1)])]))),128))])])):k.value===1&&s.cellData.type==="week"?(o(),r("div",ma,[e("div",ka,[e("p",null,[t[30]||(t[30]=e("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),S(" "+i(((V=s.cellData.week)==null?void 0:V.weekNumber)||"?"),1)]),e("p",null,[t[31]||(t[31]=e("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),S(" "+i(E(s.cellData.week)),1)]),e("p",null,[t[32]||(t[32]=e("strong",null,"–û–±—â–∏–µ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),S(" "+i(M(P)(((L=s.cellData.week)==null?void 0:L.totalElapsedTime)||0)),1)])]),e("div",va,[t[33]||(t[33]=e("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:",-1)),(o(!0),r(I,null,j(s.cellData.employees,n=>(o(),r("div",{key:n.employee.id,class:"employee-item"},[e("div",pa,[e("span",ya,i(n.employee.name),1),e("span",_a,i(M(P)(n.elapsedTime||0)),1)])]))),128))])])):U("",!0)]}),_:1})]),e("div",{class:"modal-footer"},[e("button",{class:"close-btn",onClick:Z},"–ó–∞–∫—Ä—ã—Ç—å")])])],32)):U("",!0)]))}},ga=ae(ba,[["__scopeId","data-v-fc33390b"]]),fa={class:"tickets-time-tracking-dashboard"},wa={class:"dashboard-header"},Ta={class:"breadcrumbs-row"},ha=["aria-label","aria-disabled","data-fallback","disabled"],Da={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},$a={key:"preloader",class:"time-tracking-preloader"},Ca={key:"error",class:"error-state"},Na={key:"empty",class:"empty-state"},Pa={key:"content",class:"dashboard-content"},Ea={__name:"TicketsTimeTrackingDashboard",setup(s){const _=_e(),a=W(!0),T=W(null),k=W(null),c=W(null),b=W(!1),g=N(()=>Te(k.value)),v=async()=>{a.value=!0,T.value=null;const D=new Promise(u=>setTimeout(u,300));try{const[u,E]=await Promise.all([D,de.getTimeTrackingData({product:"1C",weeksCount:4})]);k.value=E}catch(u){console.error("[TicketsTimeTrackingDashboard] Error loading data:",u),T.value=u.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}finally{a.value=!1}},G=D=>{c.value=D},J=D=>{c.value={type:"employee",...D}},F=D=>{c.value={type:"week",...D}},w=()=>{c.value=null},d=N(()=>typeof window>"u"?!1:window.history.length>1),m=N(()=>d.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"),y=()=>{b.value||(b.value=!0,d.value?_.go(-1):_.push({name:"dashboard-sector-1c"}),setTimeout(()=>{b.value=!1},300))};return ye(()=>{v()}),(D,u)=>{const E=be("router-link");return o(),r("div",fa,[e("div",wa,[e("div",Ta,[e("button",{class:"btn-back-link",type:"button",onClick:y,"aria-label":m.value,"aria-disabled":!d.value,"data-fallback":!d.value,disabled:b.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,ha),e("nav",Da,[z(E,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:H(()=>[...u[0]||(u[0]=[S(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),u[3]||(u[3]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),z(E,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:H(()=>[...u[1]||(u[1]=[S(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),u[4]||(u[4]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),z(E,{to:{name:"dashboard-graph-admission-closure"},class:"breadcrumb-link"},{default:H(()=>[...u[2]||(u[2]=[S(" –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π ",-1)])]),_:1}),u[5]||(u[5]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),u[6]||(u[6]=e("span",{class:"breadcrumb-current"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã",-1))])])]),u[9]||(u[9]=e("h1",{class:"dashboard-title"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),U("",!0),z(ie,{name:"fade",mode:"out-in"},{default:H(()=>[a.value?(o(),r("div",$a,[...u[7]||(u[7]=[e("div",{class:"preloader-content"},[e("div",{class:"preloader-spinner"},[e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"})]),e("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"),e("p",{class:"preloader-message"},"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö..."),e("div",{class:"preloader-dots"},[e("span",{class:"dot"}),e("span",{class:"dot"}),e("span",{class:"dot"})])],-1)])])):T.value?(o(),r("div",Ca,[e("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: "+i(T.value),1),e("button",{onClick:v,class:"retry-button"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):g.value?(o(),r("div",Pa,[k.value?(o(),te(Le,{key:0,data:k.value},null,8,["data"])):U("",!0),k.value?(o(),te(Ye,{key:1,data:k.value,loading:a.value,error:T.value,onCellClick:G,onEmployeeClick:J,onWeekClick:F},null,8,["data","loading","error"])):U("",!0)])):(o(),r("div",Na,[...u[8]||(u[8]=[e("p",null,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])]))]),_:1}),c.value?(o(),te(ga,{key:1,"cell-data":c.value,onClose:w},null,8,["cell-data"])):U("",!0)])}}},Ua=ae(Ea,[["__scopeId","data-v-f9084975"]]);export{Ua as default};
