const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./chunk-yvHyt3PJ.js","./chunk-CnxGu6FV.js","./chunk-DLGChJIe.js","./chunk-D3JwNzSL.js","./chunk-Dv0idwub.js","./direct-access-config-DgF6_hzD.js","./access-config-async-BlO8P_3_.js","./chunk-BxL3V5Fo.js","./WebhookLogsDashboard.vue-7HhDWJ3Q.js","./WebhookLogDetails.vue-ff5_m9p3.js","./SectorDashboardPDM.vue-DeaOFmgC.js","./SectorDashboardBitrix24.vue-M63GU2uU.js","./SectorDashboardInfrastructure.vue-CennPVwE.js"])))=>i.map(i=>d[i]);
var Ga=Object.defineProperty;var Ka=(o,e,s)=>e in o?Ga(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var je=(o,e,s)=>Ka(o,typeof e!="symbol"?e+"":e,s);import{r as be,c as u,o as c,a as ne,b as A,d as ha,t as m,n as X,e as a,f as he,g as I,h as $e,u as Xe,i as ks,j as M,w as pe,T as Ae,F as ee,k as te,l as we,m as ce,p as Ce,q as Ue,s as Ne,v as Qe,x as Be,y as It,C as Je,z as qa,L as Ya,P as Xa,A as Ja,B as Za,D as Qa,E as eo,G as to,H as so,I as ao,J as Re,K as Et,M as _t,N as wt,O as yt,Q as fa,R as va,S as st,U as At,V as Wt,W as pa,X as Cs,Y as ls,Z as Xs,_ as oo,$ as bs,a0 as dt,a1 as no,a2 as ya,a3 as ro,a4 as io,a5 as lo}from"./chunk-BxL3V5Fo.js";import{a as ka,_ as Se,g as et,b as co,f as Ft}from"./chunk-Dv0idwub.js";import{C as Js}from"./chunk-DLGChJIe.js";import{i as uo,S as Jt,m as Zt,a as Bs,g as Ps,b as ba,c as go,d as Zs,E as mo,e as Ts,f as Ss,h as ss,p as Qs,j as ho,k as fo,D as vo,l as po,n as ea,o as ta,T as yo,q as sa,r as ko}from"./chunk-yvHyt3PJ.js";import{D as vt}from"./chunk-CnxGu6FV.js";import{L as bo}from"./chunk-D3JwNzSL.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();const de=(o,e)=>{const s=o.__vccOpts||o;for(const[t,r]of e)s[t]=r;return s},_o={name:"App"},wo={id:"app"};function Co(o,e,s,t,r,i){const n=be("router-view");return c(),u("div",wo,[ne(n)])}const To=de(_o,[["render",Co]]),So={name:"StatusMessage",props:{type:{type:String,required:!0,validator:o=>["success","error","info","warning"].includes(o)},title:{type:String,default:null},message:{type:String,default:null}}},Do={key:0},Eo={key:1};function Ao(o,e,s,t,r,i){return c(),u("div",{class:X(["status-message",`status-message--${s.type}`])},[s.title?(c(),u("strong",Do,m(s.title),1)):A("",!0),s.message?(c(),u("p",Eo,m(s.message),1)):A("",!0),ha(o.$slots,"default",{},void 0)],2)}const _s=de(So,[["render",Ao],["__scopeId","data-v-7f15d2d7"]]),$o={name:"LoadingSpinner",props:{message:{type:String,default:"–ó–∞–≥—Ä—É–∑–∫–∞..."}}},Io={class:"loading-spinner"},Mo={key:0,class:"message"};function No(o,e,s,t,r,i){return c(),u("div",Io,[e[0]||(e[0]=a("div",{class:"spinner"},null,-1)),s.message?(c(),u("p",Mo,m(s.message),1)):A("",!0)])}const ws=de($o,[["render",No],["__scopeId","data-v-375eac16"]]);function Rt(){try{if(window.self===window.top)return!1;if(typeof BX24<"u")return!0;try{const o=window.parent.location.origin;return o.includes("bitrix24")||o.includes("kompo.by")}catch{return!1}}catch(o){return console.warn("Error checking Bitrix24 context:",o),!1}}function xo(){return typeof BX24<"u"}class kt{static init(e){return new Promise((s,t)=>{if(!Rt()){console.log("Not inside Bitrix24, skipping BX24.init()"),e&&e(),s();return}if(typeof BX24>"u"){t(new Error("Bitrix24 API not loaded. Make sure script is included: //api.bitrix24.com/api/v1/"));return}const r=setTimeout(()=>{t(new Error("BX24.init() timeout: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥"))},5e3);try{BX24.init(()=>{clearTimeout(r),e&&e(),s()})}catch(i){clearTimeout(r),t(i)}})}static installFinish(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}try{BX24.installFinish(),e()}catch(t){s(t)}})}static callMethod(e,s={}){return new Promise((t,r)=>{if(typeof BX24>"u"){r(new Error("Bitrix24 API not loaded"));return}const i=setTimeout(()=>{r(new Error(`BX24.callMethod(${e}) timeout: –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—ã—Å–∏–ª 10 —Å–µ–∫—É–Ω–¥`))},1e4);try{BX24.callMethod(e,s,n=>{if(clearTimeout(i),n.error()){const l=n.error();r(new Error(l.error_description||l.error||"Unknown error"))}else t(n.data())})}catch(n){clearTimeout(i),r(n)}})}static async getCurrentUser(){if(Rt()&&xo())try{const e=await Promise.race([this.callMethod("user.current",{}),new Promise((s,t)=>setTimeout(()=>t(new Error("Timeout")),5e3))]);return console.log("Got user from BX24.callMethod() (interface user):",e?.ID||"unknown"),e}catch(e){console.warn("BX24.callMethod() failed, using proxy API as fallback:",e);try{const t=await new Js().getCurrentUser();return console.log("Got user from proxy API (token owner, fallback):",t),t}catch(s){throw console.error("Both BX24 API and proxy API failed:",s),e.message&&e.message.includes("timeout")?new Error("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Bitrix24 API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç."):new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}else return console.warn("Not inside Bitrix24, using proxy API (will return token owner, not interface user)"),await new Js().getCurrentUser()}static getUser(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}if(typeof BX24.getUser!="function"){s(new Error("BX24.getUser is not available"));return}BX24.getUser(t=>{e(t)})})}static getAuth(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}BX24.getAuth(t=>{e(t)})})}}const Lo={name:"InstallPage",components:{StatusMessage:_s,LoadingSpinner:ws},setup(){const o=I(!0),e=I(null),s=I(null);return $e(async()=>{try{let t=null;if(window.INSTALL_RESULT)t=window.INSTALL_RESULT;else{const r=ka("/install.php"),i=await fetch(`${r}?get_result=1`);i.ok&&(t=await i.json())}if(!t)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏");if(s.value=t,t.rest_only===!1)if(t.install===!0){e.value={type:"success",title:"‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!",message:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24."};try{await kt.init(()=>{kt.installFinish()})}catch(r){console.error("Error finishing installation:",r)}}else e.value={type:"error",title:"‚úó –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."};else e.value={type:"info",title:"REST-only —Ä–µ–∂–∏–º",message:"–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ REST API, –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."}}catch(t){console.error("Error loading install result:",t),e.value={type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ."}}finally{o.value=!1}}),{loading:o,installStatus:e,installInfo:s}}},Po={class:"install-page"},Oo={class:"container"},Ro={key:1,class:"info"};function Bo(o,e,s,t,r,i){const n=be("StatusMessage"),l=be("LoadingSpinner");return c(),u("div",Po,[a("div",Oo,[e[1]||(e[1]=a("h1",null,"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1)),t.installStatus?(c(),he(n,{key:0,type:t.installStatus.type,title:t.installStatus.title,message:t.installStatus.message},null,8,["type","title","message"])):A("",!0),t.installInfo?(c(),u("div",Ro,[e[0]||(e[0]=a("h3",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:",-1)),a("pre",null,m(JSON.stringify(t.installInfo,null,2)),1)])):A("",!0),t.loading?(c(),he(l,{key:2,message:"–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."})):A("",!0)])])}const Uo=de(Lo,[["render",Bo],["__scopeId","data-v-d082ec9e"]]);function Wo(){const o=Xe(),e=ks();return{goBack:(n="/")=>{window.history.length>1?o.back():o.push(n)},goTo:(n,l={})=>{o.push({path:n,...l})},goHome:(n={})=>{o.push({path:"/",...n})},isCurrentRoute:n=>e.path===n,router:o,route:e}}const Fo={name:"BackButton",props:{variant:{type:String,default:"header",validator:o=>["header","floating"].includes(o)},text:{type:String,default:"–ù–ê–ó–ê–î"},to:{type:String,default:null},showIcon:{type:Boolean,default:!0},ariaLabel:{type:String,default:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"},title:{type:String,default:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"}},setup(o){const{goBack:e,goHome:s}=Wo();return{buttonClasses:M(()=>[o.variant==="header"?"back-button":"floating-back-button"]),handleClick:()=>{o.to?s({path:o.to}):e()}}}},Ho=["aria-label","title"],jo={key:0,class:"back-button-icon"},Vo={key:1,class:"back-button-text"};function zo(o,e,s,t,r,i){return c(),u("button",{class:X(t.buttonClasses),onClick:e[0]||(e[0]=(...n)=>t.handleClick&&t.handleClick(...n)),"aria-label":s.ariaLabel,title:s.title},[s.showIcon?(c(),u("span",jo,"‚Üê")):A("",!0),s.variant==="header"?(c(),u("span",Vo,m(s.text),1)):A("",!0)],10,Ho)}const _a=de(Fo,[["render",zo],["__scopeId","data-v-d605b6a0"]]);function Go(o){const e=I(!1),s=I(null),t=I(""),r=I({}),i=I([]),n=I({}),l=I([]),d=I({totalTickets:0,totalEmployees:0,activeStages:0,lastUpdated:null}),g=M(()=>i.value.length>0||l.value.length>0),p=M(()=>!g.value&&!e.value&&!s.value),T=M(()=>{const R=Object.values(n.value).reduce((G,q)=>G+(q?.length||0),0),U=i.value.reduce((G,q)=>G+(q.tickets?.length||0),0);return R+U}),v=M(()=>{if(!T.value)return 0;const U=[...Object.values(n.value).flat(),...i.value.flatMap(G=>G.tickets||[])].filter(G=>G.status==="closed"||G.status==="completed"||G.status==="done").length;return Math.round(U/T.value*100)}),y=(R,U="",G={})=>{e.value=R,t.value=U,r.value=G},k=R=>{s.value=R,e.value=!1},S=()=>{s.value=null},C=R=>{i.value=R},f=R=>{l.value=R},w=R=>{n.value=R},$=R=>{d.value={...d.value,...R,lastUpdated:new Date().toISOString()}},W=()=>{e.value=!1,s.value=null,t.value="",r.value={},i.value=[],n.value={},l.value=[],d.value={totalTickets:0,totalEmployees:0,activeStages:0,lastUpdated:null}},L=R=>i.value.find(U=>U.id===R);return{isLoading:e,error:s,currentStep:t,stepDetails:r,stages:i,zeroPointTickets:n,employees:l,sectorStats:d,hasData:g,isEmpty:p,totalTickets:T,completionRate:v,setLoading:y,setError:k,clearError:S,updateStages:C,updateEmployees:f,updateZeroPointTickets:w,updateSectorStats:$,resetState:W,getStageById:L,getEmployeeById:R=>l.value.find(U=>U.id===R),getStageTickets:R=>{const U=L(R);return U?U.tickets||[]:[]},getZeroPointTickets:R=>n.value[R]||[]}}class Dt{static async call(e,s={}){return await new vt().call(e,s)}}class Oe{static get(e){const s=this.cache.get(e);return s?Date.now()-s.timestamp>s.ttl?(this.cache.delete(e),null):s.data:null}static set(e,s,t=this.DEFAULT_TTL){this.cache.set(e,{data:s,timestamp:Date.now(),ttl:t})}static delete(e){this.cache.delete(e)}static clear(){this.cache.clear()}static invalidateByPrefix(e){const s=[];for(const t of this.cache.keys())t.startsWith(e)&&s.push(t);s.forEach(t=>this.cache.delete(t))}static cleanExpired(){const e=Date.now(),s=[];for(const[t,r]of this.cache.entries())e-r.timestamp>r.ttl&&s.push(t);s.forEach(t=>this.cache.delete(t))}static getStats(){const e=Date.now();let s=0,t=0;for(const r of this.cache.values())e-r.timestamp>r.ttl?s++:t++;return{total:this.cache.size,valid:t,expired:s}}static getTicketsCacheKey(e){return`tickets:stage:${e}`}static getAllTicketsCacheKey(){return"tickets:all"}static getEmployeesCacheKey(e){return`employees:ids:${[...e].sort((t,r)=>t-r).join(",")}`}static getSectorDataCacheKey(){return"sector:data"}static invalidateTicketsCache(){this.invalidateByPrefix("tickets:"),this.invalidateByPrefix("sector:")}static invalidateEmployeesCache(){this.invalidateByPrefix("employees:")}}je(Oe,"cache",new Map),je(Oe,"DEFAULT_TTL",5*60*1e3),je(Oe,"EMPLOYEES_TTL",30*60*1e3),je(Oe,"TICKETS_TTL",5*60*1e3);typeof window<"u"&&setInterval(()=>{Oe.cleanExpired()},5*60*1e3);const Ds="dashboard-sector-1c-logger-level",zt={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4};let Mt=class{static getLevel(){if(typeof localStorage<"u"){const s=localStorage.getItem(Ds);if(s&&zt[s]!==void 0)return s}return!0?"ERROR":"DEBUG"}static setLevel(e){return zt[e]!==void 0?(typeof localStorage<"u"&&localStorage.setItem(Ds,e),!0):!1}static isEnabled(e,s=null){const t=s||this.getLevel();if(t==="NONE")return!1;const r=zt[e]||0,i=zt[t]||0;return r<=i}static getLevels(){return{...zt}}static reset(){typeof localStorage<"u"&&localStorage.removeItem(Ds)}},Ee=class{static getLevelColor(e){return{ERROR:"#dc3545",WARN:"#ffc107",INFO:"#17a2b8",DEBUG:"#6c757d"}[e]||"#6c757d"}static formatMessage(e,s,t=""){const r=new Date().toISOString(),i=this.getLevelColor(e),n=`%c[${r}] %c[${e}] %c[${t||"Unknown"}] %c${s}`,l=["color: #6c757d; font-weight: normal",`color: ${i}; font-weight: bold`,"color: #007bff; font-weight: normal","color: #212529; font-weight: normal"];return{formatted:n,styles:l}}static log(e,s,t="",r=null){if(!Mt.isEnabled(e))return;const i=this.formatMessage(e,s,t),n=[i.formatted,...i.styles];switch(r!=null&&n.push(r),e){case"ERROR":console.error(...n);break;case"WARN":console.warn(...n);break;case"INFO":console.info(...n);break;case"DEBUG":console.log(...n);break;default:console.log(...n)}}static error(e,s="",t=null){this.log("ERROR",e,s,t)}static warn(e,s="",t=null){this.log("WARN",e,s,t)}static info(e,s="",t=null){this.log("INFO",e,s,t)}static debug(e,s="",t=null){this.log("DEBUG",e,s,t)}};function Ke(o,e,s={}){if(!o||typeof o!="string")throw new Error("Step must be a non-empty string");const t=typeof e=="number"&&!isNaN(e)?Math.max(0,Math.min(100,e)):0;let r=s.description;return r||(r=Ko(o,s)),{step:o,progress:t,details:{...s,description:r}}}function Ko(o,e){return o==="loading_tickets"&&e.stageName&&e.stageIndex!==void 0?`–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏ "${e.stageName}" (${e.stageIndex}/${e.totalStages||1})...`:o==="filtering"&&e.filteredTickets!==void 0&&e.totalTickets!==void 0?`–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤: ${e.filteredTickets} –∏–∑ ${e.totalTickets}...`:o==="grouping"&&e.employeeCount!==void 0?`–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ ${e.employeeCount} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º...`:e.count!==void 0&&e.total!==void 0?`–û–±—Ä–∞–±–æ—Ç–∫–∞: ${e.count} –∏–∑ ${e.total}...`:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."}function gs(o){if(!o||typeof o!="object")throw new Error("Progress info must be an object");const e=o.step||null;if(!e)throw new Error("Step is required in progress info");const s=o.progress!==void 0&&o.progress!==null?o.progress:o.percent!==void 0&&o.percent!==null?o.percent:void 0,t=o.details||{};return o.stage&&(t.stage=o.stage),o.stageName&&(t.stageName=o.stageName),o.stageIndex!==void 0&&(t.stageIndex=o.stageIndex),o.totalStages!==void 0&&(t.totalStages=o.totalStages),o.count!==void 0&&(t.count=o.count),o.total!==void 0&&(t.total=o.total),o.warning&&(t.warning=o.warning),{step:e,progress:s!=null?Math.max(0,Math.min(100,s)):void 0,details:t}}function Os(o,e,s){const t=typeof o=="number"&&!isNaN(o)?Math.max(0,Math.min(100,o)):0,r=typeof e=="number"&&!isNaN(e)?Math.max(0,Math.min(100,e)):0,i=typeof s=="number"&&!isNaN(s)?Math.max(0,Math.min(100,s)):0,n=t+r*i/100;return Math.max(0,Math.min(100,n))}const xt={allowedDepartmentIds:[369,366,7],adminDepartmentIds:[369]};function wa(o){return!o||typeof o!="number"?!1:xt.allowedDepartmentIds.includes(o)}function as(o){if(!o||!o.UF_DEPARTMENT)return!1;const e=Array.isArray(o.UF_DEPARTMENT)?o.UF_DEPARTMENT:[];return e.length===0?!1:e.some(s=>xt.adminDepartmentIds.includes(s))}class qo{constructor(){this.reset()}reset(){this.metrics={ticketsLoading:{stages:{},totalLoaded:0},filtering:{total:0,filtered:0,rejected:[],tagValueExamples:[]},employees:{uniqueIds:[],totalUnique:0,ticketsWithoutAssignedById:[],ticketsWithAssignedById1051:[]},grouping:{distributionByStages:{},ticketsNotInColumn:[],unknownStages:[]},zeroPoint:{byStage:{}}}}logTicketsLoading(e,s,t,r=null){this.metrics.ticketsLoading.stages[e]||(this.metrics.ticketsLoading.stages[e]={loaded:0,batches:[],total:0});const i=this.metrics.ticketsLoading.stages[e];i.loaded=t,i.batches.push({count:s,total:t,next:r}),i.total=t,this.metrics.ticketsLoading.totalLoaded=Object.values(this.metrics.ticketsLoading.stages).reduce((n,l)=>n+l.total,0)}logFiltering(e,s,t=[],r=[]){this.metrics.filtering.total=e,this.metrics.filtering.filtered=s,this.metrics.filtering.rejected=t.slice(0,50),this.metrics.filtering.tagValueExamples=r.slice(0,20)}logEmployees(e,s=[],t=[]){this.metrics.employees.uniqueIds=e,this.metrics.employees.totalUnique=e.length,this.metrics.employees.ticketsWithoutAssignedById=s.slice(0,50),this.metrics.employees.ticketsWithAssignedById1051=t.slice(0,50)}logGrouping(e,s=[],t=[]){e.forEach(r=>{const i={};let n=0;r.employees.forEach(l=>{const d=(l.ticketsInsideSector||[]).length+(l.ticketsOutsideSector||[]).length;i[l.id]=d,n+=d}),this.metrics.grouping.distributionByStages[r.id]={employees:i,total:n}}),this.metrics.grouping.ticketsNotInColumn=s.slice(0,50),this.metrics.grouping.unknownStages=t.slice(0,50)}logZeroPoint(e){Object.keys(e).forEach(s=>{this.metrics.zeroPoint.byStage[s]=Array.isArray(e[s])?e[s].length:0})}getMetrics(){return this.metrics}getProblematicTickets(){return{withoutAssignedById:this.metrics.employees.ticketsWithoutAssignedById,withAssignedById1051:this.metrics.employees.ticketsWithAssignedById1051,withoutSectorTag:this.metrics.filtering.rejected,notInColumn:this.metrics.grouping.ticketsNotInColumn,unknownStage:this.metrics.grouping.unknownStages}}exportToJSON(){return JSON.stringify({metrics:this.metrics,problematicTickets:this.getProblematicTickets(),timestamp:new Date().toISOString()},null,2)}}let Es=null;function tt(){return Es||(Es=new qo),Es}function ct(o=null,e=null){if(e&&!as(e))return!1;if(o&&o.query&&o.query.diagnostics==="true")return!0;if(typeof window<"u"&&window.location){const s=window.location.hash;if(s){const r=s.split("?");if(r.length>1){const i=r[1];if(new URLSearchParams(i).get("diagnostics")==="true")return!0}if(s.includes("diagnostics=true"))return!0}if(new URLSearchParams(window.location.search).get("diagnostics")==="true")return!0}return typeof localStorage<"u"?localStorage.getItem("dashboard-sector-1c-diagnostics")==="true":!1}const Gt=140;class Lt{static async getAllTicketsByFilter(e,s="UF_CRM_7_TYPE_PRODUCT",t=null,r=!0){Ee.info(`Loading tickets by filter: ${s} = ${e}`,"TicketRepository");try{const i=[],n=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],l=n.length;for(let d=0;d<n.length;d++){const g=n[d],p=this.getStageName(g);if(t){const T=d/l*100;t({step:"loading_tickets",progress:T,details:{stage:g,stageName:p,stageIndex:d+1,totalStages:l,filter:`${s} = ${e}`}})}try{const T=await this.getTicketsByStageWithFilter(g,e,s,r,t?v=>{const y=Os(d/l*100,1/l*100,v.percent||0);t({step:"loading_tickets",progress:y,details:{stage:g,stageName:p,stageIndex:d+1,totalStages:l,count:v.count,total:v.total,filter:`${s} = ${e}`}})}:null);i.push(...T)}catch(T){Ee.error(`Error loading tickets for stage ${g} with filter ${s} = ${e}`,"TicketRepository",T)}}return Ee.info(`Loaded ${i.length} tickets with filter ${s} = ${e}`,"TicketRepository"),i}catch(i){throw Ee.error(`Error loading tickets by filter ${s} = ${e}`,"TicketRepository",i),i}}static async getAllTickets(e,s=null,t=!0){const r=[],i=e.length;try{for(let n=0;n<e.length;n++){const l=e[n],d=this.getStageName(l);if(s){const g=n/i*100;s(Ke("loading_tickets",g,{stage:l,stageName:d,stageIndex:n+1,totalStages:i}))}try{const g=await this.getTicketsByStage(l,t,s?p=>{const T=Os(n/i*100,1/i*100,p.percent||0);s(Ke("loading_tickets",T,{stage:l,stageName:d,stageIndex:n+1,totalStages:i,count:p.count,total:p.total}))}:null);r.push(...g)}catch(g){Ee.error(`Error loading tickets for stage ${l}`,"TicketRepository",g);let p=`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–∏ "${d}"`;throw g.message&&(g.message.includes("HTTP error")||g.message.includes("network")?p=`–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞–¥–∏–∏ "${d}". –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.`:g.message.includes("timeout")?p=`–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞–¥–∏–∏ "${d}". –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.`:g.message.includes("403")||g.message.includes("401")?p=`–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞–¥–∏–∏ "${d}". –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.`:p=`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–∏ "${d}": ${g.message}`),new Error(p)}}}catch(n){throw Ee.error("Error in getAllTickets","TicketRepository",n),n}return r}static getStageName(e){return{"DT140_12:UC_0VHWE2":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","DT140_12:PREPARATION":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó","DT140_12:CLIENT":"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"}[e]||e}static async getTicketsByStage(e,s=!0,t=null){if(s){const p=Oe.getTicketsCacheKey(e),T=Oe.get(p);if(T!==null){try{const v=tt();v&&ct()&&v.logTicketsLoading(e,T.length,T.length,null)}catch(v){Ee.warn("Diagnostics logging error (cache hit) in getTicketsByStage","TicketRepository",v)}return t&&t(gs({step:"loading_tickets",percent:100,count:T.length,total:T.length})),T}}const r=[];let i=0;const n=50;let l=!0,d=0,g=null;for(;l;)try{const p=await Dt.call("crm.item.list",{entityTypeId:Gt,filter:{stageId:e},select:["*"],order:{id:"DESC"},start:i,useOriginalUfNames:"Y"});let T=[];if(p&&p.result&&(Array.isArray(p.result)?T=p.result:p.result.items&&Array.isArray(p.result.items)?T=p.result.items:p.result.data&&Array.isArray(p.result.data)&&(T=p.result.data)),T.length>0){r.push(...T),i+=T.length;const v=p?.result?.next??p?.next,y=v!=null&&v!==""&&String(v)!=="0";l=T.length===n&&y,ct()&&Ee.debug(`[Pagination] Stage: ${e}, Batch: ${T.length}, Total: ${r.length}, Start: ${i}, NextValue: ${v}, HasNext: ${y}, HasMore: ${l}`,"TicketRepository");try{const k=tt();k&&ct()&&(Ee.debug(`[Pagination Debug] Stage: ${e}, Batch: ${T.length}, Total: ${r.length}`,"TicketRepository",{resultStructure:{hasResult:!!p?.result,resultIsArray:Array.isArray(p?.result),hasItems:!!p?.result?.items,hasData:!!p?.result?.data,hasNext:!!v,nextValue:v,nextType:typeof v,resultKeys:p?.result?Object.keys(p.result):[]}}),k.logTicketsLoading(e,T.length,r.length,v||null))}catch(k){Ee.warn("Diagnostics logging error","TicketRepository",k)}if(l?d=i+n:d=r.length,t){const k=d>0?Math.min(100,r.length/d*100):0;t(gs({step:"loading_tickets",percent:k,count:r.length,total:d}))}g=null}else l=!1}catch(p){if(Ee.error(`Error loading tickets batch for stage ${e} (start: ${i})`,"TicketRepository",p),i===0)throw g=p,new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∏–∫–µ—Ç—ã –¥–ª—è —Å—Ç–∞–¥–∏–∏ ${e}: ${p.message||p}`);l=!1,t&&r.length>0&&t(Ke("loading_tickets",100,{count:r.length,total:r.length,warning:`–ó–∞–≥—Ä—É–∂–µ–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ: ${r.length} —Ç–∏–∫–µ—Ç–æ–≤. –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.`}))}if(g&&r.length===0)throw g;if(s){const p=Oe.getTicketsCacheKey(e);Oe.set(p,r,Oe.TICKETS_TTL)}return r}static async getTicket(e){return(await Dt.call("crm.item.get",{entityTypeId:Gt,id:e})).result||null}static async getTicketsByStageWithFilter(e,s,t="UF_CRM_7_TYPE_PRODUCT",r=!0,i=null){Ee.info(`Loading tickets for stage ${e} with filter ${t} = ${s}`,"TicketRepository");const n=`tickets_${e}_${t}_${JSON.stringify(s)}`;if(r){const y=Oe.get(n);if(y!==null)return Ee.info(`Cache hit for filtered tickets: ${e} with ${t} = ${s}`,"TicketRepository"),i&&i({step:"loading_tickets",percent:100,count:y.length,total:y.length}),y}const l=[];let d=0;const g=50;let p=!0,T=0;const v={stageId:e};for(Array.isArray(s),v[t]=s;p;)try{const y=await Dt.call("crm.item.list",{entityTypeId:Gt,filter:v,select:["*"],order:{id:"DESC"},start:d,useOriginalUfNames:"Y"});let k=[];y&&y.result&&(Array.isArray(y.result)?k=y.result:y.result.items&&Array.isArray(y.result.items)?k=y.result.items:y.result.data&&Array.isArray(y.result.data)&&(k=y.result.data)),k.length>0?(l.push(...k),d+=k.length,T=Math.max(T,d+k.length),i&&i({step:"loading_tickets",percent:Math.min(d/Math.max(T,d)*100,95),count:d,total:T}),p=k.length===g&&y.next):p=!1}catch(y){throw Ee.error(`Error loading batch for stage ${e} with filter ${t} = ${s}`,"TicketRepository",y),p=!1,y}r&&(Oe.set(n,l),Ee.info(`Cached ${l.length} filtered tickets for stage ${e}`,"TicketRepository"));try{const y=tt();y&&ct()&&y.logTicketsLoading(`${e}_${s}`,l.length,l.length,null)}catch(y){Ee.warn("Diagnostics logging error in getTicketsByStageWithFilter","TicketRepository",y)}return i&&i({step:"loading_tickets",percent:100,count:l.length,total:l.length}),Ee.info(`Loaded ${l.length} tickets for stage ${e} with filter ${t} = ${s}`,"TicketRepository"),l}static async updateTicket(e,s){const r=(await Dt.call("crm.item.update",{entityTypeId:Gt,id:e,fields:s})).result===!0;return r&&Oe.invalidateTicketsCache(),r}static async createTicket(e){const s=await Dt.call("crm.item.add",{entityTypeId:Gt,fields:e}),t=s.result?parseInt(s.result):0;return t>0&&Oe.invalidateTicketsCache(),t}static async assignTicket(e,s,t){return await this.updateTicket(e,{assignedById:s,stageId:t})}}class Yo{static async getEmployeesByIds(e,s=!0){if(!Array.isArray(e)||e.length===0)return[];if(s){const t=Oe.getEmployeesCacheKey(e),r=Oe.get(t);if(r!==null)return Ee.debug(`Cache hit for employees: ${e.length} employees`,"EmployeeRepository"),r}try{const t=await Dt.call("user.get",{filter:{ID:e},select:["ID","NAME","LAST_NAME","EMAIL","WORK_POSITION","UF_DEPARTMENT"]});let r=[];if(t&&t.result&&(Array.isArray(t.result)?r=t.result:Ee.warn("Unexpected user.get result format","EmployeeRepository",t)),s){const i=Oe.getEmployeesCacheKey(e);Oe.set(i,r,Oe.EMPLOYEES_TTL)}return r}catch(t){return Ee.error("Error getting employees by IDs","EmployeeRepository",t),[]}}}const Xt=new Map;function Ca(){Xt.clear()}function Xo(o){if(!o)return[];if(Array.isArray(o))return o.filter(s=>typeof s=="number"||!isNaN(parseInt(s))).map(s=>typeof s=="number"?s:parseInt(s));if(typeof o=="number")return[o];const e=parseInt(o);return isNaN(e)?[]:[e]}function Jo(o,e=!0){const s=o.id||o.ID;if(!o||!s)return null;if(e&&Xt.has(s))return Xt.get(s);const t=o.UF_DEPARTMENT||o.departmentId,r=Xo(t);for(const i of r)if(uo(i)){const l=i;return e&&Xt.set(s,l),l}return e&&Xt.set(s,null),null}function Zo(o){const e=Jo(o);return{id:parseInt(o.ID||o.id||0),name:`${o.NAME||o.name||""} ${o.LAST_NAME||o.lastName||""}`.trim()||o.EMAIL||o.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:o.WORK_POSITION||o.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:o.EMAIL||o.email||"",sectorId:e,departmentId:o.UF_DEPARTMENT||null,tickets:[]}}function Qo(o){return Array.isArray(o)?o.map(e=>Zo(e)):[]}const As="dashboard-sectors-logger-level",Kt={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4};class en{static getLevel(){if(typeof localStorage<"u"){const s=localStorage.getItem(As);if(s&&Kt[s]!==void 0)return s}return!0?"ERROR":"DEBUG"}static setLevel(e){return Kt[e]!==void 0?(typeof localStorage<"u"&&localStorage.setItem(As,e),!0):!1}static isEnabled(e,s=null){const t=s||this.getLevel();if(t==="NONE")return!1;const r=Kt[e]||0,i=Kt[t]||0;return r<=i}static getLevels(){return{...Kt}}static reset(){typeof localStorage<"u"&&localStorage.removeItem(As)}}let Nt=class{static getLevelColor(e){return{ERROR:"#dc3545",WARN:"#ffc107",INFO:"#17a2b8",DEBUG:"#6c757d"}[e]||"#6c757d"}static formatMessage(e,s,t=""){const r=new Date().toISOString(),i=this.getLevelColor(e),n=`%c[${r}] %c[${e}] %c[${t||"Unknown"}] %c${s}`,l=["color: #6c757d; font-weight: normal",`color: ${i}; font-weight: bold`,"color: #007bff; font-weight: normal","color: #212529; font-weight: normal"];return{formatted:n,styles:l}}static log(e,s,t="",r=null){if(!en.isEnabled(e))return;const i=this.formatMessage(e,s,t),n=[i.formatted,...i.styles];switch(r!=null&&n.push(r),e){case"ERROR":console.error(...n);break;case"WARN":console.warn(...n);break;case"INFO":console.info(...n);break;case"DEBUG":console.log(...n);break;default:console.log(...n)}}static error(e,s="",t=null){this.log("ERROR",e,s,t)}static warn(e,s="",t=null){this.log("WARN",e,s,t)}static info(e,s="",t=null){this.log("INFO",e,s,t)}static debug(e,s="",t=null){this.log("DEBUG",e,s,t)}};const Qt=new Map,aa=100;function tn(o,e){if(!Array.isArray(o))return Nt.warn("filterTicketsBySector: tickets is not an array","sector-filter"),[];if(!e||!e.id)return Nt.error("filterTicketsBySector: invalid sectorConfig","sector-filter",e),[];const s=nn(o,e),t=Qt.get(s);if(t!==void 0)return Nt.debug(`Filter cache hit for sector ${e.id}`,"sector-filter"),t;const r=sn(e);if(r.length===0)return Nt.warn(`No filter values for sector ${e.id}`,"sector-filter"),[];const i=o.filter(n=>an(n,r,e));return Nt.info(`Filtered ${i.length}/${o.length} tickets for sector ${e.id}`,"sector-filter",{sectorId:e.id,sectorName:e.name,totalTickets:o.length,filteredTickets:i.length,filterValues:r,filterField:e.filterField||"UF_CRM_7_TYPE_PRODUCT"}),Qt.set(s,i),rn(),i}function sn(o){const{filterValue:e}=o;return e?(Array.isArray(e)?e:Array.isArray(o.filterValues)?o.filterValues:[e]).filter(t=>t!=null).map(t=>Ta(t)).filter(Boolean):[]}function an(o,e,s){if(!o||typeof o!="object")return!1;const t=on(o,s.filterField||"UF_CRM_7_TYPE_PRODUCT"),r=Ta(t);return r?e.some(i=>r===i):!1}function on(o,e){return o[e]||o[e.toLowerCase()]||o[ln(e)]||o[e.replace(/_/g,"").toLowerCase()]||null}function Ta(o){return o==null?null:(typeof o=="object"&&o.value!==void 0&&(o=o.value),Array.isArray(o)&&o.length>0&&(o=o[0]),String(o).trim().toUpperCase().replace(/–°/g,"C").replace(/—Å/g,"c")||null)}function nn(o,e){const s=o.map(i=>i.id||i.ID||"").sort().join(","),t=JSON.stringify({id:e.id,filterValue:e.filterValue,filterValues:e.filterValues,filterField:e.filterField}),r=btoa(s+"|"+t).slice(0,50);return`filter:${e.id}:${r}`}function rn(){if(Qt.size>aa){const o=Math.floor(aa*.2);Array.from(Qt.keys()).slice(0,o).forEach(s=>Qt.delete(s)),Nt.debug(`Cleaned ${o} entries from filter cache`,"sector-filter")}}function ln(o){return o.toLowerCase().replace(/_([a-z])/g,(e,s)=>s.toUpperCase())}const ts=1051;function ms(o){if(!o||typeof o!="object")return null;let e=o.assignedById||o.ASSIGNED_BY_ID||o.assignedByIdId||o.assignedById;return e&&typeof e=="object"&&(e=e.id||e.ID||e.value||null),e||null}function Us(o){if(o==null)return null;typeof o=="object"&&(o=o.id||o.ID||o.value||null);const e=typeof o=="number"?o:parseInt(o);return isNaN(e)||e<=0?null:e}function cn(o,e=ts){const s=ms(o),t=Us(s);return t===null||t===e}function dn(o,e){Array.isArray(o)||(Ee.warn("Tickets is not an array","TicketGrouper",o),o=[]),Array.isArray(e)||(Ee.warn("Employees is not an array","TicketGrouper",e),e=[]);const s=e.filter(d=>(d.id?parseInt(d.id):null)!==ts),t=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:s.map(d=>({...d,isFromSector1C:d.sectorId===Jt.SECTOR_1C,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:s.map(d=>({...d,isFromSector1C:d.sectorId===Jt.SECTOR_1C,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:s.map(d=>({...d,isFromSector1C:d.sectorId===Jt.SECTOR_1C,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]}))}],r=new Map(t.map(d=>[d.id,d])),i=new Map;t.forEach(d=>{const g=new Map(d.employees.map(p=>[p.id,p]));i.set(d.id,g)});const n=[],l=[];o.forEach(d=>{const g=Zt(d.stageId||d.STAGE_ID||""),p=r.get(g);if(!p){l.push({id:d.id||d.ID,title:d.title||d.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",stageId:d.stageId||d.STAGE_ID,assignedById:ms(d)});return}const T=ms(d),v=Us(T);if(v!==ts)if(v){const y=i.get(g);let k=y.get(v);k||(k={id:v,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${v}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",sectorId:null,departmentId:null,isFromSector1C:!1,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]},p.employees.push(k),y.set(v,k));const S=Bs(d),C={...S,stageId:d.stageId||d.STAGE_ID||S.stageId||null,departmentHead:S.departmentHead||null,departmentHeadFull:S.departmentHeadFull||S.departmentHead||null};k.tickets.push(C),k.isFromSector1C?k.ticketsInsideSector.push(C):k.ticketsOutsideSector.push(C)}else n.push({id:d.id||d.ID,title:d.title||d.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",stageId:g,assignedById:T})}),t.forEach(d=>{d.employees.sort((g,p)=>g.isFromSector1C&&!p.isFromSector1C?-1:!g.isFromSector1C&&p.isFromSector1C?1:(g.id||0)-(p.id||0))});try{const d=tt();if(d&&ct()){const g={};t.forEach(T=>{let v=0,y=0;T.employees.forEach(k=>{v+=(k.ticketsInsideSector||[]).length,y+=(k.ticketsOutsideSector||[]).length}),g[T.id]={insideSector:v,outsideSector:y,total:v+y}});const p=d.metrics.grouping;Object.keys(g).forEach(T=>{p.distributionByStages[T]||(p.distributionByStages[T]={employees:{},total:0}),p.distributionByStages[T].insideSector=g[T].insideSector,p.distributionByStages[T].outsideSector=g[T].outsideSector,p.distributionByStages[T].total=g[T].total}),d.logGrouping(t,n,l)}}catch(d){Ee.warn("Diagnostics logging error in groupTicketsByStages","TicketGrouper",d)}return t}function un(o){const e={formed:[],review:[],execution:[]};if(!Array.isArray(o))return Ee.warn("Tickets is not an array in getZeroPointTickets","TicketGrouper",o),e;o.filter(s=>cn(s)).forEach(s=>{const t=Zt(s.stageId||s.STAGE_ID||"");if(e[t]){const r=Bs(s),i={...r,stageId:s.stageId||s.STAGE_ID||r.stageId||null,departmentHead:r.departmentHead||null,departmentHeadFull:r.departmentHeadFull||r.departmentHead||null};e[t].push(i)}});try{const s=tt();s&&ct()&&s.logZeroPoint(e)}catch(s){Ee.warn("Diagnostics logging error in getZeroPointTickets","TicketGrouper",s)}return e}function gn(o){if(!Array.isArray(o))return[];const e=new Set,s=[],t=[];o.forEach(i=>{const n=ms(i),l=Us(n);!n||n===null||n===void 0?s.push({id:i.id||i.ID,title:i.title||i.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",stageId:i.stageId||i.STAGE_ID}):l===ts&&t.push({id:i.id||i.ID,title:i.title||i.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",stageId:i.stageId||i.STAGE_ID}),l&&e.add(l)});const r=Array.from(e);try{const i=tt();i&&ct()&&i.logEmployees(r,s,t)}catch(i){Ee.warn("Diagnostics logging error in extractUniqueEmployeeIds","TicketGrouper",i)}return r}const ns=new Map,mn=10*60*1e3;function hn(o){if(!o||typeof o!="object")return{};const e={},s=Object.keys(o);for(const t of s)t.toUpperCase().startsWith("UF_")&&(e[t]=o[t]);return e}function fn(o,e=null,s=!0){if(s&&e&&ns.has(e)){const i=ns.get(e),n=Date.now();if(i.timestamp&&n-i.timestamp<mn)return i.data;ns.delete(e)}const t=hn(o),r={typeProduct:t.UF_CRM_7_TYPE_PRODUCT||t.uf_crm_7_type_product||t.ufCrm7TypeProduct||null,all:t};return s&&e&&ns.set(e,{data:r,timestamp:Date.now()}),r}class vn{static async getTicketDetails(e,s={}){const{select:t=["*"],useOriginalUfNames:r=!0,useCache:i=!0}=s;try{const n=await Lt.getTicket(e);if(!n)throw new Error(`–¢–∏–∫–µ—Ç —Å ID ${e} –Ω–µ –Ω–∞–π–¥–µ–Ω`);const l=fn(n,e,i),d=n.UF_CRM_7_UF_PRIORITY||n.uf_crm_7_uf_priority||n.ufCrm7UfPriority||n.UF_CRM_7_UF_PRIORITY||n.uf_crm_7_uf_priority||n.priority||n.PRIORITY||null,g=Ps(d),p=ba(g);return{id:n.id||n.ID,title:n.title||n.TITLE,stageId:n.stageId||n.STAGE_ID,assignedById:n.assignedById||n.ASSIGNED_BY_ID,createdAt:n.createdTime||n.CREATED_TIME||n.CREATED_DATE,updatedAt:n.updatedTime||n.UPDATED_TIME||n.MODIFY_DATE,priorityId:g.id,priorityLabel:g.label,priorityColors:p,priority:g.id,priorityBitrixValue:g.bitrixValue||null,opportunity:n.opportunity||n.OPPORTUNITY,currencyId:n.currencyId||n.CURRENCY_ID,comments:n.comments||n.COMMENTS,additionalFields:l,rawData:n}}catch(n){throw Ee.error("Error getting ticket details","TicketDetailsService",n),n}}}let Bt=class{static async getSectorData(e=!0,s=!1,t=null){let r=!1;try{if(ct()){const i=tt();i&&i.reset()}}catch(i){Ee.warn("Error resetting diagnostics","DashboardSector1CService",i)}if(t&&t(Ke("cache_check",0,{description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏..."})),e){const i=Oe.getSectorDataCacheKey(),n=Oe.get(i);if(n!==null)return t&&t(Ke("cache_hit",100,{description:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ in-memory –∫–µ—à–∞"})),n}try{t&&t(Ke("loading_tickets",10,{description:"–ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤ –∏–∑ Bitrix24..."}));const i=go(),n=await Lt.getAllTickets(i,y=>{if(t){const k=gs(y),S=Os(10,40,k.progress||0);t(Ke(k.step||"loading_tickets",S,{...k.details,warning:k.details.warning}))}},e);t&&t(Ke("filtering",50,{totalTickets:n.length,description:`–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è ${n.length} —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —Å–µ–∫—Ç–æ—Ä—É 1–°...`}));const l=tn(n,{id:"1c",name:"1C",filterValue:"1C",filterField:"UF_CRM_7_TYPE_PRODUCT"});t&&t(Ke("filtering",50,{totalTickets:n.length,filteredTickets:l.length,description:`–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ ${l.length} —Ç–∏–∫–µ—Ç–æ–≤ –∏–∑ ${n.length}`})),t&&t(Ke("extracting_employees",60,{filteredTickets:l.length,description:`–ê–Ω–∞–ª–∏–∑ ${l.length} —Ç–∏–∫–µ—Ç–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...`}));const d=gn(l);t&&t(Ke("extracting_employees",60,{employeeCount:d.length,description:`–ù–∞–π–¥–µ–Ω–æ ${d.length} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`})),t&&t(Ke("loading_employees",65,{employeeCount:d.length,description:`–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ${d.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...`})),Ca();const g=await Yo.getEmployeesByIds(d),p=Qo(g);t&&t(Ke("loading_employees",90,{employeeCount:p.length,description:`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –¥–∞–Ω–Ω—ã—Ö ${p.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`})),t&&t(Ke("grouping",90,{filteredTickets:l.length,employeeCount:p.length,description:`–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ ${l.length} —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º –∏ ${p.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º...`}));const v={stages:dn(l,p),employees:p,zeroPointTickets:un(l)};if(t&&t(Ke("caching",95,{description:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –∫–µ—à –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."})),e){const y=Oe.getSectorDataCacheKey();Oe.set(y,v,Oe.TICKETS_TTL),r=!0}return t&&t(Ke("complete",100,{description:"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"})),r&&!s&&CacheNotificationService.notifyCacheCreationSuccess("–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°"),v}catch(i){throw Ee.error("Error getting sector data","DashboardSector1CService",i),t&&t({step:"error",progress:0,error:i.message}),i}}static async assignTicket(e,s,t){try{const r=Zs(t),i=await Lt.assignTicket(e,s,r);return i&&Oe.invalidateTicketsCache(),i}catch(r){throw Ee.error("Error assigning ticket","DashboardSector1CService",r),r}}static async createTicket(e){try{const s=Zs(e.stageId||"formed"),t={title:e.title,stageId:s};e.employeeId&&(t.assignedById=e.employeeId);const r=await Lt.createTicket(t);return r>0&&Oe.invalidateTicketsCache(),r}catch(s){throw Ee.error("Error creating ticket","DashboardSector1CService",s),s}}static async getTicket(e){try{const s=await Lt.getTicket(e);return Bs(s)}catch(s){throw Ee.error("Error getting ticket","DashboardSector1CService",s),s}}static async getTicketDetails(e,s={}){try{return await vn.getTicketDetails(e,s)}catch(t){throw Ee.error("Error getting ticket details","DashboardSector1CService",t),t}}static async addComment(e,s){try{return(await Dt.call("crm.timeline.comment.add",{fields:{entityId:e,entityType:"DYNAMIC_"+mo,comment:s}})).result!==void 0}catch(t){throw Ee.error("Error adding comment","DashboardSector1CService",t),t}}};const pn=Object.freeze(Object.defineProperty({__proto__:null,DashboardSector1CService:Bt},Symbol.toStringTag,{value:"Module"}));class Sa{static normalizeSectorData(e,s){return e?{stages:this.normalizeStages(e.stages||[],s),employees:this.normalizeEmployees(e.employees||[],s),zeroPointTickets:this.normalizeTickets(e.zeroPointTickets||[],s),metrics:this.calculateMetrics(e,s),metadata:this.createMetadata(e,s)}:this.getEmptySectorData(s)}static normalizeStages(e,s){return Array.isArray(e)?e.map((t,r)=>{const i=s.stages?.[t.id]||{},n=r%this.STAGE_COLORS.length;return{id:t.id||`stage_${r}`,name:i.name||t.name||t.title||`–≠—Ç–∞–ø ${r+1}`,color:i.color||t.color||this.STAGE_COLORS[n],order:i.order||t.order||r,tickets:this.normalizeTickets(t.tickets||[],s),employees:this.normalizeEmployees(t.employees||[],s),metrics:this.calculateStageMetrics(t,s)}}).sort((t,r)=>(t.order||0)-(r.order||0)):[]}static normalizeEmployees(e,s){return Array.isArray(e)?e.map(t=>({id:t.id||t.ID||`emp_${Math.random()}`,name:this.normalizeEmployeeName(t),department:t.department||t.UF_DEPARTMENT||s.defaultDepartment||"Unknown",load:t.load||t.currentLoad||0,avatar:t.avatar||t.PERSONAL_PHOTO||null,status:t.status||t.ACTIVE||"active",color:this.assignEmployeeColor(t,s)})):[]}static normalizeTickets(e,s){return Array.isArray(e)?e.map(t=>({id:t.id||t.ID||`ticket_${Math.random()}`,title:this.normalizeTicketTitle(t),status:t.status||t.STATUS_ID||"new",priority:this.normalizePriority(t),assignedTo:t.assignedTo||t.ASSIGNED_BY_ID||t.assigned_to,createdAt:this.normalizeDate(t.createdAt||t.CREATED_DATE||t.DATE_CREATE),updatedAt:this.normalizeDate(t.updatedAt||t.UPDATED_DATE||t.TIMESTAMP_X),deadline:this.normalizeDate(t.deadline||t.DEADLINE),tags:this.extractTags(t,s),description:t.description||t.DETAIL_TEXT||t.COMMENTS||""})):[]}static normalizeEmployeeName(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫";const s=e.LAST_NAME||e.lastName||"",t=e.NAME||e.firstName||e.FIRST_NAME||"",r=`${s} ${t}`.trim();return r&&r!==" "?r:t||(e.LOGIN||e.login?e.LOGIN||e.login:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${e.id||e.ID||"unknown"}`)}static normalizeTicketTitle(e){return e.title||e.TITLE||e.name||e.NAME||e.subject||e.SUBJECT||`–¢–∏–∫–µ—Ç ${e.id||e.ID||"–±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}`}static normalizePriority(e){const s=e.priority||e.PRIORITY;return typeof s=="number"?Math.max(1,Math.min(5,s)):typeof s=="string"&&{low:1,lowest:1,normal:3,medium:3,high:4,highest:5,urgent:5,critical:5}[s.toLowerCase()]||3}static normalizeDate(e){if(!e)return null;try{const s=new Date(e);return isNaN(s.getTime())?null:s.toISOString()}catch{return null}}static extractTags(e,s){const t=[];return e.UF_CRM_7_TYPE_PRODUCT&&t.push(e.UF_CRM_7_TYPE_PRODUCT),(e.category||e.CATEGORY)&&t.push(e.category||e.CATEGORY),(e.type||e.TYPE)&&t.push(e.type||e.TYPE),e.priority&&typeof e.priority=="string"&&t.push(`priority:${e.priority}`),[...new Set(t)]}static assignEmployeeColor(e,s){const t=["#007bff","#28a745","#ffc107","#dc3545","#6c757d","#17a2b8"];if(e.department){const i=e.department.split("").reduce((n,l)=>(n=(n<<5)-n+l.charCodeAt(0),n&n),0);return t[Math.abs(i)%t.length]}const r=e.id||e.ID||0;return t[Math.abs(r)%t.length]}static calculateStageMetrics(e,s){const t=e.tickets||[],r=e.employees||[];return{ticketCount:t.length,employeeCount:r.length,averageLoad:r.length>0?t.length/r.length:0,completionRate:this.calculateCompletionRate(t),overdueCount:this.countOverdueTickets(t)}}static calculateMetrics(e,s){const t=[...e.zeroPointTickets||[],...(e.stages||[]).flatMap(l=>l.tickets||[])],r=t.length,i=e.employees?.length||0,n=(e.stages||[]).filter(l=>(l.tickets||[]).length>0).length;return{totalTickets:r,totalEmployees:i,activeStages:n,averageTicketsPerEmployee:i>0?r/i:0,completionRate:this.calculateCompletionRate(t),overdueCount:this.countOverdueTickets(t)}}static calculateCompletionRate(e){if(!e.length)return 0;const s=e.filter(t=>t.status==="closed"||t.status==="completed"||t.status==="done").length;return Math.round(s/e.length*100)}static countOverdueTickets(e){const s=new Date;return e.filter(t=>t.deadline?new Date(t.deadline)<s&&t.status!=="closed"&&t.status!=="completed":!1).length}static createMetadata(e,s){return{sectorId:s.id,sectorName:s.name,lastUpdated:new Date().toISOString(),dataVersion:"2.0",source:"universal-normalizer"}}static getEmptySectorData(e){return{stages:[],employees:[],zeroPointTickets:[],metrics:{totalTickets:0,totalEmployees:0,activeStages:0,averageTicketsPerEmployee:0,completionRate:0,overdueCount:0},metadata:this.createMetadata({},e)}}}je(Sa,"STAGE_COLORS",["#007bff","#ffc107","#28a745","#dc3545","#6c757d","#17a2b8","#e83e8c","#fd7e14"]);class Da{static create(e){if(this.serviceCache.has(e))return this.serviceCache.get(e);const s=this.createServiceInstance(e);return this.serviceCache.set(e,s),s}static createServiceInstance(e){switch(e){case"1c":console.log("[SectorServiceFactory] Creating DashboardSector1CService for sector 1c");const{DashboardSector1CService:s}=require("@/services/dashboard-sector-1c/index.js");return new s;case"pdm":console.log("[SectorServiceFactory] Creating DashboardSectorPDMService for sector pdm");const{DashboardSectorPDMService:t}=require("@/services/dashboard/DashboardSectorPDMService.js");return new t;case"bitrix24":console.log("[SectorServiceFactory] Creating DashboardSectorBitrix24Service for sector bitrix24");const{DashboardSectorBitrix24Service:r}=require("@/services/dashboard/DashboardSectorBitrix24Service.js");return new r;case"infrastructure":console.log("[SectorServiceFactory] Creating DashboardSectorInfrastructureService for sector infrastructure");const{DashboardSectorInfrastructureService:i}=require("@/services/dashboard/DashboardSectorInfrastructureService.js");return new i;default:throw new Error(`Unknown sector: ${e}`)}}static isServiceAvailable(e){return["1c","pdm","bitrix24","infrastructure"].includes(e)}static clearCache(){this.serviceCache.clear(),console.log("[SectorServiceFactory] Service cache cleared")}static getAvailableServices(){return{"1c":{type:"full",description:"–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å–µ–∫—Ç–æ—Ä–∞ 1–°"},pdm:{type:"stub",description:"–ó–∞–≥–ª—É—à–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ —Å–µ–∫—Ç–æ—Ä–∞ PDM"},bitrix24:{type:"stub",description:"–ó–∞–≥–ª—É—à–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ —Å–µ–∫—Ç–æ—Ä–∞ –ë–∏—Ç—Ä–∏–∫—Å24"},infrastructure:{type:"stub",description:"–ó–∞–≥–ª—É—à–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ —Å–µ–∫—Ç–æ—Ä–∞ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞"}}}}je(Da,"serviceCache",new Map);class Ea{constructor(e){this.sectorId=e,this.cache=new Map;try{this.sectorService=Da.create(e),console.log(`[UniversalSectorDashboardService] Initialized for sector: ${this.sectorId}`)}catch(s){throw console.error(`[UniversalSectorDashboardService] Failed to initialize for sector ${this.sectorId}:`,s),s}}async getSectorDashboardData(e={}){const s=`dashboard:${this.sectorId}:${JSON.stringify(e)}`;if(!e.forceRefresh&&this.cache.has(s))return console.log(`[UniversalSectorDashboardService] Cache hit for dashboard data: ${this.sectorId}`),this.cache.get(s);try{console.log(`[UniversalSectorDashboardService] Loading dashboard data for sector: ${this.sectorId}`);let t;if(this.sectorId==="1c"){const{DashboardSector1CService:i}=await Se(async()=>{const{DashboardSector1CService:n}=await Promise.resolve().then(()=>pn);return{DashboardSector1CService:n}},void 0,import.meta.url);t=await i.getSectorData(!e.forceRefresh,!1,null)}else t=await this.sectorService.getSectorData(e);const r=this.normalizeSectorDataToDashboard(t);return this.cache.set(s,r),setTimeout(()=>{this.cache.delete(s)},5*60*1e3),console.log(`[UniversalSectorDashboardService] Returning dashboard data for ${this.sectorId}:`,{stages:r.stages?.length||0,employees:r.employees?.length||0,totalTickets:r.metadata?.totalTickets||0}),r}catch(t){throw console.error(`[UniversalSectorDashboardService] Failed to get dashboard data for ${this.sectorId}:`,t),t}}normalizeSectorDataToDashboard(e){const s=Sa.normalizeSectorData(e,{id:this.sectorId});return{stages:this.convertStagesToDashboardFormat(s.stages),employees:s.employees,zeroPointTickets:this.extractZeroPointTickets(s),metadata:{sectorId:this.sectorId,totalTickets:s.metrics?.totalTickets||0,totalEmployees:s.employees?.length||0,lastUpdated:new Date().toISOString()}}}convertStagesToDashboardFormat(e){return e.map(s=>({id:this.mapStageIdToDashboardId(s.id),name:s.name,color:s.color||"#666",employees:s.employees||[],tickets:s.tickets||[],metrics:{ticketCount:s.tickets?.length||0,employeeCount:s.employees?.length||0}}))}mapStageIdToDashboardId(e){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution",formed:"formed",review:"review",execution:"execution",request:"formed",assessment:"review",deployment:"execution"}[e]||e}extractZeroPointTickets(e){const s={};return e.stages.forEach(t=>{const r=this.mapStageIdToDashboardId(t.id),i=t.tickets.filter(n=>!n.assignedTo||n.assignedTo===null||n.assignedTo==="");s[r]=i}),s}async updateTicketAssignment(e,s,t){try{const r=this.mapDashboardIdToStageId(s),i=await this.sectorService.updateTicketAssignment(e,r,t);return this.clearCache(),i}catch(r){throw console.error("[UniversalSectorDashboardService] Failed to update ticket assignment:",r),r}}mapDashboardIdToStageId(e){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[e]||e}clearCache(){this.cache.clear(),console.log(`[UniversalSectorDashboardService] Cache cleared for sector: ${this.sectorId}`)}async createTicket(e){try{const s=await this.sectorService.createTicket({...e,sectorId:this.sectorId});return this.clearCache(),s}catch(s){throw console.error("[UniversalSectorDashboardService] Failed to create ticket:",s),s}}async getSectorStats(){try{const e=await this.getSectorDashboardData();return{totalTickets:e.metadata.totalTickets,totalEmployees:e.metadata.totalEmployees,stagesCount:e.stages.length,unassignedTickets:Object.values(e.zeroPointTickets).reduce((s,t)=>s+t.length,0),lastUpdated:e.metadata.lastUpdated}}catch(e){throw console.error("[UniversalSectorDashboardService] Failed to get sector stats:",e),e}}}je(Ea,"services",new Map);function yn(o,e){console.log(`üîß [useUniversalDashboardActions] Initialized for sector: ${e}`);let s=null;const t=()=>{if(!s)try{console.log(`üè≠ [useUniversalDashboardActions] Creating service for sector: ${e}`),s=Ea.getService(e),console.log("‚úÖ [useUniversalDashboardActions] Service created successfully")}catch(f){console.error("‚ùå [useUniversalDashboardActions] Failed to create service:",f),s={getSectorDashboardData:async()=>({stages:[],employees:[],zeroPointTickets:{},metadata:{sectorId:e,totalTickets:0,totalEmployees:0}})}}return s},r=async(f={})=>{try{console.log(`üì° [useUniversalDashboardActions] Starting data load for sector: ${e}`);const w=t();console.log("üè≠ [useUniversalDashboardActions] Service obtained:",w);const $=await w.getSectorDashboardData(f);return console.log("‚úÖ [useUniversalDashboardActions] Dashboard data received:",$),o.updateStages&&o.updateStages($.stages||[]),o.updateEmployees&&o.updateEmployees($.employees||[]),o.updateZeroPointTickets&&o.updateZeroPointTickets($.zeroPointTickets||{}),o.updateSectorStats&&o.updateSectorStats($.metadata||{}),console.log(`‚úÖ [useUniversalDashboardActions] Sector data loaded successfully for ${e}`,{stagesCount:($.stages||[]).length,employeesCount:($.employees||[]).length,ticketsCount:$.metadata?.totalTickets||0}),$}catch(w){throw console.error(`‚ùå [useUniversalDashboardActions] Failed to load sector data for ${e}:`,w),console.error("üîç [useUniversalDashboardActions] Error details:",{message:w.message,stack:w.stack}),o.setError&&o.setError(w.message),w}},i=async(f,w,$=null)=>{try{await t().updateTicketAssignment(f,w,$),console.log("‚úÖ [useUniversalDashboardActions] Ticket assignment updated successfully"),await r({forceRefresh:!0})}catch(W){throw console.error("[useUniversalDashboardActions] Failed to update ticket assignment:",W),console.error("‚ùå [useUniversalDashboardActions] Failed to update ticket assignment:",W.message),W}},n=async f=>{try{const $=await t().createTicket(f);return console.log(`‚úÖ [useUniversalDashboardActions] Ticket created successfully: "${$.title}"`),await r({forceRefresh:!0}),$}catch(w){throw console.error("[useUniversalDashboardActions] Failed to create ticket:",w),console.error("‚ùå [useUniversalDashboardActions] Failed to create ticket:",w.message),w}},l=async(f,w,$=null)=>{try{if(!k(f,w))throw new Error("–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ");await i(f.id,w,$),console.log(`‚úÖ [useUniversalDashboardActions] Ticket moved to stage: "${C(w)}"`)}catch(W){throw console.error("[useUniversalDashboardActions] Failed to move ticket:",W),console.error("‚ùå [useUniversalDashboardActions] Failed to move ticket:",W.message),W}},d=async(f,w)=>{try{const $=t(),W=S(f);if(!W)throw new Error("–¢–∏–∫–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");await $.updateTicketAssignment(f,W.stageId,w);const L=o.getEmployeeById(w),D=L?L.name:"—Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É";console.log(`‚úÖ [useUniversalDashboardActions] Ticket assigned to: ${D}`),await r({forceRefresh:!0})}catch($){throw console.error("[useUniversalDashboardActions] Failed to assign ticket:",$),console.error("‚ùå [useUniversalDashboardActions] Failed to assign ticket:",$.message),$}},g=async()=>{try{t().clearCache(),console.log("‚úÖ [useUniversalDashboardActions] Sector cache cleared successfully"),await r({forceRefresh:!0})}catch(f){throw console.error("[useUniversalDashboardActions] Failed to clear cache:",f),console.error("‚ùå [useUniversalDashboardActions] Failed to clear cache:",f.message),f}},p=async()=>{try{return await t().getSectorStats()}catch(f){throw console.error("[useUniversalDashboardActions] Failed to get sector stats:",f),f}},T=()=>{Se(async()=>{const{useRouter:f}=await import("./chunk-BxL3V5Fo.js").then(w=>w.a6);return{useRouter:f}},[],import.meta.url).then(({useRouter:f})=>{f().push("/graph/state")}).catch(f=>{console.error("Failed to navigate to graph state:",f)})},v=()=>{Se(async()=>{const{useRouter:f}=await import("./chunk-BxL3V5Fo.js").then(w=>w.a6);return{useRouter:f}},[],import.meta.url).then(({useRouter:f})=>{f().push("/graph/admission-closure")}).catch(f=>{console.error("Failed to navigate to admission closure:",f)})},y=()=>{Se(async()=>{const{useRouter:f}=await import("./chunk-BxL3V5Fo.js").then(w=>w.a6);return{useRouter:f}},[],import.meta.url).then(({useRouter:f})=>{f().push("/tickets/time-tracking")}).catch(f=>{console.error("Failed to navigate to tickets management:",f)})},k=(f,w)=>!(!f||!w||f.stageId===w),S=f=>{for(const w of o.stages){const $=w.tickets?.find(W=>W.id===f);if($)return{...$,stageId:w.id}}for(const[w,$]of Object.entries(o.zeroPointTickets)){const W=$.find(L=>L.id===f);if(W)return{...W,stageId:w}}return null},C=f=>{const w=o.getStageById(f);return w?w.name:f};return{loadSectorData:r,updateTicketAssignment:i,createTicket:n,moveTicket:l,assignTicketToEmployee:d,clearCache:g,getSectorStats:p,navigateToGraphState:T,navigateToAdmissionClosure:v,navigateToTicketsManagement:y,canMoveTicket:k,findTicket:S,getStageName:C}}const kn={name:"SectorDashboard",components:{BackButton:_a},props:{sectorId:{type:String,required:!0,validator:o=>["1c","pdm","bitrix24","infrastructure"].includes(o)}},setup(o){if(console.log("üö®üö®üö® [SectorDashboard] SETUP STARTED - props:",o),console.log("üö®üö®üö® [SectorDashboard] sectorId:",o?.sectorId),console.log("üö®üö®üö® [SectorDashboard] props type:",typeof o),!o||!o.sectorId)return console.error("‚ùå [SectorDashboard] Invalid props received:",o),{isLoading:!1,error:"–ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞",stages:[],employees:[],totalTickets:0,sectorName:"–û—à–∏–±–∫–∞",hasData:!1};console.log(`üéØ [SectorDashboard] SETUP called for sector: ${o.sectorId}`);try{const e=Xe(),s=ks();console.log(`[SectorDashboard] Initializing composables for sector: ${o.sectorId}`);const t=Go(o.sectorId),r=yn(t,o.sectorId);console.log("[SectorDashboard] State initialized:",{hasStages:!!stages,stagesType:typeof stages,stagesIsArray:Array.isArray(stages),stagesValue:stages});const i=I(null),n=I(null),l=M(()=>({"1c":"1–°",pdm:"PDM",bitrix24:"–ë–∏—Ç—Ä–∏–∫—Å24",infrastructure:"–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞"})[o.sectorId]||o.sectorId),d=M(()=>(i.value,!1)),g=()=>{e.push("/")},p=()=>{r.loadSectorData({forceRefresh:!0})},T=()=>{e.push({name:s.name,query:{...s.query,diagnostics:"true"}})},v=()=>{r.clearCache()},y=()=>{r.navigateToGraphState()},k=()=>{r.navigateToAdmissionClosure()},S=()=>{r.navigateToTicketsManagement()};return $e(async()=>{console.log(`[SectorDashboard] üöÄ Mounted for sector: ${o.sectorId} (${l.value})`);try{console.log(`[SectorDashboard] üì° Starting data load for sector: ${o.sectorId}`),await r.loadSectorData(),console.log(`[SectorDashboard] ‚úÖ Data loaded successfully for sector: ${o.sectorId}`,{hasData,totalTickets,stagesCount:Array.isArray(stages)?stages.length:0,employeesCount:Array.isArray(employees)?employees.length:0,completionRate,stages:Array.isArray(stages)?stages.map(C=>({id:C.id,name:C.name,ticketsCount:C.tickets?.length||0})):[],renderingCondition:!isLoading&&!error,stagesLength:Array.isArray(stages)?stages.length:0})}catch(C){console.error(`[SectorDashboard] ‚ùå Failed to load initial data for sector ${o.sectorId}:`,C),console.log("[SectorDashboard] üîç Error details:",{message:C.message,stack:C.stack})}}),{...t,...r,sectorName:l,currentUser:i,draggedTicket:n,isUserAdmin:d,handleGoHome:g,handleRetry:p,navigateToGraphState:y,navigateToAdmissionClosure:k,navigateToTicketsManagement:S,getZeroPointTickets:t.getZeroPointTickets}}catch(e){return console.error(`[SectorDashboard] üí• CRITICAL ERROR in setup for sector ${o.sectorId}:`,e),console.error("[SectorDashboard] Error stack:",e.stack),console.error("[SectorDashboard] Error message:",e.message),{isLoading:!1,error:`–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: ${e.message}`,stages:[],employees:[],totalTickets:0,sectorName:o.sectorId,hasData:!1}}}},bn={style:{background:"yellow",padding:"10px","margin-bottom":"10px",border:"2px solid red"}},_n={key:0,class:"loading-indicator"},wn={key:1,class:"error-indicator"},Cn={class:"dashboard-header"},Tn={class:"breadcrumbs-row"},Sn={class:"breadcrumb-current"},Dn={class:"header-actions"},En={key:2,class:"sector-stats"},An={class:"stat-item"},$n={class:"stat-value"},In={class:"stat-item"},Mn={class:"stat-value"},Nn={class:"stat-item"},xn={class:"stat-value"},Ln={class:"stat-item"},Pn={class:"stat-value"},On={key:0,class:"loading-container"},Rn={key:0,class:"error-message"},Bn={key:3,class:"error-message-container"},Un={class:"error-message"},Wn={class:"error-header"},Fn={class:"error-text"},Hn={class:"error-actions"},jn={key:0,class:"dashboard-content"},Vn={style:{background:"#f0f0f0",padding:"10px","margin-bottom":"20px","font-size":"12px"}},zn={key:0,class:"stages-container"},Gn={class:"stage-header"},Kn={class:"stage-stats"},qn={class:"stat"},Yn={class:"stat"},Xn={class:"stage-content"},Jn={key:0,class:"tickets-list"},Zn={class:"ticket-id"},Qn={class:"ticket-title"},er={key:0,class:"more-tickets"},tr={key:1,class:"no-tickets"},sr={key:1,class:"loading-message"},ar={key:2,class:"error-message"},or={key:3,class:"empty-state"},nr={class:"empty-state-content"},rr={class:"sector-info"};function ir(o,e,s,t,r,i){const n=be("BackButton");return c(),u("div",{class:X(`dashboard-sector-${s.sectorId} ${o.draggedTicket?"is-dragging":""}`)},[a("div",bn," üö® DEBUG: SectorDashboard RENDERED for sector: "+m(s.sectorId)+" at "+m(new Date().toISOString()),1),o.isLoading?(c(),u("div",_n,[...e[11]||(e[11]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞...",-1)])])):o.error?(c(),u("div",wn,[e[12]||(e[12]=a("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),a("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: "+m(o.error),1),a("button",{onClick:e[0]||(e[0]=(...l)=>o.handleRetry&&o.handleRetry(...l)),class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):A("",!0),a("div",Cn,[a("div",Tn,[a("button",{class:"btn-home-link",type:"button",onClick:e[1]||(e[1]=(...l)=>o.handleGoHome&&o.handleGoHome(...l)),title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),e[13]||(e[13]=a("span",{class:"breadcrumb-separator"},"/",-1)),a("span",Sn,"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ "+m(o.sectorName),1)]),ne(n,{variant:"header"}),a("h1",null,"–î–∞—à–±–æ—Ä–¥ - –°–µ–∫—Ç–æ—Ä "+m(o.sectorName),1),a("div",Dn,[o.isDiagnosticsEnabled&&o.isUserAdmin?(c(),u("button",{key:0,onClick:e[2]||(e[2]=(...l)=>o.clearCache&&o.clearCache(...l)),class:"btn-clear-cache",title:"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à —Å–µ–∫—Ç–æ—Ä–∞ –∏ —Ç–∏–∫–µ—Ç–æ–≤"},[...e[14]||(e[14]=[a("span",{class:"icon"},"‚ôªÔ∏è",-1),a("span",null,"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à",-1)])])):A("",!0),!o.isDiagnosticsEnabled&&o.isUserAdmin?(c(),u("button",{key:1,onClick:e[3]||(e[3]=(...l)=>o.enableDiagnostics&&o.enableDiagnostics(...l)),class:"btn-enable-diagnostics",title:"–í–∫–ª—é—á–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º"},[...e[15]||(e[15]=[a("span",{class:"icon"},"üîç",-1),a("span",null,"–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",-1)])])):A("",!0),a("button",{onClick:e[4]||(e[4]=(...l)=>o.navigateToGraphState&&o.navigateToGraphState(...l)),class:"btn-navigate-graph-state",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞"},[...e[16]||(e[16]=[a("span",{class:"icon"},"üìä",-1),a("span",null,"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",-1)])]),a("button",{onClick:e[5]||(e[5]=(...l)=>o.navigateToAdmissionClosure&&o.navigateToAdmissionClosure(...l)),class:"btn-navigate-admission-closure",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É –ø—Ä–∏–µ–º–∫–∏-–∑–∞–∫—Ä—ã—Ç–∏—è"},[...e[17]||(e[17]=[a("span",{class:"icon"},"üìà",-1),a("span",null,"–ü—Ä–∏–µ–º–∫–∞-–∑–∞–∫—Ä—ã—Ç–∏–µ",-1)])]),a("button",{onClick:e[6]||(e[6]=(...l)=>o.navigateToTicketsManagement&&o.navigateToTicketsManagement(...l)),class:"btn-navigate-tickets",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ç–∏–∫–µ—Ç–∞–º–∏"},[...e[18]||(e[18]=[a("span",{class:"icon"},"üìã",-1),a("span",null,"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏",-1)])])])]),o.isLoading?A("",!0):(c(),u("div",En,[a("div",An,[a("div",$n,m(o.totalTickets),1),e[19]||(e[19]=a("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤",-1))]),a("div",In,[a("div",Mn,m(o.employees.length),1),e[20]||(e[20]=a("div",{class:"stat-label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",-1))]),a("div",Nn,[a("div",xn,m(o.completionRate)+"%",1),e[21]||(e[21]=a("div",{class:"stat-label"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ",-1))]),a("div",Ln,[a("div",Pn,m(Array.isArray(o.stages)?o.stages.length:0),1),e[22]||(e[22]=a("div",{class:"stat-label"},"–≠—Ç–∞–ø–æ–≤",-1))])])),ne(Ae,{name:"fade",mode:"out-in"},{default:pe(()=>[o.isLoading?(c(),u("div",On,[e[23]||(e[23]=a("div",{class:"loading-spinner"},null,-1)),a("p",null,m(o.currentStep||"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞..."),1),o.error?(c(),u("div",Rn,[a("p",null,m(o.error),1),a("button",{onClick:e[7]||(e[7]=(...l)=>o.handleRetry&&o.handleRetry(...l)),class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):A("",!0)])):A("",!0)]),_:1}),o.error&&!o.isLoading?(c(),u("div",Bn,[a("div",Un,[a("div",Wn,[e[24]||(e[24]=a("span",{class:"error-icon"},"‚ùå",-1)),e[25]||(e[25]=a("h3",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞",-1)),a("button",{onClick:e[8]||(e[8]=(...l)=>o.handleErrorClose&&o.handleErrorClose(...l)),class:"error-close","aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"‚úï")]),a("p",Fn,m(o.error),1),a("div",Hn,[a("button",{onClick:e[9]||(e[9]=(...l)=>o.handleRetry&&o.handleRetry(...l)),class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É")])])])):A("",!0),ne(Ae,{name:"dashboard-fade"},{default:pe(()=>[!o.isLoading&&!o.error?(c(),u("div",jn,[a("div",Vn," DEBUG: stages.length = "+m(Array.isArray(o.stages)?o.stages.length:"N/A")+", isLoading = "+m(o.isLoading)+", error = "+m(o.error),1),Array.isArray(o.stages)&&o.stages.length>0?(c(),u("div",zn,[(c(!0),u(ee,null,te(Array.isArray(o.stages)?o.stages:[],l=>(c(),u("div",{key:l.id,class:"stage-card",style:we({borderLeftColor:l.color})},[a("div",Gn,[a("h3",null,m(l.name),1),a("div",Kn,[a("span",qn,m(l.tickets?.length||0)+" —Ç–∏–∫–µ—Ç–æ–≤",1),a("span",Yn,m(l.employees?.length||0)+" —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",1)])]),a("div",Xn,[l.tickets&&l.tickets.length>0?(c(),u("div",Jn,[(c(!0),u(ee,null,te(l.tickets.slice(0,3),d=>(c(),u("div",{key:d.id,class:"ticket-item"},[a("span",Zn,"#"+m(d.id),1),a("span",Qn,m(d.title),1)]))),128)),l.tickets.length>3?(c(),u("div",er," ...–∏ –µ—â–µ "+m(l.tickets.length-3)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1)):A("",!0)])):(c(),u("div",tr," –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ "))])],4))),128))])):o.isLoading?(c(),u("div",sr," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞... ")):o.error?(c(),u("div",ar," –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: "+m(o.error),1)):(c(),u("div",or,[a("div",nr,[e[32]||(e[32]=a("div",{class:"empty-icon"},"üìã",-1)),a("h3",null,'–°–µ–∫—Ç–æ—Ä "'+m(o.sectorName)+'" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ',1),e[33]||(e[33]=a("p",null,"–≠—Ç–æ—Ç —Å–µ–∫—Ç–æ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.",-1)),a("div",rr,[e[31]||(e[31]=a("h4",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ–∫—Ç–æ—Ä–µ:",-1)),a("ul",null,[a("li",null,[e[26]||(e[26]=a("strong",null,"ID:",-1)),ce(" "+m(s.sectorId),1)]),a("li",null,[e[27]||(e[27]=a("strong",null,"–ù–∞–∑–≤–∞–Ω–∏–µ:",-1)),ce(" "+m(o.sectorName),1)]),a("li",null,[e[28]||(e[28]=a("strong",null,"–≠—Ç–∞–ø–æ–≤:",-1)),ce(" "+m(Array.isArray(o.stages)?o.stages.length:0),1)]),a("li",null,[e[29]||(e[29]=a("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",-1)),ce(" "+m(o.employees.length),1)]),a("li",null,[e[30]||(e[30]=a("strong",null,"–¢–∏–∫–µ—Ç–æ–≤:",-1)),ce(" "+m(o.totalTickets),1)])])]),a("button",{onClick:e[10]||(e[10]=(...l)=>o.handleRetry&&o.handleRetry(...l)),class:"btn-retry"},"–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ")])]))])):A("",!0)]),_:1}),ne(n,{variant:"floating"})],2)}const lr=de(kn,[["render",ir],["__scopeId","data-v-2b2ff622"]]),Aa="/api/tickets-time-tracking-sector-1c.php";function cr(o){if(!o)return{meta:null,data:{totalElapsedTime:0,totalElapsedTimeUnit:"hours",totalRecordsCount:0,weeks:[],employeesSummary:[]}};const e=o.data||o.result||o,s=e.meta||o.meta||null;return{meta:{weekNumber:s?.weekNumber??null,weekStartUtc:s?.weekStartUtc??null,weekEndUtc:s?.weekEndUtc??null,totalWeeks:s?.totalWeeks??0,sector1CEmployeesCount:s?.sector1CEmployeesCount??0},data:{totalElapsedTime:e.data?.totalElapsedTime??e.totalElapsedTime??0,totalElapsedTimeUnit:e.data?.totalElapsedTimeUnit??e.totalElapsedTimeUnit??"hours",totalRecordsCount:e.data?.totalRecordsCount??e.totalRecordsCount??0,weeks:e.data?.weeks??e.weeks??[],employeesSummary:e.data?.employeesSummary??e.employeesSummary??[]}}}async function dr(o={}){const{product:e="1C",weekStartUtc:s=null,weekEndUtc:t=null,weeksCount:r=4}=o;try{const i=et(Aa),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:e,weekStartUtc:s,weekEndUtc:t,weeksCount:r})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const l=await n.json();if(l.error)throw new Error(l.error_description||l.error||"Unknown error");const d=cr(l);if(l.cache_used===!0){const{CacheNotificationService:g}=await Se(async()=>{const{CacheNotificationService:p}=await Promise.resolve().then(()=>C$);return{CacheNotificationService:p}},void 0,import.meta.url);g.notifyCacheUsed("–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°")}return d}catch(i){throw console.error("[TimeTrackingService] Error fetching time tracking data:",i),i}}async function ur({taskIds:o,employeeId:e,weekNumber:s,page:t=1,perPage:r=10}){if(!o||!Array.isArray(o)||o.length===0)return{tasks:[],pagination:{totalTasks:0,currentPage:1,perPage:r,totalPages:0}};try{const i=et(Aa),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:"1C",includeTaskDetails:!0,taskIds:o,employeeId:e||void 0,weekNumber:s||void 0,page:t,perPage:r})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const l=await n.json();if(!l.success)throw new Error(l.error||l.error_description||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–¥–∞—á–∞—Ö");return{tasks:l.data.tasks||[],pagination:l.data.pagination||{totalTasks:0,currentPage:1,perPage:r,totalPages:0}}}catch(i){throw console.error("[timeTrackingService] Error loading tasks details:",i),i}}const $a={getTimeTrackingData:dr,getTasksDetails:ur};function qe(o,e=1){return typeof o!="number"||isNaN(o)?"0 —á":`${o.toFixed(e)} —á`}function rs(o,e){if(!o||!e)return`–ù–µ–¥–µ–ª—è ${o||"?"}`;try{const s=new Date(e),t=new Date(s);t.setDate(t.getDate()+6);const r=s.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}),i=t.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"});return`–ù–µ–¥–µ–ª—è ${o} (${r} - ${i})`}catch(s){return console.error("[TimeTrackingUtils] Error formatting week label:",s),`–ù–µ–¥–µ–ª—è ${o}`}}function gr(o){return!o||!o.data?!1:o.data.totalRecordsCount>0||o.data.weeks&&o.data.weeks.length>0}const mr={class:"ttt-summary"},hr={class:"summary-cards"},fr={class:"summary-card summary-card--total"},vr={class:"summary-card__content"},pr={class:"summary-card__value"},yr={class:"summary-card summary-card--employees"},kr={class:"summary-card__content"},br={class:"summary-card__value"},_r={class:"summary-card summary-card--average"},wr={class:"summary-card__content"},Cr={class:"summary-card__value"},Tr={__name:"TicketsTimeTrackingSummary",props:{data:{type:Object,required:!0}},setup(o){const e=o,s=M(()=>e.data?.data?.totalElapsedTime||0),t=M(()=>e.data?.meta?.sector1CEmployeesCount||0),r=M(()=>{const l=s.value,d=t.value;return d>0?l/d:0}),i=M(()=>s.value===0?"0.0 —á":qe(s.value,1)),n=M(()=>r.value===0?"0.00 —á":qe(r.value,2));return(l,d)=>(c(),u("div",mr,[a("div",hr,[a("div",fr,[d[1]||(d[1]=a("div",{class:"summary-card__icon"},"‚è±",-1)),a("div",vr,[d[0]||(d[0]=a("div",{class:"summary-card__label"},"–û–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç",-1)),a("div",pr,m(i.value),1)])]),a("div",yr,[d[3]||(d[3]=a("div",{class:"summary-card__icon"},"üë•",-1)),a("div",kr,[d[2]||(d[2]=a("div",{class:"summary-card__label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ —Å–µ–∫—Ç–æ—Ä–µ",-1)),a("div",br,m(t.value),1)])]),a("div",_r,[d[5]||(d[5]=a("div",{class:"summary-card__icon"},"üìä",-1)),a("div",wr,[d[4]||(d[4]=a("div",{class:"summary-card__label"},"–°—Ä–µ–¥–Ω—è—è –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞",-1)),a("div",Cr,m(n.value),1)])])])]))}},Sr=de(Tr,[["__scopeId","data-v-51b124c7"]]),Dr={class:"ttt-table-container"},Er={key:0,class:"ttt-table-loading"},Ar={key:1,class:"ttt-table-error"},$r={key:2,class:"ttt-table-empty"},Ir={key:3,class:"ttt-table-wrapper"},Mr={class:"ttt-table"},Nr=["onClick"],xr={class:"ttt-table__header-week-date"},Lr=["onClick"],Pr={class:"ttt-table__cell-employee"},Or=["onClick"],Rr={class:"ttt-table__cell-total"},Br={class:"ttt-table__row-total"},Ur=["onClick"],Wr={class:"ttt-table__cell-total"},Fr={__name:"TicketsTimeTrackingTable",props:{data:{type:Object,required:!0},loading:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["cell-click","employee-click","week-click"],setup(o,{emit:e}){const s=o,t=e,r=M(()=>s.data?.data?.weeks||[]),i=M(()=>{if(!s.data||!s.data.data||!s.data.data.weeks)return null;const v=s.data.data.weeks||[],k=(s.data.data.employeesSummary||[]).map(f=>{const w={};let $=0;return v.forEach(W=>{const D=W.employees?.find(E=>E.id===f.id)?.elapsedTime||0;w[W.weekNumber]=D,$+=D}),{id:f.id,name:f.name,weeks:w,total:$}}),S={};let C=0;return v.forEach(f=>{S[f.weekNumber]=f.totalElapsedTime||0,C+=f.totalElapsedTime||0}),{employees:k,weekTotals:S,grandTotal:C}}),n=(v,y)=>i.value?.employees.find(S=>S.id===v)?.weeks[y]||0,l=v=>i.value?.weekTotals[v]||0,d=v=>{if(!v)return"";try{return new Date(v).toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}catch{return""}},g=(v,y)=>{const k=i.value?.employees.find(C=>C.id===v),S=s.data?.data?.weeks?.find(C=>C.weekNumber===y);k&&S&&t("cell-click",{employee:k,week:S,elapsedTime:n(v,y)})},p=v=>{const y=i.value?.employees.find(k=>k.id===v);y&&t("employee-click",{employee:y,weeks:r.value.map(k=>({week:k,elapsedTime:n(v,k.weekNumber)}))})},T=v=>{const y=r.value.find(k=>k.weekNumber===v);y&&t("week-click",{week:y,employees:i.value?.employees.map(k=>({employee:k,elapsedTime:n(k.id,v)})).filter(k=>k.elapsedTime>0)})};return(v,y)=>(c(),u("div",Dr,[o.loading?(c(),u("div",Er," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):o.error?(c(),u("div",Ar,m(o.error),1)):!i.value||i.value.employees.length===0?(c(),u("div",$r," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ")):(c(),u("div",Ir,[a("table",Mr,[a("thead",null,[a("tr",null,[y[1]||(y[1]=a("th",{class:"ttt-table__header-employee"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",-1)),(c(!0),u(ee,null,te(r.value,k=>(c(),u("th",{key:k.weekNumber,class:X(["ttt-table__header-week",{"ttt-table__header--clickable":!0}]),onClick:S=>T(k.weekNumber)},[ce(" –ù–µ–¥–µ–ª—è "+m(k.weekNumber),1),y[0]||(y[0]=a("br",null,null,-1)),a("span",xr,m(d(k.weekStartUtc)),1)],8,Nr))),128)),y[2]||(y[2]=a("th",{class:"ttt-table__header-total"},"–ò—Ç–æ–≥–æ",-1))])]),a("tbody",null,[(c(!0),u(ee,null,te(i.value.employees,k=>(c(),u("tr",{key:k.id,class:X(["ttt-table__row",{"ttt-table__row--clickable":!0}]),onClick:S=>p(k.id)},[a("td",Pr,m(k.name),1),(c(!0),u(ee,null,te(r.value,S=>(c(),u("td",{key:`${k.id}-${S.weekNumber}`,class:X(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:Ce(C=>g(k.id,S.weekNumber),["stop"])},m(Ue(qe)(n(k.id,S.weekNumber))),9,Or))),128)),a("td",Rr,[a("strong",null,m(Ue(qe)(k.total)),1)])],8,Lr))),128)),a("tr",Br,[y[3]||(y[3]=a("td",{class:"ttt-table__cell-employee"},[a("strong",null,"–í–°–ï–ì–û")],-1)),(c(!0),u(ee,null,te(r.value,k=>(c(),u("td",{key:`total-${k.weekNumber}`,class:X(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:S=>T(k.weekNumber)},[a("strong",null,m(Ue(qe)(l(k.weekNumber))),1)],8,Ur))),128)),a("td",Wr,[a("strong",null,m(Ue(qe)(i.value.grandTotal)),1)])])])])]))]))}},Hr=de(Fr,[["__scopeId","data-v-8021e5e4"]]),jr={class:"modal-header"},Vr={class:"modal-body"},zr={key:"level-1",class:"detail-cell"},Gr={class:"detail-info"},Kr={key:0,class:"tasks-list"},qr={class:"task-header"},Yr={class:"task-label"},Xr={class:"task-time"},Jr={key:0,class:"ticket-info"},Zr={class:"ticket-label"},Qr=["title"],ei={key:1,class:"ticket-title"},ti={key:1,class:"ticket-info ticket-info--no-ticket"},si={class:"detail-total"},ai={key:0,class:"detail-actions"},oi={key:"level-2",class:"tasks-list-level"},ni={class:"tasks-list-header"},ri={class:"tasks-list-title"},ii={class:"tasks-list-content"},li={key:"loading",class:"loading-state"},ci={key:"error",class:"error-state"},di={class:"error-message"},ui={key:"empty",class:"empty-state"},gi={key:"tasks",class:"tasks-cards-container"},mi=["onClick"],hi={class:"task-card__header"},fi={class:"task-card__number"},vi={key:0,class:"task-card__time"},pi={class:"task-card__title"},yi={class:"task-card__dates"},ki={class:"task-card__date-item"},bi={class:"date-value"},_i={class:"task-card__date-item"},wi={class:"task-card__date-item"},Ci={class:"date-value"},Ti={key:0,class:"task-card__ticket"},Si={class:"ticket-header"},Di={class:"ticket-header__left"},Ei={class:"ticket-id"},Ai=["title"],$i={class:"ticket-title"},Ii={class:"ticket-meta"},Mi={class:"ticket-meta__row"},Ni={class:"ticket-meta__item"},xi={class:"meta-value"},Li={class:"ticket-meta__item"},Pi={class:"meta-value"},Oi={class:"ticket-meta__row"},Ri={class:"ticket-meta__item"},Bi={class:"meta-value"},Ui={class:"ticket-meta__item"},Wi={class:"meta-value"},Fi={class:"ticket-dates"},Hi={class:"ticket-date-item"},ji={class:"date-value"},Vi={key:1,class:"task-card__no-ticket"},zi={key:0,class:"tasks-pagination"},Gi=["disabled"],Ki={class:"pagination-pages"},qi=["onClick"],Yi=["disabled"],Xi={key:"employee",class:"detail-employee"},Ji={class:"detail-info"},Zi={class:"weeks-list"},Qi={class:"week-header"},el={class:"week-label"},tl={class:"week-time"},sl={key:"week",class:"detail-week"},al={class:"detail-info"},ol={class:"employees-list"},nl={class:"employee-header"},rl={class:"employee-label"},il={class:"employee-time"},ll={__name:"TimeTrackingDetailModal",props:{cellData:{type:Object,default:null}},emits:["close"],setup(o,{emit:e}){const s=o,t=e,r=I(1),i=I([]),n=I(!1),l=I(null),d=I(1),g=I(10),p=M(()=>{if(!s.cellData)return"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç";if(r.value===2)return`–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: ${s.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}, –ù–µ–¥–µ–ª—è ${s.cellData.week?.weekNumber||"?"}`;if(s.cellData.type==="employee")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${s.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}`;if(s.cellData.type==="week")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: –ù–µ–¥–µ–ª—è ${s.cellData.week?.weekNumber||"?"}`;const Y=s.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",H=s.cellData.week?.weekNumber||"?",Z=qe(s.cellData.elapsedTime||0);return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${Y}, –ù–µ–¥–µ–ª—è ${H} (${Z})`}),T=M(()=>s.cellData?.week?.employees&&s.cellData.week.employees.find(H=>H.id===s.cellData.employee?.id)?.tasksCount||0),v=M(()=>s.cellData?.week?.employees&&s.cellData.week.employees.find(H=>H.id===s.cellData.employee?.id)?.ticketsCount||0);M(()=>s.cellData?.week?.weekNumber||null);const y=I({totalTasks:0,currentPage:1,perPage:10,totalPages:0}),k=M(()=>y.value.totalPages),S=M(()=>i.value),C=M(()=>{const Y=[];let Z=Math.max(1,y.value.currentPage-Math.floor(2.5)),fe=Math.min(k.value,Z+5-1);fe-Z<4&&(Z=Math.max(1,fe-5+1));for(let P=Z;P<=fe;P++)Y.push(P);return Y}),f=Y=>{if(!Y||Y.length===0)return"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω";if(Y.length===1)return rs(Y[0].week.weekNumber,Y[0].week.weekStartUtc);const H=Y[0].week,Z=Y[Y.length-1].week;return`${rs(H.weekNumber,H.weekStartUtc)} - ${rs(Z.weekNumber,Z.weekStartUtc)}`},w=Y=>Y?rs(Y.weekNumber,Y.weekStartUtc):"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω",$=Y=>{if(!Y)return"-";try{const H=new Date(Y);return isNaN(H.getTime())?"-":H.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(H){return console.warn("[TimeTrackingDetailModal] Error formatting date:",Y,H),"-"}},W=(Y,H)=>{if(H)try{const Z=new Date(H);if(!isNaN(Z.getTime()))return!1}catch{}if(!Y)return!1;try{const Z=new Date(Y);return isNaN(Z.getTime())?!1:new Date>Z}catch(Z){return console.warn("[TimeTrackingDetailModal] Error checking overdue:",Y,Z),!1}},L=Y=>{const H=Y.closedDate?new Date(Y.closedDate):null,Z=W(Y.deadline,Y.closedDate);return{"task-card--completed":!!H,"task-card--overdue":Z,"task-card--in-progress":!H&&!Z}},D=async()=>{r.value=2,await R()},E=()=>{r.value=1,i.value=[],l.value=null,d.value=1,y.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0}},x=Y=>!Y||typeof Y!="object"?!1:!Y.id||typeof Y.id!="number"?(console.warn("[TimeTrackingDetailModal] Invalid task (no ID):",Y),!1):!0,R=async()=>{if(!s.cellData?.week?.employees||!s.cellData.employee){l.value="–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á";return}n.value=!0,l.value=null;try{const Y=s.cellData.week.employees.find(fe=>fe.id===s.cellData.employee?.id);if(!Y){i.value=[];return}let H=[];if(Array.isArray(Y.tasks)&&Y.tasks.length>0&&(H=Y.tasks.map(fe=>typeof fe=="object"&&fe!==null&&fe.id?fe.id:typeof fe=="number"?fe:null).filter(fe=>fe!==null&&fe>0)),H.length===0){i.value=[];return}const Z=await $a.getTasksDetails({taskIds:H,employeeId:s.cellData.employee.id,weekNumber:s.cellData.week.weekNumber,page:d.value,perPage:g.value});if(!Z||!Array.isArray(Z.tasks)){console.error("[TimeTrackingDetailModal] Invalid response format:",Z),l.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞",i.value=[];return}i.value=Z.tasks.filter(x),y.value=Z.pagination||{totalTasks:0,currentPage:1,perPage:g.value,totalPages:0},d.value=y.value.currentPage}catch(Y){console.error("[TimeTrackingDetailModal] Error loading tasks details:",{error:Y,taskIds:s.cellData?.week?.employees?.find(Z=>Z.id===s.cellData.employee?.id)?.tasks?.map(Z=>Z.id)||[],employeeId:s.cellData.employee?.id,weekNumber:s.cellData.week?.weekNumber,timestamp:new Date().toISOString()});const H=Y.message||"";H.includes("network")||H.includes("fetch")||H.includes("Failed to fetch")?l.value="–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.":H.includes("timeout")?l.value="–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":H.includes("403")||H.includes("401")?l.value="–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.":H.includes("404")?l.value="–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.":H.includes("500")?l.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":l.value=H||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á",i.value=[]}finally{n.value=!1}},U=()=>{d.value=1,R()};Ne(d,()=>{r.value===2&&R()});const G=Y=>{if(Y>=1&&Y<=k.value&&Y!==d.value){d.value=Y;const H=document.querySelector(".tasks-cards-container");H&&(H.scrollTop=0)}},q=Y=>{console.log("[TimeTrackingDetailModal] Task clicked:",Y.id)},oe=()=>{t("close")};return Ne(()=>s.cellData,Y=>{Y||(r.value=1,i.value=[],l.value=null,d.value=1,y.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0})}),(Y,H)=>(c(),he(It,{to:"body"},[o.cellData?(c(),u("div",{key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:Ce(oe,["self"]),onKeydown:Be(oe,["esc"])},[a("div",{class:"modal-content",onClick:H[2]||(H[2]=Ce(()=>{},["stop"]))},[a("div",jr,[a("h2",null,m(p.value),1),a("button",{class:"close-button",onClick:oe,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),a("div",Vr,[ne(Ae,{name:"level",mode:"out-in"},{default:pe(()=>[r.value===1&&(o.cellData.type==="cell"||!o.cellData.type&&o.cellData.employee&&o.cellData.week)?(c(),u("div",zr,[a("div",Gr,[a("p",null,[H[3]||(H[3]=a("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),ce(" "+m(o.cellData.employee?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),a("p",null,[H[4]||(H[4]=a("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),ce(" "+m(o.cellData.week?.weekNumber||"?"),1)]),a("p",null,[H[5]||(H[5]=a("strong",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),ce(" "+m(Ue(qe)(o.cellData.elapsedTime||0)),1)])]),o.cellData.week?.employees?(c(),u("div",Kr,[H[8]||(H[8]=a("h3",null,"–ó–∞–¥–∞—á–∏ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã:",-1)),(c(!0),u(ee,null,te(o.cellData.week.employees.filter(Z=>Z.id===o.cellData.employee?.id),Z=>(c(),u("div",{key:Z.id,class:"employee-tasks"},[(c(!0),u(ee,null,te(Z.tasks,(fe,P)=>(c(),u("div",{class:"task-item",key:P},[a("div",qr,[a("span",Yr,"–ó–∞–¥–∞—á–∞ #"+m(fe.id||P+1),1),a("span",Xr,m(Ue(qe)(fe.elapsedTime||0)),1)]),fe.ticket?(c(),u("div",Jr,[a("span",Zr,"–¢–∏–∫–µ—Ç #"+m(fe.ticket.id),1),fe.ticket.createdWeek&&fe.ticket.createdWeek!==o.cellData.week.weekNumber?(c(),u("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${fe.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${o.cellData.week.weekNumber}`}," (—Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ "+m(fe.ticket.createdWeek)+") ",9,Qr)):A("",!0),fe.ticket.title?(c(),u("div",ei,m(fe.ticket.title),1)):A("",!0)])):(c(),u("div",ti,[...H[6]||(H[6]=[a("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])]))]))),128))]))),128)),a("div",si,[a("p",null,[H[7]||(H[7]=a("strong",null,"–ò—Ç–æ–≥–æ:",-1)),ce(" "+m(Ue(qe)(o.cellData.elapsedTime||0))+" ("+m(T.value)+" –∑–∞–¥–∞—á, "+m(v.value)+" —Ç–∏–∫–µ—Ç–æ–≤) ",1)])]),T.value>0?(c(),u("div",ai,[a("button",{class:"btn btn-primary btn-tasks-list",onClick:D}," üìã –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á ")])):A("",!0)])):A("",!0)])):r.value===2?(c(),u("div",oi,[a("div",ni,[a("button",{class:"btn-back",onClick:E,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê –ù–∞–∑–∞–¥ "),a("h3",ri," –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: "+m(o.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫")+", –ù–µ–¥–µ–ª—è "+m(o.cellData.week?.weekNumber||"?"),1)]),a("div",ii,[ne(Ae,{name:"loading",mode:"out-in"},{default:pe(()=>[n.value?(c(),u("div",li,[...H[9]||(H[9]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...",-1)])])):l.value?(c(),u("div",ci,[H[10]||(H[10]=a("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),H[11]||(H[11]=a("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),a("p",di,m(l.value),1),a("button",{class:"btn btn-retry",onClick:U},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):i.value.length===0?(c(),u("div",ui,[...H[12]||(H[12]=[a("div",{class:"empty-state-icon"},"üìã",-1),a("p",{class:"empty-state-message"},"–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)])])):(c(),u("div",gi,[ne(Qe,{name:"task-card",tag:"div",class:"tasks-cards-list"},{default:pe(()=>[(c(!0),u(ee,null,te(S.value.filter(x),Z=>(c(),u("div",{key:Z.id,class:X(["task-card",L(Z)]),onClick:fe=>q(Z)},[a("div",hi,[a("span",fi,"–ó–∞–¥–∞—á–∞ #"+m(Z.id),1),Z.elapsedTime?(c(),u("span",vi,m(Ue(qe)(Z.elapsedTime)),1)):A("",!0)]),a("div",pi,m(Z.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),a("div",yi,[a("div",ki,[H[13]||(H[13]=a("span",{class:"date-icon"},"üìÖ",-1)),H[14]||(H[14]=a("span",{class:"date-label"},"–ù–∞—á–∞–ª–æ:",-1)),a("span",bi,m($(Z.startDate)),1)]),a("div",_i,[H[15]||(H[15]=a("span",{class:"date-icon"},"‚è∞",-1)),H[16]||(H[16]=a("span",{class:"date-label"},"–î–µ–¥–ª–∞–π–Ω:",-1)),a("span",{class:X(["date-value",{"date-value--overdue":W(Z.deadline,Z.closedDate)}])},m($(Z.deadline)||"-"),3)]),a("div",wi,[H[17]||(H[17]=a("span",{class:"date-icon"},"‚úì",-1)),H[18]||(H[18]=a("span",{class:"date-label"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ:",-1)),a("span",Ci,m($(Z.closedDate)||"-"),1)])]),Z.ticket?(c(),u("div",Ti,[a("div",Si,[a("div",Di,[a("span",Ei,"–¢–∏–∫–µ—Ç #"+m(Z.ticket.id),1),Z.ticket.createdWeek&&Z.ticket.createdWeek!==o.cellData.week?.weekNumber?(c(),u("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${Z.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${o.cellData.week?.weekNumber}`}," –°–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥. "+m(Z.ticket.createdWeek),9,Ai)):A("",!0)])]),a("div",$i,m(Z.ticket.title||Z.ticket.ufSubject||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),a("div",Ii,[a("div",Mi,[a("div",Ni,[H[19]||(H[19]=a("span",{class:"meta-label"},"–°–µ–∫—Ç–æ—Ä:",-1)),a("span",xi,m(Z.ticket.ufSlaBlockStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)]),a("div",Li,[H[20]||(H[20]=a("span",{class:"meta-label"},"–°–µ—Ä–≤–∏—Å:",-1)),a("span",Pi,m(Z.ticket.ufSlaServiceStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])]),a("div",Oi,[a("div",Ri,[H[21]||(H[21]=a("span",{class:"meta-label"},"–î–µ–π—Å—Ç–≤–∏–µ:",-1)),a("span",Bi,m(Z.ticket.ufActionStr||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),1)]),a("div",Ui,[H[22]||(H[22]=a("span",{class:"meta-label"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:",-1)),a("span",Wi,m(Z.ticket.ufCrm7UfPriority||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])])]),a("div",Fi,[a("div",Hi,[H[23]||(H[23]=a("span",{class:"date-icon"},"üìÖ",-1)),H[24]||(H[24]=a("span",{class:"date-label"},"–°–æ–∑–¥–∞–Ω:",-1)),a("span",ji,m($(Z.ticket.createdTime)),1)])])])):(c(),u("div",Vi,[...H[25]||(H[25]=[a("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])])),H[26]||(H[26]=a("div",{class:"task-card__status-placeholder"},null,-1))],10,mi))),128))]),_:1}),k.value>1?(c(),u("div",zi,[a("button",{class:"pagination-btn",disabled:y.value.currentPage===1,onClick:H[0]||(H[0]=Z=>G(y.value.currentPage-1))}," ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,Gi),a("div",Ki,[(c(!0),u(ee,null,te(C.value,Z=>(c(),u("button",{key:Z,class:X(["pagination-page",{"pagination-page--active":Z===y.value.currentPage}]),onClick:fe=>G(Z)},m(Z),11,qi))),128))]),a("button",{class:"pagination-btn",disabled:y.value.currentPage===k.value,onClick:H[1]||(H[1]=Z=>G(y.value.currentPage+1))}," –°–ª–µ–¥—É—é—â–∞—è ‚Üí ",8,Yi)])):A("",!0)]))]),_:1})])])):r.value===1&&o.cellData.type==="employee"?(c(),u("div",Xi,[a("div",Ji,[a("p",null,[H[27]||(H[27]=a("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),ce(" "+m(o.cellData.employee?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),a("p",null,[H[28]||(H[28]=a("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),ce(" "+m(f(o.cellData.weeks)),1)])]),a("div",Zi,[H[29]||(H[29]=a("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –Ω–µ–¥–µ–ª—è–º:",-1)),(c(!0),u(ee,null,te(o.cellData.weeks,Z=>(c(),u("div",{key:Z.week.weekNumber,class:"week-item"},[a("div",Qi,[a("span",el,"–ù–µ–¥–µ–ª—è "+m(Z.week.weekNumber),1),a("span",tl,m(Ue(qe)(Z.elapsedTime||0)),1)])]))),128))])])):r.value===1&&o.cellData.type==="week"?(c(),u("div",sl,[a("div",al,[a("p",null,[H[30]||(H[30]=a("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),ce(" "+m(o.cellData.week?.weekNumber||"?"),1)]),a("p",null,[H[31]||(H[31]=a("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),ce(" "+m(w(o.cellData.week)),1)]),a("p",null,[H[32]||(H[32]=a("strong",null,"–û–±—â–∏–µ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),ce(" "+m(Ue(qe)(o.cellData.week?.totalElapsedTime||0)),1)])]),a("div",ol,[H[33]||(H[33]=a("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:",-1)),(c(!0),u(ee,null,te(o.cellData.employees,Z=>(c(),u("div",{key:Z.employee.id,class:"employee-item"},[a("div",nl,[a("span",rl,m(Z.employee.name),1),a("span",il,m(Ue(qe)(Z.elapsedTime||0)),1)])]))),128))])])):A("",!0)]),_:1})]),a("div",{class:"modal-footer"},[a("button",{class:"close-btn",onClick:oe},"–ó–∞–∫—Ä—ã—Ç—å")])])],32)):A("",!0)]))}},cl=de(ll,[["__scopeId","data-v-fc33390b"]]),dl={class:"tickets-time-tracking-dashboard"},ul={class:"dashboard-header"},gl={class:"breadcrumbs-row"},ml=["aria-label","aria-disabled","data-fallback","disabled"],hl={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},fl={key:"preloader",class:"time-tracking-preloader"},vl={key:"error",class:"error-state"},pl={key:"empty",class:"empty-state"},yl={key:"content",class:"dashboard-content"},kl={__name:"TicketsTimeTrackingDashboard",setup(o){const e=Xe(),s=I(!0),t=I(null),r=I(null),i=I(null),n=I(!1),l=M(()=>gr(r.value)),d=async()=>{s.value=!0,t.value=null;const f=new Promise(w=>setTimeout(w,300));try{const[w,$]=await Promise.all([f,$a.getTimeTrackingData({product:"1C",weeksCount:4})]);r.value=$}catch(w){console.error("[TicketsTimeTrackingDashboard] Error loading data:",w),t.value=w.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}finally{s.value=!1}},g=f=>{i.value=f},p=f=>{i.value={type:"employee",...f}},T=f=>{i.value={type:"week",...f}},v=()=>{i.value=null},y=M(()=>typeof window>"u"?!1:window.history.length>1),k=M(()=>y.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"),S=()=>{n.value||(n.value=!0,y.value?e.go(-1):e.push({name:"dashboard-sector-1c"}),setTimeout(()=>{n.value=!1},300))},C=()=>{e.push("/")};return $e(()=>{d()}),(f,w)=>{const $=be("router-link");return c(),u("div",dl,[a("div",ul,[a("div",gl,[a("button",{class:"btn-home-link",type:"button",onClick:C,title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),w[7]||(w[7]=a("span",{class:"breadcrumb-separator"},"/",-1)),a("button",{class:"btn-back-link",type:"button",onClick:S,"aria-label":k.value,"aria-disabled":!y.value,"data-fallback":!y.value,disabled:n.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,ml),a("nav",hl,[ne($,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:pe(()=>[...w[0]||(w[0]=[ce(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),w[3]||(w[3]=a("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ne($,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:pe(()=>[...w[1]||(w[1]=[ce(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),w[4]||(w[4]=a("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ne($,{to:{name:"dashboard-graph-admission-closure"},class:"breadcrumb-link"},{default:pe(()=>[...w[2]||(w[2]=[ce(" –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π ",-1)])]),_:1}),w[5]||(w[5]=a("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),w[6]||(w[6]=a("span",{class:"breadcrumb-current"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã",-1))])])]),w[10]||(w[10]=a("h1",{class:"dashboard-title"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),A("",!0),ne(Ae,{name:"fade",mode:"out-in"},{default:pe(()=>[s.value?(c(),u("div",fl,[...w[8]||(w[8]=[a("div",{class:"preloader-content"},[a("div",{class:"preloader-spinner"},[a("div",{class:"spinner-ring"}),a("div",{class:"spinner-ring"}),a("div",{class:"spinner-ring"})]),a("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"),a("p",{class:"preloader-message"},"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö..."),a("div",{class:"preloader-dots"},[a("span",{class:"dot"}),a("span",{class:"dot"}),a("span",{class:"dot"})])],-1)])])):t.value?(c(),u("div",vl,[a("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: "+m(t.value),1),a("button",{onClick:d,class:"retry-button"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):l.value?(c(),u("div",yl,[r.value?(c(),he(Sr,{key:0,data:r.value},null,8,["data"])):A("",!0),r.value?(c(),he(Hr,{key:1,data:r.value,loading:s.value,error:t.value,onCellClick:g,onEmployeeClick:p,onWeekClick:T},null,8,["data","loading","error"])):A("",!0)])):(c(),u("div",pl,[...w[9]||(w[9]=[a("p",null,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])]))]),_:1}),i.value?(c(),he(cl,{key:1,"cell-data":i.value,onClose:v},null,8,["cell-data"])):A("",!0)])}}},Ia=de(kl,[["__scopeId","data-v-2f7848de"]]),bl=Object.freeze(Object.defineProperty({__proto__:null,default:Ia},Symbol.toStringTag,{value:"Module"}));Je.register(qa,Ya,Xa,Ja,Za,Qa,eo,to,so,ao);Je.defaults.responsive=!0;Je.defaults.maintainAspectRatio=!1;Je.defaults.plugins.legend.display=!0;Je.defaults.plugins.legend.position="top";const J={primary:"#007bff",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8",carryover:"#ff9800",successLight:"#6cbf47",carryoverLight:"#ffb74d",carryoverDark:"#f57c00"},ht={apiBaseUrl:"",snapshotsEndpoint:"/api/snapshots.php",defaultSectorId:"1C",snapshotVersion:"1.0",timeout:3e4};class pt{static getApiBaseUrl(){return co()}static async createSnapshot(e,s,t={}){try{if(!e||typeof e!="object")throw new St("sectorData –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º","VALIDATION_ERROR");if(!s||!["week_start","week_end","manual","current"].includes(s))throw new St("type –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–Ω–∏–º –∏–∑: week_start, week_end, manual, current","VALIDATION_ERROR");const r=this.validateSectorData(e);if(!r.isValid)throw new St(`–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞: ${r.errors.join(", ")}`,"VALIDATION_ERROR",{validation:r});const i=this.normalizeSectorData(e),l={metadata:this.generateSnapshotMetadata(s,t.createdBy,t.sectorId||ht.defaultSectorId),statistics:i.statistics,ticketIds:i.ticketIds,tickets:i.tickets},d=this.validateSnapshot(l);if(!d.isValid)throw new St(`–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–ª–µ–ø–∫–∞: ${d.errors.join(", ")}`,"VALIDATION_ERROR",{validation:d});d.warnings.length>0&&console.warn("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–ª–µ–ø–∫–∞:",d.warnings);const g=this.getApiBaseUrl(),p=await fetch(`${g}${ht.snapshotsEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({action:"create",snapshot:l,type:s,date:this.formatDate(new Date)})});if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);const T=await p.json();if(!T.success)throw new Error(T.message||"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞");return T.data.snapshot}catch(r){throw console.error("SnapshotService.createSnapshot error:",r),r instanceof St?r:new St(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞: ${r.message}`,"API_ERROR",{originalError:r})}}static async getSnapshot(e,s){try{const t=this.formatDate(e),i=`${this.getApiBaseUrl()}${ht.snapshotsEndpoint}?action=get&date=${t}&type=${s}`,n=await fetch(i,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(n.status===404)return null;if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const l=await n.json();if(!l.success){if(l.message&&l.message.includes("–Ω–µ –Ω–∞–π–¥–µ–Ω"))return null;throw new Error(l.message||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–ø–∫–∞")}return l.data.snapshot}catch(t){throw console.error("SnapshotService.getSnapshot error:",t),t}}static async getAllSnapshots(e={}){try{const s=new URLSearchParams;s.append("action","list"),e.startDate&&s.append("startDate",this.formatDate(e.startDate)),e.endDate&&s.append("endDate",this.formatDate(e.endDate)),e.type&&s.append("type",e.type),e.sectorId?s.append("sectorId",e.sectorId):s.append("sectorId",ht.defaultSectorId);const r=`${this.getApiBaseUrl()}${ht.snapshotsEndpoint}?${s.toString()}`,i=await fetch(r,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const n=await i.json();if(!n.success)throw new Error(n.message||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–ª–µ–ø–∫–æ–≤");return(await Promise.all(n.data.snapshots.map(async d=>{try{return await this.getSnapshot(d.date,d.type)}catch(g){return console.warn(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–µ–ø–∫–∞ ${d.date}/${d.type}:`,g),null}}))).filter(d=>d!==null).sort((d,g)=>new Date(d.metadata.createdAt)-new Date(g.metadata.createdAt))}catch(s){throw console.error("SnapshotService.getAllSnapshots error:",s),s}}static normalizeSectorData(e){const{stages:s=[],employees:t=[],zeroPointTickets:r={}}=e,i={formed:{count:0,stageId:"DT140_12:UC_0VHWE2",stageName:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ"},review:{count:0,stageId:"DT140_12:PREPARATION",stageName:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó"},execution:{count:0,stageId:"DT140_12:CLIENT",stageName:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"}},n=[],l=[],d=[];s.forEach(T=>{const v=T.id;if(i[v]){let y=0;T.employees.forEach(k=>{const S=k.tickets||[];y+=S.length;let C=n.find(f=>f.id===k.id);C||(C={id:k.id,name:k.name,ticketsByStage:{formed:0,review:0,execution:0},totalTickets:0},n.push(C)),S.forEach(f=>{l.push(f.id),d.push({id:f.id,title:f.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:{id:k.id,name:k.name},createdAt:f.createdAt||"",updatedAt:f.modifiedAt||f.updatedAt||""}),C.ticketsByStage[v]=(C.ticketsByStage[v]||0)+1,C.totalTickets+=1})}),i[v].count=y}});const g={unassigned:0,keeper:0,total:0};Object.values(r).forEach(T=>{Array.isArray(T)&&T.forEach(v=>{g.total+=1,v.assigneeId===1051||v.assignedById===1051?g.keeper+=1:g.unassigned+=1,l.push(v.id),d.push({id:v.id,title:v.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:v.assignedTo||v.assignedById?{id:v.assignedById||v.assigneeId,name:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}:null,createdAt:v.createdAt||"",updatedAt:v.modifiedAt||v.updatedAt||""})})});const p=Object.values(i).reduce((T,v)=>T+v.count,0)+g.total;return{statistics:{stages:{...i,total:p},employees:n,zeroPoint:g},ticketIds:[...new Set(l)],tickets:d}}static generateSnapshotMetadata(e,s,t){const r=new Date,i=-r.getTimezoneOffset(),n=Math.floor(i/60),l=i%60,d=`${n>=0?"+":""}${String(n).padStart(2,"0")}:${String(l).padStart(2,"0")}`,g=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}T${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}:${String(r.getSeconds()).padStart(2,"0")}${d}`;return{version:ht.snapshotVersion,createdAt:g,createdBy:s||{id:0,name:"–°–∏—Å—Ç–µ–º–∞"},type:e,sectorId:t,sectorName:t==="1C"?"–°–µ–∫—Ç–æ—Ä 1–°":`–°–µ–∫—Ç–æ—Ä ${t}`}}static formatDate(e){if(e||(e=new Date),typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;e=new Date(e)}if(!(e instanceof Date)||isNaN(e.getTime()))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞");const s=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${s}-${t}-${r}`}static buildFilePath(e,s){const t=typeof e=="string"?new Date(e):e,r=t.getFullYear(),i=this.getWeekNumber(t),n=this.formatDate(e);let l;if(s==="current"){const d=new Date,g=`${String(d.getHours()).padStart(2,"0")}-${String(d.getMinutes()).padStart(2,"0")}-${String(d.getSeconds()).padStart(2,"0")}`;l=`current-state-${n}-${g}.json`}else if(s==="manual"){const d=new Date,g=`${String(d.getHours()).padStart(2,"0")}-${String(d.getMinutes()).padStart(2,"0")}-${String(d.getSeconds()).padStart(2,"0")}`;l=`manual-${n}-${g}.json`}else l=`${s}-${n}.json`;return s==="current"?`current/${l}`:`${r}/week-${i}/${l}`}static getWeekNumber(e){const s=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),t=s.getUTCDay()||7;s.setUTCDate(s.getUTCDate()+4-t);const r=new Date(Date.UTC(s.getUTCFullYear(),0,1));return Math.ceil(((s-r)/864e5+1)/7)}static validateSnapshot(e){const s=[],t=[];if(e.metadata?((!e.metadata.version||typeof e.metadata.version!="string")&&s.push("–ù–µ–≤–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö"),(!e.metadata.createdAt||!this.isValidISODate(e.metadata.createdAt))&&s.push("–ù–µ–≤–µ—Ä–Ω–∞—è –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è"),["week_start","week_end","manual","current"].includes(e.metadata.type)||s.push("–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø —Å–ª–µ–ø–∫–∞"),(!e.metadata.sectorId||typeof e.metadata.sectorId!="string")&&s.push("–ù–µ–≤–µ—Ä–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ–∫—Ç–æ—Ä–∞"),(!e.metadata.createdBy||!e.metadata.createdBy.id||!e.metadata.createdBy.name)&&s.push("–ù–µ–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞—Ç–µ–ª–µ")):s.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–ª–µ–ø–∫–∞"),!e.statistics)s.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞");else{if(!e.statistics.stages)s.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —ç—Ç–∞–ø–∞–º");else{const r=e.statistics.stages,i=(r.formed?.count||0)+(r.review?.count||0)+(r.execution?.count||0);r.total!==i&&t.push(`–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–µ—Ç–æ–≤: –æ–∂–∏–¥–∞–µ—Ç—Å—è ${i}, —É–∫–∞–∑–∞–Ω–æ ${r.total}`)}if(Array.isArray(e.statistics.employees)||s.push("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),!e.statistics.zeroPoint)s.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω—É–ª–µ–≤–æ–π —Ç–æ—á–∫–∏");else{const r=e.statistics.zeroPoint,i=(r.unassigned||0)+(r.keeper||0);r.total!==i&&t.push(`–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω—É–ª–µ–≤–æ–π —Ç–æ—á–∫–∏: –æ–∂–∏–¥–∞–µ—Ç—Å—è ${i}, —É–∫–∞–∑–∞–Ω–æ ${r.total}`)}}if(Array.isArray(e.ticketIds)||s.push("ticketIds –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),!Array.isArray(e.tickets))s.push("tickets –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º");else{const r=new Set(e.ticketIds),i=new Set(e.tickets.map(n=>n.id));r.size!==i.size&&t.push("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ ID –≤ ticketIds –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–∏–∫–µ—Ç–æ–≤"),e.tickets.forEach((n,l)=>{n.id||s.push(`–¢–∏–∫–µ—Ç #${l}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ID`),n.title||s.push(`–¢–∏–∫–µ—Ç #${l}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫`),(!n.assignedTo||!n.assignedTo.id)&&t.push(`–¢–∏–∫–µ—Ç #${l}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –Ω—É–ª–µ–≤–æ–π —Ç–æ—á–∫–µ)`),n.createdAt||s.push(`–¢–∏–∫–µ—Ç #${l}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è`),n.updatedAt||s.push(`–¢–∏–∫–µ—Ç #${l}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è`)})}return{isValid:s.length===0,errors:s,warnings:t}}static validateSectorData(e){const s=[],t=[];return!e||typeof e!="object"?(s.push("sectorData –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{isValid:!1,errors:s,warnings:t}):(Array.isArray(e.stages)||s.push("stages –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),Array.isArray(e.employees)||s.push("employees –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),(!e.zeroPointTickets||typeof e.zeroPointTickets!="object")&&s.push("zeroPointTickets –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{isValid:s.length===0,errors:s,warnings:t})}static isValidISODate(e){if(typeof e!="string")return!1;const s=new Date(e);return!isNaN(s.getTime())&&e.includes("T")}static async deleteSnapshot(e,s){try{const t=this.formatDate(e),i=`${this.getApiBaseUrl()}${ht.snapshotsEndpoint}`,n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({action:"delete",date:t,type:s})});if(n.status===404)return!1;if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const l=await n.json();if(!l.success)throw new Error(l.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–µ–ø–∫–∞");return!0}catch(t){throw console.error("SnapshotService.deleteSnapshot error:",t),t}}static async deleteSnapshotsByPeriod(e){try{const s=await this.getAllSnapshots(e);let t=0;for(const r of s)try{await this.deleteSnapshot(r.metadata.createdAt.split("T")[0],r.metadata.type)&&t++}catch(i){console.warn(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–µ–ø–∫–∞ ${r.metadata.createdAt}:`,i)}return t}catch(s){throw console.error("SnapshotService.deleteSnapshotsByPeriod error:",s),s}}static getSnapshotVersion(e){return e?.metadata?.version||"unknown"}static async migrateSnapshot(e,s=ht.snapshotVersion){const t=this.getSnapshotVersion(e);return t===s||t==="1.0"&&s==="1.0"?e:(console.warn(`–ú–∏–≥—Ä–∞—Ü–∏—è —Å –≤–µ—Ä—Å–∏–∏ ${t} –Ω–∞ ${s} –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞`),{...e,metadata:{...e.metadata,version:s}})}static getWeekNumberInfo(e){const s=typeof e=="string"?new Date(e):e,t=this.getWeekNumber(s);return{year:s.getFullYear(),week:t}}static getWeekStartDate(e){const s=typeof e=="string"?new Date(e):e,r=(s.getDay()||7)-1,i=new Date(s);return i.setDate(s.getDate()-r),i.setHours(0,0,0,0),i}static getWeekEndDate(e){const s=typeof e=="string"?new Date(e):e,r=7-(s.getDay()||7),i=new Date(s);return i.setDate(s.getDate()+r),i.setHours(23,59,59,999),i}static async getSnapshotsForWeek(e){try{const s=this.getWeekStartDate(e),t=this.getWeekEndDate(e),r=this.getWeekNumberInfo(e),i=await this.getAllSnapshots({startDate:s,endDate:t}),n=i.find(g=>g.metadata.type==="week_start")||null,l=i.find(g=>g.metadata.type==="week_end")||null,d=i.filter(g=>g.metadata.type==="manual");return{weekStart:n,weekEnd:l,manual:d,weekInfo:r}}catch(s){throw console.error("SnapshotService.getSnapshotsForWeek error:",s),s}}static handleError(e){if(e instanceof St)return{message:e.message,code:e.code,details:e.details};let s="UNKNOWN_ERROR";return e.message.includes("–≤–∞–ª–∏–¥–∞—Ü")?s="VALIDATION_ERROR":e.message.includes("404")||e.message.includes("–Ω–µ –Ω–∞–π–¥–µ–Ω")?s="NOT_FOUND":e.message.includes("HTTP")||e.message.includes("API")?s="API_ERROR":e.message.includes("–≤–µ—Ä—Å–∏—è")||e.message.includes("version")?s="VERSION_MISMATCH":(e.message.includes("–¥–æ—Å—Ç—É–ø")||e.message.includes("permission"))&&(s="PERMISSION_DENIED"),{message:e.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",code:s,details:{originalError:e}}}static async getSnapshotsStatistics(e={}){try{const s=await this.getAllSnapshots(e),t={week_start:0,week_end:0,manual:0,current:0},r=new Map;let i=null,n=null;s.forEach(d=>{const g=d.metadata.type;t.hasOwnProperty(g)&&t[g]++;const p=this.getWeekNumberInfo(d.metadata.createdAt),T=`${p.year}-W${p.week}`;r.set(T,(r.get(T)||0)+1);const v=new Date(d.metadata.createdAt);(!i||v<new Date(i.metadata.createdAt))&&(i=d),(!n||v>new Date(n.metadata.createdAt))&&(n=d)});const l=Array.from(r.entries()).map(([d,g])=>{const[p,T]=d.split("-W");return{year:parseInt(p),week:parseInt(T),count:g}}).sort((d,g)=>d.year!==g.year?d.year-g.year:d.week-g.week);return{total:s.length,byType:t,byWeek:l,oldest:i,newest:n}}catch(s){throw console.error("SnapshotService.getSnapshotsStatistics error:",s),s}}}class St extends Error{constructor(e,s,t={}){super(e),this.name="SnapshotError",this.code=s,this.details=t}}const ft={formed:{bitrixId:Ss.formed,name:Ts.FORMED.name},review:{bitrixId:Ss.review,name:Ts.REVIEW.name},execution:{bitrixId:Ss.execution,name:Ts.EXECUTION.name}},es=ts;function _l(o){if(!o||typeof o!="object")throw new Error("Invalid sector data: sectorData must be an object");if(!o.stages||!Array.isArray(o.stages))throw new Error("Invalid sector data: stages are required and must be an array");const e=wl(o.stages),s=Cl(o.stages),t=Tl(o.zeroPointTickets||{}),r=Sl(o.zeroPointTickets||{}),i=Dl(o.stages,o.zeroPointTickets||{});return{statistics:{stages:e,employees:s,zeroPoint:t,zeroPointByStage:r},ticketIds:i.ticketIds,tickets:i.tickets}}function wl(o){const e={formed:{count:0,stageId:ft.formed.bitrixId,stageName:ft.formed.name},review:{count:0,stageId:ft.review.bitrixId,stageName:ft.review.name},execution:{count:0,stageId:ft.execution.bitrixId,stageName:ft.execution.name},total:0};return o.forEach(s=>{if(!ft[s.id]){console.warn(`Unknown stage ID: ${s.id}`);return}let t=0;s.employees&&Array.isArray(s.employees)&&s.employees.forEach(r=>{r.tickets&&Array.isArray(r.tickets)&&(t+=r.tickets.length)}),e[s.id].count=t,e.total+=t}),e}function Cl(o){const e=new Map;return o.forEach(s=>{!s.employees||!Array.isArray(s.employees)||s.employees.forEach(t=>{if(!t||!t.id)return;e.has(t.id)||e.set(t.id,{id:t.id,name:t.name||`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${t.id}`,ticketsByStage:{formed:0,review:0,execution:0},totalTickets:0});const r=e.get(t.id),i=t.tickets&&Array.isArray(t.tickets)?t.tickets.length:0;ft[s.id]&&(r.ticketsByStage[s.id]=(r.ticketsByStage[s.id]||0)+i),r.totalTickets+=i})}),Array.from(e.values())}function Tl(o){let e=0,s=0;return!o||typeof o!="object"?{unassigned:0,keeper:0,total:0}:(Object.values(o).forEach(t=>{Array.isArray(t)&&t.forEach(r=>{if(!r)return;const i=r.assignedTo||r.assignedById;!i||i===null?e++:(typeof i=="object"?i.id:i)===es?s++:e++})}),{unassigned:e,keeper:s,total:e+s})}function Sl(o){const e={formed:{keeper:0,unassigned:0,total:0},review:{keeper:0,unassigned:0,total:0},execution:{keeper:0,unassigned:0,total:0}};return!o||typeof o!="object"||Object.keys(e).forEach(s=>{const t=o[s];Array.isArray(t)&&t.forEach(r=>{if(!r)return;const i=r.assignedTo||r.assignedById;!i||i===null?e[s].unassigned++:(typeof i=="object"?i.id:i)===es?e[s].keeper++:e[s].unassigned++,e[s].total++})}),e}function Dl(o,e){const s=new Set,t=new Map;return Array.isArray(o)&&o.forEach(r=>{!r.employees||!Array.isArray(r.employees)||r.employees.forEach(i=>{!i.tickets||!Array.isArray(i.tickets)||i.tickets.forEach(n=>{if(!n||!n.id){console.warn("Ticket without ID found:",n);return}const l=parseInt(n.id);if(isNaN(l)){console.warn("Invalid ticket ID:",n.id);return}s.add(l);let d=n.assignedTo;!d&&i.id&&(d={id:i.id,name:i.name||`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${i.id}`}),t.set(l,{id:l,title:n.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:d||null,createdAt:is(n.createdAt||n.createdTime),updatedAt:is(n.updatedAt||n.modifiedAt||n.updatedTime),stageId:n.stageId||r.id||null,departmentHead:n.departmentHead||null,departmentHeadFull:n.departmentHeadFull||n.departmentHead||null,priorityId:n.priorityId||null,priorityLabel:n.priorityLabel||null,service:n.service||null,serviceLabel:n.serviceLabel||null})})})}),e&&typeof e=="object"&&Object.values(e).forEach(r=>{Array.isArray(r)&&r.forEach(i=>{if(!i||!i.id){console.warn("Ticket without ID found in zero point:",i);return}const n=parseInt(i.id);if(isNaN(n)){console.warn("Invalid ticket ID in zero point:",i.id);return}s.add(n);let l=i.assignedTo;if(!l&&i.assignedById){const d=typeof i.assignedById=="object"?i.assignedById.id||i.assignedById.value:i.assignedById;d&&d!==es?l={id:d,name:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}:d===es&&(l={id:es,name:"–•—Ä–∞–Ω–∏—Ç–µ–ª—å –æ–±—ä–µ–∫—Ç–æ–≤"})}t.set(n,{id:n,title:i.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:l||null,createdAt:is(i.createdAt||i.createdTime),updatedAt:is(i.updatedAt||i.modifiedAt||i.updatedTime),stageId:i.stageId||null,departmentHead:i.departmentHead||null,departmentHeadFull:i.departmentHeadFull||i.departmentHead||null,priorityId:i.priorityId||null,priorityLabel:i.priorityLabel||null,service:i.service||null,serviceLabel:i.serviceLabel||null})})}),{ticketIds:Array.from(s).sort((r,i)=>r-i),tickets:Array.from(t.values())}}function is(o){if(!o)return null;if(o instanceof Date)return o.toISOString();if(typeof o=="string"){if(o.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/))return o;const e=new Date(o);if(!isNaN(e.getTime()))return e.toISOString()}return console.warn("Invalid date format:",o),null}class Ws{static async getSectorDataForSnapshot(e={}){const{useCache:s=!0,useBackendCache:t=!1,onProgress:r=null,normalize:i=!0,includeTicketDetails:n=!1}=e;try{const l=await Bt.getSectorData(s,t,r);return i?_l(l):(n&&console.warn("includeTicketDetails –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ"),l)}catch(l){throw console.error("SectorDataAdapter.getSectorDataForSnapshot error:",l),l}}static async isDataAvailable(){try{const e=await Bt.getSectorData(!0);return e!=null}catch{return!1}}}class $s{static compareTwoSnapshots(e,s,t={}){const{includeTickets:r=!1,includeEmployees:i=!0}=t,n=this.validateSnapshot(e),l=this.validateSnapshot(s);if(!n.valid||!l.valid)throw new Error("Invalid snapshot structure: "+[...n.errors,...l.errors].join(", "));const d=this.buildComparisonMetadata(e,s),g=this.compareStages(e.statistics.stages,s.statistics.stages),p=i?this.compareEmployees(e.statistics.employees||[],s.statistics.employees||[]):[],T=this.compareZeroPoint(e.statistics.zeroPoint||{},s.statistics.zeroPoint||{}),v=r?this.compareTickets(e.ticketIds||[],s.ticketIds||[],e.tickets||[],s.tickets||[]):null,y=this.buildSummary(g,p,T,v);return{metadata:d,stages:g,employees:p,zeroPoint:T,tickets:v,summary:y}}static calculateDelta(e,s){const t=this.normalizeValue(e),r=this.normalizeValue(s),i=r-t;let n=0;t!==0?n=i/t*100:r!==0&&(n=r>0?1/0:-1/0);const l=this.getTrend(i);return{value1:t,value2:r,delta:i,deltaPercent:Math.round(n*100)/100,trend:l}}static normalizeValue(e){return e==null||isNaN(e)?0:Number(e)}static getTrend(e){return e>0?"increase":e<0?"decrease":"stable"}static compareStages(e,s){const t=["formed","review","execution"],r={};for(const l of t){const d=e[l]?.count||0,g=s[l]?.count||0;r[l]=this.calculateDelta(d,g)}const i=e.total||0,n=s.total||0;return r.total=this.calculateDelta(i,n),r}static compareEmployees(e,s){const t=new Map(e.map(l=>[l.id,l])),r=new Map(s.map(l=>[l.id,l])),i=new Set([...t.keys(),...r.keys()]),n=[];for(const l of i){const d=t.get(l)||null,g=r.get(l)||null;if(!d||!g){n.push({id:l,name:d?.name||g?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",snapshot1:d?{ticketsByStage:d.ticketsByStage||{},totalTickets:d.totalTickets||0}:null,snapshot2:g?{ticketsByStage:g.ticketsByStage||{},totalTickets:g.totalTickets||0}:null,delta:this.calculateEmployeeDelta(d,g),trend:d?"removed":"new"});continue}const p={},T=["formed","review","execution"];for(const y of T){const k=d.ticketsByStage?.[y]||0,S=g.ticketsByStage?.[y]||0;p[y]=this.calculateDelta(k,S)}const v=this.calculateDelta(d.totalTickets||0,g.totalTickets||0);n.push({id:l,name:d.name,snapshot1:{ticketsByStage:d.ticketsByStage||{},totalTickets:d.totalTickets||0},snapshot2:{ticketsByStage:g.ticketsByStage||{},totalTickets:g.totalTickets||0},delta:{ticketsByStage:p,totalTickets:v},trend:v.trend})}return n}static calculateEmployeeDelta(e,s){if(!e&&!s)return{ticketsByStage:{},totalTickets:{delta:0,trend:"stable"}};const t={},r=["formed","review","execution"];for(const n of r){const l=e?.ticketsByStage?.[n]||0,d=s?.ticketsByStage?.[n]||0;t[n]=this.calculateDelta(l,d)}const i=this.calculateDelta(e?.totalTickets||0,s?.totalTickets||0);return{ticketsByStage:t,totalTickets:i}}static compareZeroPoint(e,s){return{unassigned:this.calculateDelta(e?.unassigned||0,s?.unassigned||0),keeper:this.calculateDelta(e?.keeper||0,s?.keeper||0),total:this.calculateDelta(e?.total||0,s?.total||0)}}static compareTickets(e,s,t,r){const i=new Set(e),n=new Set(s),l=s.filter(y=>!i.has(y)),d=e.filter(y=>!n.has(y)),g=[],p=[],T=new Map(t.map(y=>[y.id,y])),v=new Map(r.map(y=>[y.id,y]));for(const y of e){if(!n.has(y))continue;const k=T.get(y),S=v.get(y);if(!k||!S)continue;const C=(k.assignedTo?.id||null)!==(S.assignedTo?.id||null),f=(k.stageId||null)!==(S.stageId||null);C||f?g.push(y):p.push(y)}return{new:l,removed:d,changed:g,unchanged:p}}static buildComparisonMetadata(e,s){const t=new Date(e.metadata.createdAt),r=new Date(s.metadata.createdAt),i=new Date,n=r.getTime()-t.getTime(),l=Math.floor(n/(1e3*60*60*24)),d=Math.floor(n%(1e3*60*60*24)/(1e3*60*60)),g=Math.floor(n%(1e3*60*60)/(1e3*60));return{snapshot1Date:e.metadata.createdAt,snapshot2Date:s.metadata.createdAt,comparisonDate:i.toISOString(),timeDiff:{days:l,hours:d,minutes:g,totalMinutes:Math.floor(n/(1e3*60))}}}static buildSummary(e,s,t,r){const i=e.total.delta,n=Object.keys(e).filter(g=>g==="total"?!1:e[g].delta!==0).length,l=s.filter(g=>g.trend==="new"||g.trend==="removed"?!0:g.delta.totalTickets.delta!==0).length,d=i!==0||n>0||l>0;return{totalDelta:i,stagesChanged:n,employeesChanged:l,hasChanges:d,newTicketsCount:r?.new?.length||0,removedTicketsCount:r?.removed?.length||0,changedTicketsCount:r?.changed?.length||0}}static validateSnapshot(e){const s=[],t=[];if(!e)return s.push("Snapshot is null or undefined"),{valid:!1,errors:s,warnings:t};if(e.metadata?(e.metadata.createdAt||s.push("Missing metadata.createdAt"),e.metadata.type||s.push("Missing metadata.type")):s.push("Missing metadata field"),!e.statistics)s.push("Missing statistics field");else{if(!e.statistics.stages)s.push("Missing statistics.stages");else{const r=["formed","review","execution"];for(const i of r)e.statistics.stages[i]||t.push(`Missing stage: ${i}`)}e.statistics.employees||t.push("Missing statistics.employees (may be empty array)"),e.statistics.zeroPoint||t.push("Missing statistics.zeroPoint")}return{valid:s.length===0,errors:s,warnings:t}}static compareMultipleSnapshots(e,s={}){if(!Array.isArray(e)||e.length<2)throw new Error("At least 2 snapshots required for comparison");for(const n of e){const l=this.validateSnapshot(n);if(!l.valid)throw new Error("Invalid snapshot: "+l.errors.join(", "))}const t=[...e].sort((n,l)=>{const d=new Date(n.metadata.createdAt),g=new Date(l.metadata.createdAt);return d-g}),r=[];for(let n=0;n<t.length-1;n++)r.push({from:n,to:n+1,result:this.compareTwoSnapshots(t[n],t[n+1],s)});const i=this.buildTrends(t);return{snapshots:t.map((n,l)=>({index:l,date:n.metadata.createdAt,type:n.metadata.type,data:n})),comparisons:r,trends:i}}static buildTrends(e){const s={stages:{formed:[],review:[],execution:[],total:[]},zeroPoint:{unassigned:[],keeper:[],total:[]}};for(const t of e){const r=t.statistics;s.stages.formed.push(r.stages?.formed?.count||0),s.stages.review.push(r.stages?.review?.count||0),s.stages.execution.push(r.stages?.execution?.count||0),s.stages.total.push(r.stages?.total||0),s.zeroPoint.unassigned.push(r.zeroPoint?.unassigned||0),s.zeroPoint.keeper.push(r.zeroPoint?.keeper||0),s.zeroPoint.total.push(r.zeroPoint?.total||0)}return s}}const qt=I([]);let El=0;function mt(){const o=(l,d="info",g=3e3)=>{const p=++El,T={id:p,message:l,type:d,duration:g,timestamp:Date.now()};return qt.value.push(T),g>0&&setTimeout(()=>{e(p)},g),p},e=l=>{const d=qt.value.findIndex(g=>g.id===l);d>-1&&qt.value.splice(d,1)};return{notifications:qt,showNotification:o,removeNotification:e,clearNotifications:()=>{qt.value=[]},success:(l,d=3e3)=>o(l,"success",d),error:(l,d=5e3)=>o(l,"error",d),warning:(l,d=4e3)=>o(l,"warning",d),info:(l,d=3e3)=>o(l,"info",d)}}const Al={class:"stages-container"},$l={class:"stages-chips"},Il=["checked","disabled","onChange"],Ml={class:"stage-chip-label"},Nl={__name:"StageChips",props:{stages:{type:Array,required:!0,validator:o=>o.every(e=>e.id&&e.name&&e.color)},selected:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},emits:["update:selected","change"],setup(o,{emit:e}){const s=o,t=e;function r(i,n){const l={...s.selected};l[i]=n,t("update:selected",l),t("change",i,n)}return(i,n)=>(c(),u("div",Al,[n[0]||(n[0]=a("h4",{class:"stages-title"},"–≠—Ç–∞–ø—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:",-1)),a("div",$l,[(c(!0),u(ee,null,te(o.stages,l=>(c(),u("label",{key:l.id,class:X(["stage-chip",{"stage-chip--active":o.selected[l.id],"stage-chip--disabled":o.disabled}])},[a("input",{type:"checkbox",checked:o.selected[l.id],disabled:o.disabled,onChange:d=>r(l.id,d.target.checked)},null,40,Il),a("span",{class:"stage-chip-color",style:we({backgroundColor:l.color})},null,4),a("span",Ml,m(l.name),1)],2))),128))])]))}},xl=de(Nl,[["__scopeId","data-v-fe03c03c"]]),Ll={name:"TicketCard",props:{ticket:{type:Object,required:!0},draggable:{type:Boolean,default:!0}},emits:["click","drag-start","drag-end"],setup(o,{emit:e}){const s=I(!1),t=M(()=>!1),r={color:"#ced4da",backgroundColor:"#f1f3f5",textColor:"#6c757d"},i={color:"#ced4da",backgroundColor:"#f8f9fa",textColor:"#6c757d"},n={color:"#dee2e6",backgroundColor:"#f8f9fa",textColor:"#6c757d"},l=M(()=>({label:o.ticket.priorityLabel||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",colors:o.ticket.priorityColors||r})),d=M(()=>l.value.label||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),g=M(()=>({color:l.value.colors.textColor||r.textColor,backgroundColor:l.value.colors.backgroundColor||r.backgroundColor,borderColor:l.value.colors.color||r.color})),p=M(()=>({borderLeftColor:l.value.colors.color||r.color})),T=M(()=>{const E=o.ticket.service||{};return{label:E.label||o.ticket.serviceLabel||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",colors:E.colors||o.ticket.serviceColors||i}}),v=M(()=>T.value.label||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),y=M(()=>({color:T.value.colors.textColor||i.textColor,backgroundColor:T.value.colors.backgroundColor||i.backgroundColor,borderColor:T.value.colors.color||i.color})),k=M(()=>{const E=o.ticket.actionStr||o.ticket.ufActionStr||null;if(!E)return null;const x=String(E).trim();return x.length>0?x:null}),S=M(()=>({color:n.textColor,backgroundColor:n.backgroundColor,borderColor:n.color})),C=M(()=>{if(!o.ticket.createdAt)return"";const E=Qs(o.ticket.createdAt);return E?ho(E):""}),f=M(()=>{if(!o.ticket.createdAt)return null;const E=Qs(o.ticket.createdAt);return fo(E)}),w=M(()=>{const E=f.value;return E&&vo[E]||null}),$=M(()=>{const E=w.value;return E?{color:E.textColor,backgroundColor:E.backgroundColor,borderColor:E.color,border:`1px solid ${E.color}`}:{}});return{handleDragStart:E=>{t.value&&(E.dataTransfer.effectAllowed="move",E.dataTransfer.setData("application/json",JSON.stringify(o.ticket)),E.dataTransfer.setDragImage(E.target,0,0),s.value=!0,e("drag-start",o.ticket))},handleDragEnd:()=>{t.value&&(s.value=!1,e("drag-end"))},handleCardClick:E=>{if(s.value)return;const x=ss(o.ticket.id);window.open(x,"_blank"),e("click",o.ticket)},isDragEnabled:t,priorityChipStyle:g,displayPriorityLabel:d,priorityBorderStyle:p,displayServiceLabel:v,serviceChipStyle:y,actionStrValue:k,actionChipStyle:S,formattedCreatedDate:C,dateAccentCategory:f,dateAccentConfig:w,dateAccentStyle:$}}},Pl=["draggable"],Ol={key:0,class:"ticket-department"},Rl={class:"ticket-header"},Bl={class:"ticket-id"},Ul={class:"ticket-title"},Wl={class:"ticket-meta"},Fl={key:1,class:"ticket-action"},Hl={key:2,class:"ticket-description"},jl={class:"ticket-date-label"},Vl={class:"ticket-date-value"};function zl(o,e,s,t,r,i){return c(),u("div",{class:"ticket-card",draggable:t.isDragEnabled,style:we(t.priorityBorderStyle),onClick:e[0]||(e[0]=(...n)=>t.handleCardClick&&t.handleCardClick(...n)),onDragstart:e[1]||(e[1]=(...n)=>t.handleDragStart&&t.handleDragStart(...n)),onDragend:e[2]||(e[2]=(...n)=>t.handleDragEnd&&t.handleDragEnd(...n))},[s.ticket.departmentHead?(c(),u("div",Ol,m(s.ticket.departmentHead),1)):A("",!0),a("div",Rl,[e[3]||(e[3]=a("span",{class:"ticket-icon"},"üé´",-1)),a("span",Bl,"#"+m(s.ticket.id),1)]),a("div",Ul,m(s.ticket.ufSubject||s.ticket.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),a("div",Wl,[a("span",{class:"ticket-priority",style:we(t.priorityChipStyle)},m(t.displayPriorityLabel),5),a("span",{class:"ticket-service",style:we(t.serviceChipStyle)},m(t.displayServiceLabel),5)]),t.actionStrValue?(c(),u("div",Fl,[a("span",{class:"ticket-action-chip",style:we(t.actionChipStyle)},m(t.actionStrValue),5)])):A("",!0),s.ticket.description?(c(),u("div",Hl,m(s.ticket.description),1)):A("",!0),t.formattedCreatedDate?(c(),u("div",{key:3,class:"ticket-created-date",style:we(t.dateAccentStyle)},[a("span",jl,m(t.dateAccentConfig?.label||""),1),a("span",Vl,m(t.formattedCreatedDate),1)],4)):A("",!0)],44,Pl)}const Ct=de(Ll,[["render",zl],["__scopeId","data-v-9cda001c"]]),Ht=10;function hs(o,e){if(!e||!e.statistics)return[];const s=[];e.statistics.employees&&Array.isArray(e.statistics.employees)&&e.statistics.employees.filter(r=>r.ticketsByStage&&r.ticketsByStage[o]>0).forEach(r=>{s.push({id:r.id,name:r.name,count:r.ticketsByStage[o]||0})});const t=Gl(o,e);return t>0&&s.push({id:1051,name:"–•—Ä–∞–Ω–∏—Ç–µ–ª—å –æ–±—ä–µ–∫—Ç–æ–≤ (–ù–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω–æ–µ)",count:t,isKeeper:!0}),s.sort((r,i)=>i.count-r.count)}function Gl(o,e){if(!e||!e.statistics)return 0;if(e.statistics.zeroPointByStage&&e.statistics.zeroPointByStage[o])return e.statistics.zeroPointByStage[o].keeper||0;if(e.statistics.zeroPoint){const s=e.statistics.zeroPoint.keeper||0;return Math.floor(s/3)}return 0}function Ma(o,e){return!e||!e.statistics||!e.statistics.stages?0:e.statistics.stages[o]?.count||0}function fs(o,e=Ht){if(!o||o.length===0)return{visible:[],others:{employees:[],count:0,employeeCount:0}};const s=[...o].sort((n,l)=>l.count-n.count),t=s.slice(0,e),r=s.slice(e),i=r.reduce((n,l)=>n+l.count,0);return{visible:t,others:{employees:r,count:i,employeeCount:r.length}}}function Na(o,e){return!o||o.length===0?[]:e===0?o.map(s=>({...s,percentage:0})):o.map(s=>({...s,percentage:parseFloat((s.count/e*100).toFixed(1))}))}function os(o,e,s="#007bff",t=Ht){if(!o||o.length===0)return{employees:[],others:null};const{visible:r,others:i}=fs(o,t),n=Na(r,e).map(d=>({...d,progressBarWidth:d.percentage,progressBarColor:d.isKeeper?"#f59e0b":s}));let l=null;if(i.count>0){const d=parseFloat((i.count/e*100).toFixed(1));l={...i,percentage:d,progressBarWidth:d,progressBarColor:"#6c757d"}}return{employees:n,others:l}}function Kl(o,e){const s={weekStart:[],weekEnd:[],current:[],others:{weekStart:{count:0,employeeCount:0},weekEnd:{count:0,employeeCount:0},current:{count:0,employeeCount:0}}};return["weekStart","weekEnd","current"].forEach(r=>{const i=e[r];if(!i)return;const n=hs(o,i),l=Ma(o,i);if(n.length===0)return;const{visible:d,others:g}=fs(n,Ht),p=Na(d,l);s[r]=p,g.count>0&&(s.others[r]={count:g.count,employeeCount:g.employeeCount,percentage:parseFloat((g.count/l*100).toFixed(1))})}),s}function ql(o,e="current",s=[]){const t=o[e];if(!t)return{labels:[],datasets:[]};const r=new Map;s.forEach(T=>{hs(T.id,t).forEach(y=>{r.has(y.id)||r.set(y.id,{id:y.id,name:y.name,isKeeper:y.isKeeper||!1,ticketsByStage:{}}),r.get(y.id).ticketsByStage[T.id]=y.count})});const i=Array.from(r.values()).map(T=>{const v=Object.values(T.ticketsByStage).reduce((y,k)=>y+k,0);return{...T,totalTickets:v}});i.sort((T,v)=>v.totalTickets-T.totalTickets);const{visible:n,others:l}=fs(i,Ht),d=s.map(()=>""),g={};s.forEach(T=>{const v=hs(T.id,t),{visible:y}=fs(v,Ht);g[T.id]=y.map(k=>({id:k.id,name:k.name,count:k.count}))});const p=n.map((T,v)=>{const y=s.map(S=>T.ticketsByStage[S.id]||0),k=s.map(S=>{if((T.ticketsByStage[S.id]||0)===0)return"transparent";const w=S.color.replace("#",""),$=parseInt(w.substring(0,2),16),W=parseInt(w.substring(2,4),16),L=parseInt(w.substring(4,6),16),D=.6+v*.05;return`rgba(${$}, ${W}, ${L}, ${Math.min(D,.95)})`});return{label:T.name,data:y,backgroundColor:k,borderColor:s.map(S=>{const C=S.color.replace("#",""),f=parseInt(C.substring(0,2),16),w=parseInt(C.substring(2,4),16),$=parseInt(C.substring(4,6),16);return`rgba(${f}, ${w}, ${$}, 0.8)`}),borderWidth:1,meta:{employeeId:T.id,employeeName:T.name}}});if(l.count>0){const T=s.map(v=>l.employees.reduce((y,k)=>y+(k.ticketsByStage[v.id]||0),0));p.push({label:`–î—Ä—É–≥–∏–µ (${l.employeeCount})`,data:T,backgroundColor:"rgba(108, 117, 125, 0.5)",borderColor:"#6c757d",borderWidth:1})}return{labels:d,datasets:p,meta:{employeesByStage:g}}}function Yl(o,e,s=[]){if(!e)return{stageName:"",totalCount:0,employees:[],others:null};const t=s.find(g=>g.id===o),r=t?t.name:"",i=t?t.color:"#007bff",n=hs(o,e),l=Ma(o,e);if(n.length===0)return{stageName:r,totalCount:0,employees:[],others:null};const d=os(n,l,i,Ht);return{stageName:r,totalCount:l,employees:d.employees,others:d.others}}function Xl(o,e){return e?.[o]||o}function Jl(o,e){return e?.[o]||"#007bff"}function Fs({snapshots:o,graphType:e,timePoint:s,snapshotType:t}){return o?e==="line"&&s?o[s]||null:e==="bar"&&t?o[t]||null:o.current||o.weekEnd||o.weekStart||null:null}function Hs(o,e){return e?.statistics?.stages?.[o]?.count||0}function Zl({stageId:o,timePoint:e,meta:s,snapshots:t,stageColor:r,maxVisible:i}){if(!s?.employees||!e)return null;const n=s.employees[e];if(!n||n.length===0)return null;const l=t?.[e]||null,d=Hs(o,l)||n.reduce((p,T)=>p+(T.count||0),0),g=os(n,d,r,i);return{stageId:o,totalCount:d,employees:g.employees,others:g.others,snapshot:l}}function Ql({stageId:o,meta:e,snapshots:s,stageColor:t,maxVisible:r}){const i=e?.employees?.[o];if(!i||!i.employees||i.employees.length===0)return null;const n=Fs({snapshots:s,graphType:"doughnut"}),l=i.totalCount??Hs(o,n)??i.employees.reduce((g,p)=>g+(p.count||0),0),d=os(i.employees,l,t,r);return{stageId:o,totalCount:l,employees:d.employees,others:d.others,snapshot:n}}function ec({stageId:o,meta:e,snapshots:s,stageColor:t,maxVisible:r,snapshotType:i}){const n=e?.employeesByStage?.[o];if(!n||n.length===0)return null;const l=Fs({snapshots:s,graphType:"bar",snapshotType:i}),d=Hs(o,l)||n.reduce((p,T)=>p+(T.count||0),0),g=os(n,d,t,r);return{stageId:o,totalCount:d,employees:g.employees,others:g.others,snapshot:l}}async function xa({stageId:o,graphType:e,timePoint:s=null,snapshotType:t=null,snapshots:r=null,meta:i=null,stageColorMap:n=null,stageNameMap:l=null,maxVisible:d=10,restLoader:g=null}){if(!o)throw new Error("stageId –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω—è 1");const p=Xl(o,l),T=Jl(o,n);let v=null;if(e==="line"?v=Zl({stageId:o,timePoint:s,meta:i?.line,snapshots:r,stageColor:T,maxVisible:d}):e==="doughnut"?v=Ql({stageId:o,meta:i?.doughnut,snapshots:r,stageColor:T,maxVisible:d}):e==="bar"&&(v=ec({stageId:o,meta:i?.bar,snapshots:r,stageColor:T,maxVisible:d,snapshotType:t})),v)return{stageId:o,stageName:p,color:T,totalCount:v.totalCount,employees:v.employees,others:v.others,snapshot:v.snapshot};if(typeof g=="function"){const y=await g({stageId:o,graphType:e,timePoint:s,snapshotType:t,snapshots:r});if(y&&Array.isArray(y.employees)){const k=y.totalCount??y.employees.reduce((C,f)=>C+(f.count||0),0),S=os(y.employees,k,T,d);return{stageId:o,stageName:p,color:T,totalCount:k,employees:S.employees,others:S.others,snapshot:y.snapshot||Fs({snapshots:r,graphType:e,timePoint:s,snapshotType:t})}}}throw new Error("–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã (meta/REST)")}const tc={key:"level-1",class:"level-1"},sc={class:"modal-header"},ac={class:"stage-header"},oc=["aria-expanded","onKeydown"],nc={class:"stage-title"},rc=["aria-selected","onClick","onKeydown"],ic={class:"stage-name"},lc={class:"modal-total"},cc={class:"view-switcher"},dc={class:"modal-body"},uc={key:0,class:"load-error"},gc={key:1,class:"stage-loader"},mc={key:2},hc={key:0,class:"no-employees"},fc={key:1,class:"employees-list"},vc=["onClick"],pc={class:"employee-name"},yc={class:"employee-progress"},kc={class:"employee-count"},bc={key:0,class:"employee-item employee-others"},_c={class:"employee-name"},wc={class:"employee-progress"},Cc={class:"employee-count"},Tc={key:3,class:"view-time"},Sc={key:0,class:"no-data"},Dc={key:1,class:"date-categories-list"},Ec=["onClick"],Ac={class:"category-label"},$c={class:"category-progress"},Ic={class:"category-count"},Mc={key:4,class:"view-departments"},Nc={key:0,class:"no-data"},xc={key:1,class:"departments-table-container"},Lc={class:"departments-table"},Pc=["onClick"],Oc={class:"col-department"},Rc={class:"department-name"},Bc={class:"col-count"},Uc={class:"count-value"},Wc={key:"level-2",class:"level-2"},Fc={class:"modal-header"},Hc={class:"modal-total"},jc={class:"modal-body"},Vc={class:"stage-info level2-stage-row"},zc={class:"stage-badge"},Gc={class:"level2-sort-switch",role:"group","aria-label":"–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏"},Kc={key:0},qc={key:0,class:"no-data"},Yc={key:1,class:"date-categories-list"},Xc=["onClick"],Jc={class:"category-label"},Zc={class:"category-progress"},Qc={class:"category-count"},ed={key:1,class:"view-departments"},td={key:0,class:"no-data"},sd={key:1,class:"departments-table-container"},ad={class:"departments-table"},od=["onClick"],nd={class:"col-department"},rd={class:"department-name"},id={class:"col-count"},ld={class:"count-value"},cd={key:"level-3",class:"level-3"},dd={class:"modal-header"},ud={class:"header-info"},gd={class:"header-badges"},md={class:"date-badge"},hd={class:"stage-badge"},fd={class:"modal-total"},vd={class:"modal-body"},pd={key:0,class:"no-data"},yd={key:1,class:"departments-table-container"},kd={class:"departments-table"},bd=["onClick"],_d={class:"col-department"},wd={class:"department-name"},Cd={class:"col-count"},Td={class:"count-value"},Sd={key:"level-4",class:"level-4"},Dd={class:"modal-header"},Ed={class:"header-info"},Ad={key:0,class:"header-badges"},$d={key:0,class:"date-badge"},Id={key:1,class:"department-badge"},Md={class:"stage-badge"},Nd={class:"modal-total"},xd={class:"modal-body"},Ld={key:"loading",class:"loading-state"},Pd={key:"error-fallback",class:"error-state-with-fallback"},Od={class:"tickets-list-container"},Rd={key:"error",class:"error-state"},Bd={class:"error-message"},Ud={key:"empty",class:"empty-state"},Wd={class:"empty-state-title"},Fd={class:"empty-state-message"},Hd={key:"tickets",class:"tickets-list-container"},jd={__name:"EmployeeDetailsModal",props:{isVisible:{type:Boolean,default:!1},stageName:{type:String,required:!0},stageId:{type:String,default:""},totalCount:{type:Number,required:!0},employees:{type:Array,default:()=>[]},others:{type:Object,default:null},snapshot:{type:Object,default:null},ticketDetails:{type:Object,default:null},stageSwitchContext:{type:Object,default:null}},emits:["close"],setup(o,{expose:e,emit:s}){const t=o,r=s,i=mt(),n=I(1),l=I("time"),d=I("employees"),g=I(null),p=I([]),T=I([]),v=I(null),y=I(null),k=I(null),S=I(t.stageSwitchContext||null),C=I(!1),f=I(null),w=I(null),$=I(!1),W=I(null),L=I(null),D=M(()=>{const z=S.value?.stageNameMap||{},N=S.value?.stageColorMap||{};return Object.keys(z).map(b=>({id:b,name:z[b],color:N[b]||"#007bff",disabled:b===(g.value?.stageId||t.stageId)}))});M(()=>n.value>1);const E=M(()=>{switch(n.value){case 1:return g.value?.stageName||t.stageName;case 2:return v.value?.employeeName||"";case 3:return`${v.value?.employeeName||""} ‚Äî ${y.value?.dateCategoryLabel||""}`;case 4:if(!k.value?.context)return"–°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤";const z=k.value.context,N=[];return z.employeeName&&N.push(z.employeeName),z.dateCategoryLabel&&N.push(z.dateCategoryLabel),z.departmentName&&N.push(z.departmentName),z.stageName&&N.push(z.stageName),N.length>0?N.join(" ‚Äî "):"–°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤";default:return""}});function x(){console.log("[EmployeeDetailsModal] Initializing level 1 with props:",{stageName:t.stageName,stageId:t.stageId,totalCount:t.totalCount,employeesCount:t.employees?.length||0,hasSnapshot:!!t.snapshot,snapshotTicketIds:t.snapshot?.ticketIds?.length||0,hasTicketDetails:!!t.ticketDetails,snapshotKeys:t.snapshot?Object.keys(t.snapshot):[]}),g.value={stageName:t.stageName,stageId:t.stageId,totalCount:t.totalCount,employees:t.employees||[],others:t.others||null,snapshot:t.snapshot||null,ticketDetails:t.ticketDetails||null},console.log("[EmployeeDetailsModal] Level 1 data initialized:",{stageId:g.value.stageId,hasSnapshot:!!g.value.snapshot,employeesCount:g.value.employees.length,snapshotType:g.value.snapshot?typeof g.value.snapshot:"null"}),v.value=null,y.value=null,k.value=null,n.value=1,l.value="time",d.value="employees",R(),console.log("[EmployeeDetailsModal] Popup level set to 1, ready for clicks")}async function R(){if(!g.value||!g.value.snapshot||!g.value.stageId){console.warn("[EmployeeDetailsModal] Cannot load level 1 view data - missing required data");return}try{const z=g.value.snapshot.tickets||[],N=g.value.stageId;console.log("[EmployeeDetailsModal] Loading level 1 view data:",{totalSnapshotTickets:z.length,currentStageId:N,sampleTicket:z[0]?{id:z[0].id,stageId:z[0].stageId,hasDepartmentHead:!!z[0].departmentHead,departmentHead:z[0].departmentHead,hasDepartmentHeadFull:!!z[0].departmentHeadFull,departmentHeadFull:z[0].departmentHeadFull,allKeys:Object.keys(z[0])}:null});let b=z.filter(K=>K.stageId?Zt(K.stageId)===N:!0);console.log("[EmployeeDetailsModal] Filtered tickets by stage:",{beforeFilter:z.length,afterFilter:b.length,stageId:N,ticketsWithStageId:b.filter(K=>K.stageId).length,ticketsWithoutStageId:b.filter(K=>!K.stageId).length});const O=b.filter(K=>!K.departmentHead&&!K.departmentHeadFull);if(O.length>0){console.log("[EmployeeDetailsModal] DepartmentHead missing for some tickets, loading via API...",{ticketsNeedingDetails:O.length,totalTickets:b.length,ticketsWithDepartment:b.filter(j=>j.departmentHead||j.departmentHeadFull).length});const K=O.map(j=>j.id).filter(j=>j);try{console.log("[EmployeeDetailsModal] Loading details for tickets:",{ticketIdsCount:K.length,ticketIdsSample:K.slice(0,10)});const j=await yo.getTicketsDetails(K),V=new Map;j.forEach(F=>{F&&F.id&&V.set(F.id,F)}),console.log("[EmployeeDetailsModal] Details loaded from API:",{detailsCount:j.length,detailsMapSize:V.size,sampleDetail:j[0]?{id:j[0].id,departmentHead:j[0].departmentHead,departmentHeadFull:j[0].departmentHeadFull}:null}),b=b.map(F=>{const ie=V.get(F.id);return ie?{...F,stageId:ie.stageId||F.stageId||null,departmentHead:ie.departmentHead||F.departmentHead||null,departmentHeadFull:ie.departmentHeadFull||ie.departmentHead||F.departmentHead||null}:F}),b=b.filter(F=>F.stageId?Zt(F.stageId)===N:!0),console.log("[EmployeeDetailsModal] Ticket details merged (before stage filter):",{totalTickets:b.length,ticketsWithDepartment:b.filter(F=>F.departmentHead||F.departmentHeadFull).length,ticketsWithoutDepartment:b.filter(F=>!F.departmentHead&&!F.departmentHeadFull).length,ticketsWithStageId:b.filter(F=>F.stageId).length,ticketsWithoutStageId:b.filter(F=>!F.stageId).length});const se=b.length,ge=b.slice(0,3).map(F=>({id:F.id,departmentHead:F.departmentHead,departmentHeadFull:F.departmentHeadFull,stageId:F.stageId}));b=b.filter(F=>F.stageId?Zt(F.stageId)===N:!0);const ye=b.slice(0,3).map(F=>({id:F.id,departmentHead:F.departmentHead,departmentHeadFull:F.departmentHeadFull,stageId:F.stageId}));console.log("[EmployeeDetailsModal] Ticket details merged (after stage filter):",{beforeStageFilter:se,afterStageFilter:b.length,filteredOut:se-b.length,currentStageId:N,ticketsWithDepartment:b.filter(F=>F.departmentHead||F.departmentHeadFull).length,ticketsWithoutDepartment:b.filter(F=>!F.departmentHead&&!F.departmentHeadFull).length,sampleBeforeFilter:ge,sampleAfterFilter:ye,sampleWithDepartment:b.find(F=>F.departmentHead||F.departmentHeadFull)?{id:b.find(F=>F.departmentHead||F.departmentHeadFull).id,departmentHead:b.find(F=>F.departmentHead||F.departmentHeadFull).departmentHead,departmentHeadFull:b.find(F=>F.departmentHead||F.departmentHeadFull).departmentHeadFull,allKeys:Object.keys(b.find(F=>F.departmentHead||F.departmentHeadFull)).filter(F=>F.toLowerCase().includes("department"))}:null})}catch(j){console.warn("[EmployeeDetailsModal] Failed to load ticket details via API, using snapshot data:",j),console.error("[EmployeeDetailsModal] Error details:",{message:j.message,stack:j.stack})}}else console.log("[EmployeeDetailsModal] All tickets have departmentHead, skipping API load");console.log("[EmployeeDetailsModal] Final tickets for grouping (only current stage):",{totalTickets:b.length,currentStageId:N,ticketsWithStageId:b.filter(K=>K.stageId).length,ticketsWithoutStageId:b.filter(K=>!K.stageId).length,ticketsWithDepartment:b.filter(K=>K.departmentHead||K.departmentHeadFull).length,ticketsWithoutDepartment:b.filter(K=>!K.departmentHead&&!K.departmentHeadFull).length});const Q=ea(b);p.value=Q,console.log("[EmployeeDetailsModal] Before groupTicketsByDepartment:",{ticketsCount:b.length,sampleTickets:b.slice(0,5).map(K=>({id:K.id,departmentHead:K.departmentHead,departmentHeadFull:K.departmentHeadFull,hasDepartmentHead:!!K.departmentHead,hasDepartmentHeadFull:!!K.departmentHeadFull,allKeys:Object.keys(K).filter(j=>j.toLowerCase().includes("department"))})),ticketsWithDepartment:b.filter(K=>K.departmentHead||K.departmentHeadFull).length,ticketsWithoutDepartment:b.filter(K=>!K.departmentHead&&!K.departmentHeadFull).length});const ue=ta(b);T.value=ue;const ke=Q.reduce((K,j)=>K+j.count,0),_e=ue.reduce((K,j)=>K+j.count,0);console.log("[EmployeeDetailsModal] Level 1 view data loaded (only current stage):",{currentStageId:N,totalTicketsForGrouping:b.length,timeCategoriesCount:Q.length,totalTicketsInTimeCategories:ke,departmentsCount:ue.length,totalTicketsInDepartments:_e,departmentsSample:ue.slice(0,5),ticketsWithDepartment:b.filter(K=>K.departmentHead||K.departmentHeadFull).length,ticketsWithoutDepartment:b.filter(K=>!K.departmentHead&&!K.departmentHeadFull).length,consistencyCheck:{totalTickets:b.length,timeCategoriesTotal:ke,departmentsTotal:_e,isConsistent:b.length===ke&&b.length===_e}})}catch(z){console.error("[EmployeeDetailsModal] Error loading level 1 view data:",z),console.error("[EmployeeDetailsModal] Error stack:",z.stack)}}async function U(z){if(!z){i.error("–ù–µ —É–∫–∞–∑–∞–Ω stageId –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö");return}if(g.value?.stageId===z)return;if(!S.value){i.error("–ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–º–µ–Ω—ã —Å—Ç–∞–¥–∏–∏ (stageSwitchContext)");return}C.value=!0,f.value=null;const N=g.value?{...g.value}:null;w.value=N?.stageId||null;try{const b=await xa({...S.value,stageId:z});g.value={stageId:b.stageId,stageName:b.stageName,stageColor:b.color,totalCount:b.totalCount,employees:b.employees,others:b.others,snapshot:b.snapshot||N?.snapshot||null,ticketDetails:b.ticketDetails||null},v.value=null,y.value=null,k.value=null,n.value=1,l.value="time",d.value="employees",await R()}catch(b){console.error("[EmployeeDetailsModal] Failed to reload stage data:",b),f.value=b?.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏",N&&(g.value=N),i.error(f.value)}finally{C.value=!1}}async function G(z){if(!z||z.count===0){i.info(`–£ –∑–∞–∫–∞–∑—á–∏–∫–∞ "${z?.departmentName||"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!y.value){console.error("[EmployeeDetailsModal] Level 3 data not found"),i.error("–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è 3 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}try{const{createContextFromLevel3:N}=await Se(async()=>{const{createContextFromLevel3:O}=await import("./chunk-yvHyt3PJ.js").then(Q=>Q.t);return{createContextFromLevel3:O}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),b=await N(y.value,z);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 3:",{employeeName:b.employeeName,dateCategory:b.dateCategoryLabel,departmentName:b.departmentName,ticketsCount:b.tickets.length}),await fe(b)}catch(N){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 3:",N),i.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤: "+N.message)}}async function q(z){if(!z||z.count===0){i.info(`–£ –∑–∞–∫–∞–∑—á–∏–∫–∞ "${z?.departmentName||"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!g.value){console.error("[EmployeeDetailsModal] Level 1 data not found"),i.error("–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è 1 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}try{const{createContextFromLevel1Department:N}=await Se(async()=>{const{createContextFromLevel1Department:O}=await import("./chunk-yvHyt3PJ.js").then(Q=>Q.t);return{createContextFromLevel1Department:O}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),b=N(g.value,z);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 1 (department):",{stageName:b.stageName,departmentName:b.departmentName,ticketsCount:b.tickets.length}),await fe(b)}catch(N){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 1 (department):",N),i.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤: "+N.message)}}async function oe(z){if(!z||z.count===0){i.info(`–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${z?.label||"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è"}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!z.tickets||z.tickets.length===0){i.info(`–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${z.label}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!g.value){console.error("[EmployeeDetailsModal] Level 1 data not found"),i.error("–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è 1 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}try{const{createContextFromLevel1Time:N}=await Se(async()=>{const{createContextFromLevel1Time:O}=await import("./chunk-yvHyt3PJ.js").then(Q=>Q.t);return{createContextFromLevel1Time:O}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),b=N(g.value,z);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 1 (time):",{stageName:b.stageName,dateCategory:b.dateCategoryLabel,ticketsCount:b.tickets.length}),await fe(b)}catch(N){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 1 (time):",N),i.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤: "+N.message)}}Ne(()=>t.isVisible,z=>{z?x():(h(),De())}),Ne(()=>t.stageSwitchContext,z=>{S.value=z},{deep:!0}),$e(()=>{t.isVisible&&x()});async function Y(z,N=null){if(console.log("[EmployeeDetailsModal] ====== handleEmployeeClick START ======"),console.log("[EmployeeDetailsModal] Employee clicked:",z),console.log("[EmployeeDetailsModal] Current popup level:",n.value),N&&N.currentTarget&&(N.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{N.currentTarget&&(N.currentTarget.style.transform="")},150)),!z||!z.id){console.warn("[EmployeeDetailsModal] Invalid employee data:",z);return}if(g.value||(console.log("[EmployeeDetailsModal] Level 1 data not found, initializing from props"),g.value={stageName:t.stageName,stageId:t.stageId,totalCount:t.totalCount,employees:t.employees||[],others:t.others||null,snapshot:t.snapshot||null,ticketDetails:t.ticketDetails||null}),console.log("[EmployeeDetailsModal] Level 1 data:",{stageId:g.value.stageId,stageName:g.value.stageName,hasSnapshot:!!g.value.snapshot,snapshotType:g.value.snapshot?typeof g.value.snapshot:"null",snapshotKeys:g.value.snapshot?Object.keys(g.value.snapshot):[]}),!g.value.stageId){console.error("[EmployeeDetailsModal] ERROR: ID —Å—Ç–∞–¥–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω"),i.warning("ID —Å—Ç–∞–¥–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω");return}if(!g.value.snapshot){console.error("[EmployeeDetailsModal] ERROR: –°–ª–µ–ø–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω"),console.error("[EmployeeDetailsModal] Props snapshot:",t.snapshot),i.warning("–°–ª–µ–ø–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω");return}try{console.log("[EmployeeDetailsModal] Loading tickets for employee:",z.id,"stage:",g.value.stageId);const{filterTicketsByDepartment:b}=await Se(async()=>{const{filterTicketsByDepartment:ke}=await import("./chunk-D3JwNzSL.js").then(_e=>_e.l);return{filterTicketsByDepartment:ke}},__vite__mapDeps([3,4]),import.meta.url).then(ke=>ke.LazyServiceLoader.loadTicketListUtils()),O=await po(z.id,g.value.stageId,g.value.snapshot,g.value.ticketDetails);if(console.log("[EmployeeDetailsModal] Loaded tickets:",O?.length||0,O),!O||O.length===0){console.warn("[EmployeeDetailsModal] No tickets found for employee"),i.info(`–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ "${z.name}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –Ω–∞ —Å—Ç–∞–¥–∏–∏ "${g.value.stageName}"`);return}const Q=ea(O);console.log("[EmployeeDetailsModal] Date categories:",Q?.length||0,Q);const ue=ta(O).map(ke=>({...ke,tickets:b(O,ke.departmentName)}));console.log("[EmployeeDetailsModal] Employee departments:",ue?.length||0,ue),v.value={employeeId:z.id,employeeName:z.name,stageId:g.value.stageId,stageName:g.value.stageName,totalCount:O.length,dateCategories:Q,departments:ue,tickets:O,snapshot:g.value.snapshot,ticketDetails:g.value.ticketDetails},l.value="time",console.log("[EmployeeDetailsModal] Level 2 data set:",{employeeName:v.value.employeeName,totalCount:v.value.totalCount,dateCategoriesCount:v.value.dateCategories.length,departmentsCount:v.value.departments.length}),console.log("[EmployeeDetailsModal] Transitioning to level 2"),console.log("[EmployeeDetailsModal] Level 2 data before set:",v.value),n.value=2,console.log("[EmployeeDetailsModal] Popup level set to:",n.value),console.log("[EmployeeDetailsModal] Level 2 data after set:",v.value),console.log("[EmployeeDetailsModal] Level 2 data check:",{hasLevel2Data:!!v.value,employeeName:v.value?.employeeName,dateCategoriesCount:v.value?.dateCategories?.length||0}),setTimeout(()=>{console.log("[EmployeeDetailsModal] After timeout - popupLevel:",n.value),console.log("[EmployeeDetailsModal] After timeout - level2Data:",v.value)},100),console.log("[EmployeeDetailsModal] ====== handleEmployeeClick END ======")}catch(b){console.error("[EmployeeDetailsModal] ERROR loading employee tickets:",b),console.error("[EmployeeDetailsModal] Error stack:",b.stack),i.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ —Ç–∏–∫–µ—Ç–∞—Ö: "+b.message)}}async function H(z){if(!z||z.count===0){i.info(`–£ –∑–∞–∫–∞–∑—á–∏–∫–∞ "${z?.departmentName||"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!v.value){i.error("–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}try{const{createContextFromLevel2Department:N}=await Se(async()=>{const{createContextFromLevel2Department:O}=await import("./chunk-yvHyt3PJ.js").then(Q=>Q.t);return{createContextFromLevel2Department:O}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),b=N(v.value,z);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 2 (department):",{employeeName:b.employeeName,departmentName:b.departmentName,ticketsCount:b.tickets.length}),await fe(b)}catch(N){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 2 (department):",N),i.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤: "+N.message)}}async function Z(z){if(!z||z.count===0){i.info(`–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${z?.label||"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è"}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!z.tickets||z.tickets.length===0){i.info(`–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${z.label}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!v.value){console.error("[EmployeeDetailsModal] Level 2 data not found"),i.error("–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è 2 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}try{const{createContextFromLevel2:N}=await Se(async()=>{const{createContextFromLevel2:O}=await import("./chunk-yvHyt3PJ.js").then(Q=>Q.t);return{createContextFromLevel2:O}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),b=N(v.value,z);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 2:",{employeeName:b.employeeName,dateCategory:b.dateCategoryLabel,ticketsCount:b.tickets.length}),await fe(b)}catch(N){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 2:",N),i.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤: "+N.message)}}async function fe(z){if(console.time("[Performance] goToLevel4"),!z){console.error("[EmployeeDetailsModal] Context is required for level 4"),i.error("–û—à–∏–±–∫–∞: –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–µ —É–∫–∞–∑–∞–Ω"),console.timeEnd("[Performance] goToLevel4");return}console.log("[EmployeeDetailsModal] Transitioning to level 4:",{sourceLevel:z.sourceLevel,employeeId:z.employeeId,stageId:z.stageId,dateCategory:z.dateCategory,departmentName:z.departmentName,ticketsCount:z.tickets?.length||0});try{k.value={context:z,tickets:[],totalCount:0,isLoading:!0,error:null};let N=z.tickets||[];if(N.length===0&&z.snapshot){const{filterTicketsByContext:O}=await Se(async()=>{const{filterTicketsByContext:Q}=await import("./chunk-yvHyt3PJ.js").then(ue=>ue.t);return{filterTicketsByContext:Q}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);N=await O(z)}(!N||N.length===0)&&(console.warn("[EmployeeDetailsModal] No tickets found after filtering, using context tickets"),N=z.tickets||[]),(!N||N.length===0)&&(console.warn("[EmployeeDetailsModal] No tickets in context, trying snapshot"),z.snapshot&&z.snapshot.tickets&&(N=z.snapshot.tickets||[],console.log("[EmployeeDetailsModal] Using tickets from snapshot:",N.length)));let b=[];try{console.time("[Performance] prepareTicketsForDisplay");const{prepareTicketsForDisplay:O}=await Se(async()=>{const{prepareTicketsForDisplay:Q}=await import("./chunk-yvHyt3PJ.js").then(ue=>ue.t);return{prepareTicketsForDisplay:Q}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);b=await O(N,z.snapshot,z.ticketDetails),console.timeEnd("[Performance] prepareTicketsForDisplay")}catch(O){console.error("[EmployeeDetailsModal] Error preparing tickets:",O),console.timeEnd("[Performance] prepareTicketsForDisplay"),b=N||[],i.warning("–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç–æ–≤ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å. –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.")}console.log("[EmployeeDetailsModal] Tickets prepared for level 4:",{filteredCount:N.length,preparedCount:b.length}),k.value={context:z,tickets:b,totalCount:b.length,isLoading:!1,error:null},n.value=4,console.log("[EmployeeDetailsModal] Level 4 initialized:",{totalCount:k.value.totalCount,ticketsCount:k.value.tickets.length,isLoading:k.value.isLoading}),console.timeEnd("[Performance] goToLevel4")}catch(N){console.error("[EmployeeDetailsModal] Error transitioning to level 4:",N),console.error("[EmployeeDetailsModal] Error details:",{message:N.message,stack:N.stack,context:z});let b=[];if(z.snapshot&&z.snapshot.tickets)try{const O=z.stageId;O?b=(z.snapshot.tickets||[]).filter(Q=>Q.stageId===O):b=z.snapshot.tickets||[],console.log("[EmployeeDetailsModal] Using fallback tickets from snapshot:",b.length)}catch(O){console.error("[EmployeeDetailsModal] Error using fallback tickets:",O)}k.value={context:z,tickets:b,totalCount:b.length,isLoading:!1,error:{message:N.message,hasFallback:b.length>0}},b.length>0?(i.warning("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞."),n.value=4):(i.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤: "+N.message),P()),console.timeEnd("[Performance] goToLevel4")}}function P(){if(n.value===4){if(k.value&&k.value.context){const z=k.value.context.sourceLevel;n.value=z}else n.value=1;k.value=null}else n.value===3?(n.value=2,y.value=null,k.value=null):n.value===2&&(n.value=1,v.value=null,y.value=null,k.value=null)}function h(){n.value=1,g.value=null,v.value=null,y.value=null,k.value=null,l.value="time"}function _(){if(!k.value?.context)return"–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤";const{sourceLevel:z,employeeName:N,dateCategoryLabel:b,departmentName:O}=k.value.context;return z===2&&N&&b?`–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ —É ${N} –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${b}"`:z===2&&N&&O?`–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ —É ${N} —É –∑–∞–∫–∞–∑—á–∏–∫–∞ "${O}"`:z===3&&N&&O?`–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ —É ${N} —É –∑–∞–∫–∞–∑—á–∏–∫–∞ "${O}"`:z===1&&b?`–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${b}"`:z===1&&O?`–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ —É –∑–∞–∫–∞–∑—á–∏–∫–∞ "${O}"`:"–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"}function B(){if(!k.value?.context)return"–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞.";const{stageName:z}=k.value.context;return z?`–ù–∞ —Å—Ç–∞–¥–∏–∏ "${z}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º.`:"–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞."}async function re(){if(!k.value?.context){console.error("[EmployeeDetailsModal] Cannot retry: context not found");return}const z=k.value.context;await fe(z)}function le(z){if(!z){console.warn("[EmployeeDetailsModal] Ticket is null or undefined"),i.warning("–û—à–∏–±–∫–∞: —Ç–∏–∫–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");return}if(!z.id){console.error("[EmployeeDetailsModal] Ticket ID is missing:",z),i.error("–û—à–∏–±–∫–∞: ID —Ç–∏–∫–µ—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω");return}try{const N=ss(z.id);if(console.log("[EmployeeDetailsModal] Opening ticket:",{ticketId:z.id,iframeUrl:N}),!N||typeof N!="string"||N.length===0)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å URL –¥–ª—è —Ç–∏–∫–µ—Ç–∞");const b=window.open(N,"_blank","noopener,noreferrer");if(!b||b.closed||typeof b.closed>"u")try{const O=document.createElement("a");O.href=N,O.target="_blank",O.rel="noopener noreferrer",O.style.display="none",document.body.appendChild(O),O.click(),document.body.removeChild(O),console.log("[EmployeeDetailsModal] Ticket opened via alternative method:",{ticketId:z.id,iframeUrl:N})}catch{throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É. –í–æ–∑–º–æ–∂–Ω–æ, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω popup blocker. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞.")}else console.log("[EmployeeDetailsModal] Ticket opened successfully:",{ticketId:z.id,iframeUrl:N})}catch(N){console.error("[EmployeeDetailsModal] Error opening ticket:",N),console.error("[EmployeeDetailsModal] Error details:",{message:N.message,stack:N.stack,ticket:z}),i.error("–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ç–∏–∫–µ—Ç–∞: "+N.message)}}function ae(){h(),r("close")}e({reloadLevel1ForStage:U});function me(z){z&&z.stopPropagation(),$.value=!$.value}function De(){$.value&&($.value=!1)}function Ie(z){if(!$.value)return;const N=W.value,b=L.value;N&&N.contains(z.target)||b&&b.contains(z.target)||($.value=!1)}async function xe(z){if(z.disabled){$.value=!1;return}$.value=!1,await U(z.id)}function Fe(z){if($.value){z.stopPropagation(),De();return}ae()}return(z,N)=>(c(),he(It,{to:"body"},[o.isVisible?(c(),u("div",{key:0,class:"employee-details-modal",onClick:Ce(ae,["self"]),onKeydown:Be(Fe,["esc"])},[a("div",{class:"modal-content",onClick:Ie},[ne(Ae,{name:"level",mode:"out-in"},{default:pe(()=>[n.value===1?(c(),u("div",tc,[a("div",sc,[a("div",ac,[a("button",{ref_key:"stageTriggerRef",ref:L,class:"stage-trigger","aria-expanded":$.value,"aria-haspopup":"listbox",onClick:Ce(me,["stop"]),onKeydown:[Be(Ce(me,["prevent"]),["enter"]),Be(Ce(me,["prevent"]),["space"]),Be(Ce(De,["stop","prevent"]),["esc"])]},[a("span",{class:"stage-color",style:we({backgroundColor:g.value?.stageColor||S.value?.stageColorMap?.[g.value?.stageId]||S.value?.stageColorMap?.[o.stageId]||"#007bff"})},null,4),a("span",nc,m(g.value?.stageName||o.stageName),1),a("span",{class:X(["stage-caret",{open:$.value}])},"‚ñæ",2)],40,oc),$.value?(c(),u("div",{key:0,ref_key:"stageDropdownRef",ref:W,class:"stage-dropdown",role:"listbox"},[(c(!0),u(ee,null,te(D.value,b=>(c(),u("div",{key:b.id,class:X(["stage-option",{disabled:b.disabled}]),role:"option","aria-selected":b.disabled,onClick:Ce(O=>xe(b),["stop"]),onKeydown:Be(Ce(O=>xe(b),["prevent"]),["enter"])},[a("span",{class:"stage-color",style:we({backgroundColor:b.color})},null,4),a("span",ic,m(b.name),1)],42,rc))),128))],512)):A("",!0)]),a("span",lc,"–í—Å–µ–≥–æ: "+m(g.value?.totalCount||o.totalCount)+" —Ç–∏–∫–µ—Ç–æ–≤",1),a("button",{class:"modal-close",onClick:ae,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),a("div",cc,[a("button",{class:X(["view-switch-btn",{active:d.value==="employees"}]),onClick:N[0]||(N[0]=b=>d.value="employees"),title:"–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"}," üë• –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º ",2),a("button",{class:X(["view-switch-btn",{active:d.value==="time"}]),onClick:N[1]||(N[1]=b=>d.value="time"),title:"–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –≥—Ä–∞–¥–∞—Ü–∏—è–º"}," üìÖ –ü–æ –≤—Ä–µ–º–µ–Ω–∏ ",2),a("button",{class:X(["view-switch-btn",{active:d.value==="departments"}]),onClick:N[2]||(N[2]=b=>d.value="departments"),title:"–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –∑–∞–∫–∞–∑—á–∏–∫–∞–º"}," üè¢ –ü–æ –∑–∞–∫–∞–∑—á–∏–∫–∞–º ",2)]),a("div",dc,[f.value?(c(),u("div",uc,[a("span",null,"–û—à–∏–±–∫–∞: "+m(f.value),1),a("button",{class:"btn-retry-stage",onClick:N[3]||(N[3]=b=>U(g.value?.stageId||o.stageId))}," –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")])):A("",!0),C.value?(c(),u("div",gc,[...N[7]||(N[7]=[a("div",{class:"loading-spinner small"},null,-1),a("span",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–∏...",-1)])])):A("",!0),d.value==="employees"?(c(),u("div",mc,[(g.value?.employees||o.employees).length===0&&(!(g.value?.others||o.others)||(g.value?.others||o.others).count===0)?(c(),u("div",hc," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö ")):(c(),u("div",fc,[(c(!0),u(ee,null,te(g.value?.employees||o.employees,b=>(c(),u("div",{key:b.id,class:X(["employee-item",{"employee-keeper":b.isKeeper}]),onClick:Ce(O=>Y(b,O),["stop"]),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –≥—Ä–∞–¥–∞—Ü–∏—è–º"},[a("span",pc,m(b.name),1),a("div",yc,[a("div",{class:"progress-bar",style:we({width:b.progressBarWidth+"%",backgroundColor:b.progressBarColor})},null,4)]),a("span",kc,m(b.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ("+m(b.percentage)+"%) ",1),N[8]||(N[8]=a("span",{class:"employee-arrow"},"‚Üí",-1))],10,vc))),128)),(g.value?.others||o.others)&&(g.value?.others||o.others).count>0?(c(),u("div",bc,[a("span",_c,"–î—Ä—É–≥–∏–µ ("+m((g.value?.others||o.others).employeeCount)+")",1),a("div",wc,[a("div",{class:"progress-bar",style:we({width:(g.value?.others||o.others).progressBarWidth+"%",backgroundColor:(g.value?.others||o.others).progressBarColor})},null,4)]),a("span",Cc,m((g.value?.others||o.others).count)+" —Ç–∏–∫–µ—Ç–æ–≤ ("+m((g.value?.others||o.others).percentage)+"%) ",1)])):A("",!0)]))])):d.value==="time"?(c(),u("div",Tc,[p.value.length===0?(c(),u("div",Sc," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):(c(),u("div",Dc,[(c(!0),u(ee,null,te(p.value,b=>(c(),u("div",{key:b.category,class:"category-item",onClick:Ce(O=>oe(b),["stop"])},[a("span",Ac,m(b.label),1),a("div",$c,[a("div",{class:"progress-bar",style:we({width:b.progressBarWidth+"%",backgroundColor:b.progressBarColor})},null,4)]),a("span",Ic,m(b.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ("+m(b.percentage)+"%) ",1),N[9]||(N[9]=a("span",{class:"category-arrow"},"‚Üí",-1))],8,Ec))),128))]))])):d.value==="departments"?(c(),u("div",Mc,[T.value.length===0?(c(),u("div",Nc," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):(c(),u("div",xc,[a("table",Lc,[N[11]||(N[11]=a("thead",null,[a("tr",null,[a("th",{class:"col-department"},"–ó–∞–∫–∞–∑—á–∏–∫"),a("th",{class:"col-count"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–µ—Ç–æ–≤"),a("th",{class:"col-action"})])],-1)),a("tbody",null,[(c(!0),u(ee,null,te(T.value,(b,O)=>(c(),u("tr",{key:O,class:"department-row",onClick:Ce(Q=>q(b),["stop"]),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤"},[a("td",Oc,[a("span",Rc,m(b.departmentName),1)]),a("td",Bc,[a("span",Uc,m(b.count),1)]),N[10]||(N[10]=a("td",{class:"col-action"},[a("span",{class:"department-arrow"},"‚Üí")],-1))],8,Pc))),128))])])]))])):A("",!0)])])):n.value===2&&v.value?(c(),u("div",Wc,[a("div",Fc,[a("button",{class:"btn-back",onClick:P,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê "),a("h3",null,m(v.value.employeeName),1),a("span",Hc,"–í—Å–µ–≥–æ: "+m(v.value.totalCount)+" —Ç–∏–∫–µ—Ç–æ–≤",1),a("button",{class:"modal-close",onClick:ae,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),a("div",jc,[a("div",Vc,[a("span",zc,m(v.value.stageName),1),a("div",Gc,[a("button",{class:X(["level2-sort-btn",{active:l.value==="time"}]),onClick:N[4]||(N[4]=b=>l.value="time"),title:"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏"}," –ü–æ –≤—Ä–µ–º–µ–Ω–∏ ",2),a("button",{class:X(["level2-sort-btn",{active:l.value==="departments"}]),onClick:N[5]||(N[5]=b=>l.value="departments"),title:"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∑–∞–∫–∞–∑—á–∏–∫–∞–º"}," –ü–æ –∑–∞–∫–∞–∑—á–∏–∫–∞–º ",2)])]),l.value==="time"?(c(),u("div",Kc,[v.value.dateCategories.length===0?(c(),u("div",qc," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–∏–∫–µ—Ç–∞—Ö ")):(c(),u("div",Yc,[(c(!0),u(ee,null,te(v.value.dateCategories,b=>(c(),u("div",{key:b.category,class:"category-item",onClick:Ce(O=>Z(b),["stop"])},[a("span",Jc,m(b.label),1),a("div",Zc,[a("div",{class:"progress-bar",style:we({width:b.progressBarWidth+"%",backgroundColor:b.progressBarColor})},null,4)]),a("span",Qc,m(b.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ("+m(b.percentage)+"%) ",1)],8,Xc))),128))]))])):(c(),u("div",ed,[!v.value.departments||v.value.departments.length===0?(c(),u("div",td,[N[12]||(N[12]=ce(" –î–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∑–∞–∫–∞–∑—á–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã ",-1)),a("button",{class:"btn-retry-stage",onClick:N[6]||(N[6]=b=>Y({id:v.value.employeeId,name:v.value.employeeName}))}," –û–±–Ω–æ–≤–∏—Ç—å ")])):(c(),u("div",sd,[a("table",ad,[N[14]||(N[14]=a("thead",null,[a("tr",null,[a("th",{class:"col-department"},"–ó–∞–∫–∞–∑—á–∏–∫"),a("th",{class:"col-count"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–µ—Ç–æ–≤"),a("th",{class:"col-action"})])],-1)),a("tbody",null,[(c(!0),u(ee,null,te(v.value.departments,(b,O)=>(c(),u("tr",{key:O,class:"department-row",onClick:Ce(Q=>H(b),["stop"]),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤"},[a("td",nd,[a("span",rd,m(b.departmentName),1)]),a("td",id,[a("span",ld,m(b.count),1)]),N[13]||(N[13]=a("td",{class:"col-action"},[a("span",{class:"department-arrow"},"‚Üí")],-1))],8,od))),128))])])]))]))])])):n.value===3&&y.value?(c(),u("div",cd,[a("div",dd,[a("button",{class:"btn-back",onClick:P,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê "),a("div",ud,[a("h3",null,m(y.value.employeeName),1),a("div",gd,[a("span",md,m(y.value.dateCategoryLabel),1),a("span",hd,m(y.value.stageName),1)])]),a("span",fd,"–í—Å–µ–≥–æ: "+m(y.value.totalCount)+" —Ç–∏–∫–µ—Ç–æ–≤",1),a("button",{class:"modal-close",onClick:ae,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),a("div",vd,[y.value.departments.length===0?(c(),u("div",pd," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–∫–∞–∑—á–∏–∫–∞—Ö ")):(c(),u("div",yd,[a("table",kd,[N[16]||(N[16]=a("thead",null,[a("tr",null,[a("th",{class:"col-department"},"–ó–∞–∫–∞–∑—á–∏–∫"),a("th",{class:"col-count"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–µ—Ç–æ–≤"),a("th",{class:"col-action"})])],-1)),a("tbody",null,[(c(!0),u(ee,null,te(y.value.departments,(b,O)=>(c(),u("tr",{key:O,class:"department-row",onClick:Ce(Q=>G(b),["stop"]),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤"},[a("td",_d,[a("span",wd,m(b.departmentName),1)]),a("td",Cd,[a("span",Td,m(b.count),1)]),N[15]||(N[15]=a("td",{class:"col-action"},[a("span",{class:"department-arrow"},"‚Üí")],-1))],8,bd))),128))])])]))])])):n.value===4&&k.value?(c(),u("div",Sd,[a("div",Dd,[a("button",{class:"btn-back",onClick:P,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê "),a("div",Ed,[a("h3",null,m(E.value),1),k.value.context?(c(),u("div",Ad,[k.value.context.dateCategoryLabel?(c(),u("span",$d,m(k.value.context.dateCategoryLabel),1)):A("",!0),k.value.context.departmentName?(c(),u("span",Id,m(k.value.context.departmentName),1)):A("",!0),a("span",Md,m(k.value.context.stageName),1)])):A("",!0)]),a("span",Nd,"–í—Å–µ–≥–æ: "+m(k.value.totalCount)+" —Ç–∏–∫–µ—Ç–æ–≤",1),a("button",{class:"modal-close",onClick:ae,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),a("div",xd,[ne(Ae,{name:"loading",mode:"out-in"},{default:pe(()=>[k.value.isLoading?(c(),u("div",Ld,[...N[17]||(N[17]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):k.value.error&&k.value.error.hasFallback?(c(),u("div",Pd,[N[18]||(N[18]=a("div",{class:"error-banner"},[a("span",{class:"error-icon"},"‚ö†Ô∏è"),a("span",{class:"error-message"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞.")],-1)),a("div",Od,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:pe(()=>[(c(!0),u(ee,null,te(k.value.tickets,(b,O)=>(c(),he(Ct,{key:b.id,ticket:b,draggable:!1,style:we({"--ticket-index":O}),onClick:Q=>le(b)},null,8,["ticket","style","onClick"]))),128))]),_:1})])])):k.value.error&&!k.value.error.hasFallback?(c(),u("div",Rd,[N[19]||(N[19]=a("div",{class:"error-icon"},"‚ùå",-1)),N[20]||(N[20]=a("h3",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö",-1)),a("p",Bd,m(k.value.error.message),1),a("button",{class:"btn-retry",onClick:re},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):!k.value.tickets||k.value.tickets.length===0?(c(),u("div",Ud,[N[21]||(N[21]=a("div",{class:"empty-state-icon"},"üì≠",-1)),a("h3",Wd,m(_()),1),a("p",Fd,m(B()),1)])):(c(),u("div",Hd,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:pe(()=>[(c(!0),u(ee,null,te(k.value.tickets,(b,O)=>(c(),he(Ct,{key:b.id,ticket:b,draggable:!1,style:we({"--ticket-index":O}),onClick:Q=>le(b)},null,8,["ticket","style","onClick"]))),128))]),_:1})]))]),_:1})])])):A("",!0)]),_:1})])],32)):A("",!0)]))}},Vd=de(jd,[["__scopeId","data-v-7fbd8a12"]]);function zd(o,e,s=.5){if(!e||!Array.isArray(e)||e.length===0||typeof o!="number"||o<0)return 0;(typeof s!="number"||s<=0)&&(console.warn("getOverlapCount: threshold –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0.5"),s=.5);const t=[];if(e.forEach((n,l)=>{if(!n||!n.data||!Array.isArray(n.data))return;const d=n.data[o];d!=null&&!isNaN(d)&&t.push({datasetIndex:l,value:Number(d),y:Number(d)})}),t.length<2)return 0;const r=[];return t.forEach(n=>{let l=!1;for(const d of r){const g=d.y;if(Math.abs(n.y-g)<s){d.points.push(n),d.y=d.points.reduce((T,v)=>T+v.y,0)/d.points.length,l=!0;break}}l||r.push({points:[n],y:n.y})}),r.length===0?0:r.reduce((n,l)=>l.points.length>n.points.length?l:n,r[0]).points.length}function Gd(o,e){const s=[];return o.forEach(t=>{let r=!1;for(const i of s){const n=i.y;if(Math.abs(t.value-n)<e){i.points.push(t),i.y=i.points.reduce((l,d)=>l+d.value,0)/i.points.length,r=!0;break}}r||s.push({points:[t],y:t.value})}),s}function Kd(o,e=.5){if(!o)return console.warn("findOverlappingPoints: chart –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω"),[];if(!o.config||o.config.type!=="line")return[];const s=o.data?.datasets,t=o.data?.labels||[];if(!s||!Array.isArray(s)||s.length===0)return[];if(!Array.isArray(t)||t.length===0)return[];(typeof e!="number"||e<=0)&&(console.warn("findOverlappingPoints: threshold –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0.5"),e=.5);const r=[];return t.forEach((i,n)=>{try{if(zd(n,s,e)<2)return;const d=[];if(s.forEach((y,k)=>{if(!y||!y.data||!Array.isArray(y.data))return;const S=y.data[n];S==null||isNaN(S)||d.push({datasetIndex:k,value:Number(S),label:y.label||`Dataset ${k}`})}),d.length<2)return;const g=Gd(d,e);if(g.length===0)return;const p=g.reduce((y,k)=>k.points.length>y.points.length?k:y,g[0]);if(p.points.length<2)return;let T=null,v=null;for(let y=0;y<s.length;y++)try{const k=o.getDatasetMeta(y);if(k&&k.data&&k.data[n]){T=k,v=k.data[n];break}}catch{continue}if(!v||typeof v.x!="number"||typeof v.y!="number")return;r.push({position:n,count:p.points.length,x:v.x,y:v.y,value:p.y,points:p.points.map(y=>({datasetIndex:y.datasetIndex,value:y.value,label:y.label}))})}catch(l){console.warn(`findOverlappingPoints: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–æ–∑–∏—Ü–∏–∏ ${n}:`,l)}}),r}function qd(o,e){const s=[];return o.forEach(t=>{let r=!1;for(const i of s){const n=i.y;if(Math.abs(t.y-n)<e){i.points.push(t),i.y=i.points.reduce((l,d)=>l+d.y,0)/i.points.length,r=!0;break}}r||s.push({points:[t],y:t.y})}),s}function Yd(o,e,s=.5){if(!o)return console.warn("calculatePointJitter: chart –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω"),[];if(!o.config||o.config.type!=="line")return[];if(typeof e!="number"||e<0)return console.warn("calculatePointJitter: positionIndex –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º"),[];(typeof s!="number"||s<=0)&&(console.warn("calculatePointJitter: threshold –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0.5"),s=.5);const t=o.data?.datasets,r=o.data?.labels||[];if(!t||!Array.isArray(t)||t.length===0)return[];if(!Array.isArray(r)||e>=r.length)return[];const i=[];if(t.forEach((g,p)=>{if(!g||!g.data||!Array.isArray(g.data))return;const T=g.data[e];if(!(T==null||isNaN(T)))try{const v=o.getDatasetMeta(p);if(v&&v.data&&v.data[e]){const y=v.data[e];y&&typeof y.x=="number"&&typeof y.y=="number"&&i.push({datasetIndex:p,value:Number(T),x:y.x,y:y.y})}}catch(v){console.warn(`calculatePointJitter: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ meta –¥–ª—è dataset ${p}:`,v)}}),i.length===0)return[];const n=qd(i,s),l=[];n.forEach(g=>{const p=g.points||[];p.length>1?p.forEach((v,y)=>{const k=(y-(p.length-1)/2)*4;l.push({datasetIndex:v.datasetIndex,jitterX:k,value:v.value})}):p.length===1&&l.push({datasetIndex:p[0].datasetIndex,jitterX:0,value:p[0].value})});const d=new Set(l.map(g=>g.datasetIndex));return i.forEach(g=>{d.has(g.datasetIndex)||l.push({datasetIndex:g.datasetIndex,jitterX:0,value:g.value})}),l}const Xd=.5,oa=6,Jd=2;function Zd(o){return typeof o!="number"||o<2?oa:oa+(o-1)*Jd}function Qd(o,e){if(!o||!o.ctx){console.warn("drawEnlargedPoint: chart –∏–ª–∏ ctx –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");return}if(!e||typeof e.x!="number"||typeof e.y!="number"){console.warn("drawEnlargedPoint: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã overlap",e);return}const s=e.count;if(typeof s!="number"||s<2)return;const t=o.ctx,{x:r,y:i,points:n}=e,l=Zd(s);if(t.canvas){t.save();try{t.beginPath(),t.arc(r,i,l,0,2*Math.PI);let g="rgba(128, 128, 128, 0.3)";if(n&&n.length>0&&o.data&&o.data.datasets){const p=n[0].datasetIndex,T=o.data.datasets[p];if(T&&T.pointBackgroundColor){const v=Array.isArray(T.pointBackgroundColor)?T.pointBackgroundColor[e.position]||T.pointBackgroundColor[0]:T.pointBackgroundColor;if(v)if(v.startsWith("#")){const y=parseInt(v.slice(1,3),16),k=parseInt(v.slice(3,5),16),S=parseInt(v.slice(5,7),16);g=`rgba(${y}, ${k}, ${S}, 0.4)`}else v.startsWith("rgba")?g=v.replace(/rgba?\(([^)]+)\)/,(y,k)=>{const S=k.split(",").map(C=>C.trim());return`rgba(${S[0]}, ${S[1]}, ${S[2]}, 0.4)`}):g=v+"66"}}t.fillStyle=g,t.fill(),t.strokeStyle=g.replace("0.4","0.6").replace("66","99"),t.lineWidth=1,t.stroke()}catch(g){console.warn("drawEnlargedPoint: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π —Ç–æ—á–∫–∏:",g)}finally{t.restore()}}}const eu={id:"overlappingPointsPlugin",afterDatasetsDraw:o=>{if(!(!o||!o.config||o.config.type!=="line")&&o.ctx)try{const e=Kd(o,Xd);if(!Array.isArray(e)||e.length===0)return;e.filter(t=>!(!t||typeof t!="object"||typeof t.count!="number"||t.count<2||typeof t.x!="number"||typeof t.y!="number"||!isFinite(t.x)||!isFinite(t.y))).forEach(t=>{try{Qd(o,t)}catch(r){console.warn(`overlappingPointsPlugin: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π —Ç–æ—á–∫–∏ –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ ${t.position}:`,r)}})}catch(e){console.warn("overlappingPointsPlugin: –æ—à–∏–±–∫–∞ –≤ afterDatasetsDraw:",e)}}},tu=.5,su={id:"pointJitterPlugin",beforeDatasetsDraw:o=>{if(!(!o||!o.config||o.config.type!=="line")){o._jitterData||(o._jitterData={});try{const e=o.data?.datasets,s=o.data?.labels||[];if(!e||!Array.isArray(e)||e.length===0||!Array.isArray(s)||s.length===0)return;o._jitterData={},s.forEach((t,r)=>{const i=Yd(o,r,tu);i&&i.length>0&&i.forEach(n=>{const l=`${n.datasetIndex}_${r}`;o._jitterData[l]=n.jitterX})})}catch(e){console.warn("pointJitterPlugin: –æ—à–∏–±–∫–∞ –≤ beforeDatasetsDraw:",e)}}},afterDatasetsDraw:o=>{if(!(!o||!o.config||o.config.type!=="line")&&o.ctx&&!(!o._jitterData||Object.keys(o._jitterData).length===0))try{const e=o.ctx,s=o.data?.datasets;if(!s||!Array.isArray(s)||s.length===0)return;s.forEach((t,r)=>{const i=o.getDatasetMeta(r);!i||i.hidden||!t.data||!Array.isArray(t.data)||t.data.forEach((n,l)=>{const d=i.data[l];if(!d||typeof d.x!="number"||typeof d.y!="number"||n==null||isNaN(n))return;const g=`${r}_${l}`,p=o._jitterData[g];if(!(p===void 0||p===0)){e.save();try{const T=t.pointStyle||"circle",v=(t.pointRadius||7)+1,y=Array.isArray(t.pointBackgroundColor)?t.pointBackgroundColor[l]||t.pointBackgroundColor[0]:t.pointBackgroundColor,k=Array.isArray(t.pointBorderColor)?t.pointBorderColor[l]||t.pointBorderColor[0]:t.pointBorderColor,S=t.pointBorderWidth||1,C=d.x+p,f=d.y;switch(e.fillStyle=y||"#007bff",e.strokeStyle=k||"#ffffff",e.lineWidth=S,e.beginPath(),T){case"circle":e.arc(C,f,v,0,2*Math.PI);break;case"triangle":e.moveTo(C,f-v),e.lineTo(C-v,f+v),e.lineTo(C+v,f+v),e.closePath();break;case"rect":case"rectRounded":const w=v*1.4;e.rect(C-w/2,f-w/2,w,w);break;case"rectRot":const $=v*1.4;e.moveTo(C,f-$/2),e.lineTo(C+$/2,f),e.lineTo(C,f+$/2),e.lineTo(C-$/2,f),e.closePath();break;case"star":const W=v;for(let E=0;E<5;E++){const x=E*4*Math.PI/5-Math.PI/2,R=C+W*Math.cos(x),U=f+W*Math.sin(x);E===0?e.moveTo(R,U):e.lineTo(R,U)}e.closePath();break;case"cross":const L=v;e.moveTo(C-L,f-L),e.lineTo(C+L,f+L),e.moveTo(C+L,f-L),e.lineTo(C-L,f+L);break;case"crossRot":const D=v;e.moveTo(C-D,f),e.lineTo(C+D,f),e.moveTo(C,f-D),e.lineTo(C,f+D);break;default:e.arc(C,f,v,0,2*Math.PI)}T!=="cross"&&T!=="crossRot"&&e.fill(),e.stroke(),d._originalX||(d._originalX=d.x,d._originalY=d.y),d._jitterX=p,d._jitteredX=C,d._jitteredY=f}catch(T){console.warn(`pointJitterPlugin: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ —Ç–æ—á–∫–∏ ${r}_${l}:`,T)}finally{e.restore()}}})})}catch(e){console.warn("pointJitterPlugin: –æ—à–∏–±–∫–∞ –≤ afterDatasetsDraw:",e)}},afterDraw:o=>{o._jitterData}},au={id:"pointLabelsPlugin",afterDatasetsDraw:o=>{if(!(!o||!o.config||o.config.type!=="line")&&o.ctx)try{const e=o.ctx,s=o.data?.datasets;if(!s||!Array.isArray(s)||s.length===0)return;s.forEach((t,r)=>{const i=o.getDatasetMeta(r);if(!i||i.hidden||!t.data||!Array.isArray(t.data))return;const n=Array.isArray(t.pointBackgroundColor)?t.pointBackgroundColor[0]||"#6b7280":t.pointBackgroundColor||"#6b7280";t.data.forEach((l,d)=>{const g=i.data[d];if(!g||typeof g.x!="number"||typeof g.y!="number"||l==null||isNaN(l))return;const p=g._jitteredX!==void 0?g._jitteredX:g.x,T=g._jitteredY!==void 0?g._jitteredY:g.y,v=p+8,y=T-5,k=String(Math.round(l));e.save();try{e.font="11px Arial, sans-serif",e.textAlign="left",e.textBaseline="middle";const C=e.measureText(k).width,f=11,w=3,$=v-w,W=y-f/2-w,L=C+w*2,D=f+w*2;e.fillStyle="rgba(255, 255, 255, 0.95)",e.fillRect($,W,L,D),e.strokeStyle="rgba(0, 0, 0, 0.1)",e.lineWidth=1,e.strokeRect($,W,L,D),e.fillStyle=n,e.font="11px Arial, sans-serif",e.textAlign="left",e.textBaseline="middle",e.fillText(k,v,y)}catch(S){console.warn(`pointLabelsPlugin: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è —Ç–æ—á–∫–∏ ${r}_${d}:`,S)}finally{e.restore()}})})}catch(e){console.warn("pointLabelsPlugin: –æ—à–∏–±–∫–∞ –≤ afterDatasetsDraw:",e)}}},ou={class:"graph-state-chart"},nu={class:"chart-header"},ru={class:"chart-type-selector"},iu=["onClick","title"],lu={class:"chart-type-icon"},cu={class:"chart-type-label"},du={key:0,class:"comparison-type-selector"},uu={class:"radio-group"},gu={key:0},mu={key:1},hu={key:2,class:"graph-legend"},fu={key:4,class:"error-container"},vu={class:"error-message"},pu={class:"chart-wrapper"},yu={class:"chart-canvas-container"},ku={key:0,class:"bar-chart-stage-labels"},bu={key:6,class:"no-data"},_u={__name:"GraphStateChart",props:{period:{type:Object,default:null},showCurrentState:{type:Boolean,default:!0}},emits:["data-loaded","error"],setup(o,{emit:e}){const s=(j,V)=>typeof window>"u"?V:getComputedStyle(document.documentElement).getPropertyValue(j).trim()||V,t=o,r=e,i=I(!1),n=I(null),l=I(null),d=I({weekStart:null,weekEnd:null,current:null}),g=I(null),p=I("weekStartToWeekEnd"),T=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],v=I("line"),y=I(!1),k=I(""),S=I(""),C=I(0),f=I([]),w=I(null),$=I(null),W=I(null),L=I(null),D=I([]),E=M(()=>{switch(v.value){case"line":return yt;case"bar":return va;case"doughnut":return fa;default:return yt}}),x={formed:s("--b24-primary","#007bff"),review:s("--b24-warning","#ffc107"),execution:s("--b24-success","#28a745")},R=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:x.formed},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:x.review},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:x.execution}],U=M(()=>R.reduce((j,V)=>(j[V.id]=V.name,j),{})),G=["circle","triangle","rect","rectRot","star","cross","crossRot"],q=I({formed:!0,review:!0,execution:!0}),oe=mt(),Y={id:"employeeLabelsPlugin",afterDatasetsDraw:j=>{if(j.config.type==="bar")try{const V=j.ctx;if(!j.data||!j.data.datasets)return;const se=j.data.datasets,ge=j.scales.y;se.forEach((ye,F)=>{const ie=j.getDatasetMeta(F);if(!ie||ie.hidden)return;const ve=ye.label||"";if(!ve||ve.includes("–î—Ä—É–≥–∏–µ"))return;const Te=ve.trim().split(/\s+/);let Me="";if(Te.length===1)Me=Te[0];else{const Le=Te[0],We=Te.slice(1).join(" ");Me=`${Le}
${We}`}const ze=Me.split(`
`);ye.data.forEach((Le,We)=>{if(Le===0||!Le)return;const Ge=ie.data[We];if(!Ge||typeof Ge.x!="number"||typeof Ge.y!="number")return;const He=Ge.x,Tt=Ge.y+Ge.height+25;V.save(),V.font="bold 9px Arial, sans-serif",V.fillStyle="#6b7280",V.textAlign="center",V.textBaseline="top",V.translate(He,Tt),V.rotate(-12*Math.PI/180),ze.forEach((Va,za)=>{const Ys=Va.trim();Ys&&V.fillText(Ys,0,za*11)}),V.restore()})})}catch(V){console.error("Error in employeeLabelsPlugin:",V)}}},H={id:"doughnutCenterTextPlugin",afterDraw:j=>{if(j.config.type!=="doughnut")return;const{ctx:V,chartArea:se,width:ge,height:ye}=j;if(!j.data||!j.data.datasets||j.data.datasets.length===0)return;const ie=j.data.datasets[0].meta?.totals?.overall??null;if(ie===null||typeof ie>"u")return;const ve=["–í—Å–µ–≥–æ –≤ —Å–µ–∫—Ç–æ—Ä–µ 1–°","—Ç–∏–∫–µ—Ç–æ–≤ –≤ —Ä–∞–±–æ—Ç–µ:",`${ie}`];V.save(),V.font='600 16px "Roboto", sans-serif',V.fillStyle=s("--b24-text-primary","#1f2937"),V.textAlign="center",V.textBaseline="middle";const Te=(se.left+se.right)/2,Me=(se.top+se.bottom)/2,ze=18,Le=ze*ve.length,We=Me-Le/2+4;ve.forEach((Ge,He)=>{He===ve.length-1&&`${Ge}`.length>4?V.font='700 18px "Roboto", sans-serif':V.font='600 16px "Roboto", sans-serif',V.fillText(Ge,Te,We+He*ze)}),V.restore()}};Je.register(Y),Je.register(H);function Z(){const j=new Map;[d.value.weekStart,d.value.weekEnd,d.value.current].forEach(V=>{!V||!V.statistics||!V.statistics.employees||V.statistics.employees.forEach(se=>{j.has(se.id)||j.set(se.id,{id:se.id,name:se.name})})}),D.value=Array.from(j.values()).sort((V,se)=>V.name.localeCompare(se.name))}function fe(j,V="background"){return{increase:{background:s("--b24-success","#28a745"),border:s("--b24-success-hover","#218838"),point:s("--b24-success","#28a745")},decrease:{background:s("--b24-danger","#dc3545"),border:s("--b24-danger-hover","#c82333"),point:s("--b24-danger","#dc3545")},stable:{background:s("--b24-text-muted","#9ca3af"),border:s("--b24-text-secondary","#6b7280"),point:s("--b24-text-muted","#9ca3af")}}[j]?.[V]||s("--b24-text-secondary","#6c757d")}function P(){if(!(!d.value.weekStart||!d.value.weekEnd))try{const j=$s.compareTwoSnapshots(d.value.weekStart,d.value.weekEnd,{includeTickets:!1,includeEmployees:!0});let V=null,se=null;d.value.current&&(V=$s.compareTwoSnapshots(d.value.weekEnd,d.value.current,{includeTickets:!1,includeEmployees:!0}),se=$s.compareTwoSnapshots(d.value.weekStart,d.value.current,{includeTickets:!1,includeEmployees:!0})),g.value={weekStartToWeekEnd:j,weekEndToCurrent:V,weekStartToCurrent:se}}catch(j){console.error("–û—à–∏–±–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–ª–µ–ø–∫–æ–≤:",j),oe.warning("–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–ª–µ–ø–∫–æ–≤: "+j.message)}}function h(j){return j?j.replace(/\s*\(\d+\)\s*$/,"").trim():""}function _(j){const V=h(j);return{"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ":"formed","–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó":"review",–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ:"execution"}[V]||"formed"}function B(j){return _(j)}function re(j){return j===0?"weekStart":j===1?"weekEnd":j===2?"current":"weekEnd"}function le(j,V,se,ge,ye=null,F=null,ie=null,ve=null){console.log("[GraphStateChart] openEmployeeDetailsModal called:",{stageName:j,stageId:V,totalCount:se,employeesCount:ge?.length||0,hasSnapshot:!!F,snapshotTicketIds:F?.ticketIds?.length||0}),k.value=j,S.value=V||"",C.value=se,f.value=ge||[],w.value=ye&&ye.count>0?ye:null,$.value=F,W.value=ie,L.value=ve,y.value=!0,console.log("[GraphStateChart] Modal state set:",{modalStageId:S.value,hasCurrentSnapshot:!!$.value})}async function ae(j,V,se){console.log("[GraphStateChart] openEmployeeDetailsModalForLine:",{stageId:j,timePoint:V,hasMeta:!!se});const ge=R.find(F=>F.id===j);if(!ge){console.warn("[GraphStateChart] Stage not found:",j);return}const ye={graphType:"line",stageId:j,stageName:ge.name,timePoint:V,snapshots:d.value,meta:{line:se||null,doughnut:l.value?.datasets?.[0]?.meta||null},stageColorMap:x,stageNameMap:U.value};try{const F=await xa({stageId:j,graphType:"line",timePoint:V,snapshots:d.value,meta:{line:se||null,doughnut:l.value?.datasets?.[0]?.meta||null},stageColorMap:x,stageNameMap:U.value,maxVisible:10});console.log("[GraphStateChart] Opening modal with level1:",{stageName:F.stageName,stageId:j,totalCount:F.totalCount,employeesCount:F.employees?.length||0,hasSnapshot:!!F.snapshot}),le(F.stageName,j,F.totalCount,F.employees,F.others,F.snapshot,null,ye)}catch(F){console.error("[GraphStateChart] Failed to open modal for line point:",F),oe.error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–ø–∞–ø –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–æ—á–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞")}}function me(j,V){if(!V||!V.employees||V.employees.length===0){oe.warning("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –¥–ª—è —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞");return}const se=d.value.current||d.value.weekEnd||d.value.weekStart,ge={graphType:"doughnut",stageId:j,stageName:V.stageName,snapshots:d.value,meta:{doughnut:l.value?.datasets?.[0]?.meta||null},stageColorMap:x,stageNameMap:U.value};le(V.stageName,j,V.totalCount,V.employees,V.others,se,null,ge)}function De(){y.value=!1,k.value="",S.value="",C.value=0,f.value=[],w.value=null,$.value=null,W.value=null}async function Ie(j,V,se){if(v.value!=="line"||V.length===0)return;const ge=V[0],ye=ge.datasetIndex,F=ge.index,ie=se.data.datasets[ye];if(!ie)return;const ve=B(ie.label),Te=re(F);await ae(ve,Te,ie.meta||null)}function xe(j,V,se){if(v.value!=="doughnut"||V.length===0)return;const ye=V[0].index,F=se.data,ie=F.labels[ye],ve=B(ie),Me=F.datasets[0]?.meta?.employees?.[ve];if(!Me){console.warn("–î–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è —ç—Ç–∞–ø–∞:",ve);return}me(ve,Me)}function Fe(j){const V=R[j];if(!V)return 0;const se=d.value.current||d.value.weekEnd||d.value.weekStart;return!se||!se.statistics||!se.statistics.stages?0:se.statistics.stages[V.id]?.count||0}function z(j){const V=R.find(ye=>ye.id===j);if(!V)return"";const se=d.value.current||d.value.weekEnd||d.value.weekStart;if(!se||!se.statistics||!se.statistics.stages)return V.name;const ge=se.statistics.stages[j]?.count||0;return`${V.name} (${ge})`}const N=M(()=>{if(!l.value)return null;if(v.value==="doughnut"||v.value==="bar")return l.value;const j=l.value.datasets.filter(V=>{const se=R.find(ge=>ge.name===V.label);return se?q.value[se.id]:!0});return{...l.value,datasets:j}});M(()=>v.value!=="bar"||!l.value||!l.value.meta?null:l.value.meta.employeesByStage||null);const b=M(()=>{const j={responsive:!0,maintainAspectRatio:!1,resizeDelay:0,layout:{padding:v.value==="bar"?{bottom:80}:{}},onClick:(V,se,ge)=>{v.value==="line"?Ie(V,se,ge):v.value==="doughnut"&&xe(V,se,ge)},onHover:(V,se,ge)=>{v.value==="doughnut"&&(V.native.target.style.cursor=se.length>0?"pointer":"default")},plugins:{legend:{display:v.value!=="bar",position:v.value==="doughnut"?"right":"top",labels:{font:{size:v.value==="doughnut"?14:12,weight:v.value==="doughnut"?"600":"500"},boxWidth:v.value==="doughnut"?18:12,boxHeight:v.value==="doughnut"?18:12,padding:v.value==="doughnut"?14:10},onClick:(V,se,ge)=>{if(v.value==="bar"){const F=se.datasetIndex;if(F!==void 0){const ie=ge.chart.getDatasetMeta(F);ie.hidden=!ie.hidden,ge.chart.update()}return}const ye=se.datasetIndex;if(ye!==void 0){const F=ge.chart.getDatasetMeta(ye);F.hidden=!F.hidden,ge.chart.update()}}},tooltip:{enabled:!0,mode:"index",intersect:!1,callbacks:{title:V=>{if(v.value==="bar"){const se=V[0].dataIndex,ge=R[se];return ge?ge.name:""}return V[0].label||""},label:V=>{const se=V.dataset.label||"",ge=V.parsed.y||V.parsed||0,ye=V.dataIndex;if(v.value==="bar"){const F=V.dataset,ie=V.dataIndex,ve=R[ie],Te=ve?ve.name:"";return`${F.label}: ${ge} —Ç–∏–∫–µ—Ç–æ–≤ –Ω–∞ —ç—Ç–∞–ø–µ "${Te}"`}if(v.value==="doughnut"){const F=V.dataset.data.reduce((ve,Te)=>ve+Te,0),ie=F>0?(ge/F*100).toFixed(1):0;return`${se}: ${ge} —Ç–∏–∫–µ—Ç–æ–≤ (${ie}%)`}else{if(!g.value||ye===0)return`${se}: ${ge} —Ç–∏–∫–µ—Ç–æ–≤`;let F=null;const ie=_(se);if(p.value==="weekStartToWeekEnd"&&ye===1?F=g.value.weekStartToWeekEnd?.stages?.[ie]:p.value==="weekEndToCurrent"&&ye===2&&d.value.current?F=g.value.weekEndToCurrent?.stages?.[ie]:p.value==="weekStartToCurrent"&&ye===2&&d.value.current&&(F=g.value.weekStartToCurrent?.stages?.[ie]),!F)return`${se}: ${ge} —Ç–∏–∫–µ—Ç–æ–≤`;const ve=F.delta,Te=F.deltaPercent,Me=F.trend;let ze=`${se}: ${ge} —Ç–∏–∫–µ—Ç–æ–≤`;if(ve!==0){const Le=ve>0?"+":"",We=Me==="increase"?"‚Üë":Me==="decrease"?"‚Üì":"‚Üí";ze+=` (${Le}${ve}, ${Le}${Te.toFixed(1)}%) ${We}`}else ze+=" (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)";return ze}},afterBody:V=>{if(v.value==="bar"&&V.length>0){const F=V[0];F.dataset;const ie=F.parsed.y||0,ve=F.dataIndex,Te=Fe(ve);return[`${Te>0?(ie/Te*100).toFixed(1):0}% –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç—Ç–∞–ø–∞`]}if(v.value==="doughnut"&&V.length>0)return["–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"];if(v.value==="line"){const F=[];if(g.value){const ie=V[0].dataIndex;if(ie!==0){let ve=null;if(_(V[0].dataset.label||""),p.value==="weekStartToWeekEnd"&&ie===1?ve=g.value.weekStartToWeekEnd:p.value==="weekEndToCurrent"&&ie===2?ve=g.value.weekEndToCurrent:p.value==="weekStartToCurrent"&&ie===2&&(ve=g.value.weekStartToCurrent),ve&&ve.metadata){const Te=ve.metadata.timeDiff;F.push(`–ü–µ—Ä–∏–æ–¥: ${Te.days} –¥–Ω. ${Te.hours} —á. ${Te.minutes} –º–∏–Ω.`)}}}return F.push("–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"),F}if(!g.value)return[];const se=V[0].dataIndex;if(se===0)return[];let ge=null;if(_(V[0].dataset.label||""),p.value==="weekStartToWeekEnd"&&se===1?ge=g.value.weekStartToWeekEnd:p.value==="weekEndToCurrent"&&se===2?ge=g.value.weekEndToCurrent:p.value==="weekStartToCurrent"&&se===2&&(ge=g.value.weekStartToCurrent),!ge||!ge.metadata)return[];const ye=ge.metadata.timeDiff;return[`–ü–µ—Ä–∏–æ–¥: ${ye.days} –¥–Ω. ${ye.hours} —á. ${ye.minutes} –º–∏–Ω.`]}}},title:{display:!1}}};return v.value==="line"||v.value==="bar"?{...j,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}:v.value==="doughnut"?{...j,cutout:"60%"}:j});function O(j){const V=new Date(j),se=V.getFullYear(),ge=String(V.getMonth()+1).padStart(2,"0"),ye=String(V.getDate()).padStart(2,"0");return`${se}-${ge}-${ye}`}function Q(j){const{current:V,weekEnd:se}=j,ge=V||se;if(!ge||!ge.statistics||!ge.statistics.stages)return null;const ye=[],F=[],ie=[],ve=[],Te={},Me={};if(R.forEach(Le=>{const We=ge.statistics.stages[Le.id]?.count||0;if(We>0){ye.push(`${Le.name} (${We})`),F.push(We),ie.push(Le.color+"80"),ve.push(Le.color),Me[Le.id]=We;const Ge=Yl(Le.id,ge,R);Ge&&Ge.employees&&(Te[Le.id]=Ge)}}),F.length===0)return null;const ze=F.reduce((Le,We)=>Le+We,0);return{labels:ye,datasets:[{label:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —ç—Ç–∞–ø–∞–º",data:F,backgroundColor:ie,borderColor:ve,borderWidth:2,meta:{employees:Te,totals:{overall:ze,stages:Me}}}]}}function ue(j){if(v.value==="doughnut")return Q(j);if(v.value==="bar"){const ie=t.showCurrentState&&j.current?"current":j.weekEnd?"weekEnd":"weekStart";return ql(j,ie,R)}const{weekStart:V,weekEnd:se,current:ge}=j,ye=[],F=[];return R.forEach((ie,ve)=>{const Te=[];if(V&&V.statistics&&V.statistics.stages){const He=V.statistics.stages[ie.id];if(ye.length===0){const Tt=V.metadata?.createdAt?new Date(V.metadata.createdAt):null;ye.push(Tt?O(Tt):"–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏")}Te.push(He?.count||0)}else ye.length===0&&ye.push("–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏"),Te.push(0);if(se&&se.statistics&&se.statistics.stages){const He=se.statistics.stages[ie.id];if(ye.length===1){const Tt=se.metadata?.createdAt?new Date(se.metadata.createdAt):null;ye.push(Tt?O(Tt):"–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏")}Te.push(He?.count||0)}else ye.length===1&&ye.push("–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏"),Te.push(0);if(ge&&t.showCurrentState&&ge.statistics&&ge.statistics.stages){const He=ge.statistics.stages[ie.id];ye.length===2&&ye.push("–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"),Te.push(He?.count||0)}const Me=["stable"];g.value?p.value==="weekStartToWeekEnd"?(Me.push(g.value.weekStartToWeekEnd?.stages?.[ie.id]?.trend||"stable"),ge&&Me.push(g.value.weekStartToCurrent?.stages?.[ie.id]?.trend||"stable")):p.value==="weekEndToCurrent"&&ge?(Me.push("stable"),Me.push(g.value.weekEndToCurrent?.stages?.[ie.id]?.trend||"stable")):p.value==="weekStartToCurrent"&&ge?(Me.push(g.value.weekStartToWeekEnd?.stages?.[ie.id]?.trend||"stable"),Me.push(g.value.weekStartToCurrent?.stages?.[ie.id]?.trend||"stable")):(Me.push("stable"),ge&&Me.push("stable")):(Me.push("stable"),ge&&Me.push("stable"));let ze,Le,We;g.value&&v.value!=="doughnut"?(ze=Me.map(He=>fe(He,"background")+"40"),Le=Me.map(He=>fe(He,"border")),We=Me.map(He=>fe(He,"point"))):(ze=ie.color+"40",Le=ie.color,We=ie.color);let Ge=null;v.value==="line"&&(Ge={employees:Kl(ie.id,j)}),F.push({label:ie.name,data:Te,backgroundColor:(Array.isArray(ze),ze),borderColor:(Array.isArray(Le),Le),borderWidth:2,...v.value==="line"&&{pointStyle:G[ve%G.length]},pointBackgroundColor:(Array.isArray(We),We),pointBorderColor:(Array.isArray(Le),Le),pointRadius:7,pointHoverRadius:10,fill:v.value!=="line",tension:v.value==="line"?.4:0,meta:Ge})}),ye.length===0&&(ye.push("–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏","–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏"),t.showCurrentState&&ye.push("–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ")),{labels:ye,datasets:F}}const ke=async()=>{i.value=!0,n.value=null;try{const j=t.period?.endDate?new Date(t.period.endDate):new Date,V=t.period?.startDate?new Date(t.period.startDate):pt.getWeekStartDate(j),se=t.period?.endDate?new Date(t.period.endDate):pt.getWeekEndDate(j),ge=pt.formatDate(V),ye=pt.formatDate(se),[F,ie]=await Promise.all([pt.getSnapshot(ge,"week_start"),pt.getSnapshot(ye,"week_end")]);let ve=null;t.showCurrentState&&(ve=await Ws.getSectorDataForSnapshot({useCache:!1,normalize:!0})),d.value={weekStart:F,weekEnd:ie,current:ve},Z(),P(),K(),r("data-loaded",{weekStart:F,weekEnd:ie,current:ve})}catch(j){console.error("Error loading chart data:",j),n.value=j.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞",oe.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞: "+n.value),r("error",n.value)}finally{i.value=!1}};$e(()=>{Je.register(eu),Je.register(su),Je.register(au),ke()});function _e(j){q.value=j}const K=()=>{const j=ue({weekStart:d.value.weekStart,weekEnd:d.value.weekEnd,current:d.value.current});if(!l.value||!l.value.labels||l.value.labels.length!==j?.labels?.length)l.value=j;else if(j){const V=JSON.stringify(l.value),se=JSON.stringify(j);V!==se&&(l.value=j)}};return Ne(()=>[t.period,t.showCurrentState],()=>{ke()},{deep:!0}),Ne(v,()=>{(d.value.weekStart||d.value.weekEnd||d.value.current)&&K()}),Ne(p,()=>{(d.value.weekStart||d.value.weekEnd||d.value.current)&&K()}),(j,V)=>(c(),u("div",ou,[a("div",nu,[V[3]||(V[3]=a("h3",{class:"chart-title"},"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),a("div",ru,[(c(),u(ee,null,te(T,se=>a("button",{key:se.value,onClick:ge=>v.value=se.value,class:X(["chart-type-btn",{active:v.value===se.value}]),title:se.label},[a("span",lu,m(se.icon),1),a("span",cu,m(se.label),1)],10,iu)),64))])]),!i.value&&!n.value&&g.value&&v.value!=="doughnut"?(c(),u("div",du,[V[7]||(V[7]=a("h4",{class:"comparison-title"},"–¢–∏–ø —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:",-1)),a("div",uu,[a("label",null,[Re(a("input",{type:"radio","onUpdate:modelValue":V[0]||(V[0]=se=>p.value=se),value:"weekStartToWeekEnd",onChange:K},null,544),[[Et,p.value]]),V[4]||(V[4]=a("span",null,"–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ ‚Üí –ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏",-1))]),d.value.current?(c(),u("label",gu,[Re(a("input",{type:"radio","onUpdate:modelValue":V[1]||(V[1]=se=>p.value=se),value:"weekEndToCurrent",onChange:K},null,544),[[Et,p.value]]),V[5]||(V[5]=a("span",null,"–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏ ‚Üí –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ",-1))])):A("",!0),d.value.current?(c(),u("label",mu,[Re(a("input",{type:"radio","onUpdate:modelValue":V[2]||(V[2]=se=>p.value=se),value:"weekStartToCurrent",onChange:K},null,544),[[Et,p.value]]),V[6]||(V[6]=a("span",null,"–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ ‚Üí –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ",-1))])):A("",!0)])])):A("",!0),!i.value&&!n.value&&l.value?(c(),he(xl,{key:1,stages:R,selected:q.value,"onUpdate:selected":_e,onChange:K},null,8,["selected"])):A("",!0),!i.value&&!n.value&&g.value&&v.value!=="doughnut"?(c(),u("div",hu,[...V[8]||(V[8]=[_t('<h4 class="legend-title" data-v-cbba196a>–õ–µ–≥–µ–Ω–¥–∞:</h4><div class="legend-items" data-v-cbba196a><div class="legend-item" data-v-cbba196a><span class="legend-color legend-increase" data-v-cbba196a></span><span data-v-cbba196a>–ó–µ–ª—ë–Ω—ã–π ‚Äî —Ä–æ—Å—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–µ—Ç–æ–≤</span></div><div class="legend-item" data-v-cbba196a><span class="legend-color legend-decrease" data-v-cbba196a></span><span data-v-cbba196a>–ö—Ä–∞—Å–Ω—ã–π ‚Äî —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–µ—Ç–æ–≤</span></div><div class="legend-item" data-v-cbba196a><span class="legend-color legend-stable" data-v-cbba196a></span><span data-v-cbba196a>–°–µ—Ä—ã–π ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π</span></div></div>',2)])])):A("",!0),i.value?(c(),he(ws,{key:3,message:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞..."})):n.value?(c(),u("div",fu,[a("p",vu,"‚ùå "+m(n.value),1),a("button",{onClick:ke,class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É")])):N.value?(c(),u("div",{key:5,class:X(["chart-container",`chart-type-${v.value}`])},[a("div",pu,[a("div",yu,[(c(),he(wt(E.value),{data:N.value,options:b.value},null,8,["data","options"]))]),v.value==="bar"?(c(),u("div",ku,[(c(),u(ee,null,te(R,se=>a("div",{key:se.id,class:"stage-label-item"},m(z(se.id)),1)),64))])):A("",!0)])],2)):(c(),u("div",bu,[...V[9]||(V[9]=[a("p",null,"üìä –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1),a("p",{class:"no-data-hint"},"–°–æ–∑–¥–∞–π—Ç–µ —Å–ª–µ–ø–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞",-1)])])),ne(Vd,{"is-visible":y.value,"stage-name":k.value,"stage-id":S.value,"total-count":C.value,employees:f.value,others:w.value,snapshot:$.value,"ticket-details":W.value,"stage-switch-context":L.value,onClose:De},null,8,["is-visible","stage-name","stage-id","total-count","employees","others","snapshot","ticket-details","stage-switch-context"])]))}},wu=de(_u,[["__scopeId","data-v-cbba196a"]]),nt={USER_NOT_DETERMINED:"USER_NOT_DETERMINED",ACCESS_DENIED:"ACCESS_DENIED",API_ERROR:"API_ERROR"};class lt{constructor(e,s=null,t=null,r=null){this.allowed=e,this.errorCode=s,this.errorMessage=t,this.user=r}}class rt{static async checkAccess(){try{const e=Rt();if(console.log("AccessControlService.checkAccess - isInsideBitrix24:",e),console.log("AccessControlService.checkAccess - window.self === window.top:",window.self===window.top),console.log("AccessControlService.checkAccess - typeof BX24:",typeof BX24),e)console.log("AccessControlService.checkAccess - Inside Bitrix24, skipping direct access check");else{console.log("AccessControlService.checkAccess - Not inside Bitrix24, checking direct access config...");const{isDirectAccessAllowed:i,getDenyMessage:n}=await Se(async()=>{const{isDirectAccessAllowed:d,getDenyMessage:g}=await import("./direct-access-config-DgF6_hzD.js");return{isDirectAccessAllowed:d,getDenyMessage:g}},__vite__mapDeps([5,4]),import.meta.url),l=await i();if(console.log("AccessControlService.checkAccess - allowDirectAccess:",l),!l){const d=await n();return console.warn("Direct access denied: Application opened directly in browser, but direct access is disabled in config"),console.warn("Deny message:",d),new lt(!1,nt.ACCESS_DENIED,d,null)}console.log("Direct access allowed: Using primary administrator token from settings.php")}if(e)try{await Promise.race([kt.init(),new Promise((i,n)=>setTimeout(()=>n(new Error("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥")),5e3))])}catch(i){console.warn("BX24.init() failed, will try proxy API:",i)}let s;try{s=await Promise.race([kt.getCurrentUser(),new Promise((i,n)=>setTimeout(()=>n(new Error("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø—Ä–µ–≤—ã—Å–∏–ª–æ 10 —Å–µ–∫—É–Ω–¥")),1e4))])}catch(i){console.warn("Bitrix24BxApi.getCurrentUser() failed, trying proxy API:",i);const{Bitrix24ApiProvider:n}=await Se(async()=>{const{Bitrix24ApiProvider:l}=await import("./chunk-D3JwNzSL.js").then(d=>d.b);return{Bitrix24ApiProvider:l}},__vite__mapDeps([3,4]),import.meta.url);try{const l=await n.getInstance();s=await Promise.race([l.getCurrentUser(),new Promise((d,g)=>setTimeout(()=>g(new Error("–ü—Ä–æ–∫—Å–∏ API –ø—Ä–µ–≤—ã—Å–∏–ª–æ 5 —Å–µ–∫—É–Ω–¥")),5e3))]),console.log("Got user from proxy API:",s?.ID||"unknown")}catch(l){throw console.error("Both BX24 API and proxy API failed:",l),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}if(!s||!s.ID)return console.warn("AccessControlService.checkAccess - user not determined:",s),new lt(!1,nt.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.");console.log("AccessControlService.checkAccess - user determined:",{id:s.ID,name:s.NAME,departments:s.UF_DEPARTMENT});const t=s.UF_DEPARTMENT||[];if(console.log("AccessControlService.checkAccess - departmentIds:",t),!Array.isArray(t)||t.length===0){if(console.log("AccessControlService.checkAccess - user has no departments"),!e){const{isDirectAccessAllowed:i}=await Se(async()=>{const{isDirectAccessAllowed:l}=await import("./direct-access-config-DgF6_hzD.js");return{isDirectAccessAllowed:l}},__vite__mapDeps([5,4]),import.meta.url);if(await i())return console.log("AccessControlService.checkAccess - Direct access allowed, granting access despite no departments"),new lt(!0,null,null,s)}return console.warn("AccessControlService.checkAccess - Access denied: user has no departments"),new lt(!1,nt.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ—Ç–¥–µ–ª—É.")}const r=t.some(i=>wa(i));return console.log("AccessControlService.checkAccess - hasAccess:",r),r?(console.log("AccessControlService.checkAccess - Access granted"),new lt(!0,null,null,s)):(console.warn("AccessControlService.checkAccess - Access denied: no allowed departments"),new lt(!1,nt.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"))}catch(e){return console.error("AccessControlService.checkAccess error:",e),e.message&&(e.message.includes("CORS")||e.message.includes("blocked")||e.message.includes("ERR_FAILED")||e.message.includes("unknown address space"))&&Rt()?(console.error("CORS error inside Bitrix24: Cannot determine interface user."),new lt(!1,nt.API_ERROR,"–û—à–∏–±–∫–∞ CORS: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")):e.message&&e.message.includes("not loaded")?new lt(!1,nt.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."):new lt(!1,nt.API_ERROR,"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}static async getCurrentUser(){try{return Rt()&&await kt.init(),await kt.getCurrentUser()}catch(e){return console.error("AccessControlService.getCurrentUser error:",e),null}}}const Cu={key:0,class:"create-snapshot-button-container"},Tu=["disabled"],Su={class:"modal-content"},Du={class:"modal-header"},Eu=["disabled"],Au={class:"modal-body"},$u={key:0,class:"progress-container"},Iu={class:"progress-bar-wrapper"},Mu={class:"progress-text"},Nu={class:"progress-percent"},xu={class:"progress-description"},Lu={key:1},Pu={class:"modal-footer"},Ou=["disabled"],Ru=["disabled"],Bu={key:0},Uu={key:0},Wu={key:1},Fu={key:2},Hu={key:1},ju={__name:"CreateSnapshotButton",props:{user:{type:Object,default:null}},emits:["snapshot-created"],setup(o,{emit:e}){const s=o,t=e,r=I(s.user),i=I(!1),n=I(!1),l=I(0),d=I("idle"),g=I(""),p=mt(),T=M(()=>r.value?as(r.value):!1);$e(async()=>{if(!s.user)try{const C=await rt.checkAccess();C.allowed&&(r.value=C.user)}catch(C){console.error("Error loading user:",C)}});const v=()=>{if(!T.value){p.warning("–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–µ–ø–∫–∏");return}i.value=!0},y=()=>{n.value||(i.value=!1,d.value="idle",l.value=0,g.value="")},k=async()=>{if(!n.value){if(!T.value){p.warning("–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–µ–ø–∫–∏");return}n.value=!0,d.value="loading_data",l.value=0,g.value="–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...";try{g.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞ –∏–∑ Bitrix24...";const C=await Ws.getSectorDataForSnapshot({useCache:!0,normalize:!0,onProgress:$=>{const W=Math.min(80,($.progress||0)*.8);l.value=W,d.value="loading_data",g.value=$.description||$.details?.description||"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞..."}});d.value="creating_snapshot",l.value=85,g.value="–°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–µ–ø–∫–∞...";const f=r.value;if(!f)throw new Error("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω");const w=await pt.createSnapshot(C,"manual",{createdBy:{id:f.ID,name:`${f.NAME||""} ${f.LAST_NAME||""}`.trim()||f.EMAIL||`User ${f.ID}`},sectorId:"1C"});d.value="success",l.value=100,g.value="–°–ª–µ–ø–æ–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",p.success("–°–ª–µ–ø–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"),t("snapshot-created",w),setTimeout(()=>{y()},1500)}catch(C){d.value="error",l.value=0,g.value="–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞",console.error("Error creating snapshot:",C);let f="–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞";C.message&&(C.message.includes("–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö")||C.message.includes("sector data")?f="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Bitrix24.":C.message.includes("—Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞")||C.message.includes("snapshot")?f="–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.":C.message.includes("–≤–∞–ª–∏–¥–∞—Ü")||C.message.includes("validation")?f="–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞.":f=C.message),p.error(f)}finally{n.value=!1}}},S=C=>{C.key==="Escape"&&i.value&&!n.value&&y()};return $e(()=>{window.addEventListener("keydown",S)}),st(()=>{window.removeEventListener("keydown",S)}),(C,f)=>T.value?(c(),u("div",Cu,[a("button",{class:"create-snapshot-btn",onClick:v,disabled:n.value,title:"–°–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞"},[...f[1]||(f[1]=[a("span",{class:"btn-icon"},"üì∏",-1),a("span",{class:"btn-text"},"–°–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫",-1)])],8,Tu),(c(),he(It,{to:"body"},[ne(Ae,{name:"modal"},{default:pe(()=>[i.value?(c(),u("div",{key:0,class:"modal-overlay",onClick:f[0]||(f[0]=Ce(w=>!n.value&&y(),["self"]))},[a("div",Su,[a("div",Du,[f[2]||(f[2]=a("h3",{class:"modal-title"},"–°–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞",-1)),a("button",{class:"modal-close",onClick:y,disabled:n.value,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ",8,Eu)]),a("div",Au,[d.value!=="idle"?(c(),u("div",$u,[a("div",Iu,[a("div",{class:"progress-bar",style:we({width:`${l.value}%`})},null,4)]),a("div",Mu,[a("span",Nu,m(Math.round(l.value))+"%",1),a("span",xu,m(g.value),1)])])):(c(),u("div",Lu,[...f[3]||(f[3]=[a("p",{class:"modal-description"},' –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Å–ª–µ–ø–æ–∫ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°. –°–ª–µ–ø–æ–∫ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω —Å —Ç–∏–ø–æ–º "manual" (—Ä—É—á–Ω–æ–π). ',-1),a("p",{class:"modal-warning"}," ‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è. ",-1)])]))]),a("div",Pu,[a("button",{class:"btn btn-secondary",onClick:y,disabled:n.value}," –û—Ç–º–µ–Ω–∞ ",8,Ou),a("button",{class:"btn btn-primary",onClick:k,disabled:n.value},[n.value?(c(),u("span",Bu,[d.value==="loading_data"?(c(),u("span",Uu,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...")):d.value==="creating_snapshot"?(c(),u("span",Wu,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),u("span",Fu,"–û–±—Ä–∞–±–æ—Ç–∫–∞..."))])):(c(),u("span",Hu,"–°–æ–∑–¥–∞—Ç—å"))],8,Ru)])])])):A("",!0)]),_:1})]))])):A("",!0)}},Vu=de(ju,[["__scopeId","data-v-09bccee2"]]),zu=20,Gu=5*60*1e3;async function Ku({search:o="",limit:e=zu,sectorDepartmentId:s=Jt.SECTOR_1C}={}){const t=`sector1c_employees_${o}_${e}_${s||"all"}`,r=sessionStorage.getItem(t);if(r)try{const{data:i,timestamp:n}=JSON.parse(r);if(Date.now()-n<Gu)return i}catch(i){console.warn("[sector1cEmployees] Cache parse error:",i)}try{const i={ACTIVE:"Y"};s?Array.isArray(s)?i.UF_DEPARTMENT=s:i.UF_DEPARTMENT=[s]:i.UF_DEPARTMENT=[Jt.SECTOR_1C],o&&o.length>=2&&(i["%NAME"]=o,i["%LAST_NAME"]=o,i["%WORK_POSITION"]=o);const g=((await new vt().call("user.get",{filter:i,select:["ID","NAME","LAST_NAME","SECOND_NAME","WORK_POSITION","UF_DEPARTMENT"],order:{LAST_NAME:"ASC",NAME:"ASC"},start:0})).result||[]).slice(0,e).map(p=>({id:parseInt(p.ID),name:qu(p),position:p.WORK_POSITION||"",department:p.UF_DEPARTMENT||null}));try{sessionStorage.setItem(t,JSON.stringify({data:g,timestamp:Date.now()}))}catch(p){console.warn("[sector1cEmployees] Cache write error:",p)}return g}catch(i){throw console.error("[sector1cEmployees] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",i),new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${i.message}`)}}function qu(o){const e=[o.LAST_NAME,o.NAME,o.SECOND_NAME].filter(Boolean);return e.length>0?e.join(" "):o.NAME||"–ë–µ–∑ –∏–º–µ–Ω–∏"}function Yu(o,e=300){let s;return function(...r){const i=()=>{clearTimeout(s),o(...r)};clearTimeout(s),s=setTimeout(i,e)}}const Xu={class:"employee-select-field-text"},Ju={key:0,class:"employee-select-dropdown"},Zu={class:"employee-select-dropdown-search"},Qu={key:0,class:"employee-select-state"},eg={key:1,class:"employee-select-state employee-select-state--error"},tg={key:2,class:"employee-select-state"},sg=["checked"],ag=["checked","onChange"],og={class:"employee-select-item-content"},ng={class:"employee-select-item-name"},rg={key:0,class:"employee-select-item-position"},ig={__name:"EmployeeSelect",props:{selected:{type:Array,default:()=>["all"]},multiple:{type:Boolean,default:!0},placeholder:{type:String,default:"–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°"},maxHeight:{type:Number,default:300}},emits:["update:selected","search","error"],setup(o,{emit:e}){const s=o,t=e,r=I(null),i=I(null),n=I(""),l=I([]),d=I(!1),g=I(null),p=I(!1),T=M(()=>{if(!n.value)return l.value;const D=n.value.toLowerCase();return l.value.filter(E=>E.name.toLowerCase().includes(D)||E.position&&E.position.toLowerCase().includes(D))}),v=M(()=>{if(s.selected.includes("all")||s.selected.length===0)return s.placeholder;if(s.selected.length===1){const D=l.value.find(E=>E.id===s.selected[0]);return D?D.name:s.placeholder}return`–í—ã–±—Ä–∞–Ω–æ: ${s.selected.length} ${W(s.selected.length,"—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞","—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤","—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤")}`});async function y(D=""){d.value=!0,g.value=null;try{l.value=await Ku({search:D})}catch(E){g.value=E,t("error",E)}finally{d.value=!1}}function k(){t("search",n.value)}function S(){d.value||(p.value=!p.value,p.value?(l.value.length===0&&y(),Wt(()=>{i.value&&i.value.focus()})):n.value="")}function C(D){r.value&&!r.value.contains(D.target)&&(p.value=!1,n.value="")}function f(D){const E=[...s.selected],x=E.indexOf(D);if(D==="all")if(x>-1)E.splice(x,1);else return t("update:selected",["all"]);else if(x>-1)E.splice(x,1);else{const R=E.indexOf("all");R>-1&&E.splice(R,1),E.push(D)}t("update:selected",E)}function w(D){return D==="all"?s.selected.includes("all"):s.selected.includes(D)||s.selected.includes("all")}const $=M(()=>n.value?`–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É "${n.value}"`:"–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°");function W(D,E,x,R){const U=D%10,G=D%100;return G>=11&&G<=19?R:U===1?E:U>=2&&U<=4?x:R}function L(){y(n.value)}return Ne(()=>s.selected,D=>{(!D||D.length===0)&&t("update:selected",["all"])},{immediate:!0}),$e(()=>{document.addEventListener("click",C),(!s.selected||s.selected.length===0)&&t("update:selected",["all"])}),st(()=>{document.removeEventListener("click",C)}),(D,E)=>(c(),u("div",{class:"employee-select",ref_key:"selectContainer",ref:r},[a("div",{class:X(["employee-select-field",{"employee-select-field--open":p.value,"employee-select-field--disabled":d.value}]),onClick:S},[a("span",Xu,m(v.value),1),a("span",{class:X(["employee-select-field-icon",{open:p.value}])},"‚ñº",2)],2),ne(Ae,{name:"dropdown-fade"},{default:pe(()=>[p.value?(c(),u("div",Ju,[a("div",Zu,[Re(a("input",{"onUpdate:modelValue":E[0]||(E[0]=x=>n.value=x),type:"text",placeholder:"üîç –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...",class:"employee-select-search-input",onInput:k,onClick:E[1]||(E[1]=Ce(()=>{},["stop"])),ref_key:"searchInput",ref:i},null,544),[[At,n.value]])]),d.value?(c(),u("div",Qu,[...E[6]||(E[6]=[a("span",{class:"spinner"},"‚è≥",-1),a("span",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°...",-1)])])):g.value?(c(),u("div",eg,[a("span",null,"‚ùå "+m(g.value.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤"),1),a("button",{onClick:[L,E[2]||(E[2]=Ce(()=>{},["stop"]))],class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):!d.value&&T.value.length===0&&!g.value?(c(),u("div",tg,[a("span",null,"üì≠ "+m($.value),1)])):(c(),u("div",{key:3,class:"employee-select-list",style:we({maxHeight:`${o.maxHeight}px`})},[a("label",{class:X(["employee-select-item",{"employee-select-item--selected":w("all")}]),onClick:E[4]||(E[4]=Ce(()=>{},["stop"]))},[a("input",{type:"checkbox",checked:w("all"),onChange:E[3]||(E[3]=x=>f("all"))},null,40,sg),E[7]||(E[7]=a("div",{class:"employee-select-item-content"},[a("span",{class:"employee-select-item-name"},"–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏")],-1))],2),(c(!0),u(ee,null,te(T.value,x=>(c(),u("label",{key:x.id,class:X(["employee-select-item",{"employee-select-item--selected":w(x.id)}]),onClick:E[5]||(E[5]=Ce(()=>{},["stop"]))},[a("input",{type:"checkbox",checked:w(x.id),onChange:R=>f(x.id)},null,40,ag),a("div",og,[a("span",ng,m(x.name),1),x.position?(c(),u("span",rg,m(x.position),1)):A("",!0)])],2))),128))],4))])):A("",!0)]),_:1})],512))}},lg=de(ig,[["__scopeId","data-v-6b8c949b"]]),cg={class:"stage-select-field-text"},dg={key:0,class:"stage-select-dropdown"},ug={class:"stage-select-list"},gg=["checked"],mg=["checked","onChange"],hg={class:"stage-select-item-content"},fg={class:"stage-select-item-name"},vg={__name:"StageSelect",props:{selected:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},stages:{type:Array,required:!0,default:()=>[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff"},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107"},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745"}]},placeholder:{type:String,default:"–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø—ã"}},emits:["update:selected","change"],setup(o,{emit:e}){const s=o,t=e,r=I(null),i=I(!1),n=M(()=>Object.values(s.selected).every(v=>v===!0)),l=M(()=>{if(n.value)return s.placeholder;const v=s.stages.filter(y=>s.selected[y.id]);return v.length===0?"–≠—Ç–∞–ø—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã":v.length===1?v[0].name:`–í—ã–±—Ä–∞–Ω–æ: ${v.length} —ç—Ç–∞–ø–∞(–æ–≤)`});function d(){i.value=!i.value,i.value}function g(v){r.value&&!r.value.contains(v.target)&&(i.value=!1)}function p(v,y){const k={...s.selected};k[v]=y,t("update:selected",k),t("change",v,y)}function T(){const v=n.value,y={};s.stages.forEach(k=>{y[k.id]=!v}),t("update:selected",y),t("change","all",!v)}return $e(()=>{document.addEventListener("click",g)}),st(()=>{document.removeEventListener("click",g)}),(v,y)=>(c(),u("div",{class:"stage-select",ref_key:"selectContainer",ref:r},[a("div",{class:X(["stage-select-field",{"stage-select-field--open":i.value,"stage-select-field--disabled":!1}]),onClick:d},[a("span",cg,m(l.value),1),a("span",{class:X(["stage-select-field-icon",{open:i.value}])},"‚ñº",2)],2),ne(Ae,{name:"dropdown-fade"},{default:pe(()=>[i.value?(c(),u("div",dg,[a("div",ug,[a("label",{class:X(["stage-select-item",{"stage-select-item--selected":n.value}]),onClick:y[0]||(y[0]=Ce(()=>{},["stop"]))},[a("input",{type:"checkbox",checked:n.value,onChange:T},null,40,gg),y[2]||(y[2]=a("div",{class:"stage-select-item-content"},[a("span",{class:"stage-select-item-name"},"–í—Å–µ —ç—Ç–∞–ø—ã")],-1))],2),(c(!0),u(ee,null,te(o.stages,k=>(c(),u("label",{key:k.id,class:X(["stage-select-item",{"stage-select-item--selected":o.selected[k.id]}]),onClick:y[1]||(y[1]=Ce(()=>{},["stop"]))},[a("input",{type:"checkbox",checked:o.selected[k.id],onChange:S=>p(k.id,S.target.checked)},null,40,mg),a("div",hg,[a("span",{class:"stage-select-item-color",style:we({backgroundColor:k.color})},null,4),a("span",fg,m(k.name),1)])],2))),128))])])):A("",!0)]),_:1})],512))}},pg=de(vg,[["__scopeId","data-v-ce2229b2"]]),yg={class:"trigger-text"},kg={class:"week-picker-items"},bg=["data-week-number","onClick"],_g={class:"week-item-content"},wg={class:"week-number"},Cg={class:"week-dates"},Tg={class:"week-picker-actions"},Sg=["disabled"],Dg={__name:"WeekPicker",props:{selectedWeek:{type:Object,default:null},weeksCount:{type:Number,default:52}},emits:["update:selectedWeek","change"],setup(o,{emit:e}){const s=o,t=e,r=I(null),i=I(null),n=I([]),l=I(!1),d=I(!1),g=I(null);function p(L=52,D=4){const E=[],x=new Date,R=T(x),U=v(x);for(let G=0;G<L;G++){const q=new Date(R.start);q.setUTCDate(q.getUTCDate()-G*7);const oe=T(q),Y=v(q);E.unshift({weekNumber:Y,startUtc:oe.start.toISOString(),endUtc:oe.end.toISOString(),start:oe.start,end:oe.end})}(E.length===0||E[E.length-1].weekNumber!==U)&&E.push({weekNumber:U,startUtc:R.start.toISOString(),endUtc:R.end.toISOString(),start:R.start,end:R.end});for(let G=1;G<=D;G++){const q=new Date(R.start);q.setUTCDate(q.getUTCDate()+G*7);const oe=T(q),Y=v(q);E.push({weekNumber:Y,startUtc:oe.start.toISOString(),endUtc:oe.end.toISOString(),start:oe.start,end:oe.end})}return E.sort((G,q)=>G.start-q.start),E}function T(L){const D=new Date(L),E=D.getUTCDay(),x=D.getUTCDate()-E+(E===0?-6:1),R=new Date(Date.UTC(D.getUTCFullYear(),D.getUTCMonth(),x,0,0,0)),U=new Date(R);return U.setUTCDate(U.getUTCDate()+6),U.setUTCHours(23,59,59,999),{start:R,end:U}}function v(L){const D=new Date(Date.UTC(L.getFullYear(),L.getMonth(),L.getDate()));D.setUTCDate(D.getUTCDate()+4-(D.getUTCDay()||7));const E=new Date(Date.UTC(D.getUTCFullYear(),0,1));return Math.ceil(((D-E)/864e5+1)/7)}function y(L){const D=new Date(L),E=D.getUTCFullYear(),x=String(D.getUTCMonth()+1).padStart(2,"0"),R=String(D.getUTCDate()).padStart(2,"0");return`${E}-${x}-${R}`}function k(){d.value=!d.value,d.value&&(n.value=p(s.weeksCount,4),g.value=s.selectedWeek||n.value.find(L=>{const E=v(new Date);return L.weekNumber===E})||n.value[0],Wt(()=>{g.value&&w(g.value.weekNumber)}))}function S(L){g.value=L,w(L.weekNumber)}function C(){g.value&&(t("update:selectedWeek",g.value),t("change",g.value),d.value=!1)}function f(){g.value=s.selectedWeek||null,d.value=!1}function w(L){if(!i.value)return;const D=i.value.querySelector(`[data-week-number="${L}"]`);if(D){const E=i.value,x=D.offsetTop,R=E.clientHeight,U=D.clientHeight,G=x-R/2+U/2;E.scrollTo({top:G,behavior:"smooth"})}}function $(){l.value||!d.value||(l.value=!0,clearTimeout(window.weekPickerScrollTimeout),window.weekPickerScrollTimeout=setTimeout(()=>{if(!i.value){l.value=!1;return}const L=i.value,D=L.getBoundingClientRect(),E=D.top+D.height/2,x=L.querySelectorAll(".week-picker-item");let R=null,U=1/0;if(x.forEach(G=>{const q=G.getBoundingClientRect(),oe=q.top+q.height/2,Y=Math.abs(oe-E);Y<U&&(U=Y,R=G)}),R){const G=parseInt(R.dataset.weekNumber),q=n.value.find(oe=>oe.weekNumber===G);q&&(!g.value||q.weekNumber!==g.value.weekNumber)&&(g.value=q)}l.value=!1},150))}function W(L){r.value&&!r.value.contains(L.target)&&d.value&&f()}return $e(()=>{if(n.value=p(s.weeksCount,4),s.selectedWeek)g.value=s.selectedWeek;else{const D=v(new Date),E=n.value.find(x=>x.weekNumber===D);E?g.value=E:g.value=n.value[0]}document.addEventListener("click",W)}),st(()=>{window.weekPickerScrollTimeout&&clearTimeout(window.weekPickerScrollTimeout),document.removeEventListener("click",W)}),Ne(()=>s.selectedWeek,L=>{L&&(g.value=L,d.value&&!l.value&&Wt(()=>{w(L.weekNumber)}))},{deep:!0}),(L,D)=>(c(),u("div",{class:"week-picker",ref_key:"pickerContainer",ref:r},[D[1]||(D[1]=a("div",{class:"week-picker-label"},[a("span",{class:"section-icon"},"üìÖ"),a("span",null,"–ü–µ—Ä–∏–æ–¥")],-1)),a("div",{class:X(["week-picker-trigger",{"is-open":d.value}]),onClick:k},[a("span",yg,[o.selectedWeek?(c(),u(ee,{key:0},[ce(" –ù–µ–¥–µ–ª—è "+m(o.selectedWeek.weekNumber)+" ¬∑ "+m(y(o.selectedWeek.startUtc))+" ‚Äî "+m(y(o.selectedWeek.endUtc)),1)],64)):(c(),u(ee,{key:1},[ce(" –í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–¥–µ–ª—é ")],64))]),a("span",{class:X(["trigger-icon",{"is-open":d.value}])},"‚ñº",2)],2),ne(Ae,{name:"dropdown-fade"},{default:pe(()=>[d.value?(c(),u("div",{key:0,class:"week-picker-dropdown",onClick:D[0]||(D[0]=Ce(()=>{},["stop"]))},[a("div",{class:"week-picker-wheel",ref_key:"wheelContainer",ref:i,onScroll:$},[a("div",kg,[(c(!0),u(ee,null,te(n.value,(E,x)=>(c(),u("div",{key:E.weekNumber,class:X(["week-picker-item",{active:E.weekNumber===g.value?.weekNumber}]),"data-week-number":E.weekNumber,onClick:R=>S(E)},[a("div",_g,[a("div",wg,"–ù–µ–¥–µ–ª—è "+m(E.weekNumber),1),a("div",Cg,m(y(E.startUtc))+" ‚Äî "+m(y(E.endUtc)),1)])],10,bg))),128))])],544),a("div",Tg,[a("button",{class:"btn-cancel",onClick:f},"–û—Ç–º–µ–Ω–∞"),a("button",{class:"btn-apply",onClick:C,disabled:!g.value},"–ü—Ä–∏–º–µ–Ω–∏—Ç—å",8,Sg)])])):A("",!0)]),_:1})],512))}},Eg=de(Dg,[["__scopeId","data-v-daae25a6"]]),Ag={class:"filters-panel"},$g={class:"filters-header"},Ig=["disabled"],Mg={class:"filters-content"},Ng={key:0,class:"filter-section"},xg={class:"section-content"},Lg={class:"filter-section"},Pg={class:"section-content"},Og={class:"filter-section"},Rg={key:0,class:"section-content"},Bg={class:"section-content"},Ug={key:0,class:"period-mode-group"},Wg=["value"],Fg=["disabled"],Hg=["disabled"],jg={key:0,class:"period-mode-hint"},Vg={key:1,class:"period-mode-hint"},zg=["value"],Gg={key:0,class:"custom-date-range"},Kg={class:"date-range-inputs"},qg={class:"date-input-group"},Yg=["value","max"],Xg={class:"date-input-group"},Jg=["value","min","max"],Zg={key:0,class:"filter-error"},Qg={key:1,class:"filter-hint"},em={__name:"FiltersPanel",props:{stages:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},employees:{type:Array,default:()=>["all"]},dateRange:{type:String,default:"last-week"},customDateRange:{type:Object,default:()=>({startDate:null,endDate:null})},hasActiveFilters:{type:Boolean,default:!1},hideStages:{type:Boolean,default:!1},weekPickerMode:{type:Boolean,default:!1},selectedWeek:{type:Object,default:null},weeksCount:{type:Number,default:52},showPeriodMode:{type:Boolean,default:!1},periodMode:{type:String,default:"weeks",validator:o=>["weeks","months"].includes(o)}},emits:["update:stages","update:employees","update:dateRange","update:customDateRange","update:selectedWeek","update:periodMode","reset","apply"],setup(o,{emit:e}){const s=o,t=e,r=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"var(--b24-primary, #007bff)"},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"var(--b24-warning, #ffc107)"},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"var(--b24-success, #28a745)"}],i=I(null),n=M(()=>{const C=new Date;return C.setFullYear(C.getFullYear()-1),C.toISOString().split("T")[0]}),l=M(()=>new Date().toISOString().split("T")[0]);function d(C){t("update:stages",C),t("apply")}function g(C,f){t("apply")}function p(C){t("update:employees",C),t("apply")}function T(C){t("update:dateRange",C),i.value=null,t("apply")}function v(C,f){const w={...s.customDateRange};if(w[C]=f,w.startDate&&w.endDate){const $=new Date(w.startDate),W=new Date(w.endDate);if($>W){i.value="–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω–µ—á–Ω–æ–π";return}if(Math.ceil((W-$)/(1e3*60*60*24))>365){i.value="–ü–µ—Ä–∏–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 365 –¥–Ω–µ–π";return}}i.value=null,t("update:customDateRange",w),t("apply")}function y(C){t("update:selectedWeek",C),t("apply")}function k(C){if(!["weeks","months"].includes(C)){console.warn("[FiltersPanel] Invalid periodMode:",C);return}C!==s.periodMode&&(t("update:periodMode",C),t("apply"))}function S(){i.value=null,t("reset")}return(C,f)=>(c(),u("div",Ag,[a("div",$g,[f[4]||(f[4]=a("h2",null,"–§–∏–ª—å—Ç—Ä—ã",-1)),a("button",{onClick:S,class:"btn-reset-filters",disabled:!o.hasActiveFilters}," –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã ",8,Ig)]),a("div",Mg,[o.hideStages?A("",!0):(c(),u("div",Ng,[f[5]||(f[5]=a("h3",{class:"section-title"},[a("span",{class:"section-icon"},"üìä"),ce(" –≠—Ç–∞–ø—ã ")],-1)),a("div",xg,[ne(pg,{selected:o.stages,stages:r,placeholder:"–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø—ã","onUpdate:selected":d,onChange:g},null,8,["selected"])])])),a("div",Lg,[f[6]||(f[6]=a("h3",{class:"section-title"},[a("span",{class:"section-icon"},"üë•"),ce(" –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ")],-1)),a("div",Pg,[ne(lg,{selected:o.employees,"onUpdate:selected":p},null,8,["selected"])])]),a("div",Og,[o.weekPickerMode?(c(),u("div",Rg,[ne(Eg,{selectedWeek:o.selectedWeek,weeksCount:o.weeksCount,"onUpdate:selectedWeek":y,onChange:y},null,8,["selectedWeek","weeksCount"])])):(c(),u(ee,{key:1},[f[11]||(f[11]=a("h3",{class:"section-title"},[a("span",{class:"section-icon"},"üìÖ"),ce(" –ü–µ—Ä–∏–æ–¥ ")],-1)),a("div",Bg,[o.showPeriodMode?(c(),u("div",Ug,[f[7]||(f[7]=a("label",{class:"period-mode-label"},"–†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:",-1)),a("select",{value:o.periodMode,onChange:f[0]||(f[0]=w=>k(w.target.value)),class:X(["period-mode-select",{"period-mode-select--current-weeks":o.periodMode==="weeks","period-mode-select--current-months":o.periodMode==="months"}])},[a("option",{value:"weeks",disabled:o.periodMode==="weeks"}," 4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ ",8,Fg),a("option",{value:"months",disabled:o.periodMode==="months"}," 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞ ",8,Hg)],42,Wg),o.periodMode==="weeks"?(c(),u("small",jg," –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: 4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ ")):o.periodMode==="months"?(c(),u("small",Vg," –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞ ")):A("",!0)])):A("",!0),o.showPeriodMode?A("",!0):(c(),u(ee,{key:1},[a("select",{value:o.dateRange,onChange:f[1]||(f[1]=w=>T(w.target.value)),class:"date-range-select"},[...f[8]||(f[8]=[a("option",{value:"last-week"},"–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–¥–µ–ª—è",-1),a("option",{value:"last-2-weeks"},"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏",-1),a("option",{value:"last-month"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü",-1),a("option",{value:"custom"},"–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])],40,zg),o.dateRange==="custom"?(c(),u("div",Gg,[a("div",Kg,[a("div",qg,[f[9]||(f[9]=a("label",null,"–°:",-1)),a("input",{type:"date",value:o.customDateRange.startDate,onChange:f[2]||(f[2]=w=>v("startDate",w.target.value)),max:o.customDateRange.endDate||l.value,class:"date-input"},null,40,Yg)]),a("div",Xg,[f[10]||(f[10]=a("label",null,"–ü–æ:",-1)),a("input",{type:"date",value:o.customDateRange.endDate,onChange:f[3]||(f[3]=w=>v("endDate",w.target.value)),min:o.customDateRange.startDate||n.value,max:l.value,class:"date-input"},null,40,Jg)])]),i.value?(c(),u("small",Zg,m(i.value),1)):(c(),u("small",Qg," –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –∏ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö "))])):A("",!0)],64))])],64))])])]))}},js=de(em,[["__scopeId","data-v-5970a362"]]);function tm(){const o=I(!1),e=I(null),s=I(null),t=I(0),r=mt(),i=async(C=!0,f=null)=>{o.value=!0,e.value=null,t.value=0;try{const w=await Ws.getSectorDataForSnapshot({useCache:C,onProgress:$=>{$&&typeof $.progress=="number"&&(t.value=$.progress),f&&f($)},normalize:!0});return s.value=w,w}catch(w){throw e.value=w.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞",r.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞: "+e.value),w}finally{o.value=!1,t.value=100}},n=async(C,f={})=>{if(!s.value){const w="–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ loadSectorDataForSnapshot()";throw e.value=w,r.error(w),new Error(w)}o.value=!0,e.value=null;try{if(!["week_start","week_end","manual","current"].includes(C))throw new Error(`–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø —Å–ª–µ–ø–∫–∞: ${C}. –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: week_start, week_end, manual, current`);const w=await pt.createSnapshot(s.value,C,f);return r.success("–°–ª–µ–ø–æ–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"),w}catch(w){throw e.value=w.message||"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞",r.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞: "+e.value),w}finally{o.value=!1}},l=()=>{o.value=!1,e.value=null,s.value=null,t.value=0},d=M(()=>s.value!==null&&s.value!==void 0),g=I({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),p=M(()=>{const C=new Date;let f,w;switch(g.value.dateRange){case"last-week":f=new Date(C),f.setDate(C.getDate()-7),w=C;break;case"last-2-weeks":f=new Date(C),f.setDate(C.getDate()-14),w=C;break;case"last-month":f=new Date(C),f.setMonth(C.getMonth()-1),w=C;break;case"custom":f=g.value.customDateRange.startDate?new Date(g.value.customDateRange.startDate):null,w=g.value.customDateRange.endDate?new Date(g.value.customDateRange.endDate):null;break;default:f=new Date(C),f.setDate(C.getDate()-7),w=C}return{startDate:f?f.toISOString().split("T")[0]:null,endDate:w?w.toISOString().split("T")[0]:null}}),T=()=>{y()},v=()=>{g.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},y()},y=()=>{try{localStorage.setItem("graphStateFilters",JSON.stringify(g.value))}catch(C){console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ localStorage:",C)}},k=()=>{try{const C=localStorage.getItem("graphStateFilters");if(C){const f=JSON.parse(C);f&&typeof f=="object"&&(g.value={stages:f.stages||{formed:!0,review:!0,execution:!0},employees:f.employees||["all"],dateRange:f.dateRange||"last-week",customDateRange:f.customDateRange||{startDate:null,endDate:null}})}}catch(C){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ localStorage:",C)}},S=M(()=>{const C=Object.values(g.value.stages).some($=>!$),f=!g.value.employees.includes("all"),w=g.value.dateRange!=="last-week";return C||f||w});return{isLoading:o,error:e,currentSectorData:s,loadingProgress:t,hasSectorData:d,filters:g,selectedPeriod:p,hasActiveFilters:S,loadSectorDataForSnapshot:i,createSnapshot:n,resetState:l,applyFilters:T,resetFilters:v,saveFiltersToLocalStorage:y,loadFiltersFromLocalStorage:k}}const sm={class:"graph-state-dashboard"},am={key:1,class:"error-message-container"},om={class:"error-message"},nm={class:"error-text"},rm={key:0,class:"error-details"},im={class:"dashboard-header"},lm={class:"header-content"},cm={class:"breadcrumbs-row"},dm=["aria-disabled","data-fallback","disabled"],um={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},gm={class:"header-actions"},mm=["disabled"],hm={key:0},fm={key:1},vm={key:3,class:"dashboard-content"},pm={class:"chart-container"},ym="–ù–∞–∑–∞–¥",km={__name:"GraphStateDashboard",setup(o){const e=(ae,me)=>typeof window>"u"?me:getComputedStyle(document.documentElement).getPropertyValue(ae).trim()||me,s=mt(),t=Xe(),r={name:"dashboard-sector-1c"},{filters:i,selectedPeriod:n,hasActiveFilters:l,applyFilters:d,resetFilters:g,loadFiltersFromLocalStorage:p}=tm(),T=I(null),v=I(!0),y=I(!1),k=I("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."),S=I(null),C=I(!1),f=I(!1),w=I(typeof window<"u"?window.innerWidth:1024),$=I(null),W=I(!1),L=M(()=>w.value<768);M(()=>w.value>=768&&w.value<1024),M(()=>w.value>=1024);const D=M(()=>typeof window>"u"?!1:window.history.length>1);M(()=>{const ae=new Date;return ae.setFullYear(ae.getFullYear()-1),ae.toISOString().split("T")[0]}),M(()=>new Date().toISOString().split("T")[0]);function E(ae){i.value.stages=ae}function x(ae){i.value.employees=ae}function R(ae){i.value.dateRange=ae}function U(ae){i.value.customDateRange=ae}function G(){d()}function q(){g(),$.value=null,G(),s.info("–§–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã")}function oe(ae){s.success("–°–ª–µ–ø–æ–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω")}function Y(ae){y.value=!1,k.value="",console.log("–î–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:",ae)}function H(ae){y.value=!1,Z({message:ae||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞",details:null,type:"error"})}function Z(ae){S.value={message:ae.message||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞",details:ae.details||null,type:ae.type||"error",timestamp:new Date},console.error("Dashboard error:",S.value),s.error(S.value.message)}function fe(){S.value=null}function P(){S.value=null,y.value=!0,k.value="–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."}async function h(){if(typeof window>"u"||!window.jsPDF||!window.html2canvas){s.warning("–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ jspdf –∏ html2canvas."),console.warn("–î–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: npm install jspdf html2canvas");return}C.value=!0;try{const ae=document.querySelector(".chart-container");if(!ae)throw new Error("–ì—Ä–∞—Ñ–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω");const me=window.html2canvas,De=await me(ae,{scale:2,useCORS:!0,logging:!1,backgroundColor:e("--b24-bg-white","#ffffff")}),Ie=window.jsPDF,xe=new Ie("landscape","mm","a4"),Fe=297,z=De.height*Fe/De.width;xe.setFontSize(18),xe.text("–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",148.5,15,{align:"center"});const N=new Date().toLocaleDateString("ru-RU");xe.setFontSize(10);const b=n.value.startDate&&n.value.endDate?`–ü–µ—Ä–∏–æ–¥: ${n.value.startDate} - ${n.value.endDate}`:"–ü–µ—Ä–∏–æ–¥: –Ω–µ —É–∫–∞–∑–∞–Ω";xe.text(b,148.5,25,{align:"center"}),xe.text(`–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç ${N}`,148.5,30,{align:"center"}),xe.addImage(De.toDataURL("image/png"),"PNG",10,35,Fe-20,z-20),xe.setProperties({title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",subject:`–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç ${N}`,author:"Bitrix24 Dashboard"});const O=`graph-state-${N.replace(/\//g,"-")}.pdf`;xe.save(O),s.success("–ì—Ä–∞—Ñ–∏–∫ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ PDF")}catch(ae){console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF:",ae),Z({message:"–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF: "+(ae.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"),details:ae.stack,type:"error"})}finally{C.value=!1}}function _(ae){if(ae?.preventDefault?.(),!W.value){W.value=!0;try{if(D.value){t.back();return}console.warn("GraphStateDashboard: fallback navigation to dashboard-sector-1c"),t.push(r)}finally{W.value=!1}}}function B(){t.push("/")}function re(){typeof window<"u"&&(w.value=window.innerWidth)}async function le(){try{const ae=await rt.checkAccess();ae.allowed&&(T.value=ae.user)}catch(ae){console.error("Error loading user:",ae)}}return $e(()=>{p(),le(),typeof window<"u"&&(w.value=window.innerWidth,window.addEventListener("resize",re))}),st(()=>{typeof window<"u"&&window.removeEventListener("resize",re)}),(ae,me)=>{const De=be("router-link");return c(),u("div",sm,[y.value?(c(),he(ws,{key:0,message:k.value},null,8,["message"])):A("",!0),S.value?(c(),u("div",am,[a("div",om,[a("div",{class:"error-header"},[me[1]||(me[1]=a("span",{class:"error-icon"},"‚ùå",-1)),me[2]||(me[2]=a("h3",null,"–û—à–∏–±–∫–∞",-1)),a("button",{onClick:fe,class:"error-close","aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"‚úï")]),a("p",nm,m(S.value.message),1),S.value.details?(c(),u("div",rm,[a("details",null,[me[3]||(me[3]=a("summary",null,"–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏",-1)),a("pre",null,m(S.value.details),1)])])):A("",!0),a("div",{class:"error-actions"},[a("button",{onClick:P,class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])])])):A("",!0),a("div",im,[a("div",lm,[a("div",cm,[a("button",{class:"btn-home-link",type:"button",onClick:B,title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),me[9]||(me[9]=a("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),a("button",{class:"btn-back-link",type:"button",onClick:_,"aria-label":ym,"aria-disabled":!D.value,"data-fallback":!D.value,disabled:W.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,dm),a("nav",um,[ne(De,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:pe(()=>[...me[4]||(me[4]=[ce(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),me[6]||(me[6]=a("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),me[7]||(me[7]=a("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",-1)),me[8]||(me[8]=a("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ne(De,{to:{name:"dashboard-graph-admission-closure"},class:"breadcrumb-link"},{default:pe(()=>[...me[5]||(me[5]=[ce(" –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π ",-1)])]),_:1})])]),me[10]||(me[10]=a("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),me[11]||(me[11]=a("p",{class:"dashboard-subtitle"}," –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏ ",-1))]),a("div",gm,[a("button",{onClick:h,class:"btn-export-pdf",disabled:C.value||y.value,title:"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –≤ PDF"},[C.value?(c(),u("span",fm,"‚è≥ –≠–∫—Å–ø–æ—Ä—Ç...")):(c(),u("span",hm,"üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF"))],8,mm),ne(Vu,{user:T.value,onSnapshotCreated:oe},null,8,["user"])])]),L.value?(c(),u("button",{key:2,class:"mobile-filters-toggle",onClick:me[0]||(me[0]=Ie=>f.value=!f.value)},[me[12]||(me[12]=a("span",null,"–§–∏–ª—å—Ç—Ä—ã",-1)),a("span",{class:X(["toggle-icon",{open:f.value}])},"‚ñº",2)])):A("",!0),a("div",{class:X({"mobile-open":f.value&&L.value,"mobile-closed":!f.value&&L.value})},[ne(js,{stages:Ue(i).stages,employees:Ue(i).employees,dateRange:Ue(i).dateRange,customDateRange:Ue(i).customDateRange,hasActiveFilters:Ue(l),"onUpdate:stages":E,"onUpdate:employees":x,"onUpdate:dateRange":R,"onUpdate:customDateRange":U,onReset:q,onApply:G},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])],2),!y.value&&!S.value?(c(),u("div",vm,[a("div",pm,[ne(wu,{period:Ue(n),"show-current-state":v.value,onDataLoaded:Y,onError:H},null,8,["period","show-current-state"])])])):A("",!0)])}}},La=de(km,[["__scopeId","data-v-831b0079"]]),bm=Object.freeze(Object.defineProperty({__proto__:null,default:La},Symbol.toStringTag,{value:"Module"})),_m={key:0,class:"modal-overlay"},wm={class:"modal-container",role:"dialog","aria-labelledby":"modal-title","aria-modal":"true"},Cm={class:"modal-body"},Tm={class:"mode-description"},Sm={__name:"PeriodModeInfoModal",props:{isVisible:{type:Boolean,required:!0},currentMode:{type:String,default:"weeks",validator:o=>["weeks","months"].includes(o)}},emits:["close","start-loading","select-mode"],setup(o,{emit:e}){const s=o,t=e,r=I(s.currentMode);function i(d){if(!["weeks","months"].includes(d)){console.warn("[PeriodModeInfoModal] Invalid mode:",d);return}r.value=d,console.log("[DEBUG Modal] handleModeSelect: mode =",d),console.log("[DEBUG Modal] Emitting select-mode event"),t("select-mode",d),console.log("[DEBUG Modal] Emitting close event"),t("close"),console.log("[DEBUG Modal] Scheduling start-loading event in 100ms"),setTimeout(()=>{console.log("[DEBUG Modal] Emitting start-loading event"),t("start-loading")},100)}function n(){console.log("[DEBUG Modal] handleClose called, selectedMode =",r.value),console.log("[DEBUG Modal] Emitting select-mode event with",r.value),t("select-mode",r.value),console.log("[DEBUG Modal] Emitting close event"),t("close")}function l(d){d.key==="Escape"&&s.isVisible&&n()}return Ne(()=>s.currentMode,d=>{["weeks","months"].includes(d)&&(r.value=d)}),$e(()=>{s.isVisible&&document.addEventListener("keydown",l)}),st(()=>{document.removeEventListener("keydown",l)}),Ne(()=>s.isVisible,d=>{d?(document.addEventListener("keydown",l),r.value=s.currentMode):document.removeEventListener("keydown",l)}),(d,g)=>(c(),he(It,{to:"body"},[ne(Ae,{name:"modal-fade"},{default:pe(()=>[o.isVisible?(c(),u("div",_m,[a("div",wm,[a("div",{class:"modal-header"},[g[2]||(g[2]=a("h2",{id:"modal-title",class:"modal-title"},[a("span",{class:"modal-icon"},"‚ÑπÔ∏è"),ce(" –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ")],-1)),a("button",{class:"modal-close-btn",onClick:n,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å",type:"button"}," √ó ")]),a("div",Cm,[g[5]||(g[5]=a("p",{class:"modal-description"}," –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π: ",-1)),a("div",Tm,[a("button",{class:X(["mode-item mode-item--clickable",{"mode-item--selected":r.value==="weeks"}]),onClick:g[0]||(g[0]=p=>i("weeks")),type:"button"},[...g[3]||(g[3]=[a("div",{class:"mode-header"},[a("span",{class:"mode-icon"},"üìÖ"),a("h3",{class:"mode-title"},"4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏")],-1),a("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 –Ω–µ–¥–µ–ª–∏ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –Ω–µ–¥–µ–ª—è–º. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç–∏–∫–µ—Ç–æ–≤. ",-1)])],2),a("button",{class:X(["mode-item mode-item--clickable",{"mode-item--selected":r.value==="months"}]),onClick:g[1]||(g[1]=p=>i("months")),type:"button"},[...g[4]||(g[4]=[a("div",{class:"mode-header"},[a("span",{class:"mode-icon"},"üìä"),a("h3",{class:"mode-title"},"3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞")],-1),a("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—Ü–µ–≤. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤. ",-1)])],2)])])])])):A("",!0)]),_:1})]))}},Dm=de(Sm,[["__scopeId","data-v-4a42a9a6"]]),Em={class:"ac-chart"},Am={class:"ac-chart__header"},$m={class:"ac-chart__subtitle"},Im={class:"ac-chart__controls"},Mm={class:"chart-type-selector"},Nm=["onClick"],xm={class:"chart-type-icon"},Lm={class:"chart-type-label"},Pm={class:"ac-chart__summary"},Om={class:"summary-week-block summary-week-block--current"},Rm={class:"summary-week-block__title"},Bm={class:"summary-week-block__title-week"},Um={key:0,class:"summary-week-block__title-dates"},Wm={class:"summary-week-block__cards"},Fm={class:"summary-card__value-wrapper"},Hm={class:"summary-card__value"},jm=["title"],Vm={class:"percentage-indicator__arrow"},zm={class:"percentage-indicator__value"},Gm={class:"percentage-indicator__label"},Km={class:"summary-card__value-wrapper"},qm={class:"summary-card__value-main"},Ym=["title"],Xm={class:"percentage-indicator__arrow"},Jm={class:"percentage-indicator__value"},Zm={class:"percentage-indicator__label"},Qm={class:"summary-card__breakdown"},eh={class:"breakdown-item breakdown-item--this-week"},th={class:"breakdown-item__value"},sh={class:"breakdown-item breakdown-item--other-week"},ah={class:"breakdown-item__value"},oh={class:"summary-card__value-wrapper"},nh={class:"summary-card__value-main"},rh=["title"],ih={class:"percentage-indicator__arrow"},lh={class:"percentage-indicator__value"},ch={class:"percentage-indicator__label"},dh={class:"summary-card__breakdown"},uh={class:"breakdown-item breakdown-item--this-week"},gh={class:"breakdown-item__value"},mh={class:"breakdown-item breakdown-item--previous-week"},hh={class:"breakdown-item__value"},fh={class:"breakdown-item breakdown-item--older"},vh={class:"breakdown-item__value"},ph={class:"summary-card summary-card--stages"},yh={class:"summary-card__tags"},kh={key:0,class:"stage-tag stage-tag--empty"},bh={key:0,class:"summary-week-divider"},_h={key:1,class:"summary-week-block summary-week-block--previous"},wh={class:"summary-week-block__title"},Ch={class:"summary-week-block__title-week"},Th={key:0,class:"summary-week-block__title-dates"},Sh={class:"summary-week-block__cards"},Dh={class:"summary-card__value-wrapper"},Eh={class:"summary-card__values-comparison"},Ah={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},$h={class:"summary-card__value"},Ih={class:"value-label"},Mh={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},Nh={class:"summary-card__value summary-card__value--current-week"},xh={class:"value-label"},Lh=["title"],Ph={class:"percentage-indicator__arrow"},Oh={class:"percentage-indicator__value"},Rh={class:"percentage-indicator__label"},Bh={class:"summary-card__value-wrapper"},Uh={class:"summary-card__values-comparison"},Wh={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},Fh={class:"summary-card__value-main"},Hh={class:"value-label"},jh={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},Vh={class:"summary-card__value-main summary-card__value-main--current-week"},zh={class:"value-label"},Gh=["title"],Kh={class:"percentage-indicator__arrow"},qh={class:"percentage-indicator__value"},Yh={class:"percentage-indicator__label"},Xh={class:"summary-card__breakdown"},Jh={class:"breakdown-item breakdown-item--this-week"},Zh={class:"breakdown-item__value"},Qh={class:"breakdown-item breakdown-item--other-week"},ef={class:"breakdown-item__value"},tf={class:"summary-card__value-wrapper"},sf={class:"summary-card__values-comparison"},af={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},of={class:"summary-card__value-main"},nf={class:"value-label"},rf={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},lf={class:"summary-card__value-main summary-card__value-main--current-week"},cf={class:"value-label"},df=["title"],uf={class:"percentage-indicator__arrow"},gf={class:"percentage-indicator__value"},mf={class:"percentage-indicator__label"},hf={class:"summary-card__breakdown"},ff={class:"breakdown-item breakdown-item--this-week"},vf={class:"breakdown-item__value"},pf={class:"breakdown-item breakdown-item--previous-week"},yf={class:"breakdown-item__value"},kf={class:"breakdown-item breakdown-item--older"},bf={class:"breakdown-item__value"},_f={class:"summary-card summary-card--stages summary-card--previous"},wf={class:"summary-card__tags"},Cf={key:0,class:"stage-tag stage-tag--empty"},Tf={class:"ac-chart__body"},Sf={key:0,class:"split-charts-container"},Df={class:"chart-wrapper chart-wrapper--left"},Ef={class:"chart-canvas-wrapper"},Af={class:"chart-wrapper chart-wrapper--right"},$f={class:"chart-canvas-wrapper"},If={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedPreviousWeek:0,carryoverTicketsCreatedOlder:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedPreviousWeek:[0],carryoverCreatedOlder:[0],carryoverCreatedOtherWeek:[0]},stagesByWeek:[],stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(o,{emit:e}){Je.register(pa);const s=o,t=e,r=M(()=>{const h=s.meta?.weeks||[];return h.length>=2?h[h.length-2]:null}),i=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],n=I("line"),l={color:"#111827",font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:h=>h?.dataset?.borderColor||"#111827",borderWidth:1,borderRadius:4,padding:4,offset:8,formatter:h=>h==null||isNaN(h)?"":f(h),display:h=>{if(h?.chart?.config?.type!=="line")return!1;const B=h?.dataset?.data?.[h.dataIndex];return B!=null&&!isNaN(B)&&isFinite(B)}};M(()=>s.meta?.weekNumber??"‚Äî");const d=()=>{const h=s.meta?.weeks||[];return h.length>0?h.map(_=>`–ù–µ–¥–µ–ª—è ${_.weekNumber}`):[s.meta?.weekNumber?`–ù–µ–¥–µ–ª—è ${s.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"]};function g(h,_,B,re=.3,le=0){if(!_)return((Ie,xe)=>{const Fe=parseInt(Ie.slice(1,3),16),z=parseInt(Ie.slice(3,5),16),N=parseInt(Ie.slice(5,7),16);return`rgba(${Fe}, ${z}, ${N}, ${xe})`})(B,re);const ae=(De,Ie)=>{const xe=parseInt(De.slice(1,3),16),Fe=parseInt(De.slice(3,5),16),z=parseInt(De.slice(5,7),16);return`rgba(${xe}, ${Fe}, ${z}, ${Ie})`},me=h.createLinearGradient(0,_.bottom,0,_.top);return me.addColorStop(0,ae(B,re)),me.addColorStop(1,ae(B,le)),me}const p=M(()=>{const h=d(),_=Array.isArray(s.data.series?.new)&&s.data.series.new.length>0?s.data.series.new:[s.data.newTickets??0],B=Array.isArray(s.data.series?.closed)&&s.data.series.closed.length>0?s.data.series.closed:[s.data.closedTickets??0],re=Array.isArray(s.data.series?.closedCreatedThisWeek)&&s.data.series.closedCreatedThisWeek.length>0?s.data.series.closedCreatedThisWeek:[s.data.closedTicketsCreatedThisWeek??0],le=Array.isArray(s.data.series?.closedCreatedOtherWeek)&&s.data.series.closedCreatedOtherWeek.length>0?s.data.series.closedCreatedOtherWeek:[s.data.closedTicketsCreatedOtherWeek??0];return{labels:h,datasets:[{label:"–ù–æ–≤—ã–µ",data:_,backgroundColor:ae=>{const me=ae.chart,{ctx:De,chartArea:Ie}=me;return g(De,Ie,J.primary)},borderColor:J.primary,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.primary,pointBackgroundColor:J.primary,datalabels:{...l,anchor:"end",align:"top",offset:10,color:J.primary,borderColor:J.primary}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:B,backgroundColor:ae=>{const me=ae.chart,{ctx:De,chartArea:Ie}=me;return g(De,Ie,J.success)},borderColor:J.success,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.success,pointBackgroundColor:J.success,datalabels:{...l,anchor:"start",align:"bottom",offset:10,color:J.success,borderColor:J.success}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:re,backgroundColor:J.successLight,borderColor:J.successLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:J.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.successLight,pointBackgroundColor:J.successLight,datalabels:{...l,anchor:"end",align:"bottom",offset:8,color:J.successLight,borderColor:J.successLight}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:le,backgroundColor:J.warning,borderColor:J.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:J.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.warning,pointBackgroundColor:J.warning,datalabels:{...l,anchor:"end",align:"bottom",offset:8,color:J.warning,borderColor:J.warning}}]}}),T=M(()=>{const h=d(),_=Array.isArray(s.data.series?.carryover)&&s.data.series.carryover.length>0?s.data.series.carryover:[s.data.carryoverTickets??0],B=Array.isArray(s.data.series?.carryoverCreatedThisWeek)&&s.data.series.carryoverCreatedThisWeek.length>0?s.data.series.carryoverCreatedThisWeek:[s.data.carryoverTicketsCreatedThisWeek??0],re=Array.isArray(s.data.series?.carryoverCreatedPreviousWeek)&&s.data.series.carryoverCreatedPreviousWeek.length>0?s.data.series.carryoverCreatedPreviousWeek:[s.data.carryoverTicketsCreatedPreviousWeek??0],le=Array.isArray(s.data.series?.carryoverCreatedOlder)&&s.data.series.carryoverCreatedOlder.length>0?s.data.series.carryoverCreatedOlder:[s.data.carryoverTicketsCreatedOlder??0];return Array.isArray(s.data.series?.carryoverCreatedOtherWeek)&&s.data.series.carryoverCreatedOtherWeek.length>0?s.data.series.carryoverCreatedOtherWeek:s.data.carryoverTicketsCreatedOtherWeek,{labels:h,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:_,backgroundColor:ae=>{const me=ae.chart,{ctx:De,chartArea:Ie}=me;return g(De,Ie,J.carryover)},borderColor:J.carryover,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryover,pointBackgroundColor:J.carryover,datalabels:{...l,anchor:"end",align:"top",offset:4,color:J.carryover,borderColor:J.carryover}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:B,backgroundColor:J.carryoverLight,borderColor:J.carryoverLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:J.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryoverLight,pointBackgroundColor:J.carryoverLight,datalabels:{...l,anchor:"end",align:"top",offset:6,color:J.carryoverLight,borderColor:J.carryoverLight}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π)",data:re,backgroundColor:J.warning,borderColor:J.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:J.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.warning,pointBackgroundColor:J.warning,datalabels:{...l,anchor:"end",align:"top",offset:6,color:J.warning,borderColor:J.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –Ω–µ–¥–µ–ª—è–º–∏)",data:le,backgroundColor:J.carryoverDark,borderColor:J.carryoverDark,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:J.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryoverDark,pointBackgroundColor:J.carryoverDark,datalabels:{...l,anchor:"end",align:"top",offset:6,color:J.carryoverDark,borderColor:J.carryoverDark}}]}}),v=M(()=>{const h=s.meta?.weeks||[],_=h.length>0?h.map(Fe=>`–ù–µ–¥–µ–ª—è ${Fe.weekNumber}`):[s.meta?.weekNumber?`–ù–µ–¥–µ–ª—è ${s.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"],B=Array.isArray(s.data.series?.new)&&s.data.series.new.length>0?s.data.series.new:[s.data.newTickets??0],re=Array.isArray(s.data.series?.closed)&&s.data.series.closed.length>0?s.data.series.closed:[s.data.closedTickets??0],le=Array.isArray(s.data.series?.closedCreatedThisWeek)&&s.data.series.closedCreatedThisWeek.length>0?s.data.series.closedCreatedThisWeek:[s.data.closedTicketsCreatedThisWeek??0],ae=Array.isArray(s.data.series?.closedCreatedOtherWeek)&&s.data.series.closedCreatedOtherWeek.length>0?s.data.series.closedCreatedOtherWeek:[s.data.closedTicketsCreatedOtherWeek??0],me=Array.isArray(s.data.series?.carryover)&&s.data.series.carryover.length>0?s.data.series.carryover:[s.data.carryoverTickets??0],De=Array.isArray(s.data.series?.carryoverCreatedThisWeek)&&s.data.series.carryoverCreatedThisWeek.length>0?s.data.series.carryoverCreatedThisWeek:[s.data.carryoverTicketsCreatedThisWeek??0],Ie=Array.isArray(s.data.series?.carryoverCreatedPreviousWeek)&&s.data.series.carryoverCreatedPreviousWeek.length>0?s.data.series.carryoverCreatedPreviousWeek:[s.data.carryoverTicketsCreatedPreviousWeek??0],xe=Array.isArray(s.data.series?.carryoverCreatedOlder)&&s.data.series.carryoverCreatedOlder.length>0?s.data.series.carryoverCreatedOlder:[s.data.carryoverTicketsCreatedOlder??0];return Array.isArray(s.data.series?.carryoverCreatedOtherWeek)&&s.data.series.carryoverCreatedOtherWeek.length>0?s.data.series.carryoverCreatedOtherWeek:s.data.carryoverTicketsCreatedOtherWeek,{labels:_,datasets:[{label:"–ù–æ–≤—ã–µ",data:B,backgroundColor:J.primary,borderColor:J.primary,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.primary,pointBackgroundColor:J.primary,datalabels:{...l,anchor:"end",align:"top",offset:10,color:J.primary,borderColor:J.primary}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:re,backgroundColor:J.success,borderColor:J.success,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.success,pointBackgroundColor:J.success,datalabels:{...l,anchor:"start",align:"bottom",offset:10,color:J.success,borderColor:J.success}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:le,backgroundColor:J.successLight,borderColor:J.successLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:J.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.successLight,pointBackgroundColor:J.successLight,datalabels:{...l,anchor:"end",align:"bottom",offset:8,color:J.successLight,borderColor:J.successLight}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:ae,backgroundColor:J.warning,borderColor:J.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:J.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.warning,pointBackgroundColor:J.warning,datalabels:{...l,anchor:"end",align:"bottom",offset:8,color:J.warning,borderColor:J.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:me,backgroundColor:J.carryover,borderColor:J.carryover,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryover,pointBackgroundColor:J.carryover,datalabels:{...l,anchor:"end",align:"top",offset:4,color:J.carryover,borderColor:J.carryover}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:De,backgroundColor:J.carryoverLight,borderColor:J.carryoverLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:J.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryoverLight,pointBackgroundColor:J.carryoverLight,datalabels:{...l,anchor:"end",align:"top",offset:6,color:J.carryoverLight,borderColor:J.carryoverLight}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π)",data:Ie,backgroundColor:J.warning,borderColor:J.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:J.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.warning,pointBackgroundColor:J.warning,datalabels:{...l,anchor:"end",align:"top",offset:6,color:J.warning,borderColor:J.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –Ω–µ–¥–µ–ª—è–º–∏)",data:xe,backgroundColor:J.carryoverDark,borderColor:J.carryoverDark,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:J.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryoverDark,pointBackgroundColor:J.carryoverDark,datalabels:{...l,anchor:"end",align:"top",offset:6,color:J.carryoverDark,borderColor:J.carryoverDark}}]}}),y=M(()=>({labels:["–ù–æ–≤—ã–µ","–ó–∞–∫—Ä—ã—Ç—ã–µ","–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ"],datasets:[{data:[s.data.newTickets??0,s.data.closedTickets??0,s.data.carryoverTickets??0],backgroundColor:[J.primary,J.success,J.carryover],borderWidth:1}]})),k=M(()=>{switch(n.value){case"line":return yt;case"bar":return va;case"doughnut":return fa;default:return yt}}),S=M(()=>n.value==="doughnut"?y.value:v.value),C=h=>{if(!h)return"‚Äî";try{return new Date(h).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return h}};function f(h){return h==null||isNaN(h)?"0":h>=1e3?h.toLocaleString("ru-RU"):h.toString()}function w(h){const _=h%10,B=h%100;return B>=11&&B<=14?"—Ç–∏–∫–µ—Ç–æ–≤":_===1?"—Ç–∏–∫–µ—Ç":_>=2&&_<=4?"—Ç–∏–∫–µ—Ç–∞":"—Ç–∏–∫–µ—Ç–æ–≤"}const $=M(()=>({responsive:!0,maintainAspectRatio:!1,resizeDelay:0,animation:{duration:800,easing:"easeOutQuart"},interaction:{intersect:!1,mode:"index"},plugins:{datalabels:{...l,anchor:"end",align:"top"},tooltip:{enabled:!0,backgroundColor:"rgba(255, 255, 255, 0.98)",titleColor:"#111827",bodyColor:"#374151",borderColor:"#e5e7eb",borderWidth:1,cornerRadius:8,padding:16,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},displayColors:!0,boxPadding:6,usePointStyle:!0,animation:{duration:300,easing:"easeOutQuart"},callbacks:{title:h=>{if(!h||h.length===0)return"";const _=h[0]?.dataIndex,B=s.meta?.weeks||[];if(B.length>0&&_!==void 0&&B[_]){const me=B[_];return`–ù–µ–¥–µ–ª—è ${me.weekNumber} (${C(me.weekStartUtc)} ‚Äî ${C(me.weekEndUtc)})`}const re=s.meta?.weekNumber,le=s.meta?.weekStartUtc,ae=s.meta?.weekEndUtc;return re&&le&&ae?`–ù–µ–¥–µ–ª—è ${re} (${C(le)} ‚Äî ${C(ae)})`:h[0]?.label||""},label:h=>{const _=h.parsed.y,B=h.dataset.label||"";if(_==null||isNaN(_))return`${B}: 0 —Ç–∏–∫–µ—Ç–æ–≤`;const re=f(_),le=w(_);return`${B}: ${re} ${le}`}}},legend:{position:"bottom",labels:{font:{size:13,weight:"500"},padding:12,boxWidth:18,boxHeight:12,usePointStyle:!0,pointStyle:"circle",generateLabels:h=>Je.defaults.plugins.legend.labels.generateLabels(h).map((B,re)=>{const le=h.data.datasets[re],ae=h.getDatasetMeta(re),me=le.borderDash&&Array.isArray(le.borderDash)&&le.borderDash.length>0||le.borderWidth===2||le.fill===!1;return ae.hidden?(B.fontColor="#9ca3af",B.textDecoration="line-through",B.opacity=.5):me?B.fontColor="#6b7280":B.fontColor="#111827",B})},onClick:(h,_)=>{const B=_.datasetIndex;if(B==null){console.warn("[Legend] Invalid datasetIndex:",B);return}const re=h.chart;if(!re){console.warn("[Legend] Chart not found");return}const le=re.getDatasetMeta(B);if(!le){console.warn("[Legend] Dataset meta not found for index:",B);return}le.hidden=!le.hidden,re.update("active")},onHover:(h,_)=>{h.native&&h.native.target&&(h.native.target.style.cursor="pointer")},onLeave:(h,_)=>{h.native&&h.native.target&&(h.native.target.style.cursor="default")}}},scales:n.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10,color:"#374151",callback:h=>h==null||isNaN(h)?"0":f(h)},title:{display:!1},grid:{color:h=>{if(!h||!h.tick||h.tick.value===void 0)return"#e5e7eb";const _=h.tick.value;return isNaN(_)||!isFinite(_)?"#e5e7eb":_===0||_%5===0?"#d1d5db":"#e5e7eb"},lineWidth:h=>{if(!h||!h.tick||h.tick.value===void 0)return 1;const _=h.tick.value;return isNaN(_)||!isFinite(_)?1:_===0||_%5===0?1.5:1}}},x:{ticks:{maxRotation:45,minRotation:45,font:{size:14},padding:10,color:"#374151"},title:{display:!1},grid:{color:"#e5e7eb",lineWidth:1}}}})),W=M(()=>{if(s.data?.series){const h=s.data.series,_=Math.max((Array.isArray(h.new)?h.new.length:0)-1,(Array.isArray(h.closed)?h.closed.length:0)-1,(Array.isArray(h.closedCreatedThisWeek)?h.closedCreatedThisWeek.length:0)-1,(Array.isArray(h.closedCreatedOtherWeek)?h.closedCreatedOtherWeek.length:0)-1,(Array.isArray(h.carryover)?h.carryover.length:0)-1,(Array.isArray(h.carryoverCreatedThisWeek)?h.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(h.carryoverCreatedPreviousWeek)?h.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(h.carryoverCreatedOlder)?h.carryoverCreatedOlder.length:0)-1,(Array.isArray(h.carryoverCreatedOtherWeek)?h.carryoverCreatedOtherWeek.length:0)-1,-1);if(_>=0){const B={newTickets:Array.isArray(h.new)&&h.new[_]!==void 0?h.new[_]:0,closedTickets:Array.isArray(h.closed)&&h.closed[_]!==void 0?h.closed[_]:0,closedTicketsCreatedThisWeek:Array.isArray(h.closedCreatedThisWeek)&&h.closedCreatedThisWeek[_]!==void 0?h.closedCreatedThisWeek[_]:0,closedTicketsCreatedOtherWeek:Array.isArray(h.closedCreatedOtherWeek)&&h.closedCreatedOtherWeek[_]!==void 0?h.closedCreatedOtherWeek[_]:0,carryoverTickets:Array.isArray(h.carryover)&&h.carryover[_]!==void 0?h.carryover[_]:0,carryoverTicketsCreatedThisWeek:Array.isArray(h.carryoverCreatedThisWeek)&&h.carryoverCreatedThisWeek[_]!==void 0?h.carryoverCreatedThisWeek[_]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(h.carryoverCreatedPreviousWeek)&&h.carryoverCreatedPreviousWeek[_]!==void 0?h.carryoverCreatedPreviousWeek[_]:0,carryoverTicketsCreatedOlder:Array.isArray(h.carryoverCreatedOlder)&&h.carryoverCreatedOlder[_]!==void 0?h.carryoverCreatedOlder[_]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(h.carryoverCreatedOtherWeek)&&h.carryoverCreatedOtherWeek[_]!==void 0?h.carryoverCreatedOtherWeek[_]:0};if(B.carryoverTickets>0&&console.log("[DEBUG currentWeekData]",{total:B.carryoverTickets,thisWeek:B.carryoverTicketsCreatedThisWeek,previousWeek:B.carryoverTicketsCreatedPreviousWeek,older:B.carryoverTicketsCreatedOlder,otherWeek:B.carryoverTicketsCreatedOtherWeek,sum:B.carryoverTicketsCreatedThisWeek+B.carryoverTicketsCreatedPreviousWeek+B.carryoverTicketsCreatedOlder,lastIndex:_,series:{carryoverCreatedPreviousWeek:h.carryoverCreatedPreviousWeek,carryoverCreatedOlder:h.carryoverCreatedOlder,carryoverCreatedPreviousWeekLength:h.carryoverCreatedPreviousWeek?.length,carryoverCreatedOlderLength:h.carryoverCreatedOlder?.length,carryoverCreatedPreviousWeekLast:h.carryoverCreatedPreviousWeek?.[_],carryoverCreatedOlderLast:h.carryoverCreatedOlder?.[_]},currentWeek:s.data.currentWeek,data:{carryoverTicketsCreatedPreviousWeek:s.data.carryoverTicketsCreatedPreviousWeek,carryoverTicketsCreatedOlder:s.data.carryoverTicketsCreatedOlder}}),B.newTickets>0||B.closedTickets>0||B.carryoverTickets>0)return B}}if(s.data?.currentWeek&&typeof s.data.currentWeek=="object"){const h=s.data.currentWeek;if((h.newTickets??0)>0||(h.closedTickets??0)>0||(h.carryoverTickets??0)>0)return h}if(s.data?.weeksData&&Array.isArray(s.data.weeksData)&&s.data.weeksData.length>0){const h=s.data.weeksData[s.data.weeksData.length-1];if((h.newTickets??0)>0||(h.closedTickets??0)>0||(h.carryoverTickets??0)>0)return h}if(s.data?.series){const h=s.data.series,_=Math.max((Array.isArray(h.new)?h.new.length:0)-1,(Array.isArray(h.closed)?h.closed.length:0)-1,(Array.isArray(h.carryover)?h.carryover.length:0)-1,-1);if(_>=0)return{newTickets:Array.isArray(h.new)&&h.new[_]!==void 0?h.new[_]:0,closedTickets:Array.isArray(h.closed)&&h.closed[_]!==void 0?h.closed[_]:0,closedTicketsCreatedThisWeek:Array.isArray(h.closedCreatedThisWeek)&&h.closedCreatedThisWeek[_]!==void 0?h.closedCreatedThisWeek[_]:0,closedTicketsCreatedOtherWeek:Array.isArray(h.closedCreatedOtherWeek)&&h.closedCreatedOtherWeek[_]!==void 0?h.closedCreatedOtherWeek[_]:0,carryoverTickets:Array.isArray(h.carryover)&&h.carryover[_]!==void 0?h.carryover[_]:0,carryoverTicketsCreatedThisWeek:Array.isArray(h.carryoverCreatedThisWeek)&&h.carryoverCreatedThisWeek[_]!==void 0?h.carryoverCreatedThisWeek[_]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(h.carryoverCreatedPreviousWeek)&&h.carryoverCreatedPreviousWeek[_]!==void 0?h.carryoverCreatedPreviousWeek[_]:0,carryoverTicketsCreatedOlder:Array.isArray(h.carryoverCreatedOlder)&&h.carryoverCreatedOlder[_]!==void 0?h.carryoverCreatedOlder[_]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(h.carryoverCreatedOtherWeek)&&h.carryoverCreatedOtherWeek[_]!==void 0?h.carryoverCreatedOtherWeek[_]:0}}return s.data||{}}),L=M(()=>{const h=s.meta?.weeks||[];return h.length>0?h[h.length-1]:{weekNumber:s.meta?.currentWeek?.weekNumber??s.meta?.weekNumber??null,weekStartUtc:s.meta?.currentWeek?.weekStartUtc??s.meta?.weekStartUtc??null,weekEndUtc:s.meta?.currentWeek?.weekEndUtc??s.meta?.weekEndUtc??null}}),D=M(()=>{if(s.data?.series){const h=s.data.series,_=Math.max((Array.isArray(h.new)?h.new.length:0)-1,(Array.isArray(h.closed)?h.closed.length:0)-1,(Array.isArray(h.closedCreatedThisWeek)?h.closedCreatedThisWeek.length:0)-1,(Array.isArray(h.closedCreatedOtherWeek)?h.closedCreatedOtherWeek.length:0)-1,(Array.isArray(h.carryover)?h.carryover.length:0)-1,(Array.isArray(h.carryoverCreatedThisWeek)?h.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(h.carryoverCreatedPreviousWeek)?h.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(h.carryoverCreatedOlder)?h.carryoverCreatedOlder.length:0)-1,(Array.isArray(h.carryoverCreatedOtherWeek)?h.carryoverCreatedOtherWeek.length:0)-1,-1);if(_>=1){const B=_-1,re=s.meta?.weeks?.[B],le={weekNumber:re?.weekNumber??null,weekStartUtc:re?.weekStartUtc??null,weekEndUtc:re?.weekEndUtc??null,newTickets:Array.isArray(h.new)&&h.new[B]!==void 0?h.new[B]:0,closedTickets:Array.isArray(h.closed)&&h.closed[B]!==void 0?h.closed[B]:0,closedTicketsCreatedThisWeek:Array.isArray(h.closedCreatedThisWeek)&&h.closedCreatedThisWeek[B]!==void 0?h.closedCreatedThisWeek[B]:0,closedTicketsCreatedOtherWeek:Array.isArray(h.closedCreatedOtherWeek)&&h.closedCreatedOtherWeek[B]!==void 0?h.closedCreatedOtherWeek[B]:0,carryoverTickets:Array.isArray(h.carryover)&&h.carryover[B]!==void 0?h.carryover[B]:0,carryoverTicketsCreatedThisWeek:Array.isArray(h.carryoverCreatedThisWeek)&&h.carryoverCreatedThisWeek[B]!==void 0?h.carryoverCreatedThisWeek[B]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(h.carryoverCreatedPreviousWeek)&&h.carryoverCreatedPreviousWeek[B]!==void 0?h.carryoverCreatedPreviousWeek[B]:0,carryoverTicketsCreatedOlder:Array.isArray(h.carryoverCreatedOlder)&&h.carryoverCreatedOlder[B]!==void 0?h.carryoverCreatedOlder[B]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(h.carryoverCreatedOtherWeek)&&h.carryoverCreatedOtherWeek[B]!==void 0?h.carryoverCreatedOtherWeek[B]:0};if(le.newTickets>0||le.closedTickets>0||le.carryoverTickets>0)return le}}if(s.data?.weeksData&&Array.isArray(s.data.weeksData)&&s.data.weeksData.length>=2){const h=s.data.weeksData.length-2,_=s.data.weeksData[h],B=s.meta?.weeks?.[h];if((_.newTickets??0)>0||(_.closedTickets??0)>0||(_.carryoverTickets??0)>0)return{weekNumber:_.weekNumber??B?.weekNumber??null,weekStartUtc:B?.weekStartUtc??null,weekEndUtc:B?.weekEndUtc??null,newTickets:_.newTickets??0,closedTickets:_.closedTickets??0,closedTicketsCreatedThisWeek:_.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:_.closedTicketsCreatedOtherWeek??0,carryoverTickets:_.carryoverTickets??0,carryoverTicketsCreatedThisWeek:_.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:_.carryoverTicketsCreatedOtherWeek??0}}if(s.data?.series){const h=s.data.series,_=Math.max((Array.isArray(h.new)?h.new.length:0)-1,(Array.isArray(h.closed)?h.closed.length:0)-1,(Array.isArray(h.carryover)?h.carryover.length:0)-1,-1);if(_>=1){const B=_-1,re=s.meta?.weeks?.[B];return{weekNumber:re?.weekNumber??null,weekStartUtc:re?.weekStartUtc??null,weekEndUtc:re?.weekEndUtc??null,newTickets:Array.isArray(h.new)&&h.new[B]!==void 0?h.new[B]:0,closedTickets:Array.isArray(h.closed)&&h.closed[B]!==void 0?h.closed[B]:0,closedTicketsCreatedThisWeek:Array.isArray(h.closedCreatedThisWeek)&&h.closedCreatedThisWeek[B]!==void 0?h.closedCreatedThisWeek[B]:0,closedTicketsCreatedOtherWeek:Array.isArray(h.closedCreatedOtherWeek)&&h.closedCreatedOtherWeek[B]!==void 0?h.closedCreatedOtherWeek[B]:0,carryoverTickets:Array.isArray(h.carryover)&&h.carryover[B]!==void 0?h.carryover[B]:0,carryoverTicketsCreatedThisWeek:Array.isArray(h.carryoverCreatedThisWeek)&&h.carryoverCreatedThisWeek[B]!==void 0?h.carryoverCreatedThisWeek[B]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(h.carryoverCreatedPreviousWeek)&&h.carryoverCreatedPreviousWeek[B]!==void 0?h.carryoverCreatedPreviousWeek[B]:0,carryoverTicketsCreatedOlder:Array.isArray(h.carryoverCreatedOlder)&&h.carryoverCreatedOlder[B]!==void 0?h.carryoverCreatedOlder[B]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(h.carryoverCreatedOtherWeek)&&h.carryoverCreatedOtherWeek[B]!==void 0?h.carryoverCreatedOtherWeek[B]:0}}}return null}),E=M(()=>{const h=s.data?.stagesByWeek;return Array.isArray(h)?h:null}),x=M(()=>{const h=E.value;if(h&&h.length>0){const _=h.length-1,B=h[_];if(Array.isArray(B))return B}return s.data?.stages??[]}),R=M(()=>{const h=E.value;if(h&&h.length>=2){const _=h.length-2,B=h[_];if(Array.isArray(B))return B}return[]}),U=M(()=>D.value?.weekNumber?`–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–µ–¥–µ–ª–∏ ${D.value.weekNumber}`:"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö");function G(h,_){if(typeof h!="number"||isNaN(h)||_==null||typeof _!="number"||isNaN(_)||_===0)return null;if(h===_)return 0;const B=(h-_)/_*100;return!isFinite(B)||isNaN(B)?null:B}function q(h){return h==null||isNaN(h)?"":`${h>=0?"+":""}${h.toFixed(1)}%`}const oe=M(()=>{if(s.data?.series){const h=s.data.series,_=Math.max((Array.isArray(h.new)?h.new.length:0)-1,(Array.isArray(h.closed)?h.closed.length:0)-1,(Array.isArray(h.carryover)?h.carryover.length:0)-1,-1);if(_>=2){const B=_-2;return{weekNumber:s.meta?.weeks?.[B]?.weekNumber??null,newTickets:Array.isArray(h.new)&&h.new[B]!==void 0?h.new[B]:0,closedTickets:Array.isArray(h.closed)&&h.closed[B]!==void 0?h.closed[B]:0,carryoverTickets:Array.isArray(h.carryover)&&h.carryover[B]!==void 0?h.carryover[B]:0}}}return null}),Y=M(()=>{const h=W.value,_=D.value;return!h||!_?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:G(h.newTickets??0,_.newTickets??0),closedTickets:G(h.closedTickets??0,_.closedTickets??0),carryoverTickets:G(h.carryoverTickets??0,_.carryoverTickets??0)}}),H=M(()=>{const h=D.value,_=oe.value;return!h||!_?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:G(h.newTickets??0,_.newTickets??0),closedTickets:G(h.closedTickets??0,_.closedTickets??0),carryoverTickets:G(h.carryoverTickets??0,_.carryoverTickets??0)}});function Z(h,_){if(!h||!_)return"";try{const B=new Date(h),re=new Date(_),le=B.getUTCDate(),ae=B.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),me=B.getUTCFullYear(),De=re.getUTCDate(),Ie=re.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),xe=re.getUTCFullYear();return me===xe&&ae===Ie?`${le} ‚Äî ${De} ${ae}`:me===xe?`${le} ${ae} ‚Äî ${De} ${Ie}`:`${le} ${ae} ${me} ‚Äî ${De} ${Ie} ${xe}`}catch(B){return console.error("[formatWeekDates] Error:",B),""}}const fe=h=>{const _=W.value,B=_?.newTickets??0,re=_?.closedTickets??0,le=_?.carryoverTickets??0,ae=L.value;h==="new"&&B>0?t("open-stages",{weekNumber:ae.weekNumber,weekStartUtc:ae.weekStartUtc,weekEndUtc:ae.weekEndUtc}):h==="closed"&&re>0?t("open-responsible",{weekNumber:ae.weekNumber,weekStartUtc:ae.weekStartUtc,weekEndUtc:ae.weekEndUtc}):h==="carryover"&&le>0&&t("open-carryover",{weekNumber:ae.weekNumber,weekStartUtc:ae.weekStartUtc,weekEndUtc:ae.weekEndUtc})},P=h=>{const _=D.value;if(!_)return;const B=_?.newTickets??0,re=_?.closedTickets??0,le=_?.carryoverTickets??0,ae=r.value;ae&&(h==="new"&&B>0?t("open-stages",{weekNumber:ae.weekNumber,weekStartUtc:ae.weekStartUtc,weekEndUtc:ae.weekEndUtc}):h==="closed"&&re>0?t("open-responsible",{weekNumber:ae.weekNumber,weekStartUtc:ae.weekStartUtc,weekEndUtc:ae.weekEndUtc}):h==="carryover"&&le>0&&t("open-carryover",{weekNumber:ae.weekNumber,weekStartUtc:ae.weekStartUtc,weekEndUtc:ae.weekEndUtc}))};return(h,_)=>(c(),u("div",Em,[a("header",Am,[a("div",null,[_[6]||(_[6]=a("h2",{class:"ac-chart__title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),a("p",$m," –ù–µ–¥–µ–ª—è "+m(o.meta?.currentWeek?.weekNumber??o.meta?.weekNumber??"‚Äî")+" ¬∑ "+m((o.meta?.currentWeek?.weekStartUtc??o.meta?.weekStartUtc)||"‚Äî")+" ‚Äî "+m((o.meta?.currentWeek?.weekEndUtc??o.meta?.weekEndUtc)||"‚Äî")+" (UTC) ",1)]),a("div",Im,[a("div",Mm,[(c(),u(ee,null,te(i,B=>a("button",{key:B.value,class:X(["chart-type-btn",{active:n.value===B.value}]),onClick:re=>n.value=B.value},[a("span",xm,m(B.icon),1),a("span",Lm,m(B.label),1)],10,Nm)),64))])])]),a("section",Pm,[a("div",Om,[a("h3",Rm,[_[7]||(_[7]=a("span",{class:"summary-week-block__title-text"},"–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)),a("span",Bm," –ù–µ–¥–µ–ª—è "+m(L.value.weekNumber??"‚Äî"),1),L.value.weekStartUtc?(c(),u("span",Um,m(Z(L.value.weekStartUtc,L.value.weekEndUtc)),1)):A("",!0)]),a("div",Wm,[a("div",{class:"summary-card summary-card--new",onClick:_[0]||(_[0]=B=>fe("new"))},[_[8]||(_[8]=a("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),a("div",Fm,[a("div",Hm,m(W.value?.newTickets??0),1),Y.value.newTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",Y.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${D.value?.weekNumber??"‚Äî"}): ${q(Y.value.newTickets)}`},[a("span",Vm,m(Y.value.newTickets>=0?"‚Üë":"‚Üì"),1),a("span",zm,m(q(Y.value.newTickets)),1),a("span",Gm,"–∫ –Ω–µ–¥–µ–ª–µ "+m(D.value?.weekNumber??"‚Äî"),1)],10,jm)):A("",!0)])]),a("div",{class:"summary-card summary-card--closed-breakdown",onClick:_[1]||(_[1]=B=>fe("closed"))},[_[13]||(_[13]=a("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),a("div",Km,[a("div",qm,m(W.value?.closedTickets??0),1),Y.value.closedTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",Y.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${D.value?.weekNumber??"‚Äî"}): ${q(Y.value.closedTickets)}`},[a("span",Xm,m(Y.value.closedTickets>=0?"‚Üë":"‚Üì"),1),a("span",Jm,m(q(Y.value.closedTickets)),1),a("span",Zm,"–∫ –Ω–µ–¥–µ–ª–µ "+m(D.value?.weekNumber??"‚Äî"),1)],10,Ym)):A("",!0)]),a("div",Qm,[a("div",eh,[_[9]||(_[9]=a("span",{class:"breakdown-item__icon"},"‚úì",-1)),a("span",th,m(W.value?.closedTicketsCreatedThisWeek??0),1),_[10]||(_[10]=a("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),a("div",sh,[_[11]||(_[11]=a("span",{class:"breakdown-item__icon"},"‚Üª",-1)),a("span",ah,m(W.value?.closedTicketsCreatedOtherWeek??0),1),_[12]||(_[12]=a("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),a("div",{class:"summary-card summary-card--carryover-breakdown",onClick:_[2]||(_[2]=B=>fe("carryover"))},[_[20]||(_[20]=a("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),a("div",oh,[a("div",nh,m(W.value?.carryoverTickets??0),1),Y.value.carryoverTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",Y.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${D.value?.weekNumber??"‚Äî"}): ${q(Y.value.carryoverTickets)}`},[a("span",ih,m(Y.value.carryoverTickets>=0?"‚Üë":"‚Üì"),1),a("span",lh,m(q(Y.value.carryoverTickets)),1),a("span",ch,"–∫ –Ω–µ–¥–µ–ª–µ "+m(D.value?.weekNumber??"‚Äî"),1)],10,rh)):A("",!0)]),a("div",dh,[a("div",uh,[_[14]||(_[14]=a("span",{class:"breakdown-item__icon"},"‚úì",-1)),a("span",gh,m(W.value?.carryoverTicketsCreatedThisWeek??0),1),_[15]||(_[15]=a("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),a("div",mh,[_[16]||(_[16]=a("span",{class:"breakdown-item__icon"},"‚Üª",-1)),a("span",hh,m(W.value?.carryoverTicketsCreatedPreviousWeek??0),1),_[17]||(_[17]=a("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏",-1))]),a("div",fh,[_[18]||(_[18]=a("span",{class:"breakdown-item__icon"},"‚Üª",-1)),a("span",vh,m(W.value?.carryoverTicketsCreatedOlder??0),1),_[19]||(_[19]=a("span",{class:"breakdown-item__label"},"–æ—Å—Ç–∞–ª—å–Ω—ã–µ",-1))])])]),a("div",ph,[_[21]||(_[21]=a("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),a("div",yh,[(c(!0),u(ee,null,te(x.value,B=>(c(),u("span",{key:B.stageId,class:"stage-tag"},m(B.stageName||B.stageId)+" ‚Äî "+m(B.count),1))),128)),!x.value||x.value.length===0?(c(),u("span",kh," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):A("",!0)])])])]),D.value?(c(),u("div",bh,[..._[22]||(_[22]=[a("div",{class:"summary-week-divider__line"},null,-1),a("div",{class:"summary-week-divider__label"},"–ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)])])):A("",!0),D.value?(c(),u("div",_h,[a("h3",wh,[_[23]||(_[23]=a("span",{class:"summary-week-block__title-text"},"–ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)),a("span",Ch," –ù–µ–¥–µ–ª—è "+m(D.value.weekNumber??"‚Äî"),1),D.value.weekStartUtc?(c(),u("span",Th,m(Z(D.value.weekStartUtc,D.value.weekEndUtc)),1)):A("",!0)]),a("div",Sh,[a("div",{class:"summary-card summary-card--new summary-card--previous summary-card--clickable",onClick:_[3]||(_[3]=B=>P("new"))},[_[24]||(_[24]=a("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),a("div",Dh,[a("div",Eh,[a("div",Ah,[a("div",$h,m(D.value?.newTickets??0),1),a("span",Ih,"–ù–µ–¥–µ–ª—è "+m(D.value?.weekNumber??"‚Äî"),1)]),a("div",Mh,[a("div",Nh,m(oe.value?.newTickets??0),1),a("span",xh,"–ù–µ–¥–µ–ª—è "+m(oe.value?.weekNumber??"‚Äî"),1)])]),H.value.newTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",H.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${oe.value?.weekNumber??"‚Äî"}): ${q(H.value.newTickets)}`},[a("span",Ph,m(H.value.newTickets>=0?"‚Üë":"‚Üì"),1),a("span",Oh,m(q(H.value.newTickets)),1),a("span",Rh,"–∫ –Ω–µ–¥–µ–ª–µ "+m(oe.value?.weekNumber??"‚Äî"),1)],10,Lh)):A("",!0)])]),a("div",{class:"summary-card summary-card--closed-breakdown summary-card--previous summary-card--clickable",onClick:_[4]||(_[4]=B=>P("closed"))},[_[29]||(_[29]=a("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),a("div",Bh,[a("div",Uh,[a("div",Wh,[a("div",Fh,m(D.value?.closedTickets??0),1),a("span",Hh,"–ù–µ–¥–µ–ª—è "+m(D.value?.weekNumber??"‚Äî"),1)]),a("div",jh,[a("div",Vh,m(oe.value?.closedTickets??0),1),a("span",zh,"–ù–µ–¥–µ–ª—è "+m(oe.value?.weekNumber??"‚Äî"),1)])]),H.value.closedTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",H.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${oe.value?.weekNumber??"‚Äî"}): ${q(H.value.closedTickets)}`},[a("span",Kh,m(H.value.closedTickets>=0?"‚Üë":"‚Üì"),1),a("span",qh,m(q(H.value.closedTickets)),1),a("span",Yh,"–∫ –Ω–µ–¥–µ–ª–µ "+m(oe.value?.weekNumber??"‚Äî"),1)],10,Gh)):A("",!0)]),a("div",Xh,[a("div",Jh,[_[25]||(_[25]=a("span",{class:"breakdown-item__icon"},"‚úì",-1)),a("span",Zh,m(D.value?.closedTicketsCreatedThisWeek??0),1),_[26]||(_[26]=a("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),a("div",Qh,[_[27]||(_[27]=a("span",{class:"breakdown-item__icon"},"‚Üª",-1)),a("span",ef,m(D.value?.closedTicketsCreatedOtherWeek??0),1),_[28]||(_[28]=a("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),a("div",{class:"summary-card summary-card--carryover-breakdown summary-card--previous summary-card--clickable",onClick:_[5]||(_[5]=B=>P("carryover"))},[_[36]||(_[36]=a("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),a("div",tf,[a("div",sf,[a("div",af,[a("div",of,m(D.value?.carryoverTickets??0),1),a("span",nf,"–ù–µ–¥–µ–ª—è "+m(D.value?.weekNumber??"‚Äî"),1)]),a("div",rf,[a("div",lf,m(oe.value?.carryoverTickets??0),1),a("span",cf,"–ù–µ–¥–µ–ª—è "+m(oe.value?.weekNumber??"‚Äî"),1)])]),H.value.carryoverTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",H.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${oe.value?.weekNumber??"‚Äî"}): ${q(H.value.carryoverTickets)}`},[a("span",uf,m(H.value.carryoverTickets>=0?"‚Üë":"‚Üì"),1),a("span",gf,m(q(H.value.carryoverTickets)),1),a("span",mf,"–∫ –Ω–µ–¥–µ–ª–µ "+m(oe.value?.weekNumber??"‚Äî"),1)],10,df)):A("",!0)]),a("div",hf,[a("div",ff,[_[30]||(_[30]=a("span",{class:"breakdown-item__icon"},"‚úì",-1)),a("span",vf,m(D.value?.carryoverTicketsCreatedThisWeek??0),1),_[31]||(_[31]=a("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),a("div",pf,[_[32]||(_[32]=a("span",{class:"breakdown-item__icon"},"‚Üª",-1)),a("span",yf,m(D.value?.carryoverTicketsCreatedPreviousWeek??0),1),_[33]||(_[33]=a("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏",-1))]),a("div",kf,[_[34]||(_[34]=a("span",{class:"breakdown-item__icon"},"‚Üª",-1)),a("span",bf,m(D.value?.carryoverTicketsCreatedOlder??0),1),_[35]||(_[35]=a("span",{class:"breakdown-item__label"},"–æ—Å—Ç–∞–ª—å–Ω—ã–µ",-1))])])]),a("div",_f,[_[37]||(_[37]=a("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),a("div",wf,[(c(!0),u(ee,null,te(R.value,B=>(c(),u("span",{key:B.stageId,class:"stage-tag"},m(B.stageName||B.stageId)+" ‚Äî "+m(B.count),1))),128)),!R.value||R.value.length===0?(c(),u("span",Cf,m(U.value),1)):A("",!0)])])])])):A("",!0)]),a("div",Tf,[n.value==="line"?(c(),u("div",Sf,[a("div",Df,[_[38]||(_[38]=a("h3",{class:"chart-subtitle"},"–ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),a("div",Ef,[ne(Ue(yt),{data:p.value,options:$.value},null,8,["data","options"])])]),a("div",Af,[_[39]||(_[39]=a("h3",{class:"chart-subtitle"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",-1)),a("div",$f,[ne(Ue(yt),{data:T.value,options:$.value},null,8,["data","options"])])])])):(c(),he(wt(k.value),{key:1,data:S.value,options:$.value},null,8,["data","options"]))])]))}},Mf=de(If,[["__scopeId","data-v-3666e13a"]]),Nf={class:"summary-cards-months"},xf={class:"summary-card summary-card--new"},Lf={class:"card-content"},Pf={class:"card-main-value"},Of=["title"],Rf={class:"card-month-breakdown"},Bf={class:"month-name"},Uf={class:"month-value"},Wf={key:0,class:"month-item month-item--empty"},Ff={class:"summary-card summary-card--closed"},Hf={class:"card-content"},jf={class:"card-main-value"},Vf=["title"],zf={class:"card-month-breakdown-hierarchical"},Gf={class:"month-header"},Kf={class:"month-name"},qf={class:"month-value"},Yf={class:"month-breakdown"},Xf={class:"breakdown-item breakdown-this-week"},Jf={class:"breakdown-value"},Zf={class:"breakdown-item breakdown-other-week"},Qf={class:"breakdown-value"},ev={key:0,class:"month-item-hierarchical month-item--empty"},tv={class:"summary-card summary-card--carryover"},sv={class:"card-content"},av={class:"card-current-value"},ov={class:"current-value"},nv=["title"],rv={class:"card-month-breakdown"},iv={class:"month-name"},lv={class:"month-value"},cv={key:0,class:"month-item month-item--empty"},dv={class:"summary-card summary-card--stages"},uv={class:"card-content"},gv={class:"stages-list"},mv={class:"stage-icon"},hv={class:"stage-name"},fv={class:"stage-value"},vv={key:0,class:"stage-item stage-item--empty"},pv={__name:"SummaryCardsMonths",props:{data:{type:Object,required:!0,default:()=>({newTickets:0,newTicketsByMonth:[],closedTickets:0,closedTicketsByMonth:[],carryoverTickets:0,carryoverTicketsByMonth:[],stages:[]})}},setup(o){const e=o;function s(C){return C==null||isNaN(C)?"0":C>=1e6?(C/1e6).toFixed(1)+"M":C>=1e3?C.toLocaleString("ru-RU"):C.toString()}function t(C){return C==null||isNaN(C)?"":`${C>=0?"+":""}${C.toFixed(1)}%`}function r(C,f){if(typeof C!="number"||isNaN(C)||f==null||typeof f!="number"||isNaN(f)||f===0)return null;if(C===f)return 0;const w=(C-f)/f*100;return!isFinite(w)||isNaN(w)?null:w}const i=M(()=>e.data?.newTickets||0),n=M(()=>s(i.value)),l=M(()=>e.data?.newTicketsByMonth||[]),d=M(()=>e.data?.closedTicketsByMonth||[]),g=M(()=>e.data?.carryoverTicketsByMonth||[]),p=M(()=>{const C=g.value;return C.length===0?0:C[C.length-1]?.count||0}),T=M(()=>{const C=typeof e.data?.newTickets=="number"?e.data.newTickets:parseInt(e.data?.newTickets)||0,f=e.data?.previousPeriodData?.newTickets;return r(C,f)}),v=M(()=>{const C=typeof e.data?.closedTickets=="number"?e.data.closedTickets:parseInt(e.data?.closedTickets)||0,f=e.data?.previousPeriodData?.closedTickets;return r(C,f)}),y=M(()=>{const C=p.value,f=g.value,w=f.length>0?f[0]?.count||0:null;return r(C,w)});function k(C){return{"DT140_12:SUCCESS":"stage-success","DT140_12:FAIL":"stage-fail","DT140_12:UC_0GBU8Z":"stage-other"}[C]||""}function S(C){return{"DT140_12:SUCCESS":"‚úì","DT140_12:FAIL":"‚úó","DT140_12:UC_0GBU8Z":"‚ö†"}[C]||"‚Ä¢"}return(C,f)=>(c(),u("div",Nf,[a("div",xf,[f[0]||(f[0]=a("h3",{class:"card-title"},"–ù–æ–≤—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥",-1)),a("div",Lf,[a("div",Pf,[ce(m(n.value)+" ",1),T.value!==null?(c(),u("span",{key:0,class:X(["percentage-badge",T.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${t(T.value)}`},m(t(T.value)),11,Of)):A("",!0)]),a("div",Rf,[(c(!0),u(ee,null,te(l.value,w=>(c(),u("div",{key:`new-${w.month}`,class:"month-item"},[a("span",Bf,m(w.monthName)+":",1),a("span",Uf,m(s(w.count)),1)]))),128)),l.value.length===0?(c(),u("div",Wf," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):A("",!0)])])]),a("div",Ff,[f[5]||(f[5]=a("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –≤—Å–µ–≥–æ",-1)),a("div",Hf,[a("div",jf,[ce(m(s(o.data.closedTickets||0))+" ",1),v.value!==null?(c(),u("span",{key:0,class:X(["percentage-badge",v.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${t(v.value)}`},m(t(v.value)),11,Vf)):A("",!0)]),a("div",zf,[(c(!0),u(ee,null,te(d.value,w=>(c(),u("div",{key:`closed-${w.month}`,class:"month-item-hierarchical"},[a("div",Gf,[a("span",Kf,m(w.monthName)+":",1),a("span",qf,m(s(w.count||0)),1)]),a("div",Yf,[a("div",Xf,[f[1]||(f[1]=a("span",{class:"breakdown-icon"},"‚úì",-1)),f[2]||(f[2]=a("span",{class:"breakdown-label"},"—ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞:",-1)),a("span",Jf,m(s(w.closedCreatedThisWeek||0)),1)]),a("div",Zf,[f[3]||(f[3]=a("span",{class:"breakdown-icon"},"‚Üª",-1)),f[4]||(f[4]=a("span",{class:"breakdown-label"},"–¥—Ä—É–≥–æ–≥–æ –º–µ—Å—è—Ü–∞:",-1)),a("span",Qf,m(s(w.closedCreatedOtherWeek||0)),1)])])]))),128)),d.value.length===0?(c(),u("div",ev," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):A("",!0)])])]),a("div",tv,[f[7]||(f[7]=a("h3",{class:"card-title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ –≤—Å–µ–≥–æ",-1)),f[8]||(f[8]=a("p",{class:"card-hint"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ –≤ —Ç—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–∞–±–æ—á–∏—Ö —Å—Ç–∞–¥–∏—è—Ö (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)",-1)),a("div",sv,[a("div",av,[f[6]||(f[6]=a("span",{class:"current-label"},"–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:",-1)),a("span",ov,[ce(m(s(p.value))+" ",1),y.value!==null?(c(),u("span",{key:0,class:X(["percentage-badge",y.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${t(y.value)}`},m(t(y.value)),11,nv)):A("",!0)])]),a("div",rv,[(c(!0),u(ee,null,te(g.value,w=>(c(),u("div",{key:`carryover-${w.month}`,class:"month-item"},[a("span",iv,m(w.monthName)+":",1),a("span",lv,m(s(w.count||0)),1)]))),128)),g.value.length===0?(c(),u("div",cv," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):A("",!0)])])]),a("div",dv,[f[10]||(f[10]=a("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),a("div",uv,[a("div",gv,[(c(!0),u(ee,null,te(o.data.stages||[],w=>(c(),u("div",{key:w.stageId,class:X(["stage-item",k(w.stageId)])},[a("span",mv,m(S(w.stageId)),1),a("span",hv,m(w.stageName||w.stageId)+":",1),a("span",fv,m(s(w.count||0)),1)],2))),128)),!o.data.stages||o.data.stages.length===0?(c(),u("div",vv,[...f[9]||(f[9]=[a("span",{class:"stage-name"},"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö",-1)])])):A("",!0)])])])]))}},yv=de(pv,[["__scopeId","data-v-15d88b90"]]),kv={class:"line-chart-months"},bv={class:"chart-section"},_v={class:"chart-title"},wv={key:0,class:"chart-period"},Cv={class:"chart-wrapper"},Tv={class:"chart-container"},Sv={class:"chart-summary"},Dv={class:"summary-numbers"},Ev={class:"summary-row"},Av={class:"summary-values"},$v={class:"summary-row"},Iv={class:"summary-values"},Mv={class:"summary-analysis"},Nv=["innerHTML"],xv={class:"chart-section"},Lv={class:"chart-title"},Pv={key:0,class:"chart-period"},Ov={class:"chart-wrapper"},Rv={class:"chart-container"},Bv={class:"chart-analysis"},Uv={class:"analysis-content"},Wv=["innerHTML"],Fv={class:"chart-table-section"},Hv={class:"chart-table-wrapper"},jv={class:"data-table"},Vv={class:"data-row data-row--new"},zv={class:"data-row data-row--closed"},Gv={class:"data-row data-row--carryover"},Kv={__name:"LineChartMonths",props:{data:{type:Object,required:!0,default:()=>({newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]})},meta:{type:Object,default:()=>({months:[]})}},setup(o){Je.register(pa);const e=o;function s(k){return k==null||isNaN(k)?"0":k>=1e3?k.toLocaleString("ru-RU"):k.toString()}const t=M(()=>{const k=new Set;return e.data.newTicketsByMonth?.forEach(S=>{S.weeks&&Array.isArray(S.weeks)&&S.weeks.forEach(C=>{C&&C.weekNumber&&k.add(C.weekNumber)})}),e.data.closedTicketsByMonth?.forEach(S=>{S.weeks&&Array.isArray(S.weeks)&&S.weeks.forEach(C=>{C&&C.weekNumber&&k.add(C.weekNumber)})}),e.data.carryoverTicketsByMonth?.forEach(S=>{S.weeks&&Array.isArray(S.weeks)&&S.weeks.forEach(C=>{C&&C.weekNumber&&k.add(C.weekNumber)})}),Array.from(k).sort((S,C)=>S-C)}),r=M(()=>{const k=e.data.newTicketsByMonth||[],S=k.map(w=>w.monthName||`–ú–µ—Å—è—Ü ${w.month}`),C=k.map(w=>w.count||0),f=(e.data.closedTicketsByMonth||[]).map(w=>w.count||0);return{labels:S,datasets:[{label:"–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã",data:C,borderColor:J.primary,backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:10,color:J.primary,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:J.primary,borderWidth:1,borderRadius:4,padding:4}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",data:f,borderColor:J.success,backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"start",align:"bottom",offset:10,color:J.success,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:J.success,borderWidth:1,borderRadius:4,padding:4}}]}}),i=M(()=>{const k=e.data.carryoverTicketsByMonth||[],S=k.map(f=>f.monthName||`–ú–µ—Å—è—Ü ${f.month}`),C=k.map(f=>f.count||0);return{labels:S,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",data:C,borderColor:J.carryover,backgroundColor:"rgba(255, 152, 0, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:4,color:J.carryover}}]}}),n={responsive:!0,maintainAspectRatio:!1,layout:{padding:{left:16,right:0,top:56,bottom:0}},plugins:{legend:{position:"left",labels:{font:{size:14,weight:"500"},padding:16,boxWidth:20,boxHeight:12}},tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12},datalabels:{anchor:"end",align:"top",formatter:(k,S)=>k==null||isNaN(k)?"":k.toString(),color:"#333",font:{size:12,weight:"bold"},padding:{top:4,bottom:4},display:function(k){const S=k.dataset.data[k.dataIndex];return S!=null&&!isNaN(S)&&isFinite(S)},backgroundColor:"rgba(255, 255, 255, 0.8)",borderColor:"#333",borderWidth:1,borderRadius:4,padding:4}},scales:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:0,minRotation:0,font:{size:14},padding:10},grid:{lineWidth:1.5}}}};function l(k){if(!k||k.length===0)return null;const S=k[0],C=k[k.length-1];if(!S||!C)return null;const f=S.monthName||`–ú–µ—Å—è—Ü ${S.month}`,w=C.monthName||`–ú–µ—Å—è—Ü ${C.month}`,$=S.year||new Date().getFullYear();return`${f} ‚Äî ${w} ${$}`}const d=M(()=>l(e.data?.newTicketsByMonth||[])),g=M(()=>l(e.data?.carryoverTicketsByMonth||[])),p=M(()=>{const k=e.data?.newTicketsByMonth||[],S=e.data?.closedTicketsByMonth||[];if(k.length===0)return{new:"‚Äî",closed:"‚Äî"};const C=k.map(w=>`${s(w.count||0)} (${w.monthName||w.month})`).join(" ‚Üí "),f=S.map(w=>`${s(w.count||0)} (${w.monthName||w.month})`).join(" ‚Üí ");return{new:C,closed:f}}),T=M(()=>{const k=e.data?.newTicketsByMonth||[],S=e.data?.closedTicketsByMonth||[];if(k.length<2)return["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"];const C=[],f=[],w=[];if(k.length>=2){const $=k[0],W=k[1],L=k[2];if(W&&$&&typeof $.count=="number"&&typeof W.count=="number"){const D=$.monthName||$.month,E=W.monthName||W.month,x=s($.count||0),R=s(W.count||0);if($.count>0){const U=(W.count-$.count)/$.count*100;if(isFinite(U)&&!isNaN(U)){const G=U>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(U),oe=U>=0?"+":"-",Y=U>=0?"#28a745":"#dc3545",H=U>=0?"#28a745":"#dc3545";f.push(`  ‚Ä¢ <span style="color: ${Y}; font-weight: 600;">${G}</span> —Å ${x} (${D}) –¥–æ ${R} (${E}) ‚Äî <span style="color: ${H}; font-weight: 600;">${oe}${q.toFixed(1)}%</span>`)}}else $.count===0&&W.count>0&&f.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${D}) –¥–æ ${R} (${E})`)}if(L&&W&&typeof W.count=="number"&&typeof L.count=="number"){const D=W.monthName||W.month,E=L.monthName||L.month,x=s(W.count||0),R=s(L.count||0);if(W.count>0){const U=(L.count-W.count)/W.count*100;if(isFinite(U)&&!isNaN(U))if(Math.abs(U)<.1)f.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${x} (${D}) ‚Üí ${R} (${E}) ‚Äî 0.0%`);else{const G=U>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(U),oe=U>=0?"+":"-",Y=U>=0?"#28a745":"#dc3545",H=U>=0?"#28a745":"#dc3545";f.push(`  ‚Ä¢ <span style="color: ${Y}; font-weight: 600;">${G}</span> —Å ${x} (${D}) –¥–æ ${R} (${E}) ‚Äî <span style="color: ${H}; font-weight: 600;">${oe}${q.toFixed(1)}%</span>`)}}else W.count===0&&L.count>0&&f.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${D}) –¥–æ ${R} (${E})`)}}if(S.length>=2){const $=S[0],W=S[1],L=S[2];if(W&&$&&typeof $.count=="number"&&typeof W.count=="number"){const D=$.monthName||$.month,E=W.monthName||W.month,x=s($.count||0),R=s(W.count||0);if($.count>0){const U=(W.count-$.count)/$.count*100;if(isFinite(U)&&!isNaN(U))if(Math.abs(U)<.1)w.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${x} (${D}) ‚Üí ${R} (${E}) ‚Äî 0.0%`);else{const G=U>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(U),oe=U>=0?"+":"-",Y=U>=0?"#28a745":"#dc3545",H=U>=0?"#28a745":"#dc3545";w.push(`  ‚Ä¢ <span style="color: ${Y}; font-weight: 600;">${G}</span> —Å ${x} (${D}) –¥–æ ${R} (${E}) ‚Äî <span style="color: ${H}; font-weight: 600;">${oe}${q.toFixed(1)}%</span>`)}}else $.count===0&&W.count>0&&w.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏–π: —Å 0 (${D}) –¥–æ ${R} (${E})`)}if(L&&W&&typeof W.count=="number"&&typeof L.count=="number"){const D=W.monthName||W.month,E=L.monthName||L.month,x=s(W.count||0),R=s(L.count||0);if(W.count>0){const U=(L.count-W.count)/W.count*100;if(isFinite(U)&&!isNaN(U))if(Math.abs(U)<.1)w.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${x} (${D}) ‚Üí ${R} (${E}) ‚Äî 0.0%`);else{const G=U>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(U),oe=U>=0?"+":"-",Y=U>=0?"#28a745":"#dc3545",H=U>=0?"#28a745":"#dc3545";w.push(`  ‚Ä¢ <span style="color: ${Y}; font-weight: 600;">${G}</span> —Å ${x} (${D}) –¥–æ ${R} (${E}) ‚Äî <span style="color: ${H}; font-weight: 600;">${oe}${q.toFixed(1)}%</span>`)}}else W.count===0&&L.count>0&&w.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏–π: —Å 0 (${D}) –¥–æ ${R} (${E})`)}}if(f.length>0&&(C.push("–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã:"),C.push(...f)),w.length>0&&(C.push("–ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã:"),C.push(...w)),k.length>=3&&S.length>=3){const $=k[0],W=k[k.length-1],L=S[0],D=S[S.length-1],E=$.count||0,x=W.count||0,R=L.count||0,U=D.count||0;if(E>0&&R>0){const G=(x-E)/E*100,q=(U-R)/R*100;if(isFinite(G)&&isFinite(q)){const oe=$.monthName||$.month,Y=W.monthName||W.month,H=L.monthName||L.month,Z=D.monthName||D.month,fe=G>=0?"#28a745":"#dc3545",P=G>=0?"#28a745":"#dc3545",h=q>=0?"#28a745":"#dc3545",_=q>=0?"#28a745":"#dc3545";C.push("–û–±—â–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥:"),C.push(`  ‚Ä¢ –ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã: <span style="color: ${fe}; font-weight: 600;">${G>=0?"—Ä–æ—Å—Ç":"—Å–Ω–∏–∂–µ–Ω–∏–µ"}</span> —Å ${s(E)} (${oe}) –¥–æ ${s(x)} (${Y}) ‚Äî <span style="color: ${P}; font-weight: 600;">${G>=0?"+":"-"}${Math.abs(G).toFixed(1)}%</span>`),C.push(`  ‚Ä¢ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã: <span style="color: ${h}; font-weight: 600;">${q>=0?"—Ä–æ—Å—Ç":"—Å–Ω–∏–∂–µ–Ω–∏–µ"}</span> —Å ${s(R)} (${H}) –¥–æ ${s(U)} (${Z}) ‚Äî <span style="color: ${_}; font-weight: 600;">${q>=0?"+":"-"}${Math.abs(q).toFixed(1)}%</span>`)}}}return C.length>0?C:["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"]}),v=M(()=>{const k=e.data?.carryoverTicketsByMonth||[];if(k.length===0)return["–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"];const S=[],C=[],f=k.filter(w=>w&&typeof w.count=="number").map(w=>`${s(w.count||0)} (${w.monthName||w.month||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"})`).join(" ‚Üí ");if(f&&S.push(`–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã: ${f}`),k.length>=2){const w=k[0],$=k[1],W=k[2];if($&&w&&typeof w.count=="number"&&typeof $.count=="number"){const L=w.monthName||w.month,D=$.monthName||$.month,E=s(w.count||0),x=s($.count||0);if(w.count>0){const R=($.count-w.count)/w.count*100;if(isFinite(R)&&!isNaN(R))if(Math.abs(R)<.1)C.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${E} (${L}) ‚Üí ${x} (${D}) ‚Äî 0.0%`);else{const U=R>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",G=Math.abs(R),q=R>=0?"+":"-",oe=R>=0?"#28a745":"#dc3545",Y=R>=0?"#28a745":"#dc3545";C.push(`  ‚Ä¢ <span style="color: ${oe}; font-weight: 600;">${U}</span> —Å ${E} (${L}) –¥–æ ${x} (${D}) ‚Äî <span style="color: ${Y}; font-weight: 600;">${q}${G.toFixed(1)}%</span>`)}}else w.count===0&&$.count>0&&C.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${L}) –¥–æ ${x} (${D})`)}if(W&&$&&typeof $.count=="number"&&typeof W.count=="number"){const L=$.monthName||$.month,D=W.monthName||W.month,E=s($.count||0),x=s(W.count||0);if($.count>0){const R=(W.count-$.count)/$.count*100;if(isFinite(R)&&!isNaN(R))if(Math.abs(R)<.1)C.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${E} (${L}) ‚Üí ${x} (${D}) ‚Äî 0.0%`);else{const U=R>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",G=Math.abs(R),q=R>=0?"+":"-",oe=R>=0?"#28a745":"#dc3545",Y=R>=0?"#28a745":"#dc3545";C.push(`  ‚Ä¢ <span style="color: ${oe}; font-weight: 600;">${U}</span> —Å ${E} (${L}) –¥–æ ${x} (${D}) ‚Äî <span style="color: ${Y}; font-weight: 600;">${q}${G.toFixed(1)}%</span>`)}}else $.count===0&&W.count>0&&C.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${L}) –¥–æ ${x} (${D})`)}}if(C.length>0&&(S.push("–î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º:"),S.push(...C)),k.length>=3){const w=k[0],$=k[k.length-1];if(w&&$&&typeof w.count=="number"&&typeof $.count=="number"){const W=w.count||0,L=$.count||0,D=w.monthName||w.month,E=$.monthName||$.month,x=s(W),R=s(L);if(W>0){const U=(L-W)/W*100;if(isFinite(U)&&!isNaN(U))if(Math.abs(U)<1)S.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),S.push(`  ‚Ä¢ –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${x} (${D}) ‚Üí ${R} (${E}) ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ–Ω–µ–µ 1%`);else{const G=U>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(U),oe=U>=0?"+":"-",Y=U>=0?"#28a745":"#dc3545",H=U>=0?"#28a745":"#dc3545";S.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),S.push(`  ‚Ä¢ <span style="color: ${Y}; font-weight: 600;">${G}</span> —Å ${x} (${D}) –¥–æ ${R} (${E}) ‚Äî <span style="color: ${H}; font-weight: 600;">${oe}${q.toFixed(1)}%</span>`)}}else W===0&&L>0?(S.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),S.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${D}) –¥–æ ${R} (${E})`)):W>0&&L===0&&(S.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),S.push(`  ‚Ä¢ –ü–æ–ª–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å ${x} (${D}) –¥–æ 0 (${E})`))}}return S.length>0?S:["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"]});function y(k,S){let C=[];switch(k){case"new":C=e.data.newTicketsByMonth||[];break;case"closed":C=e.data.closedTicketsByMonth||[];break;case"carryover":C=e.data.carryoverTicketsByMonth||[];break;default:return"-"}for(const f of C){if(!f.weeks||!Array.isArray(f.weeks))continue;const w=f.weeks.find($=>$&&$.weekNumber===S);if(w){const $=w.count||0;return $>0?s($):"-"}}return"-"}return(k,S)=>(c(),u("div",kv,[a("div",bv,[a("h3",_v,[S[0]||(S[0]=ce(" –ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã ",-1)),d.value?(c(),u("span",wv,"("+m(d.value)+")",1)):A("",!0)]),a("div",Cv,[a("div",Tv,[ne(Ue(yt),{data:r.value,options:n},null,8,["data"])]),a("div",Sv,[S[3]||(S[3]=a("h4",{class:"summary-title"},"–°–≤–æ–¥–Ω—ã–π –∏—Ç–æ–≥",-1)),a("div",Dv,[a("div",Ev,[S[1]||(S[1]=a("span",{class:"summary-label"},"–ù–æ–≤—ã–µ:",-1)),a("span",Av,m(p.value.new),1)]),a("div",$v,[S[2]||(S[2]=a("span",{class:"summary-label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ:",-1)),a("span",Iv,m(p.value.closed),1)])]),a("div",Mv,[(c(!0),u(ee,null,te(T.value,(C,f)=>(c(),u("p",{key:f,innerHTML:C},null,8,Nv))),128))])])])]),a("div",xv,[a("h3",Lv,[S[4]||(S[4]=ce(" –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã ",-1)),g.value?(c(),u("span",Pv,"("+m(g.value)+")",1)):A("",!0)]),a("div",Ov,[a("div",Rv,[ne(Ue(yt),{data:i.value,options:n},null,8,["data"])]),a("div",Bv,[S[5]||(S[5]=a("h4",{class:"analysis-title"},"–ê–Ω–∞–ª–∏–∑",-1)),a("div",Uv,[(c(!0),u(ee,null,te(v.value,(C,f)=>(c(),u("p",{key:f,innerHTML:C},null,8,Wv))),128))])])])]),a("div",Fv,[S[10]||(S[10]=a("h3",{class:"chart-title"},"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º",-1)),a("div",Hv,[a("table",jv,[a("thead",null,[a("tr",null,[S[6]||(S[6]=a("th",{class:"month-header-cell"},"–ú–µ—Å—è—Ü",-1)),(c(!0),u(ee,null,te(t.value,C=>(c(),u("th",{key:`week-${C}`,class:"week-header-cell"}," –ù–µ–¥–µ–ª—è "+m(C),1))),128))])]),a("tbody",null,[a("tr",Vv,[S[7]||(S[7]=a("td",{class:"data-type-cell"},"–ù–æ–≤—ã–µ",-1)),(c(!0),u(ee,null,te(t.value,C=>(c(),u("td",{key:`new-${C}`,class:"week-data-cell"},m(y("new",C)),1))),128))]),a("tr",zv,[S[8]||(S[8]=a("td",{class:"data-type-cell"},"–ó–∞–∫—Ä—ã—Ç—ã–µ",-1)),(c(!0),u(ee,null,te(t.value,C=>(c(),u("td",{key:`closed-${C}`,class:"week-data-cell"},m(y("closed",C)),1))),128))]),a("tr",Gv,[S[9]||(S[9]=a("td",{class:"data-type-cell"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),(c(!0),u(ee,null,te(t.value,C=>(c(),u("td",{key:`carryover-${C}`,class:"week-data-cell"},m(y("carryover",C)),1))),128))])])])])])]))}},qv=de(Kv,[["__scopeId","data-v-31a3d565"]]),Yv={class:"months-preloader"},Xv={class:"preloader-content"},Jv={class:"progress-container"},Zv={class:"progress-bar"},Qv={class:"progress-text"},ep={class:"preloader-message"},tp={class:"stages-list"},sp={class:"stage-icon"},ap={class:"stage-text"},op={__name:"MonthsModePreloader",props:{progress:{type:Number,required:!0,validator:o=>o>=0&&o<=100},currentStage:{type:String,default:""}},setup(o){const e=o,s=[{label:"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",threshold:5},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 1)...",threshold:35},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 2)...",threshold:65},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 3)...",threshold:85},{label:"–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...",threshold:90},{label:"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",threshold:100}];function t(i){return e.progress>=s[i].threshold}function r(i){const n=s[i].threshold,l=i>0?s[i-1].threshold:0;return e.progress>=l&&e.progress<n}return(i,n)=>(c(),u("div",Yv,[a("div",Xv,[n[0]||(n[0]=_t('<div class="preloader-spinner" data-v-b571fe67><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div></div><h3 class="preloader-title" data-v-b571fe67>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 3 –º–µ—Å—è—Ü–∞</h3>',2)),a("div",Jv,[a("div",Zv,[a("div",{class:"progress-fill",style:we({width:`${o.progress}%`})},null,4)]),a("div",Qv,m(Math.round(o.progress))+"%",1)]),a("p",ep,m(o.currentStage),1),a("div",tp,[(c(),u(ee,null,te(s,(l,d)=>a("div",{key:d,class:X(["stage-item",{"stage-completed":t(d),"stage-current":r(d)}])},[a("span",sp,m(t(d)?"‚úì":r(d)?"‚Üí":"‚óã"),1),a("span",ap,m(l.label),1)],2)),64))])])]))}},np=de(op,[["__scopeId","data-v-b571fe67"]]),rp={class:"ac-dashboard-months"},ip={key:"content"},lp={class:"dashboard-header"},cp={class:"header-content"},dp={class:"breadcrumbs-row"},up=["aria-label","aria-disabled","data-fallback","disabled"],gp={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},mp={class:"dashboard-layout"},hp={class:"filters-container"},fp={class:"chart-container"},vp={__name:"GraphAdmissionClosureMonthsDashboard",setup(o){const e=Xe(),s=I(!0),t=I(0),r=I("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."),i=I(null),n=I(null),l=I({newTickets:0,closedTickets:0,carryoverTickets:0,newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[],previousPeriodData:{newTickets:null,closedTickets:null,carryoverTickets:null}}),d=I(!1),g=M(()=>typeof window>"u"?!1:window.history.length>1),p=M(()=>g.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),T={name:"dashboard-sector-1c"};function v(x){if(x?.preventDefault?.(),!d.value){d.value=!0;try{if(g.value){e.back();return}console.warn("GraphAdmissionClosureMonthsDashboard: fallback navigation to dashboard-sector-1c"),e.push(T)}finally{d.value=!1}}}const y=I({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),k=M(()=>{const x=y.value.customDateRange.startDate||y.value.customDateRange.endDate,R=y.value.employees.length===1&&y.value.employees.includes("all");return x||!R});async function S(x,R,U=500){const G=t.value,q=10,oe=(x-G)/q,Y=U/q;for(let H=0;H<q;H++)await new Promise(Z=>setTimeout(Z,Y)),t.value=Math.min(G+oe*(H+1),x);t.value=x,r.value=R}async function C(){console.log("[DEBUG MonthsDashboard] loadData called"),console.log("[DEBUG MonthsDashboard] isLoading before:",s.value),s.value=!0,i.value=null,t.value=0,r.value="–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",console.log("[DEBUG MonthsDashboard] isLoading set to true");let x=null,R=null;try{console.log("[DEBUG MonthsDashboard] Starting API call"),await S(5,"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",200);const U=Date.now(),G=2e4;x=setInterval(()=>{const H=Date.now()-U,Z=Math.min(5+H/G*85,90);t.value=Z,Z<35?r.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 1)...":Z<65?r.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 2)...":Z<85?r.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 3)...":r.value="–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö..."},500),R=setTimeout(()=>{x&&(clearInterval(x),x=null)},G+1e4);const q=await Ft({product:"1C",periodMode:"months",includeTickets:!0});clearTimeout(R),x&&(clearInterval(x),x=null),t.value=90,r.value="–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞",await S(100,"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",300),console.log("[DEBUG MonthsDashboard] API call successful, result:",q);const{meta:oe,data:Y}=q;n.value=oe,l.value=Y,console.log("[DEBUG MonthsDashboard] Data set, meta:",oe,"data keys:",Object.keys(Y)),await new Promise(H=>setTimeout(H,200))}catch(U){x&&(clearInterval(x),x=null),R&&(clearTimeout(R),R=null),console.error("[DEBUG MonthsDashboard] API call failed:",U),i.value=U instanceof Error?U:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureMonthsDashboard] loadData error:",U),t.value=100,r.value="–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö"}finally{console.log("[DEBUG MonthsDashboard] Finally block: setting isLoading to false"),s.value=!1,console.log("[DEBUG MonthsDashboard] isLoading after:",s.value)}}function f(x){y.value.stages=x}function w(x){y.value.employees=x}function $(x){y.value.dateRange=x}function W(x){y.value.customDateRange=x}function L(){y.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},D()}function D(){C()}function E(x){if(!["weeks","months"].includes(x)){console.warn("[GraphAdmissionClosureMonthsDashboard] Invalid periodMode:",x);return}x==="weeks"&&window.dispatchEvent(new CustomEvent("period-mode-change",{detail:{mode:x}}))}return $e(()=>{console.log("[DEBUG MonthsDashboard] onMounted called"),console.log("[DEBUG MonthsDashboard] isLoading before loadData:",s.value),C()}),(x,R)=>{const U=be("router-link");return c(),u("div",rp,[ne(Ae,{name:"fade",mode:"out-in"},{default:pe(()=>[s.value?(c(),he(np,{key:"preloader",progress:t.value,"current-stage":r.value},null,8,["progress","current-stage"])):(c(),u("div",ip,[a("div",lp,[a("div",cp,[a("div",dp,[a("button",{class:"btn-back-link",type:"button",onClick:v,"aria-label":p.value,"aria-disabled":!g.value,"data-fallback":!g.value,disabled:d.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,up),a("nav",gp,[ne(U,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:pe(()=>[...R[0]||(R[0]=[ce(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),R[2]||(R[2]=a("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ne(U,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:pe(()=>[...R[1]||(R[1]=[ce(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),R[3]||(R[3]=a("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),R[4]||(R[4]=a("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),R[5]||(R[5]=a("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),R[6]||(R[6]=a("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),a("div",mp,[a("div",hp,[ne(js,{stages:y.value.stages,employees:y.value.employees,dateRange:y.value.dateRange,customDateRange:y.value.customDateRange,hasActiveFilters:k.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":"months","onUpdate:stages":f,"onUpdate:employees":w,"onUpdate:dateRange":$,"onUpdate:customDateRange":W,"onUpdate:periodMode":E,onReset:L,onApply:D},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])]),a("div",fp,[i.value?(c(),he(_s,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:i.value.message},null,8,["message"])):(c(),u(ee,{key:1},[ne(yv,{data:l.value},null,8,["data"]),ne(qv,{data:l.value,meta:n.value},null,8,["data","meta"])],64))])])]))]),_:1})])}}},pp=de(vp,[["__scopeId","data-v-fe3ca7ed"]]);class vs{static async getSectorData(){try{const e=await this.getAllTickets();console.log("Total tickets loaded:",e.length);const s=this.extractUniqueEmployeeIds(e);console.log("Unique employee IDs:",s);const t=await this.getEmployeesByIds(s);return console.log("Loaded employees:",t.length),{stages:this.groupTicketsByStages(e,t),employees:t,zeroPointTickets:this.getZeroPointTickets(e)}}catch(e){throw console.error("Error getting sector data:",e),e}}static async getAllTickets(){const e=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],s=[];for(const t of e){console.log(`Loading tickets for stage: ${t}`);const r=await this.getTicketsByStage(t);s.push(...r),console.log(`Loaded ${r.length} tickets for stage ${t}`)}return s}static async getTicketsByStage(e){const s=[];let t=0;const r=50;let i=!0;for(;i;)try{const d=await new vt().call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:e},select:["*"],order:{id:"DESC"},start:t,useOriginalUfNames:"Y"});let g=[];d&&d.result&&(Array.isArray(d.result)?g=d.result:d.result.items&&Array.isArray(d.result.items)?g=d.result.items:d.result.data&&Array.isArray(d.result.data)&&(g=d.result.data)),g.length>0?(s.push(...g),t+=g.length,i=g.length===r):i=!1}catch(l){console.error(`Error loading tickets batch for stage ${e} (start: ${t}):`,l),i=!1}s.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(s[0],null,2)),console.log("Sample ticket keys:",Object.keys(s[0])),console.log("Sample ticket assignedById variants:",{assignedById:s[0].assignedById,assignedByIdId:s[0].assignedByIdId,ASSIGNED_BY_ID:s[0].ASSIGNED_BY_ID}));const n=s.filter(l=>{const d=l.UF_CRM_7_TYPE_PRODUCT||l.uf_crm_7_type_product||l.ufCrm7TypeProduct||l.UF_CRM_7_TYPE_PRODUCT||l.uf_crm_7_type_product;return Array.isArray(d)?d.includes(this.SECTOR_TAG):typeof d=="object"&&d!==null?d.value===this.SECTOR_TAG||d===this.SECTOR_TAG:d===this.SECTOR_TAG});return console.log(`Filtered ${n.length} tickets from ${s.length} for stage ${e} (sector tag: ${this.SECTOR_TAG})`),n}static extractUniqueEmployeeIds(e){if(!Array.isArray(e))return[];const s=new Set;return e.forEach(t=>{const r=t.assignedById||t.assignedByIdId||t.ASSIGNED_BY_ID||t.assignedById||t.assignedById&&typeof t.assignedById=="object"&&(t.assignedById.id||t.assignedById.ID)||t.assignedById&&typeof t.assignedById=="object"&&t.assignedById.value;if(r){const i=parseInt(r);i&&!isNaN(i)&&i>0&&s.add(i)}}),e.length>0&&(console.log("Sample ticket for employee extraction:",e[0]),console.log("Sample ticket assignedById variants:",{assignedById:e[0].assignedById,assignedByIdId:e[0].assignedByIdId,ASSIGNED_BY_ID:e[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(s))),Array.from(s)}static async getEmployeesByIds(e){if(!Array.isArray(e)||e.length===0)return[];try{const t=await new vt().call("user.get",{filter:{ID:e}});let r=[];return t&&t.result&&(Array.isArray(t.result)?r=t.result:console.warn("Unexpected user.get result format:",t)),r.map(i=>({id:parseInt(i.ID||i.id||0),name:`${i.NAME||i.name||""} ${i.LAST_NAME||i.lastName||""}`.trim()||i.EMAIL||i.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:i.WORK_POSITION||i.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:i.EMAIL||i.email||"",tickets:[]}))}catch(s){return console.error("Error getting employees by IDs:",s),[]}}static groupTicketsByStages(e,s){Array.isArray(e)||(console.warn("Tickets is not an array:",e),e=[]),Array.isArray(s)||(console.warn("Employees is not an array:",s),s=[]);const t=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:s.map(r=>({...r,tickets:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:s.map(r=>({...r,tickets:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:s.map(r=>({...r,tickets:[]}))}];return e.forEach(r=>{const i=this.mapStageId(r.stageId||r.STAGE_ID||""),n=t.find(l=>l.id===i);if(n){const l=r.assignedById||r.ASSIGNED_BY_ID||null,d=l?parseInt(l):null;if(d){let g=n.employees.find(p=>p.id===d);g||(g={id:d,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${d}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",tickets:[]},n.employees.push(g)),g.tickets.push(this.mapTicket(r))}}}),t}static mapStageId(e){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[e]||"formed"}static mapStageIdToBitrix(e){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[e]||"DT140_12:UC_0VHWE2"}static mapTicket(e){const s=parseInt(e.id||e.ID||0),t=e.title||e.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",r=e.stageId||e.STAGE_ID||"",i=e.assignedById||e.ASSIGNED_BY_ID||null,n=e.createdTime||e.CREATED_DATE||e.CREATED_TIME||"",l=e.updatedTime||e.MODIFY_DATE||e.UPDATED_TIME||"",d=e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.ufCrm7UfPriority||e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.priority||e.PRIORITY||null,g=Ps(d),p=ba(g);return{id:s,title:t,priorityId:g.id,priorityLabel:g.label,priorityColors:p,priority:g.id,priorityBitrixValue:g.bitrixValue||null,status:this.mapStatus(r),assigneeId:i?parseInt(i):null,stageId:this.mapStageId(r),createdAt:n,modifiedAt:l,amount:e.opportunity||e.OPPORTUNITY||0,currency:e.currencyId||e.CURRENCY_ID||"RUB",description:e.comments||e.COMMENTS||""}}static mapPriority(e){return Ps(e).id}static mapPriorityToBitrix(e){if(e&&typeof e=="object")return e.bitrixValue||null;const s=sa(e);if(s&&s.bitrixValue)return s.bitrixValue;const t={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return t[e]?t[e]:sa(ko).bitrixValue}static mapStatus(e){return"in_progress"}static getZeroPointTickets(e){const s={formed:[],review:[],execution:[]};return Array.isArray(e)?(e.filter(t=>!(t.assignedById||t.ASSIGNED_BY_ID)).forEach(t=>{const r=this.mapStageId(t.stageId||t.STAGE_ID||"");s[r]&&s[r].push(this.mapTicket(t))}),s):(console.warn("Tickets is not an array in getZeroPointTickets:",e),s)}static async assignTicket(e,s,t){try{const r=this.mapStageIdToBitrix(t);return(await new vt().call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:e,fields:{assignedById:s,stageId:r}})).result===!0}catch(r){throw console.error("Error assigning ticket:",r),r}}static async createTicket(e){try{const t=await new vt().call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:e.title,assignedById:e.employeeId,stageId:this.mapStageIdToBitrix(e.stageId)}});return t.result?parseInt(t.result):0}catch(s){throw console.error("Error creating ticket:",s),s}}static async getTicket(e){try{const t=await new vt().call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:e});return this.mapTicket(t.result)}catch(s){throw console.error("Error getting ticket:",s),s}}static async addComment(e,s){try{return(await new vt().call("crm.timeline.comment.add",{fields:{entityId:e,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:s}})).result!==void 0}catch(t){throw console.error("Error adding comment:",t),t}}}je(vs,"ENTITY_TYPE_ID",140),je(vs,"SECTOR_TAG","1C");const yp=Object.freeze(Object.defineProperty({__proto__:null,DashboardSector1CService:vs},Symbol.toStringTag,{value:"Module"}));function kp(o){if(!o)return null;try{const e=new Date(o);return isNaN(e.getTime())?null:e}catch{return console.warn("Invalid date format:",o),null}}function bp(o,e){return Math.floor((o-e)/864e5)}function _p(o){return!o||isNaN(o.getTime())?!1:o<=new Date}const it={ONE_MONTH:"one_month",TWO_MONTHS:"two_months",MORE_THAN_HALF_YEAR:"more_than_half_year",MORE_THAN_YEAR:"more_than_year"},Ut={[it.ONE_MONTH]:"–û–¥–∏–Ω –º–µ—Å—è—Ü",[it.TWO_MONTHS]:"–î–≤–∞ –º–µ—Å—è—Ü–∞",[it.MORE_THAN_HALF_YEAR]:"–ë–æ–ª–µ–µ –ø–æ–ª—É–≥–æ–¥–∞",[it.MORE_THAN_YEAR]:"–ë–æ–ª–µ–µ –≥–æ–¥–∞"},na={[it.ONE_MONTH]:30,[it.TWO_MONTHS]:60,[it.MORE_THAN_HALF_YEAR]:180,[it.MORE_THAN_YEAR]:365};function ps(o,e,s=new Date){if(!Array.isArray(o))return console.warn("filterTicketsByTimePeriod: tickets must be an array"),[];if(!na[e])return console.warn(`filterTicketsByTimePeriod: Unknown period "${e}"`),o;const t=na[e],r=e.includes("more_than");return o.filter(i=>{try{if(!i||!i.id||!i.created_at)return console.warn("Ticket missing required fields:",i),!1;const n=kp(i.created_at);if(!n)return console.warn(`Invalid date for ticket ${i.id}: ${i.created_at}`),!1;if(!_p(n))return console.warn(`Future or invalid date for ticket ${i.id}: ${i.created_at}`),!1;const l=bp(s,n);return r?l>t:l<=t}catch(n){return console.error(`Error filtering ticket ${i?.id||"unknown"}:`,n),!1}})}const wp={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Cp={class:"modal"},Tp={key:0,class:"modal__tabs"},Sp={key:"level-0-categories",class:"level-0"},Dp={class:"modal__header"},Ep={class:"modal__title"},Ap={key:0},$p={class:"modal__body"},Ip={class:"categories-list"},Mp=["onClick"],Np={class:"category-item"},xp={class:"category-item__icon"},Lp={key:0},Pp={key:1},Op={class:"category-item__content"},Rp={class:"category-item__label"},Bp={class:"category-item__count"},Up={key:0,class:"category-item__arrow"},Wp={class:"modal__footer"},Fp={key:"level-1-categories",class:"level-1"},Hp={class:"modal__header"},jp={class:"modal__body"},Vp={key:"loading",class:"loading-names"},zp={key:"empty",class:"modal__empty"},Gp={key:"list",class:"responsible-list"},Kp=["onClick"],qp={class:"responsible-list__name"},Yp={class:"responsible-list__count"},Xp={key:0,class:"responsible-list__arrow"},Jp={class:"modal__footer"},Zp={key:"level-2-categories",class:"level-2"},Qp={class:"modal__header"},ey={class:"modal__title"},ty={class:"modal__body"},sy={class:"time-sort-controls"},ay={class:"time-sort-buttons"},oy=["onClick"],ny={class:"count"},ry={key:"loading",class:"loading-state"},iy={key:"error",class:"error-state"},ly={class:"error-message"},cy={key:"empty",class:"empty-state"},dy={class:"empty-state-message"},uy={key:"tickets",class:"tickets-list-container"},gy={key:"level-0-employees",class:"level-0"},my={class:"modal__header"},hy={class:"modal__title"},fy={key:0},vy={class:"modal__body"},py={key:"loading",class:"loading-names"},yy={key:"empty",class:"modal__empty"},ky={key:"list",class:"responsible-list"},by=["onClick"],_y={class:"responsible-list__name"},wy={class:"responsible-list__count"},Cy={key:0,class:"responsible-list__arrow"},Ty={class:"modal__footer"},Sy={key:"level-1-employees",class:"level-1"},Dy={class:"modal__header"},Ey={class:"modal__title"},Ay={class:"modal__body"},$y={class:"categories-list"},Iy=["onClick"],My={class:"category-item"},Ny={class:"category-item__icon"},xy={key:0},Ly={key:1},Py={class:"category-item__content"},Oy={class:"category-item__label"},Ry={class:"category-item__count"},By={key:0,class:"category-item__arrow"},Uy={class:"modal__footer"},Wy={key:"level-2-employees",class:"level-2"},Fy={class:"modal__header"},Hy={class:"modal__title"},jy={class:"modal__body"},Vy={key:"loading",class:"loading-state"},zy={key:"error",class:"error-state"},Gy={class:"error-message"},Ky={key:"empty",class:"empty-state"},qy={class:"empty-state-message"},Yy={key:"tickets",class:"tickets-list-container"},Xy={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(o){const e=o,s=I(0),t=I("categories"),r=I(null),i=I(null),n=I(null),l=I([]),d=I(!1),g=I(null),p=I([]),T=I([]),v=I(!1),y=I(it.ONE_MONTH),k=M(()=>[{id:"created-this-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é",count:e.closedTicketsCreatedThisWeek??0,responsible:e.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ",count:e.closedTicketsCreatedOtherWeek??0,responsible:e.responsibleCreatedOtherWeek??[]}]),S=M(()=>{const P=new Map;return(e.responsibleCreatedThisWeek||[]).forEach(h=>{const _=h.id??"unassigned";P.has(_)||P.set(_,{id:h.id,name:h.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const B=P.get(_);B.thisWeekCount=h.count??0,B.thisWeekTickets=h.tickets||[],B.totalCount+=B.thisWeekCount}),(e.responsibleCreatedOtherWeek||[]).forEach(h=>{const _=h.id??"unassigned";P.has(_)||P.set(_,{id:h.id,name:h.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const B=P.get(_);B.otherWeekCount=h.count??0,B.otherWeekTickets=h.tickets||[],B.totalCount+=B.otherWeekCount}),Array.from(P.values())}),C=M(()=>{if(!i.value)return[];const P=i.value.thisWeekTickets||[],h=i.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:i.value.id,name:i.value.name,thisWeekCount:i.value.thisWeekCount,otherWeekCount:i.value.otherWeekCount,thisWeekTickets:P.length,otherWeekTickets:h.length,employee:i.value}),[{id:"this-week",label:"–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ",count:i.value.thisWeekCount??0,tickets:P,employeeId:i.value.id},{id:"other-week",label:"–ù–∞ –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ",count:i.value.otherWeekCount??0,tickets:h,employeeId:i.value.id}]}),f=M(()=>(T.value||[]).length>0),w=M(()=>{if(!l.value||l.value.length===0)return[];try{const P=performance.now(),h=ps(l.value,y.value),_=performance.now();return console.log(`[ResponsibleModal] Filtering took ${(_-P).toFixed(2)}ms, results: ${h.length}`),h}catch(P){return console.error("[ResponsibleModal] Error filtering tickets:",P),[]}}),$=M(()=>Object.keys(Ut).map(P=>({key:P,label:Ut[P],count:ps(l.value,P).length})));async function W(P){const h=P.filter(_=>_.id!==null&&_.id!==void 0).map(_=>_.id);if(h.length===0)return P;try{const _=await vs.getEmployeesByIds(h),B=new Map;return _.forEach(re=>{B.set(re.id,re.name)}),P.map(re=>re.id&&B.has(re.id)?{...re,name:B.get(re.id)}:re)}catch(_){return console.error("[ResponsibleModal] Error enriching names:",_),P}}Ne([()=>t.value,()=>S.value],async([P,h])=>{if(!(P!=="employees"||s.value!==0)){if(!h||h.length===0){T.value=[];return}v.value=!0;try{T.value=await W(h)}catch(_){console.error("[ResponsibleModal] Error loading employee names:",_),T.value=h}finally{v.value=!1}}},{immediate:!0}),Ne(()=>e.responsible,async P=>{if(!(s.value!==0||r.value||t.value!=="categories")){if(!P||P.length===0){p.value=[];return}v.value=!0;try{p.value=await W(P)}catch(h){console.error("[ResponsibleModal] Error loading employee names:",h),p.value=P}finally{v.value=!1}}},{immediate:!1});const L=M(()=>(p.value||[]).length>0);function D(P){t.value!==P&&(t.value=P,s.value=0,r.value=null,i.value=null,n.value=null,l.value=[],g.value=null,p.value=[],T.value=[])}async function E(P){if(!P||P.count===0){console.warn("[ResponsibleModal] handleCategoryClick: Invalid category or count is 0",{category:P,count:P?.count});return}console.log("[ResponsibleModal] handleCategoryClick called:",{categoryId:P.id,categoryLabel:P.label,categoryCount:P.count,responsibleCount:P.responsible?.length||0,responsibleWithTickets:P.responsible?.filter(h=>h.tickets&&h.tickets.length>0).length||0,responsibleSample:P.responsible?.slice(0,2).map(h=>({id:h.id,name:h.name,count:h.count,hasTickets:!!h.tickets,ticketsCount:h.tickets?.length||0}))}),r.value=P,s.value=1,v.value=!0;try{p.value=await W(P.responsible),console.log("[ResponsibleModal] After enrichResponsibleWithNames:",{enrichedCount:p.value.length,enrichedSample:p.value.slice(0,2).map(h=>({id:h.id,name:h.name,count:h.count,hasTickets:!!h.tickets,ticketsCount:h.tickets?.length||0}))})}catch(h){console.error("[ResponsibleModal] Error loading employee names:",h),p.value=P.responsible}finally{v.value=!1}}async function x(P,h=null){!P||!P.id||P.totalCount===0||(h&&h.currentTarget&&(h.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{h.currentTarget&&(h.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:P.id,name:P.name,thisWeekCount:P.thisWeekCount,otherWeekCount:P.otherWeekCount,thisWeekTickets:P.thisWeekTickets?.length||0,otherWeekTickets:P.otherWeekTickets?.length||0,employee:P}),i.value={...P,thisWeekTickets:P.thisWeekTickets||[],otherWeekTickets:P.otherWeekTickets||[]},s.value=1)}async function R(P){if(!P||P.count===0)return;n.value=P,s.value=2;const h=P.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:P.id,label:P.label,count:P.count,ticketsInGradation:h.length,selectedEmployee:i.value?.id}),h.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",h.length),await U(h)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await G(P))}async function U(P){d.value=!0,g.value=null;try{try{const{prepareTicketsForDisplay:h}=await Se(async()=>{const{prepareTicketsForDisplay:_}=await import("./chunk-yvHyt3PJ.js").then(B=>B.t);return{prepareTicketsForDisplay:_}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);l.value=await h(P,null,null)}catch(h){console.error("[ResponsibleModal] Error preparing tickets:",h),l.value=P}l.value.length===0&&(g.value=null)}catch(h){g.value=h.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",h),l.value=[]}finally{d.value=!1}}async function G(P){d.value=!0,g.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc||!i.value)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫");const h=await Ft({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeTickets:!0}),re=(P.id==="this-week"?h.data.responsibleCreatedThisWeek:h.data.responsibleCreatedOtherWeek)?.find(le=>le.id===i.value.id)?.tickets||[];try{const{prepareTicketsForDisplay:le}=await Se(async()=>{const{prepareTicketsForDisplay:ae}=await import("./chunk-yvHyt3PJ.js").then(me=>me.t);return{prepareTicketsForDisplay:ae}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);l.value=await le(re,null,null)}catch(le){console.error("[ResponsibleModal] Error preparing tickets:",le),l.value=re}l.value.length===0&&(g.value=null)}catch(h){g.value=h.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets from API:",h),l.value=[]}finally{d.value=!1}}async function q(P,h=null){!P||!P.id||P.count===0||(h&&h.currentTarget&&(h.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{h.currentTarget&&(h.currentTarget.style.transform="")},150)),i.value=P,s.value=2,await oe(P.id))}async function oe(P){d.value=!0,g.value=null;try{let h=[];if(console.log("[ResponsibleModal] loadEmployeeTickets called:",{employeeId:P,selectedCategory:r.value?.id,hasSelectedCategory:!!r.value,hasResponsible:!!r.value?.responsible,responsibleCount:r.value?.responsible?.length||0,categoryData:r.value?{id:r.value.id,label:r.value.label,count:r.value.count,responsibleSample:r.value.responsible?.slice(0,2).map(_=>({id:_.id,name:_.name,count:_.count,hasTickets:!!_.tickets,ticketsCount:_.tickets?.length||0}))}:null}),r.value&&r.value.responsible){const _=r.value.responsible.find(B=>B.id===P);console.log("[ResponsibleModal] Employee found in category:",{employee:_,hasTickets:!!_?.tickets,ticketsCount:_?.tickets?.length||0,tickets:_?.tickets?_.tickets.slice(0,2):null}),h=_?.tickets||[]}if(h.length===0&&e.weekStartUtc&&e.weekEndUtc){console.log("[ResponsibleModal] Tickets not found in category, loading from API",{weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,categoryId:r.value?.id});const _=await Ft({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeTickets:!0});console.log("[ResponsibleModal] API response:",{hasResponsibleCreatedThisWeek:!!_.data.responsibleCreatedThisWeek,hasResponsibleCreatedOtherWeek:!!_.data.responsibleCreatedOtherWeek,thisWeekCount:_.data.responsibleCreatedThisWeek?.length||0,otherWeekCount:_.data.responsibleCreatedOtherWeek?.length||0,thisWeekSample:_.data.responsibleCreatedThisWeek?.slice(0,1).map(le=>({id:le.id,name:le.name,count:le.count,hasTickets:!!le.tickets,ticketsCount:le.tickets?.length||0})),otherWeekSample:_.data.responsibleCreatedOtherWeek?.slice(0,1).map(le=>({id:le.id,name:le.name,count:le.count,hasTickets:!!le.tickets,ticketsCount:le.tickets?.length||0}))});const B=r.value?.id==="created-this-week"?_.data.responsibleCreatedThisWeek:_.data.responsibleCreatedOtherWeek;console.log("[ResponsibleModal] Category data:",{categoryId:r.value?.id,categoryDataCount:B?.length||0,categoryDataSample:B?.slice(0,2).map(le=>({id:le.id,name:le.name,count:le.count,hasTickets:!!le.tickets,ticketsCount:le.tickets?.length||0}))});const re=B?.find(le=>le.id===P);console.log("[ResponsibleModal] Employee found in API response:",{employee:re?{id:re.id,name:re.name,count:re.count,hasTickets:!!re.tickets,ticketsCount:re.tickets?.length||0,ticketsSample:re.tickets?.slice(0,2)}:null}),h=re?.tickets||[]}console.log("[ResponsibleModal] Final employeeTickets before prepareTicketsForDisplay:",{ticketsCount:h.length,ticketsSample:h.slice(0,2).map(_=>({id:_.id,title:_.title||_.ufSubject||"No title",stageId:_.stageId}))});try{const{prepareTicketsForDisplay:_}=await Se(async()=>{const{prepareTicketsForDisplay:B}=await import("./chunk-yvHyt3PJ.js").then(re=>re.t);return{prepareTicketsForDisplay:B}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);l.value=await _(h,null,null),console.log("[ResponsibleModal] Tickets after prepareTicketsForDisplay:",{ticketsCount:l.value.length,ticketsSample:l.value.slice(0,2).map(B=>({id:B.id,title:B.title||B.ufSubject||"No title",stageId:B.stageId}))})}catch(_){console.error("[ResponsibleModal] Error preparing tickets:",_),console.error("[ResponsibleModal] prepareError details:",{message:_.message,stack:_.stack,employeeTicketsCount:h.length}),l.value=h,console.log("[ResponsibleModal] Using fallback tickets (without enrichment):",l.value.length)}l.value.length===0?(console.warn("[ResponsibleModal] No tickets after loading and preparation",{employeeId:P,categoryId:r.value?.id,employeeTicketsCount:h.length,finalTicketsCount:l.value.length}),g.value=null):console.log("[ResponsibleModal] Successfully loaded tickets:",l.value.length)}catch(h){g.value=h.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",h),console.error("[ResponsibleModal] Error details:",{message:h.message,stack:h.stack,employeeId:P,categoryId:r.value?.id}),l.value=[]}finally{d.value=!1}}function Y(){s.value===2?(s.value=1,t.value==="categories"?i.value=null:n.value=null,l.value=[],g.value=null):s.value===1&&(s.value=0,t.value==="categories"?(r.value=null,p.value=[]):i.value=null)}function H(P){console.log(`[ResponsibleModal] Sort mode changed: ${y.value} -> ${P}`);const h=performance.now();y.value=P,setTimeout(()=>{const _=w.value,B=performance.now();console.log(`[ResponsibleModal] Filtering completed in ${(B-h).toFixed(2)}ms, ${_.length} tickets shown`)},0)}function Z(P){const h=ss(P.id);window.open(h,"_blank")}function fe(){t.value==="employees"&&n.value?U(n.value.tickets):t.value==="categories"&&i.value&&oe(i.value.id)}return Ne(()=>e.isVisible,P=>{if(P){console.log("[TASK-070] ResponsibleModal opened for week",e.weekNumber),console.log("[TASK-070] ResponsibleModal props types:",{responsibleCreatedThisWeekType:typeof e.responsibleCreatedThisWeek,responsibleCreatedThisWeekIsArray:Array.isArray(e.responsibleCreatedThisWeek),responsibleCreatedThisWeekLength:Array.isArray(e.responsibleCreatedThisWeek)?e.responsibleCreatedThisWeek.length:"not array",responsibleCreatedOtherWeekType:typeof e.responsibleCreatedOtherWeek,responsibleCreatedOtherWeekIsArray:Array.isArray(e.responsibleCreatedOtherWeek),responsibleCreatedOtherWeekLength:Array.isArray(e.responsibleCreatedOtherWeek)?e.responsibleCreatedOtherWeek.length:"not array"}),console.log("[TASK-070] ResponsibleModal data:",{weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,responsibleCreatedThisWeek:Array.isArray(e.responsibleCreatedThisWeek)?e.responsibleCreatedThisWeek.length:e.responsibleCreatedThisWeek?"not array":"null/undefined",responsibleCreatedOtherWeek:Array.isArray(e.responsibleCreatedOtherWeek)?e.responsibleCreatedOtherWeek.length:e.responsibleCreatedOtherWeek?"not array":"null/undefined",closedTicketsCreatedThisWeek:e.closedTicketsCreatedThisWeek,closedTicketsCreatedOtherWeek:e.closedTicketsCreatedOtherWeek}),console.log("[TASK-070] ResponsibleModal detailed data:",{responsibleCreatedThisWeek:e.responsibleCreatedThisWeek,responsibleCreatedOtherWeek:e.responsibleCreatedOtherWeek,responsibleCreatedThisWeekWithTickets:Array.isArray(e.responsibleCreatedThisWeek)?e.responsibleCreatedThisWeek.map(_=>({id:_.id,name:_.name,count:_.count,hasTickets:!!_.tickets,ticketsCount:_.tickets?.length||0})):"not array or null",responsibleCreatedOtherWeekWithTickets:Array.isArray(e.responsibleCreatedOtherWeek)?e.responsibleCreatedOtherWeek.map(_=>({id:_.id,name:_.name,count:_.count,hasTickets:!!_.tickets,ticketsCount:_.tickets?.length||0})):"not array or null"});const h=e.weekNumber;h&&console.log("[TASK-070] ResponsibleModal: Week number",h)}else s.value=0,t.value="categories",r.value=null,i.value=null,n.value=null,l.value=[],g.value=null,p.value=[],T.value=[]}),(P,h)=>o.isVisible?(c(),u("div",wp,[a("div",Cp,[s.value===0?(c(),u("div",Tp,[a("button",{class:X(["modal__tab",{"modal__tab--active":t.value==="categories"}]),onClick:h[0]||(h[0]=_=>D("categories"))}," –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º ",2),a("button",{class:X(["modal__tab",{"modal__tab--active":t.value==="employees"}]),onClick:h[1]||(h[1]=_=>D("employees"))}," –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º ",2)])):A("",!0),ne(Ae,{name:"level",mode:"out-in"},{default:pe(()=>[t.value==="categories"&&s.value===0?(c(),u("div",Sp,[a("header",Dp,[a("h3",Ep,[h[12]||(h[12]=ce(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),o.weekNumber?(c(),u("span",Ap," ¬∑ –ù–µ–¥–µ–ª—è "+m(o.weekNumber),1)):A("",!0)]),a("button",{class:"modal__close",onClick:h[2]||(h[2]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),a("section",$p,[a("ul",Ip,[(c(!0),u(ee,null,te(k.value,_=>(c(),u("li",{key:_.id,class:X(["categories-list__item",{"categories-list__item--clickable":_.count>0}]),onClick:B=>E(_)},[a("div",Np,[a("div",xp,[_.id==="created-this-week"?(c(),u("span",Lp,"‚úì")):(c(),u("span",Pp,"‚Üª"))]),a("div",Op,[a("div",Rp,m(_.label),1),a("div",Bp,m(_.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),_.count>0?(c(),u("span",Up,"‚Üí")):A("",!0)])],10,Mp))),128))])]),a("footer",Wp,[a("button",{class:"btn",onClick:h[3]||(h[3]=_=>P.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value==="categories"&&s.value===1?(c(),u("div",Fp,[a("header",Hp,[a("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),h[13]||(h[13]=a("h3",{class:"modal__title"},"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),a("button",{class:"modal__close",onClick:h[4]||(h[4]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),a("section",jp,[ne(Ae,{name:"loading",mode:"out-in"},{default:pe(()=>[v.value?(c(),u("div",Vp,[...h[14]||(h[14]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):L.value?(c(),u("ul",Gp,[(c(!0),u(ee,null,te(p.value,_=>(c(),u("li",{key:_.id||_.name,class:X(["responsible-list__item",{"responsible-list__item--clickable":_.id&&_.count>0}]),onClick:B=>q(_,B),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[a("span",qp,m(_.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),a("span",Yp,m(_.count??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),_.id&&_.count>0?(c(),u("span",Xp,"‚Üí")):A("",!0)],10,Kp))),128))])):(c(),u("p",zp,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º"))]),_:1})]),a("footer",Jp,[a("button",{class:"btn",onClick:h[5]||(h[5]=_=>P.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value==="categories"&&s.value===2?(c(),u("div",Zp,[a("header",Qp,[a("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),a("h3",ey,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+m(i.value?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),a("button",{class:"modal__close",onClick:h[6]||(h[6]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),a("section",ty,[a("div",sy,[h[15]||(h[15]=a("h4",{class:"time-sort-title"},"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–∏–∫–µ—Ç—ã:",-1)),a("div",ay,[(c(!0),u(ee,null,te($.value,_=>(c(),u("button",{key:_.key,class:X(["time-sort-btn",{active:y.value===_.key}]),onClick:B=>H(_.key)},[ce(m(_.label)+" ",1),a("span",ny,"("+m(_.count)+")",1)],10,oy))),128))])]),ne(Ae,{name:"loading",mode:"out-in"},{default:pe(()=>[d.value?(c(),u("div",ry,[...h[16]||(h[16]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):g.value?(c(),u("div",iy,[h[17]||(h[17]=a("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),h[18]||(h[18]=a("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),a("p",ly,m(g.value),1),a("button",{class:"btn btn-retry",onClick:fe},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):w.value.length===0?(c(),u("div",cy,[h[19]||(h[19]=a("div",{class:"empty-state-icon"},"üìã",-1)),a("p",dy," –£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ("+m(Ue(Ut)[y.value])+") ",1)])):(c(),u("div",uy,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:pe(()=>[(c(!0),u(ee,null,te(w.value,(_,B)=>(c(),he(Ct,{key:_.id,ticket:_,draggable:!1,style:we({"--ticket-index":B}),onClick:Z},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):t.value==="employees"&&s.value===0?(c(),u("div",gy,[a("header",my,[a("h3",hy,[h[20]||(h[20]=ce(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),o.weekNumber?(c(),u("span",fy," ¬∑ –ù–µ–¥–µ–ª—è "+m(o.weekNumber),1)):A("",!0)]),a("button",{class:"modal__close",onClick:h[7]||(h[7]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),a("section",vy,[ne(Ae,{name:"loading",mode:"out-in"},{default:pe(()=>[v.value?(c(),u("div",py,[...h[21]||(h[21]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):f.value?(c(),u("ul",ky,[(c(!0),u(ee,null,te(T.value,_=>(c(),u("li",{key:_.id||_.name,class:X(["responsible-list__item",{"responsible-list__item--clickable":_.id&&_.totalCount>0}]),onClick:B=>x(_,B),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞–¥–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[a("span",_y,m(_.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),a("span",wy,m(_.totalCount??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),_.id&&_.totalCount>0?(c(),u("span",Cy,"‚Üí")):A("",!0)],10,by))),128))])):(c(),u("p",yy,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"))]),_:1})]),a("footer",Ty,[a("button",{class:"btn",onClick:h[8]||(h[8]=_=>P.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value==="employees"&&s.value===1?(c(),u("div",Sy,[a("header",Dy,[a("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),a("h3",Ey,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+m(i.value?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),a("button",{class:"modal__close",onClick:h[9]||(h[9]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),a("section",Ay,[a("ul",$y,[(c(!0),u(ee,null,te(C.value,_=>(c(),u("li",{key:_.id,class:X(["categories-list__item",{"categories-list__item--clickable":_.count>0}]),onClick:B=>R(_)},[a("div",My,[a("div",Ny,[_.id==="this-week"?(c(),u("span",xy,"‚úì")):(c(),u("span",Ly,"‚Üª"))]),a("div",Py,[a("div",Oy,m(_.label),1),a("div",Ry,m(_.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),_.count>0?(c(),u("span",By,"‚Üí")):A("",!0)])],10,Iy))),128))])]),a("footer",Uy,[a("button",{class:"btn",onClick:h[10]||(h[10]=_=>P.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value==="employees"&&s.value===2?(c(),u("div",Wy,[a("header",Fy,[a("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),a("h3",Hy," –¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+m(i.value?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")+" ("+m(n.value?.label||"")+") ",1),a("button",{class:"modal__close",onClick:h[11]||(h[11]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),a("section",jy,[ne(Ae,{name:"loading",mode:"out-in"},{default:pe(()=>[d.value?(c(),u("div",Vy,[...h[22]||(h[22]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):g.value?(c(),u("div",zy,[h[23]||(h[23]=a("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),h[24]||(h[24]=a("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),a("p",Gy,m(g.value),1),a("button",{class:"btn btn-retry",onClick:fe},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):l.value.length===0?(c(),u("div",Ky,[h[25]||(h[25]=a("div",{class:"empty-state-icon"},"üìã",-1)),a("p",qy,m(t.value==="employees"?`–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${n.value?.label||""}"`:"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é"),1)])):(c(),u("div",Yy,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:pe(()=>[(c(!0),u(ee,null,te(w.value,(_,B)=>(c(),he(Ct,{key:_.id,ticket:_,draggable:!1,style:we({"--ticket-index":B}),onClick:Z},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):A("",!0)]),_:1})])])):A("",!0)}},Jy=de(Xy,[["__scopeId","data-v-6f43202a"]]),Zy={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Qy={class:"modal"},ek={key:"level-1",class:"level-1"},tk={class:"modal__header"},sk={class:"modal__title"},ak={key:0},ok={class:"modal__body"},nk={key:"loading",class:"loading-names"},rk={key:"empty",class:"modal__empty"},ik={key:"list",class:"stages-list"},lk=["onClick"],ck={class:"stages-list__name"},dk={class:"stages-list__count"},uk={key:0,class:"stages-list__arrow"},gk={class:"modal__footer"},mk={key:"level-2",class:"level-2"},hk={class:"modal__header"},fk={class:"modal__title"},vk={class:"modal__body"},pk={class:"time-sort-controls"},yk={class:"time-sort-buttons"},kk=["onClick"],bk={class:"count"},_k={key:"loading",class:"loading-state"},wk={key:"error",class:"error-state"},Ck={class:"error-message"},Tk={key:"empty",class:"empty-state"},Sk={class:"empty-state-message"},Dk={key:"tickets",class:"tickets-list-container"},Ek={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(o,{emit:e}){const s=o,t=I(1),r=I(null),i=I([]),n=I(!1),l=I(!1),d=I(null),g=I([]),p=I(it.ONE_MONTH),T=M(()=>g.value.length>0&&g.value.some(L=>L.count>0)),v=M(()=>{if(!i.value||i.value.length===0)return[];try{const L=performance.now(),D=ps(i.value,p.value),E=performance.now();return console.log(`[StagesModal] Filtering took ${(E-L).toFixed(2)}ms, results: ${D.length}`),D}catch(L){return console.error("[StagesModal] Error filtering tickets:",L),[]}}),y=M(()=>Object.keys(Ut).map(L=>({key:L,label:Ut[L],count:ps(i.value,L).length})));async function k(){if(console.log("[TASK-070] StagesModal: loadStages called",{weekNumber:s.weekNumber,weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc}),!s.weekStartUtc||!s.weekEndUtc){console.warn("[TASK-070] StagesModal: Missing week boundaries, cannot load stages"),g.value=[];return}l.value=!0,d.value=null;try{console.log("[TASK-070] StagesModal: Fetching stages from API...");const L=await Ft({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeNewTicketsByStages:!0});console.log("[TASK-070] StagesModal: API response received",{hasNewTicketsByStages:!!L.data.newTicketsByStages,stagesCount:L.data.newTicketsByStages?.length||0}),g.value=L.data.newTicketsByStages||[],g.value.length===0?console.warn("[TASK-070] StagesModal: API returned empty stages array for week",s.weekNumber):console.log("[TASK-070] StagesModal: Stages loaded successfully",g.value.length,"stages")}catch(L){d.value=L.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–π",console.error("[TASK-070] StagesModal: Error loading stages:",L),g.value=[]}finally{l.value=!1}}async function S(L,D=null){!L||L.count===0||(D&&D.currentTarget&&(D.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{D.currentTarget&&(D.currentTarget.style.transform="")},150)),r.value=L,t.value=2,await C(L.stageId))}async function C(L){n.value=!0,d.value=null;try{const D=g.value.find(U=>U.stageId===L);if(D&&Array.isArray(D.tickets)&&D.tickets.length>0){console.log("[TASK-070] StagesModal: Using preloaded tickets for stage",L,"count:",D.tickets.length);const U=D.tickets;try{const{prepareTicketsForDisplay:G}=await Se(async()=>{const{prepareTicketsForDisplay:q}=await import("./chunk-yvHyt3PJ.js").then(oe=>oe.t);return{prepareTicketsForDisplay:q}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);i.value=await G(U,null,null)}catch(G){console.error("[TASK-070] StagesModal: Error preparing tickets:",G),i.value=U}n.value=!1;return}if(console.log("[TASK-070] StagesModal: Tickets not preloaded, loading from API for stage",L),!s.weekStartUtc||!s.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const R=(await Ft({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages?.find(U=>U.stageId===L)?.tickets||[];try{const{prepareTicketsForDisplay:U}=await Se(async()=>{const{prepareTicketsForDisplay:G}=await import("./chunk-yvHyt3PJ.js").then(q=>q.t);return{prepareTicketsForDisplay:G}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);i.value=await U(R,null,null)}catch(U){console.error("[StagesModal] Error preparing tickets:",U),i.value=R}i.value.length===0&&(d.value=null)}catch(D){d.value=D.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[StagesModal] Error loading tickets:",D),i.value=[]}finally{n.value=!1}}function f(){t.value=1,r.value=null,i.value=[],d.value=null}function w(L){const D=ss(L.id);window.open(D,"_blank")}function $(){r.value&&C(r.value.stageId)}function W(L){console.log(`[StagesModal] Sort mode changed: ${p.value} -> ${L}`);const D=performance.now();p.value=L,setTimeout(()=>{const E=v.value,x=performance.now();console.log(`[StagesModal] Filtering completed in ${(x-D).toFixed(2)}ms, ${E.length} tickets shown`)},0)}return Ne(()=>s.isVisible,async L=>{L?(t.value=1,r.value=null,i.value=[],d.value=null,console.log("[TASK-070] StagesModal opened:",{weekNumber:s.weekNumber,weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,preloadedData:s.preloadedData?Array.isArray(s.preloadedData)?`Array(${s.preloadedData.length})`:typeof s.preloadedData:"null"}),s.preloadedData&&Array.isArray(s.preloadedData)&&s.preloadedData.length>0?(console.log("[TASK-070] StagesModal: Using preloaded data, stages count:",s.preloadedData.length),s.preloadedData.every(E=>E.stageId&&E.stageName&&typeof E.count=="number")?(g.value=s.preloadedData,l.value=!1,console.log("[TASK-070] StagesModal: Preloaded data set, stages:",g.value.length)):(console.warn("[TASK-070] StagesModal: Invalid preloaded data structure, falling back to API"),await k())):(console.log("[TASK-070] StagesModal: No preloaded data, loading from API",{weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc}),await k())):(t.value=1,r.value=null,i.value=[],d.value=null,g.value=[])},{immediate:!1}),Ne([()=>s.weekNumber,()=>s.preloadedData],async([L,D])=>{s.isVisible&&L&&(D&&Array.isArray(D)&&D.length>0?D.every(x=>x.stageId&&x.stageName&&typeof x.count=="number")?(console.log("[TASK-070] StagesModal: Week changed, updating with preloaded data for week",L),g.value=D,l.value=!1):(console.log("[TASK-070] StagesModal: Week changed, invalid preloaded data, loading from API for week",L),await k()):(console.log("[TASK-070] StagesModal: Week changed, loading from API for week",L),await k()))}),(L,D)=>o.isVisible?(c(),u("div",Zy,[a("div",Qy,[ne(Ae,{name:"level",mode:"out-in"},{default:pe(()=>[t.value===1?(c(),u("div",ek,[a("header",tk,[a("h3",sk,[D[3]||(D[3]=ce(" –ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),o.weekNumber?(c(),u("span",ak," ¬∑ –ù–µ–¥–µ–ª—è "+m(o.weekNumber),1)):A("",!0)]),a("button",{class:"modal__close",onClick:D[0]||(D[0]=E=>L.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),a("section",ok,[ne(Ae,{name:"loading",mode:"out-in"},{default:pe(()=>[l.value?(c(),u("div",nk,[...D[4]||(D[4]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–π...",-1)])])):T.value?(c(),u("ul",ik,[(c(!0),u(ee,null,te(g.value,E=>(c(),u("li",{key:E.stageId,class:X(["stages-list__item",{"stages-list__item--clickable":E.count>0}]),style:we({"--stage-color":E.color}),onClick:x=>S(E,x),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏"},[a("span",{class:"stages-list__color",style:we({backgroundColor:E.color})},null,4),a("span",ck,m(E.stageName),1),a("span",dk,m(E.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),E.count>0?(c(),u("span",uk,"‚Üí")):A("",!0)],14,lk))),128))])):(c(),u("p",rk," –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),a("footer",gk,[a("button",{class:"btn",onClick:D[1]||(D[1]=E=>L.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value===2?(c(),u("div",mk,[a("header",hk,[a("button",{class:"btn-back",onClick:f,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),a("h3",fk," –¢–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏: "+m(r.value?.stageName||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),a("button",{class:"modal__close",onClick:D[2]||(D[2]=E=>L.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),a("section",vk,[a("div",pk,[D[5]||(D[5]=a("h4",{class:"time-sort-title"},"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–∏–∫–µ—Ç—ã:",-1)),a("div",yk,[(c(!0),u(ee,null,te(y.value,E=>(c(),u("button",{key:E.key,class:X(["time-sort-btn",{active:p.value===E.key}]),onClick:x=>W(E.key)},[ce(m(E.label)+" ",1),a("span",bk,"("+m(E.count)+")",1)],10,kk))),128))])]),ne(Ae,{name:"loading",mode:"out-in"},{default:pe(()=>[n.value?(c(),u("div",_k,[...D[6]||(D[6]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏...",-1),a("p",{class:"loading-subtitle"},"–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö",-1)])])):d.value?(c(),u("div",wk,[D[7]||(D[7]=a("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),D[8]||(D[8]=a("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),a("p",Ck,m(d.value),1),a("button",{class:"btn btn-retry",onClick:$},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):v.value.length===0?(c(),u("div",Tk,[D[9]||(D[9]=a("div",{class:"empty-state-icon"},"üìã",-1)),a("p",Sk," –ù–∞ —Å—Ç–∞–¥–∏–∏ ¬´"+m(r.value?.stageName)+"¬ª –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ("+m(Ue(Ut)[p.value])+") ",1)])):(c(),u("div",Dk,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:pe(()=>[(c(!0),u(ee,null,te(v.value,(E,x)=>(c(),he(Ct,{key:E.id,ticket:E,draggable:!1,style:we({"--ticket-index":x}),onClick:w},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):A("",!0)]),_:1})])])):A("",!0)}},Ak=de(Ek,[["__scopeId","data-v-0dacaef9"]]),Pt=new Map,$k=5*60*1e3;function Ik(o,e){return`${o}:${JSON.stringify(e)}`}function ra(o){return Date.now()-o.timestamp<$k}function Mk(o,e){if(Pt.set(o,{data:e,timestamp:Date.now()}),Pt.size>20){const s=Pt.keys().next().value;Pt.delete(s)}}function Nk(o){const e=Pt.get(o);return e&&ra(e)?(console.log("[API-CACHE] Cache hit for key:",o),e.data):(e&&!ra(e)&&(console.log("[API-CACHE] Cache expired for key:",o),Pt.delete(o)),null)}async function xk(o={}){const e="/api/graph-1c-admission-closure.php",s=Ik(e,o),t=Nk(e);if(t)return t;console.log("[API-CACHE] Cache miss, making API request for:",s);const{LazyServiceLoader:r}=await Se(async()=>{const{LazyServiceLoader:l}=await import("./chunk-D3JwNzSL.js").then(d=>d.l);return{LazyServiceLoader:l}},__vite__mapDeps([3,4]),import.meta.url),{fetchAdmissionClosureStats:i}=await r.loadAdmissionClosureService(),n=await i(o);return Mk(s,n),n}async function Lk(o,e){return xk({product:"1C",weekStartUtc:o,weekEndUtc:e,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})}const Pk={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Ok={class:"modal"},Rk={key:"level-1",class:"level-1"},Bk={class:"modal__header"},Uk={class:"modal__title"},Wk={key:0},Fk={class:"modal__body"},Hk={key:"loading",class:"loading-names"},jk={key:"empty",class:"modal__empty"},Vk={key:"list",class:"duration-list"},zk=["onClick"],Gk={class:"duration-list__name"},Kk={class:"duration-list__count"},qk={key:0,class:"duration-list__arrow"},Yk={class:"modal__footer"},Xk={key:"level-2",class:"level-2"},Jk={class:"modal__header"},Zk={class:"modal__title"},Qk={class:"modal__body"},e0={key:"loading",class:"loading-state"},t0={key:"error",class:"error-state"},s0={class:"error-message"},a0={key:"empty",class:"empty-state"},o0={class:"empty-state-message"},n0={key:"tickets",class:"tickets-list-container"},r0={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(o,{emit:e}){const s=o,t=I(1),r=I(null),i=I([]),n=I(!1),l=I(!1),d=I(null),g=I([]),p=M(()=>g.value.length>0&&g.value.some(f=>f.count>0));async function T(){if(!s.weekStartUtc||!s.weekEndUtc){g.value=[];return}l.value=!0,d.value=null;try{const f=await Ft({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});g.value=f.data.carryoverTicketsByDuration||[]}catch(f){d.value=f.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π",console.error("[CarryoverDurationModal] Error loading categories:",f),g.value=[]}finally{l.value=!1}}async function v(f,w=null){!f||f.count===0||(w&&w.currentTarget&&(w.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{w.currentTarget&&(w.currentTarget.style.transform="")},150)),r.value=f,t.value=2,await y(f.durationCategory))}async function y(f){n.value=!0,d.value=null;try{const w=g.value.find(D=>D.durationCategory===f);if(w&&Array.isArray(w.tickets)&&w.tickets.length>0){console.log("[TASK-070] CarryoverDurationModal: Using preloaded tickets for category",f,"count:",w.tickets.length);const D=w.tickets;try{const{prepareTicketsForDisplay:E}=await Se(async()=>{const{prepareTicketsForDisplay:x}=await import("./chunk-yvHyt3PJ.js").then(R=>R.t);return{prepareTicketsForDisplay:x}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);i.value=await E(D,null,null)}catch(E){console.error("[TASK-070] CarryoverDurationModal: Error preparing tickets:",E),i.value=D}n.value=!1;return}if(console.log("[TASK-070] CarryoverDurationModal: Tickets not preloaded, loading from API for category",f),!s.weekStartUtc||!s.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const L=(await Lk(s.weekStartUtc,s.weekEndUtc)).data.carryoverTicketsByDuration?.find(D=>D.durationCategory===f)?.tickets||[];try{const{prepareTicketsForDisplay:D}=await Se(async()=>{const{prepareTicketsForDisplay:E}=await import("./chunk-yvHyt3PJ.js").then(x=>x.t);return{prepareTicketsForDisplay:E}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);i.value=await D(L,null,null)}catch(D){console.error("[CarryoverDurationModal] Error preparing tickets:",D),i.value=L}i.value.length===0&&(d.value=null)}catch(w){d.value=w.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[CarryoverDurationModal] Error loading tickets:",w),i.value=[]}finally{n.value=!1}}function k(){t.value=1,r.value=null,i.value=[],d.value=null}function S(f){const w=ss(f.id);window.open(w,"_blank")}function C(){r.value&&y(r.value.durationCategory)}return Ne(()=>s.isVisible,async f=>{f?(t.value=1,r.value=null,i.value=[],d.value=null,s.preloadedData&&Array.isArray(s.preloadedData)&&s.preloadedData.length>0?(console.log("[TASK-070] CarryoverDurationModal: Using preloaded data, categories count:",s.preloadedData.length),s.preloadedData.every($=>$.durationCategory&&$.durationLabel&&typeof $.count=="number")?(g.value=s.preloadedData,l.value=!1):(console.warn("[TASK-070] CarryoverDurationModal: Invalid preloaded data structure, falling back to API"),await T())):(console.log("[TASK-070] CarryoverDurationModal: No preloaded data, loading from API"),await T())):(t.value=1,r.value=null,i.value=[],d.value=null,g.value=[])},{immediate:!1}),Ne([()=>s.weekNumber,()=>s.preloadedData],async([f,w])=>{s.isVisible&&f&&(w&&Array.isArray(w)&&w.length>0?w.every(W=>W.durationCategory&&W.durationLabel&&typeof W.count=="number")?(console.log("[TASK-070] CarryoverDurationModal: Week changed, updating with preloaded data for week",f),g.value=w,l.value=!1):(console.log("[TASK-070] CarryoverDurationModal: Week changed, invalid preloaded data, loading from API for week",f),await T()):(console.log("[TASK-070] CarryoverDurationModal: Week changed, loading from API for week",f),await T()))}),(f,w)=>o.isVisible?(c(),u("div",Pk,[a("div",Ok,[ne(Ae,{name:"level",mode:"out-in"},{default:pe(()=>[t.value===1?(c(),u("div",Rk,[a("header",Bk,[a("h3",Uk,[w[3]||(w[3]=ce(" –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ä–æ–∫–∞–º",-1)),o.weekNumber?(c(),u("span",Wk," ¬∑ –ù–µ–¥–µ–ª—è "+m(o.weekNumber),1)):A("",!0)]),a("button",{class:"modal__close",onClick:w[0]||(w[0]=$=>f.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),a("section",Fk,[ne(Ae,{name:"loading",mode:"out-in"},{default:pe(()=>[l.value?(c(),u("div",Hk,[...w[4]||(w[4]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...",-1)])])):p.value?(c(),u("ul",Vk,[(c(!0),u(ee,null,te(g.value,$=>(c(),u("li",{key:$.durationCategory,class:X(["duration-list__item",{"duration-list__item--clickable":$.count>0}]),style:we({"--duration-color":$.color}),onClick:W=>v($,W),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},[a("span",{class:"duration-list__color",style:we({backgroundColor:$.color})},null,4),a("span",Gk,m($.durationLabel),1),a("span",Kk,m($.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),$.count>0?(c(),u("span",qk,"‚Üí")):A("",!0)],14,zk))),128))])):(c(),u("p",jk," –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),a("footer",Yk,[a("button",{class:"btn",onClick:w[1]||(w[1]=$=>f.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value===2?(c(),u("div",Xk,[a("header",Jk,[a("button",{class:"btn-back",onClick:k,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),a("h3",Zk," –¢–∏–∫–µ—Ç—ã: "+m(r.value?.durationLabel||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),a("button",{class:"modal__close",onClick:w[2]||(w[2]=$=>f.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),a("section",Qk,[ne(Ae,{name:"loading",mode:"out-in"},{default:pe(()=>[n.value?(c(),u("div",e0,[...w[5]||(w[5]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...",-1),a("p",{class:"loading-subtitle"},"–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö",-1)])])):d.value?(c(),u("div",t0,[w[6]||(w[6]=a("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),w[7]||(w[7]=a("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),a("p",s0,m(d.value),1),a("button",{class:"btn btn-retry",onClick:C},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):i.value.length===0?(c(),u("div",a0,[w[8]||(w[8]=a("div",{class:"empty-state-icon"},"üìã",-1)),a("p",o0," –í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´"+m(r.value?.durationLabel)+"¬ª –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ ",1)])):(c(),u("div",n0,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:pe(()=>[(c(!0),u(ee,null,te(i.value,($,W)=>(c(),he(Ct,{key:$.id,ticket:$,draggable:!1,style:we({"--ticket-index":W}),onClick:S},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):A("",!0)]),_:1})])])):A("",!0)}},i0=de(r0,[["__scopeId","data-v-f199806c"]]);function l0(){const o=I(null),e=I(!1),s=I(null),t=async()=>{if(o.value)return o.value;try{e.value=!0,s.value=null;const{fetchAdmissionClosureStats:n,...l}=await bo.loadAdmissionClosureService();o.value={fetchAdmissionClosureStats:n,...l}}catch(n){throw s.value=n,console.error("Failed to load admission service:",n),n}finally{e.value=!1}return o.value},r=async(n={})=>(await t()).fetchAdmissionClosureStats(n),i=()=>{o.value=null,s.value=null};return{service:Cs(o),loading:Cs(e),error:Cs(s),loadService:t,fetchStats:r,clearService:i}}const c0={class:"ac-dashboard"},d0={key:"preloader",class:"chart-preloader"},u0={class:"preloader-content"},g0={class:"preloader-message"},m0={key:"content"},h0={key:1,class:"weeks-dashboard"},f0={class:"dashboard-header"},v0={class:"header-content"},p0={class:"breadcrumbs-row"},y0=["aria-label","aria-disabled","data-fallback","disabled"],k0={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},b0={class:"dashboard-layout"},_0={class:"filters-container"},w0={class:"chart-container"},C0={__name:"GraphAdmissionClosureDashboard",setup(o){const e=Xe(),{fetchStats:s}=l0(),t=async b=>await s(b),r=I(!1),i=I(null),n=I(null),l=I({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),d=I(!1),g=I(!1),p=I(!1),T=I(!0),v=I(null),y=I({weeks:new Map,currentWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null},previousWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null}}),k=M(()=>{const b=n.value?.weeks||[];return b.length>=2?b[b.length-2]:null}),S=I(!1),C=M(()=>typeof window>"u"?!1:window.history.length>1),f=M(()=>C.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),w={name:"dashboard-sector-1c"};function $(b){if(b?.preventDefault?.(),!S.value){S.value=!0;try{if(C.value){e.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),e.push(w)}finally{S.value=!1}}}function W(){e.push("/")}const L=I({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),D=I("weeks"),E=M(()=>{const b=L.value.customDateRange.startDate||L.value.customDateRange.endDate,O=L.value.employees.length===1&&L.value.employees.includes("all");return b||!O});async function x(){if(console.log("[DEBUG] loadData called"),console.log("[DEBUG] periodMode:",D.value),console.log("[DEBUG] isLoading before:",r.value),D.value!=="weeks"){console.log("[DEBUG] loadData: periodMode is not weeks, returning and resetting isLoading"),r.value=!1;return}console.log("[DEBUG] Setting isLoading to true"),r.value=!0,i.value=null;const b=new Promise(O=>setTimeout(O,300));try{console.log("[DEBUG] Starting API call");const O=N(),Q=O.weekStartUtc,ue=O.weekEndUtc;console.log("[DEBUG] Week bounds:",{weekStartUtc:Q,weekEndUtc:ue});const[ke,_e]=await Promise.all([b,t({product:"1C",periodMode:"weeks",weekStartUtc:Q,weekEndUtc:ue,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0})]);console.log("[DEBUG] API call successful, result:",_e);const{meta:K,data:j,carryoverDebug:V}=_e;n.value=K;const se=Array.isArray(j.responsibleCreatedThisWeek)?j.responsibleCreatedThisWeek:j.responsibleCreatedThisWeek?Object.values(j.responsibleCreatedThisWeek):[],ge=Array.isArray(j.responsibleCreatedOtherWeek)?j.responsibleCreatedOtherWeek:j.responsibleCreatedOtherWeek?Object.values(j.responsibleCreatedOtherWeek):[];l.value={...j,responsibleCreatedThisWeek:se,responsibleCreatedOtherWeek:ge},console.log("[DEBUG] Data set, meta:",K,"data keys:",Object.keys(j)),console.log("[TASK-070] chartData.value.responsibleCreatedThisWeek after normalization:",{isArray:Array.isArray(se),length:se.length,sample:se.slice(0,2).map(F=>({id:F.id,name:F.name,count:F.count,hasTickets:!!F.tickets,ticketsCount:F.tickets?.length||0}))}),console.log("[TASK-070] chartData.value.responsibleCreatedOtherWeek after normalization:",{isArray:Array.isArray(ge),length:ge.length,sample:ge.slice(0,2).map(F=>({id:F.id,name:F.name,count:F.count,hasTickets:!!F.tickets,ticketsCount:F.tickets?.length||0}))}),console.log("[TASK-070] responsibleCreatedThisWeek from API:",{count:j.responsibleCreatedThisWeek?.length||0,data:j.responsibleCreatedThisWeek,details:j.responsibleCreatedThisWeek?.map(F=>({id:F.id,name:F.name,count:F.count,hasTickets:!!F.tickets,ticketsCount:F.tickets?.length||0}))}),console.log("[TASK-070] responsibleCreatedOtherWeek from API:",{count:j.responsibleCreatedOtherWeek?.length||0,data:j.responsibleCreatedOtherWeek,details:j.responsibleCreatedOtherWeek?.map(F=>({id:F.id,name:F.name,count:F.count,hasTickets:!!F.tickets,ticketsCount:F.tickets?.length||0}))}),console.log("[TASK-070] closedTicketsCreatedThisWeek:",j.closedTicketsCreatedThisWeek),console.log("[TASK-070] closedTicketsCreatedOtherWeek:",j.closedTicketsCreatedOtherWeek);const ye=K?.weeks||[];if(console.log("[PERF-OPTIMIZATION] Preloading popup data for",ye.length,"weeks"),ye.forEach((F,ie)=>{y.value.weeks.has(F.weekNumber)||y.value.weeks.set(F.weekNumber,{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:F});const ve=y.value.weeks.get(F.weekNumber);ie===ye.length-1&&(j.newTicketsByStages&&(ve.newTicketsByStages=j.newTicketsByStages,console.log("[PERF-OPTIMIZATION] Preloaded newTicketsByStages for week",F.weekNumber,":",j.newTicketsByStages.length,"stages")),j.carryoverTicketsByDuration&&(ve.carryoverTicketsByDuration=j.carryoverTicketsByDuration,console.log("[PERF-OPTIMIZATION] Preloaded carryoverTicketsByDuration for week",F.weekNumber,":",j.carryoverTicketsByDuration.length,"categories")))}),j.newTicketsByStages&&(y.value.currentWeek.newTicketsByStages=j.newTicketsByStages),j.carryoverTicketsByDuration&&(y.value.currentWeek.carryoverTicketsByDuration=j.carryoverTicketsByDuration),ye.length>1&&G(ye.slice(0,-1)),j.responsibleCreatedThisWeek){const F=Array.isArray(j.responsibleCreatedThisWeek)?j.responsibleCreatedThisWeek:Object.values(j.responsibleCreatedThisWeek);y.value.currentWeek.responsibleCreatedThisWeek=F,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for current week:",F.length,"employees"),console.log("[TASK-070] responsibleCreatedThisWeek details:",F.map(ie=>({id:ie.id,name:ie.name,count:ie.count,hasTickets:!!ie.tickets,ticketsCount:ie.tickets?.length||0})))}if(j.responsibleCreatedOtherWeek){const F=Array.isArray(j.responsibleCreatedOtherWeek)?j.responsibleCreatedOtherWeek:Object.values(j.responsibleCreatedOtherWeek);y.value.currentWeek.responsibleCreatedOtherWeek=F,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for current week:",F.length,"employees"),console.log("[TASK-070] responsibleCreatedOtherWeek details:",F.map(ie=>({id:ie.id,name:ie.name,count:ie.count,hasTickets:!!ie.tickets,ticketsCount:ie.tickets?.length||0})))}if(V&&(console.log("[CARRYOVER-DEBUG] ========================================"),console.log("[CARRYOVER-DEBUG] Total:",V.total),console.log("[CARRYOVER-DEBUG] ThisWeek:",V.thisWeek),console.log("[CARRYOVER-DEBUG] PreviousWeek:",V.previousWeek),console.log("[CARRYOVER-DEBUG] Older:",V.older),console.log("[CARRYOVER-DEBUG] Sum:",V.sum,"(expected:",V.total,")"),console.log("[CARRYOVER-DEBUG] Series:",V.series),console.log("[CARRYOVER-DEBUG] CurrentWeekData:",V.currentWeekData),console.log("[CARRYOVER-DEBUG] WeeksData:",V.weeksData),console.log("[CARRYOVER-DEBUG] Full object:",V),console.log("[CARRYOVER-DEBUG] ========================================")),k.value){const F=k.value.weekStartUtc,ie=k.value.weekEndUtc;console.log("[TASK-070] Starting preload for previous week:",{weekNumber:k.value.weekNumber,weekStartUtc:F,weekEndUtc:ie}),t({product:"1C",periodMode:"weeks",weekStartUtc:F,weekEndUtc:ie,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0}).then(ve=>{if(console.log("[TASK-070] Preload successful for previous week"),ve.data.newTicketsByStages&&(y.value.previousWeek.newTicketsByStages=ve.data.newTicketsByStages,console.log("[TASK-070] Preloaded newTicketsByStages for previous week:",ve.data.newTicketsByStages.length,"stages")),ve.data.carryoverTicketsByDuration&&(y.value.previousWeek.carryoverTicketsByDuration=ve.data.carryoverTicketsByDuration,console.log("[TASK-070] Preloaded carryoverTicketsByDuration for previous week:",ve.data.carryoverTicketsByDuration.length,"categories")),ve.data.responsibleCreatedThisWeek){const Te=Array.isArray(ve.data.responsibleCreatedThisWeek)?ve.data.responsibleCreatedThisWeek:Object.values(ve.data.responsibleCreatedThisWeek);y.value.previousWeek.responsibleCreatedThisWeek=Te,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for previous week:",Te.length,"employees")}if(ve.data.responsibleCreatedOtherWeek){const Te=Array.isArray(ve.data.responsibleCreatedOtherWeek)?ve.data.responsibleCreatedOtherWeek:Object.values(ve.data.responsibleCreatedOtherWeek);y.value.previousWeek.responsibleCreatedOtherWeek=Te,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for previous week:",Te.length,"employees")}}).catch(ve=>{console.warn("[TASK-070] Failed to preload previous week data (non-critical):",ve)})}}catch(O){console.error("[DEBUG] API call failed:",O),i.value=O instanceof Error?O:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureDashboard] loadData error:",O)}finally{console.log("[DEBUG] Finally block: setting isLoading to false"),r.value=!1,console.log("[DEBUG] isLoading after:",r.value)}}function R(b){if(!b||!n.value)return console.log("[TASK-070] getPreloadedStagesData: Missing weekMeta or chartMeta"),null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber,ue=O.length>=2?O[O.length-2].weekNumber:null;console.log("[TASK-070] getPreloadedStagesData:",{requestedWeek:b.weekNumber,currentWeekNumber:Q,previousWeekNumber:ue,weeksInMeta:O.length});const ke=b.weekNumber===Q,_e=b.weekNumber===ue;let K=null;if(ke)K=y.value.currentWeek.newTicketsByStages,console.log("[TASK-070] Requested week is current week, checking currentWeek data:",K?`Array(${K.length})`:"null");else if(_e)K=y.value.previousWeek.newTicketsByStages,console.log("[TASK-070] Requested week is previous week, checking previousWeek data:",K?`Array(${K.length})`:"null");else return console.log("[TASK-070] Requested week",b.weekNumber,"is neither current nor previous, no preloaded data available"),null;return Array.isArray(K)&&K.length>0?(console.log("[TASK-070] Using preloaded stages data for week",b.weekNumber,":",K.length,"stages"),K):(console.log("[TASK-070] No preloaded stages data for week",b.weekNumber,", will use API fallback"),null)}function U(b){if(!b)return null;const O=y.value.weeks.get(b.weekNumber);if(O?.carryoverTicketsByDuration&&Array.isArray(O.carryoverTicketsByDuration))return console.log("[PERF-OPTIMIZATION] Using preloaded carryover data for week",b.weekNumber,":",O.carryoverTicketsByDuration.length,"categories"),O.carryoverTicketsByDuration;const Q=n.value?.weeks||[],ue=Q.length>0?Q[Q.length-1].weekNumber:n.value.weekNumber,_e=b.weekNumber===ue?y.value.currentWeek.carryoverTicketsByDuration:y.value.previousWeek.carryoverTicketsByDuration;return Array.isArray(_e)&&_e.length>0?(console.log("[TASK-070] Using fallback preloaded carryover data for week",b.weekNumber,":",_e.length,"categories"),_e):(console.log("[PERF-ISSUE] No preloaded carryover data for week",b.weekNumber,", will use slow API fallback"),null)}async function G(b){if(!(!b||b.length===0)){console.log("[PERF-OPTIMIZATION] Starting background preload for",b.length,"weeks");for(const O of b)try{await new Promise(ke=>setTimeout(ke,500)),console.log("[PERF-OPTIMIZATION] Preloading data for week",O.weekNumber);const Q=await t({product:"1C",periodMode:"weeks",weekStartUtc:O.weekStartUtc,weekEndUtc:O.weekEndUtc,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!1}),ue={newTicketsByStages:Q.data.newTicketsByStages||null,carryoverTicketsByDuration:Q.data.carryoverTicketsByDuration||null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:O};y.value.weeks.set(O.weekNumber,ue),console.log("[PERF-OPTIMIZATION] Successfully preloaded data for week",O.weekNumber)}catch(Q){console.warn("[PERF-OPTIMIZATION] Failed to preload data for week",O.weekNumber,":",Q)}console.log("[PERF-OPTIMIZATION] Background preload completed")}}function q(b){if(!b||!n.value)return null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber;return b.weekNumber===Q&&l.value.responsible||null}function oe(b){if(!b){const K=l.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: weekMeta is null, using chartData:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:K?Object.keys(K).length:0}),K?Array.isArray(K)?K:Object.values(K):null}if(!n.value)return console.log("[TASK-070] getResponsibleCreatedThisWeek: chartMeta is null"),null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber,ue=O.length>=2?O[O.length-2].weekNumber:null,ke=b.weekNumber===Q,_e=b.weekNumber===ue;if(console.log("[TASK-070] getResponsibleCreatedThisWeek:",{requestedWeek:b.weekNumber,currentWeekNumber:Q,previousWeekNumber:ue,isCurrentWeek:ke,isPreviousWeek:_e}),ke){const K=l.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: current week data:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:K?Object.keys(K).length:0}),K?Array.isArray(K)?K:Object.values(K):null}if(_e){const K=y.value.previousWeek.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: previous week data:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:0,data:K}),K||null}return console.log("[TASK-070] getResponsibleCreatedThisWeek: week",b.weekNumber,"is neither current nor previous, no preloaded data"),null}function Y(b){if(!b){const K=l.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: weekMeta is null, using chartData:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:K?Object.keys(K).length:0}),K?Array.isArray(K)?K:Object.values(K):null}if(!n.value)return console.log("[TASK-070] getResponsibleCreatedOtherWeek: chartMeta is null"),null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber,ue=O.length>=2?O[O.length-2].weekNumber:null,ke=b.weekNumber===Q,_e=b.weekNumber===ue;if(console.log("[TASK-070] getResponsibleCreatedOtherWeek:",{requestedWeek:b.weekNumber,currentWeekNumber:Q,previousWeekNumber:ue,isCurrentWeek:ke,isPreviousWeek:_e}),ke){const K=l.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: current week data:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:K?Object.keys(K).length:0}),K?Array.isArray(K)?K:Object.values(K):null}if(_e){const K=y.value.previousWeek.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: previous week data:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:0,data:K}),K||null}return console.log("[TASK-070] getResponsibleCreatedOtherWeek: week",b.weekNumber,"is neither current nor previous, no preloaded data"),null}function H(b){if(!b||!n.value)return null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber,ue=O.length>=2?O[O.length-2].weekNumber:null,ke=b.weekNumber===Q,_e=b.weekNumber===ue;return ke?l.value.closedTicketsCreatedThisWeek??null:_e&&l.value.weeksData?l.value.weeksData.find(j=>j.weekNumber===ue)?.closedTicketsCreatedThisWeek??null:null}function Z(b){if(!b||!n.value)return null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber,ue=O.length>=2?O[O.length-2].weekNumber:null,ke=b.weekNumber===Q,_e=b.weekNumber===ue;return ke?l.value.closedTicketsCreatedOtherWeek??null:_e&&l.value.weeksData?l.value.weeksData.find(j=>j.weekNumber===ue)?.closedTicketsCreatedOtherWeek??null:null}function fe(b){L.value.stages=b}function P(b){L.value.employees=b}function h(b){L.value.dateRange=b}function _(b){L.value.customDateRange=b}function B(b){if(!["weeks","months"].includes(b)){console.warn("[GraphAdmissionClosureDashboard] Invalid periodMode:",b);return}b!==D.value&&(D.value=b,b==="weeks"?x():b==="months"&&(r.value=!1))}function re(b){const{mode:O}=b.detail;["weeks","months"].includes(O)&&B(O)}function le(){L.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},ae()}function ae(){D.value==="weeks"&&x()}function me(b){["weeks","months"].includes(b)&&(D.value=b)}function De(){console.log("[DEBUG] handleCloseModal called"),console.log("[DEBUG] showPeriodModeInfo before:",T.value),console.log("[DEBUG] isLoading before:",r.value),console.log("[DEBUG] periodMode:",D.value),T.value=!1,r.value=!0,console.log("[DEBUG] showPeriodModeInfo after:",T.value),console.log("[DEBUG] isLoading after:",r.value),Wt(()=>{console.log("[DEBUG] handleCloseModal: calling handleStartLoading in nextTick"),Ie()})}function Ie(){console.log("[DEBUG] handleStartLoading called"),console.log("[DEBUG] periodMode before check:",D.value),console.log("[DEBUG] showPeriodModeInfo:",T.value),console.log("[DEBUG] isLoading:",r.value),(!D.value||!["weeks","months"].includes(D.value))&&(console.warn('[GraphAdmissionClosureDashboard] Period mode not set, using default "weeks"'),D.value="weeks"),console.log("[GraphAdmissionClosureDashboard] Starting loading, periodMode:",D.value),Wt(()=>{console.log("[DEBUG] nextTick callback, periodMode:",D.value),console.log("[DEBUG] isLoading in nextTick:",r.value),D.value==="weeks"?(console.log("[GraphAdmissionClosureDashboard] Loading data for weeks mode"),x()):D.value==="months"&&(console.log("[GraphAdmissionClosureDashboard] Months mode - data will be loaded by GraphAdmissionClosureMonthsDashboard"),r.value=!1,console.log("[DEBUG] Reset parent isLoading to false for months mode"))})}function xe(b=null){b?v.value=b:v.value={weekNumber:n.value?.weekNumber||null,weekStartUtc:n.value?.weekStartUtc||null,weekEndUtc:n.value?.weekEndUtc||null},g.value=!0}function Fe(b=null){b?v.value=b:v.value={weekNumber:n.value?.weekNumber||null,weekStartUtc:n.value?.weekStartUtc||null,weekEndUtc:n.value?.weekEndUtc||null},d.value=!0}function z(b=null){b?v.value=b:v.value={weekNumber:n.value?.weekNumber||null,weekStartUtc:n.value?.weekStartUtc||null,weekEndUtc:n.value?.weekEndUtc||null},p.value=!0}$e(()=>{try{const b="graph-admission-closure-period-mode-info-shown";localStorage.getItem(b)&&localStorage.removeItem(b);const O="graph-admission-closure-period-mode";localStorage.getItem(O)&&localStorage.removeItem(O)}catch(b){console.warn("[GraphAdmissionClosureDashboard] Failed to clean localStorage:",b)}window.addEventListener("period-mode-change",re)}),st(()=>{window.removeEventListener("period-mode-change",re)});function N(){const b=new Date,O=new Date(Date.UTC(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate())),Q=O.getUTCDay(),ue=O.getUTCDate()-Q+(Q===0?-6:1),ke=new Date(Date.UTC(O.getUTCFullYear(),O.getUTCMonth(),ue,0,0,0)),_e=new Date(ke);return _e.setUTCDate(_e.getUTCDate()+6),_e.setUTCHours(23,59,59,999),{weekStartUtc:ke.toISOString(),weekEndUtc:_e.toISOString()}}return(b,O)=>{const Q=be("router-link");return c(),u("div",c0,[ne(Ae,{name:"fade",mode:"out-in"},{default:pe(()=>[r.value?(c(),u("div",d0,[a("div",u0,[O[3]||(O[3]=a("div",{class:"preloader-spinner"},[a("div",{class:"spinner-ring"}),a("div",{class:"spinner-ring"}),a("div",{class:"spinner-ring"})],-1)),O[4]||(O[4]=a("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞",-1)),a("p",g0," –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ "+m(D.value==="weeks"?"4 –Ω–µ–¥–µ–ª–∏":"3 –º–µ—Å—è—Ü–∞")+"... ",1),O[5]||(O[5]=a("div",{class:"preloader-dots"},[a("span",{class:"dot"}),a("span",{class:"dot"}),a("span",{class:"dot"})],-1))])])):!T.value&&!r.value?(c(),u("div",m0,[D.value==="months"?(c(),he(pp,{key:0})):(c(),u("div",h0,[a("div",f0,[a("div",v0,[a("div",p0,[a("button",{class:"btn-home-link",type:"button",onClick:W,title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),O[11]||(O[11]=a("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),a("button",{class:"btn-back-link",type:"button",onClick:$,"aria-label":f.value,"aria-disabled":!C.value,"data-fallback":!C.value,disabled:S.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,y0),a("nav",k0,[ne(Q,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:pe(()=>[...O[6]||(O[6]=[ce(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),O[8]||(O[8]=a("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ne(Q,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:pe(()=>[...O[7]||(O[7]=[ce(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),O[9]||(O[9]=a("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),O[10]||(O[10]=a("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),O[12]||(O[12]=a("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),O[13]||(O[13]=a("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),a("div",b0,[a("div",_0,[ne(js,{stages:L.value.stages,employees:L.value.employees,dateRange:L.value.dateRange,customDateRange:L.value.customDateRange,hasActiveFilters:E.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":D.value,"onUpdate:stages":fe,"onUpdate:employees":P,"onUpdate:dateRange":h,"onUpdate:customDateRange":_,"onUpdate:periodMode":B,onReset:le,onApply:ae},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","period-mode"])]),a("div",w0,[i.value?(c(),he(_s,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:i.value.message},null,8,["message"])):(c(),he(Mf,{key:1,meta:n.value,data:l.value,onOpenResponsible:Fe,onOpenStages:xe,onOpenCarryover:z},null,8,["meta","data"]))])])]))])):A("",!0)]),_:1}),ne(Jy,{"is-visible":d.value,responsible:q(v.value)||l.value.responsible||[],"closed-tickets-created-this-week":H(v.value)??l.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":Z(v.value)??l.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":oe(v.value)||l.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":Y(v.value)||l.value.responsibleCreatedOtherWeek||[],"week-number":v.value?.weekNumber||n.value?.weekNumber||null,"week-start-utc":v.value?.weekStartUtc||n.value?.weekStartUtc||null,"week-end-utc":v.value?.weekEndUtc||n.value?.weekEndUtc||null,onClose:O[0]||(O[0]=ue=>{d.value=!1,v.value.value=null})},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),ne(Ak,{"is-visible":g.value,"week-number":v.value?.weekNumber||n.value?.weekNumber||null,"week-start-utc":v.value?.weekStartUtc||n.value?.weekStartUtc||null,"week-end-utc":v.value?.weekEndUtc||n.value?.weekEndUtc||null,"preloaded-data":R(v.value),onClose:O[1]||(O[1]=ue=>{g.value=!1,v.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),ne(i0,{"is-visible":p.value,"week-number":v.value?.weekNumber||n.value?.weekNumber||null,"week-start-utc":v.value?.weekStartUtc||n.value?.weekStartUtc||null,"week-end-utc":v.value?.weekEndUtc||n.value?.weekEndUtc||null,"preloaded-data":U(v.value),onClose:O[2]||(O[2]=ue=>{p.value=!1,v.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),T.value?(c(),he(Dm,{key:0,"is-visible":T.value,"current-mode":D.value,onClose:De,onSelectMode:me},null,8,["is-visible","current-mode"])):A("",!0)])}}},Pa=de(C0,[["__scopeId","data-v-2fa9296d"]]),T0=Object.freeze(Object.defineProperty({__proto__:null,default:Pa},Symbol.toStringTag,{value:"Module"})),S0={name:"ZeroPoint",components:{TicketCard:Ct},props:{tickets:{type:Array,required:!0,default:()=>[]},stageId:{type:String,required:!0}},emits:{"ticket-dragged":o=>typeof o=="object"&&o!==null,"ticket-assigned":o=>typeof o=="object"&&o!==null,"ticket-clicked":o=>typeof o=="object"&&o!==null},setup(o,{emit:e}){return{hasTickets:M(()=>Array.isArray(o.tickets)&&o.tickets.length>0),handleTicketDragStart:r=>{e("ticket-dragged",r)}}}},D0={class:"zero-point"},E0={key:0,class:"empty-state"};function A0(o,e,s,t,r,i){const n=be("TicketCard");return c(),u("div",D0,[e[3]||(e[3]=a("div",{class:"zero-point-header"},[a("h3",null,"–ù—É–ª–µ–≤–∞—è —Ç–æ—á–∫–∞")],-1)),ls([s.tickets.length,s.tickets.map(l=>l.id).join(",")],()=>(c(),u("div",{class:"zero-point-tickets"},[(c(!0),u(ee,null,te(s.tickets,l=>(c(),he(n,{key:l.id,ticket:l,draggable:!0,onDragStart:d=>t.handleTicketDragStart(l),onClick:d=>o.$emit("ticket-clicked",l)},null,8,["ticket","onDragStart","onClick"]))),128))])),e,0),e[1]||(Xs(-1,!0),(e[1]=t.hasTickets?A("",!0):(c(),u("div",E0,[...e[2]||(e[2]=[a("p",null,"–ù–µ—Ç –Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –≤ —Å—Ç–∞–¥–∏–∏",-1)])]))).cacheIndex=1,Xs(1),e[1])])}const $0=de(S0,[["render",A0],["__scopeId","data-v-c5370e55"]]);function I0(o){return typeof o=="number"&&o>0&&!isNaN(o)}function Oa(o){return typeof o=="number"&&o>0&&!isNaN(o)}function Ra(o){return typeof o=="string"&&["formed","review","execution"].includes(o)}function M0(o){return!o||typeof o!="object"?!1:I0(o.id)&&typeof o.title=="string"&&o.title.trim().length>0}function Ba(o,e,s){return!(!M0(o)||!Oa(e)||!Ra(s)||o.assigneeId===e&&o.stageId===s)}function N0(o){const e=[];return!o||typeof o!="object"?(e.push("–î–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{valid:!1,errors:e}):((!o.title||typeof o.title!="string"||o.title.trim().length===0)&&e.push("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"),o.stageId&&!Ra(o.stageId)&&e.push("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Å—Ç–∞–¥–∏–∏"),o.employeeId&&!Oa(o.employeeId)&&e.push("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"),{valid:e.length===0,errors:e})}function x0(o){const e=mt(),s=I(!1);return{isDropZoneActive:s,handleDragStart:(d,g)=>{d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("application/json",JSON.stringify(g)),d.dataTransfer.setDragImage(d.target,0,0)},handleDragOver:d=>{d.preventDefault(),d.dataTransfer.dropEffect="move",s.value=!0},handleDragLeave:d=>{const g=d.currentTarget.getBoundingClientRect(),p=d.clientX,T=d.clientY;(p<g.left||p>g.right||T<g.top||T>g.bottom)&&(s.value=!1)},handleDrop:async(d,g,p)=>{d.preventDefault(),s.value=!1;const T=d.dataTransfer.getData("application/json");if(T)try{const v=JSON.parse(T);if(!Ba(v,g,p)){e.warning("–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–∫–µ—Ç —Å—é–¥–∞");return}o&&typeof o=="function"&&await o(v,g,p)}catch(v){Ee.error("Error parsing ticket data","useDragAndDrop",v),e.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ç–∞")}},handleDragEnd:d=>{s.value=!1}}}function Ua(o=null){const e=oo(),s=e?.type?.name||e?.type?.__name||null,t=o||s||"Unknown",r=(g,p,T=null)=>{Ee.log(g,p,t,T)};return{error:(g,p=null)=>{r("ERROR",g,p)},warn:(g,p=null)=>{r("WARN",g,p)},info:(g,p=null)=>{r("INFO",g,p)},debug:(g,p=null)=>{r("DEBUG",g,p)},log:r,context:t}}const L0={name:"EmployeeColumn",components:{TicketCard:Ct},props:{employee:{type:Object,required:!0},stageId:{type:String,required:!0}},emits:["ticket-clicked","ticket-dropped"],setup(o,{emit:e}){Ua("EmployeeColumn");const t=x0(async(p,T,v)=>{e("ticket-dropped",p,T)}),r=M(()=>o.employee.isFromSector1C?Array.isArray(o.employee.tickets)?o.employee.tickets:[]:Array.isArray(o.employee.ticketsInsideSector)?o.employee.ticketsInsideSector:[]),i=M(()=>o.employee.isFromSector1C?[]:Array.isArray(o.employee.ticketsOutsideSector)?o.employee.ticketsOutsideSector:Array.isArray(o.employee.tickets)?o.employee.tickets:[]),n=M(()=>o.employee.isFromSector1C?Array.isArray(o.employee.tickets)?o.employee.tickets:[]:[]),l=M(()=>r.value.length+i.value.length),d=p=>{t.handleDrop(p,o.employee.id,o.stageId)},g=p=>{};return{isDropZoneActive:t.isDropZoneActive,handleDragOver:t.handleDragOver,handleDragLeave:t.handleDragLeave,handleDrop:d,ticketsInsideSector:r,ticketsOutsideSector:i,ticketsToDisplay:n,totalTicketsCount:l,handleTicketDragStart:g}}},P0={class:"employee-header"},O0={class:"employee-info"},R0={class:"employee-details"},B0={class:"employee-name"},U0={key:0,class:"employee-position"},W0={class:"tickets-count"},F0={class:"tickets-list"},H0={class:"section-header"},j0={class:"section-count"},V0={key:2,class:"empty-state"};function z0(o,e,s,t,r,i){const n=be("TicketCard");return c(),u("div",{class:X(["employee-column",{"drop-zone-active":t.isDropZoneActive}]),onDragover:e[3]||(e[3]=Ce((...l)=>t.handleDragOver&&t.handleDragOver(...l),["prevent"])),onDragleave:e[4]||(e[4]=(...l)=>t.handleDragLeave&&t.handleDragLeave(...l)),onDrop:e[5]||(e[5]=(...l)=>t.handleDrop&&t.handleDrop(...l))},[a("div",P0,[a("div",O0,[e[6]||(e[6]=a("span",{class:"employee-icon"},"üë§",-1)),a("div",R0,[a("div",B0,m(s.employee.name),1),s.employee.position?(c(),u("div",U0,m(s.employee.position),1)):A("",!0)])]),a("div",W0," üìä –¢–∏–∫–µ—Ç–æ–≤: "+m(t.totalTicketsCount),1)]),a("div",F0,[s.employee.isFromSector1C?ls([t.ticketsToDisplay.length,t.ticketsToDisplay.map(l=>l.id).join(",")],()=>(c(),u("div",{key:0},[ne(Qe,{name:"ticket",tag:"div"},{default:pe(()=>[(c(!0),u(ee,null,te(t.ticketsToDisplay,l=>(c(),he(n,{key:l.id,ticket:l,draggable:!0,onClick:d=>o.$emit("ticket-clicked",l),onDragStart:t.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),e,0):(c(),u(ee,{key:1},[t.ticketsInsideSector.length>0?ls([t.ticketsInsideSector.length,t.ticketsInsideSector.map(l=>l.id).join(",")],()=>(c(),u("div",{key:0,class:"tickets-section tickets-inside-sector"},[ne(Qe,{name:"ticket",tag:"div"},{default:pe(()=>[(c(!0),u(ee,null,te(t.ticketsInsideSector,l=>(c(),he(n,{key:l.id,ticket:l,draggable:!0,onClick:d=>o.$emit("ticket-clicked",l),onDragStart:t.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),e,1):A("",!0),t.ticketsOutsideSector.length>0?ls([t.ticketsOutsideSector.length,t.ticketsOutsideSector.map(l=>l.id).join(",")],()=>(c(),u("div",{key:1,class:"tickets-section tickets-outside-sector"},[a("div",H0,[e[7]||(e[7]=a("span",{class:"section-badge"},"–í–Ω–µ —Å–µ–∫—Ç–æ—Ä–∞",-1)),a("span",j0,m(t.ticketsOutsideSector.length),1)]),ne(Qe,{name:"ticket",tag:"div"},{default:pe(()=>[(c(!0),u(ee,null,te(t.ticketsOutsideSector,l=>(c(),he(n,{key:l.id,ticket:l,draggable:!0,class:"ticket-outside-sector",onClick:d=>o.$emit("ticket-clicked",l),onDragStart:t.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),e,2):A("",!0)],64)),t.totalTicketsCount===0?(c(),u("div",V0,[...e[8]||(e[8]=[a("p",null,"–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤",-1)])])):A("",!0)])],34)}const G0=de(L0,[["render",z0],["__scopeId","data-v-cdec5b5c"]]),K0={name:"DashboardStage",components:{ZeroPoint:$0,EmployeeColumn:G0},props:{stage:{type:Object,required:!0},zeroPointTickets:{type:Array,default:()=>[]}},emits:["ticket-moved","ticket-assigned","ticket-clicked"],setup(o,{emit:e}){const s=Ua("DashboardStage"),t=I(!1),r=M(()=>{const v=Array.isArray(o.zeroPointTickets)?o.zeroPointTickets.length:0,y=Array.isArray(o.stage.employees)?o.stage.employees.reduce((k,S)=>Array.isArray(S.ticketsInsideSector)?k+S.ticketsInsideSector.length:S.isFromSector1C&&Array.isArray(S.tickets)?k+S.tickets.length:k,0):0;return v+y}),i=M(()=>Array.isArray(o.stage.employees)?o.stage.employees.reduce((v,y)=>Array.isArray(y.ticketsOutsideSector)?v+y.ticketsOutsideSector.length:!y.isFromSector1C&&Array.isArray(y.tickets)?v+y.tickets.length:v,0):0),n=M(()=>r.value+i.value),l=M(()=>{const v=o.stage?.name||"–°—Ç–∞–¥–∏—è",y=r.value,k=i.value;return k===0?`${v} (${y})`:`${v} (${y} / ${k})`});return{isDragging:t,ticketsCountInsideSector:r,ticketsCountOutsideSector:i,totalTicketsCount:n,stageNameWithCount:l,handleTicketDragged:v=>{t.value=!0},handleTicketAssigned:(v,y)=>{e("ticket-assigned",v,y)},handleTicketDropped:(v,y)=>{e("ticket-moved",v,y,o.stage.id),t.value=!1},handleTicketClicked:v=>{s.debug("Ticket clicked",v),e("ticket-clicked",v)}}}},q0={class:"stage-header"},Y0={class:"stage-content"},X0={class:"employees-container"};function J0(o,e,s,t,r,i){const n=be("ZeroPoint"),l=be("EmployeeColumn");return c(),u("div",{class:"dashboard-stage",style:we({borderLeftColor:s.stage.color})},[a("div",q0,[a("h2",null,m(t.stageNameWithCount),1)]),a("div",Y0,[ne(n,{tickets:s.zeroPointTickets,"stage-id":s.stage.id,onTicketDragged:t.handleTicketDragged,onTicketAssigned:t.handleTicketAssigned,onTicketClicked:t.handleTicketClicked},null,8,["tickets","stage-id","onTicketDragged","onTicketAssigned","onTicketClicked"]),a("div",X0,[(c(!0),u(ee,null,te(s.stage.employees,d=>(c(),he(l,{key:d.id,employee:d,"stage-id":s.stage.id,onTicketClicked:t.handleTicketClicked,onTicketDropped:t.handleTicketDropped},null,8,["employee","stage-id","onTicketClicked","onTicketDropped"]))),128))])])],4)}const Z0=de(K0,[["render",J0],["__scopeId","data-v-c6fbde76"]]),Is={cache_check:{title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞",description:"–ü–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."},cache_hit:{title:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",description:"–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞..."},loading_tickets:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24..."},filtering:{title:"–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤",description:"–û—Ç–±–æ—Ä —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°..."},extracting_employees:{title:"–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ê–Ω–∞–ª–∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."},loading_employees:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö..."},grouping:{title:"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",description:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º..."},caching:{title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à",description:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."},complete:{title:"–ì–æ—Ç–æ–≤–æ!",description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"},error:{title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}},Q0={loading_tickets:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24..."},filtering:{title:"–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤",description:"–û—Ç–±–æ—Ä —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°..."},extracting_employees:{title:"–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ê–Ω–∞–ª–∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."},loading_employees:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö..."},grouping:{title:"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",description:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º..."},caching:{title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à",description:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."},cache_check:{title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞",description:"–ü–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."},cache_hit:{title:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",description:"–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞..."},complete:{title:"–ì–æ—Ç–æ–≤–æ!",description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"},error:{title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}},e1={name:"LoadingPreloader",props:{currentStep:{type:String,default:null},progress:{type:Number,default:0},stepDetails:{type:Object,default:()=>({})},error:{type:String,default:null}},emits:["retry"],setup(o,{emit:e}){const s=M(()=>{const{currentStep:g,stepDetails:p}=o;return p?.description?{title:g?Is[g]?.title||g:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:p.description}:g?Is[g]?Is[g]:Q0[g]||{title:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ..."}:{title:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è..."}}),t=M(()=>s.value.title),r=M(()=>s.value.description),i=M(()=>o.stepDetails),n=M(()=>{const g=o.progress;return g==null||isNaN(g)?0:Math.round(Math.max(0,Math.min(100,g)))});return{stepTitle:t,stepDescription:r,details:i,displayProgress:n,getStageDisplayName:g=>g?{"DT140_12:UC_0VHWE2":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","DT140_12:PREPARATION":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó","DT140_12:CLIENT":"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ","–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"}[g]||g:"",handleRetry:()=>{e("retry")}}}},t1={class:"preloader-backdrop"},s1={class:"preloader-container"},a1={class:"preloader-content-scrollable"},o1={key:0,class:"spinner-container"},n1={class:"preloader-content"},r1={class:"step-title"},i1={key:0,class:"step-description"},l1={key:1,class:"progress-container"},c1={class:"progress-bar"},d1={class:"progress-text"},u1={key:2,class:"step-details"},g1={key:0,class:"detail-description"},m1={key:1,class:"detail-item"},h1={class:"detail-value"},f1={key:0,class:"detail-total"},v1={key:2,class:"detail-item"},p1={class:"detail-value"},y1={key:0,class:"detail-total"},k1={key:3,class:"detail-item"},b1={class:"detail-value"},_1={key:0,class:"detail-total"},w1={key:4,class:"detail-item"},C1={class:"detail-value"},T1={key:5,class:"detail-warning"},S1={key:0,class:"error-container"},D1={class:"error-content"},E1={class:"error-message"};function A1(o,e,s,t,r,i){return c(),u("div",{class:X(["loading-preloader",{"has-error":s.error}])},[a("div",t1,[a("div",s1,[a("div",a1,[s.error?A("",!0):(c(),u("div",o1,[...e[1]||(e[1]=[a("div",{class:"spinner"},null,-1)])])),a("div",n1,[a("h3",r1,m(t.stepTitle),1),t.stepDescription?(c(),u("p",i1,m(t.stepDescription),1)):A("",!0),s.error?A("",!0):(c(),u("div",l1,[a("div",c1,[a("div",{class:"progress-fill",style:we({width:t.displayProgress+"%"})},null,4)]),a("span",d1,m(t.displayProgress)+"%",1)])),s.error?A("",!0):(c(),u("div",u1,[t.details.description?(c(),u("div",g1,m(t.details.description),1)):A("",!0),t.details.count!==void 0?(c(),u("div",m1,[e[2]||(e[2]=a("span",{class:"detail-label"},"–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–∏–∫–µ—Ç–æ–≤:",-1)),a("span",h1,m(t.details.count),1),t.details.total!==void 0?(c(),u("span",f1," –∏–∑ "+m(t.details.total),1)):A("",!0)])):A("",!0),t.details.filteredTickets!==void 0?(c(),u("div",v1,[e[3]||(e[3]=a("span",{class:"detail-label"},"–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∏–∫–µ—Ç–æ–≤:",-1)),a("span",p1,m(t.details.filteredTickets),1),t.details.totalTickets!==void 0?(c(),u("span",y1," –∏–∑ "+m(t.details.totalTickets),1)):A("",!0)])):A("",!0),t.details.stage?(c(),u("div",k1,[e[4]||(e[4]=a("span",{class:"detail-label"},"–°—Ç–∞–¥–∏—è:",-1)),a("span",b1,m(t.getStageDisplayName(t.details.stage)),1),t.details.stageIndex&&t.details.totalStages?(c(),u("span",_1," ("+m(t.details.stageIndex)+"/"+m(t.details.totalStages)+") ",1)):A("",!0)])):A("",!0),t.details.employeeCount!==void 0?(c(),u("div",w1,[e[5]||(e[5]=a("span",{class:"detail-label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",-1)),a("span",C1,m(t.details.employeeCount),1)])):A("",!0),t.details.warning?(c(),u("div",T1,[a("span",null,"‚ö†Ô∏è "+m(t.details.warning),1)])):A("",!0)]))])])])]),s.error?(c(),u("div",S1,[a("div",D1,[e[6]||(e[6]=a("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),a("p",E1,m(s.error),1),a("button",{onClick:e[0]||(e[0]=(...n)=>t.handleRetry&&t.handleRetry(...n)),class:"retry-button"}," –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É ")])])):A("",!0)],2)}const $1=de(e1,[["render",A1],["__scopeId","data-v-d129ff19"]]),I1={name:"LoggerControl",props:{showControl:{type:Boolean,default:!1}},setup(){const o=I(!1),e=I("ERROR"),s=I(!0),t=d=>({NONE:"–û—Ç–∫–ª—é—á–µ–Ω–æ",ERROR:"–¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏",WARN:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏",INFO:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏",DEBUG:"–í—Å–µ –ª–æ–≥–∏ (–æ—Ç–ª–∞–¥–∫–∞)"})[d]||d;return $e(()=>{const d=Mt.getLevel();e.value=d,o.value=d!=="NONE"}),{enabled:o,level:e,isExpanded:s,getLevelDescription:t,handleToggle:()=>{o.value?(e.value==="NONE"&&(e.value="ERROR"),Mt.setLevel(e.value)):(Mt.setLevel("NONE"),e.value="NONE")},handleLevelChange:()=>{o.value&&Mt.setLevel(e.value)},resetToDefault:()=>{const d="ERROR";e.value=d,o.value=!0,Mt.setLevel(d)},toggleVisibility:()=>{s.value=!s.value}}}},M1={key:0,class:"logger-control"},N1={class:"logger-control-header"},x1=["aria-label"],L1={key:0,class:"logger-control-content"},P1={class:"logger-control-section"},O1={class:"logger-control-label"},R1={key:0,class:"logger-control-section"},B1={class:"logger-control-label"},U1={key:1,class:"logger-control-info"},W1={class:"logger-control-info-text"},F1={key:2,class:"logger-control-section"};function H1(o,e,s,t,r,i){return s.showControl?(c(),u("div",M1,[a("div",N1,[e[6]||(e[6]=a("h3",{class:"logger-control-title"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º",-1)),a("button",{class:"logger-control-toggle",onClick:e[0]||(e[0]=(...n)=>t.toggleVisibility&&t.toggleVisibility(...n)),"aria-label":t.isExpanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"},m(t.isExpanded?"‚ñº":"‚ñ∂"),9,x1)]),t.isExpanded?(c(),u("div",L1,[a("div",P1,[a("label",O1,[Re(a("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=n=>t.enabled=n),onChange:e[2]||(e[2]=(...n)=>t.handleToggle&&t.handleToggle(...n)),class:"logger-control-checkbox"},null,544),[[bs,t.enabled]]),e[7]||(e[7]=a("span",{class:"logger-control-label-text"},"–í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ",-1))])]),t.enabled?(c(),u("div",R1,[a("label",B1,[e[9]||(e[9]=a("span",{class:"logger-control-label-text"},"–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:",-1)),Re(a("select",{"onUpdate:modelValue":e[3]||(e[3]=n=>t.level=n),onChange:e[4]||(e[4]=(...n)=>t.handleLevelChange&&t.handleLevelChange(...n)),class:"logger-control-select"},[...e[8]||(e[8]=[_t('<option value="NONE" data-v-ed57067c>–û—Ç–∫–ª—é—á–µ–Ω–æ</option><option value="ERROR" data-v-ed57067c>–¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏</option><option value="WARN" data-v-ed57067c>–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏</option><option value="INFO" data-v-ed57067c>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏</option><option value="DEBUG" data-v-ed57067c>–í—Å–µ –ª–æ–≥–∏ (–æ—Ç–ª–∞–¥–∫–∞)</option>',5)])],544),[[dt,t.level]])])])):A("",!0),t.enabled?(c(),u("div",U1,[a("span",W1,[e[10]||(e[10]=ce(" –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: ",-1)),a("strong",null,m(t.getLevelDescription(t.level)),1)])])):A("",!0),t.enabled?(c(),u("div",F1,[a("button",{onClick:e[5]||(e[5]=(...n)=>t.resetToDefault&&t.resetToDefault(...n)),class:"logger-control-reset-btn",title:"–°–±—Ä–æ—Å–∏—Ç—å –∫ –∑–Ω–∞—á–µ–Ω–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"}," –°–±—Ä–æ—Å–∏—Ç—å –∫ —É–º–æ–ª—á–∞–Ω–∏—é ")])):A("",!0)])):A("",!0)])):A("",!0)}const j1=de(I1,[["render",H1],["__scopeId","data-v-ed57067c"]]),V1={name:"DiagnosticsPanel",props:{isEnabled:{type:Boolean,default:!1},isUserAdmin:{type:Boolean,default:!1}},setup(o){const e=I(!0),s=tt(),t=M(()=>!o.isEnabled||!o.isUserAdmin?{ticketsLoading:{stages:{},totalLoaded:0},filtering:{total:0,filtered:0,rejected:[],tagValueExamples:[]},employees:{uniqueIds:[],totalUnique:0,ticketsWithoutAssignedById:[],ticketsWithAssignedById1051:[]},grouping:{distributionByStages:{},ticketsNotInColumn:[],unknownStages:[]},zeroPoint:{byStage:{}}}:s?s.getMetrics():(console.warn("[DiagnosticsPanel] Diagnostics service not available"),{ticketsLoading:{stages:{},totalLoaded:0},filtering:{total:0,filtered:0,rejected:[],tagValueExamples:[]},employees:{uniqueIds:[],totalUnique:0,ticketsWithoutAssignedById:[],ticketsWithAssignedById1051:[]},grouping:{distributionByStages:{},ticketsNotInColumn:[],unknownStages:[]},zeroPoint:{byStage:{}}})),r=M(()=>!o.isEnabled||!o.isUserAdmin||!s?{withoutAssignedById:[],withAssignedById1051:[],withoutSectorTag:[],notInColumn:[],unknownStage:[]}:s.getProblematicTickets()),i=M(()=>{const g=r.value;return g.withoutAssignedById.length===0&&g.withAssignedById1051.length===0&&g.withoutSectorTag.length===0&&g.notInColumn.length===0&&g.unknownStage.length===0});return{isExpanded:e,metrics:t,problematicTickets:r,hasNoProblems:i,toggleExpanded:()=>{e.value=!e.value},downloadJSON:()=>{if(!s)return;const g=s.exportToJSON(),p=new Blob([g],{type:"application/json"}),T=URL.createObjectURL(p),v=document.createElement("a");v.href=T,v.download=`dashboard-diagnostics-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(T)},getStageName:g=>Lt.getStageName(g)||g}}},z1={key:0,class:"diagnostics-panel"},G1={class:"diagnostics-header"},K1={class:"header-actions"},q1=["title"],Y1={key:0,class:"diagnostics-content"},X1={class:"diagnostics-section"},J1={class:"metrics-grid"},Z1={class:"metric-card"},Q1={class:"metric-value"},eb={class:"metric-label"},tb={class:"metric-value"},sb={class:"metric-detail"},ab={class:"diagnostics-section"},ob={class:"metrics-grid"},nb={class:"metric-card"},rb={class:"metric-value"},ib={class:"metric-card",style:{"border-left-color":"#28a745"}},lb={class:"metric-value"},cb={class:"metric-card",style:{"border-left-color":"#dc3545"}},db={class:"metric-value"},ub={key:0,class:"metric-detail"},gb={key:0,class:"warning-box"},mb={key:1,class:"examples-box"},hb={class:"example-type"},fb={key:0,class:"normalized"},vb={class:"diagnostics-section"},pb={class:"metrics-grid"},yb={class:"metric-card"},kb={class:"metric-value"},bb={class:"metric-card"},_b={class:"metric-value"},wb={class:"metric-card"},Cb={class:"metric-value"},Tb={class:"diagnostics-section"},Sb={class:"metrics-grid"},Db={class:"metric-card"},Eb={class:"metric-value"},Ab={class:"metric-card",style:{"border-left-color":"#28a745"}},$b={class:"metric-value"},Ib={class:"metric-card",style:{"border-left-color":"#ffc107"}},Mb={class:"metric-value"},Nb={key:0,class:"employees-list"},xb={class:"diagnostics-section"},Lb={class:"metrics-grid"},Pb={class:"metric-label"},Ob={class:"metric-value"},Rb={class:"diagnostics-section problematic-tickets"},Bb={key:0,class:"problem-group"},Ub={class:"tickets-list"},Wb={class:"ticket-id"},Fb={class:"ticket-title"},Hb={class:"ticket-stage"},jb={key:0,class:"more-items"},Vb={key:1,class:"problem-group"},zb={class:"tickets-list"},Gb={class:"ticket-id"},Kb={class:"ticket-title"},qb={class:"ticket-stage"},Yb={key:0,class:"more-items"},Xb={key:2,class:"problem-group"},Jb={class:"tickets-list"},Zb={class:"ticket-id"},Qb={class:"ticket-title"},e_={class:"ticket-stage"},t_={key:0,class:"more-items"},s_={key:3,class:"problem-group"},a_={class:"tickets-list"},o_={class:"ticket-id"},n_={class:"ticket-title"},r_={class:"ticket-stage"},i_={key:0,class:"more-items"},l_={key:4,class:"problem-group"},c_={class:"tickets-list"},d_={class:"ticket-id"},u_={class:"ticket-title"},g_={class:"ticket-stage"},m_={key:0,class:"more-items"},h_={key:5,class:"no-problems"};function f_(o,e,s,t,r,i){return s.isEnabled&&s.isUserAdmin?(c(),u("div",z1,[a("div",G1,[e[2]||(e[2]=a("h2",null,"üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞",-1)),a("div",K1,[a("button",{onClick:e[0]||(e[0]=(...n)=>t.downloadJSON&&t.downloadJSON(...n)),class:"btn-download",title:"–°–∫–∞—á–∞—Ç—å JSON"}," üì• –°–∫–∞—á–∞—Ç—å JSON "),a("button",{onClick:e[1]||(e[1]=(...n)=>t.toggleExpanded&&t.toggleExpanded(...n)),class:"btn-toggle",title:t.isExpanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"},m(t.isExpanded?"‚ñº":"‚ñ∂"),9,q1)])]),t.isExpanded?(c(),u("div",Y1,[a("section",X1,[e[4]||(e[4]=a("h3",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",-1)),a("div",J1,[a("div",Z1,[e[3]||(e[3]=a("div",{class:"metric-label"},"–í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ",-1)),a("div",Q1,m(t.metrics.ticketsLoading.totalLoaded),1)]),(c(!0),u(ee,null,te(t.metrics.ticketsLoading.stages,(n,l)=>(c(),u("div",{key:l,class:"metric-card"},[a("div",eb,m(t.getStageName(l)),1),a("div",tb,m(n.total),1),a("div",sb,"–ë–∞—Ç—á–µ–π: "+m(n.batches.length),1)]))),128))])]),a("section",ab,[e[10]||(e[10]=a("h3",null,"üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ç–æ—Ä—É 1–°",-1)),a("div",ob,[a("div",nb,[e[5]||(e[5]=a("div",{class:"metric-label"},"–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ",-1)),a("div",rb,m(t.metrics.filtering.total),1)]),a("div",ib,[e[6]||(e[6]=a("div",{class:"metric-label"},"–ü—Ä–æ—à–ª–æ —Ñ–∏–ª—å—Ç—Ä (—Ç–µ–≥ 1–°)",-1)),a("div",lb,m(t.metrics.filtering.filtered),1)]),a("div",cb,[e[7]||(e[7]=a("div",{class:"metric-label"},"–û—Ç–∫–ª–æ–Ω–µ–Ω–æ (–Ω–µ—Ç —Ç–µ–≥–∞ 1–°)",-1)),a("div",db,m(t.metrics.filtering.rejected.length),1),t.metrics.filtering.total>0?(c(),u("div",ub,m(Math.round(t.metrics.filtering.rejected.length/t.metrics.filtering.total*100))+"% –æ—Ç –≤—Å–µ—Ö ",1)):A("",!0)])]),t.metrics.filtering.rejected.length>0?(c(),u("div",gb,[e[8]||(e[8]=a("strong",null,"‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:",-1)),ce(" "+m(t.metrics.filtering.rejected.length)+" —Ç–∏–∫–µ—Ç–æ–≤ –Ω–µ –∏–º–µ—é—Ç —Ç–µ–≥–∞ —Å–µ–∫—Ç–æ—Ä–∞ 1–° (UF_CRM_7_TYPE_PRODUCT = '1C') –∏ –ø–æ—ç—Ç–æ–º—É –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –¥–∞—à–±–æ—Ä–¥–µ. –≠—Ç–∏ —Ç–∏–∫–µ—Ç—ã –µ—Å—Ç—å –≤ Bitrix24, –Ω–æ –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. ",1)])):A("",!0),t.metrics.filtering.tagValueExamples.length>0?(c(),u("div",mb,[e[9]||(e[9]=a("h4",null,"–ü—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π UF_CRM_7_TYPE_PRODUCT:",-1)),a("ul",null,[(c(!0),u(ee,null,te(t.metrics.filtering.tagValueExamples.slice(0,10),(n,l)=>(c(),u("li",{key:l},[a("code",null,m(JSON.stringify(n.value)),1),a("span",hb,"("+m(n.type)+m(n.isArray?", –º–∞—Å—Å–∏–≤":"")+")",1),n.normalized&&n.normalized.length?(c(),u("span",fb," ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ: "+m(n.normalized.join(", ")),1)):A("",!0)]))),128))])])):A("",!0)]),a("section",vb,[e[14]||(e[14]=a("h3",null,"üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏",-1)),a("div",pb,[a("div",yb,[e[11]||(e[11]=a("div",{class:"metric-label"},"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID",-1)),a("div",kb,m(t.metrics.employees.totalUnique),1)]),a("div",bb,[e[12]||(e[12]=a("div",{class:"metric-label"},"–ë–µ–∑ assignedById",-1)),a("div",_b,m(t.metrics.employees.ticketsWithoutAssignedById.length),1)]),a("div",wb,[e[13]||(e[13]=a("div",{class:"metric-label"},"–° assignedById=1051",-1)),a("div",Cb,m(t.metrics.employees.ticketsWithAssignedById1051.length),1)])])]),a("section",Tb,[e[18]||(e[18]=a("h3",null,"üì¶ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),(c(!0),u(ee,null,te(t.metrics.grouping.distributionByStages,(n,l)=>(c(),u("div",{key:l,class:"stage-distribution"},[a("h4",null,m(t.getStageName(l)),1),a("div",Sb,[a("div",Db,[e[15]||(e[15]=a("div",{class:"metric-label"},"–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤ –≤ —Å—Ç–∞–¥–∏–∏",-1)),a("div",Eb,m(n.total||0),1)]),a("div",Ab,[e[16]||(e[16]=a("div",{class:"metric-label"},"–í–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),a("div",$b,m(n.insideSector||0),1)]),a("div",Ib,[e[17]||(e[17]=a("div",{class:"metric-label"},"–í–Ω–µ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),a("div",Mb,m(n.outsideSector||0),1)])]),Object.keys(n.employees||{}).length>0?(c(),u("div",Nb,[(c(!0),u(ee,null,te(n.employees,(d,g)=>(c(),u("div",{key:g,class:"employee-item"}," –°–æ—Ç—Ä—É–¥–Ω–∏–∫ #"+m(g)+": "+m(d)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1))),128))])):A("",!0)]))),128))]),a("section",xb,[e[19]||(e[19]=a("h3",null,"üéØ –ù—É–ª–µ–≤–∞—è —Ç–æ—á–∫–∞",-1)),a("div",Lb,[(c(!0),u(ee,null,te(t.metrics.zeroPoint.byStage,(n,l)=>(c(),u("div",{key:l,class:"metric-card"},[a("div",Pb,m(t.getStageName(l)),1),a("div",Ob,m(n),1)]))),128))])]),a("section",Rb,[e[20]||(e[20]=a("h3",null,"‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),t.problematicTickets.withoutAssignedById.length>0?(c(),u("div",Bb,[a("h4",null,"–ë–µ–∑ assignedById ("+m(t.problematicTickets.withoutAssignedById.length)+")",1),a("div",Ub,[(c(!0),u(ee,null,te(t.problematicTickets.withoutAssignedById.slice(0,10),n=>(c(),u("div",{key:n.id,class:"ticket-item"},[a("span",Wb,"#"+m(n.id),1),a("span",Fb,m(n.title),1),a("span",Hb,m(t.getStageName(n.stageId)),1)]))),128)),t.problematicTickets.withoutAssignedById.length>10?(c(),u("div",jb," ... –∏ –µ—â—ë "+m(t.problematicTickets.withoutAssignedById.length-10),1)):A("",!0)])])):A("",!0),t.problematicTickets.withAssignedById1051.length>0?(c(),u("div",Vb,[a("h4",null,"–° assignedById=1051 ("+m(t.problematicTickets.withAssignedById1051.length)+")",1),a("div",zb,[(c(!0),u(ee,null,te(t.problematicTickets.withAssignedById1051.slice(0,10),n=>(c(),u("div",{key:n.id,class:"ticket-item"},[a("span",Gb,"#"+m(n.id),1),a("span",Kb,m(n.title),1),a("span",qb,m(t.getStageName(n.stageId)),1)]))),128)),t.problematicTickets.withAssignedById1051.length>10?(c(),u("div",Yb," ... –∏ –µ—â—ë "+m(t.problematicTickets.withAssignedById1051.length-10),1)):A("",!0)])])):A("",!0),t.problematicTickets.withoutSectorTag.length>0?(c(),u("div",Xb,[a("h4",null,"–ë–µ–∑/–Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–≥ —Å–µ–∫—Ç–æ—Ä–∞ ("+m(t.problematicTickets.withoutSectorTag.length)+")",1),a("div",Jb,[(c(!0),u(ee,null,te(t.problematicTickets.withoutSectorTag.slice(0,10),n=>(c(),u("div",{key:n.id||n.ID,class:"ticket-item"},[a("span",Zb,"#"+m(n.id||n.ID),1),a("span",Qb,m(n.title||n.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),a("span",e_,m(t.getStageName(n.stageId||n.STAGE_ID)),1)]))),128)),t.problematicTickets.withoutSectorTag.length>10?(c(),u("div",t_," ... –∏ –µ—â—ë "+m(t.problematicTickets.withoutSectorTag.length-10),1)):A("",!0)])])):A("",!0),t.problematicTickets.notInColumn.length>0?(c(),u("div",s_,[a("h4",null,"–ù–µ –ø–æ–ø–∞–ª–∏ –≤ –∫–æ–ª–æ–Ω–∫—É ("+m(t.problematicTickets.notInColumn.length)+")",1),a("div",a_,[(c(!0),u(ee,null,te(t.problematicTickets.notInColumn.slice(0,10),n=>(c(),u("div",{key:n.id,class:"ticket-item"},[a("span",o_,"#"+m(n.id),1),a("span",n_,m(n.title),1),a("span",r_,m(t.getStageName(n.stageId)),1)]))),128)),t.problematicTickets.notInColumn.length>10?(c(),u("div",i_," ... –∏ –µ—â—ë "+m(t.problematicTickets.notInColumn.length-10),1)):A("",!0)])])):A("",!0),t.problematicTickets.unknownStage.length>0?(c(),u("div",l_,[a("h4",null,"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç–∞–¥–∏—è ("+m(t.problematicTickets.unknownStage.length)+")",1),a("div",c_,[(c(!0),u(ee,null,te(t.problematicTickets.unknownStage.slice(0,10),n=>(c(),u("div",{key:n.id,class:"ticket-item"},[a("span",d_,"#"+m(n.id),1),a("span",u_,m(n.title),1),a("span",g_,"–°—Ç–∞–¥–∏—è: "+m(n.stageId),1)]))),128)),t.problematicTickets.unknownStage.length>10?(c(),u("div",m_," ... –∏ –µ—â—ë "+m(t.problematicTickets.unknownStage.length-10),1)):A("",!0)])])):A("",!0),t.hasNoProblems?(c(),u("div",h_," ‚úÖ –ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ ")):A("",!0)])])):A("",!0)])):A("",!0)}const v_=de(V1,[["render",f_],["__scopeId","data-v-74a5e138"]]);function p_(){const o=I(!1),e=I(null),s=I([{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:[]},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:[]},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:[]}]),t=I({formed:[],review:[],execution:[]}),r=I([]),i=I(null);return{isLoading:o,error:e,stages:s,zeroPointTickets:t,employees:r,draggedTicket:i,updateState:p=>{p.stages&&(s.value=p.stages),p.employees&&(r.value=p.employees),p.zeroPointTickets&&(t.value=p.zeroPointTickets)},resetState:()=>{o.value=!1,e.value=null,s.value=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:[]},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:[]},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:[]}],t.value={formed:[],review:[],execution:[]},r.value=[],i.value=null},updateLocalStateAfterMove:(p,T,v)=>{const y=s.value.find(S=>S.employees.some(C=>C.tickets.some(f=>f.id===p.id)));if(y){const S=y.employees.find(C=>C.tickets.some(f=>f.id===p.id));S&&(S.tickets=S.tickets.filter(C=>C.id!==p.id))}const k=s.value.find(S=>S.id===v);if(k){const S=k.employees.find(C=>C.id===T);if(S){const C={...p,assigneeId:T,stageId:v};S.tickets.push(C)}}Object.keys(t.value).forEach(S=>{t.value[S]=t.value[S].filter(C=>C.id!==p.id)})},getEmployeeTickets:(p,T)=>{const v=s.value.find(k=>k.id===T);if(!v)return[];const y=v.employees.find(k=>k.id===p);return y?y.tickets||[]:[]}}}function y_(){const o=I(null),e=I(0),s=I(null),t=I(null),r=I({}),i=(v,y={})=>{o.value=v,r.value=y},n=v=>{const y=typeof v=="number"&&!isNaN(v)?v:0;e.value=Math.min(100,Math.max(0,y))},l=v=>{s.value=v,t.value=null},d=v=>{t.value=v},g=()=>{t.value=null},p=()=>{o.value=null,e.value=0,s.value=null,t.value=null,r.value={}},T=M(()=>s.value||t.value);return{currentStep:o,progress:e,error:s,temporaryError:t,displayError:T,stepDetails:r,updateStep:i,updateProgress:n,setError:l,setTemporaryError:d,clearTemporaryError:g,reset:p}}const ut={fadeOutDuration:400,fadeInDuration:400,delayBetween:150,readyDisplayTime:800,fadeOutEasing:"ease-out",fadeInEasing:"ease-in",fadeOutTransform:"scale(0.95)",fadeInTransform:"translateY(10px)"},ia={fadeInDuration:400,fadeInEasing:"ease-in"};function Wa(o,e,s="opacity, transform"){return`${s} ${o}ms ${e}`}function k_(){return Wa(ut.fadeOutDuration,ut.fadeOutEasing)}function b_(){return Wa(ia.fadeInDuration,ia.fadeInEasing)}function __(){const o=I(!1),e=I(null),s=n=>{o.value=!0,e.value=Date.now(),n&&n()},t=n=>{o.value=!1,e.value=null,n&&n()},r=(n,l,d=ut)=>{s(()=>{n&&n(),setTimeout(()=>{l&&l()},d.delayBetween),setTimeout(()=>{t()},d.fadeOutDuration)})},i=M(()=>e.value?Date.now()-e.value:0);return{isTransitioning:M(()=>o.value),startTransition:s,endTransition:t,executeTransition:r,transitionDuration:i}}function w_(o,e=""){if(Logger.error(`API Error ${e?`(${e})`:""}`,"ErrorHandler",o),o.message){if(o.message.includes("HTTP error"))return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.";if(o.message.includes("timeout"))return"–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";if(o.message.includes("403")||o.message.includes("401"))return"–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.";if(o.message.includes("500"))return"–û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."}return o.message||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}function C_(o,e="",s={}){const t={message:o.message,stack:o.stack,context:e,...s,timestamp:new Date().toISOString()};Logger.error("Error logged","ErrorHandler",t)}function Ms(o,e="",s=null){const t=w_(o,e);C_(o,e),s&&typeof s=="function"?s(t,"error"):typeof BX<"u"&&BX.UI&&BX.UI.Notification&&BX.UI.Notification.Center.notify({content:t,autoHideDelay:5e3})}function T_(o){const e=mt(),s=y_(),{isTransitioning:t,executeTransition:r}=__();function i(y,k){const S=gs(y);S.step&&k.updateStep(S.step,S.details||{}),S.progress!==void 0&&S.progress!==null&&(k.updateProgress(S.progress),k.clearTemporaryError())}const n=async(y=!0)=>{o.isLoading.value=!0,o.error.value=null,s.reset(),s.updateStep("cache_check",{description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö..."}),s.updateProgress(0);try{const k=await Bt.getSectorData(y,S=>{i(S,s)});o.updateState(k)}catch(k){o.error.value=k.message,s.setError(k.message),Ms(k,"loading sector data",e.error)}finally{if(o.error.value)o.isLoading.value=!1;else{s.updateStep("complete",{description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"}),s.updateProgress(100);const k=ut.readyDisplayTime||800;setTimeout(()=>{r(()=>{},()=>{o.isLoading.value=!1},ut),setTimeout(()=>{s.reset()},ut.fadeOutDuration)},k)}}},l=async(y,k,S)=>{if(!Ba(y,k,S))return e.warning("–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–∫–µ—Ç —Å—é–¥–∞"),!1;try{const C=await Bt.assignTicket(y.id,k,S);return C&&(o.updateLocalStateAfterMove(y,k,S),e.success("–¢–∏–∫–µ—Ç –ø–µ—Ä–µ–º–µ—â—ë–Ω")),C}catch(C){return Ms(C,"assigning ticket",e.error),!1}finally{o.draggedTicket.value=null}};return{loadSectorData:n,assignTicket:l,moveTicketToStage:async(y,k)=>await l(y,y.assigneeId,k),assignTicketToEmployee:async(y,k)=>await l(y,k,y.stageId),createTicket:async y=>{const k=N0(y);if(!k.valid){const S=k.errors.join(", ");return e.error(S),0}try{const S=await Bt.createTicket(y);return S>0&&(await n(!1),e.success("–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω")),S}catch(S){return Ms(S,"creating ticket",e.error),0}},handleTicketDragStart:y=>{o.draggedTicket.value=y},handleTicketDrop:async(y,k,S)=>{await l(y,k,S)},loadingProgress:s,isTransitioning:t}}const Vs={name:"DashboardSector1C",components:{DashboardStage:Z0,LoadingPreloader:$1,LoggerControl:j1,BackButton:_a,DiagnosticsPanel:v_},setup(){const o=Xe(),e=ks(),s=p_(),t=T_(s),r=I(null),i=M(()=>r.value?as(r.value):!1),n=M(()=>ct(e,r.value)),l=()=>{o.push({name:"dashboard-sector-1c",query:{...e.query,diagnostics:"true"}}),typeof localStorage<"u"&&localStorage.setItem("dashboard-sector-1c-diagnostics","true");const L=tt();L&&L.reset(),t.loadSectorData(!1)},d=()=>{Oe.invalidateTicketsCache(),Oe.invalidateEmployeesCache(),Ca();const L=tt();L&&L.reset(),t.loadSectorData(!1)};$e(async()=>{try{r.value=await rt.getCurrentUser()}catch(L){console.error("Error getting current user:",L),r.value=null}if(n.value){const L=tt();L&&L.reset()}t.loadSectorData()});const g=k_(),p=b_(),T=`${ut.delayBetween}ms`,v=ut.fadeOutTransform,y=ut.fadeInTransform,k=()=>{t.loadSectorData(!1)},S=()=>{o.push({name:"dashboard-graph-state"})},C=()=>{o.push({name:"dashboard-graph-admission-closure"})},f=()=>{o.push({name:"dashboard-tickets-time-tracking"})},w=()=>{o.push("/")},$=t.loadingProgress,W=M(()=>typeof localStorage<"u"?localStorage.getItem("dashboard-sector-1c-show-logger-control")==="true":!1);return{isLoading:s.isLoading,error:s.error,stages:s.stages,zeroPointTickets:s.zeroPointTickets,employees:s.employees,draggedTicket:s.draggedTicket,currentStep:$.currentStep,progress:$.progress,stepDetails:$.stepDetails,loadingProgress:$,loadSectorData:t.loadSectorData,handleTicketDragStart:t.handleTicketDragStart,handleTicketDrop:t.handleTicketDrop,assignTicketToEmployee:t.assignTicketToEmployee,moveTicketToStage:t.moveTicketToStage,createTicket:t.createTicket,getEmployeeTickets:s.getEmployeeTickets,showLoggerControl:W,handleRetry:k,isTransitioning:t.isTransitioning,preloaderFadeOutTransition:g,dashboardFadeInTransition:p,transitionDelay:T,preloaderFadeOutTransform:v,dashboardFadeInTransform:y,navigateToGraphState:S,navigateToAdmissionClosure:C,navigateToTimeTracking:f,handleGoHome:w,isDiagnosticsEnabled:n,enableDiagnostics:l,clearCache:d,isUserAdmin:i}}},la=()=>{no(o=>({e25fa6d4:o.preloaderFadeOutTransition,v2de4400b:o.preloaderFadeOutTransform,v66f66a76:o.dashboardFadeInTransition,e224f3ee:o.transitionDelay,v171b9ffc:o.dashboardFadeInTransform}))},ca=Vs.setup;Vs.setup=ca?(o,e)=>(la(),ca(o,e)):la;const S_={class:"dashboard-header"},D_={class:"breadcrumbs-row"},E_={class:"header-actions"},A_={key:0,class:"dashboard-content"},$_={class:"stages-container"};function I_(o,e,s,t,r,i){const n=be("BackButton"),l=be("LoadingPreloader"),d=be("DashboardStage"),g=be("LoggerControl"),p=be("DiagnosticsPanel");return c(),u("div",{class:X(["dashboard-sector-1c",{"is-dragging":t.draggedTicket}])},[a("div",S_,[a("div",D_,[a("button",{class:"btn-home-link",type:"button",onClick:e[0]||(e[0]=(...T)=>t.handleGoHome&&t.handleGoHome(...T)),title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),e[6]||(e[6]=a("span",{class:"breadcrumb-separator"},"/",-1)),e[7]||(e[7]=a("span",{class:"breadcrumb-current"},"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1))]),ne(n,{variant:"header"}),e[13]||(e[13]=a("h1",null,"–î–∞—à–±–æ—Ä–¥ - –°–µ–∫—Ç–æ—Ä 1–°",-1)),a("div",E_,[t.isDiagnosticsEnabled&&t.isUserAdmin?(c(),u("button",{key:0,onClick:e[1]||(e[1]=(...T)=>t.clearCache&&t.clearCache(...T)),class:"btn-clear-cache",title:"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à —Å–µ–∫—Ç–æ—Ä–∞ –∏ —Ç–∏–∫–µ—Ç–æ–≤"},[...e[8]||(e[8]=[a("span",{class:"icon"},"‚ôªÔ∏è",-1),a("span",null,"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à",-1)])])):A("",!0),!t.isDiagnosticsEnabled&&t.isUserAdmin?(c(),u("button",{key:1,onClick:e[2]||(e[2]=(...T)=>t.enableDiagnostics&&t.enableDiagnostics(...T)),class:"btn-enable-diagnostics",title:"–í–∫–ª—é—á–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º"},[...e[9]||(e[9]=[a("span",{class:"icon"},"üîç",-1),a("span",null,"–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",-1)])])):A("",!0),a("button",{onClick:e[3]||(e[3]=(...T)=>t.navigateToGraphState&&t.navigateToGraphState(...T)),class:"btn-navigate-graph-state",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞"},[...e[10]||(e[10]=[a("span",{class:"icon"},"üìä",-1),a("span",null,"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",-1)])]),a("button",{onClick:e[4]||(e[4]=(...T)=>t.navigateToAdmissionClosure&&t.navigateToAdmissionClosure(...T)),class:"btn-navigate-admission-closure",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞"},[...e[11]||(e[11]=[a("span",{class:"icon"},"üìà",-1),a("span",null,"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1)])]),a("button",{onClick:e[5]||(e[5]=(...T)=>t.navigateToTimeTracking&&t.navigateToTimeTracking(...T)),class:"btn-navigate-time-tracking",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞–º –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞"},[...e[12]||(e[12]=[a("span",{class:"icon"},"‚è±",-1),a("span",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã",-1)])])])]),ne(Ae,{name:"preloader-fade"},{default:pe(()=>[t.isLoading||t.error||t.currentStep?(c(),he(l,{key:0,"current-step":t.currentStep,progress:t.progress,"step-details":t.stepDetails,error:t.error||null,onRetry:t.handleRetry},null,8,["current-step","progress","step-details","error","onRetry"])):A("",!0)]),_:1}),ne(Ae,{name:"dashboard-fade"},{default:pe(()=>[!t.isLoading&&!t.error&&!t.currentStep?(c(),u("div",A_,[a("div",$_,[(c(!0),u(ee,null,te(t.stages,T=>(c(),he(d,{key:T.id,stage:T,"zero-point-tickets":t.zeroPointTickets[T.id]||[],onTicketMoved:t.handleTicketDrop,onTicketAssigned:t.assignTicketToEmployee},null,8,["stage","zero-point-tickets","onTicketMoved","onTicketAssigned"]))),128))])])):A("",!0)]),_:1}),ne(n,{variant:"floating"}),ne(g,{"show-control":t.showLoggerControl},null,8,["show-control"]),ne(p,{"is-enabled":t.isDiagnosticsEnabled,"is-user-admin":t.isUserAdmin},null,8,["is-enabled","is-user-admin"])],2)}const Fa=de(Vs,[["render",I_],["__scopeId","data-v-11e84363"]]),Ha=Object.freeze(Object.defineProperty({__proto__:null,default:Fa},Symbol.toStringTag,{value:"Module"})),M_={name:"ModuleAdapter",props:{moduleConfig:{type:Object,required:!0,validator:o=>o.id&&o.title&&o.component},sectorId:{type:String,required:!0},isCompact:{type:Boolean,default:!0}},emits:["module-ready","module-error","module-navigate"],setup(o,{emit:e}){const s=Xe(),t=I(!1),r=I(null),i=I(null),n=I(null),l={SectorDashboard:lr,TicketsTimeTrackingDashboard:Ia,GraphStateDashboard:La,GraphAdmissionClosureDashboard:Pa,DashboardSector1C:Fa},d=M(()=>{const S={isCompact:o.isCompact,sectorId:o.sectorId,moduleId:o.moduleConfig.id};switch(o.moduleConfig.component){case"SectorDashboard":return{sectorId:o.sectorId};case"DashboardSector1C":return{...S,showBreadcrumbs:!1,compactMode:!0};case"GraphStateDashboard":return{...S,showBreadcrumbs:!1,compactMode:!0,autoLoad:!1};case"TicketsTimeTrackingDashboard":return{...S,showBreadcrumbs:!1,compactMode:!0};case"GraphAdmissionClosureDashboard":return{...S,showBreadcrumbs:!1,compactMode:!0};default:return S}}),g=async()=>{try{t.value=!0,r.value=null;const S=o.moduleConfig.component;l[S]?(i.value=l[S],console.log(`[ModuleAdapter] ‚úÖ Loading real component ${S} for module ${o.moduleConfig.id} in sector ${o.sectorId}`),console.log("[ModuleAdapter] Component loaded:",i.value)):(i.value="div",console.log(`[ModuleAdapter] ‚ö†Ô∏è Loading module ${o.moduleConfig.id} for sector ${o.sectorId} - using placeholder (component ${S} not found)`)),e("module-ready",{moduleId:o.moduleConfig.id,sectorId:o.sectorId})}catch(S){console.error(`Failed to load module ${o.moduleConfig.id}:`,S),r.value=S.message,e("module-error",{moduleId:o.moduleConfig.id,sectorId:o.sectorId,error:S})}finally{t.value=!1}},p=()=>{console.log("üîó [ModuleAdapter] Opening full view for module:",o.moduleConfig.id),console.log("üîó [ModuleAdapter] Route:",o.moduleConfig.route),console.log("üîó [ModuleAdapter] Module config:",o.moduleConfig),o.moduleConfig.route?(console.log("üîó [ModuleAdapter] Navigating to:",o.moduleConfig.route),s.push(o.moduleConfig.route)):console.warn(`No route defined for module ${o.moduleConfig.id}`)},T=()=>{g()},v=S=>{e("module-navigate",{type:"ready",moduleId:o.moduleConfig.id,sectorId:o.sectorId,data:S})},y=S=>{e("module-navigate",{type:"error",moduleId:o.moduleConfig.id,sectorId:o.sectorId,error:S})},k=S=>{e("module-navigate",{type:"navigate",moduleId:o.moduleConfig.id,sectorId:o.sectorId,navigation:S})};return $e(()=>{g()}),{isLoading:t,error:r,moduleComponent:i,moduleInstance:n,moduleProps:d,openFullView:p,retryLoad:T,onModuleReady:v,onModuleError:y,onModuleNavigate:k}}},N_={class:"module-header"},x_={class:"module-icon"},L_={class:"module-info"},P_={class:"module-actions"},O_=["aria-label"],R_={class:"module-content"},B_={key:0,class:"module-loading"},U_={key:1,class:"module-error"},W_={key:2,class:"module-body"},F_={class:"module-placeholder"},H_={class:"placeholder-icon"};function j_(o,e,s,t,r,i){return c(),u("div",{class:X(["sector-module-adapter",`module-${s.moduleConfig.id}`])},[a("div",N_,[a("div",x_,m(s.moduleConfig.icon),1),a("div",L_,[a("h3",null,m(s.moduleConfig.title),1),a("p",null,m(s.moduleConfig.description),1)]),a("div",P_,[a("button",{onClick:e[0]||(e[0]=(...n)=>t.openFullView&&t.openFullView(...n)),class:"btn-module-fullscreen",title:"–û—Ç–∫—Ä—ã—Ç—å –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ","aria-label":`–û—Ç–∫—Ä—ã—Ç—å ${s.moduleConfig.title} –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ`}," ‚õ∂ ",8,O_)])]),a("div",R_,[t.isLoading?(c(),u("div",B_,[e[3]||(e[3]=a("div",{class:"loading-spinner"},null,-1)),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ "+m(s.moduleConfig.title)+"...",1)])):t.error?(c(),u("div",U_,[e[4]||(e[4]=a("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),e[5]||(e[5]=a("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è",-1)),a("button",{onClick:e[1]||(e[1]=(...n)=>t.retryLoad&&t.retryLoad(...n)),class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):(c(),u("div",W_,[a("div",F_,[a("div",H_,m(s.moduleConfig.icon),1),a("h4",null,m(s.moduleConfig.title),1),a("p",null,m(s.moduleConfig.description),1),e[6]||(e[6]=a("div",{class:"placeholder-status"},[a("span",{class:"status-badge"},"–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"),a("small",null,"–ú–æ–¥—É–ª—å –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏")],-1)),a("button",{onClick:e[2]||(e[2]=(...n)=>t.openFullView&&t.openFullView(...n)),class:"btn-open-full"}," –û—Ç–∫—Ä—ã—Ç—å –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ ")])]))])],2)}const V_=de(M_,[["render",j_],["__scopeId","data-v-df66ddb2"]]),z_={name:"SectorContainer",components:{ModuleAdapter:V_},props:{sectorConfig:{type:Object,required:!0,validator:o=>o.id&&o.name&&o.icon}},emits:["module-ready","module-error","module-event","sector-expanded","sector-collapsed"],setup(o,{emit:e}){Xe();const s=I(!1),t=I(!1),r=I([]),i=M(()=>o.sectorConfig.modules&&o.sectorConfig.modules.length>0),n=M(()=>!1);$e(async()=>{i.value&&await l()});const l=async()=>{t.value=!0;try{r.value=o.sectorConfig.modules||[],e("module-ready",{sectorId:o.sectorConfig.id,modulesCount:r.value.length})}catch(y){console.error(`Failed to load modules for sector ${o.sectorConfig.id}:`,y),e("module-error",{sectorId:o.sectorConfig.id,error:y.message})}finally{t.value=!1}};return{expanded:s,loading:t,sectorModules:r,hasModules:i,canNavigateToDashboard:n,toggleExpanded:()=>{s.value=!s.value,s.value?e("sector-expanded",{sectorId:o.sectorConfig.id}):e("sector-collapsed",{sectorId:o.sectorConfig.id})},onModuleReady:y=>{e("module-ready",{sectorId:o.sectorConfig.id,moduleId:y.moduleId,data:y})},onModuleError:y=>{e("module-error",{sectorId:o.sectorConfig.id,moduleId:y.moduleId,error:y.error})},onModuleNavigate:y=>{e("module-event",{sectorId:o.sectorConfig.id,moduleId:y.moduleId,event:y})},navigateToSectorDashboard:()=>{console.log(`Navigate to dashboard for sector: ${o.sectorConfig.id}`)}}}},G_={class:"sector-header"},K_={class:"sector-header-left"},q_={class:"sector-icon"},Y_={class:"sector-title"},X_={class:"sector-actions"},J_={key:0,class:"sector-content"},Z_={key:0,class:"sector-loading"},Q_={key:1,class:"sector-modules-grid"},ew={key:2,class:"no-modules"},tw={key:3,class:"sector-dashboard-link"};function sw(o,e,s,t,r,i){const n=be("ModuleAdapter");return c(),u("div",{class:X(["sector-container",`sector-${s.sectorConfig.id}`])},[a("div",G_,[a("div",K_,[a("div",q_,m(s.sectorConfig.icon),1),a("div",Y_,[a("h2",null,m(s.sectorConfig.name),1),a("p",null,m(s.sectorConfig.description),1)])]),a("div",X_,[a("button",{onClick:e[0]||(e[0]=(...l)=>t.toggleExpanded&&t.toggleExpanded(...l)),class:"btn-toggle-sector"},m(t.expanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"),1)])]),t.expanded?(c(),u("div",J_,[t.loading?(c(),u("div",Z_,[e[3]||(e[3]=a("div",{class:"loading-spinner"},null,-1)),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∫—Ç–æ—Ä–∞ "+m(s.sectorConfig.name)+"...",1)])):t.sectorModules.length>0?(c(),u("div",Q_,[(c(!0),u(ee,null,te(t.sectorModules,l=>(c(),he(n,{key:l.id,"module-config":l,"sector-id":s.sectorConfig.id,"is-compact":!0,onModuleReady:t.onModuleReady,onModuleError:t.onModuleError,onModuleNavigate:t.onModuleNavigate},null,8,["module-config","sector-id","onModuleReady","onModuleError","onModuleNavigate"]))),128))])):(c(),u("div",ew,[a("p",null,'–ú–æ–¥—É–ª–∏ –¥–ª—è —Å–µ–∫—Ç–æ—Ä–∞ "'+m(s.sectorConfig.name)+'" –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ',1),t.canNavigateToDashboard?(c(),u("button",{key:0,onClick:e[1]||(e[1]=(...l)=>t.navigateToSectorDashboard&&t.navigateToSectorDashboard(...l)),class:"btn-sector-dashboard"},[...e[4]||(e[4]=[a("span",{class:"icon"},"üìä",-1),ce(" –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ ",-1)])])):A("",!0)])),t.sectorModules.length>0&&t.canNavigateToDashboard?(c(),u("div",tw,[a("button",{onClick:e[2]||(e[2]=(...l)=>t.navigateToSectorDashboard&&t.navigateToSectorDashboard(...l)),class:"btn-sector-dashboard"},[...e[5]||(e[5]=[a("span",{class:"icon"},"üìä",-1),ce(" –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ ",-1)])])])):A("",!0)])):A("",!0)],2)}const aw=de(z_,[["render",sw],["__scopeId","data-v-0fa90bab"]]);class cs{static async logAppEntry(e,s=null){if(!e||!e.ID)return console.warn("[ActivityLoggingService] Invalid user object for app entry logging"),!1;const t={timestamp:new Date().toISOString(),type:"app_entry",user_id:e.ID,user_name:this.getUserName(e),user_email:e.EMAIL||null,ip:s||this.getClientIp(),user_agent:navigator.userAgent,session_id:this.getSessionId()};return await this.saveLog(t)}static async logPageVisit(e,s,t=null){if(!s||!s.ID)return console.warn("[ActivityLoggingService] Invalid user object for page visit logging"),!1;if(!e||!e.path)return console.warn("[ActivityLoggingService] Invalid route object for page visit logging"),!1;const r={timestamp:new Date().toISOString(),type:"page_visit",user_id:s.ID,user_name:this.getUserName(s),route_path:e.path,route_name:e.name||null,route_title:e.meta?.title||null,from_path:t?.path||null,from_name:t?.name||null,session_id:this.getSessionId()};return await this.saveLog(r)}static async saveLog(e){try{const s=et("/api/user-activity-log.php"),t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)});if(!t.ok){const i=await t.text();return console.error("[ActivityLoggingService] Failed to save log:",{status:t.status,statusText:t.statusText,error:i}),!1}const r=await t.json();return r.success?!0:(console.error("[ActivityLoggingService] API returned error:",r.error),!1)}catch(s){return s.name==="AbortError"?console.warn("[ActivityLoggingService] Request timeout (activity logging skipped)"):console.error("[ActivityLoggingService] Error saving log:",s),!1}}static getSessionId(){const e="activity_session_id";if(sessionStorage.getItem(e))return sessionStorage.getItem(e);const s=this.generateSessionId();return sessionStorage.setItem(e,s),s}static generateSessionId(){const e=Date.now(),s=Math.random().toString(36).substring(2,11);return`${e}-${s}`}static getUserName(e){const s=e.NAME||"",t=e.LAST_NAME||"";return`${s} ${t}`.trim()||e.EMAIL||`User #${e.ID}`}static getClientIp(){return null}static isAppEntryLogged(){return sessionStorage.getItem("app_entry_logged")==="true"}static markAppEntryLogged(){sessionStorage.setItem("app_entry_logged","true")}}const ow={reports:[{id:1,title:"–û—Ç—á—ë—Ç –ø–æ —Ç–∏–∫–µ—Ç–∞–º",icon:"üìä",route:"/reports/tickets",description:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º",active:!1},{id:2,title:"–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",icon:"üìà",route:"/reports/performance",description:"–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞",active:!1},{id:3,title:"–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º",icon:"üìâ",route:"/reports/deadlines",description:"–ê–Ω–∞–ª–∏–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á",active:!1},{id:4,title:"–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç",icon:"üìã",route:"/reports/summary",description:"–û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",active:!1},{id:5,title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",route:"/dashboard/sector-1c",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0},{id:6,title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",icon:"üìä",route:"/dashboard/graph-state",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–° –≤–æ –≤—Ä–µ–º–µ–Ω–∏",active:!0,category:"analytics",order:6},{id:7,title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–°",icon:"üìà",route:"/dashboard/graph-admission-closure",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0,category:"analytics",order:7},{id:8,title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"‚è±",route:"/dashboard/tickets-time-tracking",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",active:!0,category:"analytics",order:8}]};function nw(){return ow.reports.filter(o=>o.active===!0)}const rw={adminInterfaces:[{id:1,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"üë•",route:"/admin/users",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"},{id:2,title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã",icon:"‚öôÔ∏è",route:"/admin/settings",description:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:3,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",icon:"üìã",route:"/admin/webhook-logs",description:"–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤"},{id:4,title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",icon:"üìä",route:"/admin/usage-stats",description:"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:5,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",icon:"üóëÔ∏è",route:"/admin/cache",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –º–æ–¥—É–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"}]};function iw(){return[...rw.adminInterfaces]}const Yt={sector1c:{id:"1c",name:"–°–µ–∫—Ç–æ—Ä 1–°",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ",icon:"‚öôÔ∏è",color:"#007bff",borderColor:"#0056b3",backgroundColor:"#f8f9fa",filterValue:"1C",modules:[{id:"dashboard-sector-1c",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–æ–º 1–° —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏",icon:"‚öôÔ∏è",component:"SectorDashboard",route:"/dashboard/sector-1c",category:"management"}],features:["smart-process-140","1c-integration"],order:1},sectorPdm:{id:"pdm",name:"–°–µ–∫—Ç–æ—Ä PDM",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–∞–º–∏ PDM (Product Data Management) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –æ –ø—Ä–æ–¥—É–∫—Ü–∏–∏",icon:"üîß",color:"#28a745",borderColor:"#1e7e34",backgroundColor:"#f8fff8",filterValue:"PDM",modules:[{id:"dashboard-sector-pdm",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ PDM",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–æ–º PDM —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –∑–∞–¥–∞—á–∞–º–∏",icon:"üîß",component:"SectorDashboardPDM",route:"/dashboard/sector-pdm",category:"management"}],features:["pdm-integration"],order:2},sectorBitrix24:{id:"bitrix24",name:"–°–µ–∫—Ç–æ—Ä –ë–∏—Ç—Ä–∏–∫—Å24",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ë–∏—Ç—Ä–∏–∫—Å24 - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞",icon:"üåê",color:"#ffc107",borderColor:"#d39e00",backgroundColor:"#fffef8",filterValue:"Bitrix24",modules:[{id:"dashboard-sector-bitrix24",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ –ë–∏—Ç—Ä–∏–∫—Å24",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–æ–º –ë–∏—Ç—Ä–∏–∫—Å24 —Å –∑–∞–¥–∞—á–∞–º–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏",icon:"üåê",component:"SectorDashboardBitrix24",route:"/dashboard/sector-bitrix24",category:"management"}],features:["bitrix24-integration"],order:3},sectorInfrastructure:{id:"infrastructure",name:"–°–µ–∫—Ç–æ—Ä –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏",icon:"üñ•Ô∏è",color:"#dc3545",borderColor:"#bd2130",backgroundColor:"#fff8f8",filterValue:["–ñ–µ–ª–µ–∑–æ","–ü—Ä–æ—á–µ–µ"],modules:[{id:"dashboard-sector-infrastructure",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Å –∑–∞–¥–∞—á–∞–º–∏ –ø–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é –∏ —Ç–µ—Ö–Ω–∏–∫–µ",icon:"üñ•Ô∏è",component:"SectorDashboardInfrastructure",route:"/dashboard/sector-infrastructure",category:"management"}],features:["infrastructure-management"],order:4}};class lw{static getAllSectors(){return Object.values(Yt).sort((e,s)=>(e.order||0)-(s.order||0))}static getSectorById(e){return Yt[e]||null}static getSectorsWithModules(){return this.getAllSectors().filter(e=>e.modules&&e.modules.length>0)}static getSectorColors(){const e={};return Object.values(Yt).forEach(s=>{e[s.id]=s.color}),e}static sectorExists(e){return Object.values(Yt).some(s=>s.id===e)}static getNextOrder(){return Math.max(...Object.values(Yt).map(s=>s.order||0))+1}}const cw={name:"IndexPage",components:{StatusMessage:_s,LoadingSpinner:ws,SectorContainer:aw},beforeCreate(){console.log("[IndexPage] beforeCreate() called")},created(){console.log("[IndexPage] created() called")},beforeMount(){console.log("[IndexPage] beforeMount() called")},setup(){console.log("[IndexPage] setup() called");const o=Xe(),e=I(!0),s=I(null),t=I(!1),r=I(!1),i=I(""),n=I(null),l=I(null),d=I(!1);console.log("[IndexPage] Initial state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value});const g=I(nw()),p=I(lw.getAllSectors()),T=I(!1),v=I(iw()),y=M(()=>n.value?as(n.value):!1),k=M(()=>{if(!n.value)return"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";const U=n.value.FIRST_NAME?n.value.FIRST_NAME.trim():"",G=n.value.LAST_NAME?n.value.LAST_NAME.trim():"",q=n.value.NAME?n.value.NAME.trim():"";return U&&G?`${U} ${G}`:q&&G&&q!==G?`${q} ${G}`:U&&q&&U!==q?`${U} ${q}`:q&&q.includes(" ")?q:U||G||q||`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${n.value.ID}`}),S=M(()=>s.value?s.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ":"–û—à–∏–±–∫–∞ API":null),C=M(()=>s.value?s.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É.":s.value:null),f=M(()=>s.value&&s.value.includes("no_install_app")),w=M(()=>ka("/install.php"));$e(async()=>{console.log("[IndexPage] onMounted() called");try{console.log("[IndexPage] Calling AccessControlService.checkAccess()...");const U=await rt.checkAccess();if(console.log("[IndexPage] Access result:",{allowed:U.allowed,hasUser:!!U.user,user:U.user,errorCode:U.errorCode,errorMessage:U.errorMessage}),U.allowed){if(console.log("[IndexPage] Setting accessAllowed to true"),t.value=!0,n.value=U.user,console.log("[IndexPage] Access allowed, setting state:",{accessAllowed:t.value,hasUser:!!n.value,loading:e.value,accessDenied:r.value}),!cs.isAppEntryLogged())try{U.user&&await cs.logAppEntry(U.user)&&cs.markAppEntryLogged()}catch(G){console.error("[IndexPage] Error logging app entry:",G)}}else{r.value=!0;const G=Rt(),q=!G&&U.errorCode===nt.ACCESS_DENIED&&U.errorMessage&&U.errorMessage.includes("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø");if(console.log("IndexPage - accessResult:",{errorCode:U.errorCode,errorMessage:U.errorMessage,isInsideB24:G,isDirectAccessDeniedCheck:q}),d.value=q,q&&(i.value=U.errorMessage,console.log("IndexPage - Set direct access denied message:",U.errorMessage)),console.log("IndexPage - State after check:",{accessDenied:r.value,isDirectAccessDenied:d.value,accessErrorMessage:i.value}),!q){if(U.user){const{getAllowedDepartmentIds:oe}=await Se(async()=>{const{getAllowedDepartmentIds:Y}=await import("./access-config-async-BlO8P_3_.js");return{getAllowedDepartmentIds:Y}},__vite__mapDeps([6,7,4,2,3,0,1]),import.meta.url);l.value={userId:U.user.ID,departmentIds:U.user.UF_DEPARTMENT||[],allowedIds:oe()}}U.errorCode===nt.USER_NOT_DETERMINED?i.value="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.":U.errorCode===nt.ACCESS_DENIED?i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω":i.value=U.errorMessage||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."}}}catch(U){s.value=U.message,console.error("Error checking access:",U)}finally{e.value=!1,console.log("[IndexPage] Final state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value,hasUser:!!n.value,error:s.value})}});const $=U=>{if(!U){console.error("Route is not defined for report");return}o.push(U)},W=()=>{T.value=!0},L=()=>{T.value=!1};return{loading:e,error:s,accessAllowed:t,accessDenied:r,accessErrorMessage:i,currentUser:n,userName:k,debugInfo:l,isDirectAccessDenied:d,errorTitle:S,errorMessage:C,showInstallLink:f,installPageUrl:w,reportsButtons:g,navigateToReport:$,sectors:p,handleModuleEvent:U=>{console.log("Module event:",U)},handleSectorExpanded:U=>{console.log("Sector expanded:",U.sectorId)},handleSectorCollapsed:U=>{console.log("Sector collapsed:",U.sectorId)},isAdmin:y,showAdminPopup:T,adminButtons:v,openAdminPopup:W,closeAdminPopup:L,navigateToAdmin:U=>{if(!U){console.error("Route is not defined for admin interface");return}o.push(U),L()}}}},dw={class:"index-page"},uw={class:"container"},gw={key:0,class:"install-link"},mw=["href"],hw={key:0,class:"direct-access-denied-info",style:{"margin-top":"15px",padding:"15px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px"}},fw={key:1,class:"debug-info",style:{"margin-top":"15px",padding:"10px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px","font-size":"12px"}},vw={key:3,class:"main-content"},pw={class:"greeting-section"},yw={class:"greeting-header"},kw={class:"greeting-header-content"},bw={class:"greeting-text"},_w={class:"sectors-section"},ww={class:"admin-popup-header"},Cw={class:"admin-popup-content"},Tw={class:"admin-buttons-grid"},Sw=["onClick"],Dw={class:"admin-icon"},Ew={class:"admin-title"},Aw={key:0,class:"admin-description"};function $w(o,e,s,t,r,i){const n=be("StatusMessage"),l=be("LoadingSpinner"),d=be("SectorContainer");return c(),u("div",dw,[a("div",uw,[t.error?(c(),he(n,{key:0,type:"error",title:t.errorTitle,message:t.errorMessage},{default:pe(()=>[t.showInstallLink?(c(),u("div",gw,[a("a",{href:t.installPageUrl},"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",8,mw)])):A("",!0)]),_:1},8,["title","message"])):A("",!0),t.loading?(c(),he(l,{key:1,message:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞..."})):A("",!0),!t.loading&&t.accessDenied?(c(),he(n,{key:2,type:"error",title:"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",message:t.accessErrorMessage},{default:pe(()=>[t.isDirectAccessDenied?(c(),u("div",hw,[...e[4]||(e[4]=[a("p",{style:{margin:"0 0 10px 0","font-weight":"600",color:"#856404"}},[a("strong",null,"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")],-1),a("ol",{style:{margin:"0","padding-left":"20px",color:"#856404"}},[a("li",null,"–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24"),a("li",null,"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Bitrix24 (placement, –≤–∏–¥–∂–µ—Ç –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É)")],-1)])])):t.debugInfo?(c(),u("div",fw,[e[5]||(e[5]=a("strong",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e[6]||(e[6]=a("br",null,null,-1)),ce(" ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+m(t.debugInfo.userId),1),e[7]||(e[7]=a("br",null,null,-1)),ce(" ID –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+m(t.debugInfo.departmentIds),1),e[8]||(e[8]=a("br",null,null,-1)),ce(" –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ID –æ—Ç–¥–µ–ª–æ–≤: "+m(t.debugInfo.allowedIds),1),e[9]||(e[9]=a("br",null,null,-1)),e[10]||(e[10]=a("small",{style:{color:"#856404"}},"–î–æ–±–∞–≤—å—Ç–µ ID –æ—Ç–¥–µ–ª–∞ –≤ —Ñ–∞–π–ª vue-app/src/config/access-config.js",-1))])):A("",!0)]),_:1},8,["message"])):A("",!0),!t.loading&&!t.accessDenied&&t.accessAllowed?(c(),u("div",vw,[a("div",pw,[a("div",yw,[a("div",kw,[e[13]||(e[13]=a("h2",{class:"greeting-title"},"–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ò–¢ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –ü–ª–∞–Ω–µ—Ä–∫–∏ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ü–∏–∏",-1)),a("p",bw,[e[11]||(e[11]=ce(" –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",-1)),a("strong",null,m(t.userName),1),e[12]||(e[12]=ce("! ",-1))])]),t.isAdmin?(c(),u("button",{key:0,class:"admin-button-header",onClick:e[0]||(e[0]=(...g)=>t.openAdminPopup&&t.openAdminPopup(...g)),title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"}," ‚öôÔ∏è ")):A("",!0)])]),a("div",_w,[(c(!0),u(ee,null,te(t.sectors,g=>(c(),he(d,{key:g.id,"sector-config":g,onModuleEvent:t.handleModuleEvent,onSectorExpanded:t.handleSectorExpanded,onSectorCollapsed:t.handleSectorCollapsed},null,8,["sector-config","onModuleEvent","onSectorExpanded","onSectorCollapsed"]))),128))]),t.showAdminPopup&&t.isAdmin?(c(),u("div",{key:0,class:"admin-popup-overlay",onClick:e[3]||(e[3]=(...g)=>t.closeAdminPopup&&t.closeAdminPopup(...g))},[a("div",{class:"admin-popup",onClick:e[2]||(e[2]=Ce(()=>{},["stop"]))},[a("div",ww,[e[14]||(e[14]=a("h3",{class:"admin-popup-title"},"‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",-1)),a("button",{class:"admin-popup-close",onClick:e[1]||(e[1]=(...g)=>t.closeAdminPopup&&t.closeAdminPopup(...g))}," ‚úï ")]),a("div",Cw,[a("div",Tw,[(c(!0),u(ee,null,te(t.adminButtons,g=>(c(),u("div",{key:g.id,class:"admin-interface-button",onClick:p=>t.navigateToAdmin(g.route)},[a("div",Dw,m(g.icon),1),a("div",Ew,m(g.title),1),g.description?(c(),u("div",Aw,m(g.description),1)):A("",!0)],8,Sw))),128))])])])])):A("",!0)])):A("",!0)])])}const Iw=de(cw,[["render",$w],["__scopeId","data-v-12137466"]]),Ze=I(new Map),at=I({hits:0,misses:0,sets:0,invalidations:0}),Ns={defaultTTL:5*60*1e3,maxSize:100,enableStats:!0};function Mw(o={}){const{ttl:e=Ns.defaultTTL,maxSize:s=Ns.maxSize,enableStats:t=Ns.enableStats}=o,r=C=>{const f=new WeakSet;return JSON.stringify(C,(w,$)=>{if(typeof $=="object"&&$!==null){if(f.has($))return"[Circular]";f.add($)}return typeof $=="function"||$===void 0?null:$})},i=(C,f={})=>{const w=Object.keys(f).sort().reduce(($,W)=>{const L=f[W];if(L==null)$[W]=null;else if(typeof L=="object")try{$[W]=r(L)}catch{$[W]=String(L)}else $[W]=L;return $},{});try{return`${C}_${r(w)}`}catch{const W=Object.keys(w).sort().map(L=>`${L}=${w[L]}`).join("&");return`${C}_${W}`}},n=C=>{const f=Ze.value.get(C);return f?Date.now()-f.timestamp>f.ttl?(Ze.value.delete(C),t&&at.value.misses++,null):(f.lastAccessed=Date.now(),t&&at.value.hits++,f.data):(t&&at.value.misses++,null)},l=(C,f,w=null)=>{Ze.value.size>=s&&d(),Ze.value.set(C,{data:f,timestamp:Date.now(),lastAccessed:Date.now(),ttl:w||e}),t&&at.value.sets++},d=()=>{let C=null,f=1/0;for(const[w,$]of Ze.value.entries())$.lastAccessed<f&&(f=$.lastAccessed,C=w);C&&Ze.value.delete(C)},g=()=>{Ze.value.clear(),t&&(at.value={hits:0,misses:0,sets:0,invalidations:0})},p=C=>{const f=typeof C=="string"?new RegExp(C):C;let w=0;for(const $ of Ze.value.keys())f.test($)&&(Ze.value.delete($),w++);return t&&(at.value.invalidations+=w),w},T=()=>{const C=Date.now();let f=0;for(const[w,$]of Ze.value.entries())C-$.timestamp>$.ttl&&(Ze.value.delete(w),f++);return f},v=()=>{const C=at.value.hits+at.value.misses,f=C>0?(at.value.hits/C*100).toFixed(2):0;return{...at.value,size:Ze.value.size,hitRate:`${f}%`}};let y=null;const k=(C=5*60*1e3)=>{y&&clearInterval(y),y=setInterval(()=>{T()},C)},S=()=>{y&&(clearInterval(y),y=null)};return k(),{get:n,set:l,clear:g,invalidate:p,cleanup:T,getCacheKey:i,getStats:v,startAutoCleanup:k,stopAutoCleanup:S}}function gt(o){if(!o||typeof o!="object"||!o.timestamp||typeof o.timestamp!="string"||!o.event||typeof o.event!="string"||!o.category||typeof o.category!="string"||!["tasks","smart-processes","errors"].includes(o.category))return!1;try{new Date(o.timestamp)}catch{return!1}return!0}function Nw(o){if(!o||typeof o!="object")return!1;for(const[e,s]of Object.entries(o))if(typeof s=="function")return!1;return!0}function jt(o){if(!gt(o))return null;const e={timestamp:o.timestamp,event:o.event,category:o.category};return o.ip&&typeof o.ip=="string"&&(e.ip=o.ip),o.payload&&typeof o.payload=="object"&&(e.payload=o.payload),o.details&&Nw(o.details)&&(e.details=o.details),e}function zs(o){return Array.isArray(o)?o.map(e=>jt(e)).filter(e=>e!==null):[]}const{get:xw,set:Lw,getCacheKey:Pw,invalidate:da}=Mw({ttl:2*60*1e3,maxSize:50});class ua{static getBaseUrl(){return et("/api/webhook-logs.php")}static get BASE_URL(){return this.getBaseUrl()}static async getLogs(e={},s=1,t=50,r=!1){if(s<1)throw new Error("Page must be greater than 0");if(t<1||t>1e3)throw new Error("Limit must be between 1 and 1000");const i={category:e.category||null,event:e.event||null,date:e.date||null,hour:e.hour!==void 0?e.hour:null,dateFrom:e.dateFrom||null,dateTo:e.dateTo||null,ip:e.ip||null,status:e.status||null},n=this.getBaseUrl(),l=Pw(n,{filters:i,page:s,limit:t});if(!r){const g=xw(l);if(g)return console.log("[WebhookLogsApiService] Cache hit:",l.substring(0,50)+"..."),g}console.log("[WebhookLogsApiService] Cache miss:",l.substring(0,50)+"...");const d=new URLSearchParams({page:s.toString(),limit:t.toString()});i.category&&d.append("category",i.category),i.event&&d.append("event",i.event),i.date&&d.append("date",i.date),i.hour!==null&&d.append("hour",i.hour.toString()),i.dateFrom&&d.append("dateFrom",i.dateFrom),i.dateTo&&d.append("dateTo",i.dateTo),i.ip&&d.append("ip",i.ip),i.status&&d.append("status",i.status);try{const g=this.getBaseUrl(),p=await fetch(`${g}?${d.toString()}`);if(!p.ok){const k=await p.text();let S;try{S=JSON.parse(k)}catch{S={error:k}}throw new Error(S.error_description||S.error||`HTTP error! status: ${p.status}`)}const T=await p.json();if(console.log("[WebhookLogsApiService] API response:",{success:T.success,logsCount:T.logs?.length||0,pagination:T.pagination,hasError:!!T.error}),T.error)throw new Error(T.error_description||T.error);if(!T.success)throw console.warn("[WebhookLogsApiService] API returned success=false:",T),new Error("API request failed");if(!Array.isArray(T.logs))throw console.error("[WebhookLogsApiService] Invalid logs format:",T.logs),new Error("Invalid logs format: expected array");const v=zs(T.logs);(!T.pagination||typeof T.pagination!="object")&&(console.warn("[WebhookLogsApiService] Invalid pagination format:",T.pagination),T.pagination={page:s,limit:t,total:v.length,pages:Math.ceil(v.length/t)});const y={success:!0,logs:v,pagination:{page:T.pagination.page||s,limit:T.pagination.limit||t,total:T.pagination.total||v.length,pages:T.pagination.pages||Math.ceil((T.pagination.total||v.length)/t)}};return Lw(l,y),y}catch(g){throw console.error("[WebhookLogsApiService] Error:",g),g}}static invalidateCacheOnFilterChange(e={},s={}){const t=da(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Invalidated ${t} entries on filter change`)}static clearCache(){const e=da(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Cleared ${e} entries`)}static async getLogDetails(e,s=null){const t={};return s&&(t.date=s),(await this.getLogs(t,1,1e3)).logs.find(n=>`${n.timestamp}_${n.event}`===e)||null}static async getErrors(e={},s=1,t=50){return this.getLogs({...e,category:"errors"},s,t)}static async getStats(e={}){const s=await this.getLogs(e,1,1e3),t={total:s.pagination.total||s.logs.length,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}};return s.logs.forEach(r=>{r.category==="tasks"?t.tasks++:r.category==="smart-processes"?t.smartProcesses++:r.category==="errors"&&t.errors++,t.byEvent[r.event]||(t.byEvent[r.event]=0),t.byEvent[r.event]++;const i=r.timestamp.split("T")[0];t.byDate[i]||(t.byDate[i]=0),t.byDate[i]++}),t}}function Ow(){const o=ks(),e=Xe(),s=new Date().toISOString().split("T")[0],t=I({category:null,event:null,dateFrom:s,dateTo:null,hour:null,ip:null,search:null,status:null}),r=()=>{const g=o.query;t.value={category:g.category||null,event:g.event||null,dateFrom:g.dateFrom||g.date||s,dateTo:g.dateTo||null,hour:g.hour?parseInt(g.hour):null,ip:g.ip||null,search:g.search||null,status:g.status||null}},i=g=>{if(d)return;const p={...o.query};Object.keys(g).forEach(v=>{const y=g[v];y!==null&&y!==""&&y!==void 0?p[v]=y.toString():delete p[v]}),JSON.stringify(p)!==JSON.stringify(o.query)&&(d=!0,e.replace({path:o.path,query:p}).finally(()=>{setTimeout(()=>{d=!1},100)}))},n=g=>{const p={...t.value,...g};JSON.stringify(t.value)!==JSON.stringify(p)&&(t.value=p,i(t.value))},l=()=>{t.value={category:null,event:null,dateFrom:s,dateTo:null,hour:null,ip:null,search:null,status:null},i(t.value)};$e(()=>{r()});let d=!1;return Ne(()=>o.query,(g,p)=>{if(d)return;JSON.stringify(g)!==JSON.stringify(p)&&r()},{deep:!0}),{filters:t,updateFilters:n,clearFilters:l,loadFiltersFromUrl:r}}function Rw(o,e,s={}){if(!e||!e.trim())return o;const{caseSensitive:t=!1,searchInEvent:r=!0,searchInPayload:i=!0,searchInDetails:n=!0,searchInIp:l=!0,searchInTimestamp:d=!1}=s,g=t?e.trim():e.trim().toLowerCase();return o.filter(p=>{if(r&&p.event&&(t?p.event:p.event.toLowerCase()).includes(g))return!0;if(i&&p.payload)try{const T=JSON.stringify(p.payload);if((t?T:T.toLowerCase()).includes(g))return!0}catch(T){console.warn("Error searching in payload:",T)}if(n&&p.details)try{const T=JSON.stringify(p.details);if((t?T:T.toLowerCase()).includes(g))return!0}catch(T){console.warn("Error searching in details:",T)}return!!(l&&p.ip&&(t?p.ip:p.ip.toLowerCase()).includes(g)||d&&p.timestamp&&(t?p.timestamp:p.timestamp.toLowerCase()).includes(g))})}function Rs(o){if(!o||typeof o!="object"||o.category!==void 0&&o.category!==null&&!["tasks","smart-processes","errors"].includes(o.category)||o.date!==void 0&&o.date!==null&&!/^\d{4}-\d{2}-\d{2}$/.test(o.date))return!1;if(o.hour!==void 0&&o.hour!==null){const e=parseInt(o.hour,10);if(isNaN(e)||e<0||e>23)return!1}return!(o.ip!==void 0&&o.ip!==null&&(typeof o.ip!="string"||o.ip.length===0))}function Bw(o){if(!o||typeof o!="object")return!1;const e=parseInt(o.page,10),s=parseInt(o.limit,10),t=parseInt(o.total,10),r=parseInt(o.pages,10);return!(isNaN(e)||e<1||isNaN(s)||s<1||s>1e3||isNaN(t)||t<0||isNaN(r)||r<0)}function ga(o){if(o==null)return"";const e=String(o),s=e.replace(/"/g,'""');return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${s}"`:s}function Uw(o){return o==null?"":typeof o=="object"?JSON.stringify(o):String(o)}function Ww(o,e="webhook-logs.csv",s={}){return new Promise((t,r)=>{try{if(!Array.isArray(o)||o.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{columns:i=null,onProgress:n=null}=s,l=i||Object.keys(o[0]),g=[l.map(k=>ga(k)).join(",")],p=o.length,T=1e3;for(let k=0;k<p;k+=T){const S=o.slice(k,k+T);if(S.forEach(C=>{const f=l.map(w=>{const $=C[w];return ga(Uw($))});g.push(f.join(","))}),n){const C=Math.min(100,Math.round((k+S.length)/p*100));n(C)}}const v="\uFEFF"+g.join(`
`),y=new Blob([v],{type:"text/csv;charset=utf-8;"});ja(y,e),n&&n(100),t()}catch(i){r(i)}})}function Fw(o,e="webhook-logs.json",s={}){return new Promise((t,r)=>{try{if(!Array.isArray(o)||o.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{pretty:i=!0,onProgress:n=null}=s,l=i?JSON.stringify(o,null,2):JSON.stringify(o);n&&n(50);const d=new Blob([l],{type:"application/json;charset=utf-8;"});ja(d,e),n&&n(100),t()}catch(i){r(i)}})}function ja(o,e){const s=URL.createObjectURL(o),t=document.createElement("a");t.href=s,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(s)},100)}function Hw(o,e={},s=0){const t=new Date().toISOString().split("T")[0],r=new Date().toTimeString().split(" ")[0].replace(/:/g,"-");let i=`webhook-logs_${t}_${r}`;const n=[];return e.category&&n.push(`cat-${e.category}`),e.event&&n.push(`evt-${e.event.substring(0,10)}`),e.dateFrom&&n.push(`from-${e.dateFrom}`),e.dateTo&&n.push(`to-${e.dateTo}`),n.length>0&&(i+=`_${n.join("-")}`),s>0&&(i+=`_${s}records`),`${i}.${o}`}function jw(o){const e=[];if(!Array.isArray(o))return e.push("–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),{valid:!1,errors:e,estimatedSize:0};if(o.length===0)return e.push("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"),{valid:!1,errors:e,estimatedSize:0};const s=JSON.stringify(o).length,t=50*1024*1024;return s>t&&e.push(`–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö (${Math.round(s/1024/1024)} MB). –≠–∫—Å–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è.`),{valid:e.length===0,errors:e,estimatedSize:s}}function Gs(o,e="short"){if(!o)return"‚Äî";try{const s=new Date(o);if(isNaN(s.getTime()))return"Invalid date";switch(e){case"short":return s.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});case"long":return s.toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});case"relative":return Vw(s);default:return s.toLocaleString("ru-RU")}}catch{return"Invalid date"}}function Vw(o){const s=new Date-o,t=Math.floor(s/1e3),r=Math.floor(t/60),i=Math.floor(r/60),n=Math.floor(i/24);return t<60?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":r<60?`${r} ${xs(r,"–º–∏–Ω—É—Ç—É","–º–∏–Ω—É—Ç—ã","–º–∏–Ω—É—Ç")} –Ω–∞–∑–∞–¥`:i<24?`${i} ${xs(i,"—á–∞—Å","—á–∞—Å–∞","—á–∞—Å–æ–≤")} –Ω–∞–∑–∞–¥`:n<7?`${n} ${xs(n,"–¥–µ–Ω—å","–¥–Ω—è","–¥–Ω–µ–π")} –Ω–∞–∑–∞–¥`:Gs(o.toISOString(),"short")}function xs(o,e,s,t){const r=o%10,i=o%100;return r===1&&i!==11?e:r>=2&&r<=4&&(i<10||i>=20)?s:t}function Vt(o){return o?o.replace(/^ON/,"").split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):"‚Äî"}function bt(o){return{tasks:"–ó–∞–¥–∞—á–∏","smart-processes":"–°–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å—ã",errors:"–û—à–∏–±–∫–∏"}[o]||o}function Ks(o){if(!o||typeof o!="object")return"‚Äî";const e=[];if(o.task_id&&e.push(`–ó–∞–¥–∞—á–∞ #${o.task_id}`),o.entity_id&&e.push(`–°—É—â–Ω–æ—Å—Ç—å #${o.entity_id}`),o.task_title&&e.push(`"${o.task_title}"`),o.title&&e.push(`"${o.title}"`),o.comment_text){const s=o.comment_text.length>50?o.comment_text.substring(0,50)+"...":o.comment_text;e.push(`–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${s}`)}return e.length>0?e.join(" ‚Ä¢ "):"‚Äî"}const zw={name:"WebhookLogsExport",props:{logs:{type:Array,default:()=>[]},selectedLogs:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},totalCount:{type:Number,default:0}},emits:["export-start","export-complete","export-error"],setup(o,{emit:e}){const s=I(!1),t=I("csv"),r=I("all"),i=I(!0),n=I(!1),l=I(0),d=I([]),g=I(null),p=M(()=>o.selectedLogs.length),T=M(()=>o.logs.length>0||o.totalCount>0),v=M(()=>o.filters.category||o.filters.event||o.filters.dateFrom||o.filters.dateTo),y=M(()=>r.value==="selected"?p.value:o.logs.length||o.totalCount),k=M(()=>r.value==="selected"?p.value>0:T.value),S=()=>{l.value=0,d.value=[],g.value=null,p.value>0?r.value="selected":r.value="all",s.value=!0,f()},C=()=>{n.value||(s.value=!1)},f=()=>{const L=w(),D=jw(L);d.value=D.errors,g.value=D.estimatedSize},w=()=>(r.value==="selected"?o.selectedLogs:o.logs).map(E=>jt(E)).filter(E=>gt(E)?!0:(console.warn("[WebhookLogsExport] Skipping invalid log:",E),!1)),$=async()=>{try{n.value=!0,l.value=0;let L=w();if(L.length===0)throw new Error("–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const D=L.map(R=>({timestamp:R.timestamp,event:R.event,category:R.category,ip:R.ip||null,details:R.details||null,payload:R.payload||null,formatted:{timestamp:Gs(R.timestamp),event:Vt(R.event),category:bt(R.category),details:Ks(R.details)}}));e("export-start",{format:t.value,scope:r.value,count:D.length});const E=Hw(t.value,o.filters,D.length),x=R=>{l.value=R};t.value==="csv"?await Ww(D,E,{onProgress:x}):await Fw(D,E,{pretty:i.value,onProgress:x}),e("export-complete",{format:t.value,filename:E,count:D.length}),setTimeout(()=>{n.value=!1,s.value=!1,l.value=0},500)}catch(L){console.error("[WebhookLogsExport] Export error:",L),e("export-error",L),n.value=!1,l.value=0,alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${L.message}`)}},W=L=>L<1024?`${L} B`:L<1024*1024?`${(L/1024).toFixed(2)} KB`:`${(L/1024/1024).toFixed(2)} MB`;return Ne([r,()=>o.logs,()=>o.selectedLogs],()=>{s.value&&f()}),{showExportModal:s,exportFormat:t,exportScope:r,jsonPretty:i,exporting:n,exportProgress:l,exportWarnings:d,estimatedSize:g,selectedCount:p,hasAllLogs:T,hasFilters:v,exportCount:y,canExport:k,openExportModal:S,closeExportModal:C,handleExport:$,formatSize:W}}},Gw={class:"webhook-logs-export"},Kw=["disabled","title"],qw={key:0,class:"selected-badge"},Yw={class:"export-modal-header"},Xw={class:"export-modal-body"},Jw={class:"export-section"},Zw={class:"radio-group"},Qw={class:"export-section"},eC={class:"radio-group"},tC=["disabled"],sC={class:"radio-label"},aC={key:0},oC={key:1},nC=["disabled"],rC={class:"radio-label"},iC={key:0,class:"export-section"},lC={class:"checkbox-option"},cC={class:"export-info"},dC={class:"info-item"},uC={class:"info-value"},gC={key:0,class:"info-item"},mC={class:"info-value"},hC={key:1,class:"export-warnings"},fC={key:0,class:"export-progress"},vC={class:"progress-bar"},pC={class:"progress-text"},yC={class:"export-modal-footer"},kC=["disabled"],bC={key:0},_C={key:1},wC=["disabled"];function CC(o,e,s,t,r,i){return c(),u("div",Gw,[a("button",{onClick:e[0]||(e[0]=(...n)=>t.openExportModal&&t.openExportModal(...n)),class:"btn-export",disabled:!t.canExport,title:t.canExport?"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"},[e[11]||(e[11]=a("span",{class:"btn-icon"},"üì•",-1)),e[12]||(e[12]=a("span",{class:"btn-text"},"–≠–∫—Å–ø–æ—Ä—Ç",-1)),t.selectedCount>0?(c(),u("span",qw,m(t.selectedCount),1)):A("",!0)],8,Kw),ne(Ae,{name:"modal"},{default:pe(()=>[t.showExportModal?(c(),u("div",{key:0,class:"export-modal-overlay",onClick:e[10]||(e[10]=(...n)=>t.closeExportModal&&t.closeExportModal(...n))},[a("div",{class:"export-modal",onClick:e[9]||(e[9]=Ce(()=>{},["stop"]))},[a("div",Yw,[e[13]||(e[13]=a("h3",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",-1)),a("button",{onClick:e[1]||(e[1]=(...n)=>t.closeExportModal&&t.closeExportModal(...n)),class:"btn-close"},"‚úï")]),a("div",Xw,[a("div",Jw,[e[16]||(e[16]=a("h4",null,"–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞",-1)),a("div",Zw,[a("label",{class:X(["radio-option",{active:t.exportFormat==="csv"}])},[Re(a("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=n=>t.exportFormat=n),value:"csv",class:"radio-input"},null,512),[[Et,t.exportFormat]]),e[14]||(e[14]=a("span",{class:"radio-label"},[a("strong",null,"CSV"),a("small",null,"–î–ª—è Excel, LibreOffice")],-1))],2),a("label",{class:X(["radio-option",{active:t.exportFormat==="json"}])},[Re(a("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=n=>t.exportFormat=n),value:"json",class:"radio-input"},null,512),[[Et,t.exportFormat]]),e[15]||(e[15]=a("span",{class:"radio-label"},[a("strong",null,"JSON"),a("small",null,"–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, API")],-1))],2)])]),a("div",Qw,[e[19]||(e[19]=a("h4",null,"–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",-1)),a("div",eC,[a("label",{class:X(["radio-option",{active:t.exportScope==="all",disabled:!t.hasAllLogs}])},[Re(a("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=n=>t.exportScope=n),value:"all",disabled:!t.hasAllLogs,class:"radio-input"},null,8,tC),[[Et,t.exportScope]]),a("span",sC,[e[17]||(e[17]=a("strong",null,"–í—Å–µ –∑–∞–ø–∏—Å–∏",-1)),t.hasFilters?(c(),u("small",aC,"–° –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ ("+m(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π)",1)):(c(),u("small",oC,"–í—Å–µ–≥–æ: "+m(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π",1))])],2),a("label",{class:X(["radio-option",{active:t.exportScope==="selected",disabled:t.selectedCount===0}])},[Re(a("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=n=>t.exportScope=n),value:"selected",disabled:t.selectedCount===0,class:"radio-input"},null,8,nC),[[Et,t.exportScope]]),a("span",rC,[e[18]||(e[18]=a("strong",null,"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏",-1)),a("small",null,m(t.selectedCount)+" –∑–∞–ø–∏—Å–µ–π –≤—ã–±—Ä–∞–Ω–æ",1)])],2)])]),t.exportFormat==="json"?(c(),u("div",iC,[e[21]||(e[21]=a("h4",null,"–û–ø—Ü–∏–∏ JSON",-1)),a("label",lC,[Re(a("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=n=>t.jsonPretty=n),class:"checkbox-input"},null,512),[[bs,t.jsonPretty]]),e[20]||(e[20]=a("span",{class:"checkbox-label"},"–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)",-1))])])):A("",!0),a("div",cC,[a("div",dC,[e[22]||(e[22]=a("span",{class:"info-label"},"–ó–∞–ø–∏—Å–µ–π –∫ —ç–∫—Å–ø–æ—Ä—Ç—É:",-1)),a("span",uC,m(t.exportCount),1)]),t.estimatedSize?(c(),u("div",gC,[e[23]||(e[23]=a("span",{class:"info-label"},"–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä:",-1)),a("span",mC,m(t.formatSize(t.estimatedSize)),1)])):A("",!0)]),t.exportWarnings.length>0?(c(),u("div",hC,[(c(!0),u(ee,null,te(t.exportWarnings,(n,l)=>(c(),u("div",{key:l,class:"warning-item"}," ‚ö†Ô∏è "+m(n),1))),128))])):A("",!0)]),t.exporting?(c(),u("div",fC,[a("div",vC,[a("div",{class:"progress-fill",style:we({width:`${t.exportProgress}%`})},null,4)]),a("div",pC," –≠–∫—Å–ø–æ—Ä—Ç: "+m(t.exportProgress)+"% ",1)])):A("",!0),a("div",yC,[a("button",{onClick:e[7]||(e[7]=(...n)=>t.handleExport&&t.handleExport(...n)),disabled:t.exporting||!t.canExport,class:"btn-primary"},[t.exporting?(c(),u("span",bC,"–≠–∫—Å–ø–æ—Ä—Ç...")):(c(),u("span",_C,"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"))],8,kC),a("button",{onClick:e[8]||(e[8]=(...n)=>t.closeExportModal&&t.closeExportModal(...n)),disabled:t.exporting,class:"btn-secondary"}," –û—Ç–º–µ–Ω–∞ ",8,wC)])])])):A("",!0)]),_:1})])}const TC=de(zw,[["render",CC],["__scopeId","data-v-7ae66f8c"]]),SC={name:"WebhookLogSearch",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","search"],setup(o,{emit:e}){const s=I(o.modelValue||""),t=I(!1),r=I(null),i=Yu(y=>{t.value=!1,e("search",y)},400),n=()=>{t.value=!0,e("update:modelValue",s.value),i(s.value)},l=()=>{t.value=!1,e("search",s.value)},d=()=>{s.value="",t.value=!1,r.value=null,e("update:modelValue",""),e("search","")};return Ne(()=>o.modelValue,y=>{y!==s.value&&(s.value=y)}),{searchQuery:s,isSearching:t,searchResultsCount:r,handleSearchInput:n,handleSearch:l,clearSearch:d,setResultsCount:y=>{r.value=y},getResultsText:y=>{const k=y%10,S=y%100;return S>=11&&S<=19?"–∑–∞–ø–∏—Å–µ–π":k===1?"–∑–∞–ø–∏—Å—å":k>=2&&k<=4?"–∑–∞–ø–∏—Å–∏":"–∑–∞–ø–∏—Å–µ–π"},performSearch:(y,k)=>{if(!y||!k||!Array.isArray(k))return[];const S=y.toLowerCase().trim();return S.length===0?k:k.map(f=>jt(f)).filter(f=>gt(f)).filter(f=>{if(f.event&&f.event.toLowerCase().includes(S)||f.category&&f.category.toLowerCase().includes(S)||f.ip&&f.ip.toLowerCase().includes(S)||f.details&&typeof f.details=="object"&&(f.details.task_id&&String(f.details.task_id).includes(S)||f.details.task_title&&f.details.task_title.toLowerCase().includes(S)||f.details.entity_id&&String(f.details.entity_id).includes(S)||f.details.title&&f.details.title.toLowerCase().includes(S)||f.details.comment_text&&f.details.comment_text.toLowerCase().includes(S)))return!0;if(f.payload&&typeof f.payload=="object")try{if(JSON.stringify(f.payload).toLowerCase().includes(S))return!0}catch{}return!1})},formatSearchResult:y=>{const k=[];if(y.event&&k.push(Vt(y.event)),y.category&&k.push(bt(y.category)),y.details){const S=Ks(y.details);S!=="‚Äî"&&k.push(S)}return k.join(" ‚Ä¢ ")}}}},DC={class:"webhook-search"},EC={class:"search-wrapper"},AC={key:0,class:"search-indicator"},$C={key:1,class:"search-results"};function IC(o,e,s,t,r,i){return c(),u("div",DC,[a("div",EC,[e[5]||(e[5]=a("span",{class:"search-icon"},"üîç",-1)),Re(a("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>t.searchQuery=n),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ª–æ–≥–æ–≤ (—Å–æ–±—ã—Ç–∏–µ, payload, IP, –¥–µ—Ç–∞–ª–∏)...",class:"search-input",onInput:e[1]||(e[1]=(...n)=>t.handleSearchInput&&t.handleSearchInput(...n)),onKeyup:[e[2]||(e[2]=Be((...n)=>t.handleSearch&&t.handleSearch(...n),["enter"])),e[3]||(e[3]=Be((...n)=>t.clearSearch&&t.clearSearch(...n),["esc"]))]},null,544),[[At,t.searchQuery]]),t.searchQuery?(c(),u("button",{key:0,onClick:e[4]||(e[4]=(...n)=>t.clearSearch&&t.clearSearch(...n)),class:"clear-button",title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ (Esc)","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):A("",!0)]),t.isSearching?(c(),u("div",AC,[...e[6]||(e[6]=[a("span",{class:"spinner"},null,-1),ce(" –ü–æ–∏—Å–∫... ",-1)])])):A("",!0),t.searchQuery&&t.searchResultsCount!==null?(c(),u("div",$C," –ù–∞–π–¥–µ–Ω–æ: "+m(t.searchResultsCount)+" "+m(t.getResultsText(t.searchResultsCount)),1)):A("",!0)])}const MC=de(SC,[["render",IC],["__scopeId","data-v-db228863"]]);function NC(o,e=null){const s=()=>{try{const n=localStorage.getItem(o);return n?JSON.parse(n):e}catch(n){return console.error(`Error loading ${o} from localStorage:`,n),e}},t=n=>{try{localStorage.setItem(o,JSON.stringify(n))}catch(l){console.error(`Error saving ${o} to localStorage:`,l)}},r=()=>{try{localStorage.removeItem(o)}catch(n){console.error(`Error clearing ${o} from localStorage:`,n)}},i=I(s());return Ne(i,n=>{t(n)},{deep:!0}),{value:i,save:t,load:s,clear:r}}const xC={name:"WebhookLogFilters",props:{filters:{type:Object,required:!0}},emits:["update:filters","reset"],setup(o,{emit:e}){const s=I(null),t=NC("webhook-filters",{category:null,event:null,dateFrom:null,dateTo:null,hour:null,ip:null,status:null}),r=E=>(s.value=null,Rs(E)?(e("update:filters",E),!0):(s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",console.error("[WebhookLogFilters] Validation error:",s.value),!1)),i=new Date().toISOString().split("T")[0],n=I({category:t.value.category||o.filters.category||null,event:t.value.event||o.filters.event||null,dateFrom:t.value.dateFrom||o.filters.dateFrom||o.filters.date||i,dateTo:t.value.dateTo||o.filters.dateTo||null,hour:t.value.hour!==void 0?t.value.hour:o.filters.hour!==void 0?o.filters.hour:null,ip:t.value.ip||o.filters.ip||null,status:t.value.status||o.filters.status||null}),l=I(null),d=[{id:"today",label:"–°–µ–≥–æ–¥–Ω—è",getDates:()=>({from:i,to:i})},{id:"yesterday",label:"–í—á–µ—Ä–∞",getDates:()=>{const E=new Date;E.setDate(E.getDate()-1);const x=E.toISOString().split("T")[0];return{from:x,to:x}}},{id:"last7days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",getDates:()=>{const E=new Date;return E.setDate(E.getDate()-7),{from:E.toISOString().split("T")[0],to:i}}},{id:"last30days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π",getDates:()=>{const E=new Date;return E.setDate(E.getDate()-30),{from:E.toISOString().split("T")[0],to:i}}}],g=E=>{const x=d.find(R=>R.id===E);if(x){const R=x.getDates();n.value.dateFrom=R.from,n.value.dateTo=R.to,l.value=E,L()}};Ne(()=>o.filters,E=>{n.value={category:E.category||null,event:E.event||null,dateFrom:E.dateFrom||E.date||i,dateTo:E.dateTo||null,hour:E.hour!==void 0?E.hour:null,ip:E.ip||null,status:E.status||null}},{deep:!0}),Ne(n,E=>{t.value={...E},e("update:filters",{...E})},{deep:!0});const p=M(()=>{const E={};return n.value.category&&(E.category=n.value.category),n.value.event&&(E.event=n.value.event),n.value.hour!==null&&(E.hour=n.value.hour),n.value.ip&&(E.ip=n.value.ip),n.value.status&&(E.status=n.value.status),n.value.dateFrom&&n.value.dateFrom!==i&&(E.dateFrom=n.value.dateFrom),n.value.dateTo&&(E.dateTo=n.value.dateTo),E}),T=M(()=>Object.keys(p.value).length>0),v=E=>({category:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è",event:"–°–æ–±—ã—Ç–∏–µ",hour:"–ß–∞—Å",ip:"IP –∞–¥—Ä–µ—Å",status:"–°—Ç–∞—Ç—É—Å",dateFrom:"–î–∞—Ç–∞ –æ—Ç",dateTo:"–î–∞—Ç–∞ –¥–æ"})[E]||E,y=(E,x)=>E==="category"?bt(x)||x:E==="hour"?`${String(x).padStart(2,"0")}:00`:E==="event"?Vt(x)||x:E==="status"&&{success:"–£—Å–ø–µ—à–Ω–æ",error:"–û—à–∏–±–∫–∞",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"}[x]||x,k=M(()=>[{value:null,label:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},{value:"tasks",label:bt("tasks")},{value:"smart-processes",label:bt("smart-processes")},{value:"errors",label:bt("errors")}]),S=M(()=>[{value:null,label:"–í—Å–µ —Å–æ–±—ã—Ç–∏—è"},...["ONTASKADD","ONTASKUPDATE","ONTASKDELETE","ONTASKCOMMENTADD","ONTASKCOMMENTUPDATE","ONTASKCOMMENTDELETE","ONCRMDYNAMICITEMADD","ONCRMDYNAMICITEMUPDATE","ONCRMDYNAMICITEMDELETE"].map(x=>({value:x,label:Vt(x)}))]),C=E=>{E==="hour"?n.value[E]=null:E==="dateFrom"?n.value[E]=i:n.value[E]=null,l.value=null},f=E=>{const x={...n.value,category:E||null};r(x)&&(n.value.category=E)},w=E=>{const x={...n.value,event:E||null};r(x)&&(n.value.event=E)},$=(E,x)=>{if(E&&!/^\d{4}-\d{2}-\d{2}$/.test(E)){console.error("[WebhookLogFilters] Invalid date format:",E),s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã";return}const R={...n.value,[x]:E||null};r(R)&&(n.value[x]=E)},W=E=>{if(E!=null){const R=parseInt(E,10);if(isNaN(R)||R<0||R>23){console.error("[WebhookLogFilters] Invalid hour:",E),s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∞—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23)";return}}const x={...n.value,hour:E!=null?parseInt(E,10):null};r(x)&&(n.value.hour=E!=null?parseInt(E,10):null)},L=()=>{r({...n.value})},D=()=>{n.value={category:null,event:null,dateFrom:i,dateTo:null,hour:null,ip:null,status:null},l.value=null,t.clear(),e("reset")};return $e(()=>{t.value&&Object.keys(t.value).length>0&&e("update:filters",{...t.value})}),{localFilters:n,activeFilters:p,hasActiveFilters:T,getFilterLabel:v,getFilterValue:y,clearFilter:C,handleFilterChange:L,handleCategoryChange:f,handleEventChange:w,handleDateChange:$,handleHourChange:W,handleReset:D,quickFilters:d,activeQuickFilter:l,applyQuickFilter:g,categoryOptions:k,eventOptions:S,validationError:s}}},LC={class:"webhook-log-filters"},PC={key:0,class:"active-filters-indicator"},OC=["onClick"],RC={key:1,class:"validation-error"},BC={class:"quick-filters"},UC=["onClick"],WC={class:"filters-row"},FC={class:"filter-group"},HC=["value"],jC={class:"filter-group"},VC=["value"],zC={class:"filter-group"},GC={class:"filter-group"},KC={class:"filter-group"},qC={class:"filter-group"},YC={class:"filter-group"};function XC(o,e,s,t,r,i){return c(),u("div",LC,[t.hasActiveFilters?(c(),u("div",PC,[e[14]||(e[14]=a("span",{class:"indicator-text"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),u(ee,null,te(t.activeFilters,(n,l)=>(c(),u("span",{key:l,class:"filter-badge"},[ce(m(t.getFilterLabel(l))+": "+m(t.getFilterValue(l,n))+" ",1),a("button",{onClick:d=>t.clearFilter(l),class:"filter-badge-remove",title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"}," √ó ",8,OC)]))),128)),a("button",{onClick:e[0]||(e[0]=(...n)=>t.handleReset&&t.handleReset(...n)),class:"btn-clear-all"}," –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ ")])):A("",!0),t.validationError?(c(),u("div",RC," ‚ö†Ô∏è "+m(t.validationError),1)):A("",!0),a("div",BC,[e[15]||(e[15]=a("span",{class:"quick-filters-label"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),u(ee,null,te(t.quickFilters,n=>(c(),u("button",{key:n.id,onClick:l=>t.applyQuickFilter(n.id),class:X(["quick-filter-btn",{active:t.activeQuickFilter===n.id}])},m(n.label),11,UC))),128))]),a("div",WC,[a("div",FC,[e[16]||(e[16]=a("label",{for:"category-filter"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è:",-1)),Re(a("select",{id:"category-filter","onUpdate:modelValue":e[1]||(e[1]=n=>t.localFilters.category=n),onChange:e[2]||(e[2]=n=>t.handleCategoryChange(t.localFilters.category)),class:"filter-select"},[(c(!0),u(ee,null,te(t.categoryOptions,n=>(c(),u("option",{key:n.value,value:n.value},m(n.label),9,HC))),128))],544),[[dt,t.localFilters.category]])]),a("div",jC,[e[17]||(e[17]=a("label",{for:"event-filter"},"–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:",-1)),Re(a("select",{id:"event-filter","onUpdate:modelValue":e[3]||(e[3]=n=>t.localFilters.event=n),onChange:e[4]||(e[4]=n=>t.handleEventChange(t.localFilters.event)),class:"filter-select"},[(c(!0),u(ee,null,te(t.eventOptions,n=>(c(),u("option",{key:n.value,value:n.value},m(n.label),9,VC))),128))],544),[[dt,t.localFilters.event]])]),a("div",zC,[e[18]||(e[18]=a("label",{for:"date-from-filter"},"–î–∞—Ç–∞ –æ—Ç:",-1)),Re(a("input",{id:"date-from-filter","onUpdate:modelValue":e[5]||(e[5]=n=>t.localFilters.dateFrom=n),type:"date",onChange:e[6]||(e[6]=n=>t.handleDateChange(t.localFilters.dateFrom,"dateFrom")),class:"filter-input"},null,544),[[At,t.localFilters.dateFrom]])]),a("div",GC,[e[19]||(e[19]=a("label",{for:"date-to-filter"},"–î–∞—Ç–∞ –¥–æ:",-1)),Re(a("input",{id:"date-to-filter","onUpdate:modelValue":e[7]||(e[7]=n=>t.localFilters.dateTo=n),type:"date",onChange:e[8]||(e[8]=n=>t.handleDateChange(t.localFilters.dateTo,"dateTo")),class:"filter-input"},null,544),[[At,t.localFilters.dateTo]])]),a("div",KC,[e[20]||(e[20]=a("label",{for:"ip-filter"},"IP –∞–¥—Ä–µ—Å:",-1)),Re(a("input",{id:"ip-filter","onUpdate:modelValue":e[9]||(e[9]=n=>t.localFilters.ip=n),type:"text",placeholder:"192.168.1.1",onInput:e[10]||(e[10]=(...n)=>t.handleFilterChange&&t.handleFilterChange(...n)),class:"filter-input"},null,544),[[At,t.localFilters.ip]])]),a("div",qC,[e[22]||(e[22]=a("label",{for:"status-filter"},"–°—Ç–∞—Ç—É—Å:",-1)),Re(a("select",{id:"status-filter","onUpdate:modelValue":e[11]||(e[11]=n=>t.localFilters.status=n),onChange:e[12]||(e[12]=(...n)=>t.handleFilterChange&&t.handleFilterChange(...n)),class:"filter-select"},[...e[21]||(e[21]=[a("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),a("option",{value:"success"},"–£—Å–ø–µ—à–Ω–æ",-1),a("option",{value:"error"},"–û—à–∏–±–∫–∞",-1),a("option",{value:"warning"},"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",-1)])],544),[[dt,t.localFilters.status]])]),a("div",YC,[a("button",{onClick:e[13]||(e[13]=(...n)=>t.handleReset&&t.handleReset(...n)),class:"btn-reset"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])])}const JC=de(xC,[["render",XC],["__scopeId","data-v-2a150a46"]]),ZC={name:"WebhookLogList",props:{logs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null},pagination:{type:Object,default:null},selectedLogs:{type:Array,default:()=>[]}},emits:["select-log","page-change","update:selectedLogs"],setup(o,{emit:e}){const s=M(()=>!o.logs||!Array.isArray(o.logs)?(console.warn("[WebhookLogList] Invalid logs prop:",o.logs),[]):o.logs.map(x=>jt(x)).filter(x=>gt(x)?!0:(console.warn("[WebhookLogList] Invalid log entry:",x),!1))),t=I("timestamp"),r=I("desc"),i=x=>{t.value===x?r.value=r.value==="asc"?"desc":"asc":(t.value=x,r.value="desc")},n=M(()=>!s.value||s.value.length===0?[]:[...s.value].sort((R,U)=>{let G,q;switch(t.value){case"timestamp":G=new Date(R.timestamp||0).getTime(),q=new Date(U.timestamp||0).getTime();break;case"event":G=(R.event||"").toLowerCase(),q=(U.event||"").toLowerCase();break;case"category":G=(R.category||"").toLowerCase(),q=(U.category||"").toLowerCase();break;case"ip":G=(R.ip||"").toLowerCase(),q=(U.ip||"").toLowerCase();break;default:return 0}return G<q?r.value==="asc"?-1:1:G>q?r.value==="asc"?1:-1:0})),l=x=>t.value!==x?"‚ÜïÔ∏è":r.value==="asc"?"‚Üë":"‚Üì",d=x=>x.category==="errors"?"status-error":"status-success",g=x=>x.category==="errors"?"‚ùå":"‚úÖ",p=x=>x.category==="errors"?"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏":"–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ",T=x=>`${x.timestamp}_${x.event}_${x.ip||"unknown"}`,v=x=>x?Gs(x,"short"):"‚Äî",y=x=>x?Vt(x):"‚Äî",k=x=>x?bt(x):"‚Äî",S=x=>!x||typeof x!="object"?"‚Äî":Ks(x),C=x=>`category-${x}`,f=x=>x?.startsWith("ONTASK")?"event-task":x?.startsWith("ONCRMDYNAMIC")?"event-smart-process":"event-other",w=x=>{e("select-log",x)},$=x=>{x>=1&&x<=o.pagination.pages&&e("page-change",x)},W=x=>o.selectedLogs.some(R=>T(R)===T(x)),L=(x,R)=>{R.stopPropagation();const U=[...o.selectedLogs],G=T(x),q=U.findIndex(oe=>T(oe)===G);R.target.checked?q===-1&&U.push(x):q!==-1&&U.splice(q,1),e("update:selectedLogs",U)},D=x=>{x.target.checked?e("update:selectedLogs",[...o.logs]):e("update:selectedLogs",[])},E=M(()=>s.value.length>0&&s.value.every(x=>W(x)));return Ne(()=>o.logs,x=>{if(x&&Array.isArray(x)){const R=x.filter(U=>!gt(U)).length;R>0&&console.warn(`[WebhookLogList] Received ${R} invalid log entries out of ${x.length}`)}},{immediate:!0}),{validatedLogs:s,sortBy:t,sortOrder:r,sortedLogs:n,handleSort:i,getSortIcon:l,getStatusClass:d,getStatusIcon:g,getStatusTitle:p,getLogId:T,formatTimestamp:v,formatEvent:y,formatCategoryLabel:k,formatDetailsPreview:S,getCategoryClass:C,getEventClass:f,handleLogClick:w,handlePageChange:$,isSelected:W,handleSelectLog:L,handleSelectAll:D,allSelected:E}}},QC={class:"webhook-log-list"},eT={key:0,class:"logs-table-container"},tT={class:"logs-table"},sT={class:"checkbox-header"},aT=["checked"],oT={class:"sort-icon"},nT={class:"sort-icon"},rT={class:"sort-icon"},iT={class:"sort-icon"},lT=["onClick"],cT=["checked","onChange"],dT=["title"],uT={class:"details-preview"},gT=["onClick"],mT={key:0,class:"pagination"},hT=["disabled"],fT={class:"pagination-info"},vT=["disabled"];function pT(o,e,s,t,r,i){return c(),u("div",QC,[s.logs.length>0?(c(),u("div",eT,[a("table",tT,[a("thead",null,[a("tr",null,[a("th",sT,[a("input",{type:"checkbox",checked:t.allSelected,onChange:e[0]||(e[0]=(...n)=>t.handleSelectAll&&t.handleSelectAll(...n)),onClick:e[1]||(e[1]=Ce(()=>{},["stop"])),class:"checkbox-input",title:"–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"},null,40,aT)]),a("th",{onClick:e[2]||(e[2]=n=>t.handleSort("timestamp")),class:X(["sortable",{"sort-asc":t.sortBy==="timestamp"&&t.sortOrder==="asc","sort-desc":t.sortBy==="timestamp"&&t.sortOrder==="desc"}])},[e[9]||(e[9]=ce(" –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è ",-1)),a("span",oT,m(t.getSortIcon("timestamp")),1)],2),a("th",{onClick:e[3]||(e[3]=n=>t.handleSort("event")),class:X(["sortable",{"sort-asc":t.sortBy==="event"&&t.sortOrder==="asc","sort-desc":t.sortBy==="event"&&t.sortOrder==="desc"}])},[e[10]||(e[10]=ce(" –¢–∏–ø —Å–æ–±—ã—Ç–∏—è ",-1)),a("span",nT,m(t.getSortIcon("event")),1)],2),a("th",{onClick:e[4]||(e[4]=n=>t.handleSort("category")),class:X(["sortable",{"sort-asc":t.sortBy==="category"&&t.sortOrder==="asc","sort-desc":t.sortBy==="category"&&t.sortOrder==="desc"}])},[e[11]||(e[11]=ce(" –ö–∞—Ç–µ–≥–æ—Ä–∏—è ",-1)),a("span",rT,m(t.getSortIcon("category")),1)],2),a("th",{onClick:e[5]||(e[5]=n=>t.handleSort("ip")),class:X(["sortable",{"sort-asc":t.sortBy==="ip"&&t.sortOrder==="asc","sort-desc":t.sortBy==="ip"&&t.sortOrder==="desc"}])},[e[12]||(e[12]=ce(" IP ",-1)),a("span",iT,m(t.getSortIcon("ip")),1)],2),e[13]||(e[13]=a("th",null,"–î–µ—Ç–∞–ª–∏",-1)),e[14]||(e[14]=a("th",null,"–î–µ–π—Å—Ç–≤–∏—è",-1))])]),a("tbody",null,[(c(!0),u(ee,null,te(t.sortedLogs,n=>(c(),u("tr",{key:t.getLogId(n),onClick:l=>t.handleLogClick(n),class:X(["log-row",{"row-selected":t.isSelected(n)}])},[a("td",{onClick:e[6]||(e[6]=Ce(()=>{},["stop"]))},[a("input",{type:"checkbox",checked:t.isSelected(n),onChange:l=>t.handleSelectLog(n,l),class:"checkbox-input"},null,40,cT)]),a("td",null,m(t.formatTimestamp(n.timestamp)),1),a("td",null,[a("span",{class:X(["status-indicator",t.getStatusClass(n)]),title:t.getStatusTitle(n)},m(t.getStatusIcon(n)),11,dT),a("span",{class:X(["event-badge",t.getEventClass(n.event)])},m(t.formatEvent(n.event)),3)]),a("td",null,[a("span",{class:X(["category-badge",t.getCategoryClass(n.category)])},m(t.formatCategoryLabel(n.category)),3)]),a("td",null,m(n.ip||"N/A"),1),a("td",null,[a("div",uT,m(t.formatDetailsPreview(n.details)),1)]),a("td",null,[a("button",{onClick:Ce(l=>t.handleLogClick(n),["stop"]),class:"btn-view"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,gT)])],10,lT))),128))])]),s.pagination&&s.pagination.pages>1?(c(),u("div",mT,[a("button",{onClick:e[7]||(e[7]=n=>t.handlePageChange(s.pagination.page-1)),disabled:s.pagination.page<=1,class:"btn-pagination"}," –ù–∞–∑–∞–¥ ",8,hT),a("span",fT," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+m(s.pagination.page)+" –∏–∑ "+m(s.pagination.pages)+" (–≤—Å–µ–≥–æ: "+m(s.pagination.total)+") ",1),a("button",{onClick:e[8]||(e[8]=n=>t.handlePageChange(s.pagination.page+1)),disabled:s.pagination.page>=s.pagination.pages,class:"btn-pagination"}," –í–ø–µ—Ä—ë–¥ ",8,vT)])):A("",!0)])):A("",!0)])}const yT=de(ZC,[["render",pT],["__scopeId","data-v-fddd3018"]]),kT={name:"LoadingSkeleton",props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"20px"},variant:{type:String,default:"rect",validator:o=>["rect","circle","text","table-row"].includes(o)},animated:{type:Boolean,default:!0},borderRadius:{type:String,default:null}},setup(o){return{skeletonStyle:M(()=>{const s={width:typeof o.width=="number"?`${o.width}px`:o.width,height:typeof o.height=="number"?`${o.height}px`:o.height};return o.borderRadius&&(s.borderRadius=o.borderRadius),s})}}},bT={key:0,class:"skeleton-shimmer"};function _T(o,e,s,t,r,i){return c(),u("div",{class:X(["skeleton",[`skeleton-${s.variant}`,{"skeleton-animated":s.animated}]]),style:we(t.skeletonStyle)},[s.animated?(c(),u("div",bT)):A("",!0)],6)}const wT=de(kT,[["render",_T],["__scopeId","data-v-014f86e6"]]),CT={name:"SkeletonLogList",components:{LoadingSkeleton:wT},props:{rows:{type:Number,default:5}},setup(){return{getColumnWidth:e=>["40px","15%","20%","15%","15%","20%","15%"][e-1]||"100%"}}},TT={class:"skeleton-log-list"},ST={class:"skeleton-table-header"};function DT(o,e,s,t,r,i){const n=be("LoadingSkeleton");return c(),u("div",TT,[a("div",ST,[(c(),u(ee,null,te(7,l=>ne(n,{key:l,width:"120px",height:"16px",variant:"text"})),64))]),(c(!0),u(ee,null,te(s.rows,l=>(c(),u("div",{key:l,class:"skeleton-table-row"},[(c(),u(ee,null,te(7,d=>ne(n,{key:d,width:"100%",height:"20px",variant:"text",style:we({width:t.getColumnWidth(d)})},null,8,["style"])),64))]))),128))])}const ET=de(CT,[["render",DT],["__scopeId","data-v-475c4e73"]]),AT={name:"EmptyState",props:{icon:{type:String,default:"üì≠"},title:{type:String,required:!0},description:{type:String,required:!0},actionLabel:{type:String,default:null},actions:{type:Array,default:null},hints:{type:Array,default:()=>[]},variant:{type:String,default:"default",validator:o=>["default","error","warning","info"].includes(o)}},emits:["action","action-click"]},$T={class:"empty-icon"},IT={class:"empty-title"},MT={class:"empty-description"},NT={key:0,class:"empty-hints"},xT={key:1,class:"empty-actions"},LT=["onClick"];function PT(o,e,s,t,r,i){return c(),u("div",{class:X(["empty-state",`empty-state-${s.variant}`])},[a("div",$T,m(s.icon),1),a("h3",IT,m(s.title),1),a("p",MT,m(s.description),1),s.hints&&s.hints.length>0?(c(),u("div",NT,[(c(!0),u(ee,null,te(s.hints,(n,l)=>(c(),u("div",{key:l,class:"hint-item"}," üí° "+m(n),1))),128))])):A("",!0),s.actionLabel||s.actions?(c(),u("div",xT,[s.actionLabel?(c(),u("button",{key:0,onClick:e[0]||(e[0]=n=>o.$emit("action")),class:"btn-primary"},m(s.actionLabel),1)):A("",!0),(c(!0),u(ee,null,te(s.actions,(n,l)=>(c(),u("button",{key:l,onClick:d=>o.$emit("action-click",n.id),class:X(["btn",`btn-${n.variant||"secondary"}`])},m(n.label),11,LT))),128))])):A("",!0)],2)}const OT=de(AT,[["render",PT],["__scopeId","data-v-081c13b9"]]),RT={name:"ErrorDisplay",props:{title:{type:String,default:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"},message:{type:String,required:!0},details:{type:String,default:null},severity:{type:String,default:"error",validator:o=>["error","warning","critical"].includes(o)},retryable:{type:Boolean,default:!1}},emits:["retry"],setup(){return{showDetails:I(!1)}}},BT={class:"error-icon"},UT={class:"error-content"},WT={class:"error-title"},FT={class:"error-message"},HT={key:0,class:"error-details"},jT={class:"error-actions"};function VT(o,e,s,t,r,i){return c(),u("div",{class:X(["error-display",`error-${s.severity}`])},[a("div",BT,m(s.severity==="critical"?"üö®":"‚ö†Ô∏è"),1),a("div",UT,[a("h4",WT,m(s.title),1),a("p",FT,m(s.message),1),s.details&&t.showDetails?(c(),u("div",HT,[a("pre",null,m(s.details),1)])):A("",!0),a("div",jT,[s.retryable?(c(),u("button",{key:0,onClick:e[0]||(e[0]=n=>o.$emit("retry")),class:"btn-retry"}," üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")):A("",!0),s.details?(c(),u("button",{key:1,onClick:e[1]||(e[1]=n=>t.showDetails=!t.showDetails),class:"btn-details"},m(t.showDetails?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å")+" –¥–µ—Ç–∞–ª–∏ ",1)):A("",!0)])])],2)}const zT=de(RT,[["render",VT],["__scopeId","data-v-3f2f4c14"]]),GT={name:"Notification",props:{notification:{type:Object,required:!0}},emits:["close"],setup(o,{emit:e}){const s=I(100),t=M(()=>o.notification.duration>0);let r=null;const i={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},n=M(()=>i[o.notification.type]||"‚ÑπÔ∏è"),l=()=>{e("close")},d=()=>{o.notification.onClick&&o.notification.onClick()};return $e(()=>{if(t.value&&o.notification.duration>0){const g=Date.now(),p=o.notification.duration;r=setInterval(()=>{const T=Date.now()-g;s.value=Math.max(0,100-T/p*100),s.value<=0&&(clearInterval(r),l())},50)}}),st(()=>{r&&clearInterval(r)}),{icon:n,progress:s,showProgress:t,close:l,handleClick:d}}},KT={class:"notification-content"},qT={class:"notification-icon"},YT={class:"notification-message"},XT={key:0,class:"notification-progress"};function JT(o,e,s,t,r,i){return c(),u("div",{class:X(["notification",`notification-${s.notification.type}`]),onClick:e[1]||(e[1]=(...n)=>t.handleClick&&t.handleClick(...n))},[a("div",KT,[a("span",qT,m(t.icon),1),a("span",YT,m(s.notification.message),1)]),a("button",{onClick:e[0]||(e[0]=Ce((...n)=>t.close&&t.close(...n),["stop"])),class:"notification-close"},"‚úï"),t.showProgress?(c(),u("div",XT,[a("div",{class:"progress-bar",style:we({width:`${t.progress}%`})},null,4)])):A("",!0)],2)}const ZT=de(GT,[["render",JT],["__scopeId","data-v-1b602bdf"]]),QT={name:"NotificationContainer",components:{Notification:ZT},setup(){const{notifications:o,removeNotification:e}=mt();return{notifications:o,removeNotification:e}}},eS={class:"notification-container"};function tS(o,e,s,t,r,i){const n=be("Notification");return c(),he(It,{to:"body"},[a("div",eS,[ne(Qe,{name:"notification",tag:"div"},{default:pe(()=>[(c(!0),u(ee,null,te(t.notifications,l=>(c(),he(n,{key:l.id,notification:l,onClose:d=>t.removeNotification(l.id)},null,8,["notification","onClose"]))),128))]),_:1})])])}const sS=de(QT,[["render",tS],["__scopeId","data-v-dd8772c8"]]),aS={name:"RealtimeControls",props:{enabled:{type:Boolean,default:!1},connectionState:{type:String,default:"disconnected"},error:{type:String,default:null}},emits:["toggle"],setup(o,{emit:e}){const s=I(o.enabled);Ne(()=>o.enabled,T=>{s.value=T});const t=M(()=>o.connectionState==="connecting"),r=M(()=>!!o.error),i=M(()=>({"status-connected":o.connectionState==="connected","status-connecting":o.connectionState==="connecting","status-disconnected":o.connectionState==="disconnected","status-error":o.connectionState==="error"})),n=M(()=>{switch(o.connectionState){case"connected":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";case"connecting":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...";case"disconnected":return"–û—Ç–∫–ª—é—á–µ–Ω–æ";case"error":return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}}),l=M(()=>n.value),d=M(()=>({"status-connected":o.connectionState==="connected","status-connecting":o.connectionState==="connecting","status-disconnected":o.connectionState==="disconnected","status-error":o.connectionState==="error"})),g=M(()=>o.error?typeof o.error=="string"?o.error:o.error.message?o.error.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞":null);return{localEnabled:s,isConnecting:t,hasError:r,statusClass:i,statusText:n,connectionStatusText:l,connectionStatusClass:d,displayError:g,handleToggle:()=>{e("toggle",s.value)}}}},oS={class:"realtime-controls"},nS={class:"control-toggle"},rS=["disabled"],iS={class:"status-text"},lS={key:0,class:"error-message"};function cS(o,e,s,t,r,i){return c(),u("div",oS,[a("label",nS,[Re(a("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=n=>t.localEnabled=n),onChange:e[1]||(e[1]=(...n)=>t.handleToggle&&t.handleToggle(...n)),disabled:t.isConnecting},null,40,rS),[[bs,t.localEnabled]]),e[2]||(e[2]=a("span",{class:"toggle-label"},"–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",-1))]),a("div",{class:X(["status-indicator",t.statusClass])},[e[3]||(e[3]=a("span",{class:"status-dot"},null,-1)),a("span",iS,m(t.statusText),1)],2),t.hasError&&t.displayError?(c(),u("div",lS," ‚ö†Ô∏è "+m(t.displayError),1)):A("",!0)])}const dS=de(aS,[["render",cS],["__scopeId","data-v-af36f073"]]),uS={name:"NewLogsIndicator",props:{count:{type:Number,default:0},newLogs:{type:Array,default:()=>[]}},emits:["apply","dismiss"],setup(o,{emit:e}){const s=(n,l,d,g)=>{const p=n%10,T=n%100;return T>=11&&T<=19?g:p===1?l:p>=2&&p<=4?d:g},t=M(()=>!o.newLogs||!Array.isArray(o.newLogs)||o.newLogs.length===0?[]:o.newLogs.map(l=>jt(l)).filter(l=>gt(l)).slice(0,5).map(l=>({...l,formatted:{event:Vt(l.event),category:bt(l.category)}})));return{pluralize:s,newLogsPreview:t,handleApply:()=>{if(!o.newLogs||o.newLogs.length===0)return;const n=o.newLogs.map(l=>jt(l)).filter(l=>gt(l));if(n.length===0){console.warn("[NewLogsIndicator] No valid logs to apply");return}e("apply",n)},handleDismiss:()=>{e("dismiss")}}}},gS={key:0,class:"new-logs-indicator"},mS={class:"indicator-content"},hS={class:"indicator-text"},fS={class:"indicator-actions"};function vS(o,e,s,t,r,i){return c(),he(Ae,{name:"slide-down"},{default:pe(()=>[s.count>0?(c(),u("div",gS,[a("div",mS,[e[2]||(e[2]=a("span",{class:"indicator-icon"},"üîî",-1)),a("span",hS,m(s.count)+" "+m(t.pluralize(s.count,"–Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π")),1),a("div",fS,[a("button",{onClick:e[0]||(e[0]=(...n)=>t.handleApply&&t.handleApply(...n)),class:"btn-apply"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å "),a("button",{onClick:e[1]||(e[1]=(...n)=>t.handleDismiss&&t.handleDismiss(...n)),class:"btn-dismiss"}," ‚úï ")])])])):A("",!0)]),_:1})}const pS=de(uS,[["render",vS],["__scopeId","data-v-19791dbc"]]);class yS{constructor(e,s={}){this.url=e,this.options={reconnectInterval:3e3,maxReconnectAttempts:10,reconnectDelay:1e3,lastTimestamp:null,...s},this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.reconnectTimer=null,this.isManualDisconnect=!1,this.connectionState="disconnected"}updateOptions(e){this.options={...this.options,...e}}connect(){if(this.connectionState==="connected"||this.connectionState==="connecting"){console.warn("[RealtimeService] Already connected or connecting");return}this.isManualDisconnect=!1,this.connectionState="connecting",this.notifyListeners("state-change",{state:this.connectionState});try{let e=this.url;if(!e.startsWith("http://")&&!e.startsWith("https://")){const s=new URL(e,window.location.origin);this.options.lastTimestamp&&s.searchParams.set("last_timestamp",this.options.lastTimestamp),e=s.toString()}else{const s=new URL(e);this.options.lastTimestamp&&s.searchParams.set("last_timestamp",this.options.lastTimestamp),e=s.toString()}console.log("[RealtimeService] Connecting to:",e),this.eventSource=new EventSource(e),this.eventSource.onopen=()=>{console.log("[RealtimeService] EventSource opened"),this.notifyListeners("open",{timestamp:new Date().toISOString()})},this.eventSource.onmessage=s=>{try{const t=JSON.parse(s.data);this.notifyListeners("message",t)}catch(t){console.error("[RealtimeService] Error parsing message:",t)}},this.eventSource.addEventListener("connected",s=>{try{const t=JSON.parse(s.data);console.log("[RealtimeService] Connected event received:",t),this.connectionState="connected",this.reconnectAttempts=0,this.notifyListeners("connected",t),this.notifyListeners("state-change",{state:this.connectionState})}catch(t){console.error("[RealtimeService] Error parsing connected event:",t)}}),this.eventSource.addEventListener("new_logs",s=>{const t=JSON.parse(s.data);if(t.logs&&t.logs.length>0){const r=t.logs[t.logs.length-1];r.timestamp&&(this.options.lastTimestamp=r.timestamp)}this.notifyListeners("new_logs",t)}),this.eventSource.addEventListener("error",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("error",t)}catch{this.notifyListeners("error",{message:"Server error"})}}),this.eventSource.addEventListener("timeout",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("timeout",t)}catch{this.notifyListeners("timeout",{message:"Connection timeout"})}this.reconnect()}),this.eventSource.addEventListener("closed",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("closed",t)}catch{this.notifyListeners("closed",{message:"Connection closed"})}this.isManualDisconnect||this.reconnect()}),this.eventSource.onerror=s=>{console.error("[RealtimeService] Connection error:",s),console.error("[RealtimeService] EventSource readyState:",this.eventSource?.readyState),this.eventSource?.readyState===EventSource.CLOSED?(console.log("[RealtimeService] EventSource closed by server"),this.connectionState="disconnected",this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()):this.eventSource?.readyState===EventSource.CONNECTING?console.log("[RealtimeService] Still connecting..."):(this.connectionState="error",this.notifyListeners("error",{error:s,type:"connection",message:"Failed to connect to realtime stream",readyState:this.eventSource?.readyState}),this.notifyListeners("state-change",{state:this.connectionState}),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isManualDisconnect||this.reconnect())}}catch(e){console.error("[RealtimeService] Error creating EventSource:",e),this.connectionState="error",this.notifyListeners("error",{error:e,type:"initialization"}),this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()}}reconnect(){if(this.isManualDisconnect)return;if(this.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("[RealtimeService] Max reconnect attempts reached"),this.notifyListeners("max-reconnect-attempts",{attempts:this.reconnectAttempts});return}this.reconnectAttempts++;const e=Math.min(this.options.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.options.reconnectInterval);console.log(`[RealtimeService] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},e)}disconnect(){this.isManualDisconnect=!0,this.connectionState="disconnected",this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.notifyListeners("disconnected",{timestamp:new Date().toISOString()}),this.notifyListeners("state-change",{state:this.connectionState})}on(e,s){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(s)}off(e,s){if(this.listeners.has(e)){const t=this.listeners.get(e),r=t.indexOf(s);r>-1&&t.splice(r,1)}}notifyListeners(e,s){this.listeners.has(e)&&this.listeners.get(e).forEach(t=>{try{t(s)}catch(r){console.error(`[RealtimeService] Error in listener for ${e}:`,r)}})}getState(){return this.connectionState}isConnected(){return this.connectionState==="connected"}}function kS(o,e={}){const{autoConnect:s=!1,enableSound:t=!1,onNewLogs:r=null,validateLogs:i=!0}=e,n=new yS(o,e),l=I("disconnected"),d=I([]),g=I(0),p=I(null),T=I(null),v=I(0),y=M(()=>l.value==="connected"),k=M(()=>l.value==="connecting"),S=M(()=>l.value==="error"),C=M(()=>g.value>0),f=G=>{l.value=G.state,G.state==="connected"&&(v.value=0,T.value=null)},w=G=>{let q=G.logs||[];if(i){q=zs(q);const oe=q.filter(Y=>gt(Y));oe.length!==q.length&&console.warn("[useRealtime] Filtered out invalid logs:",q.length-oe.length),q=oe}q.length!==0&&(d.value.push(...q),g.value+=q.length,p.value=new Date().toISOString(),t&&q.length>0&&U(),r&&r(q))},$=G=>{const q=G.message||G.error?.message||"Connection error";T.value=q,l.value="error",console.error("[useRealtime] Error:",G)},W=G=>{console.warn("[useRealtime] Connection timeout:",G)},L=G=>{T.value=`Max reconnect attempts reached (${G.attempts})`,console.error("[useRealtime] Max reconnect attempts:",G)},D=(G={})=>{T.value=null,G.lastTimestamp!==void 0&&n.updateOptions({lastTimestamp:G.lastTimestamp}),n.on("state-change",f),n.on("new_logs",w),n.on("error",$),n.on("timeout",W),n.on("max-reconnect-attempts",L),n.connect()},E=()=>{n.off("state-change",f),n.off("new_logs",w),n.off("error",$),n.off("timeout",W),n.off("max-reconnect-attempts",L),n.disconnect()},x=()=>{d.value=[],g.value=0},R=G=>{G&&Array.isArray(G)&&(G.unshift(...d.value),x())},U=()=>{try{const G=new Audio("/sounds/notification.mp3");G.volume=.3,G.play().catch(q=>{console.warn("[useRealtime] Failed to play sound:",q)})}catch(G){console.warn("[useRealtime] Sound not available:",G)}};return s&&$e(()=>{D()}),st(()=>{E()}),{connectionState:l,isConnected:y,isConnecting:k,hasError:S,newLogs:d,newLogsCount:g,hasNewLogs:C,lastUpdateTime:p,error:T,reconnectAttempts:v,connect:D,disconnect:E,clearNewLogs:x,applyNewLogs:R}}const bS=ya(()=>Se(()=>import("./WebhookLogsDashboard.vue-7HhDWJ3Q.js"),__vite__mapDeps([8,7,4,2,3,0,1]),import.meta.url)),_S=ya(()=>Se(()=>import("./WebhookLogDetails.vue-ff5_m9p3.js"),__vite__mapDeps([9,7,4,2,3,0,1]),import.meta.url)),wS={name:"WebhookLogsPage",components:{WebhookLogsDashboard:bS,WebhookLogsExport:TC,WebhookLogSearch:MC,WebhookLogFilters:JC,WebhookLogList:yT,WebhookLogDetails:_S,SkeletonLogList:ET,EmptyState:OT,ErrorDisplay:zT,NotificationContainer:sS,RealtimeControls:dS,NewLogsIndicator:pS},setup(){const o=Xe(),{success:e,error:s}=mt(),t=I(!1),r=I(!1),i=I(null),n=I(null),l=I([]),d=(N,b=2)=>{if(N==null)return String(N);if(typeof N=="string")return N;const O=(Q,ue=0)=>{if(ue>10)return"[Max Depth]";if(Q==null||typeof Q!="object")return Q;if(Array.isArray(Q))return Q.map(_e=>O(_e,ue+1));const ke={};try{for(const _e in Q)if(Object.prototype.hasOwnProperty.call(Q,_e))try{const K=Q[_e];if(typeof K=="function"||K===void 0)continue;ke[_e]=O(K,ue+1)}catch{ke[_e]="[Error reading property]"}}catch{return"[Error reading object]"}return ke};try{const Q=O(N),ue=new WeakSet;return JSON.stringify(Q,(ke,_e)=>{if(typeof _e=="object"&&_e!==null){if(ue.has(_e))return"[Circular]";ue.add(_e)}return _e},b)}catch(Q){return console.error("[WebhookLogsPage] Error in safeStringify:",Q),`[Error: ${Q.message}]`}},g=I(null),p=I([]),T=I(""),v=I(null),y=I(null),k=I(!1),{connectionState:S,newLogsCount:C,error:f,connect:w,disconnect:$,applyNewLogs:W,clearNewLogs:L}=kS(et("/api/webhook-realtime.php"),{autoConnect:!1,enableSound:!0,validateLogs:!0,onNewLogs:N=>{console.log("[WebhookLogsPage] New logs received:",N.length),N.length>0&&(l.value.unshift(...N),R.value.total+=N.length,e(`–ü–æ–ª—É—á–µ–Ω–æ ${N.length} –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π`))}}),{filters:D,updateFilters:E,clearFilters:x}=Ow(),R=I({page:1,limit:50,total:0,pages:0}),U=M(()=>{let N=[...l.value];return T.value&&T.value.trim()&&(N=Rw(N,T.value,{caseSensitive:!1,searchInEvent:!0,searchInPayload:!0,searchInDetails:!0,searchInIp:!0})),D.value.category&&(N=N.filter(b=>b.category===D.value.category)),D.value.event&&(N=N.filter(b=>b.event===D.value.event)),D.value.ip&&(N=N.filter(b=>b.ip&&b.ip.includes(D.value.ip))),D.value.status&&(N=N.filter(b=>D.value.status==="error"?b.category==="errors":D.value.status==="success"?b.category!=="errors":!0)),D.value.dateFrom&&(N=N.filter(b=>b.timestamp?new Date(b.timestamp).toISOString().split("T")[0]>=D.value.dateFrom:!1)),D.value.dateTo&&(N=N.filter(b=>b.timestamp?new Date(b.timestamp).toISOString().split("T")[0]<=D.value.dateTo:!1)),D.value.hour!==null&&(N=N.filter(b=>b.timestamp?new Date(b.timestamp).getHours()===D.value.hour:!1)),N});Ne(U,N=>{v.value&&T.value&&v.value.setResultsCount(N.length)});const G=async()=>{try{await kt.init();const N=await kt.getCurrentUser();if(console.log("[WebhookLogsPage] User data:",N),!N||!N.ID){console.warn("[WebhookLogsPage] User not determined"),n.value=d({error:"User not determined",userId:N?.ID||null,userName:N?`${N.NAME||""} ${N.LAST_NAME||""}`.trim():null}),t.value=!1;return}const b=N?.UF_DEPARTMENT||[];if(console.log("[WebhookLogsPage] User departments:",b),console.log("[WebhookLogsPage] Allowed departments:",xt.allowedDepartmentIds),b.length>0){const O=b.some(Q=>wa(Q));console.log("[WebhookLogsPage] Has access:",O),t.value=O,O||(n.value=d({userId:N.ID,userName:`${N.NAME||""} ${N.LAST_NAME||""}`.trim(),userDepartments:b,allowedDepartments:xt.allowedDepartmentIds,message:"User departments do not match allowed departments"}))}else console.warn("[WebhookLogsPage] User has no departments"),n.value=d({userId:N.ID,userName:`${N.NAME||""} ${N.LAST_NAME||""}`.trim(),userDepartments:[],allowedDepartments:xt.allowedDepartmentIds,message:"User has no departments assigned"}),t.value=!1}catch(N){console.error("[WebhookLogsPage] Error checking access:",N),n.value=d({error:N.message,stack:N.stack}),t.value=!1}},q=M(()=>xt.allowedDepartmentIds.join(", ")),oe=async(N=!1)=>{if(t.value&&!(Z&&!N)){Z=!0,r.value=!0,i.value=null;try{const b=new Date().toISOString().split("T")[0],O={category:D.value.category||null,event:D.value.event||null,date:D.value.dateFrom||b,hour:D.value.hour!==null&&D.value.hour!==void 0?D.value.hour:null,ip:D.value.ip||null,status:D.value.status||null,dateFrom:D.value.dateFrom||b,dateTo:D.value.dateTo||null};if(!Rs(O))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");console.log("[WebhookLogsPage] Loading logs with filters:",O);const Q=await ua.getLogs(O,R.value.page,R.value.limit,N);if(console.log("[WebhookLogsPage] API result:",Q),console.log("[WebhookLogsPage] Logs count:",Q?.logs?.length||0),console.log("[WebhookLogsPage] Pagination:",Q?.pagination),!Q.success)throw new Error(Q.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤");Bw(Q.pagination)?R.value=Q.pagination:(console.warn("[WebhookLogsPage] Invalid pagination format, using defaults"),R.value={page:R.value.page,limit:R.value.limit,total:Q.logs.length,pages:Math.ceil(Q.logs.length/R.value.limit)});const ue=zs(Q.logs),ke=ue.filter(_e=>gt(_e));ke.length!==ue.length&&console.warn("[WebhookLogsPage] Filtered out invalid logs:",ue.length-ke.length),l.value=ke,N&&e("–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")}catch(b){Y(b)}finally{r.value=!1,Z=!1}}},Y=N=>{console.error("[WebhookLogsPage] API Error:",N),N.status===403?(i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",s("–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º –≤–µ–±—Ö—É–∫–æ–≤")):N.status===404?(i.value="–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",s("–õ–æ–≥–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")):N.status>=500?(i.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",s("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")):(i.value=N.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",s(i.value)),N.status>=500&&(l.value=[])},H=N=>{T.value=N,E({search:N||null})};let Z=!1;const fe=N=>{if(!Rs(N)){s("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");return}const b={category:D.value.category,event:D.value.event,dateFrom:D.value.dateFrom,dateTo:D.value.dateTo,hour:D.value.hour,ip:D.value.ip,status:D.value.status},O={category:N?.category||null,event:N?.event||null,dateFrom:N?.dateFrom||null,dateTo:N?.dateTo||null,hour:N?.hour!==void 0?N.hour:null,ip:N?.ip||null,status:N?.status||null},Q=Object.keys(O).some(ue=>{const ke=b[ue],_e=O[ue];return ke!==_e});if(!(!Q&&!Z)){if(E(O),R.value.page=1,Q)try{ua.invalidateCacheOnFilterChange(b,O)}catch(ue){console.error("[WebhookLogsPage] Error invalidating cache:",ue)}Z||(Z=!0,oe(!0).finally(()=>{Z=!1}))}},P=()=>{x(),T.value="",R.value.page=1,oe()},h=N=>{g.value=N},_=()=>{g.value=null},B=N=>{R.value.page=N,oe()},re=()=>{try{o.push("/")}catch(N){console.error("Navigation error:",N),window.location.hash="#/"}},le=N=>{p.value=N},ae=N=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—á–∞—Ç:",N)},me=N=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω:",N),e(`–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω: ${N.count} –∑–∞–ø–∏—Å–µ–π –≤ —Ñ–∞–π–ª–µ ${N.filename}`)},De=N=>{console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:",N),s(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${N.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`)},Ie=()=>{T.value="",P()},xe=N=>{if(console.log("[WebhookLogsPage] Toggle auto-update:",N),k.value=N,N){let b=null;if(l.value.length>0){const O=l.value[0];O.timestamp&&(b=O.timestamp,console.log("[WebhookLogsPage] Using lastTimestamp:",b))}w({lastTimestamp:b})}else $()},Fe=()=>{W(l.value),e("–ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")},z=()=>{L()};return $e(async()=>{await G(),t.value&&(D.value.search&&(T.value=D.value.search),await oe())}),{hasAccess:t,loading:r,error:i,logs:l,filteredLogs:U,selectedLog:g,selectedLogs:p,filters:D,searchQuery:T,searchComponent:v,pagination:R,previousPeriodStats:y,handleFiltersUpdate:fe,handleFiltersReset:P,handleSearch:H,handleLogSelect:h,handleLogClose:_,handlePageChange:B,handleSelectedLogsUpdate:le,handleExportStart:ae,handleExportComplete:me,handleExportError:De,handleClearSearch:Ie,autoUpdateEnabled:k,connectionState:S,newLogsCount:C,realtimeError:f,handleToggleAutoUpdate:xe,handleApplyNewLogs:Fe,handleDismissNewLogs:z,allowedDepartmentsText:q,accessDebugInfo:n,goBack:re}}},CS={class:"webhook-logs-page"},TS={class:"page-header"},SS={class:"page-header-top"},DS={key:0,class:"access-denied"},ES={class:"access-denied-content"},AS={class:"access-hint"},$S={key:0,class:"access-debug"},IS={key:1,class:"page-content"},MS={class:"actions-bar"};function NS(o,e,s,t,r,i){const n=be("WebhookLogsDashboard"),l=be("WebhookLogsExport"),d=be("WebhookLogSearch"),g=be("RealtimeControls"),p=be("NewLogsIndicator"),T=be("WebhookLogFilters"),v=be("SkeletonLogList"),y=be("WebhookLogList"),k=be("EmptyState"),S=be("ErrorDisplay"),C=be("WebhookLogDetails"),f=be("NotificationContainer");return c(),u("div",CS,[a("div",TS,[a("div",SS,[a("button",{onClick:e[0]||(e[0]=(...w)=>t.goBack&&t.goBack(...w)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[3]||(e[3]=[a("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),a("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[4]||(e[4]=a("h1",null,"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ Bitrix24",-1))]),t.hasAccess?(c(),u("div",IS,[ne(n,{logs:t.logs,pagination:t.pagination,"previous-period-stats":t.previousPeriodStats},null,8,["logs","pagination","previous-period-stats"]),a("div",MS,[ne(l,{logs:t.filteredLogs,"selected-logs":t.selectedLogs,filters:t.filters,"total-count":t.filteredLogs.length,onExportStart:t.handleExportStart,onExportComplete:t.handleExportComplete,onExportError:t.handleExportError},null,8,["logs","selected-logs","filters","total-count","onExportStart","onExportComplete","onExportError"]),ne(d,{modelValue:t.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=w=>t.searchQuery=w),onSearch:t.handleSearch,ref:"searchComponent"},null,8,["modelValue","onSearch"])]),ne(g,{enabled:t.autoUpdateEnabled,"connection-state":t.connectionState,error:t.realtimeError,onToggle:t.handleToggleAutoUpdate},null,8,["enabled","connection-state","error","onToggle"]),ne(p,{count:t.newLogsCount,onApply:t.handleApplyNewLogs,onDismiss:t.handleDismissNewLogs},null,8,["count","onApply","onDismiss"]),ne(T,{filters:t.filters,"onUpdate:filters":t.handleFiltersUpdate,onReset:t.handleFiltersReset},null,8,["filters","onUpdate:filters","onReset"]),ne(Ae,{name:"fade"},{default:pe(()=>[t.loading&&t.logs.length===0?(c(),he(v,{key:0,rows:5})):A("",!0)]),_:1}),ne(Ae,{name:"fade"},{default:pe(()=>[!t.loading&&t.filteredLogs.length>0?(c(),he(y,{key:0,logs:t.filteredLogs,loading:!1,error:null,pagination:t.pagination,"selected-logs":t.selectedLogs,onSelectLog:t.handleLogSelect,onPageChange:t.handlePageChange,"onUpdate:selectedLogs":t.handleSelectedLogsUpdate},null,8,["logs","pagination","selected-logs","onSelectLog","onPageChange","onUpdate:selectedLogs"])):A("",!0)]),_:1}),ne(Ae,{name:"fade"},{default:pe(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length===0?(c(),he(k,{key:0,icon:"üì≠",title:"–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",description:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Bitrix24.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è","–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",onAction:t.handleFiltersReset},null,8,["onAction"])):A("",!0)]),_:1}),ne(Ae,{name:"fade"},{default:pe(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length>0?(c(),he(k,{key:0,icon:"üîç",title:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",description:"–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã","–û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",onAction:t.handleClearSearch},null,8,["onAction"])):A("",!0)]),_:1}),ne(Ae,{name:"fade"},{default:pe(()=>[t.error?(c(),he(S,{key:0,title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤",message:t.error,retryable:!0,onRetry:o.loadLogs},null,8,["message","onRetry"])):A("",!0)]),_:1}),t.selectedLog?(c(),u("div",{key:0,class:"modal-overlay",onClick:e[2]||(e[2]=(...w)=>t.handleLogClose&&t.handleLogClose(...w))})):A("",!0),ne(Ae,{name:"modal"},{default:pe(()=>[t.selectedLog?(c(),he(C,{key:0,log:t.selectedLog,onClose:t.handleLogClose},null,8,["log","onClose"])):A("",!0)]),_:1})])):(c(),u("div",DS,[a("div",ES,[e[7]||(e[7]=a("h2",null,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",-1)),e[8]||(e[8]=a("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤.",-1)),a("p",AS,[e[5]||(e[5]=ce(" –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ –æ—Ç–¥–µ–ª–æ–≤: ",-1)),a("strong",null,m(t.allowedDepartmentsText),1)]),e[9]||(e[9]=a("p",{class:"access-hint"}," –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã. ",-1)),t.accessDebugInfo?(c(),u("details",$S,[e[6]||(e[6]=a("summary",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",-1)),a("pre",null,m(t.accessDebugInfo),1)])):A("",!0)])])),ne(f)])}const xS=de(wS,[["render",NS],["__scopeId","data-v-628bf174"]]),LS={name:"DrillDownNavigation",props:{breadcrumbs:{type:Array,default:()=>[],validator:o=>Array.isArray(o)&&o.every(e=>typeof e=="object"&&typeof e.id=="string"&&typeof e.label=="string")},separator:{type:String,default:">"},showBackButton:{type:Boolean,default:!0},additionalActions:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},maxLabelLength:{type:Number,default:30}},emits:["navigate","back","action"],setup(o,{emit:e}){const s=M(()=>o.breadcrumbs.map(d=>({...d,label:r(d.label,o.maxLabelLength)}))),t=M(()=>{const d=s.value;return d.length<=5?d:[d[0],{id:"ellipsis-start",label:"...",isEllipsis:!0},...d.slice(-3)]}),r=(d,g)=>d.length<=g?d:d.substring(0,g-3)+"...";return{visibleBreadcrumbs:t,handleNavigate:d=>{d.action&&e("navigate",d)},handleBack:()=>{e("back")},handleAction:d=>{e("action",d)}}}},PS={class:"drilldown-navigation",role:"navigation","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"},OS={class:"breadcrumb-list"},RS={key:0,class:"breadcrumb-separator","aria-hidden":"true"},BS=["onClick","onKeydown","aria-label","title"],US={class:"breadcrumb-text"},WS={key:2,class:"breadcrumb-current-text","aria-current":"page"},FS={class:"breadcrumb-text"},HS={key:3,class:"breadcrumb-loading","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"},jS=["aria-label","title"],VS={key:1,class:"breadcrumb-actions"},zS=["onClick","onKeydown","aria-label","title","disabled"],GS={key:1,class:"action-text"};function KS(o,e,s,t,r,i){return c(),u("nav",PS,[a("ol",OS,[(c(!0),u(ee,null,te(s.breadcrumbs,(n,l)=>(c(),u("li",{key:n.id,class:X(["breadcrumb-item",{"breadcrumb-current":l===s.breadcrumbs.length-1,"breadcrumb-interactive":l<s.breadcrumbs.length-1}])},[l>0?(c(),u("span",RS,m(s.separator),1)):A("",!0),l<s.breadcrumbs.length-1&&n.action?(c(),u("button",{key:1,class:"breadcrumb-link",onClick:d=>t.handleNavigate(n),onKeydown:[Be(d=>t.handleNavigate(n),["enter"]),Be(d=>t.handleNavigate(n),["space"])],"aria-label":`–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–∞–∑–¥–µ–ª—É ${n.label}`,title:`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${n.label}`},[n.icon?(c(),he(wt(n.icon),{key:0,class:"breadcrumb-icon","aria-hidden":"true"})):A("",!0),a("span",US,m(n.label),1)],40,BS)):(c(),u("span",WS,[n.icon?(c(),he(wt(n.icon),{key:0,class:"breadcrumb-icon","aria-hidden":"true"})):A("",!0),a("span",FS,m(n.label),1)])),l===s.breadcrumbs.length-1&&s.isLoading?(c(),u("div",HS,[...e[3]||(e[3]=[a("div",{class:"loading-spinner","aria-hidden":"true"},null,-1)])])):A("",!0)],2))),128))]),s.showBackButton&&s.breadcrumbs.length>1?(c(),u("button",{key:0,class:"back-button",onClick:e[0]||(e[0]=(...n)=>t.handleBack&&t.handleBack(...n)),onKeydown:[e[1]||(e[1]=Be((...n)=>t.handleBack&&t.handleBack(...n),["enter"])),e[2]||(e[2]=Be((...n)=>t.handleBack&&t.handleBack(...n),["space"]))],"aria-label":`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${s.breadcrumbs[s.breadcrumbs.length-2]?.label||"–ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Ä–∞–∑–¥–µ–ª—É"}`,title:`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${s.breadcrumbs[s.breadcrumbs.length-2]?.label||"–ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Ä–∞–∑–¥–µ–ª—É"}`},[...e[4]||(e[4]=[a("svg",{class:"back-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[a("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})],-1),a("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])],40,jS)):A("",!0),s.additionalActions.length>0?(c(),u("div",VS,[(c(!0),u(ee,null,te(s.additionalActions,n=>(c(),u("button",{key:n.id,class:X(["action-button",n.class]),onClick:l=>t.handleAction(n),onKeydown:[Be(l=>t.handleAction(n),["enter"]),Be(l=>t.handleAction(n),["space"])],"aria-label":n.label,title:n.title||n.label,disabled:n.disabled},[n.icon?(c(),he(wt(n.icon),{key:0,class:"action-icon","aria-hidden":"true"})):A("",!0),n.text?(c(),u("span",GS,m(n.text),1)):A("",!0)],42,zS))),128))])):A("",!0)])}const qS=de(LS,[["render",KS],["__scopeId","data-v-e0da3deb"]]),YS={name:"MetricCard",emits:["click"],props:{metric:{type:Object,default:()=>({})},title:{type:String,required:!0},value:{type:[Number,String],required:!0},unit:{type:String,default:""},subtitle:{type:String,default:""},icon:{type:String,default:""},trend:{type:Number,default:null},trendPeriod:{type:String,default:""},progress:{type:Number,default:null},size:{type:String,default:"medium",validator:o=>["small","medium","large","compact"].includes(o)},interactive:{type:Boolean,default:!1}},computed:{formattedValue(){return typeof this.value=="number"?this.value>=1e6?`${(this.value/1e6).toFixed(1)}M`:this.value>=1e3?`${(this.value/1e3).toFixed(1)}K`:this.value.toLocaleString():this.value}}},XS={class:"metric-header"},JS=["innerHTML"],ZS={class:"metric-title"},QS={class:"metric-value-section"},eD={class:"metric-value"},tD={key:0,class:"metric-unit"},sD={key:0,class:"metric-subtitle"},aD={key:1,class:"metric-trend"},oD={class:"trend-indicator"},nD={key:0,viewBox:"0 0 24 24",width:"12",height:"12"},rD={key:1,viewBox:"0 0 24 24",width:"12",height:"12"},iD={key:2,viewBox:"0 0 24 24",width:"12",height:"12"},lD={class:"trend-value"},cD={class:"trend-period"},dD={key:2,class:"metric-progress"},uD={class:"progress-bar"},gD={class:"progress-text"};function mD(o,e,s,t,r,i){return c(),u("div",{class:X(["metric-card",{[`size-${s.size}`]:!0,"has-trend":s.trend!==null,"trend-up":s.trend>0,"trend-down":s.trend<0,"trend-neutral":s.trend===0,interactive:s.interactive}]),onClick:e[0]||(e[0]=n=>s.interactive?o.$emit("click",s.metric):null)},[a("div",XS,[s.icon?(c(),u("div",{key:0,class:"metric-icon",innerHTML:s.icon},null,8,JS)):A("",!0),a("div",ZS,m(s.title),1)]),a("div",QS,[a("div",eD,m(i.formattedValue),1),s.unit?(c(),u("div",tD,m(s.unit),1)):A("",!0)]),s.subtitle?(c(),u("div",sD,m(s.subtitle),1)):A("",!0),s.trend!==null?(c(),u("div",aD,[a("div",oD,[s.trend>0?(c(),u("svg",nD,[...e[1]||(e[1]=[a("path",{d:"M7 14l5-5 5 5z",fill:"currentColor"},null,-1)])])):s.trend<0?(c(),u("svg",rD,[...e[2]||(e[2]=[a("path",{d:"M7 10l5 5 5-5z",fill:"currentColor"},null,-1)])])):(c(),u("svg",iD,[...e[3]||(e[3]=[a("path",{d:"M7 12h10v-2H7z",fill:"currentColor"},null,-1)])]))]),a("span",lD,m(Math.abs(s.trend))+"%",1),a("span",cD,m(s.trendPeriod||"vs prev"),1)])):A("",!0),s.progress!==null?(c(),u("div",dD,[a("div",uD,[a("div",{class:"progress-fill",style:we({width:`${Math.min(s.progress,100)}%`})},null,4)]),a("span",gD,m(s.progress)+"%",1)])):A("",!0)],2)}const hD=de(YS,[["render",mD],["__scopeId","data-v-b8d66bef"]]),fD={name:"ContextSidebar",components:{MetricCard:hD},props:{context:{type:String,default:"global",validator:o=>["global","user","management"].includes(o)},selectedUser:{type:Object,default:null},selectedUsers:{type:Array,default:()=>[]},globalMetrics:{type:Array,default:()=>[]},userStats:{type:Object,default:()=>({})},userFilters:{type:Object,default:()=>({timeRange:"week",activity_types:[]})},filterPresets:{type:Array,default:()=>[]},activePreset:{type:String,default:null},recentActivity:{type:Array,default:()=>[]},auditLog:{type:Array,default:()=>[]},activityTypes:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},collapsed:{type:Boolean,default:!1},canEditPermissions:{type:Boolean,default:!1}},emits:["toggle-collapse","metric-click","filter-preset-apply","activity-click","filter-change","view-profile","export-data","edit-permissions","bulk-action","user-select"],setup(o,{emit:e}){const s=I(o.collapsed),t=M(()=>{if(!o.selectedUser?.name)return"";const[$,W]=o.selectedUser.name.split(" ");return`${$?.[0]||""}${W?.[0]||""}`.toUpperCase()}),r=()=>{s.value=!s.value,e("toggle-collapse",s.value)},i=()=>{switch(o.context){case"global":return"–û–±–∑–æ—Ä";case"user":return"–ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è";case"management":return"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ";default:return"–û–±–∑–æ—Ä"}},n=()=>`${i()} - –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π`,l=$=>{switch($){case"online":return"–û–Ω–ª–∞–π–Ω";case"away":return"–û—Ç–æ—à—ë–ª";case"offline":return"–û—Ñ—Ñ–ª–∞–π–Ω";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}},d=$=>{if(!$)return"";const[W,L]=$.split(" ");return`${W?.[0]||""}${L?.[0]||""}`.toUpperCase()},g=$=>{const W=Math.floor($/60),L=$%60;return`${W}:${L.toString().padStart(2,"0")}`},p=$=>{const W=new Date($),D=new Date-W,E=Math.floor(D/(1e3*60)),x=Math.floor(D/(1e3*60*60)),R=Math.floor(D/(1e3*60*60*24));return E<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":E<60?`${E} –º–∏–Ω –Ω–∞–∑–∞–¥`:x<24?`${x} —á –Ω–∞–∑–∞–¥`:R<7?`${R} –¥ –Ω–∞–∑–∞–¥`:W.toLocaleDateString()},T=$=>{e("metric-click",$)},v=$=>{e("filter-preset-apply",$)},y=$=>{e("activity-click",$)},k=()=>{e("filter-change",o.userFilters)},S=()=>{e("view-profile",o.selectedUser)},C=()=>{e("export-data",o.selectedUser)},f=()=>{e("edit-permissions",o.selectedUser)},w=$=>{e("bulk-action",{action:$,users:o.selectedUsers})};return Ne(()=>o.collapsed,$=>{s.value=$}),{isCollapsed:s,userInitials:t,toggleCollapse:r,getContextTitle:i,getAriaLabel:n,getStatusText:l,getUserInitials:d,formatDuration:g,formatTime:p,handleMetricClick:T,applyFilterPreset:v,handleActivityClick:y,handleFilterChange:k,viewDetailedProfile:S,exportUserData:C,editPermissions:f,performBulkAction:w}}},vD=["aria-label"],pD=["aria-label","title"],yD={class:"sidebar-header"},kD={class:"context-title"},bD={key:0,class:"user-indicator"},_D={class:"user-avatar"},wD=["src","alt"],CD={key:1,class:"avatar-placeholder"},TD={class:"user-info"},SD={class:"user-name"},DD={key:0,class:"global-context-content"},ED={class:"metrics-section"},AD={class:"metrics-grid"},$D={class:"filters-section"},ID={class:"filter-presets"},MD=["onClick","aria-label"],ND={class:"preset-label"},xD={key:0,class:"preset-count"},LD={class:"recent-activity-section"},PD={class:"recent-activity-list"},OD=["onClick"],RD={class:"activity-content"},BD={class:"activity-text"},UD={class:"activity-time"},WD={key:1,class:"user-context-content"},FD={class:"user-stats-section"},HD={class:"user-stats-grid"},jD={class:"stat-item"},VD={class:"stat-value"},zD={class:"stat-item"},GD={class:"stat-value"},KD={class:"stat-item"},qD={class:"stat-value"},YD={class:"stat-item"},XD={class:"stat-value"},JD={class:"analysis-filters-section"},ZD={class:"filter-controls"},QD={class:"filter-group"},e2={class:"filter-group"},t2={class:"checkbox-group"},s2=["value"],a2={class:"user-actions-section"},o2={class:"action-buttons"},n2=["aria-label"],r2=["aria-label"],i2=["aria-label"],l2={key:2,class:"management-context-content"},c2={key:0,class:"selected-users-section"},d2={class:"section-title"},u2={class:"selected-users-list"},g2={class:"user-avatar small"},m2=["src","alt"],h2={key:1,class:"avatar-placeholder small"},f2={class:"user-name"},v2={key:0,class:"more-users"},p2={class:"bulk-operations-section"},y2={class:"bulk-actions"},k2=["disabled"],b2=["disabled"],_2=["disabled"],w2={class:"audit-log-section"},C2={class:"audit-log-list"},T2={class:"audit-content"},S2={class:"audit-text"},D2={class:"audit-time"},E2={key:0,class:"sidebar-loading-overlay"};function A2(o,e,s,t,r,i){const n=be("MetricCard");return c(),u("aside",{class:X(["context-sidebar",{collapsed:t.isCollapsed,"context-global":s.context==="global","context-user":s.context==="user","context-management":s.context==="management"}]),role:"complementary","aria-label":t.getAriaLabel()},[a("button",{class:"collapse-toggle",onClick:e[0]||(e[0]=(...l)=>t.toggleCollapse&&t.toggleCollapse(...l)),onKeydown:[e[1]||(e[1]=Be((...l)=>t.toggleCollapse&&t.toggleCollapse(...l),["enter"])),e[2]||(e[2]=Be((...l)=>t.toggleCollapse&&t.toggleCollapse(...l),["space"]))],"aria-label":t.isCollapsed?"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å":"–°–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å",title:t.isCollapsed?"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å":"–°–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å"},[(c(),u("svg",{class:X(["collapse-icon",{rotated:t.isCollapsed}]),viewBox:"0 0 24 24","aria-hidden":"true"},[...e[13]||(e[13]=[a("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"},null,-1)])],2))],40,pD),a("header",yD,[a("h3",kD,m(t.getContextTitle()),1),s.context==="user"&&s.selectedUser?(c(),u("div",bD,[a("div",_D,[s.selectedUser.avatar?(c(),u("img",{key:0,src:s.selectedUser.avatar,alt:`–ê–≤–∞—Ç–∞—Ä ${s.selectedUser.name}`},null,8,wD)):(c(),u("div",CD,m(t.userInitials),1))]),a("div",TD,[a("div",SD,m(s.selectedUser.name),1),a("div",{class:X(["user-status",s.selectedUser.status])},m(t.getStatusText(s.selectedUser.status)),3)])])):A("",!0)]),a("div",{class:X(["sidebar-content",{"content-collapsed":t.isCollapsed}])},[s.context==="global"?(c(),u("div",DD,[a("section",ED,[e[14]||(e[14]=a("h4",{class:"section-title"},"–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",-1)),a("div",AD,[(c(!0),u(ee,null,te(s.globalMetrics,l=>(c(),he(n,{key:l.id,metric:l,size:"compact",onClick:t.handleMetricClick},null,8,["metric","onClick"]))),128))])]),a("section",$D,[e[15]||(e[15]=a("h4",{class:"section-title"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã",-1)),a("div",ID,[(c(!0),u(ee,null,te(s.filterPresets,l=>(c(),u("button",{key:l.id,class:X(["filter-preset",{active:s.activePreset===l.id}]),onClick:d=>t.applyFilterPreset(l),"aria-label":`–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä: ${l.label}`},[(c(),he(wt(l.icon),{class:"preset-icon"})),a("span",ND,m(l.label),1),l.count!==void 0?(c(),u("span",xD,m(l.count),1)):A("",!0)],10,MD))),128))])]),a("section",LD,[e[16]||(e[16]=a("h4",{class:"section-title"},"–ù–µ–¥–∞–≤–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",-1)),a("div",PD,[(c(!0),u(ee,null,te(s.recentActivity,l=>(c(),u("div",{key:l.id,class:"activity-item",onClick:d=>t.handleActivityClick(l)},[a("div",{class:X(["activity-icon",l.type])},[(c(),he(wt(l.icon)))],2),a("div",RD,[a("div",BD,m(l.text),1),a("div",UD,m(t.formatTime(l.timestamp)),1)])],8,OD))),128))])])])):s.context==="user"?(c(),u("div",WD,[a("section",FD,[e[21]||(e[21]=a("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",-1)),a("div",HD,[a("div",jD,[a("div",VD,m(s.userStats.total_actions||0),1),e[17]||(e[17]=a("div",{class:"stat-label"},"–¥–µ–π—Å—Ç–≤–∏–π",-1)),s.userStats.actions_change!==0?(c(),u("div",{key:0,class:X(["stat-change",{positive:s.userStats.actions_change>0,negative:s.userStats.actions_change<0}])},m(s.userStats.actions_change>0?"+":"")+m(s.userStats.actions_change)+"% ",3)):A("",!0)]),a("div",zD,[a("div",GD,m(t.formatDuration(s.userStats.avg_session_duration||0)),1),e[18]||(e[18]=a("div",{class:"stat-label"},"—Å—Ä–µ–¥–Ω—è—è —Å–µ—Å—Å–∏—è",-1))]),a("div",KD,[a("div",qD,m(s.userStats.total_sessions||0),1),e[19]||(e[19]=a("div",{class:"stat-label"},"—Å–µ—Å—Å–∏–π",-1))]),a("div",YD,[a("div",XD,m(s.userStats.activity_score||0)+"/100",1),e[20]||(e[20]=a("div",{class:"stat-label"},"–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1))])])]),a("section",JD,[e[26]||(e[26]=a("h4",{class:"section-title"},"–§–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞",-1)),a("div",ZD,[a("div",QD,[e[23]||(e[23]=a("label",{class:"filter-label"},"–ü–µ—Ä–∏–æ–¥:",-1)),Re(a("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>s.userFilters.timeRange=l),class:"filter-select",onChange:e[4]||(e[4]=(...l)=>t.handleFilterChange&&t.handleFilterChange(...l))},[...e[22]||(e[22]=[_t('<option value="today" data-v-abccaced>–°–µ–≥–æ–¥–Ω—è</option><option value="week" data-v-abccaced>–ù–µ–¥–µ–ª—è</option><option value="month" data-v-abccaced>–ú–µ—Å—è—Ü</option><option value="quarter" data-v-abccaced>–ö–≤–∞—Ä—Ç–∞–ª</option><option value="year" data-v-abccaced>–ì–æ–¥</option>',5)])],544),[[dt,s.userFilters.timeRange]])]),a("div",e2,[e[25]||(e[25]=a("label",{class:"filter-label"},"–¢–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π:",-1)),a("div",t2,[(c(!0),u(ee,null,te(s.activityTypes,l=>(c(),u("label",{key:l.id,class:"checkbox-label"},[Re(a("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":e[5]||(e[5]=d=>s.userFilters.activity_types=d),onChange:e[6]||(e[6]=(...d)=>t.handleFilterChange&&t.handleFilterChange(...d))},null,40,s2),[[bs,s.userFilters.activity_types]]),e[24]||(e[24]=a("span",{class:"checkmark"},null,-1)),ce(" "+m(l.label),1)]))),128))])])])]),a("section",a2,[e[30]||(e[30]=a("h4",{class:"section-title"},"–î–µ–π—Å—Ç–≤–∏—è",-1)),a("div",o2,[a("button",{class:"action-button primary",onClick:e[7]||(e[7]=(...l)=>t.viewDetailedProfile&&t.viewDetailedProfile(...l)),"aria-label":`–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å ${s.selectedUser?.name}`},[...e[27]||(e[27]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L19 6.6C18.8 6 18.5 5.4 18.1 4.9L19 3L17 1L15.4 1.9C14.9 1.5 14.3 1.2 13.7 1L13 0V2C12.4 2 11.8 2.2 11.3 2.6L10.6 1.9L8.6 3L9.5 4.9C9.1 5.4 8.8 6 8.6 6.6L7 7V9L8.6 8.4C8.8 9 9.1 9.6 9.5 10.1L8.6 12L10.6 13.9L11.3 13.2C11.8 13.6 12.4 13.8 13 14V16H11V18H13V20H11V22H13V20H15V18H13V16H15V14C15.6 14 16.2 13.6 16.7 13.2L17.4 13.9L19.4 12L18.5 10.1C18.9 9.6 19.2 9 19.4 8.4L21 9ZM12 8C10.9 8 10 7.1 10 6C10 4.9 10.9 4 12 4C13.1 4 14 4.9 14 6C14 7.1 13.1 8 12 8Z"})],-1),ce(" –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å ",-1)])],8,n2),a("button",{class:"action-button secondary",onClick:e[8]||(e[8]=(...l)=>t.exportUserData&&t.exportUserData(...l)),"aria-label":`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ ${s.selectedUser?.name}`},[...e[28]||(e[28]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),ce(" –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö ",-1)])],8,r2),s.canEditPermissions?(c(),u("button",{key:0,class:"action-button warning",onClick:e[9]||(e[9]=(...l)=>t.editPermissions&&t.editPermissions(...l)),"aria-label":`–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ${s.selectedUser?.name}`},[...e[29]||(e[29]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),ce(" –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ",-1)])],8,i2)):A("",!0)])])])):s.context==="management"?(c(),u("div",l2,[s.selectedUsers.length>0?(c(),u("section",c2,[a("h4",d2,"–í—ã–±—Ä–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: "+m(s.selectedUsers.length),1),a("div",u2,[(c(!0),u(ee,null,te(s.selectedUsers.slice(0,3),l=>(c(),u("div",{key:l.id,class:"selected-user-item"},[a("div",g2,[l.avatar?(c(),u("img",{key:0,src:l.avatar,alt:l.name},null,8,m2)):(c(),u("div",h2,m(t.getUserInitials(l.name)),1))]),a("span",f2,m(l.name),1)]))),128)),s.selectedUsers.length>3?(c(),u("div",v2," +"+m(s.selectedUsers.length-3)+" –µ—â—ë ",1)):A("",!0)])])):A("",!0),a("section",p2,[e[34]||(e[34]=a("h4",{class:"section-title"},"–ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",-1)),a("div",y2,[a("button",{class:"bulk-action-button",onClick:e[10]||(e[10]=l=>t.performBulkAction("change_department")),disabled:s.selectedUsers.length===0},[...e[31]||(e[31]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),ce(" –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–¥–µ–ª ",-1)])],8,k2),a("button",{class:"bulk-action-button",onClick:e[11]||(e[11]=l=>t.performBulkAction("toggle_admin")),disabled:s.selectedUsers.length===0},[...e[32]||(e[32]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),ce(" –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ",-1)])],8,b2),a("button",{class:"bulk-action-button",onClick:e[12]||(e[12]=l=>t.performBulkAction("export")),disabled:s.selectedUsers.length===0},[...e[33]||(e[33]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),ce(" –≠–∫—Å–ø–æ—Ä—Ç ",-1)])],8,_2)])]),a("section",w2,[e[35]||(e[35]=a("h4",{class:"section-title"},"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è",-1)),a("div",C2,[(c(!0),u(ee,null,te(s.auditLog.slice(0,5),l=>(c(),u("div",{key:l.id,class:"audit-entry"},[a("div",{class:X(["audit-icon",l.type])},[(c(),he(wt(l.icon)))],2),a("div",T2,[a("div",S2,m(l.text),1),a("div",D2,m(t.formatTime(l.timestamp)),1)])]))),128))])])])):A("",!0)],2),s.isLoading?(c(),u("div",E2,[...e[36]||(e[36]=[a("div",{class:"loading-spinner","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"},null,-1)])])):A("",!0)],10,vD)}const $2=de(fD,[["render",A2],["__scopeId","data-v-abccaced"]]),ma=o=>new Date(o),I2=(o,e,s={})=>{const t=new Date(o),r=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return e.replace("yyyy",r).replace("MM",i).replace("dd",n)},M2={name:"UnifiedUserCard",props:{user:{type:Object,required:!0,validator:o=>o&&typeof o=="object"&&o.id&&o.name&&o.email},isSelected:{type:Boolean,default:!1},showExtendedMetrics:{type:Boolean,default:!1},compactView:{type:Boolean,default:!1},canEditPermissions:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},maxDepartments:{type:Number,default:2}},emits:["select","view-profile","edit-permissions","toggle-hidden","view-analytics","export-data","send-notification","view-audit","delete-user"],setup(o,{emit:e}){const s=I(!1),t=I(null),r=M(()=>{const[P,h]=o.user.name.split(" ");return`${P?.[0]||""}${h?.[0]||""}`.toUpperCase()}),i=M(()=>{const P=["#2196F3","#4CAF50","#FF9800","#F44336","#9C27B0","#00BCD4","#8BC34A","#FFC107","#E91E63","#3F51B5"];return P[Math.abs(o.user.id)%P.length]}),n=M(()=>(o.user.departments||[]).slice(0,o.maxDepartments).map(h=>({...h,shortName:h.name.length>10?h.name.substring(0,8)+"...":h.name}))),l=M(()=>{const P=o.user.departments||[];return Math.max(0,P.length-o.maxDepartments)}),d=M(()=>{const P=o.user.activity_stats?.total_actions||0;return P>=1e6?`${(P/1e6).toFixed(1)}M`:P>=1e3?`${(P/1e3).toFixed(1)}K`:P.toLocaleString()}),g=M(()=>{const P=o.user.activity_stats?.total_sessions||0;return P>=1e3?`${(P/1e3).toFixed(1)}K`:P.toString()}),p=M(()=>{const P=o.user.activity_stats?.avg_session_duration||0,h=Math.floor(P/60),_=Math.floor(P%60);return`${h}:${_.toString().padStart(2,"0")}`}),T=M(()=>{const P=o.user.activity_stats?.last_activity;if(!P)return"–ù–∏–∫–æ–≥–¥–∞";let h;try{h=typeof P=="string"?ma(P):new Date(P)}catch{return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}const B=new Date-h,re=Math.floor(B/(1e3*60*60*24)),le=Math.floor(B/(1e3*60*60)),ae=Math.floor(B/(1e3*60));return ae<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":ae<60?`${ae} –º–∏–Ω`:le<24?`${le} —á`:re<7?`${re} –¥`:re<30?`${Math.floor(re/7)} –Ω–µ–¥`:I2(h,"dd.MM.yyyy")}),v=M(()=>Math.min(100,Math.max(0,o.user.activity_stats?.activity_score||0))),y=M(()=>o.user.activity_stats?.actions_change_percent||0),k=M(()=>o.user.status||"offline"),S=M(()=>!!o.user.is_admin),C=M(()=>{if(!o.user.created_at)return!1;try{const P=typeof o.user.created_at=="string"?ma(o.user.created_at):new Date(o.user.created_at);return Math.floor((new Date-P)/(1e3*60*60*24))<=7}catch{return!1}}),f=M(()=>!!o.user.is_hidden),w=M(()=>o.user.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"),$=M(()=>o.user.email||""),W=M(()=>o.user.avatar||null),L=()=>{e("select",o.user)},D=()=>{e("view-profile",o.user)},E=()=>{e("edit-permissions",o.user)},x=()=>{e("toggle-hidden",o.user)},R=()=>{s.value=!0;const P=h=>{t.value&&!t.value.contains(h.target)&&(s.value=!1,document.removeEventListener("click",P))};setTimeout(()=>{document.addEventListener("click",P)},0)},U=()=>{s.value=!1,e("view-analytics",o.user)},G=()=>{s.value=!1,e("export-data",o.user)},q=()=>{s.value=!1,e("send-notification",o.user)},oe=()=>{s.value=!1,e("view-audit",o.user)},Y=()=>{s.value=!1,confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${o.user.name}?`)&&e("delete-user",o.user)},H=()=>{console.warn(`Failed to load avatar for user ${o.user.id}`)},Z=P=>{switch(P){case"online":return"–æ–Ω–ª–∞–π–Ω";case"away":return"–æ—Ç–æ—à—ë–ª";case"offline":return"–æ—Ñ—Ñ–ª–∞–π–Ω";default:return"–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}},fe=P=>{if(P.key==="Enter"||P.key===" ")P.preventDefault(),L();else if(P.key==="ArrowDown"){P.preventDefault();const h=P.target.nextElementSibling;h&&h.focus()}else if(P.key==="ArrowUp"){P.preventDefault();const h=P.target.previousElementSibling;h&&h.focus()}};return $e(()=>{const P=document.querySelector(`[data-user-id="${o.user.id}"]`);P&&P.addEventListener("keydown",fe)}),st(()=>{const P=document.querySelector(`[data-user-id="${o.user.id}"]`);P&&P.removeEventListener("keydown",fe)}),{showContextMenuFlag:s,contextMenuRef:t,userInitials:r,avatarColor:i,visibleDepartments:n,hiddenDepartmentsCount:l,totalActionsFormatted:d,totalSessionsFormatted:g,avgSessionDurationFormatted:p,lastActivityFormatted:T,activityScore:v,actionsChange:y,userStatus:k,isAdmin:S,isNew:C,isHidden:f,userName:w,userEmail:$,userAvatar:W,handleSelect:L,viewProfile:D,editPermissions:E,toggleHidden:x,showContextMenu:R,viewDetailedAnalytics:U,exportUserData:G,sendNotification:q,viewAuditLog:oe,deleteUser:Y,handleAvatarError:H,getStatusText:Z}}},N2=["aria-label","aria-selected","aria-describedby"],x2={class:"user-avatar-section"},L2={class:"avatar-container"},P2=["src","alt"],O2=["title"],R2={key:2,class:"new-indicator",title:"–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"},B2={class:"user-info-section"},U2={class:"user-header"},W2={class:"user-name"},F2={class:"user-badges"},H2={key:0,class:"badge admin",title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"},j2={key:1,class:"badge hidden",title:"–°–∫—Ä—ã—Ç—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"},V2={class:"user-email"},z2={key:0,class:"user-departments"},G2=["title"],K2=["title"],q2={class:"user-metrics-section"},Y2={class:"metric primary"},X2={class:"metric-value"},J2=["title"],Z2={class:"metric secondary"},Q2={class:"metric-value"},eE={key:0,class:"activity-score"},tE={class:"score-bar"},sE=["title"],aE={key:1,class:"mini-metrics"},oE={class:"mini-metric"},nE={class:"mini-metric"},rE={class:"user-actions-section"},iE=["aria-label","title"],lE=["aria-label","title"],cE=["aria-label","title"],dE=["aria-label"],uE=["aria-label"],gE=["aria-label"],mE=["aria-label"],hE=["aria-label"],fE=["aria-label"],vE=["aria-label"],pE=["id"],yE={key:1,class:"selection-indicator","aria-hidden":"true"};function kE(o,e,s,t,r,i){return c(),u("div",{class:X(["unified-user-card",{selected:s.isSelected,"activity-high":t.activityScore>=80,"activity-medium":t.activityScore>=50&&t.activityScore<80,"activity-low":t.activityScore<50,"status-online":t.userStatus==="online","status-away":t.userStatus==="away","status-offline":t.userStatus==="offline","has-departments":t.visibleDepartments.length>0,"is-admin":t.isAdmin,"is-new":t.isNew,"is-hidden":t.isHidden,"compact-view":s.compactView}]),onClick:e[10]||(e[10]=(...n)=>t.handleSelect&&t.handleSelect(...n)),onDblclick:e[11]||(e[11]=(...n)=>t.viewProfile&&t.viewProfile(...n)),onKeydown:[e[12]||(e[12]=Be((...n)=>t.handleSelect&&t.handleSelect(...n),["enter"])),e[13]||(e[13]=Be((...n)=>t.handleSelect&&t.handleSelect(...n),["space"]))],onContextmenu:e[14]||(e[14]=Ce((...n)=>t.showContextMenu&&t.showContextMenu(...n),["prevent"])),tabindex:"0",role:"button","aria-label":`–í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`,"aria-selected":s.isSelected,"aria-describedby":`user-card-${s.user.id}-description`},[a("div",x2,[a("div",L2,[t.userAvatar?(c(),u("img",{key:0,src:t.userAvatar,alt:`–ê–≤–∞—Ç–∞—Ä ${t.userName}`,class:"user-avatar",onError:e[0]||(e[0]=(...n)=>t.handleAvatarError&&t.handleAvatarError(...n))},null,40,P2)):(c(),u("div",{key:1,class:"avatar-placeholder",style:we({backgroundColor:t.avatarColor})},m(t.userInitials),5)),a("div",{class:X(["status-indicator",t.userStatus]),title:`–°—Ç–∞—Ç—É—Å: ${t.getStatusText(t.userStatus)}`},null,10,O2),t.isNew?(c(),u("div",R2," NEW ")):A("",!0)])]),a("div",B2,[a("div",U2,[a("h4",W2,m(t.userName),1),a("div",F2,[t.isAdmin?(c(),u("span",H2," –ê–¥–º–∏–Ω ")):A("",!0),t.isHidden?(c(),u("span",j2," –°–∫—Ä—ã—Ç ")):A("",!0)])]),a("p",V2,m(t.userEmail),1),t.visibleDepartments.length>0?(c(),u("div",z2,[(c(!0),u(ee,null,te(t.visibleDepartments,n=>(c(),u("span",{key:n.id,class:"dept-tag",style:we({backgroundColor:n.color}),title:n.name},m(n.shortName||n.name),13,G2))),128)),t.hiddenDepartmentsCount>0?(c(),u("span",{key:0,class:"dept-more",title:`–ï—â—ë ${t.hiddenDepartmentsCount} –æ—Ç–¥–µ–ª–æ–≤`}," +"+m(t.hiddenDepartmentsCount),9,K2)):A("",!0)])):A("",!0)]),a("div",q2,[a("div",Y2,[a("div",X2,m(t.totalActionsFormatted),1),e[15]||(e[15]=a("div",{class:"metric-label"},"–¥–µ–π—Å—Ç–≤–∏–π",-1)),t.actionsChange!==0?(c(),u("div",{key:0,class:X(["metric-change",{positive:t.actionsChange>0,negative:t.actionsChange<0}]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ: ${t.actionsChange>0?"+":""}${t.actionsChange}%`},m(t.actionsChange>0?"+":"")+m(t.actionsChange)+"% ",11,J2)):A("",!0)]),a("div",Z2,[a("div",Q2,m(t.lastActivityFormatted),1),e[16]||(e[16]=a("div",{class:"metric-label"},"–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1))]),s.compactView?A("",!0):(c(),u("div",eE,[a("div",tE,[a("div",{class:X(["score-fill",{"high-score":t.activityScore>=80,"medium-score":t.activityScore>=50&&t.activityScore<80,"low-score":t.activityScore<50}]),style:we({width:`${t.activityScore}%`})},null,6)]),a("div",{class:"score-label",title:`–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: ${t.activityScore}/100`},m(t.activityScore)+"/100 ",9,sE)])),s.compactView?(c(),u("div",aE,[a("span",oE,m(t.totalSessionsFormatted)+" —Å–µ—Å—Å–∏–π",1),a("span",nE,m(t.avgSessionDurationFormatted),1)])):A("",!0)]),a("div",rE,[a("button",{onClick:e[1]||(e[1]=Ce((...n)=>t.viewProfile&&t.viewProfile(...n),["stop"])),class:"action-btn primary","aria-label":`–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ${t.userName}`,title:`–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ${t.userName}`}," üëÅÔ∏è ",8,iE),s.canEditPermissions?(c(),u("button",{key:0,onClick:e[2]||(e[2]=Ce((...n)=>t.editPermissions&&t.editPermissions(...n),["stop"])),class:"action-btn secondary","aria-label":`–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ${t.userName}`,title:`–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ${t.userName}`}," ‚öôÔ∏è ",8,lE)):A("",!0),a("button",{onClick:e[3]||(e[3]=Ce((...n)=>t.toggleHidden&&t.toggleHidden(...n),["stop"])),class:X(["action-btn tertiary",{active:t.isHidden}]),"aria-label":`${t.isHidden?"–ü–æ–∫–∞–∑–∞—Ç—å":"–°–∫—Ä—ã—Ç—å"} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`,title:`${t.isHidden?"–ü–æ–∫–∞–∑–∞—Ç—å":"–°–∫—Ä—ã—Ç—å"} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`},m(t.isHidden?"üëÅÔ∏è‚Äçüó®Ô∏è":"üôà"),11,cE),a("button",{onClick:e[4]||(e[4]=Ce((...n)=>t.showContextMenu&&t.showContextMenu(...n),["stop"])),class:"action-btn menu","aria-label":`–ú–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è ${t.userName}`,title:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è"}," ‚ãÆ ",8,dE)]),t.showContextMenuFlag?(c(),u("div",{key:0,class:"context-menu",ref:"contextMenu",role:"menu","aria-label":`–ú–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è ${t.userName}`},[a("button",{onClick:e[5]||(e[5]=(...n)=>t.viewDetailedAnalytics&&t.viewDetailedAnalytics(...n)),class:"menu-item",role:"menuitem","aria-label":`–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è ${t.userName}`}," üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ ",8,gE),a("button",{onClick:e[6]||(e[6]=(...n)=>t.exportUserData&&t.exportUserData(...n)),class:"menu-item",role:"menuitem","aria-label":`–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö ${t.userName}`}," üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö ",8,mE),a("button",{onClick:e[7]||(e[7]=(...n)=>t.sendNotification&&t.sendNotification(...n)),class:"menu-item",role:"menuitem","aria-label":`–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ${t.userName}`}," üìß –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ",8,hE),a("button",{onClick:e[8]||(e[8]=(...n)=>t.viewAuditLog&&t.viewAuditLog(...n)),class:"menu-item",role:"menuitem","aria-label":`–ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ –¥–ª—è ${t.userName}`}," üìã –ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ ",8,fE),e[17]||(e[17]=a("hr",{class:"menu-divider",role:"separator"},null,-1)),s.canDelete?(c(),u("button",{key:0,onClick:e[9]||(e[9]=(...n)=>t.deleteUser&&t.deleteUser(...n)),class:"menu-item danger",role:"menuitem","aria-label":`–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`}," üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ",8,vE)):A("",!0)],8,uE)):A("",!0),a("div",{id:`user-card-${s.user.id}-description`,class:"sr-only"}," –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "+m(t.userName)+", email "+m(t.userEmail)+", —Å—Ç–∞—Ç—É—Å "+m(t.getStatusText(t.userStatus))+", "+m(t.totalActionsFormatted)+" –¥–µ–π—Å—Ç–≤–∏–π, –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å "+m(t.lastActivityFormatted)+", —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ "+m(t.activityScore)+" –∏–∑ 100. "+m(t.isAdmin?"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.":"")+" "+m(t.isHidden?"–°–∫—Ä—ã—Ç—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.":"")+" "+m(t.visibleDepartments.length>0?`–û—Ç–¥–µ–ª—ã: ${t.visibleDepartments.map(n=>n.name).join(", ")}.`:""),9,pE),s.isSelected?(c(),u("div",yE,[...e[18]||(e[18]=[a("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},[a("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})],-1)])])):A("",!0)],42,N2)}const bE=de(M2,[["render",kE],["__scopeId","data-v-5e790fbc"]]),_E={name:"BulkActionsBar",emits:["execute","clear-selection"],props:{selectedUsers:{type:Array,default:()=>[]},availableActions:{type:Array,default:()=>[]}}},wE={key:0,class:"bulk-actions-bar"},CE={class:"bar-content"},TE={class:"selection-info"},SE={class:"selection-count"},DE={class:"selection-text"},EE={class:"actions-list"},AE=["onClick","title"],$E={key:0,class:"action-icon"},IE={class:"action-text"};function ME(o,e,s,t,r,i){return s.selectedUsers.length>0?(c(),u("div",wE,[a("div",CE,[a("div",TE,[a("span",SE," –í—ã–±—Ä–∞–Ω–æ: "+m(s.selectedUsers.length),1),a("span",DE,m(s.selectedUsers.length===1?"–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å":"–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),1)]),a("div",EE,[(c(!0),u(ee,null,te(s.availableActions,n=>(c(),u("button",{key:n.id,onClick:l=>o.$emit("execute",n),class:X(["action-btn",n.class]),title:n.description},[n.icon?(c(),u("span",$E,m(n.icon),1)):A("",!0),a("span",IE,m(n.label),1)],10,AE))),128))]),a("button",{onClick:e[0]||(e[0]=n=>o.$emit("clear-selection")),class:"clear-btn",title:"–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä"}," ‚úï ")])])):A("",!0)}const NE=de(_E,[["render",ME],["__scopeId","data-v-56b78081"]]),xE={name:"VirtualList",emits:["item-click"],props:{items:{type:Array,default:()=>[]},itemHeight:{type:Number,default:50},containerHeight:{type:Number,default:400},bufferSize:{type:Number,default:5}},data(){return{scrollTop:0}},computed:{totalItems(){return this.items.length},totalHeight(){return this.totalItems*this.itemHeight},visibleCount(){return Math.ceil(this.containerHeight/this.itemHeight)+this.bufferSize*2},startIndex(){const o=Math.floor(this.scrollTop/this.itemHeight)-this.bufferSize;return Math.max(0,o)},endIndex(){const o=this.startIndex+this.visibleCount;return Math.min(this.totalItems,o)},visibleItems(){return this.items.slice(this.startIndex,this.endIndex)},offsetTop(){return this.startIndex*this.itemHeight},offsetBottom(){return Math.max(0,this.totalHeight-this.offsetTop-this.visibleItems.length*this.itemHeight)},listHeight(){return Math.min(this.totalHeight,this.containerHeight)}},methods:{handleScroll(o){this.scrollTop=o.target.scrollTop},getItemKey(o,e){return o.id||o.key||e},scrollToIndex(o){const e=Math.max(0,o*this.itemHeight-this.containerHeight/2);this.$refs.container?.scrollTo({top:e,behavior:"smooth"})},scrollToTop(){this.$refs.container?.scrollTo({top:0,behavior:"smooth"})},scrollToBottom(){const o=this.totalHeight-this.containerHeight;this.$refs.container?.scrollTo({top:o,behavior:"smooth"})}}},LE={class:"virtual-list-container",ref:"container"};function PE(o,e,s,t,r,i){return c(),u("div",LE,[a("div",{class:"virtual-list",style:we({height:`${i.listHeight}px`}),onScroll:e[0]||(e[0]=(...n)=>i.handleScroll&&i.handleScroll(...n))},[a("div",{class:"virtual-spacer top",style:we({height:`${i.offsetTop}px`})},null,4),(c(!0),u(ee,null,te(i.visibleItems,(n,l)=>(c(),u("div",{key:i.getItemKey(n,i.startIndex+l),class:"virtual-item"},[ha(o.$slots,"item",{item:n,index:i.startIndex+l},void 0)]))),128)),a("div",{class:"virtual-spacer bottom",style:we({height:`${i.offsetBottom}px`})},null,4)],36)],512)}const OE=de(xE,[["render",PE],["__scopeId","data-v-302c06ef"]]),RE={name:"PaginationControls",emits:["page-change","per-page-change"],props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},totalItems:{type:Number,required:!0},perPage:{type:Number,default:50},showPerPageSelector:{type:Boolean,default:!0},perPageOptions:{type:Array,default:()=>[10,25,50,100]},maxVisiblePages:{type:Number,default:7}},computed:{startItem(){return(this.currentPage-1)*this.perPage+1},endItem(){return Math.min(this.currentPage*this.perPage,this.totalItems)},visiblePages(){const o=[],e=this.totalPages,s=this.currentPage,t=this.maxVisiblePages;if(e<=t)for(let r=1;r<=e;r++)o.push(r);else{const r=Math.max(1,s-Math.floor(t/2)),i=Math.min(e,r+t-1),n=Math.max(1,i-t+1);n>1&&(o.push(1),n>2&&o.push("..."));for(let l=n;l<=i;l++)o.push(l);i<e&&(i<e-1&&o.push("..."),o.push(e))}return o}}},BE={key:0,class:"pagination-controls"},UE={class:"pagination-info"},WE={class:"pagination-text"},FE={class:"pagination-nav"},HE=["disabled"],jE=["disabled"],VE={key:0,class:"page-btn ellipsis",disabled:"","aria-hidden":"true"},zE=["onClick","aria-label","aria-current"],GE=["disabled"],KE=["disabled"],qE={key:0,class:"per-page-selector"},YE=["value"],XE=["value"];function JE(o,e,s,t,r,i){return s.totalPages>1?(c(),u("div",BE,[a("div",UE,[a("span",WE,m(i.startItem)+"-"+m(i.endItem)+" –∏–∑ "+m(s.totalItems.toLocaleString()),1)]),a("div",FE,[a("button",{onClick:e[0]||(e[0]=n=>o.$emit("page-change",1)),disabled:s.currentPage===1,class:"page-btn first","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ¬´¬´ ",8,HE),a("button",{onClick:e[1]||(e[1]=n=>o.$emit("page-change",s.currentPage-1)),disabled:s.currentPage===1,class:"page-btn prev","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ‚Äπ ",8,jE),(c(!0),u(ee,null,te(i.visiblePages,n=>(c(),u(ee,{key:n},[n==="..."?(c(),u("button",VE,m(n),1)):(c(),u("button",{key:1,onClick:l=>o.$emit("page-change",n),class:X({"page-btn":!0,current:n===s.currentPage}),"aria-label":`–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ${n}`,"aria-current":n===s.currentPage?"page":null},m(n),11,zE))],64))),128)),a("button",{onClick:e[2]||(e[2]=n=>o.$emit("page-change",s.currentPage+1)),disabled:s.currentPage===s.totalPages,class:"page-btn next","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ‚Ä∫ ",8,GE),a("button",{onClick:e[3]||(e[3]=n=>o.$emit("page-change",s.totalPages)),disabled:s.currentPage===s.totalPages,class:"page-btn last","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ¬ª¬ª ",8,KE)]),s.showPerPageSelector?(c(),u("div",qE,[e[5]||(e[5]=a("label",{for:"per-page-select",class:"per-page-label"},"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å:",-1)),a("select",{id:"per-page-select",value:s.perPage,onChange:e[4]||(e[4]=n=>o.$emit("per-page-change",parseInt(n.target.value))),class:"per-page-select","aria-label":"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ"},[(c(!0),u(ee,null,te(s.perPageOptions,n=>(c(),u("option",{key:n,value:n},m(n),9,XE))),128))],40,YE)])):A("",!0)])):A("",!0)}const ZE=de(RE,[["render",JE],["__scopeId","data-v-59d0e153"]]),QE={name:"UserListPanel",components:{UnifiedUserCard:bE,BulkActionsBar:NE,VirtualList:OE,PaginationControls:ZE},props:{users:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},pagination:{type:Object,default:()=>({current_page:1,per_page:50,total:0,total_pages:0})},filters:{type:Object,default:()=>({search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc",time_range:"week"})},viewOptions:{type:Object,default:()=>({compactView:!1,showExtendedMetrics:!1,itemsPerPage:50})},canEditPermissions:{type:Boolean,default:!1},canDeleteUsers:{type:Boolean,default:!1}},emits:["user-select","user-select-multiple","filters-change","pagination-change","view-options-change","user-action"],setup(o,{emit:e}){const s=I(!1),t=I([]),r=I({...o.filters}),i=I(null),n=I(null),l=M(()=>o.users),d=M(()=>{let P=0;return r.value.search&&P++,r.value.department_ids.length>0&&P++,r.value.activity_filter!=="all"&&P++,r.value.time_range!=="week"&&P++,P}),g=M(()=>{if(!n.value)return 400;const P=n.value.getBoundingClientRect();return Math.max(400,window.innerHeight-P.top-200)}),p=M(()=>[{id:369,name:"–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª",color:"#2196F3"},{id:366,name:"–°–µ–∫—Ç–æ—Ä 1–°",color:"#4CAF50"},{id:370,name:"–û—Ç–¥–µ–ª –∞–Ω–∞–ª–∏—Ç–∏–∫–∏",color:"#FF9800"},{id:371,name:"–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",color:"#F44336"}]),T=M(()=>[{id:"change_department",label:"–ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–¥–µ–ª",icon:"BuildingIcon",description:"–ù–∞–∑–Ω–∞—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –¥—Ä—É–≥–æ–π –æ—Ç–¥–µ–ª"},{id:"toggle_admin",label:"–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",icon:"ShieldIcon",description:"–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ –æ—Ç–æ–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"},{id:"export",label:"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",icon:"DownloadIcon",description:"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},{id:"hide_users",label:"–°–∫—Ä—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",icon:"EyeOffIcon",description:"–°–∫—Ä—ã—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Å–ø–∏—Å–∫–∞"}]),v=()=>{s.value=!s.value},y=()=>{e("filters-change",{...r.value})},k=()=>{r.value={search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc",time_range:"week"},y()},S=P=>{const h=r.value.department_ids.indexOf(P);h>-1?r.value.department_ids.splice(h,1):r.value.department_ids.push(P),y()},C=()=>{r.value.sort_order=r.value.sort_order==="asc"?"desc":"asc",y()},f=()=>{const P={...o.viewOptions,compactView:!o.viewOptions.compactView};e("view-options-change",P)},w=()=>{i.value&&clearTimeout(i.value),i.value=setTimeout($,300)},$=()=>{y()},W=()=>{r.value.search="",y()},L=P=>{D(P)},D=P=>{e("user-select",P)},E=P=>{t.value=P,e("user-select-multiple",P)},x=()=>{t.value=[]},R=P=>{e("user-action","view-profile",P)},U=P=>{e("user-action","edit-permissions",P)},G=P=>{e("user-action","toggle-visibility",P)},q=P=>{e("user-action","view-analytics",P)},oe=P=>{e("user-action","export-data",P)},Y=P=>{e("user-action","delete",P)},H=P=>{e("user-action","bulk-action",{action:P,users:t.value})},Z=P=>{e("pagination-change",P)},fe=P=>{e("pagination-change",1,P)};return Ne(()=>o.filters,P=>{r.value={...P}},{deep:!0}),$e(()=>{Wt(()=>{n.value&&(n.value.style.height=`${g.value}px`)})}),{showFilters:s,selectedUsers:t,localFilters:r,filteredUsers:l,activeFiltersCount:d,listHeight:g,departments:p,bulkActions:T,listContainer:n,toggleFilters:v,applyFilters:y,resetFilters:k,toggleDepartmentFilter:S,toggleSortOrder:C,toggleCompactView:f,debounceSearch:w,applySearch:$,clearSearch:W,handleUserClick:L,handleUserSelect:D,handleUserSelectMultiple:E,clearSelection:x,handleViewProfile:R,handleEditPermissions:U,handleToggleHidden:G,handleViewAnalytics:q,handleExportUserData:oe,handleDeleteUser:Y,handleBulkAction:H,handlePageChange:Z,handlePerPageChange:fe}}},eA={class:"panel-header"},tA={class:"header-content"},sA={class:"panel-title"},aA={key:0,class:"users-count"},oA={class:"header-actions"},nA={class:"search-container"},rA=["aria-expanded"],iA={key:0,class:"filters-count"},lA={class:"view-options"},cA={key:0,class:"filters-panel",role:"region","aria-label":"–ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤"},dA={class:"filters-grid"},uA={class:"filter-group"},gA={class:"departments-filter"},mA=["onClick","aria-label"],hA={class:"filter-group"},fA={class:"filter-group"},vA={class:"filter-group"},pA={class:"sort-controls"},yA=["aria-label"],kA={class:"filter-actions"},bA={class:"users-list-container",role:"list","aria-label":"–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},_A={key:0,class:"loading-state"},wA={key:1,class:"empty-state"},CA={class:"empty-title"},TA={class:"empty-description"};function SA(o,e,s,t,r,i){const n=be("BulkActionsBar"),l=be("UnifiedUserCard"),d=be("VirtualList"),g=be("PaginationControls");return c(),u("div",{class:X(["user-list-panel",{loading:s.loading,empty:!s.loading&&t.filteredUsers.length===0,"compact-view":s.viewOptions.compactView}]),role:"region","aria-label":"–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},[a("div",eA,[a("div",tA,[a("h2",sA,[e[16]||(e[16]=ce(" –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ",-1)),s.loading?A("",!0):(c(),u("span",aA," ("+m(s.pagination.total.toLocaleString())+") ",1))]),a("div",oA,[a("div",nA,[Re(a("input",{"onUpdate:modelValue":e[0]||(e[0]=p=>t.localFilters.search=p),type:"text",class:"search-input",placeholder:"–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ email...",onInput:e[1]||(e[1]=(...p)=>t.debounceSearch&&t.debounceSearch(...p)),onKeydown:e[2]||(e[2]=Be((...p)=>t.applySearch&&t.applySearch(...p),["enter"])),"aria-label":"–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},null,544),[[At,t.localFilters.search]]),t.localFilters.search?(c(),u("button",{key:0,onClick:e[3]||(e[3]=(...p)=>t.clearSearch&&t.clearSearch(...p)),class:"search-clear","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):A("",!0),e[17]||(e[17]=a("div",{class:"search-icon","aria-hidden":"true"},"üîç",-1))]),a("button",{onClick:e[4]||(e[4]=(...p)=>t.toggleFilters&&t.toggleFilters(...p)),class:X(["filters-toggle",{active:t.showFilters}]),"aria-label":"–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã","aria-expanded":t.showFilters},[e[18]||(e[18]=a("svg",{class:"filter-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[a("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})],-1)),e[19]||(e[19]=ce(" –§–∏–ª—å—Ç—Ä—ã ",-1)),t.activeFiltersCount>0?(c(),u("span",iA,m(t.activeFiltersCount),1)):A("",!0)],10,rA),a("div",lA,[a("button",{onClick:e[5]||(e[5]=(...p)=>t.toggleCompactView&&t.toggleCompactView(...p)),class:X(["view-toggle",{active:s.viewOptions.compactView}]),"aria-label":"–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥",title:"–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥"},[...e[20]||(e[20]=[a("svg",{viewBox:"0 0 24 24","aria-hidden":"true"},[a("path",{d:"M3 3h18v2H3V3zm0 16h18v2H3v16zm0-8h18v2H3v-2z"})],-1)])],2)])])])]),t.showFilters?(c(),u("div",cA,[a("div",dA,[a("div",uA,[e[21]||(e[21]=a("label",{class:"filter-label"},"–û—Ç–¥–µ–ª—ã:",-1)),a("div",gA,[(c(!0),u(ee,null,te(t.departments,p=>(c(),u("button",{key:p.id,onClick:T=>t.toggleDepartmentFilter(p.id),class:X(["department-chip",{active:t.localFilters.department_ids.includes(p.id)}]),style:we({borderColor:p.color}),"aria-label":`–§–∏–ª—å—Ç—Ä –ø–æ –æ—Ç–¥–µ–ª—É ${p.name}`},[a("span",{class:"dept-dot",style:we({backgroundColor:p.color}),"aria-hidden":"true"},null,4),ce(" "+m(p.name),1)],14,mA))),128))])]),a("div",hA,[e[23]||(e[23]=a("label",{class:"filter-label"},"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),Re(a("select",{"onUpdate:modelValue":e[6]||(e[6]=p=>t.localFilters.activity_filter=p),class:"filter-select",onChange:e[7]||(e[7]=(...p)=>t.applyFilters&&t.applyFilters(...p)),"aria-label":"–§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"},[...e[22]||(e[22]=[_t('<option value="all" data-v-8c6ab554>–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option><option value="active" data-v-8c6ab554>–ê–∫—Ç–∏–≤–Ω—ã–µ (80%+)</option><option value="moderate" data-v-8c6ab554>–°—Ä–µ–¥–Ω–µ –∞–∫—Ç–∏–≤–Ω—ã–µ (50-80%)</option><option value="inactive" data-v-8c6ab554>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ (&lt;50%)</option><option value="new" data-v-8c6ab554>–ù–æ–≤—ã–µ (–∑–∞ –Ω–µ–¥–µ–ª—é)</option>',5)])],544),[[dt,t.localFilters.activity_filter]])]),a("div",fA,[e[25]||(e[25]=a("label",{class:"filter-label"},"–ü–µ—Ä–∏–æ–¥:",-1)),Re(a("select",{"onUpdate:modelValue":e[8]||(e[8]=p=>t.localFilters.time_range=p),class:"filter-select",onChange:e[9]||(e[9]=(...p)=>t.applyFilters&&t.applyFilters(...p)),"aria-label":"–í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏"},[...e[24]||(e[24]=[_t('<option value="today" data-v-8c6ab554>–°–µ–≥–æ–¥–Ω—è</option><option value="week" data-v-8c6ab554>–≠—Ç–∞ –Ω–µ–¥–µ–ª—è</option><option value="month" data-v-8c6ab554>–≠—Ç–æ—Ç –º–µ—Å—è—Ü</option><option value="quarter" data-v-8c6ab554>–≠—Ç–æ—Ç –∫–≤–∞—Ä—Ç–∞–ª</option><option value="year" data-v-8c6ab554>–≠—Ç–æ—Ç –≥–æ–¥</option>',5)])],544),[[dt,t.localFilters.time_range]])]),a("div",vA,[e[28]||(e[28]=a("label",{class:"filter-label"},"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:",-1)),a("div",pA,[Re(a("select",{"onUpdate:modelValue":e[10]||(e[10]=p=>t.localFilters.sort_by=p),class:"filter-select sort-select",onChange:e[11]||(e[11]=(...p)=>t.applyFilters&&t.applyFilters(...p)),"aria-label":"–ü–æ–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏"},[...e[26]||(e[26]=[a("option",{value:"last_activity"},"–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1),a("option",{value:"name"},"–ò–º—è",-1),a("option",{value:"email"},"Email",-1),a("option",{value:"total_actions"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π",-1)])],544),[[dt,t.localFilters.sort_by]]),a("button",{onClick:e[12]||(e[12]=(...p)=>t.toggleSortOrder&&t.toggleSortOrder(...p)),class:"sort-order-toggle","aria-label":`–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞ ${t.localFilters.sort_order==="asc"?"—É–±—ã–≤–∞—é—â–∏–π":"–≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–∏–π"}`},[(c(),u("svg",{class:X({rotated:t.localFilters.sort_order==="desc"}),viewBox:"0 0 24 24","aria-hidden":"true"},[...e[27]||(e[27]=[a("path",{d:"M7 14l5-5 5 5z"},null,-1)])],2))],8,yA)])])]),a("div",kA,[a("button",{onClick:e[13]||(e[13]=(...p)=>t.resetFilters&&t.resetFilters(...p)),class:"filter-reset-btn"}," –°–±—Ä–æ—Å–∏—Ç—å "),a("button",{onClick:e[14]||(e[14]=(...p)=>t.applyFilters&&t.applyFilters(...p)),class:"filter-apply-btn"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å ")])])):A("",!0),t.selectedUsers.length>0?(c(),he(n,{key:1,"selected-users":t.selectedUsers,"available-actions":t.bulkActions,onExecute:t.handleBulkAction,onClearSelection:t.clearSelection},null,8,["selected-users","available-actions","onExecute","onClearSelection"])):A("",!0),a("div",bA,[s.loading?(c(),u("div",_A,[(c(!0),u(ee,null,te(s.viewOptions.itemsPerPage,p=>(c(),u("div",{key:p,class:"user-skeleton","aria-hidden":"true"},[...e[29]||(e[29]=[_t('<div class="skeleton-avatar" data-v-8c6ab554></div><div class="skeleton-content" data-v-8c6ab554><div class="skeleton-line" data-v-8c6ab554></div><div class="skeleton-line short" data-v-8c6ab554></div></div><div class="skeleton-actions" data-v-8c6ab554><div class="skeleton-button" data-v-8c6ab554></div><div class="skeleton-button" data-v-8c6ab554></div></div>',3)])]))),128))])):t.filteredUsers.length===0?(c(),u("div",wA,[e[30]||(e[30]=a("div",{class:"empty-icon","aria-hidden":"true"},"üë•",-1)),a("h3",CA,m(t.localFilters.search?"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã":"–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),1),a("p",TA,m(t.localFilters.search?`–ü–æ –∑–∞–ø—Ä–æ—Å—É "${t.localFilters.search}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫ –∏–ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.`:"–í —Å–∏—Å—Ç–µ–º–µ –µ—â—ë –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π."),1),t.activeFiltersCount>0?(c(),u("button",{key:0,onClick:e[15]||(e[15]=(...p)=>t.resetFilters&&t.resetFilters(...p)),class:"empty-action-btn"}," –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã ")):A("",!0)])):(c(),he(d,{key:2,items:t.filteredUsers,"item-height":s.viewOptions.compactView?80:120,"container-height":t.listHeight,class:"virtual-users-list",onItemClick:t.handleUserClick},{item:pe(({item:p,index:T})=>[(c(),he(l,{key:p.id,user:p,"is-selected":t.selectedUsers.some(v=>v.id===p.id),"compact-view":s.viewOptions.compactView,"can-edit-permissions":s.canEditPermissions,"can-delete":s.canDeleteUsers,"show-extended-metrics":!s.viewOptions.compactView,onSelect:t.handleUserSelect,onViewProfile:t.handleViewProfile,onEditPermissions:t.handleEditPermissions,onToggleHidden:t.handleToggleHidden,onViewAnalytics:t.handleViewAnalytics,onExportData:t.handleExportUserData,onDeleteUser:t.handleDeleteUser},null,8,["user","is-selected","compact-view","can-edit-permissions","can-delete","show-extended-metrics","onSelect","onViewProfile","onEditPermissions","onToggleHidden","onViewAnalytics","onExportData","onDeleteUser"]))]),_:1},8,["items","item-height","container-height","onItemClick"]))]),!s.loading&&s.pagination.total_pages>1?(c(),he(g,{key:2,"current-page":s.pagination.current_page,"total-pages":s.pagination.total_pages,"total-items":s.pagination.total,"per-page":s.pagination.per_page,onPageChange:t.handlePageChange,onPerPageChange:t.handlePerPageChange},null,8,["current-page","total-pages","total-items","per-page","onPageChange","onPerPageChange"])):A("",!0)],2)}const DA=de(QE,[["render",SA],["__scopeId","data-v-8c6ab554"]]),EA={name:"AnalysisPanel",emits:["back","filter-change","export"],props:{user:{type:Object,default:null},activityData:{type:Object,default:()=>({})},filters:{type:Object,default:()=>({})},timeRange:{type:String,default:"week"},isLoading:{type:Boolean,default:!1}},methods:{getStatusText(o){switch(o){case"online":return"–æ–Ω–ª–∞–π–Ω";case"away":return"–æ—Ç–æ—à—ë–ª";case"offline":return"–æ—Ñ—Ñ–ª–∞–π–Ω";default:return"–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}},formatDuration(o){const e=Math.floor(o/60),s=Math.floor(o%60);return`${e}:${s.toString().padStart(2,"0")}`},formatLastActivity(o){if(!o)return"–ù–∏–∫–æ–≥–¥–∞";const e=new Date(o),t=new Date-e,r=Math.floor(t/(1e3*60)),i=Math.floor(t/(1e3*60*60)),n=Math.floor(t/(1e3*60*60*24));return r<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":r<60?`${r} –º–∏–Ω –Ω–∞–∑–∞–¥`:i<24?`${i} —á –Ω–∞–∑–∞–¥`:n<7?`${n} –¥ –Ω–∞–∑–∞–¥`:e.toLocaleDateString("ru-RU")}}},AA={class:"analysis-panel"},$A={class:"analysis-header"},IA={class:"user-summary"},MA={class:"user-avatar"},NA=["src","alt"],xA={key:1,class:"avatar-placeholder"},LA={class:"user-info"},PA={class:"user-email"},OA={class:"user-status"},RA={key:0,class:"admin-badge"},BA={class:"header-actions"},UA={class:"analysis-content"},WA={class:"stats-section"},FA={class:"stats-grid"},HA={class:"stat-card"},jA={class:"stat-value"},VA={class:"stat-card"},zA={class:"stat-value"},GA={class:"stat-card"},KA={class:"stat-value"},qA={class:"stat-card"},YA={class:"stat-value"},XA={class:"activity-section"},JA={class:"last-activity"},ZA={key:0,class:"departments-section"},QA={class:"departments-list"};function e$(o,e,s,t,r,i){return c(),u("div",AA,[a("div",$A,[a("div",IA,[a("div",MA,[s.user.avatar?(c(),u("img",{key:0,src:s.user.avatar,alt:`–ê–≤–∞—Ç–∞—Ä ${s.user.name}`},null,8,NA)):(c(),u("div",xA,m(s.user.name.charAt(0)),1))]),a("div",LA,[a("h2",null,m(s.user.name),1),a("p",PA,m(s.user.email),1),a("div",OA,[a("span",{class:X(`status-${s.user.status}`)},m(i.getStatusText(s.user.status)),3),s.user.is_admin?(c(),u("span",RA,"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä")):A("",!0)])])]),a("div",BA,[a("button",{onClick:e[0]||(e[0]=n=>o.$emit("back")),class:"back-btn"},"‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É")])]),a("div",UA,[a("div",WA,[e[5]||(e[5]=a("h3",null,"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),a("div",FA,[a("div",HA,[a("div",jA,m(s.user.activity_stats?.total_actions||0),1),e[1]||(e[1]=a("div",{class:"stat-label"},"–í—Å–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–π",-1))]),a("div",VA,[a("div",zA,m(s.user.activity_stats?.total_sessions||0),1),e[2]||(e[2]=a("div",{class:"stat-label"},"–°–µ—Å—Å–∏–π",-1))]),a("div",GA,[a("div",KA,m(i.formatDuration(s.user.activity_stats?.avg_session_duration||0)),1),e[3]||(e[3]=a("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω—è—è —Å–µ—Å—Å–∏—è",-1))]),a("div",qA,[a("div",YA,m(s.user.activity_stats?.activity_score||0)+"/100",1),e[4]||(e[4]=a("div",{class:"stat-label"},"–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1))])])]),a("div",XA,[e[6]||(e[6]=a("h3",null,"üïí –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1)),a("div",JA,[a("p",null,m(i.formatLastActivity(s.user.activity_stats?.last_activity)),1)])]),s.user.departments&&s.user.departments.length>0?(c(),u("div",ZA,[e[7]||(e[7]=a("h3",null,"üè¢ –û—Ç–¥–µ–ª—ã",-1)),a("div",QA,[(c(!0),u(ee,null,te(s.user.departments,n=>(c(),u("span",{key:n.id,class:"department-tag",style:we({backgroundColor:n.color})},m(n.name),5))),128))])])):A("",!0),e[8]||(e[8]=a("div",{class:"placeholder-note"},[a("strong",null,"üöß –°–ª–µ–¥—É—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:"),a("ul",null,[a("li",null,"–ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏"),a("li",null,"–ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"),a("li",null,"–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"),a("li",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏")])],-1))])])}const t$=de(EA,[["render",e$],["__scopeId","data-v-15fd9d64"]]),s$={name:"ManagementPanel",emits:["back","permissions-change","bulk-update"],props:{selectedUsers:{type:Array,default:()=>[]},allUsers:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]},auditLog:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},canEditPermissions:{type:Boolean,default:!1}},methods:{handleBulkPermissions(){this.$emit("bulk-update","change_permissions",{is_admin:!1,department_id:369})}}},a$={class:"management-panel"},o$={class:"panel-placeholder"},n$={key:0,class:"selected-info"},r$={class:"selected-list"},i$={class:"user-name"},l$={class:"user-email"},c$={class:"placeholder-actions"};function d$(o,e,s,t,r,i){return c(),u("div",a$,[a("div",o$,[e[2]||(e[2]=a("div",{class:"placeholder-icon"},"‚öôÔ∏è",-1)),e[3]||(e[3]=a("h3",null,"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏",-1)),e[4]||(e[4]=a("p",null,"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä–æ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),e[5]||(e[5]=a("div",{class:"placeholder-note"},[a("strong",null,"–°—Ç–∞—Ç—É—Å:"),ce(" –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (TASK-089 - –≠—Ç–∞–ø 5) ")],-1)),s.selectedUsers.length>0?(c(),u("div",n$,[a("h4",null,"–í—ã–±—Ä–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: "+m(s.selectedUsers.length),1),a("div",r$,[(c(!0),u(ee,null,te(s.selectedUsers.slice(0,3),n=>(c(),u("div",{key:n.id,class:"selected-user"},[a("span",i$,m(n.name),1),a("span",l$,m(n.email),1)]))),128))])])):A("",!0),a("div",c$,[a("button",{onClick:e[0]||(e[0]=n=>o.$emit("back")),class:"back-btn"},"‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É"),s.selectedUsers.length>0?(c(),u("button",{key:0,onClick:e[1]||(e[1]=(...n)=>i.handleBulkPermissions&&i.handleBulkPermissions(...n)),class:"permissions-btn"}," –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ("+m(s.selectedUsers.length)+") ",1)):A("",!0)])])])}const u$=de(s$,[["render",d$],["__scopeId","data-v-7dfddba5"]]),g$={name:"UnifiedUserManagement",components:{DrillDownNavigation:qS,ContextSidebar:$2,UserListPanel:DA,AnalysisPanel:t$,ManagementPanel:u$},props:{config:{type:Object,default:()=>({enablePersistence:!0,enableKeyboardShortcuts:!0,defaultView:"global"})}},setup(o){console.log("[UnifiedUserManagement] Component loaded successfully",o.config);const e=I("global"),s=I(null),t=I(!1),r=I([{id:1,name:"–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",email:"ivan@example.com",departments:[{id:369,name:"–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª",color:"#2196F3"}],is_admin:!0,activity_stats:{total_actions:156,last_activity:new Date().toISOString(),activity_score:85},status:"online"},{id:2,name:"–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤",email:"petr@example.com",departments:[{id:366,name:"–°–µ–∫—Ç–æ—Ä 1–°",color:"#4CAF50"}],is_admin:!1,activity_stats:{total_actions:89,last_activity:new Date(Date.now()-864e5).toISOString(),activity_score:67},status:"away"},{id:3,name:"–ê–Ω–Ω–∞ –°–∏–¥–æ—Ä–æ–≤–∞",email:"anna@example.com",departments:[],is_admin:!1,activity_stats:{total_actions:23,last_activity:new Date(Date.now()-6048e5).toISOString(),activity_score:35},status:"offline"}]),i=I({search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc"}),n=I([{id:"total_users",label:"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",value:r.value.length,change:5.2},{id:"active_users",label:"–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è",value:r.value.filter(k=>k.status==="online").length,change:12.1},{id:"new_users",label:"–ù–æ–≤—ã—Ö —Å–µ–≥–æ–¥–Ω—è",value:1,change:-2.3}]),l=M(()=>{const k=[{id:"global",label:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"UsersIcon",action:()=>d("global")}];return e.value==="user"&&s.value&&k.push({id:`user-${s.value.id}`,label:s.value.name,icon:"UserIcon",action:()=>g(s.value)}),e.value==="management"&&k.push({id:"management",label:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏",icon:"SettingsIcon",action:()=>d("management")}),k}),d=(k,S={})=>{e.value=k,S.user&&(s.value=S.user),console.log(`[UnifiedUserManagement] Switched to context: ${k}`,S)},g=k=>{s.value=k,d("user",{user:k})};return{currentContext:e,selectedUser:s,loading:t,users:r,filters:i,globalMetrics:n,breadcrumbs:l,handleUserSelect:k=>{g(k)},handleBreadcrumbNavigate:k=>{k.action&&k.action()},handleGoBack:()=>{(e.value==="user"||e.value==="management")&&(d("global"),s.value=null),console.log("[UnifiedUserManagement] Returned to global context")},handleMetricClick:k=>{console.log("Metric clicked:",k)}}}},m$={class:"unified-user-management"},h$={class:"management-grid"},f$={class:"main-content-area"};function v$(o,e,s,t,r,i){const n=be("DrillDownNavigation"),l=be("ContextSidebar"),d=be("UserListPanel"),g=be("AnalysisPanel"),p=be("ManagementPanel");return c(),u("div",m$,[ne(n,{breadcrumbs:t.breadcrumbs,"is-loading":t.loading,onNavigate:t.handleBreadcrumbNavigate,onBack:t.handleGoBack},null,8,["breadcrumbs","is-loading","onNavigate","onBack"]),a("div",h$,[ne(l,{context:t.currentContext,"global-metrics":t.globalMetrics,"selected-user":t.selectedUser,onMetricClick:t.handleMetricClick},null,8,["context","global-metrics","selected-user","onMetricClick"]),a("div",f$,[t.currentContext==="global"?(c(),he(d,{key:0,users:t.users,loading:t.loading,pagination:{current_page:1,total:t.users.length,total_pages:1},filters:t.filters,"can-edit-permissions":!0,"can-delete":!1,onUserSelect:t.handleUserSelect},null,8,["users","loading","pagination","filters","onUserSelect"])):t.currentContext==="user"?(c(),he(g,{key:1,user:t.selectedUser,onBack:t.handleGoBack},null,8,["user","onBack"])):t.currentContext==="management"?(c(),he(p,{key:2,onBack:t.handleGoBack},null,8,["onBack"])):A("",!0)])])])}const p$=de(g$,[["render",v$],["__scopeId","data-v-953cd27b"]]),y$={name:"UsersManagementPage",components:{UnifiedUserManagement:p$},setup(){const o=Xe();return $e(async()=>{try{if(!(await rt.checkAccess()).allowed){o.push("/");return}if(!await rt.getCurrentUser()){o.push("/");return}console.log("[UsersManagementPage] Access granted - loading unified interface")}catch(e){console.error("[UsersManagementPage] Access check failed:",e),o.push("/")}}),{}}},k$={class:"users-management-page"};function b$(o,e,s,t,r,i){const n=be("UnifiedUserManagement");return c(),u("div",k$,[ne(n,{config:{enablePersistence:!0,enableKeyboardShortcuts:!0,defaultView:"global"}})])}const _$=de(y$,[["render",b$],["__scopeId","data-v-3ef05244"]]);class Pe{static async getCacheStatus(){try{const e=et("/api/admin/cache-status.php");console.log("[CacheManagementService] Fetching cache status from:",e);const s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("[CacheManagementService] Response status:",s.status),!s.ok){const r=await s.text();throw console.error("[CacheManagementService] HTTP error:",r),new Error(`HTTP error! status: ${s.status}, message: ${r}`)}const t=await s.json();if(console.log("[CacheManagementService] API result:",t),t.success){let r=t.modules||[];console.log("[CacheManagementService] Modules from API:",r.length,r),r.length===0&&(console.log("[CacheManagementService] Using mock data for UI demonstration"),r=this.getMockModules(),console.log("[CacheManagementService] Mock modules:",r.length));const i=this.categorizeAndSortModules(r);return console.log("[CacheManagementService] Categorized result:",i),i}else throw new Error(t.error||"Failed to get cache status")}catch(e){console.error("[CacheManagementService] Error getting cache status:",e),console.log("[CacheManagementService] Using mock data due to API error");const s=this.getMockModules(),t=this.categorizeAndSortModules(s);return console.log("[CacheManagementService] Mock categorized result:",t),t}}static async clearCache(e){try{const s=et("/api/admin/cache-clear.php"),t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,confirm:!0})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return!0;throw new Error(r.error||"Failed to clear cache")}catch(s){throw console.error("[CacheManagementService] Error clearing cache:",s),s}}static async getCacheStats(){try{const e=et("/api/admin/cache-stats.php"),s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();if(t.success)return t.stats||{};throw new Error(t.error||"Failed to get cache stats")}catch(e){throw console.error("[CacheManagementService] Error getting cache stats:",e),e}}static formatCacheSize(e){if(e===0)return"0 B";const s=1024,t=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(s));return Math.round(e/Math.pow(s,r)*100)/100+" "+t[r]}static categorizeAndSortModules(e,s={}){const t=this.generateCacheKey(e),r=this.getCachedResult(t);if(r&&!s.forceRefresh)return r;const i=performance.now(),n=this.performCategorization(e),l=performance.now();return n.metadata={processingTime:l-i,totalModules:e.length,primaryCount:n.primaryModules.length,secondaryCount:n.secondaryModules.length,cached:!1},this.setCachedResult(t,n),n}static performCategorization(e){const s=[],t=[];return e.forEach(r=>{this.validateModule(r),this.PRIMARY_MODULE_IDS.includes(r.id)?s.push({...r,category:"primary",priority:this.PRIMARY_MODULE_PRIORITIES[r.id]||999}):t.push({...r,category:"secondary",groupType:this.getModuleType(r.id)})}),{primaryModules:this.sortPrimaryModules(s),secondaryModules:this.sortSecondaryModules(t)}}static sortPrimaryModules(e){return e.sort((s,t)=>{const r=this.PRIMARY_MODULE_PRIORITIES[s.id]||999,i=this.PRIMARY_MODULE_PRIORITIES[t.id]||999;return r-i})}static sortSecondaryModules(e){return e.sort((s,t)=>{const r=this.getModuleType(s.id),i=this.getModuleType(t.id);return r!==i?this.compareModuleTypes(r,i):s.name.localeCompare(t.name)})}static compareModuleTypes(e,s){const t=["users","activity","webhooks","other"],r=t.indexOf(e),i=t.indexOf(s);return(r===-1?999:r)-(i===-1?999:i)}static getModuleType(e){for(const[s,t]of Object.entries(this.SECONDARY_MODULE_TYPES))if(e.startsWith(t.prefix))return s;return e.includes("time-tracking")?"time-tracking":e.includes("graph")?"graphs":e.includes("dashboard")?"dashboards":"other"}static getModuleTypeConfig(e){return this.SECONDARY_MODULE_TYPES[e]||{title:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏",description:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã"}}static validateModule(e){if(!e||typeof e!="object")throw new Error("Module must be an object");if(!e.id||typeof e.id!="string")throw new Error("Module must have a valid id");if(!e.name||typeof e.name!="string")throw new Error("Module must have a valid name");return!0}static generateCacheKey(e){const s=e.map(t=>t.id).sort().join(",");return btoa(s).substring(0,16)}static getCachedResult(e){const s=this.categorizationCache.get(e);return s?Date.now()-s.timestamp>this.CACHE_TTL?(this.categorizationCache.delete(e),null):{...s.data,metadata:{...s.data.metadata,cached:!0}}:null}static setCachedResult(e,s){if(this.categorizationCache.set(e,{data:{...s,metadata:{...s.metadata,cached:!1}},timestamp:Date.now()}),this.categorizationCache.size>10){const t=this.categorizationCache.keys().next().value;this.categorizationCache.delete(t)}}static clearCategorizationCache(){this.categorizationCache.clear()}static invalidateCacheAfterModuleOperation(){this.clearCategorizationCache()}static getCategorizationStats(){return{cacheSize:this.categorizationCache.size,cacheEntries:Array.from(this.categorizationCache.entries()).map(([e,s])=>({key:e,age:Date.now()-s.timestamp,modulesCount:s.data.primaryModules.length+s.data.secondaryModules.length}))}}static formatTTL(e){return e<60?`${e} —Å–µ–∫`:e<3600?`${Math.floor(e/60)} –º–∏–Ω`:`${Math.floor(e/3600)} —á`}static formatCreationTime(e){return e<1e3?`${Math.round(e)}–º—Å`:e<6e4?`${Math.round(e/1e3*10)/10}—Å–µ–∫`:`${Math.round(e/6e4*10)/10}–º–∏–Ω`}static formatCacheHitRatio(e){return`${Math.round(e*100)}%`}static formatDataFreshness(e){return`${Math.round(e*100)}%`}static getExpiryColor(e){if(!e)return"gray";const s=Date.now()/1e3,t=(e-s)/3600;return t>2?"green":t>.5?"yellow":"red"}static getEfficiencyColor(e){return e>=.85?"green":e>=.7?"yellow":"red"}static getCreationTimeColor(e){return e<=2e3?"green":e<=1e4?"yellow":"red"}static getFreshnessColor(e){return e>=.9?"green":e>=.7?"yellow":"red"}static generateModuleMetadata(e){const s=Math.floor(Date.now()/1e3),t=e.metadata||{},r=this.PRIMARY_MODULE_IDS.includes(e.id);return{version:t.version||"1.0",module_id:e.id,module_name:e.name,created_at:t.created_at||s-Math.random()*86400*7,created_by:t.created_by||(Math.random()>.5?"system":"cron"),creation_time_ms:t.creation_time_ms||500+Math.random()*9500,last_accessed_at:t.last_accessed_at||s-Math.random()*3600,access_count:t.access_count||Math.floor(Math.random()*100)+1,expires_at:t.expires_at||s+(e.ttl||3600),ttl_seconds:e.ttl||3600,file_size_bytes:e.total_size||Math.floor(Math.random()*1e7)+1e6,compression_ratio:t.compression_ratio||.7+Math.random()*.3,data_version:t.data_version||`2026.01.12.v${Math.floor(Math.random()*10)+1}`,source_params:t.source_params||{period:r?Math.random()>.5?"weeks":"months":"default",sector_id:e.id.includes("sector-1c")?"1c":"all",filters:Math.random()>.5?["active_only"]:[],limit:Math.floor(Math.random()*1e3)+500},performance_metrics:t.performance_metrics||{avg_response_time_ms:20+Math.random()*80,cache_hit_ratio:.7+Math.random()*.3,data_freshness_score:.8+Math.random()*.2}}}static getMockModules(){const e=Math.floor(Date.now()/1e3);return[{id:"dashboard-sector-1c",name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",status:"active",file_count:5,total_size:1024e3,ttl:600,created_at:e-7200,expires_at:e+1800,cache_dir:"api/cache/dashboard-sector-1c"},{id:"graph-state",name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",status:"active",file_count:3,total_size:512e3,ttl:3600,created_at:e-3600,expires_at:e+7200,cache_dir:"api/cache/graph-state"},{id:"graph-admission-closure-weeks",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–µ–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",status:"active",file_count:8,total_size:2048e3,ttl:300,created_at:e-1800,expires_at:e+120,cache_dir:"api/cache/graph-admission-closure/weeks"},{id:"graph-admission-closure-months",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–µ–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",status:"active",file_count:12,total_size:3072e3,ttl:300,created_at:e-3600,expires_at:e+240,cache_dir:"api/cache/graph-admission-closure/months"},{id:"time-tracking-default",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",status:"active",file_count:4,total_size:768e3,ttl:300,created_at:e-900,expires_at:e+2100,cache_dir:"api/cache/time-tracking-sector-1c/default"},{id:"time-tracking-detailed",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:6,total_size:1536e3,ttl:120,created_at:e-600,expires_at:e+3540,cache_dir:"api/cache/time-tracking-sector-1c/detailed"},{id:"time-tracking-summary",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:2,total_size:384e3,ttl:600,created_at:e-1800,expires_at:e+4200,cache_dir:"api/cache/time-tracking-sector-1c/summary"},{id:"users-management-departments",name:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–æ—Ç–¥–µ–ª—ã)",status:"active",file_count:2,total_size:256e3,ttl:3600,created_at:e-7200,expires_at:e+28800,cache_dir:"api/cache/users-management/departments"},{id:"webhook-logs-api",name:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ (API –∑–∞–ø—Ä–æ—Å—ã)",status:"active",file_count:15,total_size:512e4,ttl:300,created_at:e-3600,expires_at:e+2400,cache_dir:"api/cache/webhook-logs/api"}]}static enrichModulesWithMetadata(e){return e.map(s=>({...s,metadata:this.generateModuleMetadata(s)}))}}je(Pe,"PRIMARY_MODULE_IDS",["dashboard-sector-1c","graph-state","graph-admission-closure-weeks","graph-admission-closure-months","time-tracking-default","time-tracking-detailed","time-tracking-summary"]),je(Pe,"PRIMARY_MODULE_PRIORITIES",{"dashboard-sector-1c":1,"graph-state":2,"graph-admission-closure-weeks":3,"graph-admission-closure-months":4,"time-tracking-default":5,"time-tracking-detailed":6,"time-tracking-summary":7}),je(Pe,"SECONDARY_MODULE_TYPES",{users:{prefix:"users-management",title:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –æ—Ç–¥–µ–ª–∞–º–∏"},activity:{prefix:"user-activity",title:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",description:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},webhooks:{prefix:"webhook-logs",title:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",description:"–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±—Ö—É–∫–æ–≤"}}),je(Pe,"categorizationCache",new Map),je(Pe,"CACHE_TTL",3e4);function w$(o){const e=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())),s=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-s);const t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}class Ls{static async createCache(e,s=null,t={}){try{const r=et("/api/admin/cache-create.php"),i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,mode:s,params:t})});if(!i.ok){const l=await i.json().catch(()=>({}));throw new Error(l.error||`HTTP error! status: ${i.status}`)}const n=await i.json();if(n.success)return n;throw new Error(n.error||"Failed to create cache")}catch(r){throw console.error("[CacheCreationService] Error creating cache:",r),r}}static async getCreationStatus(e){try{const s=et(`/api/admin/cache-create-status.php?task_id=${e}`),t=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return r;throw new Error(r.error||"Failed to get creation status")}catch(s){throw console.error("[CacheCreationService] Error getting creation status:",s),s}}static getDefaultParams(e){if(e.includes("graph-admission-closure"))if((e.includes("weeks")?"weeks":"months")==="weeks"){const t=new Date,r=t.getUTCFullYear(),i=w$(t),n=new Date(r,0,1+(i-1)*7),l=n.getUTCDay(),d=n.getUTCDate()-l+(l===0?-6:1);n.setUTCDate(d),n.setUTCHours(0,0,0,0);const g=new Date(n);return g.setUTCDate(n.getUTCDate()+6),g.setUTCHours(23,59,59,999),{product:"1C",periodMode:"weeks",weekStartUtc:n.toISOString(),weekEndUtc:g.toISOString(),includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,useCache:!0,forceRefresh:!0}}else return{product:"1C",periodMode:"months",includeTickets:!0,includeNewTicketsByStages:!1,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!1};if(e.includes("dashboard-sector-1c"))return{forceRefresh:!0,ttl:600};if(e.includes("graph-state"))return{type:"current",forceRefresh:!0,ttl:3600};if(e.includes("time-tracking")){const s=e.includes("detailed")?"detailed":e.includes("summary")?"summary":"default";return{product:"1C",includeTaskDetails:s==="detailed",summary:s==="summary"}}return{}}}let ds=class{static notifyCacheCreationStarted(e){this.showNotification({content:`–ù–∞—á–∞—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}"...`,type:"info",autoHideDelay:3e3})}static notifyCacheCreationSuccess(e){this.showNotification({content:`‚úÖ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,type:"success",autoHideDelay:5e3})}static notifyCacheCreationError(e,s){this.showNotification({content:`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}": ${s}`,type:"error",autoHideDelay:7e3})}static notifyCacheUpdated(e,s="auto"){const t=s==="manual"?"–≤—Ä—É—á–Ω—É—é":"–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏";this.showNotification({content:`üîÑ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" –æ–±–Ω–æ–≤–ª—ë–Ω ${t}`,type:"info",autoHideDelay:4e3})}static notifyCacheUsed(e){this.showNotification({content:`‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}"`,type:"success",autoHideDelay:3e3})}static showNotification(e){typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:e.content,autoHideDelay:e.autoHideDelay||3e3}):console.log("[CacheNotification]",e.content)}};const C$=Object.freeze(Object.defineProperty({__proto__:null,CacheNotificationService:ds},Symbol.toStringTag,{value:"Module"})),T$={name:"CacheCreateProgress",props:{progress:{type:Number,required:!0,validator:o=>o>=0&&o<=100},message:{type:String,default:"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞..."}}},S$={class:"cache-create-progress"},D$={class:"progress-bar"},E$={class:"progress-text"};function A$(o,e,s,t,r,i){return c(),u("div",S$,[a("div",D$,[a("div",{class:"progress-fill",style:we({width:s.progress+"%"})},null,4)]),a("div",E$,m(s.progress)+"% - "+m(s.message),1)])}const $$=de(T$,[["render",A$],["__scopeId","data-v-7071de3b"]]),I$={name:"CacheCreateModal",components:{CacheCreateProgress:$$},props:{module:{type:Object,required:!0}},emits:["close","create"],setup(o,{emit:e}){const s=I(!1),t=I(0),r=I(""),i=I(null),n=I(""),l=M(()=>o.module.id.includes("graph-admission-closure")||o.module.id.includes("time-tracking")),d=M(()=>o.module.id.includes("graph-admission-closure")?["months","weeks"]:o.module.id.includes("time-tracking")?["default","detailed","summary"]:[]),g=()=>{e("close")},p=v=>{v.preventDefault(),v.stopPropagation(),v.target===v.currentTarget&&g()},T=async()=>{s.value=!0,t.value=0,r.value="–ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞...";try{let v={};if(n.value.trim())try{v=JSON.parse(n.value)}catch{throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")}else v=Ls.getDefaultParams(o.module.id);ds.notifyCacheCreationStarted(o.module.name),t.value=25,r.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24...";const y=await Ls.createCache(o.module.id,i.value,v);t.value=75,r.value="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∞...",await new Promise(k=>setTimeout(k,500)),t.value=100,r.value="–ö–µ—à —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",ds.notifyCacheCreationSuccess(o.module.name),setTimeout(()=>{e("create",y),g()},1e3)}catch(v){console.error("[CacheCreateModal] Error creating cache:",v),ds.notifyCacheCreationError(o.module.name,v.message),s.value=!1}};return $e(()=>{d.value.length>0&&(i.value=d.value[0]);const v=Ls.getDefaultParams(o.module.id);n.value=JSON.stringify(v,null,2)}),{creating:s,progress:t,progressMessage:r,selectedMode:i,paramsJson:n,supportsModes:l,availableModes:d,close:g,handleOverlayClick:p,handleCreate:T}}},M$={class:"modal-header"},N$={class:"modal-body"},x$={key:1,class:"create-form"},L$={key:0,class:"form-group"},P$=["value"],O$={class:"form-group"},R$={class:"modal-footer"},B$=["disabled"],U$=["disabled"],W$={key:0},F$={key:1};function H$(o,e,s,t,r,i){const n=be("CacheCreateProgress");return c(),he(It,{to:"body"},[a("div",{class:"modal-overlay",onClick:e[6]||(e[6]=(...l)=>t.handleOverlayClick&&t.handleOverlayClick(...l))},[a("div",{class:"modal-content",onClick:e[5]||(e[5]=Ce(()=>{},["stop"])),style:{"pointer-events":"auto"}},[a("div",M$,[a("h2",null,"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞: "+m(s.module.name),1),a("button",{onClick:e[0]||(e[0]=(...l)=>t.close&&t.close(...l)),class:"btn-close"},"√ó")]),a("div",N$,[t.creating?(c(),he(n,{key:0,progress:t.progress,message:t.progressMessage},null,8,["progress","message"])):(c(),u("div",x$,[t.supportsModes?(c(),u("div",L$,[e[7]||(e[7]=a("label",null,"–†–µ–∂–∏–º –∫–µ—à–∞:",-1)),Re(a("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.selectedMode=l),class:"form-control"},[(c(!0),u(ee,null,te(t.availableModes,l=>(c(),u("option",{key:l,value:l},m(l),9,P$))),128))],512),[[dt,t.selectedMode]])])):A("",!0),a("div",O$,[e[8]||(e[8]=a("label",null,"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):",-1)),Re(a("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.paramsJson=l),placeholder:'{"product": "1C", ...}',rows:"5",class:"form-control"},null,512),[[At,t.paramsJson]]),e[9]||(e[9]=a("small",{class:"form-text"},"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",-1))])]))]),a("div",R$,[a("button",{onClick:e[3]||(e[3]=(...l)=>t.close&&t.close(...l)),class:"btn-cancel",disabled:t.creating},"–û—Ç–º–µ–Ω–∞",8,B$),a("button",{onClick:e[4]||(e[4]=(...l)=>t.handleCreate&&t.handleCreate(...l)),disabled:t.creating,class:"btn-create"},[t.creating?(c(),u("span",W$,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),u("span",F$,"–°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],8,U$)])])])])}const j$=de(I$,[["render",H$],["__scopeId","data-v-1fa7d83b"]]),V$={name:"CacheCreateButton",components:{CacheCreateModal:j$},props:{module:{type:Object,required:!0}},emits:["created"],setup(o,{emit:e}){const s=I(!1),t=I(!1);return{showModal:s,creating:t,openModal:()=>{s.value=!0},closeModal:()=>{s.value=!1},handleCreate:async l=>{t.value=!0;try{e("created",l)}finally{t.value=!1}}}}},z$={class:"cache-create-button"},G$=["disabled"],K$={key:0},q$={key:1};function Y$(o,e,s,t,r,i){const n=be("CacheCreateModal");return c(),u("div",z$,[a("button",{onClick:e[0]||(e[0]=(...l)=>t.openModal&&t.openModal(...l)),disabled:t.creating,class:X(["btn-create",{"btn-disabled":t.creating}])},[t.creating?(c(),u("span",K$,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),u("span",q$,"‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],10,G$),t.showModal?(c(),he(n,{key:0,module:s.module,onClose:t.closeModal,onCreate:t.handleCreate},null,8,["module","onClose","onCreate"])):A("",!0)])}const X$=de(V$,[["render",Y$],["__scopeId","data-v-45e7d308"]]);class Ye{static success(e,s,t={}){this.show("success",e,s,t)}static error(e,s,t={}){this.show("error",e,s,t)}static warning(e,s,t={}){this.show("warning",e,s,t)}static info(e,s,t={}){this.show("info",e,s,t)}static show(e,s,t,r={}){const i={autoHideDelay:r.autoHideDelay||5e3,position:r.position||"top-right",...r};this.isBitrix24Available()?this.showBitrix24Notification(e,s,t,i):this.showFallbackNotification(e,s,t,i)}static isBitrix24Available(){return typeof window<"u"&&window.BX&&window.BX.UI&&window.BX.UI.Notification&&window.BX.UI.Notification.Center&&typeof window.BX.UI.Notification.Center.notify=="function"}static showBitrix24Notification(e,s,t,r){try{const n={success:"success",error:"error",warning:"warning",info:"info"}[e]||"info",l=s?`${s}: ${t}`:t;window.BX.UI.Notification.Center.notify({content:l,autoHideDelay:r.autoHideDelay,category:`cache-management-${e}`,position:r.position}),console.log(`[NotificationSystem] Bitrix24 notification shown: ${e}`,{title:s,message:t,config:r})}catch(i){console.error("[NotificationSystem] Error showing Bitrix24 notification:",i),this.showFallbackNotification(e,s,t,r)}}static showFallbackNotification(e,s,t,r){if("Notification"in window&&Notification.permission==="granted")try{const i=new Notification(s||"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",{body:t,icon:this.getIconForType(e),tag:`cache-management-${e}`});setTimeout(()=>{i.close()},r.autoHideDelay),console.log(`[NotificationSystem] Browser notification shown: ${e}`,{title:s,message:t});return}catch(i){console.warn("[NotificationSystem] Browser notification failed:",i)}this.showCustomNotification(e,s,t,r)}static showCustomNotification(e,s,t,r){let i=document.getElementById("notification-container");if(!i){i=document.createElement("div"),i.id="notification-container",i.className="notification-container",document.body.appendChild(i);const d=document.createElement("style");d.textContent=this.getNotificationStyles(),document.head.appendChild(d)}const n=document.createElement("div");n.className=`custom-notification notification-${e}`,n.innerHTML=`
      <div class="notification-content">
        <div class="notification-title">${s||""}</div>
        <div class="notification-message">${t}</div>
      </div>
      <button class="notification-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">√ó</button>
    `,n.querySelector(".notification-close").addEventListener("click",()=>{this.removeCustomNotification(n)}),i.appendChild(n),setTimeout(()=>{this.removeCustomNotification(n)},r.autoHideDelay),console.log(`[NotificationSystem] Custom notification shown: ${e}`,{title:s,message:t})}static removeCustomNotification(e){e&&e.parentNode&&(e.classList.add("notification-hiding"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}static getIconForType(e){const s={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};return s[e]||s.info}static getNotificationStyles(){return`
      .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        pointer-events: none;
      }

      .custom-notification {
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 10px;
        min-width: 300px;
        max-width: 500px;
        pointer-events: auto;
        opacity: 0;
        transform: translateX(100%);
        animation: notificationSlideIn 0.3s ease forwards;
        border-left: 4px solid;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        padding: 16px;
        gap: 12px;
      }

      .custom-notification.notification-success {
        border-left-color: #28a745;
      }

      .custom-notification.notification-error {
        border-left-color: #dc3545;
      }

      .custom-notification.notification-warning {
        border-left-color: #ffc107;
      }

      .custom-notification.notification-info {
        border-left-color: #17a2b8;
      }

      .notification-content {
        flex: 1;
      }

      .notification-title {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
        color: #333;
      }

      .notification-message {
        font-size: 13px;
        color: #666;
        line-height: 1.4;
      }

      .notification-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #999;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        flex-shrink: 0;
      }

      .notification-close:hover {
        color: #333;
      }

      .notification-hiding {
        animation: notificationSlideOut 0.3s ease forwards;
      }

      @keyframes notificationSlideIn {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes notificationSlideOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(100%);
        }
      }

      @media (max-width: 768px) {
        .notification-container {
          left: 10px;
          right: 10px;
          top: 10px;
        }

        .custom-notification {
          min-width: auto;
          max-width: none;
        }
      }
    `}static clearAll(){try{this.isBitrix24Available()&&window.BX.UI.Notification.Center.clearAll&&window.BX.UI.Notification.Center.clearAll()}catch(s){console.warn("[NotificationSystem] Error clearing Bitrix24 notifications:",s)}const e=document.getElementById("notification-container");if(e&&(e.innerHTML=""),"Notification"in window&&"getNotifications"in Notification)try{Notification.getNotifications().forEach(t=>{t.tag&&t.tag.startsWith("cache-management-")&&t.close()})}catch(s){console.warn("[NotificationSystem] Error clearing browser notifications:",s)}}}Ye.show.bind(Ye);Ye.success.bind(Ye);Ye.error.bind(Ye);Ye.warning.bind(Ye);Ye.info.bind(Ye);let Ve=null,ot=null;const Ot=class Ot{static show(e={}){return new Promise((s,t)=>{ot=s,Ve||(Ve=this.createModal(),document.body.appendChild(Ve)),this.configureModal(e),this.showModal()})}static hide(){Ve&&(this.hideModal(),ot&&(ot(!1),ot=null))}static createModal(){const e=document.createElement("div");return e.className="cache-confirmation-modal",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","confirmation-title"),e.setAttribute("aria-describedby","confirmation-message"),e.innerHTML=`
      <div class="modal-backdrop" data-action="cancel"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="confirmation-title" class="modal-title"></h3>
          <button
            class="modal-close"
            data-action="cancel"
            aria-label="–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"
          >
            √ó
          </button>
        </div>

        <div class="modal-body">
          <div class="modal-icon">
            <span class="icon-symbol"></span>
          </div>
          <p id="confirmation-message" class="modal-message"></p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-cancel" data-action="cancel"></button>
          <button class="btn btn-confirm" data-action="confirm"></button>
        </div>
      </div>
    `,this.attachEventListeners(e),this.addStyles(),e}static configureModal(e){const{title:s="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",message:t="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ?",type:r="warning",confirmText:i="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",cancelText:n="–û—Ç–º–µ–Ω–∞",showCancel:l=!0}=e,d=Ve.querySelector(".modal-title");d.textContent=s;const g=Ve.querySelector(".modal-message");g.textContent=t;const p=Ve.querySelector(".icon-symbol"),T={danger:"‚ö†Ô∏è",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è",success:"‚úÖ"};p.textContent=T[r]||T.warning;const v=Ve.querySelector(".btn-cancel"),y=Ve.querySelector(".btn-confirm");v.textContent=n,y.textContent=i,l?v.style.display="inline-block":v.style.display="none",Ve.className=`cache-confirmation-modal modal-${r}`}static showModal(){document.body.style.overflow="hidden",Ve.style.display="flex",Ve.classList.add("modal-visible"),setTimeout(()=>{const e=Ve.querySelector(".btn-confirm");e&&e.focus()},100),document.addEventListener("keydown",this.handleKeyDown)}static hideModal(){document.body.style.overflow="",Ve.classList.remove("modal-visible"),document.removeEventListener("keydown",this.handleKeyDown),setTimeout(()=>{Ve&&(Ve.style.display="none")},300)}static attachEventListeners(e){e.addEventListener("click",s=>{const t=s.target.closest("[data-action]")?.getAttribute("data-action");t==="confirm"?this.handleConfirm():t==="cancel"&&this.handleCancel()})}static handleConfirm(){ot&&(ot(!0),ot=null),this.hideModal()}static handleCancel(){ot&&(ot(!1),ot=null),this.hideModal()}static handleTabNavigation(e){const t=Ve.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),r=t[0],i=t[t.length-1];e.shiftKey?document.activeElement===r&&(e.preventDefault(),i.focus()):document.activeElement===i&&(e.preventDefault(),r.focus())}static addStyles(){if(document.getElementById("cache-confirmation-styles"))return;const e=document.createElement("style");e.id="cache-confirmation-styles",e.textContent=`
      .cache-confirmation-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        align-items: center;
        justify-content: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      .cache-confirmation-modal.modal-visible {
        display: flex;
      }

      .modal-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(2px);
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        z-index: 10001;
        animation: modalSlideIn 0.3s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px 16px;
        border-bottom: 1px solid #e0e0e0;
      }

      .modal-title {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: #333;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .modal-close:hover {
        background: #f0f0f0;
        color: #333;
      }

      .modal-body {
        padding: 24px;
        text-align: center;
      }

      .modal-icon {
        margin-bottom: 16px;
      }

      .icon-symbol {
        font-size: 48px;
        display: block;
      }

      .modal-message {
        margin: 0;
        font-size: 16px;
        color: #555;
        line-height: 1.5;
      }

      .modal-footer {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        padding: 16px 24px 24px;
        border-top: 1px solid #e0e0e0;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
        min-width: 80px;
      }

      .btn:focus {
        outline: 2px solid #007bff;
        outline-offset: 2px;
      }

      .btn-cancel {
        background: #f8f9fa;
        color: #6c757d;
        border: 1px solid #dee2e6;
      }

      .btn-cancel:hover {
        background: #e9ecef;
        border-color: #adb5bd;
      }

      .btn-confirm {
        background: #007bff;
        color: white;
      }

      .btn-confirm:hover {
        background: #0056b3;
      }

      /* –¢–∏–ø—ã –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
      .modal-danger .btn-confirm {
        background: #dc3545;
      }

      .modal-danger .btn-confirm:hover {
        background: #c82333;
      }

      .modal-warning .btn-confirm {
        background: #ffc107;
        color: #212529;
      }

      .modal-warning .btn-confirm:hover {
        background: #e0a800;
      }

      .modal-info .btn-confirm {
        background: #17a2b8;
      }

      .modal-info .btn-confirm:hover {
        background: #138496;
      }

      .modal-success .btn-confirm {
        background: #28a745;
      }

      .modal-success .btn-confirm:hover {
        background: #1e7e34;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
      @media (max-width: 480px) {
        .modal-content {
          margin: 20px;
          width: calc(100% - 40px);
        }

        .modal-header,
        .modal-body,
        .modal-footer {
          padding-left: 20px;
          padding-right: 20px;
        }

        .modal-footer {
          flex-direction: column-reverse;
        }

        .btn {
          width: 100%;
        }
      }

      /* –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å */
      @media (prefers-reduced-motion: reduce) {
        .modal-content,
        .modal-close,
        .btn {
          animation: none;
          transition: none;
        }
      }

      /* –í—ã—Å–æ–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç */
      @media (prefers-contrast: high) {
        .modal-content {
          border: 2px solid #000;
        }

        .btn-cancel {
          border: 2px solid #000;
        }

        .btn-confirm {
          border: 2px solid #000;
        }
      }
    `,document.head.appendChild(e)}};je(Ot,"handleKeyDown",e=>{switch(e.key){case"Enter":e.preventDefault(),Ot.handleConfirm();break;case"Escape":e.preventDefault(),Ot.handleCancel();break;case"Tab":Ot.handleTabNavigation(e);break}});let $t=Ot;$t.show.bind($t);$t.hide.bind($t);const J$={name:"CacheModuleCard",components:{CacheCreateButton:X$},props:{module:{type:Object,required:!0,validator:o=>o&&typeof o.id=="string"&&typeof o.name=="string"},isPrimary:{type:Boolean,default:!1},priority:{type:Number,default:999},groupType:{type:String,default:null}},emits:["clear","refresh","details"],setup(o,{emit:e}){const s=I(!1),t=I(!1),r=I(!1),i=I(!1),n=b=>{if(!b.target.closest(".action-button"))switch(b.key){case"Enter":case" ":b.preventDefault();const O=b.currentTarget.querySelector(".action-button:not([disabled])");O&&O.focus();break}};$e(()=>{const b=()=>{i.value=window.innerWidth<768};b(),window.addEventListener("resize",b);const O=document.querySelector(`[data-module-id="${o.module.id}"]`);O&&O.addEventListener("keydown",n)}),st(()=>{const b=document.querySelector(`[data-module-id="${o.module.id}"]`);b&&b.removeEventListener("keydown",n)});const l=M(()=>({"cache-module-card":!0,"primary-module":o.isPrimary,"secondary-module":!o.isPrimary,"high-priority":o.priority<=3,"expiring-soon":S.value,"empty-cache":y.value,loading:s.value||t.value,[_.value]:!0})),d=M(()=>o.isPrimary?"üèÜ":{users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"}[o.groupType]||"üîß"),g=M(()=>({"primary-icon":o.isPrimary,"secondary-icon":!o.isPrimary})),p=M(()=>o.isPrimary?"–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å":o.groupType?Pe.getModuleTypeConfig(o.groupType).title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞":""),T=M(()=>o.priority?`priority-${o.priority}`:""),v=M(()=>`status-${o.module.status||"empty"}`),y=M(()=>(o.module.file_count||0)===0),k=M(()=>o.module.expires_at?new Date(o.module.expires_at*1e3)<=new Date:!1),S=M(()=>{if(!o.module.expires_at)return!1;const Q=(new Date(o.module.expires_at*1e3)-new Date)/(1e3*60*60);return Q>0&&Q<=2}),C=M(()=>{const b=o.module.status;return b==="active"?"–ê–∫—Ç–∏–≤–µ–Ω":b==="expired"?"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω":b==="empty"?"–ü—É—Å—Ç":"–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}),f=M(()=>Pe.formatCacheSize(o.module.total_size||0)),w=M(()=>Pe.formatTTL(o.module.ttl||0)),$=M(()=>{if(!o.module.cache_dir)return"";const b=o.module.cache_dir.split("/");return b.length>2?"..."+b.slice(-2).join("/"):o.module.cache_dir}),W=M(()=>o.module.metadata?.creation_time_ms?Pe.formatCreationTime(o.module.metadata.creation_time_ms):"‚Äî"),L=M(()=>{if(!o.module.metadata?.last_accessed_at)return"‚Äî";const b=new Date(o.module.metadata.last_accessed_at*1e3),Q=new Date-b;return Q<6e4?"–¢–æ–ª—å–∫–æ —á—Ç–æ":Q<36e5?`${Math.floor(Q/6e4)} –º–∏–Ω –Ω–∞–∑–∞–¥`:b.toLocaleString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),D=M(()=>o.module.metadata?.access_count||0),E=M(()=>o.module.metadata?.performance_metrics?.cache_hit_ratio?Pe.formatCacheHitRatio(o.module.metadata.performance_metrics.cache_hit_ratio):"‚Äî"),x=M(()=>o.module.metadata?.performance_metrics?.data_freshness_score?Pe.formatDataFreshness(o.module.metadata.performance_metrics.data_freshness_score):"‚Äî"),R=M(()=>o.module.expires_at?`metric-${Pe.getExpiryColor(o.module.expires_at)}`:""),U=M(()=>o.module.metadata?.creation_time_ms?`metric-${Pe.getCreationTimeColor(o.module.metadata.creation_time_ms)}`:""),G=M(()=>o.module.metadata?.performance_metrics?.cache_hit_ratio?`metric-${Pe.getEfficiencyColor(o.module.metadata.performance_metrics.cache_hit_ratio)}`:""),q=M(()=>o.module.metadata?.performance_metrics?.data_freshness_score?`metric-${Pe.getFreshnessColor(o.module.metadata.performance_metrics.data_freshness_score)}`:""),oe=M(()=>{if(!o.module.expires_at)return null;const b=new Date(o.module.expires_at*1e3);return Math.max(0,Math.floor((b-new Date)/1e3))}),Y=M(()=>{if(oe.value===null)return"‚Äî";if(oe.value<=0)return"–ò—Å—Ç–µ–∫";const b=Math.floor(oe.value/3600),O=Math.floor(oe.value%3600/60),Q=oe.value%60;return b>0?`${b}—á ${O}–º`:O>0?`${O}–º ${Q}—Å`:`${Q}—Å`}),H=M(()=>oe.value===null?"":oe.value<=0||oe.value<=1800?"metric-red":oe.value<=7200?"metric-orange":"metric-green"),Z=b=>{if(b===0)return"0 B";const O=1024,Q=["B","KB","MB","GB","TB"],ue=Math.floor(Math.log(b)/Math.log(O));return parseFloat((b/Math.pow(O,ue)).toFixed(1))+" "+Q[ue]},fe=b=>b<60?`${b}—Å`:b<3600?`${Math.floor(b/60)}–º`:b<86400?`${Math.floor(b/3600)}—á`:`${Math.floor(b/86400)}–¥`,P=M(()=>{if(y.value)return"empty";if(k.value)return"expired";const b=oe.value;return b===null?"fresh":b<=0?"expired":b<=30*60*1e3?"critical":b<=2*60*60*1e3?"warning":"fresh"}),h=M(()=>{const b=P.value;return{fresh:"–°–≤–µ–∂–∏–π –∫–µ—à",warning:"–ò—Å—Ç–µ–∫–∞–µ—Ç —Å–∫–æ—Ä–æ",critical:"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç",expired:"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω",empty:"–ö–µ—à –ø—É—Å—Ç"}[b]||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}),_=M(()=>`cache-state-${P.value}`),B=M(()=>({fresh:"üü¢",warning:"üü°",critical:"üî¥",expired:"‚ö´",empty:"‚ö™"})[P.value]||"‚ùì"),re=M(()=>!y.value&&!s.value),le=M(()=>o.isPrimary&&!y.value),ae=M(()=>y.value?"–ö–µ—à –º–æ–¥—É–ª—è –ø—É—Å—Ç":`–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è ${o.module.name}`),me=M(()=>{if(!o.module.created_at)return"‚Äî";const b=new Date(o.module.created_at*1e3),O=new Date,Q=O-b;if(Q<6e4)return"–¢–æ–ª—å–∫–æ —á—Ç–æ";if(Q<36e5){const ke=Math.floor(Q/6e4);return`${ke} ${ke===1?"–º–∏–Ω—É—Ç—É":ke<5?"–º–∏–Ω—É—Ç—ã":"–º–∏–Ω—É—Ç"} –Ω–∞–∑–∞–¥`}if(b.toDateString()===O.toDateString())return`–°–µ–≥–æ–¥–Ω—è –≤ ${b.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`;const ue=new Date(O);return ue.setDate(ue.getDate()-1),b.toDateString()===ue.toDateString()?`–í—á–µ—Ä–∞ –≤ ${b.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:b.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),De=M(()=>{if(!o.module.expires_at)return"‚Äî";const b=new Date(o.module.expires_at*1e3),Q=b-new Date;if(Q<0)return`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω (${b.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})`;const ue=Math.floor(Q/6e4),ke=Math.floor(ue/60);return ke>0?`${ke} —á ${ue%60} –º–∏–Ω`:ue>0?`${ue} –º–∏–Ω`:"–ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã"});return{clearing:s,creating:t,showDetailModal:r,isMobile:i,moduleClasses:l,moduleIcon:d,iconClass:g,moduleTypeText:p,priorityClass:T,statusClass:v,isEmpty:y,isExpired:k,isExpiringSoon:S,statusText:C,formattedSize:f,formattedTTL:w,shortCacheDir:$,formattedCreationTime:W,formattedLastAccess:L,accessCount:D,cacheEfficiency:E,dataFreshness:x,expiresClass:R,creationTimeClass:U,cacheEfficiencyClass:G,dataFreshnessClass:q,cacheState:P,cacheStateText:h,cacheStateClass:_,cacheStateIcon:B,timeToExpiry:oe,formatTimeToExpiry:Y,timeToExpiryClass:H,formatBytes:Z,formatTTL:fe,canClear:re,canShowDetails:le,clearButtonLabel:ae,formattedCreatedAt:me,formattedExpiresAt:De,handleClear:async()=>{if(re.value)try{if(!await $t.show({title:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",message:`–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${o.module.name}"?

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`,type:"danger",confirmText:"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à",cancelText:"–û—Ç–º–µ–Ω–∞"}))return;s.value=!0,await Pe.clearCache(o.module.id),e("clear",o.module.id),Ye.success("–ö–µ—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω",`–ö–µ—à –º–æ–¥—É–ª—è "${o.module.name}" –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω`)}catch(b){console.error("[CacheModuleCard] Error clearing cache:",b),Ye.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${o.module.name}": ${b.message}`)}finally{s.value=!1}},handleCacheCreated:()=>{Pe.invalidateCacheAfterModuleOperation(),e("refresh")},handleCreatingState:b=>{t.value=b},showDetails:()=>{r.value=!0,e("details",o.module)},closeDetails:()=>{r.value=!1}}}},Z$=["aria-labelledby","aria-describedby","data-module-id"],Q$={class:"card-header"},eI={class:"module-identity"},tI={class:"module-info"},sI=["id"],aI={class:"module-type"},oI={class:"header-meta"},nI=["id"],rI={class:"card-content"},iI={class:"data-grid",role:"region","aria-label":"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–µ—à–µ"},lI={class:"data-section statistics"},cI={class:"data-items"},dI={class:"data-item"},uI={class:"data-value"},gI={class:"data-item"},mI={class:"data-value"},hI={key:0,class:"data-item full-width"},fI=["title"],vI={class:"data-section lifetime"},pI={class:"data-items"},yI={class:"data-item"},kI={class:"data-value"},bI={key:0,class:"data-item"},_I={class:"data-value"},wI={key:1,class:"data-item"},CI={class:"data-section cache-state"},TI={class:"section-header"},SI=["aria-label"],DI={class:"data-items"},EI={class:"data-value cache-state-text"},AI={key:0,class:"data-section performance"},$I={class:"data-items"},II={key:0,class:"data-item"},MI={key:1,class:"data-item"},NI={class:"data-value"},xI={key:2,class:"data-item"},LI={class:"data-value"},PI={key:3,class:"data-item"},OI={key:4,class:"data-item"},RI={key:5,class:"data-item"},BI={class:"data-value"},UI={key:6,class:"data-item"},WI={class:"data-value"},FI={key:7,class:"data-item"},HI=["aria-label"],jI={class:"primary-actions"},VI={class:"secondary-actions"},zI=["disabled","aria-label"],GI={key:0,class:"button-content"},KI={key:1,class:"button-content"},qI={key:2,class:"button-content"},YI=["aria-label"],XI={class:"detail-modal",role:"dialog","aria-modal":"true"},JI={class:"modal-header"},ZI={class:"modal-content"},QI={class:"json-data"};function eM(o,e,s,t,r,i){const n=be("CacheCreateButton");return c(),u("article",{class:X(["cache-module-card",t.moduleClasses]),role:"article","aria-labelledby":`module-${s.module.id}-title`,"aria-describedby":`module-${s.module.id}-status`,"data-module-id":s.module.id,tabindex:"0"},[a("div",Q$,[a("div",eI,[a("div",{class:X(["module-icon",t.iconClass])},m(t.moduleIcon),3),a("div",tI,[a("h3",{class:"module-name",id:`module-${s.module.id}-title`},m(s.module.name),9,sI),a("span",aI,m(t.moduleTypeText),1)])]),a("div",oI,[s.isPrimary&&s.priority?(c(),u("span",{key:0,class:X(["priority-badge",t.priorityClass])},m(s.priority),3)):A("",!0),a("span",{class:X(["status-badge",t.statusClass]),id:`module-${s.module.id}-status`,role:"status"},m(t.statusText),11,nI)])]),a("div",rI,[a("div",iI,[a("div",lI,[e[14]||(e[14]=a("div",{class:"section-header"},[a("span",{class:"section-icon","aria-hidden":"true"},"üìä"),a("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],-1)),a("div",cI,[a("div",dI,[e[11]||(e[11]=a("span",{class:"data-label"},"–§–∞–π–ª–æ–≤:",-1)),a("span",uI,m(s.module.file_count||0),1)]),a("div",gI,[e[12]||(e[12]=a("span",{class:"data-label"},"–†–∞–∑–º–µ—Ä:",-1)),a("span",mI,m(t.formattedSize),1)]),s.module.cache_dir?(c(),u("div",hI,[e[13]||(e[13]=a("span",{class:"data-label"},"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:",-1)),a("span",{class:"data-value cache-dir",title:s.module.cache_dir},m(t.shortCacheDir),9,fI)])):A("",!0)])]),a("div",vI,[e[18]||(e[18]=a("div",{class:"section-header"},[a("span",{class:"section-icon","aria-hidden":"true"},"‚è∞"),a("h4",{class:"section-title"},"–í—Ä–µ–º—è –∂–∏–∑–Ω–∏")],-1)),a("div",pI,[a("div",yI,[e[15]||(e[15]=a("span",{class:"data-label"},"TTL:",-1)),a("span",kI,m(t.formattedTTL),1)]),s.module.created_at?(c(),u("div",bI,[e[16]||(e[16]=a("span",{class:"data-label"},"–°–æ–∑–¥–∞–Ω:",-1)),a("span",_I,m(t.formattedCreatedAt),1)])):A("",!0),s.module.expires_at?(c(),u("div",wI,[e[17]||(e[17]=a("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç:",-1)),a("span",{class:X(["data-value",t.expiresClass])},m(t.formattedExpiresAt),3)])):A("",!0)])]),a("div",CI,[a("div",TI,[a("span",{class:"section-icon","aria-label":t.cacheStateText,"aria-hidden":"false"},m(t.cacheStateIcon),9,SI),e[19]||(e[19]=a("h4",{class:"section-title"},"–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–µ—à–∞",-1))]),a("div",DI,[a("div",{class:X(["data-item cache-state-indicator",t.cacheStateClass])},[e[20]||(e[20]=a("span",{class:"data-label"},"–°—Ç–∞—Ç—É—Å:",-1)),a("span",EI,m(t.cacheStateText),1)],2)])]),s.module.metadata||s.module.created_at?(c(),u("div",AI,[e[29]||(e[29]=a("div",{class:"section-header"},[a("span",{class:"section-icon","aria-hidden":"true"},"‚ö°"),a("h4",{class:"section-title"},"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")],-1)),a("div",$I,[t.formattedCreationTime?(c(),u("div",II,[e[21]||(e[21]=a("span",{class:"data-label"},"–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:",-1)),a("span",{class:X(["data-value",t.creationTimeClass])},m(t.formattedCreationTime),3)])):A("",!0),t.formattedLastAccess?(c(),u("div",MI,[e[22]||(e[22]=a("span",{class:"data-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—Å—Ç—É–ø:",-1)),a("span",NI,m(t.formattedLastAccess),1)])):A("",!0),t.accessCount!==null?(c(),u("div",xI,[e[23]||(e[23]=a("span",{class:"data-label"},"–û–±—Ä–∞—â–µ–Ω–∏–π:",-1)),a("span",LI,m(t.accessCount),1)])):A("",!0),t.cacheEfficiency?(c(),u("div",PI,[e[24]||(e[24]=a("span",{class:"data-label"},"–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),a("span",{class:X(["data-value",t.cacheEfficiencyClass])},m(t.cacheEfficiency),3)])):A("",!0),t.dataFreshness?(c(),u("div",OI,[e[25]||(e[25]=a("span",{class:"data-label"},"–°–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:",-1)),a("span",{class:X(["data-value",t.dataFreshnessClass])},m(t.dataFreshness),3)])):A("",!0),s.module.total_size?(c(),u("div",RI,[e[26]||(e[26]=a("span",{class:"data-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:",-1)),a("span",BI,m(t.formatBytes(s.module.total_size)),1)])):A("",!0),s.module.ttl?(c(),u("div",UI,[e[27]||(e[27]=a("span",{class:"data-label"},"TTL:",-1)),a("span",WI,m(t.formatTTL(s.module.ttl)),1)])):A("",!0),t.timeToExpiry!==null?(c(),u("div",FI,[e[28]||(e[28]=a("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑:",-1)),a("span",{class:X(["data-value",t.timeToExpiryClass])},m(t.formatTimeToExpiry),3)])):A("",!0)])])):A("",!0)])]),a("div",{class:X(["card-actions",{"mobile-layout":t.isMobile}]),role:"group","aria-label":`–î–µ–π—Å—Ç–≤–∏—è —Å –∫–µ—à–µ–º ${s.module.name}`},[a("div",jI,[ne(n,{module:s.module,disabled:t.creating,onCreated:t.handleCacheCreated,onCreating:t.handleCreatingState,class:X({loading:t.creating})},null,8,["module","disabled","onCreated","onCreating","class"])]),a("div",VI,[a("button",{onClick:e[0]||(e[0]=(...l)=>t.handleClear&&t.handleClear(...l)),onKeydown:[e[1]||(e[1]=Be((...l)=>t.handleClear&&t.handleClear(...l),["enter"])),e[2]||(e[2]=Be(Ce((...l)=>t.handleClear&&t.handleClear(...l),["prevent"]),["space"]))],disabled:!t.canClear,class:X(["action-button clear-button",{disabled:!t.canClear,loading:t.clearing}]),"aria-label":t.clearButtonLabel,tabindex:"0"},[t.clearing?(c(),u("span",GI,[...e[30]||(e[30]=[a("span",{class:"spinner"},null,-1),ce(" –û—á–∏—Å—Ç–∫–∞... ",-1)])])):t.isEmpty?(c(),u("span",KI," üìÅ –ö–µ—à –ø—É—Å—Ç ")):(c(),u("span",qI," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å "))],42,zI),t.canShowDetails?(c(),u("button",{key:0,onClick:e[3]||(e[3]=(...l)=>t.showDetails&&t.showDetails(...l)),onKeydown:[e[4]||(e[4]=Be((...l)=>t.showDetails&&t.showDetails(...l),["enter"])),e[5]||(e[5]=Be(Ce((...l)=>t.showDetails&&t.showDetails(...l),["prevent"]),["space"]))],class:"action-button details-button","aria-label":`–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞ ${s.module.name}`,title:"–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞",tabindex:"0"}," üìä ",40,YI)):A("",!0)])],10,HI),(c(),he(It,{to:"body"},[t.showDetailModal?(c(),u("div",{key:0,class:"detail-modal-overlay",onClick:e[9]||(e[9]=Ce((...l)=>t.closeDetails&&t.closeDetails(...l),["self"])),onKeydown:e[10]||(e[10]=Be((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))},[a("div",XI,[a("div",JI,[a("h3",null,"–î–µ—Ç–∞–ª–∏ –∫–µ—à–∞: "+m(s.module.name),1),a("button",{onClick:e[6]||(e[6]=(...l)=>t.closeDetails&&t.closeDetails(...l)),onKeydown:[e[7]||(e[7]=Be((...l)=>t.closeDetails&&t.closeDetails(...l),["enter"])),e[8]||(e[8]=Be((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))],class:"close-button","aria-label":"–ó–∞–∫—Ä—ã—Ç—å",tabindex:"0"}," ‚úï ",32)]),a("div",ZI,[a("pre",QI,m(JSON.stringify(s.module,null,2)),1)])])],32)):A("",!0)]))],10,Z$)}const tM=de(J$,[["render",eM],["__scopeId","data-v-bc59cd77"]]),sM={name:"CacheStats",props:{modules:{type:Array,required:!1,default:()=>[]}},setup(o){console.log("[CacheStats] setup called with modules:",o.modules);const e=M(()=>o.modules||[]),s=M(()=>{console.log("[CacheStats] Computing primaryModules, total modules:",e.value?.length||0);const k=e.value.filter(S=>Pe.PRIMARY_MODULE_IDS.includes(S.id));return console.log("[CacheStats] Primary modules count:",k.length),k}),t=M(()=>{console.log("[CacheStats] Computing secondaryModules, total modules:",e.value?.length||0);const k=e.value.filter(S=>!Pe.PRIMARY_MODULE_IDS.includes(S.id));return console.log("[CacheStats] Secondary modules count:",k.length),k}),r=M(()=>s.value?.length||0),i=M(()=>t.value?.length||0),n=M(()=>e.value?.length||0),l=M(()=>e.value.reduce((k,S)=>k+(S.file_count||0),0)),d=M(()=>(o.modules||[]).reduce((k,S)=>k+(S.total_size||0),0)),g=M(()=>Pe.formatCacheSize(d.value)),p=M(()=>{const k=o.modules||[];if(k.length===0)return"0 –º–∏–Ω";const S=k.reduce((f,w)=>f+(w.ttl||0),0),C=Math.round(S/k.length);return Pe.formatTTL(C)}),T=M(()=>(e.value||[]).filter(k=>k.status==="active").length),v=M(()=>{if((i.value||0)===0)return[];const k={};(t.value||[]).forEach(C=>{const f=Pe.getModuleType(C.id);if(!k[f]){const w=Pe.getModuleTypeConfig(f);k[f]={type:f,title:w.title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞",icon:y(f),count:0}}k[f].count++});const S=i.value||0;return Object.values(k).map(C=>({...C,percentage:S>0?Math.round(C.count/S*100):0})).sort((C,f)=>f.count-C.count)}),y=k=>{const S={users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"};return S[k]||S.other};return{modules:e,primaryModulesCount:r,secondaryModulesCount:i,totalModules:n,totalFiles:l,totalSizeFormatted:g,avgTTL:p,activeModules:T,groupStats:v}}},aM={key:0,class:"cache-stats"},oM={class:"stats-overview"},nM={class:"overview-grid"},rM={class:"overview-card primary"},iM={class:"overview-content"},lM={class:"overview-value"},cM={class:"overview-card secondary"},dM={class:"overview-content"},uM={class:"overview-value"},gM={class:"overview-card total"},mM={class:"overview-content"},hM={class:"overview-value"},fM={class:"detailed-stats"},vM={class:"stats-grid"},pM={class:"stat-card"},yM={class:"stat-content"},kM={class:"stat-value"},bM={class:"stat-card"},_M={class:"stat-content"},wM={class:"stat-value"},CM={class:"stat-card"},TM={class:"stat-content"},SM={class:"stat-value"},DM={class:"stat-card"},EM={class:"stat-content"},AM={class:"stat-value"},$M={key:0,class:"group-distribution"},IM={class:"distribution-grid"},MM={class:"group-icon"},NM={class:"group-info"},xM={class:"group-name"},LM={class:"group-count"},PM={class:"group-percentage"},OM={key:1,class:"cache-stats-loading"};function RM(o,e,s,t,r,i){return(t.modules||[]).length>0?(c(),u("div",aM,[e[18]||(e[18]=a("h2",{class:"stats-title"},"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",-1)),a("div",oM,[a("div",nM,[a("div",rM,[e[2]||(e[2]=a("div",{class:"overview-icon"},"üèÜ",-1)),a("div",iM,[a("div",lM,m(t.primaryModulesCount),1),e[0]||(e[0]=a("div",{class:"overview-label"},"–û—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[1]||(e[1]=a("div",{class:"overview-desc"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ",-1))])]),a("div",cM,[e[5]||(e[5]=a("div",{class:"overview-icon"},"üîß",-1)),a("div",dM,[a("div",uM,m(t.secondaryModulesCount),1),e[3]||(e[3]=a("div",{class:"overview-label"},"–ü–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[4]||(e[4]=a("div",{class:"overview-desc"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),a("div",gM,[e[8]||(e[8]=a("div",{class:"overview-icon"},"üì¶",-1)),a("div",mM,[a("div",hM,m(t.totalModules),1),e[6]||(e[6]=a("div",{class:"overview-label"},"–í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π",-1)),e[7]||(e[7]=a("div",{class:"overview-desc"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö",-1))])])])]),a("div",fM,[a("div",vM,[a("div",pM,[e[10]||(e[10]=a("div",{class:"stat-icon"},"üìÑ",-1)),a("div",yM,[a("div",kM,m(t.totalFiles),1),e[9]||(e[9]=a("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤",-1))])]),a("div",bM,[e[12]||(e[12]=a("div",{class:"stat-icon"},"üíæ",-1)),a("div",_M,[a("div",wM,m(t.totalSizeFormatted),1),e[11]||(e[11]=a("div",{class:"stat-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä",-1))])]),a("div",CM,[e[14]||(e[14]=a("div",{class:"stat-icon"},"‚è±Ô∏è",-1)),a("div",TM,[a("div",SM,m(t.avgTTL),1),e[13]||(e[13]=a("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–∏–π TTL",-1))])]),a("div",DM,[e[16]||(e[16]=a("div",{class:"stat-icon"},"‚ö°",-1)),a("div",EM,[a("div",AM,m(t.activeModules),1),e[15]||(e[15]=a("div",{class:"stat-label"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–µ—à–µ–π",-1))])])])]),t.secondaryModulesCount>0?(c(),u("div",$M,[e[17]||(e[17]=a("h3",{class:"distribution-title"},"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),a("div",IM,[(c(!0),u(ee,null,te(t.groupStats,n=>(c(),u("div",{key:n.type,class:"distribution-item"},[a("div",MM,m(n.icon),1),a("div",NM,[a("div",xM,m(n.title),1),a("div",LM,m(n.count)+" –º–æ–¥—É–ª–µ–π",1)]),a("div",PM,m(n.percentage)+"%",1)]))),128))])])):A("",!0)])):(c(),u("div",OM,[...e[19]||(e[19]=[a("p",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])]))}const BM=de(sM,[["render",RM],["__scopeId","data-v-9fa190bb"]]),UM={name:"CacheManagement",components:{CacheModuleCard:tM,CacheStats:BM},setup(){const o=I([]),e=I([]),s=I(!0),t=I(null),r=I(!1),i=M(()=>(o.value?.length||0)+(e.value?.length||0)),n=M(()=>{const f=l.value?.length||0,w=(d.value?.length||0)>0?1:0;return f+w}),l=M(()=>{const f=(o.value||[]).filter(w=>!w.id.includes("time-tracking"));return console.log("[CacheManagement] individualPrimaryModules:",f.length,f.map(w=>w.id)),f}),d=M(()=>{const f=(o.value||[]).filter(w=>w.id.includes("time-tracking")).sort((w,$)=>{const W=["time-tracking-default","time-tracking-detailed","time-tracking-summary"];return W.indexOf(w.id)-W.indexOf($.id)});return console.log("[CacheManagement] timeTrackingModules:",f.length,f.map(w=>w.id)),f}),g=M(()=>{const f={};return(e.value||[]).forEach($=>{const W=Pe.getModuleType($.id);f[W]||(f[W]={type:W,title:T(W),modules:[]}),f[W].modules.push($)}),Object.values(f).sort(($,W)=>{const L=["users","activity","webhooks","other"],D=L.indexOf($.type),E=L.indexOf(W.type);return(D===-1?999:D)-(E===-1?999:E)})}),p=async()=>{s.value=!0,t.value=null;try{const f=await Pe.getCacheStatus();o.value=f.primaryModules||[],e.value=f.secondaryModules||[],console.log("[CacheManagement] Primary modules:",o.value.length,o.value.map(w=>({id:w.id,name:w.name}))),console.log("[CacheManagement] Secondary modules:",e.value.length,e.value.map(w=>({id:w.id,name:w.name})))}catch(f){console.error("[CacheManagement] Error loading modules:",f),t.value=f.message}finally{s.value=!1}},T=f=>{const w={users:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",activity:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",webhooks:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",other:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏"};return w[f]||w.other},v=async f=>{console.log(`[CacheManagement] Clearing module: ${f}`),Pe.invalidateCacheAfterModuleOperation(),await p()},y=async()=>{console.log("[CacheManagement] Clearing all cache"),r.value=!0;try{await Pe.clearCache("all"),Pe.invalidateCacheAfterModuleOperation(),Ye.success("–ö–µ—à –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω","–í—Å–µ —Ñ–∞–π–ª—ã –∫–µ—à–∞ –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã"),await p()}catch(f){console.error("[CacheManagement] Error clearing all cache:",f),Ye.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à: ${f.message}`)}finally{r.value=!1}},k=async f=>{console.log(`[CacheManagement] Creating cache for: ${f.name} (${f.id})`),alert(`–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${f.name}
ID: ${f.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},S=async f=>{console.log(`[CacheManagement] Clearing cache for: ${f.name} (${f.id})`),alert(`–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${f.name}
ID: ${f.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},C=()=>{p()};return $e(()=>{p()}),{primaryModules:o,secondaryModules:e,loading:s,error:t,totalModules:i,groupedSecondaryModules:g,individualPrimaryModules:l,timeTrackingModules:d,logicalPrimaryCount:n,clearingAll:r,handleModuleClear:v,handleClearAllCache:y,handleCreateMock:k,handleClearMock:S,refreshModules:C}}},WM={class:"cache-management"},FM={key:0,class:"header-section"},HM={class:"stats-bar"},jM={class:"stat-item"},VM={class:"stat-item"},zM={class:"stat-item"},GM={key:0,class:"global-actions"},KM=["disabled"],qM={key:0},YM={key:1},XM={class:"section-header"},JM={class:"section-meta"},ZM={class:"module-count","aria-label":"{{ logicalPrimaryCount }} –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},QM={key:0,class:"modules-container"},e4={key:0,class:"modules-grid"},t4={key:1,class:"time-tracking-group"},s4={class:"modules-grid"},a4={key:1,class:"empty-state"},o4={key:2,class:"section-divider"},n4={key:3,class:"cache-section secondary-modules","aria-labelledby":"secondary-modules-heading"},r4={class:"section-header"},i4={class:"section-meta"},l4={class:"module-count","aria-label":"{{ (secondaryModules || []).length }} –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},c4={class:"grouped-modules"},d4={class:"group-header"},u4={class:"group-title"},g4={class:"group-badge secondary"},m4={class:"modules-grid"},h4={key:4,class:"error-message",role:"alert","aria-live":"assertive"},f4={key:5,class:"loading-overlay",role:"status","aria-live":"polite","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"};function v4(o,e,s,t,r,i){const n=be("CacheModuleCard");return c(),u("div",WM,[!t.loading&&!t.error?(c(),u("div",FM,[e[6]||(e[6]=a("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1)),e[7]||(e[7]=a("p",{class:"description"}," –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º —Å–∏—Å—Ç–µ–º—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è ",-1)),a("div",HM,[a("span",jM,[a("strong",null,m(t.totalModules),1),e[3]||(e[3]=ce(" –≤—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π ",-1))]),a("span",VM,[a("strong",null,m(t.logicalPrimaryCount),1),e[4]||(e[4]=ce(" –æ—Å–Ω–æ–≤–Ω—ã—Ö ",-1))]),a("span",zM,[a("strong",null,m((t.secondaryModules||[]).length),1),e[5]||(e[5]=ce(" –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ",-1))])]),!t.loading&&!t.error?(c(),u("div",GM,[a("button",{onClick:e[0]||(e[0]=(...l)=>t.handleClearAllCache&&t.handleClearAllCache(...l)),disabled:t.clearingAll,class:X(["btn-clear-all",{"btn-disabled":t.clearingAll}])},[t.clearingAll?(c(),u("span",qM,"üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫–µ—à–∞...")):(c(),u("span",YM,"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à"))],10,KM)])):A("",!0)])):A("",!0),!t.loading&&!t.error?(c(),u("section",{key:1,class:X(["cache-section primary-modules",{empty:(t.primaryModules||[]).length===0}]),"aria-labelledby":"primary-modules-heading"},[a("div",XM,[e[9]||(e[9]=a("h2",{id:"primary-modules-heading"},"üèÜ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),a("div",JM,[a("span",ZM,m(t.logicalPrimaryCount),1),e[8]||(e[8]=a("span",{class:"section-badge primary",role:"status","aria-label":"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",-1))])]),e[13]||(e[13]=a("p",{class:"section-description"}," 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã: –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°, –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏–µ–º–∞-–∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°. ",-1)),(t.primaryModules||[]).length>0?(c(),u("div",QM,[t.individualPrimaryModules.length>0?(c(),u("div",e4,[(c(!0),u(ee,null,te(t.individualPrimaryModules,l=>(c(),u("div",{key:l.id,class:"module-wrapper"},[ne(n,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])):A("",!0),(t.timeTrackingModules||[]).length>0?(c(),u("div",t4,[e[10]||(e[10]=a("div",{class:"group-header"},[a("h3",{class:"group-title"},"‚è±Ô∏è –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"),a("span",{class:"group-badge"},"–û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞")],-1)),e[11]||(e[11]=a("p",{class:"group-description"},"–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),a("div",s4,[(c(!0),u(ee,null,te(t.timeTrackingModules,l=>(c(),u("div",{key:l.id,class:"module-wrapper"},[ne(n,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])])):A("",!0)])):(c(),u("div",a4,[e[12]||(e[12]=a("p",null,"‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)),a("button",{onClick:e[1]||(e[1]=(...l)=>t.refreshModules&&t.refreshModules(...l)),class:"refresh-btn"},"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫")]))],2)):A("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),u("div",o4,[...e[14]||(e[14]=[_t('<div class="divider-line" data-v-6a4e8216></div><div class="divider-content" data-v-6a4e8216><span class="divider-icon" data-v-6a4e8216>üîß</span><span class="divider-text" data-v-6a4e8216>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏</span><span class="divider-subtitle" data-v-6a4e8216>–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</span></div><div class="divider-line" data-v-6a4e8216></div>',3)])])):A("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),u("section",n4,[a("div",r4,[e[16]||(e[16]=a("h2",{id:"secondary-modules-heading"},"üîß –ü–æ–±–æ—á–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),a("div",i4,[a("span",l4,m((t.secondaryModules||[]).length),1),e[15]||(e[15]=a("span",{class:"section-badge secondary",role:"status","aria-label":"–°–ª—É–∂–µ–±–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),e[17]||(e[17]=a("p",{class:"section-description"}," –ú–æ–¥—É–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã. ",-1)),a("div",c4,[(c(!0),u(ee,null,te(t.groupedSecondaryModules,l=>(c(),u("div",{key:l.type,class:X(["module-group",`group-${l.type}`])},[a("div",d4,[a("h3",u4,m(l.title),1),a("span",g4,m(l.modules.length),1)]),a("div",m4,[(c(!0),u(ee,null,te(l.modules,d=>(c(),u("div",{key:d.id,class:"module-wrapper"},[ne(n,{module:d,"is-primary":!1,"group-type":l.type,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","group-type","onClear","onRefresh"])]))),128))])],2))),128))])])):A("",!0),t.error?(c(),u("div",h4,[e[18]||(e[18]=a("h3",null,"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞",-1)),a("p",null,m(t.error),1),a("button",{onClick:e[2]||(e[2]=(...l)=>o.loadModules&&o.loadModules(...l)),class:"retry-btn","aria-label":"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):A("",!0),t.loading?(c(),u("div",f4,[...e[19]||(e[19]=[a("div",{class:"loading-spinner","aria-hidden":"true"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞...",-1)])])):A("",!0)])}const p4=de(UM,[["render",v4],["__scopeId","data-v-6a4e8216"]]),y4={name:"CacheManagementPage",components:{CacheManagement:p4},beforeCreate(){console.log("[CacheManagementPage] beforeCreate() called")},created(){console.log("[CacheManagementPage] created() called")},beforeMount(){console.log("[CacheManagementPage] beforeMount() called")},setup(){console.log("[CacheManagementPage] setup() called with new hierarchical UI");const o=Xe(),e=I(!1),s=I(null),t=()=>{o.push({name:"index"})};return $e(()=>{console.log("[CacheManagementPage] onMounted() called - hierarchical cache management ready")}),{loading:e,error:s,goBack:t}}},k4={class:"cache-management-page"},b4={class:"page-header"},_4={class:"page-header-top"},w4={key:0,class:"loading"},C4={key:1,class:"error"},T4={key:2,class:"cache-content"};function S4(o,e,s,t,r,i){const n=be("CacheManagement");return c(),u("div",k4,[a("div",b4,[a("div",_4,[a("button",{onClick:e[0]||(e[0]=(...l)=>t.goBack&&t.goBack(...l)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[a("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),a("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=a("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1))]),t.loading?(c(),u("div",w4," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–µ—à–∞... ")):t.error?(c(),u("div",C4,m(t.error),1)):(c(),u("div",T4,[ne(n)]))])}const D4=de(y4,[["render",S4],["__scopeId","data-v-a20ded38"]]),E4=[{path:"/install",name:"install",component:Uo},{path:"/",name:"index",component:Iw},{path:"/webhook-logs",name:"webhook-logs",redirect:"/admin/webhook-logs"},{path:"/admin/webhook-logs",name:"admin-webhook-logs",component:xS,meta:{requiresAuth:!0,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",adminOnly:!0}},{path:"/admin/users",name:"admin-users",component:_$,meta:{requiresAuth:!0,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",adminOnly:!0}},{path:"/admin/cache",name:"admin-cache",component:D4,meta:{requiresAuth:!0,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",adminOnly:!0}},{path:"/dashboard/sector-1c",name:"dashboard-sector-1c",component:()=>Se(()=>Promise.resolve().then(()=>Ha),void 0,import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector1c"}},{path:"/dashboard/sector-pdm",name:"dashboard-sector-pdm",component:()=>Se(()=>import("./SectorDashboardPDM.vue-DeaOFmgC.js"),__vite__mapDeps([10,7,4,2,3,0,1]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector-pdm"}},{path:"/dashboard/sector-bitrix24",name:"dashboard-sector-bitrix24",component:()=>Se(()=>import("./SectorDashboardBitrix24.vue-M63GU2uU.js"),__vite__mapDeps([11,7,4,2,3,0,1]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector-bitrix24"}},{path:"/dashboard/sector-infrastructure",name:"dashboard-sector-infrastructure",component:()=>Se(()=>import("./SectorDashboardInfrastructure.vue-CennPVwE.js"),__vite__mapDeps([12,7,4,2,3,0,1]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector-infrastructure"}},{path:"/dashboard/graph-admission-closure",name:"dashboard-graph-admission-closure",component:()=>Se(()=>Promise.resolve().then(()=>T0),void 0,import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–æ–≤—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",requiresAuth:!0,chunk:"admission-dashboard"}},{path:"/dashboard/graph-state",name:"dashboard-graph-state",component:()=>Se(()=>Promise.resolve().then(()=>bm),void 0,import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏",requiresAuth:!0,chunk:"graph-state"}},{path:"/dashboard/tickets-time-tracking",name:"dashboard-tickets-time-tracking",component:()=>Se(()=>Promise.resolve().then(()=>bl),void 0,import.meta.url),meta:{title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",requiresAuth:!0,chunk:"tickets-tracking"}}],ys=ro({history:io(),routes:E4});ys.beforeEach(async(o,e,s)=>{if(console.log("[Router] beforeEach:",{to:o.path,from:e.path,name:o.name}),o.meta.title&&(document.title=`${o.meta.title} - Bitrix24 Dashboard`),o.meta.requiresAuth){console.log("[Router] requiresAuth check for:",o.path);try{const t=await rt.checkAccess();if(!t.allowed){console.warn("Unauthorized access attempt to:",o.path,t.errorMessage),s({name:"index"});return}}catch(t){console.error("Error checking access in navigation guard:",t),s();return}}if(o.meta.adminOnly)try{const t=await rt.getCurrentUser();if(!t||!as(t)){console.warn("Admin access required for:",o.path),s({name:"index"});return}}catch(t){console.error("Error checking admin access in navigation guard:",t),s({name:"index"});return}if(e.name!==null&&o.path!==e.path)try{if((await rt.checkAccess()).allowed){const r=await rt.getCurrentUser();r&&cs.logPageVisit(o,r,e).catch(i=>{console.error("[Router] Error logging page visit:",i)})}}catch(t){console.error("[Router] Error in activity logging:",t)}if(o.name==="index"&&!e.name&&setTimeout(()=>{Se(()=>Promise.resolve().then(()=>Ha),void 0,import.meta.url)},1e3),o.meta.chunk)switch(o.meta.chunk){case"dashboard-sector1c":setTimeout(()=>{Se(()=>Promise.resolve().then(()=>yp),void 0,import.meta.url)},500);break;case"admission-dashboard":setTimeout(()=>{Se(()=>import("./chunk-D3JwNzSL.js").then(t=>t.l),__vite__mapDeps([3,4]),import.meta.url)},500);break}console.log("[Router] Allowing navigation to:",o.path),s()});setTimeout(()=>{const o=window.location.pathname,e=window.location.hash;e&&e!=="#/"||(o.includes("install.php")?ys.replace("/install"):ys.replace("/"))},0);class us{static startBundleLoad(){this.metrics.bundleLoadTime=performance.now()}static endBundleLoad(e){const s=performance.now()-this.metrics.bundleLoadTime;this.metrics.chunkLoadTimes.set(e,s),console.log(`üì¶ Chunk "${e}" loaded in ${s.toFixed(2)}ms`),window.gtag&&window.gtag("event","bundle_load",{chunk_name:e,load_time:s}),s>1e3&&console.warn(`üêå Slow chunk load: ${e} took ${s.toFixed(2)}ms`)}static trackComponentLoad(e,s){const t=performance.now()-s;this.metrics.componentLoadTime.set(e,t),console.log(`üß© Component "${e}" loaded in ${t.toFixed(2)}ms`),t>500&&console.warn(`üêå Slow component load: ${e} took ${t.toFixed(2)}ms`)}static trackApiCall(e,s){this.metrics.apiResponseTime.set(e,s),s>1e3&&console.warn(`üêå Slow API call to ${e}: ${s}ms`)}static getReport(){const e=Array.from(this.metrics.componentLoadTime.values()),s=Array.from(this.metrics.apiResponseTime.values()),t=Array.from(this.metrics.chunkLoadTimes.values());return{totalChunks:this.metrics.chunkLoadTimes.size,totalComponents:this.metrics.componentLoadTime.size,totalApiCalls:this.metrics.apiResponseTime.size,averageComponentLoadTime:e.length>0?e.reduce((r,i)=>r+i,0)/e.length:0,averageApiResponseTime:s.length>0?s.reduce((r,i)=>r+i,0)/s.length:0,averageChunkLoadTime:t.length>0?t.reduce((r,i)=>r+i,0)/t.length:0,slowestComponents:Array.from(this.metrics.componentLoadTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i})),slowestApiCalls:Array.from(this.metrics.apiResponseTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({endpoint:r,time:i})),slowestChunks:Array.from(this.metrics.chunkLoadTimes.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i}))}}static clearMetrics(){this.metrics.bundleLoadTime=0,this.metrics.componentLoadTime.clear(),this.metrics.apiResponseTime.clear(),this.metrics.chunkLoadTimes.clear()}}je(us,"metrics",{bundleLoadTime:0,componentLoadTime:new Map,apiResponseTime:new Map,chunkLoadTimes:new Map});class A4{static init(){this.initChunkLoadErrorHandling(),this.initUnhandledErrorHandling(),this.initNetworkErrorHandling()}static initChunkLoadErrorHandling(){if(window.addEventListener("error",e=>{e.target.tagName==="SCRIPT"&&(console.error("‚ùå Chunk loading error:",e.target.src),this.reportError("chunk_load_error",{url:e.target.src,message:e.message||"Script load failed"}))}),"PerformanceObserver"in window)try{new PerformanceObserver(s=>{for(const t of s.getEntries())if(t.entryType==="resource"&&t.name.includes(".js")){const r=t.responseEnd-t.requestStart;us.trackApiCall(t.name,r)}}).observe({entryTypes:["resource"]})}catch{console.warn("PerformanceObserver not supported")}}static initUnhandledErrorHandling(){window.addEventListener("unhandledrejection",e=>{console.error("‚ùå Unhandled promise rejection:",e.reason),this.reportError("unhandled_rejection",{reason:e.reason?.message||String(e.reason),stack:e.reason?.stack})}),window.addEventListener("error",e=>{e.error&&e.filename&&(console.error("‚ùå Unhandled error:",e.error),this.reportError("unhandled_error",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error.stack}))})}static initNetworkErrorHandling(){const e=window.fetch;window.fetch=function(...s){const t=performance.now();return e.apply(this,s).then(r=>{const i=performance.now()-t;return us.trackApiCall(s[0],i),r.ok||console.warn(`üö® API error: ${r.status} ${r.statusText} for ${s[0]}`),r}).catch(r=>{const i=performance.now()-t;throw console.error(`‚ùå Network error for ${s[0]}:`,r),us.trackApiCall(s[0],i),this.reportError("network_error",{url:s[0],message:r.message,loadTime:i}),r})}}static reportError(e,s){const t={type:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...s};if(console.error("üìä Error report:",t),window.Sentry&&window.Sentry.captureException(new Error(`${e}: ${JSON.stringify(s)}`)),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:"/api/log-error.php",method:"POST",data:t})}catch(r){console.error("Failed to send error report to Bitrix24:",r)}window.gtag&&window.gtag("event","exception",{description:`${e}: ${s.message||"Unknown error"}`,fatal:!1})}static getErrorStats(){return{chunkLoadErrors:0,networkErrors:0,unhandledErrors:0,totalErrors:0}}}const qs=lo(To);qs.use(ys);const $4=o=>{try{const e=new WeakSet;return JSON.stringify(o,(s,t)=>{if(typeof t=="object"&&t!==null){if(e.has(t))return"[Circular]";e.add(t)}return typeof t=="function"||t===void 0?null:t})}catch{return String(o)}};qs.config.errorHandler=(o,e,s)=>{if(o instanceof TypeError&&o.message.includes("Cannot read properties of undefined (reading 'type')")){console.warn("Caught undefined.type error:",{error:o.message,component:e?.$options?.name||"Unknown",info:s,stack:o.stack});return}if(console.error("Vue error:",o,s),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:et("/api/log-error.php"),method:"POST",data:{error:o?.message||String(o),info:typeof s=="string"?s:$4(s),component:e?.$options?.name||"Unknown"}})}catch(t){console.error("Failed to log error:",t)}};qs.mount("#app");A4.init();export{lr as S,de as _,xt as a,bt as b,J as c,Nw as d,Gs as e,Vt as f,C$ as g,gt as i,jt as n};
