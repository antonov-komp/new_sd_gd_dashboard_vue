var H=Object.defineProperty;var j=(r,e,s)=>e in r?H(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var _=(r,e,s)=>j(r,typeof e!="symbol"?e+"":e,s);import{g as y,j as C,c as S,e as a,a as z,b as E,t as g,E as $,M as V,n as q,h as x,u as J,i as K,r as W,o as f,F as X,y as Q,v as ee,K as M}from"./chunk-AO5BuqvF.js";import{D as te,u as se,a as ae,_ as re,B as oe}from"./main-N0cw6fmf.js";import{_ as F}from"./chunk-CcppLww_.js";import"./chunk-oAdZbKjt.js";import"./chunk-N3WVvGh9.js";import"./chunk-8gnzGOGs.js";import"./chunk-DPelsags.js";function ne(r){const e=y(!1),s=y(null),t=y(""),o=y({}),l=y([]),d=y({}),i=y([]),b=y({totalTickets:0,totalEmployees:0,activeStages:0,lastUpdated:null}),k=C(()=>l.value.length>0||i.value.length>0),w=C(()=>!k.value&&!e.value&&!s.value),D=C(()=>{const m=Object.values(d.value).reduce((T,O)=>T+(O?.length||0),0),p=l.value.reduce((T,O)=>T+(O.tickets?.length||0),0);return m+p}),I=C(()=>{if(!D.value)return 0;const p=[...Object.values(d.value).flat(),...l.value.flatMap(T=>T.tickets||[])].filter(T=>T.status==="closed"||T.status==="completed"||T.status==="done").length;return Math.round(p/D.value*100)}),v=(m,p="",T={})=>{e.value=m,t.value=p,o.value=T},N=m=>{s.value=m,e.value=!1},P=()=>{s.value=null},R=m=>{l.value=m},U=m=>{i.value=m},n=m=>{d.value=m},c=m=>{b.value={...b.value,...m,lastUpdated:new Date().toISOString()}},u=()=>{e.value=!1,s.value=null,t.value="",o.value={},l.value=[],d.value={},i.value=[],b.value={totalTickets:0,totalEmployees:0,activeStages:0,lastUpdated:null}},h=m=>l.value.find(p=>p.id===m);return{isLoading:e,error:s,currentStep:t,stepDetails:o,stages:l,zeroPointTickets:d,employees:i,sectorStats:b,hasData:k,isEmpty:w,totalTickets:D,completionRate:I,setLoading:v,setError:N,clearError:P,updateStages:R,updateEmployees:U,updateZeroPointTickets:n,updateSectorStats:c,resetState:u,getStageById:h,getEmployeeById:m=>i.value.find(p=>p.id===m),getStageTickets:m=>{const p=h(m);return p?p.tickets||[]:[]},getZeroPointTickets:m=>d.value[m]||[]}}class L{static normalizeSectorData(e,s){return e?{stages:this.normalizeStages(e.stages||[],s),employees:this.normalizeEmployees(e.employees||[],s),zeroPointTickets:this.normalizeTickets(e.zeroPointTickets||[],s),metrics:this.calculateMetrics(e,s),metadata:this.createMetadata(e,s)}:this.getEmptySectorData(s)}static normalizeStages(e,s){return Array.isArray(e)?e.map((t,o)=>{const l=s.stages?.[t.id]||{},d=o%this.STAGE_COLORS.length;return{id:t.id||`stage_${o}`,name:l.name||t.name||t.title||`–≠—Ç–∞–ø ${o+1}`,color:l.color||t.color||this.STAGE_COLORS[d],order:l.order||t.order||o,tickets:this.normalizeTickets(t.tickets||[],s),employees:this.normalizeEmployees(t.employees||[],s),metrics:this.calculateStageMetrics(t,s)}}).sort((t,o)=>(t.order||0)-(o.order||0)):[]}static normalizeEmployees(e,s){return Array.isArray(e)?e.map(t=>({id:t.id||t.ID||`emp_${Math.random()}`,name:this.normalizeEmployeeName(t),department:t.department||t.UF_DEPARTMENT||s.defaultDepartment||"Unknown",load:t.load||t.currentLoad||0,avatar:t.avatar||t.PERSONAL_PHOTO||null,status:t.status||t.ACTIVE||"active",color:this.assignEmployeeColor(t,s)})):[]}static normalizeTickets(e,s){return Array.isArray(e)?e.map(t=>({id:t.id||t.ID||`ticket_${Math.random()}`,title:this.normalizeTicketTitle(t),status:t.status||t.STATUS_ID||"new",priority:this.normalizePriority(t),assignedTo:t.assignedTo||t.ASSIGNED_BY_ID||t.assigned_to,createdAt:this.normalizeDate(t.createdAt||t.CREATED_DATE||t.DATE_CREATE),updatedAt:this.normalizeDate(t.updatedAt||t.UPDATED_DATE||t.TIMESTAMP_X),deadline:this.normalizeDate(t.deadline||t.DEADLINE),tags:this.extractTags(t,s),description:t.description||t.DETAIL_TEXT||t.COMMENTS||""})):[]}static normalizeEmployeeName(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫";const s=e.LAST_NAME||e.lastName||"",t=e.NAME||e.firstName||e.FIRST_NAME||"",o=`${s} ${t}`.trim();return o&&o!==" "?o:t||(e.LOGIN||e.login?e.LOGIN||e.login:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${e.id||e.ID||"unknown"}`)}static normalizeTicketTitle(e){return e.title||e.TITLE||e.name||e.NAME||e.subject||e.SUBJECT||`–¢–∏–∫–µ—Ç ${e.id||e.ID||"–±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}`}static normalizePriority(e){const s=e.priority||e.PRIORITY;return typeof s=="number"?Math.max(1,Math.min(5,s)):typeof s=="string"&&{low:1,lowest:1,normal:3,medium:3,high:4,highest:5,urgent:5,critical:5}[s.toLowerCase()]||3}static normalizeDate(e){if(!e)return null;try{const s=new Date(e);return isNaN(s.getTime())?null:s.toISOString()}catch{return null}}static extractTags(e,s){const t=[];return e.UF_CRM_7_TYPE_PRODUCT&&t.push(e.UF_CRM_7_TYPE_PRODUCT),(e.category||e.CATEGORY)&&t.push(e.category||e.CATEGORY),(e.type||e.TYPE)&&t.push(e.type||e.TYPE),e.priority&&typeof e.priority=="string"&&t.push(`priority:${e.priority}`),[...new Set(t)]}static assignEmployeeColor(e,s){const t=["#007bff","#28a745","#ffc107","#dc3545","#6c757d","#17a2b8"];if(e.department){const l=e.department.split("").reduce((d,i)=>(d=(d<<5)-d+i.charCodeAt(0),d&d),0);return t[Math.abs(l)%t.length]}const o=e.id||e.ID||0;return t[Math.abs(o)%t.length]}static calculateStageMetrics(e,s){const t=e.tickets||[],o=e.employees||[];return{ticketCount:t.length,employeeCount:o.length,averageLoad:o.length>0?t.length/o.length:0,completionRate:this.calculateCompletionRate(t),overdueCount:this.countOverdueTickets(t)}}static calculateMetrics(e,s){const t=[...e.zeroPointTickets||[],...(e.stages||[]).flatMap(i=>i.tickets||[])],o=t.length,l=e.employees?.length||0,d=(e.stages||[]).filter(i=>(i.tickets||[]).length>0).length;return{totalTickets:o,totalEmployees:l,activeStages:d,averageTicketsPerEmployee:l>0?o/l:0,completionRate:this.calculateCompletionRate(t),overdueCount:this.countOverdueTickets(t)}}static calculateCompletionRate(e){if(!e.length)return 0;const s=e.filter(t=>t.status==="closed"||t.status==="completed"||t.status==="done").length;return Math.round(s/e.length*100)}static countOverdueTickets(e){const s=new Date;return e.filter(t=>t.deadline?new Date(t.deadline)<s&&t.status!=="closed"&&t.status!=="completed":!1).length}static createMetadata(e,s){return{sectorId:s.id,sectorName:s.name,lastUpdated:new Date().toISOString(),dataVersion:"2.0",source:"universal-normalizer"}}static getEmptySectorData(e){return{stages:[],employees:[],zeroPointTickets:[],metrics:{totalTickets:0,totalEmployees:0,activeStages:0,averageTicketsPerEmployee:0,completionRate:0,overdueCount:0},metadata:this.createMetadata({},e)}}}_(L,"STAGE_COLORS",["#007bff","#ffc107","#28a745","#dc3545","#6c757d","#17a2b8","#e83e8c","#fd7e14"]);class B{constructor(e,s){this.sectorId=e,this.sectorConfig=s}async getSectorData(e={}){return L.getEmptySectorData({id:this.sectorId,name:this.sectorConfig.name||this.sectorId,defaultDepartment:"Unknown"})}async updateTicketAssignment(e,s,t){return console.log(`[Stub:${this.sectorId}] updateTicketAssignment called:`,{ticketId:e,stageId:s,employeeId:t}),{success:!0,message:"Stub implementation - no real action taken"}}async createTicket(e){return console.log(`[Stub:${this.sectorId}] createTicket called:`,e),{id:`stub_${Date.now()}`,title:e.title||"Stub ticket",status:"new",createdAt:new Date().toISOString()}}}class ie extends B{constructor(){super("pdm",{id:"pdm",name:"–°–µ–∫—Ç–æ—Ä PDM",filterField:"UF_CRM_7_TYPE_PRODUCT",filterValue:"PDM",stages:{design:{name:"–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",color:"#17a2b8",order:1},review:{name:"–ü—Ä–æ–≤–µ—Ä–∫–∞",color:"#ffc107",order:2},implementation:{name:"–í–Ω–µ–¥—Ä–µ–Ω–∏–µ",color:"#28a745",order:3}}})}async getSectorData(e={}){console.log("[SectorPDMService] getSectorData called with options:",e);const s={stages:[{id:"design",name:"–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",color:"#17a2b8",tickets:[{id:"pdm-1",title:"–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è –æ—Ç—á–µ—Ç–æ–≤",status:"in_progress",assignedTo:"user1"},{id:"pdm-2",title:"–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π",status:"completed",assignedTo:"user2"}],employees:[{id:"user1",name:"–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",department:"PDM"},{id:"user2",name:"–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞",department:"PDM"}]},{id:"review",name:"–ü—Ä–æ–≤–µ—Ä–∫–∞",color:"#ffc107",tickets:[{id:"pdm-3",title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞",status:"in_progress",assignedTo:"user3"}],employees:[{id:"user3",name:"–ê–ª–µ–∫—Å–µ–π –°–∏–¥–æ—Ä–æ–≤",department:"PDM"}]},{id:"implementation",name:"–í–Ω–µ–¥—Ä–µ–Ω–∏–µ",color:"#28a745",tickets:[],employees:[]}],employees:[{id:"user1",name:"–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",department:"PDM"},{id:"user2",name:"–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞",department:"PDM"},{id:"user3",name:"–ê–ª–µ–∫—Å–µ–π –°–∏–¥–æ—Ä–æ–≤",department:"PDM"}],zeroPointTickets:[],metadata:{sectorId:"pdm",lastUpdated:new Date().toISOString()}};return console.log("[SectorPDMService] Returning test data:",{stages:s.stages?.length||0,employees:s.employees?.length||0,totalTickets:s.stages?.reduce((t,o)=>t+(o.tickets?.length||0),0)||0}),s}}class ce extends B{constructor(){super("bitrix24",{id:"bitrix24",name:"–°–µ–∫—Ç–æ—Ä –ë–∏—Ç—Ä–∏–∫—Å24",filterField:"UF_CRM_7_TYPE_PRODUCT",filterValue:"Bitrix24",stages:{analysis:{name:"–ê–Ω–∞–ª–∏–∑",color:"#007bff",order:1},development:{name:"–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞",color:"#ffc107",order:2},testing:{name:"–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",color:"#28a745",order:3},deployment:{name:"–í–Ω–µ–¥—Ä–µ–Ω–∏–µ",color:"#6c757d",order:4}}})}}class le extends B{constructor(){super("infrastructure",{id:"infrastructure",name:"–°–µ–∫—Ç–æ—Ä –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞",filterField:"UF_CRM_7_TYPE_PRODUCT",filterValues:["–ñ–µ–ª–µ–∑–æ","–ü—Ä–æ—á–µ–µ"],stages:{request:{name:"–ó–∞—è–≤–∫–∞",color:"#6c757d",order:1},assessment:{name:"–û—Ü–µ–Ω–∫–∞",color:"#ffc107",order:2},procurement:{name:"–ó–∞–∫—É–ø–∫–∞",color:"#17a2b8",order:3},deployment:{name:"–í–Ω–µ–¥—Ä–µ–Ω–∏–µ",color:"#28a745",order:4}}})}}class de{static create(e){const t={pdm:()=>new ie,bitrix24:()=>new ce,infrastructure:()=>new le}[e];if(!t)throw new Error(`No stub service available for sector: ${e}`);return t()}static isStubAvailable(e){return["pdm","bitrix24","infrastructure"].includes(e)}}class Y{static create(e){if(this.serviceCache.has(e))return this.serviceCache.get(e);const s=this.createServiceInstance(e);return this.serviceCache.set(e,s),s}static createServiceInstance(e){switch(e){case"1c":return console.log("[SectorServiceFactory] Creating DashboardSector1CService for sector 1c"),new te;case"pdm":case"bitrix24":case"infrastructure":return console.log(`[SectorServiceFactory] Creating stub service for sector ${e}`),de.create(e);default:throw new Error(`Unknown sector: ${e}`)}}static isServiceAvailable(e){return["1c","pdm","bitrix24","infrastructure"].includes(e)}static clearCache(){this.serviceCache.clear(),console.log("[SectorServiceFactory] Service cache cleared")}static getAvailableServices(){return{"1c":{type:"full",description:"–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å–µ–∫—Ç–æ—Ä–∞ 1–°"},pdm:{type:"stub",description:"–ó–∞–≥–ª—É—à–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ —Å–µ–∫—Ç–æ—Ä–∞ PDM"},bitrix24:{type:"stub",description:"–ó–∞–≥–ª—É—à–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ —Å–µ–∫—Ç–æ—Ä–∞ –ë–∏—Ç—Ä–∏–∫—Å24"},infrastructure:{type:"stub",description:"–ó–∞–≥–ª—É—à–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ —Å–µ–∫—Ç–æ—Ä–∞ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞"}}}}_(Y,"serviceCache",new Map);class ue{constructor(e){this.sectorId=e,this.sectorService=null,this.cache=new Map,this.initialize()}async initialize(){try{this.sectorService=Y.create(this.sectorId),console.log(`[UniversalSectorDashboardService] Initialized for sector: ${this.sectorId}`)}catch(e){throw console.error(`[UniversalSectorDashboardService] Failed to initialize for sector ${this.sectorId}:`,e),e}}async getSectorDashboardData(e={}){const s=`dashboard:${this.sectorId}:${JSON.stringify(e)}`;if(!e.forceRefresh&&this.cache.has(s))return console.log(`[UniversalSectorDashboardService] Cache hit for dashboard data: ${this.sectorId}`),this.cache.get(s);try{console.log(`[UniversalSectorDashboardService] Loading dashboard data for sector: ${this.sectorId}`);const t=await this.sectorService.getSectorData(e),o=this.normalizeSectorDataToDashboard(t);return this.cache.set(s,o),setTimeout(()=>{this.cache.delete(s)},5*60*1e3),console.log(`[UniversalSectorDashboardService] Returning dashboard data for ${this.sectorId}:`,{stages:o.stages?.length||0,employees:o.employees?.length||0,totalTickets:o.metadata?.totalTickets||0}),o}catch(t){throw console.error(`[UniversalSectorDashboardService] Failed to get dashboard data for ${this.sectorId}:`,t),t}}normalizeSectorDataToDashboard(e){const s=L.normalizeSectorData(e,{id:this.sectorId});return{stages:this.convertStagesToDashboardFormat(s.stages),employees:s.employees,zeroPointTickets:this.extractZeroPointTickets(s),metadata:{sectorId:this.sectorId,totalTickets:s.metrics?.totalTickets||0,totalEmployees:s.employees?.length||0,lastUpdated:new Date().toISOString()}}}convertStagesToDashboardFormat(e){return e.map(s=>({id:this.mapStageIdToDashboardId(s.id),name:s.name,color:s.color||"#666",employees:s.employees||[],tickets:s.tickets||[],metrics:{ticketCount:s.tickets?.length||0,employeeCount:s.employees?.length||0}}))}mapStageIdToDashboardId(e){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution",formed:"formed",review:"review",execution:"execution",request:"formed",assessment:"review",deployment:"execution"}[e]||e}extractZeroPointTickets(e){const s={};return e.stages.forEach(t=>{const o=this.mapStageIdToDashboardId(t.id),l=t.tickets.filter(d=>!d.assignedTo||d.assignedTo===null||d.assignedTo==="");s[o]=l}),s}async updateTicketAssignment(e,s,t){try{const o=this.mapDashboardIdToStageId(s),l=await this.sectorService.updateTicketAssignment(e,o,t);return this.clearCache(),l}catch(o){throw console.error("[UniversalSectorDashboardService] Failed to update ticket assignment:",o),o}}mapDashboardIdToStageId(e){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[e]||e}clearCache(){this.cache.clear(),console.log(`[UniversalSectorDashboardService] Cache cleared for sector: ${this.sectorId}`)}async createTicket(e){try{const s=await this.sectorService.createTicket({...e,sectorId:this.sectorId});return this.clearCache(),s}catch(s){throw console.error("[UniversalSectorDashboardService] Failed to create ticket:",s),s}}async getSectorStats(){try{const e=await this.getSectorDashboardData();return{totalTickets:e.metadata.totalTickets,totalEmployees:e.metadata.totalEmployees,stagesCount:e.stages.length,unassignedTickets:Object.values(e.zeroPointTickets).reduce((s,t)=>s+t.length,0),lastUpdated:e.metadata.lastUpdated}}catch(e){throw console.error("[UniversalSectorDashboardService] Failed to get sector stats:",e),e}}}class Z{static getService(e){return this.services.has(e)||this.services.set(e,new ue(e)),this.services.get(e)}static clearAll(){this.services.clear()}}_(Z,"services",new Map);function me(r,e){const s=ae();se();let t=null;const o=()=>(t||(t=Z.getService(e)),t),l=async(n={})=>{try{r.setLoading(!0,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞..."),r.clearError();const u=await o().getSectorDashboardData(n);r.updateStages(u.stages),r.updateEmployees(u.employees),r.updateZeroPointTickets(u.zeroPointTickets),r.updateSectorStats({totalTickets:u.metadata.totalTickets,totalEmployees:u.metadata.totalEmployees,activeStages:u.stages.length,lastUpdated:u.metadata.lastUpdated}),s.success("–î–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${u.metadata.totalTickets} —Ç–∏–∫–µ—Ç–æ–≤`)}catch(c){throw console.error(`[useUniversalDashboardActions] Failed to load sector data for ${e}:`,c),r.setError(c.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞"),s.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",c.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞"),c}finally{r.setLoading(!1)}},d=async(n,c,u=null)=>{try{await o().updateTicketAssignment(n,c,u),s.success("–¢–∏–∫–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω","–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–æ"),await l({forceRefresh:!0})}catch(h){throw console.error("[useUniversalDashboardActions] Failed to update ticket assignment:",h),s.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",h.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞"),h}},i=async n=>{try{const u=await o().createTicket(n);return s.success("–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω",`–¢–∏–∫–µ—Ç "${u.title}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`),await l({forceRefresh:!0}),u}catch(c){throw console.error("[useUniversalDashboardActions] Failed to create ticket:",c),s.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è",c.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç"),c}},b=async(n,c,u=null)=>{try{if(!P(n,c))throw new Error("–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ");await d(n.id,c,u),s.success("–¢–∏–∫–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω",`–¢–∏–∫–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω –Ω–∞ —ç—Ç–∞–ø "${U(c)}"`)}catch(h){throw console.error("[useUniversalDashboardActions] Failed to move ticket:",h),s.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è",h.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–∫–µ—Ç"),h}},k=async(n,c)=>{try{const u=o(),h=R(n);if(!h)throw new Error("–¢–∏–∫–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");await u.updateTicketAssignment(n,h.stageId,c);const A=r.getEmployeeById(c),G=A?A.name:"—Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É";s.success("–¢–∏–∫–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω",`–¢–∏–∫–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω ${G}`),await l({forceRefresh:!0})}catch(u){throw console.error("[useUniversalDashboardActions] Failed to assign ticket:",u),s.error("–û—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è",u.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–∑–Ω–∞—á–∏—Ç—å —Ç–∏–∫–µ—Ç"),u}},w=async()=>{try{o().clearCache(),s.success("–ö–µ—à –æ—á–∏—â–µ–Ω","–ö–µ—à —Å–µ–∫—Ç–æ—Ä–∞ —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω"),await l({forceRefresh:!0})}catch(n){throw console.error("[useUniversalDashboardActions] Failed to clear cache:",n),s.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏",n.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à"),n}},D=async()=>{try{return await o().getSectorStats()}catch(n){throw console.error("[useUniversalDashboardActions] Failed to get sector stats:",n),n}},I=()=>{F(async()=>{const{useRouter:n}=await import("./chunk-AO5BuqvF.js").then(c=>c.a6);return{useRouter:n}},[],import.meta.url).then(({useRouter:n})=>{n().push("/graph/state")}).catch(n=>{console.error("Failed to navigate to graph state:",n)})},v=()=>{F(async()=>{const{useRouter:n}=await import("./chunk-AO5BuqvF.js").then(c=>c.a6);return{useRouter:n}},[],import.meta.url).then(({useRouter:n})=>{n().push("/graph/admission-closure")}).catch(n=>{console.error("Failed to navigate to admission closure:",n)})},N=()=>{F(async()=>{const{useRouter:n}=await import("./chunk-AO5BuqvF.js").then(c=>c.a6);return{useRouter:n}},[],import.meta.url).then(({useRouter:n})=>{n().push("/tickets/time-tracking")}).catch(n=>{console.error("Failed to navigate to tickets management:",n)})},P=(n,c)=>!(!n||!c||n.stageId===c),R=n=>{for(const c of r.stages){const u=c.tickets?.find(h=>h.id===n);if(u)return{...u,stageId:c.id}}for(const[c,u]of Object.entries(r.zeroPointTickets)){const h=u.find(A=>A.id===n);if(h)return{...h,stageId:c}}return null},U=n=>{const c=r.getStageById(n);return c?c.name:n};return{loadSectorData:l,updateTicketAssignment:d,createTicket:i,moveTicket:b,assignTicketToEmployee:k,clearCache:w,getSectorStats:D,navigateToGraphState:I,navigateToAdmissionClosure:v,navigateToTicketsManagement:N,canMoveTicket:P,findTicket:R,getStageName:U}}const ge={name:"SectorDashboard",components:{BackButton:oe},props:{sectorId:{type:String,required:!0,validator:r=>["1c","pdm","bitrix24","infrastructure"].includes(r)}},setup(r){const e=J();K();const s=ne(r.sectorId),t=me(s,r.sectorId),o=y(null),l=y(null),d=C(()=>({"1c":"1–°",pdm:"PDM",bitrix24:"–ë–∏—Ç—Ä–∏–∫—Å24",infrastructure:"–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞"})[r.sectorId]||r.sectorId),i=C(()=>(o.value,!1)),b=()=>{e.push("/")},k=()=>{t.loadSectorData({forceRefresh:!0})},w=()=>{t.navigateToGraphState()},D=()=>{t.navigateToAdmissionClosure()},I=()=>{t.navigateToTicketsManagement()};return x(async()=>{console.log(`[SectorDashboard] üöÄ Mounted for sector: ${r.sectorId} (${d.value})`);try{console.log(`[SectorDashboard] üì° Starting data load for sector: ${r.sectorId}`),await t.loadSectorData(),console.log(`[SectorDashboard] ‚úÖ Data loaded successfully for sector: ${r.sectorId}`,{hasData:s.hasData,totalTickets:s.totalTickets,stagesCount:s.stages.length,employeesCount:s.employees.length,completionRate:s.completionRate,stages:s.stages.map(v=>({id:v.id,name:v.name,ticketsCount:v.tickets?.length||0})),renderingCondition:!s.isLoading&&!s.error,stagesLength:s.stages.length})}catch(v){console.error(`[SectorDashboard] ‚ùå Failed to load initial data for sector ${r.sectorId}:`,v),console.log("[SectorDashboard] üîç Error details:",{message:v.message,stack:v.stack})}}),{...s,...t,sectorName:d,currentUser:o,draggedTicket:l,isUserAdmin:i,handleGoHome:b,handleRetry:k,navigateToGraphState:w,navigateToAdmissionClosure:D,navigateToTicketsManagement:I,getZeroPointTickets:s.getZeroPointTickets}}},he={class:"dashboard-header"},ve={class:"breadcrumbs-row"},pe={class:"breadcrumb-current"},Te={class:"header-actions"},Se={class:"sector-stats"},fe={class:"stat-item"},ye={class:"stat-value"},be={class:"stat-item"},De={class:"stat-value"},ke={class:"stat-item"},Ee={class:"stat-value"},Ce={class:"stat-item"},we={class:"stat-value"},Ie={key:0,class:"loading-container"},Ae={key:0,class:"error-message"},Me={key:0,class:"error-message-container"},Pe={class:"error-message"},Re={class:"error-header"},Ue={class:"error-text"},_e={class:"error-actions"},ze={key:0,class:"dashboard-content"},Ne={style:{background:"#f0f0f0",padding:"10px","margin-bottom":"20px","font-size":"12px"}},Oe={key:0,class:"stages-container"},Fe={class:"stage-header"},Le={class:"stage-stats"},Be={class:"stat"},Ge={class:"stat"},$e={key:1,class:"empty-state"},Ve={class:"empty-state-content"},Ye={class:"sector-info"};function Ze(r,e,s,t,o,l){const d=W("BackButton");return f(),S("div",{class:q(`dashboard-sector-${s.sectorId} ${t.draggedTicket?"is-dragging":""}`)},[a("div",he,[a("div",ve,[a("button",{class:"btn-home-link",type:"button",onClick:e[0]||(e[0]=(...i)=>t.handleGoHome&&t.handleGoHome(...i)),title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),e[10]||(e[10]=a("span",{class:"breadcrumb-separator"},"/",-1)),a("span",pe,"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ "+g(t.sectorName),1)]),z(d,{variant:"header"}),a("h1",null,"–î–∞—à–±–æ—Ä–¥ - –°–µ–∫—Ç–æ—Ä "+g(t.sectorName),1),a("div",Te,[r.isDiagnosticsEnabled&&t.isUserAdmin?(f(),S("button",{key:0,onClick:e[1]||(e[1]=(...i)=>r.clearCache&&r.clearCache(...i)),class:"btn-clear-cache",title:"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à —Å–µ–∫—Ç–æ—Ä–∞ –∏ —Ç–∏–∫–µ—Ç–æ–≤"},[...e[11]||(e[11]=[a("span",{class:"icon"},"‚ôªÔ∏è",-1),a("span",null,"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à",-1)])])):E("",!0),!r.isDiagnosticsEnabled&&t.isUserAdmin?(f(),S("button",{key:1,onClick:e[2]||(e[2]=(...i)=>r.enableDiagnostics&&r.enableDiagnostics(...i)),class:"btn-enable-diagnostics",title:"–í–∫–ª—é—á–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º"},[...e[12]||(e[12]=[a("span",{class:"icon"},"üîç",-1),a("span",null,"–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",-1)])])):E("",!0),a("button",{onClick:e[3]||(e[3]=(...i)=>t.navigateToGraphState&&t.navigateToGraphState(...i)),class:"btn-navigate-graph-state",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞"},[...e[13]||(e[13]=[a("span",{class:"icon"},"üìä",-1),a("span",null,"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",-1)])]),a("button",{onClick:e[4]||(e[4]=(...i)=>t.navigateToAdmissionClosure&&t.navigateToAdmissionClosure(...i)),class:"btn-navigate-admission-closure",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É –ø—Ä–∏–µ–º–∫–∏-–∑–∞–∫—Ä—ã—Ç–∏—è"},[...e[14]||(e[14]=[a("span",{class:"icon"},"üìà",-1),a("span",null,"–ü—Ä–∏–µ–º–∫–∞-–∑–∞–∫—Ä—ã—Ç–∏–µ",-1)])]),a("button",{onClick:e[5]||(e[5]=(...i)=>t.navigateToTicketsManagement&&t.navigateToTicketsManagement(...i)),class:"btn-navigate-tickets",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ç–∏–∫–µ—Ç–∞–º–∏"},[...e[15]||(e[15]=[a("span",{class:"icon"},"üìã",-1),a("span",null,"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏",-1)])])])]),a("div",Se,[a("div",fe,[a("div",ye,g(r.totalTickets),1),e[16]||(e[16]=a("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤",-1))]),a("div",be,[a("div",De,g(r.employees.length),1),e[17]||(e[17]=a("div",{class:"stat-label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",-1))]),a("div",ke,[a("div",Ee,g(r.completionRate)+"%",1),e[18]||(e[18]=a("div",{class:"stat-label"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ",-1))]),a("div",Ce,[a("div",we,g(r.stages.length),1),e[19]||(e[19]=a("div",{class:"stat-label"},"–≠—Ç–∞–ø–æ–≤",-1))])]),z(V,{name:"fade",mode:"out-in"},{default:$(()=>[r.isLoading?(f(),S("div",Ie,[e[20]||(e[20]=a("div",{class:"loading-spinner"},null,-1)),a("p",null,g(r.currentStep||"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞..."),1),r.error?(f(),S("div",Ae,[a("p",null,g(r.error),1),a("button",{onClick:e[6]||(e[6]=(...i)=>t.handleRetry&&t.handleRetry(...i)),class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):E("",!0)])):E("",!0)]),_:1}),r.error&&!r.isLoading?(f(),S("div",Me,[a("div",Pe,[a("div",Re,[e[21]||(e[21]=a("span",{class:"error-icon"},"‚ùå",-1)),e[22]||(e[22]=a("h3",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞",-1)),a("button",{onClick:e[7]||(e[7]=(...i)=>r.handleErrorClose&&r.handleErrorClose(...i)),class:"error-close","aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"‚úï")]),a("p",Ue,g(r.error),1),a("div",_e,[a("button",{onClick:e[8]||(e[8]=(...i)=>t.handleRetry&&t.handleRetry(...i)),class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É")])])])):E("",!0),z(V,{name:"dashboard-fade"},{default:$(()=>[!r.isLoading&&!r.error?(f(),S("div",ze,[a("div",Ne," DEBUG: stages.length = "+g(r.stages.length)+", isLoading = "+g(r.isLoading)+", error = "+g(r.error),1),r.stages.length>0?(f(),S("div",Oe,[(f(!0),S(X,null,Q(r.stages,i=>(f(),S("div",{key:i.id,class:"stage-card",style:ee({borderLeftColor:i.color})},[a("div",Fe,[a("h3",null,g(i.name),1),a("div",Le,[a("span",Be,g(i.tickets?.length||0)+" —Ç–∏–∫–µ—Ç–æ–≤",1),a("span",Ge,g(i.employees?.length||0)+" —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",1)])]),e[23]||(e[23]=a("div",{class:"stage-content"},[a("p",null,"–≠—Ç–∞–ø—ã —Å–µ–∫—Ç–æ—Ä–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ")],-1))],4))),128))])):(f(),S("div",$e,[a("div",Ve,[e[30]||(e[30]=a("div",{class:"empty-icon"},"üìã",-1)),a("h3",null,'–°–µ–∫—Ç–æ—Ä "'+g(t.sectorName)+'" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ',1),e[31]||(e[31]=a("p",null,"–≠—Ç–æ—Ç —Å–µ–∫—Ç–æ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.",-1)),a("div",Ye,[e[29]||(e[29]=a("h4",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ–∫—Ç–æ—Ä–µ:",-1)),a("ul",null,[a("li",null,[e[24]||(e[24]=a("strong",null,"ID:",-1)),M(" "+g(s.sectorId),1)]),a("li",null,[e[25]||(e[25]=a("strong",null,"–ù–∞–∑–≤–∞–Ω–∏–µ:",-1)),M(" "+g(t.sectorName),1)]),a("li",null,[e[26]||(e[26]=a("strong",null,"–≠—Ç–∞–ø–æ–≤:",-1)),M(" "+g(r.stages.length),1)]),a("li",null,[e[27]||(e[27]=a("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",-1)),M(" "+g(r.employees.length),1)]),a("li",null,[e[28]||(e[28]=a("strong",null,"–¢–∏–∫–µ—Ç–æ–≤:",-1)),M(" "+g(r.totalTickets),1)])])]),a("button",{onClick:e[9]||(e[9]=(...i)=>t.handleRetry&&t.handleRetry(...i)),class:"btn-retry"},"–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ")])]))])):E("",!0)]),_:1}),z(d,{variant:"floating"})],2)}const et=re(ge,[["render",Ze],["__scopeId","data-v-d759f5e3"]]);export{et as default};
