const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./main-Cg0OT6a2.js","./main-BHtrLvUz.css"])))=>i.map(i=>d[i]);
import{a0 as ce,a1 as ve,_ as ae,c as N,a as r,o,b as e,t as i,F as I,e as A,n as H,y as S,i as oe,Z as M,g as W,G as re,f as te,d as U,j as G,k as J,B as ie,T as pe,a6 as ye,I as _e,m as be,z as fe,r as ge}from"./main-Cg0OT6a2.js";const de="/api/tickets-time-tracking-sector-1c.php";function we(s){var T,p,d,g,u;if(!s)return{meta:null,data:{totalElapsedTime:0,totalElapsedTimeUnit:"hours",totalRecordsCount:0,weeks:[],employeesSummary:[]}};const b=s.data||s.result||s,a=b.meta||s.meta||null;return{meta:{weekNumber:(a==null?void 0:a.weekNumber)??null,weekStartUtc:(a==null?void 0:a.weekStartUtc)??null,weekEndUtc:(a==null?void 0:a.weekEndUtc)??null,totalWeeks:(a==null?void 0:a.totalWeeks)??0,sector1CEmployeesCount:(a==null?void 0:a.sector1CEmployeesCount)??0},data:{totalElapsedTime:((T=b.data)==null?void 0:T.totalElapsedTime)??b.totalElapsedTime??0,totalElapsedTimeUnit:((p=b.data)==null?void 0:p.totalElapsedTimeUnit)??b.totalElapsedTimeUnit??"hours",totalRecordsCount:((d=b.data)==null?void 0:d.totalRecordsCount)??b.totalRecordsCount??0,weeks:((g=b.data)==null?void 0:g.weeks)??b.weeks??[],employeesSummary:((u=b.data)==null?void 0:u.employeesSummary)??b.employeesSummary??[]}}}async function Te(s={}){const{product:b="1C",weekStartUtc:a=null,weekEndUtc:T=null,weeksCount:p=4}=s;try{const d=ce(de),g=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:b,weekStartUtc:a,weekEndUtc:T,weeksCount:p})});if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);const u=await g.json();if(u.error)throw new Error(u.error_description||u.error||"Unknown error");const v=we(u);if(u.cache_used===!0){const{CacheNotificationService:j}=await ve(async()=>{const{CacheNotificationService:q}=await import("./main-Cg0OT6a2.js").then(O=>O.ap);return{CacheNotificationService:q}},__vite__mapDeps([0,1]),import.meta.url);j.notifyCacheUsed("–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°")}return v}catch(d){throw console.error("[TimeTrackingService] Error fetching time tracking data:",d),d}}async function he({taskIds:s,employeeId:b,weekNumber:a,page:T=1,perPage:p=10}){if(!s||!Array.isArray(s)||s.length===0)return{tasks:[],pagination:{totalTasks:0,currentPage:1,perPage:p,totalPages:0}};try{const d=ce(de),g=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:"1C",includeTaskDetails:!0,taskIds:s,employeeId:b||void 0,weekNumber:a||void 0,page:T,perPage:p})});if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);const u=await g.json();if(!u.success)throw new Error(u.error||u.error_description||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–¥–∞—á–∞—Ö");return{tasks:u.data.tasks||[],pagination:u.data.pagination||{totalTasks:0,currentPage:1,perPage:p,totalPages:0}}}catch(d){throw console.error("[timeTrackingService] Error loading tasks details:",d),d}}const ue={getTimeTrackingData:Te,getTasksDetails:he};function P(s,b=1){return typeof s!="number"||isNaN(s)?"0 —á":`${s.toFixed(b)} —á`}function ee(s,b){if(!s||!b)return`–ù–µ–¥–µ–ª—è ${s||"?"}`;try{const a=new Date(b),T=new Date(a);T.setDate(T.getDate()+6);const p=a.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}),d=T.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"});return`–ù–µ–¥–µ–ª—è ${s} (${p} - ${d})`}catch(a){return console.error("[TimeTrackingUtils] Error formatting week label:",a),`–ù–µ–¥–µ–ª—è ${s}`}}function De(s){return!s||!s.data?!1:s.data.totalRecordsCount>0||s.data.weeks&&s.data.weeks.length>0}const Ce={class:"ttt-summary"},$e={class:"summary-cards"},Ne={class:"summary-card summary-card--total"},Pe={class:"summary-card__content"},Ee={class:"summary-card__value"},Se={class:"summary-card summary-card--employees"},Ue={class:"summary-card__content"},We={class:"summary-card__value"},Me={class:"summary-card summary-card--average"},xe={class:"summary-card__content"},Le={class:"summary-card__value"},Ie={__name:"TicketsTimeTrackingSummary",props:{data:{type:Object,required:!0}},setup(s){const b=s,a=N(()=>{var u,v;return((v=(u=b.data)==null?void 0:u.data)==null?void 0:v.totalElapsedTime)||0}),T=N(()=>{var u,v;return((v=(u=b.data)==null?void 0:u.meta)==null?void 0:v.sector1CEmployeesCount)||0}),p=N(()=>{const u=a.value,v=T.value;return v>0?u/v:0}),d=N(()=>a.value===0?"0.0 —á":P(a.value,1)),g=N(()=>p.value===0?"0.00 —á":P(p.value,2));return(u,v)=>(o(),r("div",Ce,[e("div",$e,[e("div",Ne,[v[1]||(v[1]=e("div",{class:"summary-card__icon"},"‚è±",-1)),e("div",Pe,[v[0]||(v[0]=e("div",{class:"summary-card__label"},"–û–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç",-1)),e("div",Ee,i(d.value),1)])]),e("div",Se,[v[3]||(v[3]=e("div",{class:"summary-card__icon"},"üë•",-1)),e("div",Ue,[v[2]||(v[2]=e("div",{class:"summary-card__label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ —Å–µ–∫—Ç–æ—Ä–µ",-1)),e("div",We,i(T.value),1)])]),e("div",Me,[v[5]||(v[5]=e("div",{class:"summary-card__icon"},"üìä",-1)),e("div",xe,[v[4]||(v[4]=e("div",{class:"summary-card__label"},"–°—Ä–µ–¥–Ω—è—è –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞",-1)),e("div",Le,i(g.value),1)])])])]))}},Ae=ae(Ie,[["__scopeId","data-v-51b124c7"]]),Oe={class:"ttt-table-container"},Re={key:0,class:"ttt-table-loading"},je={key:1,class:"ttt-table-error"},Be={key:2,class:"ttt-table-empty"},Ve={key:3,class:"ttt-table-wrapper"},Fe={class:"ttt-table"},ze=["onClick"],qe={class:"ttt-table__header-week-date"},He=["onClick"],Ge={class:"ttt-table__cell-employee"},Je=["onClick"],Ke={class:"ttt-table__cell-total"},Ze={class:"ttt-table__row-total"},Qe=["onClick"],Xe={class:"ttt-table__cell-total"},Ye={__name:"TicketsTimeTrackingTable",props:{data:{type:Object,required:!0},loading:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["cell-click","employee-click","week-click"],setup(s,{emit:b}){const a=s,T=b,p=N(()=>{var w,c;return((c=(w=a.data)==null?void 0:w.data)==null?void 0:c.weeks)||[]}),d=N(()=>{if(!a.data||!a.data.data||!a.data.data.weeks)return null;const w=a.data.data.weeks||[],k=(a.data.data.employeesSummary||[]).map(m=>{const E={};let x=0;return w.forEach(R=>{var Q;const K=(Q=R.employees)==null?void 0:Q.find(X=>X.id===m.id),Z=(K==null?void 0:K.elapsedTime)||0;E[R.weekNumber]=Z,x+=Z}),{id:m.id,name:m.name,weeks:E,total:x}}),_={};let D=0;return w.forEach(m=>{_[m.weekNumber]=m.totalElapsedTime||0,D+=m.totalElapsedTime||0}),{employees:k,weekTotals:_,grandTotal:D}}),g=(w,c)=>{var _;const k=(_=d.value)==null?void 0:_.employees.find(D=>D.id===w);return(k==null?void 0:k.weeks[c])||0},u=w=>{var c;return((c=d.value)==null?void 0:c.weekTotals[w])||0},v=w=>{if(!w)return"";try{return new Date(w).toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}catch{return""}},j=(w,c)=>{var D,m,E,x;const k=(D=d.value)==null?void 0:D.employees.find(R=>R.id===w),_=(x=(E=(m=a.data)==null?void 0:m.data)==null?void 0:E.weeks)==null?void 0:x.find(R=>R.weekNumber===c);k&&_&&T("cell-click",{employee:k,week:_,elapsedTime:g(w,c)})},q=w=>{var k;const c=(k=d.value)==null?void 0:k.employees.find(_=>_.id===w);c&&T("employee-click",{employee:c,weeks:p.value.map(_=>({week:_,elapsedTime:g(w,_.weekNumber)}))})},O=w=>{var k;const c=p.value.find(_=>_.weekNumber===w);c&&T("week-click",{week:c,employees:(k=d.value)==null?void 0:k.employees.map(_=>({employee:_,elapsedTime:g(_.id,w)})).filter(_=>_.elapsedTime>0)})};return(w,c)=>(o(),r("div",Oe,[s.loading?(o(),r("div",Re," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):s.error?(o(),r("div",je,i(s.error),1)):!d.value||d.value.employees.length===0?(o(),r("div",Be," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ")):(o(),r("div",Ve,[e("table",Fe,[e("thead",null,[e("tr",null,[c[1]||(c[1]=e("th",{class:"ttt-table__header-employee"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",-1)),(o(!0),r(I,null,A(p.value,k=>(o(),r("th",{key:k.weekNumber,class:H(["ttt-table__header-week",{"ttt-table__header--clickable":!0}]),onClick:_=>O(k.weekNumber)},[S(" –ù–µ–¥–µ–ª—è "+i(k.weekNumber),1),c[0]||(c[0]=e("br",null,null,-1)),e("span",qe,i(v(k.weekStartUtc)),1)],8,ze))),128)),c[2]||(c[2]=e("th",{class:"ttt-table__header-total"},"–ò—Ç–æ–≥–æ",-1))])]),e("tbody",null,[(o(!0),r(I,null,A(d.value.employees,k=>(o(),r("tr",{key:k.id,class:H(["ttt-table__row",{"ttt-table__row--clickable":!0}]),onClick:_=>q(k.id)},[e("td",Ge,i(k.name),1),(o(!0),r(I,null,A(p.value,_=>(o(),r("td",{key:`${k.id}-${_.weekNumber}`,class:H(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:oe(D=>j(k.id,_.weekNumber),["stop"])},i(M(P)(g(k.id,_.weekNumber))),9,Je))),128)),e("td",Ke,[e("strong",null,i(M(P)(k.total)),1)])],8,He))),128)),e("tr",Ze,[c[3]||(c[3]=e("td",{class:"ttt-table__cell-employee"},[e("strong",null,"–í–°–ï–ì–û")],-1)),(o(!0),r(I,null,A(p.value,k=>(o(),r("td",{key:`total-${k.weekNumber}`,class:H(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:_=>O(k.weekNumber)},[e("strong",null,i(M(P)(u(k.weekNumber))),1)],8,Qe))),128)),e("td",Xe,[e("strong",null,i(M(P)(d.value.grandTotal)),1)])])])])]))]))}},et=ae(Ye,[["__scopeId","data-v-8021e5e4"]]),tt={class:"modal-header"},at={class:"modal-body"},st={key:"level-1",class:"detail-cell"},lt={class:"detail-info"},nt={key:0,class:"tasks-list"},ot={class:"task-header"},it={class:"task-label"},rt={class:"task-time"},ct={key:0,class:"ticket-info"},dt={class:"ticket-label"},ut=["title"],mt={key:1,class:"ticket-title"},kt={key:1,class:"ticket-info ticket-info--no-ticket"},vt={class:"detail-total"},pt={key:0,class:"detail-actions"},yt={key:"level-2",class:"tasks-list-level"},_t={class:"tasks-list-header"},bt={class:"tasks-list-title"},ft={class:"tasks-list-content"},gt={key:"loading",class:"loading-state"},wt={key:"error",class:"error-state"},Tt={class:"error-message"},ht={key:"empty",class:"empty-state"},Dt={key:"tasks",class:"tasks-cards-container"},Ct=["onClick"],$t={class:"task-card__header"},Nt={class:"task-card__number"},Pt={key:0,class:"task-card__time"},Et={class:"task-card__title"},St={class:"task-card__dates"},Ut={class:"task-card__date-item"},Wt={class:"date-value"},Mt={class:"task-card__date-item"},xt={class:"task-card__date-item"},Lt={class:"date-value"},It={key:0,class:"task-card__ticket"},At={class:"ticket-header"},Ot={class:"ticket-header__left"},Rt={class:"ticket-id"},jt=["title"],Bt={class:"ticket-title"},Vt={class:"ticket-meta"},Ft={class:"ticket-meta__row"},zt={class:"ticket-meta__item"},qt={class:"meta-value"},Ht={class:"ticket-meta__item"},Gt={class:"meta-value"},Jt={class:"ticket-meta__row"},Kt={class:"ticket-meta__item"},Zt={class:"meta-value"},Qt={class:"ticket-meta__item"},Xt={class:"meta-value"},Yt={class:"ticket-dates"},ea={class:"ticket-date-item"},ta={class:"date-value"},aa={key:1,class:"task-card__no-ticket"},sa={key:0,class:"tasks-pagination"},la=["disabled"],na={class:"pagination-pages"},oa=["onClick"],ia=["disabled"],ra={key:"employee",class:"detail-employee"},ca={class:"detail-info"},da={class:"weeks-list"},ua={class:"week-header"},ma={class:"week-label"},ka={class:"week-time"},va={key:"week",class:"detail-week"},pa={class:"detail-info"},ya={class:"employees-list"},_a={class:"employee-header"},ba={class:"employee-label"},fa={class:"employee-time"},ga={__name:"TimeTrackingDetailModal",props:{cellData:{type:Object,default:null}},emits:["close"],setup(s,{emit:b}){const a=s,T=b,p=W(1),d=W([]),g=W(!1),u=W(null),v=W(1),j=W(10),q=N(()=>{var $,C,B,V,F,z;if(!a.cellData)return"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç";if(p.value===2)return`–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: ${(($=a.cellData.employee)==null?void 0:$.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}, –ù–µ–¥–µ–ª—è ${((C=a.cellData.week)==null?void 0:C.weekNumber)||"?"}`;if(a.cellData.type==="employee")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${((B=a.cellData.employee)==null?void 0:B.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}`;if(a.cellData.type==="week")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: –ù–µ–¥–µ–ª—è ${((V=a.cellData.week)==null?void 0:V.weekNumber)||"?"}`;const l=((F=a.cellData.employee)==null?void 0:F.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",t=((z=a.cellData.week)==null?void 0:z.weekNumber)||"?",y=P(a.cellData.elapsedTime||0);return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${l}, –ù–µ–¥–µ–ª—è ${t} (${y})`}),O=N(()=>{var t,y;if(!((y=(t=a.cellData)==null?void 0:t.week)!=null&&y.employees))return 0;const l=a.cellData.week.employees.find($=>{var C;return $.id===((C=a.cellData.employee)==null?void 0:C.id)});return(l==null?void 0:l.tasksCount)||0}),w=N(()=>{var t,y;if(!((y=(t=a.cellData)==null?void 0:t.week)!=null&&y.employees))return 0;const l=a.cellData.week.employees.find($=>{var C;return $.id===((C=a.cellData.employee)==null?void 0:C.id)});return(l==null?void 0:l.ticketsCount)||0});N(()=>{var l,t;return((t=(l=a.cellData)==null?void 0:l.week)==null?void 0:t.weekNumber)||null});const c=W({totalTasks:0,currentPage:1,perPage:10,totalPages:0}),k=N(()=>c.value.totalPages),_=N(()=>d.value),D=N(()=>{const l=[];let y=Math.max(1,c.value.currentPage-Math.floor(2.5)),$=Math.min(k.value,y+5-1);$-y<4&&(y=Math.max(1,$-5+1));for(let C=y;C<=$;C++)l.push(C);return l}),m=l=>{if(!l||l.length===0)return"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω";if(l.length===1)return ee(l[0].week.weekNumber,l[0].week.weekStartUtc);const t=l[0].week,y=l[l.length-1].week;return`${ee(t.weekNumber,t.weekStartUtc)} - ${ee(y.weekNumber,y.weekStartUtc)}`},E=l=>l?ee(l.weekNumber,l.weekStartUtc):"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω",x=l=>{if(!l)return"-";try{const t=new Date(l);return isNaN(t.getTime())?"-":t.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return console.warn("[TimeTrackingDetailModal] Error formatting date:",l,t),"-"}},R=(l,t)=>{if(t)try{const y=new Date(t);if(!isNaN(y.getTime()))return!1}catch{}if(!l)return!1;try{const y=new Date(l);return isNaN(y.getTime())?!1:new Date>y}catch(y){return console.warn("[TimeTrackingDetailModal] Error checking overdue:",l,y),!1}},K=l=>{const t=l.closedDate?new Date(l.closedDate):null,y=R(l.deadline,l.closedDate);return{"task-card--completed":!!t,"task-card--overdue":y,"task-card--in-progress":!t&&!y}},Z=async()=>{p.value=2,await se()},Q=()=>{p.value=1,d.value=[],u.value=null,v.value=1,c.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0}},X=l=>!l||typeof l!="object"?!1:!l.id||typeof l.id!="number"?(console.warn("[TimeTrackingDetailModal] Invalid task (no ID):",l),!1):!0,se=async()=>{var l,t,y,$,C,B,V,F,z;if(!((t=(l=a.cellData)==null?void 0:l.week)!=null&&t.employees)||!a.cellData.employee){u.value="–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á";return}g.value=!0,u.value=null;try{const L=a.cellData.week.employees.find(h=>{var ne;return h.id===((ne=a.cellData.employee)==null?void 0:ne.id)});if(!L){d.value=[];return}let n=[];if(Array.isArray(L.tasks)&&L.tasks.length>0&&(n=L.tasks.map(h=>typeof h=="object"&&h!==null&&h.id?h.id:typeof h=="number"?h:null).filter(h=>h!==null&&h>0)),n.length===0){d.value=[];return}const f=await ue.getTasksDetails({taskIds:n,employeeId:a.cellData.employee.id,weekNumber:a.cellData.week.weekNumber,page:v.value,perPage:j.value});if(!f||!Array.isArray(f.tasks)){console.error("[TimeTrackingDetailModal] Invalid response format:",f),u.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞",d.value=[];return}d.value=f.tasks.filter(X),c.value=f.pagination||{totalTasks:0,currentPage:1,perPage:j.value,totalPages:0},v.value=c.value.currentPage}catch(L){console.error("[TimeTrackingDetailModal] Error loading tasks details:",{error:L,taskIds:((V=(B=(C=($=(y=a.cellData)==null?void 0:y.week)==null?void 0:$.employees)==null?void 0:C.find(f=>{var h;return f.id===((h=a.cellData.employee)==null?void 0:h.id)}))==null?void 0:B.tasks)==null?void 0:V.map(f=>f.id))||[],employeeId:(F=a.cellData.employee)==null?void 0:F.id,weekNumber:(z=a.cellData.week)==null?void 0:z.weekNumber,timestamp:new Date().toISOString()});const n=L.message||"";n.includes("network")||n.includes("fetch")||n.includes("Failed to fetch")?u.value="–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.":n.includes("timeout")?u.value="–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":n.includes("403")||n.includes("401")?u.value="–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.":n.includes("404")?u.value="–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.":n.includes("500")?u.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":u.value=n||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á",d.value=[]}finally{g.value=!1}},me=()=>{v.value=1,se()};re(v,()=>{p.value===2&&se()});const le=l=>{if(l>=1&&l<=k.value&&l!==v.value){v.value=l;const t=document.querySelector(".tasks-cards-container");t&&(t.scrollTop=0)}},ke=l=>{console.log("[TimeTrackingDetailModal] Task clicked:",l.id)},Y=()=>{T("close")};return re(()=>a.cellData,l=>{l||(p.value=1,d.value=[],u.value=null,v.value=1,c.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0})}),(l,t)=>(o(),te(_e,{to:"body"},[s.cellData?(o(),r("div",{key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:oe(Y,["self"]),onKeydown:ye(Y,["esc"])},[e("div",{class:"modal-content",onClick:t[2]||(t[2]=oe(()=>{},["stop"]))},[e("div",tt,[e("h2",null,i(q.value),1),e("button",{class:"close-button",onClick:Y,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),e("div",at,[G(ie,{name:"level",mode:"out-in"},{default:J(()=>{var y,$,C,B,V,F,z,L;return[p.value===1&&(s.cellData.type==="cell"||!s.cellData.type&&s.cellData.employee&&s.cellData.week)?(o(),r("div",st,[e("div",lt,[e("p",null,[t[3]||(t[3]=e("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),S(" "+i(((y=s.cellData.employee)==null?void 0:y.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),S(" "+i((($=s.cellData.week)==null?void 0:$.weekNumber)||"?"),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),S(" "+i(M(P)(s.cellData.elapsedTime||0)),1)])]),(C=s.cellData.week)!=null&&C.employees?(o(),r("div",nt,[t[8]||(t[8]=e("h3",null,"–ó–∞–¥–∞—á–∏ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã:",-1)),(o(!0),r(I,null,A(s.cellData.week.employees.filter(n=>{var f;return n.id===((f=s.cellData.employee)==null?void 0:f.id)}),n=>(o(),r("div",{key:n.id,class:"employee-tasks"},[(o(!0),r(I,null,A(n.tasks,(f,h)=>(o(),r("div",{class:"task-item",key:h},[e("div",ot,[e("span",it,"–ó–∞–¥–∞—á–∞ #"+i(f.id||h+1),1),e("span",rt,i(M(P)(f.elapsedTime||0)),1)]),f.ticket?(o(),r("div",ct,[e("span",dt,"–¢–∏–∫–µ—Ç #"+i(f.ticket.id),1),f.ticket.createdWeek&&f.ticket.createdWeek!==s.cellData.week.weekNumber?(o(),r("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${f.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${s.cellData.week.weekNumber}`}," (—Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ "+i(f.ticket.createdWeek)+") ",9,ut)):U("",!0),f.ticket.title?(o(),r("div",mt,i(f.ticket.title),1)):U("",!0)])):(o(),r("div",kt,[...t[6]||(t[6]=[e("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])]))]))),128))]))),128)),e("div",vt,[e("p",null,[t[7]||(t[7]=e("strong",null,"–ò—Ç–æ–≥–æ:",-1)),S(" "+i(M(P)(s.cellData.elapsedTime||0))+" ("+i(O.value)+" –∑–∞–¥–∞—á, "+i(w.value)+" —Ç–∏–∫–µ—Ç–æ–≤) ",1)])]),O.value>0?(o(),r("div",pt,[e("button",{class:"btn btn-primary btn-tasks-list",onClick:Z}," üìã –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á ")])):U("",!0)])):U("",!0)])):p.value===2?(o(),r("div",yt,[e("div",_t,[e("button",{class:"btn-back",onClick:Q,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê –ù–∞–∑–∞–¥ "),e("h3",bt," –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: "+i(((B=s.cellData.employee)==null?void 0:B.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫")+", –ù–µ–¥–µ–ª—è "+i(((V=s.cellData.week)==null?void 0:V.weekNumber)||"?"),1)]),e("div",ft,[G(ie,{name:"loading",mode:"out-in"},{default:J(()=>[g.value?(o(),r("div",gt,[...t[9]||(t[9]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...",-1)])])):u.value?(o(),r("div",wt,[t[10]||(t[10]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),t[11]||(t[11]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",Tt,i(u.value),1),e("button",{class:"btn btn-retry",onClick:me},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):d.value.length===0?(o(),r("div",ht,[...t[12]||(t[12]=[e("div",{class:"empty-state-icon"},"üìã",-1),e("p",{class:"empty-state-message"},"–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)])])):(o(),r("div",Dt,[G(pe,{name:"task-card",tag:"div",class:"tasks-cards-list"},{default:J(()=>[(o(!0),r(I,null,A(_.value.filter(X),n=>{var f,h;return o(),r("div",{key:n.id,class:H(["task-card",K(n)]),onClick:ne=>ke(n)},[e("div",$t,[e("span",Nt,"–ó–∞–¥–∞—á–∞ #"+i(n.id),1),n.elapsedTime?(o(),r("span",Pt,i(M(P)(n.elapsedTime)),1)):U("",!0)]),e("div",Et,i(n.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),e("div",St,[e("div",Ut,[t[13]||(t[13]=e("span",{class:"date-icon"},"üìÖ",-1)),t[14]||(t[14]=e("span",{class:"date-label"},"–ù–∞—á–∞–ª–æ:",-1)),e("span",Wt,i(x(n.startDate)),1)]),e("div",Mt,[t[15]||(t[15]=e("span",{class:"date-icon"},"‚è∞",-1)),t[16]||(t[16]=e("span",{class:"date-label"},"–î–µ–¥–ª–∞–π–Ω:",-1)),e("span",{class:H(["date-value",{"date-value--overdue":R(n.deadline,n.closedDate)}])},i(x(n.deadline)||"-"),3)]),e("div",xt,[t[17]||(t[17]=e("span",{class:"date-icon"},"‚úì",-1)),t[18]||(t[18]=e("span",{class:"date-label"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ:",-1)),e("span",Lt,i(x(n.closedDate)||"-"),1)])]),n.ticket?(o(),r("div",It,[e("div",At,[e("div",Ot,[e("span",Rt,"–¢–∏–∫–µ—Ç #"+i(n.ticket.id),1),n.ticket.createdWeek&&n.ticket.createdWeek!==((f=s.cellData.week)==null?void 0:f.weekNumber)?(o(),r("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${n.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${(h=s.cellData.week)==null?void 0:h.weekNumber}`}," –°–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥. "+i(n.ticket.createdWeek),9,jt)):U("",!0)])]),e("div",Bt,i(n.ticket.title||n.ticket.ufSubject||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),e("div",Vt,[e("div",Ft,[e("div",zt,[t[19]||(t[19]=e("span",{class:"meta-label"},"–°–µ–∫—Ç–æ—Ä:",-1)),e("span",qt,i(n.ticket.ufSlaBlockStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)]),e("div",Ht,[t[20]||(t[20]=e("span",{class:"meta-label"},"–°–µ—Ä–≤–∏—Å:",-1)),e("span",Gt,i(n.ticket.ufSlaServiceStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])]),e("div",Jt,[e("div",Kt,[t[21]||(t[21]=e("span",{class:"meta-label"},"–î–µ–π—Å—Ç–≤–∏–µ:",-1)),e("span",Zt,i(n.ticket.ufActionStr||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),1)]),e("div",Qt,[t[22]||(t[22]=e("span",{class:"meta-label"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:",-1)),e("span",Xt,i(n.ticket.ufCrm7UfPriority||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])])]),e("div",Yt,[e("div",ea,[t[23]||(t[23]=e("span",{class:"date-icon"},"üìÖ",-1)),t[24]||(t[24]=e("span",{class:"date-label"},"–°–æ–∑–¥–∞–Ω:",-1)),e("span",ta,i(x(n.ticket.createdTime)),1)])])])):(o(),r("div",aa,[...t[25]||(t[25]=[e("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])])),t[26]||(t[26]=e("div",{class:"task-card__status-placeholder"},null,-1))],10,Ct)}),128))]),_:1}),k.value>1?(o(),r("div",sa,[e("button",{class:"pagination-btn",disabled:c.value.currentPage===1,onClick:t[0]||(t[0]=n=>le(c.value.currentPage-1))}," ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,la),e("div",na,[(o(!0),r(I,null,A(D.value,n=>(o(),r("button",{key:n,class:H(["pagination-page",{"pagination-page--active":n===c.value.currentPage}]),onClick:f=>le(n)},i(n),11,oa))),128))]),e("button",{class:"pagination-btn",disabled:c.value.currentPage===k.value,onClick:t[1]||(t[1]=n=>le(c.value.currentPage+1))}," –°–ª–µ–¥—É—é—â–∞—è ‚Üí ",8,ia)])):U("",!0)]))]),_:1})])])):p.value===1&&s.cellData.type==="employee"?(o(),r("div",ra,[e("div",ca,[e("p",null,[t[27]||(t[27]=e("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),S(" "+i(((F=s.cellData.employee)==null?void 0:F.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),e("p",null,[t[28]||(t[28]=e("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),S(" "+i(m(s.cellData.weeks)),1)])]),e("div",da,[t[29]||(t[29]=e("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –Ω–µ–¥–µ–ª—è–º:",-1)),(o(!0),r(I,null,A(s.cellData.weeks,n=>(o(),r("div",{key:n.week.weekNumber,class:"week-item"},[e("div",ua,[e("span",ma,"–ù–µ–¥–µ–ª—è "+i(n.week.weekNumber),1),e("span",ka,i(M(P)(n.elapsedTime||0)),1)])]))),128))])])):p.value===1&&s.cellData.type==="week"?(o(),r("div",va,[e("div",pa,[e("p",null,[t[30]||(t[30]=e("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),S(" "+i(((z=s.cellData.week)==null?void 0:z.weekNumber)||"?"),1)]),e("p",null,[t[31]||(t[31]=e("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),S(" "+i(E(s.cellData.week)),1)]),e("p",null,[t[32]||(t[32]=e("strong",null,"–û–±—â–∏–µ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),S(" "+i(M(P)(((L=s.cellData.week)==null?void 0:L.totalElapsedTime)||0)),1)])]),e("div",ya,[t[33]||(t[33]=e("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:",-1)),(o(!0),r(I,null,A(s.cellData.employees,n=>(o(),r("div",{key:n.employee.id,class:"employee-item"},[e("div",_a,[e("span",ba,i(n.employee.name),1),e("span",fa,i(M(P)(n.elapsedTime||0)),1)])]))),128))])])):U("",!0)]}),_:1})]),e("div",{class:"modal-footer"},[e("button",{class:"close-btn",onClick:Y},"–ó–∞–∫—Ä—ã—Ç—å")])])],32)):U("",!0)]))}},wa=ae(ga,[["__scopeId","data-v-fc33390b"]]),Ta={class:"tickets-time-tracking-dashboard"},ha={class:"dashboard-header"},Da={class:"breadcrumbs-row"},Ca=["aria-label","aria-disabled","data-fallback","disabled"],$a={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Na={key:"preloader",class:"time-tracking-preloader"},Pa={key:"error",class:"error-state"},Ea={key:"empty",class:"empty-state"},Sa={key:"content",class:"dashboard-content"},Ua={__name:"TicketsTimeTrackingDashboard",setup(s){const b=fe(),a=W(!0),T=W(null),p=W(null),d=W(null),g=W(!1),u=N(()=>De(p.value)),v=async()=>{a.value=!0,T.value=null;const D=new Promise(m=>setTimeout(m,300));try{const[m,E]=await Promise.all([D,ue.getTimeTrackingData({product:"1C",weeksCount:4})]);p.value=E}catch(m){console.error("[TicketsTimeTrackingDashboard] Error loading data:",m),T.value=m.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}finally{a.value=!1}},j=D=>{d.value=D},q=D=>{d.value={type:"employee",...D}},O=D=>{d.value={type:"week",...D}},w=()=>{d.value=null},c=N(()=>typeof window>"u"?!1:window.history.length>1),k=N(()=>c.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"),_=()=>{g.value||(g.value=!0,c.value?b.go(-1):b.push({name:"dashboard-sector-1c"}),setTimeout(()=>{g.value=!1},300))};return be(()=>{v()}),(D,m)=>{const E=ge("router-link");return o(),r("div",Ta,[e("div",ha,[e("div",Da,[e("button",{class:"btn-back-link",type:"button",onClick:_,"aria-label":k.value,"aria-disabled":!c.value,"data-fallback":!c.value,disabled:g.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,Ca),e("nav",$a,[G(E,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:J(()=>[...m[0]||(m[0]=[S(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),m[3]||(m[3]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),G(E,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:J(()=>[...m[1]||(m[1]=[S(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),m[4]||(m[4]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),G(E,{to:{name:"dashboard-graph-admission-closure"},class:"breadcrumb-link"},{default:J(()=>[...m[2]||(m[2]=[S(" –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π ",-1)])]),_:1}),m[5]||(m[5]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),m[6]||(m[6]=e("span",{class:"breadcrumb-current"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã",-1))])])]),m[9]||(m[9]=e("h1",{class:"dashboard-title"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),U("",!0),G(ie,{name:"fade",mode:"out-in"},{default:J(()=>[a.value?(o(),r("div",Na,[...m[7]||(m[7]=[e("div",{class:"preloader-content"},[e("div",{class:"preloader-spinner"},[e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"})]),e("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"),e("p",{class:"preloader-message"},"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö..."),e("div",{class:"preloader-dots"},[e("span",{class:"dot"}),e("span",{class:"dot"}),e("span",{class:"dot"})])],-1)])])):T.value?(o(),r("div",Pa,[e("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: "+i(T.value),1),e("button",{onClick:v,class:"retry-button"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):u.value?(o(),r("div",Sa,[p.value?(o(),te(Ae,{key:0,data:p.value},null,8,["data"])):U("",!0),p.value?(o(),te(et,{key:1,data:p.value,loading:a.value,error:T.value,onCellClick:j,onEmployeeClick:q,onWeekClick:O},null,8,["data","loading","error"])):U("",!0)])):(o(),r("div",Ea,[...m[8]||(m[8]=[e("p",null,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])]))]),_:1}),d.value?(o(),te(wa,{key:1,"cell-data":d.value,onClose:w},null,8,["cell-data"])):U("",!0)])}}},Ma=ae(Ua,[["__scopeId","data-v-f9084975"]]);export{Ma as default};
