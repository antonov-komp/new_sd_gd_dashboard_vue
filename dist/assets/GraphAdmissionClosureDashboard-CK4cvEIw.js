const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./main-DoH-2gzR.js","./main-DgXsRbvu.css","./ticketListUtils-XuGHwEFL.js","./priority-config-BlFVckKp.js","./priority-config-Bxxce_5E.css","./ticket-mapper-DESxIyAn.js"])))=>i.map(i=>d[i]);
var jt=Object.defineProperty;var zt=(s,t,e)=>t in s?jt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var st=(s,t,e)=>zt(s,typeof t!="symbol"?t+"":t,e);import{_ as Be,g as J,G as Me,m as ct,H as Ot,f as Ee,o as y,j as ke,k as ge,a as f,d as ne,b as r,y as Te,n as pe,B as $e,I as qt,J as Xe,K as we,L as Zt,M as Bt,N as ze,O as Xt,P as Jt,Q as Qt,R as er,S as tr,U as rr,V as ar,W as sr,X as nt,c as j,Y as A,t as C,F as he,e as me,Z as Fe,$ as or,x as nr,l as Ue,a0 as lr,a1 as Re,z as It,r as Mt,a2 as Ut,a3 as Ge,T as rt,a4 as Wt}from"./main-DoH-2gzR.js";import{F as Rt}from"./FiltersPanel-DKkKpfhJ.js";import{L as He,D as ir,B as cr}from"./index-tOCMjeN3.js";import{g as At,a as dr,b as $t,D as ur,T as at,c as dt}from"./priority-config-BlFVckKp.js";const kr={key:0,class:"modal-overlay"},vr={class:"modal-container",role:"dialog","aria-labelledby":"modal-title","aria-modal":"true"},hr={class:"modal-body"},yr={class:"mode-description"},mr={__name:"PeriodModeInfoModal",props:{isVisible:{type:Boolean,required:!0},currentMode:{type:String,default:"weeks",validator:s=>["weeks","months"].includes(s)}},emits:["close","start-loading","select-mode"],setup(s,{emit:t}){const e=s,a=t,o=J(e.currentMode);function l(m){if(!["weeks","months"].includes(m)){console.warn("[PeriodModeInfoModal] Invalid mode:",m);return}o.value=m,console.log("[DEBUG Modal] handleModeSelect: mode =",m),console.log("[DEBUG Modal] Emitting select-mode event"),a("select-mode",m),console.log("[DEBUG Modal] Emitting close event"),a("close"),console.log("[DEBUG Modal] Scheduling start-loading event in 100ms"),setTimeout(()=>{console.log("[DEBUG Modal] Emitting start-loading event"),a("start-loading")},100)}function u(){console.log("[DEBUG Modal] handleClose called, selectedMode =",o.value),console.log("[DEBUG Modal] Emitting select-mode event with",o.value),a("select-mode",o.value),console.log("[DEBUG Modal] Emitting close event"),a("close")}function d(m){m.key==="Escape"&&e.isVisible&&u()}return Me(()=>e.currentMode,m=>{["weeks","months"].includes(m)&&(o.value=m)}),ct(()=>{e.isVisible&&document.addEventListener("keydown",d)}),Ot(()=>{document.removeEventListener("keydown",d)}),Me(()=>e.isVisible,m=>{m?(document.addEventListener("keydown",d),o.value=e.currentMode):document.removeEventListener("keydown",d)}),(m,p)=>(y(),Ee(qt,{to:"body"},[ke($e,{name:"modal-fade"},{default:ge(()=>[s.isVisible?(y(),f("div",kr,[r("div",vr,[r("div",{class:"modal-header"},[p[2]||(p[2]=r("h2",{id:"modal-title",class:"modal-title"},[r("span",{class:"modal-icon"},"‚ÑπÔ∏è"),Te(" –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ")],-1)),r("button",{class:"modal-close-btn",onClick:u,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å",type:"button"}," √ó ")]),r("div",hr,[p[5]||(p[5]=r("p",{class:"modal-description"}," –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π: ",-1)),r("div",yr,[r("button",{class:pe(["mode-item mode-item--clickable",{"mode-item--selected":o.value==="weeks"}]),onClick:p[0]||(p[0]=S=>l("weeks")),type:"button"},[...p[3]||(p[3]=[r("div",{class:"mode-header"},[r("span",{class:"mode-icon"},"üìÖ"),r("h3",{class:"mode-title"},"4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏")],-1),r("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 –Ω–µ–¥–µ–ª–∏ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –Ω–µ–¥–µ–ª—è–º. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç–∏–∫–µ—Ç–æ–≤. ",-1)])],2),r("button",{class:pe(["mode-item mode-item--clickable",{"mode-item--selected":o.value==="months"}]),onClick:p[1]||(p[1]=S=>l("months")),type:"button"},[...p[4]||(p[4]=[r("div",{class:"mode-header"},[r("span",{class:"mode-icon"},"üìä"),r("h3",{class:"mode-title"},"3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞")],-1),r("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—Ü–µ–≤. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤. ",-1)])],2)])])])])):ne("",!0)]),_:1})]))}},pr=Be(mr,[["__scopeId","data-v-4a42a9a6"]]);/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var Dt=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var s=window.screen;if(s)return(s.deviceXDPI||1)/(s.logicalXDPI||1)}return 1}(),qe={toTextLines:function(s){var t=[],e;for(s=[].concat(s);s.length;)e=s.pop(),typeof e=="string"?t.unshift.apply(t,e.split(`
`)):Array.isArray(e)?s.push.apply(s,e):ze(s)||t.unshift(""+e);return t},textSize:function(s,t,e){var a=[].concat(t),o=a.length,l=s.font,u=0,d;for(s.font=e.string,d=0;d<o;++d)u=Math.max(s.measureText(a[d]).width,u);return s.font=l,{height:o*e.lineHeight,width:u}},bound:function(s,t,e){return Math.max(s,Math.min(t,e))},arrayDiff:function(s,t){var e=s.slice(),a=[],o,l,u,d;for(o=0,u=t.length;o<u;++o)d=t[o],l=e.indexOf(d),l===-1?a.push([d,1]):e.splice(l,1);for(o=0,u=e.length;o<u;++o)a.push([e[o],-1]);return a},rasterize:function(s){return Math.round(s*Dt)/Dt}};function ot(s,t){var e=t.x,a=t.y;if(e===null)return{x:0,y:-1};if(a===null)return{x:1,y:0};var o=s.x-e,l=s.y-a,u=Math.sqrt(o*o+l*l);return{x:u?o/u:0,y:u?l/u:-1}}function gr(s,t,e,a,o){switch(o){case"center":e=a=0;break;case"bottom":e=0,a=1;break;case"right":e=1,a=0;break;case"left":e=-1,a=0;break;case"top":e=0,a=-1;break;case"start":e=-e,a=-a;break;case"end":break;default:o*=Math.PI/180,e=Math.cos(o),a=Math.sin(o);break}return{x:s,y:t,vx:e,vy:a}}var fr=0,Pt=1,xt=2,Lt=4,Ft=8;function Je(s,t,e){var a=fr;return s<e.left?a|=Pt:s>e.right&&(a|=xt),t<e.top?a|=Ft:t>e.bottom&&(a|=Lt),a}function br(s,t){for(var e=s.x0,a=s.y0,o=s.x1,l=s.y1,u=Je(e,a,t),d=Je(o,l,t),m,p,S;!(!(u|d)||u&d);)m=u||d,m&Ft?(p=e+(o-e)*(t.top-a)/(l-a),S=t.top):m&Lt?(p=e+(o-e)*(t.bottom-a)/(l-a),S=t.bottom):m&xt?(S=a+(l-a)*(t.right-e)/(o-e),p=t.right):m&Pt&&(S=a+(l-a)*(t.left-e)/(o-e),p=t.left),m===u?(e=p,a=S,u=Je(e,a,t)):(o=p,l=S,d=Je(o,l,t));return{x0:e,x1:o,y0:a,y1:l}}function Qe(s,t){var e=t.anchor,a=s,o,l;return t.clamp&&(a=br(a,t.area)),e==="start"?(o=a.x0,l=a.y0):e==="end"?(o=a.x1,l=a.y1):(o=(a.x0+a.x1)/2,l=(a.y0+a.y1)/2),gr(o,l,s.vx,s.vy,t.align)}var et={arc:function(s,t){var e=(s.startAngle+s.endAngle)/2,a=Math.cos(e),o=Math.sin(e),l=s.innerRadius,u=s.outerRadius;return Qe({x0:s.x+a*l,y0:s.y+o*l,x1:s.x+a*u,y1:s.y+o*u,vx:a,vy:o},t)},point:function(s,t){var e=ot(s,t.origin),a=e.x*s.options.radius,o=e.y*s.options.radius;return Qe({x0:s.x-a,y0:s.y-o,x1:s.x+a,y1:s.y+o,vx:e.x,vy:e.y},t)},bar:function(s,t){var e=ot(s,t.origin),a=s.x,o=s.y,l=0,u=0;return s.horizontal?(a=Math.min(s.x,s.base),l=Math.abs(s.base-s.x)):(o=Math.min(s.y,s.base),u=Math.abs(s.base-s.y)),Qe({x0:a,y0:o+u,x1:a+l,y1:o,vx:e.x,vy:e.y},t)},fallback:function(s,t){var e=ot(s,t.origin);return Qe({x0:s.x,y0:s.y,x1:s.x+(s.width||0),y1:s.y+(s.height||0),vx:e.x,vy:e.y},t)}},Ie=qe.rasterize;function _r(s){var t=s.borderWidth||0,e=s.padding,a=s.size.height,o=s.size.width,l=-o/2,u=-a/2;return{frame:{x:l-e.left-t,y:u-e.top-t,w:o+e.width+t*2,h:a+e.height+t*2},text:{x:l,y:u,w:o,h:a}}}function wr(s,t){var e=t.chart.getDatasetMeta(t.datasetIndex).vScale;if(!e)return null;if(e.xCenter!==void 0&&e.yCenter!==void 0)return{x:e.xCenter,y:e.yCenter};var a=e.getBasePixel();return s.horizontal?{x:a,y:null}:{x:null,y:a}}function Tr(s){return s instanceof er?et.arc:s instanceof tr?et.point:s instanceof rr?et.bar:et.fallback}function Cr(s,t,e,a,o,l){var u=Math.PI/2;if(l){var d=Math.min(l,o/2,a/2),m=t+d,p=e+d,S=t+a-d,L=e+o-d;s.moveTo(t,p),m<S&&p<L?(s.arc(m,p,d,-Math.PI,-u),s.arc(S,p,d,-u,0),s.arc(S,L,d,0,u),s.arc(m,L,d,u,Math.PI)):m<S?(s.moveTo(m,e),s.arc(S,p,d,-u,u),s.arc(m,p,d,u,Math.PI+u)):p<L?(s.arc(m,p,d,-Math.PI,0),s.arc(m,L,d,0,Math.PI)):s.arc(m,p,d,-Math.PI,Math.PI),s.closePath(),s.moveTo(t,e)}else s.rect(t,e,a,o)}function Wr(s,t,e){var a=e.backgroundColor,o=e.borderColor,l=e.borderWidth;!a&&(!o||!l)||(s.beginPath(),Cr(s,Ie(t.x)+l/2,Ie(t.y)+l/2,Ie(t.w)-l,Ie(t.h)-l,e.borderRadius),s.closePath(),a&&(s.fillStyle=a,s.fill()),o&&l&&(s.strokeStyle=o,s.lineWidth=l,s.lineJoin="miter",s.stroke()))}function Ar(s,t,e){var a=e.lineHeight,o=s.w,l=s.x,u=s.y+a/2;return t==="center"?l+=o/2:(t==="end"||t==="right")&&(l+=o),{h:a,w:o,x:l,y:u}}function $r(s,t,e){var a=s.shadowBlur,o=e.stroked,l=Ie(e.x),u=Ie(e.y),d=Ie(e.w);o&&s.strokeText(t,l,u,d),e.filled&&(a&&o&&(s.shadowBlur=0),s.fillText(t,l,u,d),a&&o&&(s.shadowBlur=a))}function Dr(s,t,e,a){var o=a.textAlign,l=a.color,u=!!l,d=a.font,m=t.length,p=a.textStrokeColor,S=a.textStrokeWidth,L=p&&S,ee;if(!(!m||!u&&!L))for(e=Ar(e,o,d),s.font=d.string,s.textAlign=o,s.textBaseline="middle",s.shadowBlur=a.textShadowBlur,s.shadowColor=a.textShadowColor,u&&(s.fillStyle=l),L&&(s.lineJoin="round",s.lineWidth=S,s.strokeStyle=p),ee=0,m=t.length;ee<m;++ee)$r(s,t[ee],{stroked:L,filled:u,w:e.w,x:e.x,y:e.y+e.h*ee})}var Gt=function(s,t,e,a){var o=this;o._config=s,o._index=a,o._model=null,o._rects=null,o._ctx=t,o._el=e};Xe(Gt.prototype,{_modelize:function(s,t,e,a){var o=this,l=o._index,u=Xt(we([e.font,{}],a,l)),d=we([e.color,Jt.color],a,l);return{align:we([e.align,"center"],a,l),anchor:we([e.anchor,"center"],a,l),area:a.chart.chartArea,backgroundColor:we([e.backgroundColor,null],a,l),borderColor:we([e.borderColor,null],a,l),borderRadius:we([e.borderRadius,0],a,l),borderWidth:we([e.borderWidth,0],a,l),clamp:we([e.clamp,!1],a,l),clip:we([e.clip,!1],a,l),color:d,display:s,font:u,lines:t,offset:we([e.offset,4],a,l),opacity:we([e.opacity,1],a,l),origin:wr(o._el,a),padding:Qt(we([e.padding,4],a,l)),positioner:Tr(o._el),rotation:we([e.rotation,0],a,l)*(Math.PI/180),size:qe.textSize(o._ctx,t,u),textAlign:we([e.textAlign,"start"],a,l),textShadowBlur:we([e.textShadowBlur,0],a,l),textShadowColor:we([e.textShadowColor,d],a,l),textStrokeColor:we([e.textStrokeColor,d],a,l),textStrokeWidth:we([e.textStrokeWidth,0],a,l)}},update:function(s){var t=this,e=null,a=null,o=t._index,l=t._config,u,d,m,p=we([l.display,!0],s,o);p&&(u=s.dataset.data[o],d=Zt(Bt(l.formatter,[u,s]),u),m=ze(d)?[]:qe.toTextLines(d),m.length&&(e=t._modelize(p,m,l,s),a=_r(e))),t._model=e,t._rects=a},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(s,t){var e=this,a=s.ctx,o=e._model,l=e._rects,u;this.visible()&&(a.save(),o.clip&&(u=o.area,a.beginPath(),a.rect(u.left,u.top,u.right-u.left,u.bottom-u.top),a.clip()),a.globalAlpha=qe.bound(0,o.opacity,1),a.translate(Ie(t.x),Ie(t.y)),a.rotate(o.rotation),Wr(a,l.frame,o),Dr(a,o.lines,l.text,o),a.restore())}});var Sr=Number.MIN_SAFE_INTEGER||-9007199254740991,Er=Number.MAX_SAFE_INTEGER||9007199254740991;function je(s,t,e){var a=Math.cos(e),o=Math.sin(e),l=t.x,u=t.y;return{x:l+a*(s.x-l)-o*(s.y-u),y:u+o*(s.x-l)+a*(s.y-u)}}function St(s,t){var e=Er,a=Sr,o=t.origin,l,u,d,m,p;for(l=0;l<s.length;++l)u=s[l],d=u.x-o.x,m=u.y-o.y,p=t.vx*d+t.vy*m,e=Math.min(e,p),a=Math.max(a,p);return{min:e,max:a}}function tt(s,t){var e=t.x-s.x,a=t.y-s.y,o=Math.sqrt(e*e+a*a);return{vx:(t.x-s.x)/o,vy:(t.y-s.y)/o,origin:s,ln:o}}var Ht=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};Xe(Ht.prototype,{center:function(){var s=this._rect;return{x:s.x+s.w/2,y:s.y+s.h/2}},update:function(s,t,e){this._rotation=e,this._rect={x:t.x+s.x,y:t.y+s.y,w:t.w,h:t.h}},contains:function(s){var t=this,e=1,a=t._rect;return s=je(s,t.center(),-t._rotation),!(s.x<a.x-e||s.y<a.y-e||s.x>a.x+a.w+e*2||s.y>a.y+a.h+e*2)},intersects:function(s){var t=this._points(),e=s._points(),a=[tt(t[0],t[1]),tt(t[0],t[3])],o,l,u;for(this._rotation!==s._rotation&&a.push(tt(e[0],e[1]),tt(e[0],e[3])),o=0;o<a.length;++o)if(l=St(t,a[o]),u=St(e,a[o]),l.max<u.min||u.max<l.min)return!1;return!0},_points:function(){var s=this,t=s._rect,e=s._rotation,a=s.center();return[je({x:t.x,y:t.y},a,e),je({x:t.x+t.w,y:t.y},a,e),je({x:t.x+t.w,y:t.y+t.h},a,e),je({x:t.x,y:t.y+t.h},a,e)]}});function Vt(s,t,e){var a=t.positioner(s,t),o=a.vx,l=a.vy;if(!o&&!l)return{x:a.x,y:a.y};var u=e.w,d=e.h,m=t.rotation,p=Math.abs(u/2*Math.cos(m))+Math.abs(d/2*Math.sin(m)),S=Math.abs(u/2*Math.sin(m))+Math.abs(d/2*Math.cos(m)),L=1/Math.max(Math.abs(o),Math.abs(l));return p*=o*L,S*=l*L,p+=t.offset*o,S+=t.offset*l,{x:a.x+p,y:a.y+S}}function Nr(s,t){var e,a,o,l;for(e=s.length-1;e>=0;--e)for(o=s[e].$layout,a=e-1;a>=0&&o._visible;--a)l=s[a].$layout,l._visible&&o._box.intersects(l._box)&&t(o,l);return s}function Or(s){var t,e,a,o,l,u,d;for(t=0,e=s.length;t<e;++t)a=s[t],o=a.$layout,o._visible&&(d=new Proxy(a._el,{get:(m,p)=>m.getProps([p],!0)[p]}),l=a.geometry(),u=Vt(d,a.model(),l),o._box.update(u,l,a.rotation()));return Nr(s,function(m,p){var S=m._hidable,L=p._hidable;S&&L||L?p._visible=!1:S&&(m._visible=!1)})}var Ze={prepare:function(s){var t=[],e,a,o,l,u;for(e=0,o=s.length;e<o;++e)for(a=0,l=s[e].length;a<l;++a)u=s[e][a],t.push(u),u.$layout={_box:new Ht,_hidable:!1,_visible:!0,_set:e,_idx:u._index};return t.sort(function(d,m){var p=d.$layout,S=m.$layout;return p._idx===S._idx?S._set-p._set:S._idx-p._idx}),this.update(t),t},update:function(s){var t=!1,e,a,o,l,u;for(e=0,a=s.length;e<a;++e)o=s[e],l=o.model(),u=o.$layout,u._hidable=l&&l.display==="auto",u._visible=o.visible(),t|=u._hidable;t&&Or(s)},lookup:function(s,t){var e,a;for(e=s.length-1;e>=0;--e)if(a=s[e].$layout,a&&a._visible&&a._box.contains(t))return s[e];return null},draw:function(s,t){var e,a,o,l,u,d;for(e=0,a=t.length;e<a;++e)o=t[e],l=o.$layout,l._visible&&(u=o.geometry(),d=Vt(o._el,o.model(),u),l._box.update(d,u,o.rotation()),o.draw(s,d))}},Br=function(s){if(ze(s))return null;var t=s,e,a,o;if(ar(s))if(!ze(s.label))t=s.label;else if(!ze(s.r))t=s.r;else for(t="",e=Object.keys(s),o=0,a=e.length;o<a;++o)t+=(o!==0?", ":"")+e[o]+": "+s[e[o]];return""+t},Ir={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:Br,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},Ae="$datalabels",Kt="$default";function Mr(s,t){var e=s.datalabels,a={},o=[],l,u;return e===!1?null:(e===!0&&(e={}),t=Xe({},[t,e]),l=t.labels||{},u=Object.keys(l),delete t.labels,u.length?u.forEach(function(d){l[d]&&o.push(Xe({},[t,l[d],{_key:d}]))}):o.push(t),a=o.reduce(function(d,m){return sr(m.listeners||{},function(p,S){d[S]=d[S]||{},d[S][m._key||Kt]=p}),delete m.listeners,d},{}),{labels:o,listeners:a})}function lt(s,t,e,a){if(t){var o=e.$context,l=e.$groups,u;t[l._set]&&(u=t[l._set][l._key],u&&Bt(u,[o,a])===!0&&(s[Ae]._dirty=!0,e.update(o)))}}function Ur(s,t,e,a,o){var l,u;!e&&!a||(e?a?e!==a&&(u=l=!0):u=!0:l=!0,u&&lt(s,t.leave,e,o),l&&lt(s,t.enter,a,o))}function Rr(s,t){var e=s[Ae],a=e._listeners,o,l;if(!(!a.enter&&!a.leave)){if(t.type==="mousemove")l=Ze.lookup(e._labels,t);else if(t.type!=="mouseout")return;o=e._hovered,e._hovered=l,Ur(s,a,o,l,t)}}function Pr(s,t){var e=s[Ae],a=e._listeners.click,o=a&&Ze.lookup(e._labels,t);o&&lt(s,a,o,t)}var Yt={id:"datalabels",defaults:Ir,beforeInit:function(s){s[Ae]={_actives:[]}},beforeUpdate:function(s){var t=s[Ae];t._listened=!1,t._listeners={},t._datasets=[],t._labels=[]},afterDatasetUpdate:function(s,t,e){var a=t.index,o=s[Ae],l=o._datasets[a]=[],u=s.isDatasetVisible(a),d=s.data.datasets[a],m=Mr(d,e),p=t.meta.data||[],S=s.ctx,L,ee,re,B,I,T,N,O;for(S.save(),L=0,re=p.length;L<re;++L)if(N=p[L],N[Ae]=[],u&&N&&s.getDataVisibility(L)&&!N.skip)for(ee=0,B=m.labels.length;ee<B;++ee)I=m.labels[ee],T=I._key,O=new Gt(I,S,N,L),O.$groups={_set:a,_key:T||Kt},O.$context={active:!1,chart:s,dataIndex:L,dataset:d,datasetIndex:a},O.update(O.$context),N[Ae].push(O),l.push(O);S.restore(),Xe(o._listeners,m.listeners,{merger:function(M,R,g){R[M]=R[M]||{},R[M][t.index]=g[M],o._listened=!0}})},afterUpdate:function(s){s[Ae]._labels=Ze.prepare(s[Ae]._datasets)},afterDatasetsDraw:function(s){Ze.draw(s,s[Ae]._labels)},beforeEvent:function(s,t){if(s[Ae]._listened){var e=t.event;switch(e.type){case"mousemove":case"mouseout":Rr(s,e);break;case"click":Pr(s,e);break}}},afterEvent:function(s){var t=s[Ae],e=t._actives,a=t._actives=s.getActiveElements(),o=qe.arrayDiff(e,a),l,u,d,m,p,S,L;for(l=0,u=o.length;l<u;++l)if(p=o[l],p[1])for(L=p[0].element[Ae]||[],d=0,m=L.length;d<m;++d)S=L[d],S.$context.active=p[1]===1,S.update(S.$context);(t._dirty||o.length)&&(Ze.update(t._labels),s.render()),delete t._dirty}};const xr={class:"ac-chart"},Lr={class:"ac-chart__header"},Fr={class:"ac-chart__subtitle"},Gr={class:"ac-chart__controls"},Hr={class:"chart-type-selector"},Vr=["onClick"],Kr={class:"chart-type-icon"},Yr={class:"chart-type-label"},jr={class:"ac-chart__summary"},zr={class:"summary-week-block summary-week-block--current"},qr={class:"summary-week-block__title"},Zr={class:"summary-week-block__title-week"},Xr={key:0,class:"summary-week-block__title-dates"},Jr={class:"summary-week-block__cards"},Qr={class:"summary-card__value-wrapper"},ea={class:"summary-card__value"},ta=["title"],ra={class:"percentage-indicator__arrow"},aa={class:"percentage-indicator__value"},sa={class:"percentage-indicator__label"},oa={class:"summary-card__value-wrapper"},na={class:"summary-card__value-main"},la=["title"],ia={class:"percentage-indicator__arrow"},ca={class:"percentage-indicator__value"},da={class:"percentage-indicator__label"},ua={class:"summary-card__breakdown"},ka={class:"breakdown-item breakdown-item--this-week"},va={class:"breakdown-item__value"},ha={class:"breakdown-item breakdown-item--other-week"},ya={class:"breakdown-item__value"},ma={class:"summary-card__value-wrapper"},pa={class:"summary-card__value-main"},ga=["title"],fa={class:"percentage-indicator__arrow"},ba={class:"percentage-indicator__value"},_a={class:"percentage-indicator__label"},wa={class:"summary-card__breakdown"},Ta={class:"breakdown-item breakdown-item--this-week"},Ca={class:"breakdown-item__value"},Wa={class:"breakdown-item breakdown-item--previous-week"},Aa={class:"breakdown-item__value"},$a={class:"breakdown-item breakdown-item--older"},Da={class:"breakdown-item__value"},Sa={class:"summary-card summary-card--stages"},Ea={class:"summary-card__tags"},Na={key:0,class:"stage-tag stage-tag--empty"},Oa={key:0,class:"summary-week-divider"},Ba={key:1,class:"summary-week-block summary-week-block--previous"},Ia={class:"summary-week-block__title"},Ma={class:"summary-week-block__title-week"},Ua={key:0,class:"summary-week-block__title-dates"},Ra={class:"summary-week-block__cards"},Pa={class:"summary-card__value-wrapper"},xa={class:"summary-card__values-comparison"},La={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},Fa={class:"summary-card__value"},Ga={class:"value-label"},Ha={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},Va={class:"summary-card__value summary-card__value--current-week"},Ka={class:"value-label"},Ya=["title"],ja={class:"percentage-indicator__arrow"},za={class:"percentage-indicator__value"},qa={class:"percentage-indicator__label"},Za={class:"summary-card__value-wrapper"},Xa={class:"summary-card__values-comparison"},Ja={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},Qa={class:"summary-card__value-main"},es={class:"value-label"},ts={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},rs={class:"summary-card__value-main summary-card__value-main--current-week"},as={class:"value-label"},ss=["title"],os={class:"percentage-indicator__arrow"},ns={class:"percentage-indicator__value"},ls={class:"percentage-indicator__label"},is={class:"summary-card__breakdown"},cs={class:"breakdown-item breakdown-item--this-week"},ds={class:"breakdown-item__value"},us={class:"breakdown-item breakdown-item--other-week"},ks={class:"breakdown-item__value"},vs={class:"summary-card__value-wrapper"},hs={class:"summary-card__values-comparison"},ys={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},ms={class:"summary-card__value-main"},ps={class:"value-label"},gs={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},fs={class:"summary-card__value-main summary-card__value-main--current-week"},bs={class:"value-label"},_s=["title"],ws={class:"percentage-indicator__arrow"},Ts={class:"percentage-indicator__value"},Cs={class:"percentage-indicator__label"},Ws={class:"summary-card__breakdown"},As={class:"breakdown-item breakdown-item--this-week"},$s={class:"breakdown-item__value"},Ds={class:"breakdown-item breakdown-item--previous-week"},Ss={class:"breakdown-item__value"},Es={class:"breakdown-item breakdown-item--older"},Ns={class:"breakdown-item__value"},Os={class:"summary-card summary-card--stages summary-card--previous"},Bs={class:"summary-card__tags"},Is={key:0,class:"stage-tag stage-tag--empty"},Ms={class:"ac-chart__body"},Us={key:0,class:"split-charts-container"},Rs={class:"chart-wrapper chart-wrapper--left"},Ps={class:"chart-canvas-wrapper"},xs={class:"chart-wrapper chart-wrapper--right"},Ls={class:"chart-canvas-wrapper"},Fs={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedPreviousWeek:0,carryoverTicketsCreatedOlder:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedPreviousWeek:[0],carryoverCreatedOlder:[0],carryoverCreatedOtherWeek:[0]},stagesByWeek:[],stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(s,{emit:t}){nt.register(Yt);const e=s,a=t,o=j(()=>{var i;const n=((i=e.meta)==null?void 0:i.weeks)||[];return n.length>=2?n[n.length-2]:null}),l=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],u=J("line"),d={color:"#111827",font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:n=>{var i;return((i=n==null?void 0:n.dataset)==null?void 0:i.borderColor)||"#111827"},borderWidth:1,borderRadius:4,padding:4,offset:8,formatter:n=>n==null||isNaN(n)?"":N(n),display:n=>{var E,G,w,V;if(((G=(E=n==null?void 0:n.chart)==null?void 0:E.config)==null?void 0:G.type)!=="line")return!1;const $=(V=(w=n==null?void 0:n.dataset)==null?void 0:w.data)==null?void 0:V[n.dataIndex];return $!=null&&!isNaN($)&&isFinite($)}};j(()=>{var n;return((n=e.meta)==null?void 0:n.weekNumber)??"‚Äî"});const m=()=>{var i,$;const n=((i=e.meta)==null?void 0:i.weeks)||[];return n.length>0?n.map(E=>`–ù–µ–¥–µ–ª—è ${E.weekNumber}`):[($=e.meta)!=null&&$.weekNumber?`–ù–µ–¥–µ–ª—è ${e.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"]};function p(n,i,$,E=.3,G=0){if(!i)return((_,v)=>{const K=parseInt(_.slice(1,3),16),k=parseInt(_.slice(3,5),16),h=parseInt(_.slice(5,7),16);return`rgba(${K}, ${k}, ${h}, ${v})`})($,E);const w=(oe,_)=>{const v=parseInt(oe.slice(1,3),16),K=parseInt(oe.slice(3,5),16),k=parseInt(oe.slice(5,7),16);return`rgba(${v}, ${K}, ${k}, ${_})`},V=n.createLinearGradient(0,i.bottom,0,i.top);return V.addColorStop(0,w($,E)),V.addColorStop(1,w($,G)),V}const S=j(()=>{var w,V,oe,_;const n=m(),i=Array.isArray((w=e.data.series)==null?void 0:w.new)&&e.data.series.new.length>0?e.data.series.new:[e.data.newTickets??0],$=Array.isArray((V=e.data.series)==null?void 0:V.closed)&&e.data.series.closed.length>0?e.data.series.closed:[e.data.closedTickets??0],E=Array.isArray((oe=e.data.series)==null?void 0:oe.closedCreatedThisWeek)&&e.data.series.closedCreatedThisWeek.length>0?e.data.series.closedCreatedThisWeek:[e.data.closedTicketsCreatedThisWeek??0],G=Array.isArray((_=e.data.series)==null?void 0:_.closedCreatedOtherWeek)&&e.data.series.closedCreatedOtherWeek.length>0?e.data.series.closedCreatedOtherWeek:[e.data.closedTicketsCreatedOtherWeek??0];return{labels:n,datasets:[{label:"–ù–æ–≤—ã–µ",data:i,backgroundColor:v=>{const K=v.chart,{ctx:k,chartArea:h}=K;return p(k,h,A.primary)},borderColor:A.primary,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:A.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.primary,pointBackgroundColor:A.primary,datalabels:{...d,anchor:"end",align:"top",offset:10,color:A.primary,borderColor:A.primary}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:$,backgroundColor:v=>{const K=v.chart,{ctx:k,chartArea:h}=K;return p(k,h,A.success)},borderColor:A.success,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:A.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.success,pointBackgroundColor:A.success,datalabels:{...d,anchor:"start",align:"bottom",offset:10,color:A.success,borderColor:A.success}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:E,backgroundColor:A.successLight,borderColor:A.successLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:A.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.successLight,pointBackgroundColor:A.successLight,datalabels:{...d,anchor:"end",align:"bottom",offset:8,color:A.successLight,borderColor:A.successLight}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:G,backgroundColor:A.warning,borderColor:A.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:A.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.warning,pointBackgroundColor:A.warning,datalabels:{...d,anchor:"end",align:"bottom",offset:8,color:A.warning,borderColor:A.warning}}]}}),L=j(()=>{var w,V,oe,_,v;const n=m(),i=Array.isArray((w=e.data.series)==null?void 0:w.carryover)&&e.data.series.carryover.length>0?e.data.series.carryover:[e.data.carryoverTickets??0],$=Array.isArray((V=e.data.series)==null?void 0:V.carryoverCreatedThisWeek)&&e.data.series.carryoverCreatedThisWeek.length>0?e.data.series.carryoverCreatedThisWeek:[e.data.carryoverTicketsCreatedThisWeek??0],E=Array.isArray((oe=e.data.series)==null?void 0:oe.carryoverCreatedPreviousWeek)&&e.data.series.carryoverCreatedPreviousWeek.length>0?e.data.series.carryoverCreatedPreviousWeek:[e.data.carryoverTicketsCreatedPreviousWeek??0],G=Array.isArray((_=e.data.series)==null?void 0:_.carryoverCreatedOlder)&&e.data.series.carryoverCreatedOlder.length>0?e.data.series.carryoverCreatedOlder:[e.data.carryoverTicketsCreatedOlder??0];return Array.isArray((v=e.data.series)==null?void 0:v.carryoverCreatedOtherWeek)&&e.data.series.carryoverCreatedOtherWeek.length>0?e.data.series.carryoverCreatedOtherWeek:e.data.carryoverTicketsCreatedOtherWeek,{labels:n,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:i,backgroundColor:K=>{const k=K.chart,{ctx:h,chartArea:Y}=k;return p(h,Y,A.carryover)},borderColor:A.carryover,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:A.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.carryover,pointBackgroundColor:A.carryover,datalabels:{...d,anchor:"end",align:"top",offset:4,color:A.carryover,borderColor:A.carryover}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:$,backgroundColor:A.carryoverLight,borderColor:A.carryoverLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:A.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.carryoverLight,pointBackgroundColor:A.carryoverLight,datalabels:{...d,anchor:"end",align:"top",offset:6,color:A.carryoverLight,borderColor:A.carryoverLight}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π)",data:E,backgroundColor:A.warning,borderColor:A.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:A.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.warning,pointBackgroundColor:A.warning,datalabels:{...d,anchor:"end",align:"top",offset:6,color:A.warning,borderColor:A.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –Ω–µ–¥–µ–ª—è–º–∏)",data:G,backgroundColor:A.carryoverDark,borderColor:A.carryoverDark,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:A.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.carryoverDark,pointBackgroundColor:A.carryoverDark,datalabels:{...d,anchor:"end",align:"top",offset:6,color:A.carryoverDark,borderColor:A.carryoverDark}}]}}),ee=j(()=>{var K,k,h,Y,te,le,se,Z,W,ie,ye;const n=((K=e.meta)==null?void 0:K.weeks)||[],i=n.length>0?n.map(de=>`–ù–µ–¥–µ–ª—è ${de.weekNumber}`):[(k=e.meta)!=null&&k.weekNumber?`–ù–µ–¥–µ–ª—è ${e.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"],$=Array.isArray((h=e.data.series)==null?void 0:h.new)&&e.data.series.new.length>0?e.data.series.new:[e.data.newTickets??0],E=Array.isArray((Y=e.data.series)==null?void 0:Y.closed)&&e.data.series.closed.length>0?e.data.series.closed:[e.data.closedTickets??0],G=Array.isArray((te=e.data.series)==null?void 0:te.closedCreatedThisWeek)&&e.data.series.closedCreatedThisWeek.length>0?e.data.series.closedCreatedThisWeek:[e.data.closedTicketsCreatedThisWeek??0],w=Array.isArray((le=e.data.series)==null?void 0:le.closedCreatedOtherWeek)&&e.data.series.closedCreatedOtherWeek.length>0?e.data.series.closedCreatedOtherWeek:[e.data.closedTicketsCreatedOtherWeek??0],V=Array.isArray((se=e.data.series)==null?void 0:se.carryover)&&e.data.series.carryover.length>0?e.data.series.carryover:[e.data.carryoverTickets??0],oe=Array.isArray((Z=e.data.series)==null?void 0:Z.carryoverCreatedThisWeek)&&e.data.series.carryoverCreatedThisWeek.length>0?e.data.series.carryoverCreatedThisWeek:[e.data.carryoverTicketsCreatedThisWeek??0],_=Array.isArray((W=e.data.series)==null?void 0:W.carryoverCreatedPreviousWeek)&&e.data.series.carryoverCreatedPreviousWeek.length>0?e.data.series.carryoverCreatedPreviousWeek:[e.data.carryoverTicketsCreatedPreviousWeek??0],v=Array.isArray((ie=e.data.series)==null?void 0:ie.carryoverCreatedOlder)&&e.data.series.carryoverCreatedOlder.length>0?e.data.series.carryoverCreatedOlder:[e.data.carryoverTicketsCreatedOlder??0];return Array.isArray((ye=e.data.series)==null?void 0:ye.carryoverCreatedOtherWeek)&&e.data.series.carryoverCreatedOtherWeek.length>0?e.data.series.carryoverCreatedOtherWeek:e.data.carryoverTicketsCreatedOtherWeek,{labels:i,datasets:[{label:"–ù–æ–≤—ã–µ",data:$,backgroundColor:A.primary,borderColor:A.primary,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:A.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.primary,pointBackgroundColor:A.primary,datalabels:{...d,anchor:"end",align:"top",offset:10,color:A.primary,borderColor:A.primary}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:E,backgroundColor:A.success,borderColor:A.success,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:A.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.success,pointBackgroundColor:A.success,datalabels:{...d,anchor:"start",align:"bottom",offset:10,color:A.success,borderColor:A.success}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:G,backgroundColor:A.successLight,borderColor:A.successLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:A.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.successLight,pointBackgroundColor:A.successLight,datalabels:{...d,anchor:"end",align:"bottom",offset:8,color:A.successLight,borderColor:A.successLight}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:w,backgroundColor:A.warning,borderColor:A.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:A.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.warning,pointBackgroundColor:A.warning,datalabels:{...d,anchor:"end",align:"bottom",offset:8,color:A.warning,borderColor:A.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:V,backgroundColor:A.carryover,borderColor:A.carryover,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:A.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.carryover,pointBackgroundColor:A.carryover,datalabels:{...d,anchor:"end",align:"top",offset:4,color:A.carryover,borderColor:A.carryover}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:oe,backgroundColor:A.carryoverLight,borderColor:A.carryoverLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:A.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.carryoverLight,pointBackgroundColor:A.carryoverLight,datalabels:{...d,anchor:"end",align:"top",offset:6,color:A.carryoverLight,borderColor:A.carryoverLight}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π)",data:_,backgroundColor:A.warning,borderColor:A.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:A.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.warning,pointBackgroundColor:A.warning,datalabels:{...d,anchor:"end",align:"top",offset:6,color:A.warning,borderColor:A.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –Ω–µ–¥–µ–ª—è–º–∏)",data:v,backgroundColor:A.carryoverDark,borderColor:A.carryoverDark,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:A.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:A.carryoverDark,pointBackgroundColor:A.carryoverDark,datalabels:{...d,anchor:"end",align:"top",offset:6,color:A.carryoverDark,borderColor:A.carryoverDark}}]}}),re=j(()=>({labels:["–ù–æ–≤—ã–µ","–ó–∞–∫—Ä—ã—Ç—ã–µ","–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ"],datasets:[{data:[e.data.newTickets??0,e.data.closedTickets??0,e.data.carryoverTickets??0],backgroundColor:[A.primary,A.success,A.carryover],borderWidth:1}]})),B=j(()=>{switch(u.value){case"line":return He;case"bar":return cr;case"doughnut":return ir;default:return He}}),I=j(()=>u.value==="doughnut"?re.value:ee.value),T=n=>{if(!n)return"‚Äî";try{return new Date(n).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return n}};function N(n){return n==null||isNaN(n)?"0":n>=1e3?n.toLocaleString("ru-RU"):n.toString()}function O(n){const i=n%10,$=n%100;return $>=11&&$<=14?"—Ç–∏–∫–µ—Ç–æ–≤":i===1?"—Ç–∏–∫–µ—Ç":i>=2&&i<=4?"—Ç–∏–∫–µ—Ç–∞":"—Ç–∏–∫–µ—Ç–æ–≤"}const M=j(()=>({responsive:!0,maintainAspectRatio:!1,resizeDelay:0,animation:{duration:800,easing:"easeOutQuart"},interaction:{intersect:!1,mode:"index"},plugins:{datalabels:{...d,anchor:"end",align:"top"},tooltip:{enabled:!0,backgroundColor:"rgba(255, 255, 255, 0.98)",titleColor:"#111827",bodyColor:"#374151",borderColor:"#e5e7eb",borderWidth:1,cornerRadius:8,padding:16,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},displayColors:!0,boxPadding:6,usePointStyle:!0,animation:{duration:300,easing:"easeOutQuart"},callbacks:{title:n=>{var V,oe,_,v,K,k;if(!n||n.length===0)return"";const i=(V=n[0])==null?void 0:V.dataIndex,$=((oe=e.meta)==null?void 0:oe.weeks)||[];if($.length>0&&i!==void 0&&$[i]){const h=$[i];return`–ù–µ–¥–µ–ª—è ${h.weekNumber} (${T(h.weekStartUtc)} ‚Äî ${T(h.weekEndUtc)})`}const E=(_=e.meta)==null?void 0:_.weekNumber,G=(v=e.meta)==null?void 0:v.weekStartUtc,w=(K=e.meta)==null?void 0:K.weekEndUtc;return E&&G&&w?`–ù–µ–¥–µ–ª—è ${E} (${T(G)} ‚Äî ${T(w)})`:((k=n[0])==null?void 0:k.label)||""},label:n=>{const i=n.parsed.y,$=n.dataset.label||"";if(i==null||isNaN(i))return`${$}: 0 —Ç–∏–∫–µ—Ç–æ–≤`;const E=N(i),G=O(i);return`${$}: ${E} ${G}`}}},legend:{position:"bottom",labels:{font:{size:13,weight:"500"},padding:12,boxWidth:18,boxHeight:12,usePointStyle:!0,pointStyle:"circle",generateLabels:n=>nt.defaults.plugins.legend.labels.generateLabels(n).map(($,E)=>{const G=n.data.datasets[E],w=n.getDatasetMeta(E),V=G.borderDash&&Array.isArray(G.borderDash)&&G.borderDash.length>0||G.borderWidth===2||G.fill===!1;return w.hidden?($.fontColor="#9ca3af",$.textDecoration="line-through",$.opacity=.5):V?$.fontColor="#6b7280":$.fontColor="#111827",$})},onClick:(n,i)=>{const $=i.datasetIndex;if($==null){console.warn("[Legend] Invalid datasetIndex:",$);return}const E=n.chart;if(!E){console.warn("[Legend] Chart not found");return}const G=E.getDatasetMeta($);if(!G){console.warn("[Legend] Dataset meta not found for index:",$);return}G.hidden=!G.hidden,E.update("active")},onHover:(n,i)=>{n.native&&n.native.target&&(n.native.target.style.cursor="pointer")},onLeave:(n,i)=>{n.native&&n.native.target&&(n.native.target.style.cursor="default")}}},scales:u.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10,color:"#374151",callback:n=>n==null||isNaN(n)?"0":N(n)},title:{display:!1},grid:{color:n=>{if(!n||!n.tick||n.tick.value===void 0)return"#e5e7eb";const i=n.tick.value;return isNaN(i)||!isFinite(i)?"#e5e7eb":i===0||i%5===0?"#d1d5db":"#e5e7eb"},lineWidth:n=>{if(!n||!n.tick||n.tick.value===void 0)return 1;const i=n.tick.value;return isNaN(i)||!isFinite(i)?1:i===0||i%5===0?1.5:1}}},x:{ticks:{maxRotation:45,minRotation:45,font:{size:14},padding:10,color:"#374151"},title:{display:!1},grid:{color:"#e5e7eb",lineWidth:1}}}})),R=j(()=>{var n,i,$,E,G,w,V,oe;if((n=e.data)!=null&&n.series){const _=e.data.series,v=Math.max((Array.isArray(_.new)?_.new.length:0)-1,(Array.isArray(_.closed)?_.closed.length:0)-1,(Array.isArray(_.closedCreatedThisWeek)?_.closedCreatedThisWeek.length:0)-1,(Array.isArray(_.closedCreatedOtherWeek)?_.closedCreatedOtherWeek.length:0)-1,(Array.isArray(_.carryover)?_.carryover.length:0)-1,(Array.isArray(_.carryoverCreatedThisWeek)?_.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(_.carryoverCreatedPreviousWeek)?_.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(_.carryoverCreatedOlder)?_.carryoverCreatedOlder.length:0)-1,(Array.isArray(_.carryoverCreatedOtherWeek)?_.carryoverCreatedOtherWeek.length:0)-1,-1);if(v>=0){const K={newTickets:Array.isArray(_.new)&&_.new[v]!==void 0?_.new[v]:0,closedTickets:Array.isArray(_.closed)&&_.closed[v]!==void 0?_.closed[v]:0,closedTicketsCreatedThisWeek:Array.isArray(_.closedCreatedThisWeek)&&_.closedCreatedThisWeek[v]!==void 0?_.closedCreatedThisWeek[v]:0,closedTicketsCreatedOtherWeek:Array.isArray(_.closedCreatedOtherWeek)&&_.closedCreatedOtherWeek[v]!==void 0?_.closedCreatedOtherWeek[v]:0,carryoverTickets:Array.isArray(_.carryover)&&_.carryover[v]!==void 0?_.carryover[v]:0,carryoverTicketsCreatedThisWeek:Array.isArray(_.carryoverCreatedThisWeek)&&_.carryoverCreatedThisWeek[v]!==void 0?_.carryoverCreatedThisWeek[v]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(_.carryoverCreatedPreviousWeek)&&_.carryoverCreatedPreviousWeek[v]!==void 0?_.carryoverCreatedPreviousWeek[v]:0,carryoverTicketsCreatedOlder:Array.isArray(_.carryoverCreatedOlder)&&_.carryoverCreatedOlder[v]!==void 0?_.carryoverCreatedOlder[v]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(_.carryoverCreatedOtherWeek)&&_.carryoverCreatedOtherWeek[v]!==void 0?_.carryoverCreatedOtherWeek[v]:0};if(K.carryoverTickets>0&&console.log("[DEBUG currentWeekData]",{total:K.carryoverTickets,thisWeek:K.carryoverTicketsCreatedThisWeek,previousWeek:K.carryoverTicketsCreatedPreviousWeek,older:K.carryoverTicketsCreatedOlder,otherWeek:K.carryoverTicketsCreatedOtherWeek,sum:K.carryoverTicketsCreatedThisWeek+K.carryoverTicketsCreatedPreviousWeek+K.carryoverTicketsCreatedOlder,lastIndex:v,series:{carryoverCreatedPreviousWeek:_.carryoverCreatedPreviousWeek,carryoverCreatedOlder:_.carryoverCreatedOlder,carryoverCreatedPreviousWeekLength:(i=_.carryoverCreatedPreviousWeek)==null?void 0:i.length,carryoverCreatedOlderLength:($=_.carryoverCreatedOlder)==null?void 0:$.length,carryoverCreatedPreviousWeekLast:(E=_.carryoverCreatedPreviousWeek)==null?void 0:E[v],carryoverCreatedOlderLast:(G=_.carryoverCreatedOlder)==null?void 0:G[v]},currentWeek:e.data.currentWeek,data:{carryoverTicketsCreatedPreviousWeek:e.data.carryoverTicketsCreatedPreviousWeek,carryoverTicketsCreatedOlder:e.data.carryoverTicketsCreatedOlder}}),K.newTickets>0||K.closedTickets>0||K.carryoverTickets>0)return K}}if((w=e.data)!=null&&w.currentWeek&&typeof e.data.currentWeek=="object"){const _=e.data.currentWeek;if((_.newTickets??0)>0||(_.closedTickets??0)>0||(_.carryoverTickets??0)>0)return _}if((V=e.data)!=null&&V.weeksData&&Array.isArray(e.data.weeksData)&&e.data.weeksData.length>0){const _=e.data.weeksData[e.data.weeksData.length-1];if((_.newTickets??0)>0||(_.closedTickets??0)>0||(_.carryoverTickets??0)>0)return _}if((oe=e.data)!=null&&oe.series){const _=e.data.series,v=Math.max((Array.isArray(_.new)?_.new.length:0)-1,(Array.isArray(_.closed)?_.closed.length:0)-1,(Array.isArray(_.carryover)?_.carryover.length:0)-1,-1);if(v>=0)return{newTickets:Array.isArray(_.new)&&_.new[v]!==void 0?_.new[v]:0,closedTickets:Array.isArray(_.closed)&&_.closed[v]!==void 0?_.closed[v]:0,closedTicketsCreatedThisWeek:Array.isArray(_.closedCreatedThisWeek)&&_.closedCreatedThisWeek[v]!==void 0?_.closedCreatedThisWeek[v]:0,closedTicketsCreatedOtherWeek:Array.isArray(_.closedCreatedOtherWeek)&&_.closedCreatedOtherWeek[v]!==void 0?_.closedCreatedOtherWeek[v]:0,carryoverTickets:Array.isArray(_.carryover)&&_.carryover[v]!==void 0?_.carryover[v]:0,carryoverTicketsCreatedThisWeek:Array.isArray(_.carryoverCreatedThisWeek)&&_.carryoverCreatedThisWeek[v]!==void 0?_.carryoverCreatedThisWeek[v]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(_.carryoverCreatedPreviousWeek)&&_.carryoverCreatedPreviousWeek[v]!==void 0?_.carryoverCreatedPreviousWeek[v]:0,carryoverTicketsCreatedOlder:Array.isArray(_.carryoverCreatedOlder)&&_.carryoverCreatedOlder[v]!==void 0?_.carryoverCreatedOlder[v]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(_.carryoverCreatedOtherWeek)&&_.carryoverCreatedOtherWeek[v]!==void 0?_.carryoverCreatedOtherWeek[v]:0}}return e.data||{}}),g=j(()=>{var i,$,E,G,w,V,oe,_,v,K;const n=((i=e.meta)==null?void 0:i.weeks)||[];return n.length>0?n[n.length-1]:{weekNumber:((E=($=e.meta)==null?void 0:$.currentWeek)==null?void 0:E.weekNumber)??((G=e.meta)==null?void 0:G.weekNumber)??null,weekStartUtc:((V=(w=e.meta)==null?void 0:w.currentWeek)==null?void 0:V.weekStartUtc)??((oe=e.meta)==null?void 0:oe.weekStartUtc)??null,weekEndUtc:((v=(_=e.meta)==null?void 0:_.currentWeek)==null?void 0:v.weekEndUtc)??((K=e.meta)==null?void 0:K.weekEndUtc)??null}}),c=j(()=>{var n,i,$,E,G,w,V,oe,_;if((n=e.data)!=null&&n.series){const v=e.data.series,K=Math.max((Array.isArray(v.new)?v.new.length:0)-1,(Array.isArray(v.closed)?v.closed.length:0)-1,(Array.isArray(v.closedCreatedThisWeek)?v.closedCreatedThisWeek.length:0)-1,(Array.isArray(v.closedCreatedOtherWeek)?v.closedCreatedOtherWeek.length:0)-1,(Array.isArray(v.carryover)?v.carryover.length:0)-1,(Array.isArray(v.carryoverCreatedThisWeek)?v.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(v.carryoverCreatedPreviousWeek)?v.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(v.carryoverCreatedOlder)?v.carryoverCreatedOlder.length:0)-1,(Array.isArray(v.carryoverCreatedOtherWeek)?v.carryoverCreatedOtherWeek.length:0)-1,-1);if(K>=1){const k=K-1,h=($=(i=e.meta)==null?void 0:i.weeks)==null?void 0:$[k],Y={weekNumber:(h==null?void 0:h.weekNumber)??null,weekStartUtc:(h==null?void 0:h.weekStartUtc)??null,weekEndUtc:(h==null?void 0:h.weekEndUtc)??null,newTickets:Array.isArray(v.new)&&v.new[k]!==void 0?v.new[k]:0,closedTickets:Array.isArray(v.closed)&&v.closed[k]!==void 0?v.closed[k]:0,closedTicketsCreatedThisWeek:Array.isArray(v.closedCreatedThisWeek)&&v.closedCreatedThisWeek[k]!==void 0?v.closedCreatedThisWeek[k]:0,closedTicketsCreatedOtherWeek:Array.isArray(v.closedCreatedOtherWeek)&&v.closedCreatedOtherWeek[k]!==void 0?v.closedCreatedOtherWeek[k]:0,carryoverTickets:Array.isArray(v.carryover)&&v.carryover[k]!==void 0?v.carryover[k]:0,carryoverTicketsCreatedThisWeek:Array.isArray(v.carryoverCreatedThisWeek)&&v.carryoverCreatedThisWeek[k]!==void 0?v.carryoverCreatedThisWeek[k]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(v.carryoverCreatedPreviousWeek)&&v.carryoverCreatedPreviousWeek[k]!==void 0?v.carryoverCreatedPreviousWeek[k]:0,carryoverTicketsCreatedOlder:Array.isArray(v.carryoverCreatedOlder)&&v.carryoverCreatedOlder[k]!==void 0?v.carryoverCreatedOlder[k]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(v.carryoverCreatedOtherWeek)&&v.carryoverCreatedOtherWeek[k]!==void 0?v.carryoverCreatedOtherWeek[k]:0};if(Y.newTickets>0||Y.closedTickets>0||Y.carryoverTickets>0)return Y}}if((E=e.data)!=null&&E.weeksData&&Array.isArray(e.data.weeksData)&&e.data.weeksData.length>=2){const v=e.data.weeksData.length-2,K=e.data.weeksData[v],k=(w=(G=e.meta)==null?void 0:G.weeks)==null?void 0:w[v];if((K.newTickets??0)>0||(K.closedTickets??0)>0||(K.carryoverTickets??0)>0)return{weekNumber:K.weekNumber??(k==null?void 0:k.weekNumber)??null,weekStartUtc:(k==null?void 0:k.weekStartUtc)??null,weekEndUtc:(k==null?void 0:k.weekEndUtc)??null,newTickets:K.newTickets??0,closedTickets:K.closedTickets??0,closedTicketsCreatedThisWeek:K.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:K.closedTicketsCreatedOtherWeek??0,carryoverTickets:K.carryoverTickets??0,carryoverTicketsCreatedThisWeek:K.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:K.carryoverTicketsCreatedOtherWeek??0}}if((V=e.data)!=null&&V.series){const v=e.data.series,K=Math.max((Array.isArray(v.new)?v.new.length:0)-1,(Array.isArray(v.closed)?v.closed.length:0)-1,(Array.isArray(v.carryover)?v.carryover.length:0)-1,-1);if(K>=1){const k=K-1,h=(_=(oe=e.meta)==null?void 0:oe.weeks)==null?void 0:_[k];return{weekNumber:(h==null?void 0:h.weekNumber)??null,weekStartUtc:(h==null?void 0:h.weekStartUtc)??null,weekEndUtc:(h==null?void 0:h.weekEndUtc)??null,newTickets:Array.isArray(v.new)&&v.new[k]!==void 0?v.new[k]:0,closedTickets:Array.isArray(v.closed)&&v.closed[k]!==void 0?v.closed[k]:0,closedTicketsCreatedThisWeek:Array.isArray(v.closedCreatedThisWeek)&&v.closedCreatedThisWeek[k]!==void 0?v.closedCreatedThisWeek[k]:0,closedTicketsCreatedOtherWeek:Array.isArray(v.closedCreatedOtherWeek)&&v.closedCreatedOtherWeek[k]!==void 0?v.closedCreatedOtherWeek[k]:0,carryoverTickets:Array.isArray(v.carryover)&&v.carryover[k]!==void 0?v.carryover[k]:0,carryoverTicketsCreatedThisWeek:Array.isArray(v.carryoverCreatedThisWeek)&&v.carryoverCreatedThisWeek[k]!==void 0?v.carryoverCreatedThisWeek[k]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(v.carryoverCreatedPreviousWeek)&&v.carryoverCreatedPreviousWeek[k]!==void 0?v.carryoverCreatedPreviousWeek[k]:0,carryoverTicketsCreatedOlder:Array.isArray(v.carryoverCreatedOlder)&&v.carryoverCreatedOlder[k]!==void 0?v.carryoverCreatedOlder[k]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(v.carryoverCreatedOtherWeek)&&v.carryoverCreatedOtherWeek[k]!==void 0?v.carryoverCreatedOtherWeek[k]:0}}}return null}),P=j(()=>{var i;const n=(i=e.data)==null?void 0:i.stagesByWeek;return Array.isArray(n)?n:null}),b=j(()=>{var i;const n=P.value;if(n&&n.length>0){const $=n.length-1,E=n[$];if(Array.isArray(E))return E}return((i=e.data)==null?void 0:i.stages)??[]}),U=j(()=>{const n=P.value;if(n&&n.length>=2){const i=n.length-2,$=n[i];if(Array.isArray($))return $}return[]}),H=j(()=>{var n;return(n=c.value)!=null&&n.weekNumber?`–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–µ–¥–µ–ª–∏ ${c.value.weekNumber}`:"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"});function F(n,i){if(typeof n!="number"||isNaN(n)||i==null||typeof i!="number"||isNaN(i)||i===0)return null;if(n===i)return 0;const $=(n-i)/i*100;return!isFinite($)||isNaN($)?null:$}function x(n){return n==null||isNaN(n)?"":`${n>=0?"+":""}${n.toFixed(1)}%`}const z=j(()=>{var n,i,$;if((n=e.data)!=null&&n.series){const E=e.data.series,G=Math.max((Array.isArray(E.new)?E.new.length:0)-1,(Array.isArray(E.closed)?E.closed.length:0)-1,(Array.isArray(E.carryover)?E.carryover.length:0)-1,-1);if(G>=2){const w=G-2,V=($=(i=e.meta)==null?void 0:i.weeks)==null?void 0:$[w];return{weekNumber:(V==null?void 0:V.weekNumber)??null,newTickets:Array.isArray(E.new)&&E.new[w]!==void 0?E.new[w]:0,closedTickets:Array.isArray(E.closed)&&E.closed[w]!==void 0?E.closed[w]:0,carryoverTickets:Array.isArray(E.carryover)&&E.carryover[w]!==void 0?E.carryover[w]:0}}}return null}),q=j(()=>{const n=R.value,i=c.value;return!n||!i?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:F(n.newTickets??0,i.newTickets??0),closedTickets:F(n.closedTickets??0,i.closedTickets??0),carryoverTickets:F(n.carryoverTickets??0,i.carryoverTickets??0)}}),ae=j(()=>{const n=c.value,i=z.value;return!n||!i?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:F(n.newTickets??0,i.newTickets??0),closedTickets:F(n.closedTickets??0,i.closedTickets??0),carryoverTickets:F(n.carryoverTickets??0,i.carryoverTickets??0)}});function ve(n,i){if(!n||!i)return"";try{const $=new Date(n),E=new Date(i),G=$.getUTCDate(),w=$.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),V=$.getUTCFullYear(),oe=E.getUTCDate(),_=E.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),v=E.getUTCFullYear();return V===v&&w===_?`${G} ‚Äî ${oe} ${w}`:V===v?`${G} ${w} ‚Äî ${oe} ${_}`:`${G} ${w} ${V} ‚Äî ${oe} ${_} ${v}`}catch($){return console.error("[formatWeekDates] Error:",$),""}}const fe=n=>{const i=R.value,$=(i==null?void 0:i.newTickets)??0,E=(i==null?void 0:i.closedTickets)??0,G=(i==null?void 0:i.carryoverTickets)??0,w=g.value;n==="new"&&$>0?a("open-stages",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc}):n==="closed"&&E>0?a("open-responsible",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc}):n==="carryover"&&G>0&&a("open-carryover",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc})},D=n=>{const i=c.value;if(!i)return;const $=(i==null?void 0:i.newTickets)??0,E=(i==null?void 0:i.closedTickets)??0,G=(i==null?void 0:i.carryoverTickets)??0,w=o.value;w&&(n==="new"&&$>0?a("open-stages",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc}):n==="closed"&&E>0?a("open-responsible",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc}):n==="carryover"&&G>0&&a("open-carryover",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc}))};return(n,i)=>{var $,E,G,w,V,oe,_,v,K,k,h,Y,te,le,se,Z,W,ie,ye,de,X,_e,De,Se,Ce,Q,ce,ue,We,xe,Le,Ye,ut,kt,vt,ht,yt,mt,pt,gt,ft,bt,_t,wt,Tt,Ct;return y(),f("div",xr,[r("header",Lr,[r("div",null,[i[6]||(i[6]=r("h2",{class:"ac-chart__title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),r("p",Fr," –ù–µ–¥–µ–ª—è "+C(((E=($=s.meta)==null?void 0:$.currentWeek)==null?void 0:E.weekNumber)??((G=s.meta)==null?void 0:G.weekNumber)??"‚Äî")+" ¬∑ "+C((((V=(w=s.meta)==null?void 0:w.currentWeek)==null?void 0:V.weekStartUtc)??((oe=s.meta)==null?void 0:oe.weekStartUtc))||"‚Äî")+" ‚Äî "+C((((v=(_=s.meta)==null?void 0:_.currentWeek)==null?void 0:v.weekEndUtc)??((K=s.meta)==null?void 0:K.weekEndUtc))||"‚Äî")+" (UTC) ",1)]),r("div",Gr,[r("div",Hr,[(y(),f(he,null,me(l,be=>r("button",{key:be.value,class:pe(["chart-type-btn",{active:u.value===be.value}]),onClick:Gc=>u.value=be.value},[r("span",Kr,C(be.icon),1),r("span",Yr,C(be.label),1)],10,Vr)),64))])])]),r("section",jr,[r("div",zr,[r("h3",qr,[i[7]||(i[7]=r("span",{class:"summary-week-block__title-text"},"–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)),r("span",Zr," –ù–µ–¥–µ–ª—è "+C(g.value.weekNumber??"‚Äî"),1),g.value.weekStartUtc?(y(),f("span",Xr,C(ve(g.value.weekStartUtc,g.value.weekEndUtc)),1)):ne("",!0)]),r("div",Jr,[r("div",{class:"summary-card summary-card--new",onClick:i[0]||(i[0]=be=>fe("new"))},[i[8]||(i[8]=r("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),r("div",Qr,[r("div",ea,C(((k=R.value)==null?void 0:k.newTickets)??0),1),q.value.newTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",q.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((h=c.value)==null?void 0:h.weekNumber)??"‚Äî"}): ${x(q.value.newTickets)}`},[r("span",ra,C(q.value.newTickets>=0?"‚Üë":"‚Üì"),1),r("span",aa,C(x(q.value.newTickets)),1),r("span",sa,"–∫ –Ω–µ–¥–µ–ª–µ "+C(((Y=c.value)==null?void 0:Y.weekNumber)??"‚Äî"),1)],10,ta)):ne("",!0)])]),r("div",{class:"summary-card summary-card--closed-breakdown",onClick:i[1]||(i[1]=be=>fe("closed"))},[i[13]||(i[13]=r("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),r("div",oa,[r("div",na,C(((te=R.value)==null?void 0:te.closedTickets)??0),1),q.value.closedTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",q.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((le=c.value)==null?void 0:le.weekNumber)??"‚Äî"}): ${x(q.value.closedTickets)}`},[r("span",ia,C(q.value.closedTickets>=0?"‚Üë":"‚Üì"),1),r("span",ca,C(x(q.value.closedTickets)),1),r("span",da,"–∫ –Ω–µ–¥–µ–ª–µ "+C(((se=c.value)==null?void 0:se.weekNumber)??"‚Äî"),1)],10,la)):ne("",!0)]),r("div",ua,[r("div",ka,[i[9]||(i[9]=r("span",{class:"breakdown-item__icon"},"‚úì",-1)),r("span",va,C(((Z=R.value)==null?void 0:Z.closedTicketsCreatedThisWeek)??0),1),i[10]||(i[10]=r("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),r("div",ha,[i[11]||(i[11]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",ya,C(((W=R.value)==null?void 0:W.closedTicketsCreatedOtherWeek)??0),1),i[12]||(i[12]=r("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),r("div",{class:"summary-card summary-card--carryover-breakdown",onClick:i[2]||(i[2]=be=>fe("carryover"))},[i[20]||(i[20]=r("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),r("div",ma,[r("div",pa,C(((ie=R.value)==null?void 0:ie.carryoverTickets)??0),1),q.value.carryoverTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",q.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((ye=c.value)==null?void 0:ye.weekNumber)??"‚Äî"}): ${x(q.value.carryoverTickets)}`},[r("span",fa,C(q.value.carryoverTickets>=0?"‚Üë":"‚Üì"),1),r("span",ba,C(x(q.value.carryoverTickets)),1),r("span",_a,"–∫ –Ω–µ–¥–µ–ª–µ "+C(((de=c.value)==null?void 0:de.weekNumber)??"‚Äî"),1)],10,ga)):ne("",!0)]),r("div",wa,[r("div",Ta,[i[14]||(i[14]=r("span",{class:"breakdown-item__icon"},"‚úì",-1)),r("span",Ca,C(((X=R.value)==null?void 0:X.carryoverTicketsCreatedThisWeek)??0),1),i[15]||(i[15]=r("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),r("div",Wa,[i[16]||(i[16]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",Aa,C(((_e=R.value)==null?void 0:_e.carryoverTicketsCreatedPreviousWeek)??0),1),i[17]||(i[17]=r("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏",-1))]),r("div",$a,[i[18]||(i[18]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",Da,C(((De=R.value)==null?void 0:De.carryoverTicketsCreatedOlder)??0),1),i[19]||(i[19]=r("span",{class:"breakdown-item__label"},"–æ—Å—Ç–∞–ª—å–Ω—ã–µ",-1))])])]),r("div",Sa,[i[21]||(i[21]=r("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),r("div",Ea,[(y(!0),f(he,null,me(b.value,be=>(y(),f("span",{key:be.stageId,class:"stage-tag"},C(be.stageName||be.stageId)+" ‚Äî "+C(be.count),1))),128)),!b.value||b.value.length===0?(y(),f("span",Na," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):ne("",!0)])])])]),c.value?(y(),f("div",Oa,[...i[22]||(i[22]=[r("div",{class:"summary-week-divider__line"},null,-1),r("div",{class:"summary-week-divider__label"},"–ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)])])):ne("",!0),c.value?(y(),f("div",Ba,[r("h3",Ia,[i[23]||(i[23]=r("span",{class:"summary-week-block__title-text"},"–ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)),r("span",Ma," –ù–µ–¥–µ–ª—è "+C(c.value.weekNumber??"‚Äî"),1),c.value.weekStartUtc?(y(),f("span",Ua,C(ve(c.value.weekStartUtc,c.value.weekEndUtc)),1)):ne("",!0)]),r("div",Ra,[r("div",{class:"summary-card summary-card--new summary-card--previous summary-card--clickable",onClick:i[3]||(i[3]=be=>D("new"))},[i[24]||(i[24]=r("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),r("div",Pa,[r("div",xa,[r("div",La,[r("div",Fa,C(((Se=c.value)==null?void 0:Se.newTickets)??0),1),r("span",Ga,"–ù–µ–¥–µ–ª—è "+C(((Ce=c.value)==null?void 0:Ce.weekNumber)??"‚Äî"),1)]),r("div",Ha,[r("div",Va,C(((Q=z.value)==null?void 0:Q.newTickets)??0),1),r("span",Ka,"–ù–µ–¥–µ–ª—è "+C(((ce=z.value)==null?void 0:ce.weekNumber)??"‚Äî"),1)])]),ae.value.newTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",ae.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((ue=z.value)==null?void 0:ue.weekNumber)??"‚Äî"}): ${x(ae.value.newTickets)}`},[r("span",ja,C(ae.value.newTickets>=0?"‚Üë":"‚Üì"),1),r("span",za,C(x(ae.value.newTickets)),1),r("span",qa,"–∫ –Ω–µ–¥–µ–ª–µ "+C(((We=z.value)==null?void 0:We.weekNumber)??"‚Äî"),1)],10,Ya)):ne("",!0)])]),r("div",{class:"summary-card summary-card--closed-breakdown summary-card--previous summary-card--clickable",onClick:i[4]||(i[4]=be=>D("closed"))},[i[29]||(i[29]=r("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),r("div",Za,[r("div",Xa,[r("div",Ja,[r("div",Qa,C(((xe=c.value)==null?void 0:xe.closedTickets)??0),1),r("span",es,"–ù–µ–¥–µ–ª—è "+C(((Le=c.value)==null?void 0:Le.weekNumber)??"‚Äî"),1)]),r("div",ts,[r("div",rs,C(((Ye=z.value)==null?void 0:Ye.closedTickets)??0),1),r("span",as,"–ù–µ–¥–µ–ª—è "+C(((ut=z.value)==null?void 0:ut.weekNumber)??"‚Äî"),1)])]),ae.value.closedTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",ae.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((kt=z.value)==null?void 0:kt.weekNumber)??"‚Äî"}): ${x(ae.value.closedTickets)}`},[r("span",os,C(ae.value.closedTickets>=0?"‚Üë":"‚Üì"),1),r("span",ns,C(x(ae.value.closedTickets)),1),r("span",ls,"–∫ –Ω–µ–¥–µ–ª–µ "+C(((vt=z.value)==null?void 0:vt.weekNumber)??"‚Äî"),1)],10,ss)):ne("",!0)]),r("div",is,[r("div",cs,[i[25]||(i[25]=r("span",{class:"breakdown-item__icon"},"‚úì",-1)),r("span",ds,C(((ht=c.value)==null?void 0:ht.closedTicketsCreatedThisWeek)??0),1),i[26]||(i[26]=r("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),r("div",us,[i[27]||(i[27]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",ks,C(((yt=c.value)==null?void 0:yt.closedTicketsCreatedOtherWeek)??0),1),i[28]||(i[28]=r("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),r("div",{class:"summary-card summary-card--carryover-breakdown summary-card--previous summary-card--clickable",onClick:i[5]||(i[5]=be=>D("carryover"))},[i[36]||(i[36]=r("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),r("div",vs,[r("div",hs,[r("div",ys,[r("div",ms,C(((mt=c.value)==null?void 0:mt.carryoverTickets)??0),1),r("span",ps,"–ù–µ–¥–µ–ª—è "+C(((pt=c.value)==null?void 0:pt.weekNumber)??"‚Äî"),1)]),r("div",gs,[r("div",fs,C(((gt=z.value)==null?void 0:gt.carryoverTickets)??0),1),r("span",bs,"–ù–µ–¥–µ–ª—è "+C(((ft=z.value)==null?void 0:ft.weekNumber)??"‚Äî"),1)])]),ae.value.carryoverTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",ae.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((bt=z.value)==null?void 0:bt.weekNumber)??"‚Äî"}): ${x(ae.value.carryoverTickets)}`},[r("span",ws,C(ae.value.carryoverTickets>=0?"‚Üë":"‚Üì"),1),r("span",Ts,C(x(ae.value.carryoverTickets)),1),r("span",Cs,"–∫ –Ω–µ–¥–µ–ª–µ "+C(((_t=z.value)==null?void 0:_t.weekNumber)??"‚Äî"),1)],10,_s)):ne("",!0)]),r("div",Ws,[r("div",As,[i[30]||(i[30]=r("span",{class:"breakdown-item__icon"},"‚úì",-1)),r("span",$s,C(((wt=c.value)==null?void 0:wt.carryoverTicketsCreatedThisWeek)??0),1),i[31]||(i[31]=r("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),r("div",Ds,[i[32]||(i[32]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",Ss,C(((Tt=c.value)==null?void 0:Tt.carryoverTicketsCreatedPreviousWeek)??0),1),i[33]||(i[33]=r("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏",-1))]),r("div",Es,[i[34]||(i[34]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",Ns,C(((Ct=c.value)==null?void 0:Ct.carryoverTicketsCreatedOlder)??0),1),i[35]||(i[35]=r("span",{class:"breakdown-item__label"},"–æ—Å—Ç–∞–ª—å–Ω—ã–µ",-1))])])]),r("div",Os,[i[37]||(i[37]=r("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),r("div",Bs,[(y(!0),f(he,null,me(U.value,be=>(y(),f("span",{key:be.stageId,class:"stage-tag"},C(be.stageName||be.stageId)+" ‚Äî "+C(be.count),1))),128)),!U.value||U.value.length===0?(y(),f("span",Is,C(H.value),1)):ne("",!0)])])])])):ne("",!0)]),r("div",Ms,[u.value==="line"?(y(),f("div",Us,[r("div",Rs,[i[38]||(i[38]=r("h3",{class:"chart-subtitle"},"–ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),r("div",Ps,[ke(Fe(He),{data:S.value,options:M.value},null,8,["data","options"])])]),r("div",xs,[i[39]||(i[39]=r("h3",{class:"chart-subtitle"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",-1)),r("div",Ls,[ke(Fe(He),{data:L.value,options:M.value},null,8,["data","options"])])])])):(y(),Ee(or(B.value),{key:1,data:I.value,options:M.value},null,8,["data","options"]))])])}}},Gs=Be(Fs,[["__scopeId","data-v-3666e13a"]]),Hs={class:"summary-cards-months"},Vs={class:"summary-card summary-card--new"},Ks={class:"card-content"},Ys={class:"card-main-value"},js=["title"],zs={class:"card-month-breakdown"},qs={class:"month-name"},Zs={class:"month-value"},Xs={key:0,class:"month-item month-item--empty"},Js={class:"summary-card summary-card--closed"},Qs={class:"card-content"},eo={class:"card-main-value"},to=["title"],ro={class:"card-month-breakdown-hierarchical"},ao={class:"month-header"},so={class:"month-name"},oo={class:"month-value"},no={class:"month-breakdown"},lo={class:"breakdown-item breakdown-this-week"},io={class:"breakdown-value"},co={class:"breakdown-item breakdown-other-week"},uo={class:"breakdown-value"},ko={key:0,class:"month-item-hierarchical month-item--empty"},vo={class:"summary-card summary-card--carryover"},ho={class:"card-content"},yo={class:"card-current-value"},mo={class:"current-value"},po=["title"],go={class:"card-month-breakdown"},fo={class:"month-name"},bo={class:"month-value"},_o={key:0,class:"month-item month-item--empty"},wo={class:"summary-card summary-card--stages"},To={class:"card-content"},Co={class:"stages-list"},Wo={class:"stage-icon"},Ao={class:"stage-name"},$o={class:"stage-value"},Do={key:0,class:"stage-item stage-item--empty"},So={__name:"SummaryCardsMonths",props:{data:{type:Object,required:!0,default:()=>({newTickets:0,newTicketsByMonth:[],closedTickets:0,closedTicketsByMonth:[],carryoverTickets:0,carryoverTicketsByMonth:[],stages:[]})}},setup(s){const t=s;function e(T){return T==null||isNaN(T)?"0":T>=1e6?(T/1e6).toFixed(1)+"M":T>=1e3?T.toLocaleString("ru-RU"):T.toString()}function a(T){return T==null||isNaN(T)?"":`${T>=0?"+":""}${T.toFixed(1)}%`}function o(T,N){if(typeof T!="number"||isNaN(T)||N==null||typeof N!="number"||isNaN(N)||N===0)return null;if(T===N)return 0;const O=(T-N)/N*100;return!isFinite(O)||isNaN(O)?null:O}const l=j(()=>{var T;return((T=t.data)==null?void 0:T.newTickets)||0}),u=j(()=>e(l.value)),d=j(()=>{var T;return((T=t.data)==null?void 0:T.newTicketsByMonth)||[]}),m=j(()=>{var T;return((T=t.data)==null?void 0:T.closedTicketsByMonth)||[]}),p=j(()=>{var T;return((T=t.data)==null?void 0:T.carryoverTicketsByMonth)||[]}),S=j(()=>{const T=p.value;if(T.length===0)return 0;const N=T[T.length-1];return(N==null?void 0:N.count)||0}),L=j(()=>{var O,M,R,g;const T=typeof((O=t.data)==null?void 0:O.newTickets)=="number"?t.data.newTickets:parseInt((M=t.data)==null?void 0:M.newTickets)||0,N=(g=(R=t.data)==null?void 0:R.previousPeriodData)==null?void 0:g.newTickets;return o(T,N)}),ee=j(()=>{var O,M,R,g;const T=typeof((O=t.data)==null?void 0:O.closedTickets)=="number"?t.data.closedTickets:parseInt((M=t.data)==null?void 0:M.closedTickets)||0,N=(g=(R=t.data)==null?void 0:R.previousPeriodData)==null?void 0:g.closedTickets;return o(T,N)}),re=j(()=>{var M;const T=S.value,N=p.value,O=N.length>0?((M=N[0])==null?void 0:M.count)||0:null;return o(T,O)});function B(T){return{"DT140_12:SUCCESS":"stage-success","DT140_12:FAIL":"stage-fail","DT140_12:UC_0GBU8Z":"stage-other"}[T]||""}function I(T){return{"DT140_12:SUCCESS":"‚úì","DT140_12:FAIL":"‚úó","DT140_12:UC_0GBU8Z":"‚ö†"}[T]||"‚Ä¢"}return(T,N)=>(y(),f("div",Hs,[r("div",Vs,[N[0]||(N[0]=r("h3",{class:"card-title"},"–ù–æ–≤—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥",-1)),r("div",Ks,[r("div",Ys,[Te(C(u.value)+" ",1),L.value!==null?(y(),f("span",{key:0,class:pe(["percentage-badge",L.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${a(L.value)}`},C(a(L.value)),11,js)):ne("",!0)]),r("div",zs,[(y(!0),f(he,null,me(d.value,O=>(y(),f("div",{key:`new-${O.month}`,class:"month-item"},[r("span",qs,C(O.monthName)+":",1),r("span",Zs,C(e(O.count)),1)]))),128)),d.value.length===0?(y(),f("div",Xs," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):ne("",!0)])])]),r("div",Js,[N[5]||(N[5]=r("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –≤—Å–µ–≥–æ",-1)),r("div",Qs,[r("div",eo,[Te(C(e(s.data.closedTickets||0))+" ",1),ee.value!==null?(y(),f("span",{key:0,class:pe(["percentage-badge",ee.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${a(ee.value)}`},C(a(ee.value)),11,to)):ne("",!0)]),r("div",ro,[(y(!0),f(he,null,me(m.value,O=>(y(),f("div",{key:`closed-${O.month}`,class:"month-item-hierarchical"},[r("div",ao,[r("span",so,C(O.monthName)+":",1),r("span",oo,C(e(O.count||0)),1)]),r("div",no,[r("div",lo,[N[1]||(N[1]=r("span",{class:"breakdown-icon"},"‚úì",-1)),N[2]||(N[2]=r("span",{class:"breakdown-label"},"—ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞:",-1)),r("span",io,C(e(O.closedCreatedThisWeek||0)),1)]),r("div",co,[N[3]||(N[3]=r("span",{class:"breakdown-icon"},"‚Üª",-1)),N[4]||(N[4]=r("span",{class:"breakdown-label"},"–¥—Ä—É–≥–æ–≥–æ –º–µ—Å—è—Ü–∞:",-1)),r("span",uo,C(e(O.closedCreatedOtherWeek||0)),1)])])]))),128)),m.value.length===0?(y(),f("div",ko," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):ne("",!0)])])]),r("div",vo,[N[7]||(N[7]=r("h3",{class:"card-title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ –≤—Å–µ–≥–æ",-1)),N[8]||(N[8]=r("p",{class:"card-hint"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ –≤ —Ç—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–∞–±–æ—á–∏—Ö —Å—Ç–∞–¥–∏—è—Ö (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)",-1)),r("div",ho,[r("div",yo,[N[6]||(N[6]=r("span",{class:"current-label"},"–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:",-1)),r("span",mo,[Te(C(e(S.value))+" ",1),re.value!==null?(y(),f("span",{key:0,class:pe(["percentage-badge",re.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${a(re.value)}`},C(a(re.value)),11,po)):ne("",!0)])]),r("div",go,[(y(!0),f(he,null,me(p.value,O=>(y(),f("div",{key:`carryover-${O.month}`,class:"month-item"},[r("span",fo,C(O.monthName)+":",1),r("span",bo,C(e(O.count||0)),1)]))),128)),p.value.length===0?(y(),f("div",_o," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):ne("",!0)])])]),r("div",wo,[N[10]||(N[10]=r("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),r("div",To,[r("div",Co,[(y(!0),f(he,null,me(s.data.stages||[],O=>(y(),f("div",{key:O.stageId,class:pe(["stage-item",B(O.stageId)])},[r("span",Wo,C(I(O.stageId)),1),r("span",Ao,C(O.stageName||O.stageId)+":",1),r("span",$o,C(e(O.count||0)),1)],2))),128)),!s.data.stages||s.data.stages.length===0?(y(),f("div",Do,[...N[9]||(N[9]=[r("span",{class:"stage-name"},"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö",-1)])])):ne("",!0)])])])]))}},Eo=Be(So,[["__scopeId","data-v-15d88b90"]]),No={class:"line-chart-months"},Oo={class:"chart-section"},Bo={class:"chart-title"},Io={key:0,class:"chart-period"},Mo={class:"chart-wrapper"},Uo={class:"chart-container"},Ro={class:"chart-summary"},Po={class:"summary-numbers"},xo={class:"summary-row"},Lo={class:"summary-values"},Fo={class:"summary-row"},Go={class:"summary-values"},Ho={class:"summary-analysis"},Vo=["innerHTML"],Ko={class:"chart-section"},Yo={class:"chart-title"},jo={key:0,class:"chart-period"},zo={class:"chart-wrapper"},qo={class:"chart-container"},Zo={class:"chart-analysis"},Xo={class:"analysis-content"},Jo=["innerHTML"],Qo={class:"chart-table-section"},en={class:"chart-table-wrapper"},tn={class:"data-table"},rn={class:"data-row data-row--new"},an={class:"data-row data-row--closed"},sn={class:"data-row data-row--carryover"},on={__name:"LineChartMonths",props:{data:{type:Object,required:!0,default:()=>({newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]})},meta:{type:Object,default:()=>({months:[]})}},setup(s){nt.register(Yt);const t=s;function e(B){return B==null||isNaN(B)?"0":B>=1e3?B.toLocaleString("ru-RU"):B.toString()}const a=j(()=>{var I,T,N;const B=new Set;return(I=t.data.newTicketsByMonth)==null||I.forEach(O=>{O.weeks&&Array.isArray(O.weeks)&&O.weeks.forEach(M=>{M&&M.weekNumber&&B.add(M.weekNumber)})}),(T=t.data.closedTicketsByMonth)==null||T.forEach(O=>{O.weeks&&Array.isArray(O.weeks)&&O.weeks.forEach(M=>{M&&M.weekNumber&&B.add(M.weekNumber)})}),(N=t.data.carryoverTicketsByMonth)==null||N.forEach(O=>{O.weeks&&Array.isArray(O.weeks)&&O.weeks.forEach(M=>{M&&M.weekNumber&&B.add(M.weekNumber)})}),Array.from(B).sort((O,M)=>O-M)}),o=j(()=>{const B=t.data.newTicketsByMonth||[],I=B.map(O=>O.monthName||`–ú–µ—Å—è—Ü ${O.month}`),T=B.map(O=>O.count||0),N=(t.data.closedTicketsByMonth||[]).map(O=>O.count||0);return{labels:I,datasets:[{label:"–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã",data:T,borderColor:A.primary,backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:10,color:A.primary,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:A.primary,borderWidth:1,borderRadius:4,padding:4}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",data:N,borderColor:A.success,backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"start",align:"bottom",offset:10,color:A.success,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:A.success,borderWidth:1,borderRadius:4,padding:4}}]}}),l=j(()=>{const B=t.data.carryoverTicketsByMonth||[],I=B.map(N=>N.monthName||`–ú–µ—Å—è—Ü ${N.month}`),T=B.map(N=>N.count||0);return{labels:I,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",data:T,borderColor:A.carryover,backgroundColor:"rgba(255, 152, 0, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:4,color:A.carryover}}]}}),u={responsive:!0,maintainAspectRatio:!1,layout:{padding:{left:16,right:0,top:56,bottom:0}},plugins:{legend:{position:"left",labels:{font:{size:14,weight:"500"},padding:16,boxWidth:20,boxHeight:12}},tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12},datalabels:{anchor:"end",align:"top",formatter:(B,I)=>B==null||isNaN(B)?"":B.toString(),color:"#333",font:{size:12,weight:"bold"},padding:{top:4,bottom:4},display:function(B){const I=B.dataset.data[B.dataIndex];return I!=null&&!isNaN(I)&&isFinite(I)},backgroundColor:"rgba(255, 255, 255, 0.8)",borderColor:"#333",borderWidth:1,borderRadius:4,padding:4}},scales:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:0,minRotation:0,font:{size:14},padding:10},grid:{lineWidth:1.5}}}};function d(B){if(!B||B.length===0)return null;const I=B[0],T=B[B.length-1];if(!I||!T)return null;const N=I.monthName||`–ú–µ—Å—è—Ü ${I.month}`,O=T.monthName||`–ú–µ—Å—è—Ü ${T.month}`,M=I.year||new Date().getFullYear();return`${N} ‚Äî ${O} ${M}`}const m=j(()=>{var B;return d(((B=t.data)==null?void 0:B.newTicketsByMonth)||[])}),p=j(()=>{var B;return d(((B=t.data)==null?void 0:B.carryoverTicketsByMonth)||[])}),S=j(()=>{var O,M;const B=((O=t.data)==null?void 0:O.newTicketsByMonth)||[],I=((M=t.data)==null?void 0:M.closedTicketsByMonth)||[];if(B.length===0)return{new:"‚Äî",closed:"‚Äî"};const T=B.map(R=>`${e(R.count||0)} (${R.monthName||R.month})`).join(" ‚Üí "),N=I.map(R=>`${e(R.count||0)} (${R.monthName||R.month})`).join(" ‚Üí ");return{new:T,closed:N}}),L=j(()=>{var M,R;const B=((M=t.data)==null?void 0:M.newTicketsByMonth)||[],I=((R=t.data)==null?void 0:R.closedTicketsByMonth)||[];if(B.length<2)return["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"];const T=[],N=[],O=[];if(B.length>=2){const g=B[0],c=B[1],P=B[2];if(c&&g&&typeof g.count=="number"&&typeof c.count=="number"){const b=g.monthName||g.month,U=c.monthName||c.month,H=e(g.count||0),F=e(c.count||0);if(g.count>0){const x=(c.count-g.count)/g.count*100;if(isFinite(x)&&!isNaN(x)){const z=x>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(x),ae=x>=0?"+":"-",ve=x>=0?"#28a745":"#dc3545",fe=x>=0?"#28a745":"#dc3545";N.push(`  ‚Ä¢ <span style="color: ${ve}; font-weight: 600;">${z}</span> —Å ${H} (${b}) –¥–æ ${F} (${U}) ‚Äî <span style="color: ${fe}; font-weight: 600;">${ae}${q.toFixed(1)}%</span>`)}}else g.count===0&&c.count>0&&N.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${b}) –¥–æ ${F} (${U})`)}if(P&&c&&typeof c.count=="number"&&typeof P.count=="number"){const b=c.monthName||c.month,U=P.monthName||P.month,H=e(c.count||0),F=e(P.count||0);if(c.count>0){const x=(P.count-c.count)/c.count*100;if(isFinite(x)&&!isNaN(x))if(Math.abs(x)<.1)N.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${H} (${b}) ‚Üí ${F} (${U}) ‚Äî 0.0%`);else{const z=x>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(x),ae=x>=0?"+":"-",ve=x>=0?"#28a745":"#dc3545",fe=x>=0?"#28a745":"#dc3545";N.push(`  ‚Ä¢ <span style="color: ${ve}; font-weight: 600;">${z}</span> —Å ${H} (${b}) –¥–æ ${F} (${U}) ‚Äî <span style="color: ${fe}; font-weight: 600;">${ae}${q.toFixed(1)}%</span>`)}}else c.count===0&&P.count>0&&N.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${b}) –¥–æ ${F} (${U})`)}}if(I.length>=2){const g=I[0],c=I[1],P=I[2];if(c&&g&&typeof g.count=="number"&&typeof c.count=="number"){const b=g.monthName||g.month,U=c.monthName||c.month,H=e(g.count||0),F=e(c.count||0);if(g.count>0){const x=(c.count-g.count)/g.count*100;if(isFinite(x)&&!isNaN(x))if(Math.abs(x)<.1)O.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${H} (${b}) ‚Üí ${F} (${U}) ‚Äî 0.0%`);else{const z=x>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(x),ae=x>=0?"+":"-",ve=x>=0?"#28a745":"#dc3545",fe=x>=0?"#28a745":"#dc3545";O.push(`  ‚Ä¢ <span style="color: ${ve}; font-weight: 600;">${z}</span> —Å ${H} (${b}) –¥–æ ${F} (${U}) ‚Äî <span style="color: ${fe}; font-weight: 600;">${ae}${q.toFixed(1)}%</span>`)}}else g.count===0&&c.count>0&&O.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏–π: —Å 0 (${b}) –¥–æ ${F} (${U})`)}if(P&&c&&typeof c.count=="number"&&typeof P.count=="number"){const b=c.monthName||c.month,U=P.monthName||P.month,H=e(c.count||0),F=e(P.count||0);if(c.count>0){const x=(P.count-c.count)/c.count*100;if(isFinite(x)&&!isNaN(x))if(Math.abs(x)<.1)O.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${H} (${b}) ‚Üí ${F} (${U}) ‚Äî 0.0%`);else{const z=x>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(x),ae=x>=0?"+":"-",ve=x>=0?"#28a745":"#dc3545",fe=x>=0?"#28a745":"#dc3545";O.push(`  ‚Ä¢ <span style="color: ${ve}; font-weight: 600;">${z}</span> —Å ${H} (${b}) –¥–æ ${F} (${U}) ‚Äî <span style="color: ${fe}; font-weight: 600;">${ae}${q.toFixed(1)}%</span>`)}}else c.count===0&&P.count>0&&O.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏–π: —Å 0 (${b}) –¥–æ ${F} (${U})`)}}if(N.length>0&&(T.push("–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã:"),T.push(...N)),O.length>0&&(T.push("–ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã:"),T.push(...O)),B.length>=3&&I.length>=3){const g=B[0],c=B[B.length-1],P=I[0],b=I[I.length-1],U=g.count||0,H=c.count||0,F=P.count||0,x=b.count||0;if(U>0&&F>0){const z=(H-U)/U*100,q=(x-F)/F*100;if(isFinite(z)&&isFinite(q)){const ae=g.monthName||g.month,ve=c.monthName||c.month,fe=P.monthName||P.month,D=b.monthName||b.month,n=z>=0?"#28a745":"#dc3545",i=z>=0?"#28a745":"#dc3545",$=q>=0?"#28a745":"#dc3545",E=q>=0?"#28a745":"#dc3545";T.push("–û–±—â–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥:"),T.push(`  ‚Ä¢ –ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã: <span style="color: ${n}; font-weight: 600;">${z>=0?"—Ä–æ—Å—Ç":"—Å–Ω–∏–∂–µ–Ω–∏–µ"}</span> —Å ${e(U)} (${ae}) –¥–æ ${e(H)} (${ve}) ‚Äî <span style="color: ${i}; font-weight: 600;">${z>=0?"+":"-"}${Math.abs(z).toFixed(1)}%</span>`),T.push(`  ‚Ä¢ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã: <span style="color: ${$}; font-weight: 600;">${q>=0?"—Ä–æ—Å—Ç":"—Å–Ω–∏–∂–µ–Ω–∏–µ"}</span> —Å ${e(F)} (${fe}) –¥–æ ${e(x)} (${D}) ‚Äî <span style="color: ${E}; font-weight: 600;">${q>=0?"+":"-"}${Math.abs(q).toFixed(1)}%</span>`)}}}return T.length>0?T:["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"]}),ee=j(()=>{var O;const B=((O=t.data)==null?void 0:O.carryoverTicketsByMonth)||[];if(B.length===0)return["–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"];const I=[],T=[],N=B.filter(M=>M&&typeof M.count=="number").map(M=>`${e(M.count||0)} (${M.monthName||M.month||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"})`).join(" ‚Üí ");if(N&&I.push(`–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã: ${N}`),B.length>=2){const M=B[0],R=B[1],g=B[2];if(R&&M&&typeof M.count=="number"&&typeof R.count=="number"){const c=M.monthName||M.month,P=R.monthName||R.month,b=e(M.count||0),U=e(R.count||0);if(M.count>0){const H=(R.count-M.count)/M.count*100;if(isFinite(H)&&!isNaN(H))if(Math.abs(H)<.1)T.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${b} (${c}) ‚Üí ${U} (${P}) ‚Äî 0.0%`);else{const F=H>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",x=Math.abs(H),z=H>=0?"+":"-",q=H>=0?"#28a745":"#dc3545",ae=H>=0?"#28a745":"#dc3545";T.push(`  ‚Ä¢ <span style="color: ${q}; font-weight: 600;">${F}</span> —Å ${b} (${c}) –¥–æ ${U} (${P}) ‚Äî <span style="color: ${ae}; font-weight: 600;">${z}${x.toFixed(1)}%</span>`)}}else M.count===0&&R.count>0&&T.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${c}) –¥–æ ${U} (${P})`)}if(g&&R&&typeof R.count=="number"&&typeof g.count=="number"){const c=R.monthName||R.month,P=g.monthName||g.month,b=e(R.count||0),U=e(g.count||0);if(R.count>0){const H=(g.count-R.count)/R.count*100;if(isFinite(H)&&!isNaN(H))if(Math.abs(H)<.1)T.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${b} (${c}) ‚Üí ${U} (${P}) ‚Äî 0.0%`);else{const F=H>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",x=Math.abs(H),z=H>=0?"+":"-",q=H>=0?"#28a745":"#dc3545",ae=H>=0?"#28a745":"#dc3545";T.push(`  ‚Ä¢ <span style="color: ${q}; font-weight: 600;">${F}</span> —Å ${b} (${c}) –¥–æ ${U} (${P}) ‚Äî <span style="color: ${ae}; font-weight: 600;">${z}${x.toFixed(1)}%</span>`)}}else R.count===0&&g.count>0&&T.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${c}) –¥–æ ${U} (${P})`)}}if(T.length>0&&(I.push("–î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º:"),I.push(...T)),B.length>=3){const M=B[0],R=B[B.length-1];if(M&&R&&typeof M.count=="number"&&typeof R.count=="number"){const g=M.count||0,c=R.count||0,P=M.monthName||M.month,b=R.monthName||R.month,U=e(g),H=e(c);if(g>0){const F=(c-g)/g*100;if(isFinite(F)&&!isNaN(F))if(Math.abs(F)<1)I.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),I.push(`  ‚Ä¢ –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${U} (${P}) ‚Üí ${H} (${b}) ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ–Ω–µ–µ 1%`);else{const x=F>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",z=Math.abs(F),q=F>=0?"+":"-",ae=F>=0?"#28a745":"#dc3545",ve=F>=0?"#28a745":"#dc3545";I.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),I.push(`  ‚Ä¢ <span style="color: ${ae}; font-weight: 600;">${x}</span> —Å ${U} (${P}) –¥–æ ${H} (${b}) ‚Äî <span style="color: ${ve}; font-weight: 600;">${q}${z.toFixed(1)}%</span>`)}}else g===0&&c>0?(I.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),I.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${P}) –¥–æ ${H} (${b})`)):g>0&&c===0&&(I.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),I.push(`  ‚Ä¢ –ü–æ–ª–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å ${U} (${P}) –¥–æ 0 (${b})`))}}return I.length>0?I:["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"]});function re(B,I){let T=[];switch(B){case"new":T=t.data.newTicketsByMonth||[];break;case"closed":T=t.data.closedTicketsByMonth||[];break;case"carryover":T=t.data.carryoverTicketsByMonth||[];break;default:return"-"}for(const N of T){if(!N.weeks||!Array.isArray(N.weeks))continue;const O=N.weeks.find(M=>M&&M.weekNumber===I);if(O){const M=O.count||0;return M>0?e(M):"-"}}return"-"}return(B,I)=>(y(),f("div",No,[r("div",Oo,[r("h3",Bo,[I[0]||(I[0]=Te(" –ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã ",-1)),m.value?(y(),f("span",Io,"("+C(m.value)+")",1)):ne("",!0)]),r("div",Mo,[r("div",Uo,[ke(Fe(He),{data:o.value,options:u},null,8,["data"])]),r("div",Ro,[I[3]||(I[3]=r("h4",{class:"summary-title"},"–°–≤–æ–¥–Ω—ã–π –∏—Ç–æ–≥",-1)),r("div",Po,[r("div",xo,[I[1]||(I[1]=r("span",{class:"summary-label"},"–ù–æ–≤—ã–µ:",-1)),r("span",Lo,C(S.value.new),1)]),r("div",Fo,[I[2]||(I[2]=r("span",{class:"summary-label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ:",-1)),r("span",Go,C(S.value.closed),1)])]),r("div",Ho,[(y(!0),f(he,null,me(L.value,(T,N)=>(y(),f("p",{key:N,innerHTML:T},null,8,Vo))),128))])])])]),r("div",Ko,[r("h3",Yo,[I[4]||(I[4]=Te(" –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã ",-1)),p.value?(y(),f("span",jo,"("+C(p.value)+")",1)):ne("",!0)]),r("div",zo,[r("div",qo,[ke(Fe(He),{data:l.value,options:u},null,8,["data"])]),r("div",Zo,[I[5]||(I[5]=r("h4",{class:"analysis-title"},"–ê–Ω–∞–ª–∏–∑",-1)),r("div",Xo,[(y(!0),f(he,null,me(ee.value,(T,N)=>(y(),f("p",{key:N,innerHTML:T},null,8,Jo))),128))])])])]),r("div",Qo,[I[10]||(I[10]=r("h3",{class:"chart-title"},"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º",-1)),r("div",en,[r("table",tn,[r("thead",null,[r("tr",null,[I[6]||(I[6]=r("th",{class:"month-header-cell"},"–ú–µ—Å—è—Ü",-1)),(y(!0),f(he,null,me(a.value,T=>(y(),f("th",{key:`week-${T}`,class:"week-header-cell"}," –ù–µ–¥–µ–ª—è "+C(T),1))),128))])]),r("tbody",null,[r("tr",rn,[I[7]||(I[7]=r("td",{class:"data-type-cell"},"–ù–æ–≤—ã–µ",-1)),(y(!0),f(he,null,me(a.value,T=>(y(),f("td",{key:`new-${T}`,class:"week-data-cell"},C(re("new",T)),1))),128))]),r("tr",an,[I[8]||(I[8]=r("td",{class:"data-type-cell"},"–ó–∞–∫—Ä—ã—Ç—ã–µ",-1)),(y(!0),f(he,null,me(a.value,T=>(y(),f("td",{key:`closed-${T}`,class:"week-data-cell"},C(re("closed",T)),1))),128))]),r("tr",sn,[I[9]||(I[9]=r("td",{class:"data-type-cell"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),(y(!0),f(he,null,me(a.value,T=>(y(),f("td",{key:`carryover-${T}`,class:"week-data-cell"},C(re("carryover",T)),1))),128))])])])])])]))}},nn=Be(on,[["__scopeId","data-v-31a3d565"]]),ln={class:"months-preloader"},cn={class:"preloader-content"},dn={class:"progress-container"},un={class:"progress-bar"},kn={class:"progress-text"},vn={class:"preloader-message"},hn={class:"stages-list"},yn={class:"stage-icon"},mn={class:"stage-text"},pn={__name:"MonthsModePreloader",props:{progress:{type:Number,required:!0,validator:s=>s>=0&&s<=100},currentStage:{type:String,default:""}},setup(s){const t=s,e=[{label:"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",threshold:5},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 1)...",threshold:35},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 2)...",threshold:65},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 3)...",threshold:85},{label:"–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...",threshold:90},{label:"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",threshold:100}];function a(l){return t.progress>=e[l].threshold}function o(l){const u=e[l].threshold,d=l>0?e[l-1].threshold:0;return t.progress>=d&&t.progress<u}return(l,u)=>(y(),f("div",ln,[r("div",cn,[u[0]||(u[0]=nr('<div class="preloader-spinner" data-v-b571fe67><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div></div><h3 class="preloader-title" data-v-b571fe67>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 3 –º–µ—Å—è—Ü–∞</h3>',2)),r("div",dn,[r("div",un,[r("div",{class:"progress-fill",style:Ue({width:`${s.progress}%`})},null,4)]),r("div",kn,C(Math.round(s.progress))+"%",1)]),r("p",vn,C(s.currentStage),1),r("div",hn,[(y(),f(he,null,me(e,(d,m)=>r("div",{key:m,class:pe(["stage-item",{"stage-completed":a(m),"stage-current":o(m)}])},[r("span",yn,C(a(m)?"‚úì":o(m)?"‚Üí":"‚óã"),1),r("span",mn,C(d.label),1)],2)),64))])])]))}},gn=Be(pn,[["__scopeId","data-v-b571fe67"]]),fn="/api/graph-1c-admission-closure.php";function bn(s){var a,o,l,u,d,m,p,S,L,ee,re,B,I,T,N,O,M,R,g,c,P,b,U,H,F,x,z,q,ae,ve,fe,D,n,i,$,E,G,w,V,oe,_,v,K,k,h,Y,te,le,se,Z,W,ie,ye,de,X,_e,De,Se,Ce,Q,ce,ue,We,xe,Le,Ye;if(!s)return{meta:null,data:{currentWeek:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,carryoverTicketsCreatedPreviousWeek:0,carryoverTicketsCreatedOlder:0},newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0],carryoverCreatedPreviousWeek:[0],carryoverCreatedOlder:[0]},weeksData:[],stagesByWeek:[],stages:[],responsible:[],responsibleCreatedThisWeek:[],responsibleCreatedOtherWeek:[]}};const t=s.data||s.result||s,e=t.meta||s.meta||null;return{meta:{...e,currentWeek:(e==null?void 0:e.currentWeek)||(e?{weekNumber:e.weekNumber,weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc}:null),weeks:(e==null?void 0:e.weeks)||[]},data:{currentWeek:((a=t.data)==null?void 0:a.currentWeek)||(t.data?{newTickets:t.data.newTickets??0,closedTickets:t.data.closedTickets??0,closedTicketsCreatedThisWeek:t.data.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:t.data.closedTicketsCreatedOtherWeek??0,carryoverTickets:t.data.carryoverTickets??0,carryoverTicketsCreatedThisWeek:t.data.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:t.data.carryoverTicketsCreatedOtherWeek??0,carryoverTicketsCreatedPreviousWeek:t.data.carryoverTicketsCreatedPreviousWeek??0,carryoverTicketsCreatedOlder:t.data.carryoverTicketsCreatedOlder??0}:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,carryoverTicketsCreatedPreviousWeek:0,carryoverTicketsCreatedOlder:0}),newTickets:((l=(o=t.data)==null?void 0:o.currentWeek)==null?void 0:l.newTickets)??((u=t.data)==null?void 0:u.newTickets)??t.newTickets??0,closedTickets:((m=(d=t.data)==null?void 0:d.currentWeek)==null?void 0:m.closedTickets)??((p=t.data)==null?void 0:p.closedTickets)??t.closedTickets??0,closedTicketsCreatedThisWeek:((L=(S=t.data)==null?void 0:S.currentWeek)==null?void 0:L.closedTicketsCreatedThisWeek)??((ee=t.data)==null?void 0:ee.closedTicketsCreatedThisWeek)??t.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:((B=(re=t.data)==null?void 0:re.currentWeek)==null?void 0:B.closedTicketsCreatedOtherWeek)??((I=t.data)==null?void 0:I.closedTicketsCreatedOtherWeek)??t.closedTicketsCreatedOtherWeek??0,carryoverTickets:((N=(T=t.data)==null?void 0:T.currentWeek)==null?void 0:N.carryoverTickets)??((O=t.data)==null?void 0:O.carryoverTickets)??t.carryoverTickets??0,carryoverTicketsCreatedThisWeek:((R=(M=t.data)==null?void 0:M.currentWeek)==null?void 0:R.carryoverTicketsCreatedThisWeek)??((g=t.data)==null?void 0:g.carryoverTicketsCreatedThisWeek)??t.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:((P=(c=t.data)==null?void 0:c.currentWeek)==null?void 0:P.carryoverTicketsCreatedOtherWeek)??((b=t.data)==null?void 0:b.carryoverTicketsCreatedOtherWeek)??t.carryoverTicketsCreatedOtherWeek??0,carryoverTicketsCreatedPreviousWeek:((H=(U=t.data)==null?void 0:U.currentWeek)==null?void 0:H.carryoverTicketsCreatedPreviousWeek)??((F=t.data)==null?void 0:F.carryoverTicketsCreatedPreviousWeek)??t.carryoverTicketsCreatedPreviousWeek??0,carryoverTicketsCreatedOlder:((z=(x=t.data)==null?void 0:x.currentWeek)==null?void 0:z.carryoverTicketsCreatedOlder)??((q=t.data)==null?void 0:q.carryoverTicketsCreatedOlder)??t.carryoverTicketsCreatedOlder??0,series:{new:((ve=(ae=t.data)==null?void 0:ae.series)==null?void 0:ve.new)??((fe=t.series)==null?void 0:fe.new)??[0],closed:((n=(D=t.data)==null?void 0:D.series)==null?void 0:n.closed)??((i=t.series)==null?void 0:i.closed)??[0],closedCreatedThisWeek:((E=($=t.data)==null?void 0:$.series)==null?void 0:E.closedCreatedThisWeek)??((G=t.series)==null?void 0:G.closedCreatedThisWeek)??[0],closedCreatedOtherWeek:((V=(w=t.data)==null?void 0:w.series)==null?void 0:V.closedCreatedOtherWeek)??((oe=t.series)==null?void 0:oe.closedCreatedOtherWeek)??[0],carryover:((v=(_=t.data)==null?void 0:_.series)==null?void 0:v.carryover)??((K=t.series)==null?void 0:K.carryover)??[0],carryoverCreatedThisWeek:((h=(k=t.data)==null?void 0:k.series)==null?void 0:h.carryoverCreatedThisWeek)??((Y=t.series)==null?void 0:Y.carryoverCreatedThisWeek)??[0],carryoverCreatedOtherWeek:((le=(te=t.data)==null?void 0:te.series)==null?void 0:le.carryoverCreatedOtherWeek)??((se=t.series)==null?void 0:se.carryoverCreatedOtherWeek)??[0],carryoverCreatedPreviousWeek:((W=(Z=t.data)==null?void 0:Z.series)==null?void 0:W.carryoverCreatedPreviousWeek)??((ie=t.series)==null?void 0:ie.carryoverCreatedPreviousWeek)??[0],carryoverCreatedOlder:((de=(ye=t.data)==null?void 0:ye.series)==null?void 0:de.carryoverCreatedOlder)??((X=t.series)==null?void 0:X.carryoverCreatedOlder)??[0]},weeksData:((_e=t.data)==null?void 0:_e.weeksData)??t.weeksData??[],stagesByWeek:((De=t.data)==null?void 0:De.stagesByWeek)??t.stagesByWeek??[],stages:((Se=t.data)==null?void 0:Se.stages)??t.stages??[],responsible:((Ce=t.data)==null?void 0:Ce.responsible)??t.responsible??[],responsibleCreatedThisWeek:((Q=t.data)==null?void 0:Q.responsibleCreatedThisWeek)??t.responsibleCreatedThisWeek??[],responsibleCreatedOtherWeek:((ce=t.data)==null?void 0:ce.responsibleCreatedOtherWeek)??t.responsibleCreatedOtherWeek??[],newTicketsByStages:((ue=t.data)==null?void 0:ue.newTicketsByStages)??t.newTicketsByStages??null,carryoverTicketsByDuration:((We=t.data)==null?void 0:We.carryoverTicketsByDuration)??t.carryoverTicketsByDuration??null,newTicketsByMonth:((xe=t.data)==null?void 0:xe.newTicketsByMonth)??t.newTicketsByMonth??[],closedTicketsByMonth:((Le=t.data)==null?void 0:Le.closedTicketsByMonth)??t.closedTicketsByMonth??[],carryoverTicketsByMonth:((Ye=t.data)==null?void 0:Ye.carryoverTicketsByMonth)??t.carryoverTicketsByMonth??[]}}}async function Oe(s={}){const{endpoint:t=fn,product:e="1C",weekStartUtc:a=null,weekEndUtc:o=null,periodMode:l="weeks",useCache:u=!0,forceRefresh:d=!1,includeTickets:m=!1,includeNewTicketsByStages:p=!1,includeCarryoverTickets:S=!0,includeCarryoverTicketsByDuration:L=!1}=s,ee={product:e,weekStartUtc:a,weekEndUtc:o,periodMode:l,useCache:u,forceRefresh:d,includeTickets:m,includeNewTicketsByStages:p,includeCarryoverTickets:S,includeCarryoverTicketsByDuration:L},re=lr(t),B=await fetch(re,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(ee)});if(!B.ok)throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (${B.status})`);const I=await B.json();if((I==null?void 0:I.success)===!1)throw new Error(I.message||"–ë—ç–∫–µ–Ω–¥ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É");const T=bn(I);if(I.cache_used===!0){const{CacheNotificationService:N}=await Re(async()=>{const{CacheNotificationService:M}=await import("./main-DoH-2gzR.js").then(R=>R.aq);return{CacheNotificationService:M}},__vite__mapDeps([0,1]),import.meta.url),O=l==="months"?"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)":"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)";N.notifyCacheUsed(O)}return T}const _n=Object.freeze(Object.defineProperty({__proto__:null,fetchAdmissionClosureStats:Oe},Symbol.toStringTag,{value:"Module"})),wn={class:"ac-dashboard-months"},Tn={key:"content"},Cn={class:"dashboard-header"},Wn={class:"header-content"},An={class:"breadcrumbs-row"},$n=["aria-label","aria-disabled","data-fallback","disabled"],Dn={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Sn={class:"dashboard-layout"},En={class:"filters-container"},Nn={class:"chart-container"},On={__name:"GraphAdmissionClosureMonthsDashboard",setup(s){const t=It(),e=J(!0),a=J(0),o=J("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."),l=J(null),u=J(null),d=J({newTickets:0,closedTickets:0,carryoverTickets:0,newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[],previousPeriodData:{newTickets:null,closedTickets:null,carryoverTickets:null}}),m=J(!1),p=j(()=>typeof window>"u"?!1:window.history.length>1),S=j(()=>p.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),L={name:"dashboard-sector-1c"};function ee(b){var U;if((U=b==null?void 0:b.preventDefault)==null||U.call(b),!m.value){m.value=!0;try{if(p.value){t.back();return}console.warn("GraphAdmissionClosureMonthsDashboard: fallback navigation to dashboard-sector-1c"),t.push(L)}finally{m.value=!1}}}const re=J({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),B=j(()=>{const b=re.value.customDateRange.startDate||re.value.customDateRange.endDate,U=re.value.employees.length===1&&re.value.employees.includes("all");return b||!U});async function I(b,U,H=500){const F=a.value,x=10,z=(b-F)/x,q=H/x;for(let ae=0;ae<x;ae++)await new Promise(ve=>setTimeout(ve,q)),a.value=Math.min(F+z*(ae+1),b);a.value=b,o.value=U}async function T(){console.log("[DEBUG MonthsDashboard] loadData called"),console.log("[DEBUG MonthsDashboard] isLoading before:",e.value),e.value=!0,l.value=null,a.value=0,o.value="–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",console.log("[DEBUG MonthsDashboard] isLoading set to true");let b=null,U=null;try{console.log("[DEBUG MonthsDashboard] Starting API call"),await I(5,"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",200);const H=Date.now(),F=2e4;b=setInterval(()=>{const ae=Date.now()-H,ve=Math.min(5+ae/F*85,90);a.value=ve,ve<35?o.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 1)...":ve<65?o.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 2)...":ve<85?o.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 3)...":o.value="–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö..."},500),U=setTimeout(()=>{b&&(clearInterval(b),b=null)},F+1e4);const x=await Oe({product:"1C",periodMode:"months",includeTickets:!0});clearTimeout(U),b&&(clearInterval(b),b=null),a.value=90,o.value="–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞",await I(100,"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",300),console.log("[DEBUG MonthsDashboard] API call successful, result:",x);const{meta:z,data:q}=x;u.value=z,d.value=q,console.log("[DEBUG MonthsDashboard] Data set, meta:",z,"data keys:",Object.keys(q)),await new Promise(ae=>setTimeout(ae,200))}catch(H){b&&(clearInterval(b),b=null),U&&(clearTimeout(U),U=null),console.error("[DEBUG MonthsDashboard] API call failed:",H),l.value=H instanceof Error?H:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureMonthsDashboard] loadData error:",H),a.value=100,o.value="–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö"}finally{console.log("[DEBUG MonthsDashboard] Finally block: setting isLoading to false"),e.value=!1,console.log("[DEBUG MonthsDashboard] isLoading after:",e.value)}}function N(b){re.value.stages=b}function O(b){re.value.employees=b}function M(b){re.value.dateRange=b}function R(b){re.value.customDateRange=b}function g(){re.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},c()}function c(){T()}function P(b){if(!["weeks","months"].includes(b)){console.warn("[GraphAdmissionClosureMonthsDashboard] Invalid periodMode:",b);return}b==="weeks"&&window.dispatchEvent(new CustomEvent("period-mode-change",{detail:{mode:b}}))}return ct(()=>{console.log("[DEBUG MonthsDashboard] onMounted called"),console.log("[DEBUG MonthsDashboard] isLoading before loadData:",e.value),T()}),(b,U)=>{const H=Mt("router-link");return y(),f("div",wn,[ke($e,{name:"fade",mode:"out-in"},{default:ge(()=>[e.value?(y(),Ee(gn,{key:"preloader",progress:a.value,"current-stage":o.value},null,8,["progress","current-stage"])):(y(),f("div",Tn,[r("div",Cn,[r("div",Wn,[r("div",An,[r("button",{class:"btn-back-link",type:"button",onClick:ee,"aria-label":S.value,"aria-disabled":!p.value,"data-fallback":!p.value,disabled:m.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,$n),r("nav",Dn,[ke(H,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ge(()=>[...U[0]||(U[0]=[Te(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),U[2]||(U[2]=r("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ke(H,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:ge(()=>[...U[1]||(U[1]=[Te(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),U[3]||(U[3]=r("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),U[4]||(U[4]=r("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),U[5]||(U[5]=r("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),U[6]||(U[6]=r("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),r("div",Sn,[r("div",En,[ke(Rt,{stages:re.value.stages,employees:re.value.employees,dateRange:re.value.dateRange,customDateRange:re.value.customDateRange,hasActiveFilters:B.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":"months","onUpdate:stages":N,"onUpdate:employees":O,"onUpdate:dateRange":M,"onUpdate:customDateRange":R,"onUpdate:periodMode":P,onReset:g,onApply:c},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])]),r("div",Nn,[l.value?(y(),Ee(Ut,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:l.value.message},null,8,["message"])):(y(),f(he,{key:1},[ke(Eo,{data:d.value},null,8,["data"]),ke(nn,{data:d.value,meta:u.value},null,8,["data","meta"])],64))])])]))]),_:1})])}}},Bn=Be(On,[["__scopeId","data-v-fe3ca7ed"]]);class it{static async getSectorData(){try{const t=await this.getAllTickets();console.log("Total tickets loaded:",t.length);const e=this.extractUniqueEmployeeIds(t);console.log("Unique employee IDs:",e);const a=await this.getEmployeesByIds(e);return console.log("Loaded employees:",a.length),{stages:this.groupTicketsByStages(t,a),employees:a,zeroPointTickets:this.getZeroPointTickets(t)}}catch(t){throw console.error("Error getting sector data:",t),t}}static async getAllTickets(){const t=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],e=[];for(const a of t){console.log(`Loading tickets for stage: ${a}`);const o=await this.getTicketsByStage(a);e.push(...o),console.log(`Loaded ${o.length} tickets for stage ${a}`)}return e}static async getTicketsByStage(t){const e=[];let a=0;const o=50;let l=!0;for(;l;)try{const d=await Ge.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:t},select:["*"],order:{id:"DESC"},start:a,useOriginalUfNames:"Y"});let m=[];d&&d.result&&(Array.isArray(d.result)?m=d.result:d.result.items&&Array.isArray(d.result.items)?m=d.result.items:d.result.data&&Array.isArray(d.result.data)&&(m=d.result.data)),m.length>0?(e.push(...m),a+=m.length,l=m.length===o):l=!1}catch(d){console.error(`Error loading tickets batch for stage ${t} (start: ${a}):`,d),l=!1}e.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(e[0],null,2)),console.log("Sample ticket keys:",Object.keys(e[0])),console.log("Sample ticket assignedById variants:",{assignedById:e[0].assignedById,assignedByIdId:e[0].assignedByIdId,ASSIGNED_BY_ID:e[0].ASSIGNED_BY_ID}));const u=e.filter(d=>{const m=d.UF_CRM_7_TYPE_PRODUCT||d.uf_crm_7_type_product||d.ufCrm7TypeProduct||d.UF_CRM_7_TYPE_PRODUCT||d.uf_crm_7_type_product;return Array.isArray(m)?m.includes(this.SECTOR_TAG):typeof m=="object"&&m!==null?m.value===this.SECTOR_TAG||m===this.SECTOR_TAG:m===this.SECTOR_TAG});return console.log(`Filtered ${u.length} tickets from ${e.length} for stage ${t} (sector tag: ${this.SECTOR_TAG})`),u}static extractUniqueEmployeeIds(t){if(!Array.isArray(t))return[];const e=new Set;return t.forEach(a=>{const o=a.assignedById||a.assignedByIdId||a.ASSIGNED_BY_ID||a.assignedById||a.assignedById&&typeof a.assignedById=="object"&&(a.assignedById.id||a.assignedById.ID)||a.assignedById&&typeof a.assignedById=="object"&&a.assignedById.value;if(o){const l=parseInt(o);l&&!isNaN(l)&&l>0&&e.add(l)}}),t.length>0&&(console.log("Sample ticket for employee extraction:",t[0]),console.log("Sample ticket assignedById variants:",{assignedById:t[0].assignedById,assignedByIdId:t[0].assignedByIdId,ASSIGNED_BY_ID:t[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(e))),Array.from(e)}static async getEmployeesByIds(t){if(!Array.isArray(t)||t.length===0)return[];try{const e=await Ge.call("user.get",{filter:{ID:t}});let a=[];return e&&e.result&&(Array.isArray(e.result)?a=e.result:console.warn("Unexpected user.get result format:",e)),a.map(o=>({id:parseInt(o.ID||o.id||0),name:`${o.NAME||o.name||""} ${o.LAST_NAME||o.lastName||""}`.trim()||o.EMAIL||o.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:o.WORK_POSITION||o.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:o.EMAIL||o.email||"",tickets:[]}))}catch(e){return console.error("Error getting employees by IDs:",e),[]}}static groupTicketsByStages(t,e){Array.isArray(t)||(console.warn("Tickets is not an array:",t),t=[]),Array.isArray(e)||(console.warn("Employees is not an array:",e),e=[]);const a=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:e.map(o=>({...o,tickets:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:e.map(o=>({...o,tickets:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:e.map(o=>({...o,tickets:[]}))}];return t.forEach(o=>{const l=this.mapStageId(o.stageId||o.STAGE_ID||""),u=a.find(d=>d.id===l);if(u){const d=o.assignedById||o.ASSIGNED_BY_ID||null,m=d?parseInt(d):null;if(m){let p=u.employees.find(S=>S.id===m);p||(p={id:m,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${m}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",tickets:[]},u.employees.push(p)),p.tickets.push(this.mapTicket(o))}}}),a}static mapStageId(t){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[t]||"formed"}static mapStageIdToBitrix(t){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[t]||"DT140_12:UC_0VHWE2"}static mapTicket(t){const e=parseInt(t.id||t.ID||0),a=t.title||t.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",o=t.stageId||t.STAGE_ID||"",l=t.assignedById||t.ASSIGNED_BY_ID||null,u=t.createdTime||t.CREATED_DATE||t.CREATED_TIME||"",d=t.updatedTime||t.MODIFY_DATE||t.UPDATED_TIME||"",m=t.UF_CRM_7_UF_PRIORITY||t.uf_crm_7_uf_priority||t.ufCrm7UfPriority||t.UF_CRM_7_UF_PRIORITY||t.uf_crm_7_uf_priority||t.priority||t.PRIORITY||null,p=At(m),S=dr(p);return{id:e,title:a,priorityId:p.id,priorityLabel:p.label,priorityColors:S,priority:p.id,priorityBitrixValue:p.bitrixValue||null,status:this.mapStatus(o),assigneeId:l?parseInt(l):null,stageId:this.mapStageId(o),createdAt:u,modifiedAt:d,amount:t.opportunity||t.OPPORTUNITY||0,currency:t.currencyId||t.CURRENCY_ID||"RUB",description:t.comments||t.COMMENTS||""}}static mapPriority(t){return At(t).id}static mapPriorityToBitrix(t){if(t&&typeof t=="object")return t.bitrixValue||null;const e=$t(t);if(e&&e.bitrixValue)return e.bitrixValue;const a={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return a[t]?a[t]:$t(ur).bitrixValue}static mapStatus(t){return"in_progress"}static getZeroPointTickets(t){const e={formed:[],review:[],execution:[]};return Array.isArray(t)?(t.filter(a=>!(a.assignedById||a.ASSIGNED_BY_ID)).forEach(a=>{const o=this.mapStageId(a.stageId||a.STAGE_ID||"");e[o]&&e[o].push(this.mapTicket(a))}),e):(console.warn("Tickets is not an array in getZeroPointTickets:",t),e)}static async assignTicket(t,e,a){try{const o=this.mapStageIdToBitrix(a);return(await Ge.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:t,fields:{assignedById:e,stageId:o}})).result===!0}catch(o){throw console.error("Error assigning ticket:",o),o}}static async createTicket(t){try{const e=await Ge.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:t.title,assignedById:t.employeeId,stageId:this.mapStageIdToBitrix(t.stageId)}});return e.result?parseInt(e.result):0}catch(e){throw console.error("Error creating ticket:",e),e}}static async getTicket(t){try{const e=await Ge.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:t});return this.mapTicket(e.result)}catch(e){throw console.error("Error getting ticket:",e),e}}static async addComment(t,e){try{return(await Ge.call("crm.timeline.comment.add",{fields:{entityId:t,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:e}})).result!==void 0}catch(a){throw console.error("Error adding comment:",a),a}}}st(it,"ENTITY_TYPE_ID",140),st(it,"SECTOR_TAG","1C");function In(s){if(!s)return null;try{const t=new Date(s);return isNaN(t.getTime())?null:t}catch{return console.warn("Invalid date format:",s),null}}function Mn(s,t){return Math.floor((s-t)/864e5)}function Un(s){return!s||isNaN(s.getTime())?!1:s<=new Date}const Ne={ONE_MONTH:"one_month",TWO_MONTHS:"two_months",MORE_THAN_HALF_YEAR:"more_than_half_year",MORE_THAN_YEAR:"more_than_year"},Pe={[Ne.ONE_MONTH]:"–û–¥–∏–Ω –º–µ—Å—è—Ü",[Ne.TWO_MONTHS]:"–î–≤–∞ –º–µ—Å—è—Ü–∞",[Ne.MORE_THAN_HALF_YEAR]:"–ë–æ–ª–µ–µ –ø–æ–ª—É–≥–æ–¥–∞",[Ne.MORE_THAN_YEAR]:"–ë–æ–ª–µ–µ –≥–æ–¥–∞"},Et={[Ne.ONE_MONTH]:30,[Ne.TWO_MONTHS]:60,[Ne.MORE_THAN_HALF_YEAR]:180,[Ne.MORE_THAN_YEAR]:365};function Ke(s,t,e=new Date){if(!Array.isArray(s))return console.warn("filterTicketsByTimePeriod: tickets must be an array"),[];if(!Et[t])return console.warn(`filterTicketsByTimePeriod: Unknown period "${t}"`),s;const a=Et[t],o=t.includes("more_than");return s.filter(l=>{try{if(!l||!l.id||!l.created_at)return console.warn("Ticket missing required fields:",l),!1;const u=In(l.created_at);if(!u)return console.warn(`Invalid date for ticket ${l.id}: ${l.created_at}`),!1;if(!Un(u))return console.warn(`Future or invalid date for ticket ${l.id}: ${l.created_at}`),!1;const d=Mn(e,u);return o?d>a:d<=a}catch(u){return console.error(`Error filtering ticket ${(l==null?void 0:l.id)||"unknown"}:`,u),!1}})}const Rn={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Pn={class:"modal"},xn={key:0,class:"modal__tabs"},Ln={key:"level-0-categories",class:"level-0"},Fn={class:"modal__header"},Gn={class:"modal__title"},Hn={key:0},Vn={class:"modal__body"},Kn={class:"categories-list"},Yn=["onClick"],jn={class:"category-item"},zn={class:"category-item__icon"},qn={key:0},Zn={key:1},Xn={class:"category-item__content"},Jn={class:"category-item__label"},Qn={class:"category-item__count"},el={key:0,class:"category-item__arrow"},tl={class:"modal__footer"},rl={key:"level-1-categories",class:"level-1"},al={class:"modal__header"},sl={class:"modal__body"},ol={key:"loading",class:"loading-names"},nl={key:"empty",class:"modal__empty"},ll={key:"list",class:"responsible-list"},il=["onClick"],cl={class:"responsible-list__name"},dl={class:"responsible-list__count"},ul={key:0,class:"responsible-list__arrow"},kl={class:"modal__footer"},vl={key:"level-2-categories",class:"level-2"},hl={class:"modal__header"},yl={class:"modal__title"},ml={class:"modal__body"},pl={class:"time-sort-controls"},gl={class:"time-sort-buttons"},fl=["onClick"],bl={class:"count"},_l={key:"loading",class:"loading-state"},wl={key:"error",class:"error-state"},Tl={class:"error-message"},Cl={key:"empty",class:"empty-state"},Wl={class:"empty-state-message"},Al={key:"tickets",class:"tickets-list-container"},$l={key:"level-0-employees",class:"level-0"},Dl={class:"modal__header"},Sl={class:"modal__title"},El={key:0},Nl={class:"modal__body"},Ol={key:"loading",class:"loading-names"},Bl={key:"empty",class:"modal__empty"},Il={key:"list",class:"responsible-list"},Ml=["onClick"],Ul={class:"responsible-list__name"},Rl={class:"responsible-list__count"},Pl={key:0,class:"responsible-list__arrow"},xl={class:"modal__footer"},Ll={key:"level-1-employees",class:"level-1"},Fl={class:"modal__header"},Gl={class:"modal__title"},Hl={class:"modal__body"},Vl={class:"categories-list"},Kl=["onClick"],Yl={class:"category-item"},jl={class:"category-item__icon"},zl={key:0},ql={key:1},Zl={class:"category-item__content"},Xl={class:"category-item__label"},Jl={class:"category-item__count"},Ql={key:0,class:"category-item__arrow"},ei={class:"modal__footer"},ti={key:"level-2-employees",class:"level-2"},ri={class:"modal__header"},ai={class:"modal__title"},si={class:"modal__body"},oi={key:"loading",class:"loading-state"},ni={key:"error",class:"error-state"},li={class:"error-message"},ii={key:"empty",class:"empty-state"},ci={class:"empty-state-message"},di={key:"tickets",class:"tickets-list-container"},ui={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(s){const t=s,e=J(0),a=J("categories"),o=J(null),l=J(null),u=J(null),d=J([]),m=J(!1),p=J(null),S=J([]),L=J([]),ee=J(!1),re=J(Ne.ONE_MONTH),B=j(()=>[{id:"created-this-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é",count:t.closedTicketsCreatedThisWeek??0,responsible:t.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ",count:t.closedTicketsCreatedOtherWeek??0,responsible:t.responsibleCreatedOtherWeek??[]}]),I=j(()=>{const D=new Map;return(t.responsibleCreatedThisWeek||[]).forEach(n=>{const i=n.id??"unassigned";D.has(i)||D.set(i,{id:n.id,name:n.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const $=D.get(i);$.thisWeekCount=n.count??0,$.thisWeekTickets=n.tickets||[],$.totalCount+=$.thisWeekCount}),(t.responsibleCreatedOtherWeek||[]).forEach(n=>{const i=n.id??"unassigned";D.has(i)||D.set(i,{id:n.id,name:n.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const $=D.get(i);$.otherWeekCount=n.count??0,$.otherWeekTickets=n.tickets||[],$.totalCount+=$.otherWeekCount}),Array.from(D.values())}),T=j(()=>{if(!l.value)return[];const D=l.value.thisWeekTickets||[],n=l.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:l.value.id,name:l.value.name,thisWeekCount:l.value.thisWeekCount,otherWeekCount:l.value.otherWeekCount,thisWeekTickets:D.length,otherWeekTickets:n.length,employee:l.value}),[{id:"this-week",label:"–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ",count:l.value.thisWeekCount??0,tickets:D,employeeId:l.value.id},{id:"other-week",label:"–ù–∞ –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ",count:l.value.otherWeekCount??0,tickets:n,employeeId:l.value.id}]}),N=j(()=>(L.value||[]).length>0),O=j(()=>{if(!d.value||d.value.length===0)return[];try{const D=performance.now(),n=Ke(d.value,re.value),i=performance.now();return console.log(`[ResponsibleModal] Filtering took ${(i-D).toFixed(2)}ms, results: ${n.length}`),n}catch(D){return console.error("[ResponsibleModal] Error filtering tickets:",D),[]}}),M=j(()=>Object.keys(Pe).map(D=>({key:D,label:Pe[D],count:Ke(d.value,D).length})));async function R(D){const n=D.filter(i=>i.id!==null&&i.id!==void 0).map(i=>i.id);if(n.length===0)return D;try{const i=await it.getEmployeesByIds(n),$=new Map;return i.forEach(E=>{$.set(E.id,E.name)}),D.map(E=>E.id&&$.has(E.id)?{...E,name:$.get(E.id)}:E)}catch(i){return console.error("[ResponsibleModal] Error enriching names:",i),D}}Me([()=>a.value,()=>I.value],async([D,n])=>{if(!(D!=="employees"||e.value!==0)){if(!n||n.length===0){L.value=[];return}ee.value=!0;try{L.value=await R(n)}catch(i){console.error("[ResponsibleModal] Error loading employee names:",i),L.value=n}finally{ee.value=!1}}},{immediate:!0}),Me(()=>t.responsible,async D=>{if(!(e.value!==0||o.value||a.value!=="categories")){if(!D||D.length===0){S.value=[];return}ee.value=!0;try{S.value=await R(D)}catch(n){console.error("[ResponsibleModal] Error loading employee names:",n),S.value=D}finally{ee.value=!1}}},{immediate:!1});const g=j(()=>(S.value||[]).length>0);function c(D){a.value!==D&&(a.value=D,e.value=0,o.value=null,l.value=null,u.value=null,d.value=[],p.value=null,S.value=[],L.value=[])}async function P(D){var n,i,$;if(!D||D.count===0){console.warn("[ResponsibleModal] handleCategoryClick: Invalid category or count is 0",{category:D,count:D==null?void 0:D.count});return}console.log("[ResponsibleModal] handleCategoryClick called:",{categoryId:D.id,categoryLabel:D.label,categoryCount:D.count,responsibleCount:((n=D.responsible)==null?void 0:n.length)||0,responsibleWithTickets:((i=D.responsible)==null?void 0:i.filter(E=>E.tickets&&E.tickets.length>0).length)||0,responsibleSample:($=D.responsible)==null?void 0:$.slice(0,2).map(E=>{var G;return{id:E.id,name:E.name,count:E.count,hasTickets:!!E.tickets,ticketsCount:((G=E.tickets)==null?void 0:G.length)||0}})}),o.value=D,e.value=1,ee.value=!0;try{S.value=await R(D.responsible),console.log("[ResponsibleModal] After enrichResponsibleWithNames:",{enrichedCount:S.value.length,enrichedSample:S.value.slice(0,2).map(E=>{var G;return{id:E.id,name:E.name,count:E.count,hasTickets:!!E.tickets,ticketsCount:((G=E.tickets)==null?void 0:G.length)||0}})})}catch(E){console.error("[ResponsibleModal] Error loading employee names:",E),S.value=D.responsible}finally{ee.value=!1}}async function b(D,n=null){var i,$;!D||!D.id||D.totalCount===0||(n&&n.currentTarget&&(n.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{n.currentTarget&&(n.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:D.id,name:D.name,thisWeekCount:D.thisWeekCount,otherWeekCount:D.otherWeekCount,thisWeekTickets:((i=D.thisWeekTickets)==null?void 0:i.length)||0,otherWeekTickets:(($=D.otherWeekTickets)==null?void 0:$.length)||0,employee:D}),l.value={...D,thisWeekTickets:D.thisWeekTickets||[],otherWeekTickets:D.otherWeekTickets||[]},e.value=1)}async function U(D){var i;if(!D||D.count===0)return;u.value=D,e.value=2;const n=D.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:D.id,label:D.label,count:D.count,ticketsInGradation:n.length,selectedEmployee:(i=l.value)==null?void 0:i.id}),n.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",n.length),await H(n)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await F(D))}async function H(D){m.value=!0,p.value=null;try{try{const{prepareTicketsForDisplay:n}=await Re(async()=>{const{prepareTicketsForDisplay:i}=await import("./ticketListUtils-XuGHwEFL.js").then($=>$.t);return{prepareTicketsForDisplay:i}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);d.value=await n(D,null,null)}catch(n){console.error("[ResponsibleModal] Error preparing tickets:",n),d.value=D}d.value.length===0&&(p.value=null)}catch(n){p.value=n.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",n),d.value=[]}finally{m.value=!1}}async function F(D){m.value=!0,p.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc||!l.value)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫");const n=await Oe({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeTickets:!0}),i=D.id==="this-week"?n.data.responsibleCreatedThisWeek:n.data.responsibleCreatedOtherWeek,$=i==null?void 0:i.find(G=>G.id===l.value.id),E=($==null?void 0:$.tickets)||[];try{const{prepareTicketsForDisplay:G}=await Re(async()=>{const{prepareTicketsForDisplay:w}=await import("./ticketListUtils-XuGHwEFL.js").then(V=>V.t);return{prepareTicketsForDisplay:w}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);d.value=await G(E,null,null)}catch(G){console.error("[ResponsibleModal] Error preparing tickets:",G),d.value=E}d.value.length===0&&(p.value=null)}catch(n){p.value=n.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets from API:",n),d.value=[]}finally{m.value=!1}}async function x(D,n=null){!D||!D.id||D.count===0||(n&&n.currentTarget&&(n.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{n.currentTarget&&(n.currentTarget.style.transform="")},150)),l.value=D,e.value=2,await z(D.id))}async function z(D){var n,i,$,E,G,w,V,oe,_,v,K,k,h,Y,te,le,se;m.value=!0,p.value=null;try{let Z=[];if(console.log("[ResponsibleModal] loadEmployeeTickets called:",{employeeId:D,selectedCategory:(n=o.value)==null?void 0:n.id,hasSelectedCategory:!!o.value,hasResponsible:!!((i=o.value)!=null&&i.responsible),responsibleCount:((E=($=o.value)==null?void 0:$.responsible)==null?void 0:E.length)||0,categoryData:o.value?{id:o.value.id,label:o.value.label,count:o.value.count,responsibleSample:(G=o.value.responsible)==null?void 0:G.slice(0,2).map(W=>{var ie;return{id:W.id,name:W.name,count:W.count,hasTickets:!!W.tickets,ticketsCount:((ie=W.tickets)==null?void 0:ie.length)||0}})}:null}),o.value&&o.value.responsible){const W=o.value.responsible.find(ie=>ie.id===D);console.log("[ResponsibleModal] Employee found in category:",{employee:W,hasTickets:!!(W!=null&&W.tickets),ticketsCount:((w=W==null?void 0:W.tickets)==null?void 0:w.length)||0,tickets:W!=null&&W.tickets?W.tickets.slice(0,2):null}),Z=(W==null?void 0:W.tickets)||[]}if(Z.length===0&&t.weekStartUtc&&t.weekEndUtc){console.log("[ResponsibleModal] Tickets not found in category, loading from API",{weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,categoryId:(V=o.value)==null?void 0:V.id});const W=await Oe({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeTickets:!0});console.log("[ResponsibleModal] API response:",{hasResponsibleCreatedThisWeek:!!W.data.responsibleCreatedThisWeek,hasResponsibleCreatedOtherWeek:!!W.data.responsibleCreatedOtherWeek,thisWeekCount:((oe=W.data.responsibleCreatedThisWeek)==null?void 0:oe.length)||0,otherWeekCount:((_=W.data.responsibleCreatedOtherWeek)==null?void 0:_.length)||0,thisWeekSample:(v=W.data.responsibleCreatedThisWeek)==null?void 0:v.slice(0,1).map(de=>{var X;return{id:de.id,name:de.name,count:de.count,hasTickets:!!de.tickets,ticketsCount:((X=de.tickets)==null?void 0:X.length)||0}}),otherWeekSample:(K=W.data.responsibleCreatedOtherWeek)==null?void 0:K.slice(0,1).map(de=>{var X;return{id:de.id,name:de.name,count:de.count,hasTickets:!!de.tickets,ticketsCount:((X=de.tickets)==null?void 0:X.length)||0}})});const ie=((k=o.value)==null?void 0:k.id)==="created-this-week"?W.data.responsibleCreatedThisWeek:W.data.responsibleCreatedOtherWeek;console.log("[ResponsibleModal] Category data:",{categoryId:(h=o.value)==null?void 0:h.id,categoryDataCount:(ie==null?void 0:ie.length)||0,categoryDataSample:ie==null?void 0:ie.slice(0,2).map(de=>{var X;return{id:de.id,name:de.name,count:de.count,hasTickets:!!de.tickets,ticketsCount:((X=de.tickets)==null?void 0:X.length)||0}})});const ye=ie==null?void 0:ie.find(de=>de.id===D);console.log("[ResponsibleModal] Employee found in API response:",{employee:ye?{id:ye.id,name:ye.name,count:ye.count,hasTickets:!!ye.tickets,ticketsCount:((Y=ye.tickets)==null?void 0:Y.length)||0,ticketsSample:(te=ye.tickets)==null?void 0:te.slice(0,2)}:null}),Z=(ye==null?void 0:ye.tickets)||[]}console.log("[ResponsibleModal] Final employeeTickets before prepareTicketsForDisplay:",{ticketsCount:Z.length,ticketsSample:Z.slice(0,2).map(W=>({id:W.id,title:W.title||W.ufSubject||"No title",stageId:W.stageId}))});try{const{prepareTicketsForDisplay:W}=await Re(async()=>{const{prepareTicketsForDisplay:ie}=await import("./ticketListUtils-XuGHwEFL.js").then(ye=>ye.t);return{prepareTicketsForDisplay:ie}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);d.value=await W(Z,null,null),console.log("[ResponsibleModal] Tickets after prepareTicketsForDisplay:",{ticketsCount:d.value.length,ticketsSample:d.value.slice(0,2).map(ie=>({id:ie.id,title:ie.title||ie.ufSubject||"No title",stageId:ie.stageId}))})}catch(W){console.error("[ResponsibleModal] Error preparing tickets:",W),console.error("[ResponsibleModal] prepareError details:",{message:W.message,stack:W.stack,employeeTicketsCount:Z.length}),d.value=Z,console.log("[ResponsibleModal] Using fallback tickets (without enrichment):",d.value.length)}d.value.length===0?(console.warn("[ResponsibleModal] No tickets after loading and preparation",{employeeId:D,categoryId:(le=o.value)==null?void 0:le.id,employeeTicketsCount:Z.length,finalTicketsCount:d.value.length}),p.value=null):console.log("[ResponsibleModal] Successfully loaded tickets:",d.value.length)}catch(Z){p.value=Z.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",Z),console.error("[ResponsibleModal] Error details:",{message:Z.message,stack:Z.stack,employeeId:D,categoryId:(se=o.value)==null?void 0:se.id}),d.value=[]}finally{m.value=!1}}function q(){e.value===2?(e.value=1,a.value==="categories"?l.value=null:u.value=null,d.value=[],p.value=null):e.value===1&&(e.value=0,a.value==="categories"?(o.value=null,S.value=[]):l.value=null)}function ae(D){console.log(`[ResponsibleModal] Sort mode changed: ${re.value} -> ${D}`);const n=performance.now();re.value=D,setTimeout(()=>{const i=O.value,$=performance.now();console.log(`[ResponsibleModal] Filtering completed in ${($-n).toFixed(2)}ms, ${i.length} tickets shown`)},0)}function ve(D){const n=dt(D.id);window.open(n,"_blank")}function fe(){a.value==="employees"&&u.value?H(u.value.tickets):a.value==="categories"&&l.value&&z(l.value.id)}return Me(()=>t.isVisible,D=>{if(D){console.log("[TASK-070] ResponsibleModal opened for week",t.weekNumber),console.log("[TASK-070] ResponsibleModal props types:",{responsibleCreatedThisWeekType:typeof t.responsibleCreatedThisWeek,responsibleCreatedThisWeekIsArray:Array.isArray(t.responsibleCreatedThisWeek),responsibleCreatedThisWeekLength:Array.isArray(t.responsibleCreatedThisWeek)?t.responsibleCreatedThisWeek.length:"not array",responsibleCreatedOtherWeekType:typeof t.responsibleCreatedOtherWeek,responsibleCreatedOtherWeekIsArray:Array.isArray(t.responsibleCreatedOtherWeek),responsibleCreatedOtherWeekLength:Array.isArray(t.responsibleCreatedOtherWeek)?t.responsibleCreatedOtherWeek.length:"not array"}),console.log("[TASK-070] ResponsibleModal data:",{weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,responsibleCreatedThisWeek:Array.isArray(t.responsibleCreatedThisWeek)?t.responsibleCreatedThisWeek.length:t.responsibleCreatedThisWeek?"not array":"null/undefined",responsibleCreatedOtherWeek:Array.isArray(t.responsibleCreatedOtherWeek)?t.responsibleCreatedOtherWeek.length:t.responsibleCreatedOtherWeek?"not array":"null/undefined",closedTicketsCreatedThisWeek:t.closedTicketsCreatedThisWeek,closedTicketsCreatedOtherWeek:t.closedTicketsCreatedOtherWeek}),console.log("[TASK-070] ResponsibleModal detailed data:",{responsibleCreatedThisWeek:t.responsibleCreatedThisWeek,responsibleCreatedOtherWeek:t.responsibleCreatedOtherWeek,responsibleCreatedThisWeekWithTickets:Array.isArray(t.responsibleCreatedThisWeek)?t.responsibleCreatedThisWeek.map(i=>{var $;return{id:i.id,name:i.name,count:i.count,hasTickets:!!i.tickets,ticketsCount:(($=i.tickets)==null?void 0:$.length)||0}}):"not array or null",responsibleCreatedOtherWeekWithTickets:Array.isArray(t.responsibleCreatedOtherWeek)?t.responsibleCreatedOtherWeek.map(i=>{var $;return{id:i.id,name:i.name,count:i.count,hasTickets:!!i.tickets,ticketsCount:(($=i.tickets)==null?void 0:$.length)||0}}):"not array or null"});const n=t.weekNumber;n&&console.log("[TASK-070] ResponsibleModal: Week number",n)}else e.value=0,a.value="categories",o.value=null,l.value=null,u.value=null,d.value=[],p.value=null,S.value=[],L.value=[]}),(D,n)=>s.isVisible?(y(),f("div",Rn,[r("div",Pn,[e.value===0?(y(),f("div",xn,[r("button",{class:pe(["modal__tab",{"modal__tab--active":a.value==="categories"}]),onClick:n[0]||(n[0]=i=>c("categories"))}," –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º ",2),r("button",{class:pe(["modal__tab",{"modal__tab--active":a.value==="employees"}]),onClick:n[1]||(n[1]=i=>c("employees"))}," –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º ",2)])):ne("",!0),ke($e,{name:"level",mode:"out-in"},{default:ge(()=>{var i,$,E,G;return[a.value==="categories"&&e.value===0?(y(),f("div",Ln,[r("header",Fn,[r("h3",Gn,[n[12]||(n[12]=Te(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s.weekNumber?(y(),f("span",Hn," ¬∑ –ù–µ–¥–µ–ª—è "+C(s.weekNumber),1)):ne("",!0)]),r("button",{class:"modal__close",onClick:n[2]||(n[2]=w=>D.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",Vn,[r("ul",Kn,[(y(!0),f(he,null,me(B.value,w=>(y(),f("li",{key:w.id,class:pe(["categories-list__item",{"categories-list__item--clickable":w.count>0}]),onClick:V=>P(w)},[r("div",jn,[r("div",zn,[w.id==="created-this-week"?(y(),f("span",qn,"‚úì")):(y(),f("span",Zn,"‚Üª"))]),r("div",Xn,[r("div",Jn,C(w.label),1),r("div",Qn,C(w.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),w.count>0?(y(),f("span",el,"‚Üí")):ne("",!0)])],10,Yn))),128))])]),r("footer",tl,[r("button",{class:"btn",onClick:n[3]||(n[3]=w=>D.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value==="categories"&&e.value===1?(y(),f("div",rl,[r("header",al,[r("button",{class:"btn-back",onClick:q,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),n[13]||(n[13]=r("h3",{class:"modal__title"},"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),r("button",{class:"modal__close",onClick:n[4]||(n[4]=w=>D.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",sl,[ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>[ee.value?(y(),f("div",ol,[...n[14]||(n[14]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):g.value?(y(),f("ul",ll,[(y(!0),f(he,null,me(S.value,w=>(y(),f("li",{key:w.id||w.name,class:pe(["responsible-list__item",{"responsible-list__item--clickable":w.id&&w.count>0}]),onClick:V=>x(w,V),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[r("span",cl,C(w.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),r("span",dl,C(w.count??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),w.id&&w.count>0?(y(),f("span",ul,"‚Üí")):ne("",!0)],10,il))),128))])):(y(),f("p",nl,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º"))]),_:1})]),r("footer",kl,[r("button",{class:"btn",onClick:n[5]||(n[5]=w=>D.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value==="categories"&&e.value===2?(y(),f("div",vl,[r("header",hl,[r("button",{class:"btn-back",onClick:q,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),r("h3",yl,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+C(((i=l.value)==null?void 0:i.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),r("button",{class:"modal__close",onClick:n[6]||(n[6]=w=>D.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",ml,[r("div",pl,[n[15]||(n[15]=r("h4",{class:"time-sort-title"},"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–∏–∫–µ—Ç—ã:",-1)),r("div",gl,[(y(!0),f(he,null,me(M.value,w=>(y(),f("button",{key:w.key,class:pe(["time-sort-btn",{active:re.value===w.key}]),onClick:V=>ae(w.key)},[Te(C(w.label)+" ",1),r("span",bl,"("+C(w.count)+")",1)],10,fl))),128))])]),ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>[m.value?(y(),f("div",_l,[...n[16]||(n[16]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):p.value?(y(),f("div",wl,[n[17]||(n[17]=r("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),n[18]||(n[18]=r("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),r("p",Tl,C(p.value),1),r("button",{class:"btn btn-retry",onClick:fe},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):O.value.length===0?(y(),f("div",Cl,[n[19]||(n[19]=r("div",{class:"empty-state-icon"},"üìã",-1)),r("p",Wl," –£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ("+C(Fe(Pe)[re.value])+") ",1)])):(y(),f("div",Al,[ke(rt,{name:"ticket",tag:"div",class:"tickets-list"},{default:ge(()=>[(y(!0),f(he,null,me(O.value,(w,V)=>(y(),Ee(at,{key:w.id,ticket:w,draggable:!1,style:Ue({"--ticket-index":V}),onClick:ve},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):a.value==="employees"&&e.value===0?(y(),f("div",$l,[r("header",Dl,[r("h3",Sl,[n[20]||(n[20]=Te(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s.weekNumber?(y(),f("span",El," ¬∑ –ù–µ–¥–µ–ª—è "+C(s.weekNumber),1)):ne("",!0)]),r("button",{class:"modal__close",onClick:n[7]||(n[7]=w=>D.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",Nl,[ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>[ee.value?(y(),f("div",Ol,[...n[21]||(n[21]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):N.value?(y(),f("ul",Il,[(y(!0),f(he,null,me(L.value,w=>(y(),f("li",{key:w.id||w.name,class:pe(["responsible-list__item",{"responsible-list__item--clickable":w.id&&w.totalCount>0}]),onClick:V=>b(w,V),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞–¥–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[r("span",Ul,C(w.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),r("span",Rl,C(w.totalCount??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),w.id&&w.totalCount>0?(y(),f("span",Pl,"‚Üí")):ne("",!0)],10,Ml))),128))])):(y(),f("p",Bl,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"))]),_:1})]),r("footer",xl,[r("button",{class:"btn",onClick:n[8]||(n[8]=w=>D.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value==="employees"&&e.value===1?(y(),f("div",Ll,[r("header",Fl,[r("button",{class:"btn-back",onClick:q,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),r("h3",Gl,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+C((($=l.value)==null?void 0:$.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),r("button",{class:"modal__close",onClick:n[9]||(n[9]=w=>D.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",Hl,[r("ul",Vl,[(y(!0),f(he,null,me(T.value,w=>(y(),f("li",{key:w.id,class:pe(["categories-list__item",{"categories-list__item--clickable":w.count>0}]),onClick:V=>U(w)},[r("div",Yl,[r("div",jl,[w.id==="this-week"?(y(),f("span",zl,"‚úì")):(y(),f("span",ql,"‚Üª"))]),r("div",Zl,[r("div",Xl,C(w.label),1),r("div",Jl,C(w.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),w.count>0?(y(),f("span",Ql,"‚Üí")):ne("",!0)])],10,Kl))),128))])]),r("footer",ei,[r("button",{class:"btn",onClick:n[10]||(n[10]=w=>D.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value==="employees"&&e.value===2?(y(),f("div",ti,[r("header",ri,[r("button",{class:"btn-back",onClick:q,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),r("h3",ai," –¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+C(((E=l.value)==null?void 0:E.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")+" ("+C(((G=u.value)==null?void 0:G.label)||"")+") ",1),r("button",{class:"modal__close",onClick:n[11]||(n[11]=w=>D.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",si,[ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>{var w;return[m.value?(y(),f("div",oi,[...n[22]||(n[22]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):p.value?(y(),f("div",ni,[n[23]||(n[23]=r("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),n[24]||(n[24]=r("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),r("p",li,C(p.value),1),r("button",{class:"btn btn-retry",onClick:fe},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):d.value.length===0?(y(),f("div",ii,[n[25]||(n[25]=r("div",{class:"empty-state-icon"},"üìã",-1)),r("p",ci,C(a.value==="employees"?`–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${((w=u.value)==null?void 0:w.label)||""}"`:"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é"),1)])):(y(),f("div",di,[ke(rt,{name:"ticket",tag:"div",class:"tickets-list"},{default:ge(()=>[(y(!0),f(he,null,me(O.value,(V,oe)=>(y(),Ee(at,{key:V.id,ticket:V,draggable:!1,style:Ue({"--ticket-index":oe}),onClick:ve},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):ne("",!0)]}),_:1})])])):ne("",!0)}},ki=Be(ui,[["__scopeId","data-v-6f43202a"]]),vi={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},hi={class:"modal"},yi={key:"level-1",class:"level-1"},mi={class:"modal__header"},pi={class:"modal__title"},gi={key:0},fi={class:"modal__body"},bi={key:"loading",class:"loading-names"},_i={key:"empty",class:"modal__empty"},wi={key:"list",class:"stages-list"},Ti=["onClick"],Ci={class:"stages-list__name"},Wi={class:"stages-list__count"},Ai={key:0,class:"stages-list__arrow"},$i={class:"modal__footer"},Di={key:"level-2",class:"level-2"},Si={class:"modal__header"},Ei={class:"modal__title"},Ni={class:"modal__body"},Oi={class:"time-sort-controls"},Bi={class:"time-sort-buttons"},Ii=["onClick"],Mi={class:"count"},Ui={key:"loading",class:"loading-state"},Ri={key:"error",class:"error-state"},Pi={class:"error-message"},xi={key:"empty",class:"empty-state"},Li={class:"empty-state-message"},Fi={key:"tickets",class:"tickets-list-container"},Gi={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(s,{emit:t}){const e=s,a=J(1),o=J(null),l=J([]),u=J(!1),d=J(!1),m=J(null),p=J([]),S=J(Ne.ONE_MONTH),L=j(()=>p.value.length>0&&p.value.some(g=>g.count>0)),ee=j(()=>{if(!l.value||l.value.length===0)return[];try{const g=performance.now(),c=Ke(l.value,S.value),P=performance.now();return console.log(`[StagesModal] Filtering took ${(P-g).toFixed(2)}ms, results: ${c.length}`),c}catch(g){return console.error("[StagesModal] Error filtering tickets:",g),[]}}),re=j(()=>Object.keys(Pe).map(g=>({key:g,label:Pe[g],count:Ke(l.value,g).length})));async function B(){var g;if(console.log("[TASK-070] StagesModal: loadStages called",{weekNumber:e.weekNumber,weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc}),!e.weekStartUtc||!e.weekEndUtc){console.warn("[TASK-070] StagesModal: Missing week boundaries, cannot load stages"),p.value=[];return}d.value=!0,m.value=null;try{console.log("[TASK-070] StagesModal: Fetching stages from API...");const c=await Oe({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeNewTicketsByStages:!0});console.log("[TASK-070] StagesModal: API response received",{hasNewTicketsByStages:!!c.data.newTicketsByStages,stagesCount:((g=c.data.newTicketsByStages)==null?void 0:g.length)||0}),p.value=c.data.newTicketsByStages||[],p.value.length===0?console.warn("[TASK-070] StagesModal: API returned empty stages array for week",e.weekNumber):console.log("[TASK-070] StagesModal: Stages loaded successfully",p.value.length,"stages")}catch(c){m.value=c.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–π",console.error("[TASK-070] StagesModal: Error loading stages:",c),p.value=[]}finally{d.value=!1}}async function I(g,c=null){!g||g.count===0||(c&&c.currentTarget&&(c.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{c.currentTarget&&(c.currentTarget.style.transform="")},150)),o.value=g,a.value=2,await T(g.stageId))}async function T(g){var c;u.value=!0,m.value=null;try{const P=p.value.find(F=>F.stageId===g);if(P&&Array.isArray(P.tickets)&&P.tickets.length>0){console.log("[TASK-070] StagesModal: Using preloaded tickets for stage",g,"count:",P.tickets.length);const F=P.tickets;try{const{prepareTicketsForDisplay:x}=await Re(async()=>{const{prepareTicketsForDisplay:z}=await import("./ticketListUtils-XuGHwEFL.js").then(q=>q.t);return{prepareTicketsForDisplay:z}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);l.value=await x(F,null,null)}catch(x){console.error("[TASK-070] StagesModal: Error preparing tickets:",x),l.value=F}u.value=!1;return}if(console.log("[TASK-070] StagesModal: Tickets not preloaded, loading from API for stage",g),!e.weekStartUtc||!e.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const U=(c=(await Oe({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:c.find(F=>F.stageId===g),H=(U==null?void 0:U.tickets)||[];try{const{prepareTicketsForDisplay:F}=await Re(async()=>{const{prepareTicketsForDisplay:x}=await import("./ticketListUtils-XuGHwEFL.js").then(z=>z.t);return{prepareTicketsForDisplay:x}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);l.value=await F(H,null,null)}catch(F){console.error("[StagesModal] Error preparing tickets:",F),l.value=H}l.value.length===0&&(m.value=null)}catch(P){m.value=P.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[StagesModal] Error loading tickets:",P),l.value=[]}finally{u.value=!1}}function N(){a.value=1,o.value=null,l.value=[],m.value=null}function O(g){const c=dt(g.id);window.open(c,"_blank")}function M(){o.value&&T(o.value.stageId)}function R(g){console.log(`[StagesModal] Sort mode changed: ${S.value} -> ${g}`);const c=performance.now();S.value=g,setTimeout(()=>{const P=ee.value,b=performance.now();console.log(`[StagesModal] Filtering completed in ${(b-c).toFixed(2)}ms, ${P.length} tickets shown`)},0)}return Me(()=>e.isVisible,async g=>{g?(a.value=1,o.value=null,l.value=[],m.value=null,console.log("[TASK-070] StagesModal opened:",{weekNumber:e.weekNumber,weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,preloadedData:e.preloadedData?Array.isArray(e.preloadedData)?`Array(${e.preloadedData.length})`:typeof e.preloadedData:"null"}),e.preloadedData&&Array.isArray(e.preloadedData)&&e.preloadedData.length>0?(console.log("[TASK-070] StagesModal: Using preloaded data, stages count:",e.preloadedData.length),e.preloadedData.every(P=>P.stageId&&P.stageName&&typeof P.count=="number")?(p.value=e.preloadedData,d.value=!1,console.log("[TASK-070] StagesModal: Preloaded data set, stages:",p.value.length)):(console.warn("[TASK-070] StagesModal: Invalid preloaded data structure, falling back to API"),await B())):(console.log("[TASK-070] StagesModal: No preloaded data, loading from API",{weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc}),await B())):(a.value=1,o.value=null,l.value=[],m.value=null,p.value=[])},{immediate:!1}),Me([()=>e.weekNumber,()=>e.preloadedData],async([g,c])=>{e.isVisible&&g&&(c&&Array.isArray(c)&&c.length>0?c.every(b=>b.stageId&&b.stageName&&typeof b.count=="number")?(console.log("[TASK-070] StagesModal: Week changed, updating with preloaded data for week",g),p.value=c,d.value=!1):(console.log("[TASK-070] StagesModal: Week changed, invalid preloaded data, loading from API for week",g),await B()):(console.log("[TASK-070] StagesModal: Week changed, loading from API for week",g),await B()))}),(g,c)=>s.isVisible?(y(),f("div",vi,[r("div",hi,[ke($e,{name:"level",mode:"out-in"},{default:ge(()=>{var P;return[a.value===1?(y(),f("div",yi,[r("header",mi,[r("h3",pi,[c[3]||(c[3]=Te(" –ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),s.weekNumber?(y(),f("span",gi," ¬∑ –ù–µ–¥–µ–ª—è "+C(s.weekNumber),1)):ne("",!0)]),r("button",{class:"modal__close",onClick:c[0]||(c[0]=b=>g.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",fi,[ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>[d.value?(y(),f("div",bi,[...c[4]||(c[4]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–π...",-1)])])):L.value?(y(),f("ul",wi,[(y(!0),f(he,null,me(p.value,b=>(y(),f("li",{key:b.stageId,class:pe(["stages-list__item",{"stages-list__item--clickable":b.count>0}]),style:Ue({"--stage-color":b.color}),onClick:U=>I(b,U),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏"},[r("span",{class:"stages-list__color",style:Ue({backgroundColor:b.color})},null,4),r("span",Ci,C(b.stageName),1),r("span",Wi,C(b.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),b.count>0?(y(),f("span",Ai,"‚Üí")):ne("",!0)],14,Ti))),128))])):(y(),f("p",_i," –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),r("footer",$i,[r("button",{class:"btn",onClick:c[1]||(c[1]=b=>g.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value===2?(y(),f("div",Di,[r("header",Si,[r("button",{class:"btn-back",onClick:N,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),r("h3",Ei," –¢–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏: "+C(((P=o.value)==null?void 0:P.stageName)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),r("button",{class:"modal__close",onClick:c[2]||(c[2]=b=>g.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",Ni,[r("div",Oi,[c[5]||(c[5]=r("h4",{class:"time-sort-title"},"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–∏–∫–µ—Ç—ã:",-1)),r("div",Bi,[(y(!0),f(he,null,me(re.value,b=>(y(),f("button",{key:b.key,class:pe(["time-sort-btn",{active:S.value===b.key}]),onClick:U=>R(b.key)},[Te(C(b.label)+" ",1),r("span",Mi,"("+C(b.count)+")",1)],10,Ii))),128))])]),ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>{var b;return[u.value?(y(),f("div",Ui,[...c[6]||(c[6]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏...",-1),r("p",{class:"loading-subtitle"},"–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö",-1)])])):m.value?(y(),f("div",Ri,[c[7]||(c[7]=r("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),c[8]||(c[8]=r("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),r("p",Pi,C(m.value),1),r("button",{class:"btn btn-retry",onClick:M},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):ee.value.length===0?(y(),f("div",xi,[c[9]||(c[9]=r("div",{class:"empty-state-icon"},"üìã",-1)),r("p",Li," –ù–∞ —Å—Ç–∞–¥–∏–∏ ¬´"+C((b=o.value)==null?void 0:b.stageName)+"¬ª –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ("+C(Fe(Pe)[S.value])+") ",1)])):(y(),f("div",Fi,[ke(rt,{name:"ticket",tag:"div",class:"tickets-list"},{default:ge(()=>[(y(!0),f(he,null,me(ee.value,(U,H)=>(y(),Ee(at,{key:U.id,ticket:U,draggable:!1,style:Ue({"--ticket-index":H}),onClick:O},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):ne("",!0)]}),_:1})])])):ne("",!0)}},Hi=Be(Gi,[["__scopeId","data-v-0dacaef9"]]),Ve=new Map,Vi=5*60*1e3;function Ki(s,t){return`${s}:${JSON.stringify(t)}`}function Nt(s){return Date.now()-s.timestamp<Vi}function Yi(s,t){if(Ve.set(s,{data:t,timestamp:Date.now()}),Ve.size>20){const e=Ve.keys().next().value;Ve.delete(e)}}function ji(s){const t=Ve.get(s);return t&&Nt(t)?(console.log("[API-CACHE] Cache hit for key:",s),t.data):(t&&!Nt(t)&&(console.log("[API-CACHE] Cache expired for key:",s),Ve.delete(s)),null)}async function zi(s={}){const t="/api/graph-1c-admission-closure.php",e=Ki(t,s),a=ji(t);if(a)return a;console.log("[API-CACHE] Cache miss, making API request for:",e);const{fetchAdmissionClosureStats:o}=await Re(async()=>{const{fetchAdmissionClosureStats:u}=await Promise.resolve().then(()=>_n);return{fetchAdmissionClosureStats:u}},void 0,import.meta.url),l=await o(s);return Yi(e,l),l}async function qi(s,t){return zi({product:"1C",weekStartUtc:s,weekEndUtc:t,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})}const Zi={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Xi={class:"modal"},Ji={key:"level-1",class:"level-1"},Qi={class:"modal__header"},ec={class:"modal__title"},tc={key:0},rc={class:"modal__body"},ac={key:"loading",class:"loading-names"},sc={key:"empty",class:"modal__empty"},oc={key:"list",class:"duration-list"},nc=["onClick"],lc={class:"duration-list__name"},ic={class:"duration-list__count"},cc={key:0,class:"duration-list__arrow"},dc={class:"modal__footer"},uc={key:"level-2",class:"level-2"},kc={class:"modal__header"},vc={class:"modal__title"},hc={class:"modal__body"},yc={class:"time-sort-controls"},mc={class:"time-sort-buttons"},pc=["onClick"],gc={class:"count"},fc={key:"loading",class:"loading-state"},bc={key:"error",class:"error-state"},_c={class:"error-message"},wc={key:"empty",class:"empty-state"},Tc={class:"empty-state-message"},Cc={key:"tickets",class:"tickets-list-container"},Wc={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(s,{emit:t}){const e=s,a=J(1),o=J(null),l=J([]),u=J(!1),d=J(!1),m=J(null),p=J([]),S=J(Ne.ONE_MONTH),L=j(()=>p.value.length>0&&p.value.some(g=>g.count>0)),ee=j(()=>{if(!l.value||l.value.length===0)return[];try{const g=performance.now(),c=Ke(l.value,S.value),P=performance.now();return console.log(`[CarryoverDurationModal] Filtering took ${(P-g).toFixed(2)}ms, results: ${c.length}`),c}catch(g){return console.error("[CarryoverDurationModal] Error filtering tickets:",g),[]}}),re=j(()=>Object.keys(Pe).map(g=>({key:g,label:Pe[g],count:Ke(l.value,g).length})));async function B(){if(!e.weekStartUtc||!e.weekEndUtc){p.value=[];return}d.value=!0,m.value=null;try{const g=await Oe({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});p.value=g.data.carryoverTicketsByDuration||[]}catch(g){m.value=g.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π",console.error("[CarryoverDurationModal] Error loading categories:",g),p.value=[]}finally{d.value=!1}}async function I(g,c=null){!g||g.count===0||(c&&c.currentTarget&&(c.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{c.currentTarget&&(c.currentTarget.style.transform="")},150)),o.value=g,a.value=2,await T(g.durationCategory))}async function T(g){var c;u.value=!0,m.value=null;try{const P=p.value.find(F=>F.durationCategory===g);if(P&&Array.isArray(P.tickets)&&P.tickets.length>0){console.log("[TASK-070] CarryoverDurationModal: Using preloaded tickets for category",g,"count:",P.tickets.length);const F=P.tickets;try{const{prepareTicketsForDisplay:x}=await Re(async()=>{const{prepareTicketsForDisplay:z}=await import("./ticketListUtils-XuGHwEFL.js").then(q=>q.t);return{prepareTicketsForDisplay:z}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);l.value=await x(F,null,null)}catch(x){console.error("[TASK-070] CarryoverDurationModal: Error preparing tickets:",x),l.value=F}u.value=!1;return}if(console.log("[TASK-070] CarryoverDurationModal: Tickets not preloaded, loading from API for category",g),!e.weekStartUtc||!e.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const U=(c=(await qi(e.weekStartUtc,e.weekEndUtc)).data.carryoverTicketsByDuration)==null?void 0:c.find(F=>F.durationCategory===g),H=(U==null?void 0:U.tickets)||[];try{const{prepareTicketsForDisplay:F}=await Re(async()=>{const{prepareTicketsForDisplay:x}=await import("./ticketListUtils-XuGHwEFL.js").then(z=>z.t);return{prepareTicketsForDisplay:x}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);l.value=await F(H,null,null)}catch(F){console.error("[CarryoverDurationModal] Error preparing tickets:",F),l.value=H}l.value.length===0&&(m.value=null)}catch(P){m.value=P.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[CarryoverDurationModal] Error loading tickets:",P),l.value=[]}finally{u.value=!1}}function N(){a.value=1,o.value=null,l.value=[],m.value=null}function O(g){console.log(`[CarryoverDurationModal] Sort mode changed: ${S.value} -> ${g}`);const c=performance.now();S.value=g,setTimeout(()=>{const P=ee.value,b=performance.now();console.log(`[CarryoverDurationModal] Filtering completed in ${(b-c).toFixed(2)}ms, ${P.length} tickets shown`)},0)}function M(g){const c=dt(g.id);window.open(c,"_blank")}function R(){o.value&&T(o.value.durationCategory)}return Me(()=>e.isVisible,async g=>{g?(a.value=1,o.value=null,l.value=[],m.value=null,e.preloadedData&&Array.isArray(e.preloadedData)&&e.preloadedData.length>0?(console.log("[TASK-070] CarryoverDurationModal: Using preloaded data, categories count:",e.preloadedData.length),e.preloadedData.every(P=>P.durationCategory&&P.durationLabel&&typeof P.count=="number")?(p.value=e.preloadedData,d.value=!1):(console.warn("[TASK-070] CarryoverDurationModal: Invalid preloaded data structure, falling back to API"),await B())):(console.log("[TASK-070] CarryoverDurationModal: No preloaded data, loading from API"),await B())):(a.value=1,o.value=null,l.value=[],m.value=null,p.value=[])},{immediate:!1}),Me([()=>e.weekNumber,()=>e.preloadedData],async([g,c])=>{e.isVisible&&g&&(c&&Array.isArray(c)&&c.length>0?c.every(b=>b.durationCategory&&b.durationLabel&&typeof b.count=="number")?(console.log("[TASK-070] CarryoverDurationModal: Week changed, updating with preloaded data for week",g),p.value=c,d.value=!1):(console.log("[TASK-070] CarryoverDurationModal: Week changed, invalid preloaded data, loading from API for week",g),await B()):(console.log("[TASK-070] CarryoverDurationModal: Week changed, loading from API for week",g),await B()))}),(g,c)=>s.isVisible?(y(),f("div",Zi,[r("div",Xi,[ke($e,{name:"level",mode:"out-in"},{default:ge(()=>{var P;return[a.value===1?(y(),f("div",Ji,[r("header",Qi,[r("h3",ec,[c[3]||(c[3]=Te(" –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ä–æ–∫–∞–º",-1)),s.weekNumber?(y(),f("span",tc," ¬∑ –ù–µ–¥–µ–ª—è "+C(s.weekNumber),1)):ne("",!0)]),r("button",{class:"modal__close",onClick:c[0]||(c[0]=b=>g.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",rc,[ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>[d.value?(y(),f("div",ac,[...c[4]||(c[4]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...",-1)])])):L.value?(y(),f("ul",oc,[(y(!0),f(he,null,me(p.value,b=>(y(),f("li",{key:b.durationCategory,class:pe(["duration-list__item",{"duration-list__item--clickable":b.count>0}]),style:Ue({"--duration-color":b.color}),onClick:U=>I(b,U),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},[r("span",{class:"duration-list__color",style:Ue({backgroundColor:b.color})},null,4),r("span",lc,C(b.durationLabel),1),r("span",ic,C(b.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),b.count>0?(y(),f("span",cc,"‚Üí")):ne("",!0)],14,nc))),128))])):(y(),f("p",sc," –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),r("footer",dc,[r("button",{class:"btn",onClick:c[1]||(c[1]=b=>g.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value===2?(y(),f("div",uc,[r("header",kc,[r("button",{class:"btn-back",onClick:N,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),r("h3",vc," –¢–∏–∫–µ—Ç—ã: "+C(((P=o.value)==null?void 0:P.durationLabel)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),r("button",{class:"modal__close",onClick:c[2]||(c[2]=b=>g.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",hc,[r("div",yc,[c[5]||(c[5]=r("h4",{class:"time-sort-title"},"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–∏–∫–µ—Ç—ã:",-1)),r("div",mc,[(y(!0),f(he,null,me(re.value,b=>(y(),f("button",{key:b.key,class:pe(["time-sort-btn",{active:S.value===b.key}]),onClick:U=>O(b.key)},[Te(C(b.label)+" ",1),r("span",gc,"("+C(b.count)+")",1)],10,pc))),128))])]),ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>{var b;return[u.value?(y(),f("div",fc,[...c[6]||(c[6]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...",-1),r("p",{class:"loading-subtitle"},"–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö",-1)])])):m.value?(y(),f("div",bc,[c[7]||(c[7]=r("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),c[8]||(c[8]=r("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),r("p",_c,C(m.value),1),r("button",{class:"btn btn-retry",onClick:R},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):ee.value.length===0?(y(),f("div",wc,[c[9]||(c[9]=r("div",{class:"empty-state-icon"},"üìã",-1)),r("p",Tc," –í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´"+C((b=o.value)==null?void 0:b.durationLabel)+"¬ª –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ("+C(Fe(Pe)[S.value])+") ",1)])):(y(),f("div",Cc,[ke(rt,{name:"ticket",tag:"div",class:"tickets-list"},{default:ge(()=>[(y(!0),f(he,null,me(ee.value,(U,H)=>(y(),Ee(at,{key:U.id,ticket:U,draggable:!1,style:Ue({"--ticket-index":H}),onClick:M},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):ne("",!0)]}),_:1})])])):ne("",!0)}},Ac=Be(Wc,[["__scopeId","data-v-ed532bc9"]]),$c={class:"ac-dashboard"},Dc={key:"preloader",class:"chart-preloader"},Sc={class:"preloader-content"},Ec={class:"preloader-message"},Nc={key:"content"},Oc={key:1,class:"weeks-dashboard"},Bc={class:"dashboard-header"},Ic={class:"header-content"},Mc={class:"breadcrumbs-row"},Uc=["aria-label","aria-disabled","data-fallback","disabled"],Rc={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Pc={class:"dashboard-layout"},xc={class:"filters-container"},Lc={class:"chart-container"},Fc={__name:"GraphAdmissionClosureDashboard",setup(s){const t=It(),e=J(!1),a=J(null),o=J(null),l=J({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),u=J(!1),d=J(!1),m=J(!1),p=J(!0),S=J(null),L=J({weeks:new Map,currentWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null},previousWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null}}),ee=j(()=>{var h;const k=((h=o.value)==null?void 0:h.weeks)||[];return k.length>=2?k[k.length-2]:null}),re=J(!1),B=j(()=>typeof window>"u"?!1:window.history.length>1),I=j(()=>B.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),T={name:"dashboard-sector-1c"};function N(k){var h;if((h=k==null?void 0:k.preventDefault)==null||h.call(k),!re.value){re.value=!0;try{if(B.value){t.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),t.push(T)}finally{re.value=!1}}}function O(){t.push("/")}const M=J({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),R=J("weeks"),g=j(()=>{const k=M.value.customDateRange.startDate||M.value.customDateRange.endDate,h=M.value.employees.length===1&&M.value.employees.includes("all");return k||!h});async function c(){var h,Y,te,le;if(console.log("[DEBUG] loadData called"),console.log("[DEBUG] periodMode:",R.value),console.log("[DEBUG] isLoading before:",e.value),R.value!=="weeks"){console.log("[DEBUG] loadData: periodMode is not weeks, returning and resetting isLoading"),e.value=!1;return}console.log("[DEBUG] Setting isLoading to true"),e.value=!0,a.value=null;const k=new Promise(se=>setTimeout(se,300));try{console.log("[DEBUG] Starting API call");const se=K(),Z=se.weekStartUtc,W=se.weekEndUtc;console.log("[DEBUG] Week bounds:",{weekStartUtc:Z,weekEndUtc:W});const[ie,ye]=await Promise.all([k,Oe({product:"1C",periodMode:"weeks",weekStartUtc:Z,weekEndUtc:W,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0})]);console.log("[DEBUG] API call successful, result:",ye);const{meta:de,data:X,carryoverDebug:_e}=ye;o.value=de;const De=Array.isArray(X.responsibleCreatedThisWeek)?X.responsibleCreatedThisWeek:X.responsibleCreatedThisWeek?Object.values(X.responsibleCreatedThisWeek):[],Se=Array.isArray(X.responsibleCreatedOtherWeek)?X.responsibleCreatedOtherWeek:X.responsibleCreatedOtherWeek?Object.values(X.responsibleCreatedOtherWeek):[];l.value={...X,responsibleCreatedThisWeek:De,responsibleCreatedOtherWeek:Se},console.log("[DEBUG] Data set, meta:",de,"data keys:",Object.keys(X)),console.log("[TASK-070] chartData.value.responsibleCreatedThisWeek after normalization:",{isArray:Array.isArray(De),length:De.length,sample:De.slice(0,2).map(Q=>{var ce;return{id:Q.id,name:Q.name,count:Q.count,hasTickets:!!Q.tickets,ticketsCount:((ce=Q.tickets)==null?void 0:ce.length)||0}})}),console.log("[TASK-070] chartData.value.responsibleCreatedOtherWeek after normalization:",{isArray:Array.isArray(Se),length:Se.length,sample:Se.slice(0,2).map(Q=>{var ce;return{id:Q.id,name:Q.name,count:Q.count,hasTickets:!!Q.tickets,ticketsCount:((ce=Q.tickets)==null?void 0:ce.length)||0}})}),console.log("[TASK-070] responsibleCreatedThisWeek from API:",{count:((h=X.responsibleCreatedThisWeek)==null?void 0:h.length)||0,data:X.responsibleCreatedThisWeek,details:(Y=X.responsibleCreatedThisWeek)==null?void 0:Y.map(Q=>{var ce;return{id:Q.id,name:Q.name,count:Q.count,hasTickets:!!Q.tickets,ticketsCount:((ce=Q.tickets)==null?void 0:ce.length)||0}})}),console.log("[TASK-070] responsibleCreatedOtherWeek from API:",{count:((te=X.responsibleCreatedOtherWeek)==null?void 0:te.length)||0,data:X.responsibleCreatedOtherWeek,details:(le=X.responsibleCreatedOtherWeek)==null?void 0:le.map(Q=>{var ce;return{id:Q.id,name:Q.name,count:Q.count,hasTickets:!!Q.tickets,ticketsCount:((ce=Q.tickets)==null?void 0:ce.length)||0}})}),console.log("[TASK-070] closedTicketsCreatedThisWeek:",X.closedTicketsCreatedThisWeek),console.log("[TASK-070] closedTicketsCreatedOtherWeek:",X.closedTicketsCreatedOtherWeek);const Ce=(de==null?void 0:de.weeks)||[];if(console.log("[PERF-OPTIMIZATION] Preloading popup data for",Ce.length,"weeks"),Ce.forEach((Q,ce)=>{L.value.weeks.has(Q.weekNumber)||L.value.weeks.set(Q.weekNumber,{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:Q});const ue=L.value.weeks.get(Q.weekNumber);ce===Ce.length-1&&(X.newTicketsByStages&&(ue.newTicketsByStages=X.newTicketsByStages,console.log("[PERF-OPTIMIZATION] Preloaded newTicketsByStages for week",Q.weekNumber,":",X.newTicketsByStages.length,"stages")),X.carryoverTicketsByDuration&&(ue.carryoverTicketsByDuration=X.carryoverTicketsByDuration,console.log("[PERF-OPTIMIZATION] Preloaded carryoverTicketsByDuration for week",Q.weekNumber,":",X.carryoverTicketsByDuration.length,"categories")))}),X.newTicketsByStages&&(L.value.currentWeek.newTicketsByStages=X.newTicketsByStages),X.carryoverTicketsByDuration&&(L.value.currentWeek.carryoverTicketsByDuration=X.carryoverTicketsByDuration),Ce.length>1&&U(Ce.slice(0,-1)),X.responsibleCreatedThisWeek){const Q=Array.isArray(X.responsibleCreatedThisWeek)?X.responsibleCreatedThisWeek:Object.values(X.responsibleCreatedThisWeek);L.value.currentWeek.responsibleCreatedThisWeek=Q,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for current week:",Q.length,"employees"),console.log("[TASK-070] responsibleCreatedThisWeek details:",Q.map(ce=>{var ue;return{id:ce.id,name:ce.name,count:ce.count,hasTickets:!!ce.tickets,ticketsCount:((ue=ce.tickets)==null?void 0:ue.length)||0}}))}if(X.responsibleCreatedOtherWeek){const Q=Array.isArray(X.responsibleCreatedOtherWeek)?X.responsibleCreatedOtherWeek:Object.values(X.responsibleCreatedOtherWeek);L.value.currentWeek.responsibleCreatedOtherWeek=Q,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for current week:",Q.length,"employees"),console.log("[TASK-070] responsibleCreatedOtherWeek details:",Q.map(ce=>{var ue;return{id:ce.id,name:ce.name,count:ce.count,hasTickets:!!ce.tickets,ticketsCount:((ue=ce.tickets)==null?void 0:ue.length)||0}}))}if(_e&&(console.log("[CARRYOVER-DEBUG] ========================================"),console.log("[CARRYOVER-DEBUG] Total:",_e.total),console.log("[CARRYOVER-DEBUG] ThisWeek:",_e.thisWeek),console.log("[CARRYOVER-DEBUG] PreviousWeek:",_e.previousWeek),console.log("[CARRYOVER-DEBUG] Older:",_e.older),console.log("[CARRYOVER-DEBUG] Sum:",_e.sum,"(expected:",_e.total,")"),console.log("[CARRYOVER-DEBUG] Series:",_e.series),console.log("[CARRYOVER-DEBUG] CurrentWeekData:",_e.currentWeekData),console.log("[CARRYOVER-DEBUG] WeeksData:",_e.weeksData),console.log("[CARRYOVER-DEBUG] Full object:",_e),console.log("[CARRYOVER-DEBUG] ========================================")),ee.value){const Q=ee.value.weekStartUtc,ce=ee.value.weekEndUtc;console.log("[TASK-070] Starting preload for previous week:",{weekNumber:ee.value.weekNumber,weekStartUtc:Q,weekEndUtc:ce}),Oe({product:"1C",periodMode:"weeks",weekStartUtc:Q,weekEndUtc:ce,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0}).then(ue=>{if(console.log("[TASK-070] Preload successful for previous week"),ue.data.newTicketsByStages&&(L.value.previousWeek.newTicketsByStages=ue.data.newTicketsByStages,console.log("[TASK-070] Preloaded newTicketsByStages for previous week:",ue.data.newTicketsByStages.length,"stages")),ue.data.carryoverTicketsByDuration&&(L.value.previousWeek.carryoverTicketsByDuration=ue.data.carryoverTicketsByDuration,console.log("[TASK-070] Preloaded carryoverTicketsByDuration for previous week:",ue.data.carryoverTicketsByDuration.length,"categories")),ue.data.responsibleCreatedThisWeek){const We=Array.isArray(ue.data.responsibleCreatedThisWeek)?ue.data.responsibleCreatedThisWeek:Object.values(ue.data.responsibleCreatedThisWeek);L.value.previousWeek.responsibleCreatedThisWeek=We,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for previous week:",We.length,"employees")}if(ue.data.responsibleCreatedOtherWeek){const We=Array.isArray(ue.data.responsibleCreatedOtherWeek)?ue.data.responsibleCreatedOtherWeek:Object.values(ue.data.responsibleCreatedOtherWeek);L.value.previousWeek.responsibleCreatedOtherWeek=We,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for previous week:",We.length,"employees")}}).catch(ue=>{console.warn("[TASK-070] Failed to preload previous week data (non-critical):",ue)})}}catch(se){console.error("[DEBUG] API call failed:",se),a.value=se instanceof Error?se:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureDashboard] loadData error:",se)}finally{console.log("[DEBUG] Finally block: setting isLoading to false"),e.value=!1,console.log("[DEBUG] isLoading after:",e.value)}}function P(k){var W;if(!k||!o.value)return console.log("[TASK-070] getPreloadedStagesData: Missing weekMeta or chartMeta"),null;const h=((W=o.value)==null?void 0:W.weeks)||[],Y=h.length>0?h[h.length-1].weekNumber:o.value.weekNumber,te=h.length>=2?h[h.length-2].weekNumber:null;console.log("[TASK-070] getPreloadedStagesData:",{requestedWeek:k.weekNumber,currentWeekNumber:Y,previousWeekNumber:te,weeksInMeta:h.length});const le=k.weekNumber===Y,se=k.weekNumber===te;let Z=null;if(le)Z=L.value.currentWeek.newTicketsByStages,console.log("[TASK-070] Requested week is current week, checking currentWeek data:",Z?`Array(${Z.length})`:"null");else if(se)Z=L.value.previousWeek.newTicketsByStages,console.log("[TASK-070] Requested week is previous week, checking previousWeek data:",Z?`Array(${Z.length})`:"null");else return console.log("[TASK-070] Requested week",k.weekNumber,"is neither current nor previous, no preloaded data available"),null;return Array.isArray(Z)&&Z.length>0?(console.log("[TASK-070] Using preloaded stages data for week",k.weekNumber,":",Z.length,"stages"),Z):(console.log("[TASK-070] No preloaded stages data for week",k.weekNumber,", will use API fallback"),null)}function b(k){var Z;if(!k)return null;const h=L.value.weeks.get(k.weekNumber);if(h!=null&&h.carryoverTicketsByDuration&&Array.isArray(h.carryoverTicketsByDuration))return console.log("[PERF-OPTIMIZATION] Using preloaded carryover data for week",k.weekNumber,":",h.carryoverTicketsByDuration.length,"categories"),h.carryoverTicketsByDuration;const Y=((Z=o.value)==null?void 0:Z.weeks)||[],te=Y.length>0?Y[Y.length-1].weekNumber:o.value.weekNumber,se=k.weekNumber===te?L.value.currentWeek.carryoverTicketsByDuration:L.value.previousWeek.carryoverTicketsByDuration;return Array.isArray(se)&&se.length>0?(console.log("[TASK-070] Using fallback preloaded carryover data for week",k.weekNumber,":",se.length,"categories"),se):(console.log("[PERF-ISSUE] No preloaded carryover data for week",k.weekNumber,", will use slow API fallback"),null)}async function U(k){if(!(!k||k.length===0)){console.log("[PERF-OPTIMIZATION] Starting background preload for",k.length,"weeks");for(const h of k)try{await new Promise(le=>setTimeout(le,500)),console.log("[PERF-OPTIMIZATION] Preloading data for week",h.weekNumber);const Y=await Oe({product:"1C",periodMode:"weeks",weekStartUtc:h.weekStartUtc,weekEndUtc:h.weekEndUtc,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!1}),te={newTicketsByStages:Y.data.newTicketsByStages||null,carryoverTicketsByDuration:Y.data.carryoverTicketsByDuration||null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:h};L.value.weeks.set(h.weekNumber,te),console.log("[PERF-OPTIMIZATION] Successfully preloaded data for week",h.weekNumber)}catch(Y){console.warn("[PERF-OPTIMIZATION] Failed to preload data for week",h.weekNumber,":",Y)}console.log("[PERF-OPTIMIZATION] Background preload completed")}}function H(k){var le;if(!k||!o.value)return null;const h=((le=o.value)==null?void 0:le.weeks)||[],Y=h.length>0?h[h.length-1].weekNumber:o.value.weekNumber;return k.weekNumber===Y&&l.value.responsible||null}function F(k){var Z;if(!k){const W=l.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: weekMeta is null, using chartData:",{hasData:!!W,isArray:Array.isArray(W),dataLength:Array.isArray(W)?W.length:W?Object.keys(W).length:0}),W?Array.isArray(W)?W:Object.values(W):null}if(!o.value)return console.log("[TASK-070] getResponsibleCreatedThisWeek: chartMeta is null"),null;const h=((Z=o.value)==null?void 0:Z.weeks)||[],Y=h.length>0?h[h.length-1].weekNumber:o.value.weekNumber,te=h.length>=2?h[h.length-2].weekNumber:null,le=k.weekNumber===Y,se=k.weekNumber===te;if(console.log("[TASK-070] getResponsibleCreatedThisWeek:",{requestedWeek:k.weekNumber,currentWeekNumber:Y,previousWeekNumber:te,isCurrentWeek:le,isPreviousWeek:se}),le){const W=l.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: current week data:",{hasData:!!W,isArray:Array.isArray(W),dataLength:Array.isArray(W)?W.length:W?Object.keys(W).length:0}),W?Array.isArray(W)?W:Object.values(W):null}if(se){const W=L.value.previousWeek.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: previous week data:",{hasData:!!W,isArray:Array.isArray(W),dataLength:Array.isArray(W)?W.length:0,data:W}),W||null}return console.log("[TASK-070] getResponsibleCreatedThisWeek: week",k.weekNumber,"is neither current nor previous, no preloaded data"),null}function x(k){var Z;if(!k){const W=l.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: weekMeta is null, using chartData:",{hasData:!!W,isArray:Array.isArray(W),dataLength:Array.isArray(W)?W.length:W?Object.keys(W).length:0}),W?Array.isArray(W)?W:Object.values(W):null}if(!o.value)return console.log("[TASK-070] getResponsibleCreatedOtherWeek: chartMeta is null"),null;const h=((Z=o.value)==null?void 0:Z.weeks)||[],Y=h.length>0?h[h.length-1].weekNumber:o.value.weekNumber,te=h.length>=2?h[h.length-2].weekNumber:null,le=k.weekNumber===Y,se=k.weekNumber===te;if(console.log("[TASK-070] getResponsibleCreatedOtherWeek:",{requestedWeek:k.weekNumber,currentWeekNumber:Y,previousWeekNumber:te,isCurrentWeek:le,isPreviousWeek:se}),le){const W=l.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: current week data:",{hasData:!!W,isArray:Array.isArray(W),dataLength:Array.isArray(W)?W.length:W?Object.keys(W).length:0}),W?Array.isArray(W)?W:Object.values(W):null}if(se){const W=L.value.previousWeek.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: previous week data:",{hasData:!!W,isArray:Array.isArray(W),dataLength:Array.isArray(W)?W.length:0,data:W}),W||null}return console.log("[TASK-070] getResponsibleCreatedOtherWeek: week",k.weekNumber,"is neither current nor previous, no preloaded data"),null}function z(k){var Z;if(!k||!o.value)return null;const h=((Z=o.value)==null?void 0:Z.weeks)||[],Y=h.length>0?h[h.length-1].weekNumber:o.value.weekNumber,te=h.length>=2?h[h.length-2].weekNumber:null,le=k.weekNumber===Y,se=k.weekNumber===te;if(le)return l.value.closedTicketsCreatedThisWeek??null;if(se&&l.value.weeksData){const W=l.value.weeksData.find(ie=>ie.weekNumber===te);return(W==null?void 0:W.closedTicketsCreatedThisWeek)??null}return null}function q(k){var Z;if(!k||!o.value)return null;const h=((Z=o.value)==null?void 0:Z.weeks)||[],Y=h.length>0?h[h.length-1].weekNumber:o.value.weekNumber,te=h.length>=2?h[h.length-2].weekNumber:null,le=k.weekNumber===Y,se=k.weekNumber===te;if(le)return l.value.closedTicketsCreatedOtherWeek??null;if(se&&l.value.weeksData){const W=l.value.weeksData.find(ie=>ie.weekNumber===te);return(W==null?void 0:W.closedTicketsCreatedOtherWeek)??null}return null}function ae(k){M.value.stages=k}function ve(k){M.value.employees=k}function fe(k){M.value.dateRange=k}function D(k){M.value.customDateRange=k}function n(k){if(!["weeks","months"].includes(k)){console.warn("[GraphAdmissionClosureDashboard] Invalid periodMode:",k);return}k!==R.value&&(R.value=k,k==="weeks"?c():k==="months"&&(e.value=!1))}function i(k){const{mode:h}=k.detail;["weeks","months"].includes(h)&&n(h)}function $(){M.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},E()}function E(){R.value==="weeks"&&c()}function G(k){["weeks","months"].includes(k)&&(R.value=k)}function w(){console.log("[DEBUG] handleCloseModal called"),console.log("[DEBUG] showPeriodModeInfo before:",p.value),console.log("[DEBUG] isLoading before:",e.value),console.log("[DEBUG] periodMode:",R.value),p.value=!1,e.value=!0,console.log("[DEBUG] showPeriodModeInfo after:",p.value),console.log("[DEBUG] isLoading after:",e.value),Wt(()=>{console.log("[DEBUG] handleCloseModal: calling handleStartLoading in nextTick"),V()})}function V(){console.log("[DEBUG] handleStartLoading called"),console.log("[DEBUG] periodMode before check:",R.value),console.log("[DEBUG] showPeriodModeInfo:",p.value),console.log("[DEBUG] isLoading:",e.value),(!R.value||!["weeks","months"].includes(R.value))&&(console.warn('[GraphAdmissionClosureDashboard] Period mode not set, using default "weeks"'),R.value="weeks"),console.log("[GraphAdmissionClosureDashboard] Starting loading, periodMode:",R.value),Wt(()=>{console.log("[DEBUG] nextTick callback, periodMode:",R.value),console.log("[DEBUG] isLoading in nextTick:",e.value),R.value==="weeks"?(console.log("[GraphAdmissionClosureDashboard] Loading data for weeks mode"),c()):R.value==="months"&&(console.log("[GraphAdmissionClosureDashboard] Months mode - data will be loaded by GraphAdmissionClosureMonthsDashboard"),e.value=!1,console.log("[DEBUG] Reset parent isLoading to false for months mode"))})}function oe(k=null){var h,Y,te;k?S.value=k:S.value={weekNumber:((h=o.value)==null?void 0:h.weekNumber)||null,weekStartUtc:((Y=o.value)==null?void 0:Y.weekStartUtc)||null,weekEndUtc:((te=o.value)==null?void 0:te.weekEndUtc)||null},d.value=!0}function _(k=null){var h,Y,te;k?S.value=k:S.value={weekNumber:((h=o.value)==null?void 0:h.weekNumber)||null,weekStartUtc:((Y=o.value)==null?void 0:Y.weekStartUtc)||null,weekEndUtc:((te=o.value)==null?void 0:te.weekEndUtc)||null},u.value=!0}function v(k=null){var h,Y,te;k?S.value=k:S.value={weekNumber:((h=o.value)==null?void 0:h.weekNumber)||null,weekStartUtc:((Y=o.value)==null?void 0:Y.weekStartUtc)||null,weekEndUtc:((te=o.value)==null?void 0:te.weekEndUtc)||null},m.value=!0}ct(()=>{try{const k="graph-admission-closure-period-mode-info-shown";localStorage.getItem(k)&&localStorage.removeItem(k);const h="graph-admission-closure-period-mode";localStorage.getItem(h)&&localStorage.removeItem(h)}catch(k){console.warn("[GraphAdmissionClosureDashboard] Failed to clean localStorage:",k)}window.addEventListener("period-mode-change",i)}),Ot(()=>{window.removeEventListener("period-mode-change",i)});function K(){const k=new Date,h=new Date(Date.UTC(k.getUTCFullYear(),k.getUTCMonth(),k.getUTCDate())),Y=h.getUTCDay(),te=h.getUTCDate()-Y+(Y===0?-6:1),le=new Date(Date.UTC(h.getUTCFullYear(),h.getUTCMonth(),te,0,0,0)),se=new Date(le);return se.setUTCDate(se.getUTCDate()+6),se.setUTCHours(23,59,59,999),{weekStartUtc:le.toISOString(),weekEndUtc:se.toISOString()}}return(k,h)=>{var te,le,se,Z,W,ie,ye,de,X,_e,De,Se,Ce,Q,ce,ue,We,xe;const Y=Mt("router-link");return y(),f("div",$c,[ke($e,{name:"fade",mode:"out-in"},{default:ge(()=>[e.value?(y(),f("div",Dc,[r("div",Sc,[h[3]||(h[3]=r("div",{class:"preloader-spinner"},[r("div",{class:"spinner-ring"}),r("div",{class:"spinner-ring"}),r("div",{class:"spinner-ring"})],-1)),h[4]||(h[4]=r("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞",-1)),r("p",Ec," –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ "+C(R.value==="weeks"?"4 –Ω–µ–¥–µ–ª–∏":"3 –º–µ—Å—è—Ü–∞")+"... ",1),h[5]||(h[5]=r("div",{class:"preloader-dots"},[r("span",{class:"dot"}),r("span",{class:"dot"}),r("span",{class:"dot"})],-1))])])):!p.value&&!e.value?(y(),f("div",Nc,[R.value==="months"?(y(),Ee(Bn,{key:0})):(y(),f("div",Oc,[r("div",Bc,[r("div",Ic,[r("div",Mc,[r("button",{class:"btn-home-link",type:"button",onClick:O,title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),h[11]||(h[11]=r("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),r("button",{class:"btn-back-link",type:"button",onClick:N,"aria-label":I.value,"aria-disabled":!B.value,"data-fallback":!B.value,disabled:re.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,Uc),r("nav",Rc,[ke(Y,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ge(()=>[...h[6]||(h[6]=[Te(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),h[8]||(h[8]=r("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ke(Y,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:ge(()=>[...h[7]||(h[7]=[Te(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),h[9]||(h[9]=r("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),h[10]||(h[10]=r("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),h[12]||(h[12]=r("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),h[13]||(h[13]=r("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),r("div",Pc,[r("div",xc,[ke(Rt,{stages:M.value.stages,employees:M.value.employees,dateRange:M.value.dateRange,customDateRange:M.value.customDateRange,hasActiveFilters:g.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":R.value,"onUpdate:stages":ae,"onUpdate:employees":ve,"onUpdate:dateRange":fe,"onUpdate:customDateRange":D,"onUpdate:periodMode":n,onReset:$,onApply:E},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","period-mode"])]),r("div",Lc,[a.value?(y(),Ee(Ut,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:a.value.message},null,8,["message"])):(y(),Ee(Gs,{key:1,meta:o.value,data:l.value,onOpenResponsible:_,onOpenStages:oe,onOpenCarryover:v},null,8,["meta","data"]))])])]))])):ne("",!0)]),_:1}),ke(ki,{"is-visible":u.value,responsible:H(S.value)||l.value.responsible||[],"closed-tickets-created-this-week":z(S.value)??l.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":q(S.value)??l.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":F(S.value)||l.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":x(S.value)||l.value.responsibleCreatedOtherWeek||[],"week-number":((te=S.value)==null?void 0:te.weekNumber)||((le=o.value)==null?void 0:le.weekNumber)||null,"week-start-utc":((se=S.value)==null?void 0:se.weekStartUtc)||((Z=o.value)==null?void 0:Z.weekStartUtc)||null,"week-end-utc":((W=S.value)==null?void 0:W.weekEndUtc)||((ie=o.value)==null?void 0:ie.weekEndUtc)||null,onClose:h[0]||(h[0]=Le=>{u.value=!1,S.value.value=null})},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),ke(Hi,{"is-visible":d.value,"week-number":((ye=S.value)==null?void 0:ye.weekNumber)||((de=o.value)==null?void 0:de.weekNumber)||null,"week-start-utc":((X=S.value)==null?void 0:X.weekStartUtc)||((_e=o.value)==null?void 0:_e.weekStartUtc)||null,"week-end-utc":((De=S.value)==null?void 0:De.weekEndUtc)||((Se=o.value)==null?void 0:Se.weekEndUtc)||null,"preloaded-data":P(S.value),onClose:h[1]||(h[1]=Le=>{d.value=!1,S.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),ke(Ac,{"is-visible":m.value,"week-number":((Ce=S.value)==null?void 0:Ce.weekNumber)||((Q=o.value)==null?void 0:Q.weekNumber)||null,"week-start-utc":((ce=S.value)==null?void 0:ce.weekStartUtc)||((ue=o.value)==null?void 0:ue.weekStartUtc)||null,"week-end-utc":((We=S.value)==null?void 0:We.weekEndUtc)||((xe=o.value)==null?void 0:xe.weekEndUtc)||null,"preloaded-data":b(S.value),onClose:h[2]||(h[2]=Le=>{m.value=!1,S.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),p.value?(y(),Ee(pr,{key:0,"is-visible":p.value,"current-mode":R.value,onClose:w,onSelectMode:G},null,8,["is-visible","current-mode"])):ne("",!0)])}}},zc=Be(Fc,[["__scopeId","data-v-e970a08a"]]);export{zc as default};
