const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./chunk-DaswhI4P.js","./chunk-Cju2jD7v.js","./chunk-CN9x_a6A.js","./chunk-BPIGQGZw.js","./chunk-CG661wCx.js","./direct-access-config-Bzka4gH0.js","./access-config-async-CledoeM0.js","./chunk-DpxUpuOm.js","./WebhookLogsDashboard.vue-Qw37XD05.js","./WebhookLogDetails.vue-BSVgwfDp.js","./SectorDashboardBitrix24.vue-CfHf327U.js","./SectorDashboardInfrastructure.vue-C-qI3v8C.js"])))=>i.map(i=>d[i]);
var Vs=Object.defineProperty;var zs=(o,e,a)=>e in o?Vs(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a;var Ke=(o,e,a)=>zs(o,typeof e!="symbol"?e+"":e,a);import{r as be,c as u,o as c,a as ne,b as A,d as hs,t as m,n as X,e as s,f as he,g as I,h as $e,u as Xe,i as Ba,j as $,F as ee,k as te,l as we,m as ge,w as Ce,p as We,q as Ne,s as ye,T as Ae,v as Qe,x as Re,y as It,C as Je,z as Gs,L as Ks,P as qs,A as Ys,B as Xs,D as Js,E as Zs,G as Qs,H as eo,I as to,J as Be,K as Et,M as _t,N as wt,O as yt,Q as fs,R as vs,S as at,U as At,V as Wt,W as ps,X as wa,Y as ia,Z as Xa,_ as ao,$ as ka,a0 as dt,a1 as so,a2 as ys,a3 as oo,a4 as no,a5 as ro}from"./chunk-DpxUpuOm.js";import{a as ks,g as et,_ as Ee,b as lo,f as Ut}from"./chunk-CG661wCx.js";import{C as Ja}from"./chunk-CN9x_a6A.js";import{i as io,S as Xt,m as Jt,a as Ra,g as La,b as bs,c as co,d as Za,E as uo,e as Ca,f as Ta,h as aa,p as Qa,j as go,k as mo,D as ho,l as fo,n as es,o as ts,T as vo,q as as,r as po}from"./chunk-DaswhI4P.js";import{D as vt}from"./chunk-Cju2jD7v.js";import{L as yo}from"./chunk-BPIGQGZw.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))t(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function a(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(l){if(l.ep)return;l.ep=!0;const r=a(l);fetch(l.href,r)}})();const ce=(o,e)=>{const a=o.__vccOpts||o;for(const[t,l]of e)a[t]=l;return a},ko={name:"App"},bo={id:"app"};function _o(o,e,a,t,l,r){const n=be("router-view");return c(),u("div",bo,[ne(n)])}const wo=ce(ko,[["render",_o]]),Co={name:"StatusMessage",props:{type:{type:String,required:!0,validator:o=>["success","error","info","warning"].includes(o)},title:{type:String,default:null},message:{type:String,default:null}}},To={key:0},So={key:1};function Do(o,e,a,t,l,r){return c(),u("div",{class:X(["status-message",`status-message--${a.type}`])},[a.title?(c(),u("strong",To,m(a.title),1)):A("",!0),a.message?(c(),u("p",So,m(a.message),1)):A("",!0),hs(o.$slots,"default",{},void 0)],2)}const ba=ce(Co,[["render",Do],["__scopeId","data-v-7f15d2d7"]]),Eo={name:"LoadingSpinner",props:{message:{type:String,default:"–ó–∞–≥—Ä—É–∑–∫–∞..."}}},Ao={class:"loading-spinner"},$o={key:0,class:"message"};function Io(o,e,a,t,l,r){return c(),u("div",Ao,[e[0]||(e[0]=s("div",{class:"spinner"},null,-1)),a.message?(c(),u("p",$o,m(a.message),1)):A("",!0)])}const _a=ce(Eo,[["render",Io],["__scopeId","data-v-375eac16"]]);function Bt(){try{if(window.self===window.top)return!1;if(typeof BX24<"u")return!0;try{const o=window.parent.location.origin;return o.includes("bitrix24")||o.includes("kompo.by")}catch{return!1}}catch(o){return console.warn("Error checking Bitrix24 context:",o),!1}}function Mo(){return typeof BX24<"u"}class kt{static init(e){return new Promise((a,t)=>{if(!Bt()){console.log("Not inside Bitrix24, skipping BX24.init()"),e&&e(),a();return}if(typeof BX24>"u"){t(new Error("Bitrix24 API not loaded. Make sure script is included: //api.bitrix24.com/api/v1/"));return}const l=setTimeout(()=>{t(new Error("BX24.init() timeout: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥"))},5e3);try{BX24.init(()=>{clearTimeout(l),e&&e(),a()})}catch(r){clearTimeout(l),t(r)}})}static installFinish(){return new Promise((e,a)=>{if(typeof BX24>"u"){a(new Error("Bitrix24 API not loaded"));return}try{BX24.installFinish(),e()}catch(t){a(t)}})}static callMethod(e,a={}){return new Promise((t,l)=>{if(typeof BX24>"u"){l(new Error("Bitrix24 API not loaded"));return}const r=setTimeout(()=>{l(new Error(`BX24.callMethod(${e}) timeout: –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—ã—Å–∏–ª 10 —Å–µ–∫—É–Ω–¥`))},1e4);try{BX24.callMethod(e,a,n=>{if(clearTimeout(r),n.error()){const i=n.error();l(new Error(i.error_description||i.error||"Unknown error"))}else t(n.data())})}catch(n){clearTimeout(r),l(n)}})}static async getCurrentUser(){if(Bt()&&Mo())try{const e=await Promise.race([this.callMethod("user.current",{}),new Promise((a,t)=>setTimeout(()=>t(new Error("Timeout")),5e3))]);return console.log("Got user from BX24.callMethod() (interface user):",e?.ID||"unknown"),e}catch(e){console.warn("BX24.callMethod() failed, using proxy API as fallback:",e);try{const t=await new Ja().getCurrentUser();return console.log("Got user from proxy API (token owner, fallback):",t),t}catch(a){throw console.error("Both BX24 API and proxy API failed:",a),e.message&&e.message.includes("timeout")?new Error("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Bitrix24 API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç."):new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}else return console.warn("Not inside Bitrix24, using proxy API (will return token owner, not interface user)"),await new Ja().getCurrentUser()}static getUser(){return new Promise((e,a)=>{if(typeof BX24>"u"){a(new Error("Bitrix24 API not loaded"));return}if(typeof BX24.getUser!="function"){a(new Error("BX24.getUser is not available"));return}BX24.getUser(t=>{e(t)})})}static getAuth(){return new Promise((e,a)=>{if(typeof BX24>"u"){a(new Error("Bitrix24 API not loaded"));return}BX24.getAuth(t=>{e(t)})})}}const No={name:"InstallPage",components:{StatusMessage:ba,LoadingSpinner:_a},setup(){const o=I(!0),e=I(null),a=I(null);return $e(async()=>{try{let t=null;if(window.INSTALL_RESULT)t=window.INSTALL_RESULT;else{const l=ks("/install.php"),r=await fetch(`${l}?get_result=1`);r.ok&&(t=await r.json())}if(!t)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏");if(a.value=t,t.rest_only===!1)if(t.install===!0){e.value={type:"success",title:"‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!",message:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24."};try{await kt.init(()=>{kt.installFinish()})}catch(l){console.error("Error finishing installation:",l)}}else e.value={type:"error",title:"‚úó –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."};else e.value={type:"info",title:"REST-only —Ä–µ–∂–∏–º",message:"–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ REST API, –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."}}catch(t){console.error("Error loading install result:",t),e.value={type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ."}}finally{o.value=!1}}),{loading:o,installStatus:e,installInfo:a}}},xo={class:"install-page"},Lo={class:"container"},Po={key:1,class:"info"};function Oo(o,e,a,t,l,r){const n=be("StatusMessage"),i=be("LoadingSpinner");return c(),u("div",xo,[s("div",Lo,[e[1]||(e[1]=s("h1",null,"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1)),t.installStatus?(c(),he(n,{key:0,type:t.installStatus.type,title:t.installStatus.title,message:t.installStatus.message},null,8,["type","title","message"])):A("",!0),t.installInfo?(c(),u("div",Po,[e[0]||(e[0]=s("h3",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:",-1)),s("pre",null,m(JSON.stringify(t.installInfo,null,2)),1)])):A("",!0),t.loading?(c(),he(i,{key:2,message:"–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."})):A("",!0)])])}const Bo=ce(No,[["render",Oo],["__scopeId","data-v-d082ec9e"]]);function Ro(){const o=Xe(),e=Ba();return{goBack:(n="/")=>{window.history.length>1?o.back():o.push(n)},goTo:(n,i={})=>{o.push({path:n,...i})},goHome:(n={})=>{o.push({path:"/",...n})},isCurrentRoute:n=>e.path===n,router:o,route:e}}const Wo={name:"BackButton",props:{variant:{type:String,default:"header",validator:o=>["header","floating"].includes(o)},text:{type:String,default:"–ù–ê–ó–ê–î"},to:{type:String,default:null},showIcon:{type:Boolean,default:!0},ariaLabel:{type:String,default:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"},title:{type:String,default:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"}},setup(o){const{goBack:e,goHome:a}=Ro();return{buttonClasses:$(()=>[o.variant==="header"?"back-button":"floating-back-button"]),handleClick:()=>{o.to?a({path:o.to}):e()}}}},Uo=["aria-label","title"],Fo={key:0,class:"back-button-icon"},Ho={key:1,class:"back-button-text"};function jo(o,e,a,t,l,r){return c(),u("button",{class:X(t.buttonClasses),onClick:e[0]||(e[0]=(...n)=>t.handleClick&&t.handleClick(...n)),"aria-label":a.ariaLabel,title:a.title},[a.showIcon?(c(),u("span",Fo,"‚Üê")):A("",!0),a.variant==="header"?(c(),u("span",Ho,m(a.text),1)):A("",!0)],10,Uo)}const _s=ce(Wo,[["render",jo],["__scopeId","data-v-d605b6a0"]]);function Vo(o){const e=I(!1),a=I(null),t=I(""),l=I({}),r=I([]),n=I({}),i=I([]),d=I({totalTickets:0,totalEmployees:0,activeStages:0,lastUpdated:null}),g=$(()=>r.value.length>0||i.value.length>0),v=$(()=>!g.value&&!e.value&&!a.value),w=$(()=>{const B=Object.values(n.value).reduce((G,q)=>G+(q?.length||0),0),W=r.value.reduce((G,q)=>G+(q.tickets?.length||0),0);return B+W}),f=$(()=>{if(!w.value)return 0;const W=[...Object.values(n.value).flat(),...r.value.flatMap(G=>G.tickets||[])].filter(G=>G.status==="closed"||G.status==="completed"||G.status==="done").length;return Math.round(W/w.value*100)}),p=(B,W="",G={})=>{e.value=B,t.value=W,l.value=G},y=B=>{a.value=B,e.value=!1},T=()=>{a.value=null},C=B=>{r.value=B},k=B=>{i.value=B},S=B=>{n.value=B},x=B=>{d.value={...d.value,...B,lastUpdated:new Date().toISOString()}},U=()=>{e.value=!1,a.value=null,t.value="",l.value={},r.value=[],n.value={},i.value=[],d.value={totalTickets:0,totalEmployees:0,activeStages:0,lastUpdated:null}},L=B=>r.value.find(W=>W.id===B);return{isLoading:e,error:a,currentStep:t,stepDetails:l,stages:r,zeroPointTickets:n,employees:i,sectorStats:d,hasData:g,isEmpty:v,totalTickets:w,completionRate:f,setLoading:p,setError:y,clearError:T,updateStages:C,updateEmployees:k,updateZeroPointTickets:S,updateSectorStats:x,resetState:U,getStageById:L,getEmployeeById:B=>i.value.find(W=>W.id===B),getStageTickets:B=>{const W=L(B);return W?W.tickets||[]:[]},getZeroPointTickets:B=>n.value[B]||[]}}class Dt{static async call(e,a={}){return await new vt().call(e,a)}}class Oe{static get(e){const a=this.cache.get(e);return a?Date.now()-a.timestamp>a.ttl?(this.cache.delete(e),null):a.data:null}static set(e,a,t=this.DEFAULT_TTL){this.cache.set(e,{data:a,timestamp:Date.now(),ttl:t})}static delete(e){this.cache.delete(e)}static clear(){this.cache.clear()}static invalidateByPrefix(e){const a=[];for(const t of this.cache.keys())t.startsWith(e)&&a.push(t);a.forEach(t=>this.cache.delete(t))}static cleanExpired(){const e=Date.now(),a=[];for(const[t,l]of this.cache.entries())e-l.timestamp>l.ttl&&a.push(t);a.forEach(t=>this.cache.delete(t))}static getStats(){const e=Date.now();let a=0,t=0;for(const l of this.cache.values())e-l.timestamp>l.ttl?a++:t++;return{total:this.cache.size,valid:t,expired:a}}static getTicketsCacheKey(e){return`tickets:stage:${e}`}static getAllTicketsCacheKey(){return"tickets:all"}static getEmployeesCacheKey(e){return`employees:ids:${[...e].sort((t,l)=>t-l).join(",")}`}static getSectorDataCacheKey(){return"sector:data"}static invalidateTicketsCache(){this.invalidateByPrefix("tickets:"),this.invalidateByPrefix("sector:")}static invalidateEmployeesCache(){this.invalidateByPrefix("employees:")}}Ke(Oe,"cache",new Map),Ke(Oe,"DEFAULT_TTL",5*60*1e3),Ke(Oe,"EMPLOYEES_TTL",30*60*1e3),Ke(Oe,"TICKETS_TTL",5*60*1e3);typeof window<"u"&&setInterval(()=>{Oe.cleanExpired()},5*60*1e3);const Sa="dashboard-sector-1c-logger-level",Vt={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4};let Mt=class{static getLevel(){if(typeof localStorage<"u"){const a=localStorage.getItem(Sa);if(a&&Vt[a]!==void 0)return a}return!0?"ERROR":"DEBUG"}static setLevel(e){return Vt[e]!==void 0?(typeof localStorage<"u"&&localStorage.setItem(Sa,e),!0):!1}static isEnabled(e,a=null){const t=a||this.getLevel();if(t==="NONE")return!1;const l=Vt[e]||0,r=Vt[t]||0;return l<=r}static getLevels(){return{...Vt}}static reset(){typeof localStorage<"u"&&localStorage.removeItem(Sa)}},De=class{static getLevelColor(e){return{ERROR:"#dc3545",WARN:"#ffc107",INFO:"#17a2b8",DEBUG:"#6c757d"}[e]||"#6c757d"}static formatMessage(e,a,t=""){const l=new Date().toISOString(),r=this.getLevelColor(e),n=`%c[${l}] %c[${e}] %c[${t||"Unknown"}] %c${a}`,i=["color: #6c757d; font-weight: normal",`color: ${r}; font-weight: bold`,"color: #007bff; font-weight: normal","color: #212529; font-weight: normal"];return{formatted:n,styles:i}}static log(e,a,t="",l=null){if(!Mt.isEnabled(e))return;const r=this.formatMessage(e,a,t),n=[r.formatted,...r.styles];switch(l!=null&&n.push(l),e){case"ERROR":console.error(...n);break;case"WARN":console.warn(...n);break;case"INFO":console.info(...n);break;case"DEBUG":console.log(...n);break;default:console.log(...n)}}static error(e,a="",t=null){this.log("ERROR",e,a,t)}static warn(e,a="",t=null){this.log("WARN",e,a,t)}static info(e,a="",t=null){this.log("INFO",e,a,t)}static debug(e,a="",t=null){this.log("DEBUG",e,a,t)}};function Ge(o,e,a={}){if(!o||typeof o!="string")throw new Error("Step must be a non-empty string");const t=typeof e=="number"&&!isNaN(e)?Math.max(0,Math.min(100,e)):0;let l=a.description;return l||(l=zo(o,a)),{step:o,progress:t,details:{...a,description:l}}}function zo(o,e){return o==="loading_tickets"&&e.stageName&&e.stageIndex!==void 0?`–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏ "${e.stageName}" (${e.stageIndex}/${e.totalStages||1})...`:o==="filtering"&&e.filteredTickets!==void 0&&e.totalTickets!==void 0?`–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤: ${e.filteredTickets} –∏–∑ ${e.totalTickets}...`:o==="grouping"&&e.employeeCount!==void 0?`–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ ${e.employeeCount} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º...`:e.count!==void 0&&e.total!==void 0?`–û–±—Ä–∞–±–æ—Ç–∫–∞: ${e.count} –∏–∑ ${e.total}...`:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."}function ga(o){if(!o||typeof o!="object")throw new Error("Progress info must be an object");const e=o.step||null;if(!e)throw new Error("Step is required in progress info");const a=o.progress!==void 0&&o.progress!==null?o.progress:o.percent!==void 0&&o.percent!==null?o.percent:void 0,t=o.details||{};return o.stage&&(t.stage=o.stage),o.stageName&&(t.stageName=o.stageName),o.stageIndex!==void 0&&(t.stageIndex=o.stageIndex),o.totalStages!==void 0&&(t.totalStages=o.totalStages),o.count!==void 0&&(t.count=o.count),o.total!==void 0&&(t.total=o.total),o.warning&&(t.warning=o.warning),{step:e,progress:a!=null?Math.max(0,Math.min(100,a)):void 0,details:t}}function Pa(o,e,a){const t=typeof o=="number"&&!isNaN(o)?Math.max(0,Math.min(100,o)):0,l=typeof e=="number"&&!isNaN(e)?Math.max(0,Math.min(100,e)):0,r=typeof a=="number"&&!isNaN(a)?Math.max(0,Math.min(100,a)):0,n=t+l*r/100;return Math.max(0,Math.min(100,n))}const xt={allowedDepartmentIds:[369,366,7],adminDepartmentIds:[369]};function ws(o){return!o||typeof o!="number"?!1:xt.allowedDepartmentIds.includes(o)}function sa(o){if(!o||!o.UF_DEPARTMENT)return!1;const e=Array.isArray(o.UF_DEPARTMENT)?o.UF_DEPARTMENT:[];return e.length===0?!1:e.some(a=>xt.adminDepartmentIds.includes(a))}class Go{constructor(){this.reset()}reset(){this.metrics={ticketsLoading:{stages:{},totalLoaded:0},filtering:{total:0,filtered:0,rejected:[],tagValueExamples:[]},employees:{uniqueIds:[],totalUnique:0,ticketsWithoutAssignedById:[],ticketsWithAssignedById1051:[]},grouping:{distributionByStages:{},ticketsNotInColumn:[],unknownStages:[]},zeroPoint:{byStage:{}}}}logTicketsLoading(e,a,t,l=null){this.metrics.ticketsLoading.stages[e]||(this.metrics.ticketsLoading.stages[e]={loaded:0,batches:[],total:0});const r=this.metrics.ticketsLoading.stages[e];r.loaded=t,r.batches.push({count:a,total:t,next:l}),r.total=t,this.metrics.ticketsLoading.totalLoaded=Object.values(this.metrics.ticketsLoading.stages).reduce((n,i)=>n+i.total,0)}logFiltering(e,a,t=[],l=[]){this.metrics.filtering.total=e,this.metrics.filtering.filtered=a,this.metrics.filtering.rejected=t.slice(0,50),this.metrics.filtering.tagValueExamples=l.slice(0,20)}logEmployees(e,a=[],t=[]){this.metrics.employees.uniqueIds=e,this.metrics.employees.totalUnique=e.length,this.metrics.employees.ticketsWithoutAssignedById=a.slice(0,50),this.metrics.employees.ticketsWithAssignedById1051=t.slice(0,50)}logGrouping(e,a=[],t=[]){e.forEach(l=>{const r={};let n=0;l.employees.forEach(i=>{const d=(i.ticketsInsideSector||[]).length+(i.ticketsOutsideSector||[]).length;r[i.id]=d,n+=d}),this.metrics.grouping.distributionByStages[l.id]={employees:r,total:n}}),this.metrics.grouping.ticketsNotInColumn=a.slice(0,50),this.metrics.grouping.unknownStages=t.slice(0,50)}logZeroPoint(e){Object.keys(e).forEach(a=>{this.metrics.zeroPoint.byStage[a]=Array.isArray(e[a])?e[a].length:0})}getMetrics(){return this.metrics}getProblematicTickets(){return{withoutAssignedById:this.metrics.employees.ticketsWithoutAssignedById,withAssignedById1051:this.metrics.employees.ticketsWithAssignedById1051,withoutSectorTag:this.metrics.filtering.rejected,notInColumn:this.metrics.grouping.ticketsNotInColumn,unknownStage:this.metrics.grouping.unknownStages}}exportToJSON(){return JSON.stringify({metrics:this.metrics,problematicTickets:this.getProblematicTickets(),timestamp:new Date().toISOString()},null,2)}}let Da=null;function tt(){return Da||(Da=new Go),Da}function ct(o=null,e=null){if(e&&!sa(e))return!1;if(o&&o.query&&o.query.diagnostics==="true")return!0;if(typeof window<"u"&&window.location){const a=window.location.hash;if(a){const l=a.split("?");if(l.length>1){const r=l[1];if(new URLSearchParams(r).get("diagnostics")==="true")return!0}if(a.includes("diagnostics=true"))return!0}if(new URLSearchParams(window.location.search).get("diagnostics")==="true")return!0}return typeof localStorage<"u"?localStorage.getItem("dashboard-sector-1c-diagnostics")==="true":!1}const zt=140;class Lt{static async getAllTicketsByFilter(e,a="UF_CRM_7_TYPE_PRODUCT",t=null,l=!0){De.info(`Loading tickets by filter: ${a} = ${e}`,"TicketRepository");try{const r=[],n=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],i=n.length;for(let d=0;d<n.length;d++){const g=n[d],v=this.getStageName(g);if(t){const w=d/i*100;t({step:"loading_tickets",progress:w,details:{stage:g,stageName:v,stageIndex:d+1,totalStages:i,filter:`${a} = ${e}`}})}try{const w=await this.getTicketsByStageWithFilter(g,e,a,l,t?f=>{const p=Pa(d/i*100,1/i*100,f.percent||0);t({step:"loading_tickets",progress:p,details:{stage:g,stageName:v,stageIndex:d+1,totalStages:i,count:f.count,total:f.total,filter:`${a} = ${e}`}})}:null);r.push(...w)}catch(w){De.error(`Error loading tickets for stage ${g} with filter ${a} = ${e}`,"TicketRepository",w)}}return De.info(`Loaded ${r.length} tickets with filter ${a} = ${e}`,"TicketRepository"),r}catch(r){throw De.error(`Error loading tickets by filter ${a} = ${e}`,"TicketRepository",r),r}}static async getAllTickets(e,a=null,t=!0){const l=[],r=e.length;try{for(let n=0;n<e.length;n++){const i=e[n],d=this.getStageName(i);if(a){const g=n/r*100;a(Ge("loading_tickets",g,{stage:i,stageName:d,stageIndex:n+1,totalStages:r}))}try{const g=await this.getTicketsByStage(i,t,a?v=>{const w=Pa(n/r*100,1/r*100,v.percent||0);a(Ge("loading_tickets",w,{stage:i,stageName:d,stageIndex:n+1,totalStages:r,count:v.count,total:v.total}))}:null);l.push(...g)}catch(g){De.error(`Error loading tickets for stage ${i}`,"TicketRepository",g);let v=`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–∏ "${d}"`;throw g.message&&(g.message.includes("HTTP error")||g.message.includes("network")?v=`–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞–¥–∏–∏ "${d}". –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.`:g.message.includes("timeout")?v=`–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞–¥–∏–∏ "${d}". –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.`:g.message.includes("403")||g.message.includes("401")?v=`–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞–¥–∏–∏ "${d}". –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.`:v=`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–∏ "${d}": ${g.message}`),new Error(v)}}}catch(n){throw De.error("Error in getAllTickets","TicketRepository",n),n}return l}static getStageName(e){return{"DT140_12:UC_0VHWE2":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","DT140_12:PREPARATION":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó","DT140_12:CLIENT":"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"}[e]||e}static async getTicketsByStage(e,a=!0,t=null){if(a){const v=Oe.getTicketsCacheKey(e),w=Oe.get(v);if(w!==null){try{const f=tt();f&&ct()&&f.logTicketsLoading(e,w.length,w.length,null)}catch(f){De.warn("Diagnostics logging error (cache hit) in getTicketsByStage","TicketRepository",f)}return t&&t(ga({step:"loading_tickets",percent:100,count:w.length,total:w.length})),w}}const l=[];let r=0;const n=50;let i=!0,d=0,g=null;for(;i;)try{const v=await Dt.call("crm.item.list",{entityTypeId:zt,filter:{stageId:e},select:["*"],order:{id:"DESC"},start:r,useOriginalUfNames:"Y"});let w=[];if(v&&v.result&&(Array.isArray(v.result)?w=v.result:v.result.items&&Array.isArray(v.result.items)?w=v.result.items:v.result.data&&Array.isArray(v.result.data)&&(w=v.result.data)),w.length>0){l.push(...w),r+=w.length;const f=v?.result?.next??v?.next,p=f!=null&&f!==""&&String(f)!=="0";i=w.length===n&&p,ct()&&De.debug(`[Pagination] Stage: ${e}, Batch: ${w.length}, Total: ${l.length}, Start: ${r}, NextValue: ${f}, HasNext: ${p}, HasMore: ${i}`,"TicketRepository");try{const y=tt();y&&ct()&&(De.debug(`[Pagination Debug] Stage: ${e}, Batch: ${w.length}, Total: ${l.length}`,"TicketRepository",{resultStructure:{hasResult:!!v?.result,resultIsArray:Array.isArray(v?.result),hasItems:!!v?.result?.items,hasData:!!v?.result?.data,hasNext:!!f,nextValue:f,nextType:typeof f,resultKeys:v?.result?Object.keys(v.result):[]}}),y.logTicketsLoading(e,w.length,l.length,f||null))}catch(y){De.warn("Diagnostics logging error","TicketRepository",y)}if(i?d=r+n:d=l.length,t){const y=d>0?Math.min(100,l.length/d*100):0;t(ga({step:"loading_tickets",percent:y,count:l.length,total:d}))}g=null}else i=!1}catch(v){if(De.error(`Error loading tickets batch for stage ${e} (start: ${r})`,"TicketRepository",v),r===0)throw g=v,new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∏–∫–µ—Ç—ã –¥–ª—è —Å—Ç–∞–¥–∏–∏ ${e}: ${v.message||v}`);i=!1,t&&l.length>0&&t(Ge("loading_tickets",100,{count:l.length,total:l.length,warning:`–ó–∞–≥—Ä—É–∂–µ–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ: ${l.length} —Ç–∏–∫–µ—Ç–æ–≤. –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.`}))}if(g&&l.length===0)throw g;if(a){const v=Oe.getTicketsCacheKey(e);Oe.set(v,l,Oe.TICKETS_TTL)}return l}static async getTicket(e){return(await Dt.call("crm.item.get",{entityTypeId:zt,id:e})).result||null}static async getTicketsByStageWithFilter(e,a,t="UF_CRM_7_TYPE_PRODUCT",l=!0,r=null){De.info(`Loading tickets for stage ${e} with filter ${t} = ${a}`,"TicketRepository");const n=`tickets_${e}_${t}_${JSON.stringify(a)}`;if(l){const p=Oe.get(n);if(p!==null)return De.info(`Cache hit for filtered tickets: ${e} with ${t} = ${a}`,"TicketRepository"),r&&r({step:"loading_tickets",percent:100,count:p.length,total:p.length}),p}const i=[];let d=0;const g=50;let v=!0,w=0;const f={stageId:e};for(Array.isArray(a),f[t]=a;v;)try{const p=await Dt.call("crm.item.list",{entityTypeId:zt,filter:f,select:["*"],order:{id:"DESC"},start:d,useOriginalUfNames:"Y"});let y=[];p&&p.result&&(Array.isArray(p.result)?y=p.result:p.result.items&&Array.isArray(p.result.items)?y=p.result.items:p.result.data&&Array.isArray(p.result.data)&&(y=p.result.data)),y.length>0?(i.push(...y),d+=y.length,w=Math.max(w,d+y.length),r&&r({step:"loading_tickets",percent:Math.min(d/Math.max(w,d)*100,95),count:d,total:w}),v=y.length===g&&p.next):v=!1}catch(p){throw De.error(`Error loading batch for stage ${e} with filter ${t} = ${a}`,"TicketRepository",p),v=!1,p}l&&(Oe.set(n,i),De.info(`Cached ${i.length} filtered tickets for stage ${e}`,"TicketRepository"));try{const p=tt();p&&ct()&&p.logTicketsLoading(`${e}_${a}`,i.length,i.length,null)}catch(p){De.warn("Diagnostics logging error in getTicketsByStageWithFilter","TicketRepository",p)}return r&&r({step:"loading_tickets",percent:100,count:i.length,total:i.length}),De.info(`Loaded ${i.length} tickets for stage ${e} with filter ${t} = ${a}`,"TicketRepository"),i}static async updateTicket(e,a){const l=(await Dt.call("crm.item.update",{entityTypeId:zt,id:e,fields:a})).result===!0;return l&&Oe.invalidateTicketsCache(),l}static async createTicket(e){const a=await Dt.call("crm.item.add",{entityTypeId:zt,fields:e}),t=a.result?parseInt(a.result):0;return t>0&&Oe.invalidateTicketsCache(),t}static async assignTicket(e,a,t){return await this.updateTicket(e,{assignedById:a,stageId:t})}}class Ko{static async getEmployeesByIds(e,a=!0){if(!Array.isArray(e)||e.length===0)return[];if(a){const t=Oe.getEmployeesCacheKey(e),l=Oe.get(t);if(l!==null)return De.debug(`Cache hit for employees: ${e.length} employees`,"EmployeeRepository"),l}try{const t=await Dt.call("user.get",{filter:{ID:e},select:["ID","NAME","LAST_NAME","EMAIL","WORK_POSITION","UF_DEPARTMENT"]});let l=[];if(t&&t.result&&(Array.isArray(t.result)?l=t.result:De.warn("Unexpected user.get result format","EmployeeRepository",t)),a){const r=Oe.getEmployeesCacheKey(e);Oe.set(r,l,Oe.EMPLOYEES_TTL)}return l}catch(t){return De.error("Error getting employees by IDs","EmployeeRepository",t),[]}}}const Yt=new Map;function Cs(){Yt.clear()}function qo(o){if(!o)return[];if(Array.isArray(o))return o.filter(a=>typeof a=="number"||!isNaN(parseInt(a))).map(a=>typeof a=="number"?a:parseInt(a));if(typeof o=="number")return[o];const e=parseInt(o);return isNaN(e)?[]:[e]}function Yo(o,e=!0){const a=o.id||o.ID;if(!o||!a)return null;if(e&&Yt.has(a))return Yt.get(a);const t=o.UF_DEPARTMENT||o.departmentId,l=qo(t);for(const r of l)if(io(r)){const i=r;return e&&Yt.set(a,i),i}return e&&Yt.set(a,null),null}function Xo(o){const e=Yo(o);return{id:parseInt(o.ID||o.id||0),name:`${o.NAME||o.name||""} ${o.LAST_NAME||o.lastName||""}`.trim()||o.EMAIL||o.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:o.WORK_POSITION||o.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:o.EMAIL||o.email||"",sectorId:e,departmentId:o.UF_DEPARTMENT||null,tickets:[]}}function Jo(o){return Array.isArray(o)?o.map(e=>Xo(e)):[]}const Ea="dashboard-sectors-logger-level",Gt={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4};class Zo{static getLevel(){if(typeof localStorage<"u"){const a=localStorage.getItem(Ea);if(a&&Gt[a]!==void 0)return a}return!0?"ERROR":"DEBUG"}static setLevel(e){return Gt[e]!==void 0?(typeof localStorage<"u"&&localStorage.setItem(Ea,e),!0):!1}static isEnabled(e,a=null){const t=a||this.getLevel();if(t==="NONE")return!1;const l=Gt[e]||0,r=Gt[t]||0;return l<=r}static getLevels(){return{...Gt}}static reset(){typeof localStorage<"u"&&localStorage.removeItem(Ea)}}let Nt=class{static getLevelColor(e){return{ERROR:"#dc3545",WARN:"#ffc107",INFO:"#17a2b8",DEBUG:"#6c757d"}[e]||"#6c757d"}static formatMessage(e,a,t=""){const l=new Date().toISOString(),r=this.getLevelColor(e),n=`%c[${l}] %c[${e}] %c[${t||"Unknown"}] %c${a}`,i=["color: #6c757d; font-weight: normal",`color: ${r}; font-weight: bold`,"color: #007bff; font-weight: normal","color: #212529; font-weight: normal"];return{formatted:n,styles:i}}static log(e,a,t="",l=null){if(!Zo.isEnabled(e))return;const r=this.formatMessage(e,a,t),n=[r.formatted,...r.styles];switch(l!=null&&n.push(l),e){case"ERROR":console.error(...n);break;case"WARN":console.warn(...n);break;case"INFO":console.info(...n);break;case"DEBUG":console.log(...n);break;default:console.log(...n)}}static error(e,a="",t=null){this.log("ERROR",e,a,t)}static warn(e,a="",t=null){this.log("WARN",e,a,t)}static info(e,a="",t=null){this.log("INFO",e,a,t)}static debug(e,a="",t=null){this.log("DEBUG",e,a,t)}};const Zt=new Map,ss=100;function Qo(o,e){if(!Array.isArray(o))return Nt.warn("filterTicketsBySector: tickets is not an array","sector-filter"),[];if(!e||!e.id)return Nt.error("filterTicketsBySector: invalid sectorConfig","sector-filter",e),[];const a=sn(o,e),t=Zt.get(a);if(t!==void 0)return Nt.debug(`Filter cache hit for sector ${e.id}`,"sector-filter"),t;const l=en(e);if(l.length===0)return Nt.warn(`No filter values for sector ${e.id}`,"sector-filter"),[];const r=o.filter(n=>tn(n,l,e));return Nt.info(`Filtered ${r.length}/${o.length} tickets for sector ${e.id}`,"sector-filter",{sectorId:e.id,sectorName:e.name,totalTickets:o.length,filteredTickets:r.length,filterValues:l,filterField:e.filterField||"UF_CRM_7_TYPE_PRODUCT"}),Zt.set(a,r),on(),r}function en(o){const{filterValue:e}=o;return e?(Array.isArray(e)?e:Array.isArray(o.filterValues)?o.filterValues:[e]).filter(t=>t!=null).map(t=>Ts(t)).filter(Boolean):[]}function tn(o,e,a){if(!o||typeof o!="object")return!1;const t=an(o,a.filterField||"UF_CRM_7_TYPE_PRODUCT"),l=Ts(t);return l?e.some(r=>l===r):!1}function an(o,e){return o[e]||o[e.toLowerCase()]||o[nn(e)]||o[e.replace(/_/g,"").toLowerCase()]||null}function Ts(o){return o==null?null:(typeof o=="object"&&o.value!==void 0&&(o=o.value),Array.isArray(o)&&o.length>0&&(o=o[0]),String(o).trim().toUpperCase().replace(/–°/g,"C").replace(/—Å/g,"c")||null)}function sn(o,e){const a=o.map(r=>r.id||r.ID||"").sort().join(","),t=JSON.stringify({id:e.id,filterValue:e.filterValue,filterValues:e.filterValues,filterField:e.filterField}),l=btoa(a+"|"+t).slice(0,50);return`filter:${e.id}:${l}`}function on(){if(Zt.size>ss){const o=Math.floor(ss*.2);Array.from(Zt.keys()).slice(0,o).forEach(a=>Zt.delete(a)),Nt.debug(`Cleaned ${o} entries from filter cache`,"sector-filter")}}function nn(o){return o.toLowerCase().replace(/_([a-z])/g,(e,a)=>a.toUpperCase())}const ta=1051;function ma(o){if(!o||typeof o!="object")return null;let e=o.assignedById||o.ASSIGNED_BY_ID||o.assignedByIdId||o.assignedById;return e&&typeof e=="object"&&(e=e.id||e.ID||e.value||null),e||null}function Wa(o){if(o==null)return null;typeof o=="object"&&(o=o.id||o.ID||o.value||null);const e=typeof o=="number"?o:parseInt(o);return isNaN(e)||e<=0?null:e}function rn(o,e=ta){const a=ma(o),t=Wa(a);return t===null||t===e}function ln(o,e){Array.isArray(o)||(De.warn("Tickets is not an array","TicketGrouper",o),o=[]),Array.isArray(e)||(De.warn("Employees is not an array","TicketGrouper",e),e=[]);const a=e.filter(d=>(d.id?parseInt(d.id):null)!==ta),t=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:a.map(d=>({...d,isFromSector1C:d.sectorId===Xt.SECTOR_1C,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:a.map(d=>({...d,isFromSector1C:d.sectorId===Xt.SECTOR_1C,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:a.map(d=>({...d,isFromSector1C:d.sectorId===Xt.SECTOR_1C,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]}))}],l=new Map(t.map(d=>[d.id,d])),r=new Map;t.forEach(d=>{const g=new Map(d.employees.map(v=>[v.id,v]));r.set(d.id,g)});const n=[],i=[];o.forEach(d=>{const g=Jt(d.stageId||d.STAGE_ID||""),v=l.get(g);if(!v){i.push({id:d.id||d.ID,title:d.title||d.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",stageId:d.stageId||d.STAGE_ID,assignedById:ma(d)});return}const w=ma(d),f=Wa(w);if(f!==ta)if(f){const p=r.get(g);let y=p.get(f);y||(y={id:f,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${f}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",sectorId:null,departmentId:null,isFromSector1C:!1,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]},v.employees.push(y),p.set(f,y));const T=Ra(d),C={...T,stageId:d.stageId||d.STAGE_ID||T.stageId,departmentHead:T.departmentHead||null,departmentHeadFull:T.departmentHeadFull||T.departmentHead||null};y.tickets.push(C),y.isFromSector1C?y.ticketsInsideSector.push(C):y.ticketsOutsideSector.push(C)}else n.push({id:d.id||d.ID,title:d.title||d.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",stageId:g,assignedById:w})}),t.forEach(d=>{d.employees.sort((g,v)=>g.isFromSector1C&&!v.isFromSector1C?-1:!g.isFromSector1C&&v.isFromSector1C?1:(g.id||0)-(v.id||0))});try{const d=tt();if(d&&ct()){const g={};t.forEach(w=>{let f=0,p=0;w.employees.forEach(y=>{f+=(y.ticketsInsideSector||[]).length,p+=(y.ticketsOutsideSector||[]).length}),g[w.id]={insideSector:f,outsideSector:p,total:f+p}});const v=d.metrics.grouping;Object.keys(g).forEach(w=>{v.distributionByStages[w]||(v.distributionByStages[w]={employees:{},total:0}),v.distributionByStages[w].insideSector=g[w].insideSector,v.distributionByStages[w].outsideSector=g[w].outsideSector,v.distributionByStages[w].total=g[w].total}),d.logGrouping(t,n,i)}}catch(d){De.warn("Diagnostics logging error in groupTicketsByStages","TicketGrouper",d)}return t}function cn(o){const e={formed:[],review:[],execution:[]};if(!Array.isArray(o))return De.warn("Tickets is not an array in getZeroPointTickets","TicketGrouper",o),e;o.filter(a=>rn(a)).forEach(a=>{const t=Jt(a.stageId||a.STAGE_ID||"");if(e[t]){const l=Ra(a),r={...l,stageId:a.stageId||a.STAGE_ID||l.stageId,departmentHead:l.departmentHead||null,departmentHeadFull:l.departmentHeadFull||l.departmentHead||null};e[t].push(r)}});try{const a=tt();a&&ct()&&a.logZeroPoint(e)}catch(a){De.warn("Diagnostics logging error in getZeroPointTickets","TicketGrouper",a)}return e}function dn(o){if(!Array.isArray(o))return[];const e=new Set,a=[],t=[];o.forEach(r=>{const n=ma(r),i=Wa(n);!n||n===null||n===void 0?a.push({id:r.id||r.ID,title:r.title||r.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",stageId:r.stageId||r.STAGE_ID}):i===ta&&t.push({id:r.id||r.ID,title:r.title||r.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",stageId:r.stageId||r.STAGE_ID}),i&&e.add(i)});const l=Array.from(e);try{const r=tt();r&&ct()&&r.logEmployees(l,a,t)}catch(r){De.warn("Diagnostics logging error in extractUniqueEmployeeIds","TicketGrouper",r)}return l}const na=new Map,un=10*60*1e3;function gn(o){if(!o||typeof o!="object")return{};const e={},a=Object.keys(o);for(const t of a)t.toUpperCase().startsWith("UF_")&&(e[t]=o[t]);return e}function mn(o,e=null,a=!0){if(a&&e&&na.has(e)){const r=na.get(e),n=Date.now();if(r.timestamp&&n-r.timestamp<un)return r.data;na.delete(e)}const t=gn(o),l={typeProduct:t.UF_CRM_7_TYPE_PRODUCT||t.uf_crm_7_type_product||t.ufCrm7TypeProduct||null,all:t};return a&&e&&na.set(e,{data:l,timestamp:Date.now()}),l}class hn{static async getTicketDetails(e,a={}){const{select:t=["*"],useOriginalUfNames:l=!0,useCache:r=!0}=a;try{const n=await Lt.getTicket(e);if(!n)throw new Error(`–¢–∏–∫–µ—Ç —Å ID ${e} –Ω–µ –Ω–∞–π–¥–µ–Ω`);const i=mn(n,e,r),d=n.UF_CRM_7_UF_PRIORITY||n.uf_crm_7_uf_priority||n.ufCrm7UfPriority||n.UF_CRM_7_UF_PRIORITY||n.uf_crm_7_uf_priority||n.priority||n.PRIORITY||null,g=La(d),v=bs(g);return{id:n.id||n.ID,title:n.title||n.TITLE,stageId:n.stageId||n.STAGE_ID,assignedById:n.assignedById||n.ASSIGNED_BY_ID,createdAt:n.createdTime||n.CREATED_TIME||n.CREATED_DATE,updatedAt:n.updatedTime||n.UPDATED_TIME||n.MODIFY_DATE,priorityId:g.id,priorityLabel:g.label,priorityColors:v,priority:g.id,priorityBitrixValue:g.bitrixValue||null,opportunity:n.opportunity||n.OPPORTUNITY,currencyId:n.currencyId||n.CURRENCY_ID,comments:n.comments||n.COMMENTS,additionalFields:i,rawData:n}}catch(n){throw De.error("Error getting ticket details","TicketDetailsService",n),n}}}let Qt=class{static async getSectorData(e=!0,a=!1,t=null){let l=!1;try{if(ct()){const r=tt();r&&r.reset()}}catch(r){De.warn("Error resetting diagnostics","DashboardSector1CService",r)}if(t&&t(Ge("cache_check",0,{description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏..."})),e){const r=Oe.getSectorDataCacheKey(),n=Oe.get(r);if(n!==null)return t&&t(Ge("cache_hit",100,{description:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ in-memory –∫–µ—à–∞"})),n}try{t&&t(Ge("loading_tickets",10,{description:"–ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤ –∏–∑ Bitrix24..."}));const r=co(),n=await Lt.getAllTickets(r,p=>{if(t){const y=ga(p),T=Pa(10,40,y.progress||0);t(Ge(y.step||"loading_tickets",T,{...y.details,warning:y.details.warning}))}},e);t&&t(Ge("filtering",50,{totalTickets:n.length,description:`–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è ${n.length} —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —Å–µ–∫—Ç–æ—Ä—É 1–°...`}));const i=Qo(n,{id:"1c",name:"1C",filterValue:"1C",filterField:"UF_CRM_7_TYPE_PRODUCT"});t&&t(Ge("filtering",50,{totalTickets:n.length,filteredTickets:i.length,description:`–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ ${i.length} —Ç–∏–∫–µ—Ç–æ–≤ –∏–∑ ${n.length}`})),t&&t(Ge("extracting_employees",60,{filteredTickets:i.length,description:`–ê–Ω–∞–ª–∏–∑ ${i.length} —Ç–∏–∫–µ—Ç–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...`}));const d=dn(i);t&&t(Ge("extracting_employees",60,{employeeCount:d.length,description:`–ù–∞–π–¥–µ–Ω–æ ${d.length} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`})),t&&t(Ge("loading_employees",65,{employeeCount:d.length,description:`–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ${d.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...`})),Cs();const g=await Ko.getEmployeesByIds(d),v=Jo(g);t&&t(Ge("loading_employees",90,{employeeCount:v.length,description:`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –¥–∞–Ω–Ω—ã—Ö ${v.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`})),t&&t(Ge("grouping",90,{filteredTickets:i.length,employeeCount:v.length,description:`–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ ${i.length} —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º –∏ ${v.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º...`}));const f={stages:ln(i,v),employees:v,zeroPointTickets:cn(i)};if(t&&t(Ge("caching",95,{description:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –∫–µ—à –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."})),e){const p=Oe.getSectorDataCacheKey();Oe.set(p,f,Oe.TICKETS_TTL),l=!0}return t&&t(Ge("complete",100,{description:"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"})),l&&!a&&CacheNotificationService.notifyCacheCreationSuccess("–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°"),f}catch(r){throw De.error("Error getting sector data","DashboardSector1CService",r),t&&t({step:"error",progress:0,error:r.message}),r}}static async assignTicket(e,a,t){try{const l=Za(t),r=await Lt.assignTicket(e,a,l);return r&&Oe.invalidateTicketsCache(),r}catch(l){throw De.error("Error assigning ticket","DashboardSector1CService",l),l}}static async createTicket(e){try{const a=Za(e.stageId||"formed"),t={title:e.title,stageId:a};e.employeeId&&(t.assignedById=e.employeeId);const l=await Lt.createTicket(t);return l>0&&Oe.invalidateTicketsCache(),l}catch(a){throw De.error("Error creating ticket","DashboardSector1CService",a),a}}static async getTicket(e){try{const a=await Lt.getTicket(e);return Ra(a)}catch(a){throw De.error("Error getting ticket","DashboardSector1CService",a),a}}static async getTicketDetails(e,a={}){try{return await hn.getTicketDetails(e,a)}catch(t){throw De.error("Error getting ticket details","DashboardSector1CService",t),t}}static async addComment(e,a){try{return(await Dt.call("crm.timeline.comment.add",{fields:{entityId:e,entityType:"DYNAMIC_"+uo,comment:a}})).result!==void 0}catch(t){throw De.error("Error adding comment","DashboardSector1CService",t),t}}};const fn={name:"SectorDashboard",components:{BackButton:_s},props:{sectorId:{type:String,required:!0}},setup(o){const e=Xe(),{state:a,actions:t}=Vo(o.sectorId),l=$(()=>a.sectorStats?.name||o.sectorId.toUpperCase()),r=$(()=>a.totalTickets||0),n=$(()=>a.isLoading||!1),i=$(()=>a.error||null),d=$(()=>a.hasData||!1),g=$(()=>a.stages||[]),v=()=>{e.push("/")},w=()=>{t.loadSectorData()};return $e(()=>{console.log(`[SectorDashboard] Mounted for sector: ${o.sectorId}`),t.loadSectorData()}),{isLoading:n,error:i,hasData:d,totalTickets:r,stages:g,sectorName:l,handleGoHome:v,handleRetry:w,...t}}},vn={style:{background:"yellow",padding:"10px","margin-bottom":"10px",border:"2px solid red"}},pn={class:"dashboard-header"},yn={key:0,class:"sector-stats"},kn={class:"stat-item"},bn={class:"stat-value"},_n={class:"dashboard-content"},wn={key:0,class:"loading-indicator"},Cn={key:1,class:"error-indicator"},Tn={key:2,class:"empty-state"},Sn={class:"empty-state-content"},Dn={key:3,class:"stages-container"},En={class:"stage-header"},An={class:"stage-stats"},$n={class:"stat"};function In(o,e,a,t,l,r){const n=be("BackButton");return c(),u("div",{class:X(`dashboard-sector-${a.sectorId}`)},[s("div",vn," üö® DEBUG: SectorDashboard RENDERED for sector: "+m(a.sectorId)+" at "+m(new Date().toISOString()),1),s("div",pn,[s("h1",null,"–î–∞—à–±–æ—Ä–¥ - –°–µ–∫—Ç–æ—Ä "+m(t.sectorName),1)]),t.isLoading?A("",!0):(c(),u("div",yn,[s("div",kn,[s("div",bn,m(t.totalTickets),1),e[2]||(e[2]=s("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤",-1))])])),s("div",_n,[t.isLoading?(c(),u("div",wn,[...e[3]||(e[3]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞...",-1)])])):t.error?(c(),u("div",Cn,[e[4]||(e[4]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),s("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: "+m(t.error),1),s("button",{onClick:e[0]||(e[0]=(...i)=>t.handleRetry&&t.handleRetry(...i)),class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):t.hasData?(c(),u("div",Dn,[(c(!0),u(ee,null,te(t.stages,i=>(c(),u("div",{key:i.id,class:"stage-card",style:we({borderLeftColor:i.color})},[s("div",En,[s("h3",null,m(i.name),1),s("div",An,[s("span",$n,m(i.tickets?.length||0)+" —Ç–∏–∫–µ—Ç–æ–≤",1)])])],4))),128))])):(c(),u("div",Tn,[s("div",Sn,[e[5]||(e[5]=s("div",{class:"empty-icon"},"üìã",-1)),s("h3",null,'–°–µ–∫—Ç–æ—Ä "'+m(t.sectorName)+'" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ',1),e[6]||(e[6]=s("p",null,"–≠—Ç–æ—Ç —Å–µ–∫—Ç–æ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.",-1)),s("button",{onClick:e[1]||(e[1]=(...i)=>t.handleRetry&&t.handleRetry(...i)),class:"btn-retry"},"–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ")])]))]),ne(n,{variant:"floating"})],2)}const Ss=ce(fn,[["render",In],["__scopeId","data-v-6471e55a"]]),Mn=Object.freeze(Object.defineProperty({__proto__:null,default:Ss},Symbol.toStringTag,{value:"Module"})),Ds="/api/tickets-time-tracking-sector-1c.php";function Nn(o){if(!o)return{meta:null,data:{totalElapsedTime:0,totalElapsedTimeUnit:"hours",totalRecordsCount:0,weeks:[],employeesSummary:[]}};const e=o.data||o.result||o,a=e.meta||o.meta||null;return{meta:{weekNumber:a?.weekNumber??null,weekStartUtc:a?.weekStartUtc??null,weekEndUtc:a?.weekEndUtc??null,totalWeeks:a?.totalWeeks??0,sector1CEmployeesCount:a?.sector1CEmployeesCount??0},data:{totalElapsedTime:e.data?.totalElapsedTime??e.totalElapsedTime??0,totalElapsedTimeUnit:e.data?.totalElapsedTimeUnit??e.totalElapsedTimeUnit??"hours",totalRecordsCount:e.data?.totalRecordsCount??e.totalRecordsCount??0,weeks:e.data?.weeks??e.weeks??[],employeesSummary:e.data?.employeesSummary??e.employeesSummary??[]}}}async function xn(o={}){const{product:e="1C",weekStartUtc:a=null,weekEndUtc:t=null,weeksCount:l=4}=o;try{const r=et(Ds),n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:e,weekStartUtc:a,weekEndUtc:t,weeksCount:l})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.json();if(i.error)throw new Error(i.error_description||i.error||"Unknown error");const d=Nn(i);if(i.cache_used===!0){const{CacheNotificationService:g}=await Ee(async()=>{const{CacheNotificationService:v}=await Promise.resolve().then(()=>GA);return{CacheNotificationService:v}},void 0,import.meta.url);g.notifyCacheUsed("–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°")}return d}catch(r){throw console.error("[TimeTrackingService] Error fetching time tracking data:",r),r}}async function Ln({taskIds:o,employeeId:e,weekNumber:a,page:t=1,perPage:l=10}){if(!o||!Array.isArray(o)||o.length===0)return{tasks:[],pagination:{totalTasks:0,currentPage:1,perPage:l,totalPages:0}};try{const r=et(Ds),n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:"1C",includeTaskDetails:!0,taskIds:o,employeeId:e||void 0,weekNumber:a||void 0,page:t,perPage:l})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.json();if(!i.success)throw new Error(i.error||i.error_description||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–¥–∞—á–∞—Ö");return{tasks:i.data.tasks||[],pagination:i.data.pagination||{totalTasks:0,currentPage:1,perPage:l,totalPages:0}}}catch(r){throw console.error("[timeTrackingService] Error loading tasks details:",r),r}}const Es={getTimeTrackingData:xn,getTasksDetails:Ln};function qe(o,e=1){return typeof o!="number"||isNaN(o)?"0 —á":`${o.toFixed(e)} —á`}function ra(o,e){if(!o||!e)return`–ù–µ–¥–µ–ª—è ${o||"?"}`;try{const a=new Date(e),t=new Date(a);t.setDate(t.getDate()+6);const l=a.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}),r=t.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"});return`–ù–µ–¥–µ–ª—è ${o} (${l} - ${r})`}catch(a){return console.error("[TimeTrackingUtils] Error formatting week label:",a),`–ù–µ–¥–µ–ª—è ${o}`}}function Pn(o){return!o||!o.data?!1:o.data.totalRecordsCount>0||o.data.weeks&&o.data.weeks.length>0}const On={class:"ttt-summary"},Bn={class:"summary-cards"},Rn={class:"summary-card summary-card--total"},Wn={class:"summary-card__content"},Un={class:"summary-card__value"},Fn={class:"summary-card summary-card--employees"},Hn={class:"summary-card__content"},jn={class:"summary-card__value"},Vn={class:"summary-card summary-card--average"},zn={class:"summary-card__content"},Gn={class:"summary-card__value"},Kn={__name:"TicketsTimeTrackingSummary",props:{data:{type:Object,required:!0}},setup(o){const e=o,a=$(()=>e.data?.data?.totalElapsedTime||0),t=$(()=>e.data?.meta?.sector1CEmployeesCount||0),l=$(()=>{const i=a.value,d=t.value;return d>0?i/d:0}),r=$(()=>a.value===0?"0.0 —á":qe(a.value,1)),n=$(()=>l.value===0?"0.00 —á":qe(l.value,2));return(i,d)=>(c(),u("div",On,[s("div",Bn,[s("div",Rn,[d[1]||(d[1]=s("div",{class:"summary-card__icon"},"‚è±",-1)),s("div",Wn,[d[0]||(d[0]=s("div",{class:"summary-card__label"},"–û–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç",-1)),s("div",Un,m(r.value),1)])]),s("div",Fn,[d[3]||(d[3]=s("div",{class:"summary-card__icon"},"üë•",-1)),s("div",Hn,[d[2]||(d[2]=s("div",{class:"summary-card__label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ —Å–µ–∫—Ç–æ—Ä–µ",-1)),s("div",jn,m(t.value),1)])]),s("div",Vn,[d[5]||(d[5]=s("div",{class:"summary-card__icon"},"üìä",-1)),s("div",zn,[d[4]||(d[4]=s("div",{class:"summary-card__label"},"–°—Ä–µ–¥–Ω—è—è –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞",-1)),s("div",Gn,m(n.value),1)])])])]))}},qn=ce(Kn,[["__scopeId","data-v-51b124c7"]]),Yn={class:"ttt-table-container"},Xn={key:0,class:"ttt-table-loading"},Jn={key:1,class:"ttt-table-error"},Zn={key:2,class:"ttt-table-empty"},Qn={key:3,class:"ttt-table-wrapper"},er={class:"ttt-table"},tr=["onClick"],ar={class:"ttt-table__header-week-date"},sr=["onClick"],or={class:"ttt-table__cell-employee"},nr=["onClick"],rr={class:"ttt-table__cell-total"},lr={class:"ttt-table__row-total"},ir=["onClick"],cr={class:"ttt-table__cell-total"},dr={__name:"TicketsTimeTrackingTable",props:{data:{type:Object,required:!0},loading:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["cell-click","employee-click","week-click"],setup(o,{emit:e}){const a=o,t=e,l=$(()=>a.data?.data?.weeks||[]),r=$(()=>{if(!a.data||!a.data.data||!a.data.data.weeks)return null;const f=a.data.data.weeks||[],y=(a.data.data.employeesSummary||[]).map(k=>{const S={};let x=0;return f.forEach(U=>{const E=U.employees?.find(D=>D.id===k.id)?.elapsedTime||0;S[U.weekNumber]=E,x+=E}),{id:k.id,name:k.name,weeks:S,total:x}}),T={};let C=0;return f.forEach(k=>{T[k.weekNumber]=k.totalElapsedTime||0,C+=k.totalElapsedTime||0}),{employees:y,weekTotals:T,grandTotal:C}}),n=(f,p)=>r.value?.employees.find(T=>T.id===f)?.weeks[p]||0,i=f=>r.value?.weekTotals[f]||0,d=f=>{if(!f)return"";try{return new Date(f).toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}catch{return""}},g=(f,p)=>{const y=r.value?.employees.find(C=>C.id===f),T=a.data?.data?.weeks?.find(C=>C.weekNumber===p);y&&T&&t("cell-click",{employee:y,week:T,elapsedTime:n(f,p)})},v=f=>{const p=r.value?.employees.find(y=>y.id===f);p&&t("employee-click",{employee:p,weeks:l.value.map(y=>({week:y,elapsedTime:n(f,y.weekNumber)}))})},w=f=>{const p=l.value.find(y=>y.weekNumber===f);p&&t("week-click",{week:p,employees:r.value?.employees.map(y=>({employee:y,elapsedTime:n(y.id,f)})).filter(y=>y.elapsedTime>0)})};return(f,p)=>(c(),u("div",Yn,[o.loading?(c(),u("div",Xn," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):o.error?(c(),u("div",Jn,m(o.error),1)):!r.value||r.value.employees.length===0?(c(),u("div",Zn," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ")):(c(),u("div",Qn,[s("table",er,[s("thead",null,[s("tr",null,[p[1]||(p[1]=s("th",{class:"ttt-table__header-employee"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",-1)),(c(!0),u(ee,null,te(l.value,y=>(c(),u("th",{key:y.weekNumber,class:X(["ttt-table__header-week",{"ttt-table__header--clickable":!0}]),onClick:T=>w(y.weekNumber)},[ge(" –ù–µ–¥–µ–ª—è "+m(y.weekNumber),1),p[0]||(p[0]=s("br",null,null,-1)),s("span",ar,m(d(y.weekStartUtc)),1)],8,tr))),128)),p[2]||(p[2]=s("th",{class:"ttt-table__header-total"},"–ò—Ç–æ–≥–æ",-1))])]),s("tbody",null,[(c(!0),u(ee,null,te(r.value.employees,y=>(c(),u("tr",{key:y.id,class:X(["ttt-table__row",{"ttt-table__row--clickable":!0}]),onClick:T=>v(y.id)},[s("td",or,m(y.name),1),(c(!0),u(ee,null,te(l.value,T=>(c(),u("td",{key:`${y.id}-${T.weekNumber}`,class:X(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:Ce(C=>g(y.id,T.weekNumber),["stop"])},m(We(qe)(n(y.id,T.weekNumber))),9,nr))),128)),s("td",rr,[s("strong",null,m(We(qe)(y.total)),1)])],8,sr))),128)),s("tr",lr,[p[3]||(p[3]=s("td",{class:"ttt-table__cell-employee"},[s("strong",null,"–í–°–ï–ì–û")],-1)),(c(!0),u(ee,null,te(l.value,y=>(c(),u("td",{key:`total-${y.weekNumber}`,class:X(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:T=>w(y.weekNumber)},[s("strong",null,m(We(qe)(i(y.weekNumber))),1)],8,ir))),128)),s("td",cr,[s("strong",null,m(We(qe)(r.value.grandTotal)),1)])])])])]))]))}},ur=ce(dr,[["__scopeId","data-v-8021e5e4"]]),gr={class:"modal-header"},mr={class:"modal-body"},hr={key:"level-1",class:"detail-cell"},fr={class:"detail-info"},vr={key:0,class:"tasks-list"},pr={class:"task-header"},yr={class:"task-label"},kr={class:"task-time"},br={key:0,class:"ticket-info"},_r={class:"ticket-label"},wr=["title"],Cr={key:1,class:"ticket-title"},Tr={key:1,class:"ticket-info ticket-info--no-ticket"},Sr={class:"detail-total"},Dr={key:0,class:"detail-actions"},Er={key:"level-2",class:"tasks-list-level"},Ar={class:"tasks-list-header"},$r={class:"tasks-list-title"},Ir={class:"tasks-list-content"},Mr={key:"loading",class:"loading-state"},Nr={key:"error",class:"error-state"},xr={class:"error-message"},Lr={key:"empty",class:"empty-state"},Pr={key:"tasks",class:"tasks-cards-container"},Or=["onClick"],Br={class:"task-card__header"},Rr={class:"task-card__number"},Wr={key:0,class:"task-card__time"},Ur={class:"task-card__title"},Fr={class:"task-card__dates"},Hr={class:"task-card__date-item"},jr={class:"date-value"},Vr={class:"task-card__date-item"},zr={class:"task-card__date-item"},Gr={class:"date-value"},Kr={key:0,class:"task-card__ticket"},qr={class:"ticket-header"},Yr={class:"ticket-header__left"},Xr={class:"ticket-id"},Jr=["title"],Zr={class:"ticket-title"},Qr={class:"ticket-meta"},el={class:"ticket-meta__row"},tl={class:"ticket-meta__item"},al={class:"meta-value"},sl={class:"ticket-meta__item"},ol={class:"meta-value"},nl={class:"ticket-meta__row"},rl={class:"ticket-meta__item"},ll={class:"meta-value"},il={class:"ticket-meta__item"},cl={class:"meta-value"},dl={class:"ticket-dates"},ul={class:"ticket-date-item"},gl={class:"date-value"},ml={key:1,class:"task-card__no-ticket"},hl={key:0,class:"tasks-pagination"},fl=["disabled"],vl={class:"pagination-pages"},pl=["onClick"],yl=["disabled"],kl={key:"employee",class:"detail-employee"},bl={class:"detail-info"},_l={class:"weeks-list"},wl={class:"week-header"},Cl={class:"week-label"},Tl={class:"week-time"},Sl={key:"week",class:"detail-week"},Dl={class:"detail-info"},El={class:"employees-list"},Al={class:"employee-header"},$l={class:"employee-label"},Il={class:"employee-time"},Ml={__name:"TimeTrackingDetailModal",props:{cellData:{type:Object,default:null}},emits:["close"],setup(o,{emit:e}){const a=o,t=e,l=I(1),r=I([]),n=I(!1),i=I(null),d=I(1),g=I(10),v=$(()=>{if(!a.cellData)return"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç";if(l.value===2)return`–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: ${a.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}, –ù–µ–¥–µ–ª—è ${a.cellData.week?.weekNumber||"?"}`;if(a.cellData.type==="employee")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${a.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}`;if(a.cellData.type==="week")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: –ù–µ–¥–µ–ª—è ${a.cellData.week?.weekNumber||"?"}`;const Y=a.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",H=a.cellData.week?.weekNumber||"?",Z=qe(a.cellData.elapsedTime||0);return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${Y}, –ù–µ–¥–µ–ª—è ${H} (${Z})`}),w=$(()=>a.cellData?.week?.employees&&a.cellData.week.employees.find(H=>H.id===a.cellData.employee?.id)?.tasksCount||0),f=$(()=>a.cellData?.week?.employees&&a.cellData.week.employees.find(H=>H.id===a.cellData.employee?.id)?.ticketsCount||0);$(()=>a.cellData?.week?.weekNumber||null);const p=I({totalTasks:0,currentPage:1,perPage:10,totalPages:0}),y=$(()=>p.value.totalPages),T=$(()=>r.value),C=$(()=>{const Y=[];let Z=Math.max(1,p.value.currentPage-Math.floor(2.5)),fe=Math.min(y.value,Z+5-1);fe-Z<4&&(Z=Math.max(1,fe-5+1));for(let P=Z;P<=fe;P++)Y.push(P);return Y}),k=Y=>{if(!Y||Y.length===0)return"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω";if(Y.length===1)return ra(Y[0].week.weekNumber,Y[0].week.weekStartUtc);const H=Y[0].week,Z=Y[Y.length-1].week;return`${ra(H.weekNumber,H.weekStartUtc)} - ${ra(Z.weekNumber,Z.weekStartUtc)}`},S=Y=>Y?ra(Y.weekNumber,Y.weekStartUtc):"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω",x=Y=>{if(!Y)return"-";try{const H=new Date(Y);return isNaN(H.getTime())?"-":H.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(H){return console.warn("[TimeTrackingDetailModal] Error formatting date:",Y,H),"-"}},U=(Y,H)=>{if(H)try{const Z=new Date(H);if(!isNaN(Z.getTime()))return!1}catch{}if(!Y)return!1;try{const Z=new Date(Y);return isNaN(Z.getTime())?!1:new Date>Z}catch(Z){return console.warn("[TimeTrackingDetailModal] Error checking overdue:",Y,Z),!1}},L=Y=>{const H=Y.closedDate?new Date(Y.closedDate):null,Z=U(Y.deadline,Y.closedDate);return{"task-card--completed":!!H,"task-card--overdue":Z,"task-card--in-progress":!H&&!Z}},E=async()=>{l.value=2,await B()},D=()=>{l.value=1,r.value=[],i.value=null,d.value=1,p.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0}},N=Y=>!Y||typeof Y!="object"?!1:!Y.id||typeof Y.id!="number"?(console.warn("[TimeTrackingDetailModal] Invalid task (no ID):",Y),!1):!0,B=async()=>{if(!a.cellData?.week?.employees||!a.cellData.employee){i.value="–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á";return}n.value=!0,i.value=null;try{const Y=a.cellData.week.employees.find(fe=>fe.id===a.cellData.employee?.id);if(!Y){r.value=[];return}let H=[];if(Array.isArray(Y.tasks)&&Y.tasks.length>0&&(H=Y.tasks.map(fe=>typeof fe=="object"&&fe!==null&&fe.id?fe.id:typeof fe=="number"?fe:null).filter(fe=>fe!==null&&fe>0)),H.length===0){r.value=[];return}const Z=await Es.getTasksDetails({taskIds:H,employeeId:a.cellData.employee.id,weekNumber:a.cellData.week.weekNumber,page:d.value,perPage:g.value});if(!Z||!Array.isArray(Z.tasks)){console.error("[TimeTrackingDetailModal] Invalid response format:",Z),i.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞",r.value=[];return}r.value=Z.tasks.filter(N),p.value=Z.pagination||{totalTasks:0,currentPage:1,perPage:g.value,totalPages:0},d.value=p.value.currentPage}catch(Y){console.error("[TimeTrackingDetailModal] Error loading tasks details:",{error:Y,taskIds:a.cellData?.week?.employees?.find(Z=>Z.id===a.cellData.employee?.id)?.tasks?.map(Z=>Z.id)||[],employeeId:a.cellData.employee?.id,weekNumber:a.cellData.week?.weekNumber,timestamp:new Date().toISOString()});const H=Y.message||"";H.includes("network")||H.includes("fetch")||H.includes("Failed to fetch")?i.value="–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.":H.includes("timeout")?i.value="–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":H.includes("403")||H.includes("401")?i.value="–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.":H.includes("404")?i.value="–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.":H.includes("500")?i.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":i.value=H||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á",r.value=[]}finally{n.value=!1}},W=()=>{d.value=1,B()};Ne(d,()=>{l.value===2&&B()});const G=Y=>{if(Y>=1&&Y<=y.value&&Y!==d.value){d.value=Y;const H=document.querySelector(".tasks-cards-container");H&&(H.scrollTop=0)}},q=Y=>{console.log("[TimeTrackingDetailModal] Task clicked:",Y.id)},oe=()=>{t("close")};return Ne(()=>a.cellData,Y=>{Y||(l.value=1,r.value=[],i.value=null,d.value=1,p.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0})}),(Y,H)=>(c(),he(It,{to:"body"},[o.cellData?(c(),u("div",{key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:Ce(oe,["self"]),onKeydown:Re(oe,["esc"])},[s("div",{class:"modal-content",onClick:H[2]||(H[2]=Ce(()=>{},["stop"]))},[s("div",gr,[s("h2",null,m(v.value),1),s("button",{class:"close-button",onClick:oe,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),s("div",mr,[ne(Ae,{name:"level",mode:"out-in"},{default:ye(()=>[l.value===1&&(o.cellData.type==="cell"||!o.cellData.type&&o.cellData.employee&&o.cellData.week)?(c(),u("div",hr,[s("div",fr,[s("p",null,[H[3]||(H[3]=s("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),ge(" "+m(o.cellData.employee?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),s("p",null,[H[4]||(H[4]=s("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),ge(" "+m(o.cellData.week?.weekNumber||"?"),1)]),s("p",null,[H[5]||(H[5]=s("strong",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),ge(" "+m(We(qe)(o.cellData.elapsedTime||0)),1)])]),o.cellData.week?.employees?(c(),u("div",vr,[H[8]||(H[8]=s("h3",null,"–ó–∞–¥–∞—á–∏ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã:",-1)),(c(!0),u(ee,null,te(o.cellData.week.employees.filter(Z=>Z.id===o.cellData.employee?.id),Z=>(c(),u("div",{key:Z.id,class:"employee-tasks"},[(c(!0),u(ee,null,te(Z.tasks,(fe,P)=>(c(),u("div",{class:"task-item",key:P},[s("div",pr,[s("span",yr,"–ó–∞–¥–∞—á–∞ #"+m(fe.id||P+1),1),s("span",kr,m(We(qe)(fe.elapsedTime||0)),1)]),fe.ticket?(c(),u("div",br,[s("span",_r,"–¢–∏–∫–µ—Ç #"+m(fe.ticket.id),1),fe.ticket.createdWeek&&fe.ticket.createdWeek!==o.cellData.week.weekNumber?(c(),u("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${fe.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${o.cellData.week.weekNumber}`}," (—Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ "+m(fe.ticket.createdWeek)+") ",9,wr)):A("",!0),fe.ticket.title?(c(),u("div",Cr,m(fe.ticket.title),1)):A("",!0)])):(c(),u("div",Tr,[...H[6]||(H[6]=[s("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])]))]))),128))]))),128)),s("div",Sr,[s("p",null,[H[7]||(H[7]=s("strong",null,"–ò—Ç–æ–≥–æ:",-1)),ge(" "+m(We(qe)(o.cellData.elapsedTime||0))+" ("+m(w.value)+" –∑–∞–¥–∞—á, "+m(f.value)+" —Ç–∏–∫–µ—Ç–æ–≤) ",1)])]),w.value>0?(c(),u("div",Dr,[s("button",{class:"btn btn-primary btn-tasks-list",onClick:E}," üìã –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á ")])):A("",!0)])):A("",!0)])):l.value===2?(c(),u("div",Er,[s("div",Ar,[s("button",{class:"btn-back",onClick:D,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê –ù–∞–∑–∞–¥ "),s("h3",$r," –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: "+m(o.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫")+", –ù–µ–¥–µ–ª—è "+m(o.cellData.week?.weekNumber||"?"),1)]),s("div",Ir,[ne(Ae,{name:"loading",mode:"out-in"},{default:ye(()=>[n.value?(c(),u("div",Mr,[...H[9]||(H[9]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...",-1)])])):i.value?(c(),u("div",Nr,[H[10]||(H[10]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),H[11]||(H[11]=s("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),s("p",xr,m(i.value),1),s("button",{class:"btn btn-retry",onClick:W},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):r.value.length===0?(c(),u("div",Lr,[...H[12]||(H[12]=[s("div",{class:"empty-state-icon"},"üìã",-1),s("p",{class:"empty-state-message"},"–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)])])):(c(),u("div",Pr,[ne(Qe,{name:"task-card",tag:"div",class:"tasks-cards-list"},{default:ye(()=>[(c(!0),u(ee,null,te(T.value.filter(N),Z=>(c(),u("div",{key:Z.id,class:X(["task-card",L(Z)]),onClick:fe=>q(Z)},[s("div",Br,[s("span",Rr,"–ó–∞–¥–∞—á–∞ #"+m(Z.id),1),Z.elapsedTime?(c(),u("span",Wr,m(We(qe)(Z.elapsedTime)),1)):A("",!0)]),s("div",Ur,m(Z.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),s("div",Fr,[s("div",Hr,[H[13]||(H[13]=s("span",{class:"date-icon"},"üìÖ",-1)),H[14]||(H[14]=s("span",{class:"date-label"},"–ù–∞—á–∞–ª–æ:",-1)),s("span",jr,m(x(Z.startDate)),1)]),s("div",Vr,[H[15]||(H[15]=s("span",{class:"date-icon"},"‚è∞",-1)),H[16]||(H[16]=s("span",{class:"date-label"},"–î–µ–¥–ª–∞–π–Ω:",-1)),s("span",{class:X(["date-value",{"date-value--overdue":U(Z.deadline,Z.closedDate)}])},m(x(Z.deadline)||"-"),3)]),s("div",zr,[H[17]||(H[17]=s("span",{class:"date-icon"},"‚úì",-1)),H[18]||(H[18]=s("span",{class:"date-label"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ:",-1)),s("span",Gr,m(x(Z.closedDate)||"-"),1)])]),Z.ticket?(c(),u("div",Kr,[s("div",qr,[s("div",Yr,[s("span",Xr,"–¢–∏–∫–µ—Ç #"+m(Z.ticket.id),1),Z.ticket.createdWeek&&Z.ticket.createdWeek!==o.cellData.week?.weekNumber?(c(),u("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${Z.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${o.cellData.week?.weekNumber}`}," –°–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥. "+m(Z.ticket.createdWeek),9,Jr)):A("",!0)])]),s("div",Zr,m(Z.ticket.title||Z.ticket.ufSubject||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),s("div",Qr,[s("div",el,[s("div",tl,[H[19]||(H[19]=s("span",{class:"meta-label"},"–°–µ–∫—Ç–æ—Ä:",-1)),s("span",al,m(Z.ticket.ufSlaBlockStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)]),s("div",sl,[H[20]||(H[20]=s("span",{class:"meta-label"},"–°–µ—Ä–≤–∏—Å:",-1)),s("span",ol,m(Z.ticket.ufSlaServiceStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])]),s("div",nl,[s("div",rl,[H[21]||(H[21]=s("span",{class:"meta-label"},"–î–µ–π—Å—Ç–≤–∏–µ:",-1)),s("span",ll,m(Z.ticket.ufActionStr||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),1)]),s("div",il,[H[22]||(H[22]=s("span",{class:"meta-label"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:",-1)),s("span",cl,m(Z.ticket.ufCrm7UfPriority||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])])]),s("div",dl,[s("div",ul,[H[23]||(H[23]=s("span",{class:"date-icon"},"üìÖ",-1)),H[24]||(H[24]=s("span",{class:"date-label"},"–°–æ–∑–¥–∞–Ω:",-1)),s("span",gl,m(x(Z.ticket.createdTime)),1)])])])):(c(),u("div",ml,[...H[25]||(H[25]=[s("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])])),H[26]||(H[26]=s("div",{class:"task-card__status-placeholder"},null,-1))],10,Or))),128))]),_:1}),y.value>1?(c(),u("div",hl,[s("button",{class:"pagination-btn",disabled:p.value.currentPage===1,onClick:H[0]||(H[0]=Z=>G(p.value.currentPage-1))}," ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,fl),s("div",vl,[(c(!0),u(ee,null,te(C.value,Z=>(c(),u("button",{key:Z,class:X(["pagination-page",{"pagination-page--active":Z===p.value.currentPage}]),onClick:fe=>G(Z)},m(Z),11,pl))),128))]),s("button",{class:"pagination-btn",disabled:p.value.currentPage===y.value,onClick:H[1]||(H[1]=Z=>G(p.value.currentPage+1))}," –°–ª–µ–¥—É—é—â–∞—è ‚Üí ",8,yl)])):A("",!0)]))]),_:1})])])):l.value===1&&o.cellData.type==="employee"?(c(),u("div",kl,[s("div",bl,[s("p",null,[H[27]||(H[27]=s("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),ge(" "+m(o.cellData.employee?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),s("p",null,[H[28]||(H[28]=s("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),ge(" "+m(k(o.cellData.weeks)),1)])]),s("div",_l,[H[29]||(H[29]=s("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –Ω–µ–¥–µ–ª—è–º:",-1)),(c(!0),u(ee,null,te(o.cellData.weeks,Z=>(c(),u("div",{key:Z.week.weekNumber,class:"week-item"},[s("div",wl,[s("span",Cl,"–ù–µ–¥–µ–ª—è "+m(Z.week.weekNumber),1),s("span",Tl,m(We(qe)(Z.elapsedTime||0)),1)])]))),128))])])):l.value===1&&o.cellData.type==="week"?(c(),u("div",Sl,[s("div",Dl,[s("p",null,[H[30]||(H[30]=s("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),ge(" "+m(o.cellData.week?.weekNumber||"?"),1)]),s("p",null,[H[31]||(H[31]=s("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),ge(" "+m(S(o.cellData.week)),1)]),s("p",null,[H[32]||(H[32]=s("strong",null,"–û–±—â–∏–µ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),ge(" "+m(We(qe)(o.cellData.week?.totalElapsedTime||0)),1)])]),s("div",El,[H[33]||(H[33]=s("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:",-1)),(c(!0),u(ee,null,te(o.cellData.employees,Z=>(c(),u("div",{key:Z.employee.id,class:"employee-item"},[s("div",Al,[s("span",$l,m(Z.employee.name),1),s("span",Il,m(We(qe)(Z.elapsedTime||0)),1)])]))),128))])])):A("",!0)]),_:1})]),s("div",{class:"modal-footer"},[s("button",{class:"close-btn",onClick:oe},"–ó–∞–∫—Ä—ã—Ç—å")])])],32)):A("",!0)]))}},Nl=ce(Ml,[["__scopeId","data-v-fc33390b"]]),xl={class:"tickets-time-tracking-dashboard"},Ll={class:"dashboard-header"},Pl={class:"breadcrumbs-row"},Ol=["aria-label","aria-disabled","data-fallback","disabled"],Bl={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Rl={key:"preloader",class:"time-tracking-preloader"},Wl={key:"error",class:"error-state"},Ul={key:"empty",class:"empty-state"},Fl={key:"content",class:"dashboard-content"},Hl={__name:"TicketsTimeTrackingDashboard",setup(o){const e=Xe(),a=I(!0),t=I(null),l=I(null),r=I(null),n=I(!1),i=$(()=>Pn(l.value)),d=async()=>{a.value=!0,t.value=null;const k=new Promise(S=>setTimeout(S,300));try{const[S,x]=await Promise.all([k,Es.getTimeTrackingData({product:"1C",weeksCount:4})]);l.value=x}catch(S){console.error("[TicketsTimeTrackingDashboard] Error loading data:",S),t.value=S.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}finally{a.value=!1}},g=k=>{r.value=k},v=k=>{r.value={type:"employee",...k}},w=k=>{r.value={type:"week",...k}},f=()=>{r.value=null},p=$(()=>typeof window>"u"?!1:window.history.length>1),y=$(()=>p.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"),T=()=>{n.value||(n.value=!0,p.value?e.go(-1):e.push({name:"dashboard-sector-1c"}),setTimeout(()=>{n.value=!1},300))},C=()=>{e.push("/")};return $e(()=>{d()}),(k,S)=>{const x=be("router-link");return c(),u("div",xl,[s("div",Ll,[s("div",Pl,[s("button",{class:"btn-home-link",type:"button",onClick:C,title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),S[7]||(S[7]=s("span",{class:"breadcrumb-separator"},"/",-1)),s("button",{class:"btn-back-link",type:"button",onClick:T,"aria-label":y.value,"aria-disabled":!p.value,"data-fallback":!p.value,disabled:n.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,Ol),s("nav",Bl,[ne(x,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ye(()=>[...S[0]||(S[0]=[ge(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),S[3]||(S[3]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ne(x,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:ye(()=>[...S[1]||(S[1]=[ge(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),S[4]||(S[4]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ne(x,{to:{name:"dashboard-graph-admission-closure"},class:"breadcrumb-link"},{default:ye(()=>[...S[2]||(S[2]=[ge(" –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π ",-1)])]),_:1}),S[5]||(S[5]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),S[6]||(S[6]=s("span",{class:"breadcrumb-current"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã",-1))])])]),S[10]||(S[10]=s("h1",{class:"dashboard-title"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),A("",!0),ne(Ae,{name:"fade",mode:"out-in"},{default:ye(()=>[a.value?(c(),u("div",Rl,[...S[8]||(S[8]=[s("div",{class:"preloader-content"},[s("div",{class:"preloader-spinner"},[s("div",{class:"spinner-ring"}),s("div",{class:"spinner-ring"}),s("div",{class:"spinner-ring"})]),s("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"),s("p",{class:"preloader-message"},"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö..."),s("div",{class:"preloader-dots"},[s("span",{class:"dot"}),s("span",{class:"dot"}),s("span",{class:"dot"})])],-1)])])):t.value?(c(),u("div",Wl,[s("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: "+m(t.value),1),s("button",{onClick:d,class:"retry-button"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):i.value?(c(),u("div",Fl,[l.value?(c(),he(qn,{key:0,data:l.value},null,8,["data"])):A("",!0),l.value?(c(),he(ur,{key:1,data:l.value,loading:a.value,error:t.value,onCellClick:g,onEmployeeClick:v,onWeekClick:w},null,8,["data","loading","error"])):A("",!0)])):(c(),u("div",Ul,[...S[9]||(S[9]=[s("p",null,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])]))]),_:1}),r.value?(c(),he(Nl,{key:1,"cell-data":r.value,onClose:f},null,8,["cell-data"])):A("",!0)])}}},As=ce(Hl,[["__scopeId","data-v-2f7848de"]]),jl=Object.freeze(Object.defineProperty({__proto__:null,default:As},Symbol.toStringTag,{value:"Module"}));Je.register(Gs,Ks,qs,Ys,Xs,Js,Zs,Qs,eo,to);Je.defaults.responsive=!0;Je.defaults.maintainAspectRatio=!1;Je.defaults.plugins.legend.display=!0;Je.defaults.plugins.legend.position="top";const J={primary:"#007bff",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8",carryover:"#ff9800",successLight:"#6cbf47",carryoverLight:"#ffb74d",carryoverDark:"#f57c00"},ht={apiBaseUrl:"",snapshotsEndpoint:"/api/snapshots.php",defaultSectorId:"1C",snapshotVersion:"1.0",timeout:3e4};class pt{static getApiBaseUrl(){return lo()}static async createSnapshot(e,a,t={}){try{if(!e||typeof e!="object")throw new St("sectorData –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º","VALIDATION_ERROR");if(!a||!["week_start","week_end","manual","current"].includes(a))throw new St("type –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–Ω–∏–º –∏–∑: week_start, week_end, manual, current","VALIDATION_ERROR");const l=this.validateSectorData(e);if(!l.isValid)throw new St(`–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞: ${l.errors.join(", ")}`,"VALIDATION_ERROR",{validation:l});const r=this.normalizeSectorData(e),i={metadata:this.generateSnapshotMetadata(a,t.createdBy,t.sectorId||ht.defaultSectorId),statistics:r.statistics,ticketIds:r.ticketIds,tickets:r.tickets},d=this.validateSnapshot(i);if(!d.isValid)throw new St(`–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–ª–µ–ø–∫–∞: ${d.errors.join(", ")}`,"VALIDATION_ERROR",{validation:d});d.warnings.length>0&&console.warn("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–ª–µ–ø–∫–∞:",d.warnings);const g=this.getApiBaseUrl(),v=await fetch(`${g}${ht.snapshotsEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({action:"create",snapshot:i,type:a,date:this.formatDate(new Date)})});if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);const w=await v.json();if(!w.success)throw new Error(w.message||"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞");return w.data.snapshot}catch(l){throw console.error("SnapshotService.createSnapshot error:",l),l instanceof St?l:new St(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞: ${l.message}`,"API_ERROR",{originalError:l})}}static async getSnapshot(e,a){try{const t=this.formatDate(e),r=`${this.getApiBaseUrl()}${ht.snapshotsEndpoint}?action=get&date=${t}&type=${a}`,n=await fetch(r,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(n.status===404)return null;if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.json();if(!i.success){if(i.message&&i.message.includes("–Ω–µ –Ω–∞–π–¥–µ–Ω"))return null;throw new Error(i.message||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–ø–∫–∞")}return i.data.snapshot}catch(t){throw console.error("SnapshotService.getSnapshot error:",t),t}}static async getAllSnapshots(e={}){try{const a=new URLSearchParams;a.append("action","list"),e.startDate&&a.append("startDate",this.formatDate(e.startDate)),e.endDate&&a.append("endDate",this.formatDate(e.endDate)),e.type&&a.append("type",e.type),e.sectorId?a.append("sectorId",e.sectorId):a.append("sectorId",ht.defaultSectorId);const l=`${this.getApiBaseUrl()}${ht.snapshotsEndpoint}?${a.toString()}`,r=await fetch(l,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const n=await r.json();if(!n.success)throw new Error(n.message||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–ª–µ–ø–∫–æ–≤");return(await Promise.all(n.data.snapshots.map(async d=>{try{return await this.getSnapshot(d.date,d.type)}catch(g){return console.warn(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–µ–ø–∫–∞ ${d.date}/${d.type}:`,g),null}}))).filter(d=>d!==null).sort((d,g)=>new Date(d.metadata.createdAt)-new Date(g.metadata.createdAt))}catch(a){throw console.error("SnapshotService.getAllSnapshots error:",a),a}}static normalizeSectorData(e){const{stages:a=[],employees:t=[],zeroPointTickets:l={}}=e,r={formed:{count:0,stageId:"DT140_12:UC_0VHWE2",stageName:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ"},review:{count:0,stageId:"DT140_12:PREPARATION",stageName:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó"},execution:{count:0,stageId:"DT140_12:CLIENT",stageName:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"}},n=[],i=[],d=[];a.forEach(w=>{const f=w.id;if(r[f]){let p=0;w.employees.forEach(y=>{const T=y.tickets||[];p+=T.length;let C=n.find(k=>k.id===y.id);C||(C={id:y.id,name:y.name,ticketsByStage:{formed:0,review:0,execution:0},totalTickets:0},n.push(C)),T.forEach(k=>{i.push(k.id),d.push({id:k.id,title:k.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:{id:y.id,name:y.name},createdAt:k.createdAt||"",updatedAt:k.modifiedAt||k.updatedAt||""}),C.ticketsByStage[f]=(C.ticketsByStage[f]||0)+1,C.totalTickets+=1})}),r[f].count=p}});const g={unassigned:0,keeper:0,total:0};Object.values(l).forEach(w=>{Array.isArray(w)&&w.forEach(f=>{g.total+=1,f.assigneeId===1051||f.assignedById===1051?g.keeper+=1:g.unassigned+=1,i.push(f.id),d.push({id:f.id,title:f.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:f.assignedTo||f.assignedById?{id:f.assignedById||f.assigneeId,name:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}:null,createdAt:f.createdAt||"",updatedAt:f.modifiedAt||f.updatedAt||""})})});const v=Object.values(r).reduce((w,f)=>w+f.count,0)+g.total;return{statistics:{stages:{...r,total:v},employees:n,zeroPoint:g},ticketIds:[...new Set(i)],tickets:d}}static generateSnapshotMetadata(e,a,t){const l=new Date,r=-l.getTimezoneOffset(),n=Math.floor(r/60),i=r%60,d=`${n>=0?"+":""}${String(n).padStart(2,"0")}:${String(i).padStart(2,"0")}`,g=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}T${String(l.getHours()).padStart(2,"0")}:${String(l.getMinutes()).padStart(2,"0")}:${String(l.getSeconds()).padStart(2,"0")}${d}`;return{version:ht.snapshotVersion,createdAt:g,createdBy:a||{id:0,name:"–°–∏—Å—Ç–µ–º–∞"},type:e,sectorId:t,sectorName:t==="1C"?"–°–µ–∫—Ç–æ—Ä 1–°":`–°–µ–∫—Ç–æ—Ä ${t}`}}static formatDate(e){if(e||(e=new Date),typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;e=new Date(e)}if(!(e instanceof Date)||isNaN(e.getTime()))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞");const a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${a}-${t}-${l}`}static buildFilePath(e,a){const t=typeof e=="string"?new Date(e):e,l=t.getFullYear(),r=this.getWeekNumber(t),n=this.formatDate(e);let i;if(a==="current"){const d=new Date,g=`${String(d.getHours()).padStart(2,"0")}-${String(d.getMinutes()).padStart(2,"0")}-${String(d.getSeconds()).padStart(2,"0")}`;i=`current-state-${n}-${g}.json`}else if(a==="manual"){const d=new Date,g=`${String(d.getHours()).padStart(2,"0")}-${String(d.getMinutes()).padStart(2,"0")}-${String(d.getSeconds()).padStart(2,"0")}`;i=`manual-${n}-${g}.json`}else i=`${a}-${n}.json`;return a==="current"?`current/${i}`:`${l}/week-${r}/${i}`}static getWeekNumber(e){const a=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),t=a.getUTCDay()||7;a.setUTCDate(a.getUTCDate()+4-t);const l=new Date(Date.UTC(a.getUTCFullYear(),0,1));return Math.ceil(((a-l)/864e5+1)/7)}static validateSnapshot(e){const a=[],t=[];if(e.metadata?((!e.metadata.version||typeof e.metadata.version!="string")&&a.push("–ù–µ–≤–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö"),(!e.metadata.createdAt||!this.isValidISODate(e.metadata.createdAt))&&a.push("–ù–µ–≤–µ—Ä–Ω–∞—è –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è"),["week_start","week_end","manual","current"].includes(e.metadata.type)||a.push("–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø —Å–ª–µ–ø–∫–∞"),(!e.metadata.sectorId||typeof e.metadata.sectorId!="string")&&a.push("–ù–µ–≤–µ—Ä–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ–∫—Ç–æ—Ä–∞"),(!e.metadata.createdBy||!e.metadata.createdBy.id||!e.metadata.createdBy.name)&&a.push("–ù–µ–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞—Ç–µ–ª–µ")):a.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–ª–µ–ø–∫–∞"),!e.statistics)a.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞");else{if(!e.statistics.stages)a.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —ç—Ç–∞–ø–∞–º");else{const l=e.statistics.stages,r=(l.formed?.count||0)+(l.review?.count||0)+(l.execution?.count||0);l.total!==r&&t.push(`–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–µ—Ç–æ–≤: –æ–∂–∏–¥–∞–µ—Ç—Å—è ${r}, —É–∫–∞–∑–∞–Ω–æ ${l.total}`)}if(Array.isArray(e.statistics.employees)||a.push("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),!e.statistics.zeroPoint)a.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω—É–ª–µ–≤–æ–π —Ç–æ—á–∫–∏");else{const l=e.statistics.zeroPoint,r=(l.unassigned||0)+(l.keeper||0);l.total!==r&&t.push(`–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω—É–ª–µ–≤–æ–π —Ç–æ—á–∫–∏: –æ–∂–∏–¥–∞–µ—Ç—Å—è ${r}, —É–∫–∞–∑–∞–Ω–æ ${l.total}`)}}if(Array.isArray(e.ticketIds)||a.push("ticketIds –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),!Array.isArray(e.tickets))a.push("tickets –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º");else{const l=new Set(e.ticketIds),r=new Set(e.tickets.map(n=>n.id));l.size!==r.size&&t.push("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ ID –≤ ticketIds –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–∏–∫–µ—Ç–æ–≤"),e.tickets.forEach((n,i)=>{n.id||a.push(`–¢–∏–∫–µ—Ç #${i}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ID`),n.title||a.push(`–¢–∏–∫–µ—Ç #${i}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫`),(!n.assignedTo||!n.assignedTo.id)&&t.push(`–¢–∏–∫–µ—Ç #${i}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –Ω—É–ª–µ–≤–æ–π —Ç–æ—á–∫–µ)`),n.createdAt||a.push(`–¢–∏–∫–µ—Ç #${i}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è`),n.updatedAt||a.push(`–¢–∏–∫–µ—Ç #${i}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è`)})}return{isValid:a.length===0,errors:a,warnings:t}}static validateSectorData(e){const a=[],t=[];return!e||typeof e!="object"?(a.push("sectorData –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{isValid:!1,errors:a,warnings:t}):(Array.isArray(e.stages)||a.push("stages –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),Array.isArray(e.employees)||a.push("employees –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),(!e.zeroPointTickets||typeof e.zeroPointTickets!="object")&&a.push("zeroPointTickets –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{isValid:a.length===0,errors:a,warnings:t})}static isValidISODate(e){if(typeof e!="string")return!1;const a=new Date(e);return!isNaN(a.getTime())&&e.includes("T")}static async deleteSnapshot(e,a){try{const t=this.formatDate(e),r=`${this.getApiBaseUrl()}${ht.snapshotsEndpoint}`,n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({action:"delete",date:t,type:a})});if(n.status===404)return!1;if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.json();if(!i.success)throw new Error(i.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–µ–ø–∫–∞");return!0}catch(t){throw console.error("SnapshotService.deleteSnapshot error:",t),t}}static async deleteSnapshotsByPeriod(e){try{const a=await this.getAllSnapshots(e);let t=0;for(const l of a)try{await this.deleteSnapshot(l.metadata.createdAt.split("T")[0],l.metadata.type)&&t++}catch(r){console.warn(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–µ–ø–∫–∞ ${l.metadata.createdAt}:`,r)}return t}catch(a){throw console.error("SnapshotService.deleteSnapshotsByPeriod error:",a),a}}static getSnapshotVersion(e){return e?.metadata?.version||"unknown"}static async migrateSnapshot(e,a=ht.snapshotVersion){const t=this.getSnapshotVersion(e);return t===a||t==="1.0"&&a==="1.0"?e:(console.warn(`–ú–∏–≥—Ä–∞—Ü–∏—è —Å –≤–µ—Ä—Å–∏–∏ ${t} –Ω–∞ ${a} –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞`),{...e,metadata:{...e.metadata,version:a}})}static getWeekNumberInfo(e){const a=typeof e=="string"?new Date(e):e,t=this.getWeekNumber(a);return{year:a.getFullYear(),week:t}}static getWeekStartDate(e){const a=typeof e=="string"?new Date(e):e,l=(a.getDay()||7)-1,r=new Date(a);return r.setDate(a.getDate()-l),r.setHours(0,0,0,0),r}static getWeekEndDate(e){const a=typeof e=="string"?new Date(e):e,l=7-(a.getDay()||7),r=new Date(a);return r.setDate(a.getDate()+l),r.setHours(23,59,59,999),r}static async getSnapshotsForWeek(e){try{const a=this.getWeekStartDate(e),t=this.getWeekEndDate(e),l=this.getWeekNumberInfo(e),r=await this.getAllSnapshots({startDate:a,endDate:t}),n=r.find(g=>g.metadata.type==="week_start")||null,i=r.find(g=>g.metadata.type==="week_end")||null,d=r.filter(g=>g.metadata.type==="manual");return{weekStart:n,weekEnd:i,manual:d,weekInfo:l}}catch(a){throw console.error("SnapshotService.getSnapshotsForWeek error:",a),a}}static handleError(e){if(e instanceof St)return{message:e.message,code:e.code,details:e.details};let a="UNKNOWN_ERROR";return e.message.includes("–≤–∞–ª–∏–¥–∞—Ü")?a="VALIDATION_ERROR":e.message.includes("404")||e.message.includes("–Ω–µ –Ω–∞–π–¥–µ–Ω")?a="NOT_FOUND":e.message.includes("HTTP")||e.message.includes("API")?a="API_ERROR":e.message.includes("–≤–µ—Ä—Å–∏—è")||e.message.includes("version")?a="VERSION_MISMATCH":(e.message.includes("–¥–æ—Å—Ç—É–ø")||e.message.includes("permission"))&&(a="PERMISSION_DENIED"),{message:e.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",code:a,details:{originalError:e}}}static async getSnapshotsStatistics(e={}){try{const a=await this.getAllSnapshots(e),t={week_start:0,week_end:0,manual:0,current:0},l=new Map;let r=null,n=null;a.forEach(d=>{const g=d.metadata.type;t.hasOwnProperty(g)&&t[g]++;const v=this.getWeekNumberInfo(d.metadata.createdAt),w=`${v.year}-W${v.week}`;l.set(w,(l.get(w)||0)+1);const f=new Date(d.metadata.createdAt);(!r||f<new Date(r.metadata.createdAt))&&(r=d),(!n||f>new Date(n.metadata.createdAt))&&(n=d)});const i=Array.from(l.entries()).map(([d,g])=>{const[v,w]=d.split("-W");return{year:parseInt(v),week:parseInt(w),count:g}}).sort((d,g)=>d.year!==g.year?d.year-g.year:d.week-g.week);return{total:a.length,byType:t,byWeek:i,oldest:r,newest:n}}catch(a){throw console.error("SnapshotService.getSnapshotsStatistics error:",a),a}}}class St extends Error{constructor(e,a,t={}){super(e),this.name="SnapshotError",this.code=a,this.details=t}}const ft={formed:{bitrixId:Ta.formed,name:Ca.FORMED.name},review:{bitrixId:Ta.review,name:Ca.REVIEW.name},execution:{bitrixId:Ta.execution,name:Ca.EXECUTION.name}},ea=ta;function Vl(o){if(!o||typeof o!="object")throw new Error("Invalid sector data: sectorData must be an object");if(!o.stages||!Array.isArray(o.stages))throw new Error("Invalid sector data: stages are required and must be an array");const e=zl(o.stages),a=Gl(o.stages),t=Kl(o.zeroPointTickets||{}),l=ql(o.zeroPointTickets||{}),r=Yl(o.stages,o.zeroPointTickets||{});return{statistics:{stages:e,employees:a,zeroPoint:t,zeroPointByStage:l},ticketIds:r.ticketIds,tickets:r.tickets}}function zl(o){const e={formed:{count:0,stageId:ft.formed.bitrixId,stageName:ft.formed.name},review:{count:0,stageId:ft.review.bitrixId,stageName:ft.review.name},execution:{count:0,stageId:ft.execution.bitrixId,stageName:ft.execution.name},total:0};return o.forEach(a=>{if(!ft[a.id]){console.warn(`Unknown stage ID: ${a.id}`);return}let t=0;a.employees&&Array.isArray(a.employees)&&a.employees.forEach(l=>{l.tickets&&Array.isArray(l.tickets)&&(t+=l.tickets.length)}),e[a.id].count=t,e.total+=t}),e}function Gl(o){const e=new Map;return o.forEach(a=>{!a.employees||!Array.isArray(a.employees)||a.employees.forEach(t=>{if(!t||!t.id)return;e.has(t.id)||e.set(t.id,{id:t.id,name:t.name||`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${t.id}`,ticketsByStage:{formed:0,review:0,execution:0},totalTickets:0});const l=e.get(t.id),r=t.tickets&&Array.isArray(t.tickets)?t.tickets.length:0;ft[a.id]&&(l.ticketsByStage[a.id]=(l.ticketsByStage[a.id]||0)+r),l.totalTickets+=r})}),Array.from(e.values())}function Kl(o){let e=0,a=0;return!o||typeof o!="object"?{unassigned:0,keeper:0,total:0}:(Object.values(o).forEach(t=>{Array.isArray(t)&&t.forEach(l=>{if(!l)return;const r=l.assignedTo||l.assignedById;!r||r===null?e++:(typeof r=="object"?r.id:r)===ea?a++:e++})}),{unassigned:e,keeper:a,total:e+a})}function ql(o){const e={formed:{keeper:0,unassigned:0,total:0},review:{keeper:0,unassigned:0,total:0},execution:{keeper:0,unassigned:0,total:0}};return!o||typeof o!="object"||Object.keys(e).forEach(a=>{const t=o[a];Array.isArray(t)&&t.forEach(l=>{if(!l)return;const r=l.assignedTo||l.assignedById;!r||r===null?e[a].unassigned++:(typeof r=="object"?r.id:r)===ea?e[a].keeper++:e[a].unassigned++,e[a].total++})}),e}function Yl(o,e){const a=new Set,t=new Map;return Array.isArray(o)&&o.forEach(l=>{!l.employees||!Array.isArray(l.employees)||l.employees.forEach(r=>{!r.tickets||!Array.isArray(r.tickets)||r.tickets.forEach(n=>{if(!n||!n.id){console.warn("Ticket without ID found:",n);return}const i=parseInt(n.id);if(isNaN(i)){console.warn("Invalid ticket ID:",n.id);return}a.add(i);let d=n.assignedTo;!d&&r.id&&(d={id:r.id,name:r.name||`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${r.id}`}),t.set(i,{id:i,title:n.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:d||null,createdAt:la(n.createdAt||n.createdTime),updatedAt:la(n.updatedAt||n.modifiedAt||n.updatedTime),stageId:n.stageId||l.id||null,departmentHead:n.departmentHead||null,departmentHeadFull:n.departmentHeadFull||n.departmentHead||null,priorityId:n.priorityId||null,priorityLabel:n.priorityLabel||null,service:n.service||null,serviceLabel:n.serviceLabel||null})})})}),e&&typeof e=="object"&&Object.values(e).forEach(l=>{Array.isArray(l)&&l.forEach(r=>{if(!r||!r.id){console.warn("Ticket without ID found in zero point:",r);return}const n=parseInt(r.id);if(isNaN(n)){console.warn("Invalid ticket ID in zero point:",r.id);return}a.add(n);let i=r.assignedTo;if(!i&&r.assignedById){const d=typeof r.assignedById=="object"?r.assignedById.id||r.assignedById.value:r.assignedById;d&&d!==ea?i={id:d,name:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}:d===ea&&(i={id:ea,name:"–•—Ä–∞–Ω–∏—Ç–µ–ª—å –æ–±—ä–µ–∫—Ç–æ–≤"})}t.set(n,{id:n,title:r.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:i||null,createdAt:la(r.createdAt||r.createdTime),updatedAt:la(r.updatedAt||r.modifiedAt||r.updatedTime),stageId:r.stageId||null,departmentHead:r.departmentHead||null,departmentHeadFull:r.departmentHeadFull||r.departmentHead||null,priorityId:r.priorityId||null,priorityLabel:r.priorityLabel||null,service:r.service||null,serviceLabel:r.serviceLabel||null})})}),{ticketIds:Array.from(a).sort((l,r)=>l-r),tickets:Array.from(t.values())}}function la(o){if(!o)return null;if(o instanceof Date)return o.toISOString();if(typeof o=="string"){if(o.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/))return o;const e=new Date(o);if(!isNaN(e.getTime()))return e.toISOString()}return console.warn("Invalid date format:",o),null}class Ua{static async getSectorDataForSnapshot(e={}){const{useCache:a=!0,useBackendCache:t=!1,onProgress:l=null,normalize:r=!0,includeTicketDetails:n=!1}=e;try{const i=await Qt.getSectorData(a,t,l);return r?Vl(i):(n&&console.warn("includeTicketDetails –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ"),i)}catch(i){throw console.error("SectorDataAdapter.getSectorDataForSnapshot error:",i),i}}static async isDataAvailable(){try{const e=await Qt.getSectorData(!0);return e!=null}catch{return!1}}}class Aa{static compareTwoSnapshots(e,a,t={}){const{includeTickets:l=!1,includeEmployees:r=!0}=t,n=this.validateSnapshot(e),i=this.validateSnapshot(a);if(!n.valid||!i.valid)throw new Error("Invalid snapshot structure: "+[...n.errors,...i.errors].join(", "));const d=this.buildComparisonMetadata(e,a),g=this.compareStages(e.statistics.stages,a.statistics.stages),v=r?this.compareEmployees(e.statistics.employees||[],a.statistics.employees||[]):[],w=this.compareZeroPoint(e.statistics.zeroPoint||{},a.statistics.zeroPoint||{}),f=l?this.compareTickets(e.ticketIds||[],a.ticketIds||[],e.tickets||[],a.tickets||[]):null,p=this.buildSummary(g,v,w,f);return{metadata:d,stages:g,employees:v,zeroPoint:w,tickets:f,summary:p}}static calculateDelta(e,a){const t=this.normalizeValue(e),l=this.normalizeValue(a),r=l-t;let n=0;t!==0?n=r/t*100:l!==0&&(n=l>0?1/0:-1/0);const i=this.getTrend(r);return{value1:t,value2:l,delta:r,deltaPercent:Math.round(n*100)/100,trend:i}}static normalizeValue(e){return e==null||isNaN(e)?0:Number(e)}static getTrend(e){return e>0?"increase":e<0?"decrease":"stable"}static compareStages(e,a){const t=["formed","review","execution"],l={};for(const i of t){const d=e[i]?.count||0,g=a[i]?.count||0;l[i]=this.calculateDelta(d,g)}const r=e.total||0,n=a.total||0;return l.total=this.calculateDelta(r,n),l}static compareEmployees(e,a){const t=new Map(e.map(i=>[i.id,i])),l=new Map(a.map(i=>[i.id,i])),r=new Set([...t.keys(),...l.keys()]),n=[];for(const i of r){const d=t.get(i)||null,g=l.get(i)||null;if(!d||!g){n.push({id:i,name:d?.name||g?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",snapshot1:d?{ticketsByStage:d.ticketsByStage||{},totalTickets:d.totalTickets||0}:null,snapshot2:g?{ticketsByStage:g.ticketsByStage||{},totalTickets:g.totalTickets||0}:null,delta:this.calculateEmployeeDelta(d,g),trend:d?"removed":"new"});continue}const v={},w=["formed","review","execution"];for(const p of w){const y=d.ticketsByStage?.[p]||0,T=g.ticketsByStage?.[p]||0;v[p]=this.calculateDelta(y,T)}const f=this.calculateDelta(d.totalTickets||0,g.totalTickets||0);n.push({id:i,name:d.name,snapshot1:{ticketsByStage:d.ticketsByStage||{},totalTickets:d.totalTickets||0},snapshot2:{ticketsByStage:g.ticketsByStage||{},totalTickets:g.totalTickets||0},delta:{ticketsByStage:v,totalTickets:f},trend:f.trend})}return n}static calculateEmployeeDelta(e,a){if(!e&&!a)return{ticketsByStage:{},totalTickets:{delta:0,trend:"stable"}};const t={},l=["formed","review","execution"];for(const n of l){const i=e?.ticketsByStage?.[n]||0,d=a?.ticketsByStage?.[n]||0;t[n]=this.calculateDelta(i,d)}const r=this.calculateDelta(e?.totalTickets||0,a?.totalTickets||0);return{ticketsByStage:t,totalTickets:r}}static compareZeroPoint(e,a){return{unassigned:this.calculateDelta(e?.unassigned||0,a?.unassigned||0),keeper:this.calculateDelta(e?.keeper||0,a?.keeper||0),total:this.calculateDelta(e?.total||0,a?.total||0)}}static compareTickets(e,a,t,l){const r=new Set(e),n=new Set(a),i=a.filter(p=>!r.has(p)),d=e.filter(p=>!n.has(p)),g=[],v=[],w=new Map(t.map(p=>[p.id,p])),f=new Map(l.map(p=>[p.id,p]));for(const p of e){if(!n.has(p))continue;const y=w.get(p),T=f.get(p);if(!y||!T)continue;const C=(y.assignedTo?.id||null)!==(T.assignedTo?.id||null),k=(y.stageId||null)!==(T.stageId||null);C||k?g.push(p):v.push(p)}return{new:i,removed:d,changed:g,unchanged:v}}static buildComparisonMetadata(e,a){const t=new Date(e.metadata.createdAt),l=new Date(a.metadata.createdAt),r=new Date,n=l.getTime()-t.getTime(),i=Math.floor(n/(1e3*60*60*24)),d=Math.floor(n%(1e3*60*60*24)/(1e3*60*60)),g=Math.floor(n%(1e3*60*60)/(1e3*60));return{snapshot1Date:e.metadata.createdAt,snapshot2Date:a.metadata.createdAt,comparisonDate:r.toISOString(),timeDiff:{days:i,hours:d,minutes:g,totalMinutes:Math.floor(n/(1e3*60))}}}static buildSummary(e,a,t,l){const r=e.total.delta,n=Object.keys(e).filter(g=>g==="total"?!1:e[g].delta!==0).length,i=a.filter(g=>g.trend==="new"||g.trend==="removed"?!0:g.delta.totalTickets.delta!==0).length,d=r!==0||n>0||i>0;return{totalDelta:r,stagesChanged:n,employeesChanged:i,hasChanges:d,newTicketsCount:l?.new?.length||0,removedTicketsCount:l?.removed?.length||0,changedTicketsCount:l?.changed?.length||0}}static validateSnapshot(e){const a=[],t=[];if(!e)return a.push("Snapshot is null or undefined"),{valid:!1,errors:a,warnings:t};if(e.metadata?(e.metadata.createdAt||a.push("Missing metadata.createdAt"),e.metadata.type||a.push("Missing metadata.type")):a.push("Missing metadata field"),!e.statistics)a.push("Missing statistics field");else{if(!e.statistics.stages)a.push("Missing statistics.stages");else{const l=["formed","review","execution"];for(const r of l)e.statistics.stages[r]||t.push(`Missing stage: ${r}`)}e.statistics.employees||t.push("Missing statistics.employees (may be empty array)"),e.statistics.zeroPoint||t.push("Missing statistics.zeroPoint")}return{valid:a.length===0,errors:a,warnings:t}}static compareMultipleSnapshots(e,a={}){if(!Array.isArray(e)||e.length<2)throw new Error("At least 2 snapshots required for comparison");for(const n of e){const i=this.validateSnapshot(n);if(!i.valid)throw new Error("Invalid snapshot: "+i.errors.join(", "))}const t=[...e].sort((n,i)=>{const d=new Date(n.metadata.createdAt),g=new Date(i.metadata.createdAt);return d-g}),l=[];for(let n=0;n<t.length-1;n++)l.push({from:n,to:n+1,result:this.compareTwoSnapshots(t[n],t[n+1],a)});const r=this.buildTrends(t);return{snapshots:t.map((n,i)=>({index:i,date:n.metadata.createdAt,type:n.metadata.type,data:n})),comparisons:l,trends:r}}static buildTrends(e){const a={stages:{formed:[],review:[],execution:[],total:[]},zeroPoint:{unassigned:[],keeper:[],total:[]}};for(const t of e){const l=t.statistics;a.stages.formed.push(l.stages?.formed?.count||0),a.stages.review.push(l.stages?.review?.count||0),a.stages.execution.push(l.stages?.execution?.count||0),a.stages.total.push(l.stages?.total||0),a.zeroPoint.unassigned.push(l.zeroPoint?.unassigned||0),a.zeroPoint.keeper.push(l.zeroPoint?.keeper||0),a.zeroPoint.total.push(l.zeroPoint?.total||0)}return a}}const Kt=I([]);let Xl=0;function mt(){const o=(i,d="info",g=3e3)=>{const v=++Xl,w={id:v,message:i,type:d,duration:g,timestamp:Date.now()};return Kt.value.push(w),g>0&&setTimeout(()=>{e(v)},g),v},e=i=>{const d=Kt.value.findIndex(g=>g.id===i);d>-1&&Kt.value.splice(d,1)};return{notifications:Kt,showNotification:o,removeNotification:e,clearNotifications:()=>{Kt.value=[]},success:(i,d=3e3)=>o(i,"success",d),error:(i,d=5e3)=>o(i,"error",d),warning:(i,d=4e3)=>o(i,"warning",d),info:(i,d=3e3)=>o(i,"info",d)}}const Jl={class:"stages-container"},Zl={class:"stages-chips"},Ql=["checked","disabled","onChange"],ei={class:"stage-chip-label"},ti={__name:"StageChips",props:{stages:{type:Array,required:!0,validator:o=>o.every(e=>e.id&&e.name&&e.color)},selected:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},emits:["update:selected","change"],setup(o,{emit:e}){const a=o,t=e;function l(r,n){const i={...a.selected};i[r]=n,t("update:selected",i),t("change",r,n)}return(r,n)=>(c(),u("div",Jl,[n[0]||(n[0]=s("h4",{class:"stages-title"},"–≠—Ç–∞–ø—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:",-1)),s("div",Zl,[(c(!0),u(ee,null,te(o.stages,i=>(c(),u("label",{key:i.id,class:X(["stage-chip",{"stage-chip--active":o.selected[i.id],"stage-chip--disabled":o.disabled}])},[s("input",{type:"checkbox",checked:o.selected[i.id],disabled:o.disabled,onChange:d=>l(i.id,d.target.checked)},null,40,Ql),s("span",{class:"stage-chip-color",style:we({backgroundColor:i.color})},null,4),s("span",ei,m(i.name),1)],2))),128))])]))}},ai=ce(ti,[["__scopeId","data-v-fe03c03c"]]),si={name:"TicketCard",props:{ticket:{type:Object,required:!0},draggable:{type:Boolean,default:!0}},emits:["click","drag-start","drag-end"],setup(o,{emit:e}){const a=I(!1),t=$(()=>!1),l={color:"#ced4da",backgroundColor:"#f1f3f5",textColor:"#6c757d"},r={color:"#ced4da",backgroundColor:"#f8f9fa",textColor:"#6c757d"},n={color:"#dee2e6",backgroundColor:"#f8f9fa",textColor:"#6c757d"},i=$(()=>({label:o.ticket.priorityLabel||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",colors:o.ticket.priorityColors||l})),d=$(()=>i.value.label||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),g=$(()=>({color:i.value.colors.textColor||l.textColor,backgroundColor:i.value.colors.backgroundColor||l.backgroundColor,borderColor:i.value.colors.color||l.color})),v=$(()=>({borderLeftColor:i.value.colors.color||l.color})),w=$(()=>{const D=o.ticket.service||{};return{label:D.label||o.ticket.serviceLabel||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",colors:D.colors||o.ticket.serviceColors||r}}),f=$(()=>w.value.label||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),p=$(()=>({color:w.value.colors.textColor||r.textColor,backgroundColor:w.value.colors.backgroundColor||r.backgroundColor,borderColor:w.value.colors.color||r.color})),y=$(()=>{const D=o.ticket.actionStr||o.ticket.ufActionStr||null;if(!D)return null;const N=String(D).trim();return N.length>0?N:null}),T=$(()=>({color:n.textColor,backgroundColor:n.backgroundColor,borderColor:n.color})),C=$(()=>{if(!o.ticket.createdAt)return"";const D=Qa(o.ticket.createdAt);return D?go(D):""}),k=$(()=>{if(!o.ticket.createdAt)return null;const D=Qa(o.ticket.createdAt);return mo(D)}),S=$(()=>{const D=k.value;return D&&ho[D]||null}),x=$(()=>{const D=S.value;return D?{color:D.textColor,backgroundColor:D.backgroundColor,borderColor:D.color,border:`1px solid ${D.color}`}:{}});return{handleDragStart:D=>{t.value&&(D.dataTransfer.effectAllowed="move",D.dataTransfer.setData("application/json",JSON.stringify(o.ticket)),D.dataTransfer.setDragImage(D.target,0,0),a.value=!0,e("drag-start",o.ticket))},handleDragEnd:()=>{t.value&&(a.value=!1,e("drag-end"))},handleCardClick:D=>{if(a.value)return;const N=aa(o.ticket.id);window.open(N,"_blank"),e("click",o.ticket)},isDragEnabled:t,priorityChipStyle:g,displayPriorityLabel:d,priorityBorderStyle:v,displayServiceLabel:f,serviceChipStyle:p,actionStrValue:y,actionChipStyle:T,formattedCreatedDate:C,dateAccentCategory:k,dateAccentConfig:S,dateAccentStyle:x}}},oi=["draggable"],ni={key:0,class:"ticket-department"},ri={class:"ticket-header"},li={class:"ticket-id"},ii={class:"ticket-title"},ci={class:"ticket-meta"},di={key:1,class:"ticket-action"},ui={key:2,class:"ticket-description"},gi={class:"ticket-date-label"},mi={class:"ticket-date-value"};function hi(o,e,a,t,l,r){return c(),u("div",{class:"ticket-card",draggable:t.isDragEnabled,style:we(t.priorityBorderStyle),onClick:e[0]||(e[0]=(...n)=>t.handleCardClick&&t.handleCardClick(...n)),onDragstart:e[1]||(e[1]=(...n)=>t.handleDragStart&&t.handleDragStart(...n)),onDragend:e[2]||(e[2]=(...n)=>t.handleDragEnd&&t.handleDragEnd(...n))},[a.ticket.departmentHead?(c(),u("div",ni,m(a.ticket.departmentHead),1)):A("",!0),s("div",ri,[e[3]||(e[3]=s("span",{class:"ticket-icon"},"üé´",-1)),s("span",li,"#"+m(a.ticket.id),1)]),s("div",ii,m(a.ticket.ufSubject||a.ticket.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),s("div",ci,[s("span",{class:"ticket-priority",style:we(t.priorityChipStyle)},m(t.displayPriorityLabel),5),s("span",{class:"ticket-service",style:we(t.serviceChipStyle)},m(t.displayServiceLabel),5)]),t.actionStrValue?(c(),u("div",di,[s("span",{class:"ticket-action-chip",style:we(t.actionChipStyle)},m(t.actionStrValue),5)])):A("",!0),a.ticket.description?(c(),u("div",ui,m(a.ticket.description),1)):A("",!0),t.formattedCreatedDate?(c(),u("div",{key:3,class:"ticket-created-date",style:we(t.dateAccentStyle)},[s("span",gi,m(t.dateAccentConfig?.label||""),1),s("span",mi,m(t.formattedCreatedDate),1)],4)):A("",!0)],44,oi)}const Ct=ce(si,[["render",hi],["__scopeId","data-v-9cda001c"]]),Ft=10;function ha(o,e){if(!e||!e.statistics)return[];const a=[];e.statistics.employees&&Array.isArray(e.statistics.employees)&&e.statistics.employees.filter(l=>l.ticketsByStage&&l.ticketsByStage[o]>0).forEach(l=>{a.push({id:l.id,name:l.name,count:l.ticketsByStage[o]||0})});const t=fi(o,e);return t>0&&a.push({id:1051,name:"–•—Ä–∞–Ω–∏—Ç–µ–ª—å –æ–±—ä–µ–∫—Ç–æ–≤ (–ù–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω–æ–µ)",count:t,isKeeper:!0}),a.sort((l,r)=>r.count-l.count)}function fi(o,e){if(!e||!e.statistics)return 0;if(e.statistics.zeroPointByStage&&e.statistics.zeroPointByStage[o])return e.statistics.zeroPointByStage[o].keeper||0;if(e.statistics.zeroPoint){const a=e.statistics.zeroPoint.keeper||0;return Math.floor(a/3)}return 0}function $s(o,e){return!e||!e.statistics||!e.statistics.stages?0:e.statistics.stages[o]?.count||0}function fa(o,e=Ft){if(!o||o.length===0)return{visible:[],others:{employees:[],count:0,employeeCount:0}};const a=[...o].sort((n,i)=>i.count-n.count),t=a.slice(0,e),l=a.slice(e),r=l.reduce((n,i)=>n+i.count,0);return{visible:t,others:{employees:l,count:r,employeeCount:l.length}}}function Is(o,e){return!o||o.length===0?[]:e===0?o.map(a=>({...a,percentage:0})):o.map(a=>({...a,percentage:parseFloat((a.count/e*100).toFixed(1))}))}function oa(o,e,a="#007bff",t=Ft){if(!o||o.length===0)return{employees:[],others:null};const{visible:l,others:r}=fa(o,t),n=Is(l,e).map(d=>({...d,progressBarWidth:d.percentage,progressBarColor:d.isKeeper?"#f59e0b":a}));let i=null;if(r.count>0){const d=parseFloat((r.count/e*100).toFixed(1));i={...r,percentage:d,progressBarWidth:d,progressBarColor:"#6c757d"}}return{employees:n,others:i}}function vi(o,e){const a={weekStart:[],weekEnd:[],current:[],others:{weekStart:{count:0,employeeCount:0},weekEnd:{count:0,employeeCount:0},current:{count:0,employeeCount:0}}};return["weekStart","weekEnd","current"].forEach(l=>{const r=e[l];if(!r)return;const n=ha(o,r),i=$s(o,r);if(n.length===0)return;const{visible:d,others:g}=fa(n,Ft),v=Is(d,i);a[l]=v,g.count>0&&(a.others[l]={count:g.count,employeeCount:g.employeeCount,percentage:parseFloat((g.count/i*100).toFixed(1))})}),a}function pi(o,e="current",a=[]){const t=o[e];if(!t)return{labels:[],datasets:[]};const l=new Map;a.forEach(w=>{ha(w.id,t).forEach(p=>{l.has(p.id)||l.set(p.id,{id:p.id,name:p.name,isKeeper:p.isKeeper||!1,ticketsByStage:{}}),l.get(p.id).ticketsByStage[w.id]=p.count})});const r=Array.from(l.values()).map(w=>{const f=Object.values(w.ticketsByStage).reduce((p,y)=>p+y,0);return{...w,totalTickets:f}});r.sort((w,f)=>f.totalTickets-w.totalTickets);const{visible:n,others:i}=fa(r,Ft),d=a.map(()=>""),g={};a.forEach(w=>{const f=ha(w.id,t),{visible:p}=fa(f,Ft);g[w.id]=p.map(y=>({id:y.id,name:y.name,count:y.count}))});const v=n.map((w,f)=>{const p=a.map(T=>w.ticketsByStage[T.id]||0),y=a.map(T=>{if((w.ticketsByStage[T.id]||0)===0)return"transparent";const S=T.color.replace("#",""),x=parseInt(S.substring(0,2),16),U=parseInt(S.substring(2,4),16),L=parseInt(S.substring(4,6),16),E=.6+f*.05;return`rgba(${x}, ${U}, ${L}, ${Math.min(E,.95)})`});return{label:w.name,data:p,backgroundColor:y,borderColor:a.map(T=>{const C=T.color.replace("#",""),k=parseInt(C.substring(0,2),16),S=parseInt(C.substring(2,4),16),x=parseInt(C.substring(4,6),16);return`rgba(${k}, ${S}, ${x}, 0.8)`}),borderWidth:1,meta:{employeeId:w.id,employeeName:w.name}}});if(i.count>0){const w=a.map(f=>i.employees.reduce((p,y)=>p+(y.ticketsByStage[f.id]||0),0));v.push({label:`–î—Ä—É–≥–∏–µ (${i.employeeCount})`,data:w,backgroundColor:"rgba(108, 117, 125, 0.5)",borderColor:"#6c757d",borderWidth:1})}return{labels:d,datasets:v,meta:{employeesByStage:g}}}function yi(o,e,a=[]){if(!e)return{stageName:"",totalCount:0,employees:[],others:null};const t=a.find(g=>g.id===o),l=t?t.name:"",r=t?t.color:"#007bff",n=ha(o,e),i=$s(o,e);if(n.length===0)return{stageName:l,totalCount:0,employees:[],others:null};const d=oa(n,i,r,Ft);return{stageName:l,totalCount:i,employees:d.employees,others:d.others}}function ki(o,e){return e?.[o]||o}function bi(o,e){return e?.[o]||"#007bff"}function Fa({snapshots:o,graphType:e,timePoint:a,snapshotType:t}){return o?e==="line"&&a?o[a]||null:e==="bar"&&t?o[t]||null:o.current||o.weekEnd||o.weekStart||null:null}function Ha(o,e){return e?.statistics?.stages?.[o]?.count||0}function _i({stageId:o,timePoint:e,meta:a,snapshots:t,stageColor:l,maxVisible:r}){if(!a?.employees||!e)return null;const n=a.employees[e];if(!n||n.length===0)return null;const i=t?.[e]||null,d=Ha(o,i)||n.reduce((v,w)=>v+(w.count||0),0),g=oa(n,d,l,r);return{stageId:o,totalCount:d,employees:g.employees,others:g.others,snapshot:i}}function wi({stageId:o,meta:e,snapshots:a,stageColor:t,maxVisible:l}){const r=e?.employees?.[o];if(!r||!r.employees||r.employees.length===0)return null;const n=Fa({snapshots:a,graphType:"doughnut"}),i=r.totalCount??Ha(o,n)??r.employees.reduce((g,v)=>g+(v.count||0),0),d=oa(r.employees,i,t,l);return{stageId:o,totalCount:i,employees:d.employees,others:d.others,snapshot:n}}function Ci({stageId:o,meta:e,snapshots:a,stageColor:t,maxVisible:l,snapshotType:r}){const n=e?.employeesByStage?.[o];if(!n||n.length===0)return null;const i=Fa({snapshots:a,graphType:"bar",snapshotType:r}),d=Ha(o,i)||n.reduce((v,w)=>v+(w.count||0),0),g=oa(n,d,t,l);return{stageId:o,totalCount:d,employees:g.employees,others:g.others,snapshot:i}}async function Ms({stageId:o,graphType:e,timePoint:a=null,snapshotType:t=null,snapshots:l=null,meta:r=null,stageColorMap:n=null,stageNameMap:i=null,maxVisible:d=10,restLoader:g=null}){if(!o)throw new Error("stageId –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω—è 1");const v=ki(o,i),w=bi(o,n);let f=null;if(e==="line"?f=_i({stageId:o,timePoint:a,meta:r?.line,snapshots:l,stageColor:w,maxVisible:d}):e==="doughnut"?f=wi({stageId:o,meta:r?.doughnut,snapshots:l,stageColor:w,maxVisible:d}):e==="bar"&&(f=Ci({stageId:o,meta:r?.bar,snapshots:l,stageColor:w,maxVisible:d,snapshotType:t})),f)return{stageId:o,stageName:v,color:w,totalCount:f.totalCount,employees:f.employees,others:f.others,snapshot:f.snapshot};if(typeof g=="function"){const p=await g({stageId:o,graphType:e,timePoint:a,snapshotType:t,snapshots:l});if(p&&Array.isArray(p.employees)){const y=p.totalCount??p.employees.reduce((C,k)=>C+(k.count||0),0),T=oa(p.employees,y,w,d);return{stageId:o,stageName:v,color:w,totalCount:y,employees:T.employees,others:T.others,snapshot:p.snapshot||Fa({snapshots:l,graphType:e,timePoint:a,snapshotType:t})}}}throw new Error("–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã (meta/REST)")}const Ti={key:"level-1",class:"level-1"},Si={class:"modal-header"},Di={class:"stage-header"},Ei=["aria-expanded","onKeydown"],Ai={class:"stage-title"},$i=["aria-selected","onClick","onKeydown"],Ii={class:"stage-name"},Mi={class:"modal-total"},Ni={class:"view-switcher"},xi={class:"modal-body"},Li={key:0,class:"load-error"},Pi={key:1,class:"stage-loader"},Oi={key:2},Bi={key:0,class:"no-employees"},Ri={key:1,class:"employees-list"},Wi=["onClick"],Ui={class:"employee-name"},Fi={class:"employee-progress"},Hi={class:"employee-count"},ji={key:0,class:"employee-item employee-others"},Vi={class:"employee-name"},zi={class:"employee-progress"},Gi={class:"employee-count"},Ki={key:3,class:"view-time"},qi={key:0,class:"no-data"},Yi={key:1,class:"date-categories-list"},Xi=["onClick"],Ji={class:"category-label"},Zi={class:"category-progress"},Qi={class:"category-count"},ec={key:4,class:"view-departments"},tc={key:0,class:"no-data"},ac={key:1,class:"departments-table-container"},sc={class:"departments-table"},oc=["onClick"],nc={class:"col-department"},rc={class:"department-name"},lc={class:"col-count"},ic={class:"count-value"},cc={key:"level-2",class:"level-2"},dc={class:"modal-header"},uc={class:"modal-total"},gc={class:"modal-body"},mc={class:"stage-info level2-stage-row"},hc={class:"stage-badge"},fc={class:"level2-sort-switch",role:"group","aria-label":"–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏"},vc={key:0},pc={key:0,class:"no-data"},yc={key:1,class:"date-categories-list"},kc=["onClick"],bc={class:"category-label"},_c={class:"category-progress"},wc={class:"category-count"},Cc={key:1,class:"view-departments"},Tc={key:0,class:"no-data"},Sc={key:1,class:"departments-table-container"},Dc={class:"departments-table"},Ec=["onClick"],Ac={class:"col-department"},$c={class:"department-name"},Ic={class:"col-count"},Mc={class:"count-value"},Nc={key:"level-3",class:"level-3"},xc={class:"modal-header"},Lc={class:"header-info"},Pc={class:"header-badges"},Oc={class:"date-badge"},Bc={class:"stage-badge"},Rc={class:"modal-total"},Wc={class:"modal-body"},Uc={key:0,class:"no-data"},Fc={key:1,class:"departments-table-container"},Hc={class:"departments-table"},jc=["onClick"],Vc={class:"col-department"},zc={class:"department-name"},Gc={class:"col-count"},Kc={class:"count-value"},qc={key:"level-4",class:"level-4"},Yc={class:"modal-header"},Xc={class:"header-info"},Jc={key:0,class:"header-badges"},Zc={key:0,class:"date-badge"},Qc={key:1,class:"department-badge"},ed={class:"stage-badge"},td={class:"modal-total"},ad={class:"modal-body"},sd={key:"loading",class:"loading-state"},od={key:"error-fallback",class:"error-state-with-fallback"},nd={class:"tickets-list-container"},rd={key:"error",class:"error-state"},ld={class:"error-message"},id={key:"empty",class:"empty-state"},cd={class:"empty-state-title"},dd={class:"empty-state-message"},ud={key:"tickets",class:"tickets-list-container"},gd={__name:"EmployeeDetailsModal",props:{isVisible:{type:Boolean,default:!1},stageName:{type:String,required:!0},stageId:{type:String,default:""},totalCount:{type:Number,required:!0},employees:{type:Array,default:()=>[]},others:{type:Object,default:null},snapshot:{type:Object,default:null},ticketDetails:{type:Object,default:null},stageSwitchContext:{type:Object,default:null}},emits:["close"],setup(o,{expose:e,emit:a}){const t=o,l=a,r=mt(),n=I(1),i=I("time"),d=I("employees"),g=I(null),v=I([]),w=I([]),f=I(null),p=I(null),y=I(null),T=I(t.stageSwitchContext||null),C=I(!1),k=I(null),S=I(null),x=I(!1),U=I(null),L=I(null),E=$(()=>{const z=T.value?.stageNameMap||{},M=T.value?.stageColorMap||{};return Object.keys(z).map(b=>({id:b,name:z[b],color:M[b]||"#007bff",disabled:b===(g.value?.stageId||t.stageId)}))});$(()=>n.value>1);const D=$(()=>{switch(n.value){case 1:return g.value?.stageName||t.stageName;case 2:return f.value?.employeeName||"";case 3:return`${f.value?.employeeName||""} ‚Äî ${p.value?.dateCategoryLabel||""}`;case 4:if(!y.value?.context)return"–°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤";const z=y.value.context,M=[];return z.employeeName&&M.push(z.employeeName),z.dateCategoryLabel&&M.push(z.dateCategoryLabel),z.departmentName&&M.push(z.departmentName),z.stageName&&M.push(z.stageName),M.length>0?M.join(" ‚Äî "):"–°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤";default:return""}});function N(){console.log("[EmployeeDetailsModal] Initializing level 1 with props:",{stageName:t.stageName,stageId:t.stageId,totalCount:t.totalCount,employeesCount:t.employees?.length||0,hasSnapshot:!!t.snapshot,snapshotTicketIds:t.snapshot?.ticketIds?.length||0,hasTicketDetails:!!t.ticketDetails,snapshotKeys:t.snapshot?Object.keys(t.snapshot):[]}),g.value={stageName:t.stageName,stageId:t.stageId,totalCount:t.totalCount,employees:t.employees||[],others:t.others||null,snapshot:t.snapshot||null,ticketDetails:t.ticketDetails||null},console.log("[EmployeeDetailsModal] Level 1 data initialized:",{stageId:g.value.stageId,hasSnapshot:!!g.value.snapshot,employeesCount:g.value.employees.length,snapshotType:g.value.snapshot?typeof g.value.snapshot:"null"}),f.value=null,p.value=null,y.value=null,n.value=1,i.value="time",d.value="employees",B(),console.log("[EmployeeDetailsModal] Popup level set to 1, ready for clicks")}async function B(){if(!g.value||!g.value.snapshot||!g.value.stageId){console.warn("[EmployeeDetailsModal] Cannot load level 1 view data - missing required data");return}try{const z=g.value.snapshot.tickets||[],M=g.value.stageId;console.log("[EmployeeDetailsModal] Loading level 1 view data:",{totalSnapshotTickets:z.length,currentStageId:M,sampleTicket:z[0]?{id:z[0].id,stageId:z[0].stageId,hasDepartmentHead:!!z[0].departmentHead,departmentHead:z[0].departmentHead,hasDepartmentHeadFull:!!z[0].departmentHeadFull,departmentHeadFull:z[0].departmentHeadFull,allKeys:Object.keys(z[0])}:null});let b=z.filter(K=>K.stageId?Jt(K.stageId)===M:!0);console.log("[EmployeeDetailsModal] Filtered tickets by stage:",{beforeFilter:z.length,afterFilter:b.length,stageId:M,ticketsWithStageId:b.filter(K=>K.stageId).length,ticketsWithoutStageId:b.filter(K=>!K.stageId).length});const O=b.filter(K=>!K.departmentHead&&!K.departmentHeadFull);if(O.length>0){console.log("[EmployeeDetailsModal] DepartmentHead missing for some tickets, loading via API...",{ticketsNeedingDetails:O.length,totalTickets:b.length,ticketsWithDepartment:b.filter(j=>j.departmentHead||j.departmentHeadFull).length});const K=O.map(j=>j.id).filter(j=>j);try{console.log("[EmployeeDetailsModal] Loading details for tickets:",{ticketIdsCount:K.length,ticketIdsSample:K.slice(0,10)});const j=await vo.getTicketsDetails(K),V=new Map;j.forEach(F=>{F&&F.id&&V.set(F.id,F)}),console.log("[EmployeeDetailsModal] Details loaded from API:",{detailsCount:j.length,detailsMapSize:V.size,sampleDetail:j[0]?{id:j[0].id,departmentHead:j[0].departmentHead,departmentHeadFull:j[0].departmentHeadFull}:null}),b=b.map(F=>{const le=V.get(F.id);return le?{...F,stageId:le.stageId||F.stageId||null,departmentHead:le.departmentHead||F.departmentHead||null,departmentHeadFull:le.departmentHeadFull||le.departmentHead||F.departmentHead||null}:F}),b=b.filter(F=>F.stageId?Jt(F.stageId)===M:!0),console.log("[EmployeeDetailsModal] Ticket details merged (before stage filter):",{totalTickets:b.length,ticketsWithDepartment:b.filter(F=>F.departmentHead||F.departmentHeadFull).length,ticketsWithoutDepartment:b.filter(F=>!F.departmentHead&&!F.departmentHeadFull).length,ticketsWithStageId:b.filter(F=>F.stageId).length,ticketsWithoutStageId:b.filter(F=>!F.stageId).length});const ae=b.length,ue=b.slice(0,3).map(F=>({id:F.id,departmentHead:F.departmentHead,departmentHeadFull:F.departmentHeadFull,stageId:F.stageId}));b=b.filter(F=>F.stageId?Jt(F.stageId)===M:!0);const pe=b.slice(0,3).map(F=>({id:F.id,departmentHead:F.departmentHead,departmentHeadFull:F.departmentHeadFull,stageId:F.stageId}));console.log("[EmployeeDetailsModal] Ticket details merged (after stage filter):",{beforeStageFilter:ae,afterStageFilter:b.length,filteredOut:ae-b.length,currentStageId:M,ticketsWithDepartment:b.filter(F=>F.departmentHead||F.departmentHeadFull).length,ticketsWithoutDepartment:b.filter(F=>!F.departmentHead&&!F.departmentHeadFull).length,sampleBeforeFilter:ue,sampleAfterFilter:pe,sampleWithDepartment:b.find(F=>F.departmentHead||F.departmentHeadFull)?{id:b.find(F=>F.departmentHead||F.departmentHeadFull).id,departmentHead:b.find(F=>F.departmentHead||F.departmentHeadFull).departmentHead,departmentHeadFull:b.find(F=>F.departmentHead||F.departmentHeadFull).departmentHeadFull,allKeys:Object.keys(b.find(F=>F.departmentHead||F.departmentHeadFull)).filter(F=>F.toLowerCase().includes("department"))}:null})}catch(j){console.warn("[EmployeeDetailsModal] Failed to load ticket details via API, using snapshot data:",j),console.error("[EmployeeDetailsModal] Error details:",{message:j.message,stack:j.stack})}}else console.log("[EmployeeDetailsModal] All tickets have departmentHead, skipping API load");console.log("[EmployeeDetailsModal] Final tickets for grouping (only current stage):",{totalTickets:b.length,currentStageId:M,ticketsWithStageId:b.filter(K=>K.stageId).length,ticketsWithoutStageId:b.filter(K=>!K.stageId).length,ticketsWithDepartment:b.filter(K=>K.departmentHead||K.departmentHeadFull).length,ticketsWithoutDepartment:b.filter(K=>!K.departmentHead&&!K.departmentHeadFull).length});const Q=es(b);v.value=Q,console.log("[EmployeeDetailsModal] Before groupTicketsByDepartment:",{ticketsCount:b.length,sampleTickets:b.slice(0,5).map(K=>({id:K.id,departmentHead:K.departmentHead,departmentHeadFull:K.departmentHeadFull,hasDepartmentHead:!!K.departmentHead,hasDepartmentHeadFull:!!K.departmentHeadFull,allKeys:Object.keys(K).filter(j=>j.toLowerCase().includes("department"))})),ticketsWithDepartment:b.filter(K=>K.departmentHead||K.departmentHeadFull).length,ticketsWithoutDepartment:b.filter(K=>!K.departmentHead&&!K.departmentHeadFull).length});const de=ts(b);w.value=de;const ke=Q.reduce((K,j)=>K+j.count,0),_e=de.reduce((K,j)=>K+j.count,0);console.log("[EmployeeDetailsModal] Level 1 view data loaded (only current stage):",{currentStageId:M,totalTicketsForGrouping:b.length,timeCategoriesCount:Q.length,totalTicketsInTimeCategories:ke,departmentsCount:de.length,totalTicketsInDepartments:_e,departmentsSample:de.slice(0,5),ticketsWithDepartment:b.filter(K=>K.departmentHead||K.departmentHeadFull).length,ticketsWithoutDepartment:b.filter(K=>!K.departmentHead&&!K.departmentHeadFull).length,consistencyCheck:{totalTickets:b.length,timeCategoriesTotal:ke,departmentsTotal:_e,isConsistent:b.length===ke&&b.length===_e}})}catch(z){console.error("[EmployeeDetailsModal] Error loading level 1 view data:",z),console.error("[EmployeeDetailsModal] Error stack:",z.stack)}}async function W(z){if(!z){r.error("–ù–µ —É–∫–∞–∑–∞–Ω stageId –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö");return}if(g.value?.stageId===z)return;if(!T.value){r.error("–ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–º–µ–Ω—ã —Å—Ç–∞–¥–∏–∏ (stageSwitchContext)");return}C.value=!0,k.value=null;const M=g.value?{...g.value}:null;S.value=M?.stageId||null;try{const b=await Ms({...T.value,stageId:z});g.value={stageId:b.stageId,stageName:b.stageName,stageColor:b.color,totalCount:b.totalCount,employees:b.employees,others:b.others,snapshot:b.snapshot||M?.snapshot||null,ticketDetails:b.ticketDetails||null},f.value=null,p.value=null,y.value=null,n.value=1,i.value="time",d.value="employees",await B()}catch(b){console.error("[EmployeeDetailsModal] Failed to reload stage data:",b),k.value=b?.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏",M&&(g.value=M),r.error(k.value)}finally{C.value=!1}}async function G(z){if(!z||z.count===0){r.info(`–£ –∑–∞–∫–∞–∑—á–∏–∫–∞ "${z?.departmentName||"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!p.value){console.error("[EmployeeDetailsModal] Level 3 data not found"),r.error("–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è 3 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}try{const{createContextFromLevel3:M}=await Ee(async()=>{const{createContextFromLevel3:O}=await import("./chunk-DaswhI4P.js").then(Q=>Q.t);return{createContextFromLevel3:O}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),b=await M(p.value,z);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 3:",{employeeName:b.employeeName,dateCategory:b.dateCategoryLabel,departmentName:b.departmentName,ticketsCount:b.tickets.length}),await fe(b)}catch(M){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 3:",M),r.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤: "+M.message)}}async function q(z){if(!z||z.count===0){r.info(`–£ –∑–∞–∫–∞–∑—á–∏–∫–∞ "${z?.departmentName||"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!g.value){console.error("[EmployeeDetailsModal] Level 1 data not found"),r.error("–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è 1 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}try{const{createContextFromLevel1Department:M}=await Ee(async()=>{const{createContextFromLevel1Department:O}=await import("./chunk-DaswhI4P.js").then(Q=>Q.t);return{createContextFromLevel1Department:O}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),b=M(g.value,z);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 1 (department):",{stageName:b.stageName,departmentName:b.departmentName,ticketsCount:b.tickets.length}),await fe(b)}catch(M){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 1 (department):",M),r.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤: "+M.message)}}async function oe(z){if(!z||z.count===0){r.info(`–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${z?.label||"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è"}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!z.tickets||z.tickets.length===0){r.info(`–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${z.label}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!g.value){console.error("[EmployeeDetailsModal] Level 1 data not found"),r.error("–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è 1 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}try{const{createContextFromLevel1Time:M}=await Ee(async()=>{const{createContextFromLevel1Time:O}=await import("./chunk-DaswhI4P.js").then(Q=>Q.t);return{createContextFromLevel1Time:O}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),b=M(g.value,z);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 1 (time):",{stageName:b.stageName,dateCategory:b.dateCategoryLabel,ticketsCount:b.tickets.length}),await fe(b)}catch(M){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 1 (time):",M),r.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤: "+M.message)}}Ne(()=>t.isVisible,z=>{z?N():(h(),Se())}),Ne(()=>t.stageSwitchContext,z=>{T.value=z},{deep:!0}),$e(()=>{t.isVisible&&N()});async function Y(z,M=null){if(console.log("[EmployeeDetailsModal] ====== handleEmployeeClick START ======"),console.log("[EmployeeDetailsModal] Employee clicked:",z),console.log("[EmployeeDetailsModal] Current popup level:",n.value),M&&M.currentTarget&&(M.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{M.currentTarget&&(M.currentTarget.style.transform="")},150)),!z||!z.id){console.warn("[EmployeeDetailsModal] Invalid employee data:",z);return}if(g.value||(console.log("[EmployeeDetailsModal] Level 1 data not found, initializing from props"),g.value={stageName:t.stageName,stageId:t.stageId,totalCount:t.totalCount,employees:t.employees||[],others:t.others||null,snapshot:t.snapshot||null,ticketDetails:t.ticketDetails||null}),console.log("[EmployeeDetailsModal] Level 1 data:",{stageId:g.value.stageId,stageName:g.value.stageName,hasSnapshot:!!g.value.snapshot,snapshotType:g.value.snapshot?typeof g.value.snapshot:"null",snapshotKeys:g.value.snapshot?Object.keys(g.value.snapshot):[]}),!g.value.stageId){console.error("[EmployeeDetailsModal] ERROR: ID —Å—Ç–∞–¥–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω"),r.warning("ID —Å—Ç–∞–¥–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω");return}if(!g.value.snapshot){console.error("[EmployeeDetailsModal] ERROR: –°–ª–µ–ø–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω"),console.error("[EmployeeDetailsModal] Props snapshot:",t.snapshot),r.warning("–°–ª–µ–ø–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω");return}try{console.log("[EmployeeDetailsModal] Loading tickets for employee:",z.id,"stage:",g.value.stageId);const{filterTicketsByDepartment:b}=await Ee(async()=>{const{filterTicketsByDepartment:ke}=await import("./chunk-BPIGQGZw.js").then(_e=>_e.l);return{filterTicketsByDepartment:ke}},__vite__mapDeps([3,4]),import.meta.url).then(ke=>ke.LazyServiceLoader.loadTicketListUtils()),O=await fo(z.id,g.value.stageId,g.value.snapshot,g.value.ticketDetails);if(console.log("[EmployeeDetailsModal] Loaded tickets:",O?.length||0,O),!O||O.length===0){console.warn("[EmployeeDetailsModal] No tickets found for employee"),r.info(`–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ "${z.name}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –Ω–∞ —Å—Ç–∞–¥–∏–∏ "${g.value.stageName}"`);return}const Q=es(O);console.log("[EmployeeDetailsModal] Date categories:",Q?.length||0,Q);const de=ts(O).map(ke=>({...ke,tickets:b(O,ke.departmentName)}));console.log("[EmployeeDetailsModal] Employee departments:",de?.length||0,de),f.value={employeeId:z.id,employeeName:z.name,stageId:g.value.stageId,stageName:g.value.stageName,totalCount:O.length,dateCategories:Q,departments:de,tickets:O,snapshot:g.value.snapshot,ticketDetails:g.value.ticketDetails},i.value="time",console.log("[EmployeeDetailsModal] Level 2 data set:",{employeeName:f.value.employeeName,totalCount:f.value.totalCount,dateCategoriesCount:f.value.dateCategories.length,departmentsCount:f.value.departments.length}),console.log("[EmployeeDetailsModal] Transitioning to level 2"),console.log("[EmployeeDetailsModal] Level 2 data before set:",f.value),n.value=2,console.log("[EmployeeDetailsModal] Popup level set to:",n.value),console.log("[EmployeeDetailsModal] Level 2 data after set:",f.value),console.log("[EmployeeDetailsModal] Level 2 data check:",{hasLevel2Data:!!f.value,employeeName:f.value?.employeeName,dateCategoriesCount:f.value?.dateCategories?.length||0}),setTimeout(()=>{console.log("[EmployeeDetailsModal] After timeout - popupLevel:",n.value),console.log("[EmployeeDetailsModal] After timeout - level2Data:",f.value)},100),console.log("[EmployeeDetailsModal] ====== handleEmployeeClick END ======")}catch(b){console.error("[EmployeeDetailsModal] ERROR loading employee tickets:",b),console.error("[EmployeeDetailsModal] Error stack:",b.stack),r.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ —Ç–∏–∫–µ—Ç–∞—Ö: "+b.message)}}async function H(z){if(!z||z.count===0){r.info(`–£ –∑–∞–∫–∞–∑—á–∏–∫–∞ "${z?.departmentName||"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!f.value){r.error("–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}try{const{createContextFromLevel2Department:M}=await Ee(async()=>{const{createContextFromLevel2Department:O}=await import("./chunk-DaswhI4P.js").then(Q=>Q.t);return{createContextFromLevel2Department:O}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),b=M(f.value,z);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 2 (department):",{employeeName:b.employeeName,departmentName:b.departmentName,ticketsCount:b.tickets.length}),await fe(b)}catch(M){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 2 (department):",M),r.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤: "+M.message)}}async function Z(z){if(!z||z.count===0){r.info(`–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${z?.label||"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è"}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!z.tickets||z.tickets.length===0){r.info(`–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${z.label}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤`);return}if(!f.value){console.error("[EmployeeDetailsModal] Level 2 data not found"),r.error("–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è 2 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}try{const{createContextFromLevel2:M}=await Ee(async()=>{const{createContextFromLevel2:O}=await import("./chunk-DaswhI4P.js").then(Q=>Q.t);return{createContextFromLevel2:O}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),b=M(f.value,z);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 2:",{employeeName:b.employeeName,dateCategory:b.dateCategoryLabel,ticketsCount:b.tickets.length}),await fe(b)}catch(M){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 2:",M),r.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤: "+M.message)}}async function fe(z){if(console.time("[Performance] goToLevel4"),!z){console.error("[EmployeeDetailsModal] Context is required for level 4"),r.error("–û—à–∏–±–∫–∞: –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–µ —É–∫–∞–∑–∞–Ω"),console.timeEnd("[Performance] goToLevel4");return}console.log("[EmployeeDetailsModal] Transitioning to level 4:",{sourceLevel:z.sourceLevel,employeeId:z.employeeId,stageId:z.stageId,dateCategory:z.dateCategory,departmentName:z.departmentName,ticketsCount:z.tickets?.length||0});try{y.value={context:z,tickets:[],totalCount:0,isLoading:!0,error:null};let M=z.tickets||[];if(M.length===0&&z.snapshot){const{filterTicketsByContext:O}=await Ee(async()=>{const{filterTicketsByContext:Q}=await import("./chunk-DaswhI4P.js").then(de=>de.t);return{filterTicketsByContext:Q}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);M=await O(z)}(!M||M.length===0)&&(console.warn("[EmployeeDetailsModal] No tickets found after filtering, using context tickets"),M=z.tickets||[]),(!M||M.length===0)&&(console.warn("[EmployeeDetailsModal] No tickets in context, trying snapshot"),z.snapshot&&z.snapshot.tickets&&(M=z.snapshot.tickets||[],console.log("[EmployeeDetailsModal] Using tickets from snapshot:",M.length)));let b=[];try{console.time("[Performance] prepareTicketsForDisplay");const{prepareTicketsForDisplay:O}=await Ee(async()=>{const{prepareTicketsForDisplay:Q}=await import("./chunk-DaswhI4P.js").then(de=>de.t);return{prepareTicketsForDisplay:Q}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);b=await O(M,z.snapshot,z.ticketDetails),console.timeEnd("[Performance] prepareTicketsForDisplay")}catch(O){console.error("[EmployeeDetailsModal] Error preparing tickets:",O),console.timeEnd("[Performance] prepareTicketsForDisplay"),b=M||[],r.warning("–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç–æ–≤ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å. –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.")}console.log("[EmployeeDetailsModal] Tickets prepared for level 4:",{filteredCount:M.length,preparedCount:b.length}),y.value={context:z,tickets:b,totalCount:b.length,isLoading:!1,error:null},n.value=4,console.log("[EmployeeDetailsModal] Level 4 initialized:",{totalCount:y.value.totalCount,ticketsCount:y.value.tickets.length,isLoading:y.value.isLoading}),console.timeEnd("[Performance] goToLevel4")}catch(M){console.error("[EmployeeDetailsModal] Error transitioning to level 4:",M),console.error("[EmployeeDetailsModal] Error details:",{message:M.message,stack:M.stack,context:z});let b=[];if(z.snapshot&&z.snapshot.tickets)try{const O=z.stageId;O?b=(z.snapshot.tickets||[]).filter(Q=>Q.stageId===O):b=z.snapshot.tickets||[],console.log("[EmployeeDetailsModal] Using fallback tickets from snapshot:",b.length)}catch(O){console.error("[EmployeeDetailsModal] Error using fallback tickets:",O)}y.value={context:z,tickets:b,totalCount:b.length,isLoading:!1,error:{message:M.message,hasFallback:b.length>0}},b.length>0?(r.warning("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞."),n.value=4):(r.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤: "+M.message),P()),console.timeEnd("[Performance] goToLevel4")}}function P(){if(n.value===4){if(y.value&&y.value.context){const z=y.value.context.sourceLevel;n.value=z}else n.value=1;y.value=null}else n.value===3?(n.value=2,p.value=null,y.value=null):n.value===2&&(n.value=1,f.value=null,p.value=null,y.value=null)}function h(){n.value=1,g.value=null,f.value=null,p.value=null,y.value=null,i.value="time"}function _(){if(!y.value?.context)return"–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤";const{sourceLevel:z,employeeName:M,dateCategoryLabel:b,departmentName:O}=y.value.context;return z===2&&M&&b?`–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ —É ${M} –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${b}"`:z===2&&M&&O?`–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ —É ${M} —É –∑–∞–∫–∞–∑—á–∏–∫–∞ "${O}"`:z===3&&M&&O?`–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ —É ${M} —É –∑–∞–∫–∞–∑—á–∏–∫–∞ "${O}"`:z===1&&b?`–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${b}"`:z===1&&O?`–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ —É –∑–∞–∫–∞–∑—á–∏–∫–∞ "${O}"`:"–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"}function R(){if(!y.value?.context)return"–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞.";const{stageName:z}=y.value.context;return z?`–ù–∞ —Å—Ç–∞–¥–∏–∏ "${z}" –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º.`:"–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞."}async function re(){if(!y.value?.context){console.error("[EmployeeDetailsModal] Cannot retry: context not found");return}const z=y.value.context;await fe(z)}function ie(z){if(!z){console.warn("[EmployeeDetailsModal] Ticket is null or undefined"),r.warning("–û—à–∏–±–∫–∞: —Ç–∏–∫–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");return}if(!z.id){console.error("[EmployeeDetailsModal] Ticket ID is missing:",z),r.error("–û—à–∏–±–∫–∞: ID —Ç–∏–∫–µ—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω");return}try{const M=aa(z.id);if(console.log("[EmployeeDetailsModal] Opening ticket:",{ticketId:z.id,iframeUrl:M}),!M||typeof M!="string"||M.length===0)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å URL –¥–ª—è —Ç–∏–∫–µ—Ç–∞");const b=window.open(M,"_blank","noopener,noreferrer");if(!b||b.closed||typeof b.closed>"u")try{const O=document.createElement("a");O.href=M,O.target="_blank",O.rel="noopener noreferrer",O.style.display="none",document.body.appendChild(O),O.click(),document.body.removeChild(O),console.log("[EmployeeDetailsModal] Ticket opened via alternative method:",{ticketId:z.id,iframeUrl:M})}catch{throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É. –í–æ–∑–º–æ–∂–Ω–æ, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω popup blocker. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞.")}else console.log("[EmployeeDetailsModal] Ticket opened successfully:",{ticketId:z.id,iframeUrl:M})}catch(M){console.error("[EmployeeDetailsModal] Error opening ticket:",M),console.error("[EmployeeDetailsModal] Error details:",{message:M.message,stack:M.stack,ticket:z}),r.error("–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ç–∏–∫–µ—Ç–∞: "+M.message)}}function se(){h(),l("close")}e({reloadLevel1ForStage:W});function me(z){z&&z.stopPropagation(),x.value=!x.value}function Se(){x.value&&(x.value=!1)}function Ie(z){if(!x.value)return;const M=U.value,b=L.value;M&&M.contains(z.target)||b&&b.contains(z.target)||(x.value=!1)}async function xe(z){if(z.disabled){x.value=!1;return}x.value=!1,await W(z.id)}function Fe(z){if(x.value){z.stopPropagation(),Se();return}se()}return(z,M)=>(c(),he(It,{to:"body"},[o.isVisible?(c(),u("div",{key:0,class:"employee-details-modal",onClick:Ce(se,["self"]),onKeydown:Re(Fe,["esc"])},[s("div",{class:"modal-content",onClick:Ie},[ne(Ae,{name:"level",mode:"out-in"},{default:ye(()=>[n.value===1?(c(),u("div",Ti,[s("div",Si,[s("div",Di,[s("button",{ref_key:"stageTriggerRef",ref:L,class:"stage-trigger","aria-expanded":x.value,"aria-haspopup":"listbox",onClick:Ce(me,["stop"]),onKeydown:[Re(Ce(me,["prevent"]),["enter"]),Re(Ce(me,["prevent"]),["space"]),Re(Ce(Se,["stop","prevent"]),["esc"])]},[s("span",{class:"stage-color",style:we({backgroundColor:g.value?.stageColor||T.value?.stageColorMap?.[g.value?.stageId]||T.value?.stageColorMap?.[o.stageId]||"#007bff"})},null,4),s("span",Ai,m(g.value?.stageName||o.stageName),1),s("span",{class:X(["stage-caret",{open:x.value}])},"‚ñæ",2)],40,Ei),x.value?(c(),u("div",{key:0,ref_key:"stageDropdownRef",ref:U,class:"stage-dropdown",role:"listbox"},[(c(!0),u(ee,null,te(E.value,b=>(c(),u("div",{key:b.id,class:X(["stage-option",{disabled:b.disabled}]),role:"option","aria-selected":b.disabled,onClick:Ce(O=>xe(b),["stop"]),onKeydown:Re(Ce(O=>xe(b),["prevent"]),["enter"])},[s("span",{class:"stage-color",style:we({backgroundColor:b.color})},null,4),s("span",Ii,m(b.name),1)],42,$i))),128))],512)):A("",!0)]),s("span",Mi,"–í—Å–µ–≥–æ: "+m(g.value?.totalCount||o.totalCount)+" —Ç–∏–∫–µ—Ç–æ–≤",1),s("button",{class:"modal-close",onClick:se,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),s("div",Ni,[s("button",{class:X(["view-switch-btn",{active:d.value==="employees"}]),onClick:M[0]||(M[0]=b=>d.value="employees"),title:"–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"}," üë• –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º ",2),s("button",{class:X(["view-switch-btn",{active:d.value==="time"}]),onClick:M[1]||(M[1]=b=>d.value="time"),title:"–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –≥—Ä–∞–¥–∞—Ü–∏—è–º"}," üìÖ –ü–æ –≤—Ä–µ–º–µ–Ω–∏ ",2),s("button",{class:X(["view-switch-btn",{active:d.value==="departments"}]),onClick:M[2]||(M[2]=b=>d.value="departments"),title:"–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –∑–∞–∫–∞–∑—á–∏–∫–∞–º"}," üè¢ –ü–æ –∑–∞–∫–∞–∑—á–∏–∫–∞–º ",2)]),s("div",xi,[k.value?(c(),u("div",Li,[s("span",null,"–û—à–∏–±–∫–∞: "+m(k.value),1),s("button",{class:"btn-retry-stage",onClick:M[3]||(M[3]=b=>W(g.value?.stageId||o.stageId))}," –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")])):A("",!0),C.value?(c(),u("div",Pi,[...M[7]||(M[7]=[s("div",{class:"loading-spinner small"},null,-1),s("span",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–∏...",-1)])])):A("",!0),d.value==="employees"?(c(),u("div",Oi,[(g.value?.employees||o.employees).length===0&&(!(g.value?.others||o.others)||(g.value?.others||o.others).count===0)?(c(),u("div",Bi," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö ")):(c(),u("div",Ri,[(c(!0),u(ee,null,te(g.value?.employees||o.employees,b=>(c(),u("div",{key:b.id,class:X(["employee-item",{"employee-keeper":b.isKeeper}]),onClick:Ce(O=>Y(b,O),["stop"]),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –≥—Ä–∞–¥–∞—Ü–∏—è–º"},[s("span",Ui,m(b.name),1),s("div",Fi,[s("div",{class:"progress-bar",style:we({width:b.progressBarWidth+"%",backgroundColor:b.progressBarColor})},null,4)]),s("span",Hi,m(b.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ("+m(b.percentage)+"%) ",1),M[8]||(M[8]=s("span",{class:"employee-arrow"},"‚Üí",-1))],10,Wi))),128)),(g.value?.others||o.others)&&(g.value?.others||o.others).count>0?(c(),u("div",ji,[s("span",Vi,"–î—Ä—É–≥–∏–µ ("+m((g.value?.others||o.others).employeeCount)+")",1),s("div",zi,[s("div",{class:"progress-bar",style:we({width:(g.value?.others||o.others).progressBarWidth+"%",backgroundColor:(g.value?.others||o.others).progressBarColor})},null,4)]),s("span",Gi,m((g.value?.others||o.others).count)+" —Ç–∏–∫–µ—Ç–æ–≤ ("+m((g.value?.others||o.others).percentage)+"%) ",1)])):A("",!0)]))])):d.value==="time"?(c(),u("div",Ki,[v.value.length===0?(c(),u("div",qi," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):(c(),u("div",Yi,[(c(!0),u(ee,null,te(v.value,b=>(c(),u("div",{key:b.category,class:"category-item",onClick:Ce(O=>oe(b),["stop"])},[s("span",Ji,m(b.label),1),s("div",Zi,[s("div",{class:"progress-bar",style:we({width:b.progressBarWidth+"%",backgroundColor:b.progressBarColor})},null,4)]),s("span",Qi,m(b.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ("+m(b.percentage)+"%) ",1),M[9]||(M[9]=s("span",{class:"category-arrow"},"‚Üí",-1))],8,Xi))),128))]))])):d.value==="departments"?(c(),u("div",ec,[w.value.length===0?(c(),u("div",tc," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):(c(),u("div",ac,[s("table",sc,[M[11]||(M[11]=s("thead",null,[s("tr",null,[s("th",{class:"col-department"},"–ó–∞–∫–∞–∑—á–∏–∫"),s("th",{class:"col-count"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–µ—Ç–æ–≤"),s("th",{class:"col-action"})])],-1)),s("tbody",null,[(c(!0),u(ee,null,te(w.value,(b,O)=>(c(),u("tr",{key:O,class:"department-row",onClick:Ce(Q=>q(b),["stop"]),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤"},[s("td",nc,[s("span",rc,m(b.departmentName),1)]),s("td",lc,[s("span",ic,m(b.count),1)]),M[10]||(M[10]=s("td",{class:"col-action"},[s("span",{class:"department-arrow"},"‚Üí")],-1))],8,oc))),128))])])]))])):A("",!0)])])):n.value===2&&f.value?(c(),u("div",cc,[s("div",dc,[s("button",{class:"btn-back",onClick:P,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê "),s("h3",null,m(f.value.employeeName),1),s("span",uc,"–í—Å–µ–≥–æ: "+m(f.value.totalCount)+" —Ç–∏–∫–µ—Ç–æ–≤",1),s("button",{class:"modal-close",onClick:se,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),s("div",gc,[s("div",mc,[s("span",hc,m(f.value.stageName),1),s("div",fc,[s("button",{class:X(["level2-sort-btn",{active:i.value==="time"}]),onClick:M[4]||(M[4]=b=>i.value="time"),title:"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏"}," –ü–æ –≤—Ä–µ–º–µ–Ω–∏ ",2),s("button",{class:X(["level2-sort-btn",{active:i.value==="departments"}]),onClick:M[5]||(M[5]=b=>i.value="departments"),title:"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∑–∞–∫–∞–∑—á–∏–∫–∞–º"}," –ü–æ –∑–∞–∫–∞–∑—á–∏–∫–∞–º ",2)])]),i.value==="time"?(c(),u("div",vc,[f.value.dateCategories.length===0?(c(),u("div",pc," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–∏–∫–µ—Ç–∞—Ö ")):(c(),u("div",yc,[(c(!0),u(ee,null,te(f.value.dateCategories,b=>(c(),u("div",{key:b.category,class:"category-item",onClick:Ce(O=>Z(b),["stop"])},[s("span",bc,m(b.label),1),s("div",_c,[s("div",{class:"progress-bar",style:we({width:b.progressBarWidth+"%",backgroundColor:b.progressBarColor})},null,4)]),s("span",wc,m(b.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ("+m(b.percentage)+"%) ",1)],8,kc))),128))]))])):(c(),u("div",Cc,[!f.value.departments||f.value.departments.length===0?(c(),u("div",Tc,[M[12]||(M[12]=ge(" –î–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∑–∞–∫–∞–∑—á–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã ",-1)),s("button",{class:"btn-retry-stage",onClick:M[6]||(M[6]=b=>Y({id:f.value.employeeId,name:f.value.employeeName}))}," –û–±–Ω–æ–≤–∏—Ç—å ")])):(c(),u("div",Sc,[s("table",Dc,[M[14]||(M[14]=s("thead",null,[s("tr",null,[s("th",{class:"col-department"},"–ó–∞–∫–∞–∑—á–∏–∫"),s("th",{class:"col-count"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–µ—Ç–æ–≤"),s("th",{class:"col-action"})])],-1)),s("tbody",null,[(c(!0),u(ee,null,te(f.value.departments,(b,O)=>(c(),u("tr",{key:O,class:"department-row",onClick:Ce(Q=>H(b),["stop"]),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤"},[s("td",Ac,[s("span",$c,m(b.departmentName),1)]),s("td",Ic,[s("span",Mc,m(b.count),1)]),M[13]||(M[13]=s("td",{class:"col-action"},[s("span",{class:"department-arrow"},"‚Üí")],-1))],8,Ec))),128))])])]))]))])])):n.value===3&&p.value?(c(),u("div",Nc,[s("div",xc,[s("button",{class:"btn-back",onClick:P,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê "),s("div",Lc,[s("h3",null,m(p.value.employeeName),1),s("div",Pc,[s("span",Oc,m(p.value.dateCategoryLabel),1),s("span",Bc,m(p.value.stageName),1)])]),s("span",Rc,"–í—Å–µ–≥–æ: "+m(p.value.totalCount)+" —Ç–∏–∫–µ—Ç–æ–≤",1),s("button",{class:"modal-close",onClick:se,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),s("div",Wc,[p.value.departments.length===0?(c(),u("div",Uc," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–∫–∞–∑—á–∏–∫–∞—Ö ")):(c(),u("div",Fc,[s("table",Hc,[M[16]||(M[16]=s("thead",null,[s("tr",null,[s("th",{class:"col-department"},"–ó–∞–∫–∞–∑—á–∏–∫"),s("th",{class:"col-count"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–µ—Ç–æ–≤"),s("th",{class:"col-action"})])],-1)),s("tbody",null,[(c(!0),u(ee,null,te(p.value.departments,(b,O)=>(c(),u("tr",{key:O,class:"department-row",onClick:Ce(Q=>G(b),["stop"]),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤"},[s("td",Vc,[s("span",zc,m(b.departmentName),1)]),s("td",Gc,[s("span",Kc,m(b.count),1)]),M[15]||(M[15]=s("td",{class:"col-action"},[s("span",{class:"department-arrow"},"‚Üí")],-1))],8,jc))),128))])])]))])])):n.value===4&&y.value?(c(),u("div",qc,[s("div",Yc,[s("button",{class:"btn-back",onClick:P,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê "),s("div",Xc,[s("h3",null,m(D.value),1),y.value.context?(c(),u("div",Jc,[y.value.context.dateCategoryLabel?(c(),u("span",Zc,m(y.value.context.dateCategoryLabel),1)):A("",!0),y.value.context.departmentName?(c(),u("span",Qc,m(y.value.context.departmentName),1)):A("",!0),s("span",ed,m(y.value.context.stageName),1)])):A("",!0)]),s("span",td,"–í—Å–µ–≥–æ: "+m(y.value.totalCount)+" —Ç–∏–∫–µ—Ç–æ–≤",1),s("button",{class:"modal-close",onClick:se,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),s("div",ad,[ne(Ae,{name:"loading",mode:"out-in"},{default:ye(()=>[y.value.isLoading?(c(),u("div",sd,[...M[17]||(M[17]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):y.value.error&&y.value.error.hasFallback?(c(),u("div",od,[M[18]||(M[18]=s("div",{class:"error-banner"},[s("span",{class:"error-icon"},"‚ö†Ô∏è"),s("span",{class:"error-message"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞.")],-1)),s("div",nd,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:ye(()=>[(c(!0),u(ee,null,te(y.value.tickets,(b,O)=>(c(),he(Ct,{key:b.id,ticket:b,draggable:!1,style:we({"--ticket-index":O}),onClick:Q=>ie(b)},null,8,["ticket","style","onClick"]))),128))]),_:1})])])):y.value.error&&!y.value.error.hasFallback?(c(),u("div",rd,[M[19]||(M[19]=s("div",{class:"error-icon"},"‚ùå",-1)),M[20]||(M[20]=s("h3",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö",-1)),s("p",ld,m(y.value.error.message),1),s("button",{class:"btn-retry",onClick:re},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):!y.value.tickets||y.value.tickets.length===0?(c(),u("div",id,[M[21]||(M[21]=s("div",{class:"empty-state-icon"},"üì≠",-1)),s("h3",cd,m(_()),1),s("p",dd,m(R()),1)])):(c(),u("div",ud,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:ye(()=>[(c(!0),u(ee,null,te(y.value.tickets,(b,O)=>(c(),he(Ct,{key:b.id,ticket:b,draggable:!1,style:we({"--ticket-index":O}),onClick:Q=>ie(b)},null,8,["ticket","style","onClick"]))),128))]),_:1})]))]),_:1})])])):A("",!0)]),_:1})])],32)):A("",!0)]))}},md=ce(gd,[["__scopeId","data-v-7fbd8a12"]]);function hd(o,e,a=.5){if(!e||!Array.isArray(e)||e.length===0||typeof o!="number"||o<0)return 0;(typeof a!="number"||a<=0)&&(console.warn("getOverlapCount: threshold –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0.5"),a=.5);const t=[];if(e.forEach((n,i)=>{if(!n||!n.data||!Array.isArray(n.data))return;const d=n.data[o];d!=null&&!isNaN(d)&&t.push({datasetIndex:i,value:Number(d),y:Number(d)})}),t.length<2)return 0;const l=[];return t.forEach(n=>{let i=!1;for(const d of l){const g=d.y;if(Math.abs(n.y-g)<a){d.points.push(n),d.y=d.points.reduce((w,f)=>w+f.y,0)/d.points.length,i=!0;break}}i||l.push({points:[n],y:n.y})}),l.length===0?0:l.reduce((n,i)=>i.points.length>n.points.length?i:n,l[0]).points.length}function fd(o,e){const a=[];return o.forEach(t=>{let l=!1;for(const r of a){const n=r.y;if(Math.abs(t.value-n)<e){r.points.push(t),r.y=r.points.reduce((i,d)=>i+d.value,0)/r.points.length,l=!0;break}}l||a.push({points:[t],y:t.value})}),a}function vd(o,e=.5){if(!o)return console.warn("findOverlappingPoints: chart –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω"),[];if(!o.config||o.config.type!=="line")return[];const a=o.data?.datasets,t=o.data?.labels||[];if(!a||!Array.isArray(a)||a.length===0)return[];if(!Array.isArray(t)||t.length===0)return[];(typeof e!="number"||e<=0)&&(console.warn("findOverlappingPoints: threshold –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0.5"),e=.5);const l=[];return t.forEach((r,n)=>{try{if(hd(n,a,e)<2)return;const d=[];if(a.forEach((p,y)=>{if(!p||!p.data||!Array.isArray(p.data))return;const T=p.data[n];T==null||isNaN(T)||d.push({datasetIndex:y,value:Number(T),label:p.label||`Dataset ${y}`})}),d.length<2)return;const g=fd(d,e);if(g.length===0)return;const v=g.reduce((p,y)=>y.points.length>p.points.length?y:p,g[0]);if(v.points.length<2)return;let w=null,f=null;for(let p=0;p<a.length;p++)try{const y=o.getDatasetMeta(p);if(y&&y.data&&y.data[n]){w=y,f=y.data[n];break}}catch{continue}if(!f||typeof f.x!="number"||typeof f.y!="number")return;l.push({position:n,count:v.points.length,x:f.x,y:f.y,value:v.y,points:v.points.map(p=>({datasetIndex:p.datasetIndex,value:p.value,label:p.label}))})}catch(i){console.warn(`findOverlappingPoints: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–æ–∑–∏—Ü–∏–∏ ${n}:`,i)}}),l}function pd(o,e){const a=[];return o.forEach(t=>{let l=!1;for(const r of a){const n=r.y;if(Math.abs(t.y-n)<e){r.points.push(t),r.y=r.points.reduce((i,d)=>i+d.y,0)/r.points.length,l=!0;break}}l||a.push({points:[t],y:t.y})}),a}function yd(o,e,a=.5){if(!o)return console.warn("calculatePointJitter: chart –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω"),[];if(!o.config||o.config.type!=="line")return[];if(typeof e!="number"||e<0)return console.warn("calculatePointJitter: positionIndex –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º"),[];(typeof a!="number"||a<=0)&&(console.warn("calculatePointJitter: threshold –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0.5"),a=.5);const t=o.data?.datasets,l=o.data?.labels||[];if(!t||!Array.isArray(t)||t.length===0)return[];if(!Array.isArray(l)||e>=l.length)return[];const r=[];if(t.forEach((g,v)=>{if(!g||!g.data||!Array.isArray(g.data))return;const w=g.data[e];if(!(w==null||isNaN(w)))try{const f=o.getDatasetMeta(v);if(f&&f.data&&f.data[e]){const p=f.data[e];p&&typeof p.x=="number"&&typeof p.y=="number"&&r.push({datasetIndex:v,value:Number(w),x:p.x,y:p.y})}}catch(f){console.warn(`calculatePointJitter: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ meta –¥–ª—è dataset ${v}:`,f)}}),r.length===0)return[];const n=pd(r,a),i=[];n.forEach(g=>{const v=g.points||[];v.length>1?v.forEach((f,p)=>{const y=(p-(v.length-1)/2)*4;i.push({datasetIndex:f.datasetIndex,jitterX:y,value:f.value})}):v.length===1&&i.push({datasetIndex:v[0].datasetIndex,jitterX:0,value:v[0].value})});const d=new Set(i.map(g=>g.datasetIndex));return r.forEach(g=>{d.has(g.datasetIndex)||i.push({datasetIndex:g.datasetIndex,jitterX:0,value:g.value})}),i}const kd=.5,os=6,bd=2;function _d(o){return typeof o!="number"||o<2?os:os+(o-1)*bd}function wd(o,e){if(!o||!o.ctx){console.warn("drawEnlargedPoint: chart –∏–ª–∏ ctx –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");return}if(!e||typeof e.x!="number"||typeof e.y!="number"){console.warn("drawEnlargedPoint: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã overlap",e);return}const a=e.count;if(typeof a!="number"||a<2)return;const t=o.ctx,{x:l,y:r,points:n}=e,i=_d(a);if(t.canvas){t.save();try{t.beginPath(),t.arc(l,r,i,0,2*Math.PI);let g="rgba(128, 128, 128, 0.3)";if(n&&n.length>0&&o.data&&o.data.datasets){const v=n[0].datasetIndex,w=o.data.datasets[v];if(w&&w.pointBackgroundColor){const f=Array.isArray(w.pointBackgroundColor)?w.pointBackgroundColor[e.position]||w.pointBackgroundColor[0]:w.pointBackgroundColor;if(f)if(f.startsWith("#")){const p=parseInt(f.slice(1,3),16),y=parseInt(f.slice(3,5),16),T=parseInt(f.slice(5,7),16);g=`rgba(${p}, ${y}, ${T}, 0.4)`}else f.startsWith("rgba")?g=f.replace(/rgba?\(([^)]+)\)/,(p,y)=>{const T=y.split(",").map(C=>C.trim());return`rgba(${T[0]}, ${T[1]}, ${T[2]}, 0.4)`}):g=f+"66"}}t.fillStyle=g,t.fill(),t.strokeStyle=g.replace("0.4","0.6").replace("66","99"),t.lineWidth=1,t.stroke()}catch(g){console.warn("drawEnlargedPoint: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π —Ç–æ—á–∫–∏:",g)}finally{t.restore()}}}const Cd={id:"overlappingPointsPlugin",afterDatasetsDraw:o=>{if(!(!o||!o.config||o.config.type!=="line")&&o.ctx)try{const e=vd(o,kd);if(!Array.isArray(e)||e.length===0)return;e.filter(t=>!(!t||typeof t!="object"||typeof t.count!="number"||t.count<2||typeof t.x!="number"||typeof t.y!="number"||!isFinite(t.x)||!isFinite(t.y))).forEach(t=>{try{wd(o,t)}catch(l){console.warn(`overlappingPointsPlugin: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π —Ç–æ—á–∫–∏ –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ ${t.position}:`,l)}})}catch(e){console.warn("overlappingPointsPlugin: –æ—à–∏–±–∫–∞ –≤ afterDatasetsDraw:",e)}}},Td=.5,Sd={id:"pointJitterPlugin",beforeDatasetsDraw:o=>{if(!(!o||!o.config||o.config.type!=="line")){o._jitterData||(o._jitterData={});try{const e=o.data?.datasets,a=o.data?.labels||[];if(!e||!Array.isArray(e)||e.length===0||!Array.isArray(a)||a.length===0)return;o._jitterData={},a.forEach((t,l)=>{const r=yd(o,l,Td);r&&r.length>0&&r.forEach(n=>{const i=`${n.datasetIndex}_${l}`;o._jitterData[i]=n.jitterX})})}catch(e){console.warn("pointJitterPlugin: –æ—à–∏–±–∫–∞ –≤ beforeDatasetsDraw:",e)}}},afterDatasetsDraw:o=>{if(!(!o||!o.config||o.config.type!=="line")&&o.ctx&&!(!o._jitterData||Object.keys(o._jitterData).length===0))try{const e=o.ctx,a=o.data?.datasets;if(!a||!Array.isArray(a)||a.length===0)return;a.forEach((t,l)=>{const r=o.getDatasetMeta(l);!r||r.hidden||!t.data||!Array.isArray(t.data)||t.data.forEach((n,i)=>{const d=r.data[i];if(!d||typeof d.x!="number"||typeof d.y!="number"||n==null||isNaN(n))return;const g=`${l}_${i}`,v=o._jitterData[g];if(!(v===void 0||v===0)){e.save();try{const w=t.pointStyle||"circle",f=(t.pointRadius||7)+1,p=Array.isArray(t.pointBackgroundColor)?t.pointBackgroundColor[i]||t.pointBackgroundColor[0]:t.pointBackgroundColor,y=Array.isArray(t.pointBorderColor)?t.pointBorderColor[i]||t.pointBorderColor[0]:t.pointBorderColor,T=t.pointBorderWidth||1,C=d.x+v,k=d.y;switch(e.fillStyle=p||"#007bff",e.strokeStyle=y||"#ffffff",e.lineWidth=T,e.beginPath(),w){case"circle":e.arc(C,k,f,0,2*Math.PI);break;case"triangle":e.moveTo(C,k-f),e.lineTo(C-f,k+f),e.lineTo(C+f,k+f),e.closePath();break;case"rect":case"rectRounded":const S=f*1.4;e.rect(C-S/2,k-S/2,S,S);break;case"rectRot":const x=f*1.4;e.moveTo(C,k-x/2),e.lineTo(C+x/2,k),e.lineTo(C,k+x/2),e.lineTo(C-x/2,k),e.closePath();break;case"star":const U=f;for(let D=0;D<5;D++){const N=D*4*Math.PI/5-Math.PI/2,B=C+U*Math.cos(N),W=k+U*Math.sin(N);D===0?e.moveTo(B,W):e.lineTo(B,W)}e.closePath();break;case"cross":const L=f;e.moveTo(C-L,k-L),e.lineTo(C+L,k+L),e.moveTo(C+L,k-L),e.lineTo(C-L,k+L);break;case"crossRot":const E=f;e.moveTo(C-E,k),e.lineTo(C+E,k),e.moveTo(C,k-E),e.lineTo(C,k+E);break;default:e.arc(C,k,f,0,2*Math.PI)}w!=="cross"&&w!=="crossRot"&&e.fill(),e.stroke(),d._originalX||(d._originalX=d.x,d._originalY=d.y),d._jitterX=v,d._jitteredX=C,d._jitteredY=k}catch(w){console.warn(`pointJitterPlugin: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ —Ç–æ—á–∫–∏ ${l}_${i}:`,w)}finally{e.restore()}}})})}catch(e){console.warn("pointJitterPlugin: –æ—à–∏–±–∫–∞ –≤ afterDatasetsDraw:",e)}},afterDraw:o=>{o._jitterData}},Dd={id:"pointLabelsPlugin",afterDatasetsDraw:o=>{if(!(!o||!o.config||o.config.type!=="line")&&o.ctx)try{const e=o.ctx,a=o.data?.datasets;if(!a||!Array.isArray(a)||a.length===0)return;a.forEach((t,l)=>{const r=o.getDatasetMeta(l);if(!r||r.hidden||!t.data||!Array.isArray(t.data))return;const n=Array.isArray(t.pointBackgroundColor)?t.pointBackgroundColor[0]||"#6b7280":t.pointBackgroundColor||"#6b7280";t.data.forEach((i,d)=>{const g=r.data[d];if(!g||typeof g.x!="number"||typeof g.y!="number"||i==null||isNaN(i))return;const v=g._jitteredX!==void 0?g._jitteredX:g.x,w=g._jitteredY!==void 0?g._jitteredY:g.y,f=v+8,p=w-5,y=String(Math.round(i));e.save();try{e.font="11px Arial, sans-serif",e.textAlign="left",e.textBaseline="middle";const C=e.measureText(y).width,k=11,S=3,x=f-S,U=p-k/2-S,L=C+S*2,E=k+S*2;e.fillStyle="rgba(255, 255, 255, 0.95)",e.fillRect(x,U,L,E),e.strokeStyle="rgba(0, 0, 0, 0.1)",e.lineWidth=1,e.strokeRect(x,U,L,E),e.fillStyle=n,e.font="11px Arial, sans-serif",e.textAlign="left",e.textBaseline="middle",e.fillText(y,f,p)}catch(T){console.warn(`pointLabelsPlugin: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è —Ç–æ—á–∫–∏ ${l}_${d}:`,T)}finally{e.restore()}})})}catch(e){console.warn("pointLabelsPlugin: –æ—à–∏–±–∫–∞ –≤ afterDatasetsDraw:",e)}}},Ed={class:"graph-state-chart"},Ad={class:"chart-header"},$d={class:"chart-type-selector"},Id=["onClick","title"],Md={class:"chart-type-icon"},Nd={class:"chart-type-label"},xd={key:0,class:"comparison-type-selector"},Ld={class:"radio-group"},Pd={key:0},Od={key:1},Bd={key:2,class:"graph-legend"},Rd={key:4,class:"error-container"},Wd={class:"error-message"},Ud={class:"chart-wrapper"},Fd={class:"chart-canvas-container"},Hd={key:0,class:"bar-chart-stage-labels"},jd={key:6,class:"no-data"},Vd={__name:"GraphStateChart",props:{period:{type:Object,default:null},showCurrentState:{type:Boolean,default:!0}},emits:["data-loaded","error"],setup(o,{emit:e}){const a=(j,V)=>typeof window>"u"?V:getComputedStyle(document.documentElement).getPropertyValue(j).trim()||V,t=o,l=e,r=I(!1),n=I(null),i=I(null),d=I({weekStart:null,weekEnd:null,current:null}),g=I(null),v=I("weekStartToWeekEnd"),w=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],f=I("line"),p=I(!1),y=I(""),T=I(""),C=I(0),k=I([]),S=I(null),x=I(null),U=I(null),L=I(null),E=I([]),D=$(()=>{switch(f.value){case"line":return yt;case"bar":return vs;case"doughnut":return fs;default:return yt}}),N={formed:a("--b24-primary","#007bff"),review:a("--b24-warning","#ffc107"),execution:a("--b24-success","#28a745")},B=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:N.formed},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:N.review},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:N.execution}],W=$(()=>B.reduce((j,V)=>(j[V.id]=V.name,j),{})),G=["circle","triangle","rect","rectRot","star","cross","crossRot"],q=I({formed:!0,review:!0,execution:!0}),oe=mt(),Y={id:"employeeLabelsPlugin",afterDatasetsDraw:j=>{if(j.config.type==="bar")try{const V=j.ctx;if(!j.data||!j.data.datasets)return;const ae=j.data.datasets,ue=j.scales.y;ae.forEach((pe,F)=>{const le=j.getDatasetMeta(F);if(!le||le.hidden)return;const ve=pe.label||"";if(!ve||ve.includes("–î—Ä—É–≥–∏–µ"))return;const Te=ve.trim().split(/\s+/);let Me="";if(Te.length===1)Me=Te[0];else{const Le=Te[0],Ue=Te.slice(1).join(" ");Me=`${Le}
${Ue}`}const Ve=Me.split(`
`);pe.data.forEach((Le,Ue)=>{if(Le===0||!Le)return;const ze=le.data[Ue];if(!ze||typeof ze.x!="number"||typeof ze.y!="number")return;const He=ze.x,Tt=ze.y+ze.height+25;V.save(),V.font="bold 9px Arial, sans-serif",V.fillStyle="#6b7280",V.textAlign="center",V.textBaseline="top",V.translate(He,Tt),V.rotate(-12*Math.PI/180),Ve.forEach((Hs,js)=>{const Ya=Hs.trim();Ya&&V.fillText(Ya,0,js*11)}),V.restore()})})}catch(V){console.error("Error in employeeLabelsPlugin:",V)}}},H={id:"doughnutCenterTextPlugin",afterDraw:j=>{if(j.config.type!=="doughnut")return;const{ctx:V,chartArea:ae,width:ue,height:pe}=j;if(!j.data||!j.data.datasets||j.data.datasets.length===0)return;const le=j.data.datasets[0].meta?.totals?.overall??null;if(le===null||typeof le>"u")return;const ve=["–í—Å–µ–≥–æ –≤ —Å–µ–∫—Ç–æ—Ä–µ 1–°","—Ç–∏–∫–µ—Ç–æ–≤ –≤ —Ä–∞–±–æ—Ç–µ:",`${le}`];V.save(),V.font='600 16px "Roboto", sans-serif',V.fillStyle=a("--b24-text-primary","#1f2937"),V.textAlign="center",V.textBaseline="middle";const Te=(ae.left+ae.right)/2,Me=(ae.top+ae.bottom)/2,Ve=18,Le=Ve*ve.length,Ue=Me-Le/2+4;ve.forEach((ze,He)=>{He===ve.length-1&&`${ze}`.length>4?V.font='700 18px "Roboto", sans-serif':V.font='600 16px "Roboto", sans-serif',V.fillText(ze,Te,Ue+He*Ve)}),V.restore()}};Je.register(Y),Je.register(H);function Z(){const j=new Map;[d.value.weekStart,d.value.weekEnd,d.value.current].forEach(V=>{!V||!V.statistics||!V.statistics.employees||V.statistics.employees.forEach(ae=>{j.has(ae.id)||j.set(ae.id,{id:ae.id,name:ae.name})})}),E.value=Array.from(j.values()).sort((V,ae)=>V.name.localeCompare(ae.name))}function fe(j,V="background"){return{increase:{background:a("--b24-success","#28a745"),border:a("--b24-success-hover","#218838"),point:a("--b24-success","#28a745")},decrease:{background:a("--b24-danger","#dc3545"),border:a("--b24-danger-hover","#c82333"),point:a("--b24-danger","#dc3545")},stable:{background:a("--b24-text-muted","#9ca3af"),border:a("--b24-text-secondary","#6b7280"),point:a("--b24-text-muted","#9ca3af")}}[j]?.[V]||a("--b24-text-secondary","#6c757d")}function P(){if(!(!d.value.weekStart||!d.value.weekEnd))try{const j=Aa.compareTwoSnapshots(d.value.weekStart,d.value.weekEnd,{includeTickets:!1,includeEmployees:!0});let V=null,ae=null;d.value.current&&(V=Aa.compareTwoSnapshots(d.value.weekEnd,d.value.current,{includeTickets:!1,includeEmployees:!0}),ae=Aa.compareTwoSnapshots(d.value.weekStart,d.value.current,{includeTickets:!1,includeEmployees:!0})),g.value={weekStartToWeekEnd:j,weekEndToCurrent:V,weekStartToCurrent:ae}}catch(j){console.error("–û—à–∏–±–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–ª–µ–ø–∫–æ–≤:",j),oe.warning("–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–ª–µ–ø–∫–æ–≤: "+j.message)}}function h(j){return j?j.replace(/\s*\(\d+\)\s*$/,"").trim():""}function _(j){const V=h(j);return{"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ":"formed","–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó":"review",–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ:"execution"}[V]||"formed"}function R(j){return _(j)}function re(j){return j===0?"weekStart":j===1?"weekEnd":j===2?"current":"weekEnd"}function ie(j,V,ae,ue,pe=null,F=null,le=null,ve=null){console.log("[GraphStateChart] openEmployeeDetailsModal called:",{stageName:j,stageId:V,totalCount:ae,employeesCount:ue?.length||0,hasSnapshot:!!F,snapshotTicketIds:F?.ticketIds?.length||0}),y.value=j,T.value=V||"",C.value=ae,k.value=ue||[],S.value=pe&&pe.count>0?pe:null,x.value=F,U.value=le,L.value=ve,p.value=!0,console.log("[GraphStateChart] Modal state set:",{modalStageId:T.value,hasCurrentSnapshot:!!x.value})}async function se(j,V,ae){console.log("[GraphStateChart] openEmployeeDetailsModalForLine:",{stageId:j,timePoint:V,hasMeta:!!ae});const ue=B.find(F=>F.id===j);if(!ue){console.warn("[GraphStateChart] Stage not found:",j);return}const pe={graphType:"line",stageId:j,stageName:ue.name,timePoint:V,snapshots:d.value,meta:{line:ae||null,doughnut:i.value?.datasets?.[0]?.meta||null},stageColorMap:N,stageNameMap:W.value};try{const F=await Ms({stageId:j,graphType:"line",timePoint:V,snapshots:d.value,meta:{line:ae||null,doughnut:i.value?.datasets?.[0]?.meta||null},stageColorMap:N,stageNameMap:W.value,maxVisible:10});console.log("[GraphStateChart] Opening modal with level1:",{stageName:F.stageName,stageId:j,totalCount:F.totalCount,employeesCount:F.employees?.length||0,hasSnapshot:!!F.snapshot}),ie(F.stageName,j,F.totalCount,F.employees,F.others,F.snapshot,null,pe)}catch(F){console.error("[GraphStateChart] Failed to open modal for line point:",F),oe.error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–ø–∞–ø –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–æ—á–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞")}}function me(j,V){if(!V||!V.employees||V.employees.length===0){oe.warning("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –¥–ª—è —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞");return}const ae=d.value.current||d.value.weekEnd||d.value.weekStart,ue={graphType:"doughnut",stageId:j,stageName:V.stageName,snapshots:d.value,meta:{doughnut:i.value?.datasets?.[0]?.meta||null},stageColorMap:N,stageNameMap:W.value};ie(V.stageName,j,V.totalCount,V.employees,V.others,ae,null,ue)}function Se(){p.value=!1,y.value="",T.value="",C.value=0,k.value=[],S.value=null,x.value=null,U.value=null}async function Ie(j,V,ae){if(f.value!=="line"||V.length===0)return;const ue=V[0],pe=ue.datasetIndex,F=ue.index,le=ae.data.datasets[pe];if(!le)return;const ve=R(le.label),Te=re(F);await se(ve,Te,le.meta||null)}function xe(j,V,ae){if(f.value!=="doughnut"||V.length===0)return;const pe=V[0].index,F=ae.data,le=F.labels[pe],ve=R(le),Me=F.datasets[0]?.meta?.employees?.[ve];if(!Me){console.warn("–î–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è —ç—Ç–∞–ø–∞:",ve);return}me(ve,Me)}function Fe(j){const V=B[j];if(!V)return 0;const ae=d.value.current||d.value.weekEnd||d.value.weekStart;return!ae||!ae.statistics||!ae.statistics.stages?0:ae.statistics.stages[V.id]?.count||0}function z(j){const V=B.find(pe=>pe.id===j);if(!V)return"";const ae=d.value.current||d.value.weekEnd||d.value.weekStart;if(!ae||!ae.statistics||!ae.statistics.stages)return V.name;const ue=ae.statistics.stages[j]?.count||0;return`${V.name} (${ue})`}const M=$(()=>{if(!i.value)return null;if(f.value==="doughnut"||f.value==="bar")return i.value;const j=i.value.datasets.filter(V=>{const ae=B.find(ue=>ue.name===V.label);return ae?q.value[ae.id]:!0});return{...i.value,datasets:j}});$(()=>f.value!=="bar"||!i.value||!i.value.meta?null:i.value.meta.employeesByStage||null);const b=$(()=>{const j={responsive:!0,maintainAspectRatio:!1,resizeDelay:0,layout:{padding:f.value==="bar"?{bottom:80}:{}},onClick:(V,ae,ue)=>{f.value==="line"?Ie(V,ae,ue):f.value==="doughnut"&&xe(V,ae,ue)},onHover:(V,ae,ue)=>{f.value==="doughnut"&&(V.native.target.style.cursor=ae.length>0?"pointer":"default")},plugins:{legend:{display:f.value!=="bar",position:f.value==="doughnut"?"right":"top",labels:{font:{size:f.value==="doughnut"?14:12,weight:f.value==="doughnut"?"600":"500"},boxWidth:f.value==="doughnut"?18:12,boxHeight:f.value==="doughnut"?18:12,padding:f.value==="doughnut"?14:10},onClick:(V,ae,ue)=>{if(f.value==="bar"){const F=ae.datasetIndex;if(F!==void 0){const le=ue.chart.getDatasetMeta(F);le.hidden=!le.hidden,ue.chart.update()}return}const pe=ae.datasetIndex;if(pe!==void 0){const F=ue.chart.getDatasetMeta(pe);F.hidden=!F.hidden,ue.chart.update()}}},tooltip:{enabled:!0,mode:"index",intersect:!1,callbacks:{title:V=>{if(f.value==="bar"){const ae=V[0].dataIndex,ue=B[ae];return ue?ue.name:""}return V[0].label||""},label:V=>{const ae=V.dataset.label||"",ue=V.parsed.y||V.parsed||0,pe=V.dataIndex;if(f.value==="bar"){const F=V.dataset,le=V.dataIndex,ve=B[le],Te=ve?ve.name:"";return`${F.label}: ${ue} —Ç–∏–∫–µ—Ç–æ–≤ –Ω–∞ —ç—Ç–∞–ø–µ "${Te}"`}if(f.value==="doughnut"){const F=V.dataset.data.reduce((ve,Te)=>ve+Te,0),le=F>0?(ue/F*100).toFixed(1):0;return`${ae}: ${ue} —Ç–∏–∫–µ—Ç–æ–≤ (${le}%)`}else{if(!g.value||pe===0)return`${ae}: ${ue} —Ç–∏–∫–µ—Ç–æ–≤`;let F=null;const le=_(ae);if(v.value==="weekStartToWeekEnd"&&pe===1?F=g.value.weekStartToWeekEnd?.stages?.[le]:v.value==="weekEndToCurrent"&&pe===2&&d.value.current?F=g.value.weekEndToCurrent?.stages?.[le]:v.value==="weekStartToCurrent"&&pe===2&&d.value.current&&(F=g.value.weekStartToCurrent?.stages?.[le]),!F)return`${ae}: ${ue} —Ç–∏–∫–µ—Ç–æ–≤`;const ve=F.delta,Te=F.deltaPercent,Me=F.trend;let Ve=`${ae}: ${ue} —Ç–∏–∫–µ—Ç–æ–≤`;if(ve!==0){const Le=ve>0?"+":"",Ue=Me==="increase"?"‚Üë":Me==="decrease"?"‚Üì":"‚Üí";Ve+=` (${Le}${ve}, ${Le}${Te.toFixed(1)}%) ${Ue}`}else Ve+=" (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)";return Ve}},afterBody:V=>{if(f.value==="bar"&&V.length>0){const F=V[0];F.dataset;const le=F.parsed.y||0,ve=F.dataIndex,Te=Fe(ve);return[`${Te>0?(le/Te*100).toFixed(1):0}% –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç—Ç–∞–ø–∞`]}if(f.value==="doughnut"&&V.length>0)return["–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"];if(f.value==="line"){const F=[];if(g.value){const le=V[0].dataIndex;if(le!==0){let ve=null;if(_(V[0].dataset.label||""),v.value==="weekStartToWeekEnd"&&le===1?ve=g.value.weekStartToWeekEnd:v.value==="weekEndToCurrent"&&le===2?ve=g.value.weekEndToCurrent:v.value==="weekStartToCurrent"&&le===2&&(ve=g.value.weekStartToCurrent),ve&&ve.metadata){const Te=ve.metadata.timeDiff;F.push(`–ü–µ—Ä–∏–æ–¥: ${Te.days} –¥–Ω. ${Te.hours} —á. ${Te.minutes} –º–∏–Ω.`)}}}return F.push("–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"),F}if(!g.value)return[];const ae=V[0].dataIndex;if(ae===0)return[];let ue=null;if(_(V[0].dataset.label||""),v.value==="weekStartToWeekEnd"&&ae===1?ue=g.value.weekStartToWeekEnd:v.value==="weekEndToCurrent"&&ae===2?ue=g.value.weekEndToCurrent:v.value==="weekStartToCurrent"&&ae===2&&(ue=g.value.weekStartToCurrent),!ue||!ue.metadata)return[];const pe=ue.metadata.timeDiff;return[`–ü–µ—Ä–∏–æ–¥: ${pe.days} –¥–Ω. ${pe.hours} —á. ${pe.minutes} –º–∏–Ω.`]}}},title:{display:!1}}};return f.value==="line"||f.value==="bar"?{...j,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}:f.value==="doughnut"?{...j,cutout:"60%"}:j});function O(j){const V=new Date(j),ae=V.getFullYear(),ue=String(V.getMonth()+1).padStart(2,"0"),pe=String(V.getDate()).padStart(2,"0");return`${ae}-${ue}-${pe}`}function Q(j){const{current:V,weekEnd:ae}=j,ue=V||ae;if(!ue||!ue.statistics||!ue.statistics.stages)return null;const pe=[],F=[],le=[],ve=[],Te={},Me={};if(B.forEach(Le=>{const Ue=ue.statistics.stages[Le.id]?.count||0;if(Ue>0){pe.push(`${Le.name} (${Ue})`),F.push(Ue),le.push(Le.color+"80"),ve.push(Le.color),Me[Le.id]=Ue;const ze=yi(Le.id,ue,B);ze&&ze.employees&&(Te[Le.id]=ze)}}),F.length===0)return null;const Ve=F.reduce((Le,Ue)=>Le+Ue,0);return{labels:pe,datasets:[{label:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —ç—Ç–∞–ø–∞–º",data:F,backgroundColor:le,borderColor:ve,borderWidth:2,meta:{employees:Te,totals:{overall:Ve,stages:Me}}}]}}function de(j){if(f.value==="doughnut")return Q(j);if(f.value==="bar"){const le=t.showCurrentState&&j.current?"current":j.weekEnd?"weekEnd":"weekStart";return pi(j,le,B)}const{weekStart:V,weekEnd:ae,current:ue}=j,pe=[],F=[];return B.forEach((le,ve)=>{const Te=[];if(V&&V.statistics&&V.statistics.stages){const He=V.statistics.stages[le.id];if(pe.length===0){const Tt=V.metadata?.createdAt?new Date(V.metadata.createdAt):null;pe.push(Tt?O(Tt):"–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏")}Te.push(He?.count||0)}else pe.length===0&&pe.push("–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏"),Te.push(0);if(ae&&ae.statistics&&ae.statistics.stages){const He=ae.statistics.stages[le.id];if(pe.length===1){const Tt=ae.metadata?.createdAt?new Date(ae.metadata.createdAt):null;pe.push(Tt?O(Tt):"–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏")}Te.push(He?.count||0)}else pe.length===1&&pe.push("–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏"),Te.push(0);if(ue&&t.showCurrentState&&ue.statistics&&ue.statistics.stages){const He=ue.statistics.stages[le.id];pe.length===2&&pe.push("–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"),Te.push(He?.count||0)}const Me=["stable"];g.value?v.value==="weekStartToWeekEnd"?(Me.push(g.value.weekStartToWeekEnd?.stages?.[le.id]?.trend||"stable"),ue&&Me.push(g.value.weekStartToCurrent?.stages?.[le.id]?.trend||"stable")):v.value==="weekEndToCurrent"&&ue?(Me.push("stable"),Me.push(g.value.weekEndToCurrent?.stages?.[le.id]?.trend||"stable")):v.value==="weekStartToCurrent"&&ue?(Me.push(g.value.weekStartToWeekEnd?.stages?.[le.id]?.trend||"stable"),Me.push(g.value.weekStartToCurrent?.stages?.[le.id]?.trend||"stable")):(Me.push("stable"),ue&&Me.push("stable")):(Me.push("stable"),ue&&Me.push("stable"));let Ve,Le,Ue;g.value&&f.value!=="doughnut"?(Ve=Me.map(He=>fe(He,"background")+"40"),Le=Me.map(He=>fe(He,"border")),Ue=Me.map(He=>fe(He,"point"))):(Ve=le.color+"40",Le=le.color,Ue=le.color);let ze=null;f.value==="line"&&(ze={employees:vi(le.id,j)}),F.push({label:le.name,data:Te,backgroundColor:(Array.isArray(Ve),Ve),borderColor:(Array.isArray(Le),Le),borderWidth:2,...f.value==="line"&&{pointStyle:G[ve%G.length]},pointBackgroundColor:(Array.isArray(Ue),Ue),pointBorderColor:(Array.isArray(Le),Le),pointRadius:7,pointHoverRadius:10,fill:f.value!=="line",tension:f.value==="line"?.4:0,meta:ze})}),pe.length===0&&(pe.push("–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏","–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏"),t.showCurrentState&&pe.push("–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ")),{labels:pe,datasets:F}}const ke=async()=>{r.value=!0,n.value=null;try{const j=t.period?.endDate?new Date(t.period.endDate):new Date,V=t.period?.startDate?new Date(t.period.startDate):pt.getWeekStartDate(j),ae=t.period?.endDate?new Date(t.period.endDate):pt.getWeekEndDate(j),ue=pt.formatDate(V),pe=pt.formatDate(ae),[F,le]=await Promise.all([pt.getSnapshot(ue,"week_start"),pt.getSnapshot(pe,"week_end")]);let ve=null;t.showCurrentState&&(ve=await Ua.getSectorDataForSnapshot({useCache:!1,normalize:!0})),d.value={weekStart:F,weekEnd:le,current:ve},Z(),P(),K(),l("data-loaded",{weekStart:F,weekEnd:le,current:ve})}catch(j){console.error("Error loading chart data:",j),n.value=j.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞",oe.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞: "+n.value),l("error",n.value)}finally{r.value=!1}};$e(()=>{Je.register(Cd),Je.register(Sd),Je.register(Dd),ke()});function _e(j){q.value=j}const K=()=>{const j=de({weekStart:d.value.weekStart,weekEnd:d.value.weekEnd,current:d.value.current});if(!i.value||!i.value.labels||i.value.labels.length!==j?.labels?.length)i.value=j;else if(j){const V=JSON.stringify(i.value),ae=JSON.stringify(j);V!==ae&&(i.value=j)}};return Ne(()=>[t.period,t.showCurrentState],()=>{ke()},{deep:!0}),Ne(f,()=>{(d.value.weekStart||d.value.weekEnd||d.value.current)&&K()}),Ne(v,()=>{(d.value.weekStart||d.value.weekEnd||d.value.current)&&K()}),(j,V)=>(c(),u("div",Ed,[s("div",Ad,[V[3]||(V[3]=s("h3",{class:"chart-title"},"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),s("div",$d,[(c(),u(ee,null,te(w,ae=>s("button",{key:ae.value,onClick:ue=>f.value=ae.value,class:X(["chart-type-btn",{active:f.value===ae.value}]),title:ae.label},[s("span",Md,m(ae.icon),1),s("span",Nd,m(ae.label),1)],10,Id)),64))])]),!r.value&&!n.value&&g.value&&f.value!=="doughnut"?(c(),u("div",xd,[V[7]||(V[7]=s("h4",{class:"comparison-title"},"–¢–∏–ø —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:",-1)),s("div",Ld,[s("label",null,[Be(s("input",{type:"radio","onUpdate:modelValue":V[0]||(V[0]=ae=>v.value=ae),value:"weekStartToWeekEnd",onChange:K},null,544),[[Et,v.value]]),V[4]||(V[4]=s("span",null,"–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ ‚Üí –ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏",-1))]),d.value.current?(c(),u("label",Pd,[Be(s("input",{type:"radio","onUpdate:modelValue":V[1]||(V[1]=ae=>v.value=ae),value:"weekEndToCurrent",onChange:K},null,544),[[Et,v.value]]),V[5]||(V[5]=s("span",null,"–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏ ‚Üí –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ",-1))])):A("",!0),d.value.current?(c(),u("label",Od,[Be(s("input",{type:"radio","onUpdate:modelValue":V[2]||(V[2]=ae=>v.value=ae),value:"weekStartToCurrent",onChange:K},null,544),[[Et,v.value]]),V[6]||(V[6]=s("span",null,"–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ ‚Üí –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ",-1))])):A("",!0)])])):A("",!0),!r.value&&!n.value&&i.value?(c(),he(ai,{key:1,stages:B,selected:q.value,"onUpdate:selected":_e,onChange:K},null,8,["selected"])):A("",!0),!r.value&&!n.value&&g.value&&f.value!=="doughnut"?(c(),u("div",Bd,[...V[8]||(V[8]=[_t('<h4 class="legend-title" data-v-cbba196a>–õ–µ–≥–µ–Ω–¥–∞:</h4><div class="legend-items" data-v-cbba196a><div class="legend-item" data-v-cbba196a><span class="legend-color legend-increase" data-v-cbba196a></span><span data-v-cbba196a>–ó–µ–ª—ë–Ω—ã–π ‚Äî —Ä–æ—Å—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–µ—Ç–æ–≤</span></div><div class="legend-item" data-v-cbba196a><span class="legend-color legend-decrease" data-v-cbba196a></span><span data-v-cbba196a>–ö—Ä–∞—Å–Ω—ã–π ‚Äî —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–µ—Ç–æ–≤</span></div><div class="legend-item" data-v-cbba196a><span class="legend-color legend-stable" data-v-cbba196a></span><span data-v-cbba196a>–°–µ—Ä—ã–π ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π</span></div></div>',2)])])):A("",!0),r.value?(c(),he(_a,{key:3,message:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞..."})):n.value?(c(),u("div",Rd,[s("p",Wd,"‚ùå "+m(n.value),1),s("button",{onClick:ke,class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É")])):M.value?(c(),u("div",{key:5,class:X(["chart-container",`chart-type-${f.value}`])},[s("div",Ud,[s("div",Fd,[(c(),he(wt(D.value),{data:M.value,options:b.value},null,8,["data","options"]))]),f.value==="bar"?(c(),u("div",Hd,[(c(),u(ee,null,te(B,ae=>s("div",{key:ae.id,class:"stage-label-item"},m(z(ae.id)),1)),64))])):A("",!0)])],2)):(c(),u("div",jd,[...V[9]||(V[9]=[s("p",null,"üìä –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1),s("p",{class:"no-data-hint"},"–°–æ–∑–¥–∞–π—Ç–µ —Å–ª–µ–ø–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞",-1)])])),ne(md,{"is-visible":p.value,"stage-name":y.value,"stage-id":T.value,"total-count":C.value,employees:k.value,others:S.value,snapshot:x.value,"ticket-details":U.value,"stage-switch-context":L.value,onClose:Se},null,8,["is-visible","stage-name","stage-id","total-count","employees","others","snapshot","ticket-details","stage-switch-context"])]))}},zd=ce(Vd,[["__scopeId","data-v-cbba196a"]]),nt={USER_NOT_DETERMINED:"USER_NOT_DETERMINED",ACCESS_DENIED:"ACCESS_DENIED",API_ERROR:"API_ERROR"};class it{constructor(e,a=null,t=null,l=null){this.allowed=e,this.errorCode=a,this.errorMessage=t,this.user=l}}class rt{static async checkAccess(){try{const e=Bt();if(console.log("AccessControlService.checkAccess - isInsideBitrix24:",e),console.log("AccessControlService.checkAccess - window.self === window.top:",window.self===window.top),console.log("AccessControlService.checkAccess - typeof BX24:",typeof BX24),e)console.log("AccessControlService.checkAccess - Inside Bitrix24, skipping direct access check");else{console.log("AccessControlService.checkAccess - Not inside Bitrix24, checking direct access config...");const{isDirectAccessAllowed:r,getDenyMessage:n}=await Ee(async()=>{const{isDirectAccessAllowed:d,getDenyMessage:g}=await import("./direct-access-config-Bzka4gH0.js");return{isDirectAccessAllowed:d,getDenyMessage:g}},__vite__mapDeps([5,4]),import.meta.url),i=await r();if(console.log("AccessControlService.checkAccess - allowDirectAccess:",i),!i){const d=await n();return console.warn("Direct access denied: Application opened directly in browser, but direct access is disabled in config"),console.warn("Deny message:",d),new it(!1,nt.ACCESS_DENIED,d,null)}console.log("Direct access allowed: Using primary administrator token from settings.php")}if(e)try{await Promise.race([kt.init(),new Promise((r,n)=>setTimeout(()=>n(new Error("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥")),5e3))])}catch(r){console.warn("BX24.init() failed, will try proxy API:",r)}let a;try{a=await Promise.race([kt.getCurrentUser(),new Promise((r,n)=>setTimeout(()=>n(new Error("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø—Ä–µ–≤—ã—Å–∏–ª–æ 10 —Å–µ–∫—É–Ω–¥")),1e4))])}catch(r){console.warn("Bitrix24BxApi.getCurrentUser() failed, trying proxy API:",r);const{Bitrix24ApiProvider:n}=await Ee(async()=>{const{Bitrix24ApiProvider:i}=await import("./chunk-BPIGQGZw.js").then(d=>d.b);return{Bitrix24ApiProvider:i}},__vite__mapDeps([3,4]),import.meta.url);try{const i=await n.getInstance();a=await Promise.race([i.getCurrentUser(),new Promise((d,g)=>setTimeout(()=>g(new Error("–ü—Ä–æ–∫—Å–∏ API –ø—Ä–µ–≤—ã—Å–∏–ª–æ 5 —Å–µ–∫—É–Ω–¥")),5e3))]),console.log("Got user from proxy API:",a?.ID||"unknown")}catch(i){throw console.error("Both BX24 API and proxy API failed:",i),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}if(!a||!a.ID)return console.warn("AccessControlService.checkAccess - user not determined:",a),new it(!1,nt.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.");console.log("AccessControlService.checkAccess - user determined:",{id:a.ID,name:a.NAME,departments:a.UF_DEPARTMENT});const t=a.UF_DEPARTMENT||[];if(console.log("AccessControlService.checkAccess - departmentIds:",t),!Array.isArray(t)||t.length===0){if(console.log("AccessControlService.checkAccess - user has no departments"),!e){const{isDirectAccessAllowed:r}=await Ee(async()=>{const{isDirectAccessAllowed:i}=await import("./direct-access-config-Bzka4gH0.js");return{isDirectAccessAllowed:i}},__vite__mapDeps([5,4]),import.meta.url);if(await r())return console.log("AccessControlService.checkAccess - Direct access allowed, granting access despite no departments"),new it(!0,null,null,a)}return console.warn("AccessControlService.checkAccess - Access denied: user has no departments"),new it(!1,nt.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ—Ç–¥–µ–ª—É.")}const l=t.some(r=>ws(r));return console.log("AccessControlService.checkAccess - hasAccess:",l),l?(console.log("AccessControlService.checkAccess - Access granted"),new it(!0,null,null,a)):(console.warn("AccessControlService.checkAccess - Access denied: no allowed departments"),new it(!1,nt.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"))}catch(e){return console.error("AccessControlService.checkAccess error:",e),e.message&&(e.message.includes("CORS")||e.message.includes("blocked")||e.message.includes("ERR_FAILED")||e.message.includes("unknown address space"))&&Bt()?(console.error("CORS error inside Bitrix24: Cannot determine interface user."),new it(!1,nt.API_ERROR,"–û—à–∏–±–∫–∞ CORS: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")):e.message&&e.message.includes("not loaded")?new it(!1,nt.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."):new it(!1,nt.API_ERROR,"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}static async getCurrentUser(){try{return Bt()&&await kt.init(),await kt.getCurrentUser()}catch(e){return console.error("AccessControlService.getCurrentUser error:",e),null}}}const Gd={key:0,class:"create-snapshot-button-container"},Kd=["disabled"],qd={class:"modal-content"},Yd={class:"modal-header"},Xd=["disabled"],Jd={class:"modal-body"},Zd={key:0,class:"progress-container"},Qd={class:"progress-bar-wrapper"},eu={class:"progress-text"},tu={class:"progress-percent"},au={class:"progress-description"},su={key:1},ou={class:"modal-footer"},nu=["disabled"],ru=["disabled"],lu={key:0},iu={key:0},cu={key:1},du={key:2},uu={key:1},gu={__name:"CreateSnapshotButton",props:{user:{type:Object,default:null}},emits:["snapshot-created"],setup(o,{emit:e}){const a=o,t=e,l=I(a.user),r=I(!1),n=I(!1),i=I(0),d=I("idle"),g=I(""),v=mt(),w=$(()=>l.value?sa(l.value):!1);$e(async()=>{if(!a.user)try{const C=await rt.checkAccess();C.allowed&&(l.value=C.user)}catch(C){console.error("Error loading user:",C)}});const f=()=>{if(!w.value){v.warning("–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–µ–ø–∫–∏");return}r.value=!0},p=()=>{n.value||(r.value=!1,d.value="idle",i.value=0,g.value="")},y=async()=>{if(!n.value){if(!w.value){v.warning("–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–µ–ø–∫–∏");return}n.value=!0,d.value="loading_data",i.value=0,g.value="–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...";try{g.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞ –∏–∑ Bitrix24...";const C=await Ua.getSectorDataForSnapshot({useCache:!0,normalize:!0,onProgress:x=>{const U=Math.min(80,(x.progress||0)*.8);i.value=U,d.value="loading_data",g.value=x.description||x.details?.description||"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞..."}});d.value="creating_snapshot",i.value=85,g.value="–°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–µ–ø–∫–∞...";const k=l.value;if(!k)throw new Error("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω");const S=await pt.createSnapshot(C,"manual",{createdBy:{id:k.ID,name:`${k.NAME||""} ${k.LAST_NAME||""}`.trim()||k.EMAIL||`User ${k.ID}`},sectorId:"1C"});d.value="success",i.value=100,g.value="–°–ª–µ–ø–æ–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",v.success("–°–ª–µ–ø–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"),t("snapshot-created",S),setTimeout(()=>{p()},1500)}catch(C){d.value="error",i.value=0,g.value="–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞",console.error("Error creating snapshot:",C);let k="–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞";C.message&&(C.message.includes("–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö")||C.message.includes("sector data")?k="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Bitrix24.":C.message.includes("—Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞")||C.message.includes("snapshot")?k="–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.":C.message.includes("–≤–∞–ª–∏–¥–∞—Ü")||C.message.includes("validation")?k="–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞.":k=C.message),v.error(k)}finally{n.value=!1}}},T=C=>{C.key==="Escape"&&r.value&&!n.value&&p()};return $e(()=>{window.addEventListener("keydown",T)}),at(()=>{window.removeEventListener("keydown",T)}),(C,k)=>w.value?(c(),u("div",Gd,[s("button",{class:"create-snapshot-btn",onClick:f,disabled:n.value,title:"–°–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞"},[...k[1]||(k[1]=[s("span",{class:"btn-icon"},"üì∏",-1),s("span",{class:"btn-text"},"–°–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫",-1)])],8,Kd),(c(),he(It,{to:"body"},[ne(Ae,{name:"modal"},{default:ye(()=>[r.value?(c(),u("div",{key:0,class:"modal-overlay",onClick:k[0]||(k[0]=Ce(S=>!n.value&&p(),["self"]))},[s("div",qd,[s("div",Yd,[k[2]||(k[2]=s("h3",{class:"modal-title"},"–°–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞",-1)),s("button",{class:"modal-close",onClick:p,disabled:n.value,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ",8,Xd)]),s("div",Jd,[d.value!=="idle"?(c(),u("div",Zd,[s("div",Qd,[s("div",{class:"progress-bar",style:we({width:`${i.value}%`})},null,4)]),s("div",eu,[s("span",tu,m(Math.round(i.value))+"%",1),s("span",au,m(g.value),1)])])):(c(),u("div",su,[...k[3]||(k[3]=[s("p",{class:"modal-description"},' –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Å–ª–µ–ø–æ–∫ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°. –°–ª–µ–ø–æ–∫ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω —Å —Ç–∏–ø–æ–º "manual" (—Ä—É—á–Ω–æ–π). ',-1),s("p",{class:"modal-warning"}," ‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è. ",-1)])]))]),s("div",ou,[s("button",{class:"btn btn-secondary",onClick:p,disabled:n.value}," –û—Ç–º–µ–Ω–∞ ",8,nu),s("button",{class:"btn btn-primary",onClick:y,disabled:n.value},[n.value?(c(),u("span",lu,[d.value==="loading_data"?(c(),u("span",iu,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...")):d.value==="creating_snapshot"?(c(),u("span",cu,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),u("span",du,"–û–±—Ä–∞–±–æ—Ç–∫–∞..."))])):(c(),u("span",uu,"–°–æ–∑–¥–∞—Ç—å"))],8,ru)])])])):A("",!0)]),_:1})]))])):A("",!0)}},mu=ce(gu,[["__scopeId","data-v-09bccee2"]]),hu=20,fu=5*60*1e3;async function vu({search:o="",limit:e=hu,sectorDepartmentId:a=Xt.SECTOR_1C}={}){const t=`sector1c_employees_${o}_${e}_${a||"all"}`,l=sessionStorage.getItem(t);if(l)try{const{data:r,timestamp:n}=JSON.parse(l);if(Date.now()-n<fu)return r}catch(r){console.warn("[sector1cEmployees] Cache parse error:",r)}try{const r={ACTIVE:"Y"};a?Array.isArray(a)?r.UF_DEPARTMENT=a:r.UF_DEPARTMENT=[a]:r.UF_DEPARTMENT=[Xt.SECTOR_1C],o&&o.length>=2&&(r["%NAME"]=o,r["%LAST_NAME"]=o,r["%WORK_POSITION"]=o);const g=((await new vt().call("user.get",{filter:r,select:["ID","NAME","LAST_NAME","SECOND_NAME","WORK_POSITION","UF_DEPARTMENT"],order:{LAST_NAME:"ASC",NAME:"ASC"},start:0})).result||[]).slice(0,e).map(v=>({id:parseInt(v.ID),name:pu(v),position:v.WORK_POSITION||"",department:v.UF_DEPARTMENT||null}));try{sessionStorage.setItem(t,JSON.stringify({data:g,timestamp:Date.now()}))}catch(v){console.warn("[sector1cEmployees] Cache write error:",v)}return g}catch(r){throw console.error("[sector1cEmployees] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",r),new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${r.message}`)}}function pu(o){const e=[o.LAST_NAME,o.NAME,o.SECOND_NAME].filter(Boolean);return e.length>0?e.join(" "):o.NAME||"–ë–µ–∑ –∏–º–µ–Ω–∏"}function yu(o,e=300){let a;return function(...l){const r=()=>{clearTimeout(a),o(...l)};clearTimeout(a),a=setTimeout(r,e)}}const ku={class:"employee-select-field-text"},bu={key:0,class:"employee-select-dropdown"},_u={class:"employee-select-dropdown-search"},wu={key:0,class:"employee-select-state"},Cu={key:1,class:"employee-select-state employee-select-state--error"},Tu={key:2,class:"employee-select-state"},Su=["checked"],Du=["checked","onChange"],Eu={class:"employee-select-item-content"},Au={class:"employee-select-item-name"},$u={key:0,class:"employee-select-item-position"},Iu={__name:"EmployeeSelect",props:{selected:{type:Array,default:()=>["all"]},multiple:{type:Boolean,default:!0},placeholder:{type:String,default:"–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°"},maxHeight:{type:Number,default:300}},emits:["update:selected","search","error"],setup(o,{emit:e}){const a=o,t=e,l=I(null),r=I(null),n=I(""),i=I([]),d=I(!1),g=I(null),v=I(!1),w=$(()=>{if(!n.value)return i.value;const E=n.value.toLowerCase();return i.value.filter(D=>D.name.toLowerCase().includes(E)||D.position&&D.position.toLowerCase().includes(E))}),f=$(()=>{if(a.selected.includes("all")||a.selected.length===0)return a.placeholder;if(a.selected.length===1){const E=i.value.find(D=>D.id===a.selected[0]);return E?E.name:a.placeholder}return`–í—ã–±—Ä–∞–Ω–æ: ${a.selected.length} ${U(a.selected.length,"—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞","—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤","—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤")}`});async function p(E=""){d.value=!0,g.value=null;try{i.value=await vu({search:E})}catch(D){g.value=D,t("error",D)}finally{d.value=!1}}function y(){t("search",n.value)}function T(){d.value||(v.value=!v.value,v.value?(i.value.length===0&&p(),Wt(()=>{r.value&&r.value.focus()})):n.value="")}function C(E){l.value&&!l.value.contains(E.target)&&(v.value=!1,n.value="")}function k(E){const D=[...a.selected],N=D.indexOf(E);if(E==="all")if(N>-1)D.splice(N,1);else return t("update:selected",["all"]);else if(N>-1)D.splice(N,1);else{const B=D.indexOf("all");B>-1&&D.splice(B,1),D.push(E)}t("update:selected",D)}function S(E){return E==="all"?a.selected.includes("all"):a.selected.includes(E)||a.selected.includes("all")}const x=$(()=>n.value?`–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É "${n.value}"`:"–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°");function U(E,D,N,B){const W=E%10,G=E%100;return G>=11&&G<=19?B:W===1?D:W>=2&&W<=4?N:B}function L(){p(n.value)}return Ne(()=>a.selected,E=>{(!E||E.length===0)&&t("update:selected",["all"])},{immediate:!0}),$e(()=>{document.addEventListener("click",C),(!a.selected||a.selected.length===0)&&t("update:selected",["all"])}),at(()=>{document.removeEventListener("click",C)}),(E,D)=>(c(),u("div",{class:"employee-select",ref_key:"selectContainer",ref:l},[s("div",{class:X(["employee-select-field",{"employee-select-field--open":v.value,"employee-select-field--disabled":d.value}]),onClick:T},[s("span",ku,m(f.value),1),s("span",{class:X(["employee-select-field-icon",{open:v.value}])},"‚ñº",2)],2),ne(Ae,{name:"dropdown-fade"},{default:ye(()=>[v.value?(c(),u("div",bu,[s("div",_u,[Be(s("input",{"onUpdate:modelValue":D[0]||(D[0]=N=>n.value=N),type:"text",placeholder:"üîç –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...",class:"employee-select-search-input",onInput:y,onClick:D[1]||(D[1]=Ce(()=>{},["stop"])),ref_key:"searchInput",ref:r},null,544),[[At,n.value]])]),d.value?(c(),u("div",wu,[...D[6]||(D[6]=[s("span",{class:"spinner"},"‚è≥",-1),s("span",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°...",-1)])])):g.value?(c(),u("div",Cu,[s("span",null,"‚ùå "+m(g.value.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤"),1),s("button",{onClick:[L,D[2]||(D[2]=Ce(()=>{},["stop"]))],class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):!d.value&&w.value.length===0&&!g.value?(c(),u("div",Tu,[s("span",null,"üì≠ "+m(x.value),1)])):(c(),u("div",{key:3,class:"employee-select-list",style:we({maxHeight:`${o.maxHeight}px`})},[s("label",{class:X(["employee-select-item",{"employee-select-item--selected":S("all")}]),onClick:D[4]||(D[4]=Ce(()=>{},["stop"]))},[s("input",{type:"checkbox",checked:S("all"),onChange:D[3]||(D[3]=N=>k("all"))},null,40,Su),D[7]||(D[7]=s("div",{class:"employee-select-item-content"},[s("span",{class:"employee-select-item-name"},"–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏")],-1))],2),(c(!0),u(ee,null,te(w.value,N=>(c(),u("label",{key:N.id,class:X(["employee-select-item",{"employee-select-item--selected":S(N.id)}]),onClick:D[5]||(D[5]=Ce(()=>{},["stop"]))},[s("input",{type:"checkbox",checked:S(N.id),onChange:B=>k(N.id)},null,40,Du),s("div",Eu,[s("span",Au,m(N.name),1),N.position?(c(),u("span",$u,m(N.position),1)):A("",!0)])],2))),128))],4))])):A("",!0)]),_:1})],512))}},Mu=ce(Iu,[["__scopeId","data-v-6b8c949b"]]),Nu={class:"stage-select-field-text"},xu={key:0,class:"stage-select-dropdown"},Lu={class:"stage-select-list"},Pu=["checked"],Ou=["checked","onChange"],Bu={class:"stage-select-item-content"},Ru={class:"stage-select-item-name"},Wu={__name:"StageSelect",props:{selected:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},stages:{type:Array,required:!0,default:()=>[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff"},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107"},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745"}]},placeholder:{type:String,default:"–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø—ã"}},emits:["update:selected","change"],setup(o,{emit:e}){const a=o,t=e,l=I(null),r=I(!1),n=$(()=>Object.values(a.selected).every(f=>f===!0)),i=$(()=>{if(n.value)return a.placeholder;const f=a.stages.filter(p=>a.selected[p.id]);return f.length===0?"–≠—Ç–∞–ø—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã":f.length===1?f[0].name:`–í—ã–±—Ä–∞–Ω–æ: ${f.length} —ç—Ç–∞–ø–∞(–æ–≤)`});function d(){r.value=!r.value,r.value}function g(f){l.value&&!l.value.contains(f.target)&&(r.value=!1)}function v(f,p){const y={...a.selected};y[f]=p,t("update:selected",y),t("change",f,p)}function w(){const f=n.value,p={};a.stages.forEach(y=>{p[y.id]=!f}),t("update:selected",p),t("change","all",!f)}return $e(()=>{document.addEventListener("click",g)}),at(()=>{document.removeEventListener("click",g)}),(f,p)=>(c(),u("div",{class:"stage-select",ref_key:"selectContainer",ref:l},[s("div",{class:X(["stage-select-field",{"stage-select-field--open":r.value,"stage-select-field--disabled":!1}]),onClick:d},[s("span",Nu,m(i.value),1),s("span",{class:X(["stage-select-field-icon",{open:r.value}])},"‚ñº",2)],2),ne(Ae,{name:"dropdown-fade"},{default:ye(()=>[r.value?(c(),u("div",xu,[s("div",Lu,[s("label",{class:X(["stage-select-item",{"stage-select-item--selected":n.value}]),onClick:p[0]||(p[0]=Ce(()=>{},["stop"]))},[s("input",{type:"checkbox",checked:n.value,onChange:w},null,40,Pu),p[2]||(p[2]=s("div",{class:"stage-select-item-content"},[s("span",{class:"stage-select-item-name"},"–í—Å–µ —ç—Ç–∞–ø—ã")],-1))],2),(c(!0),u(ee,null,te(o.stages,y=>(c(),u("label",{key:y.id,class:X(["stage-select-item",{"stage-select-item--selected":o.selected[y.id]}]),onClick:p[1]||(p[1]=Ce(()=>{},["stop"]))},[s("input",{type:"checkbox",checked:o.selected[y.id],onChange:T=>v(y.id,T.target.checked)},null,40,Ou),s("div",Bu,[s("span",{class:"stage-select-item-color",style:we({backgroundColor:y.color})},null,4),s("span",Ru,m(y.name),1)])],2))),128))])])):A("",!0)]),_:1})],512))}},Uu=ce(Wu,[["__scopeId","data-v-ce2229b2"]]),Fu={class:"trigger-text"},Hu={class:"week-picker-items"},ju=["data-week-number","onClick"],Vu={class:"week-item-content"},zu={class:"week-number"},Gu={class:"week-dates"},Ku={class:"week-picker-actions"},qu=["disabled"],Yu={__name:"WeekPicker",props:{selectedWeek:{type:Object,default:null},weeksCount:{type:Number,default:52}},emits:["update:selectedWeek","change"],setup(o,{emit:e}){const a=o,t=e,l=I(null),r=I(null),n=I([]),i=I(!1),d=I(!1),g=I(null);function v(L=52,E=4){const D=[],N=new Date,B=w(N),W=f(N);for(let G=0;G<L;G++){const q=new Date(B.start);q.setUTCDate(q.getUTCDate()-G*7);const oe=w(q),Y=f(q);D.unshift({weekNumber:Y,startUtc:oe.start.toISOString(),endUtc:oe.end.toISOString(),start:oe.start,end:oe.end})}(D.length===0||D[D.length-1].weekNumber!==W)&&D.push({weekNumber:W,startUtc:B.start.toISOString(),endUtc:B.end.toISOString(),start:B.start,end:B.end});for(let G=1;G<=E;G++){const q=new Date(B.start);q.setUTCDate(q.getUTCDate()+G*7);const oe=w(q),Y=f(q);D.push({weekNumber:Y,startUtc:oe.start.toISOString(),endUtc:oe.end.toISOString(),start:oe.start,end:oe.end})}return D.sort((G,q)=>G.start-q.start),D}function w(L){const E=new Date(L),D=E.getUTCDay(),N=E.getUTCDate()-D+(D===0?-6:1),B=new Date(Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),N,0,0,0)),W=new Date(B);return W.setUTCDate(W.getUTCDate()+6),W.setUTCHours(23,59,59,999),{start:B,end:W}}function f(L){const E=new Date(Date.UTC(L.getFullYear(),L.getMonth(),L.getDate()));E.setUTCDate(E.getUTCDate()+4-(E.getUTCDay()||7));const D=new Date(Date.UTC(E.getUTCFullYear(),0,1));return Math.ceil(((E-D)/864e5+1)/7)}function p(L){const E=new Date(L),D=E.getUTCFullYear(),N=String(E.getUTCMonth()+1).padStart(2,"0"),B=String(E.getUTCDate()).padStart(2,"0");return`${D}-${N}-${B}`}function y(){d.value=!d.value,d.value&&(n.value=v(a.weeksCount,4),g.value=a.selectedWeek||n.value.find(L=>{const D=f(new Date);return L.weekNumber===D})||n.value[0],Wt(()=>{g.value&&S(g.value.weekNumber)}))}function T(L){g.value=L,S(L.weekNumber)}function C(){g.value&&(t("update:selectedWeek",g.value),t("change",g.value),d.value=!1)}function k(){g.value=a.selectedWeek||null,d.value=!1}function S(L){if(!r.value)return;const E=r.value.querySelector(`[data-week-number="${L}"]`);if(E){const D=r.value,N=E.offsetTop,B=D.clientHeight,W=E.clientHeight,G=N-B/2+W/2;D.scrollTo({top:G,behavior:"smooth"})}}function x(){i.value||!d.value||(i.value=!0,clearTimeout(window.weekPickerScrollTimeout),window.weekPickerScrollTimeout=setTimeout(()=>{if(!r.value){i.value=!1;return}const L=r.value,E=L.getBoundingClientRect(),D=E.top+E.height/2,N=L.querySelectorAll(".week-picker-item");let B=null,W=1/0;if(N.forEach(G=>{const q=G.getBoundingClientRect(),oe=q.top+q.height/2,Y=Math.abs(oe-D);Y<W&&(W=Y,B=G)}),B){const G=parseInt(B.dataset.weekNumber),q=n.value.find(oe=>oe.weekNumber===G);q&&(!g.value||q.weekNumber!==g.value.weekNumber)&&(g.value=q)}i.value=!1},150))}function U(L){l.value&&!l.value.contains(L.target)&&d.value&&k()}return $e(()=>{if(n.value=v(a.weeksCount,4),a.selectedWeek)g.value=a.selectedWeek;else{const E=f(new Date),D=n.value.find(N=>N.weekNumber===E);D?g.value=D:g.value=n.value[0]}document.addEventListener("click",U)}),at(()=>{window.weekPickerScrollTimeout&&clearTimeout(window.weekPickerScrollTimeout),document.removeEventListener("click",U)}),Ne(()=>a.selectedWeek,L=>{L&&(g.value=L,d.value&&!i.value&&Wt(()=>{S(L.weekNumber)}))},{deep:!0}),(L,E)=>(c(),u("div",{class:"week-picker",ref_key:"pickerContainer",ref:l},[E[1]||(E[1]=s("div",{class:"week-picker-label"},[s("span",{class:"section-icon"},"üìÖ"),s("span",null,"–ü–µ—Ä–∏–æ–¥")],-1)),s("div",{class:X(["week-picker-trigger",{"is-open":d.value}]),onClick:y},[s("span",Fu,[o.selectedWeek?(c(),u(ee,{key:0},[ge(" –ù–µ–¥–µ–ª—è "+m(o.selectedWeek.weekNumber)+" ¬∑ "+m(p(o.selectedWeek.startUtc))+" ‚Äî "+m(p(o.selectedWeek.endUtc)),1)],64)):(c(),u(ee,{key:1},[ge(" –í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–¥–µ–ª—é ")],64))]),s("span",{class:X(["trigger-icon",{"is-open":d.value}])},"‚ñº",2)],2),ne(Ae,{name:"dropdown-fade"},{default:ye(()=>[d.value?(c(),u("div",{key:0,class:"week-picker-dropdown",onClick:E[0]||(E[0]=Ce(()=>{},["stop"]))},[s("div",{class:"week-picker-wheel",ref_key:"wheelContainer",ref:r,onScroll:x},[s("div",Hu,[(c(!0),u(ee,null,te(n.value,(D,N)=>(c(),u("div",{key:D.weekNumber,class:X(["week-picker-item",{active:D.weekNumber===g.value?.weekNumber}]),"data-week-number":D.weekNumber,onClick:B=>T(D)},[s("div",Vu,[s("div",zu,"–ù–µ–¥–µ–ª—è "+m(D.weekNumber),1),s("div",Gu,m(p(D.startUtc))+" ‚Äî "+m(p(D.endUtc)),1)])],10,ju))),128))])],544),s("div",Ku,[s("button",{class:"btn-cancel",onClick:k},"–û—Ç–º–µ–Ω–∞"),s("button",{class:"btn-apply",onClick:C,disabled:!g.value},"–ü—Ä–∏–º–µ–Ω–∏—Ç—å",8,qu)])])):A("",!0)]),_:1})],512))}},Xu=ce(Yu,[["__scopeId","data-v-daae25a6"]]),Ju={class:"filters-panel"},Zu={class:"filters-header"},Qu=["disabled"],eg={class:"filters-content"},tg={key:0,class:"filter-section"},ag={class:"section-content"},sg={class:"filter-section"},og={class:"section-content"},ng={class:"filter-section"},rg={key:0,class:"section-content"},lg={class:"section-content"},ig={key:0,class:"period-mode-group"},cg=["value"],dg=["disabled"],ug=["disabled"],gg={key:0,class:"period-mode-hint"},mg={key:1,class:"period-mode-hint"},hg=["value"],fg={key:0,class:"custom-date-range"},vg={class:"date-range-inputs"},pg={class:"date-input-group"},yg=["value","max"],kg={class:"date-input-group"},bg=["value","min","max"],_g={key:0,class:"filter-error"},wg={key:1,class:"filter-hint"},Cg={__name:"FiltersPanel",props:{stages:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},employees:{type:Array,default:()=>["all"]},dateRange:{type:String,default:"last-week"},customDateRange:{type:Object,default:()=>({startDate:null,endDate:null})},hasActiveFilters:{type:Boolean,default:!1},hideStages:{type:Boolean,default:!1},weekPickerMode:{type:Boolean,default:!1},selectedWeek:{type:Object,default:null},weeksCount:{type:Number,default:52},showPeriodMode:{type:Boolean,default:!1},periodMode:{type:String,default:"weeks",validator:o=>["weeks","months"].includes(o)}},emits:["update:stages","update:employees","update:dateRange","update:customDateRange","update:selectedWeek","update:periodMode","reset","apply"],setup(o,{emit:e}){const a=o,t=e,l=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"var(--b24-primary, #007bff)"},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"var(--b24-warning, #ffc107)"},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"var(--b24-success, #28a745)"}],r=I(null),n=$(()=>{const C=new Date;return C.setFullYear(C.getFullYear()-1),C.toISOString().split("T")[0]}),i=$(()=>new Date().toISOString().split("T")[0]);function d(C){t("update:stages",C),t("apply")}function g(C,k){t("apply")}function v(C){t("update:employees",C),t("apply")}function w(C){t("update:dateRange",C),r.value=null,t("apply")}function f(C,k){const S={...a.customDateRange};if(S[C]=k,S.startDate&&S.endDate){const x=new Date(S.startDate),U=new Date(S.endDate);if(x>U){r.value="–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω–µ—á–Ω–æ–π";return}if(Math.ceil((U-x)/(1e3*60*60*24))>365){r.value="–ü–µ—Ä–∏–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 365 –¥–Ω–µ–π";return}}r.value=null,t("update:customDateRange",S),t("apply")}function p(C){t("update:selectedWeek",C),t("apply")}function y(C){if(!["weeks","months"].includes(C)){console.warn("[FiltersPanel] Invalid periodMode:",C);return}C!==a.periodMode&&(t("update:periodMode",C),t("apply"))}function T(){r.value=null,t("reset")}return(C,k)=>(c(),u("div",Ju,[s("div",Zu,[k[4]||(k[4]=s("h2",null,"–§–∏–ª—å—Ç—Ä—ã",-1)),s("button",{onClick:T,class:"btn-reset-filters",disabled:!o.hasActiveFilters}," –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã ",8,Qu)]),s("div",eg,[o.hideStages?A("",!0):(c(),u("div",tg,[k[5]||(k[5]=s("h3",{class:"section-title"},[s("span",{class:"section-icon"},"üìä"),ge(" –≠—Ç–∞–ø—ã ")],-1)),s("div",ag,[ne(Uu,{selected:o.stages,stages:l,placeholder:"–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø—ã","onUpdate:selected":d,onChange:g},null,8,["selected"])])])),s("div",sg,[k[6]||(k[6]=s("h3",{class:"section-title"},[s("span",{class:"section-icon"},"üë•"),ge(" –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ")],-1)),s("div",og,[ne(Mu,{selected:o.employees,"onUpdate:selected":v},null,8,["selected"])])]),s("div",ng,[o.weekPickerMode?(c(),u("div",rg,[ne(Xu,{selectedWeek:o.selectedWeek,weeksCount:o.weeksCount,"onUpdate:selectedWeek":p,onChange:p},null,8,["selectedWeek","weeksCount"])])):(c(),u(ee,{key:1},[k[11]||(k[11]=s("h3",{class:"section-title"},[s("span",{class:"section-icon"},"üìÖ"),ge(" –ü–µ—Ä–∏–æ–¥ ")],-1)),s("div",lg,[o.showPeriodMode?(c(),u("div",ig,[k[7]||(k[7]=s("label",{class:"period-mode-label"},"–†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:",-1)),s("select",{value:o.periodMode,onChange:k[0]||(k[0]=S=>y(S.target.value)),class:X(["period-mode-select",{"period-mode-select--current-weeks":o.periodMode==="weeks","period-mode-select--current-months":o.periodMode==="months"}])},[s("option",{value:"weeks",disabled:o.periodMode==="weeks"}," 4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ ",8,dg),s("option",{value:"months",disabled:o.periodMode==="months"}," 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞ ",8,ug)],42,cg),o.periodMode==="weeks"?(c(),u("small",gg," –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: 4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ ")):o.periodMode==="months"?(c(),u("small",mg," –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞ ")):A("",!0)])):A("",!0),o.showPeriodMode?A("",!0):(c(),u(ee,{key:1},[s("select",{value:o.dateRange,onChange:k[1]||(k[1]=S=>w(S.target.value)),class:"date-range-select"},[...k[8]||(k[8]=[s("option",{value:"last-week"},"–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–¥–µ–ª—è",-1),s("option",{value:"last-2-weeks"},"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏",-1),s("option",{value:"last-month"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü",-1),s("option",{value:"custom"},"–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])],40,hg),o.dateRange==="custom"?(c(),u("div",fg,[s("div",vg,[s("div",pg,[k[9]||(k[9]=s("label",null,"–°:",-1)),s("input",{type:"date",value:o.customDateRange.startDate,onChange:k[2]||(k[2]=S=>f("startDate",S.target.value)),max:o.customDateRange.endDate||i.value,class:"date-input"},null,40,yg)]),s("div",kg,[k[10]||(k[10]=s("label",null,"–ü–æ:",-1)),s("input",{type:"date",value:o.customDateRange.endDate,onChange:k[3]||(k[3]=S=>f("endDate",S.target.value)),min:o.customDateRange.startDate||n.value,max:i.value,class:"date-input"},null,40,bg)])]),r.value?(c(),u("small",_g,m(r.value),1)):(c(),u("small",wg," –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –∏ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö "))])):A("",!0)],64))])],64))])])]))}},ja=ce(Cg,[["__scopeId","data-v-5970a362"]]);function Tg(){const o=I(!1),e=I(null),a=I(null),t=I(0),l=mt(),r=async(C=!0,k=null)=>{o.value=!0,e.value=null,t.value=0;try{const S=await Ua.getSectorDataForSnapshot({useCache:C,onProgress:x=>{x&&typeof x.progress=="number"&&(t.value=x.progress),k&&k(x)},normalize:!0});return a.value=S,S}catch(S){throw e.value=S.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞",l.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞: "+e.value),S}finally{o.value=!1,t.value=100}},n=async(C,k={})=>{if(!a.value){const S="–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ loadSectorDataForSnapshot()";throw e.value=S,l.error(S),new Error(S)}o.value=!0,e.value=null;try{if(!["week_start","week_end","manual","current"].includes(C))throw new Error(`–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø —Å–ª–µ–ø–∫–∞: ${C}. –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: week_start, week_end, manual, current`);const S=await pt.createSnapshot(a.value,C,k);return l.success("–°–ª–µ–ø–æ–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"),S}catch(S){throw e.value=S.message||"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞",l.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞: "+e.value),S}finally{o.value=!1}},i=()=>{o.value=!1,e.value=null,a.value=null,t.value=0},d=$(()=>a.value!==null&&a.value!==void 0),g=I({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),v=$(()=>{const C=new Date;let k,S;switch(g.value.dateRange){case"last-week":k=new Date(C),k.setDate(C.getDate()-7),S=C;break;case"last-2-weeks":k=new Date(C),k.setDate(C.getDate()-14),S=C;break;case"last-month":k=new Date(C),k.setMonth(C.getMonth()-1),S=C;break;case"custom":k=g.value.customDateRange.startDate?new Date(g.value.customDateRange.startDate):null,S=g.value.customDateRange.endDate?new Date(g.value.customDateRange.endDate):null;break;default:k=new Date(C),k.setDate(C.getDate()-7),S=C}return{startDate:k?k.toISOString().split("T")[0]:null,endDate:S?S.toISOString().split("T")[0]:null}}),w=()=>{p()},f=()=>{g.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},p()},p=()=>{try{localStorage.setItem("graphStateFilters",JSON.stringify(g.value))}catch(C){console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ localStorage:",C)}},y=()=>{try{const C=localStorage.getItem("graphStateFilters");if(C){const k=JSON.parse(C);k&&typeof k=="object"&&(g.value={stages:k.stages||{formed:!0,review:!0,execution:!0},employees:k.employees||["all"],dateRange:k.dateRange||"last-week",customDateRange:k.customDateRange||{startDate:null,endDate:null}})}}catch(C){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ localStorage:",C)}},T=$(()=>{const C=Object.values(g.value.stages).some(x=>!x),k=!g.value.employees.includes("all"),S=g.value.dateRange!=="last-week";return C||k||S});return{isLoading:o,error:e,currentSectorData:a,loadingProgress:t,hasSectorData:d,filters:g,selectedPeriod:v,hasActiveFilters:T,loadSectorDataForSnapshot:r,createSnapshot:n,resetState:i,applyFilters:w,resetFilters:f,saveFiltersToLocalStorage:p,loadFiltersFromLocalStorage:y}}const Sg={class:"graph-state-dashboard"},Dg={key:1,class:"error-message-container"},Eg={class:"error-message"},Ag={class:"error-text"},$g={key:0,class:"error-details"},Ig={class:"dashboard-header"},Mg={class:"header-content"},Ng={class:"breadcrumbs-row"},xg=["aria-disabled","data-fallback","disabled"],Lg={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Pg={class:"header-actions"},Og=["disabled"],Bg={key:0},Rg={key:1},Wg={key:3,class:"dashboard-content"},Ug={class:"chart-container"},Fg="–ù–∞–∑–∞–¥",Hg={__name:"GraphStateDashboard",setup(o){const e=(se,me)=>typeof window>"u"?me:getComputedStyle(document.documentElement).getPropertyValue(se).trim()||me,a=mt(),t=Xe(),l={name:"dashboard-sector-1c"},{filters:r,selectedPeriod:n,hasActiveFilters:i,applyFilters:d,resetFilters:g,loadFiltersFromLocalStorage:v}=Tg(),w=I(null),f=I(!0),p=I(!1),y=I("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."),T=I(null),C=I(!1),k=I(!1),S=I(typeof window<"u"?window.innerWidth:1024),x=I(null),U=I(!1),L=$(()=>S.value<768);$(()=>S.value>=768&&S.value<1024),$(()=>S.value>=1024);const E=$(()=>typeof window>"u"?!1:window.history.length>1);$(()=>{const se=new Date;return se.setFullYear(se.getFullYear()-1),se.toISOString().split("T")[0]}),$(()=>new Date().toISOString().split("T")[0]);function D(se){r.value.stages=se}function N(se){r.value.employees=se}function B(se){r.value.dateRange=se}function W(se){r.value.customDateRange=se}function G(){d()}function q(){g(),x.value=null,G(),a.info("–§–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã")}function oe(se){a.success("–°–ª–µ–ø–æ–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω")}function Y(se){p.value=!1,y.value="",console.log("–î–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:",se)}function H(se){p.value=!1,Z({message:se||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞",details:null,type:"error"})}function Z(se){T.value={message:se.message||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞",details:se.details||null,type:se.type||"error",timestamp:new Date},console.error("Dashboard error:",T.value),a.error(T.value.message)}function fe(){T.value=null}function P(){T.value=null,p.value=!0,y.value="–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."}async function h(){if(typeof window>"u"||!window.jsPDF||!window.html2canvas){a.warning("–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ jspdf –∏ html2canvas."),console.warn("–î–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: npm install jspdf html2canvas");return}C.value=!0;try{const se=document.querySelector(".chart-container");if(!se)throw new Error("–ì—Ä–∞—Ñ–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω");const me=window.html2canvas,Se=await me(se,{scale:2,useCORS:!0,logging:!1,backgroundColor:e("--b24-bg-white","#ffffff")}),Ie=window.jsPDF,xe=new Ie("landscape","mm","a4"),Fe=297,z=Se.height*Fe/Se.width;xe.setFontSize(18),xe.text("–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",148.5,15,{align:"center"});const M=new Date().toLocaleDateString("ru-RU");xe.setFontSize(10);const b=n.value.startDate&&n.value.endDate?`–ü–µ—Ä–∏–æ–¥: ${n.value.startDate} - ${n.value.endDate}`:"–ü–µ—Ä–∏–æ–¥: –Ω–µ —É–∫–∞–∑–∞–Ω";xe.text(b,148.5,25,{align:"center"}),xe.text(`–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç ${M}`,148.5,30,{align:"center"}),xe.addImage(Se.toDataURL("image/png"),"PNG",10,35,Fe-20,z-20),xe.setProperties({title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",subject:`–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç ${M}`,author:"Bitrix24 Dashboard"});const O=`graph-state-${M.replace(/\//g,"-")}.pdf`;xe.save(O),a.success("–ì—Ä–∞—Ñ–∏–∫ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ PDF")}catch(se){console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF:",se),Z({message:"–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF: "+(se.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"),details:se.stack,type:"error"})}finally{C.value=!1}}function _(se){if(se?.preventDefault?.(),!U.value){U.value=!0;try{if(E.value){t.back();return}console.warn("GraphStateDashboard: fallback navigation to dashboard-sector-1c"),t.push(l)}finally{U.value=!1}}}function R(){t.push("/")}function re(){typeof window<"u"&&(S.value=window.innerWidth)}async function ie(){try{const se=await rt.checkAccess();se.allowed&&(w.value=se.user)}catch(se){console.error("Error loading user:",se)}}return $e(()=>{v(),ie(),typeof window<"u"&&(S.value=window.innerWidth,window.addEventListener("resize",re))}),at(()=>{typeof window<"u"&&window.removeEventListener("resize",re)}),(se,me)=>{const Se=be("router-link");return c(),u("div",Sg,[p.value?(c(),he(_a,{key:0,message:y.value},null,8,["message"])):A("",!0),T.value?(c(),u("div",Dg,[s("div",Eg,[s("div",{class:"error-header"},[me[1]||(me[1]=s("span",{class:"error-icon"},"‚ùå",-1)),me[2]||(me[2]=s("h3",null,"–û—à–∏–±–∫–∞",-1)),s("button",{onClick:fe,class:"error-close","aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"‚úï")]),s("p",Ag,m(T.value.message),1),T.value.details?(c(),u("div",$g,[s("details",null,[me[3]||(me[3]=s("summary",null,"–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏",-1)),s("pre",null,m(T.value.details),1)])])):A("",!0),s("div",{class:"error-actions"},[s("button",{onClick:P,class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])])])):A("",!0),s("div",Ig,[s("div",Mg,[s("div",Ng,[s("button",{class:"btn-home-link",type:"button",onClick:R,title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),me[9]||(me[9]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),s("button",{class:"btn-back-link",type:"button",onClick:_,"aria-label":Fg,"aria-disabled":!E.value,"data-fallback":!E.value,disabled:U.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,xg),s("nav",Lg,[ne(Se,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ye(()=>[...me[4]||(me[4]=[ge(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),me[6]||(me[6]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),me[7]||(me[7]=s("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",-1)),me[8]||(me[8]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ne(Se,{to:{name:"dashboard-graph-admission-closure"},class:"breadcrumb-link"},{default:ye(()=>[...me[5]||(me[5]=[ge(" –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π ",-1)])]),_:1})])]),me[10]||(me[10]=s("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),me[11]||(me[11]=s("p",{class:"dashboard-subtitle"}," –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏ ",-1))]),s("div",Pg,[s("button",{onClick:h,class:"btn-export-pdf",disabled:C.value||p.value,title:"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –≤ PDF"},[C.value?(c(),u("span",Rg,"‚è≥ –≠–∫—Å–ø–æ—Ä—Ç...")):(c(),u("span",Bg,"üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF"))],8,Og),ne(mu,{user:w.value,onSnapshotCreated:oe},null,8,["user"])])]),L.value?(c(),u("button",{key:2,class:"mobile-filters-toggle",onClick:me[0]||(me[0]=Ie=>k.value=!k.value)},[me[12]||(me[12]=s("span",null,"–§–∏–ª—å—Ç—Ä—ã",-1)),s("span",{class:X(["toggle-icon",{open:k.value}])},"‚ñº",2)])):A("",!0),s("div",{class:X({"mobile-open":k.value&&L.value,"mobile-closed":!k.value&&L.value})},[ne(ja,{stages:We(r).stages,employees:We(r).employees,dateRange:We(r).dateRange,customDateRange:We(r).customDateRange,hasActiveFilters:We(i),"onUpdate:stages":D,"onUpdate:employees":N,"onUpdate:dateRange":B,"onUpdate:customDateRange":W,onReset:q,onApply:G},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])],2),!p.value&&!T.value?(c(),u("div",Wg,[s("div",Ug,[ne(zd,{period:We(n),"show-current-state":f.value,onDataLoaded:Y,onError:H},null,8,["period","show-current-state"])])])):A("",!0)])}}},Ns=ce(Hg,[["__scopeId","data-v-831b0079"]]),jg=Object.freeze(Object.defineProperty({__proto__:null,default:Ns},Symbol.toStringTag,{value:"Module"})),Vg={key:0,class:"modal-overlay"},zg={class:"modal-container",role:"dialog","aria-labelledby":"modal-title","aria-modal":"true"},Gg={class:"modal-body"},Kg={class:"mode-description"},qg={__name:"PeriodModeInfoModal",props:{isVisible:{type:Boolean,required:!0},currentMode:{type:String,default:"weeks",validator:o=>["weeks","months"].includes(o)}},emits:["close","start-loading","select-mode"],setup(o,{emit:e}){const a=o,t=e,l=I(a.currentMode);function r(d){if(!["weeks","months"].includes(d)){console.warn("[PeriodModeInfoModal] Invalid mode:",d);return}l.value=d,console.log("[DEBUG Modal] handleModeSelect: mode =",d),console.log("[DEBUG Modal] Emitting select-mode event"),t("select-mode",d),console.log("[DEBUG Modal] Emitting close event"),t("close"),console.log("[DEBUG Modal] Scheduling start-loading event in 100ms"),setTimeout(()=>{console.log("[DEBUG Modal] Emitting start-loading event"),t("start-loading")},100)}function n(){console.log("[DEBUG Modal] handleClose called, selectedMode =",l.value),console.log("[DEBUG Modal] Emitting select-mode event with",l.value),t("select-mode",l.value),console.log("[DEBUG Modal] Emitting close event"),t("close")}function i(d){d.key==="Escape"&&a.isVisible&&n()}return Ne(()=>a.currentMode,d=>{["weeks","months"].includes(d)&&(l.value=d)}),$e(()=>{a.isVisible&&document.addEventListener("keydown",i)}),at(()=>{document.removeEventListener("keydown",i)}),Ne(()=>a.isVisible,d=>{d?(document.addEventListener("keydown",i),l.value=a.currentMode):document.removeEventListener("keydown",i)}),(d,g)=>(c(),he(It,{to:"body"},[ne(Ae,{name:"modal-fade"},{default:ye(()=>[o.isVisible?(c(),u("div",Vg,[s("div",zg,[s("div",{class:"modal-header"},[g[2]||(g[2]=s("h2",{id:"modal-title",class:"modal-title"},[s("span",{class:"modal-icon"},"‚ÑπÔ∏è"),ge(" –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ")],-1)),s("button",{class:"modal-close-btn",onClick:n,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å",type:"button"}," √ó ")]),s("div",Gg,[g[5]||(g[5]=s("p",{class:"modal-description"}," –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π: ",-1)),s("div",Kg,[s("button",{class:X(["mode-item mode-item--clickable",{"mode-item--selected":l.value==="weeks"}]),onClick:g[0]||(g[0]=v=>r("weeks")),type:"button"},[...g[3]||(g[3]=[s("div",{class:"mode-header"},[s("span",{class:"mode-icon"},"üìÖ"),s("h3",{class:"mode-title"},"4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏")],-1),s("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 –Ω–µ–¥–µ–ª–∏ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –Ω–µ–¥–µ–ª—è–º. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç–∏–∫–µ—Ç–æ–≤. ",-1)])],2),s("button",{class:X(["mode-item mode-item--clickable",{"mode-item--selected":l.value==="months"}]),onClick:g[1]||(g[1]=v=>r("months")),type:"button"},[...g[4]||(g[4]=[s("div",{class:"mode-header"},[s("span",{class:"mode-icon"},"üìä"),s("h3",{class:"mode-title"},"3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞")],-1),s("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—Ü–µ–≤. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤. ",-1)])],2)])])])])):A("",!0)]),_:1})]))}},Yg=ce(qg,[["__scopeId","data-v-4a42a9a6"]]),Xg={class:"ac-chart"},Jg={class:"ac-chart__header"},Zg={class:"ac-chart__subtitle"},Qg={class:"ac-chart__controls"},em={class:"chart-type-selector"},tm=["onClick"],am={class:"chart-type-icon"},sm={class:"chart-type-label"},om={class:"ac-chart__summary"},nm={class:"summary-week-block summary-week-block--current"},rm={class:"summary-week-block__title"},lm={class:"summary-week-block__title-week"},im={key:0,class:"summary-week-block__title-dates"},cm={class:"summary-week-block__cards"},dm={class:"summary-card__value-wrapper"},um={class:"summary-card__value"},gm=["title"],mm={class:"percentage-indicator__arrow"},hm={class:"percentage-indicator__value"},fm={class:"percentage-indicator__label"},vm={class:"summary-card__value-wrapper"},pm={class:"summary-card__value-main"},ym=["title"],km={class:"percentage-indicator__arrow"},bm={class:"percentage-indicator__value"},_m={class:"percentage-indicator__label"},wm={class:"summary-card__breakdown"},Cm={class:"breakdown-item breakdown-item--this-week"},Tm={class:"breakdown-item__value"},Sm={class:"breakdown-item breakdown-item--other-week"},Dm={class:"breakdown-item__value"},Em={class:"summary-card__value-wrapper"},Am={class:"summary-card__value-main"},$m=["title"],Im={class:"percentage-indicator__arrow"},Mm={class:"percentage-indicator__value"},Nm={class:"percentage-indicator__label"},xm={class:"summary-card__breakdown"},Lm={class:"breakdown-item breakdown-item--this-week"},Pm={class:"breakdown-item__value"},Om={class:"breakdown-item breakdown-item--previous-week"},Bm={class:"breakdown-item__value"},Rm={class:"breakdown-item breakdown-item--older"},Wm={class:"breakdown-item__value"},Um={class:"summary-card summary-card--stages"},Fm={class:"summary-card__tags"},Hm={key:0,class:"stage-tag stage-tag--empty"},jm={key:0,class:"summary-week-divider"},Vm={key:1,class:"summary-week-block summary-week-block--previous"},zm={class:"summary-week-block__title"},Gm={class:"summary-week-block__title-week"},Km={key:0,class:"summary-week-block__title-dates"},qm={class:"summary-week-block__cards"},Ym={class:"summary-card__value-wrapper"},Xm={class:"summary-card__values-comparison"},Jm={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},Zm={class:"summary-card__value"},Qm={class:"value-label"},eh={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},th={class:"summary-card__value summary-card__value--current-week"},ah={class:"value-label"},sh=["title"],oh={class:"percentage-indicator__arrow"},nh={class:"percentage-indicator__value"},rh={class:"percentage-indicator__label"},lh={class:"summary-card__value-wrapper"},ih={class:"summary-card__values-comparison"},ch={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},dh={class:"summary-card__value-main"},uh={class:"value-label"},gh={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},mh={class:"summary-card__value-main summary-card__value-main--current-week"},hh={class:"value-label"},fh=["title"],vh={class:"percentage-indicator__arrow"},ph={class:"percentage-indicator__value"},yh={class:"percentage-indicator__label"},kh={class:"summary-card__breakdown"},bh={class:"breakdown-item breakdown-item--this-week"},_h={class:"breakdown-item__value"},wh={class:"breakdown-item breakdown-item--other-week"},Ch={class:"breakdown-item__value"},Th={class:"summary-card__value-wrapper"},Sh={class:"summary-card__values-comparison"},Dh={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},Eh={class:"summary-card__value-main"},Ah={class:"value-label"},$h={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},Ih={class:"summary-card__value-main summary-card__value-main--current-week"},Mh={class:"value-label"},Nh=["title"],xh={class:"percentage-indicator__arrow"},Lh={class:"percentage-indicator__value"},Ph={class:"percentage-indicator__label"},Oh={class:"summary-card__breakdown"},Bh={class:"breakdown-item breakdown-item--this-week"},Rh={class:"breakdown-item__value"},Wh={class:"breakdown-item breakdown-item--previous-week"},Uh={class:"breakdown-item__value"},Fh={class:"breakdown-item breakdown-item--older"},Hh={class:"breakdown-item__value"},jh={class:"summary-card summary-card--stages summary-card--previous"},Vh={class:"summary-card__tags"},zh={key:0,class:"stage-tag stage-tag--empty"},Gh={class:"ac-chart__body"},Kh={key:0,class:"split-charts-container"},qh={class:"chart-wrapper chart-wrapper--left"},Yh={class:"chart-canvas-wrapper"},Xh={class:"chart-wrapper chart-wrapper--right"},Jh={class:"chart-canvas-wrapper"},Zh={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedPreviousWeek:0,carryoverTicketsCreatedOlder:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedPreviousWeek:[0],carryoverCreatedOlder:[0],carryoverCreatedOtherWeek:[0]},stagesByWeek:[],stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(o,{emit:e}){Je.register(ps);const a=o,t=e,l=$(()=>{const h=a.meta?.weeks||[];return h.length>=2?h[h.length-2]:null}),r=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],n=I("line"),i={color:"#111827",font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:h=>h?.dataset?.borderColor||"#111827",borderWidth:1,borderRadius:4,padding:4,offset:8,formatter:h=>h==null||isNaN(h)?"":k(h),display:h=>{if(h?.chart?.config?.type!=="line")return!1;const R=h?.dataset?.data?.[h.dataIndex];return R!=null&&!isNaN(R)&&isFinite(R)}};$(()=>a.meta?.weekNumber??"‚Äî");const d=()=>{const h=a.meta?.weeks||[];return h.length>0?h.map(_=>`–ù–µ–¥–µ–ª—è ${_.weekNumber}`):[a.meta?.weekNumber?`–ù–µ–¥–µ–ª—è ${a.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"]};function g(h,_,R,re=.3,ie=0){if(!_)return((Ie,xe)=>{const Fe=parseInt(Ie.slice(1,3),16),z=parseInt(Ie.slice(3,5),16),M=parseInt(Ie.slice(5,7),16);return`rgba(${Fe}, ${z}, ${M}, ${xe})`})(R,re);const se=(Se,Ie)=>{const xe=parseInt(Se.slice(1,3),16),Fe=parseInt(Se.slice(3,5),16),z=parseInt(Se.slice(5,7),16);return`rgba(${xe}, ${Fe}, ${z}, ${Ie})`},me=h.createLinearGradient(0,_.bottom,0,_.top);return me.addColorStop(0,se(R,re)),me.addColorStop(1,se(R,ie)),me}const v=$(()=>{const h=d(),_=Array.isArray(a.data.series?.new)&&a.data.series.new.length>0?a.data.series.new:[a.data.newTickets??0],R=Array.isArray(a.data.series?.closed)&&a.data.series.closed.length>0?a.data.series.closed:[a.data.closedTickets??0],re=Array.isArray(a.data.series?.closedCreatedThisWeek)&&a.data.series.closedCreatedThisWeek.length>0?a.data.series.closedCreatedThisWeek:[a.data.closedTicketsCreatedThisWeek??0],ie=Array.isArray(a.data.series?.closedCreatedOtherWeek)&&a.data.series.closedCreatedOtherWeek.length>0?a.data.series.closedCreatedOtherWeek:[a.data.closedTicketsCreatedOtherWeek??0];return{labels:h,datasets:[{label:"–ù–æ–≤—ã–µ",data:_,backgroundColor:se=>{const me=se.chart,{ctx:Se,chartArea:Ie}=me;return g(Se,Ie,J.primary)},borderColor:J.primary,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.primary,pointBackgroundColor:J.primary,datalabels:{...i,anchor:"end",align:"top",offset:10,color:J.primary,borderColor:J.primary}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:R,backgroundColor:se=>{const me=se.chart,{ctx:Se,chartArea:Ie}=me;return g(Se,Ie,J.success)},borderColor:J.success,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.success,pointBackgroundColor:J.success,datalabels:{...i,anchor:"start",align:"bottom",offset:10,color:J.success,borderColor:J.success}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:re,backgroundColor:J.successLight,borderColor:J.successLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:J.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.successLight,pointBackgroundColor:J.successLight,datalabels:{...i,anchor:"end",align:"bottom",offset:8,color:J.successLight,borderColor:J.successLight}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:ie,backgroundColor:J.warning,borderColor:J.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:J.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.warning,pointBackgroundColor:J.warning,datalabels:{...i,anchor:"end",align:"bottom",offset:8,color:J.warning,borderColor:J.warning}}]}}),w=$(()=>{const h=d(),_=Array.isArray(a.data.series?.carryover)&&a.data.series.carryover.length>0?a.data.series.carryover:[a.data.carryoverTickets??0],R=Array.isArray(a.data.series?.carryoverCreatedThisWeek)&&a.data.series.carryoverCreatedThisWeek.length>0?a.data.series.carryoverCreatedThisWeek:[a.data.carryoverTicketsCreatedThisWeek??0],re=Array.isArray(a.data.series?.carryoverCreatedPreviousWeek)&&a.data.series.carryoverCreatedPreviousWeek.length>0?a.data.series.carryoverCreatedPreviousWeek:[a.data.carryoverTicketsCreatedPreviousWeek??0],ie=Array.isArray(a.data.series?.carryoverCreatedOlder)&&a.data.series.carryoverCreatedOlder.length>0?a.data.series.carryoverCreatedOlder:[a.data.carryoverTicketsCreatedOlder??0];return Array.isArray(a.data.series?.carryoverCreatedOtherWeek)&&a.data.series.carryoverCreatedOtherWeek.length>0?a.data.series.carryoverCreatedOtherWeek:a.data.carryoverTicketsCreatedOtherWeek,{labels:h,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:_,backgroundColor:se=>{const me=se.chart,{ctx:Se,chartArea:Ie}=me;return g(Se,Ie,J.carryover)},borderColor:J.carryover,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryover,pointBackgroundColor:J.carryover,datalabels:{...i,anchor:"end",align:"top",offset:4,color:J.carryover,borderColor:J.carryover}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:R,backgroundColor:J.carryoverLight,borderColor:J.carryoverLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:J.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryoverLight,pointBackgroundColor:J.carryoverLight,datalabels:{...i,anchor:"end",align:"top",offset:6,color:J.carryoverLight,borderColor:J.carryoverLight}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π)",data:re,backgroundColor:J.warning,borderColor:J.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:J.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.warning,pointBackgroundColor:J.warning,datalabels:{...i,anchor:"end",align:"top",offset:6,color:J.warning,borderColor:J.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –Ω–µ–¥–µ–ª—è–º–∏)",data:ie,backgroundColor:J.carryoverDark,borderColor:J.carryoverDark,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:J.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryoverDark,pointBackgroundColor:J.carryoverDark,datalabels:{...i,anchor:"end",align:"top",offset:6,color:J.carryoverDark,borderColor:J.carryoverDark}}]}}),f=$(()=>{const h=a.meta?.weeks||[],_=h.length>0?h.map(Fe=>`–ù–µ–¥–µ–ª—è ${Fe.weekNumber}`):[a.meta?.weekNumber?`–ù–µ–¥–µ–ª—è ${a.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"],R=Array.isArray(a.data.series?.new)&&a.data.series.new.length>0?a.data.series.new:[a.data.newTickets??0],re=Array.isArray(a.data.series?.closed)&&a.data.series.closed.length>0?a.data.series.closed:[a.data.closedTickets??0],ie=Array.isArray(a.data.series?.closedCreatedThisWeek)&&a.data.series.closedCreatedThisWeek.length>0?a.data.series.closedCreatedThisWeek:[a.data.closedTicketsCreatedThisWeek??0],se=Array.isArray(a.data.series?.closedCreatedOtherWeek)&&a.data.series.closedCreatedOtherWeek.length>0?a.data.series.closedCreatedOtherWeek:[a.data.closedTicketsCreatedOtherWeek??0],me=Array.isArray(a.data.series?.carryover)&&a.data.series.carryover.length>0?a.data.series.carryover:[a.data.carryoverTickets??0],Se=Array.isArray(a.data.series?.carryoverCreatedThisWeek)&&a.data.series.carryoverCreatedThisWeek.length>0?a.data.series.carryoverCreatedThisWeek:[a.data.carryoverTicketsCreatedThisWeek??0],Ie=Array.isArray(a.data.series?.carryoverCreatedPreviousWeek)&&a.data.series.carryoverCreatedPreviousWeek.length>0?a.data.series.carryoverCreatedPreviousWeek:[a.data.carryoverTicketsCreatedPreviousWeek??0],xe=Array.isArray(a.data.series?.carryoverCreatedOlder)&&a.data.series.carryoverCreatedOlder.length>0?a.data.series.carryoverCreatedOlder:[a.data.carryoverTicketsCreatedOlder??0];return Array.isArray(a.data.series?.carryoverCreatedOtherWeek)&&a.data.series.carryoverCreatedOtherWeek.length>0?a.data.series.carryoverCreatedOtherWeek:a.data.carryoverTicketsCreatedOtherWeek,{labels:_,datasets:[{label:"–ù–æ–≤—ã–µ",data:R,backgroundColor:J.primary,borderColor:J.primary,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.primary,pointBackgroundColor:J.primary,datalabels:{...i,anchor:"end",align:"top",offset:10,color:J.primary,borderColor:J.primary}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:re,backgroundColor:J.success,borderColor:J.success,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.success,pointBackgroundColor:J.success,datalabels:{...i,anchor:"start",align:"bottom",offset:10,color:J.success,borderColor:J.success}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:ie,backgroundColor:J.successLight,borderColor:J.successLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:J.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.successLight,pointBackgroundColor:J.successLight,datalabels:{...i,anchor:"end",align:"bottom",offset:8,color:J.successLight,borderColor:J.successLight}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:se,backgroundColor:J.warning,borderColor:J.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:J.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.warning,pointBackgroundColor:J.warning,datalabels:{...i,anchor:"end",align:"bottom",offset:8,color:J.warning,borderColor:J.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:me,backgroundColor:J.carryover,borderColor:J.carryover,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:J.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryover,pointBackgroundColor:J.carryover,datalabels:{...i,anchor:"end",align:"top",offset:4,color:J.carryover,borderColor:J.carryover}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:Se,backgroundColor:J.carryoverLight,borderColor:J.carryoverLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:J.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryoverLight,pointBackgroundColor:J.carryoverLight,datalabels:{...i,anchor:"end",align:"top",offset:6,color:J.carryoverLight,borderColor:J.carryoverLight}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π)",data:Ie,backgroundColor:J.warning,borderColor:J.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:J.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.warning,pointBackgroundColor:J.warning,datalabels:{...i,anchor:"end",align:"top",offset:6,color:J.warning,borderColor:J.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –Ω–µ–¥–µ–ª—è–º–∏)",data:xe,backgroundColor:J.carryoverDark,borderColor:J.carryoverDark,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:J.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:J.carryoverDark,pointBackgroundColor:J.carryoverDark,datalabels:{...i,anchor:"end",align:"top",offset:6,color:J.carryoverDark,borderColor:J.carryoverDark}}]}}),p=$(()=>({labels:["–ù–æ–≤—ã–µ","–ó–∞–∫—Ä—ã—Ç—ã–µ","–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ"],datasets:[{data:[a.data.newTickets??0,a.data.closedTickets??0,a.data.carryoverTickets??0],backgroundColor:[J.primary,J.success,J.carryover],borderWidth:1}]})),y=$(()=>{switch(n.value){case"line":return yt;case"bar":return vs;case"doughnut":return fs;default:return yt}}),T=$(()=>n.value==="doughnut"?p.value:f.value),C=h=>{if(!h)return"‚Äî";try{return new Date(h).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return h}};function k(h){return h==null||isNaN(h)?"0":h>=1e3?h.toLocaleString("ru-RU"):h.toString()}function S(h){const _=h%10,R=h%100;return R>=11&&R<=14?"—Ç–∏–∫–µ—Ç–æ–≤":_===1?"—Ç–∏–∫–µ—Ç":_>=2&&_<=4?"—Ç–∏–∫–µ—Ç–∞":"—Ç–∏–∫–µ—Ç–æ–≤"}const x=$(()=>({responsive:!0,maintainAspectRatio:!1,resizeDelay:0,animation:{duration:800,easing:"easeOutQuart"},interaction:{intersect:!1,mode:"index"},plugins:{datalabels:{...i,anchor:"end",align:"top"},tooltip:{enabled:!0,backgroundColor:"rgba(255, 255, 255, 0.98)",titleColor:"#111827",bodyColor:"#374151",borderColor:"#e5e7eb",borderWidth:1,cornerRadius:8,padding:16,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},displayColors:!0,boxPadding:6,usePointStyle:!0,animation:{duration:300,easing:"easeOutQuart"},callbacks:{title:h=>{if(!h||h.length===0)return"";const _=h[0]?.dataIndex,R=a.meta?.weeks||[];if(R.length>0&&_!==void 0&&R[_]){const me=R[_];return`–ù–µ–¥–µ–ª—è ${me.weekNumber} (${C(me.weekStartUtc)} ‚Äî ${C(me.weekEndUtc)})`}const re=a.meta?.weekNumber,ie=a.meta?.weekStartUtc,se=a.meta?.weekEndUtc;return re&&ie&&se?`–ù–µ–¥–µ–ª—è ${re} (${C(ie)} ‚Äî ${C(se)})`:h[0]?.label||""},label:h=>{const _=h.parsed.y,R=h.dataset.label||"";if(_==null||isNaN(_))return`${R}: 0 —Ç–∏–∫–µ—Ç–æ–≤`;const re=k(_),ie=S(_);return`${R}: ${re} ${ie}`}}},legend:{position:"bottom",labels:{font:{size:13,weight:"500"},padding:12,boxWidth:18,boxHeight:12,usePointStyle:!0,pointStyle:"circle",generateLabels:h=>Je.defaults.plugins.legend.labels.generateLabels(h).map((R,re)=>{const ie=h.data.datasets[re],se=h.getDatasetMeta(re),me=ie.borderDash&&Array.isArray(ie.borderDash)&&ie.borderDash.length>0||ie.borderWidth===2||ie.fill===!1;return se.hidden?(R.fontColor="#9ca3af",R.textDecoration="line-through",R.opacity=.5):me?R.fontColor="#6b7280":R.fontColor="#111827",R})},onClick:(h,_)=>{const R=_.datasetIndex;if(R==null){console.warn("[Legend] Invalid datasetIndex:",R);return}const re=h.chart;if(!re){console.warn("[Legend] Chart not found");return}const ie=re.getDatasetMeta(R);if(!ie){console.warn("[Legend] Dataset meta not found for index:",R);return}ie.hidden=!ie.hidden,re.update("active")},onHover:(h,_)=>{h.native&&h.native.target&&(h.native.target.style.cursor="pointer")},onLeave:(h,_)=>{h.native&&h.native.target&&(h.native.target.style.cursor="default")}}},scales:n.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10,color:"#374151",callback:h=>h==null||isNaN(h)?"0":k(h)},title:{display:!1},grid:{color:h=>{if(!h||!h.tick||h.tick.value===void 0)return"#e5e7eb";const _=h.tick.value;return isNaN(_)||!isFinite(_)?"#e5e7eb":_===0||_%5===0?"#d1d5db":"#e5e7eb"},lineWidth:h=>{if(!h||!h.tick||h.tick.value===void 0)return 1;const _=h.tick.value;return isNaN(_)||!isFinite(_)?1:_===0||_%5===0?1.5:1}}},x:{ticks:{maxRotation:45,minRotation:45,font:{size:14},padding:10,color:"#374151"},title:{display:!1},grid:{color:"#e5e7eb",lineWidth:1}}}})),U=$(()=>{if(a.data?.series){const h=a.data.series,_=Math.max((Array.isArray(h.new)?h.new.length:0)-1,(Array.isArray(h.closed)?h.closed.length:0)-1,(Array.isArray(h.closedCreatedThisWeek)?h.closedCreatedThisWeek.length:0)-1,(Array.isArray(h.closedCreatedOtherWeek)?h.closedCreatedOtherWeek.length:0)-1,(Array.isArray(h.carryover)?h.carryover.length:0)-1,(Array.isArray(h.carryoverCreatedThisWeek)?h.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(h.carryoverCreatedPreviousWeek)?h.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(h.carryoverCreatedOlder)?h.carryoverCreatedOlder.length:0)-1,(Array.isArray(h.carryoverCreatedOtherWeek)?h.carryoverCreatedOtherWeek.length:0)-1,-1);if(_>=0){const R={newTickets:Array.isArray(h.new)&&h.new[_]!==void 0?h.new[_]:0,closedTickets:Array.isArray(h.closed)&&h.closed[_]!==void 0?h.closed[_]:0,closedTicketsCreatedThisWeek:Array.isArray(h.closedCreatedThisWeek)&&h.closedCreatedThisWeek[_]!==void 0?h.closedCreatedThisWeek[_]:0,closedTicketsCreatedOtherWeek:Array.isArray(h.closedCreatedOtherWeek)&&h.closedCreatedOtherWeek[_]!==void 0?h.closedCreatedOtherWeek[_]:0,carryoverTickets:Array.isArray(h.carryover)&&h.carryover[_]!==void 0?h.carryover[_]:0,carryoverTicketsCreatedThisWeek:Array.isArray(h.carryoverCreatedThisWeek)&&h.carryoverCreatedThisWeek[_]!==void 0?h.carryoverCreatedThisWeek[_]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(h.carryoverCreatedPreviousWeek)&&h.carryoverCreatedPreviousWeek[_]!==void 0?h.carryoverCreatedPreviousWeek[_]:0,carryoverTicketsCreatedOlder:Array.isArray(h.carryoverCreatedOlder)&&h.carryoverCreatedOlder[_]!==void 0?h.carryoverCreatedOlder[_]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(h.carryoverCreatedOtherWeek)&&h.carryoverCreatedOtherWeek[_]!==void 0?h.carryoverCreatedOtherWeek[_]:0};if(R.carryoverTickets>0&&console.log("[DEBUG currentWeekData]",{total:R.carryoverTickets,thisWeek:R.carryoverTicketsCreatedThisWeek,previousWeek:R.carryoverTicketsCreatedPreviousWeek,older:R.carryoverTicketsCreatedOlder,otherWeek:R.carryoverTicketsCreatedOtherWeek,sum:R.carryoverTicketsCreatedThisWeek+R.carryoverTicketsCreatedPreviousWeek+R.carryoverTicketsCreatedOlder,lastIndex:_,series:{carryoverCreatedPreviousWeek:h.carryoverCreatedPreviousWeek,carryoverCreatedOlder:h.carryoverCreatedOlder,carryoverCreatedPreviousWeekLength:h.carryoverCreatedPreviousWeek?.length,carryoverCreatedOlderLength:h.carryoverCreatedOlder?.length,carryoverCreatedPreviousWeekLast:h.carryoverCreatedPreviousWeek?.[_],carryoverCreatedOlderLast:h.carryoverCreatedOlder?.[_]},currentWeek:a.data.currentWeek,data:{carryoverTicketsCreatedPreviousWeek:a.data.carryoverTicketsCreatedPreviousWeek,carryoverTicketsCreatedOlder:a.data.carryoverTicketsCreatedOlder}}),R.newTickets>0||R.closedTickets>0||R.carryoverTickets>0)return R}}if(a.data?.currentWeek&&typeof a.data.currentWeek=="object"){const h=a.data.currentWeek;if((h.newTickets??0)>0||(h.closedTickets??0)>0||(h.carryoverTickets??0)>0)return h}if(a.data?.weeksData&&Array.isArray(a.data.weeksData)&&a.data.weeksData.length>0){const h=a.data.weeksData[a.data.weeksData.length-1];if((h.newTickets??0)>0||(h.closedTickets??0)>0||(h.carryoverTickets??0)>0)return h}if(a.data?.series){const h=a.data.series,_=Math.max((Array.isArray(h.new)?h.new.length:0)-1,(Array.isArray(h.closed)?h.closed.length:0)-1,(Array.isArray(h.carryover)?h.carryover.length:0)-1,-1);if(_>=0)return{newTickets:Array.isArray(h.new)&&h.new[_]!==void 0?h.new[_]:0,closedTickets:Array.isArray(h.closed)&&h.closed[_]!==void 0?h.closed[_]:0,closedTicketsCreatedThisWeek:Array.isArray(h.closedCreatedThisWeek)&&h.closedCreatedThisWeek[_]!==void 0?h.closedCreatedThisWeek[_]:0,closedTicketsCreatedOtherWeek:Array.isArray(h.closedCreatedOtherWeek)&&h.closedCreatedOtherWeek[_]!==void 0?h.closedCreatedOtherWeek[_]:0,carryoverTickets:Array.isArray(h.carryover)&&h.carryover[_]!==void 0?h.carryover[_]:0,carryoverTicketsCreatedThisWeek:Array.isArray(h.carryoverCreatedThisWeek)&&h.carryoverCreatedThisWeek[_]!==void 0?h.carryoverCreatedThisWeek[_]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(h.carryoverCreatedPreviousWeek)&&h.carryoverCreatedPreviousWeek[_]!==void 0?h.carryoverCreatedPreviousWeek[_]:0,carryoverTicketsCreatedOlder:Array.isArray(h.carryoverCreatedOlder)&&h.carryoverCreatedOlder[_]!==void 0?h.carryoverCreatedOlder[_]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(h.carryoverCreatedOtherWeek)&&h.carryoverCreatedOtherWeek[_]!==void 0?h.carryoverCreatedOtherWeek[_]:0}}return a.data||{}}),L=$(()=>{const h=a.meta?.weeks||[];return h.length>0?h[h.length-1]:{weekNumber:a.meta?.currentWeek?.weekNumber??a.meta?.weekNumber??null,weekStartUtc:a.meta?.currentWeek?.weekStartUtc??a.meta?.weekStartUtc??null,weekEndUtc:a.meta?.currentWeek?.weekEndUtc??a.meta?.weekEndUtc??null}}),E=$(()=>{if(a.data?.series){const h=a.data.series,_=Math.max((Array.isArray(h.new)?h.new.length:0)-1,(Array.isArray(h.closed)?h.closed.length:0)-1,(Array.isArray(h.closedCreatedThisWeek)?h.closedCreatedThisWeek.length:0)-1,(Array.isArray(h.closedCreatedOtherWeek)?h.closedCreatedOtherWeek.length:0)-1,(Array.isArray(h.carryover)?h.carryover.length:0)-1,(Array.isArray(h.carryoverCreatedThisWeek)?h.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(h.carryoverCreatedPreviousWeek)?h.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(h.carryoverCreatedOlder)?h.carryoverCreatedOlder.length:0)-1,(Array.isArray(h.carryoverCreatedOtherWeek)?h.carryoverCreatedOtherWeek.length:0)-1,-1);if(_>=1){const R=_-1,re=a.meta?.weeks?.[R],ie={weekNumber:re?.weekNumber??null,weekStartUtc:re?.weekStartUtc??null,weekEndUtc:re?.weekEndUtc??null,newTickets:Array.isArray(h.new)&&h.new[R]!==void 0?h.new[R]:0,closedTickets:Array.isArray(h.closed)&&h.closed[R]!==void 0?h.closed[R]:0,closedTicketsCreatedThisWeek:Array.isArray(h.closedCreatedThisWeek)&&h.closedCreatedThisWeek[R]!==void 0?h.closedCreatedThisWeek[R]:0,closedTicketsCreatedOtherWeek:Array.isArray(h.closedCreatedOtherWeek)&&h.closedCreatedOtherWeek[R]!==void 0?h.closedCreatedOtherWeek[R]:0,carryoverTickets:Array.isArray(h.carryover)&&h.carryover[R]!==void 0?h.carryover[R]:0,carryoverTicketsCreatedThisWeek:Array.isArray(h.carryoverCreatedThisWeek)&&h.carryoverCreatedThisWeek[R]!==void 0?h.carryoverCreatedThisWeek[R]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(h.carryoverCreatedPreviousWeek)&&h.carryoverCreatedPreviousWeek[R]!==void 0?h.carryoverCreatedPreviousWeek[R]:0,carryoverTicketsCreatedOlder:Array.isArray(h.carryoverCreatedOlder)&&h.carryoverCreatedOlder[R]!==void 0?h.carryoverCreatedOlder[R]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(h.carryoverCreatedOtherWeek)&&h.carryoverCreatedOtherWeek[R]!==void 0?h.carryoverCreatedOtherWeek[R]:0};if(ie.newTickets>0||ie.closedTickets>0||ie.carryoverTickets>0)return ie}}if(a.data?.weeksData&&Array.isArray(a.data.weeksData)&&a.data.weeksData.length>=2){const h=a.data.weeksData.length-2,_=a.data.weeksData[h],R=a.meta?.weeks?.[h];if((_.newTickets??0)>0||(_.closedTickets??0)>0||(_.carryoverTickets??0)>0)return{weekNumber:_.weekNumber??R?.weekNumber??null,weekStartUtc:R?.weekStartUtc??null,weekEndUtc:R?.weekEndUtc??null,newTickets:_.newTickets??0,closedTickets:_.closedTickets??0,closedTicketsCreatedThisWeek:_.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:_.closedTicketsCreatedOtherWeek??0,carryoverTickets:_.carryoverTickets??0,carryoverTicketsCreatedThisWeek:_.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:_.carryoverTicketsCreatedOtherWeek??0}}if(a.data?.series){const h=a.data.series,_=Math.max((Array.isArray(h.new)?h.new.length:0)-1,(Array.isArray(h.closed)?h.closed.length:0)-1,(Array.isArray(h.carryover)?h.carryover.length:0)-1,-1);if(_>=1){const R=_-1,re=a.meta?.weeks?.[R];return{weekNumber:re?.weekNumber??null,weekStartUtc:re?.weekStartUtc??null,weekEndUtc:re?.weekEndUtc??null,newTickets:Array.isArray(h.new)&&h.new[R]!==void 0?h.new[R]:0,closedTickets:Array.isArray(h.closed)&&h.closed[R]!==void 0?h.closed[R]:0,closedTicketsCreatedThisWeek:Array.isArray(h.closedCreatedThisWeek)&&h.closedCreatedThisWeek[R]!==void 0?h.closedCreatedThisWeek[R]:0,closedTicketsCreatedOtherWeek:Array.isArray(h.closedCreatedOtherWeek)&&h.closedCreatedOtherWeek[R]!==void 0?h.closedCreatedOtherWeek[R]:0,carryoverTickets:Array.isArray(h.carryover)&&h.carryover[R]!==void 0?h.carryover[R]:0,carryoverTicketsCreatedThisWeek:Array.isArray(h.carryoverCreatedThisWeek)&&h.carryoverCreatedThisWeek[R]!==void 0?h.carryoverCreatedThisWeek[R]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(h.carryoverCreatedPreviousWeek)&&h.carryoverCreatedPreviousWeek[R]!==void 0?h.carryoverCreatedPreviousWeek[R]:0,carryoverTicketsCreatedOlder:Array.isArray(h.carryoverCreatedOlder)&&h.carryoverCreatedOlder[R]!==void 0?h.carryoverCreatedOlder[R]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(h.carryoverCreatedOtherWeek)&&h.carryoverCreatedOtherWeek[R]!==void 0?h.carryoverCreatedOtherWeek[R]:0}}}return null}),D=$(()=>{const h=a.data?.stagesByWeek;return Array.isArray(h)?h:null}),N=$(()=>{const h=D.value;if(h&&h.length>0){const _=h.length-1,R=h[_];if(Array.isArray(R))return R}return a.data?.stages??[]}),B=$(()=>{const h=D.value;if(h&&h.length>=2){const _=h.length-2,R=h[_];if(Array.isArray(R))return R}return[]}),W=$(()=>E.value?.weekNumber?`–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–µ–¥–µ–ª–∏ ${E.value.weekNumber}`:"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö");function G(h,_){if(typeof h!="number"||isNaN(h)||_==null||typeof _!="number"||isNaN(_)||_===0)return null;if(h===_)return 0;const R=(h-_)/_*100;return!isFinite(R)||isNaN(R)?null:R}function q(h){return h==null||isNaN(h)?"":`${h>=0?"+":""}${h.toFixed(1)}%`}const oe=$(()=>{if(a.data?.series){const h=a.data.series,_=Math.max((Array.isArray(h.new)?h.new.length:0)-1,(Array.isArray(h.closed)?h.closed.length:0)-1,(Array.isArray(h.carryover)?h.carryover.length:0)-1,-1);if(_>=2){const R=_-2;return{weekNumber:a.meta?.weeks?.[R]?.weekNumber??null,newTickets:Array.isArray(h.new)&&h.new[R]!==void 0?h.new[R]:0,closedTickets:Array.isArray(h.closed)&&h.closed[R]!==void 0?h.closed[R]:0,carryoverTickets:Array.isArray(h.carryover)&&h.carryover[R]!==void 0?h.carryover[R]:0}}}return null}),Y=$(()=>{const h=U.value,_=E.value;return!h||!_?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:G(h.newTickets??0,_.newTickets??0),closedTickets:G(h.closedTickets??0,_.closedTickets??0),carryoverTickets:G(h.carryoverTickets??0,_.carryoverTickets??0)}}),H=$(()=>{const h=E.value,_=oe.value;return!h||!_?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:G(h.newTickets??0,_.newTickets??0),closedTickets:G(h.closedTickets??0,_.closedTickets??0),carryoverTickets:G(h.carryoverTickets??0,_.carryoverTickets??0)}});function Z(h,_){if(!h||!_)return"";try{const R=new Date(h),re=new Date(_),ie=R.getUTCDate(),se=R.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),me=R.getUTCFullYear(),Se=re.getUTCDate(),Ie=re.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),xe=re.getUTCFullYear();return me===xe&&se===Ie?`${ie} ‚Äî ${Se} ${se}`:me===xe?`${ie} ${se} ‚Äî ${Se} ${Ie}`:`${ie} ${se} ${me} ‚Äî ${Se} ${Ie} ${xe}`}catch(R){return console.error("[formatWeekDates] Error:",R),""}}const fe=h=>{const _=U.value,R=_?.newTickets??0,re=_?.closedTickets??0,ie=_?.carryoverTickets??0,se=L.value;h==="new"&&R>0?t("open-stages",{weekNumber:se.weekNumber,weekStartUtc:se.weekStartUtc,weekEndUtc:se.weekEndUtc}):h==="closed"&&re>0?t("open-responsible",{weekNumber:se.weekNumber,weekStartUtc:se.weekStartUtc,weekEndUtc:se.weekEndUtc}):h==="carryover"&&ie>0&&t("open-carryover",{weekNumber:se.weekNumber,weekStartUtc:se.weekStartUtc,weekEndUtc:se.weekEndUtc})},P=h=>{const _=E.value;if(!_)return;const R=_?.newTickets??0,re=_?.closedTickets??0,ie=_?.carryoverTickets??0,se=l.value;se&&(h==="new"&&R>0?t("open-stages",{weekNumber:se.weekNumber,weekStartUtc:se.weekStartUtc,weekEndUtc:se.weekEndUtc}):h==="closed"&&re>0?t("open-responsible",{weekNumber:se.weekNumber,weekStartUtc:se.weekStartUtc,weekEndUtc:se.weekEndUtc}):h==="carryover"&&ie>0&&t("open-carryover",{weekNumber:se.weekNumber,weekStartUtc:se.weekStartUtc,weekEndUtc:se.weekEndUtc}))};return(h,_)=>(c(),u("div",Xg,[s("header",Jg,[s("div",null,[_[6]||(_[6]=s("h2",{class:"ac-chart__title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),s("p",Zg," –ù–µ–¥–µ–ª—è "+m(o.meta?.currentWeek?.weekNumber??o.meta?.weekNumber??"‚Äî")+" ¬∑ "+m((o.meta?.currentWeek?.weekStartUtc??o.meta?.weekStartUtc)||"‚Äî")+" ‚Äî "+m((o.meta?.currentWeek?.weekEndUtc??o.meta?.weekEndUtc)||"‚Äî")+" (UTC) ",1)]),s("div",Qg,[s("div",em,[(c(),u(ee,null,te(r,R=>s("button",{key:R.value,class:X(["chart-type-btn",{active:n.value===R.value}]),onClick:re=>n.value=R.value},[s("span",am,m(R.icon),1),s("span",sm,m(R.label),1)],10,tm)),64))])])]),s("section",om,[s("div",nm,[s("h3",rm,[_[7]||(_[7]=s("span",{class:"summary-week-block__title-text"},"–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)),s("span",lm," –ù–µ–¥–µ–ª—è "+m(L.value.weekNumber??"‚Äî"),1),L.value.weekStartUtc?(c(),u("span",im,m(Z(L.value.weekStartUtc,L.value.weekEndUtc)),1)):A("",!0)]),s("div",cm,[s("div",{class:"summary-card summary-card--new",onClick:_[0]||(_[0]=R=>fe("new"))},[_[8]||(_[8]=s("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s("div",dm,[s("div",um,m(U.value?.newTickets??0),1),Y.value.newTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",Y.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${E.value?.weekNumber??"‚Äî"}): ${q(Y.value.newTickets)}`},[s("span",mm,m(Y.value.newTickets>=0?"‚Üë":"‚Üì"),1),s("span",hm,m(q(Y.value.newTickets)),1),s("span",fm,"–∫ –Ω–µ–¥–µ–ª–µ "+m(E.value?.weekNumber??"‚Äî"),1)],10,gm)):A("",!0)])]),s("div",{class:"summary-card summary-card--closed-breakdown",onClick:_[1]||(_[1]=R=>fe("closed"))},[_[13]||(_[13]=s("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s("div",vm,[s("div",pm,m(U.value?.closedTickets??0),1),Y.value.closedTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",Y.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${E.value?.weekNumber??"‚Äî"}): ${q(Y.value.closedTickets)}`},[s("span",km,m(Y.value.closedTickets>=0?"‚Üë":"‚Üì"),1),s("span",bm,m(q(Y.value.closedTickets)),1),s("span",_m,"–∫ –Ω–µ–¥–µ–ª–µ "+m(E.value?.weekNumber??"‚Äî"),1)],10,ym)):A("",!0)]),s("div",wm,[s("div",Cm,[_[9]||(_[9]=s("span",{class:"breakdown-item__icon"},"‚úì",-1)),s("span",Tm,m(U.value?.closedTicketsCreatedThisWeek??0),1),_[10]||(_[10]=s("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),s("div",Sm,[_[11]||(_[11]=s("span",{class:"breakdown-item__icon"},"‚Üª",-1)),s("span",Dm,m(U.value?.closedTicketsCreatedOtherWeek??0),1),_[12]||(_[12]=s("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),s("div",{class:"summary-card summary-card--carryover-breakdown",onClick:_[2]||(_[2]=R=>fe("carryover"))},[_[20]||(_[20]=s("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),s("div",Em,[s("div",Am,m(U.value?.carryoverTickets??0),1),Y.value.carryoverTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",Y.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${E.value?.weekNumber??"‚Äî"}): ${q(Y.value.carryoverTickets)}`},[s("span",Im,m(Y.value.carryoverTickets>=0?"‚Üë":"‚Üì"),1),s("span",Mm,m(q(Y.value.carryoverTickets)),1),s("span",Nm,"–∫ –Ω–µ–¥–µ–ª–µ "+m(E.value?.weekNumber??"‚Äî"),1)],10,$m)):A("",!0)]),s("div",xm,[s("div",Lm,[_[14]||(_[14]=s("span",{class:"breakdown-item__icon"},"‚úì",-1)),s("span",Pm,m(U.value?.carryoverTicketsCreatedThisWeek??0),1),_[15]||(_[15]=s("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),s("div",Om,[_[16]||(_[16]=s("span",{class:"breakdown-item__icon"},"‚Üª",-1)),s("span",Bm,m(U.value?.carryoverTicketsCreatedPreviousWeek??0),1),_[17]||(_[17]=s("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏",-1))]),s("div",Rm,[_[18]||(_[18]=s("span",{class:"breakdown-item__icon"},"‚Üª",-1)),s("span",Wm,m(U.value?.carryoverTicketsCreatedOlder??0),1),_[19]||(_[19]=s("span",{class:"breakdown-item__label"},"–æ—Å—Ç–∞–ª—å–Ω—ã–µ",-1))])])]),s("div",Um,[_[21]||(_[21]=s("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),s("div",Fm,[(c(!0),u(ee,null,te(N.value,R=>(c(),u("span",{key:R.stageId,class:"stage-tag"},m(R.stageName||R.stageId)+" ‚Äî "+m(R.count),1))),128)),!N.value||N.value.length===0?(c(),u("span",Hm," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):A("",!0)])])])]),E.value?(c(),u("div",jm,[..._[22]||(_[22]=[s("div",{class:"summary-week-divider__line"},null,-1),s("div",{class:"summary-week-divider__label"},"–ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)])])):A("",!0),E.value?(c(),u("div",Vm,[s("h3",zm,[_[23]||(_[23]=s("span",{class:"summary-week-block__title-text"},"–ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)),s("span",Gm," –ù–µ–¥–µ–ª—è "+m(E.value.weekNumber??"‚Äî"),1),E.value.weekStartUtc?(c(),u("span",Km,m(Z(E.value.weekStartUtc,E.value.weekEndUtc)),1)):A("",!0)]),s("div",qm,[s("div",{class:"summary-card summary-card--new summary-card--previous summary-card--clickable",onClick:_[3]||(_[3]=R=>P("new"))},[_[24]||(_[24]=s("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s("div",Ym,[s("div",Xm,[s("div",Jm,[s("div",Zm,m(E.value?.newTickets??0),1),s("span",Qm,"–ù–µ–¥–µ–ª—è "+m(E.value?.weekNumber??"‚Äî"),1)]),s("div",eh,[s("div",th,m(oe.value?.newTickets??0),1),s("span",ah,"–ù–µ–¥–µ–ª—è "+m(oe.value?.weekNumber??"‚Äî"),1)])]),H.value.newTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",H.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${oe.value?.weekNumber??"‚Äî"}): ${q(H.value.newTickets)}`},[s("span",oh,m(H.value.newTickets>=0?"‚Üë":"‚Üì"),1),s("span",nh,m(q(H.value.newTickets)),1),s("span",rh,"–∫ –Ω–µ–¥–µ–ª–µ "+m(oe.value?.weekNumber??"‚Äî"),1)],10,sh)):A("",!0)])]),s("div",{class:"summary-card summary-card--closed-breakdown summary-card--previous summary-card--clickable",onClick:_[4]||(_[4]=R=>P("closed"))},[_[29]||(_[29]=s("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s("div",lh,[s("div",ih,[s("div",ch,[s("div",dh,m(E.value?.closedTickets??0),1),s("span",uh,"–ù–µ–¥–µ–ª—è "+m(E.value?.weekNumber??"‚Äî"),1)]),s("div",gh,[s("div",mh,m(oe.value?.closedTickets??0),1),s("span",hh,"–ù–µ–¥–µ–ª—è "+m(oe.value?.weekNumber??"‚Äî"),1)])]),H.value.closedTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",H.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${oe.value?.weekNumber??"‚Äî"}): ${q(H.value.closedTickets)}`},[s("span",vh,m(H.value.closedTickets>=0?"‚Üë":"‚Üì"),1),s("span",ph,m(q(H.value.closedTickets)),1),s("span",yh,"–∫ –Ω–µ–¥–µ–ª–µ "+m(oe.value?.weekNumber??"‚Äî"),1)],10,fh)):A("",!0)]),s("div",kh,[s("div",bh,[_[25]||(_[25]=s("span",{class:"breakdown-item__icon"},"‚úì",-1)),s("span",_h,m(E.value?.closedTicketsCreatedThisWeek??0),1),_[26]||(_[26]=s("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),s("div",wh,[_[27]||(_[27]=s("span",{class:"breakdown-item__icon"},"‚Üª",-1)),s("span",Ch,m(E.value?.closedTicketsCreatedOtherWeek??0),1),_[28]||(_[28]=s("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),s("div",{class:"summary-card summary-card--carryover-breakdown summary-card--previous summary-card--clickable",onClick:_[5]||(_[5]=R=>P("carryover"))},[_[36]||(_[36]=s("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),s("div",Th,[s("div",Sh,[s("div",Dh,[s("div",Eh,m(E.value?.carryoverTickets??0),1),s("span",Ah,"–ù–µ–¥–µ–ª—è "+m(E.value?.weekNumber??"‚Äî"),1)]),s("div",$h,[s("div",Ih,m(oe.value?.carryoverTickets??0),1),s("span",Mh,"–ù–µ–¥–µ–ª—è "+m(oe.value?.weekNumber??"‚Äî"),1)])]),H.value.carryoverTickets!==null?(c(),u("div",{key:0,class:X(["percentage-indicator",H.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${oe.value?.weekNumber??"‚Äî"}): ${q(H.value.carryoverTickets)}`},[s("span",xh,m(H.value.carryoverTickets>=0?"‚Üë":"‚Üì"),1),s("span",Lh,m(q(H.value.carryoverTickets)),1),s("span",Ph,"–∫ –Ω–µ–¥–µ–ª–µ "+m(oe.value?.weekNumber??"‚Äî"),1)],10,Nh)):A("",!0)]),s("div",Oh,[s("div",Bh,[_[30]||(_[30]=s("span",{class:"breakdown-item__icon"},"‚úì",-1)),s("span",Rh,m(E.value?.carryoverTicketsCreatedThisWeek??0),1),_[31]||(_[31]=s("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),s("div",Wh,[_[32]||(_[32]=s("span",{class:"breakdown-item__icon"},"‚Üª",-1)),s("span",Uh,m(E.value?.carryoverTicketsCreatedPreviousWeek??0),1),_[33]||(_[33]=s("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏",-1))]),s("div",Fh,[_[34]||(_[34]=s("span",{class:"breakdown-item__icon"},"‚Üª",-1)),s("span",Hh,m(E.value?.carryoverTicketsCreatedOlder??0),1),_[35]||(_[35]=s("span",{class:"breakdown-item__label"},"–æ—Å—Ç–∞–ª—å–Ω—ã–µ",-1))])])]),s("div",jh,[_[37]||(_[37]=s("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),s("div",Vh,[(c(!0),u(ee,null,te(B.value,R=>(c(),u("span",{key:R.stageId,class:"stage-tag"},m(R.stageName||R.stageId)+" ‚Äî "+m(R.count),1))),128)),!B.value||B.value.length===0?(c(),u("span",zh,m(W.value),1)):A("",!0)])])])])):A("",!0)]),s("div",Gh,[n.value==="line"?(c(),u("div",Kh,[s("div",qh,[_[38]||(_[38]=s("h3",{class:"chart-subtitle"},"–ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),s("div",Yh,[ne(We(yt),{data:v.value,options:x.value},null,8,["data","options"])])]),s("div",Xh,[_[39]||(_[39]=s("h3",{class:"chart-subtitle"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",-1)),s("div",Jh,[ne(We(yt),{data:w.value,options:x.value},null,8,["data","options"])])])])):(c(),he(wt(y.value),{key:1,data:T.value,options:x.value},null,8,["data","options"]))])]))}},Qh=ce(Zh,[["__scopeId","data-v-3666e13a"]]),ef={class:"summary-cards-months"},tf={class:"summary-card summary-card--new"},af={class:"card-content"},sf={class:"card-main-value"},of=["title"],nf={class:"card-month-breakdown"},rf={class:"month-name"},lf={class:"month-value"},cf={key:0,class:"month-item month-item--empty"},df={class:"summary-card summary-card--closed"},uf={class:"card-content"},gf={class:"card-main-value"},mf=["title"],hf={class:"card-month-breakdown-hierarchical"},ff={class:"month-header"},vf={class:"month-name"},pf={class:"month-value"},yf={class:"month-breakdown"},kf={class:"breakdown-item breakdown-this-week"},bf={class:"breakdown-value"},_f={class:"breakdown-item breakdown-other-week"},wf={class:"breakdown-value"},Cf={key:0,class:"month-item-hierarchical month-item--empty"},Tf={class:"summary-card summary-card--carryover"},Sf={class:"card-content"},Df={class:"card-current-value"},Ef={class:"current-value"},Af=["title"],$f={class:"card-month-breakdown"},If={class:"month-name"},Mf={class:"month-value"},Nf={key:0,class:"month-item month-item--empty"},xf={class:"summary-card summary-card--stages"},Lf={class:"card-content"},Pf={class:"stages-list"},Of={class:"stage-icon"},Bf={class:"stage-name"},Rf={class:"stage-value"},Wf={key:0,class:"stage-item stage-item--empty"},Uf={__name:"SummaryCardsMonths",props:{data:{type:Object,required:!0,default:()=>({newTickets:0,newTicketsByMonth:[],closedTickets:0,closedTicketsByMonth:[],carryoverTickets:0,carryoverTicketsByMonth:[],stages:[]})}},setup(o){const e=o;function a(C){return C==null||isNaN(C)?"0":C>=1e6?(C/1e6).toFixed(1)+"M":C>=1e3?C.toLocaleString("ru-RU"):C.toString()}function t(C){return C==null||isNaN(C)?"":`${C>=0?"+":""}${C.toFixed(1)}%`}function l(C,k){if(typeof C!="number"||isNaN(C)||k==null||typeof k!="number"||isNaN(k)||k===0)return null;if(C===k)return 0;const S=(C-k)/k*100;return!isFinite(S)||isNaN(S)?null:S}const r=$(()=>e.data?.newTickets||0),n=$(()=>a(r.value)),i=$(()=>e.data?.newTicketsByMonth||[]),d=$(()=>e.data?.closedTicketsByMonth||[]),g=$(()=>e.data?.carryoverTicketsByMonth||[]),v=$(()=>{const C=g.value;return C.length===0?0:C[C.length-1]?.count||0}),w=$(()=>{const C=typeof e.data?.newTickets=="number"?e.data.newTickets:parseInt(e.data?.newTickets)||0,k=e.data?.previousPeriodData?.newTickets;return l(C,k)}),f=$(()=>{const C=typeof e.data?.closedTickets=="number"?e.data.closedTickets:parseInt(e.data?.closedTickets)||0,k=e.data?.previousPeriodData?.closedTickets;return l(C,k)}),p=$(()=>{const C=v.value,k=g.value,S=k.length>0?k[0]?.count||0:null;return l(C,S)});function y(C){return{"DT140_12:SUCCESS":"stage-success","DT140_12:FAIL":"stage-fail","DT140_12:UC_0GBU8Z":"stage-other"}[C]||""}function T(C){return{"DT140_12:SUCCESS":"‚úì","DT140_12:FAIL":"‚úó","DT140_12:UC_0GBU8Z":"‚ö†"}[C]||"‚Ä¢"}return(C,k)=>(c(),u("div",ef,[s("div",tf,[k[0]||(k[0]=s("h3",{class:"card-title"},"–ù–æ–≤—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥",-1)),s("div",af,[s("div",sf,[ge(m(n.value)+" ",1),w.value!==null?(c(),u("span",{key:0,class:X(["percentage-badge",w.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${t(w.value)}`},m(t(w.value)),11,of)):A("",!0)]),s("div",nf,[(c(!0),u(ee,null,te(i.value,S=>(c(),u("div",{key:`new-${S.month}`,class:"month-item"},[s("span",rf,m(S.monthName)+":",1),s("span",lf,m(a(S.count)),1)]))),128)),i.value.length===0?(c(),u("div",cf," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):A("",!0)])])]),s("div",df,[k[5]||(k[5]=s("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –≤—Å–µ–≥–æ",-1)),s("div",uf,[s("div",gf,[ge(m(a(o.data.closedTickets||0))+" ",1),f.value!==null?(c(),u("span",{key:0,class:X(["percentage-badge",f.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${t(f.value)}`},m(t(f.value)),11,mf)):A("",!0)]),s("div",hf,[(c(!0),u(ee,null,te(d.value,S=>(c(),u("div",{key:`closed-${S.month}`,class:"month-item-hierarchical"},[s("div",ff,[s("span",vf,m(S.monthName)+":",1),s("span",pf,m(a(S.count||0)),1)]),s("div",yf,[s("div",kf,[k[1]||(k[1]=s("span",{class:"breakdown-icon"},"‚úì",-1)),k[2]||(k[2]=s("span",{class:"breakdown-label"},"—ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞:",-1)),s("span",bf,m(a(S.closedCreatedThisWeek||0)),1)]),s("div",_f,[k[3]||(k[3]=s("span",{class:"breakdown-icon"},"‚Üª",-1)),k[4]||(k[4]=s("span",{class:"breakdown-label"},"–¥—Ä—É–≥–æ–≥–æ –º–µ—Å—è—Ü–∞:",-1)),s("span",wf,m(a(S.closedCreatedOtherWeek||0)),1)])])]))),128)),d.value.length===0?(c(),u("div",Cf," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):A("",!0)])])]),s("div",Tf,[k[7]||(k[7]=s("h3",{class:"card-title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ –≤—Å–µ–≥–æ",-1)),k[8]||(k[8]=s("p",{class:"card-hint"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ –≤ —Ç—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–∞–±–æ—á–∏—Ö —Å—Ç–∞–¥–∏—è—Ö (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)",-1)),s("div",Sf,[s("div",Df,[k[6]||(k[6]=s("span",{class:"current-label"},"–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:",-1)),s("span",Ef,[ge(m(a(v.value))+" ",1),p.value!==null?(c(),u("span",{key:0,class:X(["percentage-badge",p.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${t(p.value)}`},m(t(p.value)),11,Af)):A("",!0)])]),s("div",$f,[(c(!0),u(ee,null,te(g.value,S=>(c(),u("div",{key:`carryover-${S.month}`,class:"month-item"},[s("span",If,m(S.monthName)+":",1),s("span",Mf,m(a(S.count||0)),1)]))),128)),g.value.length===0?(c(),u("div",Nf," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):A("",!0)])])]),s("div",xf,[k[10]||(k[10]=s("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),s("div",Lf,[s("div",Pf,[(c(!0),u(ee,null,te(o.data.stages||[],S=>(c(),u("div",{key:S.stageId,class:X(["stage-item",y(S.stageId)])},[s("span",Of,m(T(S.stageId)),1),s("span",Bf,m(S.stageName||S.stageId)+":",1),s("span",Rf,m(a(S.count||0)),1)],2))),128)),!o.data.stages||o.data.stages.length===0?(c(),u("div",Wf,[...k[9]||(k[9]=[s("span",{class:"stage-name"},"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö",-1)])])):A("",!0)])])])]))}},Ff=ce(Uf,[["__scopeId","data-v-15d88b90"]]),Hf={class:"line-chart-months"},jf={class:"chart-section"},Vf={class:"chart-title"},zf={key:0,class:"chart-period"},Gf={class:"chart-wrapper"},Kf={class:"chart-container"},qf={class:"chart-summary"},Yf={class:"summary-numbers"},Xf={class:"summary-row"},Jf={class:"summary-values"},Zf={class:"summary-row"},Qf={class:"summary-values"},ev={class:"summary-analysis"},tv=["innerHTML"],av={class:"chart-section"},sv={class:"chart-title"},ov={key:0,class:"chart-period"},nv={class:"chart-wrapper"},rv={class:"chart-container"},lv={class:"chart-analysis"},iv={class:"analysis-content"},cv=["innerHTML"],dv={class:"chart-table-section"},uv={class:"chart-table-wrapper"},gv={class:"data-table"},mv={class:"data-row data-row--new"},hv={class:"data-row data-row--closed"},fv={class:"data-row data-row--carryover"},vv={__name:"LineChartMonths",props:{data:{type:Object,required:!0,default:()=>({newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]})},meta:{type:Object,default:()=>({months:[]})}},setup(o){Je.register(ps);const e=o;function a(y){return y==null||isNaN(y)?"0":y>=1e3?y.toLocaleString("ru-RU"):y.toString()}const t=$(()=>{const y=new Set;return e.data.newTicketsByMonth?.forEach(T=>{T.weeks&&Array.isArray(T.weeks)&&T.weeks.forEach(C=>{C&&C.weekNumber&&y.add(C.weekNumber)})}),e.data.closedTicketsByMonth?.forEach(T=>{T.weeks&&Array.isArray(T.weeks)&&T.weeks.forEach(C=>{C&&C.weekNumber&&y.add(C.weekNumber)})}),e.data.carryoverTicketsByMonth?.forEach(T=>{T.weeks&&Array.isArray(T.weeks)&&T.weeks.forEach(C=>{C&&C.weekNumber&&y.add(C.weekNumber)})}),Array.from(y).sort((T,C)=>T-C)}),l=$(()=>{const y=e.data.newTicketsByMonth||[],T=y.map(S=>S.monthName||`–ú–µ—Å—è—Ü ${S.month}`),C=y.map(S=>S.count||0),k=(e.data.closedTicketsByMonth||[]).map(S=>S.count||0);return{labels:T,datasets:[{label:"–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã",data:C,borderColor:J.primary,backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:10,color:J.primary,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:J.primary,borderWidth:1,borderRadius:4,padding:4}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",data:k,borderColor:J.success,backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"start",align:"bottom",offset:10,color:J.success,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:J.success,borderWidth:1,borderRadius:4,padding:4}}]}}),r=$(()=>{const y=e.data.carryoverTicketsByMonth||[],T=y.map(k=>k.monthName||`–ú–µ—Å—è—Ü ${k.month}`),C=y.map(k=>k.count||0);return{labels:T,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",data:C,borderColor:J.carryover,backgroundColor:"rgba(255, 152, 0, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:4,color:J.carryover}}]}}),n={responsive:!0,maintainAspectRatio:!1,layout:{padding:{left:16,right:0,top:56,bottom:0}},plugins:{legend:{position:"left",labels:{font:{size:14,weight:"500"},padding:16,boxWidth:20,boxHeight:12}},tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12},datalabels:{anchor:"end",align:"top",formatter:(y,T)=>y==null||isNaN(y)?"":y.toString(),color:"#333",font:{size:12,weight:"bold"},padding:{top:4,bottom:4},display:function(y){const T=y.dataset.data[y.dataIndex];return T!=null&&!isNaN(T)&&isFinite(T)},backgroundColor:"rgba(255, 255, 255, 0.8)",borderColor:"#333",borderWidth:1,borderRadius:4,padding:4}},scales:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:0,minRotation:0,font:{size:14},padding:10},grid:{lineWidth:1.5}}}};function i(y){if(!y||y.length===0)return null;const T=y[0],C=y[y.length-1];if(!T||!C)return null;const k=T.monthName||`–ú–µ—Å—è—Ü ${T.month}`,S=C.monthName||`–ú–µ—Å—è—Ü ${C.month}`,x=T.year||new Date().getFullYear();return`${k} ‚Äî ${S} ${x}`}const d=$(()=>i(e.data?.newTicketsByMonth||[])),g=$(()=>i(e.data?.carryoverTicketsByMonth||[])),v=$(()=>{const y=e.data?.newTicketsByMonth||[],T=e.data?.closedTicketsByMonth||[];if(y.length===0)return{new:"‚Äî",closed:"‚Äî"};const C=y.map(S=>`${a(S.count||0)} (${S.monthName||S.month})`).join(" ‚Üí "),k=T.map(S=>`${a(S.count||0)} (${S.monthName||S.month})`).join(" ‚Üí ");return{new:C,closed:k}}),w=$(()=>{const y=e.data?.newTicketsByMonth||[],T=e.data?.closedTicketsByMonth||[];if(y.length<2)return["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"];const C=[],k=[],S=[];if(y.length>=2){const x=y[0],U=y[1],L=y[2];if(U&&x&&typeof x.count=="number"&&typeof U.count=="number"){const E=x.monthName||x.month,D=U.monthName||U.month,N=a(x.count||0),B=a(U.count||0);if(x.count>0){const W=(U.count-x.count)/x.count*100;if(isFinite(W)&&!isNaN(W)){const G=W>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(W),oe=W>=0?"+":"-",Y=W>=0?"#28a745":"#dc3545",H=W>=0?"#28a745":"#dc3545";k.push(`  ‚Ä¢ <span style="color: ${Y}; font-weight: 600;">${G}</span> —Å ${N} (${E}) –¥–æ ${B} (${D}) ‚Äî <span style="color: ${H}; font-weight: 600;">${oe}${q.toFixed(1)}%</span>`)}}else x.count===0&&U.count>0&&k.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${E}) –¥–æ ${B} (${D})`)}if(L&&U&&typeof U.count=="number"&&typeof L.count=="number"){const E=U.monthName||U.month,D=L.monthName||L.month,N=a(U.count||0),B=a(L.count||0);if(U.count>0){const W=(L.count-U.count)/U.count*100;if(isFinite(W)&&!isNaN(W))if(Math.abs(W)<.1)k.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${N} (${E}) ‚Üí ${B} (${D}) ‚Äî 0.0%`);else{const G=W>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(W),oe=W>=0?"+":"-",Y=W>=0?"#28a745":"#dc3545",H=W>=0?"#28a745":"#dc3545";k.push(`  ‚Ä¢ <span style="color: ${Y}; font-weight: 600;">${G}</span> —Å ${N} (${E}) –¥–æ ${B} (${D}) ‚Äî <span style="color: ${H}; font-weight: 600;">${oe}${q.toFixed(1)}%</span>`)}}else U.count===0&&L.count>0&&k.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${E}) –¥–æ ${B} (${D})`)}}if(T.length>=2){const x=T[0],U=T[1],L=T[2];if(U&&x&&typeof x.count=="number"&&typeof U.count=="number"){const E=x.monthName||x.month,D=U.monthName||U.month,N=a(x.count||0),B=a(U.count||0);if(x.count>0){const W=(U.count-x.count)/x.count*100;if(isFinite(W)&&!isNaN(W))if(Math.abs(W)<.1)S.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${N} (${E}) ‚Üí ${B} (${D}) ‚Äî 0.0%`);else{const G=W>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(W),oe=W>=0?"+":"-",Y=W>=0?"#28a745":"#dc3545",H=W>=0?"#28a745":"#dc3545";S.push(`  ‚Ä¢ <span style="color: ${Y}; font-weight: 600;">${G}</span> —Å ${N} (${E}) –¥–æ ${B} (${D}) ‚Äî <span style="color: ${H}; font-weight: 600;">${oe}${q.toFixed(1)}%</span>`)}}else x.count===0&&U.count>0&&S.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏–π: —Å 0 (${E}) –¥–æ ${B} (${D})`)}if(L&&U&&typeof U.count=="number"&&typeof L.count=="number"){const E=U.monthName||U.month,D=L.monthName||L.month,N=a(U.count||0),B=a(L.count||0);if(U.count>0){const W=(L.count-U.count)/U.count*100;if(isFinite(W)&&!isNaN(W))if(Math.abs(W)<.1)S.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${N} (${E}) ‚Üí ${B} (${D}) ‚Äî 0.0%`);else{const G=W>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(W),oe=W>=0?"+":"-",Y=W>=0?"#28a745":"#dc3545",H=W>=0?"#28a745":"#dc3545";S.push(`  ‚Ä¢ <span style="color: ${Y}; font-weight: 600;">${G}</span> —Å ${N} (${E}) –¥–æ ${B} (${D}) ‚Äî <span style="color: ${H}; font-weight: 600;">${oe}${q.toFixed(1)}%</span>`)}}else U.count===0&&L.count>0&&S.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏–π: —Å 0 (${E}) –¥–æ ${B} (${D})`)}}if(k.length>0&&(C.push("–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã:"),C.push(...k)),S.length>0&&(C.push("–ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã:"),C.push(...S)),y.length>=3&&T.length>=3){const x=y[0],U=y[y.length-1],L=T[0],E=T[T.length-1],D=x.count||0,N=U.count||0,B=L.count||0,W=E.count||0;if(D>0&&B>0){const G=(N-D)/D*100,q=(W-B)/B*100;if(isFinite(G)&&isFinite(q)){const oe=x.monthName||x.month,Y=U.monthName||U.month,H=L.monthName||L.month,Z=E.monthName||E.month,fe=G>=0?"#28a745":"#dc3545",P=G>=0?"#28a745":"#dc3545",h=q>=0?"#28a745":"#dc3545",_=q>=0?"#28a745":"#dc3545";C.push("–û–±—â–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥:"),C.push(`  ‚Ä¢ –ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã: <span style="color: ${fe}; font-weight: 600;">${G>=0?"—Ä–æ—Å—Ç":"—Å–Ω–∏–∂–µ–Ω–∏–µ"}</span> —Å ${a(D)} (${oe}) –¥–æ ${a(N)} (${Y}) ‚Äî <span style="color: ${P}; font-weight: 600;">${G>=0?"+":"-"}${Math.abs(G).toFixed(1)}%</span>`),C.push(`  ‚Ä¢ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã: <span style="color: ${h}; font-weight: 600;">${q>=0?"—Ä–æ—Å—Ç":"—Å–Ω–∏–∂–µ–Ω–∏–µ"}</span> —Å ${a(B)} (${H}) –¥–æ ${a(W)} (${Z}) ‚Äî <span style="color: ${_}; font-weight: 600;">${q>=0?"+":"-"}${Math.abs(q).toFixed(1)}%</span>`)}}}return C.length>0?C:["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"]}),f=$(()=>{const y=e.data?.carryoverTicketsByMonth||[];if(y.length===0)return["–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"];const T=[],C=[],k=y.filter(S=>S&&typeof S.count=="number").map(S=>`${a(S.count||0)} (${S.monthName||S.month||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"})`).join(" ‚Üí ");if(k&&T.push(`–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã: ${k}`),y.length>=2){const S=y[0],x=y[1],U=y[2];if(x&&S&&typeof S.count=="number"&&typeof x.count=="number"){const L=S.monthName||S.month,E=x.monthName||x.month,D=a(S.count||0),N=a(x.count||0);if(S.count>0){const B=(x.count-S.count)/S.count*100;if(isFinite(B)&&!isNaN(B))if(Math.abs(B)<.1)C.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${D} (${L}) ‚Üí ${N} (${E}) ‚Äî 0.0%`);else{const W=B>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",G=Math.abs(B),q=B>=0?"+":"-",oe=B>=0?"#28a745":"#dc3545",Y=B>=0?"#28a745":"#dc3545";C.push(`  ‚Ä¢ <span style="color: ${oe}; font-weight: 600;">${W}</span> —Å ${D} (${L}) –¥–æ ${N} (${E}) ‚Äî <span style="color: ${Y}; font-weight: 600;">${q}${G.toFixed(1)}%</span>`)}}else S.count===0&&x.count>0&&C.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${L}) –¥–æ ${N} (${E})`)}if(U&&x&&typeof x.count=="number"&&typeof U.count=="number"){const L=x.monthName||x.month,E=U.monthName||U.month,D=a(x.count||0),N=a(U.count||0);if(x.count>0){const B=(U.count-x.count)/x.count*100;if(isFinite(B)&&!isNaN(B))if(Math.abs(B)<.1)C.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${D} (${L}) ‚Üí ${N} (${E}) ‚Äî 0.0%`);else{const W=B>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",G=Math.abs(B),q=B>=0?"+":"-",oe=B>=0?"#28a745":"#dc3545",Y=B>=0?"#28a745":"#dc3545";C.push(`  ‚Ä¢ <span style="color: ${oe}; font-weight: 600;">${W}</span> —Å ${D} (${L}) –¥–æ ${N} (${E}) ‚Äî <span style="color: ${Y}; font-weight: 600;">${q}${G.toFixed(1)}%</span>`)}}else x.count===0&&U.count>0&&C.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${L}) –¥–æ ${N} (${E})`)}}if(C.length>0&&(T.push("–î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º:"),T.push(...C)),y.length>=3){const S=y[0],x=y[y.length-1];if(S&&x&&typeof S.count=="number"&&typeof x.count=="number"){const U=S.count||0,L=x.count||0,E=S.monthName||S.month,D=x.monthName||x.month,N=a(U),B=a(L);if(U>0){const W=(L-U)/U*100;if(isFinite(W)&&!isNaN(W))if(Math.abs(W)<1)T.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),T.push(`  ‚Ä¢ –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${N} (${E}) ‚Üí ${B} (${D}) ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ–Ω–µ–µ 1%`);else{const G=W>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",q=Math.abs(W),oe=W>=0?"+":"-",Y=W>=0?"#28a745":"#dc3545",H=W>=0?"#28a745":"#dc3545";T.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),T.push(`  ‚Ä¢ <span style="color: ${Y}; font-weight: 600;">${G}</span> —Å ${N} (${E}) –¥–æ ${B} (${D}) ‚Äî <span style="color: ${H}; font-weight: 600;">${oe}${q.toFixed(1)}%</span>`)}}else U===0&&L>0?(T.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),T.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${E}) –¥–æ ${B} (${D})`)):U>0&&L===0&&(T.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),T.push(`  ‚Ä¢ –ü–æ–ª–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å ${N} (${E}) –¥–æ 0 (${D})`))}}return T.length>0?T:["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"]});function p(y,T){let C=[];switch(y){case"new":C=e.data.newTicketsByMonth||[];break;case"closed":C=e.data.closedTicketsByMonth||[];break;case"carryover":C=e.data.carryoverTicketsByMonth||[];break;default:return"-"}for(const k of C){if(!k.weeks||!Array.isArray(k.weeks))continue;const S=k.weeks.find(x=>x&&x.weekNumber===T);if(S){const x=S.count||0;return x>0?a(x):"-"}}return"-"}return(y,T)=>(c(),u("div",Hf,[s("div",jf,[s("h3",Vf,[T[0]||(T[0]=ge(" –ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã ",-1)),d.value?(c(),u("span",zf,"("+m(d.value)+")",1)):A("",!0)]),s("div",Gf,[s("div",Kf,[ne(We(yt),{data:l.value,options:n},null,8,["data"])]),s("div",qf,[T[3]||(T[3]=s("h4",{class:"summary-title"},"–°–≤–æ–¥–Ω—ã–π –∏—Ç–æ–≥",-1)),s("div",Yf,[s("div",Xf,[T[1]||(T[1]=s("span",{class:"summary-label"},"–ù–æ–≤—ã–µ:",-1)),s("span",Jf,m(v.value.new),1)]),s("div",Zf,[T[2]||(T[2]=s("span",{class:"summary-label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ:",-1)),s("span",Qf,m(v.value.closed),1)])]),s("div",ev,[(c(!0),u(ee,null,te(w.value,(C,k)=>(c(),u("p",{key:k,innerHTML:C},null,8,tv))),128))])])])]),s("div",av,[s("h3",sv,[T[4]||(T[4]=ge(" –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã ",-1)),g.value?(c(),u("span",ov,"("+m(g.value)+")",1)):A("",!0)]),s("div",nv,[s("div",rv,[ne(We(yt),{data:r.value,options:n},null,8,["data"])]),s("div",lv,[T[5]||(T[5]=s("h4",{class:"analysis-title"},"–ê–Ω–∞–ª–∏–∑",-1)),s("div",iv,[(c(!0),u(ee,null,te(f.value,(C,k)=>(c(),u("p",{key:k,innerHTML:C},null,8,cv))),128))])])])]),s("div",dv,[T[10]||(T[10]=s("h3",{class:"chart-title"},"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º",-1)),s("div",uv,[s("table",gv,[s("thead",null,[s("tr",null,[T[6]||(T[6]=s("th",{class:"month-header-cell"},"–ú–µ—Å—è—Ü",-1)),(c(!0),u(ee,null,te(t.value,C=>(c(),u("th",{key:`week-${C}`,class:"week-header-cell"}," –ù–µ–¥–µ–ª—è "+m(C),1))),128))])]),s("tbody",null,[s("tr",mv,[T[7]||(T[7]=s("td",{class:"data-type-cell"},"–ù–æ–≤—ã–µ",-1)),(c(!0),u(ee,null,te(t.value,C=>(c(),u("td",{key:`new-${C}`,class:"week-data-cell"},m(p("new",C)),1))),128))]),s("tr",hv,[T[8]||(T[8]=s("td",{class:"data-type-cell"},"–ó–∞–∫—Ä—ã—Ç—ã–µ",-1)),(c(!0),u(ee,null,te(t.value,C=>(c(),u("td",{key:`closed-${C}`,class:"week-data-cell"},m(p("closed",C)),1))),128))]),s("tr",fv,[T[9]||(T[9]=s("td",{class:"data-type-cell"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),(c(!0),u(ee,null,te(t.value,C=>(c(),u("td",{key:`carryover-${C}`,class:"week-data-cell"},m(p("carryover",C)),1))),128))])])])])])]))}},pv=ce(vv,[["__scopeId","data-v-31a3d565"]]),yv={class:"months-preloader"},kv={class:"preloader-content"},bv={class:"progress-container"},_v={class:"progress-bar"},wv={class:"progress-text"},Cv={class:"preloader-message"},Tv={class:"stages-list"},Sv={class:"stage-icon"},Dv={class:"stage-text"},Ev={__name:"MonthsModePreloader",props:{progress:{type:Number,required:!0,validator:o=>o>=0&&o<=100},currentStage:{type:String,default:""}},setup(o){const e=o,a=[{label:"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",threshold:5},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 1)...",threshold:35},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 2)...",threshold:65},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 3)...",threshold:85},{label:"–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...",threshold:90},{label:"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",threshold:100}];function t(r){return e.progress>=a[r].threshold}function l(r){const n=a[r].threshold,i=r>0?a[r-1].threshold:0;return e.progress>=i&&e.progress<n}return(r,n)=>(c(),u("div",yv,[s("div",kv,[n[0]||(n[0]=_t('<div class="preloader-spinner" data-v-b571fe67><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div></div><h3 class="preloader-title" data-v-b571fe67>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 3 –º–µ—Å—è—Ü–∞</h3>',2)),s("div",bv,[s("div",_v,[s("div",{class:"progress-fill",style:we({width:`${o.progress}%`})},null,4)]),s("div",wv,m(Math.round(o.progress))+"%",1)]),s("p",Cv,m(o.currentStage),1),s("div",Tv,[(c(),u(ee,null,te(a,(i,d)=>s("div",{key:d,class:X(["stage-item",{"stage-completed":t(d),"stage-current":l(d)}])},[s("span",Sv,m(t(d)?"‚úì":l(d)?"‚Üí":"‚óã"),1),s("span",Dv,m(i.label),1)],2)),64))])])]))}},Av=ce(Ev,[["__scopeId","data-v-b571fe67"]]),$v={class:"ac-dashboard-months"},Iv={key:"content"},Mv={class:"dashboard-header"},Nv={class:"header-content"},xv={class:"breadcrumbs-row"},Lv=["aria-label","aria-disabled","data-fallback","disabled"],Pv={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Ov={class:"dashboard-layout"},Bv={class:"filters-container"},Rv={class:"chart-container"},Wv={__name:"GraphAdmissionClosureMonthsDashboard",setup(o){const e=Xe(),a=I(!0),t=I(0),l=I("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."),r=I(null),n=I(null),i=I({newTickets:0,closedTickets:0,carryoverTickets:0,newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[],previousPeriodData:{newTickets:null,closedTickets:null,carryoverTickets:null}}),d=I(!1),g=$(()=>typeof window>"u"?!1:window.history.length>1),v=$(()=>g.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),w={name:"dashboard-sector-1c"};function f(N){if(N?.preventDefault?.(),!d.value){d.value=!0;try{if(g.value){e.back();return}console.warn("GraphAdmissionClosureMonthsDashboard: fallback navigation to dashboard-sector-1c"),e.push(w)}finally{d.value=!1}}}const p=I({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),y=$(()=>{const N=p.value.customDateRange.startDate||p.value.customDateRange.endDate,B=p.value.employees.length===1&&p.value.employees.includes("all");return N||!B});async function T(N,B,W=500){const G=t.value,q=10,oe=(N-G)/q,Y=W/q;for(let H=0;H<q;H++)await new Promise(Z=>setTimeout(Z,Y)),t.value=Math.min(G+oe*(H+1),N);t.value=N,l.value=B}async function C(){console.log("[DEBUG MonthsDashboard] loadData called"),console.log("[DEBUG MonthsDashboard] isLoading before:",a.value),a.value=!0,r.value=null,t.value=0,l.value="–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",console.log("[DEBUG MonthsDashboard] isLoading set to true");let N=null,B=null;try{console.log("[DEBUG MonthsDashboard] Starting API call"),await T(5,"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",200);const W=Date.now(),G=2e4;N=setInterval(()=>{const H=Date.now()-W,Z=Math.min(5+H/G*85,90);t.value=Z,Z<35?l.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 1)...":Z<65?l.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 2)...":Z<85?l.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 3)...":l.value="–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö..."},500),B=setTimeout(()=>{N&&(clearInterval(N),N=null)},G+1e4);const q=await Ut({product:"1C",periodMode:"months",includeTickets:!0});clearTimeout(B),N&&(clearInterval(N),N=null),t.value=90,l.value="–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞",await T(100,"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",300),console.log("[DEBUG MonthsDashboard] API call successful, result:",q);const{meta:oe,data:Y}=q;n.value=oe,i.value=Y,console.log("[DEBUG MonthsDashboard] Data set, meta:",oe,"data keys:",Object.keys(Y)),await new Promise(H=>setTimeout(H,200))}catch(W){N&&(clearInterval(N),N=null),B&&(clearTimeout(B),B=null),console.error("[DEBUG MonthsDashboard] API call failed:",W),r.value=W instanceof Error?W:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureMonthsDashboard] loadData error:",W),t.value=100,l.value="–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö"}finally{console.log("[DEBUG MonthsDashboard] Finally block: setting isLoading to false"),a.value=!1,console.log("[DEBUG MonthsDashboard] isLoading after:",a.value)}}function k(N){p.value.stages=N}function S(N){p.value.employees=N}function x(N){p.value.dateRange=N}function U(N){p.value.customDateRange=N}function L(){p.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},E()}function E(){C()}function D(N){if(!["weeks","months"].includes(N)){console.warn("[GraphAdmissionClosureMonthsDashboard] Invalid periodMode:",N);return}N==="weeks"&&window.dispatchEvent(new CustomEvent("period-mode-change",{detail:{mode:N}}))}return $e(()=>{console.log("[DEBUG MonthsDashboard] onMounted called"),console.log("[DEBUG MonthsDashboard] isLoading before loadData:",a.value),C()}),(N,B)=>{const W=be("router-link");return c(),u("div",$v,[ne(Ae,{name:"fade",mode:"out-in"},{default:ye(()=>[a.value?(c(),he(Av,{key:"preloader",progress:t.value,"current-stage":l.value},null,8,["progress","current-stage"])):(c(),u("div",Iv,[s("div",Mv,[s("div",Nv,[s("div",xv,[s("button",{class:"btn-back-link",type:"button",onClick:f,"aria-label":v.value,"aria-disabled":!g.value,"data-fallback":!g.value,disabled:d.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,Lv),s("nav",Pv,[ne(W,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ye(()=>[...B[0]||(B[0]=[ge(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),B[2]||(B[2]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ne(W,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:ye(()=>[...B[1]||(B[1]=[ge(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),B[3]||(B[3]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),B[4]||(B[4]=s("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),B[5]||(B[5]=s("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),B[6]||(B[6]=s("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),s("div",Ov,[s("div",Bv,[ne(ja,{stages:p.value.stages,employees:p.value.employees,dateRange:p.value.dateRange,customDateRange:p.value.customDateRange,hasActiveFilters:y.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":"months","onUpdate:stages":k,"onUpdate:employees":S,"onUpdate:dateRange":x,"onUpdate:customDateRange":U,"onUpdate:periodMode":D,onReset:L,onApply:E},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])]),s("div",Rv,[r.value?(c(),he(ba,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:r.value.message},null,8,["message"])):(c(),u(ee,{key:1},[ne(Ff,{data:i.value},null,8,["data"]),ne(pv,{data:i.value,meta:n.value},null,8,["data","meta"])],64))])])]))]),_:1})])}}},Uv=ce(Wv,[["__scopeId","data-v-fe3ca7ed"]]);class va{static async getSectorData(){try{const e=await this.getAllTickets();console.log("Total tickets loaded:",e.length);const a=this.extractUniqueEmployeeIds(e);console.log("Unique employee IDs:",a);const t=await this.getEmployeesByIds(a);return console.log("Loaded employees:",t.length),{stages:this.groupTicketsByStages(e,t),employees:t,zeroPointTickets:this.getZeroPointTickets(e)}}catch(e){throw console.error("Error getting sector data:",e),e}}static async getAllTickets(){const e=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],a=[];for(const t of e){console.log(`Loading tickets for stage: ${t}`);const l=await this.getTicketsByStage(t);a.push(...l),console.log(`Loaded ${l.length} tickets for stage ${t}`)}return a}static async getTicketsByStage(e){const a=[];let t=0;const l=50;let r=!0;for(;r;)try{const d=await new vt().call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:e},select:["*"],order:{id:"DESC"},start:t,useOriginalUfNames:"Y"});let g=[];d&&d.result&&(Array.isArray(d.result)?g=d.result:d.result.items&&Array.isArray(d.result.items)?g=d.result.items:d.result.data&&Array.isArray(d.result.data)&&(g=d.result.data)),g.length>0?(a.push(...g),t+=g.length,r=g.length===l):r=!1}catch(i){console.error(`Error loading tickets batch for stage ${e} (start: ${t}):`,i),r=!1}a.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(a[0],null,2)),console.log("Sample ticket keys:",Object.keys(a[0])),console.log("Sample ticket assignedById variants:",{assignedById:a[0].assignedById,assignedByIdId:a[0].assignedByIdId,ASSIGNED_BY_ID:a[0].ASSIGNED_BY_ID}));const n=a.filter(i=>{const d=i.UF_CRM_7_TYPE_PRODUCT||i.uf_crm_7_type_product||i.ufCrm7TypeProduct||i.UF_CRM_7_TYPE_PRODUCT||i.uf_crm_7_type_product;return Array.isArray(d)?d.includes(this.SECTOR_TAG):typeof d=="object"&&d!==null?d.value===this.SECTOR_TAG||d===this.SECTOR_TAG:d===this.SECTOR_TAG});return console.log(`Filtered ${n.length} tickets from ${a.length} for stage ${e} (sector tag: ${this.SECTOR_TAG})`),n}static extractUniqueEmployeeIds(e){if(!Array.isArray(e))return[];const a=new Set;return e.forEach(t=>{const l=t.assignedById||t.assignedByIdId||t.ASSIGNED_BY_ID||t.assignedById||t.assignedById&&typeof t.assignedById=="object"&&(t.assignedById.id||t.assignedById.ID)||t.assignedById&&typeof t.assignedById=="object"&&t.assignedById.value;if(l){const r=parseInt(l);r&&!isNaN(r)&&r>0&&a.add(r)}}),e.length>0&&(console.log("Sample ticket for employee extraction:",e[0]),console.log("Sample ticket assignedById variants:",{assignedById:e[0].assignedById,assignedByIdId:e[0].assignedByIdId,ASSIGNED_BY_ID:e[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(a))),Array.from(a)}static async getEmployeesByIds(e){if(!Array.isArray(e)||e.length===0)return[];try{const t=await new vt().call("user.get",{filter:{ID:e}});let l=[];return t&&t.result&&(Array.isArray(t.result)?l=t.result:console.warn("Unexpected user.get result format:",t)),l.map(r=>({id:parseInt(r.ID||r.id||0),name:`${r.NAME||r.name||""} ${r.LAST_NAME||r.lastName||""}`.trim()||r.EMAIL||r.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:r.WORK_POSITION||r.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:r.EMAIL||r.email||"",tickets:[]}))}catch(a){return console.error("Error getting employees by IDs:",a),[]}}static groupTicketsByStages(e,a){Array.isArray(e)||(console.warn("Tickets is not an array:",e),e=[]),Array.isArray(a)||(console.warn("Employees is not an array:",a),a=[]);const t=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:a.map(l=>({...l,tickets:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:a.map(l=>({...l,tickets:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:a.map(l=>({...l,tickets:[]}))}];return e.forEach(l=>{const r=this.mapStageId(l.stageId||l.STAGE_ID||""),n=t.find(i=>i.id===r);if(n){const i=l.assignedById||l.ASSIGNED_BY_ID||null,d=i?parseInt(i):null;if(d){let g=n.employees.find(v=>v.id===d);g||(g={id:d,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${d}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",tickets:[]},n.employees.push(g)),g.tickets.push(this.mapTicket(l))}}}),t}static mapStageId(e){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[e]||"formed"}static mapStageIdToBitrix(e){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[e]||"DT140_12:UC_0VHWE2"}static mapTicket(e){const a=parseInt(e.id||e.ID||0),t=e.title||e.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",l=e.stageId||e.STAGE_ID||"",r=e.assignedById||e.ASSIGNED_BY_ID||null,n=e.createdTime||e.CREATED_DATE||e.CREATED_TIME||"",i=e.updatedTime||e.MODIFY_DATE||e.UPDATED_TIME||"",d=e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.ufCrm7UfPriority||e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.priority||e.PRIORITY||null,g=La(d),v=bs(g);return{id:a,title:t,priorityId:g.id,priorityLabel:g.label,priorityColors:v,priority:g.id,priorityBitrixValue:g.bitrixValue||null,status:this.mapStatus(l),assigneeId:r?parseInt(r):null,stageId:this.mapStageId(l),createdAt:n,modifiedAt:i,amount:e.opportunity||e.OPPORTUNITY||0,currency:e.currencyId||e.CURRENCY_ID||"RUB",description:e.comments||e.COMMENTS||""}}static mapPriority(e){return La(e).id}static mapPriorityToBitrix(e){if(e&&typeof e=="object")return e.bitrixValue||null;const a=as(e);if(a&&a.bitrixValue)return a.bitrixValue;const t={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return t[e]?t[e]:as(po).bitrixValue}static mapStatus(e){return"in_progress"}static getZeroPointTickets(e){const a={formed:[],review:[],execution:[]};return Array.isArray(e)?(e.filter(t=>!(t.assignedById||t.ASSIGNED_BY_ID)).forEach(t=>{const l=this.mapStageId(t.stageId||t.STAGE_ID||"");a[l]&&a[l].push(this.mapTicket(t))}),a):(console.warn("Tickets is not an array in getZeroPointTickets:",e),a)}static async assignTicket(e,a,t){try{const l=this.mapStageIdToBitrix(t);return(await new vt().call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:e,fields:{assignedById:a,stageId:l}})).result===!0}catch(l){throw console.error("Error assigning ticket:",l),l}}static async createTicket(e){try{const t=await new vt().call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:e.title,assignedById:e.employeeId,stageId:this.mapStageIdToBitrix(e.stageId)}});return t.result?parseInt(t.result):0}catch(a){throw console.error("Error creating ticket:",a),a}}static async getTicket(e){try{const t=await new vt().call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:e});return this.mapTicket(t.result)}catch(a){throw console.error("Error getting ticket:",a),a}}static async addComment(e,a){try{return(await new vt().call("crm.timeline.comment.add",{fields:{entityId:e,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:a}})).result!==void 0}catch(t){throw console.error("Error adding comment:",t),t}}}Ke(va,"ENTITY_TYPE_ID",140),Ke(va,"SECTOR_TAG","1C");const Fv=Object.freeze(Object.defineProperty({__proto__:null,DashboardSector1CService:va},Symbol.toStringTag,{value:"Module"}));function Hv(o){if(!o)return null;try{const e=new Date(o);return isNaN(e.getTime())?null:e}catch{return console.warn("Invalid date format:",o),null}}function jv(o,e){return Math.floor((o-e)/864e5)}function Vv(o){return!o||isNaN(o.getTime())?!1:o<=new Date}const lt={ONE_MONTH:"one_month",TWO_MONTHS:"two_months",MORE_THAN_HALF_YEAR:"more_than_half_year",MORE_THAN_YEAR:"more_than_year"},Rt={[lt.ONE_MONTH]:"–û–¥–∏–Ω –º–µ—Å—è—Ü",[lt.TWO_MONTHS]:"–î–≤–∞ –º–µ—Å—è—Ü–∞",[lt.MORE_THAN_HALF_YEAR]:"–ë–æ–ª–µ–µ –ø–æ–ª—É–≥–æ–¥–∞",[lt.MORE_THAN_YEAR]:"–ë–æ–ª–µ–µ –≥–æ–¥–∞"},ns={[lt.ONE_MONTH]:30,[lt.TWO_MONTHS]:60,[lt.MORE_THAN_HALF_YEAR]:180,[lt.MORE_THAN_YEAR]:365};function pa(o,e,a=new Date){if(!Array.isArray(o))return console.warn("filterTicketsByTimePeriod: tickets must be an array"),[];if(!ns[e])return console.warn(`filterTicketsByTimePeriod: Unknown period "${e}"`),o;const t=ns[e],l=e.includes("more_than");return o.filter(r=>{try{if(!r||!r.id||!r.created_at)return console.warn("Ticket missing required fields:",r),!1;const n=Hv(r.created_at);if(!n)return console.warn(`Invalid date for ticket ${r.id}: ${r.created_at}`),!1;if(!Vv(n))return console.warn(`Future or invalid date for ticket ${r.id}: ${r.created_at}`),!1;const i=jv(a,n);return l?i>t:i<=t}catch(n){return console.error(`Error filtering ticket ${r?.id||"unknown"}:`,n),!1}})}const zv={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Gv={class:"modal"},Kv={key:0,class:"modal__tabs"},qv={key:"level-0-categories",class:"level-0"},Yv={class:"modal__header"},Xv={class:"modal__title"},Jv={key:0},Zv={class:"modal__body"},Qv={class:"categories-list"},ep=["onClick"],tp={class:"category-item"},ap={class:"category-item__icon"},sp={key:0},op={key:1},np={class:"category-item__content"},rp={class:"category-item__label"},lp={class:"category-item__count"},ip={key:0,class:"category-item__arrow"},cp={class:"modal__footer"},dp={key:"level-1-categories",class:"level-1"},up={class:"modal__header"},gp={class:"modal__body"},mp={key:"loading",class:"loading-names"},hp={key:"empty",class:"modal__empty"},fp={key:"list",class:"responsible-list"},vp=["onClick"],pp={class:"responsible-list__name"},yp={class:"responsible-list__count"},kp={key:0,class:"responsible-list__arrow"},bp={class:"modal__footer"},_p={key:"level-2-categories",class:"level-2"},wp={class:"modal__header"},Cp={class:"modal__title"},Tp={class:"modal__body"},Sp={class:"time-sort-controls"},Dp={class:"time-sort-buttons"},Ep=["onClick"],Ap={class:"count"},$p={key:"loading",class:"loading-state"},Ip={key:"error",class:"error-state"},Mp={class:"error-message"},Np={key:"empty",class:"empty-state"},xp={class:"empty-state-message"},Lp={key:"tickets",class:"tickets-list-container"},Pp={key:"level-0-employees",class:"level-0"},Op={class:"modal__header"},Bp={class:"modal__title"},Rp={key:0},Wp={class:"modal__body"},Up={key:"loading",class:"loading-names"},Fp={key:"empty",class:"modal__empty"},Hp={key:"list",class:"responsible-list"},jp=["onClick"],Vp={class:"responsible-list__name"},zp={class:"responsible-list__count"},Gp={key:0,class:"responsible-list__arrow"},Kp={class:"modal__footer"},qp={key:"level-1-employees",class:"level-1"},Yp={class:"modal__header"},Xp={class:"modal__title"},Jp={class:"modal__body"},Zp={class:"categories-list"},Qp=["onClick"],ey={class:"category-item"},ty={class:"category-item__icon"},ay={key:0},sy={key:1},oy={class:"category-item__content"},ny={class:"category-item__label"},ry={class:"category-item__count"},ly={key:0,class:"category-item__arrow"},iy={class:"modal__footer"},cy={key:"level-2-employees",class:"level-2"},dy={class:"modal__header"},uy={class:"modal__title"},gy={class:"modal__body"},my={key:"loading",class:"loading-state"},hy={key:"error",class:"error-state"},fy={class:"error-message"},vy={key:"empty",class:"empty-state"},py={class:"empty-state-message"},yy={key:"tickets",class:"tickets-list-container"},ky={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(o){const e=o,a=I(0),t=I("categories"),l=I(null),r=I(null),n=I(null),i=I([]),d=I(!1),g=I(null),v=I([]),w=I([]),f=I(!1),p=I(lt.ONE_MONTH),y=$(()=>[{id:"created-this-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é",count:e.closedTicketsCreatedThisWeek??0,responsible:e.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ",count:e.closedTicketsCreatedOtherWeek??0,responsible:e.responsibleCreatedOtherWeek??[]}]),T=$(()=>{const P=new Map;return(e.responsibleCreatedThisWeek||[]).forEach(h=>{const _=h.id??"unassigned";P.has(_)||P.set(_,{id:h.id,name:h.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const R=P.get(_);R.thisWeekCount=h.count??0,R.thisWeekTickets=h.tickets||[],R.totalCount+=R.thisWeekCount}),(e.responsibleCreatedOtherWeek||[]).forEach(h=>{const _=h.id??"unassigned";P.has(_)||P.set(_,{id:h.id,name:h.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const R=P.get(_);R.otherWeekCount=h.count??0,R.otherWeekTickets=h.tickets||[],R.totalCount+=R.otherWeekCount}),Array.from(P.values())}),C=$(()=>{if(!r.value)return[];const P=r.value.thisWeekTickets||[],h=r.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:r.value.id,name:r.value.name,thisWeekCount:r.value.thisWeekCount,otherWeekCount:r.value.otherWeekCount,thisWeekTickets:P.length,otherWeekTickets:h.length,employee:r.value}),[{id:"this-week",label:"–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ",count:r.value.thisWeekCount??0,tickets:P,employeeId:r.value.id},{id:"other-week",label:"–ù–∞ –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ",count:r.value.otherWeekCount??0,tickets:h,employeeId:r.value.id}]}),k=$(()=>(w.value||[]).length>0),S=$(()=>{if(!i.value||i.value.length===0)return[];try{const P=performance.now(),h=pa(i.value,p.value),_=performance.now();return console.log(`[ResponsibleModal] Filtering took ${(_-P).toFixed(2)}ms, results: ${h.length}`),h}catch(P){return console.error("[ResponsibleModal] Error filtering tickets:",P),[]}}),x=$(()=>Object.keys(Rt).map(P=>({key:P,label:Rt[P],count:pa(i.value,P).length})));async function U(P){const h=P.filter(_=>_.id!==null&&_.id!==void 0).map(_=>_.id);if(h.length===0)return P;try{const _=await va.getEmployeesByIds(h),R=new Map;return _.forEach(re=>{R.set(re.id,re.name)}),P.map(re=>re.id&&R.has(re.id)?{...re,name:R.get(re.id)}:re)}catch(_){return console.error("[ResponsibleModal] Error enriching names:",_),P}}Ne([()=>t.value,()=>T.value],async([P,h])=>{if(!(P!=="employees"||a.value!==0)){if(!h||h.length===0){w.value=[];return}f.value=!0;try{w.value=await U(h)}catch(_){console.error("[ResponsibleModal] Error loading employee names:",_),w.value=h}finally{f.value=!1}}},{immediate:!0}),Ne(()=>e.responsible,async P=>{if(!(a.value!==0||l.value||t.value!=="categories")){if(!P||P.length===0){v.value=[];return}f.value=!0;try{v.value=await U(P)}catch(h){console.error("[ResponsibleModal] Error loading employee names:",h),v.value=P}finally{f.value=!1}}},{immediate:!1});const L=$(()=>(v.value||[]).length>0);function E(P){t.value!==P&&(t.value=P,a.value=0,l.value=null,r.value=null,n.value=null,i.value=[],g.value=null,v.value=[],w.value=[])}async function D(P){if(!P||P.count===0){console.warn("[ResponsibleModal] handleCategoryClick: Invalid category or count is 0",{category:P,count:P?.count});return}console.log("[ResponsibleModal] handleCategoryClick called:",{categoryId:P.id,categoryLabel:P.label,categoryCount:P.count,responsibleCount:P.responsible?.length||0,responsibleWithTickets:P.responsible?.filter(h=>h.tickets&&h.tickets.length>0).length||0,responsibleSample:P.responsible?.slice(0,2).map(h=>({id:h.id,name:h.name,count:h.count,hasTickets:!!h.tickets,ticketsCount:h.tickets?.length||0}))}),l.value=P,a.value=1,f.value=!0;try{v.value=await U(P.responsible),console.log("[ResponsibleModal] After enrichResponsibleWithNames:",{enrichedCount:v.value.length,enrichedSample:v.value.slice(0,2).map(h=>({id:h.id,name:h.name,count:h.count,hasTickets:!!h.tickets,ticketsCount:h.tickets?.length||0}))})}catch(h){console.error("[ResponsibleModal] Error loading employee names:",h),v.value=P.responsible}finally{f.value=!1}}async function N(P,h=null){!P||!P.id||P.totalCount===0||(h&&h.currentTarget&&(h.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{h.currentTarget&&(h.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:P.id,name:P.name,thisWeekCount:P.thisWeekCount,otherWeekCount:P.otherWeekCount,thisWeekTickets:P.thisWeekTickets?.length||0,otherWeekTickets:P.otherWeekTickets?.length||0,employee:P}),r.value={...P,thisWeekTickets:P.thisWeekTickets||[],otherWeekTickets:P.otherWeekTickets||[]},a.value=1)}async function B(P){if(!P||P.count===0)return;n.value=P,a.value=2;const h=P.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:P.id,label:P.label,count:P.count,ticketsInGradation:h.length,selectedEmployee:r.value?.id}),h.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",h.length),await W(h)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await G(P))}async function W(P){d.value=!0,g.value=null;try{try{const{prepareTicketsForDisplay:h}=await Ee(async()=>{const{prepareTicketsForDisplay:_}=await import("./chunk-DaswhI4P.js").then(R=>R.t);return{prepareTicketsForDisplay:_}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);i.value=await h(P,null,null)}catch(h){console.error("[ResponsibleModal] Error preparing tickets:",h),i.value=P}i.value.length===0&&(g.value=null)}catch(h){g.value=h.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",h),i.value=[]}finally{d.value=!1}}async function G(P){d.value=!0,g.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc||!r.value)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫");const h=await Ut({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeTickets:!0}),re=(P.id==="this-week"?h.data.responsibleCreatedThisWeek:h.data.responsibleCreatedOtherWeek)?.find(ie=>ie.id===r.value.id)?.tickets||[];try{const{prepareTicketsForDisplay:ie}=await Ee(async()=>{const{prepareTicketsForDisplay:se}=await import("./chunk-DaswhI4P.js").then(me=>me.t);return{prepareTicketsForDisplay:se}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);i.value=await ie(re,null,null)}catch(ie){console.error("[ResponsibleModal] Error preparing tickets:",ie),i.value=re}i.value.length===0&&(g.value=null)}catch(h){g.value=h.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets from API:",h),i.value=[]}finally{d.value=!1}}async function q(P,h=null){!P||!P.id||P.count===0||(h&&h.currentTarget&&(h.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{h.currentTarget&&(h.currentTarget.style.transform="")},150)),r.value=P,a.value=2,await oe(P.id))}async function oe(P){d.value=!0,g.value=null;try{let h=[];if(console.log("[ResponsibleModal] loadEmployeeTickets called:",{employeeId:P,selectedCategory:l.value?.id,hasSelectedCategory:!!l.value,hasResponsible:!!l.value?.responsible,responsibleCount:l.value?.responsible?.length||0,categoryData:l.value?{id:l.value.id,label:l.value.label,count:l.value.count,responsibleSample:l.value.responsible?.slice(0,2).map(_=>({id:_.id,name:_.name,count:_.count,hasTickets:!!_.tickets,ticketsCount:_.tickets?.length||0}))}:null}),l.value&&l.value.responsible){const _=l.value.responsible.find(R=>R.id===P);console.log("[ResponsibleModal] Employee found in category:",{employee:_,hasTickets:!!_?.tickets,ticketsCount:_?.tickets?.length||0,tickets:_?.tickets?_.tickets.slice(0,2):null}),h=_?.tickets||[]}if(h.length===0&&e.weekStartUtc&&e.weekEndUtc){console.log("[ResponsibleModal] Tickets not found in category, loading from API",{weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,categoryId:l.value?.id});const _=await Ut({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeTickets:!0});console.log("[ResponsibleModal] API response:",{hasResponsibleCreatedThisWeek:!!_.data.responsibleCreatedThisWeek,hasResponsibleCreatedOtherWeek:!!_.data.responsibleCreatedOtherWeek,thisWeekCount:_.data.responsibleCreatedThisWeek?.length||0,otherWeekCount:_.data.responsibleCreatedOtherWeek?.length||0,thisWeekSample:_.data.responsibleCreatedThisWeek?.slice(0,1).map(ie=>({id:ie.id,name:ie.name,count:ie.count,hasTickets:!!ie.tickets,ticketsCount:ie.tickets?.length||0})),otherWeekSample:_.data.responsibleCreatedOtherWeek?.slice(0,1).map(ie=>({id:ie.id,name:ie.name,count:ie.count,hasTickets:!!ie.tickets,ticketsCount:ie.tickets?.length||0}))});const R=l.value?.id==="created-this-week"?_.data.responsibleCreatedThisWeek:_.data.responsibleCreatedOtherWeek;console.log("[ResponsibleModal] Category data:",{categoryId:l.value?.id,categoryDataCount:R?.length||0,categoryDataSample:R?.slice(0,2).map(ie=>({id:ie.id,name:ie.name,count:ie.count,hasTickets:!!ie.tickets,ticketsCount:ie.tickets?.length||0}))});const re=R?.find(ie=>ie.id===P);console.log("[ResponsibleModal] Employee found in API response:",{employee:re?{id:re.id,name:re.name,count:re.count,hasTickets:!!re.tickets,ticketsCount:re.tickets?.length||0,ticketsSample:re.tickets?.slice(0,2)}:null}),h=re?.tickets||[]}console.log("[ResponsibleModal] Final employeeTickets before prepareTicketsForDisplay:",{ticketsCount:h.length,ticketsSample:h.slice(0,2).map(_=>({id:_.id,title:_.title||_.ufSubject||"No title",stageId:_.stageId}))});try{const{prepareTicketsForDisplay:_}=await Ee(async()=>{const{prepareTicketsForDisplay:R}=await import("./chunk-DaswhI4P.js").then(re=>re.t);return{prepareTicketsForDisplay:R}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);i.value=await _(h,null,null),console.log("[ResponsibleModal] Tickets after prepareTicketsForDisplay:",{ticketsCount:i.value.length,ticketsSample:i.value.slice(0,2).map(R=>({id:R.id,title:R.title||R.ufSubject||"No title",stageId:R.stageId}))})}catch(_){console.error("[ResponsibleModal] Error preparing tickets:",_),console.error("[ResponsibleModal] prepareError details:",{message:_.message,stack:_.stack,employeeTicketsCount:h.length}),i.value=h,console.log("[ResponsibleModal] Using fallback tickets (without enrichment):",i.value.length)}i.value.length===0?(console.warn("[ResponsibleModal] No tickets after loading and preparation",{employeeId:P,categoryId:l.value?.id,employeeTicketsCount:h.length,finalTicketsCount:i.value.length}),g.value=null):console.log("[ResponsibleModal] Successfully loaded tickets:",i.value.length)}catch(h){g.value=h.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",h),console.error("[ResponsibleModal] Error details:",{message:h.message,stack:h.stack,employeeId:P,categoryId:l.value?.id}),i.value=[]}finally{d.value=!1}}function Y(){a.value===2?(a.value=1,t.value==="categories"?r.value=null:n.value=null,i.value=[],g.value=null):a.value===1&&(a.value=0,t.value==="categories"?(l.value=null,v.value=[]):r.value=null)}function H(P){console.log(`[ResponsibleModal] Sort mode changed: ${p.value} -> ${P}`);const h=performance.now();p.value=P,setTimeout(()=>{const _=S.value,R=performance.now();console.log(`[ResponsibleModal] Filtering completed in ${(R-h).toFixed(2)}ms, ${_.length} tickets shown`)},0)}function Z(P){const h=aa(P.id);window.open(h,"_blank")}function fe(){t.value==="employees"&&n.value?W(n.value.tickets):t.value==="categories"&&r.value&&oe(r.value.id)}return Ne(()=>e.isVisible,P=>{if(P){console.log("[TASK-070] ResponsibleModal opened for week",e.weekNumber),console.log("[TASK-070] ResponsibleModal props types:",{responsibleCreatedThisWeekType:typeof e.responsibleCreatedThisWeek,responsibleCreatedThisWeekIsArray:Array.isArray(e.responsibleCreatedThisWeek),responsibleCreatedThisWeekLength:Array.isArray(e.responsibleCreatedThisWeek)?e.responsibleCreatedThisWeek.length:"not array",responsibleCreatedOtherWeekType:typeof e.responsibleCreatedOtherWeek,responsibleCreatedOtherWeekIsArray:Array.isArray(e.responsibleCreatedOtherWeek),responsibleCreatedOtherWeekLength:Array.isArray(e.responsibleCreatedOtherWeek)?e.responsibleCreatedOtherWeek.length:"not array"}),console.log("[TASK-070] ResponsibleModal data:",{weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,responsibleCreatedThisWeek:Array.isArray(e.responsibleCreatedThisWeek)?e.responsibleCreatedThisWeek.length:e.responsibleCreatedThisWeek?"not array":"null/undefined",responsibleCreatedOtherWeek:Array.isArray(e.responsibleCreatedOtherWeek)?e.responsibleCreatedOtherWeek.length:e.responsibleCreatedOtherWeek?"not array":"null/undefined",closedTicketsCreatedThisWeek:e.closedTicketsCreatedThisWeek,closedTicketsCreatedOtherWeek:e.closedTicketsCreatedOtherWeek}),console.log("[TASK-070] ResponsibleModal detailed data:",{responsibleCreatedThisWeek:e.responsibleCreatedThisWeek,responsibleCreatedOtherWeek:e.responsibleCreatedOtherWeek,responsibleCreatedThisWeekWithTickets:Array.isArray(e.responsibleCreatedThisWeek)?e.responsibleCreatedThisWeek.map(_=>({id:_.id,name:_.name,count:_.count,hasTickets:!!_.tickets,ticketsCount:_.tickets?.length||0})):"not array or null",responsibleCreatedOtherWeekWithTickets:Array.isArray(e.responsibleCreatedOtherWeek)?e.responsibleCreatedOtherWeek.map(_=>({id:_.id,name:_.name,count:_.count,hasTickets:!!_.tickets,ticketsCount:_.tickets?.length||0})):"not array or null"});const h=e.weekNumber;h&&console.log("[TASK-070] ResponsibleModal: Week number",h)}else a.value=0,t.value="categories",l.value=null,r.value=null,n.value=null,i.value=[],g.value=null,v.value=[],w.value=[]}),(P,h)=>o.isVisible?(c(),u("div",zv,[s("div",Gv,[a.value===0?(c(),u("div",Kv,[s("button",{class:X(["modal__tab",{"modal__tab--active":t.value==="categories"}]),onClick:h[0]||(h[0]=_=>E("categories"))}," –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º ",2),s("button",{class:X(["modal__tab",{"modal__tab--active":t.value==="employees"}]),onClick:h[1]||(h[1]=_=>E("employees"))}," –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º ",2)])):A("",!0),ne(Ae,{name:"level",mode:"out-in"},{default:ye(()=>[t.value==="categories"&&a.value===0?(c(),u("div",qv,[s("header",Yv,[s("h3",Xv,[h[12]||(h[12]=ge(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),o.weekNumber?(c(),u("span",Jv," ¬∑ –ù–µ–¥–µ–ª—è "+m(o.weekNumber),1)):A("",!0)]),s("button",{class:"modal__close",onClick:h[2]||(h[2]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Zv,[s("ul",Qv,[(c(!0),u(ee,null,te(y.value,_=>(c(),u("li",{key:_.id,class:X(["categories-list__item",{"categories-list__item--clickable":_.count>0}]),onClick:R=>D(_)},[s("div",tp,[s("div",ap,[_.id==="created-this-week"?(c(),u("span",sp,"‚úì")):(c(),u("span",op,"‚Üª"))]),s("div",np,[s("div",rp,m(_.label),1),s("div",lp,m(_.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),_.count>0?(c(),u("span",ip,"‚Üí")):A("",!0)])],10,ep))),128))])]),s("footer",cp,[s("button",{class:"btn",onClick:h[3]||(h[3]=_=>P.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value==="categories"&&a.value===1?(c(),u("div",dp,[s("header",up,[s("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),h[13]||(h[13]=s("h3",{class:"modal__title"},"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s("button",{class:"modal__close",onClick:h[4]||(h[4]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",gp,[ne(Ae,{name:"loading",mode:"out-in"},{default:ye(()=>[f.value?(c(),u("div",mp,[...h[14]||(h[14]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):L.value?(c(),u("ul",fp,[(c(!0),u(ee,null,te(v.value,_=>(c(),u("li",{key:_.id||_.name,class:X(["responsible-list__item",{"responsible-list__item--clickable":_.id&&_.count>0}]),onClick:R=>q(_,R),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[s("span",pp,m(_.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),s("span",yp,m(_.count??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),_.id&&_.count>0?(c(),u("span",kp,"‚Üí")):A("",!0)],10,vp))),128))])):(c(),u("p",hp,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º"))]),_:1})]),s("footer",bp,[s("button",{class:"btn",onClick:h[5]||(h[5]=_=>P.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value==="categories"&&a.value===2?(c(),u("div",_p,[s("header",wp,[s("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),s("h3",Cp,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+m(r.value?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),s("button",{class:"modal__close",onClick:h[6]||(h[6]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Tp,[s("div",Sp,[h[15]||(h[15]=s("h4",{class:"time-sort-title"},"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–∏–∫–µ—Ç—ã:",-1)),s("div",Dp,[(c(!0),u(ee,null,te(x.value,_=>(c(),u("button",{key:_.key,class:X(["time-sort-btn",{active:p.value===_.key}]),onClick:R=>H(_.key)},[ge(m(_.label)+" ",1),s("span",Ap,"("+m(_.count)+")",1)],10,Ep))),128))])]),ne(Ae,{name:"loading",mode:"out-in"},{default:ye(()=>[d.value?(c(),u("div",$p,[...h[16]||(h[16]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):g.value?(c(),u("div",Ip,[h[17]||(h[17]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),h[18]||(h[18]=s("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),s("p",Mp,m(g.value),1),s("button",{class:"btn btn-retry",onClick:fe},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):S.value.length===0?(c(),u("div",Np,[h[19]||(h[19]=s("div",{class:"empty-state-icon"},"üìã",-1)),s("p",xp," –£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ("+m(We(Rt)[p.value])+") ",1)])):(c(),u("div",Lp,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:ye(()=>[(c(!0),u(ee,null,te(S.value,(_,R)=>(c(),he(Ct,{key:_.id,ticket:_,draggable:!1,style:we({"--ticket-index":R}),onClick:Z},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):t.value==="employees"&&a.value===0?(c(),u("div",Pp,[s("header",Op,[s("h3",Bp,[h[20]||(h[20]=ge(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),o.weekNumber?(c(),u("span",Rp," ¬∑ –ù–µ–¥–µ–ª—è "+m(o.weekNumber),1)):A("",!0)]),s("button",{class:"modal__close",onClick:h[7]||(h[7]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Wp,[ne(Ae,{name:"loading",mode:"out-in"},{default:ye(()=>[f.value?(c(),u("div",Up,[...h[21]||(h[21]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):k.value?(c(),u("ul",Hp,[(c(!0),u(ee,null,te(w.value,_=>(c(),u("li",{key:_.id||_.name,class:X(["responsible-list__item",{"responsible-list__item--clickable":_.id&&_.totalCount>0}]),onClick:R=>N(_,R),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞–¥–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[s("span",Vp,m(_.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),s("span",zp,m(_.totalCount??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),_.id&&_.totalCount>0?(c(),u("span",Gp,"‚Üí")):A("",!0)],10,jp))),128))])):(c(),u("p",Fp,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"))]),_:1})]),s("footer",Kp,[s("button",{class:"btn",onClick:h[8]||(h[8]=_=>P.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value==="employees"&&a.value===1?(c(),u("div",qp,[s("header",Yp,[s("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),s("h3",Xp,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+m(r.value?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),s("button",{class:"modal__close",onClick:h[9]||(h[9]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Jp,[s("ul",Zp,[(c(!0),u(ee,null,te(C.value,_=>(c(),u("li",{key:_.id,class:X(["categories-list__item",{"categories-list__item--clickable":_.count>0}]),onClick:R=>B(_)},[s("div",ey,[s("div",ty,[_.id==="this-week"?(c(),u("span",ay,"‚úì")):(c(),u("span",sy,"‚Üª"))]),s("div",oy,[s("div",ny,m(_.label),1),s("div",ry,m(_.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),_.count>0?(c(),u("span",ly,"‚Üí")):A("",!0)])],10,Qp))),128))])]),s("footer",iy,[s("button",{class:"btn",onClick:h[10]||(h[10]=_=>P.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value==="employees"&&a.value===2?(c(),u("div",cy,[s("header",dy,[s("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),s("h3",uy," –¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+m(r.value?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")+" ("+m(n.value?.label||"")+") ",1),s("button",{class:"modal__close",onClick:h[11]||(h[11]=_=>P.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",gy,[ne(Ae,{name:"loading",mode:"out-in"},{default:ye(()=>[d.value?(c(),u("div",my,[...h[22]||(h[22]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):g.value?(c(),u("div",hy,[h[23]||(h[23]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),h[24]||(h[24]=s("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),s("p",fy,m(g.value),1),s("button",{class:"btn btn-retry",onClick:fe},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):i.value.length===0?(c(),u("div",vy,[h[25]||(h[25]=s("div",{class:"empty-state-icon"},"üìã",-1)),s("p",py,m(t.value==="employees"?`–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${n.value?.label||""}"`:"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é"),1)])):(c(),u("div",yy,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:ye(()=>[(c(!0),u(ee,null,te(S.value,(_,R)=>(c(),he(Ct,{key:_.id,ticket:_,draggable:!1,style:we({"--ticket-index":R}),onClick:Z},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):A("",!0)]),_:1})])])):A("",!0)}},by=ce(ky,[["__scopeId","data-v-6f43202a"]]),_y={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},wy={class:"modal"},Cy={key:"level-1",class:"level-1"},Ty={class:"modal__header"},Sy={class:"modal__title"},Dy={key:0},Ey={class:"modal__body"},Ay={key:"loading",class:"loading-names"},$y={key:"empty",class:"modal__empty"},Iy={key:"list",class:"stages-list"},My=["onClick"],Ny={class:"stages-list__name"},xy={class:"stages-list__count"},Ly={key:0,class:"stages-list__arrow"},Py={class:"modal__footer"},Oy={key:"level-2",class:"level-2"},By={class:"modal__header"},Ry={class:"modal__title"},Wy={class:"modal__body"},Uy={class:"time-sort-controls"},Fy={class:"time-sort-buttons"},Hy=["onClick"],jy={class:"count"},Vy={key:"loading",class:"loading-state"},zy={key:"error",class:"error-state"},Gy={class:"error-message"},Ky={key:"empty",class:"empty-state"},qy={class:"empty-state-message"},Yy={key:"tickets",class:"tickets-list-container"},Xy={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(o,{emit:e}){const a=o,t=I(1),l=I(null),r=I([]),n=I(!1),i=I(!1),d=I(null),g=I([]),v=I(lt.ONE_MONTH),w=$(()=>g.value.length>0&&g.value.some(L=>L.count>0)),f=$(()=>{if(!r.value||r.value.length===0)return[];try{const L=performance.now(),E=pa(r.value,v.value),D=performance.now();return console.log(`[StagesModal] Filtering took ${(D-L).toFixed(2)}ms, results: ${E.length}`),E}catch(L){return console.error("[StagesModal] Error filtering tickets:",L),[]}}),p=$(()=>Object.keys(Rt).map(L=>({key:L,label:Rt[L],count:pa(r.value,L).length})));async function y(){if(console.log("[TASK-070] StagesModal: loadStages called",{weekNumber:a.weekNumber,weekStartUtc:a.weekStartUtc,weekEndUtc:a.weekEndUtc}),!a.weekStartUtc||!a.weekEndUtc){console.warn("[TASK-070] StagesModal: Missing week boundaries, cannot load stages"),g.value=[];return}i.value=!0,d.value=null;try{console.log("[TASK-070] StagesModal: Fetching stages from API...");const L=await Ut({product:"1C",weekStartUtc:a.weekStartUtc,weekEndUtc:a.weekEndUtc,includeNewTicketsByStages:!0});console.log("[TASK-070] StagesModal: API response received",{hasNewTicketsByStages:!!L.data.newTicketsByStages,stagesCount:L.data.newTicketsByStages?.length||0}),g.value=L.data.newTicketsByStages||[],g.value.length===0?console.warn("[TASK-070] StagesModal: API returned empty stages array for week",a.weekNumber):console.log("[TASK-070] StagesModal: Stages loaded successfully",g.value.length,"stages")}catch(L){d.value=L.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–π",console.error("[TASK-070] StagesModal: Error loading stages:",L),g.value=[]}finally{i.value=!1}}async function T(L,E=null){!L||L.count===0||(E&&E.currentTarget&&(E.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{E.currentTarget&&(E.currentTarget.style.transform="")},150)),l.value=L,t.value=2,await C(L.stageId))}async function C(L){n.value=!0,d.value=null;try{const E=g.value.find(W=>W.stageId===L);if(E&&Array.isArray(E.tickets)&&E.tickets.length>0){console.log("[TASK-070] StagesModal: Using preloaded tickets for stage",L,"count:",E.tickets.length);const W=E.tickets;try{const{prepareTicketsForDisplay:G}=await Ee(async()=>{const{prepareTicketsForDisplay:q}=await import("./chunk-DaswhI4P.js").then(oe=>oe.t);return{prepareTicketsForDisplay:q}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);r.value=await G(W,null,null)}catch(G){console.error("[TASK-070] StagesModal: Error preparing tickets:",G),r.value=W}n.value=!1;return}if(console.log("[TASK-070] StagesModal: Tickets not preloaded, loading from API for stage",L),!a.weekStartUtc||!a.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const B=(await Ut({product:"1C",weekStartUtc:a.weekStartUtc,weekEndUtc:a.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages?.find(W=>W.stageId===L)?.tickets||[];try{const{prepareTicketsForDisplay:W}=await Ee(async()=>{const{prepareTicketsForDisplay:G}=await import("./chunk-DaswhI4P.js").then(q=>q.t);return{prepareTicketsForDisplay:G}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);r.value=await W(B,null,null)}catch(W){console.error("[StagesModal] Error preparing tickets:",W),r.value=B}r.value.length===0&&(d.value=null)}catch(E){d.value=E.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[StagesModal] Error loading tickets:",E),r.value=[]}finally{n.value=!1}}function k(){t.value=1,l.value=null,r.value=[],d.value=null}function S(L){const E=aa(L.id);window.open(E,"_blank")}function x(){l.value&&C(l.value.stageId)}function U(L){console.log(`[StagesModal] Sort mode changed: ${v.value} -> ${L}`);const E=performance.now();v.value=L,setTimeout(()=>{const D=f.value,N=performance.now();console.log(`[StagesModal] Filtering completed in ${(N-E).toFixed(2)}ms, ${D.length} tickets shown`)},0)}return Ne(()=>a.isVisible,async L=>{L?(t.value=1,l.value=null,r.value=[],d.value=null,console.log("[TASK-070] StagesModal opened:",{weekNumber:a.weekNumber,weekStartUtc:a.weekStartUtc,weekEndUtc:a.weekEndUtc,preloadedData:a.preloadedData?Array.isArray(a.preloadedData)?`Array(${a.preloadedData.length})`:typeof a.preloadedData:"null"}),a.preloadedData&&Array.isArray(a.preloadedData)&&a.preloadedData.length>0?(console.log("[TASK-070] StagesModal: Using preloaded data, stages count:",a.preloadedData.length),a.preloadedData.every(D=>D.stageId&&D.stageName&&typeof D.count=="number")?(g.value=a.preloadedData,i.value=!1,console.log("[TASK-070] StagesModal: Preloaded data set, stages:",g.value.length)):(console.warn("[TASK-070] StagesModal: Invalid preloaded data structure, falling back to API"),await y())):(console.log("[TASK-070] StagesModal: No preloaded data, loading from API",{weekStartUtc:a.weekStartUtc,weekEndUtc:a.weekEndUtc}),await y())):(t.value=1,l.value=null,r.value=[],d.value=null,g.value=[])},{immediate:!1}),Ne([()=>a.weekNumber,()=>a.preloadedData],async([L,E])=>{a.isVisible&&L&&(E&&Array.isArray(E)&&E.length>0?E.every(N=>N.stageId&&N.stageName&&typeof N.count=="number")?(console.log("[TASK-070] StagesModal: Week changed, updating with preloaded data for week",L),g.value=E,i.value=!1):(console.log("[TASK-070] StagesModal: Week changed, invalid preloaded data, loading from API for week",L),await y()):(console.log("[TASK-070] StagesModal: Week changed, loading from API for week",L),await y()))}),(L,E)=>o.isVisible?(c(),u("div",_y,[s("div",wy,[ne(Ae,{name:"level",mode:"out-in"},{default:ye(()=>[t.value===1?(c(),u("div",Cy,[s("header",Ty,[s("h3",Sy,[E[3]||(E[3]=ge(" –ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),o.weekNumber?(c(),u("span",Dy," ¬∑ –ù–µ–¥–µ–ª—è "+m(o.weekNumber),1)):A("",!0)]),s("button",{class:"modal__close",onClick:E[0]||(E[0]=D=>L.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Ey,[ne(Ae,{name:"loading",mode:"out-in"},{default:ye(()=>[i.value?(c(),u("div",Ay,[...E[4]||(E[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–π...",-1)])])):w.value?(c(),u("ul",Iy,[(c(!0),u(ee,null,te(g.value,D=>(c(),u("li",{key:D.stageId,class:X(["stages-list__item",{"stages-list__item--clickable":D.count>0}]),style:we({"--stage-color":D.color}),onClick:N=>T(D,N),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏"},[s("span",{class:"stages-list__color",style:we({backgroundColor:D.color})},null,4),s("span",Ny,m(D.stageName),1),s("span",xy,m(D.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),D.count>0?(c(),u("span",Ly,"‚Üí")):A("",!0)],14,My))),128))])):(c(),u("p",$y," –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),s("footer",Py,[s("button",{class:"btn",onClick:E[1]||(E[1]=D=>L.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value===2?(c(),u("div",Oy,[s("header",By,[s("button",{class:"btn-back",onClick:k,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),s("h3",Ry," –¢–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏: "+m(l.value?.stageName||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),s("button",{class:"modal__close",onClick:E[2]||(E[2]=D=>L.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Wy,[s("div",Uy,[E[5]||(E[5]=s("h4",{class:"time-sort-title"},"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–∏–∫–µ—Ç—ã:",-1)),s("div",Fy,[(c(!0),u(ee,null,te(p.value,D=>(c(),u("button",{key:D.key,class:X(["time-sort-btn",{active:v.value===D.key}]),onClick:N=>U(D.key)},[ge(m(D.label)+" ",1),s("span",jy,"("+m(D.count)+")",1)],10,Hy))),128))])]),ne(Ae,{name:"loading",mode:"out-in"},{default:ye(()=>[n.value?(c(),u("div",Vy,[...E[6]||(E[6]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏...",-1),s("p",{class:"loading-subtitle"},"–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö",-1)])])):d.value?(c(),u("div",zy,[E[7]||(E[7]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),E[8]||(E[8]=s("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),s("p",Gy,m(d.value),1),s("button",{class:"btn btn-retry",onClick:x},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):f.value.length===0?(c(),u("div",Ky,[E[9]||(E[9]=s("div",{class:"empty-state-icon"},"üìã",-1)),s("p",qy," –ù–∞ —Å—Ç–∞–¥–∏–∏ ¬´"+m(l.value?.stageName)+"¬ª –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ("+m(We(Rt)[v.value])+") ",1)])):(c(),u("div",Yy,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:ye(()=>[(c(!0),u(ee,null,te(f.value,(D,N)=>(c(),he(Ct,{key:D.id,ticket:D,draggable:!1,style:we({"--ticket-index":N}),onClick:S},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):A("",!0)]),_:1})])])):A("",!0)}},Jy=ce(Xy,[["__scopeId","data-v-0dacaef9"]]),Pt=new Map,Zy=5*60*1e3;function Qy(o,e){return`${o}:${JSON.stringify(e)}`}function rs(o){return Date.now()-o.timestamp<Zy}function ek(o,e){if(Pt.set(o,{data:e,timestamp:Date.now()}),Pt.size>20){const a=Pt.keys().next().value;Pt.delete(a)}}function tk(o){const e=Pt.get(o);return e&&rs(e)?(console.log("[API-CACHE] Cache hit for key:",o),e.data):(e&&!rs(e)&&(console.log("[API-CACHE] Cache expired for key:",o),Pt.delete(o)),null)}async function ak(o={}){const e="/api/graph-1c-admission-closure.php",a=Qy(e,o),t=tk(e);if(t)return t;console.log("[API-CACHE] Cache miss, making API request for:",a);const{LazyServiceLoader:l}=await Ee(async()=>{const{LazyServiceLoader:i}=await import("./chunk-BPIGQGZw.js").then(d=>d.l);return{LazyServiceLoader:i}},__vite__mapDeps([3,4]),import.meta.url),{fetchAdmissionClosureStats:r}=await l.loadAdmissionClosureService(),n=await r(o);return ek(a,n),n}async function sk(o,e){return ak({product:"1C",weekStartUtc:o,weekEndUtc:e,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})}const ok={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},nk={class:"modal"},rk={key:"level-1",class:"level-1"},lk={class:"modal__header"},ik={class:"modal__title"},ck={key:0},dk={class:"modal__body"},uk={key:"loading",class:"loading-names"},gk={key:"empty",class:"modal__empty"},mk={key:"list",class:"duration-list"},hk=["onClick"],fk={class:"duration-list__name"},vk={class:"duration-list__count"},pk={key:0,class:"duration-list__arrow"},yk={class:"modal__footer"},kk={key:"level-2",class:"level-2"},bk={class:"modal__header"},_k={class:"modal__title"},wk={class:"modal__body"},Ck={key:"loading",class:"loading-state"},Tk={key:"error",class:"error-state"},Sk={class:"error-message"},Dk={key:"empty",class:"empty-state"},Ek={class:"empty-state-message"},Ak={key:"tickets",class:"tickets-list-container"},$k={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(o,{emit:e}){const a=o,t=I(1),l=I(null),r=I([]),n=I(!1),i=I(!1),d=I(null),g=I([]),v=$(()=>g.value.length>0&&g.value.some(k=>k.count>0));async function w(){if(!a.weekStartUtc||!a.weekEndUtc){g.value=[];return}i.value=!0,d.value=null;try{const k=await Ut({product:"1C",weekStartUtc:a.weekStartUtc,weekEndUtc:a.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});g.value=k.data.carryoverTicketsByDuration||[]}catch(k){d.value=k.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π",console.error("[CarryoverDurationModal] Error loading categories:",k),g.value=[]}finally{i.value=!1}}async function f(k,S=null){!k||k.count===0||(S&&S.currentTarget&&(S.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{S.currentTarget&&(S.currentTarget.style.transform="")},150)),l.value=k,t.value=2,await p(k.durationCategory))}async function p(k){n.value=!0,d.value=null;try{const S=g.value.find(E=>E.durationCategory===k);if(S&&Array.isArray(S.tickets)&&S.tickets.length>0){console.log("[TASK-070] CarryoverDurationModal: Using preloaded tickets for category",k,"count:",S.tickets.length);const E=S.tickets;try{const{prepareTicketsForDisplay:D}=await Ee(async()=>{const{prepareTicketsForDisplay:N}=await import("./chunk-DaswhI4P.js").then(B=>B.t);return{prepareTicketsForDisplay:N}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);r.value=await D(E,null,null)}catch(D){console.error("[TASK-070] CarryoverDurationModal: Error preparing tickets:",D),r.value=E}n.value=!1;return}if(console.log("[TASK-070] CarryoverDurationModal: Tickets not preloaded, loading from API for category",k),!a.weekStartUtc||!a.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const L=(await sk(a.weekStartUtc,a.weekEndUtc)).data.carryoverTicketsByDuration?.find(E=>E.durationCategory===k)?.tickets||[];try{const{prepareTicketsForDisplay:E}=await Ee(async()=>{const{prepareTicketsForDisplay:D}=await import("./chunk-DaswhI4P.js").then(N=>N.t);return{prepareTicketsForDisplay:D}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);r.value=await E(L,null,null)}catch(E){console.error("[CarryoverDurationModal] Error preparing tickets:",E),r.value=L}r.value.length===0&&(d.value=null)}catch(S){d.value=S.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[CarryoverDurationModal] Error loading tickets:",S),r.value=[]}finally{n.value=!1}}function y(){t.value=1,l.value=null,r.value=[],d.value=null}function T(k){const S=aa(k.id);window.open(S,"_blank")}function C(){l.value&&p(l.value.durationCategory)}return Ne(()=>a.isVisible,async k=>{k?(t.value=1,l.value=null,r.value=[],d.value=null,a.preloadedData&&Array.isArray(a.preloadedData)&&a.preloadedData.length>0?(console.log("[TASK-070] CarryoverDurationModal: Using preloaded data, categories count:",a.preloadedData.length),a.preloadedData.every(x=>x.durationCategory&&x.durationLabel&&typeof x.count=="number")?(g.value=a.preloadedData,i.value=!1):(console.warn("[TASK-070] CarryoverDurationModal: Invalid preloaded data structure, falling back to API"),await w())):(console.log("[TASK-070] CarryoverDurationModal: No preloaded data, loading from API"),await w())):(t.value=1,l.value=null,r.value=[],d.value=null,g.value=[])},{immediate:!1}),Ne([()=>a.weekNumber,()=>a.preloadedData],async([k,S])=>{a.isVisible&&k&&(S&&Array.isArray(S)&&S.length>0?S.every(U=>U.durationCategory&&U.durationLabel&&typeof U.count=="number")?(console.log("[TASK-070] CarryoverDurationModal: Week changed, updating with preloaded data for week",k),g.value=S,i.value=!1):(console.log("[TASK-070] CarryoverDurationModal: Week changed, invalid preloaded data, loading from API for week",k),await w()):(console.log("[TASK-070] CarryoverDurationModal: Week changed, loading from API for week",k),await w()))}),(k,S)=>o.isVisible?(c(),u("div",ok,[s("div",nk,[ne(Ae,{name:"level",mode:"out-in"},{default:ye(()=>[t.value===1?(c(),u("div",rk,[s("header",lk,[s("h3",ik,[S[3]||(S[3]=ge(" –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ä–æ–∫–∞–º",-1)),o.weekNumber?(c(),u("span",ck," ¬∑ –ù–µ–¥–µ–ª—è "+m(o.weekNumber),1)):A("",!0)]),s("button",{class:"modal__close",onClick:S[0]||(S[0]=x=>k.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",dk,[ne(Ae,{name:"loading",mode:"out-in"},{default:ye(()=>[i.value?(c(),u("div",uk,[...S[4]||(S[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...",-1)])])):v.value?(c(),u("ul",mk,[(c(!0),u(ee,null,te(g.value,x=>(c(),u("li",{key:x.durationCategory,class:X(["duration-list__item",{"duration-list__item--clickable":x.count>0}]),style:we({"--duration-color":x.color}),onClick:U=>f(x,U),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},[s("span",{class:"duration-list__color",style:we({backgroundColor:x.color})},null,4),s("span",fk,m(x.durationLabel),1),s("span",vk,m(x.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),x.count>0?(c(),u("span",pk,"‚Üí")):A("",!0)],14,hk))),128))])):(c(),u("p",gk," –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),s("footer",yk,[s("button",{class:"btn",onClick:S[1]||(S[1]=x=>k.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):t.value===2?(c(),u("div",kk,[s("header",bk,[s("button",{class:"btn-back",onClick:y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),s("h3",_k," –¢–∏–∫–µ—Ç—ã: "+m(l.value?.durationLabel||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),s("button",{class:"modal__close",onClick:S[2]||(S[2]=x=>k.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",wk,[ne(Ae,{name:"loading",mode:"out-in"},{default:ye(()=>[n.value?(c(),u("div",Ck,[...S[5]||(S[5]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...",-1),s("p",{class:"loading-subtitle"},"–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö",-1)])])):d.value?(c(),u("div",Tk,[S[6]||(S[6]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),S[7]||(S[7]=s("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),s("p",Sk,m(d.value),1),s("button",{class:"btn btn-retry",onClick:C},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):r.value.length===0?(c(),u("div",Dk,[S[8]||(S[8]=s("div",{class:"empty-state-icon"},"üìã",-1)),s("p",Ek," –í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´"+m(l.value?.durationLabel)+"¬ª –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ ",1)])):(c(),u("div",Ak,[ne(Qe,{name:"ticket",tag:"div",class:"tickets-list"},{default:ye(()=>[(c(!0),u(ee,null,te(r.value,(x,U)=>(c(),he(Ct,{key:x.id,ticket:x,draggable:!1,style:we({"--ticket-index":U}),onClick:T},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):A("",!0)]),_:1})])])):A("",!0)}},Ik=ce($k,[["__scopeId","data-v-f199806c"]]);function Mk(){const o=I(null),e=I(!1),a=I(null),t=async()=>{if(o.value)return o.value;try{e.value=!0,a.value=null;const{fetchAdmissionClosureStats:n,...i}=await yo.loadAdmissionClosureService();o.value={fetchAdmissionClosureStats:n,...i}}catch(n){throw a.value=n,console.error("Failed to load admission service:",n),n}finally{e.value=!1}return o.value},l=async(n={})=>(await t()).fetchAdmissionClosureStats(n),r=()=>{o.value=null,a.value=null};return{service:wa(o),loading:wa(e),error:wa(a),loadService:t,fetchStats:l,clearService:r}}const Nk={class:"ac-dashboard"},xk={key:"preloader",class:"chart-preloader"},Lk={class:"preloader-content"},Pk={class:"preloader-message"},Ok={key:"content"},Bk={key:1,class:"weeks-dashboard"},Rk={class:"dashboard-header"},Wk={class:"header-content"},Uk={class:"breadcrumbs-row"},Fk=["aria-label","aria-disabled","data-fallback","disabled"],Hk={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},jk={class:"dashboard-layout"},Vk={class:"filters-container"},zk={class:"chart-container"},Gk={__name:"GraphAdmissionClosureDashboard",setup(o){const e=Xe(),{fetchStats:a}=Mk(),t=async b=>await a(b),l=I(!1),r=I(null),n=I(null),i=I({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),d=I(!1),g=I(!1),v=I(!1),w=I(!0),f=I(null),p=I({weeks:new Map,currentWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null},previousWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null}}),y=$(()=>{const b=n.value?.weeks||[];return b.length>=2?b[b.length-2]:null}),T=I(!1),C=$(()=>typeof window>"u"?!1:window.history.length>1),k=$(()=>C.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),S={name:"dashboard-sector-1c"};function x(b){if(b?.preventDefault?.(),!T.value){T.value=!0;try{if(C.value){e.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),e.push(S)}finally{T.value=!1}}}function U(){e.push("/")}const L=I({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),E=I("weeks"),D=$(()=>{const b=L.value.customDateRange.startDate||L.value.customDateRange.endDate,O=L.value.employees.length===1&&L.value.employees.includes("all");return b||!O});async function N(){if(console.log("[DEBUG] loadData called"),console.log("[DEBUG] periodMode:",E.value),console.log("[DEBUG] isLoading before:",l.value),E.value!=="weeks"){console.log("[DEBUG] loadData: periodMode is not weeks, returning and resetting isLoading"),l.value=!1;return}console.log("[DEBUG] Setting isLoading to true"),l.value=!0,r.value=null;const b=new Promise(O=>setTimeout(O,300));try{console.log("[DEBUG] Starting API call");const O=M(),Q=O.weekStartUtc,de=O.weekEndUtc;console.log("[DEBUG] Week bounds:",{weekStartUtc:Q,weekEndUtc:de});const[ke,_e]=await Promise.all([b,t({product:"1C",periodMode:"weeks",weekStartUtc:Q,weekEndUtc:de,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0})]);console.log("[DEBUG] API call successful, result:",_e);const{meta:K,data:j,carryoverDebug:V}=_e;n.value=K;const ae=Array.isArray(j.responsibleCreatedThisWeek)?j.responsibleCreatedThisWeek:j.responsibleCreatedThisWeek?Object.values(j.responsibleCreatedThisWeek):[],ue=Array.isArray(j.responsibleCreatedOtherWeek)?j.responsibleCreatedOtherWeek:j.responsibleCreatedOtherWeek?Object.values(j.responsibleCreatedOtherWeek):[];i.value={...j,responsibleCreatedThisWeek:ae,responsibleCreatedOtherWeek:ue},console.log("[DEBUG] Data set, meta:",K,"data keys:",Object.keys(j)),console.log("[TASK-070] chartData.value.responsibleCreatedThisWeek after normalization:",{isArray:Array.isArray(ae),length:ae.length,sample:ae.slice(0,2).map(F=>({id:F.id,name:F.name,count:F.count,hasTickets:!!F.tickets,ticketsCount:F.tickets?.length||0}))}),console.log("[TASK-070] chartData.value.responsibleCreatedOtherWeek after normalization:",{isArray:Array.isArray(ue),length:ue.length,sample:ue.slice(0,2).map(F=>({id:F.id,name:F.name,count:F.count,hasTickets:!!F.tickets,ticketsCount:F.tickets?.length||0}))}),console.log("[TASK-070] responsibleCreatedThisWeek from API:",{count:j.responsibleCreatedThisWeek?.length||0,data:j.responsibleCreatedThisWeek,details:j.responsibleCreatedThisWeek?.map(F=>({id:F.id,name:F.name,count:F.count,hasTickets:!!F.tickets,ticketsCount:F.tickets?.length||0}))}),console.log("[TASK-070] responsibleCreatedOtherWeek from API:",{count:j.responsibleCreatedOtherWeek?.length||0,data:j.responsibleCreatedOtherWeek,details:j.responsibleCreatedOtherWeek?.map(F=>({id:F.id,name:F.name,count:F.count,hasTickets:!!F.tickets,ticketsCount:F.tickets?.length||0}))}),console.log("[TASK-070] closedTicketsCreatedThisWeek:",j.closedTicketsCreatedThisWeek),console.log("[TASK-070] closedTicketsCreatedOtherWeek:",j.closedTicketsCreatedOtherWeek);const pe=K?.weeks||[];if(console.log("[PERF-OPTIMIZATION] Preloading popup data for",pe.length,"weeks"),pe.forEach((F,le)=>{p.value.weeks.has(F.weekNumber)||p.value.weeks.set(F.weekNumber,{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:F});const ve=p.value.weeks.get(F.weekNumber);le===pe.length-1&&(j.newTicketsByStages&&(ve.newTicketsByStages=j.newTicketsByStages,console.log("[PERF-OPTIMIZATION] Preloaded newTicketsByStages for week",F.weekNumber,":",j.newTicketsByStages.length,"stages")),j.carryoverTicketsByDuration&&(ve.carryoverTicketsByDuration=j.carryoverTicketsByDuration,console.log("[PERF-OPTIMIZATION] Preloaded carryoverTicketsByDuration for week",F.weekNumber,":",j.carryoverTicketsByDuration.length,"categories")))}),j.newTicketsByStages&&(p.value.currentWeek.newTicketsByStages=j.newTicketsByStages),j.carryoverTicketsByDuration&&(p.value.currentWeek.carryoverTicketsByDuration=j.carryoverTicketsByDuration),pe.length>1&&G(pe.slice(0,-1)),j.responsibleCreatedThisWeek){const F=Array.isArray(j.responsibleCreatedThisWeek)?j.responsibleCreatedThisWeek:Object.values(j.responsibleCreatedThisWeek);p.value.currentWeek.responsibleCreatedThisWeek=F,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for current week:",F.length,"employees"),console.log("[TASK-070] responsibleCreatedThisWeek details:",F.map(le=>({id:le.id,name:le.name,count:le.count,hasTickets:!!le.tickets,ticketsCount:le.tickets?.length||0})))}if(j.responsibleCreatedOtherWeek){const F=Array.isArray(j.responsibleCreatedOtherWeek)?j.responsibleCreatedOtherWeek:Object.values(j.responsibleCreatedOtherWeek);p.value.currentWeek.responsibleCreatedOtherWeek=F,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for current week:",F.length,"employees"),console.log("[TASK-070] responsibleCreatedOtherWeek details:",F.map(le=>({id:le.id,name:le.name,count:le.count,hasTickets:!!le.tickets,ticketsCount:le.tickets?.length||0})))}if(V&&(console.log("[CARRYOVER-DEBUG] ========================================"),console.log("[CARRYOVER-DEBUG] Total:",V.total),console.log("[CARRYOVER-DEBUG] ThisWeek:",V.thisWeek),console.log("[CARRYOVER-DEBUG] PreviousWeek:",V.previousWeek),console.log("[CARRYOVER-DEBUG] Older:",V.older),console.log("[CARRYOVER-DEBUG] Sum:",V.sum,"(expected:",V.total,")"),console.log("[CARRYOVER-DEBUG] Series:",V.series),console.log("[CARRYOVER-DEBUG] CurrentWeekData:",V.currentWeekData),console.log("[CARRYOVER-DEBUG] WeeksData:",V.weeksData),console.log("[CARRYOVER-DEBUG] Full object:",V),console.log("[CARRYOVER-DEBUG] ========================================")),y.value){const F=y.value.weekStartUtc,le=y.value.weekEndUtc;console.log("[TASK-070] Starting preload for previous week:",{weekNumber:y.value.weekNumber,weekStartUtc:F,weekEndUtc:le}),t({product:"1C",periodMode:"weeks",weekStartUtc:F,weekEndUtc:le,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0}).then(ve=>{if(console.log("[TASK-070] Preload successful for previous week"),ve.data.newTicketsByStages&&(p.value.previousWeek.newTicketsByStages=ve.data.newTicketsByStages,console.log("[TASK-070] Preloaded newTicketsByStages for previous week:",ve.data.newTicketsByStages.length,"stages")),ve.data.carryoverTicketsByDuration&&(p.value.previousWeek.carryoverTicketsByDuration=ve.data.carryoverTicketsByDuration,console.log("[TASK-070] Preloaded carryoverTicketsByDuration for previous week:",ve.data.carryoverTicketsByDuration.length,"categories")),ve.data.responsibleCreatedThisWeek){const Te=Array.isArray(ve.data.responsibleCreatedThisWeek)?ve.data.responsibleCreatedThisWeek:Object.values(ve.data.responsibleCreatedThisWeek);p.value.previousWeek.responsibleCreatedThisWeek=Te,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for previous week:",Te.length,"employees")}if(ve.data.responsibleCreatedOtherWeek){const Te=Array.isArray(ve.data.responsibleCreatedOtherWeek)?ve.data.responsibleCreatedOtherWeek:Object.values(ve.data.responsibleCreatedOtherWeek);p.value.previousWeek.responsibleCreatedOtherWeek=Te,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for previous week:",Te.length,"employees")}}).catch(ve=>{console.warn("[TASK-070] Failed to preload previous week data (non-critical):",ve)})}}catch(O){console.error("[DEBUG] API call failed:",O),r.value=O instanceof Error?O:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureDashboard] loadData error:",O)}finally{console.log("[DEBUG] Finally block: setting isLoading to false"),l.value=!1,console.log("[DEBUG] isLoading after:",l.value)}}function B(b){if(!b||!n.value)return console.log("[TASK-070] getPreloadedStagesData: Missing weekMeta or chartMeta"),null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber,de=O.length>=2?O[O.length-2].weekNumber:null;console.log("[TASK-070] getPreloadedStagesData:",{requestedWeek:b.weekNumber,currentWeekNumber:Q,previousWeekNumber:de,weeksInMeta:O.length});const ke=b.weekNumber===Q,_e=b.weekNumber===de;let K=null;if(ke)K=p.value.currentWeek.newTicketsByStages,console.log("[TASK-070] Requested week is current week, checking currentWeek data:",K?`Array(${K.length})`:"null");else if(_e)K=p.value.previousWeek.newTicketsByStages,console.log("[TASK-070] Requested week is previous week, checking previousWeek data:",K?`Array(${K.length})`:"null");else return console.log("[TASK-070] Requested week",b.weekNumber,"is neither current nor previous, no preloaded data available"),null;return Array.isArray(K)&&K.length>0?(console.log("[TASK-070] Using preloaded stages data for week",b.weekNumber,":",K.length,"stages"),K):(console.log("[TASK-070] No preloaded stages data for week",b.weekNumber,", will use API fallback"),null)}function W(b){if(!b)return null;const O=p.value.weeks.get(b.weekNumber);if(O?.carryoverTicketsByDuration&&Array.isArray(O.carryoverTicketsByDuration))return console.log("[PERF-OPTIMIZATION] Using preloaded carryover data for week",b.weekNumber,":",O.carryoverTicketsByDuration.length,"categories"),O.carryoverTicketsByDuration;const Q=n.value?.weeks||[],de=Q.length>0?Q[Q.length-1].weekNumber:n.value.weekNumber,_e=b.weekNumber===de?p.value.currentWeek.carryoverTicketsByDuration:p.value.previousWeek.carryoverTicketsByDuration;return Array.isArray(_e)&&_e.length>0?(console.log("[TASK-070] Using fallback preloaded carryover data for week",b.weekNumber,":",_e.length,"categories"),_e):(console.log("[PERF-ISSUE] No preloaded carryover data for week",b.weekNumber,", will use slow API fallback"),null)}async function G(b){if(!(!b||b.length===0)){console.log("[PERF-OPTIMIZATION] Starting background preload for",b.length,"weeks");for(const O of b)try{await new Promise(ke=>setTimeout(ke,500)),console.log("[PERF-OPTIMIZATION] Preloading data for week",O.weekNumber);const Q=await t({product:"1C",periodMode:"weeks",weekStartUtc:O.weekStartUtc,weekEndUtc:O.weekEndUtc,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!1}),de={newTicketsByStages:Q.data.newTicketsByStages||null,carryoverTicketsByDuration:Q.data.carryoverTicketsByDuration||null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:O};p.value.weeks.set(O.weekNumber,de),console.log("[PERF-OPTIMIZATION] Successfully preloaded data for week",O.weekNumber)}catch(Q){console.warn("[PERF-OPTIMIZATION] Failed to preload data for week",O.weekNumber,":",Q)}console.log("[PERF-OPTIMIZATION] Background preload completed")}}function q(b){if(!b||!n.value)return null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber;return b.weekNumber===Q&&i.value.responsible||null}function oe(b){if(!b){const K=i.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: weekMeta is null, using chartData:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:K?Object.keys(K).length:0}),K?Array.isArray(K)?K:Object.values(K):null}if(!n.value)return console.log("[TASK-070] getResponsibleCreatedThisWeek: chartMeta is null"),null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber,de=O.length>=2?O[O.length-2].weekNumber:null,ke=b.weekNumber===Q,_e=b.weekNumber===de;if(console.log("[TASK-070] getResponsibleCreatedThisWeek:",{requestedWeek:b.weekNumber,currentWeekNumber:Q,previousWeekNumber:de,isCurrentWeek:ke,isPreviousWeek:_e}),ke){const K=i.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: current week data:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:K?Object.keys(K).length:0}),K?Array.isArray(K)?K:Object.values(K):null}if(_e){const K=p.value.previousWeek.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: previous week data:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:0,data:K}),K||null}return console.log("[TASK-070] getResponsibleCreatedThisWeek: week",b.weekNumber,"is neither current nor previous, no preloaded data"),null}function Y(b){if(!b){const K=i.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: weekMeta is null, using chartData:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:K?Object.keys(K).length:0}),K?Array.isArray(K)?K:Object.values(K):null}if(!n.value)return console.log("[TASK-070] getResponsibleCreatedOtherWeek: chartMeta is null"),null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber,de=O.length>=2?O[O.length-2].weekNumber:null,ke=b.weekNumber===Q,_e=b.weekNumber===de;if(console.log("[TASK-070] getResponsibleCreatedOtherWeek:",{requestedWeek:b.weekNumber,currentWeekNumber:Q,previousWeekNumber:de,isCurrentWeek:ke,isPreviousWeek:_e}),ke){const K=i.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: current week data:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:K?Object.keys(K).length:0}),K?Array.isArray(K)?K:Object.values(K):null}if(_e){const K=p.value.previousWeek.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: previous week data:",{hasData:!!K,isArray:Array.isArray(K),dataLength:Array.isArray(K)?K.length:0,data:K}),K||null}return console.log("[TASK-070] getResponsibleCreatedOtherWeek: week",b.weekNumber,"is neither current nor previous, no preloaded data"),null}function H(b){if(!b||!n.value)return null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber,de=O.length>=2?O[O.length-2].weekNumber:null,ke=b.weekNumber===Q,_e=b.weekNumber===de;return ke?i.value.closedTicketsCreatedThisWeek??null:_e&&i.value.weeksData?i.value.weeksData.find(j=>j.weekNumber===de)?.closedTicketsCreatedThisWeek??null:null}function Z(b){if(!b||!n.value)return null;const O=n.value?.weeks||[],Q=O.length>0?O[O.length-1].weekNumber:n.value.weekNumber,de=O.length>=2?O[O.length-2].weekNumber:null,ke=b.weekNumber===Q,_e=b.weekNumber===de;return ke?i.value.closedTicketsCreatedOtherWeek??null:_e&&i.value.weeksData?i.value.weeksData.find(j=>j.weekNumber===de)?.closedTicketsCreatedOtherWeek??null:null}function fe(b){L.value.stages=b}function P(b){L.value.employees=b}function h(b){L.value.dateRange=b}function _(b){L.value.customDateRange=b}function R(b){if(!["weeks","months"].includes(b)){console.warn("[GraphAdmissionClosureDashboard] Invalid periodMode:",b);return}b!==E.value&&(E.value=b,b==="weeks"?N():b==="months"&&(l.value=!1))}function re(b){const{mode:O}=b.detail;["weeks","months"].includes(O)&&R(O)}function ie(){L.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},se()}function se(){E.value==="weeks"&&N()}function me(b){["weeks","months"].includes(b)&&(E.value=b)}function Se(){console.log("[DEBUG] handleCloseModal called"),console.log("[DEBUG] showPeriodModeInfo before:",w.value),console.log("[DEBUG] isLoading before:",l.value),console.log("[DEBUG] periodMode:",E.value),w.value=!1,l.value=!0,console.log("[DEBUG] showPeriodModeInfo after:",w.value),console.log("[DEBUG] isLoading after:",l.value),Wt(()=>{console.log("[DEBUG] handleCloseModal: calling handleStartLoading in nextTick"),Ie()})}function Ie(){console.log("[DEBUG] handleStartLoading called"),console.log("[DEBUG] periodMode before check:",E.value),console.log("[DEBUG] showPeriodModeInfo:",w.value),console.log("[DEBUG] isLoading:",l.value),(!E.value||!["weeks","months"].includes(E.value))&&(console.warn('[GraphAdmissionClosureDashboard] Period mode not set, using default "weeks"'),E.value="weeks"),console.log("[GraphAdmissionClosureDashboard] Starting loading, periodMode:",E.value),Wt(()=>{console.log("[DEBUG] nextTick callback, periodMode:",E.value),console.log("[DEBUG] isLoading in nextTick:",l.value),E.value==="weeks"?(console.log("[GraphAdmissionClosureDashboard] Loading data for weeks mode"),N()):E.value==="months"&&(console.log("[GraphAdmissionClosureDashboard] Months mode - data will be loaded by GraphAdmissionClosureMonthsDashboard"),l.value=!1,console.log("[DEBUG] Reset parent isLoading to false for months mode"))})}function xe(b=null){b?f.value=b:f.value={weekNumber:n.value?.weekNumber||null,weekStartUtc:n.value?.weekStartUtc||null,weekEndUtc:n.value?.weekEndUtc||null},g.value=!0}function Fe(b=null){b?f.value=b:f.value={weekNumber:n.value?.weekNumber||null,weekStartUtc:n.value?.weekStartUtc||null,weekEndUtc:n.value?.weekEndUtc||null},d.value=!0}function z(b=null){b?f.value=b:f.value={weekNumber:n.value?.weekNumber||null,weekStartUtc:n.value?.weekStartUtc||null,weekEndUtc:n.value?.weekEndUtc||null},v.value=!0}$e(()=>{try{const b="graph-admission-closure-period-mode-info-shown";localStorage.getItem(b)&&localStorage.removeItem(b);const O="graph-admission-closure-period-mode";localStorage.getItem(O)&&localStorage.removeItem(O)}catch(b){console.warn("[GraphAdmissionClosureDashboard] Failed to clean localStorage:",b)}window.addEventListener("period-mode-change",re)}),at(()=>{window.removeEventListener("period-mode-change",re)});function M(){const b=new Date,O=new Date(Date.UTC(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate())),Q=O.getUTCDay(),de=O.getUTCDate()-Q+(Q===0?-6:1),ke=new Date(Date.UTC(O.getUTCFullYear(),O.getUTCMonth(),de,0,0,0)),_e=new Date(ke);return _e.setUTCDate(_e.getUTCDate()+6),_e.setUTCHours(23,59,59,999),{weekStartUtc:ke.toISOString(),weekEndUtc:_e.toISOString()}}return(b,O)=>{const Q=be("router-link");return c(),u("div",Nk,[ne(Ae,{name:"fade",mode:"out-in"},{default:ye(()=>[l.value?(c(),u("div",xk,[s("div",Lk,[O[3]||(O[3]=s("div",{class:"preloader-spinner"},[s("div",{class:"spinner-ring"}),s("div",{class:"spinner-ring"}),s("div",{class:"spinner-ring"})],-1)),O[4]||(O[4]=s("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞",-1)),s("p",Pk," –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ "+m(E.value==="weeks"?"4 –Ω–µ–¥–µ–ª–∏":"3 –º–µ—Å—è—Ü–∞")+"... ",1),O[5]||(O[5]=s("div",{class:"preloader-dots"},[s("span",{class:"dot"}),s("span",{class:"dot"}),s("span",{class:"dot"})],-1))])])):!w.value&&!l.value?(c(),u("div",Ok,[E.value==="months"?(c(),he(Uv,{key:0})):(c(),u("div",Bk,[s("div",Rk,[s("div",Wk,[s("div",Uk,[s("button",{class:"btn-home-link",type:"button",onClick:U,title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),O[11]||(O[11]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),s("button",{class:"btn-back-link",type:"button",onClick:x,"aria-label":k.value,"aria-disabled":!C.value,"data-fallback":!C.value,disabled:T.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,Fk),s("nav",Hk,[ne(Q,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ye(()=>[...O[6]||(O[6]=[ge(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),O[8]||(O[8]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ne(Q,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:ye(()=>[...O[7]||(O[7]=[ge(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),O[9]||(O[9]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),O[10]||(O[10]=s("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),O[12]||(O[12]=s("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),O[13]||(O[13]=s("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),s("div",jk,[s("div",Vk,[ne(ja,{stages:L.value.stages,employees:L.value.employees,dateRange:L.value.dateRange,customDateRange:L.value.customDateRange,hasActiveFilters:D.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":E.value,"onUpdate:stages":fe,"onUpdate:employees":P,"onUpdate:dateRange":h,"onUpdate:customDateRange":_,"onUpdate:periodMode":R,onReset:ie,onApply:se},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","period-mode"])]),s("div",zk,[r.value?(c(),he(ba,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:r.value.message},null,8,["message"])):(c(),he(Qh,{key:1,meta:n.value,data:i.value,onOpenResponsible:Fe,onOpenStages:xe,onOpenCarryover:z},null,8,["meta","data"]))])])]))])):A("",!0)]),_:1}),ne(by,{"is-visible":d.value,responsible:q(f.value)||i.value.responsible||[],"closed-tickets-created-this-week":H(f.value)??i.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":Z(f.value)??i.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":oe(f.value)||i.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":Y(f.value)||i.value.responsibleCreatedOtherWeek||[],"week-number":f.value?.weekNumber||n.value?.weekNumber||null,"week-start-utc":f.value?.weekStartUtc||n.value?.weekStartUtc||null,"week-end-utc":f.value?.weekEndUtc||n.value?.weekEndUtc||null,onClose:O[0]||(O[0]=de=>{d.value=!1,f.value.value=null})},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),ne(Jy,{"is-visible":g.value,"week-number":f.value?.weekNumber||n.value?.weekNumber||null,"week-start-utc":f.value?.weekStartUtc||n.value?.weekStartUtc||null,"week-end-utc":f.value?.weekEndUtc||n.value?.weekEndUtc||null,"preloaded-data":B(f.value),onClose:O[1]||(O[1]=de=>{g.value=!1,f.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),ne(Ik,{"is-visible":v.value,"week-number":f.value?.weekNumber||n.value?.weekNumber||null,"week-start-utc":f.value?.weekStartUtc||n.value?.weekStartUtc||null,"week-end-utc":f.value?.weekEndUtc||n.value?.weekEndUtc||null,"preloaded-data":W(f.value),onClose:O[2]||(O[2]=de=>{v.value=!1,f.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),w.value?(c(),he(Yg,{key:0,"is-visible":w.value,"current-mode":E.value,onClose:Se,onSelectMode:me},null,8,["is-visible","current-mode"])):A("",!0)])}}},xs=ce(Gk,[["__scopeId","data-v-2fa9296d"]]),Kk=Object.freeze(Object.defineProperty({__proto__:null,default:xs},Symbol.toStringTag,{value:"Module"})),qk={name:"ZeroPoint",components:{TicketCard:Ct},props:{tickets:{type:Array,required:!0,default:()=>[]},stageId:{type:String,required:!0}},emits:{"ticket-dragged":o=>typeof o=="object"&&o!==null,"ticket-assigned":o=>typeof o=="object"&&o!==null,"ticket-clicked":o=>typeof o=="object"&&o!==null},setup(o,{emit:e}){return{hasTickets:$(()=>Array.isArray(o.tickets)&&o.tickets.length>0),handleTicketDragStart:l=>{e("ticket-dragged",l)}}}},Yk={class:"zero-point"},Xk={key:0,class:"empty-state"};function Jk(o,e,a,t,l,r){const n=be("TicketCard");return c(),u("div",Yk,[e[3]||(e[3]=s("div",{class:"zero-point-header"},[s("h3",null,"–ù—É–ª–µ–≤–∞—è —Ç–æ—á–∫–∞")],-1)),ia([a.tickets.length,a.tickets.map(i=>i.id).join(",")],()=>(c(),u("div",{class:"zero-point-tickets"},[(c(!0),u(ee,null,te(a.tickets,i=>(c(),he(n,{key:i.id,ticket:i,draggable:!0,onDragStart:d=>t.handleTicketDragStart(i),onClick:d=>o.$emit("ticket-clicked",i)},null,8,["ticket","onDragStart","onClick"]))),128))])),e,0),e[1]||(Xa(-1,!0),(e[1]=t.hasTickets?A("",!0):(c(),u("div",Xk,[...e[2]||(e[2]=[s("p",null,"–ù–µ—Ç –Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –≤ —Å—Ç–∞–¥–∏–∏",-1)])]))).cacheIndex=1,Xa(1),e[1])])}const Zk=ce(qk,[["render",Jk],["__scopeId","data-v-c5370e55"]]);function Qk(o){return typeof o=="number"&&o>0&&!isNaN(o)}function Ls(o){return typeof o=="number"&&o>0&&!isNaN(o)}function Ps(o){return typeof o=="string"&&["formed","review","execution"].includes(o)}function e0(o){return!o||typeof o!="object"?!1:Qk(o.id)&&typeof o.title=="string"&&o.title.trim().length>0}function Os(o,e,a){return!(!e0(o)||!Ls(e)||!Ps(a)||o.assigneeId===e&&o.stageId===a)}function t0(o){const e=[];return!o||typeof o!="object"?(e.push("–î–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{valid:!1,errors:e}):((!o.title||typeof o.title!="string"||o.title.trim().length===0)&&e.push("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"),o.stageId&&!Ps(o.stageId)&&e.push("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Å—Ç–∞–¥–∏–∏"),o.employeeId&&!Ls(o.employeeId)&&e.push("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"),{valid:e.length===0,errors:e})}function a0(o){const e=mt(),a=I(!1);return{isDropZoneActive:a,handleDragStart:(d,g)=>{d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("application/json",JSON.stringify(g)),d.dataTransfer.setDragImage(d.target,0,0)},handleDragOver:d=>{d.preventDefault(),d.dataTransfer.dropEffect="move",a.value=!0},handleDragLeave:d=>{const g=d.currentTarget.getBoundingClientRect(),v=d.clientX,w=d.clientY;(v<g.left||v>g.right||w<g.top||w>g.bottom)&&(a.value=!1)},handleDrop:async(d,g,v)=>{d.preventDefault(),a.value=!1;const w=d.dataTransfer.getData("application/json");if(w)try{const f=JSON.parse(w);if(!Os(f,g,v)){e.warning("–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–∫–µ—Ç —Å—é–¥–∞");return}o&&typeof o=="function"&&await o(f,g,v)}catch(f){De.error("Error parsing ticket data","useDragAndDrop",f),e.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ç–∞")}},handleDragEnd:d=>{a.value=!1}}}function Bs(o=null){const e=ao(),a=e?.type?.name||e?.type?.__name||null,t=o||a||"Unknown",l=(g,v,w=null)=>{De.log(g,v,t,w)};return{error:(g,v=null)=>{l("ERROR",g,v)},warn:(g,v=null)=>{l("WARN",g,v)},info:(g,v=null)=>{l("INFO",g,v)},debug:(g,v=null)=>{l("DEBUG",g,v)},log:l,context:t}}const s0={name:"EmployeeColumn",components:{TicketCard:Ct},props:{employee:{type:Object,required:!0},stageId:{type:String,required:!0}},emits:["ticket-clicked","ticket-dropped"],setup(o,{emit:e}){Bs("EmployeeColumn");const t=a0(async(v,w,f)=>{e("ticket-dropped",v,w)}),l=$(()=>o.employee.isFromSector1C?Array.isArray(o.employee.tickets)?o.employee.tickets:[]:Array.isArray(o.employee.ticketsInsideSector)?o.employee.ticketsInsideSector:[]),r=$(()=>o.employee.isFromSector1C?[]:Array.isArray(o.employee.ticketsOutsideSector)?o.employee.ticketsOutsideSector:Array.isArray(o.employee.tickets)?o.employee.tickets:[]),n=$(()=>o.employee.isFromSector1C?Array.isArray(o.employee.tickets)?o.employee.tickets:[]:[]),i=$(()=>l.value.length+r.value.length),d=v=>{t.handleDrop(v,o.employee.id,o.stageId)},g=v=>{};return{isDropZoneActive:t.isDropZoneActive,handleDragOver:t.handleDragOver,handleDragLeave:t.handleDragLeave,handleDrop:d,ticketsInsideSector:l,ticketsOutsideSector:r,ticketsToDisplay:n,totalTicketsCount:i,handleTicketDragStart:g}}},o0={class:"employee-header"},n0={class:"employee-info"},r0={class:"employee-details"},l0={class:"employee-name"},i0={key:0,class:"employee-position"},c0={class:"tickets-count"},d0={class:"tickets-list"},u0={class:"section-header"},g0={class:"section-count"},m0={key:2,class:"empty-state"};function h0(o,e,a,t,l,r){const n=be("TicketCard");return c(),u("div",{class:X(["employee-column",{"drop-zone-active":t.isDropZoneActive}]),onDragover:e[3]||(e[3]=Ce((...i)=>t.handleDragOver&&t.handleDragOver(...i),["prevent"])),onDragleave:e[4]||(e[4]=(...i)=>t.handleDragLeave&&t.handleDragLeave(...i)),onDrop:e[5]||(e[5]=(...i)=>t.handleDrop&&t.handleDrop(...i))},[s("div",o0,[s("div",n0,[e[6]||(e[6]=s("span",{class:"employee-icon"},"üë§",-1)),s("div",r0,[s("div",l0,m(a.employee.name),1),a.employee.position?(c(),u("div",i0,m(a.employee.position),1)):A("",!0)])]),s("div",c0," üìä –¢–∏–∫–µ—Ç–æ–≤: "+m(t.totalTicketsCount),1)]),s("div",d0,[a.employee.isFromSector1C?ia([t.ticketsToDisplay.length,t.ticketsToDisplay.map(i=>i.id).join(",")],()=>(c(),u("div",{key:0},[ne(Qe,{name:"ticket",tag:"div"},{default:ye(()=>[(c(!0),u(ee,null,te(t.ticketsToDisplay,i=>(c(),he(n,{key:i.id,ticket:i,draggable:!0,onClick:d=>o.$emit("ticket-clicked",i),onDragStart:t.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),e,0):(c(),u(ee,{key:1},[t.ticketsInsideSector.length>0?ia([t.ticketsInsideSector.length,t.ticketsInsideSector.map(i=>i.id).join(",")],()=>(c(),u("div",{key:0,class:"tickets-section tickets-inside-sector"},[ne(Qe,{name:"ticket",tag:"div"},{default:ye(()=>[(c(!0),u(ee,null,te(t.ticketsInsideSector,i=>(c(),he(n,{key:i.id,ticket:i,draggable:!0,onClick:d=>o.$emit("ticket-clicked",i),onDragStart:t.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),e,1):A("",!0),t.ticketsOutsideSector.length>0?ia([t.ticketsOutsideSector.length,t.ticketsOutsideSector.map(i=>i.id).join(",")],()=>(c(),u("div",{key:1,class:"tickets-section tickets-outside-sector"},[s("div",u0,[e[7]||(e[7]=s("span",{class:"section-badge"},"–í–Ω–µ —Å–µ–∫—Ç–æ—Ä–∞",-1)),s("span",g0,m(t.ticketsOutsideSector.length),1)]),ne(Qe,{name:"ticket",tag:"div"},{default:ye(()=>[(c(!0),u(ee,null,te(t.ticketsOutsideSector,i=>(c(),he(n,{key:i.id,ticket:i,draggable:!0,class:"ticket-outside-sector",onClick:d=>o.$emit("ticket-clicked",i),onDragStart:t.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),e,2):A("",!0)],64)),t.totalTicketsCount===0?(c(),u("div",m0,[...e[8]||(e[8]=[s("p",null,"–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤",-1)])])):A("",!0)])],34)}const f0=ce(s0,[["render",h0],["__scopeId","data-v-cdec5b5c"]]),v0={name:"DashboardStage",components:{ZeroPoint:Zk,EmployeeColumn:f0},props:{stage:{type:Object,required:!0},zeroPointTickets:{type:Array,default:()=>[]}},emits:["ticket-moved","ticket-assigned","ticket-clicked"],setup(o,{emit:e}){const a=Bs("DashboardStage"),t=I(!1),l=$(()=>{const f=Array.isArray(o.zeroPointTickets)?o.zeroPointTickets.length:0,p=Array.isArray(o.stage.employees)?o.stage.employees.reduce((y,T)=>Array.isArray(T.ticketsInsideSector)?y+T.ticketsInsideSector.length:T.isFromSector1C&&Array.isArray(T.tickets)?y+T.tickets.length:y,0):0;return f+p}),r=$(()=>Array.isArray(o.stage.employees)?o.stage.employees.reduce((f,p)=>Array.isArray(p.ticketsOutsideSector)?f+p.ticketsOutsideSector.length:!p.isFromSector1C&&Array.isArray(p.tickets)?f+p.tickets.length:f,0):0),n=$(()=>l.value+r.value),i=$(()=>{const f=o.stage?.name||"–°—Ç–∞–¥–∏—è",p=l.value,y=r.value;return y===0?`${f} (${p})`:`${f} (${p} / ${y})`});return{isDragging:t,ticketsCountInsideSector:l,ticketsCountOutsideSector:r,totalTicketsCount:n,stageNameWithCount:i,handleTicketDragged:f=>{t.value=!0},handleTicketAssigned:(f,p)=>{e("ticket-assigned",f,p)},handleTicketDropped:(f,p)=>{e("ticket-moved",f,p,o.stage.id),t.value=!1},handleTicketClicked:f=>{a.debug("Ticket clicked",f),e("ticket-clicked",f)}}}},p0={class:"stage-header"},y0={class:"stage-content"},k0={class:"employees-container"};function b0(o,e,a,t,l,r){const n=be("ZeroPoint"),i=be("EmployeeColumn");return c(),u("div",{class:"dashboard-stage",style:we({borderLeftColor:a.stage.color})},[s("div",p0,[s("h2",null,m(t.stageNameWithCount),1)]),s("div",y0,[ne(n,{tickets:a.zeroPointTickets,"stage-id":a.stage.id,onTicketDragged:t.handleTicketDragged,onTicketAssigned:t.handleTicketAssigned,onTicketClicked:t.handleTicketClicked},null,8,["tickets","stage-id","onTicketDragged","onTicketAssigned","onTicketClicked"]),s("div",k0,[(c(!0),u(ee,null,te(a.stage.employees,d=>(c(),he(i,{key:d.id,employee:d,"stage-id":a.stage.id,onTicketClicked:t.handleTicketClicked,onTicketDropped:t.handleTicketDropped},null,8,["employee","stage-id","onTicketClicked","onTicketDropped"]))),128))])])],4)}const _0=ce(v0,[["render",b0],["__scopeId","data-v-c6fbde76"]]),$a={cache_check:{title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞",description:"–ü–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."},cache_hit:{title:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",description:"–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞..."},loading_tickets:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24..."},filtering:{title:"–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤",description:"–û—Ç–±–æ—Ä —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°..."},extracting_employees:{title:"–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ê–Ω–∞–ª–∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."},loading_employees:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö..."},grouping:{title:"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",description:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º..."},caching:{title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à",description:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."},complete:{title:"–ì–æ—Ç–æ–≤–æ!",description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"},error:{title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}},w0={loading_tickets:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24..."},filtering:{title:"–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤",description:"–û—Ç–±–æ—Ä —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°..."},extracting_employees:{title:"–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ê–Ω–∞–ª–∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."},loading_employees:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö..."},grouping:{title:"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",description:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º..."},caching:{title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à",description:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."},cache_check:{title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞",description:"–ü–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."},cache_hit:{title:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",description:"–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞..."},complete:{title:"–ì–æ—Ç–æ–≤–æ!",description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"},error:{title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}},C0={name:"LoadingPreloader",props:{currentStep:{type:String,default:null},progress:{type:Number,default:0},stepDetails:{type:Object,default:()=>({})},error:{type:String,default:null}},emits:["retry"],setup(o,{emit:e}){const a=$(()=>{const{currentStep:g,stepDetails:v}=o;return v?.description?{title:g?$a[g]?.title||g:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:v.description}:g?$a[g]?$a[g]:w0[g]||{title:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ..."}:{title:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è..."}}),t=$(()=>a.value.title),l=$(()=>a.value.description),r=$(()=>o.stepDetails),n=$(()=>{const g=o.progress;return g==null||isNaN(g)?0:Math.round(Math.max(0,Math.min(100,g)))});return{stepTitle:t,stepDescription:l,details:r,displayProgress:n,getStageDisplayName:g=>g?{"DT140_12:UC_0VHWE2":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","DT140_12:PREPARATION":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó","DT140_12:CLIENT":"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ","–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"}[g]||g:"",handleRetry:()=>{e("retry")}}}},T0={class:"preloader-backdrop"},S0={class:"preloader-container"},D0={class:"preloader-content-scrollable"},E0={key:0,class:"spinner-container"},A0={class:"preloader-content"},$0={class:"step-title"},I0={key:0,class:"step-description"},M0={key:1,class:"progress-container"},N0={class:"progress-bar"},x0={class:"progress-text"},L0={key:2,class:"step-details"},P0={key:0,class:"detail-description"},O0={key:1,class:"detail-item"},B0={class:"detail-value"},R0={key:0,class:"detail-total"},W0={key:2,class:"detail-item"},U0={class:"detail-value"},F0={key:0,class:"detail-total"},H0={key:3,class:"detail-item"},j0={class:"detail-value"},V0={key:0,class:"detail-total"},z0={key:4,class:"detail-item"},G0={class:"detail-value"},K0={key:5,class:"detail-warning"},q0={key:0,class:"error-container"},Y0={class:"error-content"},X0={class:"error-message"};function J0(o,e,a,t,l,r){return c(),u("div",{class:X(["loading-preloader",{"has-error":a.error}])},[s("div",T0,[s("div",S0,[s("div",D0,[a.error?A("",!0):(c(),u("div",E0,[...e[1]||(e[1]=[s("div",{class:"spinner"},null,-1)])])),s("div",A0,[s("h3",$0,m(t.stepTitle),1),t.stepDescription?(c(),u("p",I0,m(t.stepDescription),1)):A("",!0),a.error?A("",!0):(c(),u("div",M0,[s("div",N0,[s("div",{class:"progress-fill",style:we({width:t.displayProgress+"%"})},null,4)]),s("span",x0,m(t.displayProgress)+"%",1)])),a.error?A("",!0):(c(),u("div",L0,[t.details.description?(c(),u("div",P0,m(t.details.description),1)):A("",!0),t.details.count!==void 0?(c(),u("div",O0,[e[2]||(e[2]=s("span",{class:"detail-label"},"–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–∏–∫–µ—Ç–æ–≤:",-1)),s("span",B0,m(t.details.count),1),t.details.total!==void 0?(c(),u("span",R0," –∏–∑ "+m(t.details.total),1)):A("",!0)])):A("",!0),t.details.filteredTickets!==void 0?(c(),u("div",W0,[e[3]||(e[3]=s("span",{class:"detail-label"},"–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∏–∫–µ—Ç–æ–≤:",-1)),s("span",U0,m(t.details.filteredTickets),1),t.details.totalTickets!==void 0?(c(),u("span",F0," –∏–∑ "+m(t.details.totalTickets),1)):A("",!0)])):A("",!0),t.details.stage?(c(),u("div",H0,[e[4]||(e[4]=s("span",{class:"detail-label"},"–°—Ç–∞–¥–∏—è:",-1)),s("span",j0,m(t.getStageDisplayName(t.details.stage)),1),t.details.stageIndex&&t.details.totalStages?(c(),u("span",V0," ("+m(t.details.stageIndex)+"/"+m(t.details.totalStages)+") ",1)):A("",!0)])):A("",!0),t.details.employeeCount!==void 0?(c(),u("div",z0,[e[5]||(e[5]=s("span",{class:"detail-label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",-1)),s("span",G0,m(t.details.employeeCount),1)])):A("",!0),t.details.warning?(c(),u("div",K0,[s("span",null,"‚ö†Ô∏è "+m(t.details.warning),1)])):A("",!0)]))])])])]),a.error?(c(),u("div",q0,[s("div",Y0,[e[6]||(e[6]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),s("p",X0,m(a.error),1),s("button",{onClick:e[0]||(e[0]=(...n)=>t.handleRetry&&t.handleRetry(...n)),class:"retry-button"}," –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É ")])])):A("",!0)],2)}const Z0=ce(C0,[["render",J0],["__scopeId","data-v-d129ff19"]]),Q0={name:"LoggerControl",props:{showControl:{type:Boolean,default:!1}},setup(){const o=I(!1),e=I("ERROR"),a=I(!0),t=d=>({NONE:"–û—Ç–∫–ª—é—á–µ–Ω–æ",ERROR:"–¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏",WARN:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏",INFO:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏",DEBUG:"–í—Å–µ –ª–æ–≥–∏ (–æ—Ç–ª–∞–¥–∫–∞)"})[d]||d;return $e(()=>{const d=Mt.getLevel();e.value=d,o.value=d!=="NONE"}),{enabled:o,level:e,isExpanded:a,getLevelDescription:t,handleToggle:()=>{o.value?(e.value==="NONE"&&(e.value="ERROR"),Mt.setLevel(e.value)):(Mt.setLevel("NONE"),e.value="NONE")},handleLevelChange:()=>{o.value&&Mt.setLevel(e.value)},resetToDefault:()=>{const d="ERROR";e.value=d,o.value=!0,Mt.setLevel(d)},toggleVisibility:()=>{a.value=!a.value}}}},e1={key:0,class:"logger-control"},t1={class:"logger-control-header"},a1=["aria-label"],s1={key:0,class:"logger-control-content"},o1={class:"logger-control-section"},n1={class:"logger-control-label"},r1={key:0,class:"logger-control-section"},l1={class:"logger-control-label"},i1={key:1,class:"logger-control-info"},c1={class:"logger-control-info-text"},d1={key:2,class:"logger-control-section"};function u1(o,e,a,t,l,r){return a.showControl?(c(),u("div",e1,[s("div",t1,[e[6]||(e[6]=s("h3",{class:"logger-control-title"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º",-1)),s("button",{class:"logger-control-toggle",onClick:e[0]||(e[0]=(...n)=>t.toggleVisibility&&t.toggleVisibility(...n)),"aria-label":t.isExpanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"},m(t.isExpanded?"‚ñº":"‚ñ∂"),9,a1)]),t.isExpanded?(c(),u("div",s1,[s("div",o1,[s("label",n1,[Be(s("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=n=>t.enabled=n),onChange:e[2]||(e[2]=(...n)=>t.handleToggle&&t.handleToggle(...n)),class:"logger-control-checkbox"},null,544),[[ka,t.enabled]]),e[7]||(e[7]=s("span",{class:"logger-control-label-text"},"–í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ",-1))])]),t.enabled?(c(),u("div",r1,[s("label",l1,[e[9]||(e[9]=s("span",{class:"logger-control-label-text"},"–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:",-1)),Be(s("select",{"onUpdate:modelValue":e[3]||(e[3]=n=>t.level=n),onChange:e[4]||(e[4]=(...n)=>t.handleLevelChange&&t.handleLevelChange(...n)),class:"logger-control-select"},[...e[8]||(e[8]=[_t('<option value="NONE" data-v-ed57067c>–û—Ç–∫–ª—é—á–µ–Ω–æ</option><option value="ERROR" data-v-ed57067c>–¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏</option><option value="WARN" data-v-ed57067c>–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏</option><option value="INFO" data-v-ed57067c>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏</option><option value="DEBUG" data-v-ed57067c>–í—Å–µ –ª–æ–≥–∏ (–æ—Ç–ª–∞–¥–∫–∞)</option>',5)])],544),[[dt,t.level]])])])):A("",!0),t.enabled?(c(),u("div",i1,[s("span",c1,[e[10]||(e[10]=ge(" –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: ",-1)),s("strong",null,m(t.getLevelDescription(t.level)),1)])])):A("",!0),t.enabled?(c(),u("div",d1,[s("button",{onClick:e[5]||(e[5]=(...n)=>t.resetToDefault&&t.resetToDefault(...n)),class:"logger-control-reset-btn",title:"–°–±—Ä–æ—Å–∏—Ç—å –∫ –∑–Ω–∞—á–µ–Ω–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"}," –°–±—Ä–æ—Å–∏—Ç—å –∫ —É–º–æ–ª—á–∞–Ω–∏—é ")])):A("",!0)])):A("",!0)])):A("",!0)}const g1=ce(Q0,[["render",u1],["__scopeId","data-v-ed57067c"]]),m1={name:"DiagnosticsPanel",props:{isEnabled:{type:Boolean,default:!1},isUserAdmin:{type:Boolean,default:!1}},setup(o){const e=I(!0),a=tt(),t=$(()=>!o.isEnabled||!o.isUserAdmin?{ticketsLoading:{stages:{},totalLoaded:0},filtering:{total:0,filtered:0,rejected:[],tagValueExamples:[]},employees:{uniqueIds:[],totalUnique:0,ticketsWithoutAssignedById:[],ticketsWithAssignedById1051:[]},grouping:{distributionByStages:{},ticketsNotInColumn:[],unknownStages:[]},zeroPoint:{byStage:{}}}:a?a.getMetrics():(console.warn("[DiagnosticsPanel] Diagnostics service not available"),{ticketsLoading:{stages:{},totalLoaded:0},filtering:{total:0,filtered:0,rejected:[],tagValueExamples:[]},employees:{uniqueIds:[],totalUnique:0,ticketsWithoutAssignedById:[],ticketsWithAssignedById1051:[]},grouping:{distributionByStages:{},ticketsNotInColumn:[],unknownStages:[]},zeroPoint:{byStage:{}}})),l=$(()=>!o.isEnabled||!o.isUserAdmin||!a?{withoutAssignedById:[],withAssignedById1051:[],withoutSectorTag:[],notInColumn:[],unknownStage:[]}:a.getProblematicTickets()),r=$(()=>{const g=l.value;return g.withoutAssignedById.length===0&&g.withAssignedById1051.length===0&&g.withoutSectorTag.length===0&&g.notInColumn.length===0&&g.unknownStage.length===0});return{isExpanded:e,metrics:t,problematicTickets:l,hasNoProblems:r,toggleExpanded:()=>{e.value=!e.value},downloadJSON:()=>{if(!a)return;const g=a.exportToJSON(),v=new Blob([g],{type:"application/json"}),w=URL.createObjectURL(v),f=document.createElement("a");f.href=w,f.download=`dashboard-diagnostics-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(w)},getStageName:g=>Lt.getStageName(g)||g}}},h1={key:0,class:"diagnostics-panel"},f1={class:"diagnostics-header"},v1={class:"header-actions"},p1=["title"],y1={key:0,class:"diagnostics-content"},k1={class:"diagnostics-section"},b1={class:"metrics-grid"},_1={class:"metric-card"},w1={class:"metric-value"},C1={class:"metric-label"},T1={class:"metric-value"},S1={class:"metric-detail"},D1={class:"diagnostics-section"},E1={class:"metrics-grid"},A1={class:"metric-card"},$1={class:"metric-value"},I1={class:"metric-card",style:{"border-left-color":"#28a745"}},M1={class:"metric-value"},N1={class:"metric-card",style:{"border-left-color":"#dc3545"}},x1={class:"metric-value"},L1={key:0,class:"metric-detail"},P1={key:0,class:"warning-box"},O1={key:1,class:"examples-box"},B1={class:"example-type"},R1={key:0,class:"normalized"},W1={class:"diagnostics-section"},U1={class:"metrics-grid"},F1={class:"metric-card"},H1={class:"metric-value"},j1={class:"metric-card"},V1={class:"metric-value"},z1={class:"metric-card"},G1={class:"metric-value"},K1={class:"diagnostics-section"},q1={class:"metrics-grid"},Y1={class:"metric-card"},X1={class:"metric-value"},J1={class:"metric-card",style:{"border-left-color":"#28a745"}},Z1={class:"metric-value"},Q1={class:"metric-card",style:{"border-left-color":"#ffc107"}},eb={class:"metric-value"},tb={key:0,class:"employees-list"},ab={class:"diagnostics-section"},sb={class:"metrics-grid"},ob={class:"metric-label"},nb={class:"metric-value"},rb={class:"diagnostics-section problematic-tickets"},lb={key:0,class:"problem-group"},ib={class:"tickets-list"},cb={class:"ticket-id"},db={class:"ticket-title"},ub={class:"ticket-stage"},gb={key:0,class:"more-items"},mb={key:1,class:"problem-group"},hb={class:"tickets-list"},fb={class:"ticket-id"},vb={class:"ticket-title"},pb={class:"ticket-stage"},yb={key:0,class:"more-items"},kb={key:2,class:"problem-group"},bb={class:"tickets-list"},_b={class:"ticket-id"},wb={class:"ticket-title"},Cb={class:"ticket-stage"},Tb={key:0,class:"more-items"},Sb={key:3,class:"problem-group"},Db={class:"tickets-list"},Eb={class:"ticket-id"},Ab={class:"ticket-title"},$b={class:"ticket-stage"},Ib={key:0,class:"more-items"},Mb={key:4,class:"problem-group"},Nb={class:"tickets-list"},xb={class:"ticket-id"},Lb={class:"ticket-title"},Pb={class:"ticket-stage"},Ob={key:0,class:"more-items"},Bb={key:5,class:"no-problems"};function Rb(o,e,a,t,l,r){return a.isEnabled&&a.isUserAdmin?(c(),u("div",h1,[s("div",f1,[e[2]||(e[2]=s("h2",null,"üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞",-1)),s("div",v1,[s("button",{onClick:e[0]||(e[0]=(...n)=>t.downloadJSON&&t.downloadJSON(...n)),class:"btn-download",title:"–°–∫–∞—á–∞—Ç—å JSON"}," üì• –°–∫–∞—á–∞—Ç—å JSON "),s("button",{onClick:e[1]||(e[1]=(...n)=>t.toggleExpanded&&t.toggleExpanded(...n)),class:"btn-toggle",title:t.isExpanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"},m(t.isExpanded?"‚ñº":"‚ñ∂"),9,p1)])]),t.isExpanded?(c(),u("div",y1,[s("section",k1,[e[4]||(e[4]=s("h3",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",-1)),s("div",b1,[s("div",_1,[e[3]||(e[3]=s("div",{class:"metric-label"},"–í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ",-1)),s("div",w1,m(t.metrics.ticketsLoading.totalLoaded),1)]),(c(!0),u(ee,null,te(t.metrics.ticketsLoading.stages,(n,i)=>(c(),u("div",{key:i,class:"metric-card"},[s("div",C1,m(t.getStageName(i)),1),s("div",T1,m(n.total),1),s("div",S1,"–ë–∞—Ç—á–µ–π: "+m(n.batches.length),1)]))),128))])]),s("section",D1,[e[10]||(e[10]=s("h3",null,"üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ç–æ—Ä—É 1–°",-1)),s("div",E1,[s("div",A1,[e[5]||(e[5]=s("div",{class:"metric-label"},"–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ",-1)),s("div",$1,m(t.metrics.filtering.total),1)]),s("div",I1,[e[6]||(e[6]=s("div",{class:"metric-label"},"–ü—Ä–æ—à–ª–æ —Ñ–∏–ª—å—Ç—Ä (—Ç–µ–≥ 1–°)",-1)),s("div",M1,m(t.metrics.filtering.filtered),1)]),s("div",N1,[e[7]||(e[7]=s("div",{class:"metric-label"},"–û—Ç–∫–ª–æ–Ω–µ–Ω–æ (–Ω–µ—Ç —Ç–µ–≥–∞ 1–°)",-1)),s("div",x1,m(t.metrics.filtering.rejected.length),1),t.metrics.filtering.total>0?(c(),u("div",L1,m(Math.round(t.metrics.filtering.rejected.length/t.metrics.filtering.total*100))+"% –æ—Ç –≤—Å–µ—Ö ",1)):A("",!0)])]),t.metrics.filtering.rejected.length>0?(c(),u("div",P1,[e[8]||(e[8]=s("strong",null,"‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:",-1)),ge(" "+m(t.metrics.filtering.rejected.length)+" —Ç–∏–∫–µ—Ç–æ–≤ –Ω–µ –∏–º–µ—é—Ç —Ç–µ–≥–∞ —Å–µ–∫—Ç–æ—Ä–∞ 1–° (UF_CRM_7_TYPE_PRODUCT = '1C') –∏ –ø–æ—ç—Ç–æ–º—É –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –¥–∞—à–±–æ—Ä–¥–µ. –≠—Ç–∏ —Ç–∏–∫–µ—Ç—ã –µ—Å—Ç—å –≤ Bitrix24, –Ω–æ –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. ",1)])):A("",!0),t.metrics.filtering.tagValueExamples.length>0?(c(),u("div",O1,[e[9]||(e[9]=s("h4",null,"–ü—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π UF_CRM_7_TYPE_PRODUCT:",-1)),s("ul",null,[(c(!0),u(ee,null,te(t.metrics.filtering.tagValueExamples.slice(0,10),(n,i)=>(c(),u("li",{key:i},[s("code",null,m(JSON.stringify(n.value)),1),s("span",B1,"("+m(n.type)+m(n.isArray?", –º–∞—Å—Å–∏–≤":"")+")",1),n.normalized&&n.normalized.length?(c(),u("span",R1," ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ: "+m(n.normalized.join(", ")),1)):A("",!0)]))),128))])])):A("",!0)]),s("section",W1,[e[14]||(e[14]=s("h3",null,"üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏",-1)),s("div",U1,[s("div",F1,[e[11]||(e[11]=s("div",{class:"metric-label"},"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID",-1)),s("div",H1,m(t.metrics.employees.totalUnique),1)]),s("div",j1,[e[12]||(e[12]=s("div",{class:"metric-label"},"–ë–µ–∑ assignedById",-1)),s("div",V1,m(t.metrics.employees.ticketsWithoutAssignedById.length),1)]),s("div",z1,[e[13]||(e[13]=s("div",{class:"metric-label"},"–° assignedById=1051",-1)),s("div",G1,m(t.metrics.employees.ticketsWithAssignedById1051.length),1)])])]),s("section",K1,[e[18]||(e[18]=s("h3",null,"üì¶ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),(c(!0),u(ee,null,te(t.metrics.grouping.distributionByStages,(n,i)=>(c(),u("div",{key:i,class:"stage-distribution"},[s("h4",null,m(t.getStageName(i)),1),s("div",q1,[s("div",Y1,[e[15]||(e[15]=s("div",{class:"metric-label"},"–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤ –≤ —Å—Ç–∞–¥–∏–∏",-1)),s("div",X1,m(n.total||0),1)]),s("div",J1,[e[16]||(e[16]=s("div",{class:"metric-label"},"–í–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),s("div",Z1,m(n.insideSector||0),1)]),s("div",Q1,[e[17]||(e[17]=s("div",{class:"metric-label"},"–í–Ω–µ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),s("div",eb,m(n.outsideSector||0),1)])]),Object.keys(n.employees||{}).length>0?(c(),u("div",tb,[(c(!0),u(ee,null,te(n.employees,(d,g)=>(c(),u("div",{key:g,class:"employee-item"}," –°–æ—Ç—Ä—É–¥–Ω–∏–∫ #"+m(g)+": "+m(d)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1))),128))])):A("",!0)]))),128))]),s("section",ab,[e[19]||(e[19]=s("h3",null,"üéØ –ù—É–ª–µ–≤–∞—è —Ç–æ—á–∫–∞",-1)),s("div",sb,[(c(!0),u(ee,null,te(t.metrics.zeroPoint.byStage,(n,i)=>(c(),u("div",{key:i,class:"metric-card"},[s("div",ob,m(t.getStageName(i)),1),s("div",nb,m(n),1)]))),128))])]),s("section",rb,[e[20]||(e[20]=s("h3",null,"‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),t.problematicTickets.withoutAssignedById.length>0?(c(),u("div",lb,[s("h4",null,"–ë–µ–∑ assignedById ("+m(t.problematicTickets.withoutAssignedById.length)+")",1),s("div",ib,[(c(!0),u(ee,null,te(t.problematicTickets.withoutAssignedById.slice(0,10),n=>(c(),u("div",{key:n.id,class:"ticket-item"},[s("span",cb,"#"+m(n.id),1),s("span",db,m(n.title),1),s("span",ub,m(t.getStageName(n.stageId)),1)]))),128)),t.problematicTickets.withoutAssignedById.length>10?(c(),u("div",gb," ... –∏ –µ—â—ë "+m(t.problematicTickets.withoutAssignedById.length-10),1)):A("",!0)])])):A("",!0),t.problematicTickets.withAssignedById1051.length>0?(c(),u("div",mb,[s("h4",null,"–° assignedById=1051 ("+m(t.problematicTickets.withAssignedById1051.length)+")",1),s("div",hb,[(c(!0),u(ee,null,te(t.problematicTickets.withAssignedById1051.slice(0,10),n=>(c(),u("div",{key:n.id,class:"ticket-item"},[s("span",fb,"#"+m(n.id),1),s("span",vb,m(n.title),1),s("span",pb,m(t.getStageName(n.stageId)),1)]))),128)),t.problematicTickets.withAssignedById1051.length>10?(c(),u("div",yb," ... –∏ –µ—â—ë "+m(t.problematicTickets.withAssignedById1051.length-10),1)):A("",!0)])])):A("",!0),t.problematicTickets.withoutSectorTag.length>0?(c(),u("div",kb,[s("h4",null,"–ë–µ–∑/–Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–≥ —Å–µ–∫—Ç–æ—Ä–∞ ("+m(t.problematicTickets.withoutSectorTag.length)+")",1),s("div",bb,[(c(!0),u(ee,null,te(t.problematicTickets.withoutSectorTag.slice(0,10),n=>(c(),u("div",{key:n.id||n.ID,class:"ticket-item"},[s("span",_b,"#"+m(n.id||n.ID),1),s("span",wb,m(n.title||n.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),s("span",Cb,m(t.getStageName(n.stageId||n.STAGE_ID)),1)]))),128)),t.problematicTickets.withoutSectorTag.length>10?(c(),u("div",Tb," ... –∏ –µ—â—ë "+m(t.problematicTickets.withoutSectorTag.length-10),1)):A("",!0)])])):A("",!0),t.problematicTickets.notInColumn.length>0?(c(),u("div",Sb,[s("h4",null,"–ù–µ –ø–æ–ø–∞–ª–∏ –≤ –∫–æ–ª–æ–Ω–∫—É ("+m(t.problematicTickets.notInColumn.length)+")",1),s("div",Db,[(c(!0),u(ee,null,te(t.problematicTickets.notInColumn.slice(0,10),n=>(c(),u("div",{key:n.id,class:"ticket-item"},[s("span",Eb,"#"+m(n.id),1),s("span",Ab,m(n.title),1),s("span",$b,m(t.getStageName(n.stageId)),1)]))),128)),t.problematicTickets.notInColumn.length>10?(c(),u("div",Ib," ... –∏ –µ—â—ë "+m(t.problematicTickets.notInColumn.length-10),1)):A("",!0)])])):A("",!0),t.problematicTickets.unknownStage.length>0?(c(),u("div",Mb,[s("h4",null,"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç–∞–¥–∏—è ("+m(t.problematicTickets.unknownStage.length)+")",1),s("div",Nb,[(c(!0),u(ee,null,te(t.problematicTickets.unknownStage.slice(0,10),n=>(c(),u("div",{key:n.id,class:"ticket-item"},[s("span",xb,"#"+m(n.id),1),s("span",Lb,m(n.title),1),s("span",Pb,"–°—Ç–∞–¥–∏—è: "+m(n.stageId),1)]))),128)),t.problematicTickets.unknownStage.length>10?(c(),u("div",Ob," ... –∏ –µ—â—ë "+m(t.problematicTickets.unknownStage.length-10),1)):A("",!0)])])):A("",!0),t.hasNoProblems?(c(),u("div",Bb," ‚úÖ –ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ ")):A("",!0)])])):A("",!0)])):A("",!0)}const Wb=ce(m1,[["render",Rb],["__scopeId","data-v-74a5e138"]]);function Ub(){const o=I(!1),e=I(null),a=I([{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:[]},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:[]},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:[]}]),t=I({formed:[],review:[],execution:[]}),l=I([]),r=I(null);return{isLoading:o,error:e,stages:a,zeroPointTickets:t,employees:l,draggedTicket:r,updateState:v=>{v.stages&&(a.value=v.stages),v.employees&&(l.value=v.employees),v.zeroPointTickets&&(t.value=v.zeroPointTickets)},resetState:()=>{o.value=!1,e.value=null,a.value=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:[]},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:[]},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:[]}],t.value={formed:[],review:[],execution:[]},l.value=[],r.value=null},updateLocalStateAfterMove:(v,w,f)=>{const p=a.value.find(T=>T.employees.some(C=>C.tickets.some(k=>k.id===v.id)));if(p){const T=p.employees.find(C=>C.tickets.some(k=>k.id===v.id));T&&(T.tickets=T.tickets.filter(C=>C.id!==v.id))}const y=a.value.find(T=>T.id===f);if(y){const T=y.employees.find(C=>C.id===w);if(T){const C={...v,assigneeId:w,stageId:f};T.tickets.push(C)}}Object.keys(t.value).forEach(T=>{t.value[T]=t.value[T].filter(C=>C.id!==v.id)})},getEmployeeTickets:(v,w)=>{const f=a.value.find(y=>y.id===w);if(!f)return[];const p=f.employees.find(y=>y.id===v);return p?p.tickets||[]:[]}}}function Fb(){const o=I(null),e=I(0),a=I(null),t=I(null),l=I({}),r=(f,p={})=>{o.value=f,l.value=p},n=f=>{const p=typeof f=="number"&&!isNaN(f)?f:0;e.value=Math.min(100,Math.max(0,p))},i=f=>{a.value=f,t.value=null},d=f=>{t.value=f},g=()=>{t.value=null},v=()=>{o.value=null,e.value=0,a.value=null,t.value=null,l.value={}},w=$(()=>a.value||t.value);return{currentStep:o,progress:e,error:a,temporaryError:t,displayError:w,stepDetails:l,updateStep:r,updateProgress:n,setError:i,setTemporaryError:d,clearTemporaryError:g,reset:v}}const ut={fadeOutDuration:400,fadeInDuration:400,delayBetween:150,readyDisplayTime:800,fadeOutEasing:"ease-out",fadeInEasing:"ease-in",fadeOutTransform:"scale(0.95)",fadeInTransform:"translateY(10px)"},ls={fadeInDuration:400,fadeInEasing:"ease-in"};function Rs(o,e,a="opacity, transform"){return`${a} ${o}ms ${e}`}function Hb(){return Rs(ut.fadeOutDuration,ut.fadeOutEasing)}function jb(){return Rs(ls.fadeInDuration,ls.fadeInEasing)}function Vb(){const o=I(!1),e=I(null),a=n=>{o.value=!0,e.value=Date.now(),n&&n()},t=n=>{o.value=!1,e.value=null,n&&n()},l=(n,i,d=ut)=>{a(()=>{n&&n(),setTimeout(()=>{i&&i()},d.delayBetween),setTimeout(()=>{t()},d.fadeOutDuration)})},r=$(()=>e.value?Date.now()-e.value:0);return{isTransitioning:$(()=>o.value),startTransition:a,endTransition:t,executeTransition:l,transitionDuration:r}}function zb(o,e=""){if(Logger.error(`API Error ${e?`(${e})`:""}`,"ErrorHandler",o),o.message){if(o.message.includes("HTTP error"))return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.";if(o.message.includes("timeout"))return"–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";if(o.message.includes("403")||o.message.includes("401"))return"–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.";if(o.message.includes("500"))return"–û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."}return o.message||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}function Gb(o,e="",a={}){const t={message:o.message,stack:o.stack,context:e,...a,timestamp:new Date().toISOString()};Logger.error("Error logged","ErrorHandler",t)}function Ia(o,e="",a=null){const t=zb(o,e);Gb(o,e),a&&typeof a=="function"?a(t,"error"):typeof BX<"u"&&BX.UI&&BX.UI.Notification&&BX.UI.Notification.Center.notify({content:t,autoHideDelay:5e3})}function Kb(o){const e=mt(),a=Fb(),{isTransitioning:t,executeTransition:l}=Vb();function r(p,y){const T=ga(p);T.step&&y.updateStep(T.step,T.details||{}),T.progress!==void 0&&T.progress!==null&&(y.updateProgress(T.progress),y.clearTemporaryError())}const n=async(p=!0)=>{o.isLoading.value=!0,o.error.value=null,a.reset(),a.updateStep("cache_check",{description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö..."}),a.updateProgress(0);try{const y=await Qt.getSectorData(p,T=>{r(T,a)});o.updateState(y)}catch(y){o.error.value=y.message,a.setError(y.message),Ia(y,"loading sector data",e.error)}finally{if(o.error.value)o.isLoading.value=!1;else{a.updateStep("complete",{description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"}),a.updateProgress(100);const y=ut.readyDisplayTime||800;setTimeout(()=>{l(()=>{},()=>{o.isLoading.value=!1},ut),setTimeout(()=>{a.reset()},ut.fadeOutDuration)},y)}}},i=async(p,y,T)=>{if(!Os(p,y,T))return e.warning("–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–∫–µ—Ç —Å—é–¥–∞"),!1;try{const C=await Qt.assignTicket(p.id,y,T);return C&&(o.updateLocalStateAfterMove(p,y,T),e.success("–¢–∏–∫–µ—Ç –ø–µ—Ä–µ–º–µ—â—ë–Ω")),C}catch(C){return Ia(C,"assigning ticket",e.error),!1}finally{o.draggedTicket.value=null}};return{loadSectorData:n,assignTicket:i,moveTicketToStage:async(p,y)=>await i(p,p.assigneeId,y),assignTicketToEmployee:async(p,y)=>await i(p,y,p.stageId),createTicket:async p=>{const y=t0(p);if(!y.valid){const T=y.errors.join(", ");return e.error(T),0}try{const T=await Qt.createTicket(p);return T>0&&(await n(!1),e.success("–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω")),T}catch(T){return Ia(T,"creating ticket",e.error),0}},handleTicketDragStart:p=>{o.draggedTicket.value=p},handleTicketDrop:async(p,y,T)=>{await i(p,y,T)},loadingProgress:a,isTransitioning:t}}const Va={name:"DashboardSector1C",components:{DashboardStage:_0,LoadingPreloader:Z0,LoggerControl:g1,BackButton:_s,DiagnosticsPanel:Wb},setup(){const o=Xe(),e=Ba(),a=Ub(),t=Kb(a),l=I(null),r=$(()=>l.value?sa(l.value):!1),n=$(()=>ct(e,l.value)),i=()=>{o.push({name:"dashboard-sector-1c",query:{...e.query,diagnostics:"true"}}),typeof localStorage<"u"&&localStorage.setItem("dashboard-sector-1c-diagnostics","true");const L=tt();L&&L.reset(),t.loadSectorData(!1)},d=()=>{Oe.invalidateTicketsCache(),Oe.invalidateEmployeesCache(),Cs();const L=tt();L&&L.reset(),t.loadSectorData(!1)};$e(async()=>{try{l.value=await rt.getCurrentUser()}catch(L){console.error("Error getting current user:",L),l.value=null}if(n.value){const L=tt();L&&L.reset()}t.loadSectorData()});const g=Hb(),v=jb(),w=`${ut.delayBetween}ms`,f=ut.fadeOutTransform,p=ut.fadeInTransform,y=()=>{t.loadSectorData(!1)},T=()=>{o.push({name:"dashboard-graph-state"})},C=()=>{o.push({name:"dashboard-graph-admission-closure"})},k=()=>{o.push({name:"dashboard-tickets-time-tracking"})},S=()=>{o.push("/")},x=t.loadingProgress,U=$(()=>typeof localStorage<"u"?localStorage.getItem("dashboard-sector-1c-show-logger-control")==="true":!1);return{isLoading:a.isLoading,error:a.error,stages:a.stages,zeroPointTickets:a.zeroPointTickets,employees:a.employees,draggedTicket:a.draggedTicket,currentStep:x.currentStep,progress:x.progress,stepDetails:x.stepDetails,loadingProgress:x,loadSectorData:t.loadSectorData,handleTicketDragStart:t.handleTicketDragStart,handleTicketDrop:t.handleTicketDrop,assignTicketToEmployee:t.assignTicketToEmployee,moveTicketToStage:t.moveTicketToStage,createTicket:t.createTicket,getEmployeeTickets:a.getEmployeeTickets,showLoggerControl:U,handleRetry:y,isTransitioning:t.isTransitioning,preloaderFadeOutTransition:g,dashboardFadeInTransition:v,transitionDelay:w,preloaderFadeOutTransform:f,dashboardFadeInTransform:p,navigateToGraphState:T,navigateToAdmissionClosure:C,navigateToTimeTracking:k,handleGoHome:S,isDiagnosticsEnabled:n,enableDiagnostics:i,clearCache:d,isUserAdmin:r}}},is=()=>{so(o=>({e25fa6d4:o.preloaderFadeOutTransition,v2de4400b:o.preloaderFadeOutTransform,v66f66a76:o.dashboardFadeInTransition,e224f3ee:o.transitionDelay,v171b9ffc:o.dashboardFadeInTransform}))},cs=Va.setup;Va.setup=cs?(o,e)=>(is(),cs(o,e)):is;const qb={class:"dashboard-header"},Yb={class:"breadcrumbs-row"},Xb={class:"header-actions"},Jb={key:0,class:"dashboard-content"},Zb={class:"stages-container"};function Qb(o,e,a,t,l,r){const n=be("BackButton"),i=be("LoadingPreloader"),d=be("DashboardStage"),g=be("LoggerControl"),v=be("DiagnosticsPanel");return c(),u("div",{class:X(["dashboard-sector-1c",{"is-dragging":t.draggedTicket}])},[s("div",qb,[s("div",Yb,[s("button",{class:"btn-home-link",type:"button",onClick:e[0]||(e[0]=(...w)=>t.handleGoHome&&t.handleGoHome(...w)),title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),e[6]||(e[6]=s("span",{class:"breadcrumb-separator"},"/",-1)),e[7]||(e[7]=s("span",{class:"breadcrumb-current"},"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1))]),ne(n,{variant:"header"}),e[13]||(e[13]=s("h1",null,"–î–∞—à–±–æ—Ä–¥ - –°–µ–∫—Ç–æ—Ä 1–°",-1)),s("div",Xb,[t.isDiagnosticsEnabled&&t.isUserAdmin?(c(),u("button",{key:0,onClick:e[1]||(e[1]=(...w)=>t.clearCache&&t.clearCache(...w)),class:"btn-clear-cache",title:"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à —Å–µ–∫—Ç–æ—Ä–∞ –∏ —Ç–∏–∫–µ—Ç–æ–≤"},[...e[8]||(e[8]=[s("span",{class:"icon"},"‚ôªÔ∏è",-1),s("span",null,"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à",-1)])])):A("",!0),!t.isDiagnosticsEnabled&&t.isUserAdmin?(c(),u("button",{key:1,onClick:e[2]||(e[2]=(...w)=>t.enableDiagnostics&&t.enableDiagnostics(...w)),class:"btn-enable-diagnostics",title:"–í–∫–ª—é—á–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º"},[...e[9]||(e[9]=[s("span",{class:"icon"},"üîç",-1),s("span",null,"–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",-1)])])):A("",!0),s("button",{onClick:e[3]||(e[3]=(...w)=>t.navigateToGraphState&&t.navigateToGraphState(...w)),class:"btn-navigate-graph-state",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞"},[...e[10]||(e[10]=[s("span",{class:"icon"},"üìä",-1),s("span",null,"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",-1)])]),s("button",{onClick:e[4]||(e[4]=(...w)=>t.navigateToAdmissionClosure&&t.navigateToAdmissionClosure(...w)),class:"btn-navigate-admission-closure",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞"},[...e[11]||(e[11]=[s("span",{class:"icon"},"üìà",-1),s("span",null,"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1)])]),s("button",{onClick:e[5]||(e[5]=(...w)=>t.navigateToTimeTracking&&t.navigateToTimeTracking(...w)),class:"btn-navigate-time-tracking",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞–º –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞"},[...e[12]||(e[12]=[s("span",{class:"icon"},"‚è±",-1),s("span",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã",-1)])])])]),ne(Ae,{name:"preloader-fade"},{default:ye(()=>[t.isLoading||t.error||t.currentStep?(c(),he(i,{key:0,"current-step":t.currentStep,progress:t.progress,"step-details":t.stepDetails,error:t.error||null,onRetry:t.handleRetry},null,8,["current-step","progress","step-details","error","onRetry"])):A("",!0)]),_:1}),ne(Ae,{name:"dashboard-fade"},{default:ye(()=>[!t.isLoading&&!t.error&&!t.currentStep?(c(),u("div",Jb,[s("div",Zb,[(c(!0),u(ee,null,te(t.stages,w=>(c(),he(d,{key:w.id,stage:w,"zero-point-tickets":t.zeroPointTickets[w.id]||[],onTicketMoved:t.handleTicketDrop,onTicketAssigned:t.assignTicketToEmployee},null,8,["stage","zero-point-tickets","onTicketMoved","onTicketAssigned"]))),128))])])):A("",!0)]),_:1}),ne(n,{variant:"floating"}),ne(g,{"show-control":t.showLoggerControl},null,8,["show-control"]),ne(v,{"is-enabled":t.isDiagnosticsEnabled,"is-user-admin":t.isUserAdmin},null,8,["is-enabled","is-user-admin"])],2)}const Ws=ce(Va,[["render",Qb],["__scopeId","data-v-11e84363"]]),Us=Object.freeze(Object.defineProperty({__proto__:null,default:Ws},Symbol.toStringTag,{value:"Module"})),e_={name:"ModuleAdapter",props:{moduleConfig:{type:Object,required:!0,validator:o=>o.id&&o.title&&o.component},sectorId:{type:String,required:!0},isCompact:{type:Boolean,default:!0}},emits:["module-ready","module-error","module-navigate"],setup(o,{emit:e}){const a=Xe(),t=I(!1),l=I(null),r=I(null),n=I(null),i={SectorDashboard:Ss,TicketsTimeTrackingDashboard:As,GraphStateDashboard:Ns,GraphAdmissionClosureDashboard:xs,DashboardSector1C:Ws},d=$(()=>{const T={isCompact:o.isCompact,sectorId:o.sectorId,moduleId:o.moduleConfig.id};switch(o.moduleConfig.component){case"SectorDashboard":return{sectorId:o.sectorId};case"DashboardSector1C":return{...T,showBreadcrumbs:!1,compactMode:!0};case"GraphStateDashboard":return{...T,showBreadcrumbs:!1,compactMode:!0,autoLoad:!1};case"TicketsTimeTrackingDashboard":return{...T,showBreadcrumbs:!1,compactMode:!0};case"GraphAdmissionClosureDashboard":return{...T,showBreadcrumbs:!1,compactMode:!0};default:return T}}),g=async()=>{try{t.value=!0,l.value=null;const T=o.moduleConfig.component;i[T]?(r.value=i[T],console.log(`[ModuleAdapter] ‚úÖ Loading real component ${T} for module ${o.moduleConfig.id} in sector ${o.sectorId}`),console.log("[ModuleAdapter] Component loaded:",r.value)):(r.value="div",console.log(`[ModuleAdapter] ‚ö†Ô∏è Loading module ${o.moduleConfig.id} for sector ${o.sectorId} - using placeholder (component ${T} not found)`)),e("module-ready",{moduleId:o.moduleConfig.id,sectorId:o.sectorId})}catch(T){console.error(`Failed to load module ${o.moduleConfig.id}:`,T),l.value=T.message,e("module-error",{moduleId:o.moduleConfig.id,sectorId:o.sectorId,error:T})}finally{t.value=!1}},v=()=>{console.log("üîó [ModuleAdapter] Opening full view for module:",o.moduleConfig.id),console.log("üîó [ModuleAdapter] Route:",o.moduleConfig.route),console.log("üîó [ModuleAdapter] Module config:",o.moduleConfig),o.moduleConfig.route?(console.log("üîó [ModuleAdapter] Navigating to:",o.moduleConfig.route),a.push(o.moduleConfig.route)):console.warn(`No route defined for module ${o.moduleConfig.id}`)},w=()=>{g()},f=T=>{e("module-navigate",{type:"ready",moduleId:o.moduleConfig.id,sectorId:o.sectorId,data:T})},p=T=>{e("module-navigate",{type:"error",moduleId:o.moduleConfig.id,sectorId:o.sectorId,error:T})},y=T=>{e("module-navigate",{type:"navigate",moduleId:o.moduleConfig.id,sectorId:o.sectorId,navigation:T})};return $e(()=>{g()}),{isLoading:t,error:l,moduleComponent:r,moduleInstance:n,moduleProps:d,openFullView:v,retryLoad:w,onModuleReady:f,onModuleError:p,onModuleNavigate:y}}},t_={class:"module-header"},a_={class:"module-icon"},s_={class:"module-info"},o_={class:"module-actions"},n_=["aria-label"],r_={class:"module-content"},l_={key:0,class:"module-loading"},i_={key:1,class:"module-error"},c_={key:2,class:"module-body"},d_={class:"module-placeholder"},u_={class:"placeholder-icon"};function g_(o,e,a,t,l,r){return c(),u("div",{class:X(["sector-module-adapter",`module-${a.moduleConfig.id}`])},[s("div",t_,[s("div",a_,m(a.moduleConfig.icon),1),s("div",s_,[s("h3",null,m(a.moduleConfig.title),1),s("p",null,m(a.moduleConfig.description),1)]),s("div",o_,[s("button",{onClick:e[0]||(e[0]=(...n)=>t.openFullView&&t.openFullView(...n)),class:"btn-module-fullscreen",title:"–û—Ç–∫—Ä—ã—Ç—å –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ","aria-label":`–û—Ç–∫—Ä—ã—Ç—å ${a.moduleConfig.title} –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ`}," ‚õ∂ ",8,n_)])]),s("div",r_,[t.isLoading?(c(),u("div",l_,[e[3]||(e[3]=s("div",{class:"loading-spinner"},null,-1)),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ "+m(a.moduleConfig.title)+"...",1)])):t.error?(c(),u("div",i_,[e[4]||(e[4]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),e[5]||(e[5]=s("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è",-1)),s("button",{onClick:e[1]||(e[1]=(...n)=>t.retryLoad&&t.retryLoad(...n)),class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):(c(),u("div",c_,[s("div",d_,[s("div",u_,m(a.moduleConfig.icon),1),s("h4",null,m(a.moduleConfig.title),1),s("p",null,m(a.moduleConfig.description),1),e[6]||(e[6]=s("div",{class:"placeholder-status"},[s("span",{class:"status-badge"},"–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"),s("small",null,"–ú–æ–¥—É–ª—å –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏")],-1)),s("button",{onClick:e[2]||(e[2]=(...n)=>t.openFullView&&t.openFullView(...n)),class:"btn-open-full"}," –û—Ç–∫—Ä—ã—Ç—å –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ ")])]))])],2)}const m_=ce(e_,[["render",g_],["__scopeId","data-v-df66ddb2"]]),h_={name:"SectorContainer",components:{ModuleAdapter:m_},props:{sectorConfig:{type:Object,required:!0,validator:o=>o.id&&o.name&&o.icon}},emits:["module-ready","module-error","module-event","sector-expanded","sector-collapsed"],setup(o,{emit:e}){Xe();const a=I(!1),t=I(!1),l=I([]),r=$(()=>o.sectorConfig.modules&&o.sectorConfig.modules.length>0),n=$(()=>!1);$e(async()=>{r.value&&await i()});const i=async()=>{t.value=!0;try{l.value=o.sectorConfig.modules||[],e("module-ready",{sectorId:o.sectorConfig.id,modulesCount:l.value.length})}catch(p){console.error(`Failed to load modules for sector ${o.sectorConfig.id}:`,p),e("module-error",{sectorId:o.sectorConfig.id,error:p.message})}finally{t.value=!1}};return{expanded:a,loading:t,sectorModules:l,hasModules:r,canNavigateToDashboard:n,toggleExpanded:()=>{a.value=!a.value,a.value?e("sector-expanded",{sectorId:o.sectorConfig.id}):e("sector-collapsed",{sectorId:o.sectorConfig.id})},onModuleReady:p=>{e("module-ready",{sectorId:o.sectorConfig.id,moduleId:p.moduleId,data:p})},onModuleError:p=>{e("module-error",{sectorId:o.sectorConfig.id,moduleId:p.moduleId,error:p.error})},onModuleNavigate:p=>{e("module-event",{sectorId:o.sectorConfig.id,moduleId:p.moduleId,event:p})},navigateToSectorDashboard:()=>{console.log(`Navigate to dashboard for sector: ${o.sectorConfig.id}`)}}}},f_={class:"sector-header"},v_={class:"sector-header-left"},p_={class:"sector-icon"},y_={class:"sector-title"},k_={class:"sector-actions"},b_={key:0,class:"sector-content"},__={key:0,class:"sector-loading"},w_={key:1,class:"sector-modules-grid"},C_={key:2,class:"no-modules"},T_={key:3,class:"sector-dashboard-link"};function S_(o,e,a,t,l,r){const n=be("ModuleAdapter");return c(),u("div",{class:X(["sector-container",`sector-${a.sectorConfig.id}`])},[s("div",f_,[s("div",v_,[s("div",p_,m(a.sectorConfig.icon),1),s("div",y_,[s("h2",null,m(a.sectorConfig.name),1),s("p",null,m(a.sectorConfig.description),1)])]),s("div",k_,[s("button",{onClick:e[0]||(e[0]=(...i)=>t.toggleExpanded&&t.toggleExpanded(...i)),class:"btn-toggle-sector"},m(t.expanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"),1)])]),t.expanded?(c(),u("div",b_,[t.loading?(c(),u("div",__,[e[3]||(e[3]=s("div",{class:"loading-spinner"},null,-1)),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∫—Ç–æ—Ä–∞ "+m(a.sectorConfig.name)+"...",1)])):t.sectorModules.length>0?(c(),u("div",w_,[(c(!0),u(ee,null,te(t.sectorModules,i=>(c(),he(n,{key:i.id,"module-config":i,"sector-id":a.sectorConfig.id,"is-compact":!0,onModuleReady:t.onModuleReady,onModuleError:t.onModuleError,onModuleNavigate:t.onModuleNavigate},null,8,["module-config","sector-id","onModuleReady","onModuleError","onModuleNavigate"]))),128))])):(c(),u("div",C_,[s("p",null,'–ú–æ–¥—É–ª–∏ –¥–ª—è —Å–µ–∫—Ç–æ—Ä–∞ "'+m(a.sectorConfig.name)+'" –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ',1),t.canNavigateToDashboard?(c(),u("button",{key:0,onClick:e[1]||(e[1]=(...i)=>t.navigateToSectorDashboard&&t.navigateToSectorDashboard(...i)),class:"btn-sector-dashboard"},[...e[4]||(e[4]=[s("span",{class:"icon"},"üìä",-1),ge(" –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ ",-1)])])):A("",!0)])),t.sectorModules.length>0&&t.canNavigateToDashboard?(c(),u("div",T_,[s("button",{onClick:e[2]||(e[2]=(...i)=>t.navigateToSectorDashboard&&t.navigateToSectorDashboard(...i)),class:"btn-sector-dashboard"},[...e[5]||(e[5]=[s("span",{class:"icon"},"üìä",-1),ge(" –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ ",-1)])])])):A("",!0)])):A("",!0)],2)}const D_=ce(h_,[["render",S_],["__scopeId","data-v-0fa90bab"]]);class ca{static async logAppEntry(e,a=null){if(!e||!e.ID)return console.warn("[ActivityLoggingService] Invalid user object for app entry logging"),!1;const t={timestamp:new Date().toISOString(),type:"app_entry",user_id:e.ID,user_name:this.getUserName(e),user_email:e.EMAIL||null,ip:a||this.getClientIp(),user_agent:navigator.userAgent,session_id:this.getSessionId()};return await this.saveLog(t)}static async logPageVisit(e,a,t=null){if(!a||!a.ID)return console.warn("[ActivityLoggingService] Invalid user object for page visit logging"),!1;if(!e||!e.path)return console.warn("[ActivityLoggingService] Invalid route object for page visit logging"),!1;const l={timestamp:new Date().toISOString(),type:"page_visit",user_id:a.ID,user_name:this.getUserName(a),route_path:e.path,route_name:e.name||null,route_title:e.meta?.title||null,from_path:t?.path||null,from_name:t?.name||null,session_id:this.getSessionId()};return await this.saveLog(l)}static async saveLog(e){try{const a=et("/api/user-activity-log.php"),t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)});if(!t.ok){const r=await t.text();return console.error("[ActivityLoggingService] Failed to save log:",{status:t.status,statusText:t.statusText,error:r}),!1}const l=await t.json();return l.success?!0:(console.error("[ActivityLoggingService] API returned error:",l.error),!1)}catch(a){return a.name==="AbortError"?console.warn("[ActivityLoggingService] Request timeout (activity logging skipped)"):console.error("[ActivityLoggingService] Error saving log:",a),!1}}static getSessionId(){const e="activity_session_id";if(sessionStorage.getItem(e))return sessionStorage.getItem(e);const a=this.generateSessionId();return sessionStorage.setItem(e,a),a}static generateSessionId(){const e=Date.now(),a=Math.random().toString(36).substring(2,11);return`${e}-${a}`}static getUserName(e){const a=e.NAME||"",t=e.LAST_NAME||"";return`${a} ${t}`.trim()||e.EMAIL||`User #${e.ID}`}static getClientIp(){return null}static isAppEntryLogged(){return sessionStorage.getItem("app_entry_logged")==="true"}static markAppEntryLogged(){sessionStorage.setItem("app_entry_logged","true")}}const E_={reports:[{id:1,title:"–û—Ç—á—ë—Ç –ø–æ —Ç–∏–∫–µ—Ç–∞–º",icon:"üìä",route:"/reports/tickets",description:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º",active:!1},{id:2,title:"–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",icon:"üìà",route:"/reports/performance",description:"–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞",active:!1},{id:3,title:"–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º",icon:"üìâ",route:"/reports/deadlines",description:"–ê–Ω–∞–ª–∏–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á",active:!1},{id:4,title:"–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç",icon:"üìã",route:"/reports/summary",description:"–û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",active:!1},{id:5,title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",route:"/dashboard/sector-1c",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0},{id:6,title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",icon:"üìä",route:"/dashboard/graph-state",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–° –≤–æ –≤—Ä–µ–º–µ–Ω–∏",active:!0,category:"analytics",order:6},{id:7,title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–°",icon:"üìà",route:"/dashboard/graph-admission-closure",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0,category:"analytics",order:7},{id:8,title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"‚è±",route:"/dashboard/tickets-time-tracking",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",active:!0,category:"analytics",order:8}]};function A_(){return E_.reports.filter(o=>o.active===!0)}const $_={adminInterfaces:[{id:1,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"üë•",route:"/admin/users",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"},{id:2,title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã",icon:"‚öôÔ∏è",route:"/admin/settings",description:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:3,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",icon:"üìã",route:"/admin/webhook-logs",description:"–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤"},{id:4,title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",icon:"üìä",route:"/admin/usage-stats",description:"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:5,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",icon:"üóëÔ∏è",route:"/admin/cache",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –º–æ–¥—É–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"}]};function I_(){return[...$_.adminInterfaces]}const qt={sector1c:{id:"1c",name:"–°–µ–∫—Ç–æ—Ä 1–°",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ",icon:"‚öôÔ∏è",color:"#007bff",borderColor:"#0056b3",backgroundColor:"#f8f9fa",filterValue:"1C",modules:[{id:"dashboard-sector-1c",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–æ–º 1–° —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏",icon:"‚öôÔ∏è",component:"SectorDashboard",route:"/dashboard/sector-1c",category:"management"}],features:["smart-process-140","1c-integration"],order:1},sectorPdm:{id:"pdm",name:"–°–µ–∫—Ç–æ—Ä PDM",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–∞–º–∏ PDM (Product Data Management) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –æ –ø—Ä–æ–¥—É–∫—Ü–∏–∏",icon:"üîß",color:"#28a745",borderColor:"#1e7e34",backgroundColor:"#f8fff8",filterValue:"PDM",modules:[{id:"dashboard-sector-pdm",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ PDM",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–æ–º PDM —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –∑–∞–¥–∞—á–∞–º–∏",icon:"üîß",component:"SectorDashboardPDM",route:"/dashboard/sector-pdm",category:"management"}],features:["pdm-integration"],order:2},sectorBitrix24:{id:"bitrix24",name:"–°–µ–∫—Ç–æ—Ä –ë–∏—Ç—Ä–∏–∫—Å24",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ë–∏—Ç—Ä–∏–∫—Å24 - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞",icon:"üåê",color:"#ffc107",borderColor:"#d39e00",backgroundColor:"#fffef8",filterValue:"Bitrix24",modules:[{id:"dashboard-sector-bitrix24",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ –ë–∏—Ç—Ä–∏–∫—Å24",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–æ–º –ë–∏—Ç—Ä–∏–∫—Å24 —Å –∑–∞–¥–∞—á–∞–º–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏",icon:"üåê",component:"SectorDashboardBitrix24",route:"/dashboard/sector-bitrix24",category:"management"}],features:["bitrix24-integration"],order:3},sectorInfrastructure:{id:"infrastructure",name:"–°–µ–∫—Ç–æ—Ä –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏",icon:"üñ•Ô∏è",color:"#dc3545",borderColor:"#bd2130",backgroundColor:"#fff8f8",filterValue:["–ñ–µ–ª–µ–∑–æ","–ü—Ä–æ—á–µ–µ"],modules:[{id:"dashboard-sector-infrastructure",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Å –∑–∞–¥–∞—á–∞–º–∏ –ø–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é –∏ —Ç–µ—Ö–Ω–∏–∫–µ",icon:"üñ•Ô∏è",component:"SectorDashboardInfrastructure",route:"/dashboard/sector-infrastructure",category:"management"}],features:["infrastructure-management"],order:4}};class M_{static getAllSectors(){return Object.values(qt).sort((e,a)=>(e.order||0)-(a.order||0))}static getSectorById(e){return qt[e]||null}static getSectorsWithModules(){return this.getAllSectors().filter(e=>e.modules&&e.modules.length>0)}static getSectorColors(){const e={};return Object.values(qt).forEach(a=>{e[a.id]=a.color}),e}static sectorExists(e){return Object.values(qt).some(a=>a.id===e)}static getNextOrder(){return Math.max(...Object.values(qt).map(a=>a.order||0))+1}}const N_={name:"IndexPage",components:{StatusMessage:ba,LoadingSpinner:_a,SectorContainer:D_},beforeCreate(){console.log("[IndexPage] beforeCreate() called")},created(){console.log("[IndexPage] created() called")},beforeMount(){console.log("[IndexPage] beforeMount() called")},setup(){console.log("[IndexPage] setup() called");const o=Xe(),e=I(!0),a=I(null),t=I(!1),l=I(!1),r=I(""),n=I(null),i=I(null),d=I(!1);console.log("[IndexPage] Initial state:",{loading:e.value,accessAllowed:t.value,accessDenied:l.value});const g=I(A_()),v=I(M_.getAllSectors()),w=I(!1),f=I(I_()),p=$(()=>n.value?sa(n.value):!1),y=$(()=>{if(!n.value)return"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";const W=n.value.FIRST_NAME?n.value.FIRST_NAME.trim():"",G=n.value.LAST_NAME?n.value.LAST_NAME.trim():"",q=n.value.NAME?n.value.NAME.trim():"";return W&&G?`${W} ${G}`:q&&G&&q!==G?`${q} ${G}`:W&&q&&W!==q?`${W} ${q}`:q&&q.includes(" ")?q:W||G||q||`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${n.value.ID}`}),T=$(()=>a.value?a.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ":"–û—à–∏–±–∫–∞ API":null),C=$(()=>a.value?a.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É.":a.value:null),k=$(()=>a.value&&a.value.includes("no_install_app")),S=$(()=>ks("/install.php"));$e(async()=>{console.log("[IndexPage] onMounted() called");try{console.log("[IndexPage] Calling AccessControlService.checkAccess()...");const W=await rt.checkAccess();if(console.log("[IndexPage] Access result:",{allowed:W.allowed,hasUser:!!W.user,user:W.user,errorCode:W.errorCode,errorMessage:W.errorMessage}),W.allowed){if(console.log("[IndexPage] Setting accessAllowed to true"),t.value=!0,n.value=W.user,console.log("[IndexPage] Access allowed, setting state:",{accessAllowed:t.value,hasUser:!!n.value,loading:e.value,accessDenied:l.value}),!ca.isAppEntryLogged())try{W.user&&await ca.logAppEntry(W.user)&&ca.markAppEntryLogged()}catch(G){console.error("[IndexPage] Error logging app entry:",G)}}else{l.value=!0;const G=Bt(),q=!G&&W.errorCode===nt.ACCESS_DENIED&&W.errorMessage&&W.errorMessage.includes("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø");if(console.log("IndexPage - accessResult:",{errorCode:W.errorCode,errorMessage:W.errorMessage,isInsideB24:G,isDirectAccessDeniedCheck:q}),d.value=q,q&&(r.value=W.errorMessage,console.log("IndexPage - Set direct access denied message:",W.errorMessage)),console.log("IndexPage - State after check:",{accessDenied:l.value,isDirectAccessDenied:d.value,accessErrorMessage:r.value}),!q){if(W.user){const{getAllowedDepartmentIds:oe}=await Ee(async()=>{const{getAllowedDepartmentIds:Y}=await import("./access-config-async-CledoeM0.js");return{getAllowedDepartmentIds:Y}},__vite__mapDeps([6,7,4,2,3,0,1]),import.meta.url);i.value={userId:W.user.ID,departmentIds:W.user.UF_DEPARTMENT||[],allowedIds:oe()}}W.errorCode===nt.USER_NOT_DETERMINED?r.value="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.":W.errorCode===nt.ACCESS_DENIED?r.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω":r.value=W.errorMessage||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."}}}catch(W){a.value=W.message,console.error("Error checking access:",W)}finally{e.value=!1,console.log("[IndexPage] Final state:",{loading:e.value,accessAllowed:t.value,accessDenied:l.value,hasUser:!!n.value,error:a.value})}});const x=W=>{if(!W){console.error("Route is not defined for report");return}o.push(W)},U=()=>{w.value=!0},L=()=>{w.value=!1};return{loading:e,error:a,accessAllowed:t,accessDenied:l,accessErrorMessage:r,currentUser:n,userName:y,debugInfo:i,isDirectAccessDenied:d,errorTitle:T,errorMessage:C,showInstallLink:k,installPageUrl:S,reportsButtons:g,navigateToReport:x,sectors:v,handleModuleEvent:W=>{console.log("Module event:",W)},handleSectorExpanded:W=>{console.log("Sector expanded:",W.sectorId)},handleSectorCollapsed:W=>{console.log("Sector collapsed:",W.sectorId)},isAdmin:p,showAdminPopup:w,adminButtons:f,openAdminPopup:U,closeAdminPopup:L,navigateToAdmin:W=>{if(!W){console.error("Route is not defined for admin interface");return}o.push(W),L()}}}},x_={class:"index-page"},L_={class:"container"},P_={key:0,class:"install-link"},O_=["href"],B_={key:0,class:"direct-access-denied-info",style:{"margin-top":"15px",padding:"15px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px"}},R_={key:1,class:"debug-info",style:{"margin-top":"15px",padding:"10px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px","font-size":"12px"}},W_={key:3,class:"main-content"},U_={class:"greeting-section"},F_={class:"greeting-header"},H_={class:"greeting-header-content"},j_={class:"greeting-text"},V_={class:"sectors-section"},z_={class:"admin-popup-header"},G_={class:"admin-popup-content"},K_={class:"admin-buttons-grid"},q_=["onClick"],Y_={class:"admin-icon"},X_={class:"admin-title"},J_={key:0,class:"admin-description"};function Z_(o,e,a,t,l,r){const n=be("StatusMessage"),i=be("LoadingSpinner"),d=be("SectorContainer");return c(),u("div",x_,[s("div",L_,[t.error?(c(),he(n,{key:0,type:"error",title:t.errorTitle,message:t.errorMessage},{default:ye(()=>[t.showInstallLink?(c(),u("div",P_,[s("a",{href:t.installPageUrl},"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",8,O_)])):A("",!0)]),_:1},8,["title","message"])):A("",!0),t.loading?(c(),he(i,{key:1,message:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞..."})):A("",!0),!t.loading&&t.accessDenied?(c(),he(n,{key:2,type:"error",title:"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",message:t.accessErrorMessage},{default:ye(()=>[t.isDirectAccessDenied?(c(),u("div",B_,[...e[4]||(e[4]=[s("p",{style:{margin:"0 0 10px 0","font-weight":"600",color:"#856404"}},[s("strong",null,"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")],-1),s("ol",{style:{margin:"0","padding-left":"20px",color:"#856404"}},[s("li",null,"–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24"),s("li",null,"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Bitrix24 (placement, –≤–∏–¥–∂–µ—Ç –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É)")],-1)])])):t.debugInfo?(c(),u("div",R_,[e[5]||(e[5]=s("strong",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e[6]||(e[6]=s("br",null,null,-1)),ge(" ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+m(t.debugInfo.userId),1),e[7]||(e[7]=s("br",null,null,-1)),ge(" ID –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+m(t.debugInfo.departmentIds),1),e[8]||(e[8]=s("br",null,null,-1)),ge(" –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ID –æ—Ç–¥–µ–ª–æ–≤: "+m(t.debugInfo.allowedIds),1),e[9]||(e[9]=s("br",null,null,-1)),e[10]||(e[10]=s("small",{style:{color:"#856404"}},"–î–æ–±–∞–≤—å—Ç–µ ID –æ—Ç–¥–µ–ª–∞ –≤ —Ñ–∞–π–ª vue-app/src/config/access-config.js",-1))])):A("",!0)]),_:1},8,["message"])):A("",!0),!t.loading&&!t.accessDenied&&t.accessAllowed?(c(),u("div",W_,[s("div",U_,[s("div",F_,[s("div",H_,[e[13]||(e[13]=s("h2",{class:"greeting-title"},"–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ò–¢ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –ü–ª–∞–Ω–µ—Ä–∫–∏ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ü–∏–∏",-1)),s("p",j_,[e[11]||(e[11]=ge(" –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",-1)),s("strong",null,m(t.userName),1),e[12]||(e[12]=ge("! ",-1))])]),t.isAdmin?(c(),u("button",{key:0,class:"admin-button-header",onClick:e[0]||(e[0]=(...g)=>t.openAdminPopup&&t.openAdminPopup(...g)),title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"}," ‚öôÔ∏è ")):A("",!0)])]),s("div",V_,[(c(!0),u(ee,null,te(t.sectors,g=>(c(),he(d,{key:g.id,"sector-config":g,onModuleEvent:t.handleModuleEvent,onSectorExpanded:t.handleSectorExpanded,onSectorCollapsed:t.handleSectorCollapsed},null,8,["sector-config","onModuleEvent","onSectorExpanded","onSectorCollapsed"]))),128))]),t.showAdminPopup&&t.isAdmin?(c(),u("div",{key:0,class:"admin-popup-overlay",onClick:e[3]||(e[3]=(...g)=>t.closeAdminPopup&&t.closeAdminPopup(...g))},[s("div",{class:"admin-popup",onClick:e[2]||(e[2]=Ce(()=>{},["stop"]))},[s("div",z_,[e[14]||(e[14]=s("h3",{class:"admin-popup-title"},"‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",-1)),s("button",{class:"admin-popup-close",onClick:e[1]||(e[1]=(...g)=>t.closeAdminPopup&&t.closeAdminPopup(...g))}," ‚úï ")]),s("div",G_,[s("div",K_,[(c(!0),u(ee,null,te(t.adminButtons,g=>(c(),u("div",{key:g.id,class:"admin-interface-button",onClick:v=>t.navigateToAdmin(g.route)},[s("div",Y_,m(g.icon),1),s("div",X_,m(g.title),1),g.description?(c(),u("div",J_,m(g.description),1)):A("",!0)],8,q_))),128))])])])])):A("",!0)])):A("",!0)])])}const Q_=ce(N_,[["render",Z_],["__scopeId","data-v-12137466"]]),Ze=I(new Map),st=I({hits:0,misses:0,sets:0,invalidations:0}),Ma={defaultTTL:5*60*1e3,maxSize:100,enableStats:!0};function ew(o={}){const{ttl:e=Ma.defaultTTL,maxSize:a=Ma.maxSize,enableStats:t=Ma.enableStats}=o,l=C=>{const k=new WeakSet;return JSON.stringify(C,(S,x)=>{if(typeof x=="object"&&x!==null){if(k.has(x))return"[Circular]";k.add(x)}return typeof x=="function"||x===void 0?null:x})},r=(C,k={})=>{const S=Object.keys(k).sort().reduce((x,U)=>{const L=k[U];if(L==null)x[U]=null;else if(typeof L=="object")try{x[U]=l(L)}catch{x[U]=String(L)}else x[U]=L;return x},{});try{return`${C}_${l(S)}`}catch{const U=Object.keys(S).sort().map(L=>`${L}=${S[L]}`).join("&");return`${C}_${U}`}},n=C=>{const k=Ze.value.get(C);return k?Date.now()-k.timestamp>k.ttl?(Ze.value.delete(C),t&&st.value.misses++,null):(k.lastAccessed=Date.now(),t&&st.value.hits++,k.data):(t&&st.value.misses++,null)},i=(C,k,S=null)=>{Ze.value.size>=a&&d(),Ze.value.set(C,{data:k,timestamp:Date.now(),lastAccessed:Date.now(),ttl:S||e}),t&&st.value.sets++},d=()=>{let C=null,k=1/0;for(const[S,x]of Ze.value.entries())x.lastAccessed<k&&(k=x.lastAccessed,C=S);C&&Ze.value.delete(C)},g=()=>{Ze.value.clear(),t&&(st.value={hits:0,misses:0,sets:0,invalidations:0})},v=C=>{const k=typeof C=="string"?new RegExp(C):C;let S=0;for(const x of Ze.value.keys())k.test(x)&&(Ze.value.delete(x),S++);return t&&(st.value.invalidations+=S),S},w=()=>{const C=Date.now();let k=0;for(const[S,x]of Ze.value.entries())C-x.timestamp>x.ttl&&(Ze.value.delete(S),k++);return k},f=()=>{const C=st.value.hits+st.value.misses,k=C>0?(st.value.hits/C*100).toFixed(2):0;return{...st.value,size:Ze.value.size,hitRate:`${k}%`}};let p=null;const y=(C=5*60*1e3)=>{p&&clearInterval(p),p=setInterval(()=>{w()},C)},T=()=>{p&&(clearInterval(p),p=null)};return y(),{get:n,set:i,clear:g,invalidate:v,cleanup:w,getCacheKey:r,getStats:f,startAutoCleanup:y,stopAutoCleanup:T}}function gt(o){if(!o||typeof o!="object"||!o.timestamp||typeof o.timestamp!="string"||!o.event||typeof o.event!="string"||!o.category||typeof o.category!="string"||!["tasks","smart-processes","errors"].includes(o.category))return!1;try{new Date(o.timestamp)}catch{return!1}return!0}function tw(o){if(!o||typeof o!="object")return!1;for(const[e,a]of Object.entries(o))if(typeof a=="function")return!1;return!0}function Ht(o){if(!gt(o))return null;const e={timestamp:o.timestamp,event:o.event,category:o.category};return o.ip&&typeof o.ip=="string"&&(e.ip=o.ip),o.payload&&typeof o.payload=="object"&&(e.payload=o.payload),o.details&&tw(o.details)&&(e.details=o.details),e}function za(o){return Array.isArray(o)?o.map(e=>Ht(e)).filter(e=>e!==null):[]}const{get:aw,set:sw,getCacheKey:ow,invalidate:ds}=ew({ttl:2*60*1e3,maxSize:50});class us{static getBaseUrl(){return et("/api/webhook-logs.php")}static get BASE_URL(){return this.getBaseUrl()}static async getLogs(e={},a=1,t=50,l=!1){if(a<1)throw new Error("Page must be greater than 0");if(t<1||t>1e3)throw new Error("Limit must be between 1 and 1000");const r={category:e.category||null,event:e.event||null,date:e.date||null,hour:e.hour!==void 0?e.hour:null,dateFrom:e.dateFrom||null,dateTo:e.dateTo||null,ip:e.ip||null,status:e.status||null},n=this.getBaseUrl(),i=ow(n,{filters:r,page:a,limit:t});if(!l){const g=aw(i);if(g)return console.log("[WebhookLogsApiService] Cache hit:",i.substring(0,50)+"..."),g}console.log("[WebhookLogsApiService] Cache miss:",i.substring(0,50)+"...");const d=new URLSearchParams({page:a.toString(),limit:t.toString()});r.category&&d.append("category",r.category),r.event&&d.append("event",r.event),r.date&&d.append("date",r.date),r.hour!==null&&d.append("hour",r.hour.toString()),r.dateFrom&&d.append("dateFrom",r.dateFrom),r.dateTo&&d.append("dateTo",r.dateTo),r.ip&&d.append("ip",r.ip),r.status&&d.append("status",r.status);try{const g=this.getBaseUrl(),v=await fetch(`${g}?${d.toString()}`);if(!v.ok){const y=await v.text();let T;try{T=JSON.parse(y)}catch{T={error:y}}throw new Error(T.error_description||T.error||`HTTP error! status: ${v.status}`)}const w=await v.json();if(console.log("[WebhookLogsApiService] API response:",{success:w.success,logsCount:w.logs?.length||0,pagination:w.pagination,hasError:!!w.error}),w.error)throw new Error(w.error_description||w.error);if(!w.success)throw console.warn("[WebhookLogsApiService] API returned success=false:",w),new Error("API request failed");if(!Array.isArray(w.logs))throw console.error("[WebhookLogsApiService] Invalid logs format:",w.logs),new Error("Invalid logs format: expected array");const f=za(w.logs);(!w.pagination||typeof w.pagination!="object")&&(console.warn("[WebhookLogsApiService] Invalid pagination format:",w.pagination),w.pagination={page:a,limit:t,total:f.length,pages:Math.ceil(f.length/t)});const p={success:!0,logs:f,pagination:{page:w.pagination.page||a,limit:w.pagination.limit||t,total:w.pagination.total||f.length,pages:w.pagination.pages||Math.ceil((w.pagination.total||f.length)/t)}};return sw(i,p),p}catch(g){throw console.error("[WebhookLogsApiService] Error:",g),g}}static invalidateCacheOnFilterChange(e={},a={}){const t=ds(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Invalidated ${t} entries on filter change`)}static clearCache(){const e=ds(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Cleared ${e} entries`)}static async getLogDetails(e,a=null){const t={};return a&&(t.date=a),(await this.getLogs(t,1,1e3)).logs.find(n=>`${n.timestamp}_${n.event}`===e)||null}static async getErrors(e={},a=1,t=50){return this.getLogs({...e,category:"errors"},a,t)}static async getStats(e={}){const a=await this.getLogs(e,1,1e3),t={total:a.pagination.total||a.logs.length,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}};return a.logs.forEach(l=>{l.category==="tasks"?t.tasks++:l.category==="smart-processes"?t.smartProcesses++:l.category==="errors"&&t.errors++,t.byEvent[l.event]||(t.byEvent[l.event]=0),t.byEvent[l.event]++;const r=l.timestamp.split("T")[0];t.byDate[r]||(t.byDate[r]=0),t.byDate[r]++}),t}}function nw(){const o=Ba(),e=Xe(),a=new Date().toISOString().split("T")[0],t=I({category:null,event:null,dateFrom:a,dateTo:null,hour:null,ip:null,search:null,status:null}),l=()=>{const g=o.query;t.value={category:g.category||null,event:g.event||null,dateFrom:g.dateFrom||g.date||a,dateTo:g.dateTo||null,hour:g.hour?parseInt(g.hour):null,ip:g.ip||null,search:g.search||null,status:g.status||null}},r=g=>{if(d)return;const v={...o.query};Object.keys(g).forEach(f=>{const p=g[f];p!==null&&p!==""&&p!==void 0?v[f]=p.toString():delete v[f]}),JSON.stringify(v)!==JSON.stringify(o.query)&&(d=!0,e.replace({path:o.path,query:v}).finally(()=>{setTimeout(()=>{d=!1},100)}))},n=g=>{const v={...t.value,...g};JSON.stringify(t.value)!==JSON.stringify(v)&&(t.value=v,r(t.value))},i=()=>{t.value={category:null,event:null,dateFrom:a,dateTo:null,hour:null,ip:null,search:null,status:null},r(t.value)};$e(()=>{l()});let d=!1;return Ne(()=>o.query,(g,v)=>{if(d)return;JSON.stringify(g)!==JSON.stringify(v)&&l()},{deep:!0}),{filters:t,updateFilters:n,clearFilters:i,loadFiltersFromUrl:l}}function rw(o,e,a={}){if(!e||!e.trim())return o;const{caseSensitive:t=!1,searchInEvent:l=!0,searchInPayload:r=!0,searchInDetails:n=!0,searchInIp:i=!0,searchInTimestamp:d=!1}=a,g=t?e.trim():e.trim().toLowerCase();return o.filter(v=>{if(l&&v.event&&(t?v.event:v.event.toLowerCase()).includes(g))return!0;if(r&&v.payload)try{const w=JSON.stringify(v.payload);if((t?w:w.toLowerCase()).includes(g))return!0}catch(w){console.warn("Error searching in payload:",w)}if(n&&v.details)try{const w=JSON.stringify(v.details);if((t?w:w.toLowerCase()).includes(g))return!0}catch(w){console.warn("Error searching in details:",w)}return!!(i&&v.ip&&(t?v.ip:v.ip.toLowerCase()).includes(g)||d&&v.timestamp&&(t?v.timestamp:v.timestamp.toLowerCase()).includes(g))})}function Oa(o){if(!o||typeof o!="object"||o.category!==void 0&&o.category!==null&&!["tasks","smart-processes","errors"].includes(o.category)||o.date!==void 0&&o.date!==null&&!/^\d{4}-\d{2}-\d{2}$/.test(o.date))return!1;if(o.hour!==void 0&&o.hour!==null){const e=parseInt(o.hour,10);if(isNaN(e)||e<0||e>23)return!1}return!(o.ip!==void 0&&o.ip!==null&&(typeof o.ip!="string"||o.ip.length===0))}function lw(o){if(!o||typeof o!="object")return!1;const e=parseInt(o.page,10),a=parseInt(o.limit,10),t=parseInt(o.total,10),l=parseInt(o.pages,10);return!(isNaN(e)||e<1||isNaN(a)||a<1||a>1e3||isNaN(t)||t<0||isNaN(l)||l<0)}function gs(o){if(o==null)return"";const e=String(o),a=e.replace(/"/g,'""');return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${a}"`:a}function iw(o){return o==null?"":typeof o=="object"?JSON.stringify(o):String(o)}function cw(o,e="webhook-logs.csv",a={}){return new Promise((t,l)=>{try{if(!Array.isArray(o)||o.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{columns:r=null,onProgress:n=null}=a,i=r||Object.keys(o[0]),g=[i.map(y=>gs(y)).join(",")],v=o.length,w=1e3;for(let y=0;y<v;y+=w){const T=o.slice(y,y+w);if(T.forEach(C=>{const k=i.map(S=>{const x=C[S];return gs(iw(x))});g.push(k.join(","))}),n){const C=Math.min(100,Math.round((y+T.length)/v*100));n(C)}}const f="\uFEFF"+g.join(`
`),p=new Blob([f],{type:"text/csv;charset=utf-8;"});Fs(p,e),n&&n(100),t()}catch(r){l(r)}})}function dw(o,e="webhook-logs.json",a={}){return new Promise((t,l)=>{try{if(!Array.isArray(o)||o.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{pretty:r=!0,onProgress:n=null}=a,i=r?JSON.stringify(o,null,2):JSON.stringify(o);n&&n(50);const d=new Blob([i],{type:"application/json;charset=utf-8;"});Fs(d,e),n&&n(100),t()}catch(r){l(r)}})}function Fs(o,e){const a=URL.createObjectURL(o),t=document.createElement("a");t.href=a,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(a)},100)}function uw(o,e={},a=0){const t=new Date().toISOString().split("T")[0],l=new Date().toTimeString().split(" ")[0].replace(/:/g,"-");let r=`webhook-logs_${t}_${l}`;const n=[];return e.category&&n.push(`cat-${e.category}`),e.event&&n.push(`evt-${e.event.substring(0,10)}`),e.dateFrom&&n.push(`from-${e.dateFrom}`),e.dateTo&&n.push(`to-${e.dateTo}`),n.length>0&&(r+=`_${n.join("-")}`),a>0&&(r+=`_${a}records`),`${r}.${o}`}function gw(o){const e=[];if(!Array.isArray(o))return e.push("–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),{valid:!1,errors:e,estimatedSize:0};if(o.length===0)return e.push("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"),{valid:!1,errors:e,estimatedSize:0};const a=JSON.stringify(o).length,t=50*1024*1024;return a>t&&e.push(`–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö (${Math.round(a/1024/1024)} MB). –≠–∫—Å–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è.`),{valid:e.length===0,errors:e,estimatedSize:a}}function Ga(o,e="short"){if(!o)return"‚Äî";try{const a=new Date(o);if(isNaN(a.getTime()))return"Invalid date";switch(e){case"short":return a.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});case"long":return a.toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});case"relative":return mw(a);default:return a.toLocaleString("ru-RU")}}catch{return"Invalid date"}}function mw(o){const a=new Date-o,t=Math.floor(a/1e3),l=Math.floor(t/60),r=Math.floor(l/60),n=Math.floor(r/24);return t<60?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":l<60?`${l} ${Na(l,"–º–∏–Ω—É—Ç—É","–º–∏–Ω—É—Ç—ã","–º–∏–Ω—É—Ç")} –Ω–∞–∑–∞–¥`:r<24?`${r} ${Na(r,"—á–∞—Å","—á–∞—Å–∞","—á–∞—Å–æ–≤")} –Ω–∞–∑–∞–¥`:n<7?`${n} ${Na(n,"–¥–µ–Ω—å","–¥–Ω—è","–¥–Ω–µ–π")} –Ω–∞–∑–∞–¥`:Ga(o.toISOString(),"short")}function Na(o,e,a,t){const l=o%10,r=o%100;return l===1&&r!==11?e:l>=2&&l<=4&&(r<10||r>=20)?a:t}function jt(o){return o?o.replace(/^ON/,"").split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):"‚Äî"}function bt(o){return{tasks:"–ó–∞–¥–∞—á–∏","smart-processes":"–°–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å—ã",errors:"–û—à–∏–±–∫–∏"}[o]||o}function Ka(o){if(!o||typeof o!="object")return"‚Äî";const e=[];if(o.task_id&&e.push(`–ó–∞–¥–∞—á–∞ #${o.task_id}`),o.entity_id&&e.push(`–°—É—â–Ω–æ—Å—Ç—å #${o.entity_id}`),o.task_title&&e.push(`"${o.task_title}"`),o.title&&e.push(`"${o.title}"`),o.comment_text){const a=o.comment_text.length>50?o.comment_text.substring(0,50)+"...":o.comment_text;e.push(`–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${a}`)}return e.length>0?e.join(" ‚Ä¢ "):"‚Äî"}const hw={name:"WebhookLogsExport",props:{logs:{type:Array,default:()=>[]},selectedLogs:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},totalCount:{type:Number,default:0}},emits:["export-start","export-complete","export-error"],setup(o,{emit:e}){const a=I(!1),t=I("csv"),l=I("all"),r=I(!0),n=I(!1),i=I(0),d=I([]),g=I(null),v=$(()=>o.selectedLogs.length),w=$(()=>o.logs.length>0||o.totalCount>0),f=$(()=>o.filters.category||o.filters.event||o.filters.dateFrom||o.filters.dateTo),p=$(()=>l.value==="selected"?v.value:o.logs.length||o.totalCount),y=$(()=>l.value==="selected"?v.value>0:w.value),T=()=>{i.value=0,d.value=[],g.value=null,v.value>0?l.value="selected":l.value="all",a.value=!0,k()},C=()=>{n.value||(a.value=!1)},k=()=>{const L=S(),E=gw(L);d.value=E.errors,g.value=E.estimatedSize},S=()=>(l.value==="selected"?o.selectedLogs:o.logs).map(D=>Ht(D)).filter(D=>gt(D)?!0:(console.warn("[WebhookLogsExport] Skipping invalid log:",D),!1)),x=async()=>{try{n.value=!0,i.value=0;let L=S();if(L.length===0)throw new Error("–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const E=L.map(B=>({timestamp:B.timestamp,event:B.event,category:B.category,ip:B.ip||null,details:B.details||null,payload:B.payload||null,formatted:{timestamp:Ga(B.timestamp),event:jt(B.event),category:bt(B.category),details:Ka(B.details)}}));e("export-start",{format:t.value,scope:l.value,count:E.length});const D=uw(t.value,o.filters,E.length),N=B=>{i.value=B};t.value==="csv"?await cw(E,D,{onProgress:N}):await dw(E,D,{pretty:r.value,onProgress:N}),e("export-complete",{format:t.value,filename:D,count:E.length}),setTimeout(()=>{n.value=!1,a.value=!1,i.value=0},500)}catch(L){console.error("[WebhookLogsExport] Export error:",L),e("export-error",L),n.value=!1,i.value=0,alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${L.message}`)}},U=L=>L<1024?`${L} B`:L<1024*1024?`${(L/1024).toFixed(2)} KB`:`${(L/1024/1024).toFixed(2)} MB`;return Ne([l,()=>o.logs,()=>o.selectedLogs],()=>{a.value&&k()}),{showExportModal:a,exportFormat:t,exportScope:l,jsonPretty:r,exporting:n,exportProgress:i,exportWarnings:d,estimatedSize:g,selectedCount:v,hasAllLogs:w,hasFilters:f,exportCount:p,canExport:y,openExportModal:T,closeExportModal:C,handleExport:x,formatSize:U}}},fw={class:"webhook-logs-export"},vw=["disabled","title"],pw={key:0,class:"selected-badge"},yw={class:"export-modal-header"},kw={class:"export-modal-body"},bw={class:"export-section"},_w={class:"radio-group"},ww={class:"export-section"},Cw={class:"radio-group"},Tw=["disabled"],Sw={class:"radio-label"},Dw={key:0},Ew={key:1},Aw=["disabled"],$w={class:"radio-label"},Iw={key:0,class:"export-section"},Mw={class:"checkbox-option"},Nw={class:"export-info"},xw={class:"info-item"},Lw={class:"info-value"},Pw={key:0,class:"info-item"},Ow={class:"info-value"},Bw={key:1,class:"export-warnings"},Rw={key:0,class:"export-progress"},Ww={class:"progress-bar"},Uw={class:"progress-text"},Fw={class:"export-modal-footer"},Hw=["disabled"],jw={key:0},Vw={key:1},zw=["disabled"];function Gw(o,e,a,t,l,r){return c(),u("div",fw,[s("button",{onClick:e[0]||(e[0]=(...n)=>t.openExportModal&&t.openExportModal(...n)),class:"btn-export",disabled:!t.canExport,title:t.canExport?"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"},[e[11]||(e[11]=s("span",{class:"btn-icon"},"üì•",-1)),e[12]||(e[12]=s("span",{class:"btn-text"},"–≠–∫—Å–ø–æ—Ä—Ç",-1)),t.selectedCount>0?(c(),u("span",pw,m(t.selectedCount),1)):A("",!0)],8,vw),ne(Ae,{name:"modal"},{default:ye(()=>[t.showExportModal?(c(),u("div",{key:0,class:"export-modal-overlay",onClick:e[10]||(e[10]=(...n)=>t.closeExportModal&&t.closeExportModal(...n))},[s("div",{class:"export-modal",onClick:e[9]||(e[9]=Ce(()=>{},["stop"]))},[s("div",yw,[e[13]||(e[13]=s("h3",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",-1)),s("button",{onClick:e[1]||(e[1]=(...n)=>t.closeExportModal&&t.closeExportModal(...n)),class:"btn-close"},"‚úï")]),s("div",kw,[s("div",bw,[e[16]||(e[16]=s("h4",null,"–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞",-1)),s("div",_w,[s("label",{class:X(["radio-option",{active:t.exportFormat==="csv"}])},[Be(s("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=n=>t.exportFormat=n),value:"csv",class:"radio-input"},null,512),[[Et,t.exportFormat]]),e[14]||(e[14]=s("span",{class:"radio-label"},[s("strong",null,"CSV"),s("small",null,"–î–ª—è Excel, LibreOffice")],-1))],2),s("label",{class:X(["radio-option",{active:t.exportFormat==="json"}])},[Be(s("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=n=>t.exportFormat=n),value:"json",class:"radio-input"},null,512),[[Et,t.exportFormat]]),e[15]||(e[15]=s("span",{class:"radio-label"},[s("strong",null,"JSON"),s("small",null,"–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, API")],-1))],2)])]),s("div",ww,[e[19]||(e[19]=s("h4",null,"–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",-1)),s("div",Cw,[s("label",{class:X(["radio-option",{active:t.exportScope==="all",disabled:!t.hasAllLogs}])},[Be(s("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=n=>t.exportScope=n),value:"all",disabled:!t.hasAllLogs,class:"radio-input"},null,8,Tw),[[Et,t.exportScope]]),s("span",Sw,[e[17]||(e[17]=s("strong",null,"–í—Å–µ –∑–∞–ø–∏—Å–∏",-1)),t.hasFilters?(c(),u("small",Dw,"–° –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ ("+m(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π)",1)):(c(),u("small",Ew,"–í—Å–µ–≥–æ: "+m(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π",1))])],2),s("label",{class:X(["radio-option",{active:t.exportScope==="selected",disabled:t.selectedCount===0}])},[Be(s("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=n=>t.exportScope=n),value:"selected",disabled:t.selectedCount===0,class:"radio-input"},null,8,Aw),[[Et,t.exportScope]]),s("span",$w,[e[18]||(e[18]=s("strong",null,"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏",-1)),s("small",null,m(t.selectedCount)+" –∑–∞–ø–∏—Å–µ–π –≤—ã–±—Ä–∞–Ω–æ",1)])],2)])]),t.exportFormat==="json"?(c(),u("div",Iw,[e[21]||(e[21]=s("h4",null,"–û–ø—Ü–∏–∏ JSON",-1)),s("label",Mw,[Be(s("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=n=>t.jsonPretty=n),class:"checkbox-input"},null,512),[[ka,t.jsonPretty]]),e[20]||(e[20]=s("span",{class:"checkbox-label"},"–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)",-1))])])):A("",!0),s("div",Nw,[s("div",xw,[e[22]||(e[22]=s("span",{class:"info-label"},"–ó–∞–ø–∏—Å–µ–π –∫ —ç–∫—Å–ø–æ—Ä—Ç—É:",-1)),s("span",Lw,m(t.exportCount),1)]),t.estimatedSize?(c(),u("div",Pw,[e[23]||(e[23]=s("span",{class:"info-label"},"–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä:",-1)),s("span",Ow,m(t.formatSize(t.estimatedSize)),1)])):A("",!0)]),t.exportWarnings.length>0?(c(),u("div",Bw,[(c(!0),u(ee,null,te(t.exportWarnings,(n,i)=>(c(),u("div",{key:i,class:"warning-item"}," ‚ö†Ô∏è "+m(n),1))),128))])):A("",!0)]),t.exporting?(c(),u("div",Rw,[s("div",Ww,[s("div",{class:"progress-fill",style:we({width:`${t.exportProgress}%`})},null,4)]),s("div",Uw," –≠–∫—Å–ø–æ—Ä—Ç: "+m(t.exportProgress)+"% ",1)])):A("",!0),s("div",Fw,[s("button",{onClick:e[7]||(e[7]=(...n)=>t.handleExport&&t.handleExport(...n)),disabled:t.exporting||!t.canExport,class:"btn-primary"},[t.exporting?(c(),u("span",jw,"–≠–∫—Å–ø–æ—Ä—Ç...")):(c(),u("span",Vw,"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"))],8,Hw),s("button",{onClick:e[8]||(e[8]=(...n)=>t.closeExportModal&&t.closeExportModal(...n)),disabled:t.exporting,class:"btn-secondary"}," –û—Ç–º–µ–Ω–∞ ",8,zw)])])])):A("",!0)]),_:1})])}const Kw=ce(hw,[["render",Gw],["__scopeId","data-v-7ae66f8c"]]),qw={name:"WebhookLogSearch",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","search"],setup(o,{emit:e}){const a=I(o.modelValue||""),t=I(!1),l=I(null),r=yu(p=>{t.value=!1,e("search",p)},400),n=()=>{t.value=!0,e("update:modelValue",a.value),r(a.value)},i=()=>{t.value=!1,e("search",a.value)},d=()=>{a.value="",t.value=!1,l.value=null,e("update:modelValue",""),e("search","")};return Ne(()=>o.modelValue,p=>{p!==a.value&&(a.value=p)}),{searchQuery:a,isSearching:t,searchResultsCount:l,handleSearchInput:n,handleSearch:i,clearSearch:d,setResultsCount:p=>{l.value=p},getResultsText:p=>{const y=p%10,T=p%100;return T>=11&&T<=19?"–∑–∞–ø–∏—Å–µ–π":y===1?"–∑–∞–ø–∏—Å—å":y>=2&&y<=4?"–∑–∞–ø–∏—Å–∏":"–∑–∞–ø–∏—Å–µ–π"},performSearch:(p,y)=>{if(!p||!y||!Array.isArray(y))return[];const T=p.toLowerCase().trim();return T.length===0?y:y.map(k=>Ht(k)).filter(k=>gt(k)).filter(k=>{if(k.event&&k.event.toLowerCase().includes(T)||k.category&&k.category.toLowerCase().includes(T)||k.ip&&k.ip.toLowerCase().includes(T)||k.details&&typeof k.details=="object"&&(k.details.task_id&&String(k.details.task_id).includes(T)||k.details.task_title&&k.details.task_title.toLowerCase().includes(T)||k.details.entity_id&&String(k.details.entity_id).includes(T)||k.details.title&&k.details.title.toLowerCase().includes(T)||k.details.comment_text&&k.details.comment_text.toLowerCase().includes(T)))return!0;if(k.payload&&typeof k.payload=="object")try{if(JSON.stringify(k.payload).toLowerCase().includes(T))return!0}catch{}return!1})},formatSearchResult:p=>{const y=[];if(p.event&&y.push(jt(p.event)),p.category&&y.push(bt(p.category)),p.details){const T=Ka(p.details);T!=="‚Äî"&&y.push(T)}return y.join(" ‚Ä¢ ")}}}},Yw={class:"webhook-search"},Xw={class:"search-wrapper"},Jw={key:0,class:"search-indicator"},Zw={key:1,class:"search-results"};function Qw(o,e,a,t,l,r){return c(),u("div",Yw,[s("div",Xw,[e[5]||(e[5]=s("span",{class:"search-icon"},"üîç",-1)),Be(s("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>t.searchQuery=n),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ª–æ–≥–æ–≤ (—Å–æ–±—ã—Ç–∏–µ, payload, IP, –¥–µ—Ç–∞–ª–∏)...",class:"search-input",onInput:e[1]||(e[1]=(...n)=>t.handleSearchInput&&t.handleSearchInput(...n)),onKeyup:[e[2]||(e[2]=Re((...n)=>t.handleSearch&&t.handleSearch(...n),["enter"])),e[3]||(e[3]=Re((...n)=>t.clearSearch&&t.clearSearch(...n),["esc"]))]},null,544),[[At,t.searchQuery]]),t.searchQuery?(c(),u("button",{key:0,onClick:e[4]||(e[4]=(...n)=>t.clearSearch&&t.clearSearch(...n)),class:"clear-button",title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ (Esc)","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):A("",!0)]),t.isSearching?(c(),u("div",Jw,[...e[6]||(e[6]=[s("span",{class:"spinner"},null,-1),ge(" –ü–æ–∏—Å–∫... ",-1)])])):A("",!0),t.searchQuery&&t.searchResultsCount!==null?(c(),u("div",Zw," –ù–∞–π–¥–µ–Ω–æ: "+m(t.searchResultsCount)+" "+m(t.getResultsText(t.searchResultsCount)),1)):A("",!0)])}const eC=ce(qw,[["render",Qw],["__scopeId","data-v-db228863"]]);function tC(o,e=null){const a=()=>{try{const n=localStorage.getItem(o);return n?JSON.parse(n):e}catch(n){return console.error(`Error loading ${o} from localStorage:`,n),e}},t=n=>{try{localStorage.setItem(o,JSON.stringify(n))}catch(i){console.error(`Error saving ${o} to localStorage:`,i)}},l=()=>{try{localStorage.removeItem(o)}catch(n){console.error(`Error clearing ${o} from localStorage:`,n)}},r=I(a());return Ne(r,n=>{t(n)},{deep:!0}),{value:r,save:t,load:a,clear:l}}const aC={name:"WebhookLogFilters",props:{filters:{type:Object,required:!0}},emits:["update:filters","reset"],setup(o,{emit:e}){const a=I(null),t=tC("webhook-filters",{category:null,event:null,dateFrom:null,dateTo:null,hour:null,ip:null,status:null}),l=D=>(a.value=null,Oa(D)?(e("update:filters",D),!0):(a.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",console.error("[WebhookLogFilters] Validation error:",a.value),!1)),r=new Date().toISOString().split("T")[0],n=I({category:t.value.category||o.filters.category||null,event:t.value.event||o.filters.event||null,dateFrom:t.value.dateFrom||o.filters.dateFrom||o.filters.date||r,dateTo:t.value.dateTo||o.filters.dateTo||null,hour:t.value.hour!==void 0?t.value.hour:o.filters.hour!==void 0?o.filters.hour:null,ip:t.value.ip||o.filters.ip||null,status:t.value.status||o.filters.status||null}),i=I(null),d=[{id:"today",label:"–°–µ–≥–æ–¥–Ω—è",getDates:()=>({from:r,to:r})},{id:"yesterday",label:"–í—á–µ—Ä–∞",getDates:()=>{const D=new Date;D.setDate(D.getDate()-1);const N=D.toISOString().split("T")[0];return{from:N,to:N}}},{id:"last7days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",getDates:()=>{const D=new Date;return D.setDate(D.getDate()-7),{from:D.toISOString().split("T")[0],to:r}}},{id:"last30days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π",getDates:()=>{const D=new Date;return D.setDate(D.getDate()-30),{from:D.toISOString().split("T")[0],to:r}}}],g=D=>{const N=d.find(B=>B.id===D);if(N){const B=N.getDates();n.value.dateFrom=B.from,n.value.dateTo=B.to,i.value=D,L()}};Ne(()=>o.filters,D=>{n.value={category:D.category||null,event:D.event||null,dateFrom:D.dateFrom||D.date||r,dateTo:D.dateTo||null,hour:D.hour!==void 0?D.hour:null,ip:D.ip||null,status:D.status||null}},{deep:!0}),Ne(n,D=>{t.value={...D},e("update:filters",{...D})},{deep:!0});const v=$(()=>{const D={};return n.value.category&&(D.category=n.value.category),n.value.event&&(D.event=n.value.event),n.value.hour!==null&&(D.hour=n.value.hour),n.value.ip&&(D.ip=n.value.ip),n.value.status&&(D.status=n.value.status),n.value.dateFrom&&n.value.dateFrom!==r&&(D.dateFrom=n.value.dateFrom),n.value.dateTo&&(D.dateTo=n.value.dateTo),D}),w=$(()=>Object.keys(v.value).length>0),f=D=>({category:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è",event:"–°–æ–±—ã—Ç–∏–µ",hour:"–ß–∞—Å",ip:"IP –∞–¥—Ä–µ—Å",status:"–°—Ç–∞—Ç—É—Å",dateFrom:"–î–∞—Ç–∞ –æ—Ç",dateTo:"–î–∞—Ç–∞ –¥–æ"})[D]||D,p=(D,N)=>D==="category"?bt(N)||N:D==="hour"?`${String(N).padStart(2,"0")}:00`:D==="event"?jt(N)||N:D==="status"&&{success:"–£—Å–ø–µ—à–Ω–æ",error:"–û—à–∏–±–∫–∞",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"}[N]||N,y=$(()=>[{value:null,label:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},{value:"tasks",label:bt("tasks")},{value:"smart-processes",label:bt("smart-processes")},{value:"errors",label:bt("errors")}]),T=$(()=>[{value:null,label:"–í—Å–µ —Å–æ–±—ã—Ç–∏—è"},...["ONTASKADD","ONTASKUPDATE","ONTASKDELETE","ONTASKCOMMENTADD","ONTASKCOMMENTUPDATE","ONTASKCOMMENTDELETE","ONCRMDYNAMICITEMADD","ONCRMDYNAMICITEMUPDATE","ONCRMDYNAMICITEMDELETE"].map(N=>({value:N,label:jt(N)}))]),C=D=>{D==="hour"?n.value[D]=null:D==="dateFrom"?n.value[D]=r:n.value[D]=null,i.value=null},k=D=>{const N={...n.value,category:D||null};l(N)&&(n.value.category=D)},S=D=>{const N={...n.value,event:D||null};l(N)&&(n.value.event=D)},x=(D,N)=>{if(D&&!/^\d{4}-\d{2}-\d{2}$/.test(D)){console.error("[WebhookLogFilters] Invalid date format:",D),a.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã";return}const B={...n.value,[N]:D||null};l(B)&&(n.value[N]=D)},U=D=>{if(D!=null){const B=parseInt(D,10);if(isNaN(B)||B<0||B>23){console.error("[WebhookLogFilters] Invalid hour:",D),a.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∞—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23)";return}}const N={...n.value,hour:D!=null?parseInt(D,10):null};l(N)&&(n.value.hour=D!=null?parseInt(D,10):null)},L=()=>{l({...n.value})},E=()=>{n.value={category:null,event:null,dateFrom:r,dateTo:null,hour:null,ip:null,status:null},i.value=null,t.clear(),e("reset")};return $e(()=>{t.value&&Object.keys(t.value).length>0&&e("update:filters",{...t.value})}),{localFilters:n,activeFilters:v,hasActiveFilters:w,getFilterLabel:f,getFilterValue:p,clearFilter:C,handleFilterChange:L,handleCategoryChange:k,handleEventChange:S,handleDateChange:x,handleHourChange:U,handleReset:E,quickFilters:d,activeQuickFilter:i,applyQuickFilter:g,categoryOptions:y,eventOptions:T,validationError:a}}},sC={class:"webhook-log-filters"},oC={key:0,class:"active-filters-indicator"},nC=["onClick"],rC={key:1,class:"validation-error"},lC={class:"quick-filters"},iC=["onClick"],cC={class:"filters-row"},dC={class:"filter-group"},uC=["value"],gC={class:"filter-group"},mC=["value"],hC={class:"filter-group"},fC={class:"filter-group"},vC={class:"filter-group"},pC={class:"filter-group"},yC={class:"filter-group"};function kC(o,e,a,t,l,r){return c(),u("div",sC,[t.hasActiveFilters?(c(),u("div",oC,[e[14]||(e[14]=s("span",{class:"indicator-text"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),u(ee,null,te(t.activeFilters,(n,i)=>(c(),u("span",{key:i,class:"filter-badge"},[ge(m(t.getFilterLabel(i))+": "+m(t.getFilterValue(i,n))+" ",1),s("button",{onClick:d=>t.clearFilter(i),class:"filter-badge-remove",title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"}," √ó ",8,nC)]))),128)),s("button",{onClick:e[0]||(e[0]=(...n)=>t.handleReset&&t.handleReset(...n)),class:"btn-clear-all"}," –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ ")])):A("",!0),t.validationError?(c(),u("div",rC," ‚ö†Ô∏è "+m(t.validationError),1)):A("",!0),s("div",lC,[e[15]||(e[15]=s("span",{class:"quick-filters-label"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),u(ee,null,te(t.quickFilters,n=>(c(),u("button",{key:n.id,onClick:i=>t.applyQuickFilter(n.id),class:X(["quick-filter-btn",{active:t.activeQuickFilter===n.id}])},m(n.label),11,iC))),128))]),s("div",cC,[s("div",dC,[e[16]||(e[16]=s("label",{for:"category-filter"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è:",-1)),Be(s("select",{id:"category-filter","onUpdate:modelValue":e[1]||(e[1]=n=>t.localFilters.category=n),onChange:e[2]||(e[2]=n=>t.handleCategoryChange(t.localFilters.category)),class:"filter-select"},[(c(!0),u(ee,null,te(t.categoryOptions,n=>(c(),u("option",{key:n.value,value:n.value},m(n.label),9,uC))),128))],544),[[dt,t.localFilters.category]])]),s("div",gC,[e[17]||(e[17]=s("label",{for:"event-filter"},"–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:",-1)),Be(s("select",{id:"event-filter","onUpdate:modelValue":e[3]||(e[3]=n=>t.localFilters.event=n),onChange:e[4]||(e[4]=n=>t.handleEventChange(t.localFilters.event)),class:"filter-select"},[(c(!0),u(ee,null,te(t.eventOptions,n=>(c(),u("option",{key:n.value,value:n.value},m(n.label),9,mC))),128))],544),[[dt,t.localFilters.event]])]),s("div",hC,[e[18]||(e[18]=s("label",{for:"date-from-filter"},"–î–∞—Ç–∞ –æ—Ç:",-1)),Be(s("input",{id:"date-from-filter","onUpdate:modelValue":e[5]||(e[5]=n=>t.localFilters.dateFrom=n),type:"date",onChange:e[6]||(e[6]=n=>t.handleDateChange(t.localFilters.dateFrom,"dateFrom")),class:"filter-input"},null,544),[[At,t.localFilters.dateFrom]])]),s("div",fC,[e[19]||(e[19]=s("label",{for:"date-to-filter"},"–î–∞—Ç–∞ –¥–æ:",-1)),Be(s("input",{id:"date-to-filter","onUpdate:modelValue":e[7]||(e[7]=n=>t.localFilters.dateTo=n),type:"date",onChange:e[8]||(e[8]=n=>t.handleDateChange(t.localFilters.dateTo,"dateTo")),class:"filter-input"},null,544),[[At,t.localFilters.dateTo]])]),s("div",vC,[e[20]||(e[20]=s("label",{for:"ip-filter"},"IP –∞–¥—Ä–µ—Å:",-1)),Be(s("input",{id:"ip-filter","onUpdate:modelValue":e[9]||(e[9]=n=>t.localFilters.ip=n),type:"text",placeholder:"192.168.1.1",onInput:e[10]||(e[10]=(...n)=>t.handleFilterChange&&t.handleFilterChange(...n)),class:"filter-input"},null,544),[[At,t.localFilters.ip]])]),s("div",pC,[e[22]||(e[22]=s("label",{for:"status-filter"},"–°—Ç–∞—Ç—É—Å:",-1)),Be(s("select",{id:"status-filter","onUpdate:modelValue":e[11]||(e[11]=n=>t.localFilters.status=n),onChange:e[12]||(e[12]=(...n)=>t.handleFilterChange&&t.handleFilterChange(...n)),class:"filter-select"},[...e[21]||(e[21]=[s("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),s("option",{value:"success"},"–£—Å–ø–µ—à–Ω–æ",-1),s("option",{value:"error"},"–û—à–∏–±–∫–∞",-1),s("option",{value:"warning"},"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",-1)])],544),[[dt,t.localFilters.status]])]),s("div",yC,[s("button",{onClick:e[13]||(e[13]=(...n)=>t.handleReset&&t.handleReset(...n)),class:"btn-reset"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])])}const bC=ce(aC,[["render",kC],["__scopeId","data-v-2a150a46"]]),_C={name:"WebhookLogList",props:{logs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null},pagination:{type:Object,default:null},selectedLogs:{type:Array,default:()=>[]}},emits:["select-log","page-change","update:selectedLogs"],setup(o,{emit:e}){const a=$(()=>!o.logs||!Array.isArray(o.logs)?(console.warn("[WebhookLogList] Invalid logs prop:",o.logs),[]):o.logs.map(N=>Ht(N)).filter(N=>gt(N)?!0:(console.warn("[WebhookLogList] Invalid log entry:",N),!1))),t=I("timestamp"),l=I("desc"),r=N=>{t.value===N?l.value=l.value==="asc"?"desc":"asc":(t.value=N,l.value="desc")},n=$(()=>!a.value||a.value.length===0?[]:[...a.value].sort((B,W)=>{let G,q;switch(t.value){case"timestamp":G=new Date(B.timestamp||0).getTime(),q=new Date(W.timestamp||0).getTime();break;case"event":G=(B.event||"").toLowerCase(),q=(W.event||"").toLowerCase();break;case"category":G=(B.category||"").toLowerCase(),q=(W.category||"").toLowerCase();break;case"ip":G=(B.ip||"").toLowerCase(),q=(W.ip||"").toLowerCase();break;default:return 0}return G<q?l.value==="asc"?-1:1:G>q?l.value==="asc"?1:-1:0})),i=N=>t.value!==N?"‚ÜïÔ∏è":l.value==="asc"?"‚Üë":"‚Üì",d=N=>N.category==="errors"?"status-error":"status-success",g=N=>N.category==="errors"?"‚ùå":"‚úÖ",v=N=>N.category==="errors"?"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏":"–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ",w=N=>`${N.timestamp}_${N.event}_${N.ip||"unknown"}`,f=N=>N?Ga(N,"short"):"‚Äî",p=N=>N?jt(N):"‚Äî",y=N=>N?bt(N):"‚Äî",T=N=>!N||typeof N!="object"?"‚Äî":Ka(N),C=N=>`category-${N}`,k=N=>N?.startsWith("ONTASK")?"event-task":N?.startsWith("ONCRMDYNAMIC")?"event-smart-process":"event-other",S=N=>{e("select-log",N)},x=N=>{N>=1&&N<=o.pagination.pages&&e("page-change",N)},U=N=>o.selectedLogs.some(B=>w(B)===w(N)),L=(N,B)=>{B.stopPropagation();const W=[...o.selectedLogs],G=w(N),q=W.findIndex(oe=>w(oe)===G);B.target.checked?q===-1&&W.push(N):q!==-1&&W.splice(q,1),e("update:selectedLogs",W)},E=N=>{N.target.checked?e("update:selectedLogs",[...o.logs]):e("update:selectedLogs",[])},D=$(()=>a.value.length>0&&a.value.every(N=>U(N)));return Ne(()=>o.logs,N=>{if(N&&Array.isArray(N)){const B=N.filter(W=>!gt(W)).length;B>0&&console.warn(`[WebhookLogList] Received ${B} invalid log entries out of ${N.length}`)}},{immediate:!0}),{validatedLogs:a,sortBy:t,sortOrder:l,sortedLogs:n,handleSort:r,getSortIcon:i,getStatusClass:d,getStatusIcon:g,getStatusTitle:v,getLogId:w,formatTimestamp:f,formatEvent:p,formatCategoryLabel:y,formatDetailsPreview:T,getCategoryClass:C,getEventClass:k,handleLogClick:S,handlePageChange:x,isSelected:U,handleSelectLog:L,handleSelectAll:E,allSelected:D}}},wC={class:"webhook-log-list"},CC={key:0,class:"logs-table-container"},TC={class:"logs-table"},SC={class:"checkbox-header"},DC=["checked"],EC={class:"sort-icon"},AC={class:"sort-icon"},$C={class:"sort-icon"},IC={class:"sort-icon"},MC=["onClick"],NC=["checked","onChange"],xC=["title"],LC={class:"details-preview"},PC=["onClick"],OC={key:0,class:"pagination"},BC=["disabled"],RC={class:"pagination-info"},WC=["disabled"];function UC(o,e,a,t,l,r){return c(),u("div",wC,[a.logs.length>0?(c(),u("div",CC,[s("table",TC,[s("thead",null,[s("tr",null,[s("th",SC,[s("input",{type:"checkbox",checked:t.allSelected,onChange:e[0]||(e[0]=(...n)=>t.handleSelectAll&&t.handleSelectAll(...n)),onClick:e[1]||(e[1]=Ce(()=>{},["stop"])),class:"checkbox-input",title:"–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"},null,40,DC)]),s("th",{onClick:e[2]||(e[2]=n=>t.handleSort("timestamp")),class:X(["sortable",{"sort-asc":t.sortBy==="timestamp"&&t.sortOrder==="asc","sort-desc":t.sortBy==="timestamp"&&t.sortOrder==="desc"}])},[e[9]||(e[9]=ge(" –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è ",-1)),s("span",EC,m(t.getSortIcon("timestamp")),1)],2),s("th",{onClick:e[3]||(e[3]=n=>t.handleSort("event")),class:X(["sortable",{"sort-asc":t.sortBy==="event"&&t.sortOrder==="asc","sort-desc":t.sortBy==="event"&&t.sortOrder==="desc"}])},[e[10]||(e[10]=ge(" –¢–∏–ø —Å–æ–±—ã—Ç–∏—è ",-1)),s("span",AC,m(t.getSortIcon("event")),1)],2),s("th",{onClick:e[4]||(e[4]=n=>t.handleSort("category")),class:X(["sortable",{"sort-asc":t.sortBy==="category"&&t.sortOrder==="asc","sort-desc":t.sortBy==="category"&&t.sortOrder==="desc"}])},[e[11]||(e[11]=ge(" –ö–∞—Ç–µ–≥–æ—Ä–∏—è ",-1)),s("span",$C,m(t.getSortIcon("category")),1)],2),s("th",{onClick:e[5]||(e[5]=n=>t.handleSort("ip")),class:X(["sortable",{"sort-asc":t.sortBy==="ip"&&t.sortOrder==="asc","sort-desc":t.sortBy==="ip"&&t.sortOrder==="desc"}])},[e[12]||(e[12]=ge(" IP ",-1)),s("span",IC,m(t.getSortIcon("ip")),1)],2),e[13]||(e[13]=s("th",null,"–î–µ—Ç–∞–ª–∏",-1)),e[14]||(e[14]=s("th",null,"–î–µ–π—Å—Ç–≤–∏—è",-1))])]),s("tbody",null,[(c(!0),u(ee,null,te(t.sortedLogs,n=>(c(),u("tr",{key:t.getLogId(n),onClick:i=>t.handleLogClick(n),class:X(["log-row",{"row-selected":t.isSelected(n)}])},[s("td",{onClick:e[6]||(e[6]=Ce(()=>{},["stop"]))},[s("input",{type:"checkbox",checked:t.isSelected(n),onChange:i=>t.handleSelectLog(n,i),class:"checkbox-input"},null,40,NC)]),s("td",null,m(t.formatTimestamp(n.timestamp)),1),s("td",null,[s("span",{class:X(["status-indicator",t.getStatusClass(n)]),title:t.getStatusTitle(n)},m(t.getStatusIcon(n)),11,xC),s("span",{class:X(["event-badge",t.getEventClass(n.event)])},m(t.formatEvent(n.event)),3)]),s("td",null,[s("span",{class:X(["category-badge",t.getCategoryClass(n.category)])},m(t.formatCategoryLabel(n.category)),3)]),s("td",null,m(n.ip||"N/A"),1),s("td",null,[s("div",LC,m(t.formatDetailsPreview(n.details)),1)]),s("td",null,[s("button",{onClick:Ce(i=>t.handleLogClick(n),["stop"]),class:"btn-view"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,PC)])],10,MC))),128))])]),a.pagination&&a.pagination.pages>1?(c(),u("div",OC,[s("button",{onClick:e[7]||(e[7]=n=>t.handlePageChange(a.pagination.page-1)),disabled:a.pagination.page<=1,class:"btn-pagination"}," –ù–∞–∑–∞–¥ ",8,BC),s("span",RC," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+m(a.pagination.page)+" –∏–∑ "+m(a.pagination.pages)+" (–≤—Å–µ–≥–æ: "+m(a.pagination.total)+") ",1),s("button",{onClick:e[8]||(e[8]=n=>t.handlePageChange(a.pagination.page+1)),disabled:a.pagination.page>=a.pagination.pages,class:"btn-pagination"}," –í–ø–µ—Ä—ë–¥ ",8,WC)])):A("",!0)])):A("",!0)])}const FC=ce(_C,[["render",UC],["__scopeId","data-v-fddd3018"]]),HC={name:"LoadingSkeleton",props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"20px"},variant:{type:String,default:"rect",validator:o=>["rect","circle","text","table-row"].includes(o)},animated:{type:Boolean,default:!0},borderRadius:{type:String,default:null}},setup(o){return{skeletonStyle:$(()=>{const a={width:typeof o.width=="number"?`${o.width}px`:o.width,height:typeof o.height=="number"?`${o.height}px`:o.height};return o.borderRadius&&(a.borderRadius=o.borderRadius),a})}}},jC={key:0,class:"skeleton-shimmer"};function VC(o,e,a,t,l,r){return c(),u("div",{class:X(["skeleton",[`skeleton-${a.variant}`,{"skeleton-animated":a.animated}]]),style:we(t.skeletonStyle)},[a.animated?(c(),u("div",jC)):A("",!0)],6)}const zC=ce(HC,[["render",VC],["__scopeId","data-v-014f86e6"]]),GC={name:"SkeletonLogList",components:{LoadingSkeleton:zC},props:{rows:{type:Number,default:5}},setup(){return{getColumnWidth:e=>["40px","15%","20%","15%","15%","20%","15%"][e-1]||"100%"}}},KC={class:"skeleton-log-list"},qC={class:"skeleton-table-header"};function YC(o,e,a,t,l,r){const n=be("LoadingSkeleton");return c(),u("div",KC,[s("div",qC,[(c(),u(ee,null,te(7,i=>ne(n,{key:i,width:"120px",height:"16px",variant:"text"})),64))]),(c(!0),u(ee,null,te(a.rows,i=>(c(),u("div",{key:i,class:"skeleton-table-row"},[(c(),u(ee,null,te(7,d=>ne(n,{key:d,width:"100%",height:"20px",variant:"text",style:we({width:t.getColumnWidth(d)})},null,8,["style"])),64))]))),128))])}const XC=ce(GC,[["render",YC],["__scopeId","data-v-475c4e73"]]),JC={name:"EmptyState",props:{icon:{type:String,default:"üì≠"},title:{type:String,required:!0},description:{type:String,required:!0},actionLabel:{type:String,default:null},actions:{type:Array,default:null},hints:{type:Array,default:()=>[]},variant:{type:String,default:"default",validator:o=>["default","error","warning","info"].includes(o)}},emits:["action","action-click"]},ZC={class:"empty-icon"},QC={class:"empty-title"},eT={class:"empty-description"},tT={key:0,class:"empty-hints"},aT={key:1,class:"empty-actions"},sT=["onClick"];function oT(o,e,a,t,l,r){return c(),u("div",{class:X(["empty-state",`empty-state-${a.variant}`])},[s("div",ZC,m(a.icon),1),s("h3",QC,m(a.title),1),s("p",eT,m(a.description),1),a.hints&&a.hints.length>0?(c(),u("div",tT,[(c(!0),u(ee,null,te(a.hints,(n,i)=>(c(),u("div",{key:i,class:"hint-item"}," üí° "+m(n),1))),128))])):A("",!0),a.actionLabel||a.actions?(c(),u("div",aT,[a.actionLabel?(c(),u("button",{key:0,onClick:e[0]||(e[0]=n=>o.$emit("action")),class:"btn-primary"},m(a.actionLabel),1)):A("",!0),(c(!0),u(ee,null,te(a.actions,(n,i)=>(c(),u("button",{key:i,onClick:d=>o.$emit("action-click",n.id),class:X(["btn",`btn-${n.variant||"secondary"}`])},m(n.label),11,sT))),128))])):A("",!0)],2)}const nT=ce(JC,[["render",oT],["__scopeId","data-v-081c13b9"]]),rT={name:"ErrorDisplay",props:{title:{type:String,default:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"},message:{type:String,required:!0},details:{type:String,default:null},severity:{type:String,default:"error",validator:o=>["error","warning","critical"].includes(o)},retryable:{type:Boolean,default:!1}},emits:["retry"],setup(){return{showDetails:I(!1)}}},lT={class:"error-icon"},iT={class:"error-content"},cT={class:"error-title"},dT={class:"error-message"},uT={key:0,class:"error-details"},gT={class:"error-actions"};function mT(o,e,a,t,l,r){return c(),u("div",{class:X(["error-display",`error-${a.severity}`])},[s("div",lT,m(a.severity==="critical"?"üö®":"‚ö†Ô∏è"),1),s("div",iT,[s("h4",cT,m(a.title),1),s("p",dT,m(a.message),1),a.details&&t.showDetails?(c(),u("div",uT,[s("pre",null,m(a.details),1)])):A("",!0),s("div",gT,[a.retryable?(c(),u("button",{key:0,onClick:e[0]||(e[0]=n=>o.$emit("retry")),class:"btn-retry"}," üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")):A("",!0),a.details?(c(),u("button",{key:1,onClick:e[1]||(e[1]=n=>t.showDetails=!t.showDetails),class:"btn-details"},m(t.showDetails?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å")+" –¥–µ—Ç–∞–ª–∏ ",1)):A("",!0)])])],2)}const hT=ce(rT,[["render",mT],["__scopeId","data-v-3f2f4c14"]]),fT={name:"Notification",props:{notification:{type:Object,required:!0}},emits:["close"],setup(o,{emit:e}){const a=I(100),t=$(()=>o.notification.duration>0);let l=null;const r={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},n=$(()=>r[o.notification.type]||"‚ÑπÔ∏è"),i=()=>{e("close")},d=()=>{o.notification.onClick&&o.notification.onClick()};return $e(()=>{if(t.value&&o.notification.duration>0){const g=Date.now(),v=o.notification.duration;l=setInterval(()=>{const w=Date.now()-g;a.value=Math.max(0,100-w/v*100),a.value<=0&&(clearInterval(l),i())},50)}}),at(()=>{l&&clearInterval(l)}),{icon:n,progress:a,showProgress:t,close:i,handleClick:d}}},vT={class:"notification-content"},pT={class:"notification-icon"},yT={class:"notification-message"},kT={key:0,class:"notification-progress"};function bT(o,e,a,t,l,r){return c(),u("div",{class:X(["notification",`notification-${a.notification.type}`]),onClick:e[1]||(e[1]=(...n)=>t.handleClick&&t.handleClick(...n))},[s("div",vT,[s("span",pT,m(t.icon),1),s("span",yT,m(a.notification.message),1)]),s("button",{onClick:e[0]||(e[0]=Ce((...n)=>t.close&&t.close(...n),["stop"])),class:"notification-close"},"‚úï"),t.showProgress?(c(),u("div",kT,[s("div",{class:"progress-bar",style:we({width:`${t.progress}%`})},null,4)])):A("",!0)],2)}const _T=ce(fT,[["render",bT],["__scopeId","data-v-1b602bdf"]]),wT={name:"NotificationContainer",components:{Notification:_T},setup(){const{notifications:o,removeNotification:e}=mt();return{notifications:o,removeNotification:e}}},CT={class:"notification-container"};function TT(o,e,a,t,l,r){const n=be("Notification");return c(),he(It,{to:"body"},[s("div",CT,[ne(Qe,{name:"notification",tag:"div"},{default:ye(()=>[(c(!0),u(ee,null,te(t.notifications,i=>(c(),he(n,{key:i.id,notification:i,onClose:d=>t.removeNotification(i.id)},null,8,["notification","onClose"]))),128))]),_:1})])])}const ST=ce(wT,[["render",TT],["__scopeId","data-v-dd8772c8"]]),DT={name:"RealtimeControls",props:{enabled:{type:Boolean,default:!1},connectionState:{type:String,default:"disconnected"},error:{type:String,default:null}},emits:["toggle"],setup(o,{emit:e}){const a=I(o.enabled);Ne(()=>o.enabled,w=>{a.value=w});const t=$(()=>o.connectionState==="connecting"),l=$(()=>!!o.error),r=$(()=>({"status-connected":o.connectionState==="connected","status-connecting":o.connectionState==="connecting","status-disconnected":o.connectionState==="disconnected","status-error":o.connectionState==="error"})),n=$(()=>{switch(o.connectionState){case"connected":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";case"connecting":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...";case"disconnected":return"–û—Ç–∫–ª—é—á–µ–Ω–æ";case"error":return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}}),i=$(()=>n.value),d=$(()=>({"status-connected":o.connectionState==="connected","status-connecting":o.connectionState==="connecting","status-disconnected":o.connectionState==="disconnected","status-error":o.connectionState==="error"})),g=$(()=>o.error?typeof o.error=="string"?o.error:o.error.message?o.error.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞":null);return{localEnabled:a,isConnecting:t,hasError:l,statusClass:r,statusText:n,connectionStatusText:i,connectionStatusClass:d,displayError:g,handleToggle:()=>{e("toggle",a.value)}}}},ET={class:"realtime-controls"},AT={class:"control-toggle"},$T=["disabled"],IT={class:"status-text"},MT={key:0,class:"error-message"};function NT(o,e,a,t,l,r){return c(),u("div",ET,[s("label",AT,[Be(s("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=n=>t.localEnabled=n),onChange:e[1]||(e[1]=(...n)=>t.handleToggle&&t.handleToggle(...n)),disabled:t.isConnecting},null,40,$T),[[ka,t.localEnabled]]),e[2]||(e[2]=s("span",{class:"toggle-label"},"–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",-1))]),s("div",{class:X(["status-indicator",t.statusClass])},[e[3]||(e[3]=s("span",{class:"status-dot"},null,-1)),s("span",IT,m(t.statusText),1)],2),t.hasError&&t.displayError?(c(),u("div",MT," ‚ö†Ô∏è "+m(t.displayError),1)):A("",!0)])}const xT=ce(DT,[["render",NT],["__scopeId","data-v-af36f073"]]),LT={name:"NewLogsIndicator",props:{count:{type:Number,default:0},newLogs:{type:Array,default:()=>[]}},emits:["apply","dismiss"],setup(o,{emit:e}){const a=(n,i,d,g)=>{const v=n%10,w=n%100;return w>=11&&w<=19?g:v===1?i:v>=2&&v<=4?d:g},t=$(()=>!o.newLogs||!Array.isArray(o.newLogs)||o.newLogs.length===0?[]:o.newLogs.map(i=>Ht(i)).filter(i=>gt(i)).slice(0,5).map(i=>({...i,formatted:{event:jt(i.event),category:bt(i.category)}})));return{pluralize:a,newLogsPreview:t,handleApply:()=>{if(!o.newLogs||o.newLogs.length===0)return;const n=o.newLogs.map(i=>Ht(i)).filter(i=>gt(i));if(n.length===0){console.warn("[NewLogsIndicator] No valid logs to apply");return}e("apply",n)},handleDismiss:()=>{e("dismiss")}}}},PT={key:0,class:"new-logs-indicator"},OT={class:"indicator-content"},BT={class:"indicator-text"},RT={class:"indicator-actions"};function WT(o,e,a,t,l,r){return c(),he(Ae,{name:"slide-down"},{default:ye(()=>[a.count>0?(c(),u("div",PT,[s("div",OT,[e[2]||(e[2]=s("span",{class:"indicator-icon"},"üîî",-1)),s("span",BT,m(a.count)+" "+m(t.pluralize(a.count,"–Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π")),1),s("div",RT,[s("button",{onClick:e[0]||(e[0]=(...n)=>t.handleApply&&t.handleApply(...n)),class:"btn-apply"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å "),s("button",{onClick:e[1]||(e[1]=(...n)=>t.handleDismiss&&t.handleDismiss(...n)),class:"btn-dismiss"}," ‚úï ")])])])):A("",!0)]),_:1})}const UT=ce(LT,[["render",WT],["__scopeId","data-v-19791dbc"]]);class FT{constructor(e,a={}){this.url=e,this.options={reconnectInterval:3e3,maxReconnectAttempts:10,reconnectDelay:1e3,lastTimestamp:null,...a},this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.reconnectTimer=null,this.isManualDisconnect=!1,this.connectionState="disconnected"}updateOptions(e){this.options={...this.options,...e}}connect(){if(this.connectionState==="connected"||this.connectionState==="connecting"){console.warn("[RealtimeService] Already connected or connecting");return}this.isManualDisconnect=!1,this.connectionState="connecting",this.notifyListeners("state-change",{state:this.connectionState});try{let e=this.url;if(!e.startsWith("http://")&&!e.startsWith("https://")){const a=new URL(e,window.location.origin);this.options.lastTimestamp&&a.searchParams.set("last_timestamp",this.options.lastTimestamp),e=a.toString()}else{const a=new URL(e);this.options.lastTimestamp&&a.searchParams.set("last_timestamp",this.options.lastTimestamp),e=a.toString()}console.log("[RealtimeService] Connecting to:",e),this.eventSource=new EventSource(e),this.eventSource.onopen=()=>{console.log("[RealtimeService] EventSource opened"),this.notifyListeners("open",{timestamp:new Date().toISOString()})},this.eventSource.onmessage=a=>{try{const t=JSON.parse(a.data);this.notifyListeners("message",t)}catch(t){console.error("[RealtimeService] Error parsing message:",t)}},this.eventSource.addEventListener("connected",a=>{try{const t=JSON.parse(a.data);console.log("[RealtimeService] Connected event received:",t),this.connectionState="connected",this.reconnectAttempts=0,this.notifyListeners("connected",t),this.notifyListeners("state-change",{state:this.connectionState})}catch(t){console.error("[RealtimeService] Error parsing connected event:",t)}}),this.eventSource.addEventListener("new_logs",a=>{const t=JSON.parse(a.data);if(t.logs&&t.logs.length>0){const l=t.logs[t.logs.length-1];l.timestamp&&(this.options.lastTimestamp=l.timestamp)}this.notifyListeners("new_logs",t)}),this.eventSource.addEventListener("error",a=>{try{const t=JSON.parse(a.data);this.notifyListeners("error",t)}catch{this.notifyListeners("error",{message:"Server error"})}}),this.eventSource.addEventListener("timeout",a=>{try{const t=JSON.parse(a.data);this.notifyListeners("timeout",t)}catch{this.notifyListeners("timeout",{message:"Connection timeout"})}this.reconnect()}),this.eventSource.addEventListener("closed",a=>{try{const t=JSON.parse(a.data);this.notifyListeners("closed",t)}catch{this.notifyListeners("closed",{message:"Connection closed"})}this.isManualDisconnect||this.reconnect()}),this.eventSource.onerror=a=>{console.error("[RealtimeService] Connection error:",a),console.error("[RealtimeService] EventSource readyState:",this.eventSource?.readyState),this.eventSource?.readyState===EventSource.CLOSED?(console.log("[RealtimeService] EventSource closed by server"),this.connectionState="disconnected",this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()):this.eventSource?.readyState===EventSource.CONNECTING?console.log("[RealtimeService] Still connecting..."):(this.connectionState="error",this.notifyListeners("error",{error:a,type:"connection",message:"Failed to connect to realtime stream",readyState:this.eventSource?.readyState}),this.notifyListeners("state-change",{state:this.connectionState}),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isManualDisconnect||this.reconnect())}}catch(e){console.error("[RealtimeService] Error creating EventSource:",e),this.connectionState="error",this.notifyListeners("error",{error:e,type:"initialization"}),this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()}}reconnect(){if(this.isManualDisconnect)return;if(this.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("[RealtimeService] Max reconnect attempts reached"),this.notifyListeners("max-reconnect-attempts",{attempts:this.reconnectAttempts});return}this.reconnectAttempts++;const e=Math.min(this.options.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.options.reconnectInterval);console.log(`[RealtimeService] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},e)}disconnect(){this.isManualDisconnect=!0,this.connectionState="disconnected",this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.notifyListeners("disconnected",{timestamp:new Date().toISOString()}),this.notifyListeners("state-change",{state:this.connectionState})}on(e,a){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(a)}off(e,a){if(this.listeners.has(e)){const t=this.listeners.get(e),l=t.indexOf(a);l>-1&&t.splice(l,1)}}notifyListeners(e,a){this.listeners.has(e)&&this.listeners.get(e).forEach(t=>{try{t(a)}catch(l){console.error(`[RealtimeService] Error in listener for ${e}:`,l)}})}getState(){return this.connectionState}isConnected(){return this.connectionState==="connected"}}function HT(o,e={}){const{autoConnect:a=!1,enableSound:t=!1,onNewLogs:l=null,validateLogs:r=!0}=e,n=new FT(o,e),i=I("disconnected"),d=I([]),g=I(0),v=I(null),w=I(null),f=I(0),p=$(()=>i.value==="connected"),y=$(()=>i.value==="connecting"),T=$(()=>i.value==="error"),C=$(()=>g.value>0),k=G=>{i.value=G.state,G.state==="connected"&&(f.value=0,w.value=null)},S=G=>{let q=G.logs||[];if(r){q=za(q);const oe=q.filter(Y=>gt(Y));oe.length!==q.length&&console.warn("[useRealtime] Filtered out invalid logs:",q.length-oe.length),q=oe}q.length!==0&&(d.value.push(...q),g.value+=q.length,v.value=new Date().toISOString(),t&&q.length>0&&W(),l&&l(q))},x=G=>{const q=G.message||G.error?.message||"Connection error";w.value=q,i.value="error",console.error("[useRealtime] Error:",G)},U=G=>{console.warn("[useRealtime] Connection timeout:",G)},L=G=>{w.value=`Max reconnect attempts reached (${G.attempts})`,console.error("[useRealtime] Max reconnect attempts:",G)},E=(G={})=>{w.value=null,G.lastTimestamp!==void 0&&n.updateOptions({lastTimestamp:G.lastTimestamp}),n.on("state-change",k),n.on("new_logs",S),n.on("error",x),n.on("timeout",U),n.on("max-reconnect-attempts",L),n.connect()},D=()=>{n.off("state-change",k),n.off("new_logs",S),n.off("error",x),n.off("timeout",U),n.off("max-reconnect-attempts",L),n.disconnect()},N=()=>{d.value=[],g.value=0},B=G=>{G&&Array.isArray(G)&&(G.unshift(...d.value),N())},W=()=>{try{const G=new Audio("/sounds/notification.mp3");G.volume=.3,G.play().catch(q=>{console.warn("[useRealtime] Failed to play sound:",q)})}catch(G){console.warn("[useRealtime] Sound not available:",G)}};return a&&$e(()=>{E()}),at(()=>{D()}),{connectionState:i,isConnected:p,isConnecting:y,hasError:T,newLogs:d,newLogsCount:g,hasNewLogs:C,lastUpdateTime:v,error:w,reconnectAttempts:f,connect:E,disconnect:D,clearNewLogs:N,applyNewLogs:B}}const jT=ys(()=>Ee(()=>import("./WebhookLogsDashboard.vue-Qw37XD05.js"),__vite__mapDeps([8,7,4,2,3,0,1]),import.meta.url)),VT=ys(()=>Ee(()=>import("./WebhookLogDetails.vue-BSVgwfDp.js"),__vite__mapDeps([9,7,4,2,3,0,1]),import.meta.url)),zT={name:"WebhookLogsPage",components:{WebhookLogsDashboard:jT,WebhookLogsExport:Kw,WebhookLogSearch:eC,WebhookLogFilters:bC,WebhookLogList:FC,WebhookLogDetails:VT,SkeletonLogList:XC,EmptyState:nT,ErrorDisplay:hT,NotificationContainer:ST,RealtimeControls:xT,NewLogsIndicator:UT},setup(){const o=Xe(),{success:e,error:a}=mt(),t=I(!1),l=I(!1),r=I(null),n=I(null),i=I([]),d=(M,b=2)=>{if(M==null)return String(M);if(typeof M=="string")return M;const O=(Q,de=0)=>{if(de>10)return"[Max Depth]";if(Q==null||typeof Q!="object")return Q;if(Array.isArray(Q))return Q.map(_e=>O(_e,de+1));const ke={};try{for(const _e in Q)if(Object.prototype.hasOwnProperty.call(Q,_e))try{const K=Q[_e];if(typeof K=="function"||K===void 0)continue;ke[_e]=O(K,de+1)}catch{ke[_e]="[Error reading property]"}}catch{return"[Error reading object]"}return ke};try{const Q=O(M),de=new WeakSet;return JSON.stringify(Q,(ke,_e)=>{if(typeof _e=="object"&&_e!==null){if(de.has(_e))return"[Circular]";de.add(_e)}return _e},b)}catch(Q){return console.error("[WebhookLogsPage] Error in safeStringify:",Q),`[Error: ${Q.message}]`}},g=I(null),v=I([]),w=I(""),f=I(null),p=I(null),y=I(!1),{connectionState:T,newLogsCount:C,error:k,connect:S,disconnect:x,applyNewLogs:U,clearNewLogs:L}=HT(et("/api/webhook-realtime.php"),{autoConnect:!1,enableSound:!0,validateLogs:!0,onNewLogs:M=>{console.log("[WebhookLogsPage] New logs received:",M.length),M.length>0&&(i.value.unshift(...M),B.value.total+=M.length,e(`–ü–æ–ª—É—á–µ–Ω–æ ${M.length} –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π`))}}),{filters:E,updateFilters:D,clearFilters:N}=nw(),B=I({page:1,limit:50,total:0,pages:0}),W=$(()=>{let M=[...i.value];return w.value&&w.value.trim()&&(M=rw(M,w.value,{caseSensitive:!1,searchInEvent:!0,searchInPayload:!0,searchInDetails:!0,searchInIp:!0})),E.value.category&&(M=M.filter(b=>b.category===E.value.category)),E.value.event&&(M=M.filter(b=>b.event===E.value.event)),E.value.ip&&(M=M.filter(b=>b.ip&&b.ip.includes(E.value.ip))),E.value.status&&(M=M.filter(b=>E.value.status==="error"?b.category==="errors":E.value.status==="success"?b.category!=="errors":!0)),E.value.dateFrom&&(M=M.filter(b=>b.timestamp?new Date(b.timestamp).toISOString().split("T")[0]>=E.value.dateFrom:!1)),E.value.dateTo&&(M=M.filter(b=>b.timestamp?new Date(b.timestamp).toISOString().split("T")[0]<=E.value.dateTo:!1)),E.value.hour!==null&&(M=M.filter(b=>b.timestamp?new Date(b.timestamp).getHours()===E.value.hour:!1)),M});Ne(W,M=>{f.value&&w.value&&f.value.setResultsCount(M.length)});const G=async()=>{try{await kt.init();const M=await kt.getCurrentUser();if(console.log("[WebhookLogsPage] User data:",M),!M||!M.ID){console.warn("[WebhookLogsPage] User not determined"),n.value=d({error:"User not determined",userId:M?.ID||null,userName:M?`${M.NAME||""} ${M.LAST_NAME||""}`.trim():null}),t.value=!1;return}const b=M?.UF_DEPARTMENT||[];if(console.log("[WebhookLogsPage] User departments:",b),console.log("[WebhookLogsPage] Allowed departments:",xt.allowedDepartmentIds),b.length>0){const O=b.some(Q=>ws(Q));console.log("[WebhookLogsPage] Has access:",O),t.value=O,O||(n.value=d({userId:M.ID,userName:`${M.NAME||""} ${M.LAST_NAME||""}`.trim(),userDepartments:b,allowedDepartments:xt.allowedDepartmentIds,message:"User departments do not match allowed departments"}))}else console.warn("[WebhookLogsPage] User has no departments"),n.value=d({userId:M.ID,userName:`${M.NAME||""} ${M.LAST_NAME||""}`.trim(),userDepartments:[],allowedDepartments:xt.allowedDepartmentIds,message:"User has no departments assigned"}),t.value=!1}catch(M){console.error("[WebhookLogsPage] Error checking access:",M),n.value=d({error:M.message,stack:M.stack}),t.value=!1}},q=$(()=>xt.allowedDepartmentIds.join(", ")),oe=async(M=!1)=>{if(t.value&&!(Z&&!M)){Z=!0,l.value=!0,r.value=null;try{const b=new Date().toISOString().split("T")[0],O={category:E.value.category||null,event:E.value.event||null,date:E.value.dateFrom||b,hour:E.value.hour!==null&&E.value.hour!==void 0?E.value.hour:null,ip:E.value.ip||null,status:E.value.status||null,dateFrom:E.value.dateFrom||b,dateTo:E.value.dateTo||null};if(!Oa(O))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");console.log("[WebhookLogsPage] Loading logs with filters:",O);const Q=await us.getLogs(O,B.value.page,B.value.limit,M);if(console.log("[WebhookLogsPage] API result:",Q),console.log("[WebhookLogsPage] Logs count:",Q?.logs?.length||0),console.log("[WebhookLogsPage] Pagination:",Q?.pagination),!Q.success)throw new Error(Q.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤");lw(Q.pagination)?B.value=Q.pagination:(console.warn("[WebhookLogsPage] Invalid pagination format, using defaults"),B.value={page:B.value.page,limit:B.value.limit,total:Q.logs.length,pages:Math.ceil(Q.logs.length/B.value.limit)});const de=za(Q.logs),ke=de.filter(_e=>gt(_e));ke.length!==de.length&&console.warn("[WebhookLogsPage] Filtered out invalid logs:",de.length-ke.length),i.value=ke,M&&e("–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")}catch(b){Y(b)}finally{l.value=!1,Z=!1}}},Y=M=>{console.error("[WebhookLogsPage] API Error:",M),M.status===403?(r.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",a("–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º –≤–µ–±—Ö—É–∫–æ–≤")):M.status===404?(r.value="–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",a("–õ–æ–≥–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")):M.status>=500?(r.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",a("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")):(r.value=M.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",a(r.value)),M.status>=500&&(i.value=[])},H=M=>{w.value=M,D({search:M||null})};let Z=!1;const fe=M=>{if(!Oa(M)){a("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");return}const b={category:E.value.category,event:E.value.event,dateFrom:E.value.dateFrom,dateTo:E.value.dateTo,hour:E.value.hour,ip:E.value.ip,status:E.value.status},O={category:M?.category||null,event:M?.event||null,dateFrom:M?.dateFrom||null,dateTo:M?.dateTo||null,hour:M?.hour!==void 0?M.hour:null,ip:M?.ip||null,status:M?.status||null},Q=Object.keys(O).some(de=>{const ke=b[de],_e=O[de];return ke!==_e});if(!(!Q&&!Z)){if(D(O),B.value.page=1,Q)try{us.invalidateCacheOnFilterChange(b,O)}catch(de){console.error("[WebhookLogsPage] Error invalidating cache:",de)}Z||(Z=!0,oe(!0).finally(()=>{Z=!1}))}},P=()=>{N(),w.value="",B.value.page=1,oe()},h=M=>{g.value=M},_=()=>{g.value=null},R=M=>{B.value.page=M,oe()},re=()=>{try{o.push("/")}catch(M){console.error("Navigation error:",M),window.location.hash="#/"}},ie=M=>{v.value=M},se=M=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—á–∞—Ç:",M)},me=M=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω:",M),e(`–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω: ${M.count} –∑–∞–ø–∏—Å–µ–π –≤ —Ñ–∞–π–ª–µ ${M.filename}`)},Se=M=>{console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:",M),a(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${M.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`)},Ie=()=>{w.value="",P()},xe=M=>{if(console.log("[WebhookLogsPage] Toggle auto-update:",M),y.value=M,M){let b=null;if(i.value.length>0){const O=i.value[0];O.timestamp&&(b=O.timestamp,console.log("[WebhookLogsPage] Using lastTimestamp:",b))}S({lastTimestamp:b})}else x()},Fe=()=>{U(i.value),e("–ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")},z=()=>{L()};return $e(async()=>{await G(),t.value&&(E.value.search&&(w.value=E.value.search),await oe())}),{hasAccess:t,loading:l,error:r,logs:i,filteredLogs:W,selectedLog:g,selectedLogs:v,filters:E,searchQuery:w,searchComponent:f,pagination:B,previousPeriodStats:p,handleFiltersUpdate:fe,handleFiltersReset:P,handleSearch:H,handleLogSelect:h,handleLogClose:_,handlePageChange:R,handleSelectedLogsUpdate:ie,handleExportStart:se,handleExportComplete:me,handleExportError:Se,handleClearSearch:Ie,autoUpdateEnabled:y,connectionState:T,newLogsCount:C,realtimeError:k,handleToggleAutoUpdate:xe,handleApplyNewLogs:Fe,handleDismissNewLogs:z,allowedDepartmentsText:q,accessDebugInfo:n,goBack:re}}},GT={class:"webhook-logs-page"},KT={class:"page-header"},qT={class:"page-header-top"},YT={key:0,class:"access-denied"},XT={class:"access-denied-content"},JT={class:"access-hint"},ZT={key:0,class:"access-debug"},QT={key:1,class:"page-content"},eS={class:"actions-bar"};function tS(o,e,a,t,l,r){const n=be("WebhookLogsDashboard"),i=be("WebhookLogsExport"),d=be("WebhookLogSearch"),g=be("RealtimeControls"),v=be("NewLogsIndicator"),w=be("WebhookLogFilters"),f=be("SkeletonLogList"),p=be("WebhookLogList"),y=be("EmptyState"),T=be("ErrorDisplay"),C=be("WebhookLogDetails"),k=be("NotificationContainer");return c(),u("div",GT,[s("div",KT,[s("div",qT,[s("button",{onClick:e[0]||(e[0]=(...S)=>t.goBack&&t.goBack(...S)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[3]||(e[3]=[s("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),s("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[4]||(e[4]=s("h1",null,"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ Bitrix24",-1))]),t.hasAccess?(c(),u("div",QT,[ne(n,{logs:t.logs,pagination:t.pagination,"previous-period-stats":t.previousPeriodStats},null,8,["logs","pagination","previous-period-stats"]),s("div",eS,[ne(i,{logs:t.filteredLogs,"selected-logs":t.selectedLogs,filters:t.filters,"total-count":t.filteredLogs.length,onExportStart:t.handleExportStart,onExportComplete:t.handleExportComplete,onExportError:t.handleExportError},null,8,["logs","selected-logs","filters","total-count","onExportStart","onExportComplete","onExportError"]),ne(d,{modelValue:t.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=S=>t.searchQuery=S),onSearch:t.handleSearch,ref:"searchComponent"},null,8,["modelValue","onSearch"])]),ne(g,{enabled:t.autoUpdateEnabled,"connection-state":t.connectionState,error:t.realtimeError,onToggle:t.handleToggleAutoUpdate},null,8,["enabled","connection-state","error","onToggle"]),ne(v,{count:t.newLogsCount,onApply:t.handleApplyNewLogs,onDismiss:t.handleDismissNewLogs},null,8,["count","onApply","onDismiss"]),ne(w,{filters:t.filters,"onUpdate:filters":t.handleFiltersUpdate,onReset:t.handleFiltersReset},null,8,["filters","onUpdate:filters","onReset"]),ne(Ae,{name:"fade"},{default:ye(()=>[t.loading&&t.logs.length===0?(c(),he(f,{key:0,rows:5})):A("",!0)]),_:1}),ne(Ae,{name:"fade"},{default:ye(()=>[!t.loading&&t.filteredLogs.length>0?(c(),he(p,{key:0,logs:t.filteredLogs,loading:!1,error:null,pagination:t.pagination,"selected-logs":t.selectedLogs,onSelectLog:t.handleLogSelect,onPageChange:t.handlePageChange,"onUpdate:selectedLogs":t.handleSelectedLogsUpdate},null,8,["logs","pagination","selected-logs","onSelectLog","onPageChange","onUpdate:selectedLogs"])):A("",!0)]),_:1}),ne(Ae,{name:"fade"},{default:ye(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length===0?(c(),he(y,{key:0,icon:"üì≠",title:"–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",description:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Bitrix24.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è","–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",onAction:t.handleFiltersReset},null,8,["onAction"])):A("",!0)]),_:1}),ne(Ae,{name:"fade"},{default:ye(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length>0?(c(),he(y,{key:0,icon:"üîç",title:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",description:"–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã","–û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",onAction:t.handleClearSearch},null,8,["onAction"])):A("",!0)]),_:1}),ne(Ae,{name:"fade"},{default:ye(()=>[t.error?(c(),he(T,{key:0,title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤",message:t.error,retryable:!0,onRetry:o.loadLogs},null,8,["message","onRetry"])):A("",!0)]),_:1}),t.selectedLog?(c(),u("div",{key:0,class:"modal-overlay",onClick:e[2]||(e[2]=(...S)=>t.handleLogClose&&t.handleLogClose(...S))})):A("",!0),ne(Ae,{name:"modal"},{default:ye(()=>[t.selectedLog?(c(),he(C,{key:0,log:t.selectedLog,onClose:t.handleLogClose},null,8,["log","onClose"])):A("",!0)]),_:1})])):(c(),u("div",YT,[s("div",XT,[e[7]||(e[7]=s("h2",null,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",-1)),e[8]||(e[8]=s("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤.",-1)),s("p",JT,[e[5]||(e[5]=ge(" –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ –æ—Ç–¥–µ–ª–æ–≤: ",-1)),s("strong",null,m(t.allowedDepartmentsText),1)]),e[9]||(e[9]=s("p",{class:"access-hint"}," –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã. ",-1)),t.accessDebugInfo?(c(),u("details",ZT,[e[6]||(e[6]=s("summary",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",-1)),s("pre",null,m(t.accessDebugInfo),1)])):A("",!0)])])),ne(k)])}const aS=ce(zT,[["render",tS],["__scopeId","data-v-628bf174"]]),sS={name:"DrillDownNavigation",props:{breadcrumbs:{type:Array,default:()=>[],validator:o=>Array.isArray(o)&&o.every(e=>typeof e=="object"&&typeof e.id=="string"&&typeof e.label=="string")},separator:{type:String,default:">"},showBackButton:{type:Boolean,default:!0},additionalActions:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},maxLabelLength:{type:Number,default:30}},emits:["navigate","back","action"],setup(o,{emit:e}){const a=$(()=>o.breadcrumbs.map(d=>({...d,label:l(d.label,o.maxLabelLength)}))),t=$(()=>{const d=a.value;return d.length<=5?d:[d[0],{id:"ellipsis-start",label:"...",isEllipsis:!0},...d.slice(-3)]}),l=(d,g)=>d.length<=g?d:d.substring(0,g-3)+"...";return{visibleBreadcrumbs:t,handleNavigate:d=>{d.action&&e("navigate",d)},handleBack:()=>{e("back")},handleAction:d=>{e("action",d)}}}},oS={class:"drilldown-navigation",role:"navigation","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"},nS={class:"breadcrumb-list"},rS={key:0,class:"breadcrumb-separator","aria-hidden":"true"},lS=["onClick","onKeydown","aria-label","title"],iS={class:"breadcrumb-text"},cS={key:2,class:"breadcrumb-current-text","aria-current":"page"},dS={class:"breadcrumb-text"},uS={key:3,class:"breadcrumb-loading","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"},gS=["aria-label","title"],mS={key:1,class:"breadcrumb-actions"},hS=["onClick","onKeydown","aria-label","title","disabled"],fS={key:1,class:"action-text"};function vS(o,e,a,t,l,r){return c(),u("nav",oS,[s("ol",nS,[(c(!0),u(ee,null,te(a.breadcrumbs,(n,i)=>(c(),u("li",{key:n.id,class:X(["breadcrumb-item",{"breadcrumb-current":i===a.breadcrumbs.length-1,"breadcrumb-interactive":i<a.breadcrumbs.length-1}])},[i>0?(c(),u("span",rS,m(a.separator),1)):A("",!0),i<a.breadcrumbs.length-1&&n.action?(c(),u("button",{key:1,class:"breadcrumb-link",onClick:d=>t.handleNavigate(n),onKeydown:[Re(d=>t.handleNavigate(n),["enter"]),Re(d=>t.handleNavigate(n),["space"])],"aria-label":`–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–∞–∑–¥–µ–ª—É ${n.label}`,title:`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${n.label}`},[n.icon?(c(),he(wt(n.icon),{key:0,class:"breadcrumb-icon","aria-hidden":"true"})):A("",!0),s("span",iS,m(n.label),1)],40,lS)):(c(),u("span",cS,[n.icon?(c(),he(wt(n.icon),{key:0,class:"breadcrumb-icon","aria-hidden":"true"})):A("",!0),s("span",dS,m(n.label),1)])),i===a.breadcrumbs.length-1&&a.isLoading?(c(),u("div",uS,[...e[3]||(e[3]=[s("div",{class:"loading-spinner","aria-hidden":"true"},null,-1)])])):A("",!0)],2))),128))]),a.showBackButton&&a.breadcrumbs.length>1?(c(),u("button",{key:0,class:"back-button",onClick:e[0]||(e[0]=(...n)=>t.handleBack&&t.handleBack(...n)),onKeydown:[e[1]||(e[1]=Re((...n)=>t.handleBack&&t.handleBack(...n),["enter"])),e[2]||(e[2]=Re((...n)=>t.handleBack&&t.handleBack(...n),["space"]))],"aria-label":`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${a.breadcrumbs[a.breadcrumbs.length-2]?.label||"–ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Ä–∞–∑–¥–µ–ª—É"}`,title:`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${a.breadcrumbs[a.breadcrumbs.length-2]?.label||"–ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Ä–∞–∑–¥–µ–ª—É"}`},[...e[4]||(e[4]=[s("svg",{class:"back-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[s("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})],-1),s("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])],40,gS)):A("",!0),a.additionalActions.length>0?(c(),u("div",mS,[(c(!0),u(ee,null,te(a.additionalActions,n=>(c(),u("button",{key:n.id,class:X(["action-button",n.class]),onClick:i=>t.handleAction(n),onKeydown:[Re(i=>t.handleAction(n),["enter"]),Re(i=>t.handleAction(n),["space"])],"aria-label":n.label,title:n.title||n.label,disabled:n.disabled},[n.icon?(c(),he(wt(n.icon),{key:0,class:"action-icon","aria-hidden":"true"})):A("",!0),n.text?(c(),u("span",fS,m(n.text),1)):A("",!0)],42,hS))),128))])):A("",!0)])}const pS=ce(sS,[["render",vS],["__scopeId","data-v-e0da3deb"]]),yS={name:"MetricCard",emits:["click"],props:{metric:{type:Object,default:()=>({})},title:{type:String,required:!0},value:{type:[Number,String],required:!0},unit:{type:String,default:""},subtitle:{type:String,default:""},icon:{type:String,default:""},trend:{type:Number,default:null},trendPeriod:{type:String,default:""},progress:{type:Number,default:null},size:{type:String,default:"medium",validator:o=>["small","medium","large","compact"].includes(o)},interactive:{type:Boolean,default:!1}},computed:{formattedValue(){return typeof this.value=="number"?this.value>=1e6?`${(this.value/1e6).toFixed(1)}M`:this.value>=1e3?`${(this.value/1e3).toFixed(1)}K`:this.value.toLocaleString():this.value}}},kS={class:"metric-header"},bS=["innerHTML"],_S={class:"metric-title"},wS={class:"metric-value-section"},CS={class:"metric-value"},TS={key:0,class:"metric-unit"},SS={key:0,class:"metric-subtitle"},DS={key:1,class:"metric-trend"},ES={class:"trend-indicator"},AS={key:0,viewBox:"0 0 24 24",width:"12",height:"12"},$S={key:1,viewBox:"0 0 24 24",width:"12",height:"12"},IS={key:2,viewBox:"0 0 24 24",width:"12",height:"12"},MS={class:"trend-value"},NS={class:"trend-period"},xS={key:2,class:"metric-progress"},LS={class:"progress-bar"},PS={class:"progress-text"};function OS(o,e,a,t,l,r){return c(),u("div",{class:X(["metric-card",{[`size-${a.size}`]:!0,"has-trend":a.trend!==null,"trend-up":a.trend>0,"trend-down":a.trend<0,"trend-neutral":a.trend===0,interactive:a.interactive}]),onClick:e[0]||(e[0]=n=>a.interactive?o.$emit("click",a.metric):null)},[s("div",kS,[a.icon?(c(),u("div",{key:0,class:"metric-icon",innerHTML:a.icon},null,8,bS)):A("",!0),s("div",_S,m(a.title),1)]),s("div",wS,[s("div",CS,m(r.formattedValue),1),a.unit?(c(),u("div",TS,m(a.unit),1)):A("",!0)]),a.subtitle?(c(),u("div",SS,m(a.subtitle),1)):A("",!0),a.trend!==null?(c(),u("div",DS,[s("div",ES,[a.trend>0?(c(),u("svg",AS,[...e[1]||(e[1]=[s("path",{d:"M7 14l5-5 5 5z",fill:"currentColor"},null,-1)])])):a.trend<0?(c(),u("svg",$S,[...e[2]||(e[2]=[s("path",{d:"M7 10l5 5 5-5z",fill:"currentColor"},null,-1)])])):(c(),u("svg",IS,[...e[3]||(e[3]=[s("path",{d:"M7 12h10v-2H7z",fill:"currentColor"},null,-1)])]))]),s("span",MS,m(Math.abs(a.trend))+"%",1),s("span",NS,m(a.trendPeriod||"vs prev"),1)])):A("",!0),a.progress!==null?(c(),u("div",xS,[s("div",LS,[s("div",{class:"progress-fill",style:we({width:`${Math.min(a.progress,100)}%`})},null,4)]),s("span",PS,m(a.progress)+"%",1)])):A("",!0)],2)}const BS=ce(yS,[["render",OS],["__scopeId","data-v-b8d66bef"]]),RS={name:"ContextSidebar",components:{MetricCard:BS},props:{context:{type:String,default:"global",validator:o=>["global","user","management"].includes(o)},selectedUser:{type:Object,default:null},selectedUsers:{type:Array,default:()=>[]},globalMetrics:{type:Array,default:()=>[]},userStats:{type:Object,default:()=>({})},userFilters:{type:Object,default:()=>({timeRange:"week",activity_types:[]})},filterPresets:{type:Array,default:()=>[]},activePreset:{type:String,default:null},recentActivity:{type:Array,default:()=>[]},auditLog:{type:Array,default:()=>[]},activityTypes:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},collapsed:{type:Boolean,default:!1},canEditPermissions:{type:Boolean,default:!1}},emits:["toggle-collapse","metric-click","filter-preset-apply","activity-click","filter-change","view-profile","export-data","edit-permissions","bulk-action","user-select"],setup(o,{emit:e}){const a=I(o.collapsed),t=$(()=>{if(!o.selectedUser?.name)return"";const[x,U]=o.selectedUser.name.split(" ");return`${x?.[0]||""}${U?.[0]||""}`.toUpperCase()}),l=()=>{a.value=!a.value,e("toggle-collapse",a.value)},r=()=>{switch(o.context){case"global":return"–û–±–∑–æ—Ä";case"user":return"–ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è";case"management":return"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ";default:return"–û–±–∑–æ—Ä"}},n=()=>`${r()} - –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π`,i=x=>{switch(x){case"online":return"–û–Ω–ª–∞–π–Ω";case"away":return"–û—Ç–æ—à—ë–ª";case"offline":return"–û—Ñ—Ñ–ª–∞–π–Ω";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}},d=x=>{if(!x)return"";const[U,L]=x.split(" ");return`${U?.[0]||""}${L?.[0]||""}`.toUpperCase()},g=x=>{const U=Math.floor(x/60),L=x%60;return`${U}:${L.toString().padStart(2,"0")}`},v=x=>{const U=new Date(x),E=new Date-U,D=Math.floor(E/(1e3*60)),N=Math.floor(E/(1e3*60*60)),B=Math.floor(E/(1e3*60*60*24));return D<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":D<60?`${D} –º–∏–Ω –Ω–∞–∑–∞–¥`:N<24?`${N} —á –Ω–∞–∑–∞–¥`:B<7?`${B} –¥ –Ω–∞–∑–∞–¥`:U.toLocaleDateString()},w=x=>{e("metric-click",x)},f=x=>{e("filter-preset-apply",x)},p=x=>{e("activity-click",x)},y=()=>{e("filter-change",o.userFilters)},T=()=>{e("view-profile",o.selectedUser)},C=()=>{e("export-data",o.selectedUser)},k=()=>{e("edit-permissions",o.selectedUser)},S=x=>{e("bulk-action",{action:x,users:o.selectedUsers})};return Ne(()=>o.collapsed,x=>{a.value=x}),{isCollapsed:a,userInitials:t,toggleCollapse:l,getContextTitle:r,getAriaLabel:n,getStatusText:i,getUserInitials:d,formatDuration:g,formatTime:v,handleMetricClick:w,applyFilterPreset:f,handleActivityClick:p,handleFilterChange:y,viewDetailedProfile:T,exportUserData:C,editPermissions:k,performBulkAction:S}}},WS=["aria-label"],US=["aria-label","title"],FS={class:"sidebar-header"},HS={class:"context-title"},jS={key:0,class:"user-indicator"},VS={class:"user-avatar"},zS=["src","alt"],GS={key:1,class:"avatar-placeholder"},KS={class:"user-info"},qS={class:"user-name"},YS={key:0,class:"global-context-content"},XS={class:"metrics-section"},JS={class:"metrics-grid"},ZS={class:"filters-section"},QS={class:"filter-presets"},eD=["onClick","aria-label"],tD={class:"preset-label"},aD={key:0,class:"preset-count"},sD={class:"recent-activity-section"},oD={class:"recent-activity-list"},nD=["onClick"],rD={class:"activity-content"},lD={class:"activity-text"},iD={class:"activity-time"},cD={key:1,class:"user-context-content"},dD={class:"user-stats-section"},uD={class:"user-stats-grid"},gD={class:"stat-item"},mD={class:"stat-value"},hD={class:"stat-item"},fD={class:"stat-value"},vD={class:"stat-item"},pD={class:"stat-value"},yD={class:"stat-item"},kD={class:"stat-value"},bD={class:"analysis-filters-section"},_D={class:"filter-controls"},wD={class:"filter-group"},CD={class:"filter-group"},TD={class:"checkbox-group"},SD=["value"],DD={class:"user-actions-section"},ED={class:"action-buttons"},AD=["aria-label"],$D=["aria-label"],ID=["aria-label"],MD={key:2,class:"management-context-content"},ND={key:0,class:"selected-users-section"},xD={class:"section-title"},LD={class:"selected-users-list"},PD={class:"user-avatar small"},OD=["src","alt"],BD={key:1,class:"avatar-placeholder small"},RD={class:"user-name"},WD={key:0,class:"more-users"},UD={class:"bulk-operations-section"},FD={class:"bulk-actions"},HD=["disabled"],jD=["disabled"],VD=["disabled"],zD={class:"audit-log-section"},GD={class:"audit-log-list"},KD={class:"audit-content"},qD={class:"audit-text"},YD={class:"audit-time"},XD={key:0,class:"sidebar-loading-overlay"};function JD(o,e,a,t,l,r){const n=be("MetricCard");return c(),u("aside",{class:X(["context-sidebar",{collapsed:t.isCollapsed,"context-global":a.context==="global","context-user":a.context==="user","context-management":a.context==="management"}]),role:"complementary","aria-label":t.getAriaLabel()},[s("button",{class:"collapse-toggle",onClick:e[0]||(e[0]=(...i)=>t.toggleCollapse&&t.toggleCollapse(...i)),onKeydown:[e[1]||(e[1]=Re((...i)=>t.toggleCollapse&&t.toggleCollapse(...i),["enter"])),e[2]||(e[2]=Re((...i)=>t.toggleCollapse&&t.toggleCollapse(...i),["space"]))],"aria-label":t.isCollapsed?"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å":"–°–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å",title:t.isCollapsed?"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å":"–°–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å"},[(c(),u("svg",{class:X(["collapse-icon",{rotated:t.isCollapsed}]),viewBox:"0 0 24 24","aria-hidden":"true"},[...e[13]||(e[13]=[s("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"},null,-1)])],2))],40,US),s("header",FS,[s("h3",HS,m(t.getContextTitle()),1),a.context==="user"&&a.selectedUser?(c(),u("div",jS,[s("div",VS,[a.selectedUser.avatar?(c(),u("img",{key:0,src:a.selectedUser.avatar,alt:`–ê–≤–∞—Ç–∞—Ä ${a.selectedUser.name}`},null,8,zS)):(c(),u("div",GS,m(t.userInitials),1))]),s("div",KS,[s("div",qS,m(a.selectedUser.name),1),s("div",{class:X(["user-status",a.selectedUser.status])},m(t.getStatusText(a.selectedUser.status)),3)])])):A("",!0)]),s("div",{class:X(["sidebar-content",{"content-collapsed":t.isCollapsed}])},[a.context==="global"?(c(),u("div",YS,[s("section",XS,[e[14]||(e[14]=s("h4",{class:"section-title"},"–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",-1)),s("div",JS,[(c(!0),u(ee,null,te(a.globalMetrics,i=>(c(),he(n,{key:i.id,metric:i,size:"compact",onClick:t.handleMetricClick},null,8,["metric","onClick"]))),128))])]),s("section",ZS,[e[15]||(e[15]=s("h4",{class:"section-title"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã",-1)),s("div",QS,[(c(!0),u(ee,null,te(a.filterPresets,i=>(c(),u("button",{key:i.id,class:X(["filter-preset",{active:a.activePreset===i.id}]),onClick:d=>t.applyFilterPreset(i),"aria-label":`–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä: ${i.label}`},[(c(),he(wt(i.icon),{class:"preset-icon"})),s("span",tD,m(i.label),1),i.count!==void 0?(c(),u("span",aD,m(i.count),1)):A("",!0)],10,eD))),128))])]),s("section",sD,[e[16]||(e[16]=s("h4",{class:"section-title"},"–ù–µ–¥–∞–≤–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",-1)),s("div",oD,[(c(!0),u(ee,null,te(a.recentActivity,i=>(c(),u("div",{key:i.id,class:"activity-item",onClick:d=>t.handleActivityClick(i)},[s("div",{class:X(["activity-icon",i.type])},[(c(),he(wt(i.icon)))],2),s("div",rD,[s("div",lD,m(i.text),1),s("div",iD,m(t.formatTime(i.timestamp)),1)])],8,nD))),128))])])])):a.context==="user"?(c(),u("div",cD,[s("section",dD,[e[21]||(e[21]=s("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",-1)),s("div",uD,[s("div",gD,[s("div",mD,m(a.userStats.total_actions||0),1),e[17]||(e[17]=s("div",{class:"stat-label"},"–¥–µ–π—Å—Ç–≤–∏–π",-1)),a.userStats.actions_change!==0?(c(),u("div",{key:0,class:X(["stat-change",{positive:a.userStats.actions_change>0,negative:a.userStats.actions_change<0}])},m(a.userStats.actions_change>0?"+":"")+m(a.userStats.actions_change)+"% ",3)):A("",!0)]),s("div",hD,[s("div",fD,m(t.formatDuration(a.userStats.avg_session_duration||0)),1),e[18]||(e[18]=s("div",{class:"stat-label"},"—Å—Ä–µ–¥–Ω—è—è —Å–µ—Å—Å–∏—è",-1))]),s("div",vD,[s("div",pD,m(a.userStats.total_sessions||0),1),e[19]||(e[19]=s("div",{class:"stat-label"},"—Å–µ—Å—Å–∏–π",-1))]),s("div",yD,[s("div",kD,m(a.userStats.activity_score||0)+"/100",1),e[20]||(e[20]=s("div",{class:"stat-label"},"–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1))])])]),s("section",bD,[e[26]||(e[26]=s("h4",{class:"section-title"},"–§–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞",-1)),s("div",_D,[s("div",wD,[e[23]||(e[23]=s("label",{class:"filter-label"},"–ü–µ—Ä–∏–æ–¥:",-1)),Be(s("select",{"onUpdate:modelValue":e[3]||(e[3]=i=>a.userFilters.timeRange=i),class:"filter-select",onChange:e[4]||(e[4]=(...i)=>t.handleFilterChange&&t.handleFilterChange(...i))},[...e[22]||(e[22]=[_t('<option value="today" data-v-abccaced>–°–µ–≥–æ–¥–Ω—è</option><option value="week" data-v-abccaced>–ù–µ–¥–µ–ª—è</option><option value="month" data-v-abccaced>–ú–µ—Å—è—Ü</option><option value="quarter" data-v-abccaced>–ö–≤–∞—Ä—Ç–∞–ª</option><option value="year" data-v-abccaced>–ì–æ–¥</option>',5)])],544),[[dt,a.userFilters.timeRange]])]),s("div",CD,[e[25]||(e[25]=s("label",{class:"filter-label"},"–¢–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π:",-1)),s("div",TD,[(c(!0),u(ee,null,te(a.activityTypes,i=>(c(),u("label",{key:i.id,class:"checkbox-label"},[Be(s("input",{type:"checkbox",value:i.id,"onUpdate:modelValue":e[5]||(e[5]=d=>a.userFilters.activity_types=d),onChange:e[6]||(e[6]=(...d)=>t.handleFilterChange&&t.handleFilterChange(...d))},null,40,SD),[[ka,a.userFilters.activity_types]]),e[24]||(e[24]=s("span",{class:"checkmark"},null,-1)),ge(" "+m(i.label),1)]))),128))])])])]),s("section",DD,[e[30]||(e[30]=s("h4",{class:"section-title"},"–î–µ–π—Å—Ç–≤–∏—è",-1)),s("div",ED,[s("button",{class:"action-button primary",onClick:e[7]||(e[7]=(...i)=>t.viewDetailedProfile&&t.viewDetailedProfile(...i)),"aria-label":`–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å ${a.selectedUser?.name}`},[...e[27]||(e[27]=[s("svg",{class:"action-icon",viewBox:"0 0 24 24"},[s("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L19 6.6C18.8 6 18.5 5.4 18.1 4.9L19 3L17 1L15.4 1.9C14.9 1.5 14.3 1.2 13.7 1L13 0V2C12.4 2 11.8 2.2 11.3 2.6L10.6 1.9L8.6 3L9.5 4.9C9.1 5.4 8.8 6 8.6 6.6L7 7V9L8.6 8.4C8.8 9 9.1 9.6 9.5 10.1L8.6 12L10.6 13.9L11.3 13.2C11.8 13.6 12.4 13.8 13 14V16H11V18H13V20H11V22H13V20H15V18H13V16H15V14C15.6 14 16.2 13.6 16.7 13.2L17.4 13.9L19.4 12L18.5 10.1C18.9 9.6 19.2 9 19.4 8.4L21 9ZM12 8C10.9 8 10 7.1 10 6C10 4.9 10.9 4 12 4C13.1 4 14 4.9 14 6C14 7.1 13.1 8 12 8Z"})],-1),ge(" –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å ",-1)])],8,AD),s("button",{class:"action-button secondary",onClick:e[8]||(e[8]=(...i)=>t.exportUserData&&t.exportUserData(...i)),"aria-label":`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ ${a.selectedUser?.name}`},[...e[28]||(e[28]=[s("svg",{class:"action-icon",viewBox:"0 0 24 24"},[s("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),ge(" –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö ",-1)])],8,$D),a.canEditPermissions?(c(),u("button",{key:0,class:"action-button warning",onClick:e[9]||(e[9]=(...i)=>t.editPermissions&&t.editPermissions(...i)),"aria-label":`–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ${a.selectedUser?.name}`},[...e[29]||(e[29]=[s("svg",{class:"action-icon",viewBox:"0 0 24 24"},[s("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),ge(" –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ",-1)])],8,ID)):A("",!0)])])])):a.context==="management"?(c(),u("div",MD,[a.selectedUsers.length>0?(c(),u("section",ND,[s("h4",xD,"–í—ã–±—Ä–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: "+m(a.selectedUsers.length),1),s("div",LD,[(c(!0),u(ee,null,te(a.selectedUsers.slice(0,3),i=>(c(),u("div",{key:i.id,class:"selected-user-item"},[s("div",PD,[i.avatar?(c(),u("img",{key:0,src:i.avatar,alt:i.name},null,8,OD)):(c(),u("div",BD,m(t.getUserInitials(i.name)),1))]),s("span",RD,m(i.name),1)]))),128)),a.selectedUsers.length>3?(c(),u("div",WD," +"+m(a.selectedUsers.length-3)+" –µ—â—ë ",1)):A("",!0)])])):A("",!0),s("section",UD,[e[34]||(e[34]=s("h4",{class:"section-title"},"–ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",-1)),s("div",FD,[s("button",{class:"bulk-action-button",onClick:e[10]||(e[10]=i=>t.performBulkAction("change_department")),disabled:a.selectedUsers.length===0},[...e[31]||(e[31]=[s("svg",{class:"action-icon",viewBox:"0 0 24 24"},[s("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),ge(" –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–¥–µ–ª ",-1)])],8,HD),s("button",{class:"bulk-action-button",onClick:e[11]||(e[11]=i=>t.performBulkAction("toggle_admin")),disabled:a.selectedUsers.length===0},[...e[32]||(e[32]=[s("svg",{class:"action-icon",viewBox:"0 0 24 24"},[s("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),ge(" –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ",-1)])],8,jD),s("button",{class:"bulk-action-button",onClick:e[12]||(e[12]=i=>t.performBulkAction("export")),disabled:a.selectedUsers.length===0},[...e[33]||(e[33]=[s("svg",{class:"action-icon",viewBox:"0 0 24 24"},[s("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),ge(" –≠–∫—Å–ø–æ—Ä—Ç ",-1)])],8,VD)])]),s("section",zD,[e[35]||(e[35]=s("h4",{class:"section-title"},"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è",-1)),s("div",GD,[(c(!0),u(ee,null,te(a.auditLog.slice(0,5),i=>(c(),u("div",{key:i.id,class:"audit-entry"},[s("div",{class:X(["audit-icon",i.type])},[(c(),he(wt(i.icon)))],2),s("div",KD,[s("div",qD,m(i.text),1),s("div",YD,m(t.formatTime(i.timestamp)),1)])]))),128))])])])):A("",!0)],2),a.isLoading?(c(),u("div",XD,[...e[36]||(e[36]=[s("div",{class:"loading-spinner","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"},null,-1)])])):A("",!0)],10,WS)}const ZD=ce(RS,[["render",JD],["__scopeId","data-v-abccaced"]]),ms=o=>new Date(o),QD=(o,e,a={})=>{const t=new Date(o),l=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return e.replace("yyyy",l).replace("MM",r).replace("dd",n)},e2={name:"UnifiedUserCard",props:{user:{type:Object,required:!0,validator:o=>o&&typeof o=="object"&&o.id&&o.name&&o.email},isSelected:{type:Boolean,default:!1},showExtendedMetrics:{type:Boolean,default:!1},compactView:{type:Boolean,default:!1},canEditPermissions:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},maxDepartments:{type:Number,default:2}},emits:["select","view-profile","edit-permissions","toggle-hidden","view-analytics","export-data","send-notification","view-audit","delete-user"],setup(o,{emit:e}){const a=I(!1),t=I(null),l=$(()=>{const[P,h]=o.user.name.split(" ");return`${P?.[0]||""}${h?.[0]||""}`.toUpperCase()}),r=$(()=>{const P=["#2196F3","#4CAF50","#FF9800","#F44336","#9C27B0","#00BCD4","#8BC34A","#FFC107","#E91E63","#3F51B5"];return P[Math.abs(o.user.id)%P.length]}),n=$(()=>(o.user.departments||[]).slice(0,o.maxDepartments).map(h=>({...h,shortName:h.name.length>10?h.name.substring(0,8)+"...":h.name}))),i=$(()=>{const P=o.user.departments||[];return Math.max(0,P.length-o.maxDepartments)}),d=$(()=>{const P=o.user.activity_stats?.total_actions||0;return P>=1e6?`${(P/1e6).toFixed(1)}M`:P>=1e3?`${(P/1e3).toFixed(1)}K`:P.toLocaleString()}),g=$(()=>{const P=o.user.activity_stats?.total_sessions||0;return P>=1e3?`${(P/1e3).toFixed(1)}K`:P.toString()}),v=$(()=>{const P=o.user.activity_stats?.avg_session_duration||0,h=Math.floor(P/60),_=Math.floor(P%60);return`${h}:${_.toString().padStart(2,"0")}`}),w=$(()=>{const P=o.user.activity_stats?.last_activity;if(!P)return"–ù–∏–∫–æ–≥–¥–∞";let h;try{h=typeof P=="string"?ms(P):new Date(P)}catch{return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}const R=new Date-h,re=Math.floor(R/(1e3*60*60*24)),ie=Math.floor(R/(1e3*60*60)),se=Math.floor(R/(1e3*60));return se<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":se<60?`${se} –º–∏–Ω`:ie<24?`${ie} —á`:re<7?`${re} –¥`:re<30?`${Math.floor(re/7)} –Ω–µ–¥`:QD(h,"dd.MM.yyyy")}),f=$(()=>Math.min(100,Math.max(0,o.user.activity_stats?.activity_score||0))),p=$(()=>o.user.activity_stats?.actions_change_percent||0),y=$(()=>o.user.status||"offline"),T=$(()=>!!o.user.is_admin),C=$(()=>{if(!o.user.created_at)return!1;try{const P=typeof o.user.created_at=="string"?ms(o.user.created_at):new Date(o.user.created_at);return Math.floor((new Date-P)/(1e3*60*60*24))<=7}catch{return!1}}),k=$(()=>!!o.user.is_hidden),S=$(()=>o.user.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"),x=$(()=>o.user.email||""),U=$(()=>o.user.avatar||null),L=()=>{e("select",o.user)},E=()=>{e("view-profile",o.user)},D=()=>{e("edit-permissions",o.user)},N=()=>{e("toggle-hidden",o.user)},B=()=>{a.value=!0;const P=h=>{t.value&&!t.value.contains(h.target)&&(a.value=!1,document.removeEventListener("click",P))};setTimeout(()=>{document.addEventListener("click",P)},0)},W=()=>{a.value=!1,e("view-analytics",o.user)},G=()=>{a.value=!1,e("export-data",o.user)},q=()=>{a.value=!1,e("send-notification",o.user)},oe=()=>{a.value=!1,e("view-audit",o.user)},Y=()=>{a.value=!1,confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${o.user.name}?`)&&e("delete-user",o.user)},H=()=>{console.warn(`Failed to load avatar for user ${o.user.id}`)},Z=P=>{switch(P){case"online":return"–æ–Ω–ª–∞–π–Ω";case"away":return"–æ—Ç–æ—à—ë–ª";case"offline":return"–æ—Ñ—Ñ–ª–∞–π–Ω";default:return"–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}},fe=P=>{if(P.key==="Enter"||P.key===" ")P.preventDefault(),L();else if(P.key==="ArrowDown"){P.preventDefault();const h=P.target.nextElementSibling;h&&h.focus()}else if(P.key==="ArrowUp"){P.preventDefault();const h=P.target.previousElementSibling;h&&h.focus()}};return $e(()=>{const P=document.querySelector(`[data-user-id="${o.user.id}"]`);P&&P.addEventListener("keydown",fe)}),at(()=>{const P=document.querySelector(`[data-user-id="${o.user.id}"]`);P&&P.removeEventListener("keydown",fe)}),{showContextMenuFlag:a,contextMenuRef:t,userInitials:l,avatarColor:r,visibleDepartments:n,hiddenDepartmentsCount:i,totalActionsFormatted:d,totalSessionsFormatted:g,avgSessionDurationFormatted:v,lastActivityFormatted:w,activityScore:f,actionsChange:p,userStatus:y,isAdmin:T,isNew:C,isHidden:k,userName:S,userEmail:x,userAvatar:U,handleSelect:L,viewProfile:E,editPermissions:D,toggleHidden:N,showContextMenu:B,viewDetailedAnalytics:W,exportUserData:G,sendNotification:q,viewAuditLog:oe,deleteUser:Y,handleAvatarError:H,getStatusText:Z}}},t2=["aria-label","aria-selected","aria-describedby"],a2={class:"user-avatar-section"},s2={class:"avatar-container"},o2=["src","alt"],n2=["title"],r2={key:2,class:"new-indicator",title:"–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"},l2={class:"user-info-section"},i2={class:"user-header"},c2={class:"user-name"},d2={class:"user-badges"},u2={key:0,class:"badge admin",title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"},g2={key:1,class:"badge hidden",title:"–°–∫—Ä—ã—Ç—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"},m2={class:"user-email"},h2={key:0,class:"user-departments"},f2=["title"],v2=["title"],p2={class:"user-metrics-section"},y2={class:"metric primary"},k2={class:"metric-value"},b2=["title"],_2={class:"metric secondary"},w2={class:"metric-value"},C2={key:0,class:"activity-score"},T2={class:"score-bar"},S2=["title"],D2={key:1,class:"mini-metrics"},E2={class:"mini-metric"},A2={class:"mini-metric"},$2={class:"user-actions-section"},I2=["aria-label","title"],M2=["aria-label","title"],N2=["aria-label","title"],x2=["aria-label"],L2=["aria-label"],P2=["aria-label"],O2=["aria-label"],B2=["aria-label"],R2=["aria-label"],W2=["aria-label"],U2=["id"],F2={key:1,class:"selection-indicator","aria-hidden":"true"};function H2(o,e,a,t,l,r){return c(),u("div",{class:X(["unified-user-card",{selected:a.isSelected,"activity-high":t.activityScore>=80,"activity-medium":t.activityScore>=50&&t.activityScore<80,"activity-low":t.activityScore<50,"status-online":t.userStatus==="online","status-away":t.userStatus==="away","status-offline":t.userStatus==="offline","has-departments":t.visibleDepartments.length>0,"is-admin":t.isAdmin,"is-new":t.isNew,"is-hidden":t.isHidden,"compact-view":a.compactView}]),onClick:e[10]||(e[10]=(...n)=>t.handleSelect&&t.handleSelect(...n)),onDblclick:e[11]||(e[11]=(...n)=>t.viewProfile&&t.viewProfile(...n)),onKeydown:[e[12]||(e[12]=Re((...n)=>t.handleSelect&&t.handleSelect(...n),["enter"])),e[13]||(e[13]=Re((...n)=>t.handleSelect&&t.handleSelect(...n),["space"]))],onContextmenu:e[14]||(e[14]=Ce((...n)=>t.showContextMenu&&t.showContextMenu(...n),["prevent"])),tabindex:"0",role:"button","aria-label":`–í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`,"aria-selected":a.isSelected,"aria-describedby":`user-card-${a.user.id}-description`},[s("div",a2,[s("div",s2,[t.userAvatar?(c(),u("img",{key:0,src:t.userAvatar,alt:`–ê–≤–∞—Ç–∞—Ä ${t.userName}`,class:"user-avatar",onError:e[0]||(e[0]=(...n)=>t.handleAvatarError&&t.handleAvatarError(...n))},null,40,o2)):(c(),u("div",{key:1,class:"avatar-placeholder",style:we({backgroundColor:t.avatarColor})},m(t.userInitials),5)),s("div",{class:X(["status-indicator",t.userStatus]),title:`–°—Ç–∞—Ç—É—Å: ${t.getStatusText(t.userStatus)}`},null,10,n2),t.isNew?(c(),u("div",r2," NEW ")):A("",!0)])]),s("div",l2,[s("div",i2,[s("h4",c2,m(t.userName),1),s("div",d2,[t.isAdmin?(c(),u("span",u2," –ê–¥–º–∏–Ω ")):A("",!0),t.isHidden?(c(),u("span",g2," –°–∫—Ä—ã—Ç ")):A("",!0)])]),s("p",m2,m(t.userEmail),1),t.visibleDepartments.length>0?(c(),u("div",h2,[(c(!0),u(ee,null,te(t.visibleDepartments,n=>(c(),u("span",{key:n.id,class:"dept-tag",style:we({backgroundColor:n.color}),title:n.name},m(n.shortName||n.name),13,f2))),128)),t.hiddenDepartmentsCount>0?(c(),u("span",{key:0,class:"dept-more",title:`–ï—â—ë ${t.hiddenDepartmentsCount} –æ—Ç–¥–µ–ª–æ–≤`}," +"+m(t.hiddenDepartmentsCount),9,v2)):A("",!0)])):A("",!0)]),s("div",p2,[s("div",y2,[s("div",k2,m(t.totalActionsFormatted),1),e[15]||(e[15]=s("div",{class:"metric-label"},"–¥–µ–π—Å—Ç–≤–∏–π",-1)),t.actionsChange!==0?(c(),u("div",{key:0,class:X(["metric-change",{positive:t.actionsChange>0,negative:t.actionsChange<0}]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ: ${t.actionsChange>0?"+":""}${t.actionsChange}%`},m(t.actionsChange>0?"+":"")+m(t.actionsChange)+"% ",11,b2)):A("",!0)]),s("div",_2,[s("div",w2,m(t.lastActivityFormatted),1),e[16]||(e[16]=s("div",{class:"metric-label"},"–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1))]),a.compactView?A("",!0):(c(),u("div",C2,[s("div",T2,[s("div",{class:X(["score-fill",{"high-score":t.activityScore>=80,"medium-score":t.activityScore>=50&&t.activityScore<80,"low-score":t.activityScore<50}]),style:we({width:`${t.activityScore}%`})},null,6)]),s("div",{class:"score-label",title:`–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: ${t.activityScore}/100`},m(t.activityScore)+"/100 ",9,S2)])),a.compactView?(c(),u("div",D2,[s("span",E2,m(t.totalSessionsFormatted)+" —Å–µ—Å—Å–∏–π",1),s("span",A2,m(t.avgSessionDurationFormatted),1)])):A("",!0)]),s("div",$2,[s("button",{onClick:e[1]||(e[1]=Ce((...n)=>t.viewProfile&&t.viewProfile(...n),["stop"])),class:"action-btn primary","aria-label":`–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ${t.userName}`,title:`–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ${t.userName}`}," üëÅÔ∏è ",8,I2),a.canEditPermissions?(c(),u("button",{key:0,onClick:e[2]||(e[2]=Ce((...n)=>t.editPermissions&&t.editPermissions(...n),["stop"])),class:"action-btn secondary","aria-label":`–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ${t.userName}`,title:`–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ${t.userName}`}," ‚öôÔ∏è ",8,M2)):A("",!0),s("button",{onClick:e[3]||(e[3]=Ce((...n)=>t.toggleHidden&&t.toggleHidden(...n),["stop"])),class:X(["action-btn tertiary",{active:t.isHidden}]),"aria-label":`${t.isHidden?"–ü–æ–∫–∞–∑–∞—Ç—å":"–°–∫—Ä—ã—Ç—å"} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`,title:`${t.isHidden?"–ü–æ–∫–∞–∑–∞—Ç—å":"–°–∫—Ä—ã—Ç—å"} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`},m(t.isHidden?"üëÅÔ∏è‚Äçüó®Ô∏è":"üôà"),11,N2),s("button",{onClick:e[4]||(e[4]=Ce((...n)=>t.showContextMenu&&t.showContextMenu(...n),["stop"])),class:"action-btn menu","aria-label":`–ú–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è ${t.userName}`,title:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è"}," ‚ãÆ ",8,x2)]),t.showContextMenuFlag?(c(),u("div",{key:0,class:"context-menu",ref:"contextMenu",role:"menu","aria-label":`–ú–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è ${t.userName}`},[s("button",{onClick:e[5]||(e[5]=(...n)=>t.viewDetailedAnalytics&&t.viewDetailedAnalytics(...n)),class:"menu-item",role:"menuitem","aria-label":`–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è ${t.userName}`}," üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ ",8,P2),s("button",{onClick:e[6]||(e[6]=(...n)=>t.exportUserData&&t.exportUserData(...n)),class:"menu-item",role:"menuitem","aria-label":`–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö ${t.userName}`}," üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö ",8,O2),s("button",{onClick:e[7]||(e[7]=(...n)=>t.sendNotification&&t.sendNotification(...n)),class:"menu-item",role:"menuitem","aria-label":`–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ${t.userName}`}," üìß –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ",8,B2),s("button",{onClick:e[8]||(e[8]=(...n)=>t.viewAuditLog&&t.viewAuditLog(...n)),class:"menu-item",role:"menuitem","aria-label":`–ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ –¥–ª—è ${t.userName}`}," üìã –ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ ",8,R2),e[17]||(e[17]=s("hr",{class:"menu-divider",role:"separator"},null,-1)),a.canDelete?(c(),u("button",{key:0,onClick:e[9]||(e[9]=(...n)=>t.deleteUser&&t.deleteUser(...n)),class:"menu-item danger",role:"menuitem","aria-label":`–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`}," üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ",8,W2)):A("",!0)],8,L2)):A("",!0),s("div",{id:`user-card-${a.user.id}-description`,class:"sr-only"}," –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "+m(t.userName)+", email "+m(t.userEmail)+", —Å—Ç–∞—Ç—É—Å "+m(t.getStatusText(t.userStatus))+", "+m(t.totalActionsFormatted)+" –¥–µ–π—Å—Ç–≤–∏–π, –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å "+m(t.lastActivityFormatted)+", —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ "+m(t.activityScore)+" –∏–∑ 100. "+m(t.isAdmin?"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.":"")+" "+m(t.isHidden?"–°–∫—Ä—ã—Ç—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.":"")+" "+m(t.visibleDepartments.length>0?`–û—Ç–¥–µ–ª—ã: ${t.visibleDepartments.map(n=>n.name).join(", ")}.`:""),9,U2),a.isSelected?(c(),u("div",F2,[...e[18]||(e[18]=[s("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},[s("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})],-1)])])):A("",!0)],42,t2)}const j2=ce(e2,[["render",H2],["__scopeId","data-v-5e790fbc"]]),V2={name:"BulkActionsBar",emits:["execute","clear-selection"],props:{selectedUsers:{type:Array,default:()=>[]},availableActions:{type:Array,default:()=>[]}}},z2={key:0,class:"bulk-actions-bar"},G2={class:"bar-content"},K2={class:"selection-info"},q2={class:"selection-count"},Y2={class:"selection-text"},X2={class:"actions-list"},J2=["onClick","title"],Z2={key:0,class:"action-icon"},Q2={class:"action-text"};function eE(o,e,a,t,l,r){return a.selectedUsers.length>0?(c(),u("div",z2,[s("div",G2,[s("div",K2,[s("span",q2," –í—ã–±—Ä–∞–Ω–æ: "+m(a.selectedUsers.length),1),s("span",Y2,m(a.selectedUsers.length===1?"–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å":"–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),1)]),s("div",X2,[(c(!0),u(ee,null,te(a.availableActions,n=>(c(),u("button",{key:n.id,onClick:i=>o.$emit("execute",n),class:X(["action-btn",n.class]),title:n.description},[n.icon?(c(),u("span",Z2,m(n.icon),1)):A("",!0),s("span",Q2,m(n.label),1)],10,J2))),128))]),s("button",{onClick:e[0]||(e[0]=n=>o.$emit("clear-selection")),class:"clear-btn",title:"–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä"}," ‚úï ")])])):A("",!0)}const tE=ce(V2,[["render",eE],["__scopeId","data-v-56b78081"]]),aE={name:"VirtualList",emits:["item-click"],props:{items:{type:Array,default:()=>[]},itemHeight:{type:Number,default:50},containerHeight:{type:Number,default:400},bufferSize:{type:Number,default:5}},data(){return{scrollTop:0}},computed:{totalItems(){return this.items.length},totalHeight(){return this.totalItems*this.itemHeight},visibleCount(){return Math.ceil(this.containerHeight/this.itemHeight)+this.bufferSize*2},startIndex(){const o=Math.floor(this.scrollTop/this.itemHeight)-this.bufferSize;return Math.max(0,o)},endIndex(){const o=this.startIndex+this.visibleCount;return Math.min(this.totalItems,o)},visibleItems(){return this.items.slice(this.startIndex,this.endIndex)},offsetTop(){return this.startIndex*this.itemHeight},offsetBottom(){return Math.max(0,this.totalHeight-this.offsetTop-this.visibleItems.length*this.itemHeight)},listHeight(){return Math.min(this.totalHeight,this.containerHeight)}},methods:{handleScroll(o){this.scrollTop=o.target.scrollTop},getItemKey(o,e){return o.id||o.key||e},scrollToIndex(o){const e=Math.max(0,o*this.itemHeight-this.containerHeight/2);this.$refs.container?.scrollTo({top:e,behavior:"smooth"})},scrollToTop(){this.$refs.container?.scrollTo({top:0,behavior:"smooth"})},scrollToBottom(){const o=this.totalHeight-this.containerHeight;this.$refs.container?.scrollTo({top:o,behavior:"smooth"})}}},sE={class:"virtual-list-container",ref:"container"};function oE(o,e,a,t,l,r){return c(),u("div",sE,[s("div",{class:"virtual-list",style:we({height:`${r.listHeight}px`}),onScroll:e[0]||(e[0]=(...n)=>r.handleScroll&&r.handleScroll(...n))},[s("div",{class:"virtual-spacer top",style:we({height:`${r.offsetTop}px`})},null,4),(c(!0),u(ee,null,te(r.visibleItems,(n,i)=>(c(),u("div",{key:r.getItemKey(n,r.startIndex+i),class:"virtual-item"},[hs(o.$slots,"item",{item:n,index:r.startIndex+i},void 0)]))),128)),s("div",{class:"virtual-spacer bottom",style:we({height:`${r.offsetBottom}px`})},null,4)],36)],512)}const nE=ce(aE,[["render",oE],["__scopeId","data-v-302c06ef"]]),rE={name:"PaginationControls",emits:["page-change","per-page-change"],props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},totalItems:{type:Number,required:!0},perPage:{type:Number,default:50},showPerPageSelector:{type:Boolean,default:!0},perPageOptions:{type:Array,default:()=>[10,25,50,100]},maxVisiblePages:{type:Number,default:7}},computed:{startItem(){return(this.currentPage-1)*this.perPage+1},endItem(){return Math.min(this.currentPage*this.perPage,this.totalItems)},visiblePages(){const o=[],e=this.totalPages,a=this.currentPage,t=this.maxVisiblePages;if(e<=t)for(let l=1;l<=e;l++)o.push(l);else{const l=Math.max(1,a-Math.floor(t/2)),r=Math.min(e,l+t-1),n=Math.max(1,r-t+1);n>1&&(o.push(1),n>2&&o.push("..."));for(let i=n;i<=r;i++)o.push(i);r<e&&(r<e-1&&o.push("..."),o.push(e))}return o}}},lE={key:0,class:"pagination-controls"},iE={class:"pagination-info"},cE={class:"pagination-text"},dE={class:"pagination-nav"},uE=["disabled"],gE=["disabled"],mE={key:0,class:"page-btn ellipsis",disabled:"","aria-hidden":"true"},hE=["onClick","aria-label","aria-current"],fE=["disabled"],vE=["disabled"],pE={key:0,class:"per-page-selector"},yE=["value"],kE=["value"];function bE(o,e,a,t,l,r){return a.totalPages>1?(c(),u("div",lE,[s("div",iE,[s("span",cE,m(r.startItem)+"-"+m(r.endItem)+" –∏–∑ "+m(a.totalItems.toLocaleString()),1)]),s("div",dE,[s("button",{onClick:e[0]||(e[0]=n=>o.$emit("page-change",1)),disabled:a.currentPage===1,class:"page-btn first","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ¬´¬´ ",8,uE),s("button",{onClick:e[1]||(e[1]=n=>o.$emit("page-change",a.currentPage-1)),disabled:a.currentPage===1,class:"page-btn prev","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ‚Äπ ",8,gE),(c(!0),u(ee,null,te(r.visiblePages,n=>(c(),u(ee,{key:n},[n==="..."?(c(),u("button",mE,m(n),1)):(c(),u("button",{key:1,onClick:i=>o.$emit("page-change",n),class:X({"page-btn":!0,current:n===a.currentPage}),"aria-label":`–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ${n}`,"aria-current":n===a.currentPage?"page":null},m(n),11,hE))],64))),128)),s("button",{onClick:e[2]||(e[2]=n=>o.$emit("page-change",a.currentPage+1)),disabled:a.currentPage===a.totalPages,class:"page-btn next","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ‚Ä∫ ",8,fE),s("button",{onClick:e[3]||(e[3]=n=>o.$emit("page-change",a.totalPages)),disabled:a.currentPage===a.totalPages,class:"page-btn last","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ¬ª¬ª ",8,vE)]),a.showPerPageSelector?(c(),u("div",pE,[e[5]||(e[5]=s("label",{for:"per-page-select",class:"per-page-label"},"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å:",-1)),s("select",{id:"per-page-select",value:a.perPage,onChange:e[4]||(e[4]=n=>o.$emit("per-page-change",parseInt(n.target.value))),class:"per-page-select","aria-label":"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ"},[(c(!0),u(ee,null,te(a.perPageOptions,n=>(c(),u("option",{key:n,value:n},m(n),9,kE))),128))],40,yE)])):A("",!0)])):A("",!0)}const _E=ce(rE,[["render",bE],["__scopeId","data-v-59d0e153"]]),wE={name:"UserListPanel",components:{UnifiedUserCard:j2,BulkActionsBar:tE,VirtualList:nE,PaginationControls:_E},props:{users:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},pagination:{type:Object,default:()=>({current_page:1,per_page:50,total:0,total_pages:0})},filters:{type:Object,default:()=>({search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc",time_range:"week"})},viewOptions:{type:Object,default:()=>({compactView:!1,showExtendedMetrics:!1,itemsPerPage:50})},canEditPermissions:{type:Boolean,default:!1},canDeleteUsers:{type:Boolean,default:!1}},emits:["user-select","user-select-multiple","filters-change","pagination-change","view-options-change","user-action"],setup(o,{emit:e}){const a=I(!1),t=I([]),l=I({...o.filters}),r=I(null),n=I(null),i=$(()=>o.users),d=$(()=>{let P=0;return l.value.search&&P++,l.value.department_ids.length>0&&P++,l.value.activity_filter!=="all"&&P++,l.value.time_range!=="week"&&P++,P}),g=$(()=>{if(!n.value)return 400;const P=n.value.getBoundingClientRect();return Math.max(400,window.innerHeight-P.top-200)}),v=$(()=>[{id:369,name:"–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª",color:"#2196F3"},{id:366,name:"–°–µ–∫—Ç–æ—Ä 1–°",color:"#4CAF50"},{id:370,name:"–û—Ç–¥–µ–ª –∞–Ω–∞–ª–∏—Ç–∏–∫–∏",color:"#FF9800"},{id:371,name:"–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",color:"#F44336"}]),w=$(()=>[{id:"change_department",label:"–ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–¥–µ–ª",icon:"BuildingIcon",description:"–ù–∞–∑–Ω–∞—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –¥—Ä—É–≥–æ–π –æ—Ç–¥–µ–ª"},{id:"toggle_admin",label:"–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",icon:"ShieldIcon",description:"–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ –æ—Ç–æ–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"},{id:"export",label:"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",icon:"DownloadIcon",description:"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},{id:"hide_users",label:"–°–∫—Ä—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",icon:"EyeOffIcon",description:"–°–∫—Ä—ã—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Å–ø–∏—Å–∫–∞"}]),f=()=>{a.value=!a.value},p=()=>{e("filters-change",{...l.value})},y=()=>{l.value={search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc",time_range:"week"},p()},T=P=>{const h=l.value.department_ids.indexOf(P);h>-1?l.value.department_ids.splice(h,1):l.value.department_ids.push(P),p()},C=()=>{l.value.sort_order=l.value.sort_order==="asc"?"desc":"asc",p()},k=()=>{const P={...o.viewOptions,compactView:!o.viewOptions.compactView};e("view-options-change",P)},S=()=>{r.value&&clearTimeout(r.value),r.value=setTimeout(x,300)},x=()=>{p()},U=()=>{l.value.search="",p()},L=P=>{E(P)},E=P=>{e("user-select",P)},D=P=>{t.value=P,e("user-select-multiple",P)},N=()=>{t.value=[]},B=P=>{e("user-action","view-profile",P)},W=P=>{e("user-action","edit-permissions",P)},G=P=>{e("user-action","toggle-visibility",P)},q=P=>{e("user-action","view-analytics",P)},oe=P=>{e("user-action","export-data",P)},Y=P=>{e("user-action","delete",P)},H=P=>{e("user-action","bulk-action",{action:P,users:t.value})},Z=P=>{e("pagination-change",P)},fe=P=>{e("pagination-change",1,P)};return Ne(()=>o.filters,P=>{l.value={...P}},{deep:!0}),$e(()=>{Wt(()=>{n.value&&(n.value.style.height=`${g.value}px`)})}),{showFilters:a,selectedUsers:t,localFilters:l,filteredUsers:i,activeFiltersCount:d,listHeight:g,departments:v,bulkActions:w,listContainer:n,toggleFilters:f,applyFilters:p,resetFilters:y,toggleDepartmentFilter:T,toggleSortOrder:C,toggleCompactView:k,debounceSearch:S,applySearch:x,clearSearch:U,handleUserClick:L,handleUserSelect:E,handleUserSelectMultiple:D,clearSelection:N,handleViewProfile:B,handleEditPermissions:W,handleToggleHidden:G,handleViewAnalytics:q,handleExportUserData:oe,handleDeleteUser:Y,handleBulkAction:H,handlePageChange:Z,handlePerPageChange:fe}}},CE={class:"panel-header"},TE={class:"header-content"},SE={class:"panel-title"},DE={key:0,class:"users-count"},EE={class:"header-actions"},AE={class:"search-container"},$E=["aria-expanded"],IE={key:0,class:"filters-count"},ME={class:"view-options"},NE={key:0,class:"filters-panel",role:"region","aria-label":"–ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤"},xE={class:"filters-grid"},LE={class:"filter-group"},PE={class:"departments-filter"},OE=["onClick","aria-label"],BE={class:"filter-group"},RE={class:"filter-group"},WE={class:"filter-group"},UE={class:"sort-controls"},FE=["aria-label"],HE={class:"filter-actions"},jE={class:"users-list-container",role:"list","aria-label":"–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},VE={key:0,class:"loading-state"},zE={key:1,class:"empty-state"},GE={class:"empty-title"},KE={class:"empty-description"};function qE(o,e,a,t,l,r){const n=be("BulkActionsBar"),i=be("UnifiedUserCard"),d=be("VirtualList"),g=be("PaginationControls");return c(),u("div",{class:X(["user-list-panel",{loading:a.loading,empty:!a.loading&&t.filteredUsers.length===0,"compact-view":a.viewOptions.compactView}]),role:"region","aria-label":"–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},[s("div",CE,[s("div",TE,[s("h2",SE,[e[16]||(e[16]=ge(" –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ",-1)),a.loading?A("",!0):(c(),u("span",DE," ("+m(a.pagination.total.toLocaleString())+") ",1))]),s("div",EE,[s("div",AE,[Be(s("input",{"onUpdate:modelValue":e[0]||(e[0]=v=>t.localFilters.search=v),type:"text",class:"search-input",placeholder:"–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ email...",onInput:e[1]||(e[1]=(...v)=>t.debounceSearch&&t.debounceSearch(...v)),onKeydown:e[2]||(e[2]=Re((...v)=>t.applySearch&&t.applySearch(...v),["enter"])),"aria-label":"–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},null,544),[[At,t.localFilters.search]]),t.localFilters.search?(c(),u("button",{key:0,onClick:e[3]||(e[3]=(...v)=>t.clearSearch&&t.clearSearch(...v)),class:"search-clear","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):A("",!0),e[17]||(e[17]=s("div",{class:"search-icon","aria-hidden":"true"},"üîç",-1))]),s("button",{onClick:e[4]||(e[4]=(...v)=>t.toggleFilters&&t.toggleFilters(...v)),class:X(["filters-toggle",{active:t.showFilters}]),"aria-label":"–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã","aria-expanded":t.showFilters},[e[18]||(e[18]=s("svg",{class:"filter-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[s("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})],-1)),e[19]||(e[19]=ge(" –§–∏–ª—å—Ç—Ä—ã ",-1)),t.activeFiltersCount>0?(c(),u("span",IE,m(t.activeFiltersCount),1)):A("",!0)],10,$E),s("div",ME,[s("button",{onClick:e[5]||(e[5]=(...v)=>t.toggleCompactView&&t.toggleCompactView(...v)),class:X(["view-toggle",{active:a.viewOptions.compactView}]),"aria-label":"–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥",title:"–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥"},[...e[20]||(e[20]=[s("svg",{viewBox:"0 0 24 24","aria-hidden":"true"},[s("path",{d:"M3 3h18v2H3V3zm0 16h18v2H3v16zm0-8h18v2H3v-2z"})],-1)])],2)])])])]),t.showFilters?(c(),u("div",NE,[s("div",xE,[s("div",LE,[e[21]||(e[21]=s("label",{class:"filter-label"},"–û—Ç–¥–µ–ª—ã:",-1)),s("div",PE,[(c(!0),u(ee,null,te(t.departments,v=>(c(),u("button",{key:v.id,onClick:w=>t.toggleDepartmentFilter(v.id),class:X(["department-chip",{active:t.localFilters.department_ids.includes(v.id)}]),style:we({borderColor:v.color}),"aria-label":`–§–∏–ª—å—Ç—Ä –ø–æ –æ—Ç–¥–µ–ª—É ${v.name}`},[s("span",{class:"dept-dot",style:we({backgroundColor:v.color}),"aria-hidden":"true"},null,4),ge(" "+m(v.name),1)],14,OE))),128))])]),s("div",BE,[e[23]||(e[23]=s("label",{class:"filter-label"},"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),Be(s("select",{"onUpdate:modelValue":e[6]||(e[6]=v=>t.localFilters.activity_filter=v),class:"filter-select",onChange:e[7]||(e[7]=(...v)=>t.applyFilters&&t.applyFilters(...v)),"aria-label":"–§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"},[...e[22]||(e[22]=[_t('<option value="all" data-v-8c6ab554>–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option><option value="active" data-v-8c6ab554>–ê–∫—Ç–∏–≤–Ω—ã–µ (80%+)</option><option value="moderate" data-v-8c6ab554>–°—Ä–µ–¥–Ω–µ –∞–∫—Ç–∏–≤–Ω—ã–µ (50-80%)</option><option value="inactive" data-v-8c6ab554>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ (&lt;50%)</option><option value="new" data-v-8c6ab554>–ù–æ–≤—ã–µ (–∑–∞ –Ω–µ–¥–µ–ª—é)</option>',5)])],544),[[dt,t.localFilters.activity_filter]])]),s("div",RE,[e[25]||(e[25]=s("label",{class:"filter-label"},"–ü–µ—Ä–∏–æ–¥:",-1)),Be(s("select",{"onUpdate:modelValue":e[8]||(e[8]=v=>t.localFilters.time_range=v),class:"filter-select",onChange:e[9]||(e[9]=(...v)=>t.applyFilters&&t.applyFilters(...v)),"aria-label":"–í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏"},[...e[24]||(e[24]=[_t('<option value="today" data-v-8c6ab554>–°–µ–≥–æ–¥–Ω—è</option><option value="week" data-v-8c6ab554>–≠—Ç–∞ –Ω–µ–¥–µ–ª—è</option><option value="month" data-v-8c6ab554>–≠—Ç–æ—Ç –º–µ—Å—è—Ü</option><option value="quarter" data-v-8c6ab554>–≠—Ç–æ—Ç –∫–≤–∞—Ä—Ç–∞–ª</option><option value="year" data-v-8c6ab554>–≠—Ç–æ—Ç –≥–æ–¥</option>',5)])],544),[[dt,t.localFilters.time_range]])]),s("div",WE,[e[28]||(e[28]=s("label",{class:"filter-label"},"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:",-1)),s("div",UE,[Be(s("select",{"onUpdate:modelValue":e[10]||(e[10]=v=>t.localFilters.sort_by=v),class:"filter-select sort-select",onChange:e[11]||(e[11]=(...v)=>t.applyFilters&&t.applyFilters(...v)),"aria-label":"–ü–æ–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏"},[...e[26]||(e[26]=[s("option",{value:"last_activity"},"–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1),s("option",{value:"name"},"–ò–º—è",-1),s("option",{value:"email"},"Email",-1),s("option",{value:"total_actions"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π",-1)])],544),[[dt,t.localFilters.sort_by]]),s("button",{onClick:e[12]||(e[12]=(...v)=>t.toggleSortOrder&&t.toggleSortOrder(...v)),class:"sort-order-toggle","aria-label":`–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞ ${t.localFilters.sort_order==="asc"?"—É–±—ã–≤–∞—é—â–∏–π":"–≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–∏–π"}`},[(c(),u("svg",{class:X({rotated:t.localFilters.sort_order==="desc"}),viewBox:"0 0 24 24","aria-hidden":"true"},[...e[27]||(e[27]=[s("path",{d:"M7 14l5-5 5 5z"},null,-1)])],2))],8,FE)])])]),s("div",HE,[s("button",{onClick:e[13]||(e[13]=(...v)=>t.resetFilters&&t.resetFilters(...v)),class:"filter-reset-btn"}," –°–±—Ä–æ—Å–∏—Ç—å "),s("button",{onClick:e[14]||(e[14]=(...v)=>t.applyFilters&&t.applyFilters(...v)),class:"filter-apply-btn"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å ")])])):A("",!0),t.selectedUsers.length>0?(c(),he(n,{key:1,"selected-users":t.selectedUsers,"available-actions":t.bulkActions,onExecute:t.handleBulkAction,onClearSelection:t.clearSelection},null,8,["selected-users","available-actions","onExecute","onClearSelection"])):A("",!0),s("div",jE,[a.loading?(c(),u("div",VE,[(c(!0),u(ee,null,te(a.viewOptions.itemsPerPage,v=>(c(),u("div",{key:v,class:"user-skeleton","aria-hidden":"true"},[...e[29]||(e[29]=[_t('<div class="skeleton-avatar" data-v-8c6ab554></div><div class="skeleton-content" data-v-8c6ab554><div class="skeleton-line" data-v-8c6ab554></div><div class="skeleton-line short" data-v-8c6ab554></div></div><div class="skeleton-actions" data-v-8c6ab554><div class="skeleton-button" data-v-8c6ab554></div><div class="skeleton-button" data-v-8c6ab554></div></div>',3)])]))),128))])):t.filteredUsers.length===0?(c(),u("div",zE,[e[30]||(e[30]=s("div",{class:"empty-icon","aria-hidden":"true"},"üë•",-1)),s("h3",GE,m(t.localFilters.search?"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã":"–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),1),s("p",KE,m(t.localFilters.search?`–ü–æ –∑–∞–ø—Ä–æ—Å—É "${t.localFilters.search}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫ –∏–ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.`:"–í —Å–∏—Å—Ç–µ–º–µ –µ—â—ë –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π."),1),t.activeFiltersCount>0?(c(),u("button",{key:0,onClick:e[15]||(e[15]=(...v)=>t.resetFilters&&t.resetFilters(...v)),class:"empty-action-btn"}," –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã ")):A("",!0)])):(c(),he(d,{key:2,items:t.filteredUsers,"item-height":a.viewOptions.compactView?80:120,"container-height":t.listHeight,class:"virtual-users-list",onItemClick:t.handleUserClick},{item:ye(({item:v,index:w})=>[(c(),he(i,{key:v.id,user:v,"is-selected":t.selectedUsers.some(f=>f.id===v.id),"compact-view":a.viewOptions.compactView,"can-edit-permissions":a.canEditPermissions,"can-delete":a.canDeleteUsers,"show-extended-metrics":!a.viewOptions.compactView,onSelect:t.handleUserSelect,onViewProfile:t.handleViewProfile,onEditPermissions:t.handleEditPermissions,onToggleHidden:t.handleToggleHidden,onViewAnalytics:t.handleViewAnalytics,onExportData:t.handleExportUserData,onDeleteUser:t.handleDeleteUser},null,8,["user","is-selected","compact-view","can-edit-permissions","can-delete","show-extended-metrics","onSelect","onViewProfile","onEditPermissions","onToggleHidden","onViewAnalytics","onExportData","onDeleteUser"]))]),_:1},8,["items","item-height","container-height","onItemClick"]))]),!a.loading&&a.pagination.total_pages>1?(c(),he(g,{key:2,"current-page":a.pagination.current_page,"total-pages":a.pagination.total_pages,"total-items":a.pagination.total,"per-page":a.pagination.per_page,onPageChange:t.handlePageChange,onPerPageChange:t.handlePerPageChange},null,8,["current-page","total-pages","total-items","per-page","onPageChange","onPerPageChange"])):A("",!0)],2)}const YE=ce(wE,[["render",qE],["__scopeId","data-v-8c6ab554"]]),XE={name:"AnalysisPanel",emits:["back","filter-change","export"],props:{user:{type:Object,default:null},activityData:{type:Object,default:()=>({})},filters:{type:Object,default:()=>({})},timeRange:{type:String,default:"week"},isLoading:{type:Boolean,default:!1}},methods:{getStatusText(o){switch(o){case"online":return"–æ–Ω–ª–∞–π–Ω";case"away":return"–æ—Ç–æ—à—ë–ª";case"offline":return"–æ—Ñ—Ñ–ª–∞–π–Ω";default:return"–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}},formatDuration(o){const e=Math.floor(o/60),a=Math.floor(o%60);return`${e}:${a.toString().padStart(2,"0")}`},formatLastActivity(o){if(!o)return"–ù–∏–∫–æ–≥–¥–∞";const e=new Date(o),t=new Date-e,l=Math.floor(t/(1e3*60)),r=Math.floor(t/(1e3*60*60)),n=Math.floor(t/(1e3*60*60*24));return l<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":l<60?`${l} –º–∏–Ω –Ω–∞–∑–∞–¥`:r<24?`${r} —á –Ω–∞–∑–∞–¥`:n<7?`${n} –¥ –Ω–∞–∑–∞–¥`:e.toLocaleDateString("ru-RU")}}},JE={class:"analysis-panel"},ZE={class:"analysis-header"},QE={class:"user-summary"},eA={class:"user-avatar"},tA=["src","alt"],aA={key:1,class:"avatar-placeholder"},sA={class:"user-info"},oA={class:"user-email"},nA={class:"user-status"},rA={key:0,class:"admin-badge"},lA={class:"header-actions"},iA={class:"analysis-content"},cA={class:"stats-section"},dA={class:"stats-grid"},uA={class:"stat-card"},gA={class:"stat-value"},mA={class:"stat-card"},hA={class:"stat-value"},fA={class:"stat-card"},vA={class:"stat-value"},pA={class:"stat-card"},yA={class:"stat-value"},kA={class:"activity-section"},bA={class:"last-activity"},_A={key:0,class:"departments-section"},wA={class:"departments-list"};function CA(o,e,a,t,l,r){return c(),u("div",JE,[s("div",ZE,[s("div",QE,[s("div",eA,[a.user.avatar?(c(),u("img",{key:0,src:a.user.avatar,alt:`–ê–≤–∞—Ç–∞—Ä ${a.user.name}`},null,8,tA)):(c(),u("div",aA,m(a.user.name.charAt(0)),1))]),s("div",sA,[s("h2",null,m(a.user.name),1),s("p",oA,m(a.user.email),1),s("div",nA,[s("span",{class:X(`status-${a.user.status}`)},m(r.getStatusText(a.user.status)),3),a.user.is_admin?(c(),u("span",rA,"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä")):A("",!0)])])]),s("div",lA,[s("button",{onClick:e[0]||(e[0]=n=>o.$emit("back")),class:"back-btn"},"‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É")])]),s("div",iA,[s("div",cA,[e[5]||(e[5]=s("h3",null,"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),s("div",dA,[s("div",uA,[s("div",gA,m(a.user.activity_stats?.total_actions||0),1),e[1]||(e[1]=s("div",{class:"stat-label"},"–í—Å–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–π",-1))]),s("div",mA,[s("div",hA,m(a.user.activity_stats?.total_sessions||0),1),e[2]||(e[2]=s("div",{class:"stat-label"},"–°–µ—Å—Å–∏–π",-1))]),s("div",fA,[s("div",vA,m(r.formatDuration(a.user.activity_stats?.avg_session_duration||0)),1),e[3]||(e[3]=s("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω—è—è —Å–µ—Å—Å–∏—è",-1))]),s("div",pA,[s("div",yA,m(a.user.activity_stats?.activity_score||0)+"/100",1),e[4]||(e[4]=s("div",{class:"stat-label"},"–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1))])])]),s("div",kA,[e[6]||(e[6]=s("h3",null,"üïí –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1)),s("div",bA,[s("p",null,m(r.formatLastActivity(a.user.activity_stats?.last_activity)),1)])]),a.user.departments&&a.user.departments.length>0?(c(),u("div",_A,[e[7]||(e[7]=s("h3",null,"üè¢ –û—Ç–¥–µ–ª—ã",-1)),s("div",wA,[(c(!0),u(ee,null,te(a.user.departments,n=>(c(),u("span",{key:n.id,class:"department-tag",style:we({backgroundColor:n.color})},m(n.name),5))),128))])])):A("",!0),e[8]||(e[8]=s("div",{class:"placeholder-note"},[s("strong",null,"üöß –°–ª–µ–¥—É—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:"),s("ul",null,[s("li",null,"–ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏"),s("li",null,"–ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"),s("li",null,"–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"),s("li",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏")])],-1))])])}const TA=ce(XE,[["render",CA],["__scopeId","data-v-15fd9d64"]]),SA={name:"ManagementPanel",emits:["back","permissions-change","bulk-update"],props:{selectedUsers:{type:Array,default:()=>[]},allUsers:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]},auditLog:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},canEditPermissions:{type:Boolean,default:!1}},methods:{handleBulkPermissions(){this.$emit("bulk-update","change_permissions",{is_admin:!1,department_id:369})}}},DA={class:"management-panel"},EA={class:"panel-placeholder"},AA={key:0,class:"selected-info"},$A={class:"selected-list"},IA={class:"user-name"},MA={class:"user-email"},NA={class:"placeholder-actions"};function xA(o,e,a,t,l,r){return c(),u("div",DA,[s("div",EA,[e[2]||(e[2]=s("div",{class:"placeholder-icon"},"‚öôÔ∏è",-1)),e[3]||(e[3]=s("h3",null,"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏",-1)),e[4]||(e[4]=s("p",null,"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä–æ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),e[5]||(e[5]=s("div",{class:"placeholder-note"},[s("strong",null,"–°—Ç–∞—Ç—É—Å:"),ge(" –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (TASK-089 - –≠—Ç–∞–ø 5) ")],-1)),a.selectedUsers.length>0?(c(),u("div",AA,[s("h4",null,"–í—ã–±—Ä–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: "+m(a.selectedUsers.length),1),s("div",$A,[(c(!0),u(ee,null,te(a.selectedUsers.slice(0,3),n=>(c(),u("div",{key:n.id,class:"selected-user"},[s("span",IA,m(n.name),1),s("span",MA,m(n.email),1)]))),128))])])):A("",!0),s("div",NA,[s("button",{onClick:e[0]||(e[0]=n=>o.$emit("back")),class:"back-btn"},"‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É"),a.selectedUsers.length>0?(c(),u("button",{key:0,onClick:e[1]||(e[1]=(...n)=>r.handleBulkPermissions&&r.handleBulkPermissions(...n)),class:"permissions-btn"}," –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ("+m(a.selectedUsers.length)+") ",1)):A("",!0)])])])}const LA=ce(SA,[["render",xA],["__scopeId","data-v-7dfddba5"]]),PA={name:"UnifiedUserManagement",components:{DrillDownNavigation:pS,ContextSidebar:ZD,UserListPanel:YE,AnalysisPanel:TA,ManagementPanel:LA},props:{config:{type:Object,default:()=>({enablePersistence:!0,enableKeyboardShortcuts:!0,defaultView:"global"})}},setup(o){console.log("[UnifiedUserManagement] Component loaded successfully",o.config);const e=I("global"),a=I(null),t=I(!1),l=I([{id:1,name:"–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",email:"ivan@example.com",departments:[{id:369,name:"–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª",color:"#2196F3"}],is_admin:!0,activity_stats:{total_actions:156,last_activity:new Date().toISOString(),activity_score:85},status:"online"},{id:2,name:"–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤",email:"petr@example.com",departments:[{id:366,name:"–°–µ–∫—Ç–æ—Ä 1–°",color:"#4CAF50"}],is_admin:!1,activity_stats:{total_actions:89,last_activity:new Date(Date.now()-864e5).toISOString(),activity_score:67},status:"away"},{id:3,name:"–ê–Ω–Ω–∞ –°–∏–¥–æ—Ä–æ–≤–∞",email:"anna@example.com",departments:[],is_admin:!1,activity_stats:{total_actions:23,last_activity:new Date(Date.now()-6048e5).toISOString(),activity_score:35},status:"offline"}]),r=I({search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc"}),n=I([{id:"total_users",label:"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",value:l.value.length,change:5.2},{id:"active_users",label:"–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è",value:l.value.filter(y=>y.status==="online").length,change:12.1},{id:"new_users",label:"–ù–æ–≤—ã—Ö —Å–µ–≥–æ–¥–Ω—è",value:1,change:-2.3}]),i=$(()=>{const y=[{id:"global",label:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"UsersIcon",action:()=>d("global")}];return e.value==="user"&&a.value&&y.push({id:`user-${a.value.id}`,label:a.value.name,icon:"UserIcon",action:()=>g(a.value)}),e.value==="management"&&y.push({id:"management",label:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏",icon:"SettingsIcon",action:()=>d("management")}),y}),d=(y,T={})=>{e.value=y,T.user&&(a.value=T.user),console.log(`[UnifiedUserManagement] Switched to context: ${y}`,T)},g=y=>{a.value=y,d("user",{user:y})};return{currentContext:e,selectedUser:a,loading:t,users:l,filters:r,globalMetrics:n,breadcrumbs:i,handleUserSelect:y=>{g(y)},handleBreadcrumbNavigate:y=>{y.action&&y.action()},handleGoBack:()=>{(e.value==="user"||e.value==="management")&&(d("global"),a.value=null),console.log("[UnifiedUserManagement] Returned to global context")},handleMetricClick:y=>{console.log("Metric clicked:",y)}}}},OA={class:"unified-user-management"},BA={class:"management-grid"},RA={class:"main-content-area"};function WA(o,e,a,t,l,r){const n=be("DrillDownNavigation"),i=be("ContextSidebar"),d=be("UserListPanel"),g=be("AnalysisPanel"),v=be("ManagementPanel");return c(),u("div",OA,[ne(n,{breadcrumbs:t.breadcrumbs,"is-loading":t.loading,onNavigate:t.handleBreadcrumbNavigate,onBack:t.handleGoBack},null,8,["breadcrumbs","is-loading","onNavigate","onBack"]),s("div",BA,[ne(i,{context:t.currentContext,"global-metrics":t.globalMetrics,"selected-user":t.selectedUser,onMetricClick:t.handleMetricClick},null,8,["context","global-metrics","selected-user","onMetricClick"]),s("div",RA,[t.currentContext==="global"?(c(),he(d,{key:0,users:t.users,loading:t.loading,pagination:{current_page:1,total:t.users.length,total_pages:1},filters:t.filters,"can-edit-permissions":!0,"can-delete":!1,onUserSelect:t.handleUserSelect},null,8,["users","loading","pagination","filters","onUserSelect"])):t.currentContext==="user"?(c(),he(g,{key:1,user:t.selectedUser,onBack:t.handleGoBack},null,8,["user","onBack"])):t.currentContext==="management"?(c(),he(v,{key:2,onBack:t.handleGoBack},null,8,["onBack"])):A("",!0)])])])}const UA=ce(PA,[["render",WA],["__scopeId","data-v-953cd27b"]]),FA={name:"UsersManagementPage",components:{UnifiedUserManagement:UA},setup(){const o=Xe();return $e(async()=>{try{if(!(await rt.checkAccess()).allowed){o.push("/");return}if(!await rt.getCurrentUser()){o.push("/");return}console.log("[UsersManagementPage] Access granted - loading unified interface")}catch(e){console.error("[UsersManagementPage] Access check failed:",e),o.push("/")}}),{}}},HA={class:"users-management-page"};function jA(o,e,a,t,l,r){const n=be("UnifiedUserManagement");return c(),u("div",HA,[ne(n,{config:{enablePersistence:!0,enableKeyboardShortcuts:!0,defaultView:"global"}})])}const VA=ce(FA,[["render",jA],["__scopeId","data-v-3ef05244"]]);class Pe{static async getCacheStatus(){try{const e=et("/api/admin/cache-status.php");console.log("[CacheManagementService] Fetching cache status from:",e);const a=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("[CacheManagementService] Response status:",a.status),!a.ok){const l=await a.text();throw console.error("[CacheManagementService] HTTP error:",l),new Error(`HTTP error! status: ${a.status}, message: ${l}`)}const t=await a.json();if(console.log("[CacheManagementService] API result:",t),t.success){let l=t.modules||[];console.log("[CacheManagementService] Modules from API:",l.length,l),l.length===0&&(console.log("[CacheManagementService] Using mock data for UI demonstration"),l=this.getMockModules(),console.log("[CacheManagementService] Mock modules:",l.length));const r=this.categorizeAndSortModules(l);return console.log("[CacheManagementService] Categorized result:",r),r}else throw new Error(t.error||"Failed to get cache status")}catch(e){console.error("[CacheManagementService] Error getting cache status:",e),console.log("[CacheManagementService] Using mock data due to API error");const a=this.getMockModules(),t=this.categorizeAndSortModules(a);return console.log("[CacheManagementService] Mock categorized result:",t),t}}static async clearCache(e){try{const a=et("/api/admin/cache-clear.php"),t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,confirm:!0})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const l=await t.json();if(l.success)return!0;throw new Error(l.error||"Failed to clear cache")}catch(a){throw console.error("[CacheManagementService] Error clearing cache:",a),a}}static async getCacheStats(){try{const e=et("/api/admin/cache-stats.php"),a=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const t=await a.json();if(t.success)return t.stats||{};throw new Error(t.error||"Failed to get cache stats")}catch(e){throw console.error("[CacheManagementService] Error getting cache stats:",e),e}}static formatCacheSize(e){if(e===0)return"0 B";const a=1024,t=["B","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(a));return Math.round(e/Math.pow(a,l)*100)/100+" "+t[l]}static categorizeAndSortModules(e,a={}){const t=this.generateCacheKey(e),l=this.getCachedResult(t);if(l&&!a.forceRefresh)return l;const r=performance.now(),n=this.performCategorization(e),i=performance.now();return n.metadata={processingTime:i-r,totalModules:e.length,primaryCount:n.primaryModules.length,secondaryCount:n.secondaryModules.length,cached:!1},this.setCachedResult(t,n),n}static performCategorization(e){const a=[],t=[];return e.forEach(l=>{this.validateModule(l),this.PRIMARY_MODULE_IDS.includes(l.id)?a.push({...l,category:"primary",priority:this.PRIMARY_MODULE_PRIORITIES[l.id]||999}):t.push({...l,category:"secondary",groupType:this.getModuleType(l.id)})}),{primaryModules:this.sortPrimaryModules(a),secondaryModules:this.sortSecondaryModules(t)}}static sortPrimaryModules(e){return e.sort((a,t)=>{const l=this.PRIMARY_MODULE_PRIORITIES[a.id]||999,r=this.PRIMARY_MODULE_PRIORITIES[t.id]||999;return l-r})}static sortSecondaryModules(e){return e.sort((a,t)=>{const l=this.getModuleType(a.id),r=this.getModuleType(t.id);return l!==r?this.compareModuleTypes(l,r):a.name.localeCompare(t.name)})}static compareModuleTypes(e,a){const t=["users","activity","webhooks","other"],l=t.indexOf(e),r=t.indexOf(a);return(l===-1?999:l)-(r===-1?999:r)}static getModuleType(e){for(const[a,t]of Object.entries(this.SECONDARY_MODULE_TYPES))if(e.startsWith(t.prefix))return a;return e.includes("time-tracking")?"time-tracking":e.includes("graph")?"graphs":e.includes("dashboard")?"dashboards":"other"}static getModuleTypeConfig(e){return this.SECONDARY_MODULE_TYPES[e]||{title:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏",description:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã"}}static validateModule(e){if(!e||typeof e!="object")throw new Error("Module must be an object");if(!e.id||typeof e.id!="string")throw new Error("Module must have a valid id");if(!e.name||typeof e.name!="string")throw new Error("Module must have a valid name");return!0}static generateCacheKey(e){const a=e.map(t=>t.id).sort().join(",");return btoa(a).substring(0,16)}static getCachedResult(e){const a=this.categorizationCache.get(e);return a?Date.now()-a.timestamp>this.CACHE_TTL?(this.categorizationCache.delete(e),null):{...a.data,metadata:{...a.data.metadata,cached:!0}}:null}static setCachedResult(e,a){if(this.categorizationCache.set(e,{data:{...a,metadata:{...a.metadata,cached:!1}},timestamp:Date.now()}),this.categorizationCache.size>10){const t=this.categorizationCache.keys().next().value;this.categorizationCache.delete(t)}}static clearCategorizationCache(){this.categorizationCache.clear()}static invalidateCacheAfterModuleOperation(){this.clearCategorizationCache()}static getCategorizationStats(){return{cacheSize:this.categorizationCache.size,cacheEntries:Array.from(this.categorizationCache.entries()).map(([e,a])=>({key:e,age:Date.now()-a.timestamp,modulesCount:a.data.primaryModules.length+a.data.secondaryModules.length}))}}static formatTTL(e){return e<60?`${e} —Å–µ–∫`:e<3600?`${Math.floor(e/60)} –º–∏–Ω`:`${Math.floor(e/3600)} —á`}static formatCreationTime(e){return e<1e3?`${Math.round(e)}–º—Å`:e<6e4?`${Math.round(e/1e3*10)/10}—Å–µ–∫`:`${Math.round(e/6e4*10)/10}–º–∏–Ω`}static formatCacheHitRatio(e){return`${Math.round(e*100)}%`}static formatDataFreshness(e){return`${Math.round(e*100)}%`}static getExpiryColor(e){if(!e)return"gray";const a=Date.now()/1e3,t=(e-a)/3600;return t>2?"green":t>.5?"yellow":"red"}static getEfficiencyColor(e){return e>=.85?"green":e>=.7?"yellow":"red"}static getCreationTimeColor(e){return e<=2e3?"green":e<=1e4?"yellow":"red"}static getFreshnessColor(e){return e>=.9?"green":e>=.7?"yellow":"red"}static generateModuleMetadata(e){const a=Math.floor(Date.now()/1e3),t=e.metadata||{},l=this.PRIMARY_MODULE_IDS.includes(e.id);return{version:t.version||"1.0",module_id:e.id,module_name:e.name,created_at:t.created_at||a-Math.random()*86400*7,created_by:t.created_by||(Math.random()>.5?"system":"cron"),creation_time_ms:t.creation_time_ms||500+Math.random()*9500,last_accessed_at:t.last_accessed_at||a-Math.random()*3600,access_count:t.access_count||Math.floor(Math.random()*100)+1,expires_at:t.expires_at||a+(e.ttl||3600),ttl_seconds:e.ttl||3600,file_size_bytes:e.total_size||Math.floor(Math.random()*1e7)+1e6,compression_ratio:t.compression_ratio||.7+Math.random()*.3,data_version:t.data_version||`2026.01.12.v${Math.floor(Math.random()*10)+1}`,source_params:t.source_params||{period:l?Math.random()>.5?"weeks":"months":"default",sector_id:e.id.includes("sector-1c")?"1c":"all",filters:Math.random()>.5?["active_only"]:[],limit:Math.floor(Math.random()*1e3)+500},performance_metrics:t.performance_metrics||{avg_response_time_ms:20+Math.random()*80,cache_hit_ratio:.7+Math.random()*.3,data_freshness_score:.8+Math.random()*.2}}}static getMockModules(){const e=Math.floor(Date.now()/1e3);return[{id:"dashboard-sector-1c",name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",status:"active",file_count:5,total_size:1024e3,ttl:600,created_at:e-7200,expires_at:e+1800,cache_dir:"api/cache/dashboard-sector-1c"},{id:"graph-state",name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",status:"active",file_count:3,total_size:512e3,ttl:3600,created_at:e-3600,expires_at:e+7200,cache_dir:"api/cache/graph-state"},{id:"graph-admission-closure-weeks",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–µ–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",status:"active",file_count:8,total_size:2048e3,ttl:300,created_at:e-1800,expires_at:e+120,cache_dir:"api/cache/graph-admission-closure/weeks"},{id:"graph-admission-closure-months",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–µ–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",status:"active",file_count:12,total_size:3072e3,ttl:300,created_at:e-3600,expires_at:e+240,cache_dir:"api/cache/graph-admission-closure/months"},{id:"time-tracking-default",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",status:"active",file_count:4,total_size:768e3,ttl:300,created_at:e-900,expires_at:e+2100,cache_dir:"api/cache/time-tracking-sector-1c/default"},{id:"time-tracking-detailed",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:6,total_size:1536e3,ttl:120,created_at:e-600,expires_at:e+3540,cache_dir:"api/cache/time-tracking-sector-1c/detailed"},{id:"time-tracking-summary",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:2,total_size:384e3,ttl:600,created_at:e-1800,expires_at:e+4200,cache_dir:"api/cache/time-tracking-sector-1c/summary"},{id:"users-management-departments",name:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–æ—Ç–¥–µ–ª—ã)",status:"active",file_count:2,total_size:256e3,ttl:3600,created_at:e-7200,expires_at:e+28800,cache_dir:"api/cache/users-management/departments"},{id:"webhook-logs-api",name:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ (API –∑–∞–ø—Ä–æ—Å—ã)",status:"active",file_count:15,total_size:512e4,ttl:300,created_at:e-3600,expires_at:e+2400,cache_dir:"api/cache/webhook-logs/api"}]}static enrichModulesWithMetadata(e){return e.map(a=>({...a,metadata:this.generateModuleMetadata(a)}))}}Ke(Pe,"PRIMARY_MODULE_IDS",["dashboard-sector-1c","graph-state","graph-admission-closure-weeks","graph-admission-closure-months","time-tracking-default","time-tracking-detailed","time-tracking-summary"]),Ke(Pe,"PRIMARY_MODULE_PRIORITIES",{"dashboard-sector-1c":1,"graph-state":2,"graph-admission-closure-weeks":3,"graph-admission-closure-months":4,"time-tracking-default":5,"time-tracking-detailed":6,"time-tracking-summary":7}),Ke(Pe,"SECONDARY_MODULE_TYPES",{users:{prefix:"users-management",title:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –æ—Ç–¥–µ–ª–∞–º–∏"},activity:{prefix:"user-activity",title:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",description:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},webhooks:{prefix:"webhook-logs",title:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",description:"–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±—Ö—É–∫–æ–≤"}}),Ke(Pe,"categorizationCache",new Map),Ke(Pe,"CACHE_TTL",3e4);function zA(o){const e=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())),a=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-a);const t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}class xa{static async createCache(e,a=null,t={}){try{const l=et("/api/admin/cache-create.php"),r=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,mode:a,params:t})});if(!r.ok){const i=await r.json().catch(()=>({}));throw new Error(i.error||`HTTP error! status: ${r.status}`)}const n=await r.json();if(n.success)return n;throw new Error(n.error||"Failed to create cache")}catch(l){throw console.error("[CacheCreationService] Error creating cache:",l),l}}static async getCreationStatus(e){try{const a=et(`/api/admin/cache-create-status.php?task_id=${e}`),t=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const l=await t.json();if(l.success)return l;throw new Error(l.error||"Failed to get creation status")}catch(a){throw console.error("[CacheCreationService] Error getting creation status:",a),a}}static getDefaultParams(e){if(e.includes("graph-admission-closure"))if((e.includes("weeks")?"weeks":"months")==="weeks"){const t=new Date,l=t.getUTCFullYear(),r=zA(t),n=new Date(l,0,1+(r-1)*7),i=n.getUTCDay(),d=n.getUTCDate()-i+(i===0?-6:1);n.setUTCDate(d),n.setUTCHours(0,0,0,0);const g=new Date(n);return g.setUTCDate(n.getUTCDate()+6),g.setUTCHours(23,59,59,999),{product:"1C",periodMode:"weeks",weekStartUtc:n.toISOString(),weekEndUtc:g.toISOString(),includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,useCache:!0,forceRefresh:!0}}else return{product:"1C",periodMode:"months",includeTickets:!0,includeNewTicketsByStages:!1,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!1};if(e.includes("dashboard-sector-1c"))return{forceRefresh:!0,ttl:600};if(e.includes("graph-state"))return{type:"current",forceRefresh:!0,ttl:3600};if(e.includes("time-tracking")){const a=e.includes("detailed")?"detailed":e.includes("summary")?"summary":"default";return{product:"1C",includeTaskDetails:a==="detailed",summary:a==="summary"}}return{}}}let da=class{static notifyCacheCreationStarted(e){this.showNotification({content:`–ù–∞—á–∞—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}"...`,type:"info",autoHideDelay:3e3})}static notifyCacheCreationSuccess(e){this.showNotification({content:`‚úÖ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,type:"success",autoHideDelay:5e3})}static notifyCacheCreationError(e,a){this.showNotification({content:`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}": ${a}`,type:"error",autoHideDelay:7e3})}static notifyCacheUpdated(e,a="auto"){const t=a==="manual"?"–≤—Ä—É—á–Ω—É—é":"–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏";this.showNotification({content:`üîÑ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" –æ–±–Ω–æ–≤–ª—ë–Ω ${t}`,type:"info",autoHideDelay:4e3})}static notifyCacheUsed(e){this.showNotification({content:`‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}"`,type:"success",autoHideDelay:3e3})}static showNotification(e){typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:e.content,autoHideDelay:e.autoHideDelay||3e3}):console.log("[CacheNotification]",e.content)}};const GA=Object.freeze(Object.defineProperty({__proto__:null,CacheNotificationService:da},Symbol.toStringTag,{value:"Module"})),KA={name:"CacheCreateProgress",props:{progress:{type:Number,required:!0,validator:o=>o>=0&&o<=100},message:{type:String,default:"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞..."}}},qA={class:"cache-create-progress"},YA={class:"progress-bar"},XA={class:"progress-text"};function JA(o,e,a,t,l,r){return c(),u("div",qA,[s("div",YA,[s("div",{class:"progress-fill",style:we({width:a.progress+"%"})},null,4)]),s("div",XA,m(a.progress)+"% - "+m(a.message),1)])}const ZA=ce(KA,[["render",JA],["__scopeId","data-v-7071de3b"]]),QA={name:"CacheCreateModal",components:{CacheCreateProgress:ZA},props:{module:{type:Object,required:!0}},emits:["close","create"],setup(o,{emit:e}){const a=I(!1),t=I(0),l=I(""),r=I(null),n=I(""),i=$(()=>o.module.id.includes("graph-admission-closure")||o.module.id.includes("time-tracking")),d=$(()=>o.module.id.includes("graph-admission-closure")?["months","weeks"]:o.module.id.includes("time-tracking")?["default","detailed","summary"]:[]),g=()=>{e("close")},v=f=>{f.preventDefault(),f.stopPropagation(),f.target===f.currentTarget&&g()},w=async()=>{a.value=!0,t.value=0,l.value="–ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞...";try{let f={};if(n.value.trim())try{f=JSON.parse(n.value)}catch{throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")}else f=xa.getDefaultParams(o.module.id);da.notifyCacheCreationStarted(o.module.name),t.value=25,l.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24...";const p=await xa.createCache(o.module.id,r.value,f);t.value=75,l.value="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∞...",await new Promise(y=>setTimeout(y,500)),t.value=100,l.value="–ö–µ—à —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",da.notifyCacheCreationSuccess(o.module.name),setTimeout(()=>{e("create",p),g()},1e3)}catch(f){console.error("[CacheCreateModal] Error creating cache:",f),da.notifyCacheCreationError(o.module.name,f.message),a.value=!1}};return $e(()=>{d.value.length>0&&(r.value=d.value[0]);const f=xa.getDefaultParams(o.module.id);n.value=JSON.stringify(f,null,2)}),{creating:a,progress:t,progressMessage:l,selectedMode:r,paramsJson:n,supportsModes:i,availableModes:d,close:g,handleOverlayClick:v,handleCreate:w}}},e$={class:"modal-header"},t$={class:"modal-body"},a$={key:1,class:"create-form"},s$={key:0,class:"form-group"},o$=["value"],n$={class:"form-group"},r$={class:"modal-footer"},l$=["disabled"],i$=["disabled"],c$={key:0},d$={key:1};function u$(o,e,a,t,l,r){const n=be("CacheCreateProgress");return c(),he(It,{to:"body"},[s("div",{class:"modal-overlay",onClick:e[6]||(e[6]=(...i)=>t.handleOverlayClick&&t.handleOverlayClick(...i))},[s("div",{class:"modal-content",onClick:e[5]||(e[5]=Ce(()=>{},["stop"])),style:{"pointer-events":"auto"}},[s("div",e$,[s("h2",null,"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞: "+m(a.module.name),1),s("button",{onClick:e[0]||(e[0]=(...i)=>t.close&&t.close(...i)),class:"btn-close"},"√ó")]),s("div",t$,[t.creating?(c(),he(n,{key:0,progress:t.progress,message:t.progressMessage},null,8,["progress","message"])):(c(),u("div",a$,[t.supportsModes?(c(),u("div",s$,[e[7]||(e[7]=s("label",null,"–†–µ–∂–∏–º –∫–µ—à–∞:",-1)),Be(s("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>t.selectedMode=i),class:"form-control"},[(c(!0),u(ee,null,te(t.availableModes,i=>(c(),u("option",{key:i,value:i},m(i),9,o$))),128))],512),[[dt,t.selectedMode]])])):A("",!0),s("div",n$,[e[8]||(e[8]=s("label",null,"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):",-1)),Be(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=i=>t.paramsJson=i),placeholder:'{"product": "1C", ...}',rows:"5",class:"form-control"},null,512),[[At,t.paramsJson]]),e[9]||(e[9]=s("small",{class:"form-text"},"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",-1))])]))]),s("div",r$,[s("button",{onClick:e[3]||(e[3]=(...i)=>t.close&&t.close(...i)),class:"btn-cancel",disabled:t.creating},"–û—Ç–º–µ–Ω–∞",8,l$),s("button",{onClick:e[4]||(e[4]=(...i)=>t.handleCreate&&t.handleCreate(...i)),disabled:t.creating,class:"btn-create"},[t.creating?(c(),u("span",c$,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),u("span",d$,"–°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],8,i$)])])])])}const g$=ce(QA,[["render",u$],["__scopeId","data-v-1fa7d83b"]]),m$={name:"CacheCreateButton",components:{CacheCreateModal:g$},props:{module:{type:Object,required:!0}},emits:["created"],setup(o,{emit:e}){const a=I(!1),t=I(!1);return{showModal:a,creating:t,openModal:()=>{a.value=!0},closeModal:()=>{a.value=!1},handleCreate:async i=>{t.value=!0;try{e("created",i)}finally{t.value=!1}}}}},h$={class:"cache-create-button"},f$=["disabled"],v$={key:0},p$={key:1};function y$(o,e,a,t,l,r){const n=be("CacheCreateModal");return c(),u("div",h$,[s("button",{onClick:e[0]||(e[0]=(...i)=>t.openModal&&t.openModal(...i)),disabled:t.creating,class:X(["btn-create",{"btn-disabled":t.creating}])},[t.creating?(c(),u("span",v$,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),u("span",p$,"‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],10,f$),t.showModal?(c(),he(n,{key:0,module:a.module,onClose:t.closeModal,onCreate:t.handleCreate},null,8,["module","onClose","onCreate"])):A("",!0)])}const k$=ce(m$,[["render",y$],["__scopeId","data-v-45e7d308"]]);class Ye{static success(e,a,t={}){this.show("success",e,a,t)}static error(e,a,t={}){this.show("error",e,a,t)}static warning(e,a,t={}){this.show("warning",e,a,t)}static info(e,a,t={}){this.show("info",e,a,t)}static show(e,a,t,l={}){const r={autoHideDelay:l.autoHideDelay||5e3,position:l.position||"top-right",...l};this.isBitrix24Available()?this.showBitrix24Notification(e,a,t,r):this.showFallbackNotification(e,a,t,r)}static isBitrix24Available(){return typeof window<"u"&&window.BX&&window.BX.UI&&window.BX.UI.Notification&&window.BX.UI.Notification.Center&&typeof window.BX.UI.Notification.Center.notify=="function"}static showBitrix24Notification(e,a,t,l){try{const n={success:"success",error:"error",warning:"warning",info:"info"}[e]||"info",i=a?`${a}: ${t}`:t;window.BX.UI.Notification.Center.notify({content:i,autoHideDelay:l.autoHideDelay,category:`cache-management-${e}`,position:l.position}),console.log(`[NotificationSystem] Bitrix24 notification shown: ${e}`,{title:a,message:t,config:l})}catch(r){console.error("[NotificationSystem] Error showing Bitrix24 notification:",r),this.showFallbackNotification(e,a,t,l)}}static showFallbackNotification(e,a,t,l){if("Notification"in window&&Notification.permission==="granted")try{const r=new Notification(a||"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",{body:t,icon:this.getIconForType(e),tag:`cache-management-${e}`});setTimeout(()=>{r.close()},l.autoHideDelay),console.log(`[NotificationSystem] Browser notification shown: ${e}`,{title:a,message:t});return}catch(r){console.warn("[NotificationSystem] Browser notification failed:",r)}this.showCustomNotification(e,a,t,l)}static showCustomNotification(e,a,t,l){let r=document.getElementById("notification-container");if(!r){r=document.createElement("div"),r.id="notification-container",r.className="notification-container",document.body.appendChild(r);const d=document.createElement("style");d.textContent=this.getNotificationStyles(),document.head.appendChild(d)}const n=document.createElement("div");n.className=`custom-notification notification-${e}`,n.innerHTML=`
      <div class="notification-content">
        <div class="notification-title">${a||""}</div>
        <div class="notification-message">${t}</div>
      </div>
      <button class="notification-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">√ó</button>
    `,n.querySelector(".notification-close").addEventListener("click",()=>{this.removeCustomNotification(n)}),r.appendChild(n),setTimeout(()=>{this.removeCustomNotification(n)},l.autoHideDelay),console.log(`[NotificationSystem] Custom notification shown: ${e}`,{title:a,message:t})}static removeCustomNotification(e){e&&e.parentNode&&(e.classList.add("notification-hiding"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}static getIconForType(e){const a={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};return a[e]||a.info}static getNotificationStyles(){return`
      .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        pointer-events: none;
      }

      .custom-notification {
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 10px;
        min-width: 300px;
        max-width: 500px;
        pointer-events: auto;
        opacity: 0;
        transform: translateX(100%);
        animation: notificationSlideIn 0.3s ease forwards;
        border-left: 4px solid;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        padding: 16px;
        gap: 12px;
      }

      .custom-notification.notification-success {
        border-left-color: #28a745;
      }

      .custom-notification.notification-error {
        border-left-color: #dc3545;
      }

      .custom-notification.notification-warning {
        border-left-color: #ffc107;
      }

      .custom-notification.notification-info {
        border-left-color: #17a2b8;
      }

      .notification-content {
        flex: 1;
      }

      .notification-title {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
        color: #333;
      }

      .notification-message {
        font-size: 13px;
        color: #666;
        line-height: 1.4;
      }

      .notification-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #999;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        flex-shrink: 0;
      }

      .notification-close:hover {
        color: #333;
      }

      .notification-hiding {
        animation: notificationSlideOut 0.3s ease forwards;
      }

      @keyframes notificationSlideIn {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes notificationSlideOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(100%);
        }
      }

      @media (max-width: 768px) {
        .notification-container {
          left: 10px;
          right: 10px;
          top: 10px;
        }

        .custom-notification {
          min-width: auto;
          max-width: none;
        }
      }
    `}static clearAll(){try{this.isBitrix24Available()&&window.BX.UI.Notification.Center.clearAll&&window.BX.UI.Notification.Center.clearAll()}catch(a){console.warn("[NotificationSystem] Error clearing Bitrix24 notifications:",a)}const e=document.getElementById("notification-container");if(e&&(e.innerHTML=""),"Notification"in window&&"getNotifications"in Notification)try{Notification.getNotifications().forEach(t=>{t.tag&&t.tag.startsWith("cache-management-")&&t.close()})}catch(a){console.warn("[NotificationSystem] Error clearing browser notifications:",a)}}}Ye.show.bind(Ye);Ye.success.bind(Ye);Ye.error.bind(Ye);Ye.warning.bind(Ye);Ye.info.bind(Ye);let je=null,ot=null;const Ot=class Ot{static show(e={}){return new Promise((a,t)=>{ot=a,je||(je=this.createModal(),document.body.appendChild(je)),this.configureModal(e),this.showModal()})}static hide(){je&&(this.hideModal(),ot&&(ot(!1),ot=null))}static createModal(){const e=document.createElement("div");return e.className="cache-confirmation-modal",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","confirmation-title"),e.setAttribute("aria-describedby","confirmation-message"),e.innerHTML=`
      <div class="modal-backdrop" data-action="cancel"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="confirmation-title" class="modal-title"></h3>
          <button
            class="modal-close"
            data-action="cancel"
            aria-label="–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"
          >
            √ó
          </button>
        </div>

        <div class="modal-body">
          <div class="modal-icon">
            <span class="icon-symbol"></span>
          </div>
          <p id="confirmation-message" class="modal-message"></p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-cancel" data-action="cancel"></button>
          <button class="btn btn-confirm" data-action="confirm"></button>
        </div>
      </div>
    `,this.attachEventListeners(e),this.addStyles(),e}static configureModal(e){const{title:a="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",message:t="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ?",type:l="warning",confirmText:r="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",cancelText:n="–û—Ç–º–µ–Ω–∞",showCancel:i=!0}=e,d=je.querySelector(".modal-title");d.textContent=a;const g=je.querySelector(".modal-message");g.textContent=t;const v=je.querySelector(".icon-symbol"),w={danger:"‚ö†Ô∏è",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è",success:"‚úÖ"};v.textContent=w[l]||w.warning;const f=je.querySelector(".btn-cancel"),p=je.querySelector(".btn-confirm");f.textContent=n,p.textContent=r,i?f.style.display="inline-block":f.style.display="none",je.className=`cache-confirmation-modal modal-${l}`}static showModal(){document.body.style.overflow="hidden",je.style.display="flex",je.classList.add("modal-visible"),setTimeout(()=>{const e=je.querySelector(".btn-confirm");e&&e.focus()},100),document.addEventListener("keydown",this.handleKeyDown)}static hideModal(){document.body.style.overflow="",je.classList.remove("modal-visible"),document.removeEventListener("keydown",this.handleKeyDown),setTimeout(()=>{je&&(je.style.display="none")},300)}static attachEventListeners(e){e.addEventListener("click",a=>{const t=a.target.closest("[data-action]")?.getAttribute("data-action");t==="confirm"?this.handleConfirm():t==="cancel"&&this.handleCancel()})}static handleConfirm(){ot&&(ot(!0),ot=null),this.hideModal()}static handleCancel(){ot&&(ot(!1),ot=null),this.hideModal()}static handleTabNavigation(e){const t=je.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),l=t[0],r=t[t.length-1];e.shiftKey?document.activeElement===l&&(e.preventDefault(),r.focus()):document.activeElement===r&&(e.preventDefault(),l.focus())}static addStyles(){if(document.getElementById("cache-confirmation-styles"))return;const e=document.createElement("style");e.id="cache-confirmation-styles",e.textContent=`
      .cache-confirmation-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        align-items: center;
        justify-content: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      .cache-confirmation-modal.modal-visible {
        display: flex;
      }

      .modal-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(2px);
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        z-index: 10001;
        animation: modalSlideIn 0.3s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px 16px;
        border-bottom: 1px solid #e0e0e0;
      }

      .modal-title {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: #333;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .modal-close:hover {
        background: #f0f0f0;
        color: #333;
      }

      .modal-body {
        padding: 24px;
        text-align: center;
      }

      .modal-icon {
        margin-bottom: 16px;
      }

      .icon-symbol {
        font-size: 48px;
        display: block;
      }

      .modal-message {
        margin: 0;
        font-size: 16px;
        color: #555;
        line-height: 1.5;
      }

      .modal-footer {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        padding: 16px 24px 24px;
        border-top: 1px solid #e0e0e0;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
        min-width: 80px;
      }

      .btn:focus {
        outline: 2px solid #007bff;
        outline-offset: 2px;
      }

      .btn-cancel {
        background: #f8f9fa;
        color: #6c757d;
        border: 1px solid #dee2e6;
      }

      .btn-cancel:hover {
        background: #e9ecef;
        border-color: #adb5bd;
      }

      .btn-confirm {
        background: #007bff;
        color: white;
      }

      .btn-confirm:hover {
        background: #0056b3;
      }

      /* –¢–∏–ø—ã –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
      .modal-danger .btn-confirm {
        background: #dc3545;
      }

      .modal-danger .btn-confirm:hover {
        background: #c82333;
      }

      .modal-warning .btn-confirm {
        background: #ffc107;
        color: #212529;
      }

      .modal-warning .btn-confirm:hover {
        background: #e0a800;
      }

      .modal-info .btn-confirm {
        background: #17a2b8;
      }

      .modal-info .btn-confirm:hover {
        background: #138496;
      }

      .modal-success .btn-confirm {
        background: #28a745;
      }

      .modal-success .btn-confirm:hover {
        background: #1e7e34;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
      @media (max-width: 480px) {
        .modal-content {
          margin: 20px;
          width: calc(100% - 40px);
        }

        .modal-header,
        .modal-body,
        .modal-footer {
          padding-left: 20px;
          padding-right: 20px;
        }

        .modal-footer {
          flex-direction: column-reverse;
        }

        .btn {
          width: 100%;
        }
      }

      /* –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å */
      @media (prefers-reduced-motion: reduce) {
        .modal-content,
        .modal-close,
        .btn {
          animation: none;
          transition: none;
        }
      }

      /* –í—ã—Å–æ–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç */
      @media (prefers-contrast: high) {
        .modal-content {
          border: 2px solid #000;
        }

        .btn-cancel {
          border: 2px solid #000;
        }

        .btn-confirm {
          border: 2px solid #000;
        }
      }
    `,document.head.appendChild(e)}};Ke(Ot,"handleKeyDown",e=>{switch(e.key){case"Enter":e.preventDefault(),Ot.handleConfirm();break;case"Escape":e.preventDefault(),Ot.handleCancel();break;case"Tab":Ot.handleTabNavigation(e);break}});let $t=Ot;$t.show.bind($t);$t.hide.bind($t);const b$={name:"CacheModuleCard",components:{CacheCreateButton:k$},props:{module:{type:Object,required:!0,validator:o=>o&&typeof o.id=="string"&&typeof o.name=="string"},isPrimary:{type:Boolean,default:!1},priority:{type:Number,default:999},groupType:{type:String,default:null}},emits:["clear","refresh","details"],setup(o,{emit:e}){const a=I(!1),t=I(!1),l=I(!1),r=I(!1),n=b=>{if(!b.target.closest(".action-button"))switch(b.key){case"Enter":case" ":b.preventDefault();const O=b.currentTarget.querySelector(".action-button:not([disabled])");O&&O.focus();break}};$e(()=>{const b=()=>{r.value=window.innerWidth<768};b(),window.addEventListener("resize",b);const O=document.querySelector(`[data-module-id="${o.module.id}"]`);O&&O.addEventListener("keydown",n)}),at(()=>{const b=document.querySelector(`[data-module-id="${o.module.id}"]`);b&&b.removeEventListener("keydown",n)});const i=$(()=>({"cache-module-card":!0,"primary-module":o.isPrimary,"secondary-module":!o.isPrimary,"high-priority":o.priority<=3,"expiring-soon":T.value,"empty-cache":p.value,loading:a.value||t.value,[_.value]:!0})),d=$(()=>o.isPrimary?"üèÜ":{users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"}[o.groupType]||"üîß"),g=$(()=>({"primary-icon":o.isPrimary,"secondary-icon":!o.isPrimary})),v=$(()=>o.isPrimary?"–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å":o.groupType?Pe.getModuleTypeConfig(o.groupType).title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞":""),w=$(()=>o.priority?`priority-${o.priority}`:""),f=$(()=>`status-${o.module.status||"empty"}`),p=$(()=>(o.module.file_count||0)===0),y=$(()=>o.module.expires_at?new Date(o.module.expires_at*1e3)<=new Date:!1),T=$(()=>{if(!o.module.expires_at)return!1;const Q=(new Date(o.module.expires_at*1e3)-new Date)/(1e3*60*60);return Q>0&&Q<=2}),C=$(()=>{const b=o.module.status;return b==="active"?"–ê–∫—Ç–∏–≤–µ–Ω":b==="expired"?"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω":b==="empty"?"–ü—É—Å—Ç":"–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}),k=$(()=>Pe.formatCacheSize(o.module.total_size||0)),S=$(()=>Pe.formatTTL(o.module.ttl||0)),x=$(()=>{if(!o.module.cache_dir)return"";const b=o.module.cache_dir.split("/");return b.length>2?"..."+b.slice(-2).join("/"):o.module.cache_dir}),U=$(()=>o.module.metadata?.creation_time_ms?Pe.formatCreationTime(o.module.metadata.creation_time_ms):"‚Äî"),L=$(()=>{if(!o.module.metadata?.last_accessed_at)return"‚Äî";const b=new Date(o.module.metadata.last_accessed_at*1e3),Q=new Date-b;return Q<6e4?"–¢–æ–ª—å–∫–æ —á—Ç–æ":Q<36e5?`${Math.floor(Q/6e4)} –º–∏–Ω –Ω–∞–∑–∞–¥`:b.toLocaleString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),E=$(()=>o.module.metadata?.access_count||0),D=$(()=>o.module.metadata?.performance_metrics?.cache_hit_ratio?Pe.formatCacheHitRatio(o.module.metadata.performance_metrics.cache_hit_ratio):"‚Äî"),N=$(()=>o.module.metadata?.performance_metrics?.data_freshness_score?Pe.formatDataFreshness(o.module.metadata.performance_metrics.data_freshness_score):"‚Äî"),B=$(()=>o.module.expires_at?`metric-${Pe.getExpiryColor(o.module.expires_at)}`:""),W=$(()=>o.module.metadata?.creation_time_ms?`metric-${Pe.getCreationTimeColor(o.module.metadata.creation_time_ms)}`:""),G=$(()=>o.module.metadata?.performance_metrics?.cache_hit_ratio?`metric-${Pe.getEfficiencyColor(o.module.metadata.performance_metrics.cache_hit_ratio)}`:""),q=$(()=>o.module.metadata?.performance_metrics?.data_freshness_score?`metric-${Pe.getFreshnessColor(o.module.metadata.performance_metrics.data_freshness_score)}`:""),oe=$(()=>{if(!o.module.expires_at)return null;const b=new Date(o.module.expires_at*1e3);return Math.max(0,Math.floor((b-new Date)/1e3))}),Y=$(()=>{if(oe.value===null)return"‚Äî";if(oe.value<=0)return"–ò—Å—Ç–µ–∫";const b=Math.floor(oe.value/3600),O=Math.floor(oe.value%3600/60),Q=oe.value%60;return b>0?`${b}—á ${O}–º`:O>0?`${O}–º ${Q}—Å`:`${Q}—Å`}),H=$(()=>oe.value===null?"":oe.value<=0||oe.value<=1800?"metric-red":oe.value<=7200?"metric-orange":"metric-green"),Z=b=>{if(b===0)return"0 B";const O=1024,Q=["B","KB","MB","GB","TB"],de=Math.floor(Math.log(b)/Math.log(O));return parseFloat((b/Math.pow(O,de)).toFixed(1))+" "+Q[de]},fe=b=>b<60?`${b}—Å`:b<3600?`${Math.floor(b/60)}–º`:b<86400?`${Math.floor(b/3600)}—á`:`${Math.floor(b/86400)}–¥`,P=$(()=>{if(p.value)return"empty";if(y.value)return"expired";const b=oe.value;return b===null?"fresh":b<=0?"expired":b<=30*60*1e3?"critical":b<=2*60*60*1e3?"warning":"fresh"}),h=$(()=>{const b=P.value;return{fresh:"–°–≤–µ–∂–∏–π –∫–µ—à",warning:"–ò—Å—Ç–µ–∫–∞–µ—Ç —Å–∫–æ—Ä–æ",critical:"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç",expired:"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω",empty:"–ö–µ—à –ø—É—Å—Ç"}[b]||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}),_=$(()=>`cache-state-${P.value}`),R=$(()=>({fresh:"üü¢",warning:"üü°",critical:"üî¥",expired:"‚ö´",empty:"‚ö™"})[P.value]||"‚ùì"),re=$(()=>!p.value&&!a.value),ie=$(()=>o.isPrimary&&!p.value),se=$(()=>p.value?"–ö–µ—à –º–æ–¥—É–ª—è –ø—É—Å—Ç":`–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è ${o.module.name}`),me=$(()=>{if(!o.module.created_at)return"‚Äî";const b=new Date(o.module.created_at*1e3),O=new Date,Q=O-b;if(Q<6e4)return"–¢–æ–ª—å–∫–æ —á—Ç–æ";if(Q<36e5){const ke=Math.floor(Q/6e4);return`${ke} ${ke===1?"–º–∏–Ω—É—Ç—É":ke<5?"–º–∏–Ω—É—Ç—ã":"–º–∏–Ω—É—Ç"} –Ω–∞–∑–∞–¥`}if(b.toDateString()===O.toDateString())return`–°–µ–≥–æ–¥–Ω—è –≤ ${b.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`;const de=new Date(O);return de.setDate(de.getDate()-1),b.toDateString()===de.toDateString()?`–í—á–µ—Ä–∞ –≤ ${b.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:b.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),Se=$(()=>{if(!o.module.expires_at)return"‚Äî";const b=new Date(o.module.expires_at*1e3),Q=b-new Date;if(Q<0)return`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω (${b.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})`;const de=Math.floor(Q/6e4),ke=Math.floor(de/60);return ke>0?`${ke} —á ${de%60} –º–∏–Ω`:de>0?`${de} –º–∏–Ω`:"–ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã"});return{clearing:a,creating:t,showDetailModal:l,isMobile:r,moduleClasses:i,moduleIcon:d,iconClass:g,moduleTypeText:v,priorityClass:w,statusClass:f,isEmpty:p,isExpired:y,isExpiringSoon:T,statusText:C,formattedSize:k,formattedTTL:S,shortCacheDir:x,formattedCreationTime:U,formattedLastAccess:L,accessCount:E,cacheEfficiency:D,dataFreshness:N,expiresClass:B,creationTimeClass:W,cacheEfficiencyClass:G,dataFreshnessClass:q,cacheState:P,cacheStateText:h,cacheStateClass:_,cacheStateIcon:R,timeToExpiry:oe,formatTimeToExpiry:Y,timeToExpiryClass:H,formatBytes:Z,formatTTL:fe,canClear:re,canShowDetails:ie,clearButtonLabel:se,formattedCreatedAt:me,formattedExpiresAt:Se,handleClear:async()=>{if(re.value)try{if(!await $t.show({title:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",message:`–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${o.module.name}"?

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`,type:"danger",confirmText:"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à",cancelText:"–û—Ç–º–µ–Ω–∞"}))return;a.value=!0,await Pe.clearCache(o.module.id),e("clear",o.module.id),Ye.success("–ö–µ—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω",`–ö–µ—à –º–æ–¥—É–ª—è "${o.module.name}" –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω`)}catch(b){console.error("[CacheModuleCard] Error clearing cache:",b),Ye.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${o.module.name}": ${b.message}`)}finally{a.value=!1}},handleCacheCreated:()=>{Pe.invalidateCacheAfterModuleOperation(),e("refresh")},handleCreatingState:b=>{t.value=b},showDetails:()=>{l.value=!0,e("details",o.module)},closeDetails:()=>{l.value=!1}}}},_$=["aria-labelledby","aria-describedby","data-module-id"],w$={class:"card-header"},C$={class:"module-identity"},T$={class:"module-info"},S$=["id"],D$={class:"module-type"},E$={class:"header-meta"},A$=["id"],$$={class:"card-content"},I$={class:"data-grid",role:"region","aria-label":"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–µ—à–µ"},M$={class:"data-section statistics"},N$={class:"data-items"},x$={class:"data-item"},L$={class:"data-value"},P$={class:"data-item"},O$={class:"data-value"},B$={key:0,class:"data-item full-width"},R$=["title"],W$={class:"data-section lifetime"},U$={class:"data-items"},F$={class:"data-item"},H$={class:"data-value"},j$={key:0,class:"data-item"},V$={class:"data-value"},z$={key:1,class:"data-item"},G$={class:"data-section cache-state"},K$={class:"section-header"},q$=["aria-label"],Y$={class:"data-items"},X$={class:"data-value cache-state-text"},J$={key:0,class:"data-section performance"},Z$={class:"data-items"},Q$={key:0,class:"data-item"},eI={key:1,class:"data-item"},tI={class:"data-value"},aI={key:2,class:"data-item"},sI={class:"data-value"},oI={key:3,class:"data-item"},nI={key:4,class:"data-item"},rI={key:5,class:"data-item"},lI={class:"data-value"},iI={key:6,class:"data-item"},cI={class:"data-value"},dI={key:7,class:"data-item"},uI=["aria-label"],gI={class:"primary-actions"},mI={class:"secondary-actions"},hI=["disabled","aria-label"],fI={key:0,class:"button-content"},vI={key:1,class:"button-content"},pI={key:2,class:"button-content"},yI=["aria-label"],kI={class:"detail-modal",role:"dialog","aria-modal":"true"},bI={class:"modal-header"},_I={class:"modal-content"},wI={class:"json-data"};function CI(o,e,a,t,l,r){const n=be("CacheCreateButton");return c(),u("article",{class:X(["cache-module-card",t.moduleClasses]),role:"article","aria-labelledby":`module-${a.module.id}-title`,"aria-describedby":`module-${a.module.id}-status`,"data-module-id":a.module.id,tabindex:"0"},[s("div",w$,[s("div",C$,[s("div",{class:X(["module-icon",t.iconClass])},m(t.moduleIcon),3),s("div",T$,[s("h3",{class:"module-name",id:`module-${a.module.id}-title`},m(a.module.name),9,S$),s("span",D$,m(t.moduleTypeText),1)])]),s("div",E$,[a.isPrimary&&a.priority?(c(),u("span",{key:0,class:X(["priority-badge",t.priorityClass])},m(a.priority),3)):A("",!0),s("span",{class:X(["status-badge",t.statusClass]),id:`module-${a.module.id}-status`,role:"status"},m(t.statusText),11,A$)])]),s("div",$$,[s("div",I$,[s("div",M$,[e[14]||(e[14]=s("div",{class:"section-header"},[s("span",{class:"section-icon","aria-hidden":"true"},"üìä"),s("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],-1)),s("div",N$,[s("div",x$,[e[11]||(e[11]=s("span",{class:"data-label"},"–§–∞–π–ª–æ–≤:",-1)),s("span",L$,m(a.module.file_count||0),1)]),s("div",P$,[e[12]||(e[12]=s("span",{class:"data-label"},"–†–∞–∑–º–µ—Ä:",-1)),s("span",O$,m(t.formattedSize),1)]),a.module.cache_dir?(c(),u("div",B$,[e[13]||(e[13]=s("span",{class:"data-label"},"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:",-1)),s("span",{class:"data-value cache-dir",title:a.module.cache_dir},m(t.shortCacheDir),9,R$)])):A("",!0)])]),s("div",W$,[e[18]||(e[18]=s("div",{class:"section-header"},[s("span",{class:"section-icon","aria-hidden":"true"},"‚è∞"),s("h4",{class:"section-title"},"–í—Ä–µ–º—è –∂–∏–∑–Ω–∏")],-1)),s("div",U$,[s("div",F$,[e[15]||(e[15]=s("span",{class:"data-label"},"TTL:",-1)),s("span",H$,m(t.formattedTTL),1)]),a.module.created_at?(c(),u("div",j$,[e[16]||(e[16]=s("span",{class:"data-label"},"–°–æ–∑–¥–∞–Ω:",-1)),s("span",V$,m(t.formattedCreatedAt),1)])):A("",!0),a.module.expires_at?(c(),u("div",z$,[e[17]||(e[17]=s("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç:",-1)),s("span",{class:X(["data-value",t.expiresClass])},m(t.formattedExpiresAt),3)])):A("",!0)])]),s("div",G$,[s("div",K$,[s("span",{class:"section-icon","aria-label":t.cacheStateText,"aria-hidden":"false"},m(t.cacheStateIcon),9,q$),e[19]||(e[19]=s("h4",{class:"section-title"},"–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–µ—à–∞",-1))]),s("div",Y$,[s("div",{class:X(["data-item cache-state-indicator",t.cacheStateClass])},[e[20]||(e[20]=s("span",{class:"data-label"},"–°—Ç–∞—Ç—É—Å:",-1)),s("span",X$,m(t.cacheStateText),1)],2)])]),a.module.metadata||a.module.created_at?(c(),u("div",J$,[e[29]||(e[29]=s("div",{class:"section-header"},[s("span",{class:"section-icon","aria-hidden":"true"},"‚ö°"),s("h4",{class:"section-title"},"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")],-1)),s("div",Z$,[t.formattedCreationTime?(c(),u("div",Q$,[e[21]||(e[21]=s("span",{class:"data-label"},"–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:",-1)),s("span",{class:X(["data-value",t.creationTimeClass])},m(t.formattedCreationTime),3)])):A("",!0),t.formattedLastAccess?(c(),u("div",eI,[e[22]||(e[22]=s("span",{class:"data-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—Å—Ç—É–ø:",-1)),s("span",tI,m(t.formattedLastAccess),1)])):A("",!0),t.accessCount!==null?(c(),u("div",aI,[e[23]||(e[23]=s("span",{class:"data-label"},"–û–±—Ä–∞—â–µ–Ω–∏–π:",-1)),s("span",sI,m(t.accessCount),1)])):A("",!0),t.cacheEfficiency?(c(),u("div",oI,[e[24]||(e[24]=s("span",{class:"data-label"},"–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),s("span",{class:X(["data-value",t.cacheEfficiencyClass])},m(t.cacheEfficiency),3)])):A("",!0),t.dataFreshness?(c(),u("div",nI,[e[25]||(e[25]=s("span",{class:"data-label"},"–°–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:",-1)),s("span",{class:X(["data-value",t.dataFreshnessClass])},m(t.dataFreshness),3)])):A("",!0),a.module.total_size?(c(),u("div",rI,[e[26]||(e[26]=s("span",{class:"data-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:",-1)),s("span",lI,m(t.formatBytes(a.module.total_size)),1)])):A("",!0),a.module.ttl?(c(),u("div",iI,[e[27]||(e[27]=s("span",{class:"data-label"},"TTL:",-1)),s("span",cI,m(t.formatTTL(a.module.ttl)),1)])):A("",!0),t.timeToExpiry!==null?(c(),u("div",dI,[e[28]||(e[28]=s("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑:",-1)),s("span",{class:X(["data-value",t.timeToExpiryClass])},m(t.formatTimeToExpiry),3)])):A("",!0)])])):A("",!0)])]),s("div",{class:X(["card-actions",{"mobile-layout":t.isMobile}]),role:"group","aria-label":`–î–µ–π—Å—Ç–≤–∏—è —Å –∫–µ—à–µ–º ${a.module.name}`},[s("div",gI,[ne(n,{module:a.module,disabled:t.creating,onCreated:t.handleCacheCreated,onCreating:t.handleCreatingState,class:X({loading:t.creating})},null,8,["module","disabled","onCreated","onCreating","class"])]),s("div",mI,[s("button",{onClick:e[0]||(e[0]=(...i)=>t.handleClear&&t.handleClear(...i)),onKeydown:[e[1]||(e[1]=Re((...i)=>t.handleClear&&t.handleClear(...i),["enter"])),e[2]||(e[2]=Re(Ce((...i)=>t.handleClear&&t.handleClear(...i),["prevent"]),["space"]))],disabled:!t.canClear,class:X(["action-button clear-button",{disabled:!t.canClear,loading:t.clearing}]),"aria-label":t.clearButtonLabel,tabindex:"0"},[t.clearing?(c(),u("span",fI,[...e[30]||(e[30]=[s("span",{class:"spinner"},null,-1),ge(" –û—á–∏—Å—Ç–∫–∞... ",-1)])])):t.isEmpty?(c(),u("span",vI," üìÅ –ö–µ—à –ø—É—Å—Ç ")):(c(),u("span",pI," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å "))],42,hI),t.canShowDetails?(c(),u("button",{key:0,onClick:e[3]||(e[3]=(...i)=>t.showDetails&&t.showDetails(...i)),onKeydown:[e[4]||(e[4]=Re((...i)=>t.showDetails&&t.showDetails(...i),["enter"])),e[5]||(e[5]=Re(Ce((...i)=>t.showDetails&&t.showDetails(...i),["prevent"]),["space"]))],class:"action-button details-button","aria-label":`–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞ ${a.module.name}`,title:"–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞",tabindex:"0"}," üìä ",40,yI)):A("",!0)])],10,uI),(c(),he(It,{to:"body"},[t.showDetailModal?(c(),u("div",{key:0,class:"detail-modal-overlay",onClick:e[9]||(e[9]=Ce((...i)=>t.closeDetails&&t.closeDetails(...i),["self"])),onKeydown:e[10]||(e[10]=Re((...i)=>t.closeDetails&&t.closeDetails(...i),["escape"]))},[s("div",kI,[s("div",bI,[s("h3",null,"–î–µ—Ç–∞–ª–∏ –∫–µ—à–∞: "+m(a.module.name),1),s("button",{onClick:e[6]||(e[6]=(...i)=>t.closeDetails&&t.closeDetails(...i)),onKeydown:[e[7]||(e[7]=Re((...i)=>t.closeDetails&&t.closeDetails(...i),["enter"])),e[8]||(e[8]=Re((...i)=>t.closeDetails&&t.closeDetails(...i),["escape"]))],class:"close-button","aria-label":"–ó–∞–∫—Ä—ã—Ç—å",tabindex:"0"}," ‚úï ",32)]),s("div",_I,[s("pre",wI,m(JSON.stringify(a.module,null,2)),1)])])],32)):A("",!0)]))],10,_$)}const TI=ce(b$,[["render",CI],["__scopeId","data-v-bc59cd77"]]),SI={name:"CacheStats",props:{modules:{type:Array,required:!1,default:()=>[]}},setup(o){console.log("[CacheStats] setup called with modules:",o.modules);const e=$(()=>o.modules||[]),a=$(()=>{console.log("[CacheStats] Computing primaryModules, total modules:",e.value?.length||0);const y=e.value.filter(T=>Pe.PRIMARY_MODULE_IDS.includes(T.id));return console.log("[CacheStats] Primary modules count:",y.length),y}),t=$(()=>{console.log("[CacheStats] Computing secondaryModules, total modules:",e.value?.length||0);const y=e.value.filter(T=>!Pe.PRIMARY_MODULE_IDS.includes(T.id));return console.log("[CacheStats] Secondary modules count:",y.length),y}),l=$(()=>a.value?.length||0),r=$(()=>t.value?.length||0),n=$(()=>e.value?.length||0),i=$(()=>e.value.reduce((y,T)=>y+(T.file_count||0),0)),d=$(()=>(o.modules||[]).reduce((y,T)=>y+(T.total_size||0),0)),g=$(()=>Pe.formatCacheSize(d.value)),v=$(()=>{const y=o.modules||[];if(y.length===0)return"0 –º–∏–Ω";const T=y.reduce((k,S)=>k+(S.ttl||0),0),C=Math.round(T/y.length);return Pe.formatTTL(C)}),w=$(()=>(e.value||[]).filter(y=>y.status==="active").length),f=$(()=>{if((r.value||0)===0)return[];const y={};(t.value||[]).forEach(C=>{const k=Pe.getModuleType(C.id);if(!y[k]){const S=Pe.getModuleTypeConfig(k);y[k]={type:k,title:S.title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞",icon:p(k),count:0}}y[k].count++});const T=r.value||0;return Object.values(y).map(C=>({...C,percentage:T>0?Math.round(C.count/T*100):0})).sort((C,k)=>k.count-C.count)}),p=y=>{const T={users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"};return T[y]||T.other};return{modules:e,primaryModulesCount:l,secondaryModulesCount:r,totalModules:n,totalFiles:i,totalSizeFormatted:g,avgTTL:v,activeModules:w,groupStats:f}}},DI={key:0,class:"cache-stats"},EI={class:"stats-overview"},AI={class:"overview-grid"},$I={class:"overview-card primary"},II={class:"overview-content"},MI={class:"overview-value"},NI={class:"overview-card secondary"},xI={class:"overview-content"},LI={class:"overview-value"},PI={class:"overview-card total"},OI={class:"overview-content"},BI={class:"overview-value"},RI={class:"detailed-stats"},WI={class:"stats-grid"},UI={class:"stat-card"},FI={class:"stat-content"},HI={class:"stat-value"},jI={class:"stat-card"},VI={class:"stat-content"},zI={class:"stat-value"},GI={class:"stat-card"},KI={class:"stat-content"},qI={class:"stat-value"},YI={class:"stat-card"},XI={class:"stat-content"},JI={class:"stat-value"},ZI={key:0,class:"group-distribution"},QI={class:"distribution-grid"},eM={class:"group-icon"},tM={class:"group-info"},aM={class:"group-name"},sM={class:"group-count"},oM={class:"group-percentage"},nM={key:1,class:"cache-stats-loading"};function rM(o,e,a,t,l,r){return(t.modules||[]).length>0?(c(),u("div",DI,[e[18]||(e[18]=s("h2",{class:"stats-title"},"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",-1)),s("div",EI,[s("div",AI,[s("div",$I,[e[2]||(e[2]=s("div",{class:"overview-icon"},"üèÜ",-1)),s("div",II,[s("div",MI,m(t.primaryModulesCount),1),e[0]||(e[0]=s("div",{class:"overview-label"},"–û—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[1]||(e[1]=s("div",{class:"overview-desc"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ",-1))])]),s("div",NI,[e[5]||(e[5]=s("div",{class:"overview-icon"},"üîß",-1)),s("div",xI,[s("div",LI,m(t.secondaryModulesCount),1),e[3]||(e[3]=s("div",{class:"overview-label"},"–ü–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[4]||(e[4]=s("div",{class:"overview-desc"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),s("div",PI,[e[8]||(e[8]=s("div",{class:"overview-icon"},"üì¶",-1)),s("div",OI,[s("div",BI,m(t.totalModules),1),e[6]||(e[6]=s("div",{class:"overview-label"},"–í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π",-1)),e[7]||(e[7]=s("div",{class:"overview-desc"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö",-1))])])])]),s("div",RI,[s("div",WI,[s("div",UI,[e[10]||(e[10]=s("div",{class:"stat-icon"},"üìÑ",-1)),s("div",FI,[s("div",HI,m(t.totalFiles),1),e[9]||(e[9]=s("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤",-1))])]),s("div",jI,[e[12]||(e[12]=s("div",{class:"stat-icon"},"üíæ",-1)),s("div",VI,[s("div",zI,m(t.totalSizeFormatted),1),e[11]||(e[11]=s("div",{class:"stat-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä",-1))])]),s("div",GI,[e[14]||(e[14]=s("div",{class:"stat-icon"},"‚è±Ô∏è",-1)),s("div",KI,[s("div",qI,m(t.avgTTL),1),e[13]||(e[13]=s("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–∏–π TTL",-1))])]),s("div",YI,[e[16]||(e[16]=s("div",{class:"stat-icon"},"‚ö°",-1)),s("div",XI,[s("div",JI,m(t.activeModules),1),e[15]||(e[15]=s("div",{class:"stat-label"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–µ—à–µ–π",-1))])])])]),t.secondaryModulesCount>0?(c(),u("div",ZI,[e[17]||(e[17]=s("h3",{class:"distribution-title"},"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),s("div",QI,[(c(!0),u(ee,null,te(t.groupStats,n=>(c(),u("div",{key:n.type,class:"distribution-item"},[s("div",eM,m(n.icon),1),s("div",tM,[s("div",aM,m(n.title),1),s("div",sM,m(n.count)+" –º–æ–¥—É–ª–µ–π",1)]),s("div",oM,m(n.percentage)+"%",1)]))),128))])])):A("",!0)])):(c(),u("div",nM,[...e[19]||(e[19]=[s("p",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])]))}const lM=ce(SI,[["render",rM],["__scopeId","data-v-9fa190bb"]]),iM={name:"CacheManagement",components:{CacheModuleCard:TI,CacheStats:lM},setup(){const o=I([]),e=I([]),a=I(!0),t=I(null),l=I(!1),r=$(()=>(o.value?.length||0)+(e.value?.length||0)),n=$(()=>{const k=i.value?.length||0,S=(d.value?.length||0)>0?1:0;return k+S}),i=$(()=>{const k=(o.value||[]).filter(S=>!S.id.includes("time-tracking"));return console.log("[CacheManagement] individualPrimaryModules:",k.length,k.map(S=>S.id)),k}),d=$(()=>{const k=(o.value||[]).filter(S=>S.id.includes("time-tracking")).sort((S,x)=>{const U=["time-tracking-default","time-tracking-detailed","time-tracking-summary"];return U.indexOf(S.id)-U.indexOf(x.id)});return console.log("[CacheManagement] timeTrackingModules:",k.length,k.map(S=>S.id)),k}),g=$(()=>{const k={};return(e.value||[]).forEach(x=>{const U=Pe.getModuleType(x.id);k[U]||(k[U]={type:U,title:w(U),modules:[]}),k[U].modules.push(x)}),Object.values(k).sort((x,U)=>{const L=["users","activity","webhooks","other"],E=L.indexOf(x.type),D=L.indexOf(U.type);return(E===-1?999:E)-(D===-1?999:D)})}),v=async()=>{a.value=!0,t.value=null;try{const k=await Pe.getCacheStatus();o.value=k.primaryModules||[],e.value=k.secondaryModules||[],console.log("[CacheManagement] Primary modules:",o.value.length,o.value.map(S=>({id:S.id,name:S.name}))),console.log("[CacheManagement] Secondary modules:",e.value.length,e.value.map(S=>({id:S.id,name:S.name})))}catch(k){console.error("[CacheManagement] Error loading modules:",k),t.value=k.message}finally{a.value=!1}},w=k=>{const S={users:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",activity:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",webhooks:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",other:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏"};return S[k]||S.other},f=async k=>{console.log(`[CacheManagement] Clearing module: ${k}`),Pe.invalidateCacheAfterModuleOperation(),await v()},p=async()=>{console.log("[CacheManagement] Clearing all cache"),l.value=!0;try{await Pe.clearCache("all"),Pe.invalidateCacheAfterModuleOperation(),Ye.success("–ö–µ—à –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω","–í—Å–µ —Ñ–∞–π–ª—ã –∫–µ—à–∞ –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã"),await v()}catch(k){console.error("[CacheManagement] Error clearing all cache:",k),Ye.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à: ${k.message}`)}finally{l.value=!1}},y=async k=>{console.log(`[CacheManagement] Creating cache for: ${k.name} (${k.id})`),alert(`–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${k.name}
ID: ${k.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},T=async k=>{console.log(`[CacheManagement] Clearing cache for: ${k.name} (${k.id})`),alert(`–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${k.name}
ID: ${k.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},C=()=>{v()};return $e(()=>{v()}),{primaryModules:o,secondaryModules:e,loading:a,error:t,totalModules:r,groupedSecondaryModules:g,individualPrimaryModules:i,timeTrackingModules:d,logicalPrimaryCount:n,clearingAll:l,handleModuleClear:f,handleClearAllCache:p,handleCreateMock:y,handleClearMock:T,refreshModules:C}}},cM={class:"cache-management"},dM={key:0,class:"header-section"},uM={class:"stats-bar"},gM={class:"stat-item"},mM={class:"stat-item"},hM={class:"stat-item"},fM={key:0,class:"global-actions"},vM=["disabled"],pM={key:0},yM={key:1},kM={class:"section-header"},bM={class:"section-meta"},_M={class:"module-count","aria-label":"{{ logicalPrimaryCount }} –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},wM={key:0,class:"modules-container"},CM={key:0,class:"modules-grid"},TM={key:1,class:"time-tracking-group"},SM={class:"modules-grid"},DM={key:1,class:"empty-state"},EM={key:2,class:"section-divider"},AM={key:3,class:"cache-section secondary-modules","aria-labelledby":"secondary-modules-heading"},$M={class:"section-header"},IM={class:"section-meta"},MM={class:"module-count","aria-label":"{{ (secondaryModules || []).length }} –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},NM={class:"grouped-modules"},xM={class:"group-header"},LM={class:"group-title"},PM={class:"group-badge secondary"},OM={class:"modules-grid"},BM={key:4,class:"error-message",role:"alert","aria-live":"assertive"},RM={key:5,class:"loading-overlay",role:"status","aria-live":"polite","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"};function WM(o,e,a,t,l,r){const n=be("CacheModuleCard");return c(),u("div",cM,[!t.loading&&!t.error?(c(),u("div",dM,[e[6]||(e[6]=s("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1)),e[7]||(e[7]=s("p",{class:"description"}," –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º —Å–∏—Å—Ç–µ–º—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è ",-1)),s("div",uM,[s("span",gM,[s("strong",null,m(t.totalModules),1),e[3]||(e[3]=ge(" –≤—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π ",-1))]),s("span",mM,[s("strong",null,m(t.logicalPrimaryCount),1),e[4]||(e[4]=ge(" –æ—Å–Ω–æ–≤–Ω—ã—Ö ",-1))]),s("span",hM,[s("strong",null,m((t.secondaryModules||[]).length),1),e[5]||(e[5]=ge(" –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ",-1))])]),!t.loading&&!t.error?(c(),u("div",fM,[s("button",{onClick:e[0]||(e[0]=(...i)=>t.handleClearAllCache&&t.handleClearAllCache(...i)),disabled:t.clearingAll,class:X(["btn-clear-all",{"btn-disabled":t.clearingAll}])},[t.clearingAll?(c(),u("span",pM,"üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫–µ—à–∞...")):(c(),u("span",yM,"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à"))],10,vM)])):A("",!0)])):A("",!0),!t.loading&&!t.error?(c(),u("section",{key:1,class:X(["cache-section primary-modules",{empty:(t.primaryModules||[]).length===0}]),"aria-labelledby":"primary-modules-heading"},[s("div",kM,[e[9]||(e[9]=s("h2",{id:"primary-modules-heading"},"üèÜ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),s("div",bM,[s("span",_M,m(t.logicalPrimaryCount),1),e[8]||(e[8]=s("span",{class:"section-badge primary",role:"status","aria-label":"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",-1))])]),e[13]||(e[13]=s("p",{class:"section-description"}," 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã: –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°, –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏–µ–º–∞-–∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°. ",-1)),(t.primaryModules||[]).length>0?(c(),u("div",wM,[t.individualPrimaryModules.length>0?(c(),u("div",CM,[(c(!0),u(ee,null,te(t.individualPrimaryModules,i=>(c(),u("div",{key:i.id,class:"module-wrapper"},[ne(n,{module:i,"is-primary":!0,priority:i.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])):A("",!0),(t.timeTrackingModules||[]).length>0?(c(),u("div",TM,[e[10]||(e[10]=s("div",{class:"group-header"},[s("h3",{class:"group-title"},"‚è±Ô∏è –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"),s("span",{class:"group-badge"},"–û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞")],-1)),e[11]||(e[11]=s("p",{class:"group-description"},"–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),s("div",SM,[(c(!0),u(ee,null,te(t.timeTrackingModules,i=>(c(),u("div",{key:i.id,class:"module-wrapper"},[ne(n,{module:i,"is-primary":!0,priority:i.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])])):A("",!0)])):(c(),u("div",DM,[e[12]||(e[12]=s("p",null,"‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)),s("button",{onClick:e[1]||(e[1]=(...i)=>t.refreshModules&&t.refreshModules(...i)),class:"refresh-btn"},"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫")]))],2)):A("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),u("div",EM,[...e[14]||(e[14]=[_t('<div class="divider-line" data-v-6a4e8216></div><div class="divider-content" data-v-6a4e8216><span class="divider-icon" data-v-6a4e8216>üîß</span><span class="divider-text" data-v-6a4e8216>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏</span><span class="divider-subtitle" data-v-6a4e8216>–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</span></div><div class="divider-line" data-v-6a4e8216></div>',3)])])):A("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),u("section",AM,[s("div",$M,[e[16]||(e[16]=s("h2",{id:"secondary-modules-heading"},"üîß –ü–æ–±–æ—á–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),s("div",IM,[s("span",MM,m((t.secondaryModules||[]).length),1),e[15]||(e[15]=s("span",{class:"section-badge secondary",role:"status","aria-label":"–°–ª—É–∂–µ–±–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),e[17]||(e[17]=s("p",{class:"section-description"}," –ú–æ–¥—É–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã. ",-1)),s("div",NM,[(c(!0),u(ee,null,te(t.groupedSecondaryModules,i=>(c(),u("div",{key:i.type,class:X(["module-group",`group-${i.type}`])},[s("div",xM,[s("h3",LM,m(i.title),1),s("span",PM,m(i.modules.length),1)]),s("div",OM,[(c(!0),u(ee,null,te(i.modules,d=>(c(),u("div",{key:d.id,class:"module-wrapper"},[ne(n,{module:d,"is-primary":!1,"group-type":i.type,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","group-type","onClear","onRefresh"])]))),128))])],2))),128))])])):A("",!0),t.error?(c(),u("div",BM,[e[18]||(e[18]=s("h3",null,"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞",-1)),s("p",null,m(t.error),1),s("button",{onClick:e[2]||(e[2]=(...i)=>o.loadModules&&o.loadModules(...i)),class:"retry-btn","aria-label":"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):A("",!0),t.loading?(c(),u("div",RM,[...e[19]||(e[19]=[s("div",{class:"loading-spinner","aria-hidden":"true"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞...",-1)])])):A("",!0)])}const UM=ce(iM,[["render",WM],["__scopeId","data-v-6a4e8216"]]),FM={name:"CacheManagementPage",components:{CacheManagement:UM},beforeCreate(){console.log("[CacheManagementPage] beforeCreate() called")},created(){console.log("[CacheManagementPage] created() called")},beforeMount(){console.log("[CacheManagementPage] beforeMount() called")},setup(){console.log("[CacheManagementPage] setup() called with new hierarchical UI");const o=Xe(),e=I(!1),a=I(null),t=()=>{o.push({name:"index"})};return $e(()=>{console.log("[CacheManagementPage] onMounted() called - hierarchical cache management ready")}),{loading:e,error:a,goBack:t}}},HM={class:"cache-management-page"},jM={class:"page-header"},VM={class:"page-header-top"},zM={key:0,class:"loading"},GM={key:1,class:"error"},KM={key:2,class:"cache-content"};function qM(o,e,a,t,l,r){const n=be("CacheManagement");return c(),u("div",HM,[s("div",jM,[s("div",VM,[s("button",{onClick:e[0]||(e[0]=(...i)=>t.goBack&&t.goBack(...i)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[s("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),s("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=s("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1))]),t.loading?(c(),u("div",zM," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–µ—à–∞... ")):t.error?(c(),u("div",GM,m(t.error),1)):(c(),u("div",KM,[ne(n)]))])}const YM=ce(FM,[["render",qM],["__scopeId","data-v-a20ded38"]]),XM=[{path:"/install",name:"install",component:Bo},{path:"/",name:"index",component:Q_},{path:"/webhook-logs",name:"webhook-logs",redirect:"/admin/webhook-logs"},{path:"/admin/webhook-logs",name:"admin-webhook-logs",component:aS,meta:{requiresAuth:!0,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",adminOnly:!0}},{path:"/admin/users",name:"admin-users",component:VA,meta:{requiresAuth:!0,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",adminOnly:!0}},{path:"/admin/cache",name:"admin-cache",component:YM,meta:{requiresAuth:!0,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",adminOnly:!0}},{path:"/dashboard/sector-1c",name:"dashboard-sector-1c",component:()=>Ee(()=>Promise.resolve().then(()=>Us),void 0,import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector1c"}},{path:"/dashboard/sector-pdm",name:"dashboard-sector-pdm",component:()=>Ee(()=>Promise.resolve().then(()=>Mn),void 0,import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector-pdm"}},{path:"/dashboard/sector-bitrix24",name:"dashboard-sector-bitrix24",component:()=>Ee(()=>import("./SectorDashboardBitrix24.vue-CfHf327U.js"),__vite__mapDeps([10,7,4,2,3,0,1]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector-bitrix24"}},{path:"/dashboard/sector-infrastructure",name:"dashboard-sector-infrastructure",component:()=>Ee(()=>import("./SectorDashboardInfrastructure.vue-C-qI3v8C.js"),__vite__mapDeps([11,7,4,2,3,0,1]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector-infrastructure"}},{path:"/dashboard/graph-admission-closure",name:"dashboard-graph-admission-closure",component:()=>Ee(()=>Promise.resolve().then(()=>Kk),void 0,import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–æ–≤—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",requiresAuth:!0,chunk:"admission-dashboard"}},{path:"/dashboard/graph-state",name:"dashboard-graph-state",component:()=>Ee(()=>Promise.resolve().then(()=>jg),void 0,import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏",requiresAuth:!0,chunk:"graph-state"}},{path:"/dashboard/tickets-time-tracking",name:"dashboard-tickets-time-tracking",component:()=>Ee(()=>Promise.resolve().then(()=>jl),void 0,import.meta.url),meta:{title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",requiresAuth:!0,chunk:"tickets-tracking"}}],ya=oo({history:no(),routes:XM});ya.beforeEach(async(o,e,a)=>{if(console.log("[Router] beforeEach:",{to:o.path,from:e.path,name:o.name}),o.meta.title&&(document.title=`${o.meta.title} - Bitrix24 Dashboard`),o.meta.requiresAuth){console.log("[Router] requiresAuth check for:",o.path);try{const t=await rt.checkAccess();if(!t.allowed){console.warn("Unauthorized access attempt to:",o.path,t.errorMessage),a({name:"index"});return}}catch(t){console.error("Error checking access in navigation guard:",t),a();return}}if(o.meta.adminOnly)try{const t=await rt.getCurrentUser();if(!t||!sa(t)){console.warn("Admin access required for:",o.path),a({name:"index"});return}}catch(t){console.error("Error checking admin access in navigation guard:",t),a({name:"index"});return}if(e.name!==null&&o.path!==e.path)try{if((await rt.checkAccess()).allowed){const l=await rt.getCurrentUser();l&&ca.logPageVisit(o,l,e).catch(r=>{console.error("[Router] Error logging page visit:",r)})}}catch(t){console.error("[Router] Error in activity logging:",t)}if(o.name==="index"&&!e.name&&setTimeout(()=>{Ee(()=>Promise.resolve().then(()=>Us),void 0,import.meta.url)},1e3),o.meta.chunk)switch(o.meta.chunk){case"dashboard-sector1c":setTimeout(()=>{Ee(()=>Promise.resolve().then(()=>Fv),void 0,import.meta.url)},500);break;case"admission-dashboard":setTimeout(()=>{Ee(()=>import("./chunk-BPIGQGZw.js").then(t=>t.l),__vite__mapDeps([3,4]),import.meta.url)},500);break}console.log("[Router] Allowing navigation to:",o.path),a()});setTimeout(()=>{const o=window.location.pathname,e=window.location.hash;e&&e!=="#/"||(o.includes("install.php")?ya.replace("/install"):ya.replace("/"))},0);class ua{static startBundleLoad(){this.metrics.bundleLoadTime=performance.now()}static endBundleLoad(e){const a=performance.now()-this.metrics.bundleLoadTime;this.metrics.chunkLoadTimes.set(e,a),console.log(`üì¶ Chunk "${e}" loaded in ${a.toFixed(2)}ms`),window.gtag&&window.gtag("event","bundle_load",{chunk_name:e,load_time:a}),a>1e3&&console.warn(`üêå Slow chunk load: ${e} took ${a.toFixed(2)}ms`)}static trackComponentLoad(e,a){const t=performance.now()-a;this.metrics.componentLoadTime.set(e,t),console.log(`üß© Component "${e}" loaded in ${t.toFixed(2)}ms`),t>500&&console.warn(`üêå Slow component load: ${e} took ${t.toFixed(2)}ms`)}static trackApiCall(e,a){this.metrics.apiResponseTime.set(e,a),a>1e3&&console.warn(`üêå Slow API call to ${e}: ${a}ms`)}static getReport(){const e=Array.from(this.metrics.componentLoadTime.values()),a=Array.from(this.metrics.apiResponseTime.values()),t=Array.from(this.metrics.chunkLoadTimes.values());return{totalChunks:this.metrics.chunkLoadTimes.size,totalComponents:this.metrics.componentLoadTime.size,totalApiCalls:this.metrics.apiResponseTime.size,averageComponentLoadTime:e.length>0?e.reduce((l,r)=>l+r,0)/e.length:0,averageApiResponseTime:a.length>0?a.reduce((l,r)=>l+r,0)/a.length:0,averageChunkLoadTime:t.length>0?t.reduce((l,r)=>l+r,0)/t.length:0,slowestComponents:Array.from(this.metrics.componentLoadTime.entries()).sort(([,l],[,r])=>r-l).slice(0,5).map(([l,r])=>({name:l,time:r})),slowestApiCalls:Array.from(this.metrics.apiResponseTime.entries()).sort(([,l],[,r])=>r-l).slice(0,5).map(([l,r])=>({endpoint:l,time:r})),slowestChunks:Array.from(this.metrics.chunkLoadTimes.entries()).sort(([,l],[,r])=>r-l).slice(0,5).map(([l,r])=>({name:l,time:r}))}}static clearMetrics(){this.metrics.bundleLoadTime=0,this.metrics.componentLoadTime.clear(),this.metrics.apiResponseTime.clear(),this.metrics.chunkLoadTimes.clear()}}Ke(ua,"metrics",{bundleLoadTime:0,componentLoadTime:new Map,apiResponseTime:new Map,chunkLoadTimes:new Map});class JM{static init(){this.initChunkLoadErrorHandling(),this.initUnhandledErrorHandling(),this.initNetworkErrorHandling()}static initChunkLoadErrorHandling(){if(window.addEventListener("error",e=>{e.target.tagName==="SCRIPT"&&(console.error("‚ùå Chunk loading error:",e.target.src),this.reportError("chunk_load_error",{url:e.target.src,message:e.message||"Script load failed"}))}),"PerformanceObserver"in window)try{new PerformanceObserver(a=>{for(const t of a.getEntries())if(t.entryType==="resource"&&t.name.includes(".js")){const l=t.responseEnd-t.requestStart;ua.trackApiCall(t.name,l)}}).observe({entryTypes:["resource"]})}catch{console.warn("PerformanceObserver not supported")}}static initUnhandledErrorHandling(){window.addEventListener("unhandledrejection",e=>{console.error("‚ùå Unhandled promise rejection:",e.reason),this.reportError("unhandled_rejection",{reason:e.reason?.message||String(e.reason),stack:e.reason?.stack})}),window.addEventListener("error",e=>{e.error&&e.filename&&(console.error("‚ùå Unhandled error:",e.error),this.reportError("unhandled_error",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error.stack}))})}static initNetworkErrorHandling(){const e=window.fetch;window.fetch=function(...a){const t=performance.now();return e.apply(this,a).then(l=>{const r=performance.now()-t;return ua.trackApiCall(a[0],r),l.ok||console.warn(`üö® API error: ${l.status} ${l.statusText} for ${a[0]}`),l}).catch(l=>{const r=performance.now()-t;throw console.error(`‚ùå Network error for ${a[0]}:`,l),ua.trackApiCall(a[0],r),this.reportError("network_error",{url:a[0],message:l.message,loadTime:r}),l})}}static reportError(e,a){const t={type:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...a};if(console.error("üìä Error report:",t),window.Sentry&&window.Sentry.captureException(new Error(`${e}: ${JSON.stringify(a)}`)),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:"/api/log-error.php",method:"POST",data:t})}catch(l){console.error("Failed to send error report to Bitrix24:",l)}window.gtag&&window.gtag("event","exception",{description:`${e}: ${a.message||"Unknown error"}`,fatal:!1})}static getErrorStats(){return{chunkLoadErrors:0,networkErrors:0,unhandledErrors:0,totalErrors:0}}}const qa=ro(wo);qa.use(ya);const ZM=o=>{try{const e=new WeakSet;return JSON.stringify(o,(a,t)=>{if(typeof t=="object"&&t!==null){if(e.has(t))return"[Circular]";e.add(t)}return typeof t=="function"||t===void 0?null:t})}catch{return String(o)}};qa.config.errorHandler=(o,e,a)=>{if(o instanceof TypeError&&o.message.includes("Cannot read properties of undefined (reading 'type')")){console.warn("Caught undefined.type error:",{error:o.message,component:e?.$options?.name||"Unknown",info:a,stack:o.stack});return}if(console.error("Vue error:",o,a),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:et("/api/log-error.php"),method:"POST",data:{error:o?.message||String(o),info:typeof a=="string"?a:ZM(a),component:e?.$options?.name||"Unknown"}})}catch(t){console.error("Failed to log error:",t)}};qa.mount("#app");JM.init();export{Ss as S,ce as _,xt as a,bt as b,J as c,tw as d,Ga as e,jt as f,GA as g,gt as i,Ht as n};
