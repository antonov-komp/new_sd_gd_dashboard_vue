const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./main-CFHmHLwF.js","./main-BHG-6UNi.css","./ticketListUtils-BoUj61Ng.js","./priority-config-E_zHyBF_.js","./priority-config-Bxxce_5E.css","./ticket-mapper-BoCSE8dH.js"])))=>i.map(i=>d[i]);
var jt=Object.defineProperty;var zt=(s,t,e)=>t in s?jt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var st=(s,t,e)=>zt(s,typeof t!="symbol"?t+"":t,e);import{_ as Be,g as Q,G as Me,m as ct,H as Ot,f as Ee,o as y,j as ke,k as ge,a as f,d as ne,b as r,y as Te,n as pe,B as $e,I as qt,J as Ze,K as we,L as Zt,M as Bt,N as je,O as Xt,P as Jt,Q as Qt,R as er,S as tr,U as rr,V as ar,W as sr,X as nt,c as q,Y as W,t as A,F as ye,e as me,Z as Ve,$ as or,x as nr,l as Ue,a0 as lr,a1 as Re,z as It,r as Mt,a2 as Ut,a3 as Le,T as tt,a4 as Wt}from"./main-CFHmHLwF.js";import{F as Rt}from"./FiltersPanel-uCF_s1Xd.js";import{L as Fe,D as ir,B as cr}from"./index-Dlwl4QZR.js";import{g as At,a as dr,b as $t,D as ur,T as rt,c as dt}from"./priority-config-E_zHyBF_.js";const kr={key:0,class:"modal-overlay"},vr={class:"modal-container",role:"dialog","aria-labelledby":"modal-title","aria-modal":"true"},hr={class:"modal-body"},yr={class:"mode-description"},mr={__name:"PeriodModeInfoModal",props:{isVisible:{type:Boolean,required:!0},currentMode:{type:String,default:"weeks",validator:s=>["weeks","months"].includes(s)}},emits:["close","start-loading","select-mode"],setup(s,{emit:t}){const e=s,a=t,o=Q(e.currentMode);function l(m){if(!["weeks","months"].includes(m)){console.warn("[PeriodModeInfoModal] Invalid mode:",m);return}o.value=m,console.log("[DEBUG Modal] handleModeSelect: mode =",m),console.log("[DEBUG Modal] Emitting select-mode event"),a("select-mode",m),console.log("[DEBUG Modal] Emitting close event"),a("close"),console.log("[DEBUG Modal] Scheduling start-loading event in 100ms"),setTimeout(()=>{console.log("[DEBUG Modal] Emitting start-loading event"),a("start-loading")},100)}function d(){console.log("[DEBUG Modal] handleClose called, selectedMode =",o.value),console.log("[DEBUG Modal] Emitting select-mode event with",o.value),a("select-mode",o.value),console.log("[DEBUG Modal] Emitting close event"),a("close")}function c(m){m.key==="Escape"&&e.isVisible&&d()}return Me(()=>e.currentMode,m=>{["weeks","months"].includes(m)&&(o.value=m)}),ct(()=>{e.isVisible&&document.addEventListener("keydown",c)}),Ot(()=>{document.removeEventListener("keydown",c)}),Me(()=>e.isVisible,m=>{m?(document.addEventListener("keydown",c),o.value=e.currentMode):document.removeEventListener("keydown",c)}),(m,p)=>(y(),Ee(qt,{to:"body"},[ke($e,{name:"modal-fade"},{default:ge(()=>[s.isVisible?(y(),f("div",kr,[r("div",vr,[r("div",{class:"modal-header"},[p[2]||(p[2]=r("h2",{id:"modal-title",class:"modal-title"},[r("span",{class:"modal-icon"},"‚ÑπÔ∏è"),Te(" –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ")],-1)),r("button",{class:"modal-close-btn",onClick:d,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å",type:"button"}," √ó ")]),r("div",hr,[p[5]||(p[5]=r("p",{class:"modal-description"}," –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π: ",-1)),r("div",yr,[r("button",{class:pe(["mode-item mode-item--clickable",{"mode-item--selected":o.value==="weeks"}]),onClick:p[0]||(p[0]=O=>l("weeks")),type:"button"},[...p[3]||(p[3]=[r("div",{class:"mode-header"},[r("span",{class:"mode-icon"},"üìÖ"),r("h3",{class:"mode-title"},"4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏")],-1),r("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 –Ω–µ–¥–µ–ª–∏ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –Ω–µ–¥–µ–ª—è–º. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç–∏–∫–µ—Ç–æ–≤. ",-1)])],2),r("button",{class:pe(["mode-item mode-item--clickable",{"mode-item--selected":o.value==="months"}]),onClick:p[1]||(p[1]=O=>l("months")),type:"button"},[...p[4]||(p[4]=[r("div",{class:"mode-header"},[r("span",{class:"mode-icon"},"üìä"),r("h3",{class:"mode-title"},"3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞")],-1),r("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—Ü–µ–≤. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤. ",-1)])],2)])])])])):ne("",!0)]),_:1})]))}},pr=Be(mr,[["__scopeId","data-v-4a42a9a6"]]);/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var St=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var s=window.screen;if(s)return(s.deviceXDPI||1)/(s.logicalXDPI||1)}return 1}(),ze={toTextLines:function(s){var t=[],e;for(s=[].concat(s);s.length;)e=s.pop(),typeof e=="string"?t.unshift.apply(t,e.split(`
`)):Array.isArray(e)?s.push.apply(s,e):je(s)||t.unshift(""+e);return t},textSize:function(s,t,e){var a=[].concat(t),o=a.length,l=s.font,d=0,c;for(s.font=e.string,c=0;c<o;++c)d=Math.max(s.measureText(a[c]).width,d);return s.font=l,{height:o*e.lineHeight,width:d}},bound:function(s,t,e){return Math.max(s,Math.min(t,e))},arrayDiff:function(s,t){var e=s.slice(),a=[],o,l,d,c;for(o=0,d=t.length;o<d;++o)c=t[o],l=e.indexOf(c),l===-1?a.push([c,1]):e.splice(l,1);for(o=0,d=e.length;o<d;++o)a.push([e[o],-1]);return a},rasterize:function(s){return Math.round(s*St)/St}};function ot(s,t){var e=t.x,a=t.y;if(e===null)return{x:0,y:-1};if(a===null)return{x:1,y:0};var o=s.x-e,l=s.y-a,d=Math.sqrt(o*o+l*l);return{x:d?o/d:0,y:d?l/d:-1}}function gr(s,t,e,a,o){switch(o){case"center":e=a=0;break;case"bottom":e=0,a=1;break;case"right":e=1,a=0;break;case"left":e=-1,a=0;break;case"top":e=0,a=-1;break;case"start":e=-e,a=-a;break;case"end":break;default:o*=Math.PI/180,e=Math.cos(o),a=Math.sin(o);break}return{x:s,y:t,vx:e,vy:a}}var fr=0,Pt=1,xt=2,Lt=4,Ft=8;function Xe(s,t,e){var a=fr;return s<e.left?a|=Pt:s>e.right&&(a|=xt),t<e.top?a|=Ft:t>e.bottom&&(a|=Lt),a}function br(s,t){for(var e=s.x0,a=s.y0,o=s.x1,l=s.y1,d=Xe(e,a,t),c=Xe(o,l,t),m,p,O;!(!(d|c)||d&c);)m=d||c,m&Ft?(p=e+(o-e)*(t.top-a)/(l-a),O=t.top):m&Lt?(p=e+(o-e)*(t.bottom-a)/(l-a),O=t.bottom):m&xt?(O=a+(l-a)*(t.right-e)/(o-e),p=t.right):m&Pt&&(O=a+(l-a)*(t.left-e)/(o-e),p=t.left),m===d?(e=p,a=O,d=Xe(e,a,t)):(o=p,l=O,c=Xe(o,l,t));return{x0:e,x1:o,y0:a,y1:l}}function Je(s,t){var e=t.anchor,a=s,o,l;return t.clamp&&(a=br(a,t.area)),e==="start"?(o=a.x0,l=a.y0):e==="end"?(o=a.x1,l=a.y1):(o=(a.x0+a.x1)/2,l=(a.y0+a.y1)/2),gr(o,l,s.vx,s.vy,t.align)}var Qe={arc:function(s,t){var e=(s.startAngle+s.endAngle)/2,a=Math.cos(e),o=Math.sin(e),l=s.innerRadius,d=s.outerRadius;return Je({x0:s.x+a*l,y0:s.y+o*l,x1:s.x+a*d,y1:s.y+o*d,vx:a,vy:o},t)},point:function(s,t){var e=ot(s,t.origin),a=e.x*s.options.radius,o=e.y*s.options.radius;return Je({x0:s.x-a,y0:s.y-o,x1:s.x+a,y1:s.y+o,vx:e.x,vy:e.y},t)},bar:function(s,t){var e=ot(s,t.origin),a=s.x,o=s.y,l=0,d=0;return s.horizontal?(a=Math.min(s.x,s.base),l=Math.abs(s.base-s.x)):(o=Math.min(s.y,s.base),d=Math.abs(s.base-s.y)),Je({x0:a,y0:o+d,x1:a+l,y1:o,vx:e.x,vy:e.y},t)},fallback:function(s,t){var e=ot(s,t.origin);return Je({x0:s.x,y0:s.y,x1:s.x+(s.width||0),y1:s.y+(s.height||0),vx:e.x,vy:e.y},t)}},Ie=ze.rasterize;function _r(s){var t=s.borderWidth||0,e=s.padding,a=s.size.height,o=s.size.width,l=-o/2,d=-a/2;return{frame:{x:l-e.left-t,y:d-e.top-t,w:o+e.width+t*2,h:a+e.height+t*2},text:{x:l,y:d,w:o,h:a}}}function wr(s,t){var e=t.chart.getDatasetMeta(t.datasetIndex).vScale;if(!e)return null;if(e.xCenter!==void 0&&e.yCenter!==void 0)return{x:e.xCenter,y:e.yCenter};var a=e.getBasePixel();return s.horizontal?{x:a,y:null}:{x:null,y:a}}function Tr(s){return s instanceof er?Qe.arc:s instanceof tr?Qe.point:s instanceof rr?Qe.bar:Qe.fallback}function Cr(s,t,e,a,o,l){var d=Math.PI/2;if(l){var c=Math.min(l,o/2,a/2),m=t+c,p=e+c,O=t+a-c,P=e+o-c;s.moveTo(t,p),m<O&&p<P?(s.arc(m,p,c,-Math.PI,-d),s.arc(O,p,c,-d,0),s.arc(O,P,c,0,d),s.arc(m,P,c,d,Math.PI)):m<O?(s.moveTo(m,e),s.arc(O,p,c,-d,d),s.arc(m,p,c,d,Math.PI+d)):p<P?(s.arc(m,p,c,-Math.PI,0),s.arc(m,P,c,0,Math.PI)):s.arc(m,p,c,-Math.PI,Math.PI),s.closePath(),s.moveTo(t,e)}else s.rect(t,e,a,o)}function Wr(s,t,e){var a=e.backgroundColor,o=e.borderColor,l=e.borderWidth;!a&&(!o||!l)||(s.beginPath(),Cr(s,Ie(t.x)+l/2,Ie(t.y)+l/2,Ie(t.w)-l,Ie(t.h)-l,e.borderRadius),s.closePath(),a&&(s.fillStyle=a,s.fill()),o&&l&&(s.strokeStyle=o,s.lineWidth=l,s.lineJoin="miter",s.stroke()))}function Ar(s,t,e){var a=e.lineHeight,o=s.w,l=s.x,d=s.y+a/2;return t==="center"?l+=o/2:(t==="end"||t==="right")&&(l+=o),{h:a,w:o,x:l,y:d}}function $r(s,t,e){var a=s.shadowBlur,o=e.stroked,l=Ie(e.x),d=Ie(e.y),c=Ie(e.w);o&&s.strokeText(t,l,d,c),e.filled&&(a&&o&&(s.shadowBlur=0),s.fillText(t,l,d,c),a&&o&&(s.shadowBlur=a))}function Sr(s,t,e,a){var o=a.textAlign,l=a.color,d=!!l,c=a.font,m=t.length,p=a.textStrokeColor,O=a.textStrokeWidth,P=p&&O,re;if(!(!m||!d&&!P))for(e=Ar(e,o,c),s.font=c.string,s.textAlign=o,s.textBaseline="middle",s.shadowBlur=a.textShadowBlur,s.shadowColor=a.textShadowColor,d&&(s.fillStyle=l),P&&(s.lineJoin="round",s.lineWidth=O,s.strokeStyle=p),re=0,m=t.length;re<m;++re)$r(s,t[re],{stroked:P,filled:d,w:e.w,x:e.x,y:e.y+e.h*re})}var Gt=function(s,t,e,a){var o=this;o._config=s,o._index=a,o._model=null,o._rects=null,o._ctx=t,o._el=e};Ze(Gt.prototype,{_modelize:function(s,t,e,a){var o=this,l=o._index,d=Xt(we([e.font,{}],a,l)),c=we([e.color,Jt.color],a,l);return{align:we([e.align,"center"],a,l),anchor:we([e.anchor,"center"],a,l),area:a.chart.chartArea,backgroundColor:we([e.backgroundColor,null],a,l),borderColor:we([e.borderColor,null],a,l),borderRadius:we([e.borderRadius,0],a,l),borderWidth:we([e.borderWidth,0],a,l),clamp:we([e.clamp,!1],a,l),clip:we([e.clip,!1],a,l),color:c,display:s,font:d,lines:t,offset:we([e.offset,4],a,l),opacity:we([e.opacity,1],a,l),origin:wr(o._el,a),padding:Qt(we([e.padding,4],a,l)),positioner:Tr(o._el),rotation:we([e.rotation,0],a,l)*(Math.PI/180),size:ze.textSize(o._ctx,t,d),textAlign:we([e.textAlign,"start"],a,l),textShadowBlur:we([e.textShadowBlur,0],a,l),textShadowColor:we([e.textShadowColor,c],a,l),textStrokeColor:we([e.textStrokeColor,c],a,l),textStrokeWidth:we([e.textStrokeWidth,0],a,l)}},update:function(s){var t=this,e=null,a=null,o=t._index,l=t._config,d,c,m,p=we([l.display,!0],s,o);p&&(d=s.dataset.data[o],c=Zt(Bt(l.formatter,[d,s]),d),m=je(c)?[]:ze.toTextLines(c),m.length&&(e=t._modelize(p,m,l,s),a=_r(e))),t._model=e,t._rects=a},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(s,t){var e=this,a=s.ctx,o=e._model,l=e._rects,d;this.visible()&&(a.save(),o.clip&&(d=o.area,a.beginPath(),a.rect(d.left,d.top,d.right-d.left,d.bottom-d.top),a.clip()),a.globalAlpha=ze.bound(0,o.opacity,1),a.translate(Ie(t.x),Ie(t.y)),a.rotate(o.rotation),Wr(a,l.frame,o),Sr(a,o.lines,l.text,o),a.restore())}});var Dr=Number.MIN_SAFE_INTEGER||-9007199254740991,Er=Number.MAX_SAFE_INTEGER||9007199254740991;function Ye(s,t,e){var a=Math.cos(e),o=Math.sin(e),l=t.x,d=t.y;return{x:l+a*(s.x-l)-o*(s.y-d),y:d+o*(s.x-l)+a*(s.y-d)}}function Dt(s,t){var e=Er,a=Dr,o=t.origin,l,d,c,m,p;for(l=0;l<s.length;++l)d=s[l],c=d.x-o.x,m=d.y-o.y,p=t.vx*c+t.vy*m,e=Math.min(e,p),a=Math.max(a,p);return{min:e,max:a}}function et(s,t){var e=t.x-s.x,a=t.y-s.y,o=Math.sqrt(e*e+a*a);return{vx:(t.x-s.x)/o,vy:(t.y-s.y)/o,origin:s,ln:o}}var Ht=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};Ze(Ht.prototype,{center:function(){var s=this._rect;return{x:s.x+s.w/2,y:s.y+s.h/2}},update:function(s,t,e){this._rotation=e,this._rect={x:t.x+s.x,y:t.y+s.y,w:t.w,h:t.h}},contains:function(s){var t=this,e=1,a=t._rect;return s=Ye(s,t.center(),-t._rotation),!(s.x<a.x-e||s.y<a.y-e||s.x>a.x+a.w+e*2||s.y>a.y+a.h+e*2)},intersects:function(s){var t=this._points(),e=s._points(),a=[et(t[0],t[1]),et(t[0],t[3])],o,l,d;for(this._rotation!==s._rotation&&a.push(et(e[0],e[1]),et(e[0],e[3])),o=0;o<a.length;++o)if(l=Dt(t,a[o]),d=Dt(e,a[o]),l.max<d.min||d.max<l.min)return!1;return!0},_points:function(){var s=this,t=s._rect,e=s._rotation,a=s.center();return[Ye({x:t.x,y:t.y},a,e),Ye({x:t.x+t.w,y:t.y},a,e),Ye({x:t.x+t.w,y:t.y+t.h},a,e),Ye({x:t.x,y:t.y+t.h},a,e)]}});function Vt(s,t,e){var a=t.positioner(s,t),o=a.vx,l=a.vy;if(!o&&!l)return{x:a.x,y:a.y};var d=e.w,c=e.h,m=t.rotation,p=Math.abs(d/2*Math.cos(m))+Math.abs(c/2*Math.sin(m)),O=Math.abs(d/2*Math.sin(m))+Math.abs(c/2*Math.cos(m)),P=1/Math.max(Math.abs(o),Math.abs(l));return p*=o*P,O*=l*P,p+=t.offset*o,O+=t.offset*l,{x:a.x+p,y:a.y+O}}function Nr(s,t){var e,a,o,l;for(e=s.length-1;e>=0;--e)for(o=s[e].$layout,a=e-1;a>=0&&o._visible;--a)l=s[a].$layout,l._visible&&o._box.intersects(l._box)&&t(o,l);return s}function Or(s){var t,e,a,o,l,d,c;for(t=0,e=s.length;t<e;++t)a=s[t],o=a.$layout,o._visible&&(c=new Proxy(a._el,{get:(m,p)=>m.getProps([p],!0)[p]}),l=a.geometry(),d=Vt(c,a.model(),l),o._box.update(d,l,a.rotation()));return Nr(s,function(m,p){var O=m._hidable,P=p._hidable;O&&P||P?p._visible=!1:O&&(m._visible=!1)})}var qe={prepare:function(s){var t=[],e,a,o,l,d;for(e=0,o=s.length;e<o;++e)for(a=0,l=s[e].length;a<l;++a)d=s[e][a],t.push(d),d.$layout={_box:new Ht,_hidable:!1,_visible:!0,_set:e,_idx:d._index};return t.sort(function(c,m){var p=c.$layout,O=m.$layout;return p._idx===O._idx?O._set-p._set:O._idx-p._idx}),this.update(t),t},update:function(s){var t=!1,e,a,o,l,d;for(e=0,a=s.length;e<a;++e)o=s[e],l=o.model(),d=o.$layout,d._hidable=l&&l.display==="auto",d._visible=o.visible(),t|=d._hidable;t&&Or(s)},lookup:function(s,t){var e,a;for(e=s.length-1;e>=0;--e)if(a=s[e].$layout,a&&a._visible&&a._box.contains(t))return s[e];return null},draw:function(s,t){var e,a,o,l,d,c;for(e=0,a=t.length;e<a;++e)o=t[e],l=o.$layout,l._visible&&(d=o.geometry(),c=Vt(o._el,o.model(),d),l._box.update(c,d,o.rotation()),o.draw(s,c))}},Br=function(s){if(je(s))return null;var t=s,e,a,o;if(ar(s))if(!je(s.label))t=s.label;else if(!je(s.r))t=s.r;else for(t="",e=Object.keys(s),o=0,a=e.length;o<a;++o)t+=(o!==0?", ":"")+e[o]+": "+s[e[o]];return""+t},Ir={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:Br,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},Ae="$datalabels",Kt="$default";function Mr(s,t){var e=s.datalabels,a={},o=[],l,d;return e===!1?null:(e===!0&&(e={}),t=Ze({},[t,e]),l=t.labels||{},d=Object.keys(l),delete t.labels,d.length?d.forEach(function(c){l[c]&&o.push(Ze({},[t,l[c],{_key:c}]))}):o.push(t),a=o.reduce(function(c,m){return sr(m.listeners||{},function(p,O){c[O]=c[O]||{},c[O][m._key||Kt]=p}),delete m.listeners,c},{}),{labels:o,listeners:a})}function lt(s,t,e,a){if(t){var o=e.$context,l=e.$groups,d;t[l._set]&&(d=t[l._set][l._key],d&&Bt(d,[o,a])===!0&&(s[Ae]._dirty=!0,e.update(o)))}}function Ur(s,t,e,a,o){var l,d;!e&&!a||(e?a?e!==a&&(d=l=!0):d=!0:l=!0,d&&lt(s,t.leave,e,o),l&&lt(s,t.enter,a,o))}function Rr(s,t){var e=s[Ae],a=e._listeners,o,l;if(!(!a.enter&&!a.leave)){if(t.type==="mousemove")l=qe.lookup(e._labels,t);else if(t.type!=="mouseout")return;o=e._hovered,e._hovered=l,Ur(s,a,o,l,t)}}function Pr(s,t){var e=s[Ae],a=e._listeners.click,o=a&&qe.lookup(e._labels,t);o&&lt(s,a,o,t)}var Yt={id:"datalabels",defaults:Ir,beforeInit:function(s){s[Ae]={_actives:[]}},beforeUpdate:function(s){var t=s[Ae];t._listened=!1,t._listeners={},t._datasets=[],t._labels=[]},afterDatasetUpdate:function(s,t,e){var a=t.index,o=s[Ae],l=o._datasets[a]=[],d=s.isDatasetVisible(a),c=s.data.datasets[a],m=Mr(c,e),p=t.meta.data||[],O=s.ctx,P,re,ee,U,M,T,_,g;for(O.save(),P=0,ee=p.length;P<ee;++P)if(_=p[P],_[Ae]=[],d&&_&&s.getDataVisibility(P)&&!_.skip)for(re=0,U=m.labels.length;re<U;++re)M=m.labels[re],T=M._key,g=new Gt(M,O,_,P),g.$groups={_set:a,_key:T||Kt},g.$context={active:!1,chart:s,dataIndex:P,dataset:c,datasetIndex:a},g.update(g.$context),_[Ae].push(g),l.push(g);O.restore(),Ze(o._listeners,m.listeners,{merger:function(E,B,N){B[E]=B[E]||{},B[E][t.index]=N[E],o._listened=!0}})},afterUpdate:function(s){s[Ae]._labels=qe.prepare(s[Ae]._datasets)},afterDatasetsDraw:function(s){qe.draw(s,s[Ae]._labels)},beforeEvent:function(s,t){if(s[Ae]._listened){var e=t.event;switch(e.type){case"mousemove":case"mouseout":Rr(s,e);break;case"click":Pr(s,e);break}}},afterEvent:function(s){var t=s[Ae],e=t._actives,a=t._actives=s.getActiveElements(),o=ze.arrayDiff(e,a),l,d,c,m,p,O,P;for(l=0,d=o.length;l<d;++l)if(p=o[l],p[1])for(P=p[0].element[Ae]||[],c=0,m=P.length;c<m;++c)O=P[c],O.$context.active=p[1]===1,O.update(O.$context);(t._dirty||o.length)&&(qe.update(t._labels),s.render()),delete t._dirty}};const xr={class:"ac-chart"},Lr={class:"ac-chart__header"},Fr={class:"ac-chart__subtitle"},Gr={class:"ac-chart__controls"},Hr={class:"chart-type-selector"},Vr=["onClick"],Kr={class:"chart-type-icon"},Yr={class:"chart-type-label"},jr={class:"ac-chart__summary"},zr={class:"summary-week-block summary-week-block--current"},qr={class:"summary-week-block__title"},Zr={class:"summary-week-block__title-week"},Xr={key:0,class:"summary-week-block__title-dates"},Jr={class:"summary-week-block__cards"},Qr={class:"summary-card__value-wrapper"},ea={class:"summary-card__value"},ta=["title"],ra={class:"percentage-indicator__arrow"},aa={class:"percentage-indicator__value"},sa={class:"percentage-indicator__label"},oa={class:"summary-card__value-wrapper"},na={class:"summary-card__value-main"},la=["title"],ia={class:"percentage-indicator__arrow"},ca={class:"percentage-indicator__value"},da={class:"percentage-indicator__label"},ua={class:"summary-card__breakdown"},ka={class:"breakdown-item breakdown-item--this-week"},va={class:"breakdown-item__value"},ha={class:"breakdown-item breakdown-item--other-week"},ya={class:"breakdown-item__value"},ma={class:"summary-card__value-wrapper"},pa={class:"summary-card__value-main"},ga=["title"],fa={class:"percentage-indicator__arrow"},ba={class:"percentage-indicator__value"},_a={class:"percentage-indicator__label"},wa={class:"summary-card__breakdown"},Ta={class:"breakdown-item breakdown-item--this-week"},Ca={class:"breakdown-item__value"},Wa={class:"breakdown-item breakdown-item--previous-week"},Aa={class:"breakdown-item__value"},$a={class:"breakdown-item breakdown-item--older"},Sa={class:"breakdown-item__value"},Da={class:"summary-card summary-card--stages"},Ea={class:"summary-card__tags"},Na={key:0,class:"stage-tag stage-tag--empty"},Oa={key:0,class:"summary-week-divider"},Ba={key:1,class:"summary-week-block summary-week-block--previous"},Ia={class:"summary-week-block__title"},Ma={class:"summary-week-block__title-week"},Ua={key:0,class:"summary-week-block__title-dates"},Ra={class:"summary-week-block__cards"},Pa={class:"summary-card__value-wrapper"},xa={class:"summary-card__values-comparison"},La={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},Fa={class:"summary-card__value"},Ga={class:"value-label"},Ha={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},Va={class:"summary-card__value summary-card__value--current-week"},Ka={class:"value-label"},Ya=["title"],ja={class:"percentage-indicator__arrow"},za={class:"percentage-indicator__value"},qa={class:"percentage-indicator__label"},Za={class:"summary-card__value-wrapper"},Xa={class:"summary-card__values-comparison"},Ja={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},Qa={class:"summary-card__value-main"},es={class:"value-label"},ts={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},rs={class:"summary-card__value-main summary-card__value-main--current-week"},as={class:"value-label"},ss=["title"],os={class:"percentage-indicator__arrow"},ns={class:"percentage-indicator__value"},ls={class:"percentage-indicator__label"},is={class:"summary-card__breakdown"},cs={class:"breakdown-item breakdown-item--this-week"},ds={class:"breakdown-item__value"},us={class:"breakdown-item breakdown-item--other-week"},ks={class:"breakdown-item__value"},vs={class:"summary-card__value-wrapper"},hs={class:"summary-card__values-comparison"},ys={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},ms={class:"summary-card__value-main"},ps={class:"value-label"},gs={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},fs={class:"summary-card__value-main summary-card__value-main--current-week"},bs={class:"value-label"},_s=["title"],ws={class:"percentage-indicator__arrow"},Ts={class:"percentage-indicator__value"},Cs={class:"percentage-indicator__label"},Ws={class:"summary-card__breakdown"},As={class:"breakdown-item breakdown-item--this-week"},$s={class:"breakdown-item__value"},Ss={class:"breakdown-item breakdown-item--previous-week"},Ds={class:"breakdown-item__value"},Es={class:"breakdown-item breakdown-item--older"},Ns={class:"breakdown-item__value"},Os={class:"summary-card summary-card--stages summary-card--previous"},Bs={class:"summary-card__tags"},Is={key:0,class:"stage-tag stage-tag--empty"},Ms={class:"ac-chart__body"},Us={key:0,class:"split-charts-container"},Rs={class:"chart-wrapper chart-wrapper--left"},Ps={class:"chart-canvas-wrapper"},xs={class:"chart-wrapper chart-wrapper--right"},Ls={class:"chart-canvas-wrapper"},Fs={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedPreviousWeek:0,carryoverTicketsCreatedOlder:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedPreviousWeek:[0],carryoverCreatedOlder:[0],carryoverCreatedOtherWeek:[0]},stagesByWeek:[],stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(s,{emit:t}){nt.register(Yt);const e=s,a=t,o=q(()=>{var i;const n=((i=e.meta)==null?void 0:i.weeks)||[];return n.length>=2?n[n.length-2]:null}),l=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],d=Q("line"),c={color:"#111827",font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:n=>{var i;return((i=n==null?void 0:n.dataset)==null?void 0:i.borderColor)||"#111827"},borderWidth:1,borderRadius:4,padding:4,offset:8,formatter:n=>n==null||isNaN(n)?"":_(n),display:n=>{var I,F,w,V;if(((F=(I=n==null?void 0:n.chart)==null?void 0:I.config)==null?void 0:F.type)!=="line")return!1;const $=(V=(w=n==null?void 0:n.dataset)==null?void 0:w.data)==null?void 0:V[n.dataIndex];return $!=null&&!isNaN($)&&isFinite($)}};q(()=>{var n;return((n=e.meta)==null?void 0:n.weekNumber)??"‚Äî"});const m=()=>{var i,$;const n=((i=e.meta)==null?void 0:i.weeks)||[];return n.length>0?n.map(I=>`–ù–µ–¥–µ–ª—è ${I.weekNumber}`):[($=e.meta)!=null&&$.weekNumber?`–ù–µ–¥–µ–ª—è ${e.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"]};function p(n,i,$,I=.3,F=0){if(!i)return((b,k)=>{const K=parseInt(b.slice(1,3),16),u=parseInt(b.slice(3,5),16),v=parseInt(b.slice(5,7),16);return`rgba(${K}, ${u}, ${v}, ${k})`})($,I);const w=(oe,b)=>{const k=parseInt(oe.slice(1,3),16),K=parseInt(oe.slice(3,5),16),u=parseInt(oe.slice(5,7),16);return`rgba(${k}, ${K}, ${u}, ${b})`},V=n.createLinearGradient(0,i.bottom,0,i.top);return V.addColorStop(0,w($,I)),V.addColorStop(1,w($,F)),V}const O=q(()=>{var w,V,oe,b;const n=m(),i=Array.isArray((w=e.data.series)==null?void 0:w.new)&&e.data.series.new.length>0?e.data.series.new:[e.data.newTickets??0],$=Array.isArray((V=e.data.series)==null?void 0:V.closed)&&e.data.series.closed.length>0?e.data.series.closed:[e.data.closedTickets??0],I=Array.isArray((oe=e.data.series)==null?void 0:oe.closedCreatedThisWeek)&&e.data.series.closedCreatedThisWeek.length>0?e.data.series.closedCreatedThisWeek:[e.data.closedTicketsCreatedThisWeek??0],F=Array.isArray((b=e.data.series)==null?void 0:b.closedCreatedOtherWeek)&&e.data.series.closedCreatedOtherWeek.length>0?e.data.series.closedCreatedOtherWeek:[e.data.closedTicketsCreatedOtherWeek??0];return{labels:n,datasets:[{label:"–ù–æ–≤—ã–µ",data:i,backgroundColor:k=>{const K=k.chart,{ctx:u,chartArea:v}=K;return p(u,v,W.primary)},borderColor:W.primary,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:W.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.primary,pointBackgroundColor:W.primary,datalabels:{...c,anchor:"end",align:"top",offset:10,color:W.primary,borderColor:W.primary}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:$,backgroundColor:k=>{const K=k.chart,{ctx:u,chartArea:v}=K;return p(u,v,W.success)},borderColor:W.success,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:W.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.success,pointBackgroundColor:W.success,datalabels:{...c,anchor:"start",align:"bottom",offset:10,color:W.success,borderColor:W.success}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:I,backgroundColor:W.successLight,borderColor:W.successLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:W.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.successLight,pointBackgroundColor:W.successLight,datalabels:{...c,anchor:"end",align:"bottom",offset:8,color:W.successLight,borderColor:W.successLight}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:F,backgroundColor:W.warning,borderColor:W.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:W.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.warning,pointBackgroundColor:W.warning,datalabels:{...c,anchor:"end",align:"bottom",offset:8,color:W.warning,borderColor:W.warning}}]}}),P=q(()=>{var w,V,oe,b,k;const n=m(),i=Array.isArray((w=e.data.series)==null?void 0:w.carryover)&&e.data.series.carryover.length>0?e.data.series.carryover:[e.data.carryoverTickets??0],$=Array.isArray((V=e.data.series)==null?void 0:V.carryoverCreatedThisWeek)&&e.data.series.carryoverCreatedThisWeek.length>0?e.data.series.carryoverCreatedThisWeek:[e.data.carryoverTicketsCreatedThisWeek??0],I=Array.isArray((oe=e.data.series)==null?void 0:oe.carryoverCreatedPreviousWeek)&&e.data.series.carryoverCreatedPreviousWeek.length>0?e.data.series.carryoverCreatedPreviousWeek:[e.data.carryoverTicketsCreatedPreviousWeek??0],F=Array.isArray((b=e.data.series)==null?void 0:b.carryoverCreatedOlder)&&e.data.series.carryoverCreatedOlder.length>0?e.data.series.carryoverCreatedOlder:[e.data.carryoverTicketsCreatedOlder??0];return Array.isArray((k=e.data.series)==null?void 0:k.carryoverCreatedOtherWeek)&&e.data.series.carryoverCreatedOtherWeek.length>0?e.data.series.carryoverCreatedOtherWeek:e.data.carryoverTicketsCreatedOtherWeek,{labels:n,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:i,backgroundColor:K=>{const u=K.chart,{ctx:v,chartArea:Y}=u;return p(v,Y,W.carryover)},borderColor:W.carryover,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:W.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.carryover,pointBackgroundColor:W.carryover,datalabels:{...c,anchor:"end",align:"top",offset:4,color:W.carryover,borderColor:W.carryover}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:$,backgroundColor:W.carryoverLight,borderColor:W.carryoverLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:W.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.carryoverLight,pointBackgroundColor:W.carryoverLight,datalabels:{...c,anchor:"end",align:"top",offset:6,color:W.carryoverLight,borderColor:W.carryoverLight}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π)",data:I,backgroundColor:W.warning,borderColor:W.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:W.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.warning,pointBackgroundColor:W.warning,datalabels:{...c,anchor:"end",align:"top",offset:6,color:W.warning,borderColor:W.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –Ω–µ–¥–µ–ª—è–º–∏)",data:F,backgroundColor:W.carryoverDark,borderColor:W.carryoverDark,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:W.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.carryoverDark,pointBackgroundColor:W.carryoverDark,datalabels:{...c,anchor:"end",align:"top",offset:6,color:W.carryoverDark,borderColor:W.carryoverDark}}]}}),re=q(()=>{var K,u,v,Y,te,le,se,j,C,ie,he;const n=((K=e.meta)==null?void 0:K.weeks)||[],i=n.length>0?n.map(de=>`–ù–µ–¥–µ–ª—è ${de.weekNumber}`):[(u=e.meta)!=null&&u.weekNumber?`–ù–µ–¥–µ–ª—è ${e.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"],$=Array.isArray((v=e.data.series)==null?void 0:v.new)&&e.data.series.new.length>0?e.data.series.new:[e.data.newTickets??0],I=Array.isArray((Y=e.data.series)==null?void 0:Y.closed)&&e.data.series.closed.length>0?e.data.series.closed:[e.data.closedTickets??0],F=Array.isArray((te=e.data.series)==null?void 0:te.closedCreatedThisWeek)&&e.data.series.closedCreatedThisWeek.length>0?e.data.series.closedCreatedThisWeek:[e.data.closedTicketsCreatedThisWeek??0],w=Array.isArray((le=e.data.series)==null?void 0:le.closedCreatedOtherWeek)&&e.data.series.closedCreatedOtherWeek.length>0?e.data.series.closedCreatedOtherWeek:[e.data.closedTicketsCreatedOtherWeek??0],V=Array.isArray((se=e.data.series)==null?void 0:se.carryover)&&e.data.series.carryover.length>0?e.data.series.carryover:[e.data.carryoverTickets??0],oe=Array.isArray((j=e.data.series)==null?void 0:j.carryoverCreatedThisWeek)&&e.data.series.carryoverCreatedThisWeek.length>0?e.data.series.carryoverCreatedThisWeek:[e.data.carryoverTicketsCreatedThisWeek??0],b=Array.isArray((C=e.data.series)==null?void 0:C.carryoverCreatedPreviousWeek)&&e.data.series.carryoverCreatedPreviousWeek.length>0?e.data.series.carryoverCreatedPreviousWeek:[e.data.carryoverTicketsCreatedPreviousWeek??0],k=Array.isArray((ie=e.data.series)==null?void 0:ie.carryoverCreatedOlder)&&e.data.series.carryoverCreatedOlder.length>0?e.data.series.carryoverCreatedOlder:[e.data.carryoverTicketsCreatedOlder??0];return Array.isArray((he=e.data.series)==null?void 0:he.carryoverCreatedOtherWeek)&&e.data.series.carryoverCreatedOtherWeek.length>0?e.data.series.carryoverCreatedOtherWeek:e.data.carryoverTicketsCreatedOtherWeek,{labels:i,datasets:[{label:"–ù–æ–≤—ã–µ",data:$,backgroundColor:W.primary,borderColor:W.primary,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:W.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.primary,pointBackgroundColor:W.primary,datalabels:{...c,anchor:"end",align:"top",offset:10,color:W.primary,borderColor:W.primary}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:I,backgroundColor:W.success,borderColor:W.success,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:W.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.success,pointBackgroundColor:W.success,datalabels:{...c,anchor:"start",align:"bottom",offset:10,color:W.success,borderColor:W.success}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:F,backgroundColor:W.successLight,borderColor:W.successLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:W.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.successLight,pointBackgroundColor:W.successLight,datalabels:{...c,anchor:"end",align:"bottom",offset:8,color:W.successLight,borderColor:W.successLight}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:w,backgroundColor:W.warning,borderColor:W.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:W.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.warning,pointBackgroundColor:W.warning,datalabels:{...c,anchor:"end",align:"bottom",offset:8,color:W.warning,borderColor:W.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:V,backgroundColor:W.carryover,borderColor:W.carryover,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:W.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.carryover,pointBackgroundColor:W.carryover,datalabels:{...c,anchor:"end",align:"top",offset:4,color:W.carryover,borderColor:W.carryover}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:oe,backgroundColor:W.carryoverLight,borderColor:W.carryoverLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:W.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.carryoverLight,pointBackgroundColor:W.carryoverLight,datalabels:{...c,anchor:"end",align:"top",offset:6,color:W.carryoverLight,borderColor:W.carryoverLight}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π)",data:b,backgroundColor:W.warning,borderColor:W.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:W.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.warning,pointBackgroundColor:W.warning,datalabels:{...c,anchor:"end",align:"top",offset:6,color:W.warning,borderColor:W.warning}},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –Ω–µ–¥–µ–ª—è–º–∏)",data:k,backgroundColor:W.carryoverDark,borderColor:W.carryoverDark,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:W.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:W.carryoverDark,pointBackgroundColor:W.carryoverDark,datalabels:{...c,anchor:"end",align:"top",offset:6,color:W.carryoverDark,borderColor:W.carryoverDark}}]}}),ee=q(()=>({labels:["–ù–æ–≤—ã–µ","–ó–∞–∫—Ä—ã—Ç—ã–µ","–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ"],datasets:[{data:[e.data.newTickets??0,e.data.closedTickets??0,e.data.carryoverTickets??0],backgroundColor:[W.primary,W.success,W.carryover],borderWidth:1}]})),U=q(()=>{switch(d.value){case"line":return Fe;case"bar":return cr;case"doughnut":return ir;default:return Fe}}),M=q(()=>d.value==="doughnut"?ee.value:re.value),T=n=>{if(!n)return"‚Äî";try{return new Date(n).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return n}};function _(n){return n==null||isNaN(n)?"0":n>=1e3?n.toLocaleString("ru-RU"):n.toString()}function g(n){const i=n%10,$=n%100;return $>=11&&$<=14?"—Ç–∏–∫–µ—Ç–æ–≤":i===1?"—Ç–∏–∫–µ—Ç":i>=2&&i<=4?"—Ç–∏–∫–µ—Ç–∞":"—Ç–∏–∫–µ—Ç–æ–≤"}const E=q(()=>({responsive:!0,maintainAspectRatio:!1,resizeDelay:0,animation:{duration:800,easing:"easeOutQuart"},interaction:{intersect:!1,mode:"index"},plugins:{datalabels:{...c,anchor:"end",align:"top"},tooltip:{enabled:!0,backgroundColor:"rgba(255, 255, 255, 0.98)",titleColor:"#111827",bodyColor:"#374151",borderColor:"#e5e7eb",borderWidth:1,cornerRadius:8,padding:16,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},displayColors:!0,boxPadding:6,usePointStyle:!0,animation:{duration:300,easing:"easeOutQuart"},callbacks:{title:n=>{var V,oe,b,k,K,u;if(!n||n.length===0)return"";const i=(V=n[0])==null?void 0:V.dataIndex,$=((oe=e.meta)==null?void 0:oe.weeks)||[];if($.length>0&&i!==void 0&&$[i]){const v=$[i];return`–ù–µ–¥–µ–ª—è ${v.weekNumber} (${T(v.weekStartUtc)} ‚Äî ${T(v.weekEndUtc)})`}const I=(b=e.meta)==null?void 0:b.weekNumber,F=(k=e.meta)==null?void 0:k.weekStartUtc,w=(K=e.meta)==null?void 0:K.weekEndUtc;return I&&F&&w?`–ù–µ–¥–µ–ª—è ${I} (${T(F)} ‚Äî ${T(w)})`:((u=n[0])==null?void 0:u.label)||""},label:n=>{const i=n.parsed.y,$=n.dataset.label||"";if(i==null||isNaN(i))return`${$}: 0 —Ç–∏–∫–µ—Ç–æ–≤`;const I=_(i),F=g(i);return`${$}: ${I} ${F}`}}},legend:{position:"bottom",labels:{font:{size:13,weight:"500"},padding:12,boxWidth:18,boxHeight:12,usePointStyle:!0,pointStyle:"circle",generateLabels:n=>nt.defaults.plugins.legend.labels.generateLabels(n).map(($,I)=>{const F=n.data.datasets[I],w=n.getDatasetMeta(I),V=F.borderDash&&Array.isArray(F.borderDash)&&F.borderDash.length>0||F.borderWidth===2||F.fill===!1;return w.hidden?($.fontColor="#9ca3af",$.textDecoration="line-through",$.opacity=.5):V?$.fontColor="#6b7280":$.fontColor="#111827",$})},onClick:(n,i)=>{const $=i.datasetIndex;if($==null){console.warn("[Legend] Invalid datasetIndex:",$);return}const I=n.chart;if(!I){console.warn("[Legend] Chart not found");return}const F=I.getDatasetMeta($);if(!F){console.warn("[Legend] Dataset meta not found for index:",$);return}F.hidden=!F.hidden,I.update("active")},onHover:(n,i)=>{n.native&&n.native.target&&(n.native.target.style.cursor="pointer")},onLeave:(n,i)=>{n.native&&n.native.target&&(n.native.target.style.cursor="default")}}},scales:d.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10,color:"#374151",callback:n=>n==null||isNaN(n)?"0":_(n)},title:{display:!1},grid:{color:n=>{if(!n||!n.tick||n.tick.value===void 0)return"#e5e7eb";const i=n.tick.value;return isNaN(i)||!isFinite(i)?"#e5e7eb":i===0||i%5===0?"#d1d5db":"#e5e7eb"},lineWidth:n=>{if(!n||!n.tick||n.tick.value===void 0)return 1;const i=n.tick.value;return isNaN(i)||!isFinite(i)?1:i===0||i%5===0?1.5:1}}},x:{ticks:{maxRotation:45,minRotation:45,font:{size:14},padding:10,color:"#374151"},title:{display:!1},grid:{color:"#e5e7eb",lineWidth:1}}}})),B=q(()=>{var n,i,$,I,F,w,V,oe;if((n=e.data)!=null&&n.series){const b=e.data.series,k=Math.max((Array.isArray(b.new)?b.new.length:0)-1,(Array.isArray(b.closed)?b.closed.length:0)-1,(Array.isArray(b.closedCreatedThisWeek)?b.closedCreatedThisWeek.length:0)-1,(Array.isArray(b.closedCreatedOtherWeek)?b.closedCreatedOtherWeek.length:0)-1,(Array.isArray(b.carryover)?b.carryover.length:0)-1,(Array.isArray(b.carryoverCreatedThisWeek)?b.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(b.carryoverCreatedPreviousWeek)?b.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(b.carryoverCreatedOlder)?b.carryoverCreatedOlder.length:0)-1,(Array.isArray(b.carryoverCreatedOtherWeek)?b.carryoverCreatedOtherWeek.length:0)-1,-1);if(k>=0){const K={newTickets:Array.isArray(b.new)&&b.new[k]!==void 0?b.new[k]:0,closedTickets:Array.isArray(b.closed)&&b.closed[k]!==void 0?b.closed[k]:0,closedTicketsCreatedThisWeek:Array.isArray(b.closedCreatedThisWeek)&&b.closedCreatedThisWeek[k]!==void 0?b.closedCreatedThisWeek[k]:0,closedTicketsCreatedOtherWeek:Array.isArray(b.closedCreatedOtherWeek)&&b.closedCreatedOtherWeek[k]!==void 0?b.closedCreatedOtherWeek[k]:0,carryoverTickets:Array.isArray(b.carryover)&&b.carryover[k]!==void 0?b.carryover[k]:0,carryoverTicketsCreatedThisWeek:Array.isArray(b.carryoverCreatedThisWeek)&&b.carryoverCreatedThisWeek[k]!==void 0?b.carryoverCreatedThisWeek[k]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(b.carryoverCreatedPreviousWeek)&&b.carryoverCreatedPreviousWeek[k]!==void 0?b.carryoverCreatedPreviousWeek[k]:0,carryoverTicketsCreatedOlder:Array.isArray(b.carryoverCreatedOlder)&&b.carryoverCreatedOlder[k]!==void 0?b.carryoverCreatedOlder[k]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(b.carryoverCreatedOtherWeek)&&b.carryoverCreatedOtherWeek[k]!==void 0?b.carryoverCreatedOtherWeek[k]:0};if(K.carryoverTickets>0&&console.log("[DEBUG currentWeekData]",{total:K.carryoverTickets,thisWeek:K.carryoverTicketsCreatedThisWeek,previousWeek:K.carryoverTicketsCreatedPreviousWeek,older:K.carryoverTicketsCreatedOlder,otherWeek:K.carryoverTicketsCreatedOtherWeek,sum:K.carryoverTicketsCreatedThisWeek+K.carryoverTicketsCreatedPreviousWeek+K.carryoverTicketsCreatedOlder,lastIndex:k,series:{carryoverCreatedPreviousWeek:b.carryoverCreatedPreviousWeek,carryoverCreatedOlder:b.carryoverCreatedOlder,carryoverCreatedPreviousWeekLength:(i=b.carryoverCreatedPreviousWeek)==null?void 0:i.length,carryoverCreatedOlderLength:($=b.carryoverCreatedOlder)==null?void 0:$.length,carryoverCreatedPreviousWeekLast:(I=b.carryoverCreatedPreviousWeek)==null?void 0:I[k],carryoverCreatedOlderLast:(F=b.carryoverCreatedOlder)==null?void 0:F[k]},currentWeek:e.data.currentWeek,data:{carryoverTicketsCreatedPreviousWeek:e.data.carryoverTicketsCreatedPreviousWeek,carryoverTicketsCreatedOlder:e.data.carryoverTicketsCreatedOlder}}),K.newTickets>0||K.closedTickets>0||K.carryoverTickets>0)return K}}if((w=e.data)!=null&&w.currentWeek&&typeof e.data.currentWeek=="object"){const b=e.data.currentWeek;if((b.newTickets??0)>0||(b.closedTickets??0)>0||(b.carryoverTickets??0)>0)return b}if((V=e.data)!=null&&V.weeksData&&Array.isArray(e.data.weeksData)&&e.data.weeksData.length>0){const b=e.data.weeksData[e.data.weeksData.length-1];if((b.newTickets??0)>0||(b.closedTickets??0)>0||(b.carryoverTickets??0)>0)return b}if((oe=e.data)!=null&&oe.series){const b=e.data.series,k=Math.max((Array.isArray(b.new)?b.new.length:0)-1,(Array.isArray(b.closed)?b.closed.length:0)-1,(Array.isArray(b.carryover)?b.carryover.length:0)-1,-1);if(k>=0)return{newTickets:Array.isArray(b.new)&&b.new[k]!==void 0?b.new[k]:0,closedTickets:Array.isArray(b.closed)&&b.closed[k]!==void 0?b.closed[k]:0,closedTicketsCreatedThisWeek:Array.isArray(b.closedCreatedThisWeek)&&b.closedCreatedThisWeek[k]!==void 0?b.closedCreatedThisWeek[k]:0,closedTicketsCreatedOtherWeek:Array.isArray(b.closedCreatedOtherWeek)&&b.closedCreatedOtherWeek[k]!==void 0?b.closedCreatedOtherWeek[k]:0,carryoverTickets:Array.isArray(b.carryover)&&b.carryover[k]!==void 0?b.carryover[k]:0,carryoverTicketsCreatedThisWeek:Array.isArray(b.carryoverCreatedThisWeek)&&b.carryoverCreatedThisWeek[k]!==void 0?b.carryoverCreatedThisWeek[k]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(b.carryoverCreatedPreviousWeek)&&b.carryoverCreatedPreviousWeek[k]!==void 0?b.carryoverCreatedPreviousWeek[k]:0,carryoverTicketsCreatedOlder:Array.isArray(b.carryoverCreatedOlder)&&b.carryoverCreatedOlder[k]!==void 0?b.carryoverCreatedOlder[k]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(b.carryoverCreatedOtherWeek)&&b.carryoverCreatedOtherWeek[k]!==void 0?b.carryoverCreatedOtherWeek[k]:0}}return e.data||{}}),N=q(()=>{var i,$,I,F,w,V,oe,b,k,K;const n=((i=e.meta)==null?void 0:i.weeks)||[];return n.length>0?n[n.length-1]:{weekNumber:((I=($=e.meta)==null?void 0:$.currentWeek)==null?void 0:I.weekNumber)??((F=e.meta)==null?void 0:F.weekNumber)??null,weekStartUtc:((V=(w=e.meta)==null?void 0:w.currentWeek)==null?void 0:V.weekStartUtc)??((oe=e.meta)==null?void 0:oe.weekStartUtc)??null,weekEndUtc:((k=(b=e.meta)==null?void 0:b.currentWeek)==null?void 0:k.weekEndUtc)??((K=e.meta)==null?void 0:K.weekEndUtc)??null}}),h=q(()=>{var n,i,$,I,F,w,V,oe,b;if((n=e.data)!=null&&n.series){const k=e.data.series,K=Math.max((Array.isArray(k.new)?k.new.length:0)-1,(Array.isArray(k.closed)?k.closed.length:0)-1,(Array.isArray(k.closedCreatedThisWeek)?k.closedCreatedThisWeek.length:0)-1,(Array.isArray(k.closedCreatedOtherWeek)?k.closedCreatedOtherWeek.length:0)-1,(Array.isArray(k.carryover)?k.carryover.length:0)-1,(Array.isArray(k.carryoverCreatedThisWeek)?k.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(k.carryoverCreatedPreviousWeek)?k.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(k.carryoverCreatedOlder)?k.carryoverCreatedOlder.length:0)-1,(Array.isArray(k.carryoverCreatedOtherWeek)?k.carryoverCreatedOtherWeek.length:0)-1,-1);if(K>=1){const u=K-1,v=($=(i=e.meta)==null?void 0:i.weeks)==null?void 0:$[u],Y={weekNumber:(v==null?void 0:v.weekNumber)??null,weekStartUtc:(v==null?void 0:v.weekStartUtc)??null,weekEndUtc:(v==null?void 0:v.weekEndUtc)??null,newTickets:Array.isArray(k.new)&&k.new[u]!==void 0?k.new[u]:0,closedTickets:Array.isArray(k.closed)&&k.closed[u]!==void 0?k.closed[u]:0,closedTicketsCreatedThisWeek:Array.isArray(k.closedCreatedThisWeek)&&k.closedCreatedThisWeek[u]!==void 0?k.closedCreatedThisWeek[u]:0,closedTicketsCreatedOtherWeek:Array.isArray(k.closedCreatedOtherWeek)&&k.closedCreatedOtherWeek[u]!==void 0?k.closedCreatedOtherWeek[u]:0,carryoverTickets:Array.isArray(k.carryover)&&k.carryover[u]!==void 0?k.carryover[u]:0,carryoverTicketsCreatedThisWeek:Array.isArray(k.carryoverCreatedThisWeek)&&k.carryoverCreatedThisWeek[u]!==void 0?k.carryoverCreatedThisWeek[u]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(k.carryoverCreatedPreviousWeek)&&k.carryoverCreatedPreviousWeek[u]!==void 0?k.carryoverCreatedPreviousWeek[u]:0,carryoverTicketsCreatedOlder:Array.isArray(k.carryoverCreatedOlder)&&k.carryoverCreatedOlder[u]!==void 0?k.carryoverCreatedOlder[u]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(k.carryoverCreatedOtherWeek)&&k.carryoverCreatedOtherWeek[u]!==void 0?k.carryoverCreatedOtherWeek[u]:0};if(Y.newTickets>0||Y.closedTickets>0||Y.carryoverTickets>0)return Y}}if((I=e.data)!=null&&I.weeksData&&Array.isArray(e.data.weeksData)&&e.data.weeksData.length>=2){const k=e.data.weeksData.length-2,K=e.data.weeksData[k],u=(w=(F=e.meta)==null?void 0:F.weeks)==null?void 0:w[k];if((K.newTickets??0)>0||(K.closedTickets??0)>0||(K.carryoverTickets??0)>0)return{weekNumber:K.weekNumber??(u==null?void 0:u.weekNumber)??null,weekStartUtc:(u==null?void 0:u.weekStartUtc)??null,weekEndUtc:(u==null?void 0:u.weekEndUtc)??null,newTickets:K.newTickets??0,closedTickets:K.closedTickets??0,closedTicketsCreatedThisWeek:K.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:K.closedTicketsCreatedOtherWeek??0,carryoverTickets:K.carryoverTickets??0,carryoverTicketsCreatedThisWeek:K.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:K.carryoverTicketsCreatedOtherWeek??0}}if((V=e.data)!=null&&V.series){const k=e.data.series,K=Math.max((Array.isArray(k.new)?k.new.length:0)-1,(Array.isArray(k.closed)?k.closed.length:0)-1,(Array.isArray(k.carryover)?k.carryover.length:0)-1,-1);if(K>=1){const u=K-1,v=(b=(oe=e.meta)==null?void 0:oe.weeks)==null?void 0:b[u];return{weekNumber:(v==null?void 0:v.weekNumber)??null,weekStartUtc:(v==null?void 0:v.weekStartUtc)??null,weekEndUtc:(v==null?void 0:v.weekEndUtc)??null,newTickets:Array.isArray(k.new)&&k.new[u]!==void 0?k.new[u]:0,closedTickets:Array.isArray(k.closed)&&k.closed[u]!==void 0?k.closed[u]:0,closedTicketsCreatedThisWeek:Array.isArray(k.closedCreatedThisWeek)&&k.closedCreatedThisWeek[u]!==void 0?k.closedCreatedThisWeek[u]:0,closedTicketsCreatedOtherWeek:Array.isArray(k.closedCreatedOtherWeek)&&k.closedCreatedOtherWeek[u]!==void 0?k.closedCreatedOtherWeek[u]:0,carryoverTickets:Array.isArray(k.carryover)&&k.carryover[u]!==void 0?k.carryover[u]:0,carryoverTicketsCreatedThisWeek:Array.isArray(k.carryoverCreatedThisWeek)&&k.carryoverCreatedThisWeek[u]!==void 0?k.carryoverCreatedThisWeek[u]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(k.carryoverCreatedPreviousWeek)&&k.carryoverCreatedPreviousWeek[u]!==void 0?k.carryoverCreatedPreviousWeek[u]:0,carryoverTicketsCreatedOlder:Array.isArray(k.carryoverCreatedOlder)&&k.carryoverCreatedOlder[u]!==void 0?k.carryoverCreatedOlder[u]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(k.carryoverCreatedOtherWeek)&&k.carryoverCreatedOtherWeek[u]!==void 0?k.carryoverCreatedOtherWeek[u]:0}}}return null}),x=q(()=>{var i;const n=(i=e.data)==null?void 0:i.stagesByWeek;return Array.isArray(n)?n:null}),D=q(()=>{var i;const n=x.value;if(n&&n.length>0){const $=n.length-1,I=n[$];if(Array.isArray(I))return I}return((i=e.data)==null?void 0:i.stages)??[]}),R=q(()=>{const n=x.value;if(n&&n.length>=2){const i=n.length-2,$=n[i];if(Array.isArray($))return $}return[]}),G=q(()=>{var n;return(n=h.value)!=null&&n.weekNumber?`–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–µ–¥–µ–ª–∏ ${h.value.weekNumber}`:"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"});function H(n,i){if(typeof n!="number"||isNaN(n)||i==null||typeof i!="number"||isNaN(i)||i===0)return null;if(n===i)return 0;const $=(n-i)/i*100;return!isFinite($)||isNaN($)?null:$}function L(n){return n==null||isNaN(n)?"":`${n>=0?"+":""}${n.toFixed(1)}%`}const X=q(()=>{var n,i,$;if((n=e.data)!=null&&n.series){const I=e.data.series,F=Math.max((Array.isArray(I.new)?I.new.length:0)-1,(Array.isArray(I.closed)?I.closed.length:0)-1,(Array.isArray(I.carryover)?I.carryover.length:0)-1,-1);if(F>=2){const w=F-2,V=($=(i=e.meta)==null?void 0:i.weeks)==null?void 0:$[w];return{weekNumber:(V==null?void 0:V.weekNumber)??null,newTickets:Array.isArray(I.new)&&I.new[w]!==void 0?I.new[w]:0,closedTickets:Array.isArray(I.closed)&&I.closed[w]!==void 0?I.closed[w]:0,carryoverTickets:Array.isArray(I.carryover)&&I.carryover[w]!==void 0?I.carryover[w]:0}}}return null}),Z=q(()=>{const n=B.value,i=h.value;return!n||!i?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:H(n.newTickets??0,i.newTickets??0),closedTickets:H(n.closedTickets??0,i.closedTickets??0),carryoverTickets:H(n.carryoverTickets??0,i.carryoverTickets??0)}}),ae=q(()=>{const n=h.value,i=X.value;return!n||!i?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:H(n.newTickets??0,i.newTickets??0),closedTickets:H(n.closedTickets??0,i.closedTickets??0),carryoverTickets:H(n.carryoverTickets??0,i.carryoverTickets??0)}});function ve(n,i){if(!n||!i)return"";try{const $=new Date(n),I=new Date(i),F=$.getUTCDate(),w=$.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),V=$.getUTCFullYear(),oe=I.getUTCDate(),b=I.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),k=I.getUTCFullYear();return V===k&&w===b?`${F} ‚Äî ${oe} ${w}`:V===k?`${F} ${w} ‚Äî ${oe} ${b}`:`${F} ${w} ${V} ‚Äî ${oe} ${b} ${k}`}catch($){return console.error("[formatWeekDates] Error:",$),""}}const fe=n=>{const i=B.value,$=(i==null?void 0:i.newTickets)??0,I=(i==null?void 0:i.closedTickets)??0,F=(i==null?void 0:i.carryoverTickets)??0,w=N.value;n==="new"&&$>0?a("open-stages",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc}):n==="closed"&&I>0?a("open-responsible",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc}):n==="carryover"&&F>0&&a("open-carryover",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc})},S=n=>{const i=h.value;if(!i)return;const $=(i==null?void 0:i.newTickets)??0,I=(i==null?void 0:i.closedTickets)??0,F=(i==null?void 0:i.carryoverTickets)??0,w=o.value;w&&(n==="new"&&$>0?a("open-stages",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc}):n==="closed"&&I>0?a("open-responsible",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc}):n==="carryover"&&F>0&&a("open-carryover",{weekNumber:w.weekNumber,weekStartUtc:w.weekStartUtc,weekEndUtc:w.weekEndUtc}))};return(n,i)=>{var $,I,F,w,V,oe,b,k,K,u,v,Y,te,le,se,j,C,ie,he,de,z,_e,Se,De,Ce,J,ce,ue,We,Pe,xe,Ke,ut,kt,vt,ht,yt,mt,pt,gt,ft,bt,_t,wt,Tt,Ct;return y(),f("div",xr,[r("header",Lr,[r("div",null,[i[6]||(i[6]=r("h2",{class:"ac-chart__title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),r("p",Fr," –ù–µ–¥–µ–ª—è "+A(((I=($=s.meta)==null?void 0:$.currentWeek)==null?void 0:I.weekNumber)??((F=s.meta)==null?void 0:F.weekNumber)??"‚Äî")+" ¬∑ "+A((((V=(w=s.meta)==null?void 0:w.currentWeek)==null?void 0:V.weekStartUtc)??((oe=s.meta)==null?void 0:oe.weekStartUtc))||"‚Äî")+" ‚Äî "+A((((k=(b=s.meta)==null?void 0:b.currentWeek)==null?void 0:k.weekEndUtc)??((K=s.meta)==null?void 0:K.weekEndUtc))||"‚Äî")+" (UTC) ",1)]),r("div",Gr,[r("div",Hr,[(y(),f(ye,null,me(l,be=>r("button",{key:be.value,class:pe(["chart-type-btn",{active:d.value===be.value}]),onClick:Pc=>d.value=be.value},[r("span",Kr,A(be.icon),1),r("span",Yr,A(be.label),1)],10,Vr)),64))])])]),r("section",jr,[r("div",zr,[r("h3",qr,[i[7]||(i[7]=r("span",{class:"summary-week-block__title-text"},"–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)),r("span",Zr," –ù–µ–¥–µ–ª—è "+A(N.value.weekNumber??"‚Äî"),1),N.value.weekStartUtc?(y(),f("span",Xr,A(ve(N.value.weekStartUtc,N.value.weekEndUtc)),1)):ne("",!0)]),r("div",Jr,[r("div",{class:"summary-card summary-card--new",onClick:i[0]||(i[0]=be=>fe("new"))},[i[8]||(i[8]=r("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),r("div",Qr,[r("div",ea,A(((u=B.value)==null?void 0:u.newTickets)??0),1),Z.value.newTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",Z.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((v=h.value)==null?void 0:v.weekNumber)??"‚Äî"}): ${L(Z.value.newTickets)}`},[r("span",ra,A(Z.value.newTickets>=0?"‚Üë":"‚Üì"),1),r("span",aa,A(L(Z.value.newTickets)),1),r("span",sa,"–∫ –Ω–µ–¥–µ–ª–µ "+A(((Y=h.value)==null?void 0:Y.weekNumber)??"‚Äî"),1)],10,ta)):ne("",!0)])]),r("div",{class:"summary-card summary-card--closed-breakdown",onClick:i[1]||(i[1]=be=>fe("closed"))},[i[13]||(i[13]=r("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),r("div",oa,[r("div",na,A(((te=B.value)==null?void 0:te.closedTickets)??0),1),Z.value.closedTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",Z.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((le=h.value)==null?void 0:le.weekNumber)??"‚Äî"}): ${L(Z.value.closedTickets)}`},[r("span",ia,A(Z.value.closedTickets>=0?"‚Üë":"‚Üì"),1),r("span",ca,A(L(Z.value.closedTickets)),1),r("span",da,"–∫ –Ω–µ–¥–µ–ª–µ "+A(((se=h.value)==null?void 0:se.weekNumber)??"‚Äî"),1)],10,la)):ne("",!0)]),r("div",ua,[r("div",ka,[i[9]||(i[9]=r("span",{class:"breakdown-item__icon"},"‚úì",-1)),r("span",va,A(((j=B.value)==null?void 0:j.closedTicketsCreatedThisWeek)??0),1),i[10]||(i[10]=r("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),r("div",ha,[i[11]||(i[11]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",ya,A(((C=B.value)==null?void 0:C.closedTicketsCreatedOtherWeek)??0),1),i[12]||(i[12]=r("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),r("div",{class:"summary-card summary-card--carryover-breakdown",onClick:i[2]||(i[2]=be=>fe("carryover"))},[i[20]||(i[20]=r("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),r("div",ma,[r("div",pa,A(((ie=B.value)==null?void 0:ie.carryoverTickets)??0),1),Z.value.carryoverTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",Z.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((he=h.value)==null?void 0:he.weekNumber)??"‚Äî"}): ${L(Z.value.carryoverTickets)}`},[r("span",fa,A(Z.value.carryoverTickets>=0?"‚Üë":"‚Üì"),1),r("span",ba,A(L(Z.value.carryoverTickets)),1),r("span",_a,"–∫ –Ω–µ–¥–µ–ª–µ "+A(((de=h.value)==null?void 0:de.weekNumber)??"‚Äî"),1)],10,ga)):ne("",!0)]),r("div",wa,[r("div",Ta,[i[14]||(i[14]=r("span",{class:"breakdown-item__icon"},"‚úì",-1)),r("span",Ca,A(((z=B.value)==null?void 0:z.carryoverTicketsCreatedThisWeek)??0),1),i[15]||(i[15]=r("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),r("div",Wa,[i[16]||(i[16]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",Aa,A(((_e=B.value)==null?void 0:_e.carryoverTicketsCreatedPreviousWeek)??0),1),i[17]||(i[17]=r("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏",-1))]),r("div",$a,[i[18]||(i[18]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",Sa,A(((Se=B.value)==null?void 0:Se.carryoverTicketsCreatedOlder)??0),1),i[19]||(i[19]=r("span",{class:"breakdown-item__label"},"–æ—Å—Ç–∞–ª—å–Ω—ã–µ",-1))])])]),r("div",Da,[i[21]||(i[21]=r("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),r("div",Ea,[(y(!0),f(ye,null,me(D.value,be=>(y(),f("span",{key:be.stageId,class:"stage-tag"},A(be.stageName||be.stageId)+" ‚Äî "+A(be.count),1))),128)),!D.value||D.value.length===0?(y(),f("span",Na," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):ne("",!0)])])])]),h.value?(y(),f("div",Oa,[...i[22]||(i[22]=[r("div",{class:"summary-week-divider__line"},null,-1),r("div",{class:"summary-week-divider__label"},"–ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)])])):ne("",!0),h.value?(y(),f("div",Ba,[r("h3",Ia,[i[23]||(i[23]=r("span",{class:"summary-week-block__title-text"},"–ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è",-1)),r("span",Ma," –ù–µ–¥–µ–ª—è "+A(h.value.weekNumber??"‚Äî"),1),h.value.weekStartUtc?(y(),f("span",Ua,A(ve(h.value.weekStartUtc,h.value.weekEndUtc)),1)):ne("",!0)]),r("div",Ra,[r("div",{class:"summary-card summary-card--new summary-card--previous summary-card--clickable",onClick:i[3]||(i[3]=be=>S("new"))},[i[24]||(i[24]=r("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),r("div",Pa,[r("div",xa,[r("div",La,[r("div",Fa,A(((De=h.value)==null?void 0:De.newTickets)??0),1),r("span",Ga,"–ù–µ–¥–µ–ª—è "+A(((Ce=h.value)==null?void 0:Ce.weekNumber)??"‚Äî"),1)]),r("div",Ha,[r("div",Va,A(((J=X.value)==null?void 0:J.newTickets)??0),1),r("span",Ka,"–ù–µ–¥–µ–ª—è "+A(((ce=X.value)==null?void 0:ce.weekNumber)??"‚Äî"),1)])]),ae.value.newTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",ae.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((ue=X.value)==null?void 0:ue.weekNumber)??"‚Äî"}): ${L(ae.value.newTickets)}`},[r("span",ja,A(ae.value.newTickets>=0?"‚Üë":"‚Üì"),1),r("span",za,A(L(ae.value.newTickets)),1),r("span",qa,"–∫ –Ω–µ–¥–µ–ª–µ "+A(((We=X.value)==null?void 0:We.weekNumber)??"‚Äî"),1)],10,Ya)):ne("",!0)])]),r("div",{class:"summary-card summary-card--closed-breakdown summary-card--previous summary-card--clickable",onClick:i[4]||(i[4]=be=>S("closed"))},[i[29]||(i[29]=r("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),r("div",Za,[r("div",Xa,[r("div",Ja,[r("div",Qa,A(((Pe=h.value)==null?void 0:Pe.closedTickets)??0),1),r("span",es,"–ù–µ–¥–µ–ª—è "+A(((xe=h.value)==null?void 0:xe.weekNumber)??"‚Äî"),1)]),r("div",ts,[r("div",rs,A(((Ke=X.value)==null?void 0:Ke.closedTickets)??0),1),r("span",as,"–ù–µ–¥–µ–ª—è "+A(((ut=X.value)==null?void 0:ut.weekNumber)??"‚Äî"),1)])]),ae.value.closedTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",ae.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((kt=X.value)==null?void 0:kt.weekNumber)??"‚Äî"}): ${L(ae.value.closedTickets)}`},[r("span",os,A(ae.value.closedTickets>=0?"‚Üë":"‚Üì"),1),r("span",ns,A(L(ae.value.closedTickets)),1),r("span",ls,"–∫ –Ω–µ–¥–µ–ª–µ "+A(((vt=X.value)==null?void 0:vt.weekNumber)??"‚Äî"),1)],10,ss)):ne("",!0)]),r("div",is,[r("div",cs,[i[25]||(i[25]=r("span",{class:"breakdown-item__icon"},"‚úì",-1)),r("span",ds,A(((ht=h.value)==null?void 0:ht.closedTicketsCreatedThisWeek)??0),1),i[26]||(i[26]=r("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),r("div",us,[i[27]||(i[27]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",ks,A(((yt=h.value)==null?void 0:yt.closedTicketsCreatedOtherWeek)??0),1),i[28]||(i[28]=r("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),r("div",{class:"summary-card summary-card--carryover-breakdown summary-card--previous summary-card--clickable",onClick:i[5]||(i[5]=be=>S("carryover"))},[i[36]||(i[36]=r("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),r("div",vs,[r("div",hs,[r("div",ys,[r("div",ms,A(((mt=h.value)==null?void 0:mt.carryoverTickets)??0),1),r("span",ps,"–ù–µ–¥–µ–ª—è "+A(((pt=h.value)==null?void 0:pt.weekNumber)??"‚Äî"),1)]),r("div",gs,[r("div",fs,A(((gt=X.value)==null?void 0:gt.carryoverTickets)??0),1),r("span",bs,"–ù–µ–¥–µ–ª—è "+A(((ft=X.value)==null?void 0:ft.weekNumber)??"‚Äî"),1)])]),ae.value.carryoverTickets!==null?(y(),f("div",{key:0,class:pe(["percentage-indicator",ae.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ù–µ–¥–µ–ª—è ${((bt=X.value)==null?void 0:bt.weekNumber)??"‚Äî"}): ${L(ae.value.carryoverTickets)}`},[r("span",ws,A(ae.value.carryoverTickets>=0?"‚Üë":"‚Üì"),1),r("span",Ts,A(L(ae.value.carryoverTickets)),1),r("span",Cs,"–∫ –Ω–µ–¥–µ–ª–µ "+A(((_t=X.value)==null?void 0:_t.weekNumber)??"‚Äî"),1)],10,_s)):ne("",!0)]),r("div",Ws,[r("div",As,[i[30]||(i[30]=r("span",{class:"breakdown-item__icon"},"‚úì",-1)),r("span",$s,A(((wt=h.value)==null?void 0:wt.carryoverTicketsCreatedThisWeek)??0),1),i[31]||(i[31]=r("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),r("div",Ss,[i[32]||(i[32]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",Ds,A(((Tt=h.value)==null?void 0:Tt.carryoverTicketsCreatedPreviousWeek)??0),1),i[33]||(i[33]=r("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏",-1))]),r("div",Es,[i[34]||(i[34]=r("span",{class:"breakdown-item__icon"},"‚Üª",-1)),r("span",Ns,A(((Ct=h.value)==null?void 0:Ct.carryoverTicketsCreatedOlder)??0),1),i[35]||(i[35]=r("span",{class:"breakdown-item__label"},"–æ—Å—Ç–∞–ª—å–Ω—ã–µ",-1))])])]),r("div",Os,[i[37]||(i[37]=r("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),r("div",Bs,[(y(!0),f(ye,null,me(R.value,be=>(y(),f("span",{key:be.stageId,class:"stage-tag"},A(be.stageName||be.stageId)+" ‚Äî "+A(be.count),1))),128)),!R.value||R.value.length===0?(y(),f("span",Is,A(G.value),1)):ne("",!0)])])])])):ne("",!0)]),r("div",Ms,[d.value==="line"?(y(),f("div",Us,[r("div",Rs,[i[38]||(i[38]=r("h3",{class:"chart-subtitle"},"–ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),r("div",Ps,[ke(Ve(Fe),{data:O.value,options:E.value},null,8,["data","options"])])]),r("div",xs,[i[39]||(i[39]=r("h3",{class:"chart-subtitle"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",-1)),r("div",Ls,[ke(Ve(Fe),{data:P.value,options:E.value},null,8,["data","options"])])])])):(y(),Ee(or(U.value),{key:1,data:M.value,options:E.value},null,8,["data","options"]))])])}}},Gs=Be(Fs,[["__scopeId","data-v-3666e13a"]]),Hs={class:"summary-cards-months"},Vs={class:"summary-card summary-card--new"},Ks={class:"card-content"},Ys={class:"card-main-value"},js=["title"],zs={class:"card-month-breakdown"},qs={class:"month-name"},Zs={class:"month-value"},Xs={key:0,class:"month-item month-item--empty"},Js={class:"summary-card summary-card--closed"},Qs={class:"card-content"},eo={class:"card-main-value"},to=["title"],ro={class:"card-month-breakdown-hierarchical"},ao={class:"month-header"},so={class:"month-name"},oo={class:"month-value"},no={class:"month-breakdown"},lo={class:"breakdown-item breakdown-this-week"},io={class:"breakdown-value"},co={class:"breakdown-item breakdown-other-week"},uo={class:"breakdown-value"},ko={key:0,class:"month-item-hierarchical month-item--empty"},vo={class:"summary-card summary-card--carryover"},ho={class:"card-content"},yo={class:"card-current-value"},mo={class:"current-value"},po=["title"],go={class:"card-month-breakdown"},fo={class:"month-name"},bo={class:"month-value"},_o={key:0,class:"month-item month-item--empty"},wo={class:"summary-card summary-card--stages"},To={class:"card-content"},Co={class:"stages-list"},Wo={class:"stage-icon"},Ao={class:"stage-name"},$o={class:"stage-value"},So={key:0,class:"stage-item stage-item--empty"},Do={__name:"SummaryCardsMonths",props:{data:{type:Object,required:!0,default:()=>({newTickets:0,newTicketsByMonth:[],closedTickets:0,closedTicketsByMonth:[],carryoverTickets:0,carryoverTicketsByMonth:[],stages:[]})}},setup(s){const t=s;function e(T){return T==null||isNaN(T)?"0":T>=1e6?(T/1e6).toFixed(1)+"M":T>=1e3?T.toLocaleString("ru-RU"):T.toString()}function a(T){return T==null||isNaN(T)?"":`${T>=0?"+":""}${T.toFixed(1)}%`}function o(T,_){if(typeof T!="number"||isNaN(T)||_==null||typeof _!="number"||isNaN(_)||_===0)return null;if(T===_)return 0;const g=(T-_)/_*100;return!isFinite(g)||isNaN(g)?null:g}const l=q(()=>{var T;return((T=t.data)==null?void 0:T.newTickets)||0}),d=q(()=>e(l.value)),c=q(()=>{var T;return((T=t.data)==null?void 0:T.newTicketsByMonth)||[]}),m=q(()=>{var T;return((T=t.data)==null?void 0:T.closedTicketsByMonth)||[]}),p=q(()=>{var T;return((T=t.data)==null?void 0:T.carryoverTicketsByMonth)||[]}),O=q(()=>{const T=p.value;if(T.length===0)return 0;const _=T[T.length-1];return(_==null?void 0:_.count)||0}),P=q(()=>{var g,E,B,N;const T=typeof((g=t.data)==null?void 0:g.newTickets)=="number"?t.data.newTickets:parseInt((E=t.data)==null?void 0:E.newTickets)||0,_=(N=(B=t.data)==null?void 0:B.previousPeriodData)==null?void 0:N.newTickets;return o(T,_)}),re=q(()=>{var g,E,B,N;const T=typeof((g=t.data)==null?void 0:g.closedTickets)=="number"?t.data.closedTickets:parseInt((E=t.data)==null?void 0:E.closedTickets)||0,_=(N=(B=t.data)==null?void 0:B.previousPeriodData)==null?void 0:N.closedTickets;return o(T,_)}),ee=q(()=>{var E;const T=O.value,_=p.value,g=_.length>0?((E=_[0])==null?void 0:E.count)||0:null;return o(T,g)});function U(T){return{"DT140_12:SUCCESS":"stage-success","DT140_12:FAIL":"stage-fail","DT140_12:UC_0GBU8Z":"stage-other"}[T]||""}function M(T){return{"DT140_12:SUCCESS":"‚úì","DT140_12:FAIL":"‚úó","DT140_12:UC_0GBU8Z":"‚ö†"}[T]||"‚Ä¢"}return(T,_)=>(y(),f("div",Hs,[r("div",Vs,[_[0]||(_[0]=r("h3",{class:"card-title"},"–ù–æ–≤—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥",-1)),r("div",Ks,[r("div",Ys,[Te(A(d.value)+" ",1),P.value!==null?(y(),f("span",{key:0,class:pe(["percentage-badge",P.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${a(P.value)}`},A(a(P.value)),11,js)):ne("",!0)]),r("div",zs,[(y(!0),f(ye,null,me(c.value,g=>(y(),f("div",{key:`new-${g.month}`,class:"month-item"},[r("span",qs,A(g.monthName)+":",1),r("span",Zs,A(e(g.count)),1)]))),128)),c.value.length===0?(y(),f("div",Xs," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):ne("",!0)])])]),r("div",Js,[_[5]||(_[5]=r("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –≤—Å–µ–≥–æ",-1)),r("div",Qs,[r("div",eo,[Te(A(e(s.data.closedTickets||0))+" ",1),re.value!==null?(y(),f("span",{key:0,class:pe(["percentage-badge",re.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${a(re.value)}`},A(a(re.value)),11,to)):ne("",!0)]),r("div",ro,[(y(!0),f(ye,null,me(m.value,g=>(y(),f("div",{key:`closed-${g.month}`,class:"month-item-hierarchical"},[r("div",ao,[r("span",so,A(g.monthName)+":",1),r("span",oo,A(e(g.count||0)),1)]),r("div",no,[r("div",lo,[_[1]||(_[1]=r("span",{class:"breakdown-icon"},"‚úì",-1)),_[2]||(_[2]=r("span",{class:"breakdown-label"},"—ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞:",-1)),r("span",io,A(e(g.closedCreatedThisWeek||0)),1)]),r("div",co,[_[3]||(_[3]=r("span",{class:"breakdown-icon"},"‚Üª",-1)),_[4]||(_[4]=r("span",{class:"breakdown-label"},"–¥—Ä—É–≥–æ–≥–æ –º–µ—Å—è—Ü–∞:",-1)),r("span",uo,A(e(g.closedCreatedOtherWeek||0)),1)])])]))),128)),m.value.length===0?(y(),f("div",ko," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):ne("",!0)])])]),r("div",vo,[_[7]||(_[7]=r("h3",{class:"card-title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ –≤—Å–µ–≥–æ",-1)),_[8]||(_[8]=r("p",{class:"card-hint"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ –≤ —Ç—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–∞–±–æ—á–∏—Ö —Å—Ç–∞–¥–∏—è—Ö (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)",-1)),r("div",ho,[r("div",yo,[_[6]||(_[6]=r("span",{class:"current-label"},"–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:",-1)),r("span",mo,[Te(A(e(O.value))+" ",1),ee.value!==null?(y(),f("span",{key:0,class:pe(["percentage-badge",ee.value>=0?"positive":"negative"]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞: ${a(ee.value)}`},A(a(ee.value)),11,po)):ne("",!0)])]),r("div",go,[(y(!0),f(ye,null,me(p.value,g=>(y(),f("div",{key:`carryover-${g.month}`,class:"month-item"},[r("span",fo,A(g.monthName)+":",1),r("span",bo,A(e(g.count||0)),1)]))),128)),p.value.length===0?(y(),f("div",_o," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):ne("",!0)])])]),r("div",wo,[_[10]||(_[10]=r("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),r("div",To,[r("div",Co,[(y(!0),f(ye,null,me(s.data.stages||[],g=>(y(),f("div",{key:g.stageId,class:pe(["stage-item",U(g.stageId)])},[r("span",Wo,A(M(g.stageId)),1),r("span",Ao,A(g.stageName||g.stageId)+":",1),r("span",$o,A(e(g.count||0)),1)],2))),128)),!s.data.stages||s.data.stages.length===0?(y(),f("div",So,[..._[9]||(_[9]=[r("span",{class:"stage-name"},"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö",-1)])])):ne("",!0)])])])]))}},Eo=Be(Do,[["__scopeId","data-v-15d88b90"]]),No={class:"line-chart-months"},Oo={class:"chart-section"},Bo={class:"chart-title"},Io={key:0,class:"chart-period"},Mo={class:"chart-wrapper"},Uo={class:"chart-container"},Ro={class:"chart-summary"},Po={class:"summary-numbers"},xo={class:"summary-row"},Lo={class:"summary-values"},Fo={class:"summary-row"},Go={class:"summary-values"},Ho={class:"summary-analysis"},Vo=["innerHTML"],Ko={class:"chart-section"},Yo={class:"chart-title"},jo={key:0,class:"chart-period"},zo={class:"chart-wrapper"},qo={class:"chart-container"},Zo={class:"chart-analysis"},Xo={class:"analysis-content"},Jo=["innerHTML"],Qo={class:"chart-table-section"},en={class:"chart-table-wrapper"},tn={class:"data-table"},rn={class:"data-row data-row--new"},an={class:"data-row data-row--closed"},sn={class:"data-row data-row--carryover"},on={__name:"LineChartMonths",props:{data:{type:Object,required:!0,default:()=>({newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]})},meta:{type:Object,default:()=>({months:[]})}},setup(s){nt.register(Yt);const t=s;function e(U){return U==null||isNaN(U)?"0":U>=1e3?U.toLocaleString("ru-RU"):U.toString()}const a=q(()=>{var M,T,_;const U=new Set;return(M=t.data.newTicketsByMonth)==null||M.forEach(g=>{g.weeks&&Array.isArray(g.weeks)&&g.weeks.forEach(E=>{E&&E.weekNumber&&U.add(E.weekNumber)})}),(T=t.data.closedTicketsByMonth)==null||T.forEach(g=>{g.weeks&&Array.isArray(g.weeks)&&g.weeks.forEach(E=>{E&&E.weekNumber&&U.add(E.weekNumber)})}),(_=t.data.carryoverTicketsByMonth)==null||_.forEach(g=>{g.weeks&&Array.isArray(g.weeks)&&g.weeks.forEach(E=>{E&&E.weekNumber&&U.add(E.weekNumber)})}),Array.from(U).sort((g,E)=>g-E)}),o=q(()=>{const U=t.data.newTicketsByMonth||[],M=U.map(g=>g.monthName||`–ú–µ—Å—è—Ü ${g.month}`),T=U.map(g=>g.count||0),_=(t.data.closedTicketsByMonth||[]).map(g=>g.count||0);return{labels:M,datasets:[{label:"–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã",data:T,borderColor:W.primary,backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:10,color:W.primary,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:W.primary,borderWidth:1,borderRadius:4,padding:4}},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",data:_,borderColor:W.success,backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"start",align:"bottom",offset:10,color:W.success,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:W.success,borderWidth:1,borderRadius:4,padding:4}}]}}),l=q(()=>{const U=t.data.carryoverTicketsByMonth||[],M=U.map(_=>_.monthName||`–ú–µ—Å—è—Ü ${_.month}`),T=U.map(_=>_.count||0);return{labels:M,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",data:T,borderColor:W.carryover,backgroundColor:"rgba(255, 152, 0, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:4,color:W.carryover}}]}}),d={responsive:!0,maintainAspectRatio:!1,layout:{padding:{left:16,right:0,top:56,bottom:0}},plugins:{legend:{position:"left",labels:{font:{size:14,weight:"500"},padding:16,boxWidth:20,boxHeight:12}},tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12},datalabels:{anchor:"end",align:"top",formatter:(U,M)=>U==null||isNaN(U)?"":U.toString(),color:"#333",font:{size:12,weight:"bold"},padding:{top:4,bottom:4},display:function(U){const M=U.dataset.data[U.dataIndex];return M!=null&&!isNaN(M)&&isFinite(M)},backgroundColor:"rgba(255, 255, 255, 0.8)",borderColor:"#333",borderWidth:1,borderRadius:4,padding:4}},scales:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:0,minRotation:0,font:{size:14},padding:10},grid:{lineWidth:1.5}}}};function c(U){if(!U||U.length===0)return null;const M=U[0],T=U[U.length-1];if(!M||!T)return null;const _=M.monthName||`–ú–µ—Å—è—Ü ${M.month}`,g=T.monthName||`–ú–µ—Å—è—Ü ${T.month}`,E=M.year||new Date().getFullYear();return`${_} ‚Äî ${g} ${E}`}const m=q(()=>{var U;return c(((U=t.data)==null?void 0:U.newTicketsByMonth)||[])}),p=q(()=>{var U;return c(((U=t.data)==null?void 0:U.carryoverTicketsByMonth)||[])}),O=q(()=>{var g,E;const U=((g=t.data)==null?void 0:g.newTicketsByMonth)||[],M=((E=t.data)==null?void 0:E.closedTicketsByMonth)||[];if(U.length===0)return{new:"‚Äî",closed:"‚Äî"};const T=U.map(B=>`${e(B.count||0)} (${B.monthName||B.month})`).join(" ‚Üí "),_=M.map(B=>`${e(B.count||0)} (${B.monthName||B.month})`).join(" ‚Üí ");return{new:T,closed:_}}),P=q(()=>{var E,B;const U=((E=t.data)==null?void 0:E.newTicketsByMonth)||[],M=((B=t.data)==null?void 0:B.closedTicketsByMonth)||[];if(U.length<2)return["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"];const T=[],_=[],g=[];if(U.length>=2){const N=U[0],h=U[1],x=U[2];if(h&&N&&typeof N.count=="number"&&typeof h.count=="number"){const D=N.monthName||N.month,R=h.monthName||h.month,G=e(N.count||0),H=e(h.count||0);if(N.count>0){const L=(h.count-N.count)/N.count*100;if(isFinite(L)&&!isNaN(L)){const X=L>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",Z=Math.abs(L),ae=L>=0?"+":"-",ve=L>=0?"#28a745":"#dc3545",fe=L>=0?"#28a745":"#dc3545";_.push(`  ‚Ä¢ <span style="color: ${ve}; font-weight: 600;">${X}</span> —Å ${G} (${D}) –¥–æ ${H} (${R}) ‚Äî <span style="color: ${fe}; font-weight: 600;">${ae}${Z.toFixed(1)}%</span>`)}}else N.count===0&&h.count>0&&_.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${D}) –¥–æ ${H} (${R})`)}if(x&&h&&typeof h.count=="number"&&typeof x.count=="number"){const D=h.monthName||h.month,R=x.monthName||x.month,G=e(h.count||0),H=e(x.count||0);if(h.count>0){const L=(x.count-h.count)/h.count*100;if(isFinite(L)&&!isNaN(L))if(Math.abs(L)<.1)_.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${G} (${D}) ‚Üí ${H} (${R}) ‚Äî 0.0%`);else{const X=L>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",Z=Math.abs(L),ae=L>=0?"+":"-",ve=L>=0?"#28a745":"#dc3545",fe=L>=0?"#28a745":"#dc3545";_.push(`  ‚Ä¢ <span style="color: ${ve}; font-weight: 600;">${X}</span> —Å ${G} (${D}) –¥–æ ${H} (${R}) ‚Äî <span style="color: ${fe}; font-weight: 600;">${ae}${Z.toFixed(1)}%</span>`)}}else h.count===0&&x.count>0&&_.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${D}) –¥–æ ${H} (${R})`)}}if(M.length>=2){const N=M[0],h=M[1],x=M[2];if(h&&N&&typeof N.count=="number"&&typeof h.count=="number"){const D=N.monthName||N.month,R=h.monthName||h.month,G=e(N.count||0),H=e(h.count||0);if(N.count>0){const L=(h.count-N.count)/N.count*100;if(isFinite(L)&&!isNaN(L))if(Math.abs(L)<.1)g.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${G} (${D}) ‚Üí ${H} (${R}) ‚Äî 0.0%`);else{const X=L>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",Z=Math.abs(L),ae=L>=0?"+":"-",ve=L>=0?"#28a745":"#dc3545",fe=L>=0?"#28a745":"#dc3545";g.push(`  ‚Ä¢ <span style="color: ${ve}; font-weight: 600;">${X}</span> —Å ${G} (${D}) –¥–æ ${H} (${R}) ‚Äî <span style="color: ${fe}; font-weight: 600;">${ae}${Z.toFixed(1)}%</span>`)}}else N.count===0&&h.count>0&&g.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏–π: —Å 0 (${D}) –¥–æ ${H} (${R})`)}if(x&&h&&typeof h.count=="number"&&typeof x.count=="number"){const D=h.monthName||h.month,R=x.monthName||x.month,G=e(h.count||0),H=e(x.count||0);if(h.count>0){const L=(x.count-h.count)/h.count*100;if(isFinite(L)&&!isNaN(L))if(Math.abs(L)<.1)g.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${G} (${D}) ‚Üí ${H} (${R}) ‚Äî 0.0%`);else{const X=L>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",Z=Math.abs(L),ae=L>=0?"+":"-",ve=L>=0?"#28a745":"#dc3545",fe=L>=0?"#28a745":"#dc3545";g.push(`  ‚Ä¢ <span style="color: ${ve}; font-weight: 600;">${X}</span> —Å ${G} (${D}) –¥–æ ${H} (${R}) ‚Äî <span style="color: ${fe}; font-weight: 600;">${ae}${Z.toFixed(1)}%</span>`)}}else h.count===0&&x.count>0&&g.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏–π: —Å 0 (${D}) –¥–æ ${H} (${R})`)}}if(_.length>0&&(T.push("–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã:"),T.push(..._)),g.length>0&&(T.push("–ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã:"),T.push(...g)),U.length>=3&&M.length>=3){const N=U[0],h=U[U.length-1],x=M[0],D=M[M.length-1],R=N.count||0,G=h.count||0,H=x.count||0,L=D.count||0;if(R>0&&H>0){const X=(G-R)/R*100,Z=(L-H)/H*100;if(isFinite(X)&&isFinite(Z)){const ae=N.monthName||N.month,ve=h.monthName||h.month,fe=x.monthName||x.month,S=D.monthName||D.month,n=X>=0?"#28a745":"#dc3545",i=X>=0?"#28a745":"#dc3545",$=Z>=0?"#28a745":"#dc3545",I=Z>=0?"#28a745":"#dc3545";T.push("–û–±—â–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥:"),T.push(`  ‚Ä¢ –ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã: <span style="color: ${n}; font-weight: 600;">${X>=0?"—Ä–æ—Å—Ç":"—Å–Ω–∏–∂–µ–Ω–∏–µ"}</span> —Å ${e(R)} (${ae}) –¥–æ ${e(G)} (${ve}) ‚Äî <span style="color: ${i}; font-weight: 600;">${X>=0?"+":"-"}${Math.abs(X).toFixed(1)}%</span>`),T.push(`  ‚Ä¢ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã: <span style="color: ${$}; font-weight: 600;">${Z>=0?"—Ä–æ—Å—Ç":"—Å–Ω–∏–∂–µ–Ω–∏–µ"}</span> —Å ${e(H)} (${fe}) –¥–æ ${e(L)} (${S}) ‚Äî <span style="color: ${I}; font-weight: 600;">${Z>=0?"+":"-"}${Math.abs(Z).toFixed(1)}%</span>`)}}}return T.length>0?T:["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"]}),re=q(()=>{var g;const U=((g=t.data)==null?void 0:g.carryoverTicketsByMonth)||[];if(U.length===0)return["–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"];const M=[],T=[],_=U.filter(E=>E&&typeof E.count=="number").map(E=>`${e(E.count||0)} (${E.monthName||E.month||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"})`).join(" ‚Üí ");if(_&&M.push(`–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã: ${_}`),U.length>=2){const E=U[0],B=U[1],N=U[2];if(B&&E&&typeof E.count=="number"&&typeof B.count=="number"){const h=E.monthName||E.month,x=B.monthName||B.month,D=e(E.count||0),R=e(B.count||0);if(E.count>0){const G=(B.count-E.count)/E.count*100;if(isFinite(G)&&!isNaN(G))if(Math.abs(G)<.1)T.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${D} (${h}) ‚Üí ${R} (${x}) ‚Äî 0.0%`);else{const H=G>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",L=Math.abs(G),X=G>=0?"+":"-",Z=G>=0?"#28a745":"#dc3545",ae=G>=0?"#28a745":"#dc3545";T.push(`  ‚Ä¢ <span style="color: ${Z}; font-weight: 600;">${H}</span> —Å ${D} (${h}) –¥–æ ${R} (${x}) ‚Äî <span style="color: ${ae}; font-weight: 600;">${X}${L.toFixed(1)}%</span>`)}}else E.count===0&&B.count>0&&T.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${h}) –¥–æ ${R} (${x})`)}if(N&&B&&typeof B.count=="number"&&typeof N.count=="number"){const h=B.monthName||B.month,x=N.monthName||N.month,D=e(B.count||0),R=e(N.count||0);if(B.count>0){const G=(N.count-B.count)/B.count*100;if(isFinite(G)&&!isNaN(G))if(Math.abs(G)<.1)T.push(`  ‚Ä¢ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${D} (${h}) ‚Üí ${R} (${x}) ‚Äî 0.0%`);else{const H=G>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",L=Math.abs(G),X=G>=0?"+":"-",Z=G>=0?"#28a745":"#dc3545",ae=G>=0?"#28a745":"#dc3545";T.push(`  ‚Ä¢ <span style="color: ${Z}; font-weight: 600;">${H}</span> —Å ${D} (${h}) –¥–æ ${R} (${x}) ‚Äî <span style="color: ${ae}; font-weight: 600;">${X}${L.toFixed(1)}%</span>`)}}else B.count===0&&N.count>0&&T.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${h}) –¥–æ ${R} (${x})`)}}if(T.length>0&&(M.push("–î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º:"),M.push(...T)),U.length>=3){const E=U[0],B=U[U.length-1];if(E&&B&&typeof E.count=="number"&&typeof B.count=="number"){const N=E.count||0,h=B.count||0,x=E.monthName||E.month,D=B.monthName||B.month,R=e(N),G=e(h);if(N>0){const H=(h-N)/N*100;if(isFinite(H)&&!isNaN(H))if(Math.abs(H)<1)M.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),M.push(`  ‚Ä¢ –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${R} (${x}) ‚Üí ${G} (${D}) ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ–Ω–µ–µ 1%`);else{const L=H>=0?"–†–æ—Å—Ç":"–°–Ω–∏–∂–µ–Ω–∏–µ",X=Math.abs(H),Z=H>=0?"+":"-",ae=H>=0?"#28a745":"#dc3545",ve=H>=0?"#28a745":"#dc3545";M.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),M.push(`  ‚Ä¢ <span style="color: ${ae}; font-weight: 600;">${L}</span> —Å ${R} (${x}) –¥–æ ${G} (${D}) ‚Äî <span style="color: ${ve}; font-weight: 600;">${Z}${X.toFixed(1)}%</span>`)}}else N===0&&h>0?(M.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),M.push(`  ‚Ä¢ –ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å 0 (${x}) –¥–æ ${G} (${D})`)):N>0&&h===0&&(M.push("–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥:"),M.push(`  ‚Ä¢ –ü–æ–ª–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤: —Å ${R} (${x}) –¥–æ 0 (${D})`))}}return M.length>0?M:["–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"]});function ee(U,M){let T=[];switch(U){case"new":T=t.data.newTicketsByMonth||[];break;case"closed":T=t.data.closedTicketsByMonth||[];break;case"carryover":T=t.data.carryoverTicketsByMonth||[];break;default:return"-"}for(const _ of T){if(!_.weeks||!Array.isArray(_.weeks))continue;const g=_.weeks.find(E=>E&&E.weekNumber===M);if(g){const E=g.count||0;return E>0?e(E):"-"}}return"-"}return(U,M)=>(y(),f("div",No,[r("div",Oo,[r("h3",Bo,[M[0]||(M[0]=Te(" –ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã ",-1)),m.value?(y(),f("span",Io,"("+A(m.value)+")",1)):ne("",!0)]),r("div",Mo,[r("div",Uo,[ke(Ve(Fe),{data:o.value,options:d},null,8,["data"])]),r("div",Ro,[M[3]||(M[3]=r("h4",{class:"summary-title"},"–°–≤–æ–¥–Ω—ã–π –∏—Ç–æ–≥",-1)),r("div",Po,[r("div",xo,[M[1]||(M[1]=r("span",{class:"summary-label"},"–ù–æ–≤—ã–µ:",-1)),r("span",Lo,A(O.value.new),1)]),r("div",Fo,[M[2]||(M[2]=r("span",{class:"summary-label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ:",-1)),r("span",Go,A(O.value.closed),1)])]),r("div",Ho,[(y(!0),f(ye,null,me(P.value,(T,_)=>(y(),f("p",{key:_,innerHTML:T},null,8,Vo))),128))])])])]),r("div",Ko,[r("h3",Yo,[M[4]||(M[4]=Te(" –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã ",-1)),p.value?(y(),f("span",jo,"("+A(p.value)+")",1)):ne("",!0)]),r("div",zo,[r("div",qo,[ke(Ve(Fe),{data:l.value,options:d},null,8,["data"])]),r("div",Zo,[M[5]||(M[5]=r("h4",{class:"analysis-title"},"–ê–Ω–∞–ª–∏–∑",-1)),r("div",Xo,[(y(!0),f(ye,null,me(re.value,(T,_)=>(y(),f("p",{key:_,innerHTML:T},null,8,Jo))),128))])])])]),r("div",Qo,[M[10]||(M[10]=r("h3",{class:"chart-title"},"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º",-1)),r("div",en,[r("table",tn,[r("thead",null,[r("tr",null,[M[6]||(M[6]=r("th",{class:"month-header-cell"},"–ú–µ—Å—è—Ü",-1)),(y(!0),f(ye,null,me(a.value,T=>(y(),f("th",{key:`week-${T}`,class:"week-header-cell"}," –ù–µ–¥–µ–ª—è "+A(T),1))),128))])]),r("tbody",null,[r("tr",rn,[M[7]||(M[7]=r("td",{class:"data-type-cell"},"–ù–æ–≤—ã–µ",-1)),(y(!0),f(ye,null,me(a.value,T=>(y(),f("td",{key:`new-${T}`,class:"week-data-cell"},A(ee("new",T)),1))),128))]),r("tr",an,[M[8]||(M[8]=r("td",{class:"data-type-cell"},"–ó–∞–∫—Ä—ã—Ç—ã–µ",-1)),(y(!0),f(ye,null,me(a.value,T=>(y(),f("td",{key:`closed-${T}`,class:"week-data-cell"},A(ee("closed",T)),1))),128))]),r("tr",sn,[M[9]||(M[9]=r("td",{class:"data-type-cell"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),(y(!0),f(ye,null,me(a.value,T=>(y(),f("td",{key:`carryover-${T}`,class:"week-data-cell"},A(ee("carryover",T)),1))),128))])])])])])]))}},nn=Be(on,[["__scopeId","data-v-31a3d565"]]),ln={class:"months-preloader"},cn={class:"preloader-content"},dn={class:"progress-container"},un={class:"progress-bar"},kn={class:"progress-text"},vn={class:"preloader-message"},hn={class:"stages-list"},yn={class:"stage-icon"},mn={class:"stage-text"},pn={__name:"MonthsModePreloader",props:{progress:{type:Number,required:!0,validator:s=>s>=0&&s<=100},currentStage:{type:String,default:""}},setup(s){const t=s,e=[{label:"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",threshold:5},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 1)...",threshold:35},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 2)...",threshold:65},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 3)...",threshold:85},{label:"–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...",threshold:90},{label:"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",threshold:100}];function a(l){return t.progress>=e[l].threshold}function o(l){const d=e[l].threshold,c=l>0?e[l-1].threshold:0;return t.progress>=c&&t.progress<d}return(l,d)=>(y(),f("div",ln,[r("div",cn,[d[0]||(d[0]=nr('<div class="preloader-spinner" data-v-b571fe67><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div></div><h3 class="preloader-title" data-v-b571fe67>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 3 –º–µ—Å—è—Ü–∞</h3>',2)),r("div",dn,[r("div",un,[r("div",{class:"progress-fill",style:Ue({width:`${s.progress}%`})},null,4)]),r("div",kn,A(Math.round(s.progress))+"%",1)]),r("p",vn,A(s.currentStage),1),r("div",hn,[(y(),f(ye,null,me(e,(c,m)=>r("div",{key:m,class:pe(["stage-item",{"stage-completed":a(m),"stage-current":o(m)}])},[r("span",yn,A(a(m)?"‚úì":o(m)?"‚Üí":"‚óã"),1),r("span",mn,A(c.label),1)],2)),64))])])]))}},gn=Be(pn,[["__scopeId","data-v-b571fe67"]]),fn="/api/graph-1c-admission-closure.php";function bn(s){var a,o,l,d,c,m,p,O,P,re,ee,U,M,T,_,g,E,B,N,h,x,D,R,G,H,L,X,Z,ae,ve,fe,S,n,i,$,I,F,w,V,oe,b,k,K,u,v,Y,te,le,se,j,C,ie,he,de,z,_e,Se,De,Ce,J,ce,ue,We,Pe,xe,Ke;if(!s)return{meta:null,data:{currentWeek:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,carryoverTicketsCreatedPreviousWeek:0,carryoverTicketsCreatedOlder:0},newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0],carryoverCreatedPreviousWeek:[0],carryoverCreatedOlder:[0]},weeksData:[],stagesByWeek:[],stages:[],responsible:[],responsibleCreatedThisWeek:[],responsibleCreatedOtherWeek:[]}};const t=s.data||s.result||s,e=t.meta||s.meta||null;return{meta:{...e,currentWeek:(e==null?void 0:e.currentWeek)||(e?{weekNumber:e.weekNumber,weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc}:null),weeks:(e==null?void 0:e.weeks)||[]},data:{currentWeek:((a=t.data)==null?void 0:a.currentWeek)||(t.data?{newTickets:t.data.newTickets??0,closedTickets:t.data.closedTickets??0,closedTicketsCreatedThisWeek:t.data.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:t.data.closedTicketsCreatedOtherWeek??0,carryoverTickets:t.data.carryoverTickets??0,carryoverTicketsCreatedThisWeek:t.data.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:t.data.carryoverTicketsCreatedOtherWeek??0,carryoverTicketsCreatedPreviousWeek:t.data.carryoverTicketsCreatedPreviousWeek??0,carryoverTicketsCreatedOlder:t.data.carryoverTicketsCreatedOlder??0}:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,carryoverTicketsCreatedPreviousWeek:0,carryoverTicketsCreatedOlder:0}),newTickets:((l=(o=t.data)==null?void 0:o.currentWeek)==null?void 0:l.newTickets)??((d=t.data)==null?void 0:d.newTickets)??t.newTickets??0,closedTickets:((m=(c=t.data)==null?void 0:c.currentWeek)==null?void 0:m.closedTickets)??((p=t.data)==null?void 0:p.closedTickets)??t.closedTickets??0,closedTicketsCreatedThisWeek:((P=(O=t.data)==null?void 0:O.currentWeek)==null?void 0:P.closedTicketsCreatedThisWeek)??((re=t.data)==null?void 0:re.closedTicketsCreatedThisWeek)??t.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:((U=(ee=t.data)==null?void 0:ee.currentWeek)==null?void 0:U.closedTicketsCreatedOtherWeek)??((M=t.data)==null?void 0:M.closedTicketsCreatedOtherWeek)??t.closedTicketsCreatedOtherWeek??0,carryoverTickets:((_=(T=t.data)==null?void 0:T.currentWeek)==null?void 0:_.carryoverTickets)??((g=t.data)==null?void 0:g.carryoverTickets)??t.carryoverTickets??0,carryoverTicketsCreatedThisWeek:((B=(E=t.data)==null?void 0:E.currentWeek)==null?void 0:B.carryoverTicketsCreatedThisWeek)??((N=t.data)==null?void 0:N.carryoverTicketsCreatedThisWeek)??t.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:((x=(h=t.data)==null?void 0:h.currentWeek)==null?void 0:x.carryoverTicketsCreatedOtherWeek)??((D=t.data)==null?void 0:D.carryoverTicketsCreatedOtherWeek)??t.carryoverTicketsCreatedOtherWeek??0,carryoverTicketsCreatedPreviousWeek:((G=(R=t.data)==null?void 0:R.currentWeek)==null?void 0:G.carryoverTicketsCreatedPreviousWeek)??((H=t.data)==null?void 0:H.carryoverTicketsCreatedPreviousWeek)??t.carryoverTicketsCreatedPreviousWeek??0,carryoverTicketsCreatedOlder:((X=(L=t.data)==null?void 0:L.currentWeek)==null?void 0:X.carryoverTicketsCreatedOlder)??((Z=t.data)==null?void 0:Z.carryoverTicketsCreatedOlder)??t.carryoverTicketsCreatedOlder??0,series:{new:((ve=(ae=t.data)==null?void 0:ae.series)==null?void 0:ve.new)??((fe=t.series)==null?void 0:fe.new)??[0],closed:((n=(S=t.data)==null?void 0:S.series)==null?void 0:n.closed)??((i=t.series)==null?void 0:i.closed)??[0],closedCreatedThisWeek:((I=($=t.data)==null?void 0:$.series)==null?void 0:I.closedCreatedThisWeek)??((F=t.series)==null?void 0:F.closedCreatedThisWeek)??[0],closedCreatedOtherWeek:((V=(w=t.data)==null?void 0:w.series)==null?void 0:V.closedCreatedOtherWeek)??((oe=t.series)==null?void 0:oe.closedCreatedOtherWeek)??[0],carryover:((k=(b=t.data)==null?void 0:b.series)==null?void 0:k.carryover)??((K=t.series)==null?void 0:K.carryover)??[0],carryoverCreatedThisWeek:((v=(u=t.data)==null?void 0:u.series)==null?void 0:v.carryoverCreatedThisWeek)??((Y=t.series)==null?void 0:Y.carryoverCreatedThisWeek)??[0],carryoverCreatedOtherWeek:((le=(te=t.data)==null?void 0:te.series)==null?void 0:le.carryoverCreatedOtherWeek)??((se=t.series)==null?void 0:se.carryoverCreatedOtherWeek)??[0],carryoverCreatedPreviousWeek:((C=(j=t.data)==null?void 0:j.series)==null?void 0:C.carryoverCreatedPreviousWeek)??((ie=t.series)==null?void 0:ie.carryoverCreatedPreviousWeek)??[0],carryoverCreatedOlder:((de=(he=t.data)==null?void 0:he.series)==null?void 0:de.carryoverCreatedOlder)??((z=t.series)==null?void 0:z.carryoverCreatedOlder)??[0]},weeksData:((_e=t.data)==null?void 0:_e.weeksData)??t.weeksData??[],stagesByWeek:((Se=t.data)==null?void 0:Se.stagesByWeek)??t.stagesByWeek??[],stages:((De=t.data)==null?void 0:De.stages)??t.stages??[],responsible:((Ce=t.data)==null?void 0:Ce.responsible)??t.responsible??[],responsibleCreatedThisWeek:((J=t.data)==null?void 0:J.responsibleCreatedThisWeek)??t.responsibleCreatedThisWeek??[],responsibleCreatedOtherWeek:((ce=t.data)==null?void 0:ce.responsibleCreatedOtherWeek)??t.responsibleCreatedOtherWeek??[],newTicketsByStages:((ue=t.data)==null?void 0:ue.newTicketsByStages)??t.newTicketsByStages??null,carryoverTicketsByDuration:((We=t.data)==null?void 0:We.carryoverTicketsByDuration)??t.carryoverTicketsByDuration??null,newTicketsByMonth:((Pe=t.data)==null?void 0:Pe.newTicketsByMonth)??t.newTicketsByMonth??[],closedTicketsByMonth:((xe=t.data)==null?void 0:xe.closedTicketsByMonth)??t.closedTicketsByMonth??[],carryoverTicketsByMonth:((Ke=t.data)==null?void 0:Ke.carryoverTicketsByMonth)??t.carryoverTicketsByMonth??[]}}}async function Oe(s={}){const{endpoint:t=fn,product:e="1C",weekStartUtc:a=null,weekEndUtc:o=null,periodMode:l="weeks",useCache:d=!0,forceRefresh:c=!1,includeTickets:m=!1,includeNewTicketsByStages:p=!1,includeCarryoverTickets:O=!0,includeCarryoverTicketsByDuration:P=!1}=s,re={product:e,weekStartUtc:a,weekEndUtc:o,periodMode:l,useCache:d,forceRefresh:c,includeTickets:m,includeNewTicketsByStages:p,includeCarryoverTickets:O,includeCarryoverTicketsByDuration:P},ee=lr(t),U=await fetch(ee,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(re)});if(!U.ok)throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (${U.status})`);const M=await U.json();if((M==null?void 0:M.success)===!1)throw new Error(M.message||"–ë—ç–∫–µ–Ω–¥ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É");const T=bn(M);if(M.cache_used===!0){const{CacheNotificationService:_}=await Re(async()=>{const{CacheNotificationService:E}=await import("./main-CFHmHLwF.js").then(B=>B.aq);return{CacheNotificationService:E}},__vite__mapDeps([0,1]),import.meta.url),g=l==="months"?"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)":"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)";_.notifyCacheUsed(g)}return T}const _n=Object.freeze(Object.defineProperty({__proto__:null,fetchAdmissionClosureStats:Oe},Symbol.toStringTag,{value:"Module"})),wn={class:"ac-dashboard-months"},Tn={key:"content"},Cn={class:"dashboard-header"},Wn={class:"header-content"},An={class:"breadcrumbs-row"},$n=["aria-label","aria-disabled","data-fallback","disabled"],Sn={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Dn={class:"dashboard-layout"},En={class:"filters-container"},Nn={class:"chart-container"},On={__name:"GraphAdmissionClosureMonthsDashboard",setup(s){const t=It(),e=Q(!0),a=Q(0),o=Q("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."),l=Q(null),d=Q(null),c=Q({newTickets:0,closedTickets:0,carryoverTickets:0,newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[],previousPeriodData:{newTickets:null,closedTickets:null,carryoverTickets:null}}),m=Q(!1),p=q(()=>typeof window>"u"?!1:window.history.length>1),O=q(()=>p.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),P={name:"dashboard-sector-1c"};function re(D){var R;if((R=D==null?void 0:D.preventDefault)==null||R.call(D),!m.value){m.value=!0;try{if(p.value){t.back();return}console.warn("GraphAdmissionClosureMonthsDashboard: fallback navigation to dashboard-sector-1c"),t.push(P)}finally{m.value=!1}}}const ee=Q({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),U=q(()=>{const D=ee.value.customDateRange.startDate||ee.value.customDateRange.endDate,R=ee.value.employees.length===1&&ee.value.employees.includes("all");return D||!R});async function M(D,R,G=500){const H=a.value,L=10,X=(D-H)/L,Z=G/L;for(let ae=0;ae<L;ae++)await new Promise(ve=>setTimeout(ve,Z)),a.value=Math.min(H+X*(ae+1),D);a.value=D,o.value=R}async function T(){console.log("[DEBUG MonthsDashboard] loadData called"),console.log("[DEBUG MonthsDashboard] isLoading before:",e.value),e.value=!0,l.value=null,a.value=0,o.value="–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",console.log("[DEBUG MonthsDashboard] isLoading set to true");let D=null,R=null;try{console.log("[DEBUG MonthsDashboard] Starting API call"),await M(5,"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",200);const G=Date.now(),H=2e4;D=setInterval(()=>{const ae=Date.now()-G,ve=Math.min(5+ae/H*85,90);a.value=ve,ve<35?o.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 1)...":ve<65?o.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 2)...":ve<85?o.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∑–∞–ø—Ä–æ—Å 3)...":o.value="–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö..."},500),R=setTimeout(()=>{D&&(clearInterval(D),D=null)},H+1e4);const L=await Oe({product:"1C",periodMode:"months",includeTickets:!0});clearTimeout(R),D&&(clearInterval(D),D=null),a.value=90,o.value="–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞",await M(100,"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",300),console.log("[DEBUG MonthsDashboard] API call successful, result:",L);const{meta:X,data:Z}=L;d.value=X,c.value=Z,console.log("[DEBUG MonthsDashboard] Data set, meta:",X,"data keys:",Object.keys(Z)),await new Promise(ae=>setTimeout(ae,200))}catch(G){D&&(clearInterval(D),D=null),R&&(clearTimeout(R),R=null),console.error("[DEBUG MonthsDashboard] API call failed:",G),l.value=G instanceof Error?G:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureMonthsDashboard] loadData error:",G),a.value=100,o.value="–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö"}finally{console.log("[DEBUG MonthsDashboard] Finally block: setting isLoading to false"),e.value=!1,console.log("[DEBUG MonthsDashboard] isLoading after:",e.value)}}function _(D){ee.value.stages=D}function g(D){ee.value.employees=D}function E(D){ee.value.dateRange=D}function B(D){ee.value.customDateRange=D}function N(){ee.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},h()}function h(){T()}function x(D){if(!["weeks","months"].includes(D)){console.warn("[GraphAdmissionClosureMonthsDashboard] Invalid periodMode:",D);return}D==="weeks"&&window.dispatchEvent(new CustomEvent("period-mode-change",{detail:{mode:D}}))}return ct(()=>{console.log("[DEBUG MonthsDashboard] onMounted called"),console.log("[DEBUG MonthsDashboard] isLoading before loadData:",e.value),T()}),(D,R)=>{const G=Mt("router-link");return y(),f("div",wn,[ke($e,{name:"fade",mode:"out-in"},{default:ge(()=>[e.value?(y(),Ee(gn,{key:"preloader",progress:a.value,"current-stage":o.value},null,8,["progress","current-stage"])):(y(),f("div",Tn,[r("div",Cn,[r("div",Wn,[r("div",An,[r("button",{class:"btn-back-link",type:"button",onClick:re,"aria-label":O.value,"aria-disabled":!p.value,"data-fallback":!p.value,disabled:m.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,$n),r("nav",Sn,[ke(G,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ge(()=>[...R[0]||(R[0]=[Te(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),R[2]||(R[2]=r("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ke(G,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:ge(()=>[...R[1]||(R[1]=[Te(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),R[3]||(R[3]=r("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),R[4]||(R[4]=r("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),R[5]||(R[5]=r("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),R[6]||(R[6]=r("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),r("div",Dn,[r("div",En,[ke(Rt,{stages:ee.value.stages,employees:ee.value.employees,dateRange:ee.value.dateRange,customDateRange:ee.value.customDateRange,hasActiveFilters:U.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":"months","onUpdate:stages":_,"onUpdate:employees":g,"onUpdate:dateRange":E,"onUpdate:customDateRange":B,"onUpdate:periodMode":x,onReset:N,onApply:h},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])]),r("div",Nn,[l.value?(y(),Ee(Ut,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:l.value.message},null,8,["message"])):(y(),f(ye,{key:1},[ke(Eo,{data:c.value},null,8,["data"]),ke(nn,{data:c.value,meta:d.value},null,8,["data","meta"])],64))])])]))]),_:1})])}}},Bn=Be(On,[["__scopeId","data-v-fe3ca7ed"]]);class it{static async getSectorData(){try{const t=await this.getAllTickets();console.log("Total tickets loaded:",t.length);const e=this.extractUniqueEmployeeIds(t);console.log("Unique employee IDs:",e);const a=await this.getEmployeesByIds(e);return console.log("Loaded employees:",a.length),{stages:this.groupTicketsByStages(t,a),employees:a,zeroPointTickets:this.getZeroPointTickets(t)}}catch(t){throw console.error("Error getting sector data:",t),t}}static async getAllTickets(){const t=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],e=[];for(const a of t){console.log(`Loading tickets for stage: ${a}`);const o=await this.getTicketsByStage(a);e.push(...o),console.log(`Loaded ${o.length} tickets for stage ${a}`)}return e}static async getTicketsByStage(t){const e=[];let a=0;const o=50;let l=!0;for(;l;)try{const c=await Le.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:t},select:["*"],order:{id:"DESC"},start:a,useOriginalUfNames:"Y"});let m=[];c&&c.result&&(Array.isArray(c.result)?m=c.result:c.result.items&&Array.isArray(c.result.items)?m=c.result.items:c.result.data&&Array.isArray(c.result.data)&&(m=c.result.data)),m.length>0?(e.push(...m),a+=m.length,l=m.length===o):l=!1}catch(c){console.error(`Error loading tickets batch for stage ${t} (start: ${a}):`,c),l=!1}e.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(e[0],null,2)),console.log("Sample ticket keys:",Object.keys(e[0])),console.log("Sample ticket assignedById variants:",{assignedById:e[0].assignedById,assignedByIdId:e[0].assignedByIdId,ASSIGNED_BY_ID:e[0].ASSIGNED_BY_ID}));const d=e.filter(c=>{const m=c.UF_CRM_7_TYPE_PRODUCT||c.uf_crm_7_type_product||c.ufCrm7TypeProduct||c.UF_CRM_7_TYPE_PRODUCT||c.uf_crm_7_type_product;return Array.isArray(m)?m.includes(this.SECTOR_TAG):typeof m=="object"&&m!==null?m.value===this.SECTOR_TAG||m===this.SECTOR_TAG:m===this.SECTOR_TAG});return console.log(`Filtered ${d.length} tickets from ${e.length} for stage ${t} (sector tag: ${this.SECTOR_TAG})`),d}static extractUniqueEmployeeIds(t){if(!Array.isArray(t))return[];const e=new Set;return t.forEach(a=>{const o=a.assignedById||a.assignedByIdId||a.ASSIGNED_BY_ID||a.assignedById||a.assignedById&&typeof a.assignedById=="object"&&(a.assignedById.id||a.assignedById.ID)||a.assignedById&&typeof a.assignedById=="object"&&a.assignedById.value;if(o){const l=parseInt(o);l&&!isNaN(l)&&l>0&&e.add(l)}}),t.length>0&&(console.log("Sample ticket for employee extraction:",t[0]),console.log("Sample ticket assignedById variants:",{assignedById:t[0].assignedById,assignedByIdId:t[0].assignedByIdId,ASSIGNED_BY_ID:t[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(e))),Array.from(e)}static async getEmployeesByIds(t){if(!Array.isArray(t)||t.length===0)return[];try{const e=await Le.call("user.get",{filter:{ID:t}});let a=[];return e&&e.result&&(Array.isArray(e.result)?a=e.result:console.warn("Unexpected user.get result format:",e)),a.map(o=>({id:parseInt(o.ID||o.id||0),name:`${o.NAME||o.name||""} ${o.LAST_NAME||o.lastName||""}`.trim()||o.EMAIL||o.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:o.WORK_POSITION||o.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:o.EMAIL||o.email||"",tickets:[]}))}catch(e){return console.error("Error getting employees by IDs:",e),[]}}static groupTicketsByStages(t,e){Array.isArray(t)||(console.warn("Tickets is not an array:",t),t=[]),Array.isArray(e)||(console.warn("Employees is not an array:",e),e=[]);const a=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:e.map(o=>({...o,tickets:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:e.map(o=>({...o,tickets:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:e.map(o=>({...o,tickets:[]}))}];return t.forEach(o=>{const l=this.mapStageId(o.stageId||o.STAGE_ID||""),d=a.find(c=>c.id===l);if(d){const c=o.assignedById||o.ASSIGNED_BY_ID||null,m=c?parseInt(c):null;if(m){let p=d.employees.find(O=>O.id===m);p||(p={id:m,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${m}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",tickets:[]},d.employees.push(p)),p.tickets.push(this.mapTicket(o))}}}),a}static mapStageId(t){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[t]||"formed"}static mapStageIdToBitrix(t){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[t]||"DT140_12:UC_0VHWE2"}static mapTicket(t){const e=parseInt(t.id||t.ID||0),a=t.title||t.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",o=t.stageId||t.STAGE_ID||"",l=t.assignedById||t.ASSIGNED_BY_ID||null,d=t.createdTime||t.CREATED_DATE||t.CREATED_TIME||"",c=t.updatedTime||t.MODIFY_DATE||t.UPDATED_TIME||"",m=t.UF_CRM_7_UF_PRIORITY||t.uf_crm_7_uf_priority||t.ufCrm7UfPriority||t.UF_CRM_7_UF_PRIORITY||t.uf_crm_7_uf_priority||t.priority||t.PRIORITY||null,p=At(m),O=dr(p);return{id:e,title:a,priorityId:p.id,priorityLabel:p.label,priorityColors:O,priority:p.id,priorityBitrixValue:p.bitrixValue||null,status:this.mapStatus(o),assigneeId:l?parseInt(l):null,stageId:this.mapStageId(o),createdAt:d,modifiedAt:c,amount:t.opportunity||t.OPPORTUNITY||0,currency:t.currencyId||t.CURRENCY_ID||"RUB",description:t.comments||t.COMMENTS||""}}static mapPriority(t){return At(t).id}static mapPriorityToBitrix(t){if(t&&typeof t=="object")return t.bitrixValue||null;const e=$t(t);if(e&&e.bitrixValue)return e.bitrixValue;const a={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return a[t]?a[t]:$t(ur).bitrixValue}static mapStatus(t){return"in_progress"}static getZeroPointTickets(t){const e={formed:[],review:[],execution:[]};return Array.isArray(t)?(t.filter(a=>!(a.assignedById||a.ASSIGNED_BY_ID)).forEach(a=>{const o=this.mapStageId(a.stageId||a.STAGE_ID||"");e[o]&&e[o].push(this.mapTicket(a))}),e):(console.warn("Tickets is not an array in getZeroPointTickets:",t),e)}static async assignTicket(t,e,a){try{const o=this.mapStageIdToBitrix(a);return(await Le.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:t,fields:{assignedById:e,stageId:o}})).result===!0}catch(o){throw console.error("Error assigning ticket:",o),o}}static async createTicket(t){try{const e=await Le.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:t.title,assignedById:t.employeeId,stageId:this.mapStageIdToBitrix(t.stageId)}});return e.result?parseInt(e.result):0}catch(e){throw console.error("Error creating ticket:",e),e}}static async getTicket(t){try{const e=await Le.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:t});return this.mapTicket(e.result)}catch(e){throw console.error("Error getting ticket:",e),e}}static async addComment(t,e){try{return(await Le.call("crm.timeline.comment.add",{fields:{entityId:t,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:e}})).result!==void 0}catch(a){throw console.error("Error adding comment:",a),a}}}st(it,"ENTITY_TYPE_ID",140),st(it,"SECTOR_TAG","1C");function In(s){if(!s)return null;try{const t=new Date(s);return isNaN(t.getTime())?null:t}catch{return console.warn("Invalid date format:",s),null}}function Mn(s,t){return Math.floor((s-t)/864e5)}function Un(s){return!s||isNaN(s.getTime())?!1:s<=new Date}const Ne={ONE_MONTH:"one_month",TWO_MONTHS:"two_months",MORE_THAN_HALF_YEAR:"more_than_half_year",MORE_THAN_YEAR:"more_than_year"},He={[Ne.ONE_MONTH]:"–û–¥–∏–Ω –º–µ—Å—è—Ü",[Ne.TWO_MONTHS]:"–î–≤–∞ –º–µ—Å—è—Ü–∞",[Ne.MORE_THAN_HALF_YEAR]:"–ë–æ–ª–µ–µ –ø–æ–ª—É–≥–æ–¥–∞",[Ne.MORE_THAN_YEAR]:"–ë–æ–ª–µ–µ –≥–æ–¥–∞"},Et={[Ne.ONE_MONTH]:30,[Ne.TWO_MONTHS]:60,[Ne.MORE_THAN_HALF_YEAR]:180,[Ne.MORE_THAN_YEAR]:365};function at(s,t,e=new Date){if(!Array.isArray(s))return console.warn("filterTicketsByTimePeriod: tickets must be an array"),[];if(!Et[t])return console.warn(`filterTicketsByTimePeriod: Unknown period "${t}"`),s;const a=Et[t],o=t.includes("more_than");return s.filter(l=>{try{if(!l||!l.id||!l.created_at)return console.warn("Ticket missing required fields:",l),!1;const d=In(l.created_at);if(!d)return console.warn(`Invalid date for ticket ${l.id}: ${l.created_at}`),!1;if(!Un(d))return console.warn(`Future or invalid date for ticket ${l.id}: ${l.created_at}`),!1;const c=Mn(e,d);return o?c>a:c<=a}catch(d){return console.error(`Error filtering ticket ${(l==null?void 0:l.id)||"unknown"}:`,d),!1}})}const Rn={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Pn={class:"modal"},xn={key:0,class:"modal__tabs"},Ln={key:"level-0-categories",class:"level-0"},Fn={class:"modal__header"},Gn={class:"modal__title"},Hn={key:0},Vn={class:"modal__body"},Kn={class:"categories-list"},Yn=["onClick"],jn={class:"category-item"},zn={class:"category-item__icon"},qn={key:0},Zn={key:1},Xn={class:"category-item__content"},Jn={class:"category-item__label"},Qn={class:"category-item__count"},el={key:0,class:"category-item__arrow"},tl={class:"modal__footer"},rl={key:"level-1-categories",class:"level-1"},al={class:"modal__header"},sl={class:"modal__body"},ol={key:"loading",class:"loading-names"},nl={key:"empty",class:"modal__empty"},ll={key:"list",class:"responsible-list"},il=["onClick"],cl={class:"responsible-list__name"},dl={class:"responsible-list__count"},ul={key:0,class:"responsible-list__arrow"},kl={class:"modal__footer"},vl={key:"level-2-categories",class:"level-2"},hl={class:"modal__header"},yl={class:"modal__title"},ml={class:"modal__body"},pl={class:"time-sort-controls"},gl={class:"time-sort-buttons"},fl=["onClick"],bl={class:"count"},_l={key:"loading",class:"loading-state"},wl={key:"error",class:"error-state"},Tl={class:"error-message"},Cl={key:"empty",class:"empty-state"},Wl={class:"empty-state-message"},Al={key:"tickets",class:"tickets-list-container"},$l={key:"level-0-employees",class:"level-0"},Sl={class:"modal__header"},Dl={class:"modal__title"},El={key:0},Nl={class:"modal__body"},Ol={key:"loading",class:"loading-names"},Bl={key:"empty",class:"modal__empty"},Il={key:"list",class:"responsible-list"},Ml=["onClick"],Ul={class:"responsible-list__name"},Rl={class:"responsible-list__count"},Pl={key:0,class:"responsible-list__arrow"},xl={class:"modal__footer"},Ll={key:"level-1-employees",class:"level-1"},Fl={class:"modal__header"},Gl={class:"modal__title"},Hl={class:"modal__body"},Vl={class:"categories-list"},Kl=["onClick"],Yl={class:"category-item"},jl={class:"category-item__icon"},zl={key:0},ql={key:1},Zl={class:"category-item__content"},Xl={class:"category-item__label"},Jl={class:"category-item__count"},Ql={key:0,class:"category-item__arrow"},ei={class:"modal__footer"},ti={key:"level-2-employees",class:"level-2"},ri={class:"modal__header"},ai={class:"modal__title"},si={class:"modal__body"},oi={key:"loading",class:"loading-state"},ni={key:"error",class:"error-state"},li={class:"error-message"},ii={key:"empty",class:"empty-state"},ci={class:"empty-state-message"},di={key:"tickets",class:"tickets-list-container"},ui={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(s){const t=s,e=Q(0),a=Q("categories"),o=Q(null),l=Q(null),d=Q(null),c=Q([]),m=Q(!1),p=Q(null),O=Q([]),P=Q([]),re=Q(!1),ee=Q(Ne.ONE_MONTH),U=q(()=>[{id:"created-this-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é",count:t.closedTicketsCreatedThisWeek??0,responsible:t.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ",count:t.closedTicketsCreatedOtherWeek??0,responsible:t.responsibleCreatedOtherWeek??[]}]),M=q(()=>{const S=new Map;return(t.responsibleCreatedThisWeek||[]).forEach(n=>{const i=n.id??"unassigned";S.has(i)||S.set(i,{id:n.id,name:n.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const $=S.get(i);$.thisWeekCount=n.count??0,$.thisWeekTickets=n.tickets||[],$.totalCount+=$.thisWeekCount}),(t.responsibleCreatedOtherWeek||[]).forEach(n=>{const i=n.id??"unassigned";S.has(i)||S.set(i,{id:n.id,name:n.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const $=S.get(i);$.otherWeekCount=n.count??0,$.otherWeekTickets=n.tickets||[],$.totalCount+=$.otherWeekCount}),Array.from(S.values())}),T=q(()=>{if(!l.value)return[];const S=l.value.thisWeekTickets||[],n=l.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:l.value.id,name:l.value.name,thisWeekCount:l.value.thisWeekCount,otherWeekCount:l.value.otherWeekCount,thisWeekTickets:S.length,otherWeekTickets:n.length,employee:l.value}),[{id:"this-week",label:"–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ",count:l.value.thisWeekCount??0,tickets:S,employeeId:l.value.id},{id:"other-week",label:"–ù–∞ –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ",count:l.value.otherWeekCount??0,tickets:n,employeeId:l.value.id}]}),_=q(()=>(P.value||[]).length>0),g=q(()=>{if(!c.value||c.value.length===0)return[];try{const S=performance.now(),n=at(c.value,ee.value),i=performance.now();return console.log(`[ResponsibleModal] Filtering took ${(i-S).toFixed(2)}ms, results: ${n.length}`),n}catch(S){return console.error("[ResponsibleModal] Error filtering tickets:",S),[]}}),E=q(()=>Object.keys(He).map(S=>({key:S,label:He[S],count:at(c.value,S).length})));async function B(S){const n=S.filter(i=>i.id!==null&&i.id!==void 0).map(i=>i.id);if(n.length===0)return S;try{const i=await it.getEmployeesByIds(n),$=new Map;return i.forEach(I=>{$.set(I.id,I.name)}),S.map(I=>I.id&&$.has(I.id)?{...I,name:$.get(I.id)}:I)}catch(i){return console.error("[ResponsibleModal] Error enriching names:",i),S}}Me([()=>a.value,()=>M.value],async([S,n])=>{if(!(S!=="employees"||e.value!==0)){if(!n||n.length===0){P.value=[];return}re.value=!0;try{P.value=await B(n)}catch(i){console.error("[ResponsibleModal] Error loading employee names:",i),P.value=n}finally{re.value=!1}}},{immediate:!0}),Me(()=>t.responsible,async S=>{if(!(e.value!==0||o.value||a.value!=="categories")){if(!S||S.length===0){O.value=[];return}re.value=!0;try{O.value=await B(S)}catch(n){console.error("[ResponsibleModal] Error loading employee names:",n),O.value=S}finally{re.value=!1}}},{immediate:!1});const N=q(()=>(O.value||[]).length>0);function h(S){a.value!==S&&(a.value=S,e.value=0,o.value=null,l.value=null,d.value=null,c.value=[],p.value=null,O.value=[],P.value=[])}async function x(S){var n,i,$;if(!S||S.count===0){console.warn("[ResponsibleModal] handleCategoryClick: Invalid category or count is 0",{category:S,count:S==null?void 0:S.count});return}console.log("[ResponsibleModal] handleCategoryClick called:",{categoryId:S.id,categoryLabel:S.label,categoryCount:S.count,responsibleCount:((n=S.responsible)==null?void 0:n.length)||0,responsibleWithTickets:((i=S.responsible)==null?void 0:i.filter(I=>I.tickets&&I.tickets.length>0).length)||0,responsibleSample:($=S.responsible)==null?void 0:$.slice(0,2).map(I=>{var F;return{id:I.id,name:I.name,count:I.count,hasTickets:!!I.tickets,ticketsCount:((F=I.tickets)==null?void 0:F.length)||0}})}),o.value=S,e.value=1,re.value=!0;try{O.value=await B(S.responsible),console.log("[ResponsibleModal] After enrichResponsibleWithNames:",{enrichedCount:O.value.length,enrichedSample:O.value.slice(0,2).map(I=>{var F;return{id:I.id,name:I.name,count:I.count,hasTickets:!!I.tickets,ticketsCount:((F=I.tickets)==null?void 0:F.length)||0}})})}catch(I){console.error("[ResponsibleModal] Error loading employee names:",I),O.value=S.responsible}finally{re.value=!1}}async function D(S,n=null){var i,$;!S||!S.id||S.totalCount===0||(n&&n.currentTarget&&(n.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{n.currentTarget&&(n.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:S.id,name:S.name,thisWeekCount:S.thisWeekCount,otherWeekCount:S.otherWeekCount,thisWeekTickets:((i=S.thisWeekTickets)==null?void 0:i.length)||0,otherWeekTickets:(($=S.otherWeekTickets)==null?void 0:$.length)||0,employee:S}),l.value={...S,thisWeekTickets:S.thisWeekTickets||[],otherWeekTickets:S.otherWeekTickets||[]},e.value=1)}async function R(S){var i;if(!S||S.count===0)return;d.value=S,e.value=2;const n=S.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:S.id,label:S.label,count:S.count,ticketsInGradation:n.length,selectedEmployee:(i=l.value)==null?void 0:i.id}),n.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",n.length),await G(n)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await H(S))}async function G(S){m.value=!0,p.value=null;try{try{const{prepareTicketsForDisplay:n}=await Re(async()=>{const{prepareTicketsForDisplay:i}=await import("./ticketListUtils-BoUj61Ng.js").then($=>$.t);return{prepareTicketsForDisplay:i}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);c.value=await n(S,null,null)}catch(n){console.error("[ResponsibleModal] Error preparing tickets:",n),c.value=S}c.value.length===0&&(p.value=null)}catch(n){p.value=n.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",n),c.value=[]}finally{m.value=!1}}async function H(S){m.value=!0,p.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc||!l.value)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫");const n=await Oe({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeTickets:!0}),i=S.id==="this-week"?n.data.responsibleCreatedThisWeek:n.data.responsibleCreatedOtherWeek,$=i==null?void 0:i.find(F=>F.id===l.value.id),I=($==null?void 0:$.tickets)||[];try{const{prepareTicketsForDisplay:F}=await Re(async()=>{const{prepareTicketsForDisplay:w}=await import("./ticketListUtils-BoUj61Ng.js").then(V=>V.t);return{prepareTicketsForDisplay:w}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);c.value=await F(I,null,null)}catch(F){console.error("[ResponsibleModal] Error preparing tickets:",F),c.value=I}c.value.length===0&&(p.value=null)}catch(n){p.value=n.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets from API:",n),c.value=[]}finally{m.value=!1}}async function L(S,n=null){!S||!S.id||S.count===0||(n&&n.currentTarget&&(n.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{n.currentTarget&&(n.currentTarget.style.transform="")},150)),l.value=S,e.value=2,await X(S.id))}async function X(S){var n,i,$,I,F,w,V,oe,b,k,K,u,v,Y,te,le,se;m.value=!0,p.value=null;try{let j=[];if(console.log("[ResponsibleModal] loadEmployeeTickets called:",{employeeId:S,selectedCategory:(n=o.value)==null?void 0:n.id,hasSelectedCategory:!!o.value,hasResponsible:!!((i=o.value)!=null&&i.responsible),responsibleCount:((I=($=o.value)==null?void 0:$.responsible)==null?void 0:I.length)||0,categoryData:o.value?{id:o.value.id,label:o.value.label,count:o.value.count,responsibleSample:(F=o.value.responsible)==null?void 0:F.slice(0,2).map(C=>{var ie;return{id:C.id,name:C.name,count:C.count,hasTickets:!!C.tickets,ticketsCount:((ie=C.tickets)==null?void 0:ie.length)||0}})}:null}),o.value&&o.value.responsible){const C=o.value.responsible.find(ie=>ie.id===S);console.log("[ResponsibleModal] Employee found in category:",{employee:C,hasTickets:!!(C!=null&&C.tickets),ticketsCount:((w=C==null?void 0:C.tickets)==null?void 0:w.length)||0,tickets:C!=null&&C.tickets?C.tickets.slice(0,2):null}),j=(C==null?void 0:C.tickets)||[]}if(j.length===0&&t.weekStartUtc&&t.weekEndUtc){console.log("[ResponsibleModal] Tickets not found in category, loading from API",{weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,categoryId:(V=o.value)==null?void 0:V.id});const C=await Oe({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeTickets:!0});console.log("[ResponsibleModal] API response:",{hasResponsibleCreatedThisWeek:!!C.data.responsibleCreatedThisWeek,hasResponsibleCreatedOtherWeek:!!C.data.responsibleCreatedOtherWeek,thisWeekCount:((oe=C.data.responsibleCreatedThisWeek)==null?void 0:oe.length)||0,otherWeekCount:((b=C.data.responsibleCreatedOtherWeek)==null?void 0:b.length)||0,thisWeekSample:(k=C.data.responsibleCreatedThisWeek)==null?void 0:k.slice(0,1).map(de=>{var z;return{id:de.id,name:de.name,count:de.count,hasTickets:!!de.tickets,ticketsCount:((z=de.tickets)==null?void 0:z.length)||0}}),otherWeekSample:(K=C.data.responsibleCreatedOtherWeek)==null?void 0:K.slice(0,1).map(de=>{var z;return{id:de.id,name:de.name,count:de.count,hasTickets:!!de.tickets,ticketsCount:((z=de.tickets)==null?void 0:z.length)||0}})});const ie=((u=o.value)==null?void 0:u.id)==="created-this-week"?C.data.responsibleCreatedThisWeek:C.data.responsibleCreatedOtherWeek;console.log("[ResponsibleModal] Category data:",{categoryId:(v=o.value)==null?void 0:v.id,categoryDataCount:(ie==null?void 0:ie.length)||0,categoryDataSample:ie==null?void 0:ie.slice(0,2).map(de=>{var z;return{id:de.id,name:de.name,count:de.count,hasTickets:!!de.tickets,ticketsCount:((z=de.tickets)==null?void 0:z.length)||0}})});const he=ie==null?void 0:ie.find(de=>de.id===S);console.log("[ResponsibleModal] Employee found in API response:",{employee:he?{id:he.id,name:he.name,count:he.count,hasTickets:!!he.tickets,ticketsCount:((Y=he.tickets)==null?void 0:Y.length)||0,ticketsSample:(te=he.tickets)==null?void 0:te.slice(0,2)}:null}),j=(he==null?void 0:he.tickets)||[]}console.log("[ResponsibleModal] Final employeeTickets before prepareTicketsForDisplay:",{ticketsCount:j.length,ticketsSample:j.slice(0,2).map(C=>({id:C.id,title:C.title||C.ufSubject||"No title",stageId:C.stageId}))});try{const{prepareTicketsForDisplay:C}=await Re(async()=>{const{prepareTicketsForDisplay:ie}=await import("./ticketListUtils-BoUj61Ng.js").then(he=>he.t);return{prepareTicketsForDisplay:ie}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);c.value=await C(j,null,null),console.log("[ResponsibleModal] Tickets after prepareTicketsForDisplay:",{ticketsCount:c.value.length,ticketsSample:c.value.slice(0,2).map(ie=>({id:ie.id,title:ie.title||ie.ufSubject||"No title",stageId:ie.stageId}))})}catch(C){console.error("[ResponsibleModal] Error preparing tickets:",C),console.error("[ResponsibleModal] prepareError details:",{message:C.message,stack:C.stack,employeeTicketsCount:j.length}),c.value=j,console.log("[ResponsibleModal] Using fallback tickets (without enrichment):",c.value.length)}c.value.length===0?(console.warn("[ResponsibleModal] No tickets after loading and preparation",{employeeId:S,categoryId:(le=o.value)==null?void 0:le.id,employeeTicketsCount:j.length,finalTicketsCount:c.value.length}),p.value=null):console.log("[ResponsibleModal] Successfully loaded tickets:",c.value.length)}catch(j){p.value=j.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",j),console.error("[ResponsibleModal] Error details:",{message:j.message,stack:j.stack,employeeId:S,categoryId:(se=o.value)==null?void 0:se.id}),c.value=[]}finally{m.value=!1}}function Z(){e.value===2?(e.value=1,a.value==="categories"?l.value=null:d.value=null,c.value=[],p.value=null):e.value===1&&(e.value=0,a.value==="categories"?(o.value=null,O.value=[]):l.value=null)}function ae(S){console.log(`[ResponsibleModal] Sort mode changed: ${ee.value} -> ${S}`);const n=performance.now();ee.value=S,setTimeout(()=>{const i=g.value,$=performance.now();console.log(`[ResponsibleModal] Filtering completed in ${($-n).toFixed(2)}ms, ${i.length} tickets shown`)},0)}function ve(S){const n=dt(S.id);window.open(n,"_blank")}function fe(){a.value==="employees"&&d.value?G(d.value.tickets):a.value==="categories"&&l.value&&X(l.value.id)}return Me(()=>t.isVisible,S=>{if(S){console.log("[TASK-070] ResponsibleModal opened for week",t.weekNumber),console.log("[TASK-070] ResponsibleModal props types:",{responsibleCreatedThisWeekType:typeof t.responsibleCreatedThisWeek,responsibleCreatedThisWeekIsArray:Array.isArray(t.responsibleCreatedThisWeek),responsibleCreatedThisWeekLength:Array.isArray(t.responsibleCreatedThisWeek)?t.responsibleCreatedThisWeek.length:"not array",responsibleCreatedOtherWeekType:typeof t.responsibleCreatedOtherWeek,responsibleCreatedOtherWeekIsArray:Array.isArray(t.responsibleCreatedOtherWeek),responsibleCreatedOtherWeekLength:Array.isArray(t.responsibleCreatedOtherWeek)?t.responsibleCreatedOtherWeek.length:"not array"}),console.log("[TASK-070] ResponsibleModal data:",{weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,responsibleCreatedThisWeek:Array.isArray(t.responsibleCreatedThisWeek)?t.responsibleCreatedThisWeek.length:t.responsibleCreatedThisWeek?"not array":"null/undefined",responsibleCreatedOtherWeek:Array.isArray(t.responsibleCreatedOtherWeek)?t.responsibleCreatedOtherWeek.length:t.responsibleCreatedOtherWeek?"not array":"null/undefined",closedTicketsCreatedThisWeek:t.closedTicketsCreatedThisWeek,closedTicketsCreatedOtherWeek:t.closedTicketsCreatedOtherWeek}),console.log("[TASK-070] ResponsibleModal detailed data:",{responsibleCreatedThisWeek:t.responsibleCreatedThisWeek,responsibleCreatedOtherWeek:t.responsibleCreatedOtherWeek,responsibleCreatedThisWeekWithTickets:Array.isArray(t.responsibleCreatedThisWeek)?t.responsibleCreatedThisWeek.map(i=>{var $;return{id:i.id,name:i.name,count:i.count,hasTickets:!!i.tickets,ticketsCount:(($=i.tickets)==null?void 0:$.length)||0}}):"not array or null",responsibleCreatedOtherWeekWithTickets:Array.isArray(t.responsibleCreatedOtherWeek)?t.responsibleCreatedOtherWeek.map(i=>{var $;return{id:i.id,name:i.name,count:i.count,hasTickets:!!i.tickets,ticketsCount:(($=i.tickets)==null?void 0:$.length)||0}}):"not array or null"});const n=t.weekNumber;n&&console.log("[TASK-070] ResponsibleModal: Week number",n)}else e.value=0,a.value="categories",o.value=null,l.value=null,d.value=null,c.value=[],p.value=null,O.value=[],P.value=[]}),(S,n)=>s.isVisible?(y(),f("div",Rn,[r("div",Pn,[e.value===0?(y(),f("div",xn,[r("button",{class:pe(["modal__tab",{"modal__tab--active":a.value==="categories"}]),onClick:n[0]||(n[0]=i=>h("categories"))}," –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º ",2),r("button",{class:pe(["modal__tab",{"modal__tab--active":a.value==="employees"}]),onClick:n[1]||(n[1]=i=>h("employees"))}," –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º ",2)])):ne("",!0),ke($e,{name:"level",mode:"out-in"},{default:ge(()=>{var i,$,I,F;return[a.value==="categories"&&e.value===0?(y(),f("div",Ln,[r("header",Fn,[r("h3",Gn,[n[12]||(n[12]=Te(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s.weekNumber?(y(),f("span",Hn," ¬∑ –ù–µ–¥–µ–ª—è "+A(s.weekNumber),1)):ne("",!0)]),r("button",{class:"modal__close",onClick:n[2]||(n[2]=w=>S.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",Vn,[r("ul",Kn,[(y(!0),f(ye,null,me(U.value,w=>(y(),f("li",{key:w.id,class:pe(["categories-list__item",{"categories-list__item--clickable":w.count>0}]),onClick:V=>x(w)},[r("div",jn,[r("div",zn,[w.id==="created-this-week"?(y(),f("span",qn,"‚úì")):(y(),f("span",Zn,"‚Üª"))]),r("div",Xn,[r("div",Jn,A(w.label),1),r("div",Qn,A(w.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),w.count>0?(y(),f("span",el,"‚Üí")):ne("",!0)])],10,Yn))),128))])]),r("footer",tl,[r("button",{class:"btn",onClick:n[3]||(n[3]=w=>S.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value==="categories"&&e.value===1?(y(),f("div",rl,[r("header",al,[r("button",{class:"btn-back",onClick:Z,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),n[13]||(n[13]=r("h3",{class:"modal__title"},"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),r("button",{class:"modal__close",onClick:n[4]||(n[4]=w=>S.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",sl,[ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>[re.value?(y(),f("div",ol,[...n[14]||(n[14]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):N.value?(y(),f("ul",ll,[(y(!0),f(ye,null,me(O.value,w=>(y(),f("li",{key:w.id||w.name,class:pe(["responsible-list__item",{"responsible-list__item--clickable":w.id&&w.count>0}]),onClick:V=>L(w,V),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[r("span",cl,A(w.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),r("span",dl,A(w.count??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),w.id&&w.count>0?(y(),f("span",ul,"‚Üí")):ne("",!0)],10,il))),128))])):(y(),f("p",nl,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º"))]),_:1})]),r("footer",kl,[r("button",{class:"btn",onClick:n[5]||(n[5]=w=>S.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value==="categories"&&e.value===2?(y(),f("div",vl,[r("header",hl,[r("button",{class:"btn-back",onClick:Z,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),r("h3",yl,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+A(((i=l.value)==null?void 0:i.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),r("button",{class:"modal__close",onClick:n[6]||(n[6]=w=>S.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",ml,[r("div",pl,[n[15]||(n[15]=r("h4",{class:"time-sort-title"},"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–∏–∫–µ—Ç—ã:",-1)),r("div",gl,[(y(!0),f(ye,null,me(E.value,w=>(y(),f("button",{key:w.key,class:pe(["time-sort-btn",{active:ee.value===w.key}]),onClick:V=>ae(w.key)},[Te(A(w.label)+" ",1),r("span",bl,"("+A(w.count)+")",1)],10,fl))),128))])]),ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>[m.value?(y(),f("div",_l,[...n[16]||(n[16]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):p.value?(y(),f("div",wl,[n[17]||(n[17]=r("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),n[18]||(n[18]=r("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),r("p",Tl,A(p.value),1),r("button",{class:"btn btn-retry",onClick:fe},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):g.value.length===0?(y(),f("div",Cl,[n[19]||(n[19]=r("div",{class:"empty-state-icon"},"üìã",-1)),r("p",Wl," –£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ("+A(Ve(He)[ee.value])+") ",1)])):(y(),f("div",Al,[ke(tt,{name:"ticket",tag:"div",class:"tickets-list"},{default:ge(()=>[(y(!0),f(ye,null,me(g.value,(w,V)=>(y(),Ee(rt,{key:w.id,ticket:w,draggable:!1,style:Ue({"--ticket-index":V}),onClick:ve},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):a.value==="employees"&&e.value===0?(y(),f("div",$l,[r("header",Sl,[r("h3",Dl,[n[20]||(n[20]=Te(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s.weekNumber?(y(),f("span",El," ¬∑ –ù–µ–¥–µ–ª—è "+A(s.weekNumber),1)):ne("",!0)]),r("button",{class:"modal__close",onClick:n[7]||(n[7]=w=>S.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",Nl,[ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>[re.value?(y(),f("div",Ol,[...n[21]||(n[21]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):_.value?(y(),f("ul",Il,[(y(!0),f(ye,null,me(P.value,w=>(y(),f("li",{key:w.id||w.name,class:pe(["responsible-list__item",{"responsible-list__item--clickable":w.id&&w.totalCount>0}]),onClick:V=>D(w,V),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞–¥–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[r("span",Ul,A(w.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),r("span",Rl,A(w.totalCount??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),w.id&&w.totalCount>0?(y(),f("span",Pl,"‚Üí")):ne("",!0)],10,Ml))),128))])):(y(),f("p",Bl,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"))]),_:1})]),r("footer",xl,[r("button",{class:"btn",onClick:n[8]||(n[8]=w=>S.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value==="employees"&&e.value===1?(y(),f("div",Ll,[r("header",Fl,[r("button",{class:"btn-back",onClick:Z,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),r("h3",Gl,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+A((($=l.value)==null?void 0:$.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),r("button",{class:"modal__close",onClick:n[9]||(n[9]=w=>S.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",Hl,[r("ul",Vl,[(y(!0),f(ye,null,me(T.value,w=>(y(),f("li",{key:w.id,class:pe(["categories-list__item",{"categories-list__item--clickable":w.count>0}]),onClick:V=>R(w)},[r("div",Yl,[r("div",jl,[w.id==="this-week"?(y(),f("span",zl,"‚úì")):(y(),f("span",ql,"‚Üª"))]),r("div",Zl,[r("div",Xl,A(w.label),1),r("div",Jl,A(w.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),w.count>0?(y(),f("span",Ql,"‚Üí")):ne("",!0)])],10,Kl))),128))])]),r("footer",ei,[r("button",{class:"btn",onClick:n[10]||(n[10]=w=>S.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value==="employees"&&e.value===2?(y(),f("div",ti,[r("header",ri,[r("button",{class:"btn-back",onClick:Z,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),r("h3",ai," –¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+A(((I=l.value)==null?void 0:I.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")+" ("+A(((F=d.value)==null?void 0:F.label)||"")+") ",1),r("button",{class:"modal__close",onClick:n[11]||(n[11]=w=>S.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",si,[ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>{var w;return[m.value?(y(),f("div",oi,[...n[22]||(n[22]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):p.value?(y(),f("div",ni,[n[23]||(n[23]=r("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),n[24]||(n[24]=r("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),r("p",li,A(p.value),1),r("button",{class:"btn btn-retry",onClick:fe},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):c.value.length===0?(y(),f("div",ii,[n[25]||(n[25]=r("div",{class:"empty-state-icon"},"üìã",-1)),r("p",ci,A(a.value==="employees"?`–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${((w=d.value)==null?void 0:w.label)||""}"`:"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é"),1)])):(y(),f("div",di,[ke(tt,{name:"ticket",tag:"div",class:"tickets-list"},{default:ge(()=>[(y(!0),f(ye,null,me(g.value,(V,oe)=>(y(),Ee(rt,{key:V.id,ticket:V,draggable:!1,style:Ue({"--ticket-index":oe}),onClick:ve},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):ne("",!0)]}),_:1})])])):ne("",!0)}},ki=Be(ui,[["__scopeId","data-v-6f43202a"]]),vi={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},hi={class:"modal"},yi={key:"level-1",class:"level-1"},mi={class:"modal__header"},pi={class:"modal__title"},gi={key:0},fi={class:"modal__body"},bi={key:"loading",class:"loading-names"},_i={key:"empty",class:"modal__empty"},wi={key:"list",class:"stages-list"},Ti=["onClick"],Ci={class:"stages-list__name"},Wi={class:"stages-list__count"},Ai={key:0,class:"stages-list__arrow"},$i={class:"modal__footer"},Si={key:"level-2",class:"level-2"},Di={class:"modal__header"},Ei={class:"modal__title"},Ni={class:"modal__body"},Oi={class:"time-sort-controls"},Bi={class:"time-sort-buttons"},Ii=["onClick"],Mi={class:"count"},Ui={key:"loading",class:"loading-state"},Ri={key:"error",class:"error-state"},Pi={class:"error-message"},xi={key:"empty",class:"empty-state"},Li={class:"empty-state-message"},Fi={key:"tickets",class:"tickets-list-container"},Gi={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(s,{emit:t}){const e=s,a=Q(1),o=Q(null),l=Q([]),d=Q(!1),c=Q(!1),m=Q(null),p=Q([]),O=Q(Ne.ONE_MONTH),P=q(()=>p.value.length>0&&p.value.some(N=>N.count>0)),re=q(()=>{if(!l.value||l.value.length===0)return[];try{const N=performance.now(),h=at(l.value,O.value),x=performance.now();return console.log(`[StagesModal] Filtering took ${(x-N).toFixed(2)}ms, results: ${h.length}`),h}catch(N){return console.error("[StagesModal] Error filtering tickets:",N),[]}}),ee=q(()=>Object.keys(He).map(N=>({key:N,label:He[N],count:at(l.value,N).length})));async function U(){var N;if(console.log("[TASK-070] StagesModal: loadStages called",{weekNumber:e.weekNumber,weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc}),!e.weekStartUtc||!e.weekEndUtc){console.warn("[TASK-070] StagesModal: Missing week boundaries, cannot load stages"),p.value=[];return}c.value=!0,m.value=null;try{console.log("[TASK-070] StagesModal: Fetching stages from API...");const h=await Oe({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeNewTicketsByStages:!0});console.log("[TASK-070] StagesModal: API response received",{hasNewTicketsByStages:!!h.data.newTicketsByStages,stagesCount:((N=h.data.newTicketsByStages)==null?void 0:N.length)||0}),p.value=h.data.newTicketsByStages||[],p.value.length===0?console.warn("[TASK-070] StagesModal: API returned empty stages array for week",e.weekNumber):console.log("[TASK-070] StagesModal: Stages loaded successfully",p.value.length,"stages")}catch(h){m.value=h.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–π",console.error("[TASK-070] StagesModal: Error loading stages:",h),p.value=[]}finally{c.value=!1}}async function M(N,h=null){!N||N.count===0||(h&&h.currentTarget&&(h.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{h.currentTarget&&(h.currentTarget.style.transform="")},150)),o.value=N,a.value=2,await T(N.stageId))}async function T(N){var h;d.value=!0,m.value=null;try{const x=p.value.find(H=>H.stageId===N);if(x&&Array.isArray(x.tickets)&&x.tickets.length>0){console.log("[TASK-070] StagesModal: Using preloaded tickets for stage",N,"count:",x.tickets.length);const H=x.tickets;try{const{prepareTicketsForDisplay:L}=await Re(async()=>{const{prepareTicketsForDisplay:X}=await import("./ticketListUtils-BoUj61Ng.js").then(Z=>Z.t);return{prepareTicketsForDisplay:X}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);l.value=await L(H,null,null)}catch(L){console.error("[TASK-070] StagesModal: Error preparing tickets:",L),l.value=H}d.value=!1;return}if(console.log("[TASK-070] StagesModal: Tickets not preloaded, loading from API for stage",N),!e.weekStartUtc||!e.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const R=(h=(await Oe({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:h.find(H=>H.stageId===N),G=(R==null?void 0:R.tickets)||[];try{const{prepareTicketsForDisplay:H}=await Re(async()=>{const{prepareTicketsForDisplay:L}=await import("./ticketListUtils-BoUj61Ng.js").then(X=>X.t);return{prepareTicketsForDisplay:L}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);l.value=await H(G,null,null)}catch(H){console.error("[StagesModal] Error preparing tickets:",H),l.value=G}l.value.length===0&&(m.value=null)}catch(x){m.value=x.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[StagesModal] Error loading tickets:",x),l.value=[]}finally{d.value=!1}}function _(){a.value=1,o.value=null,l.value=[],m.value=null}function g(N){const h=dt(N.id);window.open(h,"_blank")}function E(){o.value&&T(o.value.stageId)}function B(N){console.log(`[StagesModal] Sort mode changed: ${O.value} -> ${N}`);const h=performance.now();O.value=N,setTimeout(()=>{const x=re.value,D=performance.now();console.log(`[StagesModal] Filtering completed in ${(D-h).toFixed(2)}ms, ${x.length} tickets shown`)},0)}return Me(()=>e.isVisible,async N=>{N?(a.value=1,o.value=null,l.value=[],m.value=null,console.log("[TASK-070] StagesModal opened:",{weekNumber:e.weekNumber,weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,preloadedData:e.preloadedData?Array.isArray(e.preloadedData)?`Array(${e.preloadedData.length})`:typeof e.preloadedData:"null"}),e.preloadedData&&Array.isArray(e.preloadedData)&&e.preloadedData.length>0?(console.log("[TASK-070] StagesModal: Using preloaded data, stages count:",e.preloadedData.length),e.preloadedData.every(x=>x.stageId&&x.stageName&&typeof x.count=="number")?(p.value=e.preloadedData,c.value=!1,console.log("[TASK-070] StagesModal: Preloaded data set, stages:",p.value.length)):(console.warn("[TASK-070] StagesModal: Invalid preloaded data structure, falling back to API"),await U())):(console.log("[TASK-070] StagesModal: No preloaded data, loading from API",{weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc}),await U())):(a.value=1,o.value=null,l.value=[],m.value=null,p.value=[])},{immediate:!1}),Me([()=>e.weekNumber,()=>e.preloadedData],async([N,h])=>{e.isVisible&&N&&(h&&Array.isArray(h)&&h.length>0?h.every(D=>D.stageId&&D.stageName&&typeof D.count=="number")?(console.log("[TASK-070] StagesModal: Week changed, updating with preloaded data for week",N),p.value=h,c.value=!1):(console.log("[TASK-070] StagesModal: Week changed, invalid preloaded data, loading from API for week",N),await U()):(console.log("[TASK-070] StagesModal: Week changed, loading from API for week",N),await U()))}),(N,h)=>s.isVisible?(y(),f("div",vi,[r("div",hi,[ke($e,{name:"level",mode:"out-in"},{default:ge(()=>{var x;return[a.value===1?(y(),f("div",yi,[r("header",mi,[r("h3",pi,[h[3]||(h[3]=Te(" –ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),s.weekNumber?(y(),f("span",gi," ¬∑ –ù–µ–¥–µ–ª—è "+A(s.weekNumber),1)):ne("",!0)]),r("button",{class:"modal__close",onClick:h[0]||(h[0]=D=>N.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",fi,[ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>[c.value?(y(),f("div",bi,[...h[4]||(h[4]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–π...",-1)])])):P.value?(y(),f("ul",wi,[(y(!0),f(ye,null,me(p.value,D=>(y(),f("li",{key:D.stageId,class:pe(["stages-list__item",{"stages-list__item--clickable":D.count>0}]),style:Ue({"--stage-color":D.color}),onClick:R=>M(D,R),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏"},[r("span",{class:"stages-list__color",style:Ue({backgroundColor:D.color})},null,4),r("span",Ci,A(D.stageName),1),r("span",Wi,A(D.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),D.count>0?(y(),f("span",Ai,"‚Üí")):ne("",!0)],14,Ti))),128))])):(y(),f("p",_i," –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),r("footer",$i,[r("button",{class:"btn",onClick:h[1]||(h[1]=D=>N.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value===2?(y(),f("div",Si,[r("header",Di,[r("button",{class:"btn-back",onClick:_,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),r("h3",Ei," –¢–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏: "+A(((x=o.value)==null?void 0:x.stageName)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),r("button",{class:"modal__close",onClick:h[2]||(h[2]=D=>N.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",Ni,[r("div",Oi,[h[5]||(h[5]=r("h4",{class:"time-sort-title"},"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–∏–∫–µ—Ç—ã:",-1)),r("div",Bi,[(y(!0),f(ye,null,me(ee.value,D=>(y(),f("button",{key:D.key,class:pe(["time-sort-btn",{active:O.value===D.key}]),onClick:R=>B(D.key)},[Te(A(D.label)+" ",1),r("span",Mi,"("+A(D.count)+")",1)],10,Ii))),128))])]),ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>{var D;return[d.value?(y(),f("div",Ui,[...h[6]||(h[6]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏...",-1),r("p",{class:"loading-subtitle"},"–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö",-1)])])):m.value?(y(),f("div",Ri,[h[7]||(h[7]=r("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),h[8]||(h[8]=r("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),r("p",Pi,A(m.value),1),r("button",{class:"btn btn-retry",onClick:E},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):re.value.length===0?(y(),f("div",xi,[h[9]||(h[9]=r("div",{class:"empty-state-icon"},"üìã",-1)),r("p",Li," –ù–∞ —Å—Ç–∞–¥–∏–∏ ¬´"+A((D=o.value)==null?void 0:D.stageName)+"¬ª –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ("+A(Ve(He)[O.value])+") ",1)])):(y(),f("div",Fi,[ke(tt,{name:"ticket",tag:"div",class:"tickets-list"},{default:ge(()=>[(y(!0),f(ye,null,me(re.value,(R,G)=>(y(),Ee(rt,{key:R.id,ticket:R,draggable:!1,style:Ue({"--ticket-index":G}),onClick:g},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):ne("",!0)]}),_:1})])])):ne("",!0)}},Hi=Be(Gi,[["__scopeId","data-v-0dacaef9"]]),Ge=new Map,Vi=5*60*1e3;function Ki(s,t){return`${s}:${JSON.stringify(t)}`}function Nt(s){return Date.now()-s.timestamp<Vi}function Yi(s,t){if(Ge.set(s,{data:t,timestamp:Date.now()}),Ge.size>20){const e=Ge.keys().next().value;Ge.delete(e)}}function ji(s){const t=Ge.get(s);return t&&Nt(t)?(console.log("[API-CACHE] Cache hit for key:",s),t.data):(t&&!Nt(t)&&(console.log("[API-CACHE] Cache expired for key:",s),Ge.delete(s)),null)}async function zi(s={}){const t="/api/graph-1c-admission-closure.php",e=Ki(t,s),a=ji(t);if(a)return a;console.log("[API-CACHE] Cache miss, making API request for:",e);const{fetchAdmissionClosureStats:o}=await Re(async()=>{const{fetchAdmissionClosureStats:d}=await Promise.resolve().then(()=>_n);return{fetchAdmissionClosureStats:d}},void 0,import.meta.url),l=await o(s);return Yi(e,l),l}async function qi(s,t){return zi({product:"1C",weekStartUtc:s,weekEndUtc:t,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})}const Zi={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Xi={class:"modal"},Ji={key:"level-1",class:"level-1"},Qi={class:"modal__header"},ec={class:"modal__title"},tc={key:0},rc={class:"modal__body"},ac={key:"loading",class:"loading-names"},sc={key:"empty",class:"modal__empty"},oc={key:"list",class:"duration-list"},nc=["onClick"],lc={class:"duration-list__name"},ic={class:"duration-list__count"},cc={key:0,class:"duration-list__arrow"},dc={class:"modal__footer"},uc={key:"level-2",class:"level-2"},kc={class:"modal__header"},vc={class:"modal__title"},hc={class:"modal__body"},yc={key:"loading",class:"loading-state"},mc={key:"error",class:"error-state"},pc={class:"error-message"},gc={key:"empty",class:"empty-state"},fc={class:"empty-state-message"},bc={key:"tickets",class:"tickets-list-container"},_c={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(s,{emit:t}){const e=s,a=Q(1),o=Q(null),l=Q([]),d=Q(!1),c=Q(!1),m=Q(null),p=Q([]),O=q(()=>p.value.length>0&&p.value.some(_=>_.count>0));async function P(){if(!e.weekStartUtc||!e.weekEndUtc){p.value=[];return}c.value=!0,m.value=null;try{const _=await Oe({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});p.value=_.data.carryoverTicketsByDuration||[]}catch(_){m.value=_.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π",console.error("[CarryoverDurationModal] Error loading categories:",_),p.value=[]}finally{c.value=!1}}async function re(_,g=null){!_||_.count===0||(g&&g.currentTarget&&(g.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{g.currentTarget&&(g.currentTarget.style.transform="")},150)),o.value=_,a.value=2,await ee(_.durationCategory))}async function ee(_){var g;d.value=!0,m.value=null;try{const E=p.value.find(x=>x.durationCategory===_);if(E&&Array.isArray(E.tickets)&&E.tickets.length>0){console.log("[TASK-070] CarryoverDurationModal: Using preloaded tickets for category",_,"count:",E.tickets.length);const x=E.tickets;try{const{prepareTicketsForDisplay:D}=await Re(async()=>{const{prepareTicketsForDisplay:R}=await import("./ticketListUtils-BoUj61Ng.js").then(G=>G.t);return{prepareTicketsForDisplay:R}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);l.value=await D(x,null,null)}catch(D){console.error("[TASK-070] CarryoverDurationModal: Error preparing tickets:",D),l.value=x}d.value=!1;return}if(console.log("[TASK-070] CarryoverDurationModal: Tickets not preloaded, loading from API for category",_),!e.weekStartUtc||!e.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const N=(g=(await qi(e.weekStartUtc,e.weekEndUtc)).data.carryoverTicketsByDuration)==null?void 0:g.find(x=>x.durationCategory===_),h=(N==null?void 0:N.tickets)||[];try{const{prepareTicketsForDisplay:x}=await Re(async()=>{const{prepareTicketsForDisplay:D}=await import("./ticketListUtils-BoUj61Ng.js").then(R=>R.t);return{prepareTicketsForDisplay:D}},__vite__mapDeps([2,3,0,1,4,5]),import.meta.url);l.value=await x(h,null,null)}catch(x){console.error("[CarryoverDurationModal] Error preparing tickets:",x),l.value=h}l.value.length===0&&(m.value=null)}catch(E){m.value=E.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[CarryoverDurationModal] Error loading tickets:",E),l.value=[]}finally{d.value=!1}}function U(){a.value=1,o.value=null,l.value=[],m.value=null}function M(_){const g=dt(_.id);window.open(g,"_blank")}function T(){o.value&&ee(o.value.durationCategory)}return Me(()=>e.isVisible,async _=>{_?(a.value=1,o.value=null,l.value=[],m.value=null,e.preloadedData&&Array.isArray(e.preloadedData)&&e.preloadedData.length>0?(console.log("[TASK-070] CarryoverDurationModal: Using preloaded data, categories count:",e.preloadedData.length),e.preloadedData.every(E=>E.durationCategory&&E.durationLabel&&typeof E.count=="number")?(p.value=e.preloadedData,c.value=!1):(console.warn("[TASK-070] CarryoverDurationModal: Invalid preloaded data structure, falling back to API"),await P())):(console.log("[TASK-070] CarryoverDurationModal: No preloaded data, loading from API"),await P())):(a.value=1,o.value=null,l.value=[],m.value=null,p.value=[])},{immediate:!1}),Me([()=>e.weekNumber,()=>e.preloadedData],async([_,g])=>{e.isVisible&&_&&(g&&Array.isArray(g)&&g.length>0?g.every(B=>B.durationCategory&&B.durationLabel&&typeof B.count=="number")?(console.log("[TASK-070] CarryoverDurationModal: Week changed, updating with preloaded data for week",_),p.value=g,c.value=!1):(console.log("[TASK-070] CarryoverDurationModal: Week changed, invalid preloaded data, loading from API for week",_),await P()):(console.log("[TASK-070] CarryoverDurationModal: Week changed, loading from API for week",_),await P()))}),(_,g)=>s.isVisible?(y(),f("div",Zi,[r("div",Xi,[ke($e,{name:"level",mode:"out-in"},{default:ge(()=>{var E;return[a.value===1?(y(),f("div",Ji,[r("header",Qi,[r("h3",ec,[g[3]||(g[3]=Te(" –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ä–æ–∫–∞–º",-1)),s.weekNumber?(y(),f("span",tc," ¬∑ –ù–µ–¥–µ–ª—è "+A(s.weekNumber),1)):ne("",!0)]),r("button",{class:"modal__close",onClick:g[0]||(g[0]=B=>_.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",rc,[ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>[c.value?(y(),f("div",ac,[...g[4]||(g[4]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...",-1)])])):O.value?(y(),f("ul",oc,[(y(!0),f(ye,null,me(p.value,B=>(y(),f("li",{key:B.durationCategory,class:pe(["duration-list__item",{"duration-list__item--clickable":B.count>0}]),style:Ue({"--duration-color":B.color}),onClick:N=>re(B,N),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},[r("span",{class:"duration-list__color",style:Ue({backgroundColor:B.color})},null,4),r("span",lc,A(B.durationLabel),1),r("span",ic,A(B.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),B.count>0?(y(),f("span",cc,"‚Üí")):ne("",!0)],14,nc))),128))])):(y(),f("p",sc," –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),r("footer",dc,[r("button",{class:"btn",onClick:g[1]||(g[1]=B=>_.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):a.value===2?(y(),f("div",uc,[r("header",kc,[r("button",{class:"btn-back",onClick:U,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),r("h3",vc," –¢–∏–∫–µ—Ç—ã: "+A(((E=o.value)==null?void 0:E.durationLabel)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),r("button",{class:"modal__close",onClick:g[2]||(g[2]=B=>_.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),r("section",hc,[ke($e,{name:"loading",mode:"out-in"},{default:ge(()=>{var B;return[d.value?(y(),f("div",yc,[...g[5]||(g[5]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...",-1),r("p",{class:"loading-subtitle"},"–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö",-1)])])):m.value?(y(),f("div",mc,[g[6]||(g[6]=r("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),g[7]||(g[7]=r("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),r("p",pc,A(m.value),1),r("button",{class:"btn btn-retry",onClick:T},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):l.value.length===0?(y(),f("div",gc,[g[8]||(g[8]=r("div",{class:"empty-state-icon"},"üìã",-1)),r("p",fc," –í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´"+A((B=o.value)==null?void 0:B.durationLabel)+"¬ª –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ ",1)])):(y(),f("div",bc,[ke(tt,{name:"ticket",tag:"div",class:"tickets-list"},{default:ge(()=>[(y(!0),f(ye,null,me(l.value,(N,h)=>(y(),Ee(rt,{key:N.id,ticket:N,draggable:!1,style:Ue({"--ticket-index":h}),onClick:M},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):ne("",!0)]}),_:1})])])):ne("",!0)}},wc=Be(_c,[["__scopeId","data-v-f199806c"]]),Tc={class:"ac-dashboard"},Cc={key:"preloader",class:"chart-preloader"},Wc={class:"preloader-content"},Ac={class:"preloader-message"},$c={key:"content"},Sc={key:1,class:"weeks-dashboard"},Dc={class:"dashboard-header"},Ec={class:"header-content"},Nc={class:"breadcrumbs-row"},Oc=["aria-label","aria-disabled","data-fallback","disabled"],Bc={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Ic={class:"dashboard-layout"},Mc={class:"filters-container"},Uc={class:"chart-container"},Rc={__name:"GraphAdmissionClosureDashboard",setup(s){const t=It(),e=Q(!1),a=Q(null),o=Q(null),l=Q({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),d=Q(!1),c=Q(!1),m=Q(!1),p=Q(!0),O=Q(null),P=Q({weeks:new Map,currentWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null},previousWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null}}),re=q(()=>{var v;const u=((v=o.value)==null?void 0:v.weeks)||[];return u.length>=2?u[u.length-2]:null}),ee=Q(!1),U=q(()=>typeof window>"u"?!1:window.history.length>1),M=q(()=>U.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),T={name:"dashboard-sector-1c"};function _(u){var v;if((v=u==null?void 0:u.preventDefault)==null||v.call(u),!ee.value){ee.value=!0;try{if(U.value){t.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),t.push(T)}finally{ee.value=!1}}}function g(){t.push("/")}const E=Q({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),B=Q("weeks"),N=q(()=>{const u=E.value.customDateRange.startDate||E.value.customDateRange.endDate,v=E.value.employees.length===1&&E.value.employees.includes("all");return u||!v});async function h(){var v,Y,te,le;if(console.log("[DEBUG] loadData called"),console.log("[DEBUG] periodMode:",B.value),console.log("[DEBUG] isLoading before:",e.value),B.value!=="weeks"){console.log("[DEBUG] loadData: periodMode is not weeks, returning and resetting isLoading"),e.value=!1;return}console.log("[DEBUG] Setting isLoading to true"),e.value=!0,a.value=null;const u=new Promise(se=>setTimeout(se,300));try{console.log("[DEBUG] Starting API call");const se=K(),j=se.weekStartUtc,C=se.weekEndUtc;console.log("[DEBUG] Week bounds:",{weekStartUtc:j,weekEndUtc:C});const[ie,he]=await Promise.all([u,Oe({product:"1C",periodMode:"weeks",weekStartUtc:j,weekEndUtc:C,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0})]);console.log("[DEBUG] API call successful, result:",he);const{meta:de,data:z,carryoverDebug:_e}=he;o.value=de;const Se=Array.isArray(z.responsibleCreatedThisWeek)?z.responsibleCreatedThisWeek:z.responsibleCreatedThisWeek?Object.values(z.responsibleCreatedThisWeek):[],De=Array.isArray(z.responsibleCreatedOtherWeek)?z.responsibleCreatedOtherWeek:z.responsibleCreatedOtherWeek?Object.values(z.responsibleCreatedOtherWeek):[];l.value={...z,responsibleCreatedThisWeek:Se,responsibleCreatedOtherWeek:De},console.log("[DEBUG] Data set, meta:",de,"data keys:",Object.keys(z)),console.log("[TASK-070] chartData.value.responsibleCreatedThisWeek after normalization:",{isArray:Array.isArray(Se),length:Se.length,sample:Se.slice(0,2).map(J=>{var ce;return{id:J.id,name:J.name,count:J.count,hasTickets:!!J.tickets,ticketsCount:((ce=J.tickets)==null?void 0:ce.length)||0}})}),console.log("[TASK-070] chartData.value.responsibleCreatedOtherWeek after normalization:",{isArray:Array.isArray(De),length:De.length,sample:De.slice(0,2).map(J=>{var ce;return{id:J.id,name:J.name,count:J.count,hasTickets:!!J.tickets,ticketsCount:((ce=J.tickets)==null?void 0:ce.length)||0}})}),console.log("[TASK-070] responsibleCreatedThisWeek from API:",{count:((v=z.responsibleCreatedThisWeek)==null?void 0:v.length)||0,data:z.responsibleCreatedThisWeek,details:(Y=z.responsibleCreatedThisWeek)==null?void 0:Y.map(J=>{var ce;return{id:J.id,name:J.name,count:J.count,hasTickets:!!J.tickets,ticketsCount:((ce=J.tickets)==null?void 0:ce.length)||0}})}),console.log("[TASK-070] responsibleCreatedOtherWeek from API:",{count:((te=z.responsibleCreatedOtherWeek)==null?void 0:te.length)||0,data:z.responsibleCreatedOtherWeek,details:(le=z.responsibleCreatedOtherWeek)==null?void 0:le.map(J=>{var ce;return{id:J.id,name:J.name,count:J.count,hasTickets:!!J.tickets,ticketsCount:((ce=J.tickets)==null?void 0:ce.length)||0}})}),console.log("[TASK-070] closedTicketsCreatedThisWeek:",z.closedTicketsCreatedThisWeek),console.log("[TASK-070] closedTicketsCreatedOtherWeek:",z.closedTicketsCreatedOtherWeek);const Ce=(de==null?void 0:de.weeks)||[];if(console.log("[PERF-OPTIMIZATION] Preloading popup data for",Ce.length,"weeks"),Ce.forEach((J,ce)=>{P.value.weeks.has(J.weekNumber)||P.value.weeks.set(J.weekNumber,{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:J});const ue=P.value.weeks.get(J.weekNumber);ce===Ce.length-1&&(z.newTicketsByStages&&(ue.newTicketsByStages=z.newTicketsByStages,console.log("[PERF-OPTIMIZATION] Preloaded newTicketsByStages for week",J.weekNumber,":",z.newTicketsByStages.length,"stages")),z.carryoverTicketsByDuration&&(ue.carryoverTicketsByDuration=z.carryoverTicketsByDuration,console.log("[PERF-OPTIMIZATION] Preloaded carryoverTicketsByDuration for week",J.weekNumber,":",z.carryoverTicketsByDuration.length,"categories")))}),z.newTicketsByStages&&(P.value.currentWeek.newTicketsByStages=z.newTicketsByStages),z.carryoverTicketsByDuration&&(P.value.currentWeek.carryoverTicketsByDuration=z.carryoverTicketsByDuration),Ce.length>1&&R(Ce.slice(0,-1)),z.responsibleCreatedThisWeek){const J=Array.isArray(z.responsibleCreatedThisWeek)?z.responsibleCreatedThisWeek:Object.values(z.responsibleCreatedThisWeek);P.value.currentWeek.responsibleCreatedThisWeek=J,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for current week:",J.length,"employees"),console.log("[TASK-070] responsibleCreatedThisWeek details:",J.map(ce=>{var ue;return{id:ce.id,name:ce.name,count:ce.count,hasTickets:!!ce.tickets,ticketsCount:((ue=ce.tickets)==null?void 0:ue.length)||0}}))}if(z.responsibleCreatedOtherWeek){const J=Array.isArray(z.responsibleCreatedOtherWeek)?z.responsibleCreatedOtherWeek:Object.values(z.responsibleCreatedOtherWeek);P.value.currentWeek.responsibleCreatedOtherWeek=J,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for current week:",J.length,"employees"),console.log("[TASK-070] responsibleCreatedOtherWeek details:",J.map(ce=>{var ue;return{id:ce.id,name:ce.name,count:ce.count,hasTickets:!!ce.tickets,ticketsCount:((ue=ce.tickets)==null?void 0:ue.length)||0}}))}if(_e&&(console.log("[CARRYOVER-DEBUG] ========================================"),console.log("[CARRYOVER-DEBUG] Total:",_e.total),console.log("[CARRYOVER-DEBUG] ThisWeek:",_e.thisWeek),console.log("[CARRYOVER-DEBUG] PreviousWeek:",_e.previousWeek),console.log("[CARRYOVER-DEBUG] Older:",_e.older),console.log("[CARRYOVER-DEBUG] Sum:",_e.sum,"(expected:",_e.total,")"),console.log("[CARRYOVER-DEBUG] Series:",_e.series),console.log("[CARRYOVER-DEBUG] CurrentWeekData:",_e.currentWeekData),console.log("[CARRYOVER-DEBUG] WeeksData:",_e.weeksData),console.log("[CARRYOVER-DEBUG] Full object:",_e),console.log("[CARRYOVER-DEBUG] ========================================")),re.value){const J=re.value.weekStartUtc,ce=re.value.weekEndUtc;console.log("[TASK-070] Starting preload for previous week:",{weekNumber:re.value.weekNumber,weekStartUtc:J,weekEndUtc:ce}),Oe({product:"1C",periodMode:"weeks",weekStartUtc:J,weekEndUtc:ce,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0}).then(ue=>{if(console.log("[TASK-070] Preload successful for previous week"),ue.data.newTicketsByStages&&(P.value.previousWeek.newTicketsByStages=ue.data.newTicketsByStages,console.log("[TASK-070] Preloaded newTicketsByStages for previous week:",ue.data.newTicketsByStages.length,"stages")),ue.data.carryoverTicketsByDuration&&(P.value.previousWeek.carryoverTicketsByDuration=ue.data.carryoverTicketsByDuration,console.log("[TASK-070] Preloaded carryoverTicketsByDuration for previous week:",ue.data.carryoverTicketsByDuration.length,"categories")),ue.data.responsibleCreatedThisWeek){const We=Array.isArray(ue.data.responsibleCreatedThisWeek)?ue.data.responsibleCreatedThisWeek:Object.values(ue.data.responsibleCreatedThisWeek);P.value.previousWeek.responsibleCreatedThisWeek=We,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for previous week:",We.length,"employees")}if(ue.data.responsibleCreatedOtherWeek){const We=Array.isArray(ue.data.responsibleCreatedOtherWeek)?ue.data.responsibleCreatedOtherWeek:Object.values(ue.data.responsibleCreatedOtherWeek);P.value.previousWeek.responsibleCreatedOtherWeek=We,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for previous week:",We.length,"employees")}}).catch(ue=>{console.warn("[TASK-070] Failed to preload previous week data (non-critical):",ue)})}}catch(se){console.error("[DEBUG] API call failed:",se),a.value=se instanceof Error?se:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureDashboard] loadData error:",se)}finally{console.log("[DEBUG] Finally block: setting isLoading to false"),e.value=!1,console.log("[DEBUG] isLoading after:",e.value)}}function x(u){var C;if(!u||!o.value)return console.log("[TASK-070] getPreloadedStagesData: Missing weekMeta or chartMeta"),null;const v=((C=o.value)==null?void 0:C.weeks)||[],Y=v.length>0?v[v.length-1].weekNumber:o.value.weekNumber,te=v.length>=2?v[v.length-2].weekNumber:null;console.log("[TASK-070] getPreloadedStagesData:",{requestedWeek:u.weekNumber,currentWeekNumber:Y,previousWeekNumber:te,weeksInMeta:v.length});const le=u.weekNumber===Y,se=u.weekNumber===te;let j=null;if(le)j=P.value.currentWeek.newTicketsByStages,console.log("[TASK-070] Requested week is current week, checking currentWeek data:",j?`Array(${j.length})`:"null");else if(se)j=P.value.previousWeek.newTicketsByStages,console.log("[TASK-070] Requested week is previous week, checking previousWeek data:",j?`Array(${j.length})`:"null");else return console.log("[TASK-070] Requested week",u.weekNumber,"is neither current nor previous, no preloaded data available"),null;return Array.isArray(j)&&j.length>0?(console.log("[TASK-070] Using preloaded stages data for week",u.weekNumber,":",j.length,"stages"),j):(console.log("[TASK-070] No preloaded stages data for week",u.weekNumber,", will use API fallback"),null)}function D(u){var j;if(!u)return null;const v=P.value.weeks.get(u.weekNumber);if(v!=null&&v.carryoverTicketsByDuration&&Array.isArray(v.carryoverTicketsByDuration))return console.log("[PERF-OPTIMIZATION] Using preloaded carryover data for week",u.weekNumber,":",v.carryoverTicketsByDuration.length,"categories"),v.carryoverTicketsByDuration;const Y=((j=o.value)==null?void 0:j.weeks)||[],te=Y.length>0?Y[Y.length-1].weekNumber:o.value.weekNumber,se=u.weekNumber===te?P.value.currentWeek.carryoverTicketsByDuration:P.value.previousWeek.carryoverTicketsByDuration;return Array.isArray(se)&&se.length>0?(console.log("[TASK-070] Using fallback preloaded carryover data for week",u.weekNumber,":",se.length,"categories"),se):(console.log("[PERF-ISSUE] No preloaded carryover data for week",u.weekNumber,", will use slow API fallback"),null)}async function R(u){if(!(!u||u.length===0)){console.log("[PERF-OPTIMIZATION] Starting background preload for",u.length,"weeks");for(const v of u)try{await new Promise(le=>setTimeout(le,500)),console.log("[PERF-OPTIMIZATION] Preloading data for week",v.weekNumber);const Y=await Oe({product:"1C",periodMode:"weeks",weekStartUtc:v.weekStartUtc,weekEndUtc:v.weekEndUtc,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!1}),te={newTicketsByStages:Y.data.newTicketsByStages||null,carryoverTicketsByDuration:Y.data.carryoverTicketsByDuration||null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:v};P.value.weeks.set(v.weekNumber,te),console.log("[PERF-OPTIMIZATION] Successfully preloaded data for week",v.weekNumber)}catch(Y){console.warn("[PERF-OPTIMIZATION] Failed to preload data for week",v.weekNumber,":",Y)}console.log("[PERF-OPTIMIZATION] Background preload completed")}}function G(u){var le;if(!u||!o.value)return null;const v=((le=o.value)==null?void 0:le.weeks)||[],Y=v.length>0?v[v.length-1].weekNumber:o.value.weekNumber;return u.weekNumber===Y&&l.value.responsible||null}function H(u){var j;if(!u){const C=l.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: weekMeta is null, using chartData:",{hasData:!!C,isArray:Array.isArray(C),dataLength:Array.isArray(C)?C.length:C?Object.keys(C).length:0}),C?Array.isArray(C)?C:Object.values(C):null}if(!o.value)return console.log("[TASK-070] getResponsibleCreatedThisWeek: chartMeta is null"),null;const v=((j=o.value)==null?void 0:j.weeks)||[],Y=v.length>0?v[v.length-1].weekNumber:o.value.weekNumber,te=v.length>=2?v[v.length-2].weekNumber:null,le=u.weekNumber===Y,se=u.weekNumber===te;if(console.log("[TASK-070] getResponsibleCreatedThisWeek:",{requestedWeek:u.weekNumber,currentWeekNumber:Y,previousWeekNumber:te,isCurrentWeek:le,isPreviousWeek:se}),le){const C=l.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: current week data:",{hasData:!!C,isArray:Array.isArray(C),dataLength:Array.isArray(C)?C.length:C?Object.keys(C).length:0}),C?Array.isArray(C)?C:Object.values(C):null}if(se){const C=P.value.previousWeek.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: previous week data:",{hasData:!!C,isArray:Array.isArray(C),dataLength:Array.isArray(C)?C.length:0,data:C}),C||null}return console.log("[TASK-070] getResponsibleCreatedThisWeek: week",u.weekNumber,"is neither current nor previous, no preloaded data"),null}function L(u){var j;if(!u){const C=l.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: weekMeta is null, using chartData:",{hasData:!!C,isArray:Array.isArray(C),dataLength:Array.isArray(C)?C.length:C?Object.keys(C).length:0}),C?Array.isArray(C)?C:Object.values(C):null}if(!o.value)return console.log("[TASK-070] getResponsibleCreatedOtherWeek: chartMeta is null"),null;const v=((j=o.value)==null?void 0:j.weeks)||[],Y=v.length>0?v[v.length-1].weekNumber:o.value.weekNumber,te=v.length>=2?v[v.length-2].weekNumber:null,le=u.weekNumber===Y,se=u.weekNumber===te;if(console.log("[TASK-070] getResponsibleCreatedOtherWeek:",{requestedWeek:u.weekNumber,currentWeekNumber:Y,previousWeekNumber:te,isCurrentWeek:le,isPreviousWeek:se}),le){const C=l.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: current week data:",{hasData:!!C,isArray:Array.isArray(C),dataLength:Array.isArray(C)?C.length:C?Object.keys(C).length:0}),C?Array.isArray(C)?C:Object.values(C):null}if(se){const C=P.value.previousWeek.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: previous week data:",{hasData:!!C,isArray:Array.isArray(C),dataLength:Array.isArray(C)?C.length:0,data:C}),C||null}return console.log("[TASK-070] getResponsibleCreatedOtherWeek: week",u.weekNumber,"is neither current nor previous, no preloaded data"),null}function X(u){var j;if(!u||!o.value)return null;const v=((j=o.value)==null?void 0:j.weeks)||[],Y=v.length>0?v[v.length-1].weekNumber:o.value.weekNumber,te=v.length>=2?v[v.length-2].weekNumber:null,le=u.weekNumber===Y,se=u.weekNumber===te;if(le)return l.value.closedTicketsCreatedThisWeek??null;if(se&&l.value.weeksData){const C=l.value.weeksData.find(ie=>ie.weekNumber===te);return(C==null?void 0:C.closedTicketsCreatedThisWeek)??null}return null}function Z(u){var j;if(!u||!o.value)return null;const v=((j=o.value)==null?void 0:j.weeks)||[],Y=v.length>0?v[v.length-1].weekNumber:o.value.weekNumber,te=v.length>=2?v[v.length-2].weekNumber:null,le=u.weekNumber===Y,se=u.weekNumber===te;if(le)return l.value.closedTicketsCreatedOtherWeek??null;if(se&&l.value.weeksData){const C=l.value.weeksData.find(ie=>ie.weekNumber===te);return(C==null?void 0:C.closedTicketsCreatedOtherWeek)??null}return null}function ae(u){E.value.stages=u}function ve(u){E.value.employees=u}function fe(u){E.value.dateRange=u}function S(u){E.value.customDateRange=u}function n(u){if(!["weeks","months"].includes(u)){console.warn("[GraphAdmissionClosureDashboard] Invalid periodMode:",u);return}u!==B.value&&(B.value=u,u==="weeks"?h():u==="months"&&(e.value=!1))}function i(u){const{mode:v}=u.detail;["weeks","months"].includes(v)&&n(v)}function $(){E.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},I()}function I(){B.value==="weeks"&&h()}function F(u){["weeks","months"].includes(u)&&(B.value=u)}function w(){console.log("[DEBUG] handleCloseModal called"),console.log("[DEBUG] showPeriodModeInfo before:",p.value),console.log("[DEBUG] isLoading before:",e.value),console.log("[DEBUG] periodMode:",B.value),p.value=!1,e.value=!0,console.log("[DEBUG] showPeriodModeInfo after:",p.value),console.log("[DEBUG] isLoading after:",e.value),Wt(()=>{console.log("[DEBUG] handleCloseModal: calling handleStartLoading in nextTick"),V()})}function V(){console.log("[DEBUG] handleStartLoading called"),console.log("[DEBUG] periodMode before check:",B.value),console.log("[DEBUG] showPeriodModeInfo:",p.value),console.log("[DEBUG] isLoading:",e.value),(!B.value||!["weeks","months"].includes(B.value))&&(console.warn('[GraphAdmissionClosureDashboard] Period mode not set, using default "weeks"'),B.value="weeks"),console.log("[GraphAdmissionClosureDashboard] Starting loading, periodMode:",B.value),Wt(()=>{console.log("[DEBUG] nextTick callback, periodMode:",B.value),console.log("[DEBUG] isLoading in nextTick:",e.value),B.value==="weeks"?(console.log("[GraphAdmissionClosureDashboard] Loading data for weeks mode"),h()):B.value==="months"&&(console.log("[GraphAdmissionClosureDashboard] Months mode - data will be loaded by GraphAdmissionClosureMonthsDashboard"),e.value=!1,console.log("[DEBUG] Reset parent isLoading to false for months mode"))})}function oe(u=null){var v,Y,te;u?O.value=u:O.value={weekNumber:((v=o.value)==null?void 0:v.weekNumber)||null,weekStartUtc:((Y=o.value)==null?void 0:Y.weekStartUtc)||null,weekEndUtc:((te=o.value)==null?void 0:te.weekEndUtc)||null},c.value=!0}function b(u=null){var v,Y,te;u?O.value=u:O.value={weekNumber:((v=o.value)==null?void 0:v.weekNumber)||null,weekStartUtc:((Y=o.value)==null?void 0:Y.weekStartUtc)||null,weekEndUtc:((te=o.value)==null?void 0:te.weekEndUtc)||null},d.value=!0}function k(u=null){var v,Y,te;u?O.value=u:O.value={weekNumber:((v=o.value)==null?void 0:v.weekNumber)||null,weekStartUtc:((Y=o.value)==null?void 0:Y.weekStartUtc)||null,weekEndUtc:((te=o.value)==null?void 0:te.weekEndUtc)||null},m.value=!0}ct(()=>{try{const u="graph-admission-closure-period-mode-info-shown";localStorage.getItem(u)&&localStorage.removeItem(u);const v="graph-admission-closure-period-mode";localStorage.getItem(v)&&localStorage.removeItem(v)}catch(u){console.warn("[GraphAdmissionClosureDashboard] Failed to clean localStorage:",u)}window.addEventListener("period-mode-change",i)}),Ot(()=>{window.removeEventListener("period-mode-change",i)});function K(){const u=new Date,v=new Date(Date.UTC(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate())),Y=v.getUTCDay(),te=v.getUTCDate()-Y+(Y===0?-6:1),le=new Date(Date.UTC(v.getUTCFullYear(),v.getUTCMonth(),te,0,0,0)),se=new Date(le);return se.setUTCDate(se.getUTCDate()+6),se.setUTCHours(23,59,59,999),{weekStartUtc:le.toISOString(),weekEndUtc:se.toISOString()}}return(u,v)=>{var te,le,se,j,C,ie,he,de,z,_e,Se,De,Ce,J,ce,ue,We,Pe;const Y=Mt("router-link");return y(),f("div",Tc,[ke($e,{name:"fade",mode:"out-in"},{default:ge(()=>[e.value?(y(),f("div",Cc,[r("div",Wc,[v[3]||(v[3]=r("div",{class:"preloader-spinner"},[r("div",{class:"spinner-ring"}),r("div",{class:"spinner-ring"}),r("div",{class:"spinner-ring"})],-1)),v[4]||(v[4]=r("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞",-1)),r("p",Ac," –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ "+A(B.value==="weeks"?"4 –Ω–µ–¥–µ–ª–∏":"3 –º–µ—Å—è—Ü–∞")+"... ",1),v[5]||(v[5]=r("div",{class:"preloader-dots"},[r("span",{class:"dot"}),r("span",{class:"dot"}),r("span",{class:"dot"})],-1))])])):!p.value&&!e.value?(y(),f("div",$c,[B.value==="months"?(y(),Ee(Bn,{key:0})):(y(),f("div",Sc,[r("div",Dc,[r("div",Ec,[r("div",Nc,[r("button",{class:"btn-home-link",type:"button",onClick:g,title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),v[11]||(v[11]=r("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),r("button",{class:"btn-back-link",type:"button",onClick:_,"aria-label":M.value,"aria-disabled":!U.value,"data-fallback":!U.value,disabled:ee.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,Oc),r("nav",Bc,[ke(Y,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ge(()=>[...v[6]||(v[6]=[Te(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),v[8]||(v[8]=r("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),ke(Y,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:ge(()=>[...v[7]||(v[7]=[Te(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),v[9]||(v[9]=r("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),v[10]||(v[10]=r("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),v[12]||(v[12]=r("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),v[13]||(v[13]=r("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),r("div",Ic,[r("div",Mc,[ke(Rt,{stages:E.value.stages,employees:E.value.employees,dateRange:E.value.dateRange,customDateRange:E.value.customDateRange,hasActiveFilters:N.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":B.value,"onUpdate:stages":ae,"onUpdate:employees":ve,"onUpdate:dateRange":fe,"onUpdate:customDateRange":S,"onUpdate:periodMode":n,onReset:$,onApply:I},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","period-mode"])]),r("div",Uc,[a.value?(y(),Ee(Ut,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:a.value.message},null,8,["message"])):(y(),Ee(Gs,{key:1,meta:o.value,data:l.value,onOpenResponsible:b,onOpenStages:oe,onOpenCarryover:k},null,8,["meta","data"]))])])]))])):ne("",!0)]),_:1}),ke(ki,{"is-visible":d.value,responsible:G(O.value)||l.value.responsible||[],"closed-tickets-created-this-week":X(O.value)??l.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":Z(O.value)??l.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":H(O.value)||l.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":L(O.value)||l.value.responsibleCreatedOtherWeek||[],"week-number":((te=O.value)==null?void 0:te.weekNumber)||((le=o.value)==null?void 0:le.weekNumber)||null,"week-start-utc":((se=O.value)==null?void 0:se.weekStartUtc)||((j=o.value)==null?void 0:j.weekStartUtc)||null,"week-end-utc":((C=O.value)==null?void 0:C.weekEndUtc)||((ie=o.value)==null?void 0:ie.weekEndUtc)||null,onClose:v[0]||(v[0]=xe=>{d.value=!1,O.value.value=null})},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),ke(Hi,{"is-visible":c.value,"week-number":((he=O.value)==null?void 0:he.weekNumber)||((de=o.value)==null?void 0:de.weekNumber)||null,"week-start-utc":((z=O.value)==null?void 0:z.weekStartUtc)||((_e=o.value)==null?void 0:_e.weekStartUtc)||null,"week-end-utc":((Se=O.value)==null?void 0:Se.weekEndUtc)||((De=o.value)==null?void 0:De.weekEndUtc)||null,"preloaded-data":x(O.value),onClose:v[1]||(v[1]=xe=>{c.value=!1,O.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),ke(wc,{"is-visible":m.value,"week-number":((Ce=O.value)==null?void 0:Ce.weekNumber)||((J=o.value)==null?void 0:J.weekNumber)||null,"week-start-utc":((ce=O.value)==null?void 0:ce.weekStartUtc)||((ue=o.value)==null?void 0:ue.weekStartUtc)||null,"week-end-utc":((We=O.value)==null?void 0:We.weekEndUtc)||((Pe=o.value)==null?void 0:Pe.weekEndUtc)||null,"preloaded-data":D(O.value),onClose:v[2]||(v[2]=xe=>{m.value=!1,O.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),p.value?(y(),Ee(pr,{key:0,"is-visible":p.value,"current-mode":B.value,onClose:w,onSelectMode:F},null,8,["is-visible","current-mode"])):ne("",!0)])}}},Vc=Be(Rc,[["__scopeId","data-v-e970a08a"]]);export{Vc as default};
