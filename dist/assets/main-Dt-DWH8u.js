const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./direct-access-config-D4heVEns.js","./chunk-CVoFfQ50.js","./chunk-D85qNiqy.js","./access-config-async-D73-Okh7.js","./chunk-q4E_n_Zn.js","./chunk-D7at5FQX.js","./chunk-yzaUG9vQ.js","./WebhookLogsDashboard.vue-UbaUoaXR.js","./WebhookLogDetails.vue-CkUvOW_p.js","./DashboardSector1C.vue-DtNSkQdN.js","./chunk-CrmXC1Fv.js","./chunk-C-QDJ0Zs.js","./chunk-D15Haoqg.js","./chunk-D8irmMFq.js","./GraphAdmissionClosureDashboard.vue-BhBMfeCM.js","./chunk-BT2v9UuW.js","./dashboard-sector-1c-service-B6ZCEz-L.js","./GraphStateDashboard.vue-Gat5ILLK.js","./TicketsTimeTrackingDashboard.vue-hc6IgKoI.js"])))=>i.map(i=>d[i]);
var St=Object.defineProperty;var kt=(o,e,s)=>e in o?St(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var Ce=(o,e,s)=>kt(o,typeof e!="symbol"?e+"":e,s);import{r as $,c as d,o as c,a as j,b as A,d as Et,t as m,n as N,e as n,f as G,g as C,h as te,w as ie,i as Y,F as H,j as q,k as ge,l as S,u as Ue,m as se,p as At,T as _e,q as J,v as $e,s as mt,x as Re,y as ke,z as pe,A as Ee,B as qe,C as Tt,D as gt,E as ft,G as Mt,H as Lt,I as xt,J as Ne,K as Dt,L as It,P as Pt,M as Ut,N as Rt,O as Nt,Q as Ft,R as Ot,S as Bt,U as $t,V as zt}from"./chunk-q4E_n_Zn.js";import{a as ht,_ as ne,g as fe}from"./chunk-CVoFfQ50.js";import{C as lt}from"./chunk-D7at5FQX.js";import{A as jt}from"./chunk-yzaUG9vQ.js";import"./chunk-D85qNiqy.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();const O=(o,e)=>{const s=o.__vccOpts||o;for(const[t,r]of e)s[t]=r;return s},Wt={name:"App"},Vt={id:"app"};function Ht(o,e,s,t,r,i){const a=$("router-view");return c(),d("div",Vt,[j(a)])}const qt=O(Wt,[["render",Ht]]),Xt={name:"StatusMessage",props:{type:{type:String,required:!0,validator:o=>["success","error","info","warning"].includes(o)},title:{type:String,default:null},message:{type:String,default:null}}},Jt={key:0},Kt={key:1};function Yt(o,e,s,t,r,i){return c(),d("div",{class:N(["status-message",`status-message--${s.type}`])},[s.title?(c(),d("strong",Jt,m(s.title),1)):A("",!0),s.message?(c(),d("p",Kt,m(s.message),1)):A("",!0),Et(o.$slots,"default",{},void 0)],2)}const vt=O(Xt,[["render",Yt],["__scopeId","data-v-7f15d2d7"]]),Gt={name:"LoadingSpinner",props:{message:{type:String,default:"–ó–∞–≥—Ä—É–∑–∫–∞..."}}},Qt={class:"loading-spinner"},Zt={key:0,class:"message"};function es(o,e,s,t,r,i){return c(),d("div",Qt,[e[0]||(e[0]=n("div",{class:"spinner"},null,-1)),s.message?(c(),d("p",Zt,m(s.message),1)):A("",!0)])}const pt=O(Gt,[["render",es],["__scopeId","data-v-375eac16"]]);function Te(){try{if(window.self===window.top)return!1;if(typeof BX24<"u")return!0;try{const o=window.parent.location.origin;return o.includes("bitrix24")||o.includes("kompo.by")}catch{return!1}}catch(o){return console.warn("Error checking Bitrix24 context:",o),!1}}function ts(){return typeof BX24<"u"}class we{static init(e){return new Promise((s,t)=>{if(!Te()){console.log("Not inside Bitrix24, skipping BX24.init()"),e&&e(),s();return}if(typeof BX24>"u"){t(new Error("Bitrix24 API not loaded. Make sure script is included: //api.bitrix24.com/api/v1/"));return}const r=setTimeout(()=>{t(new Error("BX24.init() timeout: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥"))},5e3);try{BX24.init(()=>{clearTimeout(r),e&&e(),s()})}catch(i){clearTimeout(r),t(i)}})}static installFinish(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}try{BX24.installFinish(),e()}catch(t){s(t)}})}static callMethod(e,s={}){return new Promise((t,r)=>{if(typeof BX24>"u"){r(new Error("Bitrix24 API not loaded"));return}const i=setTimeout(()=>{r(new Error(`BX24.callMethod(${e}) timeout: –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—ã—Å–∏–ª 10 —Å–µ–∫—É–Ω–¥`))},1e4);try{BX24.callMethod(e,s,a=>{if(clearTimeout(i),a.error()){const l=a.error();r(new Error(l.error_description||l.error||"Unknown error"))}else t(a.data())})}catch(a){clearTimeout(i),r(a)}})}static async getCurrentUser(){if(Te()&&ts())try{const e=await Promise.race([this.callMethod("user.current",{}),new Promise((s,t)=>setTimeout(()=>t(new Error("Timeout")),5e3))]);return console.log("Got user from BX24.callMethod() (interface user):",e?.ID||"unknown"),e}catch(e){console.warn("BX24.callMethod() failed, using proxy API as fallback:",e);try{const t=await new lt().getCurrentUser();return console.log("Got user from proxy API (token owner, fallback):",t),t}catch(s){throw console.error("Both BX24 API and proxy API failed:",s),e.message&&e.message.includes("timeout")?new Error("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Bitrix24 API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç."):new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}else return console.warn("Not inside Bitrix24, using proxy API (will return token owner, not interface user)"),await new lt().getCurrentUser()}static getUser(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}if(typeof BX24.getUser!="function"){s(new Error("BX24.getUser is not available"));return}BX24.getUser(t=>{e(t)})})}static getAuth(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}BX24.getAuth(t=>{e(t)})})}}const ss={name:"InstallPage",components:{StatusMessage:vt,LoadingSpinner:pt},setup(){const o=C(!0),e=C(null),s=C(null);return te(async()=>{try{let t=null;if(window.INSTALL_RESULT)t=window.INSTALL_RESULT;else{const r=ht("/install.php"),i=await fetch(`${r}?get_result=1`);i.ok&&(t=await i.json())}if(!t)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏");if(s.value=t,t.rest_only===!1)if(t.install===!0){e.value={type:"success",title:"‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!",message:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24."};try{await we.init(()=>{we.installFinish()})}catch(r){console.error("Error finishing installation:",r)}}else e.value={type:"error",title:"‚úó –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."};else e.value={type:"info",title:"REST-only —Ä–µ–∂–∏–º",message:"–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ REST API, –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."}}catch(t){console.error("Error loading install result:",t),e.value={type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ."}}finally{o.value=!1}}),{loading:o,installStatus:e,installInfo:s}}},os={class:"install-page"},ns={class:"container"},as={key:1,class:"info"};function rs(o,e,s,t,r,i){const a=$("StatusMessage"),l=$("LoadingSpinner");return c(),d("div",os,[n("div",ns,[e[1]||(e[1]=n("h1",null,"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1)),t.installStatus?(c(),G(a,{key:0,type:t.installStatus.type,title:t.installStatus.title,message:t.installStatus.message},null,8,["type","title","message"])):A("",!0),t.installInfo?(c(),d("div",as,[e[0]||(e[0]=n("h3",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:",-1)),n("pre",null,m(JSON.stringify(t.installInfo,null,2)),1)])):A("",!0),t.loading?(c(),G(l,{key:2,message:"–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."})):A("",!0)])])}const is=O(ss,[["render",rs],["__scopeId","data-v-d082ec9e"]]),Ae={allowedDepartmentIds:[369,366,7],adminDepartmentIds:[369]};function yt(o){return!o||typeof o!="number"?!1:Ae.allowedDepartmentIds.includes(o)}function _t(o){if(!o||!o.UF_DEPARTMENT)return!1;const e=Array.isArray(o.UF_DEPARTMENT)?o.UF_DEPARTMENT:[];return e.length===0?!1:e.some(s=>Ae.adminDepartmentIds.includes(s))}const me={USER_NOT_DETERMINED:"USER_NOT_DETERMINED",ACCESS_DENIED:"ACCESS_DENIED",API_ERROR:"API_ERROR"};class ve{constructor(e,s=null,t=null,r=null){this.allowed=e,this.errorCode=s,this.errorMessage=t,this.user=r}}class Se{static async checkAccess(){try{const e=Te();if(console.log("AccessControlService.checkAccess - isInsideBitrix24:",e),console.log("AccessControlService.checkAccess - window.self === window.top:",window.self===window.top),console.log("AccessControlService.checkAccess - typeof BX24:",typeof BX24),e)console.log("AccessControlService.checkAccess - Inside Bitrix24, skipping direct access check");else{console.log("AccessControlService.checkAccess - Not inside Bitrix24, checking direct access config...");const{isDirectAccessAllowed:i,getDenyMessage:a}=await ne(async()=>{const{isDirectAccessAllowed:u,getDenyMessage:g}=await import("./direct-access-config-D4heVEns.js");return{isDirectAccessAllowed:u,getDenyMessage:g}},__vite__mapDeps([0,1]),import.meta.url),l=await i();if(console.log("AccessControlService.checkAccess - allowDirectAccess:",l),!l){const u=await a();return console.warn("Direct access denied: Application opened directly in browser, but direct access is disabled in config"),console.warn("Deny message:",u),new ve(!1,me.ACCESS_DENIED,u,null)}console.log("Direct access allowed: Using primary administrator token from settings.php")}if(e)try{await Promise.race([we.init(),new Promise((i,a)=>setTimeout(()=>a(new Error("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥")),5e3))])}catch(i){console.warn("BX24.init() failed, will try proxy API:",i)}let s;try{s=await Promise.race([we.getCurrentUser(),new Promise((i,a)=>setTimeout(()=>a(new Error("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø—Ä–µ–≤—ã—Å–∏–ª–æ 10 —Å–µ–∫—É–Ω–¥")),1e4))])}catch(i){console.warn("Bitrix24BxApi.getCurrentUser() failed, trying proxy API:",i);const{Bitrix24ApiProvider:a}=await ne(async()=>{const{Bitrix24ApiProvider:l}=await import("./chunk-D85qNiqy.js").then(u=>u.b);return{Bitrix24ApiProvider:l}},__vite__mapDeps([2,1]),import.meta.url);try{const l=await a.getInstance();s=await Promise.race([l.getCurrentUser(),new Promise((u,g)=>setTimeout(()=>g(new Error("–ü—Ä–æ–∫—Å–∏ API –ø—Ä–µ–≤—ã—Å–∏–ª–æ 5 —Å–µ–∫—É–Ω–¥")),5e3))]),console.log("Got user from proxy API:",s?.ID||"unknown")}catch(l){throw console.error("Both BX24 API and proxy API failed:",l),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}if(!s||!s.ID)return console.warn("AccessControlService.checkAccess - user not determined:",s),new ve(!1,me.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.");console.log("AccessControlService.checkAccess - user determined:",{id:s.ID,name:s.NAME,departments:s.UF_DEPARTMENT});const t=s.UF_DEPARTMENT||[];if(console.log("AccessControlService.checkAccess - departmentIds:",t),!Array.isArray(t)||t.length===0){if(console.log("AccessControlService.checkAccess - user has no departments"),!e){const{isDirectAccessAllowed:i}=await ne(async()=>{const{isDirectAccessAllowed:l}=await import("./direct-access-config-D4heVEns.js");return{isDirectAccessAllowed:l}},__vite__mapDeps([0,1]),import.meta.url);if(await i())return console.log("AccessControlService.checkAccess - Direct access allowed, granting access despite no departments"),new ve(!0,null,null,s)}return console.warn("AccessControlService.checkAccess - Access denied: user has no departments"),new ve(!1,me.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ—Ç–¥–µ–ª—É.")}const r=t.some(i=>yt(i));return console.log("AccessControlService.checkAccess - hasAccess:",r),r?(console.log("AccessControlService.checkAccess - Access granted"),new ve(!0,null,null,s)):(console.warn("AccessControlService.checkAccess - Access denied: no allowed departments"),new ve(!1,me.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"))}catch(e){return console.error("AccessControlService.checkAccess error:",e),e.message&&(e.message.includes("CORS")||e.message.includes("blocked")||e.message.includes("ERR_FAILED")||e.message.includes("unknown address space"))&&Te()?(console.error("CORS error inside Bitrix24: Cannot determine interface user."),new ve(!1,me.API_ERROR,"–û—à–∏–±–∫–∞ CORS: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")):e.message&&e.message.includes("not loaded")?new ve(!1,me.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."):new ve(!1,me.API_ERROR,"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}static async getCurrentUser(){try{return Te()&&await we.init(),await we.getCurrentUser()}catch(e){return console.error("AccessControlService.getCurrentUser error:",e),null}}}class ze{static async logAppEntry(e,s=null){if(!e||!e.ID)return console.warn("[ActivityLoggingService] Invalid user object for app entry logging"),!1;const t={timestamp:new Date().toISOString(),type:"app_entry",user_id:e.ID,user_name:this.getUserName(e),user_email:e.EMAIL||null,ip:s||this.getClientIp(),user_agent:navigator.userAgent,session_id:this.getSessionId()};return await this.saveLog(t)}static async logPageVisit(e,s,t=null){if(!s||!s.ID)return console.warn("[ActivityLoggingService] Invalid user object for page visit logging"),!1;if(!e||!e.path)return console.warn("[ActivityLoggingService] Invalid route object for page visit logging"),!1;const r={timestamp:new Date().toISOString(),type:"page_visit",user_id:s.ID,user_name:this.getUserName(s),route_path:e.path,route_name:e.name||null,route_title:e.meta?.title||null,from_path:t?.path||null,from_name:t?.name||null,session_id:this.getSessionId()};return await this.saveLog(r)}static async saveLog(e){try{const s=fe("/api/user-activity-log.php"),t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)});if(!t.ok){const i=await t.text();return console.error("[ActivityLoggingService] Failed to save log:",{status:t.status,statusText:t.statusText,error:i}),!1}const r=await t.json();return r.success?!0:(console.error("[ActivityLoggingService] API returned error:",r.error),!1)}catch(s){return s.name==="AbortError"?console.warn("[ActivityLoggingService] Request timeout (activity logging skipped)"):console.error("[ActivityLoggingService] Error saving log:",s),!1}}static getSessionId(){const e="activity_session_id";if(sessionStorage.getItem(e))return sessionStorage.getItem(e);const s=this.generateSessionId();return sessionStorage.setItem(e,s),s}static generateSessionId(){const e=Date.now(),s=Math.random().toString(36).substring(2,11);return`${e}-${s}`}static getUserName(e){const s=e.NAME||"",t=e.LAST_NAME||"";return`${s} ${t}`.trim()||e.EMAIL||`User #${e.ID}`}static getClientIp(){return null}static isAppEntryLogged(){return sessionStorage.getItem("app_entry_logged")==="true"}static markAppEntryLogged(){sessionStorage.setItem("app_entry_logged","true")}}const ls={reports:[{id:1,title:"–û—Ç—á—ë—Ç –ø–æ —Ç–∏–∫–µ—Ç–∞–º",icon:"üìä",route:"/reports/tickets",description:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º",active:!1},{id:2,title:"–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",icon:"üìà",route:"/reports/performance",description:"–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞",active:!1},{id:3,title:"–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º",icon:"üìâ",route:"/reports/deadlines",description:"–ê–Ω–∞–ª–∏–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á",active:!1},{id:4,title:"–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç",icon:"üìã",route:"/reports/summary",description:"–û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",active:!1},{id:5,title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",route:"/dashboard/sector-1c",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0},{id:6,title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",icon:"üìä",route:"/dashboard/graph-state",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–° –≤–æ –≤—Ä–µ–º–µ–Ω–∏",active:!0,category:"analytics",order:6},{id:7,title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–°",icon:"üìà",route:"/dashboard/graph-admission-closure",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0,category:"analytics",order:7},{id:8,title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"‚è±",route:"/dashboard/tickets-time-tracking",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",active:!0,category:"analytics",order:8}]};function cs(){return ls.reports.filter(o=>o.active===!0)}const ds={adminInterfaces:[{id:1,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"üë•",route:"/admin/users",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"},{id:2,title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã",icon:"‚öôÔ∏è",route:"/admin/settings",description:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:3,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",icon:"üìã",route:"/admin/webhook-logs",description:"–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤"},{id:4,title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",icon:"üìä",route:"/admin/usage-stats",description:"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:5,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",icon:"üóëÔ∏è",route:"/admin/cache",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –º–æ–¥—É–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"}]};function us(){return[...ds.adminInterfaces]}const ms={name:"IndexPage",components:{StatusMessage:vt,LoadingSpinner:pt},beforeCreate(){console.log("[IndexPage] beforeCreate() called")},created(){console.log("[IndexPage] created() called")},beforeMount(){console.log("[IndexPage] beforeMount() called")},setup(){console.log("[IndexPage] setup() called");const o=Ue(),e=C(!0),s=C(null),t=C(!1),r=C(!1),i=C(""),a=C(null),l=C(null),u=C(!1);console.log("[IndexPage] Initial state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value});const g=C(cs()),p=C(!1),f=C(us()),M=S(()=>a.value?_t(a.value):!1),T=S(()=>{if(!a.value)return"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";const _=a.value.FIRST_NAME?a.value.FIRST_NAME.trim():"",h=a.value.LAST_NAME?a.value.LAST_NAME.trim():"",v=a.value.NAME?a.value.NAME.trim():"";return _&&h?`${_} ${h}`:v&&h&&v!==h?`${v} ${h}`:_&&v&&_!==v?`${_} ${v}`:v&&v.includes(" ")?v:_||h||v||`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${a.value.ID}`}),k=S(()=>s.value?s.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ":"–û—à–∏–±–∫–∞ API":null),w=S(()=>s.value?s.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É.":s.value:null),E=S(()=>s.value&&s.value.includes("no_install_app")),b=S(()=>ht("/install.php"));te(async()=>{console.log("[IndexPage] onMounted() called");try{console.log("[IndexPage] Calling AccessControlService.checkAccess()...");const _=await Se.checkAccess();if(console.log("[IndexPage] Access result:",{allowed:_.allowed,hasUser:!!_.user,user:_.user,errorCode:_.errorCode,errorMessage:_.errorMessage}),_.allowed){if(console.log("[IndexPage] Setting accessAllowed to true"),t.value=!0,a.value=_.user,console.log("[IndexPage] Access allowed, setting state:",{accessAllowed:t.value,hasUser:!!a.value,loading:e.value,accessDenied:r.value}),!ze.isAppEntryLogged())try{_.user&&await ze.logAppEntry(_.user)&&ze.markAppEntryLogged()}catch(h){console.error("[IndexPage] Error logging app entry:",h)}}else{r.value=!0;const h=Te(),v=!h&&_.errorCode===me.ACCESS_DENIED&&_.errorMessage&&_.errorMessage.includes("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø");if(console.log("IndexPage - accessResult:",{errorCode:_.errorCode,errorMessage:_.errorMessage,isInsideB24:h,isDirectAccessDeniedCheck:v}),u.value=v,v&&(i.value=_.errorMessage,console.log("IndexPage - Set direct access denied message:",_.errorMessage)),console.log("IndexPage - State after check:",{accessDenied:r.value,isDirectAccessDenied:u.value,accessErrorMessage:i.value}),!v){if(_.user){const{getAllowedDepartmentIds:x}=await ne(async()=>{const{getAllowedDepartmentIds:X}=await import("./access-config-async-D73-Okh7.js");return{getAllowedDepartmentIds:X}},__vite__mapDeps([3,4,1,5,6,2]),import.meta.url);l.value={userId:_.user.ID,departmentIds:_.user.UF_DEPARTMENT||[],allowedIds:x()}}_.errorCode===me.USER_NOT_DETERMINED?i.value="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.":_.errorCode===me.ACCESS_DENIED?i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω":i.value=_.errorMessage||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."}}}catch(_){s.value=_.message,console.error("Error checking access:",_)}finally{e.value=!1,console.log("[IndexPage] Final state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value,hasUser:!!a.value,error:s.value})}});const L=_=>{if(!_){console.error("Route is not defined for report");return}o.push(_)},D=()=>{p.value=!0},z=()=>{p.value=!1};return{loading:e,error:s,accessAllowed:t,accessDenied:r,accessErrorMessage:i,currentUser:a,userName:T,debugInfo:l,isDirectAccessDenied:u,errorTitle:k,errorMessage:w,showInstallLink:E,installPageUrl:b,reportsButtons:g,navigateToReport:L,isAdmin:M,showAdminPopup:p,adminButtons:f,openAdminPopup:D,closeAdminPopup:z,navigateToAdmin:_=>{if(!_){console.error("Route is not defined for admin interface");return}o.push(_),z()}}}},gs={class:"index-page"},fs={class:"container"},hs={key:0,class:"install-link"},vs=["href"],ps={key:0,class:"direct-access-denied-info",style:{"margin-top":"15px",padding:"15px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px"}},ys={key:1,class:"debug-info",style:{"margin-top":"15px",padding:"10px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px","font-size":"12px"}},_s={key:3,class:"main-content"},ws={class:"greeting-section"},bs={class:"greeting-header"},Cs={class:"greeting-header-content"},Ss={class:"greeting-text"},ks={class:"reports-section"},Es={class:"reports-grid"},As=["onClick"],Ts={class:"report-icon"},Ms={class:"report-title"},Ls={key:0,class:"report-description"},xs={class:"admin-popup-header"},Ds={class:"admin-popup-content"},Is={class:"admin-buttons-grid"},Ps=["onClick"],Us={class:"admin-icon"},Rs={class:"admin-title"},Ns={key:0,class:"admin-description"};function Fs(o,e,s,t,r,i){const a=$("StatusMessage"),l=$("LoadingSpinner");return c(),d("div",gs,[n("div",fs,[t.error?(c(),G(a,{key:0,type:"error",title:t.errorTitle,message:t.errorMessage},{default:ie(()=>[t.showInstallLink?(c(),d("div",hs,[n("a",{href:t.installPageUrl},"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",8,vs)])):A("",!0)]),_:1},8,["title","message"])):A("",!0),t.loading?(c(),G(l,{key:1,message:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞..."})):A("",!0),!t.loading&&t.accessDenied?(c(),G(a,{key:2,type:"error",title:"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",message:t.accessErrorMessage},{default:ie(()=>[t.isDirectAccessDenied?(c(),d("div",ps,[...e[4]||(e[4]=[n("p",{style:{margin:"0 0 10px 0","font-weight":"600",color:"#856404"}},[n("strong",null,"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")],-1),n("ol",{style:{margin:"0","padding-left":"20px",color:"#856404"}},[n("li",null,"–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24"),n("li",null,"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Bitrix24 (placement, –≤–∏–¥–∂–µ—Ç –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É)")],-1)])])):t.debugInfo?(c(),d("div",ys,[e[5]||(e[5]=n("strong",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e[6]||(e[6]=n("br",null,null,-1)),Y(" ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+m(t.debugInfo.userId),1),e[7]||(e[7]=n("br",null,null,-1)),Y(" ID –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+m(t.debugInfo.departmentIds),1),e[8]||(e[8]=n("br",null,null,-1)),Y(" –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ID –æ—Ç–¥–µ–ª–æ–≤: "+m(t.debugInfo.allowedIds),1),e[9]||(e[9]=n("br",null,null,-1)),e[10]||(e[10]=n("small",{style:{color:"#856404"}},"–î–æ–±–∞–≤—å—Ç–µ ID –æ—Ç–¥–µ–ª–∞ –≤ —Ñ–∞–π–ª vue-app/src/config/access-config.js",-1))])):A("",!0)]),_:1},8,["message"])):A("",!0),!t.loading&&!t.accessDenied&&t.accessAllowed?(c(),d("div",_s,[n("div",ws,[n("div",bs,[n("div",Cs,[e[13]||(e[13]=n("h2",{class:"greeting-title"},"–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ò–¢ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –ü–ª–∞–Ω–µ—Ä–∫–∏ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ü–∏–∏",-1)),n("p",Ss,[e[11]||(e[11]=Y(" –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",-1)),n("strong",null,m(t.userName),1),e[12]||(e[12]=Y("! ",-1))])]),t.isAdmin?(c(),d("button",{key:0,class:"admin-button-header",onClick:e[0]||(e[0]=(...u)=>t.openAdminPopup&&t.openAdminPopup(...u)),title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"}," ‚öôÔ∏è ")):A("",!0)])]),n("div",ks,[n("div",Es,[(c(!0),d(H,null,q(t.reportsButtons,u=>(c(),d("div",{key:u.id,class:"report-button",onClick:g=>t.navigateToReport(u.route)},[n("div",Ts,m(u.icon),1),n("div",Ms,m(u.title),1),u.description?(c(),d("div",Ls,m(u.description),1)):A("",!0)],8,As))),128))])]),t.showAdminPopup&&t.isAdmin?(c(),d("div",{key:0,class:"admin-popup-overlay",onClick:e[3]||(e[3]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))},[n("div",{class:"admin-popup",onClick:e[2]||(e[2]=ge(()=>{},["stop"]))},[n("div",xs,[e[14]||(e[14]=n("h3",{class:"admin-popup-title"},"‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",-1)),n("button",{class:"admin-popup-close",onClick:e[1]||(e[1]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))}," ‚úï ")]),n("div",Ds,[n("div",Is,[(c(!0),d(H,null,q(t.adminButtons,u=>(c(),d("div",{key:u.id,class:"admin-interface-button",onClick:g=>t.navigateToAdmin(u.route)},[n("div",Us,m(u.icon),1),n("div",Rs,m(u.title),1),u.description?(c(),d("div",Ns,m(u.description),1)):A("",!0)],8,Ps))),128))])])])])):A("",!0)])):A("",!0)])])}const Os=O(ms,[["render",Fs],["__scopeId","data-v-6cc28966"]]),re=C(new Map),ue=C({hits:0,misses:0,sets:0,invalidations:0}),et={defaultTTL:5*60*1e3,maxSize:100,enableStats:!0};function Bs(o={}){const{ttl:e=et.defaultTTL,maxSize:s=et.maxSize,enableStats:t=et.enableStats}=o,r=E=>{const b=new WeakSet;return JSON.stringify(E,(L,D)=>{if(typeof D=="object"&&D!==null){if(b.has(D))return"[Circular]";b.add(D)}return typeof D=="function"||D===void 0?null:D})},i=(E,b={})=>{const L=Object.keys(b).sort().reduce((D,z)=>{const I=b[z];if(I==null)D[z]=null;else if(typeof I=="object")try{D[z]=r(I)}catch{D[z]=String(I)}else D[z]=I;return D},{});try{return`${E}_${r(L)}`}catch{const z=Object.keys(L).sort().map(I=>`${I}=${L[I]}`).join("&");return`${E}_${z}`}},a=E=>{const b=re.value.get(E);return b?Date.now()-b.timestamp>b.ttl?(re.value.delete(E),t&&ue.value.misses++,null):(b.lastAccessed=Date.now(),t&&ue.value.hits++,b.data):(t&&ue.value.misses++,null)},l=(E,b,L=null)=>{re.value.size>=s&&u(),re.value.set(E,{data:b,timestamp:Date.now(),lastAccessed:Date.now(),ttl:L||e}),t&&ue.value.sets++},u=()=>{let E=null,b=1/0;for(const[L,D]of re.value.entries())D.lastAccessed<b&&(b=D.lastAccessed,E=L);E&&re.value.delete(E)},g=()=>{re.value.clear(),t&&(ue.value={hits:0,misses:0,sets:0,invalidations:0})},p=E=>{const b=typeof E=="string"?new RegExp(E):E;let L=0;for(const D of re.value.keys())b.test(D)&&(re.value.delete(D),L++);return t&&(ue.value.invalidations+=L),L},f=()=>{const E=Date.now();let b=0;for(const[L,D]of re.value.entries())E-D.timestamp>D.ttl&&(re.value.delete(L),b++);return b},M=()=>{const E=ue.value.hits+ue.value.misses,b=E>0?(ue.value.hits/E*100).toFixed(2):0;return{...ue.value,size:re.value.size,hitRate:`${b}%`}};let T=null;const k=(E=5*60*1e3)=>{T&&clearInterval(T),T=setInterval(()=>{f()},E)},w=()=>{T&&(clearInterval(T),T=null)};return k(),{get:a,set:l,clear:g,invalidate:p,cleanup:f,getCacheKey:i,getStats:M,startAutoCleanup:k,stopAutoCleanup:w}}function ye(o){if(!o||typeof o!="object"||!o.timestamp||typeof o.timestamp!="string"||!o.event||typeof o.event!="string"||!o.category||typeof o.category!="string"||!["tasks","smart-processes","errors"].includes(o.category))return!1;try{new Date(o.timestamp)}catch{return!1}return!0}function $s(o){if(!o||typeof o!="object")return!1;for(const[e,s]of Object.entries(o))if(typeof s=="function")return!1;return!0}function Le(o){if(!ye(o))return null;const e={timestamp:o.timestamp,event:o.event,category:o.category};return o.ip&&typeof o.ip=="string"&&(e.ip=o.ip),o.payload&&typeof o.payload=="object"&&(e.payload=o.payload),o.details&&$s(o.details)&&(e.details=o.details),e}function nt(o){return Array.isArray(o)?o.map(e=>Le(e)).filter(e=>e!==null):[]}const{get:zs,set:js,getCacheKey:Ws,invalidate:ct}=Bs({ttl:2*60*1e3,maxSize:50});class dt{static getBaseUrl(){return fe("/api/webhook-logs.php")}static get BASE_URL(){return this.getBaseUrl()}static async getLogs(e={},s=1,t=50,r=!1){if(s<1)throw new Error("Page must be greater than 0");if(t<1||t>1e3)throw new Error("Limit must be between 1 and 1000");const i={category:e.category||null,event:e.event||null,date:e.date||null,hour:e.hour!==void 0?e.hour:null,dateFrom:e.dateFrom||null,dateTo:e.dateTo||null,ip:e.ip||null,status:e.status||null},a=this.getBaseUrl(),l=Ws(a,{filters:i,page:s,limit:t});if(!r){const g=zs(l);if(g)return console.log("[WebhookLogsApiService] Cache hit:",l.substring(0,50)+"..."),g}console.log("[WebhookLogsApiService] Cache miss:",l.substring(0,50)+"...");const u=new URLSearchParams({page:s.toString(),limit:t.toString()});i.category&&u.append("category",i.category),i.event&&u.append("event",i.event),i.date&&u.append("date",i.date),i.hour!==null&&u.append("hour",i.hour.toString()),i.dateFrom&&u.append("dateFrom",i.dateFrom),i.dateTo&&u.append("dateTo",i.dateTo),i.ip&&u.append("ip",i.ip),i.status&&u.append("status",i.status);try{const g=this.getBaseUrl(),p=await fetch(`${g}?${u.toString()}`);if(!p.ok){const k=await p.text();let w;try{w=JSON.parse(k)}catch{w={error:k}}throw new Error(w.error_description||w.error||`HTTP error! status: ${p.status}`)}const f=await p.json();if(console.log("[WebhookLogsApiService] API response:",{success:f.success,logsCount:f.logs?.length||0,pagination:f.pagination,hasError:!!f.error}),f.error)throw new Error(f.error_description||f.error);if(!f.success)throw console.warn("[WebhookLogsApiService] API returned success=false:",f),new Error("API request failed");if(!Array.isArray(f.logs))throw console.error("[WebhookLogsApiService] Invalid logs format:",f.logs),new Error("Invalid logs format: expected array");const M=nt(f.logs);(!f.pagination||typeof f.pagination!="object")&&(console.warn("[WebhookLogsApiService] Invalid pagination format:",f.pagination),f.pagination={page:s,limit:t,total:M.length,pages:Math.ceil(M.length/t)});const T={success:!0,logs:M,pagination:{page:f.pagination.page||s,limit:f.pagination.limit||t,total:f.pagination.total||M.length,pages:f.pagination.pages||Math.ceil((f.pagination.total||M.length)/t)}};return js(l,T),T}catch(g){throw console.error("[WebhookLogsApiService] Error:",g),g}}static invalidateCacheOnFilterChange(e={},s={}){const t=ct(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Invalidated ${t} entries on filter change`)}static clearCache(){const e=ct(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Cleared ${e} entries`)}static async getLogDetails(e,s=null){const t={};return s&&(t.date=s),(await this.getLogs(t,1,1e3)).logs.find(a=>`${a.timestamp}_${a.event}`===e)||null}static async getErrors(e={},s=1,t=50){return this.getLogs({...e,category:"errors"},s,t)}static async getStats(e={}){const s=await this.getLogs(e,1,1e3),t={total:s.pagination.total||s.logs.length,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}};return s.logs.forEach(r=>{r.category==="tasks"?t.tasks++:r.category==="smart-processes"?t.smartProcesses++:r.category==="errors"&&t.errors++,t.byEvent[r.event]||(t.byEvent[r.event]=0),t.byEvent[r.event]++;const i=r.timestamp.split("T")[0];t.byDate[i]||(t.byDate[i]=0),t.byDate[i]++}),t}}function Vs(){const o=At(),e=Ue(),s=new Date().toISOString().split("T")[0],t=C({category:null,event:null,dateFrom:s,dateTo:null,hour:null,ip:null,search:null,status:null}),r=()=>{const g=o.query;t.value={category:g.category||null,event:g.event||null,dateFrom:g.dateFrom||g.date||s,dateTo:g.dateTo||null,hour:g.hour?parseInt(g.hour):null,ip:g.ip||null,search:g.search||null,status:g.status||null}},i=g=>{if(u)return;const p={...o.query};Object.keys(g).forEach(M=>{const T=g[M];T!==null&&T!==""&&T!==void 0?p[M]=T.toString():delete p[M]}),JSON.stringify(p)!==JSON.stringify(o.query)&&(u=!0,e.replace({path:o.path,query:p}).finally(()=>{setTimeout(()=>{u=!1},100)}))},a=g=>{const p={...t.value,...g};JSON.stringify(t.value)!==JSON.stringify(p)&&(t.value=p,i(t.value))},l=()=>{t.value={category:null,event:null,dateFrom:s,dateTo:null,hour:null,ip:null,search:null,status:null},i(t.value)};te(()=>{r()});let u=!1;return se(()=>o.query,(g,p)=>{if(u)return;JSON.stringify(g)!==JSON.stringify(p)&&r()},{deep:!0}),{filters:t,updateFilters:a,clearFilters:l,loadFiltersFromUrl:r}}function Hs(o,e,s={}){if(!e||!e.trim())return o;const{caseSensitive:t=!1,searchInEvent:r=!0,searchInPayload:i=!0,searchInDetails:a=!0,searchInIp:l=!0,searchInTimestamp:u=!1}=s,g=t?e.trim():e.trim().toLowerCase();return o.filter(p=>{if(r&&p.event&&(t?p.event:p.event.toLowerCase()).includes(g))return!0;if(i&&p.payload)try{const f=JSON.stringify(p.payload);if((t?f:f.toLowerCase()).includes(g))return!0}catch(f){console.warn("Error searching in payload:",f)}if(a&&p.details)try{const f=JSON.stringify(p.details);if((t?f:f.toLowerCase()).includes(g))return!0}catch(f){console.warn("Error searching in details:",f)}return!!(l&&p.ip&&(t?p.ip:p.ip.toLowerCase()).includes(g)||u&&p.timestamp&&(t?p.timestamp:p.timestamp.toLowerCase()).includes(g))})}function ot(o){if(!o||typeof o!="object"||o.category!==void 0&&o.category!==null&&!["tasks","smart-processes","errors"].includes(o.category)||o.date!==void 0&&o.date!==null&&!/^\d{4}-\d{2}-\d{2}$/.test(o.date))return!1;if(o.hour!==void 0&&o.hour!==null){const e=parseInt(o.hour,10);if(isNaN(e)||e<0||e>23)return!1}return!(o.ip!==void 0&&o.ip!==null&&(typeof o.ip!="string"||o.ip.length===0))}function qs(o){if(!o||typeof o!="object")return!1;const e=parseInt(o.page,10),s=parseInt(o.limit,10),t=parseInt(o.total,10),r=parseInt(o.pages,10);return!(isNaN(e)||e<1||isNaN(s)||s<1||s>1e3||isNaN(t)||t<0||isNaN(r)||r<0)}function ut(o){if(o==null)return"";const e=String(o),s=e.replace(/"/g,'""');return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${s}"`:s}function Xs(o){return o==null?"":typeof o=="object"?JSON.stringify(o):String(o)}function Js(o,e="webhook-logs.csv",s={}){return new Promise((t,r)=>{try{if(!Array.isArray(o)||o.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{columns:i=null,onProgress:a=null}=s,l=i||Object.keys(o[0]),g=[l.map(k=>ut(k)).join(",")],p=o.length,f=1e3;for(let k=0;k<p;k+=f){const w=o.slice(k,k+f);if(w.forEach(E=>{const b=l.map(L=>{const D=E[L];return ut(Xs(D))});g.push(b.join(","))}),a){const E=Math.min(100,Math.round((k+w.length)/p*100));a(E)}}const M="\uFEFF"+g.join(`
`),T=new Blob([M],{type:"text/csv;charset=utf-8;"});wt(T,e),a&&a(100),t()}catch(i){r(i)}})}function Ks(o,e="webhook-logs.json",s={}){return new Promise((t,r)=>{try{if(!Array.isArray(o)||o.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{pretty:i=!0,onProgress:a=null}=s,l=i?JSON.stringify(o,null,2):JSON.stringify(o);a&&a(50);const u=new Blob([l],{type:"application/json;charset=utf-8;"});wt(u,e),a&&a(100),t()}catch(i){r(i)}})}function wt(o,e){const s=URL.createObjectURL(o),t=document.createElement("a");t.href=s,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(s)},100)}function Ys(o,e={},s=0){const t=new Date().toISOString().split("T")[0],r=new Date().toTimeString().split(" ")[0].replace(/:/g,"-");let i=`webhook-logs_${t}_${r}`;const a=[];return e.category&&a.push(`cat-${e.category}`),e.event&&a.push(`evt-${e.event.substring(0,10)}`),e.dateFrom&&a.push(`from-${e.dateFrom}`),e.dateTo&&a.push(`to-${e.dateTo}`),a.length>0&&(i+=`_${a.join("-")}`),s>0&&(i+=`_${s}records`),`${i}.${o}`}function Gs(o){const e=[];if(!Array.isArray(o))return e.push("–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),{valid:!1,errors:e,estimatedSize:0};if(o.length===0)return e.push("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"),{valid:!1,errors:e,estimatedSize:0};const s=JSON.stringify(o).length,t=50*1024*1024;return s>t&&e.push(`–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö (${Math.round(s/1024/1024)} MB). –≠–∫—Å–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è.`),{valid:e.length===0,errors:e,estimatedSize:s}}function at(o,e="short"){if(!o)return"‚Äî";try{const s=new Date(o);if(isNaN(s.getTime()))return"Invalid date";switch(e){case"short":return s.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});case"long":return s.toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});case"relative":return Qs(s);default:return s.toLocaleString("ru-RU")}}catch{return"Invalid date"}}function Qs(o){const s=new Date-o,t=Math.floor(s/1e3),r=Math.floor(t/60),i=Math.floor(r/60),a=Math.floor(i/24);return t<60?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":r<60?`${r} ${tt(r,"–º–∏–Ω—É—Ç—É","–º–∏–Ω—É—Ç—ã","–º–∏–Ω—É—Ç")} –Ω–∞–∑–∞–¥`:i<24?`${i} ${tt(i,"—á–∞—Å","—á–∞—Å–∞","—á–∞—Å–æ–≤")} –Ω–∞–∑–∞–¥`:a<7?`${a} ${tt(a,"–¥–µ–Ω—å","–¥–Ω—è","–¥–Ω–µ–π")} –Ω–∞–∑–∞–¥`:at(o.toISOString(),"short")}function tt(o,e,s,t){const r=o%10,i=o%100;return r===1&&i!==11?e:r>=2&&r<=4&&(i<10||i>=20)?s:t}function xe(o){return o?o.replace(/^ON/,"").split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):"‚Äî"}function be(o){return{tasks:"–ó–∞–¥–∞—á–∏","smart-processes":"–°–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å—ã",errors:"–û—à–∏–±–∫–∏"}[o]||o}function rt(o){if(!o||typeof o!="object")return"‚Äî";const e=[];if(o.task_id&&e.push(`–ó–∞–¥–∞—á–∞ #${o.task_id}`),o.entity_id&&e.push(`–°—É—â–Ω–æ—Å—Ç—å #${o.entity_id}`),o.task_title&&e.push(`"${o.task_title}"`),o.title&&e.push(`"${o.title}"`),o.comment_text){const s=o.comment_text.length>50?o.comment_text.substring(0,50)+"...":o.comment_text;e.push(`–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${s}`)}return e.length>0?e.join(" ‚Ä¢ "):"‚Äî"}const Zs={name:"WebhookLogsExport",props:{logs:{type:Array,default:()=>[]},selectedLogs:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},totalCount:{type:Number,default:0}},emits:["export-start","export-complete","export-error"],setup(o,{emit:e}){const s=C(!1),t=C("csv"),r=C("all"),i=C(!0),a=C(!1),l=C(0),u=C([]),g=C(null),p=S(()=>o.selectedLogs.length),f=S(()=>o.logs.length>0||o.totalCount>0),M=S(()=>o.filters.category||o.filters.event||o.filters.dateFrom||o.filters.dateTo),T=S(()=>r.value==="selected"?p.value:o.logs.length||o.totalCount),k=S(()=>r.value==="selected"?p.value>0:f.value),w=()=>{l.value=0,u.value=[],g.value=null,p.value>0?r.value="selected":r.value="all",s.value=!0,b()},E=()=>{a.value||(s.value=!1)},b=()=>{const I=L(),_=Gs(I);u.value=_.errors,g.value=_.estimatedSize},L=()=>(r.value==="selected"?o.selectedLogs:o.logs).map(h=>Le(h)).filter(h=>ye(h)?!0:(console.warn("[WebhookLogsExport] Skipping invalid log:",h),!1)),D=async()=>{try{a.value=!0,l.value=0;let I=L();if(I.length===0)throw new Error("–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const _=I.map(x=>({timestamp:x.timestamp,event:x.event,category:x.category,ip:x.ip||null,details:x.details||null,payload:x.payload||null,formatted:{timestamp:at(x.timestamp),event:xe(x.event),category:be(x.category),details:rt(x.details)}}));e("export-start",{format:t.value,scope:r.value,count:_.length});const h=Ys(t.value,o.filters,_.length),v=x=>{l.value=x};t.value==="csv"?await Js(_,h,{onProgress:v}):await Ks(_,h,{pretty:i.value,onProgress:v}),e("export-complete",{format:t.value,filename:h,count:_.length}),setTimeout(()=>{a.value=!1,s.value=!1,l.value=0},500)}catch(I){console.error("[WebhookLogsExport] Export error:",I),e("export-error",I),a.value=!1,l.value=0,alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${I.message}`)}},z=I=>I<1024?`${I} B`:I<1024*1024?`${(I/1024).toFixed(2)} KB`:`${(I/1024/1024).toFixed(2)} MB`;return se([r,()=>o.logs,()=>o.selectedLogs],()=>{s.value&&b()}),{showExportModal:s,exportFormat:t,exportScope:r,jsonPretty:i,exporting:a,exportProgress:l,exportWarnings:u,estimatedSize:g,selectedCount:p,hasAllLogs:f,hasFilters:M,exportCount:T,canExport:k,openExportModal:w,closeExportModal:E,handleExport:D,formatSize:z}}},eo={class:"webhook-logs-export"},to=["disabled","title"],so={key:0,class:"selected-badge"},oo={class:"export-modal-header"},no={class:"export-modal-body"},ao={class:"export-section"},ro={class:"radio-group"},io={class:"export-section"},lo={class:"radio-group"},co=["disabled"],uo={class:"radio-label"},mo={key:0},go={key:1},fo=["disabled"],ho={class:"radio-label"},vo={key:0,class:"export-section"},po={class:"checkbox-option"},yo={class:"export-info"},_o={class:"info-item"},wo={class:"info-value"},bo={key:0,class:"info-item"},Co={class:"info-value"},So={key:1,class:"export-warnings"},ko={key:0,class:"export-progress"},Eo={class:"progress-bar"},Ao={class:"progress-text"},To={class:"export-modal-footer"},Mo=["disabled"],Lo={key:0},xo={key:1},Do=["disabled"];function Io(o,e,s,t,r,i){return c(),d("div",eo,[n("button",{onClick:e[0]||(e[0]=(...a)=>t.openExportModal&&t.openExportModal(...a)),class:"btn-export",disabled:!t.canExport,title:t.canExport?"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"},[e[11]||(e[11]=n("span",{class:"btn-icon"},"üì•",-1)),e[12]||(e[12]=n("span",{class:"btn-text"},"–≠–∫—Å–ø–æ—Ä—Ç",-1)),t.selectedCount>0?(c(),d("span",so,m(t.selectedCount),1)):A("",!0)],8,to),j(_e,{name:"modal"},{default:ie(()=>[t.showExportModal?(c(),d("div",{key:0,class:"export-modal-overlay",onClick:e[10]||(e[10]=(...a)=>t.closeExportModal&&t.closeExportModal(...a))},[n("div",{class:"export-modal",onClick:e[9]||(e[9]=ge(()=>{},["stop"]))},[n("div",oo,[e[13]||(e[13]=n("h3",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",-1)),n("button",{onClick:e[1]||(e[1]=(...a)=>t.closeExportModal&&t.closeExportModal(...a)),class:"btn-close"},"‚úï")]),n("div",no,[n("div",ao,[e[16]||(e[16]=n("h4",null,"–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞",-1)),n("div",ro,[n("label",{class:N(["radio-option",{active:t.exportFormat==="csv"}])},[J(n("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=a=>t.exportFormat=a),value:"csv",class:"radio-input"},null,512),[[$e,t.exportFormat]]),e[14]||(e[14]=n("span",{class:"radio-label"},[n("strong",null,"CSV"),n("small",null,"–î–ª—è Excel, LibreOffice")],-1))],2),n("label",{class:N(["radio-option",{active:t.exportFormat==="json"}])},[J(n("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=a=>t.exportFormat=a),value:"json",class:"radio-input"},null,512),[[$e,t.exportFormat]]),e[15]||(e[15]=n("span",{class:"radio-label"},[n("strong",null,"JSON"),n("small",null,"–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, API")],-1))],2)])]),n("div",io,[e[19]||(e[19]=n("h4",null,"–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",-1)),n("div",lo,[n("label",{class:N(["radio-option",{active:t.exportScope==="all",disabled:!t.hasAllLogs}])},[J(n("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=a=>t.exportScope=a),value:"all",disabled:!t.hasAllLogs,class:"radio-input"},null,8,co),[[$e,t.exportScope]]),n("span",uo,[e[17]||(e[17]=n("strong",null,"–í—Å–µ –∑–∞–ø–∏—Å–∏",-1)),t.hasFilters?(c(),d("small",mo,"–° –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ ("+m(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π)",1)):(c(),d("small",go,"–í—Å–µ–≥–æ: "+m(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π",1))])],2),n("label",{class:N(["radio-option",{active:t.exportScope==="selected",disabled:t.selectedCount===0}])},[J(n("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=a=>t.exportScope=a),value:"selected",disabled:t.selectedCount===0,class:"radio-input"},null,8,fo),[[$e,t.exportScope]]),n("span",ho,[e[18]||(e[18]=n("strong",null,"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏",-1)),n("small",null,m(t.selectedCount)+" –∑–∞–ø–∏—Å–µ–π –≤—ã–±—Ä–∞–Ω–æ",1)])],2)])]),t.exportFormat==="json"?(c(),d("div",vo,[e[21]||(e[21]=n("h4",null,"–û–ø—Ü–∏–∏ JSON",-1)),n("label",po,[J(n("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=a=>t.jsonPretty=a),class:"checkbox-input"},null,512),[[mt,t.jsonPretty]]),e[20]||(e[20]=n("span",{class:"checkbox-label"},"–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)",-1))])])):A("",!0),n("div",yo,[n("div",_o,[e[22]||(e[22]=n("span",{class:"info-label"},"–ó–∞–ø–∏—Å–µ–π –∫ —ç–∫—Å–ø–æ—Ä—Ç—É:",-1)),n("span",wo,m(t.exportCount),1)]),t.estimatedSize?(c(),d("div",bo,[e[23]||(e[23]=n("span",{class:"info-label"},"–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä:",-1)),n("span",Co,m(t.formatSize(t.estimatedSize)),1)])):A("",!0)]),t.exportWarnings.length>0?(c(),d("div",So,[(c(!0),d(H,null,q(t.exportWarnings,(a,l)=>(c(),d("div",{key:l,class:"warning-item"}," ‚ö†Ô∏è "+m(a),1))),128))])):A("",!0)]),t.exporting?(c(),d("div",ko,[n("div",Eo,[n("div",{class:"progress-fill",style:Re({width:`${t.exportProgress}%`})},null,4)]),n("div",Ao," –≠–∫—Å–ø–æ—Ä—Ç: "+m(t.exportProgress)+"% ",1)])):A("",!0),n("div",To,[n("button",{onClick:e[7]||(e[7]=(...a)=>t.handleExport&&t.handleExport(...a)),disabled:t.exporting||!t.canExport,class:"btn-primary"},[t.exporting?(c(),d("span",Lo,"–≠–∫—Å–ø–æ—Ä—Ç...")):(c(),d("span",xo,"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"))],8,Mo),n("button",{onClick:e[8]||(e[8]=(...a)=>t.closeExportModal&&t.closeExportModal(...a)),disabled:t.exporting,class:"btn-secondary"}," –û—Ç–º–µ–Ω–∞ ",8,Do)])])])):A("",!0)]),_:1})])}const Po=O(Zs,[["render",Io],["__scopeId","data-v-7ae66f8c"]]);function Uo(o,e=300){let s;return function(...r){const i=()=>{clearTimeout(s),o(...r)};clearTimeout(s),s=setTimeout(i,e)}}const Ro={name:"WebhookLogSearch",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","search"],setup(o,{emit:e}){const s=C(o.modelValue||""),t=C(!1),r=C(null),i=Uo(T=>{t.value=!1,e("search",T)},400),a=()=>{t.value=!0,e("update:modelValue",s.value),i(s.value)},l=()=>{t.value=!1,e("search",s.value)},u=()=>{s.value="",t.value=!1,r.value=null,e("update:modelValue",""),e("search","")};return se(()=>o.modelValue,T=>{T!==s.value&&(s.value=T)}),{searchQuery:s,isSearching:t,searchResultsCount:r,handleSearchInput:a,handleSearch:l,clearSearch:u,setResultsCount:T=>{r.value=T},getResultsText:T=>{const k=T%10,w=T%100;return w>=11&&w<=19?"–∑–∞–ø–∏—Å–µ–π":k===1?"–∑–∞–ø–∏—Å—å":k>=2&&k<=4?"–∑–∞–ø–∏—Å–∏":"–∑–∞–ø–∏—Å–µ–π"},performSearch:(T,k)=>{if(!T||!k||!Array.isArray(k))return[];const w=T.toLowerCase().trim();return w.length===0?k:k.map(b=>Le(b)).filter(b=>ye(b)).filter(b=>{if(b.event&&b.event.toLowerCase().includes(w)||b.category&&b.category.toLowerCase().includes(w)||b.ip&&b.ip.toLowerCase().includes(w)||b.details&&typeof b.details=="object"&&(b.details.task_id&&String(b.details.task_id).includes(w)||b.details.task_title&&b.details.task_title.toLowerCase().includes(w)||b.details.entity_id&&String(b.details.entity_id).includes(w)||b.details.title&&b.details.title.toLowerCase().includes(w)||b.details.comment_text&&b.details.comment_text.toLowerCase().includes(w)))return!0;if(b.payload&&typeof b.payload=="object")try{if(JSON.stringify(b.payload).toLowerCase().includes(w))return!0}catch{}return!1})},formatSearchResult:T=>{const k=[];if(T.event&&k.push(xe(T.event)),T.category&&k.push(be(T.category)),T.details){const w=rt(T.details);w!=="‚Äî"&&k.push(w)}return k.join(" ‚Ä¢ ")}}}},No={class:"webhook-search"},Fo={class:"search-wrapper"},Oo={key:0,class:"search-indicator"},Bo={key:1,class:"search-results"};function $o(o,e,s,t,r,i){return c(),d("div",No,[n("div",Fo,[e[5]||(e[5]=n("span",{class:"search-icon"},"üîç",-1)),J(n("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.searchQuery=a),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ª–æ–≥–æ–≤ (—Å–æ–±—ã—Ç–∏–µ, payload, IP, –¥–µ—Ç–∞–ª–∏)...",class:"search-input",onInput:e[1]||(e[1]=(...a)=>t.handleSearchInput&&t.handleSearchInput(...a)),onKeyup:[e[2]||(e[2]=pe((...a)=>t.handleSearch&&t.handleSearch(...a),["enter"])),e[3]||(e[3]=pe((...a)=>t.clearSearch&&t.clearSearch(...a),["esc"]))]},null,544),[[ke,t.searchQuery]]),t.searchQuery?(c(),d("button",{key:0,onClick:e[4]||(e[4]=(...a)=>t.clearSearch&&t.clearSearch(...a)),class:"clear-button",title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ (Esc)","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):A("",!0)]),t.isSearching?(c(),d("div",Oo,[...e[6]||(e[6]=[n("span",{class:"spinner"},null,-1),Y(" –ü–æ–∏—Å–∫... ",-1)])])):A("",!0),t.searchQuery&&t.searchResultsCount!==null?(c(),d("div",Bo," –ù–∞–π–¥–µ–Ω–æ: "+m(t.searchResultsCount)+" "+m(t.getResultsText(t.searchResultsCount)),1)):A("",!0)])}const zo=O(Ro,[["render",$o],["__scopeId","data-v-db228863"]]);function jo(o,e=null){const s=()=>{try{const a=localStorage.getItem(o);return a?JSON.parse(a):e}catch(a){return console.error(`Error loading ${o} from localStorage:`,a),e}},t=a=>{try{localStorage.setItem(o,JSON.stringify(a))}catch(l){console.error(`Error saving ${o} to localStorage:`,l)}},r=()=>{try{localStorage.removeItem(o)}catch(a){console.error(`Error clearing ${o} from localStorage:`,a)}},i=C(s());return se(i,a=>{t(a)},{deep:!0}),{value:i,save:t,load:s,clear:r}}const Wo={name:"WebhookLogFilters",props:{filters:{type:Object,required:!0}},emits:["update:filters","reset"],setup(o,{emit:e}){const s=C(null),t=jo("webhook-filters",{category:null,event:null,dateFrom:null,dateTo:null,hour:null,ip:null,status:null}),r=h=>(s.value=null,ot(h)?(e("update:filters",h),!0):(s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",console.error("[WebhookLogFilters] Validation error:",s.value),!1)),i=new Date().toISOString().split("T")[0],a=C({category:t.value.category||o.filters.category||null,event:t.value.event||o.filters.event||null,dateFrom:t.value.dateFrom||o.filters.dateFrom||o.filters.date||i,dateTo:t.value.dateTo||o.filters.dateTo||null,hour:t.value.hour!==void 0?t.value.hour:o.filters.hour!==void 0?o.filters.hour:null,ip:t.value.ip||o.filters.ip||null,status:t.value.status||o.filters.status||null}),l=C(null),u=[{id:"today",label:"–°–µ–≥–æ–¥–Ω—è",getDates:()=>({from:i,to:i})},{id:"yesterday",label:"–í—á–µ—Ä–∞",getDates:()=>{const h=new Date;h.setDate(h.getDate()-1);const v=h.toISOString().split("T")[0];return{from:v,to:v}}},{id:"last7days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",getDates:()=>{const h=new Date;return h.setDate(h.getDate()-7),{from:h.toISOString().split("T")[0],to:i}}},{id:"last30days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π",getDates:()=>{const h=new Date;return h.setDate(h.getDate()-30),{from:h.toISOString().split("T")[0],to:i}}}],g=h=>{const v=u.find(x=>x.id===h);if(v){const x=v.getDates();a.value.dateFrom=x.from,a.value.dateTo=x.to,l.value=h,I()}};se(()=>o.filters,h=>{a.value={category:h.category||null,event:h.event||null,dateFrom:h.dateFrom||h.date||i,dateTo:h.dateTo||null,hour:h.hour!==void 0?h.hour:null,ip:h.ip||null,status:h.status||null}},{deep:!0}),se(a,h=>{t.value={...h},e("update:filters",{...h})},{deep:!0});const p=S(()=>{const h={};return a.value.category&&(h.category=a.value.category),a.value.event&&(h.event=a.value.event),a.value.hour!==null&&(h.hour=a.value.hour),a.value.ip&&(h.ip=a.value.ip),a.value.status&&(h.status=a.value.status),a.value.dateFrom&&a.value.dateFrom!==i&&(h.dateFrom=a.value.dateFrom),a.value.dateTo&&(h.dateTo=a.value.dateTo),h}),f=S(()=>Object.keys(p.value).length>0),M=h=>({category:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è",event:"–°–æ–±—ã—Ç–∏–µ",hour:"–ß–∞—Å",ip:"IP –∞–¥—Ä–µ—Å",status:"–°—Ç–∞—Ç—É—Å",dateFrom:"–î–∞—Ç–∞ –æ—Ç",dateTo:"–î–∞—Ç–∞ –¥–æ"})[h]||h,T=(h,v)=>h==="category"?be(v)||v:h==="hour"?`${String(v).padStart(2,"0")}:00`:h==="event"?xe(v)||v:h==="status"&&{success:"–£—Å–ø–µ—à–Ω–æ",error:"–û—à–∏–±–∫–∞",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"}[v]||v,k=S(()=>[{value:null,label:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},{value:"tasks",label:be("tasks")},{value:"smart-processes",label:be("smart-processes")},{value:"errors",label:be("errors")}]),w=S(()=>[{value:null,label:"–í—Å–µ —Å–æ–±—ã—Ç–∏—è"},...["ONTASKADD","ONTASKUPDATE","ONTASKDELETE","ONTASKCOMMENTADD","ONTASKCOMMENTUPDATE","ONTASKCOMMENTDELETE","ONCRMDYNAMICITEMADD","ONCRMDYNAMICITEMUPDATE","ONCRMDYNAMICITEMDELETE"].map(v=>({value:v,label:xe(v)}))]),E=h=>{h==="hour"?a.value[h]=null:h==="dateFrom"?a.value[h]=i:a.value[h]=null,l.value=null},b=h=>{const v={...a.value,category:h||null};r(v)&&(a.value.category=h)},L=h=>{const v={...a.value,event:h||null};r(v)&&(a.value.event=h)},D=(h,v)=>{if(h&&!/^\d{4}-\d{2}-\d{2}$/.test(h)){console.error("[WebhookLogFilters] Invalid date format:",h),s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã";return}const x={...a.value,[v]:h||null};r(x)&&(a.value[v]=h)},z=h=>{if(h!=null){const x=parseInt(h,10);if(isNaN(x)||x<0||x>23){console.error("[WebhookLogFilters] Invalid hour:",h),s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∞—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23)";return}}const v={...a.value,hour:h!=null?parseInt(h,10):null};r(v)&&(a.value.hour=h!=null?parseInt(h,10):null)},I=()=>{r({...a.value})},_=()=>{a.value={category:null,event:null,dateFrom:i,dateTo:null,hour:null,ip:null,status:null},l.value=null,t.clear(),e("reset")};return te(()=>{t.value&&Object.keys(t.value).length>0&&e("update:filters",{...t.value})}),{localFilters:a,activeFilters:p,hasActiveFilters:f,getFilterLabel:M,getFilterValue:T,clearFilter:E,handleFilterChange:I,handleCategoryChange:b,handleEventChange:L,handleDateChange:D,handleHourChange:z,handleReset:_,quickFilters:u,activeQuickFilter:l,applyQuickFilter:g,categoryOptions:k,eventOptions:w,validationError:s}}},Vo={class:"webhook-log-filters"},Ho={key:0,class:"active-filters-indicator"},qo=["onClick"],Xo={key:1,class:"validation-error"},Jo={class:"quick-filters"},Ko=["onClick"],Yo={class:"filters-row"},Go={class:"filter-group"},Qo=["value"],Zo={class:"filter-group"},en=["value"],tn={class:"filter-group"},sn={class:"filter-group"},on={class:"filter-group"},nn={class:"filter-group"},an={class:"filter-group"};function rn(o,e,s,t,r,i){return c(),d("div",Vo,[t.hasActiveFilters?(c(),d("div",Ho,[e[14]||(e[14]=n("span",{class:"indicator-text"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(H,null,q(t.activeFilters,(a,l)=>(c(),d("span",{key:l,class:"filter-badge"},[Y(m(t.getFilterLabel(l))+": "+m(t.getFilterValue(l,a))+" ",1),n("button",{onClick:u=>t.clearFilter(l),class:"filter-badge-remove",title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"}," √ó ",8,qo)]))),128)),n("button",{onClick:e[0]||(e[0]=(...a)=>t.handleReset&&t.handleReset(...a)),class:"btn-clear-all"}," –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ ")])):A("",!0),t.validationError?(c(),d("div",Xo," ‚ö†Ô∏è "+m(t.validationError),1)):A("",!0),n("div",Jo,[e[15]||(e[15]=n("span",{class:"quick-filters-label"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(H,null,q(t.quickFilters,a=>(c(),d("button",{key:a.id,onClick:l=>t.applyQuickFilter(a.id),class:N(["quick-filter-btn",{active:t.activeQuickFilter===a.id}])},m(a.label),11,Ko))),128))]),n("div",Yo,[n("div",Go,[e[16]||(e[16]=n("label",{for:"category-filter"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è:",-1)),J(n("select",{id:"category-filter","onUpdate:modelValue":e[1]||(e[1]=a=>t.localFilters.category=a),onChange:e[2]||(e[2]=a=>t.handleCategoryChange(t.localFilters.category)),class:"filter-select"},[(c(!0),d(H,null,q(t.categoryOptions,a=>(c(),d("option",{key:a.value,value:a.value},m(a.label),9,Qo))),128))],544),[[Ee,t.localFilters.category]])]),n("div",Zo,[e[17]||(e[17]=n("label",{for:"event-filter"},"–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:",-1)),J(n("select",{id:"event-filter","onUpdate:modelValue":e[3]||(e[3]=a=>t.localFilters.event=a),onChange:e[4]||(e[4]=a=>t.handleEventChange(t.localFilters.event)),class:"filter-select"},[(c(!0),d(H,null,q(t.eventOptions,a=>(c(),d("option",{key:a.value,value:a.value},m(a.label),9,en))),128))],544),[[Ee,t.localFilters.event]])]),n("div",tn,[e[18]||(e[18]=n("label",{for:"date-from-filter"},"–î–∞—Ç–∞ –æ—Ç:",-1)),J(n("input",{id:"date-from-filter","onUpdate:modelValue":e[5]||(e[5]=a=>t.localFilters.dateFrom=a),type:"date",onChange:e[6]||(e[6]=a=>t.handleDateChange(t.localFilters.dateFrom,"dateFrom")),class:"filter-input"},null,544),[[ke,t.localFilters.dateFrom]])]),n("div",sn,[e[19]||(e[19]=n("label",{for:"date-to-filter"},"–î–∞—Ç–∞ –¥–æ:",-1)),J(n("input",{id:"date-to-filter","onUpdate:modelValue":e[7]||(e[7]=a=>t.localFilters.dateTo=a),type:"date",onChange:e[8]||(e[8]=a=>t.handleDateChange(t.localFilters.dateTo,"dateTo")),class:"filter-input"},null,544),[[ke,t.localFilters.dateTo]])]),n("div",on,[e[20]||(e[20]=n("label",{for:"ip-filter"},"IP –∞–¥—Ä–µ—Å:",-1)),J(n("input",{id:"ip-filter","onUpdate:modelValue":e[9]||(e[9]=a=>t.localFilters.ip=a),type:"text",placeholder:"192.168.1.1",onInput:e[10]||(e[10]=(...a)=>t.handleFilterChange&&t.handleFilterChange(...a)),class:"filter-input"},null,544),[[ke,t.localFilters.ip]])]),n("div",nn,[e[22]||(e[22]=n("label",{for:"status-filter"},"–°—Ç–∞—Ç—É—Å:",-1)),J(n("select",{id:"status-filter","onUpdate:modelValue":e[11]||(e[11]=a=>t.localFilters.status=a),onChange:e[12]||(e[12]=(...a)=>t.handleFilterChange&&t.handleFilterChange(...a)),class:"filter-select"},[...e[21]||(e[21]=[n("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),n("option",{value:"success"},"–£—Å–ø–µ—à–Ω–æ",-1),n("option",{value:"error"},"–û—à–∏–±–∫–∞",-1),n("option",{value:"warning"},"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",-1)])],544),[[Ee,t.localFilters.status]])]),n("div",an,[n("button",{onClick:e[13]||(e[13]=(...a)=>t.handleReset&&t.handleReset(...a)),class:"btn-reset"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])])}const ln=O(Wo,[["render",rn],["__scopeId","data-v-2a150a46"]]),cn={name:"WebhookLogList",props:{logs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null},pagination:{type:Object,default:null},selectedLogs:{type:Array,default:()=>[]}},emits:["select-log","page-change","update:selectedLogs"],setup(o,{emit:e}){const s=S(()=>!o.logs||!Array.isArray(o.logs)?(console.warn("[WebhookLogList] Invalid logs prop:",o.logs),[]):o.logs.map(v=>Le(v)).filter(v=>ye(v)?!0:(console.warn("[WebhookLogList] Invalid log entry:",v),!1))),t=C("timestamp"),r=C("desc"),i=v=>{t.value===v?r.value=r.value==="asc"?"desc":"asc":(t.value=v,r.value="desc")},a=S(()=>!s.value||s.value.length===0?[]:[...s.value].sort((x,X)=>{let P,B;switch(t.value){case"timestamp":P=new Date(x.timestamp||0).getTime(),B=new Date(X.timestamp||0).getTime();break;case"event":P=(x.event||"").toLowerCase(),B=(X.event||"").toLowerCase();break;case"category":P=(x.category||"").toLowerCase(),B=(X.category||"").toLowerCase();break;case"ip":P=(x.ip||"").toLowerCase(),B=(X.ip||"").toLowerCase();break;default:return 0}return P<B?r.value==="asc"?-1:1:P>B?r.value==="asc"?1:-1:0})),l=v=>t.value!==v?"‚ÜïÔ∏è":r.value==="asc"?"‚Üë":"‚Üì",u=v=>v.category==="errors"?"status-error":"status-success",g=v=>v.category==="errors"?"‚ùå":"‚úÖ",p=v=>v.category==="errors"?"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏":"–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ",f=v=>`${v.timestamp}_${v.event}_${v.ip||"unknown"}`,M=v=>v?at(v,"short"):"‚Äî",T=v=>v?xe(v):"‚Äî",k=v=>v?be(v):"‚Äî",w=v=>!v||typeof v!="object"?"‚Äî":rt(v),E=v=>`category-${v}`,b=v=>v?.startsWith("ONTASK")?"event-task":v?.startsWith("ONCRMDYNAMIC")?"event-smart-process":"event-other",L=v=>{e("select-log",v)},D=v=>{v>=1&&v<=o.pagination.pages&&e("page-change",v)},z=v=>o.selectedLogs.some(x=>f(x)===f(v)),I=(v,x)=>{x.stopPropagation();const X=[...o.selectedLogs],P=f(v),B=X.findIndex(ae=>f(ae)===P);x.target.checked?B===-1&&X.push(v):B!==-1&&X.splice(B,1),e("update:selectedLogs",X)},_=v=>{v.target.checked?e("update:selectedLogs",[...o.logs]):e("update:selectedLogs",[])},h=S(()=>s.value.length>0&&s.value.every(v=>z(v)));return se(()=>o.logs,v=>{if(v&&Array.isArray(v)){const x=v.filter(X=>!ye(X)).length;x>0&&console.warn(`[WebhookLogList] Received ${x} invalid log entries out of ${v.length}`)}},{immediate:!0}),{validatedLogs:s,sortBy:t,sortOrder:r,sortedLogs:a,handleSort:i,getSortIcon:l,getStatusClass:u,getStatusIcon:g,getStatusTitle:p,getLogId:f,formatTimestamp:M,formatEvent:T,formatCategoryLabel:k,formatDetailsPreview:w,getCategoryClass:E,getEventClass:b,handleLogClick:L,handlePageChange:D,isSelected:z,handleSelectLog:I,handleSelectAll:_,allSelected:h}}},dn={class:"webhook-log-list"},un={key:0,class:"logs-table-container"},mn={class:"logs-table"},gn={class:"checkbox-header"},fn=["checked"],hn={class:"sort-icon"},vn={class:"sort-icon"},pn={class:"sort-icon"},yn={class:"sort-icon"},_n=["onClick"],wn=["checked","onChange"],bn=["title"],Cn={class:"details-preview"},Sn=["onClick"],kn={key:0,class:"pagination"},En=["disabled"],An={class:"pagination-info"},Tn=["disabled"];function Mn(o,e,s,t,r,i){return c(),d("div",dn,[s.logs.length>0?(c(),d("div",un,[n("table",mn,[n("thead",null,[n("tr",null,[n("th",gn,[n("input",{type:"checkbox",checked:t.allSelected,onChange:e[0]||(e[0]=(...a)=>t.handleSelectAll&&t.handleSelectAll(...a)),onClick:e[1]||(e[1]=ge(()=>{},["stop"])),class:"checkbox-input",title:"–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"},null,40,fn)]),n("th",{onClick:e[2]||(e[2]=a=>t.handleSort("timestamp")),class:N(["sortable",{"sort-asc":t.sortBy==="timestamp"&&t.sortOrder==="asc","sort-desc":t.sortBy==="timestamp"&&t.sortOrder==="desc"}])},[e[9]||(e[9]=Y(" –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è ",-1)),n("span",hn,m(t.getSortIcon("timestamp")),1)],2),n("th",{onClick:e[3]||(e[3]=a=>t.handleSort("event")),class:N(["sortable",{"sort-asc":t.sortBy==="event"&&t.sortOrder==="asc","sort-desc":t.sortBy==="event"&&t.sortOrder==="desc"}])},[e[10]||(e[10]=Y(" –¢–∏–ø —Å–æ–±—ã—Ç–∏—è ",-1)),n("span",vn,m(t.getSortIcon("event")),1)],2),n("th",{onClick:e[4]||(e[4]=a=>t.handleSort("category")),class:N(["sortable",{"sort-asc":t.sortBy==="category"&&t.sortOrder==="asc","sort-desc":t.sortBy==="category"&&t.sortOrder==="desc"}])},[e[11]||(e[11]=Y(" –ö–∞—Ç–µ–≥–æ—Ä–∏—è ",-1)),n("span",pn,m(t.getSortIcon("category")),1)],2),n("th",{onClick:e[5]||(e[5]=a=>t.handleSort("ip")),class:N(["sortable",{"sort-asc":t.sortBy==="ip"&&t.sortOrder==="asc","sort-desc":t.sortBy==="ip"&&t.sortOrder==="desc"}])},[e[12]||(e[12]=Y(" IP ",-1)),n("span",yn,m(t.getSortIcon("ip")),1)],2),e[13]||(e[13]=n("th",null,"–î–µ—Ç–∞–ª–∏",-1)),e[14]||(e[14]=n("th",null,"–î–µ–π—Å—Ç–≤–∏—è",-1))])]),n("tbody",null,[(c(!0),d(H,null,q(t.sortedLogs,a=>(c(),d("tr",{key:t.getLogId(a),onClick:l=>t.handleLogClick(a),class:N(["log-row",{"row-selected":t.isSelected(a)}])},[n("td",{onClick:e[6]||(e[6]=ge(()=>{},["stop"]))},[n("input",{type:"checkbox",checked:t.isSelected(a),onChange:l=>t.handleSelectLog(a,l),class:"checkbox-input"},null,40,wn)]),n("td",null,m(t.formatTimestamp(a.timestamp)),1),n("td",null,[n("span",{class:N(["status-indicator",t.getStatusClass(a)]),title:t.getStatusTitle(a)},m(t.getStatusIcon(a)),11,bn),n("span",{class:N(["event-badge",t.getEventClass(a.event)])},m(t.formatEvent(a.event)),3)]),n("td",null,[n("span",{class:N(["category-badge",t.getCategoryClass(a.category)])},m(t.formatCategoryLabel(a.category)),3)]),n("td",null,m(a.ip||"N/A"),1),n("td",null,[n("div",Cn,m(t.formatDetailsPreview(a.details)),1)]),n("td",null,[n("button",{onClick:ge(l=>t.handleLogClick(a),["stop"]),class:"btn-view"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,Sn)])],10,_n))),128))])]),s.pagination&&s.pagination.pages>1?(c(),d("div",kn,[n("button",{onClick:e[7]||(e[7]=a=>t.handlePageChange(s.pagination.page-1)),disabled:s.pagination.page<=1,class:"btn-pagination"}," –ù–∞–∑–∞–¥ ",8,En),n("span",An," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+m(s.pagination.page)+" –∏–∑ "+m(s.pagination.pages)+" (–≤—Å–µ–≥–æ: "+m(s.pagination.total)+") ",1),n("button",{onClick:e[8]||(e[8]=a=>t.handlePageChange(s.pagination.page+1)),disabled:s.pagination.page>=s.pagination.pages,class:"btn-pagination"}," –í–ø–µ—Ä—ë–¥ ",8,Tn)])):A("",!0)])):A("",!0)])}const Ln=O(cn,[["render",Mn],["__scopeId","data-v-fddd3018"]]),xn={name:"LoadingSkeleton",props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"20px"},variant:{type:String,default:"rect",validator:o=>["rect","circle","text","table-row"].includes(o)},animated:{type:Boolean,default:!0},borderRadius:{type:String,default:null}},setup(o){return{skeletonStyle:S(()=>{const s={width:typeof o.width=="number"?`${o.width}px`:o.width,height:typeof o.height=="number"?`${o.height}px`:o.height};return o.borderRadius&&(s.borderRadius=o.borderRadius),s})}}},Dn={key:0,class:"skeleton-shimmer"};function In(o,e,s,t,r,i){return c(),d("div",{class:N(["skeleton",[`skeleton-${s.variant}`,{"skeleton-animated":s.animated}]]),style:Re(t.skeletonStyle)},[s.animated?(c(),d("div",Dn)):A("",!0)],6)}const Pn=O(xn,[["render",In],["__scopeId","data-v-014f86e6"]]),Un={name:"SkeletonLogList",components:{LoadingSkeleton:Pn},props:{rows:{type:Number,default:5}},setup(){return{getColumnWidth:e=>["40px","15%","20%","15%","15%","20%","15%"][e-1]||"100%"}}},Rn={class:"skeleton-log-list"},Nn={class:"skeleton-table-header"};function Fn(o,e,s,t,r,i){const a=$("LoadingSkeleton");return c(),d("div",Rn,[n("div",Nn,[(c(),d(H,null,q(7,l=>j(a,{key:l,width:"120px",height:"16px",variant:"text"})),64))]),(c(!0),d(H,null,q(s.rows,l=>(c(),d("div",{key:l,class:"skeleton-table-row"},[(c(),d(H,null,q(7,u=>j(a,{key:u,width:"100%",height:"20px",variant:"text",style:Re({width:t.getColumnWidth(u)})},null,8,["style"])),64))]))),128))])}const On=O(Un,[["render",Fn],["__scopeId","data-v-475c4e73"]]),Bn={name:"EmptyState",props:{icon:{type:String,default:"üì≠"},title:{type:String,required:!0},description:{type:String,required:!0},actionLabel:{type:String,default:null},actions:{type:Array,default:null},hints:{type:Array,default:()=>[]},variant:{type:String,default:"default",validator:o=>["default","error","warning","info"].includes(o)}},emits:["action","action-click"]},$n={class:"empty-icon"},zn={class:"empty-title"},jn={class:"empty-description"},Wn={key:0,class:"empty-hints"},Vn={key:1,class:"empty-actions"},Hn=["onClick"];function qn(o,e,s,t,r,i){return c(),d("div",{class:N(["empty-state",`empty-state-${s.variant}`])},[n("div",$n,m(s.icon),1),n("h3",zn,m(s.title),1),n("p",jn,m(s.description),1),s.hints&&s.hints.length>0?(c(),d("div",Wn,[(c(!0),d(H,null,q(s.hints,(a,l)=>(c(),d("div",{key:l,class:"hint-item"}," üí° "+m(a),1))),128))])):A("",!0),s.actionLabel||s.actions?(c(),d("div",Vn,[s.actionLabel?(c(),d("button",{key:0,onClick:e[0]||(e[0]=a=>o.$emit("action")),class:"btn-primary"},m(s.actionLabel),1)):A("",!0),(c(!0),d(H,null,q(s.actions,(a,l)=>(c(),d("button",{key:l,onClick:u=>o.$emit("action-click",a.id),class:N(["btn",`btn-${a.variant||"secondary"}`])},m(a.label),11,Hn))),128))])):A("",!0)],2)}const Xn=O(Bn,[["render",qn],["__scopeId","data-v-081c13b9"]]),Jn={name:"ErrorDisplay",props:{title:{type:String,default:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"},message:{type:String,required:!0},details:{type:String,default:null},severity:{type:String,default:"error",validator:o=>["error","warning","critical"].includes(o)},retryable:{type:Boolean,default:!1}},emits:["retry"],setup(){return{showDetails:C(!1)}}},Kn={class:"error-icon"},Yn={class:"error-content"},Gn={class:"error-title"},Qn={class:"error-message"},Zn={key:0,class:"error-details"},ea={class:"error-actions"};function ta(o,e,s,t,r,i){return c(),d("div",{class:N(["error-display",`error-${s.severity}`])},[n("div",Kn,m(s.severity==="critical"?"üö®":"‚ö†Ô∏è"),1),n("div",Yn,[n("h4",Gn,m(s.title),1),n("p",Qn,m(s.message),1),s.details&&t.showDetails?(c(),d("div",Zn,[n("pre",null,m(s.details),1)])):A("",!0),n("div",ea,[s.retryable?(c(),d("button",{key:0,onClick:e[0]||(e[0]=a=>o.$emit("retry")),class:"btn-retry"}," üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")):A("",!0),s.details?(c(),d("button",{key:1,onClick:e[1]||(e[1]=a=>t.showDetails=!t.showDetails),class:"btn-details"},m(t.showDetails?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å")+" –¥–µ—Ç–∞–ª–∏ ",1)):A("",!0)])])],2)}const sa=O(Jn,[["render",ta],["__scopeId","data-v-3f2f4c14"]]),Pe=C([]);let oa=0;function bt(){const o=(l,u="info",g=3e3)=>{const p=++oa,f={id:p,message:l,type:u,duration:g,timestamp:Date.now()};return Pe.value.push(f),g>0&&setTimeout(()=>{e(p)},g),p},e=l=>{const u=Pe.value.findIndex(g=>g.id===l);u>-1&&Pe.value.splice(u,1)};return{notifications:Pe,showNotification:o,removeNotification:e,clearNotifications:()=>{Pe.value=[]},success:(l,u=3e3)=>o(l,"success",u),error:(l,u=5e3)=>o(l,"error",u),warning:(l,u=4e3)=>o(l,"warning",u),info:(l,u=3e3)=>o(l,"info",u)}}const na={name:"Notification",props:{notification:{type:Object,required:!0}},emits:["close"],setup(o,{emit:e}){const s=C(100),t=S(()=>o.notification.duration>0);let r=null;const i={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},a=S(()=>i[o.notification.type]||"‚ÑπÔ∏è"),l=()=>{e("close")},u=()=>{o.notification.onClick&&o.notification.onClick()};return te(()=>{if(t.value&&o.notification.duration>0){const g=Date.now(),p=o.notification.duration;r=setInterval(()=>{const f=Date.now()-g;s.value=Math.max(0,100-f/p*100),s.value<=0&&(clearInterval(r),l())},50)}}),qe(()=>{r&&clearInterval(r)}),{icon:a,progress:s,showProgress:t,close:l,handleClick:u}}},aa={class:"notification-content"},ra={class:"notification-icon"},ia={class:"notification-message"},la={key:0,class:"notification-progress"};function ca(o,e,s,t,r,i){return c(),d("div",{class:N(["notification",`notification-${s.notification.type}`]),onClick:e[1]||(e[1]=(...a)=>t.handleClick&&t.handleClick(...a))},[n("div",aa,[n("span",ra,m(t.icon),1),n("span",ia,m(s.notification.message),1)]),n("button",{onClick:e[0]||(e[0]=ge((...a)=>t.close&&t.close(...a),["stop"])),class:"notification-close"},"‚úï"),t.showProgress?(c(),d("div",la,[n("div",{class:"progress-bar",style:Re({width:`${t.progress}%`})},null,4)])):A("",!0)],2)}const da=O(na,[["render",ca],["__scopeId","data-v-1b602bdf"]]),ua={name:"NotificationContainer",components:{Notification:da},setup(){const{notifications:o,removeNotification:e}=bt();return{notifications:o,removeNotification:e}}},ma={class:"notification-container"};function ga(o,e,s,t,r,i){const a=$("Notification");return c(),G(gt,{to:"body"},[n("div",ma,[j(Tt,{name:"notification",tag:"div"},{default:ie(()=>[(c(!0),d(H,null,q(t.notifications,l=>(c(),G(a,{key:l.id,notification:l,onClose:u=>t.removeNotification(l.id)},null,8,["notification","onClose"]))),128))]),_:1})])])}const fa=O(ua,[["render",ga],["__scopeId","data-v-dd8772c8"]]),ha={name:"RealtimeControls",props:{enabled:{type:Boolean,default:!1},connectionState:{type:String,default:"disconnected"},error:{type:String,default:null}},emits:["toggle"],setup(o,{emit:e}){const s=C(o.enabled);se(()=>o.enabled,f=>{s.value=f});const t=S(()=>o.connectionState==="connecting"),r=S(()=>!!o.error),i=S(()=>({"status-connected":o.connectionState==="connected","status-connecting":o.connectionState==="connecting","status-disconnected":o.connectionState==="disconnected","status-error":o.connectionState==="error"})),a=S(()=>{switch(o.connectionState){case"connected":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";case"connecting":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...";case"disconnected":return"–û—Ç–∫–ª—é—á–µ–Ω–æ";case"error":return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}}),l=S(()=>a.value),u=S(()=>({"status-connected":o.connectionState==="connected","status-connecting":o.connectionState==="connecting","status-disconnected":o.connectionState==="disconnected","status-error":o.connectionState==="error"})),g=S(()=>o.error?typeof o.error=="string"?o.error:o.error.message?o.error.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞":null);return{localEnabled:s,isConnecting:t,hasError:r,statusClass:i,statusText:a,connectionStatusText:l,connectionStatusClass:u,displayError:g,handleToggle:()=>{e("toggle",s.value)}}}},va={class:"realtime-controls"},pa={class:"control-toggle"},ya=["disabled"],_a={class:"status-text"},wa={key:0,class:"error-message"};function ba(o,e,s,t,r,i){return c(),d("div",va,[n("label",pa,[J(n("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=a=>t.localEnabled=a),onChange:e[1]||(e[1]=(...a)=>t.handleToggle&&t.handleToggle(...a)),disabled:t.isConnecting},null,40,ya),[[mt,t.localEnabled]]),e[2]||(e[2]=n("span",{class:"toggle-label"},"–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",-1))]),n("div",{class:N(["status-indicator",t.statusClass])},[e[3]||(e[3]=n("span",{class:"status-dot"},null,-1)),n("span",_a,m(t.statusText),1)],2),t.hasError&&t.displayError?(c(),d("div",wa," ‚ö†Ô∏è "+m(t.displayError),1)):A("",!0)])}const Ca=O(ha,[["render",ba],["__scopeId","data-v-af36f073"]]),Sa={name:"NewLogsIndicator",props:{count:{type:Number,default:0},newLogs:{type:Array,default:()=>[]}},emits:["apply","dismiss"],setup(o,{emit:e}){const s=(a,l,u,g)=>{const p=a%10,f=a%100;return f>=11&&f<=19?g:p===1?l:p>=2&&p<=4?u:g},t=S(()=>!o.newLogs||!Array.isArray(o.newLogs)||o.newLogs.length===0?[]:o.newLogs.map(l=>Le(l)).filter(l=>ye(l)).slice(0,5).map(l=>({...l,formatted:{event:xe(l.event),category:be(l.category)}})));return{pluralize:s,newLogsPreview:t,handleApply:()=>{if(!o.newLogs||o.newLogs.length===0)return;const a=o.newLogs.map(l=>Le(l)).filter(l=>ye(l));if(a.length===0){console.warn("[NewLogsIndicator] No valid logs to apply");return}e("apply",a)},handleDismiss:()=>{e("dismiss")}}}},ka={key:0,class:"new-logs-indicator"},Ea={class:"indicator-content"},Aa={class:"indicator-text"},Ta={class:"indicator-actions"};function Ma(o,e,s,t,r,i){return c(),G(_e,{name:"slide-down"},{default:ie(()=>[s.count>0?(c(),d("div",ka,[n("div",Ea,[e[2]||(e[2]=n("span",{class:"indicator-icon"},"üîî",-1)),n("span",Aa,m(s.count)+" "+m(t.pluralize(s.count,"–Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π")),1),n("div",Ta,[n("button",{onClick:e[0]||(e[0]=(...a)=>t.handleApply&&t.handleApply(...a)),class:"btn-apply"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å "),n("button",{onClick:e[1]||(e[1]=(...a)=>t.handleDismiss&&t.handleDismiss(...a)),class:"btn-dismiss"}," ‚úï ")])])])):A("",!0)]),_:1})}const La=O(Sa,[["render",Ma],["__scopeId","data-v-19791dbc"]]);class xa{constructor(e,s={}){this.url=e,this.options={reconnectInterval:3e3,maxReconnectAttempts:10,reconnectDelay:1e3,lastTimestamp:null,...s},this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.reconnectTimer=null,this.isManualDisconnect=!1,this.connectionState="disconnected"}updateOptions(e){this.options={...this.options,...e}}connect(){if(this.connectionState==="connected"||this.connectionState==="connecting"){console.warn("[RealtimeService] Already connected or connecting");return}this.isManualDisconnect=!1,this.connectionState="connecting",this.notifyListeners("state-change",{state:this.connectionState});try{let e=this.url;if(!e.startsWith("http://")&&!e.startsWith("https://")){const s=new URL(e,window.location.origin);this.options.lastTimestamp&&s.searchParams.set("last_timestamp",this.options.lastTimestamp),e=s.toString()}else{const s=new URL(e);this.options.lastTimestamp&&s.searchParams.set("last_timestamp",this.options.lastTimestamp),e=s.toString()}console.log("[RealtimeService] Connecting to:",e),this.eventSource=new EventSource(e),this.eventSource.onopen=()=>{console.log("[RealtimeService] EventSource opened"),this.notifyListeners("open",{timestamp:new Date().toISOString()})},this.eventSource.onmessage=s=>{try{const t=JSON.parse(s.data);this.notifyListeners("message",t)}catch(t){console.error("[RealtimeService] Error parsing message:",t)}},this.eventSource.addEventListener("connected",s=>{try{const t=JSON.parse(s.data);console.log("[RealtimeService] Connected event received:",t),this.connectionState="connected",this.reconnectAttempts=0,this.notifyListeners("connected",t),this.notifyListeners("state-change",{state:this.connectionState})}catch(t){console.error("[RealtimeService] Error parsing connected event:",t)}}),this.eventSource.addEventListener("new_logs",s=>{const t=JSON.parse(s.data);if(t.logs&&t.logs.length>0){const r=t.logs[t.logs.length-1];r.timestamp&&(this.options.lastTimestamp=r.timestamp)}this.notifyListeners("new_logs",t)}),this.eventSource.addEventListener("error",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("error",t)}catch{this.notifyListeners("error",{message:"Server error"})}}),this.eventSource.addEventListener("timeout",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("timeout",t)}catch{this.notifyListeners("timeout",{message:"Connection timeout"})}this.reconnect()}),this.eventSource.addEventListener("closed",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("closed",t)}catch{this.notifyListeners("closed",{message:"Connection closed"})}this.isManualDisconnect||this.reconnect()}),this.eventSource.onerror=s=>{console.error("[RealtimeService] Connection error:",s),console.error("[RealtimeService] EventSource readyState:",this.eventSource?.readyState),this.eventSource?.readyState===EventSource.CLOSED?(console.log("[RealtimeService] EventSource closed by server"),this.connectionState="disconnected",this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()):this.eventSource?.readyState===EventSource.CONNECTING?console.log("[RealtimeService] Still connecting..."):(this.connectionState="error",this.notifyListeners("error",{error:s,type:"connection",message:"Failed to connect to realtime stream",readyState:this.eventSource?.readyState}),this.notifyListeners("state-change",{state:this.connectionState}),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isManualDisconnect||this.reconnect())}}catch(e){console.error("[RealtimeService] Error creating EventSource:",e),this.connectionState="error",this.notifyListeners("error",{error:e,type:"initialization"}),this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()}}reconnect(){if(this.isManualDisconnect)return;if(this.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("[RealtimeService] Max reconnect attempts reached"),this.notifyListeners("max-reconnect-attempts",{attempts:this.reconnectAttempts});return}this.reconnectAttempts++;const e=Math.min(this.options.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.options.reconnectInterval);console.log(`[RealtimeService] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},e)}disconnect(){this.isManualDisconnect=!0,this.connectionState="disconnected",this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.notifyListeners("disconnected",{timestamp:new Date().toISOString()}),this.notifyListeners("state-change",{state:this.connectionState})}on(e,s){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(s)}off(e,s){if(this.listeners.has(e)){const t=this.listeners.get(e),r=t.indexOf(s);r>-1&&t.splice(r,1)}}notifyListeners(e,s){this.listeners.has(e)&&this.listeners.get(e).forEach(t=>{try{t(s)}catch(r){console.error(`[RealtimeService] Error in listener for ${e}:`,r)}})}getState(){return this.connectionState}isConnected(){return this.connectionState==="connected"}}function Da(o,e={}){const{autoConnect:s=!1,enableSound:t=!1,onNewLogs:r=null,validateLogs:i=!0}=e,a=new xa(o,e),l=C("disconnected"),u=C([]),g=C(0),p=C(null),f=C(null),M=C(0),T=S(()=>l.value==="connected"),k=S(()=>l.value==="connecting"),w=S(()=>l.value==="error"),E=S(()=>g.value>0),b=P=>{l.value=P.state,P.state==="connected"&&(M.value=0,f.value=null)},L=P=>{let B=P.logs||[];if(i){B=nt(B);const ae=B.filter(De=>ye(De));ae.length!==B.length&&console.warn("[useRealtime] Filtered out invalid logs:",B.length-ae.length),B=ae}B.length!==0&&(u.value.push(...B),g.value+=B.length,p.value=new Date().toISOString(),t&&B.length>0&&X(),r&&r(B))},D=P=>{const B=P.message||P.error?.message||"Connection error";f.value=B,l.value="error",console.error("[useRealtime] Error:",P)},z=P=>{console.warn("[useRealtime] Connection timeout:",P)},I=P=>{f.value=`Max reconnect attempts reached (${P.attempts})`,console.error("[useRealtime] Max reconnect attempts:",P)},_=(P={})=>{f.value=null,P.lastTimestamp!==void 0&&a.updateOptions({lastTimestamp:P.lastTimestamp}),a.on("state-change",b),a.on("new_logs",L),a.on("error",D),a.on("timeout",z),a.on("max-reconnect-attempts",I),a.connect()},h=()=>{a.off("state-change",b),a.off("new_logs",L),a.off("error",D),a.off("timeout",z),a.off("max-reconnect-attempts",I),a.disconnect()},v=()=>{u.value=[],g.value=0},x=P=>{P&&Array.isArray(P)&&(P.unshift(...u.value),v())},X=()=>{try{const P=new Audio("/sounds/notification.mp3");P.volume=.3,P.play().catch(B=>{console.warn("[useRealtime] Failed to play sound:",B)})}catch(P){console.warn("[useRealtime] Sound not available:",P)}};return s&&te(()=>{_()}),qe(()=>{h()}),{connectionState:l,isConnected:T,isConnecting:k,hasError:w,newLogs:u,newLogsCount:g,hasNewLogs:E,lastUpdateTime:p,error:f,reconnectAttempts:M,connect:_,disconnect:h,clearNewLogs:v,applyNewLogs:x}}const Ia=ft(()=>ne(()=>import("./WebhookLogsDashboard.vue-UbaUoaXR.js"),__vite__mapDeps([7,4,1,5,6,2]),import.meta.url)),Pa=ft(()=>ne(()=>import("./WebhookLogDetails.vue-CkUvOW_p.js"),__vite__mapDeps([8,4,1,5,6,2]),import.meta.url)),Ua={name:"WebhookLogsPage",components:{WebhookLogsDashboard:Ia,WebhookLogsExport:Po,WebhookLogSearch:zo,WebhookLogFilters:ln,WebhookLogList:Ln,WebhookLogDetails:Pa,SkeletonLogList:On,EmptyState:Xn,ErrorDisplay:sa,NotificationContainer:fa,RealtimeControls:Ca,NewLogsIndicator:La},setup(){const o=Ue(),{success:e,error:s}=bt(),t=C(!1),r=C(!1),i=C(null),a=C(null),l=C([]),u=(y,U=2)=>{if(y==null)return String(y);if(typeof y=="string")return y;const V=(F,ee=0)=>{if(ee>10)return"[Max Depth]";if(F==null||typeof F!="object")return F;if(Array.isArray(F))return F.map(Q=>V(Q,ee+1));const de={};try{for(const Q in F)if(Object.prototype.hasOwnProperty.call(F,Q))try{const Be=F[Q];if(typeof Be=="function"||Be===void 0)continue;de[Q]=V(Be,ee+1)}catch{de[Q]="[Error reading property]"}}catch{return"[Error reading object]"}return de};try{const F=V(y),ee=new WeakSet;return JSON.stringify(F,(de,Q)=>{if(typeof Q=="object"&&Q!==null){if(ee.has(Q))return"[Circular]";ee.add(Q)}return Q},U)}catch(F){return console.error("[WebhookLogsPage] Error in safeStringify:",F),`[Error: ${F.message}]`}},g=C(null),p=C([]),f=C(""),M=C(null),T=C(null),k=C(!1),{connectionState:w,newLogsCount:E,error:b,connect:L,disconnect:D,applyNewLogs:z,clearNewLogs:I}=Da(fe("/api/webhook-realtime.php"),{autoConnect:!1,enableSound:!0,validateLogs:!0,onNewLogs:y=>{console.log("[WebhookLogsPage] New logs received:",y.length),y.length>0&&(l.value.unshift(...y),x.value.total+=y.length,e(`–ü–æ–ª—É—á–µ–Ω–æ ${y.length} –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π`))}}),{filters:_,updateFilters:h,clearFilters:v}=Vs(),x=C({page:1,limit:50,total:0,pages:0}),X=S(()=>{let y=[...l.value];return f.value&&f.value.trim()&&(y=Hs(y,f.value,{caseSensitive:!1,searchInEvent:!0,searchInPayload:!0,searchInDetails:!0,searchInIp:!0})),_.value.category&&(y=y.filter(U=>U.category===_.value.category)),_.value.event&&(y=y.filter(U=>U.event===_.value.event)),_.value.ip&&(y=y.filter(U=>U.ip&&U.ip.includes(_.value.ip))),_.value.status&&(y=y.filter(U=>_.value.status==="error"?U.category==="errors":_.value.status==="success"?U.category!=="errors":!0)),_.value.dateFrom&&(y=y.filter(U=>U.timestamp?new Date(U.timestamp).toISOString().split("T")[0]>=_.value.dateFrom:!1)),_.value.dateTo&&(y=y.filter(U=>U.timestamp?new Date(U.timestamp).toISOString().split("T")[0]<=_.value.dateTo:!1)),_.value.hour!==null&&(y=y.filter(U=>U.timestamp?new Date(U.timestamp).getHours()===_.value.hour:!1)),y});se(X,y=>{M.value&&f.value&&M.value.setResultsCount(y.length)});const P=async()=>{try{await we.init();const y=await we.getCurrentUser();if(console.log("[WebhookLogsPage] User data:",y),!y||!y.ID){console.warn("[WebhookLogsPage] User not determined"),a.value=u({error:"User not determined",userId:y?.ID||null,userName:y?`${y.NAME||""} ${y.LAST_NAME||""}`.trim():null}),t.value=!1;return}const U=y?.UF_DEPARTMENT||[];if(console.log("[WebhookLogsPage] User departments:",U),console.log("[WebhookLogsPage] Allowed departments:",Ae.allowedDepartmentIds),U.length>0){const V=U.some(F=>yt(F));console.log("[WebhookLogsPage] Has access:",V),t.value=V,V||(a.value=u({userId:y.ID,userName:`${y.NAME||""} ${y.LAST_NAME||""}`.trim(),userDepartments:U,allowedDepartments:Ae.allowedDepartmentIds,message:"User departments do not match allowed departments"}))}else console.warn("[WebhookLogsPage] User has no departments"),a.value=u({userId:y.ID,userName:`${y.NAME||""} ${y.LAST_NAME||""}`.trim(),userDepartments:[],allowedDepartments:Ae.allowedDepartmentIds,message:"User has no departments assigned"}),t.value=!1}catch(y){console.error("[WebhookLogsPage] Error checking access:",y),a.value=u({error:y.message,stack:y.stack}),t.value=!1}},B=S(()=>Ae.allowedDepartmentIds.join(", ")),ae=async(y=!1)=>{if(t.value&&!(he&&!y)){he=!0,r.value=!0,i.value=null;try{const U=new Date().toISOString().split("T")[0],V={category:_.value.category||null,event:_.value.event||null,date:_.value.dateFrom||U,hour:_.value.hour!==null&&_.value.hour!==void 0?_.value.hour:null,ip:_.value.ip||null,status:_.value.status||null,dateFrom:_.value.dateFrom||U,dateTo:_.value.dateTo||null};if(!ot(V))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");console.log("[WebhookLogsPage] Loading logs with filters:",V);const F=await dt.getLogs(V,x.value.page,x.value.limit,y);if(console.log("[WebhookLogsPage] API result:",F),console.log("[WebhookLogsPage] Logs count:",F?.logs?.length||0),console.log("[WebhookLogsPage] Pagination:",F?.pagination),!F.success)throw new Error(F.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤");qs(F.pagination)?x.value=F.pagination:(console.warn("[WebhookLogsPage] Invalid pagination format, using defaults"),x.value={page:x.value.page,limit:x.value.limit,total:F.logs.length,pages:Math.ceil(F.logs.length/x.value.limit)});const ee=nt(F.logs),de=ee.filter(Q=>ye(Q));de.length!==ee.length&&console.warn("[WebhookLogsPage] Filtered out invalid logs:",ee.length-de.length),l.value=de,y&&e("–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")}catch(U){De(U)}finally{r.value=!1,he=!1}}},De=y=>{console.error("[WebhookLogsPage] API Error:",y),y.status===403?(i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",s("–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º –≤–µ–±—Ö—É–∫–æ–≤")):y.status===404?(i.value="–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",s("–õ–æ–≥–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")):y.status>=500?(i.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",s("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")):(i.value=y.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",s(i.value)),y.status>=500&&(l.value=[])},Je=y=>{f.value=y,h({search:y||null})};let he=!1;const Ke=y=>{if(!ot(y)){s("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");return}const U={category:_.value.category,event:_.value.event,dateFrom:_.value.dateFrom,dateTo:_.value.dateTo,hour:_.value.hour,ip:_.value.ip,status:_.value.status},V={category:y?.category||null,event:y?.event||null,dateFrom:y?.dateFrom||null,dateTo:y?.dateTo||null,hour:y?.hour!==void 0?y.hour:null,ip:y?.ip||null,status:y?.status||null},F=Object.keys(V).some(ee=>{const de=U[ee],Q=V[ee];return de!==Q});if(!(!F&&!he)){if(h(V),x.value.page=1,F)try{dt.invalidateCacheOnFilterChange(U,V)}catch(ee){console.error("[WebhookLogsPage] Error invalidating cache:",ee)}he||(he=!0,ae(!0).finally(()=>{he=!1}))}},Fe=()=>{v(),f.value="",x.value.page=1,ae()},Ye=y=>{g.value=y},Ge=()=>{g.value=null},Oe=y=>{x.value.page=y,ae()},Qe=()=>{try{o.push("/")}catch(y){console.error("Navigation error:",y),window.location.hash="#/"}},R=y=>{p.value=y},Z=y=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—á–∞—Ç:",y)},K=y=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω:",y),e(`–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω: ${y.count} –∑–∞–ø–∏—Å–µ–π –≤ —Ñ–∞–π–ª–µ ${y.filename}`)},oe=y=>{console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:",y),s(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${y.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`)},le=()=>{f.value="",Fe()},Ie=y=>{if(console.log("[WebhookLogsPage] Toggle auto-update:",y),k.value=y,y){let U=null;if(l.value.length>0){const V=l.value[0];V.timestamp&&(U=V.timestamp,console.log("[WebhookLogsPage] Using lastTimestamp:",U))}L({lastTimestamp:U})}else D()},ce=()=>{z(l.value),e("–ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")},Ze=()=>{I()};return te(async()=>{await P(),t.value&&(_.value.search&&(f.value=_.value.search),await ae())}),{hasAccess:t,loading:r,error:i,logs:l,filteredLogs:X,selectedLog:g,selectedLogs:p,filters:_,searchQuery:f,searchComponent:M,pagination:x,previousPeriodStats:T,handleFiltersUpdate:Ke,handleFiltersReset:Fe,handleSearch:Je,handleLogSelect:Ye,handleLogClose:Ge,handlePageChange:Oe,handleSelectedLogsUpdate:R,handleExportStart:Z,handleExportComplete:K,handleExportError:oe,handleClearSearch:le,autoUpdateEnabled:k,connectionState:w,newLogsCount:E,realtimeError:b,handleToggleAutoUpdate:Ie,handleApplyNewLogs:ce,handleDismissNewLogs:Ze,allowedDepartmentsText:B,accessDebugInfo:a,goBack:Qe}}},Ra={class:"webhook-logs-page"},Na={class:"page-header"},Fa={class:"page-header-top"},Oa={key:0,class:"access-denied"},Ba={class:"access-denied-content"},$a={class:"access-hint"},za={key:0,class:"access-debug"},ja={key:1,class:"page-content"},Wa={class:"actions-bar"};function Va(o,e,s,t,r,i){const a=$("WebhookLogsDashboard"),l=$("WebhookLogsExport"),u=$("WebhookLogSearch"),g=$("RealtimeControls"),p=$("NewLogsIndicator"),f=$("WebhookLogFilters"),M=$("SkeletonLogList"),T=$("WebhookLogList"),k=$("EmptyState"),w=$("ErrorDisplay"),E=$("WebhookLogDetails"),b=$("NotificationContainer");return c(),d("div",Ra,[n("div",Na,[n("div",Fa,[n("button",{onClick:e[0]||(e[0]=(...L)=>t.goBack&&t.goBack(...L)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[3]||(e[3]=[n("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),n("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[4]||(e[4]=n("h1",null,"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ Bitrix24",-1))]),t.hasAccess?(c(),d("div",ja,[j(a,{logs:t.logs,pagination:t.pagination,"previous-period-stats":t.previousPeriodStats},null,8,["logs","pagination","previous-period-stats"]),n("div",Wa,[j(l,{logs:t.filteredLogs,"selected-logs":t.selectedLogs,filters:t.filters,"total-count":t.filteredLogs.length,onExportStart:t.handleExportStart,onExportComplete:t.handleExportComplete,onExportError:t.handleExportError},null,8,["logs","selected-logs","filters","total-count","onExportStart","onExportComplete","onExportError"]),j(u,{modelValue:t.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=L=>t.searchQuery=L),onSearch:t.handleSearch,ref:"searchComponent"},null,8,["modelValue","onSearch"])]),j(g,{enabled:t.autoUpdateEnabled,"connection-state":t.connectionState,error:t.realtimeError,onToggle:t.handleToggleAutoUpdate},null,8,["enabled","connection-state","error","onToggle"]),j(p,{count:t.newLogsCount,onApply:t.handleApplyNewLogs,onDismiss:t.handleDismissNewLogs},null,8,["count","onApply","onDismiss"]),j(f,{filters:t.filters,"onUpdate:filters":t.handleFiltersUpdate,onReset:t.handleFiltersReset},null,8,["filters","onUpdate:filters","onReset"]),j(_e,{name:"fade"},{default:ie(()=>[t.loading&&t.logs.length===0?(c(),G(M,{key:0,rows:5})):A("",!0)]),_:1}),j(_e,{name:"fade"},{default:ie(()=>[!t.loading&&t.filteredLogs.length>0?(c(),G(T,{key:0,logs:t.filteredLogs,loading:!1,error:null,pagination:t.pagination,"selected-logs":t.selectedLogs,onSelectLog:t.handleLogSelect,onPageChange:t.handlePageChange,"onUpdate:selectedLogs":t.handleSelectedLogsUpdate},null,8,["logs","pagination","selected-logs","onSelectLog","onPageChange","onUpdate:selectedLogs"])):A("",!0)]),_:1}),j(_e,{name:"fade"},{default:ie(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length===0?(c(),G(k,{key:0,icon:"üì≠",title:"–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",description:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Bitrix24.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è","–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",onAction:t.handleFiltersReset},null,8,["onAction"])):A("",!0)]),_:1}),j(_e,{name:"fade"},{default:ie(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length>0?(c(),G(k,{key:0,icon:"üîç",title:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",description:"–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã","–û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",onAction:t.handleClearSearch},null,8,["onAction"])):A("",!0)]),_:1}),j(_e,{name:"fade"},{default:ie(()=>[t.error?(c(),G(w,{key:0,title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤",message:t.error,retryable:!0,onRetry:o.loadLogs},null,8,["message","onRetry"])):A("",!0)]),_:1}),t.selectedLog?(c(),d("div",{key:0,class:"modal-overlay",onClick:e[2]||(e[2]=(...L)=>t.handleLogClose&&t.handleLogClose(...L))})):A("",!0),j(_e,{name:"modal"},{default:ie(()=>[t.selectedLog?(c(),G(E,{key:0,log:t.selectedLog,onClose:t.handleLogClose},null,8,["log","onClose"])):A("",!0)]),_:1})])):(c(),d("div",Oa,[n("div",Ba,[e[7]||(e[7]=n("h2",null,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",-1)),e[8]||(e[8]=n("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤.",-1)),n("p",$a,[e[5]||(e[5]=Y(" –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ –æ—Ç–¥–µ–ª–æ–≤: ",-1)),n("strong",null,m(t.allowedDepartmentsText),1)]),e[9]||(e[9]=n("p",{class:"access-hint"}," –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã. ",-1)),t.accessDebugInfo?(c(),d("details",za,[e[6]||(e[6]=n("summary",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",-1)),n("pre",null,m(t.accessDebugInfo),1)])):A("",!0)])])),j(b)])}const Ha=O(Ua,[["render",Va],["__scopeId","data-v-628bf174"]]);class Ve{static async getActivity(e={}){const{userId:s=null,dateFrom:t=null,dateTo:r=null,type:i=null,limit:a=1e3}=e,l=new URLSearchParams;s&&l.append("user_id",s),t&&l.append("date_from",t),r&&l.append("date_to",r),i&&l.append("type",i),a&&l.append("limit",a);try{const u=fe("/api/user-activity-get.php"),g=await fetch(`${u}?${l.toString()}`);if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);const p=await g.json();if(p.success)return p.data||[];throw new Error(p.error||"Failed to get activity")}catch(u){throw console.error("[UserActivityService] Error getting activity:",u),u}}static async getActivityStats(e={}){const s=await this.getActivity(e),t={total_entries:s.length,total_app_entries:0,total_page_visits:0,unique_users:new Set,pages_visited:{},activity_by_date:{},activity_by_hour:{}};return s.forEach(r=>{if(r.type==="app_entry")t.total_app_entries++,t.unique_users.add(r.user_id);else if(r.type==="page_visit"){t.total_page_visits++;const i=r.route_title||r.route_path||r.route_name||"unknown";t.pages_visited[i]=(t.pages_visited[i]||0)+1}if(r.timestamp){const i=new Date(r.timestamp).toISOString().split("T")[0];t.activity_by_date[i]=(t.activity_by_date[i]||0)+1;const a=new Date(r.timestamp).getHours();t.activity_by_hour[a]=(t.activity_by_hour[a]||0)+1}}),t.unique_users_count=t.unique_users.size,t.unique_users=Array.from(t.unique_users),t}static async getUserActivity(e,s={}){return await this.getActivity({...s,userId:e})}}const Xe="hidden_users_list";function Me(){try{const o=localStorage.getItem(Xe);if(!o)return[];const e=JSON.parse(o);return Array.isArray(e)?e.map(s=>Number(s)):[]}catch(o){return console.error("[HiddenUsersManager] Error reading hidden users:",o),[]}}function qa(o){const e=Me(),s=Number(o);if(!e.includes(s)){e.push(s);try{localStorage.setItem(Xe,JSON.stringify(e))}catch(t){console.error("[HiddenUsersManager] Error saving hidden users:",t)}}}function Xa(o){const e=Me(),s=Number(o),t=e.filter(r=>r!==s);if(t.length!==e.length)try{localStorage.setItem(Xe,JSON.stringify(t))}catch(r){console.error("[HiddenUsersManager] Error saving hidden users:",r)}}function Ja(){try{localStorage.removeItem(Xe)}catch(o){console.error("[HiddenUsersManager] Error clearing hidden users:",o)}}function Ka(o){const e=new Map;return o.forEach(s=>{if(s.user_id){const t=Number(s.user_id);e.has(t)||e.set(t,{id:t,name:s.user_name||`User #${t}`,count:0}),e.get(t).count++}}),Array.from(e.values()).sort((s,t)=>t.count-s.count)}function Ct(o){const e=Me();return e.length===0?o:o.filter(s=>s.user_id?!e.includes(Number(s.user_id)):!0)}const Ya={name:"UserActivityCard",props:{entry:{type:Object,required:!0}},computed:{cardClass(){return{"activity-entry":this.entry.type==="app_entry","activity-visit":this.entry.type==="page_visit"}}},methods:{formatTime(o){return o?new Date(o).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}}},Ga={class:"activity-icon"},Qa={key:0},Za={key:1},er={class:"activity-content"},tr={class:"activity-header"},sr={class:"user-name"},or={class:"activity-time"},nr={class:"activity-details"},ar={key:0,class:"activity-type"},rr={key:1,class:"activity-type"},ir={key:0,class:"activity-from"};function lr(o,e,s,t,r,i){return c(),d("div",{class:N(["user-activity-card",i.cardClass])},[n("div",Ga,[s.entry.type==="app_entry"?(c(),d("span",Qa,"üö™")):s.entry.type==="page_visit"?(c(),d("span",Za,"üìÑ")):A("",!0)]),n("div",er,[n("div",tr,[n("span",sr,m(s.entry.user_name||`User #${s.entry.user_id}`),1),n("span",or,m(i.formatTime(s.entry.timestamp)),1)]),n("div",nr,[s.entry.type==="app_entry"?(c(),d("span",ar," –û—Ç–∫—Ä—ã–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ")):s.entry.type==="page_visit"?(c(),d("span",rr," –û—Ç–∫—Ä—ã–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É: "+m(s.entry.route_title||s.entry.route_path||s.entry.route_name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"),1)):A("",!0)]),s.entry.type==="page_visit"&&s.entry.from_path?(c(),d("div",ir," –°: "+m(s.entry.from_name||s.entry.from_path),1)):A("",!0)])],2)}const cr=O(Ya,[["render",lr],["__scopeId","data-v-fe61b287"]]),dr={name:"UserActivityList",components:{UserActivityCard:cr},props:{userId:{type:Number,default:null},dateFrom:{type:String,default:null},dateTo:{type:String,default:null},type:{type:String,default:null}},emits:["view-details"],setup(o,{emit:e}){const s=C([]),t=C(!1),r=C(null),i=S(()=>Ct(s.value)),a=async()=>{t.value=!0,r.value=null;try{const p={userId:o.userId,dateFrom:o.dateFrom,dateTo:o.dateTo,type:o.type};s.value=await Ve.getActivity(p)}catch(p){r.value=p.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",console.error("[UserActivityList] Error:",p)}finally{t.value=!1}},l=p=>{e("view-details",p)},u=p=>`${p.timestamp}-${p.user_id}-${p.type}-${p.route_path||""}`,g=()=>{a()};return te(()=>{a(),window.addEventListener("hidden-users-changed",g)}),qe(()=>{window.removeEventListener("hidden-users-changed",g)}),se(()=>[o.userId,o.dateFrom,o.dateTo,o.type],()=>{a()},{deep:!0}),{activity:i,loading:t,error:r,handleViewDetails:l,getEntryKey:u}}},ur={class:"user-activity-list"},mr={key:0,class:"loading"},gr={key:1,class:"error"},fr={key:2,class:"empty"},hr={key:3,class:"activity-items"};function vr(o,e,s,t,r,i){const a=$("UserActivityCard");return c(),d("div",ur,[t.loading?(c(),d("div",mr," –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏... ")):t.error?(c(),d("div",gr,m(t.error),1)):t.activity.length===0?(c(),d("div",fr," –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ")):(c(),d("div",hr,[(c(!0),d(H,null,q(t.activity,l=>(c(),G(a,{key:t.getEntryKey(l),entry:l,onClick:u=>t.handleViewDetails(l)},null,8,["entry","onClick"]))),128))]))])}const pr=O(dr,[["render",vr],["__scopeId","data-v-a10310fc"]]),yr={name:"UserActivityFilters",props:{filters:{type:Object,default:()=>({})},users:{type:Array,default:()=>[]}},emits:["update-filters"],setup(o,{emit:e}){const s=C({userId:o.filters.userId||null,type:o.filters.type||null,dateFrom:o.filters.dateFrom||null,dateTo:o.filters.dateTo||null}),t=()=>{e("update-filters",{...s.value})},r=()=>{s.value={userId:null,type:null,dateFrom:null,dateTo:null},t()},i=a=>{const l=a.NAME||"",u=a.LAST_NAME||"";return`${l} ${u}`.trim()||a.EMAIL||`User #${a.ID}`};return se(()=>o.filters,a=>{s.value={...a}},{deep:!0}),{localFilters:s,updateFilters:t,resetFilters:r,getUserName:i}}},_r={class:"user-activity-filters"},wr={class:"filter-group"},br=["value"],Cr={class:"filter-group"},Sr={class:"filter-group"},kr={class:"filter-group"};function Er(o,e,s,t,r,i){return c(),d("div",_r,[n("div",wr,[e[10]||(e[10]=n("label",null,"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:",-1)),J(n("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.localFilters.userId=a),onChange:e[1]||(e[1]=(...a)=>t.updateFilters&&t.updateFilters(...a))},[e[9]||(e[9]=n("option",{value:null},"–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",-1)),(c(!0),d(H,null,q(s.users,a=>(c(),d("option",{key:a.ID,value:a.ID},m(t.getUserName(a)),9,br))),128))],544),[[Ee,t.localFilters.userId]])]),n("div",Cr,[e[12]||(e[12]=n("label",null,"–¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:",-1)),J(n("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.localFilters.type=a),onChange:e[3]||(e[3]=(...a)=>t.updateFilters&&t.updateFilters(...a))},[...e[11]||(e[11]=[n("option",{value:null},"–í—Å–µ —Ç–∏–ø—ã",-1),n("option",{value:"app_entry"},"–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1),n("option",{value:"page_visit"},"–ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",-1)])],544),[[Ee,t.localFilters.type]])]),n("div",Sr,[e[13]||(e[13]=n("label",null,"–î–∞—Ç–∞ –æ—Ç:",-1)),J(n("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=a=>t.localFilters.dateFrom=a),onChange:e[5]||(e[5]=(...a)=>t.updateFilters&&t.updateFilters(...a))},null,544),[[ke,t.localFilters.dateFrom]])]),n("div",kr,[e[14]||(e[14]=n("label",null,"–î–∞—Ç–∞ –¥–æ:",-1)),J(n("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=a=>t.localFilters.dateTo=a),onChange:e[7]||(e[7]=(...a)=>t.updateFilters&&t.updateFilters(...a))},null,544),[[ke,t.localFilters.dateTo]])]),n("button",{onClick:e[8]||(e[8]=(...a)=>t.resetFilters&&t.resetFilters(...a)),class:"btn-reset"},"–°–±—Ä–æ—Å–∏—Ç—å")])}const Ar=O(yr,[["render",Er],["__scopeId","data-v-f4c5efa9"]]),Tr={name:"UserActivityStats",props:{filters:{type:Object,default:()=>({})}},setup(o){const e=C({total_entries:0,unique_users_count:0,total_app_entries:0,total_page_visits:0,pages_visited:{}}),s=C(!1),t=C(null),r=S(()=>e.value),i=async()=>{s.value=!0,t.value=null;try{const u=await Ve.getActivity({...o.filters,limit:1e4}),g=Ct(u);e.value=await Ve.getActivityStats({...o.filters});const p={total_entries:g.length,unique_users_count:new Set(g.map(f=>f.user_id)).size,total_app_entries:g.filter(f=>f.type==="app_entry").length,total_page_visits:g.filter(f=>f.type==="page_visit").length,pages_visited:{}};g.filter(f=>f.type==="page_visit"&&f.route_path).forEach(f=>{const M=f.route_title||f.route_path||f.route_name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞";p.pages_visited[M]=(p.pages_visited[M]||0)+1}),e.value=p}catch(u){t.value=u.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏",console.error("[UserActivityStats] Error loading stats:",u)}finally{s.value=!1}},a=S(()=>{const u=r.value.pages_visited||{};return Object.entries(u).sort((g,p)=>p[1]-g[1]).slice(0,10).reduce((g,[p,f])=>(g[p]=f,g),{})}),l=()=>{i()};return te(()=>{i(),window.addEventListener("hidden-users-changed",l)}),qe(()=>{window.removeEventListener("hidden-users-changed",l)}),se(()=>o.filters,()=>{i()},{deep:!0}),{stats:r,loading:s,error:t,sortedPages:a}}},Mr={class:"user-activity-stats"},Lr={key:0,class:"loading"},xr={key:1,class:"error"},Dr={key:2},Ir={class:"stats-grid"},Pr={class:"stat-card"},Ur={class:"stat-value"},Rr={class:"stat-card"},Nr={class:"stat-value"},Fr={class:"stat-card"},Or={class:"stat-value"},Br={class:"stat-card"},$r={class:"stat-value"},zr={key:0,class:"pages-stats"};function jr(o,e,s,t,r,i){return c(),d("div",Mr,[t.loading?(c(),d("div",Lr," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏... ")):t.error?(c(),d("div",xr,m(t.error),1)):(c(),d("div",Dr,[n("div",Ir,[n("div",Pr,[n("div",Ur,m(t.stats.total_entries),1),e[0]||(e[0]=n("div",{class:"stat-label"},"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",-1))]),n("div",Rr,[n("div",Nr,m(t.stats.unique_users_count),1),e[1]||(e[1]=n("div",{class:"stat-label"},"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1))]),n("div",Fr,[n("div",Or,m(t.stats.total_app_entries),1),e[2]||(e[2]=n("div",{class:"stat-label"},"–û—Ç–∫—Ä—ã—Ç–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1))]),n("div",Br,[n("div",$r,m(t.stats.total_page_visits),1),e[3]||(e[3]=n("div",{class:"stat-label"},"–ü–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",-1))])]),Object.keys(t.stats.pages_visited).length>0?(c(),d("div",zr,[e[5]||(e[5]=n("h3",null,"–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:",-1)),n("ul",null,[(c(!0),d(H,null,q(t.sortedPages,(a,l)=>(c(),d("li",{key:l},[Y(m(l)+": ",1),n("strong",null,m(a),1),e[4]||(e[4]=Y(" –ø–æ—Å–µ—â–µ–Ω–∏–π ",-1))]))),128))])])):A("",!0)]))])}const Wr=O(Tr,[["render",jr],["__scopeId","data-v-d896786e"]]),Vr={name:"HiddenUsersManager",props:{filters:{type:Object,default:()=>({})}},emits:["hidden-users-changed"],setup(o,{emit:e}){const s=C(!1),t=C(null),r=C([]),i=C([]),a=S(()=>Ka(r.value)),l=S(()=>{const f=Me();return a.value.filter(M=>f.includes(M.id))}),u=async()=>{s.value=!0,t.value=null;try{const f={...o.filters,limit:1e3};r.value=await Ve.getActivity(f);const M=Me();i.value=M.filter(T=>a.value.some(k=>k.id===T))}catch(f){t.value=f.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",console.error("[HiddenUsersManager] Error loading activity:",f)}finally{s.value=!1}},g=()=>{const f=Me(),M=i.value.map(T=>Number(T));M.forEach(T=>{f.includes(T)||qa(T)}),f.forEach(T=>{M.includes(T)||Xa(T)}),e("hidden-users-changed"),window.dispatchEvent(new CustomEvent("hidden-users-changed"))},p=()=>{Ja(),i.value=[],e("hidden-users-changed"),window.dispatchEvent(new CustomEvent("hidden-users-changed"))};return te(()=>{u()}),se(()=>o.filters,()=>{u()},{deep:!0}),se(()=>l.value,f=>{i.value=f.map(M=>M.id)},{deep:!0}),{loading:s,error:t,availableUsers:a,hiddenUsers:l,selectedUsers:i,applySelection:g,showAll:p}}},Hr={class:"hidden-users-manager"},qr={class:"manager-controls"},Xr={class:"dropdown-wrapper"},Jr=["disabled"],Kr=["value"],Yr={key:0,class:"empty-hint"},Gr={class:"actions"},Qr=["disabled"],Zr=["disabled"],ei={key:0,class:"loading"},ti={key:1,class:"error"};function si(o,e,s,t,r,i){return c(),d("div",Hr,[n("div",qr,[n("div",Xr,[e[3]||(e[3]=n("label",{class:"dropdown-label"}," üëÅÔ∏è –°–∫—Ä—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ",-1)),J(n("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.selectedUsers=a),multiple:"",class:"users-dropdown",disabled:t.loading||t.availableUsers.length===0,size:"5"},[(c(!0),d(H,null,q(t.availableUsers,a=>(c(),d("option",{key:a.id,value:a.id},m(a.name)+" ("+m(a.count)+" "+m(a.count===1?"–∑–∞–ø–∏—Å—å":"–∑–∞–ø–∏—Å–µ–π")+") ",9,Kr))),128))],8,Jr),[[Ee,t.selectedUsers]]),t.availableUsers.length===0&&!t.loading?(c(),d("div",Yr," –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∑–∞–ø–∏—Å—è—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ")):A("",!0)]),n("div",Gr,[n("button",{onClick:e[1]||(e[1]=(...a)=>t.applySelection&&t.applySelection(...a)),class:"apply-btn",disabled:t.loading,title:"–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å ",8,Qr),t.hiddenUsers.length>0?(c(),d("button",{key:0,onClick:e[2]||(e[2]=(...a)=>t.showAll&&t.showAll(...a)),class:"show-all-btn",disabled:t.loading,title:"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"}," –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö ("+m(t.hiddenUsers.length)+") ",9,Zr)):A("",!0)])]),t.loading?(c(),d("div",ei," –ó–∞–≥—Ä—É–∑–∫–∞... ")):A("",!0),t.error?(c(),d("div",ti,m(t.error),1)):A("",!0)])}const oi=O(Vr,[["render",si],["__scopeId","data-v-4fdc2eaa"]]),ni={name:"UsersManagementPage",components:{UserActivityList:pr,UserActivityFilters:Ar,UserActivityStats:Wr,HiddenUsersManager:oi},setup(){const o=Ue(),e=C([]),s=C({userId:null,type:null,dateFrom:null,dateTo:null}),t=async()=>{try{const g=await new jt().getUsersList();e.value=g}catch(u){console.error("[UsersManagementPage] Error loading users:",u)}},r=u=>{s.value={...u}},i=u=>{console.log("View activity details:",u)},a=()=>{window.dispatchEvent(new CustomEvent("hidden-users-changed"))},l=()=>{o.push("/")};return te(async()=>{try{if(!(await Se.checkAccess()).allowed){o.push("/");return}if(!await Se.getCurrentUser()){o.push("/");return}await t()}catch(u){console.error("[UsersManagementPage] Error:",u),o.push("/")}}),{users:e,activityFilters:s,handleFiltersUpdate:r,handleViewActivityDetails:i,handleHiddenUsersChanged:a,goBack:l}}},ai={class:"users-management-page"},ri={class:"page-header"},ii={class:"page-header-top"},li={class:"page-content"},ci={class:"activity-section"};function di(o,e,s,t,r,i){const a=$("UserActivityFilters"),l=$("HiddenUsersManager"),u=$("UserActivityStats"),g=$("UserActivityList");return c(),d("div",ai,[n("div",ri,[n("div",ii,[n("button",{onClick:e[0]||(e[0]=(...p)=>t.goBack&&t.goBack(...p)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[n("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),n("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=n("h1",null,"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",-1))]),n("div",li,[n("div",ci,[e[3]||(e[3]=n("h2",null,"üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),j(a,{filters:t.activityFilters,users:t.users,onUpdateFilters:t.handleFiltersUpdate},null,8,["filters","users","onUpdateFilters"]),j(l,{filters:t.activityFilters,onHiddenUsersChanged:t.handleHiddenUsersChanged},null,8,["filters","onHiddenUsersChanged"]),j(u,{filters:t.activityFilters},null,8,["filters"]),j(g,{userId:t.activityFilters.userId,dateFrom:t.activityFilters.dateFrom,dateTo:t.activityFilters.dateTo,type:t.activityFilters.type,onViewDetails:t.handleViewActivityDetails},null,8,["userId","dateFrom","dateTo","type","onViewDetails"])])])])}const ui=O(ni,[["render",di],["__scopeId","data-v-d7aa0377"]]);class W{static async getCacheStatus(){try{const e=fe("/api/admin/cache-status.php"),s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok){const r=await s.text();throw new Error(`HTTP error! status: ${s.status}, message: ${r}`)}const t=await s.json();if(t.success){const r=t.modules||[];return r.length===0?{primaryModules:[],secondaryModules:[],metadata:{totalModules:0,primaryCount:0,secondaryCount:0}}:this.categorizeAndSortModules(r)}else throw new Error(t.error||"Failed to get cache status")}catch(e){throw console.error("[CacheManagementService] Error getting cache status:",e),e}}static async clearCache(e){try{const s=fe("/api/admin/cache-clear.php"),t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,confirm:!0})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return!0;throw new Error(r.error||"Failed to clear cache")}catch(s){throw console.error("[CacheManagementService] Error clearing cache:",s),s}}static async getCacheStats(){try{const e=fe("/api/admin/cache-stats.php"),s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();if(t.success)return t.stats||{};throw new Error(t.error||"Failed to get cache stats")}catch(e){throw console.error("[CacheManagementService] Error getting cache stats:",e),e}}static formatCacheSize(e){if(e===0)return"0 B";const s=1024,t=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(s));return Math.round(e/Math.pow(s,r)*100)/100+" "+t[r]}static categorizeAndSortModules(e,s={}){const t=this.generateCacheKey(e),r=this.getCachedResult(t);if(r&&!s.forceRefresh)return r;const i=performance.now(),a=this.performCategorization(e),l=performance.now();return a.metadata={processingTime:l-i,totalModules:e.length,primaryCount:a.primaryModules.length,secondaryCount:a.secondaryModules.length,cached:!1},this.setCachedResult(t,a),a}static performCategorization(e){const s=[],t=[];return e.forEach(r=>{this.validateModule(r),this.PRIMARY_MODULE_IDS.includes(r.id)?s.push({...r,category:"primary",priority:this.PRIMARY_MODULE_PRIORITIES[r.id]||999}):t.push({...r,category:"secondary",groupType:this.getModuleType(r.id)})}),{primaryModules:this.sortPrimaryModules(s),secondaryModules:this.sortSecondaryModules(t)}}static sortPrimaryModules(e){return e.sort((s,t)=>{const r=this.PRIMARY_MODULE_PRIORITIES[s.id]||999,i=this.PRIMARY_MODULE_PRIORITIES[t.id]||999;return r-i})}static sortSecondaryModules(e){return e.sort((s,t)=>{const r=this.getModuleType(s.id),i=this.getModuleType(t.id);return r!==i?this.compareModuleTypes(r,i):s.name.localeCompare(t.name)})}static compareModuleTypes(e,s){const t=["users","activity","webhooks","other"],r=t.indexOf(e),i=t.indexOf(s);return(r===-1?999:r)-(i===-1?999:i)}static getModuleType(e){for(const[s,t]of Object.entries(this.SECONDARY_MODULE_TYPES))if(e.startsWith(t.prefix))return s;return e.includes("time-tracking")?"time-tracking":e.includes("graph")?"graphs":e.includes("dashboard")?"dashboards":"other"}static getModuleTypeConfig(e){return this.SECONDARY_MODULE_TYPES[e]||{title:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏",description:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã"}}static validateModule(e){if(!e||typeof e!="object")throw new Error("Module must be an object");if(!e.id||typeof e.id!="string")throw new Error("Module must have a valid id");if(!e.name||typeof e.name!="string")throw new Error("Module must have a valid name");return!0}static generateCacheKey(e){const s=e.map(t=>t.id).sort().join(",");return btoa(s).substring(0,16)}static getCachedResult(e){const s=this.categorizationCache.get(e);return s?Date.now()-s.timestamp>this.CACHE_TTL?(this.categorizationCache.delete(e),null):{...s.data,metadata:{...s.data.metadata,cached:!0}}:null}static setCachedResult(e,s){if(this.categorizationCache.set(e,{data:{...s,metadata:{...s.metadata,cached:!1}},timestamp:Date.now()}),this.categorizationCache.size>10){const t=this.categorizationCache.keys().next().value;this.categorizationCache.delete(t)}}static clearCategorizationCache(){this.categorizationCache.clear()}static getCategorizationStats(){return{cacheSize:this.categorizationCache.size,cacheEntries:Array.from(this.categorizationCache.entries()).map(([e,s])=>({key:e,age:Date.now()-s.timestamp,modulesCount:s.data.primaryModules.length+s.data.secondaryModules.length}))}}static formatTTL(e){return e<60?`${e} —Å–µ–∫`:e<3600?`${Math.floor(e/60)} –º–∏–Ω`:`${Math.floor(e/3600)} —á`}static formatCreationTime(e){return e<1e3?`${Math.round(e)}–º—Å`:e<6e4?`${Math.round(e/1e3*10)/10}—Å–µ–∫`:`${Math.round(e/6e4*10)/10}–º–∏–Ω`}static formatCacheHitRatio(e){return`${Math.round(e*100)}%`}static formatDataFreshness(e){return`${Math.round(e*100)}%`}static getExpiryColor(e){if(!e)return"gray";const s=Date.now()/1e3,t=(e-s)/3600;return t>2?"green":t>.5?"yellow":"red"}static getEfficiencyColor(e){return e>=.85?"green":e>=.7?"yellow":"red"}static getCreationTimeColor(e){return e<=2e3?"green":e<=1e4?"yellow":"red"}static getFreshnessColor(e){return e>=.9?"green":e>=.7?"yellow":"red"}static generateModuleMetadata(e){const s=Math.floor(Date.now()/1e3),t=e.metadata||{},r=this.PRIMARY_MODULE_IDS.includes(e.id);return{version:t.version||"1.0",module_id:e.id,module_name:e.name,created_at:t.created_at||s-Math.random()*86400*7,created_by:t.created_by||(Math.random()>.5?"system":"cron"),creation_time_ms:t.creation_time_ms||500+Math.random()*9500,last_accessed_at:t.last_accessed_at||s-Math.random()*3600,access_count:t.access_count||Math.floor(Math.random()*100)+1,expires_at:t.expires_at||s+(e.ttl||3600),ttl_seconds:e.ttl||3600,file_size_bytes:e.total_size||Math.floor(Math.random()*1e7)+1e6,compression_ratio:t.compression_ratio||.7+Math.random()*.3,data_version:t.data_version||`2026.01.12.v${Math.floor(Math.random()*10)+1}`,source_params:t.source_params||{period:r?Math.random()>.5?"weeks":"months":"default",sector_id:e.id.includes("sector-1c")?"1c":"all",filters:Math.random()>.5?["active_only"]:[],limit:Math.floor(Math.random()*1e3)+500},performance_metrics:t.performance_metrics||{avg_response_time_ms:20+Math.random()*80,cache_hit_ratio:.7+Math.random()*.3,data_freshness_score:.8+Math.random()*.2}}}static enrichModulesWithMetadata(e){return e.map(s=>({...s,metadata:this.generateModuleMetadata(s)}))}}Ce(W,"PRIMARY_MODULE_IDS",["dashboard-sector-1c","graph-state","graph-admission-closure-weeks","graph-admission-closure-months","time-tracking-default","time-tracking-detailed","time-tracking-summary"]),Ce(W,"PRIMARY_MODULE_PRIORITIES",{"dashboard-sector-1c":1,"graph-state":2,"graph-admission-closure-weeks":3,"graph-admission-closure-months":4,"time-tracking-default":5,"time-tracking-detailed":6,"time-tracking-summary":7}),Ce(W,"SECONDARY_MODULE_TYPES",{users:{prefix:"users-management",title:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –æ—Ç–¥–µ–ª–∞–º–∏"},activity:{prefix:"user-activity",title:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",description:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},webhooks:{prefix:"webhook-logs",title:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",description:"–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±—Ö—É–∫–æ–≤"}}),Ce(W,"categorizationCache",new Map),Ce(W,"CACHE_TTL",3e4);function mi(o){const e=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())),s=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-s);const t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}class st{static async createCache(e,s=null,t={}){try{const r=fe("/api/admin/cache-create.php"),i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,mode:s,params:t})});if(!i.ok){const l=await i.json().catch(()=>({}));throw new Error(l.error||`HTTP error! status: ${i.status}`)}const a=await i.json();if(a.success)return a;throw new Error(a.error||"Failed to create cache")}catch(r){throw console.error("[CacheCreationService] Error creating cache:",r),r}}static async getCreationStatus(e){try{const s=fe(`/api/admin/cache-create-status.php?task_id=${e}`),t=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return r;throw new Error(r.error||"Failed to get creation status")}catch(s){throw console.error("[CacheCreationService] Error getting creation status:",s),s}}static getDefaultParams(e){if(e.includes("graph-admission-closure"))if((e.includes("weeks")?"weeks":"months")==="weeks"){const t=new Date,r=t.getUTCFullYear(),i=mi(t),a=new Date(r,0,1+(i-1)*7),l=a.getUTCDay(),u=a.getUTCDate()-l+(l===0?-6:1);a.setUTCDate(u),a.setUTCHours(0,0,0,0);const g=new Date(a);return g.setUTCDate(a.getUTCDate()+6),g.setUTCHours(23,59,59,999),{product:"1C",periodMode:"weeks",weekStartUtc:a.toISOString(),weekEndUtc:g.toISOString(),includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,useCache:!0,forceRefresh:!0}}else return{product:"1C",periodMode:"months",includeTickets:!0,includeNewTicketsByStages:!1,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!1};if(e.includes("dashboard-sector-1c"))return{forceRefresh:!0,ttl:600};if(e.includes("graph-state"))return{type:"current",forceRefresh:!0,ttl:3600};if(e.includes("time-tracking")){const s=e.includes("detailed")?"detailed":e.includes("summary")?"summary":"default";return{product:"1C",includeTaskDetails:s==="detailed",summary:s==="summary"}}return{}}}class je{static notifyCacheCreationStarted(e){this.showNotification({content:`–ù–∞—á–∞—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}"...`,type:"info",autoHideDelay:3e3})}static notifyCacheCreationSuccess(e){this.showNotification({content:`‚úÖ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,type:"success",autoHideDelay:5e3})}static notifyCacheCreationError(e,s){this.showNotification({content:`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}": ${s}`,type:"error",autoHideDelay:7e3})}static notifyCacheUpdated(e,s="auto"){const t=s==="manual"?"–≤—Ä—É—á–Ω—É—é":"–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏";this.showNotification({content:`üîÑ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" –æ–±–Ω–æ–≤–ª—ë–Ω ${t}`,type:"info",autoHideDelay:4e3})}static notifyCacheUsed(e){this.showNotification({content:`‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}"`,type:"success",autoHideDelay:3e3})}static showNotification(e){typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:e.content,autoHideDelay:e.autoHideDelay||3e3}):console.log("[CacheNotification]",e.content)}}const ud=Object.freeze(Object.defineProperty({__proto__:null,CacheNotificationService:je},Symbol.toStringTag,{value:"Module"})),gi={name:"CacheCreateProgress",props:{progress:{type:Number,required:!0,validator:o=>o>=0&&o<=100},message:{type:String,default:"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞..."}}},fi={class:"cache-create-progress"},hi={class:"progress-bar"},vi={class:"progress-text"};function pi(o,e,s,t,r,i){return c(),d("div",fi,[n("div",hi,[n("div",{class:"progress-fill",style:Re({width:s.progress+"%"})},null,4)]),n("div",vi,m(s.progress)+"% - "+m(s.message),1)])}const yi=O(gi,[["render",pi],["__scopeId","data-v-7071de3b"]]),_i={name:"CacheCreateModal",components:{CacheCreateProgress:yi},props:{module:{type:Object,required:!0}},emits:["close","create"],setup(o,{emit:e}){const s=C(!1),t=C(0),r=C(""),i=C(null),a=C(""),l=S(()=>o.module.id.includes("graph-admission-closure")||o.module.id.includes("time-tracking")),u=S(()=>o.module.id.includes("graph-admission-closure")?["months","weeks"]:o.module.id.includes("time-tracking")?["default","detailed","summary"]:[]),g=()=>{e("close")},p=M=>{M.target===M.currentTarget&&g()},f=async()=>{s.value=!0,t.value=0,r.value="–ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞...";try{let M={};if(a.value.trim())try{M=JSON.parse(a.value)}catch{throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")}else M=st.getDefaultParams(o.module.id);je.notifyCacheCreationStarted(o.module.name),t.value=25,r.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24...";const T=await st.createCache(o.module.id,i.value,M);t.value=75,r.value="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∞...",await new Promise(k=>setTimeout(k,500)),t.value=100,r.value="–ö–µ—à —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",je.notifyCacheCreationSuccess(o.module.name),setTimeout(()=>{e("create",T),g()},1e3)}catch(M){console.error("[CacheCreateModal] Error creating cache:",M),je.notifyCacheCreationError(o.module.name,M.message),s.value=!1}};return te(()=>{u.value.length>0&&(i.value=u.value[0]);const M=st.getDefaultParams(o.module.id);a.value=JSON.stringify(M,null,2)}),{creating:s,progress:t,progressMessage:r,selectedMode:i,paramsJson:a,supportsModes:l,availableModes:u,close:g,handleOverlayClick:p,handleCreate:f}}},wi={class:"modal-header"},bi={class:"modal-body"},Ci={key:1,class:"create-form"},Si={key:0,class:"form-group"},ki=["value"],Ei={class:"form-group"},Ai={class:"modal-footer"},Ti=["disabled"],Mi=["disabled"],Li={key:0},xi={key:1};function Di(o,e,s,t,r,i){const a=$("CacheCreateProgress");return c(),d("div",{class:"modal-overlay",onClick:e[6]||(e[6]=(...l)=>t.handleOverlayClick&&t.handleOverlayClick(...l))},[n("div",{class:"modal-content",onClick:e[5]||(e[5]=ge(()=>{},["stop"]))},[n("div",wi,[n("h2",null,"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞: "+m(s.module.name),1),n("button",{onClick:e[0]||(e[0]=(...l)=>t.close&&t.close(...l)),class:"btn-close"},"√ó")]),n("div",bi,[t.creating?(c(),G(a,{key:0,progress:t.progress,message:t.progressMessage},null,8,["progress","message"])):(c(),d("div",Ci,[t.supportsModes?(c(),d("div",Si,[e[7]||(e[7]=n("label",null,"–†–µ–∂–∏–º –∫–µ—à–∞:",-1)),J(n("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.selectedMode=l),class:"form-control"},[(c(!0),d(H,null,q(t.availableModes,l=>(c(),d("option",{key:l,value:l},m(l),9,ki))),128))],512),[[Ee,t.selectedMode]])])):A("",!0),n("div",Ei,[e[8]||(e[8]=n("label",null,"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):",-1)),J(n("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.paramsJson=l),placeholder:'{"product": "1C", ...}',rows:"5",class:"form-control"},null,512),[[ke,t.paramsJson]]),e[9]||(e[9]=n("small",{class:"form-text"},"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",-1))])]))]),n("div",Ai,[n("button",{onClick:e[3]||(e[3]=(...l)=>t.close&&t.close(...l)),class:"btn-cancel",disabled:t.creating},"–û—Ç–º–µ–Ω–∞",8,Ti),n("button",{onClick:e[4]||(e[4]=(...l)=>t.handleCreate&&t.handleCreate(...l)),disabled:t.creating,class:"btn-create"},[t.creating?(c(),d("span",Li,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",xi,"–°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],8,Mi)])])])}const Ii=O(_i,[["render",Di],["__scopeId","data-v-da24811e"]]),Pi={name:"CacheCreateButton",components:{CacheCreateModal:Ii},props:{module:{type:Object,required:!0}},emits:["created"],setup(o,{emit:e}){const s=C(!1),t=C(!1);return{showModal:s,creating:t,openModal:()=>{s.value=!0},closeModal:()=>{s.value=!1},handleCreate:async l=>{t.value=!0;try{e("created",l)}finally{t.value=!1}}}}},Ui={class:"cache-create-button"},Ri=["disabled"],Ni={key:0},Fi={key:1};function Oi(o,e,s,t,r,i){const a=$("CacheCreateModal");return c(),d("div",Ui,[n("button",{onClick:e[0]||(e[0]=(...l)=>t.openModal&&t.openModal(...l)),disabled:t.creating,class:N(["btn-create",{"btn-disabled":t.creating}])},[t.creating?(c(),d("span",Ni,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",Fi,"‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],10,Ri),t.showModal?(c(),G(a,{key:0,module:s.module,onClose:t.closeModal,onCreate:t.handleCreate},null,8,["module","onClose","onCreate"])):A("",!0)])}const Bi=O(Pi,[["render",Oi],["__scopeId","data-v-177605d5"]]),$i={name:"CacheModuleCard",components:{CacheCreateButton:Bi},props:{module:{type:Object,required:!0,validator:o=>o&&typeof o.id=="string"&&typeof o.name=="string"},isPrimary:{type:Boolean,default:!1},priority:{type:Number,default:999},groupType:{type:String,default:null}},emits:["clear","refresh","details"],setup(o,{emit:e}){const s=C(!1),t=C(!1),r=C(!1),i=C(!1);te(()=>{const R=()=>{i.value=window.innerWidth<768};R(),window.addEventListener("resize",R)});const a=S(()=>({"cache-module-card":!0,"primary-module":o.isPrimary,"secondary-module":!o.isPrimary,"high-priority":o.priority<=3,"expiring-soon":T.value,"empty-cache":M.value,loading:s.value||t.value})),l=S(()=>o.isPrimary?"üèÜ":{users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"}[o.groupType]||"üîß"),u=S(()=>({"primary-icon":o.isPrimary,"secondary-icon":!o.isPrimary})),g=S(()=>o.isPrimary?"–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å":o.groupType?W.getModuleTypeConfig(o.groupType).title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞":""),p=S(()=>o.priority?`priority-${o.priority}`:""),f=S(()=>`status-${o.module.status||"empty"}`),M=S(()=>(o.module.file_count||0)===0),T=S(()=>{if(!o.module.expires_at)return!1;const K=(new Date(o.module.expires_at*1e3)-new Date)/(1e3*60*60);return K>0&&K<=2}),k=S(()=>{const R=o.module.status;return R==="active"?"–ê–∫—Ç–∏–≤–µ–Ω":R==="expired"?"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω":R==="empty"?"–ü—É—Å—Ç":"–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}),w=S(()=>W.formatCacheSize(o.module.total_size||0)),E=S(()=>W.formatTTL(o.module.ttl||0)),b=S(()=>{if(!o.module.cache_dir)return"";const R=o.module.cache_dir.split("/");return R.length>2?"..."+R.slice(-2).join("/"):o.module.cache_dir}),L=S(()=>o.module.metadata?.creation_time_ms?W.formatCreationTime(o.module.metadata.creation_time_ms):"‚Äî"),D=S(()=>{if(!o.module.metadata?.last_accessed_at)return"‚Äî";const R=new Date(o.module.metadata.last_accessed_at*1e3),K=new Date-R;return K<6e4?"–¢–æ–ª—å–∫–æ —á—Ç–æ":K<36e5?`${Math.floor(K/6e4)} –º–∏–Ω –Ω–∞–∑–∞–¥`:R.toLocaleString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),z=S(()=>o.module.metadata?.access_count||0),I=S(()=>o.module.metadata?.performance_metrics?.cache_hit_ratio?W.formatCacheHitRatio(o.module.metadata.performance_metrics.cache_hit_ratio):"‚Äî"),_=S(()=>o.module.metadata?.performance_metrics?.data_freshness_score?W.formatDataFreshness(o.module.metadata.performance_metrics.data_freshness_score):"‚Äî"),h=S(()=>o.module.expires_at?`metric-${W.getExpiryColor(o.module.expires_at)}`:""),v=S(()=>o.module.metadata?.creation_time_ms?`metric-${W.getCreationTimeColor(o.module.metadata.creation_time_ms)}`:""),x=S(()=>o.module.metadata?.performance_metrics?.cache_hit_ratio?`metric-${W.getEfficiencyColor(o.module.metadata.performance_metrics.cache_hit_ratio)}`:""),X=S(()=>o.module.metadata?.performance_metrics?.data_freshness_score?`metric-${W.getFreshnessColor(o.module.metadata.performance_metrics.data_freshness_score)}`:""),P=S(()=>!M.value&&!s.value),B=S(()=>o.isPrimary&&!M.value),ae=S(()=>M.value?"–ö–µ—à –º–æ–¥—É–ª—è –ø—É—Å—Ç":`–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è ${o.module.name}`),De=S(()=>{if(!o.module.created_at)return"‚Äî";const R=new Date(o.module.created_at*1e3),Z=new Date,K=Z-R;if(K<6e4)return"–¢–æ–ª—å–∫–æ —á—Ç–æ";if(K<36e5){const le=Math.floor(K/6e4);return`${le} ${le===1?"–º–∏–Ω—É—Ç—É":le<5?"–º–∏–Ω—É—Ç—ã":"–º–∏–Ω—É—Ç"} –Ω–∞–∑–∞–¥`}if(R.toDateString()===Z.toDateString())return`–°–µ–≥–æ–¥–Ω—è –≤ ${R.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`;const oe=new Date(Z);return oe.setDate(oe.getDate()-1),R.toDateString()===oe.toDateString()?`–í—á–µ—Ä–∞ –≤ ${R.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:R.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),Je=S(()=>{if(!o.module.expires_at)return"‚Äî";const R=new Date(o.module.expires_at*1e3),K=R-new Date;if(K<0)return`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω (${R.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})`;const oe=Math.floor(K/6e4),le=Math.floor(oe/60);return le>0?`${le} —á ${oe%60} –º–∏–Ω`:oe>0?`${oe} –º–∏–Ω`:"–ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã"}),he=async()=>{if(!(!P.value||!await Qe({title:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏",message:`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${o.module.name}"?`,type:"danger",confirmText:"–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à",cancelText:"–û—Ç–º–µ–Ω–∞"}))){s.value=!0;try{await W.clearCache(o.module.id),e("clear",o.module.id),Oe({type:"success",title:"–ö–µ—à –æ—á–∏—â–µ–Ω",message:`–ö–µ—à –º–æ–¥—É–ª—è "${o.module.name}" —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω`})}catch(Z){Oe({type:"error",title:"–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏",message:Z.message})}finally{s.value=!1}}},Ke=()=>{e("refresh")},Fe=R=>{t.value=R},Ye=()=>{r.value=!0,e("details",o.module)},Ge=()=>{r.value=!1},Oe=({type:R,title:Z,message:K})=>{typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:`${Z}: ${K}`,autoHideDelay:R==="error"?5e3:3e3}):alert(`${Z}: ${K}`)},Qe=async({title:R,message:Z,type:K,confirmText:oe,cancelText:le})=>new Promise(Ie=>{const ce=document.createElement("div");ce.className="confirmation-modal-overlay",ce.innerHTML=`
          <div class="confirmation-modal" role="dialog" aria-modal="true">
            <div class="modal-header">
              <h3>${R}</h3>
            </div>
            <div class="modal-body">
              <p>${Z}</p>
              <div class="warning-info">
                <p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ:</p>
                <ul>
                  <li>–£–¥–∞–ª–∏—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∫–µ—à–∞</li>
                  <li>–ü—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É —Å–æ–∑–¥–∞–Ω–∏—é –∫–µ—à–∞ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ</li>
                  <li>–ú–æ–∂–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–µ–¥–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É –º–æ–¥—É–ª—è</li>
                </ul>
              </div>
            </div>
            <div class="modal-actions">
              <button class="btn-cancel">${le}</button>
              <button class="btn-confirm">${oe}</button>
            </div>
          </div>
        `;const Ze=ce.querySelector(".btn-cancel"),y=ce.querySelector(".btn-confirm");Ze.addEventListener("click",()=>{ce.remove(),Ie(!1)}),y.addEventListener("click",()=>{ce.remove(),Ie(!0)}),document.addEventListener("keydown",function U(V){V.key==="Escape"&&(ce.remove(),Ie(!1),document.removeEventListener("keydown",U))}),document.body.appendChild(ce)});return{clearing:s,creating:t,showDetailModal:r,isMobile:i,moduleClasses:a,moduleIcon:l,iconClass:u,moduleTypeText:g,priorityClass:p,statusClass:f,isEmpty:M,isExpiringSoon:T,statusText:k,formattedSize:w,formattedTTL:E,shortCacheDir:b,formattedCreationTime:L,formattedLastAccess:D,accessCount:z,cacheEfficiency:I,dataFreshness:_,expiresClass:h,creationTimeClass:v,cacheEfficiencyClass:x,dataFreshnessClass:X,canClear:P,canShowDetails:B,clearButtonLabel:ae,formattedCreatedAt:De,formattedExpiresAt:Je,handleClear:he,handleCacheCreated:Ke,handleCreatingState:Fe,showDetails:Ye,closeDetails:Ge}}},zi=["aria-labelledby","aria-describedby"],ji={class:"card-header"},Wi={class:"module-identity"},Vi={class:"module-info"},Hi=["id"],qi={class:"module-type"},Xi={class:"header-meta"},Ji=["id"],Ki={class:"card-content"},Yi={class:"data-grid"},Gi={class:"data-section statistics"},Qi={class:"data-items"},Zi={class:"data-item"},el={class:"data-value"},tl={class:"data-item"},sl={class:"data-value"},ol={key:0,class:"data-item full-width"},nl=["title"],al={class:"data-section lifetime"},rl={class:"data-items"},il={class:"data-item"},ll={class:"data-value"},cl={key:0,class:"data-item"},dl={class:"data-value"},ul={key:1,class:"data-item"},ml={key:0,class:"data-section performance"},gl={class:"data-items"},fl={class:"data-item"},hl={class:"data-item"},vl={class:"data-value"},pl={class:"data-item"},yl={class:"data-value"},_l={class:"data-item"},wl={class:"data-item"},bl={class:"primary-actions"},Cl={class:"secondary-actions"},Sl=["disabled","aria-label"],kl={key:0,class:"button-content"},El={key:1,class:"button-content"},Al={key:2,class:"button-content"},Tl=["aria-label"],Ml={class:"detail-modal",role:"dialog","aria-modal":"true"},Ll={class:"modal-header"},xl={class:"modal-content"},Dl={class:"json-data"};function Il(o,e,s,t,r,i){const a=$("CacheCreateButton");return c(),d("article",{class:N(["cache-module-card",t.moduleClasses]),role:"article","aria-labelledby":`module-${s.module.id}-title`,"aria-describedby":`module-${s.module.id}-status`},[n("div",ji,[n("div",Wi,[n("div",{class:N(["module-icon",t.iconClass])},m(t.moduleIcon),3),n("div",Vi,[n("h3",{class:"module-name",id:`module-${s.module.id}-title`},m(s.module.name),9,Hi),n("span",qi,m(t.moduleTypeText),1)])]),n("div",Xi,[s.isPrimary&&s.priority?(c(),d("span",{key:0,class:N(["priority-badge",t.priorityClass])},m(s.priority),3)):A("",!0),n("span",{class:N(["status-badge",t.statusClass]),id:`module-${s.module.id}-status`,role:"status"},m(t.statusText),11,Ji)])]),n("div",Ki,[n("div",Yi,[n("div",Gi,[e[14]||(e[14]=n("div",{class:"section-header"},[n("span",{class:"section-icon"},"üìä"),n("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],-1)),n("div",Qi,[n("div",Zi,[e[11]||(e[11]=n("span",{class:"data-label"},"–§–∞–π–ª–æ–≤:",-1)),n("span",el,m(s.module.file_count||0),1)]),n("div",tl,[e[12]||(e[12]=n("span",{class:"data-label"},"–†–∞–∑–º–µ—Ä:",-1)),n("span",sl,m(t.formattedSize),1)]),s.module.cache_dir?(c(),d("div",ol,[e[13]||(e[13]=n("span",{class:"data-label"},"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:",-1)),n("span",{class:"data-value cache-dir",title:s.module.cache_dir},m(t.shortCacheDir),9,nl)])):A("",!0)])]),n("div",al,[e[18]||(e[18]=n("div",{class:"section-header"},[n("span",{class:"section-icon"},"‚è∞"),n("h4",{class:"section-title"},"–í—Ä–µ–º—è –∂–∏–∑–Ω–∏")],-1)),n("div",rl,[n("div",il,[e[15]||(e[15]=n("span",{class:"data-label"},"TTL:",-1)),n("span",ll,m(t.formattedTTL),1)]),s.module.created_at?(c(),d("div",cl,[e[16]||(e[16]=n("span",{class:"data-label"},"–°–æ–∑–¥–∞–Ω:",-1)),n("span",dl,m(t.formattedCreatedAt),1)])):A("",!0),s.module.expires_at?(c(),d("div",ul,[e[17]||(e[17]=n("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç:",-1)),n("span",{class:N(["data-value",t.expiresClass])},m(t.formattedExpiresAt),3)])):A("",!0)])]),s.isPrimary&&s.module.metadata?(c(),d("div",ml,[e[24]||(e[24]=n("div",{class:"section-header"},[n("span",{class:"section-icon"},"‚ö°"),n("h4",{class:"section-title"},"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")],-1)),n("div",gl,[n("div",fl,[e[19]||(e[19]=n("span",{class:"data-label"},"–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:",-1)),n("span",{class:N(["data-value",t.creationTimeClass])},m(t.formattedCreationTime),3)]),n("div",hl,[e[20]||(e[20]=n("span",{class:"data-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—Å—Ç—É–ø:",-1)),n("span",vl,m(t.formattedLastAccess),1)]),n("div",pl,[e[21]||(e[21]=n("span",{class:"data-label"},"–û–±—Ä–∞—â–µ–Ω–∏–π:",-1)),n("span",yl,m(t.accessCount),1)]),n("div",_l,[e[22]||(e[22]=n("span",{class:"data-label"},"–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),n("span",{class:N(["data-value",t.cacheEfficiencyClass])},m(t.cacheEfficiency),3)]),n("div",wl,[e[23]||(e[23]=n("span",{class:"data-label"},"–°–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:",-1)),n("span",{class:N(["data-value",t.dataFreshnessClass])},m(t.dataFreshness),3)])])])):A("",!0)])]),n("div",{class:N(["card-actions",{"mobile-layout":t.isMobile}])},[n("div",bl,[j(a,{module:s.module,disabled:t.creating,onCreated:t.handleCacheCreated,onCreating:t.handleCreatingState,class:N(["action-button create-button",{loading:t.creating}])},null,8,["module","disabled","onCreated","onCreating","class"])]),n("div",Cl,[n("button",{onClick:e[0]||(e[0]=(...l)=>t.handleClear&&t.handleClear(...l)),onKeydown:[e[1]||(e[1]=pe((...l)=>t.handleClear&&t.handleClear(...l),["enter"])),e[2]||(e[2]=pe(ge((...l)=>t.handleClear&&t.handleClear(...l),["prevent"]),["space"]))],disabled:!t.canClear,class:N(["action-button clear-button",{disabled:!t.canClear,loading:t.clearing}]),"aria-label":t.clearButtonLabel,tabindex:"0"},[t.clearing?(c(),d("span",kl,[...e[25]||(e[25]=[n("span",{class:"spinner"},null,-1),Y(" –û—á–∏—Å—Ç–∫–∞... ",-1)])])):t.isEmpty?(c(),d("span",El," üìÅ –ö–µ—à –ø—É—Å—Ç ")):(c(),d("span",Al," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å "))],42,Sl),t.canShowDetails?(c(),d("button",{key:0,onClick:e[3]||(e[3]=(...l)=>t.showDetails&&t.showDetails(...l)),onKeydown:[e[4]||(e[4]=pe((...l)=>t.showDetails&&t.showDetails(...l),["enter"])),e[5]||(e[5]=pe(ge((...l)=>t.showDetails&&t.showDetails(...l),["prevent"]),["space"]))],class:"action-button details-button","aria-label":`–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞ ${s.module.name}`,title:"–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞",tabindex:"0"}," üìä ",40,Tl)):A("",!0)])],2),(c(),G(gt,{to:"body"},[t.showDetailModal?(c(),d("div",{key:0,class:"detail-modal-overlay",onClick:e[9]||(e[9]=ge((...l)=>t.closeDetails&&t.closeDetails(...l),["self"])),onKeydown:e[10]||(e[10]=pe((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))},[n("div",Ml,[n("div",Ll,[n("h3",null,"–î–µ—Ç–∞–ª–∏ –∫–µ—à–∞: "+m(s.module.name),1),n("button",{onClick:e[6]||(e[6]=(...l)=>t.closeDetails&&t.closeDetails(...l)),onKeydown:[e[7]||(e[7]=pe((...l)=>t.closeDetails&&t.closeDetails(...l),["enter"])),e[8]||(e[8]=pe((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))],class:"close-button","aria-label":"–ó–∞–∫—Ä—ã—Ç—å",tabindex:"0"}," ‚úï ",32)]),n("div",xl,[n("pre",Dl,m(JSON.stringify(s.module,null,2)),1)])])],32)):A("",!0)]))],10,zi)}const Pl=O($i,[["render",Il],["__scopeId","data-v-c700185b"]]),Ul={name:"CacheStats",props:{modules:{type:Array,required:!1,default:()=>[]}},setup(o){console.log("[CacheStats] setup called with modules:",o.modules);const e=S(()=>o.modules||[]),s=S(()=>{console.log("[CacheStats] Computing primaryModules, total modules:",e.value?.length||0);const k=e.value.filter(w=>W.PRIMARY_MODULE_IDS.includes(w.id));return console.log("[CacheStats] Primary modules count:",k.length),k}),t=S(()=>{console.log("[CacheStats] Computing secondaryModules, total modules:",e.value?.length||0);const k=e.value.filter(w=>!W.PRIMARY_MODULE_IDS.includes(w.id));return console.log("[CacheStats] Secondary modules count:",k.length),k}),r=S(()=>s.value?.length||0),i=S(()=>t.value?.length||0),a=S(()=>e.value?.length||0),l=S(()=>e.value.reduce((k,w)=>k+(w.file_count||0),0)),u=S(()=>(o.modules||[]).reduce((k,w)=>k+(w.total_size||0),0)),g=S(()=>W.formatCacheSize(u.value)),p=S(()=>{const k=o.modules||[];if(k.length===0)return"0 –º–∏–Ω";const w=k.reduce((b,L)=>b+(L.ttl||0),0),E=Math.round(w/k.length);return W.formatTTL(E)}),f=S(()=>(e.value||[]).filter(k=>k.status==="active").length),M=S(()=>{if((i.value||0)===0)return[];const k={};(t.value||[]).forEach(E=>{const b=W.getModuleType(E.id);if(!k[b]){const L=W.getModuleTypeConfig(b);k[b]={type:b,title:L.title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞",icon:T(b),count:0}}k[b].count++});const w=i.value||0;return Object.values(k).map(E=>({...E,percentage:w>0?Math.round(E.count/w*100):0})).sort((E,b)=>b.count-E.count)}),T=k=>{const w={users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"};return w[k]||w.other};return{modules:e,primaryModulesCount:r,secondaryModulesCount:i,totalModules:a,totalFiles:l,totalSizeFormatted:g,avgTTL:p,activeModules:f,groupStats:M}}},Rl={key:0,class:"cache-stats"},Nl={class:"stats-overview"},Fl={class:"overview-grid"},Ol={class:"overview-card primary"},Bl={class:"overview-content"},$l={class:"overview-value"},zl={class:"overview-card secondary"},jl={class:"overview-content"},Wl={class:"overview-value"},Vl={class:"overview-card total"},Hl={class:"overview-content"},ql={class:"overview-value"},Xl={class:"detailed-stats"},Jl={class:"stats-grid"},Kl={class:"stat-card"},Yl={class:"stat-content"},Gl={class:"stat-value"},Ql={class:"stat-card"},Zl={class:"stat-content"},ec={class:"stat-value"},tc={class:"stat-card"},sc={class:"stat-content"},oc={class:"stat-value"},nc={class:"stat-card"},ac={class:"stat-content"},rc={class:"stat-value"},ic={key:0,class:"group-distribution"},lc={class:"distribution-grid"},cc={class:"group-icon"},dc={class:"group-info"},uc={class:"group-name"},mc={class:"group-count"},gc={class:"group-percentage"},fc={key:1,class:"cache-stats-loading"};function hc(o,e,s,t,r,i){return(t.modules||[]).length>0?(c(),d("div",Rl,[e[18]||(e[18]=n("h2",{class:"stats-title"},"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",-1)),n("div",Nl,[n("div",Fl,[n("div",Ol,[e[2]||(e[2]=n("div",{class:"overview-icon"},"üèÜ",-1)),n("div",Bl,[n("div",$l,m(t.primaryModulesCount),1),e[0]||(e[0]=n("div",{class:"overview-label"},"–û—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[1]||(e[1]=n("div",{class:"overview-desc"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ",-1))])]),n("div",zl,[e[5]||(e[5]=n("div",{class:"overview-icon"},"üîß",-1)),n("div",jl,[n("div",Wl,m(t.secondaryModulesCount),1),e[3]||(e[3]=n("div",{class:"overview-label"},"–ü–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[4]||(e[4]=n("div",{class:"overview-desc"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),n("div",Vl,[e[8]||(e[8]=n("div",{class:"overview-icon"},"üì¶",-1)),n("div",Hl,[n("div",ql,m(t.totalModules),1),e[6]||(e[6]=n("div",{class:"overview-label"},"–í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π",-1)),e[7]||(e[7]=n("div",{class:"overview-desc"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö",-1))])])])]),n("div",Xl,[n("div",Jl,[n("div",Kl,[e[10]||(e[10]=n("div",{class:"stat-icon"},"üìÑ",-1)),n("div",Yl,[n("div",Gl,m(t.totalFiles),1),e[9]||(e[9]=n("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤",-1))])]),n("div",Ql,[e[12]||(e[12]=n("div",{class:"stat-icon"},"üíæ",-1)),n("div",Zl,[n("div",ec,m(t.totalSizeFormatted),1),e[11]||(e[11]=n("div",{class:"stat-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä",-1))])]),n("div",tc,[e[14]||(e[14]=n("div",{class:"stat-icon"},"‚è±Ô∏è",-1)),n("div",sc,[n("div",oc,m(t.avgTTL),1),e[13]||(e[13]=n("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–∏–π TTL",-1))])]),n("div",nc,[e[16]||(e[16]=n("div",{class:"stat-icon"},"‚ö°",-1)),n("div",ac,[n("div",rc,m(t.activeModules),1),e[15]||(e[15]=n("div",{class:"stat-label"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–µ—à–µ–π",-1))])])])]),t.secondaryModulesCount>0?(c(),d("div",ic,[e[17]||(e[17]=n("h3",{class:"distribution-title"},"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),n("div",lc,[(c(!0),d(H,null,q(t.groupStats,a=>(c(),d("div",{key:a.type,class:"distribution-item"},[n("div",cc,m(a.icon),1),n("div",dc,[n("div",uc,m(a.title),1),n("div",mc,m(a.count)+" –º–æ–¥—É–ª–µ–π",1)]),n("div",gc,m(a.percentage)+"%",1)]))),128))])])):A("",!0)])):(c(),d("div",fc,[...e[19]||(e[19]=[n("p",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])]))}const vc=O(Ul,[["render",hc],["__scopeId","data-v-9fa190bb"]]),pc={name:"CacheManagement",components:{CacheModuleCard:Pl,CacheStats:vc},setup(){const o=C([]),e=C([]),s=C(!0),t=C(null),r=S(()=>(o.value?.length||0)+(e.value?.length||0)),i=S(()=>{const w=a.value?.length||0,E=(l.value?.length||0)>0?1:0;return w+E}),a=S(()=>{const w=(o.value||[]).filter(E=>!E.id.includes("time-tracking"));return console.log("[CacheManagement] individualPrimaryModules:",w.length,w.map(E=>E.id)),w}),l=S(()=>{const w=(o.value||[]).filter(E=>E.id.includes("time-tracking")).sort((E,b)=>{const L=["time-tracking-default","time-tracking-detailed","time-tracking-summary"];return L.indexOf(E.id)-L.indexOf(b.id)});return console.log("[CacheManagement] timeTrackingModules:",w.length,w.map(E=>E.id)),w}),u=S(()=>{const w={};return(e.value||[]).forEach(b=>{const L=W.getModuleType(b.id);w[L]||(w[L]={type:L,title:p(L),modules:[]}),w[L].modules.push(b)}),Object.values(w).sort((b,L)=>{const D=["users","activity","webhooks","other"],z=D.indexOf(b.type),I=D.indexOf(L.type);return(z===-1?999:z)-(I===-1?999:I)})}),g=async()=>{s.value=!0,t.value=null;try{const w=[{id:"dashboard-sector-1c",name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",status:"active",file_count:5,total_size:1024e3,ttl:600,created_at:Math.floor(Date.now()/1e3)-7200,expires_at:Math.floor(Date.now()/1e3)+1800,cache_dir:"/var/cache/dashboard/sector-1c",metadata:{version:"1.0",module_id:"dashboard-sector-1c",module_name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",created_at:Math.floor(Date.now()/1e3)-7200,created_by:"system",creation_time_ms:1250,last_accessed_at:Math.floor(Date.now()/1e3)-300,access_count:45,expires_at:Math.floor(Date.now()/1e3)+1800,ttl_seconds:600,file_size_bytes:1024e3,compression_ratio:.75,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only"],limit:1e3},performance_metrics:{avg_response_time_ms:45,cache_hit_ratio:.92,data_freshness_score:.95}}},{id:"graph-state",name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",status:"active",file_count:3,total_size:512e3,ttl:3600,created_at:Math.floor(Date.now()/1e3)-10800,expires_at:Math.floor(Date.now()/1e3)+7200,cache_dir:"/var/cache/graphs/state",metadata:{version:"1.0",module_id:"graph-state",module_name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",created_at:Math.floor(Date.now()/1e3)-10800,created_by:"cron",creation_time_ms:890,last_accessed_at:Math.floor(Date.now()/1e3)-600,access_count:23,expires_at:Math.floor(Date.now()/1e3)+7200,ttl_seconds:3600,file_size_bytes:512e3,compression_ratio:.82,data_version:"2026.01.12.v2",source_params:{period:"months",sector_id:"all",filters:[],limit:500},performance_metrics:{avg_response_time_ms:32,cache_hit_ratio:.88,data_freshness_score:.91}}},{id:"graph-admission-closure-weeks",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",status:"active",file_count:8,total_size:2048e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-1800,expires_at:Math.floor(Date.now()/1e3)+120,cache_dir:"/var/cache/graphs/admission-closure/weeks",metadata:{version:"1.0",module_id:"graph-admission-closure-weeks",module_name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",created_at:Math.floor(Date.now()/1e3)-1800,created_by:"system",creation_time_ms:2100,last_accessed_at:Math.floor(Date.now()/1e3)-60,access_count:67,expires_at:Math.floor(Date.now()/1e3)+120,ttl_seconds:300,file_size_bytes:2048e3,compression_ratio:.68,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only","resolved_only"],limit:2e3},performance_metrics:{avg_response_time_ms:78,cache_hit_ratio:.95,data_freshness_score:.98}}},{id:"graph-admission-closure-months",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",status:"active",file_count:12,total_size:3072e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-3600,expires_at:Math.floor(Date.now()/1e3)+240,cache_dir:"/var/cache/graphs/admission-closure/months",metadata:{version:"1.0",module_id:"graph-admission-closure-months",module_name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",created_at:Math.floor(Date.now()/1e3)-3600,created_by:"cron",creation_time_ms:3400,last_accessed_at:Math.floor(Date.now()/1e3)-120,access_count:34,expires_at:Math.floor(Date.now()/1e3)+240,ttl_seconds:300,file_size_bytes:3072e3,compression_ratio:.71,data_version:"2026.01.12.v3",source_params:{period:"months",sector_id:"1c",filters:["active_only"],limit:3e3},performance_metrics:{avg_response_time_ms:92,cache_hit_ratio:.89,data_freshness_score:.93}}},{id:"time-tracking-default",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",status:"active",file_count:4,total_size:768e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-900,expires_at:Math.floor(Date.now()/1e3)+2100,cache_dir:"/var/cache/time-tracking/default",metadata:{version:"1.0",module_id:"time-tracking-default",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",created_at:Math.floor(Date.now()/1e3)-900,created_by:"system",creation_time_ms:560,last_accessed_at:Math.floor(Date.now()/1e3)-180,access_count:12,expires_at:Math.floor(Date.now()/1e3)+2100,ttl_seconds:300,file_size_bytes:768e3,compression_ratio:.79,data_version:"2026.01.12.v2",source_params:{period:"weeks",sector_id:"1c",filters:["active_only"],limit:800},performance_metrics:{avg_response_time_ms:28,cache_hit_ratio:.96,data_freshness_score:.97}}},{id:"time-tracking-detailed",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:6,total_size:1536e3,ttl:120,created_at:Math.floor(Date.now()/1e3)-600,expires_at:Math.floor(Date.now()/1e3)+3540,cache_dir:"/var/cache/time-tracking/detailed",metadata:{version:"1.0",module_id:"time-tracking-detailed",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",created_at:Math.floor(Date.now()/1e3)-600,created_by:"user",creation_time_ms:890,last_accessed_at:Math.floor(Date.now()/1e3)-90,access_count:8,expires_at:Math.floor(Date.now()/1e3)+3540,ttl_seconds:120,file_size_bytes:1536e3,compression_ratio:.74,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only","detailed_view"],limit:1500},performance_metrics:{avg_response_time_ms:45,cache_hit_ratio:.91,data_freshness_score:.94}}},{id:"time-tracking-summary",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:2,total_size:384e3,ttl:600,created_at:Math.floor(Date.now()/1e3)-1800,expires_at:Math.floor(Date.now()/1e3)+4200,cache_dir:"/var/cache/time-tracking/summary",metadata:{version:"1.0",module_id:"time-tracking-summary",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",created_at:Math.floor(Date.now()/1e3)-1800,created_by:"cron",creation_time_ms:340,last_accessed_at:Math.floor(Date.now()/1e3)-240,access_count:19,expires_at:Math.floor(Date.now()/1e3)+4200,ttl_seconds:600,file_size_bytes:384e3,compression_ratio:.85,data_version:"2026.01.12.v3",source_params:{period:"months",sector_id:"1c",filters:["summary_view"],limit:300},performance_metrics:{avg_response_time_ms:18,cache_hit_ratio:.98,data_freshness_score:.99}}},{id:"users-management-departments",name:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–æ—Ç–¥–µ–ª—ã)",status:"active",file_count:2,total_size:256e3,ttl:3600,created_at:Math.floor(Date.now()/1e3)-7200,expires_at:Math.floor(Date.now()/1e3)+28800,cache_dir:"/var/cache/users/departments"},{id:"webhook-logs-api",name:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ (API –∑–∞–ø—Ä–æ—Å—ã)",status:"active",file_count:15,total_size:512e4,ttl:300,created_at:Math.floor(Date.now()/1e3)-3600,expires_at:Math.floor(Date.now()/1e3)+2400,cache_dir:"/var/cache/webhooks/api"}],E=W.enrichModulesWithMetadata(w),b=W.categorizeAndSortModules(E);o.value=b.primaryModules||[],e.value=b.secondaryModules||[],console.log("[CacheManagement] Primary modules:",o.value.length,o.value.map(L=>({id:L.id,name:L.name}))),console.log("[CacheManagement] Secondary modules:",e.value.length,e.value.map(L=>({id:L.id,name:L.name})))}catch(w){console.error("[CacheManagement] Error loading modules:",w),t.value=w.message}finally{s.value=!1}},p=w=>{const E={users:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",activity:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",webhooks:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",other:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏"};return E[w]||E.other},f=async w=>{console.log(`[CacheManagement] Clearing module: ${w}`),await g()},M=async w=>{console.log(`[CacheManagement] Creating cache for: ${w.name} (${w.id})`),alert(`–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${w.name}
ID: ${w.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},T=async w=>{console.log(`[CacheManagement] Clearing cache for: ${w.name} (${w.id})`),alert(`–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${w.name}
ID: ${w.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},k=()=>{g()};return te(()=>{g()}),{primaryModules:o,secondaryModules:e,loading:s,error:t,totalModules:r,groupedSecondaryModules:u,individualPrimaryModules:a,timeTrackingModules:l,logicalPrimaryCount:i,handleModuleClear:f,handleCreateMock:M,handleClearMock:T,refreshModules:k}}},yc={class:"cache-management"},_c={key:0,class:"header-section"},wc={class:"stats-bar"},bc={class:"stat-item"},Cc={class:"stat-item"},Sc={class:"stat-item"},kc={class:"section-header"},Ec={class:"section-meta"},Ac={class:"module-count","aria-label":"{{ logicalPrimaryCount }} –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},Tc={key:0,class:"modules-container"},Mc={style:{background:"#f0f8ff",padding:"10px",margin:"10px 0",border:"1px solid #007bff","border-radius":"4px"}},Lc={key:0,class:"modules-grid"},xc={key:1,class:"time-tracking-group"},Dc={class:"modules-grid"},Ic={key:1,class:"empty-state"},Pc={key:2,class:"section-divider"},Uc={key:3,class:"cache-section secondary-modules","aria-labelledby":"secondary-modules-heading"},Rc={class:"section-header"},Nc={class:"section-meta"},Fc={class:"module-count","aria-label":"{{ (secondaryModules || []).length }} –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},Oc={class:"grouped-modules"},Bc={class:"group-header"},$c={class:"group-title"},zc={class:"group-badge secondary"},jc={class:"modules-grid"},Wc={key:4,class:"error-message",role:"alert","aria-live":"assertive"},Vc={key:5,class:"loading-overlay",role:"status","aria-live":"polite","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"};function Hc(o,e,s,t,r,i){const a=$("CacheModuleCard");return c(),d("div",yc,[!t.loading&&!t.error?(c(),d("div",_c,[e[5]||(e[5]=n("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1)),e[6]||(e[6]=n("p",{class:"description"}," –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º —Å–∏—Å—Ç–µ–º—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è ",-1)),n("div",wc,[n("span",bc,[n("strong",null,m(t.totalModules),1),e[2]||(e[2]=Y(" –≤—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π ",-1))]),n("span",Cc,[n("strong",null,m(t.logicalPrimaryCount),1),e[3]||(e[3]=Y(" –æ—Å–Ω–æ–≤–Ω—ã—Ö ",-1))]),n("span",Sc,[n("strong",null,m((t.secondaryModules||[]).length),1),e[4]||(e[4]=Y(" –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ",-1))])])])):A("",!0),!t.loading&&!t.error?(c(),d("section",{key:1,class:N(["cache-section primary-modules",{empty:(t.primaryModules||[]).length===0}]),"aria-labelledby":"primary-modules-heading"},[n("div",kc,[e[8]||(e[8]=n("h2",{id:"primary-modules-heading"},"üèÜ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),n("div",Ec,[n("span",Ac,m(t.logicalPrimaryCount),1),e[7]||(e[7]=n("span",{class:"section-badge primary",role:"status","aria-label":"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",-1))])]),e[16]||(e[16]=n("p",{class:"section-description"}," 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã: –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°, –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏–µ–º–∞-–∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°. ",-1)),(t.primaryModules||[]).length>0?(c(),d("div",Tc,[n("div",Mc,[n("strong",null,"DEBUG: Primary modules loaded: "+m(t.primaryModules.length),1),e[9]||(e[9]=n("br",null,null,-1)),n("strong",null,"Individual modules: "+m(t.individualPrimaryModules.length),1),e[10]||(e[10]=n("br",null,null,-1)),n("strong",null,"Time tracking modules: "+m(t.timeTrackingModules.length),1),e[11]||(e[11]=n("br",null,null,-1)),e[12]||(e[12]=n("strong",null,"IDs:",-1)),Y(" "+m(t.primaryModules.map(l=>l.id).join(", ")),1)]),t.individualPrimaryModules.length>0?(c(),d("div",Lc,[(c(!0),d(H,null,q(t.individualPrimaryModules,l=>(c(),d("div",{key:l.id,class:"module-wrapper"},[j(a,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])):A("",!0),(t.timeTrackingModules||[]).length>0?(c(),d("div",xc,[e[13]||(e[13]=n("div",{class:"group-header"},[n("h3",{class:"group-title"},"‚è±Ô∏è –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"),n("span",{class:"group-badge"},"–û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞")],-1)),e[14]||(e[14]=n("p",{class:"group-description"},"–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),n("div",Dc,[(c(!0),d(H,null,q(t.timeTrackingModules,l=>(c(),d("div",{key:l.id,class:"module-wrapper"},[j(a,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])])):A("",!0)])):(c(),d("div",Ic,[e[15]||(e[15]=n("p",null,"‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)),n("button",{onClick:e[0]||(e[0]=(...l)=>t.refreshModules&&t.refreshModules(...l)),class:"refresh-btn"},"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫")]))],2)):A("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("div",Pc,[...e[17]||(e[17]=[Mt('<div class="divider-line" data-v-02719b2e></div><div class="divider-content" data-v-02719b2e><span class="divider-icon" data-v-02719b2e>üîß</span><span class="divider-text" data-v-02719b2e>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏</span><span class="divider-subtitle" data-v-02719b2e>–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</span></div><div class="divider-line" data-v-02719b2e></div>',3)])])):A("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("section",Uc,[n("div",Rc,[e[19]||(e[19]=n("h2",{id:"secondary-modules-heading"},"üîß –ü–æ–±–æ—á–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),n("div",Nc,[n("span",Fc,m((t.secondaryModules||[]).length),1),e[18]||(e[18]=n("span",{class:"section-badge secondary",role:"status","aria-label":"–°–ª—É–∂–µ–±–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),e[20]||(e[20]=n("p",{class:"section-description"}," –ú–æ–¥—É–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã. ",-1)),n("div",Oc,[(c(!0),d(H,null,q(t.groupedSecondaryModules,l=>(c(),d("div",{key:l.type,class:N(["module-group",`group-${l.type}`])},[n("div",Bc,[n("h3",$c,m(l.title),1),n("span",zc,m(l.modules.length),1)]),n("div",jc,[(c(!0),d(H,null,q(l.modules,u=>(c(),d("div",{key:u.id,class:"module-wrapper"},[j(a,{module:u,"is-primary":!1,"group-type":l.type,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","group-type","onClear","onRefresh"])]))),128))])],2))),128))])])):A("",!0),t.error?(c(),d("div",Wc,[e[21]||(e[21]=n("h3",null,"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞",-1)),n("p",null,m(t.error),1),n("button",{onClick:e[1]||(e[1]=(...l)=>o.loadModules&&o.loadModules(...l)),class:"retry-btn","aria-label":"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):A("",!0),t.loading?(c(),d("div",Vc,[...e[22]||(e[22]=[n("div",{class:"loading-spinner","aria-hidden":"true"},null,-1),n("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞...",-1)])])):A("",!0)])}const qc=O(pc,[["render",Hc],["__scopeId","data-v-02719b2e"]]),Xc={name:"CacheManagementPage",components:{CacheManagement:qc},beforeCreate(){console.log("[CacheManagementPage] beforeCreate() called")},created(){console.log("[CacheManagementPage] created() called")},beforeMount(){console.log("[CacheManagementPage] beforeMount() called")},setup(){console.log("[CacheManagementPage] setup() called with new hierarchical UI");const o=Ue(),e=C(!1),s=C(null),t=()=>{o.push({name:"index"})};return te(()=>{console.log("[CacheManagementPage] onMounted() called - hierarchical cache management ready")}),{loading:e,error:s,goBack:t}}},Jc={class:"cache-management-page"},Kc={class:"page-header"},Yc={class:"page-header-top"},Gc={key:0,class:"loading"},Qc={key:1,class:"error"},Zc={key:2,class:"cache-content"};function ed(o,e,s,t,r,i){const a=$("CacheManagement");return c(),d("div",Jc,[n("div",Kc,[n("div",Yc,[n("button",{onClick:e[0]||(e[0]=(...l)=>t.goBack&&t.goBack(...l)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[n("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),n("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=n("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1))]),t.loading?(c(),d("div",Gc," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–µ—à–∞... ")):t.error?(c(),d("div",Qc,m(t.error),1)):(c(),d("div",Zc,[j(a)]))])}const td=O(Xc,[["render",ed],["__scopeId","data-v-a20ded38"]]),sd=[{path:"/install",name:"install",component:is},{path:"/",name:"index",component:Os},{path:"/webhook-logs",name:"webhook-logs",redirect:"/admin/webhook-logs"},{path:"/admin/webhook-logs",name:"admin-webhook-logs",component:Ha,meta:{requiresAuth:!0,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",adminOnly:!0}},{path:"/admin/users",name:"admin-users",component:ui,meta:{requiresAuth:!0,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",adminOnly:!0}},{path:"/admin/cache",name:"admin-cache",component:td,meta:{requiresAuth:!0,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",adminOnly:!0}},{path:"/dashboard/sector-1c",name:"dashboard-sector-1c",component:()=>ne(()=>import("./DashboardSector1C.vue-DtNSkQdN.js"),__vite__mapDeps([9,4,10,11,12,6,2,1,13,5]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector1c"}},{path:"/dashboard/graph-admission-closure",name:"dashboard-graph-admission-closure",component:()=>ne(()=>import("./GraphAdmissionClosureDashboard.vue-BhBMfeCM.js"),__vite__mapDeps([14,4,15,12,6,2,1,11,16,10,5]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–æ–≤—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",requiresAuth:!0,chunk:"admission-dashboard"}},{path:"/dashboard/graph-state",name:"dashboard-graph-state",component:()=>ne(()=>import("./GraphStateDashboard.vue-Gat5ILLK.js"),__vite__mapDeps([17,4,1,13,12,6,2,11,10,15,5]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏",requiresAuth:!0,chunk:"graph-state"}},{path:"/dashboard/tickets-time-tracking",name:"dashboard-tickets-time-tracking",component:()=>ne(()=>import("./TicketsTimeTrackingDashboard.vue-hc6IgKoI.js"),__vite__mapDeps([18,4,1,5,6,2]),import.meta.url),meta:{title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",requiresAuth:!0,chunk:"tickets-tracking"}}],He=Lt({history:xt(),routes:sd});He.beforeEach(async(o,e,s)=>{if(console.log("[Router] beforeEach:",{to:o.path,from:e.path,name:o.name}),o.meta.title&&(document.title=`${o.meta.title} - Bitrix24 Dashboard`),o.meta.requiresAuth){console.log("[Router] requiresAuth check for:",o.path);try{const t=await Se.checkAccess();if(!t.allowed){console.warn("Unauthorized access attempt to:",o.path,t.errorMessage),s({name:"index"});return}}catch(t){console.error("Error checking access in navigation guard:",t),s();return}}if(o.meta.adminOnly)try{const t=await Se.getCurrentUser();if(!t||!_t(t)){console.warn("Admin access required for:",o.path),s({name:"index"});return}}catch(t){console.error("Error checking admin access in navigation guard:",t),s({name:"index"});return}if(e.name!==null&&o.path!==e.path)try{if((await Se.checkAccess()).allowed){const r=await Se.getCurrentUser();r&&ze.logPageVisit(o,r,e).catch(i=>{console.error("[Router] Error logging page visit:",i)})}}catch(t){console.error("[Router] Error in activity logging:",t)}if(o.name==="index"&&!e.name&&setTimeout(()=>{ne(()=>import("./DashboardSector1C.vue-DtNSkQdN.js"),__vite__mapDeps([9,4,10,11,12,6,2,1,13,5]),import.meta.url)},1e3),o.meta.chunk)switch(o.meta.chunk){case"dashboard-sector1c":setTimeout(()=>{ne(()=>import("./dashboard-sector-1c-service-B6ZCEz-L.js"),__vite__mapDeps([16,12,6,2,1,11]),import.meta.url)},500);break;case"admission-dashboard":setTimeout(()=>{ne(()=>import("./chunk-D85qNiqy.js").then(t=>t.l),__vite__mapDeps([2,1]),import.meta.url)},500);break}console.log("[Router] Allowing navigation to:",o.path),s()});setTimeout(()=>{const o=window.location.pathname,e=window.location.hash;e&&e!=="#/"||(o.includes("install.php")?He.replace("/install"):He.replace("/"))},0);Ne.register(Dt,It,Pt,Ut,Rt,Nt,Ft,Ot,Bt,$t);Ne.defaults.responsive=!0;Ne.defaults.maintainAspectRatio=!1;Ne.defaults.plugins.legend.display=!0;Ne.defaults.plugins.legend.position="top";const md={primary:"#007bff",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8",carryover:"#ff9800",successLight:"#6cbf47",carryoverLight:"#ffb74d",carryoverDark:"#f57c00"};class We{static startBundleLoad(){this.metrics.bundleLoadTime=performance.now()}static endBundleLoad(e){const s=performance.now()-this.metrics.bundleLoadTime;this.metrics.chunkLoadTimes.set(e,s),console.log(`üì¶ Chunk "${e}" loaded in ${s.toFixed(2)}ms`),window.gtag&&window.gtag("event","bundle_load",{chunk_name:e,load_time:s}),s>1e3&&console.warn(`üêå Slow chunk load: ${e} took ${s.toFixed(2)}ms`)}static trackComponentLoad(e,s){const t=performance.now()-s;this.metrics.componentLoadTime.set(e,t),console.log(`üß© Component "${e}" loaded in ${t.toFixed(2)}ms`),t>500&&console.warn(`üêå Slow component load: ${e} took ${t.toFixed(2)}ms`)}static trackApiCall(e,s){this.metrics.apiResponseTime.set(e,s),s>1e3&&console.warn(`üêå Slow API call to ${e}: ${s}ms`)}static getReport(){const e=Array.from(this.metrics.componentLoadTime.values()),s=Array.from(this.metrics.apiResponseTime.values()),t=Array.from(this.metrics.chunkLoadTimes.values());return{totalChunks:this.metrics.chunkLoadTimes.size,totalComponents:this.metrics.componentLoadTime.size,totalApiCalls:this.metrics.apiResponseTime.size,averageComponentLoadTime:e.length>0?e.reduce((r,i)=>r+i,0)/e.length:0,averageApiResponseTime:s.length>0?s.reduce((r,i)=>r+i,0)/s.length:0,averageChunkLoadTime:t.length>0?t.reduce((r,i)=>r+i,0)/t.length:0,slowestComponents:Array.from(this.metrics.componentLoadTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i})),slowestApiCalls:Array.from(this.metrics.apiResponseTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({endpoint:r,time:i})),slowestChunks:Array.from(this.metrics.chunkLoadTimes.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i}))}}static clearMetrics(){this.metrics.bundleLoadTime=0,this.metrics.componentLoadTime.clear(),this.metrics.apiResponseTime.clear(),this.metrics.chunkLoadTimes.clear()}}Ce(We,"metrics",{bundleLoadTime:0,componentLoadTime:new Map,apiResponseTime:new Map,chunkLoadTimes:new Map});class od{static init(){this.initChunkLoadErrorHandling(),this.initUnhandledErrorHandling(),this.initNetworkErrorHandling()}static initChunkLoadErrorHandling(){if(window.addEventListener("error",e=>{e.target.tagName==="SCRIPT"&&(console.error("‚ùå Chunk loading error:",e.target.src),this.reportError("chunk_load_error",{url:e.target.src,message:e.message||"Script load failed"}))}),"PerformanceObserver"in window)try{new PerformanceObserver(s=>{for(const t of s.getEntries())if(t.entryType==="resource"&&t.name.includes(".js")){const r=t.responseEnd-t.requestStart;We.trackApiCall(t.name,r)}}).observe({entryTypes:["resource"]})}catch{console.warn("PerformanceObserver not supported")}}static initUnhandledErrorHandling(){window.addEventListener("unhandledrejection",e=>{console.error("‚ùå Unhandled promise rejection:",e.reason),this.reportError("unhandled_rejection",{reason:e.reason?.message||String(e.reason),stack:e.reason?.stack})}),window.addEventListener("error",e=>{e.error&&e.filename&&(console.error("‚ùå Unhandled error:",e.error),this.reportError("unhandled_error",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error.stack}))})}static initNetworkErrorHandling(){const e=window.fetch;window.fetch=function(...s){const t=performance.now();return e.apply(this,s).then(r=>{const i=performance.now()-t;return We.trackApiCall(s[0],i),r.ok||console.warn(`üö® API error: ${r.status} ${r.statusText} for ${s[0]}`),r}).catch(r=>{const i=performance.now()-t;throw console.error(`‚ùå Network error for ${s[0]}:`,r),We.trackApiCall(s[0],i),this.reportError("network_error",{url:s[0],message:r.message,loadTime:i}),r})}}static reportError(e,s){const t={type:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...s};if(console.error("üìä Error report:",t),window.Sentry&&window.Sentry.captureException(new Error(`${e}: ${JSON.stringify(s)}`)),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:"/api/log-error.php",method:"POST",data:t})}catch(r){console.error("Failed to send error report to Bitrix24:",r)}window.gtag&&window.gtag("event","exception",{description:`${e}: ${s.message||"Unknown error"}`,fatal:!1})}static getErrorStats(){return{chunkLoadErrors:0,networkErrors:0,unhandledErrors:0,totalErrors:0}}}const it=zt(qt);it.use(He);const nd=o=>{try{const e=new WeakSet;return JSON.stringify(o,(s,t)=>{if(typeof t=="object"&&t!==null){if(e.has(t))return"[Circular]";e.add(t)}return typeof t=="function"||t===void 0?null:t})}catch{return String(o)}};it.config.errorHandler=(o,e,s)=>{if(console.error("Vue error:",o,s),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:fe("/api/log-error.php"),method:"POST",data:{error:o?.message||String(o),info:typeof s=="string"?s:nd(s),component:e?.$options?.name||"Unknown"}})}catch(t){console.error("Failed to log error:",t)}};it.mount("#app");od.init();export{Se as A,je as C,pt as L,vt as S,O as _,Ae as a,be as b,md as c,ye as d,$s as e,xe as f,at as g,ud as h,_t as i,Le as n,bt as u};
