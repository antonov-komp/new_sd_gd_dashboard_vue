import{_ as ne,a as E,o as k,b as i,F as ce,f as de,j as V,n as ve,t as N,r as A,c as F,m as ue,G as ke,d as U,g as he,p as be,H as Re,x as Ze,I as Qe,u as Ee,L as Xe,C as Je,J as Te,k as X,l as _e,i as se,B as Be,K as et,D as tt,M as at,N as st,y as De,O as ie,z as nt,e as ot}from"./main-DxMJ7Pp1.js";import{L as qe,D as rt,B as lt}from"./index-Bn3akV2I.js";import{S as xe,d as Me,K as it,D as Ge,e as Ye,B as ct}from"./index-CEd6309h.js";const Q={apiBaseUrl:"",snapshotsEndpoint:"/api/snapshots.php",defaultSectorId:"1C",snapshotVersion:"1.0",timeout:3e4};class te{static getApiBaseUrl(){const e=window.location.pathname;return e.substring(0,e.lastIndexOf("/"))}static async createSnapshot(e,t,s={}){try{if(!e||typeof e!="object")throw new ae("sectorData –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º","VALIDATION_ERROR");if(!t||!["week_start","week_end","manual","current"].includes(t))throw new ae("type –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–Ω–∏–º –∏–∑: week_start, week_end, manual, current","VALIDATION_ERROR");const r=this.validateSectorData(e);if(!r.isValid)throw new ae(`–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞: ${r.errors.join(", ")}`,"VALIDATION_ERROR",{validation:r});const a=this.normalizeSectorData(e),c={metadata:this.generateSnapshotMetadata(t,s.createdBy,s.sectorId||Q.defaultSectorId),statistics:a.statistics,ticketIds:a.ticketIds,tickets:a.tickets},o=this.validateSnapshot(c);if(!o.isValid)throw new ae(`–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–ª–µ–ø–∫–∞: ${o.errors.join(", ")}`,"VALIDATION_ERROR",{validation:o});o.warnings.length>0&&console.warn("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–ª–µ–ø–∫–∞:",o.warnings);const l=this.getApiBaseUrl(),f=await fetch(`${l}${Q.snapshotsEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({action:"create",snapshot:c,type:t,date:this.formatDate(new Date)})});if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);const w=await f.json();if(!w.success)throw new Error(w.message||"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞");return w.data.snapshot}catch(r){throw console.error("SnapshotService.createSnapshot error:",r),r instanceof ae?r:new ae(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞: ${r.message}`,"API_ERROR",{originalError:r})}}static async getSnapshot(e,t){try{const s=this.formatDate(e),a=`${this.getApiBaseUrl()}${Q.snapshotsEndpoint}?action=get&date=${s}&type=${t}`,n=await fetch(a,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(n.status===404)return null;if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const c=await n.json();if(!c.success)throw new Error(c.message||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–ø–∫–∞");return c.data.snapshot}catch(s){throw console.error("SnapshotService.getSnapshot error:",s),s}}static async getAllSnapshots(e={}){try{const t=new URLSearchParams;t.append("action","list"),e.startDate&&t.append("startDate",this.formatDate(e.startDate)),e.endDate&&t.append("endDate",this.formatDate(e.endDate)),e.type&&t.append("type",e.type),e.sectorId?t.append("sectorId",e.sectorId):t.append("sectorId",Q.defaultSectorId);const r=`${this.getApiBaseUrl()}${Q.snapshotsEndpoint}?${t.toString()}`,a=await fetch(r,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=await a.json();if(!n.success)throw new Error(n.message||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–ª–µ–ø–∫–æ–≤");return(await Promise.all(n.data.snapshots.map(async o=>{try{return await this.getSnapshot(o.date,o.type)}catch(l){return console.warn(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–µ–ø–∫–∞ ${o.date}/${o.type}:`,l),null}}))).filter(o=>o!==null).sort((o,l)=>new Date(o.metadata.createdAt)-new Date(l.metadata.createdAt))}catch(t){throw console.error("SnapshotService.getAllSnapshots error:",t),t}}static normalizeSectorData(e){const{stages:t=[],employees:s=[],zeroPointTickets:r={}}=e,a={formed:{count:0,stageId:"DT140_12:UC_0VHWE2",stageName:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ"},review:{count:0,stageId:"DT140_12:PREPARATION",stageName:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó"},execution:{count:0,stageId:"DT140_12:CLIENT",stageName:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"}},n=[],c=[],o=[];t.forEach(w=>{const p=w.id;if(a[p]){let D=0;w.employees.forEach(S=>{const y=S.tickets||[];D+=y.length;let g=n.find(m=>m.id===S.id);g||(g={id:S.id,name:S.name,ticketsByStage:{formed:0,review:0,execution:0},totalTickets:0},n.push(g)),y.forEach(m=>{c.push(m.id),o.push({id:m.id,title:m.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:{id:S.id,name:S.name},createdAt:m.createdAt||"",updatedAt:m.modifiedAt||m.updatedAt||""}),g.ticketsByStage[p]=(g.ticketsByStage[p]||0)+1,g.totalTickets+=1})}),a[p].count=D}});const l={unassigned:0,keeper:0,total:0};Object.values(r).forEach(w=>{Array.isArray(w)&&w.forEach(p=>{l.total+=1,p.assigneeId===1051||p.assignedById===1051?l.keeper+=1:l.unassigned+=1,c.push(p.id),o.push({id:p.id,title:p.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:p.assignedTo||p.assignedById?{id:p.assignedById||p.assigneeId,name:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}:null,createdAt:p.createdAt||"",updatedAt:p.modifiedAt||p.updatedAt||""})})});const f=Object.values(a).reduce((w,p)=>w+p.count,0)+l.total;return{statistics:{stages:{...a,total:f},employees:n,zeroPoint:l},ticketIds:[...new Set(c)],tickets:o}}static generateSnapshotMetadata(e,t,s){const r=new Date,a=-r.getTimezoneOffset(),n=Math.floor(a/60),c=a%60,o=`${n>=0?"+":""}${String(n).padStart(2,"0")}:${String(c).padStart(2,"0")}`,l=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}T${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}:${String(r.getSeconds()).padStart(2,"0")}${o}`;return{version:Q.snapshotVersion,createdAt:l,createdBy:t||{id:0,name:"–°–∏—Å—Ç–µ–º–∞"},type:e,sectorId:s,sectorName:s==="1C"?"–°–µ–∫—Ç–æ—Ä 1–°":`–°–µ–∫—Ç–æ—Ä ${s}`}}static formatDate(e){if(e||(e=new Date),typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;e=new Date(e)}if(!(e instanceof Date)||isNaN(e.getTime()))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞");const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${r}`}static buildFilePath(e,t){const s=typeof e=="string"?new Date(e):e,r=s.getFullYear(),a=this.getWeekNumber(s),n=this.formatDate(e);let c;if(t==="current"){const o=new Date,l=`${String(o.getHours()).padStart(2,"0")}-${String(o.getMinutes()).padStart(2,"0")}-${String(o.getSeconds()).padStart(2,"0")}`;c=`current-state-${n}-${l}.json`}else if(t==="manual"){const o=new Date,l=`${String(o.getHours()).padStart(2,"0")}-${String(o.getMinutes()).padStart(2,"0")}-${String(o.getSeconds()).padStart(2,"0")}`;c=`manual-${n}-${l}.json`}else c=`${t}-${n}.json`;return t==="current"?`current/${c}`:`${r}/week-${a}/${c}`}static getWeekNumber(e){const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),s=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-s);const r=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-r)/864e5+1)/7)}static validateSnapshot(e){var r,a,n;const t=[],s=[];if(e.metadata?((!e.metadata.version||typeof e.metadata.version!="string")&&t.push("–ù–µ–≤–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö"),(!e.metadata.createdAt||!this.isValidISODate(e.metadata.createdAt))&&t.push("–ù–µ–≤–µ—Ä–Ω–∞—è –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è"),["week_start","week_end","manual","current"].includes(e.metadata.type)||t.push("–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø —Å–ª–µ–ø–∫–∞"),(!e.metadata.sectorId||typeof e.metadata.sectorId!="string")&&t.push("–ù–µ–≤–µ—Ä–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ–∫—Ç–æ—Ä–∞"),(!e.metadata.createdBy||!e.metadata.createdBy.id||!e.metadata.createdBy.name)&&t.push("–ù–µ–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞—Ç–µ–ª–µ")):t.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–ª–µ–ø–∫–∞"),!e.statistics)t.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞");else{if(!e.statistics.stages)t.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —ç—Ç–∞–ø–∞–º");else{const c=e.statistics.stages,o=(((r=c.formed)==null?void 0:r.count)||0)+(((a=c.review)==null?void 0:a.count)||0)+(((n=c.execution)==null?void 0:n.count)||0);c.total!==o&&s.push(`–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–µ—Ç–æ–≤: –æ–∂–∏–¥–∞–µ—Ç—Å—è ${o}, —É–∫–∞–∑–∞–Ω–æ ${c.total}`)}if(Array.isArray(e.statistics.employees)||t.push("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),!e.statistics.zeroPoint)t.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω—É–ª–µ–≤–æ–π —Ç–æ—á–∫–∏");else{const c=e.statistics.zeroPoint,o=(c.unassigned||0)+(c.keeper||0);c.total!==o&&s.push(`–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω—É–ª–µ–≤–æ–π —Ç–æ—á–∫–∏: –æ–∂–∏–¥–∞–µ—Ç—Å—è ${o}, —É–∫–∞–∑–∞–Ω–æ ${c.total}`)}}if(Array.isArray(e.ticketIds)||t.push("ticketIds –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),!Array.isArray(e.tickets))t.push("tickets –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º");else{const c=new Set(e.ticketIds),o=new Set(e.tickets.map(l=>l.id));c.size!==o.size&&s.push("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ ID –≤ ticketIds –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–∏–∫–µ—Ç–æ–≤"),e.tickets.forEach((l,f)=>{l.id||t.push(`–¢–∏–∫–µ—Ç #${f}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ID`),l.title||t.push(`–¢–∏–∫–µ—Ç #${f}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫`),(!l.assignedTo||!l.assignedTo.id)&&s.push(`–¢–∏–∫–µ—Ç #${f}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –Ω—É–ª–µ–≤–æ–π —Ç–æ—á–∫–µ)`),l.createdAt||t.push(`–¢–∏–∫–µ—Ç #${f}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è`),l.updatedAt||t.push(`–¢–∏–∫–µ—Ç #${f}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è`)})}return{isValid:t.length===0,errors:t,warnings:s}}static validateSectorData(e){const t=[],s=[];return!e||typeof e!="object"?(t.push("sectorData –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{isValid:!1,errors:t,warnings:s}):(Array.isArray(e.stages)||t.push("stages –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),Array.isArray(e.employees)||t.push("employees –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),(!e.zeroPointTickets||typeof e.zeroPointTickets!="object")&&t.push("zeroPointTickets –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{isValid:t.length===0,errors:t,warnings:s})}static isValidISODate(e){if(typeof e!="string")return!1;const t=new Date(e);return!isNaN(t.getTime())&&e.includes("T")}static async deleteSnapshot(e,t){try{const s=this.formatDate(e),a=`${this.getApiBaseUrl()}${Q.snapshotsEndpoint}`,n=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({action:"delete",date:s,type:t})});if(n.status===404)return!1;if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const c=await n.json();if(!c.success)throw new Error(c.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–µ–ø–∫–∞");return!0}catch(s){throw console.error("SnapshotService.deleteSnapshot error:",s),s}}static async deleteSnapshotsByPeriod(e){try{const t=await this.getAllSnapshots(e);let s=0;for(const r of t)try{await this.deleteSnapshot(r.metadata.createdAt.split("T")[0],r.metadata.type)&&s++}catch(a){console.warn(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–µ–ø–∫–∞ ${r.metadata.createdAt}:`,a)}return s}catch(t){throw console.error("SnapshotService.deleteSnapshotsByPeriod error:",t),t}}static getSnapshotVersion(e){var t;return((t=e==null?void 0:e.metadata)==null?void 0:t.version)||"unknown"}static async migrateSnapshot(e,t=Q.snapshotVersion){const s=this.getSnapshotVersion(e);return s===t||s==="1.0"&&t==="1.0"?e:(console.warn(`–ú–∏–≥—Ä–∞—Ü–∏—è —Å –≤–µ—Ä—Å–∏–∏ ${s} –Ω–∞ ${t} –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞`),{...e,metadata:{...e.metadata,version:t}})}static getWeekNumberInfo(e){const t=typeof e=="string"?new Date(e):e,s=this.getWeekNumber(t);return{year:t.getFullYear(),week:s}}static getWeekStartDate(e){const t=typeof e=="string"?new Date(e):e,r=(t.getDay()||7)-1,a=new Date(t);return a.setDate(t.getDate()-r),a.setHours(0,0,0,0),a}static getWeekEndDate(e){const t=typeof e=="string"?new Date(e):e,r=7-(t.getDay()||7),a=new Date(t);return a.setDate(t.getDate()+r),a.setHours(23,59,59,999),a}static async getSnapshotsForWeek(e){try{const t=this.getWeekStartDate(e),s=this.getWeekEndDate(e),r=this.getWeekNumberInfo(e),a=await this.getAllSnapshots({startDate:t,endDate:s}),n=a.find(l=>l.metadata.type==="week_start")||null,c=a.find(l=>l.metadata.type==="week_end")||null,o=a.filter(l=>l.metadata.type==="manual");return{weekStart:n,weekEnd:c,manual:o,weekInfo:r}}catch(t){throw console.error("SnapshotService.getSnapshotsForWeek error:",t),t}}static handleError(e){if(e instanceof ae)return{message:e.message,code:e.code,details:e.details};let t="UNKNOWN_ERROR";return e.message.includes("–≤–∞–ª–∏–¥–∞—Ü")?t="VALIDATION_ERROR":e.message.includes("404")||e.message.includes("–Ω–µ –Ω–∞–π–¥–µ–Ω")?t="NOT_FOUND":e.message.includes("HTTP")||e.message.includes("API")?t="API_ERROR":e.message.includes("–≤–µ—Ä—Å–∏—è")||e.message.includes("version")?t="VERSION_MISMATCH":(e.message.includes("–¥–æ—Å—Ç—É–ø")||e.message.includes("permission"))&&(t="PERMISSION_DENIED"),{message:e.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",code:t,details:{originalError:e}}}static async getSnapshotsStatistics(e={}){try{const t=await this.getAllSnapshots(e),s={week_start:0,week_end:0,manual:0,current:0},r=new Map;let a=null,n=null;t.forEach(o=>{const l=o.metadata.type;s.hasOwnProperty(l)&&s[l]++;const f=this.getWeekNumberInfo(o.metadata.createdAt),w=`${f.year}-W${f.week}`;r.set(w,(r.get(w)||0)+1);const p=new Date(o.metadata.createdAt);(!a||p<new Date(a.metadata.createdAt))&&(a=o),(!n||p>new Date(n.metadata.createdAt))&&(n=o)});const c=Array.from(r.entries()).map(([o,l])=>{const[f,w]=o.split("-W");return{year:parseInt(f),week:parseInt(w),count:l}}).sort((o,l)=>o.year!==l.year?o.year-l.year:o.week-l.week);return{total:t.length,byType:s,byWeek:c,oldest:a,newest:n}}catch(t){throw console.error("SnapshotService.getSnapshotsStatistics error:",t),t}}}class ae extends Error{constructor(e,t,s={}){super(e),this.name="SnapshotError",this.code=t,this.details=s}}const ee={formed:{bitrixId:Me.formed,name:xe.FORMED.name},review:{bitrixId:Me.review,name:xe.REVIEW.name},execution:{bitrixId:Me.execution,name:xe.EXECUTION.name}},me=it;function dt(d){if(!d||typeof d!="object")throw new Error("Invalid sector data: sectorData must be an object");if(!d.stages||!Array.isArray(d.stages))throw new Error("Invalid sector data: stages are required and must be an array");const e=ut(d.stages),t=pt(d.stages),s=ft(d.zeroPointTickets||{}),r=gt(d.zeroPointTickets||{}),a=ht(d.stages,d.zeroPointTickets||{});return{statistics:{stages:e,employees:t,zeroPoint:s,zeroPointByStage:r},ticketIds:a.ticketIds,tickets:a.tickets}}function ut(d){const e={formed:{count:0,stageId:ee.formed.bitrixId,stageName:ee.formed.name},review:{count:0,stageId:ee.review.bitrixId,stageName:ee.review.name},execution:{count:0,stageId:ee.execution.bitrixId,stageName:ee.execution.name},total:0};return d.forEach(t=>{if(!ee[t.id]){console.warn(`Unknown stage ID: ${t.id}`);return}let s=0;t.employees&&Array.isArray(t.employees)&&t.employees.forEach(r=>{r.tickets&&Array.isArray(r.tickets)&&(s+=r.tickets.length)}),e[t.id].count=s,e.total+=s}),e}function pt(d){const e=new Map;return d.forEach(t=>{!t.employees||!Array.isArray(t.employees)||t.employees.forEach(s=>{if(!s||!s.id)return;e.has(s.id)||e.set(s.id,{id:s.id,name:s.name||`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${s.id}`,ticketsByStage:{formed:0,review:0,execution:0},totalTickets:0});const r=e.get(s.id),a=s.tickets&&Array.isArray(s.tickets)?s.tickets.length:0;ee[t.id]&&(r.ticketsByStage[t.id]=(r.ticketsByStage[t.id]||0)+a),r.totalTickets+=a})}),Array.from(e.values())}function ft(d){let e=0,t=0;return!d||typeof d!="object"?{unassigned:0,keeper:0,total:0}:(Object.values(d).forEach(s=>{Array.isArray(s)&&s.forEach(r=>{if(!r)return;const a=r.assignedTo||r.assignedById;!a||a===null?e++:(typeof a=="object"?a.id:a)===me?t++:e++})}),{unassigned:e,keeper:t,total:e+t})}function gt(d){const e={formed:{keeper:0,unassigned:0,total:0},review:{keeper:0,unassigned:0,total:0},execution:{keeper:0,unassigned:0,total:0}};return!d||typeof d!="object"||Object.keys(e).forEach(t=>{const s=d[t];Array.isArray(s)&&s.forEach(r=>{if(!r)return;const a=r.assignedTo||r.assignedById;!a||a===null?e[t].unassigned++:(typeof a=="object"?a.id:a)===me?e[t].keeper++:e[t].unassigned++,e[t].total++})}),e}function ht(d,e){const t=new Set,s=new Map;return Array.isArray(d)&&d.forEach(r=>{!r.employees||!Array.isArray(r.employees)||r.employees.forEach(a=>{!a.tickets||!Array.isArray(a.tickets)||a.tickets.forEach(n=>{if(!n||!n.id){console.warn("Ticket without ID found:",n);return}const c=parseInt(n.id);if(isNaN(c)){console.warn("Invalid ticket ID:",n.id);return}t.add(c);let o=n.assignedTo;!o&&a.id&&(o={id:a.id,name:a.name||`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${a.id}`}),s.set(c,{id:c,title:n.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:o||null,createdAt:Se(n.createdAt||n.createdTime),updatedAt:Se(n.updatedAt||n.modifiedAt||n.updatedTime)})})})}),e&&typeof e=="object"&&Object.values(e).forEach(r=>{Array.isArray(r)&&r.forEach(a=>{if(!a||!a.id){console.warn("Ticket without ID found in zero point:",a);return}const n=parseInt(a.id);if(isNaN(n)){console.warn("Invalid ticket ID in zero point:",a.id);return}t.add(n);let c=a.assignedTo;if(!c&&a.assignedById){const o=typeof a.assignedById=="object"?a.assignedById.id||a.assignedById.value:a.assignedById;o&&o!==me?c={id:o,name:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"}:o===me&&(c={id:me,name:"–•—Ä–∞–Ω–∏—Ç–µ–ª—å –æ–±—ä–µ–∫—Ç–æ–≤"})}s.set(n,{id:n,title:a.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",assignedTo:c||null,createdAt:Se(a.createdAt||a.createdTime),updatedAt:Se(a.updatedAt||a.modifiedAt||a.updatedTime)})})}),{ticketIds:Array.from(t).sort((r,a)=>r-a),tickets:Array.from(s.values())}}function Se(d){if(!d)return null;if(d instanceof Date)return d.toISOString();if(typeof d=="string"){if(d.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/))return d;const e=new Date(d);if(!isNaN(e.getTime()))return e.toISOString()}return console.warn("Invalid date format:",d),null}class Ne{static async getSectorDataForSnapshot(e={}){const{useCache:t=!0,onProgress:s=null,normalize:r=!0,includeTicketDetails:a=!1}=e;try{const n=await Ge.getSectorData(t,s);return r?dt(n):(a&&console.warn("includeTicketDetails –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ"),n)}catch(n){throw console.error("SectorDataAdapter.getSectorDataForSnapshot error:",n),n}}static async isDataAvailable(){try{const e=await Ge.getSectorData(!0);return e!=null}catch{return!1}}}class Oe{static compareTwoSnapshots(e,t,s={}){const{includeTickets:r=!1,includeEmployees:a=!0}=s,n=this.validateSnapshot(e),c=this.validateSnapshot(t);if(!n.valid||!c.valid)throw new Error("Invalid snapshot structure: "+[...n.errors,...c.errors].join(", "));const o=this.buildComparisonMetadata(e,t),l=this.compareStages(e.statistics.stages,t.statistics.stages),f=a?this.compareEmployees(e.statistics.employees||[],t.statistics.employees||[]):[],w=this.compareZeroPoint(e.statistics.zeroPoint||{},t.statistics.zeroPoint||{}),p=r?this.compareTickets(e.ticketIds||[],t.ticketIds||[],e.tickets||[],t.tickets||[]):null,D=this.buildSummary(l,f,w,p);return{metadata:o,stages:l,employees:f,zeroPoint:w,tickets:p,summary:D}}static calculateDelta(e,t){const s=this.normalizeValue(e),r=this.normalizeValue(t),a=r-s;let n=0;s!==0?n=a/s*100:r!==0&&(n=r>0?1/0:-1/0);const c=this.getTrend(a);return{value1:s,value2:r,delta:a,deltaPercent:Math.round(n*100)/100,trend:c}}static normalizeValue(e){return e==null||isNaN(e)?0:Number(e)}static getTrend(e){return e>0?"increase":e<0?"decrease":"stable"}static compareStages(e,t){var c,o;const s=["formed","review","execution"],r={};for(const l of s){const f=((c=e[l])==null?void 0:c.count)||0,w=((o=t[l])==null?void 0:o.count)||0;r[l]=this.calculateDelta(f,w)}const a=e.total||0,n=t.total||0;return r.total=this.calculateDelta(a,n),r}static compareEmployees(e,t){var c,o;const s=new Map(e.map(l=>[l.id,l])),r=new Map(t.map(l=>[l.id,l])),a=new Set([...s.keys(),...r.keys()]),n=[];for(const l of a){const f=s.get(l)||null,w=r.get(l)||null;if(!f||!w){n.push({id:l,name:(f==null?void 0:f.name)||(w==null?void 0:w.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",snapshot1:f?{ticketsByStage:f.ticketsByStage||{},totalTickets:f.totalTickets||0}:null,snapshot2:w?{ticketsByStage:w.ticketsByStage||{},totalTickets:w.totalTickets||0}:null,delta:this.calculateEmployeeDelta(f,w),trend:f?"removed":"new"});continue}const p={},D=["formed","review","execution"];for(const y of D){const g=((c=f.ticketsByStage)==null?void 0:c[y])||0,m=((o=w.ticketsByStage)==null?void 0:o[y])||0;p[y]=this.calculateDelta(g,m)}const S=this.calculateDelta(f.totalTickets||0,w.totalTickets||0);n.push({id:l,name:f.name,snapshot1:{ticketsByStage:f.ticketsByStage||{},totalTickets:f.totalTickets||0},snapshot2:{ticketsByStage:w.ticketsByStage||{},totalTickets:w.totalTickets||0},delta:{ticketsByStage:p,totalTickets:S},trend:S.trend})}return n}static calculateEmployeeDelta(e,t){var n,c;if(!e&&!t)return{ticketsByStage:{},totalTickets:{delta:0,trend:"stable"}};const s={},r=["formed","review","execution"];for(const o of r){const l=((n=e==null?void 0:e.ticketsByStage)==null?void 0:n[o])||0,f=((c=t==null?void 0:t.ticketsByStage)==null?void 0:c[o])||0;s[o]=this.calculateDelta(l,f)}const a=this.calculateDelta((e==null?void 0:e.totalTickets)||0,(t==null?void 0:t.totalTickets)||0);return{ticketsByStage:s,totalTickets:a}}static compareZeroPoint(e,t){return{unassigned:this.calculateDelta((e==null?void 0:e.unassigned)||0,(t==null?void 0:t.unassigned)||0),keeper:this.calculateDelta((e==null?void 0:e.keeper)||0,(t==null?void 0:t.keeper)||0),total:this.calculateDelta((e==null?void 0:e.total)||0,(t==null?void 0:t.total)||0)}}static compareTickets(e,t,s,r){var D,S;const a=new Set(e),n=new Set(t),c=t.filter(y=>!a.has(y)),o=e.filter(y=>!n.has(y)),l=[],f=[],w=new Map(s.map(y=>[y.id,y])),p=new Map(r.map(y=>[y.id,y]));for(const y of e){if(!n.has(y))continue;const g=w.get(y),m=p.get(y);if(!g||!m)continue;const T=(((D=g.assignedTo)==null?void 0:D.id)||null)!==(((S=m.assignedTo)==null?void 0:S.id)||null),P=(g.stageId||null)!==(m.stageId||null);T||P?l.push(y):f.push(y)}return{new:c,removed:o,changed:l,unchanged:f}}static buildComparisonMetadata(e,t){const s=new Date(e.metadata.createdAt),r=new Date(t.metadata.createdAt),a=new Date,n=r.getTime()-s.getTime(),c=Math.floor(n/(1e3*60*60*24)),o=Math.floor(n%(1e3*60*60*24)/(1e3*60*60)),l=Math.floor(n%(1e3*60*60)/(1e3*60));return{snapshot1Date:e.metadata.createdAt,snapshot2Date:t.metadata.createdAt,comparisonDate:a.toISOString(),timeDiff:{days:c,hours:o,minutes:l,totalMinutes:Math.floor(n/(1e3*60))}}}static buildSummary(e,t,s,r){var l,f,w;const a=e.total.delta,n=Object.keys(e).filter(p=>p==="total"?!1:e[p].delta!==0).length,c=t.filter(p=>p.trend==="new"||p.trend==="removed"?!0:p.delta.totalTickets.delta!==0).length,o=a!==0||n>0||c>0;return{totalDelta:a,stagesChanged:n,employeesChanged:c,hasChanges:o,newTicketsCount:((l=r==null?void 0:r.new)==null?void 0:l.length)||0,removedTicketsCount:((f=r==null?void 0:r.removed)==null?void 0:f.length)||0,changedTicketsCount:((w=r==null?void 0:r.changed)==null?void 0:w.length)||0}}static validateSnapshot(e){const t=[],s=[];if(!e)return t.push("Snapshot is null or undefined"),{valid:!1,errors:t,warnings:s};if(e.metadata?(e.metadata.createdAt||t.push("Missing metadata.createdAt"),e.metadata.type||t.push("Missing metadata.type")):t.push("Missing metadata field"),!e.statistics)t.push("Missing statistics field");else{if(!e.statistics.stages)t.push("Missing statistics.stages");else{const r=["formed","review","execution"];for(const a of r)e.statistics.stages[a]||s.push(`Missing stage: ${a}`)}e.statistics.employees||s.push("Missing statistics.employees (may be empty array)"),e.statistics.zeroPoint||s.push("Missing statistics.zeroPoint")}return{valid:t.length===0,errors:t,warnings:s}}static compareMultipleSnapshots(e,t={}){if(!Array.isArray(e)||e.length<2)throw new Error("At least 2 snapshots required for comparison");for(const n of e){const c=this.validateSnapshot(n);if(!c.valid)throw new Error("Invalid snapshot: "+c.errors.join(", "))}const s=[...e].sort((n,c)=>{const o=new Date(n.metadata.createdAt),l=new Date(c.metadata.createdAt);return o-l}),r=[];for(let n=0;n<s.length-1;n++)r.push({from:n,to:n+1,result:this.compareTwoSnapshots(s[n],s[n+1],t)});const a=this.buildTrends(s);return{snapshots:s.map((n,c)=>({index:c,date:n.metadata.createdAt,type:n.metadata.type,data:n})),comparisons:r,trends:a}}static buildTrends(e){var s,r,a,n,c,o,l,f,w,p;const t={stages:{formed:[],review:[],execution:[],total:[]},zeroPoint:{unassigned:[],keeper:[],total:[]}};for(const D of e){const S=D.statistics;t.stages.formed.push(((r=(s=S.stages)==null?void 0:s.formed)==null?void 0:r.count)||0),t.stages.review.push(((n=(a=S.stages)==null?void 0:a.review)==null?void 0:n.count)||0),t.stages.execution.push(((o=(c=S.stages)==null?void 0:c.execution)==null?void 0:o.count)||0),t.stages.total.push(((l=S.stages)==null?void 0:l.total)||0),t.zeroPoint.unassigned.push(((f=S.zeroPoint)==null?void 0:f.unassigned)||0),t.zeroPoint.keeper.push(((w=S.zeroPoint)==null?void 0:w.keeper)||0),t.zeroPoint.total.push(((p=S.zeroPoint)==null?void 0:p.total)||0)}return t}}const mt={class:"stages-container"},vt={class:"stages-chips"},yt=["checked","disabled","onChange"],wt={class:"stage-chip-label"},St={__name:"StageChips",props:{stages:{type:Array,required:!0,validator:d=>d.every(e=>e.id&&e.name&&e.color)},selected:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},emits:["update:selected","change"],setup(d,{emit:e}){const t=d,s=e;function r(a,n){const c={...t.selected};c[a]=n,s("update:selected",c),s("change",a,n)}return(a,n)=>(k(),E("div",mt,[n[0]||(n[0]=i("h4",{class:"stages-title"},"–≠—Ç–∞–ø—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:",-1)),i("div",vt,[(k(!0),E(ce,null,de(d.stages,c=>(k(),E("label",{key:c.id,class:V(["stage-chip",{"stage-chip--active":d.selected[c.id],"stage-chip--disabled":d.disabled}])},[i("input",{type:"checkbox",checked:d.selected[c.id],disabled:d.disabled,onChange:o=>r(c.id,o.target.checked)},null,40,yt),i("span",{class:"stage-chip-color",style:ve({backgroundColor:c.color})},null,4),i("span",wt,N(c.name),1)],2))),128))])]))}},kt=ne(St,[["__scopeId","data-v-fe03c03c"]]),bt={class:"graph-state-chart"},Dt={class:"chart-header"},Et={class:"chart-type-selector"},Tt=["onClick","title"],_t={class:"chart-type-icon"},$t={class:"chart-type-label"},At={key:0,class:"comparison-type-selector"},Ct={class:"radio-group"},It={key:0},Rt={key:1},xt={key:2,class:"graph-legend"},Mt={key:4,class:"error-container"},Ot={class:"error-message"},Bt={key:5,class:"chart-container"},Nt={key:6,class:"no-data"},Ft={key:7,class:"employees-details"},Pt={class:"employees-details-content"},Ut={class:"stage-details-header"},Lt={class:"stage-details-name"},Wt={class:"stage-details-count"},jt={class:"stage-details-employees"},Vt={class:"employee-detail-name"},zt={class:"employee-detail-count"},Ht={key:0,class:"no-employees-in-stage"},Kt={__name:"GraphStateChart",props:{period:{type:Object,default:null},showCurrentState:{type:Boolean,default:!0}},emits:["data-loaded","error"],setup(d,{emit:e}){const t=($,u)=>typeof window>"u"?u:getComputedStyle(document.documentElement).getPropertyValue($).trim()||u,s=d,r=e,a=A(!1),n=A(null),c=A(null),o=A({weekStart:null,weekEnd:null,current:null}),l=A(null),f=A("weekStartToWeekEnd"),w=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],p=A("line"),D=A(!0),S=A([]),y=F(()=>{switch(p.value){case"line":return qe;case"bar":return lt;case"doughnut":return rt;default:return qe}}),g={formed:t("--b24-primary","#007bff"),review:t("--b24-warning","#ffc107"),execution:t("--b24-success","#28a745")},m=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:g.formed},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:g.review},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:g.execution}],T=A({formed:!0,review:!0,execution:!0});function P($){var v;const u=o.value.current||o.value.weekEnd||o.value.weekStart;return!u||!u.statistics||!u.statistics.stages?0:((v=u.statistics.stages[$])==null?void 0:v.count)||0}function z($){const u=o.value.current||o.value.weekEnd||o.value.weekStart;if(!u||!u.statistics)return[];const v=[];u.statistics.employees&&Array.isArray(u.statistics.employees)&&u.statistics.employees.filter(h=>h.ticketsByStage&&h.ticketsByStage[$]>0).forEach(h=>{v.push({id:h.id,name:h.name,count:h.ticketsByStage[$]||0})});const b=H($);return b>0&&v.push({id:1051,name:"–•—Ä–∞–Ω–∏—Ç–µ–ª—å –æ–±—ä–µ–∫—Ç–æ–≤ (–ù–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω–æ–µ)",count:b,isKeeper:!0}),v.sort((h,_)=>_.count-h.count)}function H($){const u=o.value.current||o.value.weekEnd||o.value.weekStart;if(!u||!u.statistics)return 0;if(u.statistics.zeroPointByStage&&u.statistics.zeroPointByStage[$])return u.statistics.zeroPointByStage[$].keeper||0;if(u.statistics.zeroPoint){const v=u.statistics.zeroPoint.keeper||0;return Math.floor(v/3)}return 0}const R=Ee();function C(){const $=new Map;[o.value.weekStart,o.value.weekEnd,o.value.current].forEach(u=>{!u||!u.statistics||!u.statistics.employees||u.statistics.employees.forEach(v=>{$.has(v.id)||$.set(v.id,{id:v.id,name:v.name})})}),S.value=Array.from($.values()).sort((u,v)=>u.name.localeCompare(v.name))}function M($,u="background"){var b;return((b={increase:{background:t("--b24-success","#28a745"),border:t("--b24-success-hover","#218838"),point:t("--b24-success","#28a745")},decrease:{background:t("--b24-danger","#dc3545"),border:t("--b24-danger-hover","#c82333"),point:t("--b24-danger","#dc3545")},stable:{background:t("--b24-text-muted","#9ca3af"),border:t("--b24-text-secondary","#6b7280"),point:t("--b24-text-muted","#9ca3af")}}[$])==null?void 0:b[u])||t("--b24-text-secondary","#6c757d")}function K(){if(!(!o.value.weekStart||!o.value.weekEnd))try{const $=Oe.compareTwoSnapshots(o.value.weekStart,o.value.weekEnd,{includeTickets:!1,includeEmployees:!0});let u=null,v=null;o.value.current&&(u=Oe.compareTwoSnapshots(o.value.weekEnd,o.value.current,{includeTickets:!1,includeEmployees:!0}),v=Oe.compareTwoSnapshots(o.value.weekStart,o.value.current,{includeTickets:!1,includeEmployees:!0})),l.value={weekStartToWeekEnd:$,weekEndToCurrent:u,weekStartToCurrent:v}}catch($){console.error("–û—à–∏–±–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–ª–µ–ø–∫–æ–≤:",$),R.warning("–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–ª–µ–ø–∫–æ–≤: "+$.message)}}function J($){return{"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ":"formed","–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó":"review",–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ:"execution"}[$]||"formed"}const Z=F(()=>{if(!c.value)return null;if(p.value==="doughnut")return c.value;const $=c.value.datasets.filter(u=>{const v=m.find(b=>b.name===u.label);return v?T.value[v.id]:!0});return{...c.value,datasets:$}}),$e=F(()=>{const $={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:p.value==="doughnut"?"right":"top",onClick:(u,v,b)=>{const h=v.datasetIndex;if(h!==void 0){const _=b.chart.getDatasetMeta(h);_.hidden=!_.hidden,b.chart.update()}}},tooltip:{enabled:!0,mode:"index",intersect:!1,callbacks:{title:u=>u[0].label||"",label:u=>{var _,x,L,I,W,O;const v=u.dataset.label||"",b=u.parsed.y||u.parsed||0,h=u.dataIndex;if(p.value==="doughnut"){const B=u.dataset.data.reduce((G,re)=>G+re,0),q=B>0?(b/B*100).toFixed(1):0;return`${v}: ${b} (${q}%)`}else{if(!l.value||h===0||p.value==="doughnut")return`${v}: ${b}`;let B=null;const q=J(v);if(f.value==="weekStartToWeekEnd"&&h===1?B=(x=(_=l.value.weekStartToWeekEnd)==null?void 0:_.stages)==null?void 0:x[q]:f.value==="weekEndToCurrent"&&h===2&&o.current?B=(I=(L=l.value.weekEndToCurrent)==null?void 0:L.stages)==null?void 0:I[q]:f.value==="weekStartToCurrent"&&h===2&&o.current&&(B=(O=(W=l.value.weekStartToCurrent)==null?void 0:W.stages)==null?void 0:O[q]),!B)return`${v}: ${b}`;const G=B.delta,re=B.deltaPercent,pe=B.trend;let le=`${v}: ${b}`;if(G!==0){const fe=G>0?"+":"",we=pe==="increase"?"‚Üë":pe==="decrease"?"‚Üì":"‚Üí";le+=` (${fe}${G}, ${fe}${re.toFixed(1)}%) ${we}`}else le+=" (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)";return le}},afterBody:u=>{if(p.value==="doughnut"||!l.value)return[];const v=u[0].dataIndex;if(v===0)return[];let b=null;if(J(u[0].dataset.label||""),f.value==="weekStartToWeekEnd"&&v===1?b=l.value.weekStartToWeekEnd:f.value==="weekEndToCurrent"&&v===2?b=l.value.weekEndToCurrent:f.value==="weekStartToCurrent"&&v===2&&(b=l.value.weekStartToCurrent),!b||!b.metadata)return[];const h=b.metadata.timeDiff;return[`–ü–µ—Ä–∏–æ–¥: ${h.days} –¥–Ω. ${h.hours} —á. ${h.minutes} –º–∏–Ω.`]}}},title:{display:!1}}};return p.value==="line"||p.value==="bar"?{...$,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}:p.value==="doughnut"?{...$,cutout:"60%"}:$});function ye($){const u=new Date($),v=u.getFullYear(),b=String(u.getMonth()+1).padStart(2,"0"),h=String(u.getDate()).padStart(2,"0");return`${v}-${b}-${h}`}function Ae($){const{current:u,weekEnd:v}=$,b=u||v;if(!b||!b.statistics||!b.statistics.stages)return null;const h=[],_=[],x=[],L=[];return m.forEach(I=>{var O;const W=((O=b.statistics.stages[I.id])==null?void 0:O.count)||0;W>0&&(h.push(I.name),_.push(W),x.push(I.color+"80"),L.push(I.color))}),_.length===0?null:{labels:h,datasets:[{label:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —ç—Ç–∞–ø–∞–º",data:_,backgroundColor:x,borderColor:L,borderWidth:2}]}}function Ce($){if(p.value==="doughnut")return Ae($);const{weekStart:u,weekEnd:v,current:b}=$,h=[],_=[];return m.forEach(x=>{var q,G,re,pe,le,fe,we,Fe,Pe,Ue,Le,We,je,Ve,ze,He,Ke;const L=[];if(u&&u.statistics&&u.statistics.stages){const j=u.statistics.stages[x.id];if(h.length===0){const ge=(q=u.metadata)!=null&&q.createdAt?new Date(u.metadata.createdAt):null;h.push(ge?ye(ge):"–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏")}L.push((j==null?void 0:j.count)||0)}else h.length===0&&h.push("–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏"),L.push(0);if(v&&v.statistics&&v.statistics.stages){const j=v.statistics.stages[x.id];if(h.length===1){const ge=(G=v.metadata)!=null&&G.createdAt?new Date(v.metadata.createdAt):null;h.push(ge?ye(ge):"–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏")}L.push((j==null?void 0:j.count)||0)}else h.length===1&&h.push("–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏"),L.push(0);if(b&&s.showCurrentState&&b.statistics&&b.statistics.stages){const j=b.statistics.stages[x.id];h.length===2&&h.push("–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"),L.push((j==null?void 0:j.count)||0)}const I=["stable"];l.value?f.value==="weekStartToWeekEnd"?(I.push(((le=(pe=(re=l.value.weekStartToWeekEnd)==null?void 0:re.stages)==null?void 0:pe[x.id])==null?void 0:le.trend)||"stable"),b&&I.push(((Fe=(we=(fe=l.value.weekStartToCurrent)==null?void 0:fe.stages)==null?void 0:we[x.id])==null?void 0:Fe.trend)||"stable")):f.value==="weekEndToCurrent"&&b?(I.push("stable"),I.push(((Le=(Ue=(Pe=l.value.weekEndToCurrent)==null?void 0:Pe.stages)==null?void 0:Ue[x.id])==null?void 0:Le.trend)||"stable")):f.value==="weekStartToCurrent"&&b?(I.push(((Ve=(je=(We=l.value.weekStartToWeekEnd)==null?void 0:We.stages)==null?void 0:je[x.id])==null?void 0:Ve.trend)||"stable"),I.push(((Ke=(He=(ze=l.value.weekStartToCurrent)==null?void 0:ze.stages)==null?void 0:He[x.id])==null?void 0:Ke.trend)||"stable")):(I.push("stable"),b&&I.push("stable")):(I.push("stable"),b&&I.push("stable"));let W,O,B;l.value&&p.value!=="doughnut"?(W=I.map(j=>M(j,"background")+"40"),O=I.map(j=>M(j,"border")),B=I.map(j=>M(j,"point"))):(W=x.color+"40",O=x.color,B=x.color),_.push({label:x.name,data:L,backgroundColor:(Array.isArray(W),W),borderColor:(Array.isArray(O),O),borderWidth:2,pointBackgroundColor:(Array.isArray(B),B),pointBorderColor:(Array.isArray(O),O),pointRadius:6,pointHoverRadius:8,fill:p.value!=="line",tension:p.value==="line"?.4:0})}),h.length===0&&(h.push("–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏","–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏"),s.showCurrentState&&h.push("–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ")),{labels:h,datasets:_}}const oe=async()=>{var $,u,v;a.value=!0,n.value=null;try{const b=($=s.period)!=null&&$.endDate?new Date(s.period.endDate):new Date,h=(u=s.period)!=null&&u.startDate?new Date(s.period.startDate):te.getWeekStartDate(b),_=(v=s.period)!=null&&v.endDate?new Date(s.period.endDate):te.getWeekEndDate(b),x=te.formatDate(h),L=te.formatDate(_),[I,W]=await Promise.all([te.getSnapshot(x,"week_start"),te.getSnapshot(L,"week_end")]);let O=null;s.showCurrentState&&(O=await Ne.getSectorDataForSnapshot({useCache:!1,normalize:!0})),o.value={weekStart:I,weekEnd:W,current:O},C(),K(),Y(),r("data-loaded",{weekStart:I,weekEnd:W,current:O})}catch(b){console.error("Error loading chart data:",b),n.value=b.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞",R.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞: "+n.value),r("error",n.value)}finally{a.value=!1}};ue(()=>{oe()});function Ie($){T.value=$}const Y=()=>{c.value=Ce({weekStart:o.value.weekStart,weekEnd:o.value.weekEnd,current:o.value.current})};return ke(()=>[s.period,s.showCurrentState],()=>{oe()},{deep:!0}),ke(p,()=>{(o.value.weekStart||o.value.weekEnd||o.value.current)&&Y()}),ke(f,()=>{(o.value.weekStart||o.value.weekEnd||o.value.current)&&Y()}),($,u)=>(k(),E("div",bt,[i("div",Dt,[u[3]||(u[3]=i("h3",{class:"chart-title"},"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),i("div",Et,[(k(),E(ce,null,de(w,v=>i("button",{key:v.value,onClick:b=>p.value=v.value,class:V(["chart-type-btn",{active:p.value===v.value}]),title:v.label},[i("span",_t,N(v.icon),1),i("span",$t,N(v.label),1)],10,Tt)),64))])]),!a.value&&!n.value&&l.value&&p.value!=="doughnut"?(k(),E("div",At,[u[7]||(u[7]=i("h4",{class:"comparison-title"},"–¢–∏–ø —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:",-1)),i("div",Ct,[i("label",null,[be(i("input",{type:"radio","onUpdate:modelValue":u[0]||(u[0]=v=>f.value=v),value:"weekStartToWeekEnd",onChange:Y},null,544),[[Re,f.value]]),u[4]||(u[4]=i("span",null,"–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ ‚Üí –ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏",-1))]),o.value.current?(k(),E("label",It,[be(i("input",{type:"radio","onUpdate:modelValue":u[1]||(u[1]=v=>f.value=v),value:"weekEndToCurrent",onChange:Y},null,544),[[Re,f.value]]),u[5]||(u[5]=i("span",null,"–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏ ‚Üí –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ",-1))])):U("",!0),o.value.current?(k(),E("label",Rt,[be(i("input",{type:"radio","onUpdate:modelValue":u[2]||(u[2]=v=>f.value=v),value:"weekStartToCurrent",onChange:Y},null,544),[[Re,f.value]]),u[6]||(u[6]=i("span",null,"–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ ‚Üí –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ",-1))])):U("",!0)])])):U("",!0),!a.value&&!n.value&&c.value?(k(),he(kt,{key:1,stages:m,selected:T.value,"onUpdate:selected":Ie,onChange:Y},null,8,["selected"])):U("",!0),!a.value&&!n.value&&l.value&&p.value!=="doughnut"?(k(),E("div",xt,[...u[8]||(u[8]=[Ze('<h4 class="legend-title" data-v-6bedf2b9>–õ–µ–≥–µ–Ω–¥–∞:</h4><div class="legend-items" data-v-6bedf2b9><div class="legend-item" data-v-6bedf2b9><span class="legend-color legend-increase" data-v-6bedf2b9></span><span data-v-6bedf2b9>–ó–µ–ª—ë–Ω—ã–π ‚Äî —Ä–æ—Å—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–µ—Ç–æ–≤</span></div><div class="legend-item" data-v-6bedf2b9><span class="legend-color legend-decrease" data-v-6bedf2b9></span><span data-v-6bedf2b9>–ö—Ä–∞—Å–Ω—ã–π ‚Äî —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–µ—Ç–æ–≤</span></div><div class="legend-item" data-v-6bedf2b9><span class="legend-color legend-stable" data-v-6bedf2b9></span><span data-v-6bedf2b9>–°–µ—Ä—ã–π ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π</span></div></div>',2)])])):U("",!0),a.value?(k(),he(Xe,{key:3,message:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞..."})):n.value?(k(),E("div",Mt,[i("p",Ot,"‚ùå "+N(n.value),1),i("button",{onClick:oe,class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É")])):Z.value?(k(),E("div",Bt,[(k(),he(Qe(y.value),{data:Z.value,options:$e.value,height:300},null,8,["data","options"]))])):(k(),E("div",Nt,[...u[9]||(u[9]=[i("p",null,"üìä –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1),i("p",{class:"no-data-hint"},"–°–æ–∑–¥–∞–π—Ç–µ —Å–ª–µ–ø–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞",-1)])])),!a.value&&!n.value&&c.value&&D.value?(k(),E("div",Ft,[u[10]||(u[10]=i("h4",{class:"employees-details-title"},"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º",-1)),i("div",Pt,[(k(),E(ce,null,de(m,v=>i("div",{key:v.id,class:"stage-details"},[i("div",Ut,[i("span",{class:"stage-details-color",style:ve({backgroundColor:v.color})},null,4),i("h5",Lt,N(v.name),1),i("span",Wt," –í—Å–µ–≥–æ: "+N(P(v.id))+" —Ç–∏–∫–µ—Ç–æ–≤ ",1)]),i("div",jt,[(k(!0),E(ce,null,de(z(v.id),b=>(k(),E("div",{key:`${v.id}-${b.id}`,class:V(["employee-detail-item",{"employee-detail-keeper":b.isKeeper}])},[i("span",Vt,N(b.name),1),i("span",zt,N(b.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)],2))),128)),z(v.id).length===0?(k(),E("div",Ht," –ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ ")):U("",!0)])])),64))])])):U("",!0)]))}},qt=ne(Kt,[["__scopeId","data-v-6bedf2b9"]]),Gt={key:0,class:"create-snapshot-button-container"},Yt=["disabled"],Xt={class:"modal-content"},Jt={class:"modal-header"},Zt=["disabled"],Qt={class:"modal-body"},ea={key:0,class:"progress-container"},ta={class:"progress-bar-wrapper"},aa={class:"progress-text"},sa={class:"progress-percent"},na={class:"progress-description"},oa={key:1},ra={class:"modal-footer"},la=["disabled"],ia=["disabled"],ca={key:0},da={key:0},ua={key:1},pa={key:2},fa={key:1},ga={__name:"CreateSnapshotButton",props:{user:{type:Object,default:null}},emits:["snapshot-created"],setup(d,{emit:e}){const t=d,s=e,r=A(t.user),a=A(!1),n=A(!1),c=A(0),o=A("idle"),l=A(""),f=Ee(),w=F(()=>r.value?tt(r.value):!1);ue(async()=>{if(!t.user)try{const g=await Je.checkAccess();g.allowed&&(r.value=g.user)}catch(g){console.error("Error loading user:",g)}});const p=()=>{if(!w.value){f.warning("–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–µ–ø–∫–∏");return}a.value=!0},D=()=>{n.value||(a.value=!1,o.value="idle",c.value=0,l.value="")},S=async()=>{if(!n.value){if(!w.value){f.warning("–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–µ–ø–∫–∏");return}n.value=!0,o.value="loading_data",c.value=0,l.value="–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...";try{l.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞ –∏–∑ Bitrix24...";const g=await Ne.getSectorDataForSnapshot({useCache:!0,normalize:!0,onProgress:P=>{var H;const z=Math.min(80,(P.progress||0)*.8);c.value=z,o.value="loading_data",l.value=P.description||((H=P.details)==null?void 0:H.description)||"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞..."}});o.value="creating_snapshot",c.value=85,l.value="–°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–µ–ø–∫–∞...";const m=r.value;if(!m)throw new Error("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω");const T=await te.createSnapshot(g,"manual",{createdBy:{id:m.ID,name:`${m.NAME||""} ${m.LAST_NAME||""}`.trim()||m.EMAIL||`User ${m.ID}`},sectorId:"1C"});o.value="success",c.value=100,l.value="–°–ª–µ–ø–æ–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",f.success("–°–ª–µ–ø–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"),s("snapshot-created",T),setTimeout(()=>{D()},1500)}catch(g){o.value="error",c.value=0,l.value="–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞",console.error("Error creating snapshot:",g);let m="–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞";g.message&&(g.message.includes("–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö")||g.message.includes("sector data")?m="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Bitrix24.":g.message.includes("—Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞")||g.message.includes("snapshot")?m="–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.":g.message.includes("–≤–∞–ª–∏–¥–∞—Ü")||g.message.includes("validation")?m="–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞.":m=g.message),f.error(m)}finally{n.value=!1}}},y=g=>{g.key==="Escape"&&a.value&&!n.value&&D()};return ue(()=>{window.addEventListener("keydown",y)}),Te(()=>{window.removeEventListener("keydown",y)}),(g,m)=>w.value?(k(),E("div",Gt,[i("button",{class:"create-snapshot-btn",onClick:p,disabled:n.value,title:"–°–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞"},[...m[1]||(m[1]=[i("span",{class:"btn-icon"},"üì∏",-1),i("span",{class:"btn-text"},"–°–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫",-1)])],8,Yt),(k(),he(et,{to:"body"},[X(Be,{name:"modal"},{default:_e(()=>[a.value?(k(),E("div",{key:0,class:"modal-overlay",onClick:m[0]||(m[0]=se(T=>!n.value&&D(),["self"]))},[i("div",Xt,[i("div",Jt,[m[2]||(m[2]=i("h3",{class:"modal-title"},"–°–æ–∑–¥–∞—Ç—å —Å–ª–µ–ø–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞",-1)),i("button",{class:"modal-close",onClick:D,disabled:n.value,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ",8,Zt)]),i("div",Qt,[o.value!=="idle"?(k(),E("div",ea,[i("div",ta,[i("div",{class:"progress-bar",style:ve({width:`${c.value}%`})},null,4)]),i("div",aa,[i("span",sa,N(Math.round(c.value))+"%",1),i("span",na,N(l.value),1)])])):(k(),E("div",oa,[...m[3]||(m[3]=[i("p",{class:"modal-description"},' –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Å–ª–µ–ø–æ–∫ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°. –°–ª–µ–ø–æ–∫ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω —Å —Ç–∏–ø–æ–º "manual" (—Ä—É—á–Ω–æ–π). ',-1),i("p",{class:"modal-warning"}," ‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è. ",-1)])]))]),i("div",ra,[i("button",{class:"btn btn-secondary",onClick:D,disabled:n.value}," –û—Ç–º–µ–Ω–∞ ",8,la),i("button",{class:"btn btn-primary",onClick:S,disabled:n.value},[n.value?(k(),E("span",ca,[o.value==="loading_data"?(k(),E("span",da,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...")):o.value==="creating_snapshot"?(k(),E("span",ua,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(k(),E("span",pa,"–û–±—Ä–∞–±–æ—Ç–∫–∞..."))])):(k(),E("span",fa,"–°–æ–∑–¥–∞—Ç—å"))],8,ia)])])])):U("",!0)]),_:1})]))])):U("",!0)}},ha=ne(ga,[["__scopeId","data-v-09bccee2"]]),ma=20,va=5*60*1e3;async function ya({search:d="",limit:e=ma,sectorDepartmentId:t=Ye.SECTOR_1C}={}){const s=`sector1c_employees_${d}_${e}_${t||"all"}`,r=sessionStorage.getItem(s);if(r)try{const{data:a,timestamp:n}=JSON.parse(r);if(Date.now()-n<va)return a}catch(a){console.warn("[sector1cEmployees] Cache parse error:",a)}try{const a={ACTIVE:"Y"};t?Array.isArray(t)?a.UF_DEPARTMENT=t:a.UF_DEPARTMENT=[t]:a.UF_DEPARTMENT=[Ye.SECTOR_1C],d&&d.length>=2&&(a["%NAME"]=d,a["%LAST_NAME"]=d,a["%WORK_POSITION"]=d);const o=((await ct.call("user.get",{filter:a,select:["ID","NAME","LAST_NAME","SECOND_NAME","WORK_POSITION","UF_DEPARTMENT"],order:{LAST_NAME:"ASC",NAME:"ASC"},start:0})).result||[]).slice(0,e).map(l=>({id:parseInt(l.ID),name:wa(l),position:l.WORK_POSITION||"",department:l.UF_DEPARTMENT||null}));try{sessionStorage.setItem(s,JSON.stringify({data:o,timestamp:Date.now()}))}catch(l){console.warn("[sector1cEmployees] Cache write error:",l)}return o}catch(a){throw console.error("[sector1cEmployees] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",a),new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${a.message}`)}}function wa(d){const e=[d.LAST_NAME,d.NAME,d.SECOND_NAME].filter(Boolean);return e.length>0?e.join(" "):d.NAME||"–ë–µ–∑ –∏–º–µ–Ω–∏"}const Sa={class:"employee-select-field-text"},ka={key:0,class:"employee-select-dropdown"},ba={class:"employee-select-dropdown-search"},Da={key:0,class:"employee-select-state"},Ea={key:1,class:"employee-select-state employee-select-state--error"},Ta={key:2,class:"employee-select-state"},_a=["checked"],$a=["checked","onChange"],Aa={class:"employee-select-item-content"},Ca={class:"employee-select-item-name"},Ia={key:0,class:"employee-select-item-position"},Ra={__name:"EmployeeSelect",props:{selected:{type:Array,default:()=>["all"]},multiple:{type:Boolean,default:!0},placeholder:{type:String,default:"–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°"},maxHeight:{type:Number,default:300}},emits:["update:selected","search","error"],setup(d,{emit:e}){const t=d,s=e,r=A(null),a=A(null),n=A(""),c=A([]),o=A(!1),l=A(null),f=A(!1),w=F(()=>{if(!n.value)return c.value;const R=n.value.toLowerCase();return c.value.filter(C=>C.name.toLowerCase().includes(R)||C.position&&C.position.toLowerCase().includes(R))}),p=F(()=>{if(t.selected.includes("all")||t.selected.length===0)return t.placeholder;if(t.selected.length===1){const R=c.value.find(C=>C.id===t.selected[0]);return R?R.name:t.placeholder}return`–í—ã–±—Ä–∞–Ω–æ: ${t.selected.length} ${z(t.selected.length,"—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞","—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤","—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤")}`});async function D(R=""){o.value=!0,l.value=null;try{c.value=await ya({search:R})}catch(C){l.value=C,s("error",C)}finally{o.value=!1}}function S(){s("search",n.value)}function y(){o.value||(f.value=!f.value,f.value?(c.value.length===0&&D(),st(()=>{a.value&&a.value.focus()})):n.value="")}function g(R){r.value&&!r.value.contains(R.target)&&(f.value=!1,n.value="")}function m(R){const C=[...t.selected],M=C.indexOf(R);if(R==="all")if(M>-1)C.splice(M,1);else return s("update:selected",["all"]);else if(M>-1)C.splice(M,1);else{const K=C.indexOf("all");K>-1&&C.splice(K,1),C.push(R)}s("update:selected",C)}function T(R){return R==="all"?t.selected.includes("all"):t.selected.includes(R)||t.selected.includes("all")}const P=F(()=>n.value?`–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É "${n.value}"`:"–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°");function z(R,C,M,K){const J=R%10,Z=R%100;return Z>=11&&Z<=19?K:J===1?C:J>=2&&J<=4?M:K}function H(){D(n.value)}return ke(()=>t.selected,R=>{(!R||R.length===0)&&s("update:selected",["all"])},{immediate:!0}),ue(()=>{document.addEventListener("click",g),(!t.selected||t.selected.length===0)&&s("update:selected",["all"])}),Te(()=>{document.removeEventListener("click",g)}),(R,C)=>(k(),E("div",{class:"employee-select",ref_key:"selectContainer",ref:r},[i("div",{class:V(["employee-select-field",{"employee-select-field--open":f.value,"employee-select-field--disabled":o.value}]),onClick:y},[i("span",Sa,N(p.value),1),i("span",{class:V(["employee-select-field-icon",{open:f.value}])},"‚ñº",2)],2),X(Be,{name:"dropdown-fade"},{default:_e(()=>[f.value?(k(),E("div",ka,[i("div",ba,[be(i("input",{"onUpdate:modelValue":C[0]||(C[0]=M=>n.value=M),type:"text",placeholder:"üîç –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...",class:"employee-select-search-input",onInput:S,onClick:C[1]||(C[1]=se(()=>{},["stop"])),ref_key:"searchInput",ref:a},null,544),[[at,n.value]])]),o.value?(k(),E("div",Da,[...C[6]||(C[6]=[i("span",{class:"spinner"},"‚è≥",-1),i("span",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°...",-1)])])):l.value?(k(),E("div",Ea,[i("span",null,"‚ùå "+N(l.value.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤"),1),i("button",{onClick:[H,C[2]||(C[2]=se(()=>{},["stop"]))],class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):!o.value&&w.value.length===0&&!l.value?(k(),E("div",Ta,[i("span",null,"üì≠ "+N(P.value),1)])):(k(),E("div",{key:3,class:"employee-select-list",style:ve({maxHeight:`${d.maxHeight}px`})},[i("label",{class:V(["employee-select-item",{"employee-select-item--selected":T("all")}]),onClick:C[4]||(C[4]=se(()=>{},["stop"]))},[i("input",{type:"checkbox",checked:T("all"),onChange:C[3]||(C[3]=M=>m("all"))},null,40,_a),C[7]||(C[7]=i("div",{class:"employee-select-item-content"},[i("span",{class:"employee-select-item-name"},"–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏")],-1))],2),(k(!0),E(ce,null,de(w.value,M=>(k(),E("label",{key:M.id,class:V(["employee-select-item",{"employee-select-item--selected":T(M.id)}]),onClick:C[5]||(C[5]=se(()=>{},["stop"]))},[i("input",{type:"checkbox",checked:T(M.id),onChange:K=>m(M.id)},null,40,$a),i("div",Aa,[i("span",Ca,N(M.name),1),M.position?(k(),E("span",Ia,N(M.position),1)):U("",!0)])],2))),128))],4))])):U("",!0)]),_:1})],512))}},xa=ne(Ra,[["__scopeId","data-v-6b8c949b"]]),Ma={class:"stage-select-field-text"},Oa={key:0,class:"stage-select-dropdown"},Ba={class:"stage-select-list"},Na=["checked"],Fa=["checked","onChange"],Pa={class:"stage-select-item-content"},Ua={class:"stage-select-item-name"},La={__name:"StageSelect",props:{selected:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},stages:{type:Array,required:!0,default:()=>[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff"},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107"},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745"}]},placeholder:{type:String,default:"–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø—ã"}},emits:["update:selected","change"],setup(d,{emit:e}){const t=d,s=e,r=A(null),a=A(!1),n=F(()=>Object.values(t.selected).every(p=>p===!0)),c=F(()=>{if(n.value)return t.placeholder;const p=t.stages.filter(D=>t.selected[D.id]);return p.length===0?"–≠—Ç–∞–ø—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã":p.length===1?p[0].name:`–í—ã–±—Ä–∞–Ω–æ: ${p.length} —ç—Ç–∞–ø–∞(–æ–≤)`});function o(){a.value=!a.value,a.value}function l(p){r.value&&!r.value.contains(p.target)&&(a.value=!1)}function f(p,D){const S={...t.selected};S[p]=D,s("update:selected",S),s("change",p,D)}function w(){const p=n.value,D={};t.stages.forEach(S=>{D[S.id]=!p}),s("update:selected",D),s("change","all",!p)}return ue(()=>{document.addEventListener("click",l)}),Te(()=>{document.removeEventListener("click",l)}),(p,D)=>(k(),E("div",{class:"stage-select",ref_key:"selectContainer",ref:r},[i("div",{class:V(["stage-select-field",{"stage-select-field--open":a.value,"stage-select-field--disabled":!1}]),onClick:o},[i("span",Ma,N(c.value),1),i("span",{class:V(["stage-select-field-icon",{open:a.value}])},"‚ñº",2)],2),X(Be,{name:"dropdown-fade"},{default:_e(()=>[a.value?(k(),E("div",Oa,[i("div",Ba,[i("label",{class:V(["stage-select-item",{"stage-select-item--selected":n.value}]),onClick:D[0]||(D[0]=se(()=>{},["stop"]))},[i("input",{type:"checkbox",checked:n.value,onChange:w},null,40,Na),D[2]||(D[2]=i("div",{class:"stage-select-item-content"},[i("span",{class:"stage-select-item-name"},"–í—Å–µ —ç—Ç–∞–ø—ã")],-1))],2),(k(!0),E(ce,null,de(d.stages,S=>(k(),E("label",{key:S.id,class:V(["stage-select-item",{"stage-select-item--selected":d.selected[S.id]}]),onClick:D[1]||(D[1]=se(()=>{},["stop"]))},[i("input",{type:"checkbox",checked:d.selected[S.id],onChange:y=>f(S.id,y.target.checked)},null,40,Fa),i("div",Pa,[i("span",{class:"stage-select-item-color",style:ve({backgroundColor:S.color})},null,4),i("span",Ua,N(S.name),1)])],2))),128))])])):U("",!0)]),_:1})],512))}},Wa=ne(La,[["__scopeId","data-v-ce2229b2"]]),ja={class:"filters-panel"},Va={class:"filters-header"},za=["disabled"],Ha={class:"filters-content"},Ka={class:"filter-section"},qa={class:"section-content"},Ga={class:"filter-section"},Ya={class:"section-content"},Xa={class:"filter-section"},Ja={class:"section-content"},Za=["value"],Qa={key:0,class:"custom-date-range"},es={class:"date-range-inputs"},ts={class:"date-input-group"},as=["value","max"],ss={class:"date-input-group"},ns=["value","min","max"],os={key:0,class:"filter-error"},rs={key:1,class:"filter-hint"},ls={__name:"FiltersPanel",props:{stages:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},employees:{type:Array,default:()=>["all"]},dateRange:{type:String,default:"last-week"},customDateRange:{type:Object,default:()=>({startDate:null,endDate:null})},hasActiveFilters:{type:Boolean,default:!1}},emits:["update:stages","update:employees","update:dateRange","update:customDateRange","reset","apply"],setup(d,{emit:e}){const t=d,s=e,r=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"var(--b24-primary, #007bff)"},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"var(--b24-warning, #ffc107)"},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"var(--b24-success, #28a745)"}],a=A(null),n=F(()=>{const S=new Date;return S.setFullYear(S.getFullYear()-1),S.toISOString().split("T")[0]}),c=F(()=>new Date().toISOString().split("T")[0]);function o(S){s("update:stages",S),s("apply")}function l(S,y){s("apply")}function f(S){s("update:employees",S),s("apply")}function w(S){s("update:dateRange",S),a.value=null,s("apply")}function p(S,y){const g={...t.customDateRange};if(g[S]=y,g.startDate&&g.endDate){const m=new Date(g.startDate),T=new Date(g.endDate);if(m>T){a.value="–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω–µ—á–Ω–æ–π";return}if(Math.ceil((T-m)/(1e3*60*60*24))>365){a.value="–ü–µ—Ä–∏–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 365 –¥–Ω–µ–π";return}}a.value=null,s("update:customDateRange",g),s("apply")}function D(){a.value=null,s("reset")}return(S,y)=>(k(),E("div",ja,[i("div",Va,[y[3]||(y[3]=i("h2",null,"–§–∏–ª—å—Ç—Ä—ã",-1)),i("button",{onClick:D,class:"btn-reset-filters",disabled:!d.hasActiveFilters}," –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã ",8,za)]),i("div",Ha,[i("div",Ka,[y[4]||(y[4]=i("h3",{class:"section-title"},[i("span",{class:"section-icon"},"üìä"),De(" –≠—Ç–∞–ø—ã ")],-1)),i("div",qa,[X(Wa,{selected:d.stages,stages:r,placeholder:"–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø—ã","onUpdate:selected":o,onChange:l},null,8,["selected"])])]),i("div",Ga,[y[5]||(y[5]=i("h3",{class:"section-title"},[i("span",{class:"section-icon"},"üë•"),De(" –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ")],-1)),i("div",Ya,[X(xa,{selected:d.employees,"onUpdate:selected":f},null,8,["selected"])])]),i("div",Xa,[y[9]||(y[9]=i("h3",{class:"section-title"},[i("span",{class:"section-icon"},"üìÖ"),De(" –ü–µ—Ä–∏–æ–¥ ")],-1)),i("div",Ja,[i("select",{value:d.dateRange,onChange:y[0]||(y[0]=g=>w(g.target.value)),class:"date-range-select"},[...y[6]||(y[6]=[i("option",{value:"last-week"},"–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–¥–µ–ª—è",-1),i("option",{value:"last-2-weeks"},"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏",-1),i("option",{value:"last-month"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü",-1),i("option",{value:"custom"},"–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])],40,Za),d.dateRange==="custom"?(k(),E("div",Qa,[i("div",es,[i("div",ts,[y[7]||(y[7]=i("label",null,"–°:",-1)),i("input",{type:"date",value:d.customDateRange.startDate,onChange:y[1]||(y[1]=g=>p("startDate",g.target.value)),max:d.customDateRange.endDate||c.value,class:"date-input"},null,40,as)]),i("div",ss,[y[8]||(y[8]=i("label",null,"–ü–æ:",-1)),i("input",{type:"date",value:d.customDateRange.endDate,onChange:y[2]||(y[2]=g=>p("endDate",g.target.value)),min:d.customDateRange.startDate||n.value,max:c.value,class:"date-input"},null,40,ns)])]),a.value?(k(),E("small",os,N(a.value),1)):(k(),E("small",rs," –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –∏ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö "))])):U("",!0)])])])]))}},is=ne(ls,[["__scopeId","data-v-4b7456a2"]]);function cs(){const d=A(!1),e=A(null),t=A(null),s=A(0),r=Ee(),a=async(g=!0,m=null)=>{d.value=!0,e.value=null,s.value=0;try{const T=await Ne.getSectorDataForSnapshot({useCache:g,onProgress:P=>{P&&typeof P.progress=="number"&&(s.value=P.progress),m&&m(P)},normalize:!0});return t.value=T,T}catch(T){throw e.value=T.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞",r.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞: "+e.value),T}finally{d.value=!1,s.value=100}},n=async(g,m={})=>{if(!t.value){const T="–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ loadSectorDataForSnapshot()";throw e.value=T,r.error(T),new Error(T)}d.value=!0,e.value=null;try{if(!["week_start","week_end","manual","current"].includes(g))throw new Error(`–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø —Å–ª–µ–ø–∫–∞: ${g}. –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: week_start, week_end, manual, current`);const T=await te.createSnapshot(t.value,g,m);return r.success("–°–ª–µ–ø–æ–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"),T}catch(T){throw e.value=T.message||"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞",r.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–µ–ø–∫–∞: "+e.value),T}finally{d.value=!1}},c=()=>{d.value=!1,e.value=null,t.value=null,s.value=0},o=F(()=>t.value!==null&&t.value!==void 0),l=A({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),f=F(()=>{const g=new Date;let m,T;switch(l.value.dateRange){case"last-week":m=new Date(g),m.setDate(g.getDate()-7),T=g;break;case"last-2-weeks":m=new Date(g),m.setDate(g.getDate()-14),T=g;break;case"last-month":m=new Date(g),m.setMonth(g.getMonth()-1),T=g;break;case"custom":m=l.value.customDateRange.startDate?new Date(l.value.customDateRange.startDate):null,T=l.value.customDateRange.endDate?new Date(l.value.customDateRange.endDate):null;break;default:m=new Date(g),m.setDate(g.getDate()-7),T=g}return{startDate:m?m.toISOString().split("T")[0]:null,endDate:T?T.toISOString().split("T")[0]:null}}),w=()=>{D()},p=()=>{l.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},D()},D=()=>{try{localStorage.setItem("graphStateFilters",JSON.stringify(l.value))}catch(g){console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ localStorage:",g)}},S=()=>{try{const g=localStorage.getItem("graphStateFilters");if(g){const m=JSON.parse(g);m&&typeof m=="object"&&(l.value={stages:m.stages||{formed:!0,review:!0,execution:!0},employees:m.employees||["all"],dateRange:m.dateRange||"last-week",customDateRange:m.customDateRange||{startDate:null,endDate:null}})}}catch(g){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ localStorage:",g)}},y=F(()=>{const g=Object.values(l.value.stages).some(P=>!P),m=!l.value.employees.includes("all"),T=l.value.dateRange!=="last-week";return g||m||T});return{isLoading:d,error:e,currentSectorData:t,loadingProgress:s,hasSectorData:o,filters:l,selectedPeriod:f,hasActiveFilters:y,loadSectorDataForSnapshot:a,createSnapshot:n,resetState:c,applyFilters:w,resetFilters:p,saveFiltersToLocalStorage:D,loadFiltersFromLocalStorage:S}}const ds={class:"graph-state-dashboard"},us={key:1,class:"error-message-container"},ps={class:"error-message"},fs={class:"error-text"},gs={key:0,class:"error-details"},hs={class:"dashboard-header"},ms={class:"header-content"},vs={class:"breadcrumbs-row"},ys=["aria-disabled","data-fallback","disabled"],ws={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Ss={class:"header-actions"},ks=["disabled"],bs={key:0},Ds={key:1},Es={key:3,class:"dashboard-content"},Ts={class:"chart-container"},_s="–ù–∞–∑–∞–¥",$s={__name:"GraphStateDashboard",setup(d){const e=(h,_)=>typeof window>"u"?_:getComputedStyle(document.documentElement).getPropertyValue(h).trim()||_,t=Ee(),s=nt(),r={name:"dashboard-sector-1c"},{filters:a,selectedPeriod:n,hasActiveFilters:c,applyFilters:o,resetFilters:l,loadFiltersFromLocalStorage:f}=cs(),w=A(null),p=A(!0),D=A(!1),S=A("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."),y=A(null),g=A(!1),m=A(!1),T=A(typeof window<"u"?window.innerWidth:1024),P=A(null),z=A(!1),H=F(()=>T.value<768);F(()=>T.value>=768&&T.value<1024),F(()=>T.value>=1024);const R=F(()=>typeof window>"u"?!1:window.history.length>1);F(()=>{const h=new Date;return h.setFullYear(h.getFullYear()-1),h.toISOString().split("T")[0]}),F(()=>new Date().toISOString().split("T")[0]);function C(h){a.value.stages=h}function M(h){a.value.employees=h}function K(h){a.value.dateRange=h}function J(h){a.value.customDateRange=h}function Z(){o()}function $e(){l(),P.value=null,Z(),t.info("–§–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã")}function ye(h){t.success("–°–ª–µ–ø–æ–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω")}function Ae(h){D.value=!1,S.value="",console.log("–î–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:",h)}function Ce(h){D.value=!1,oe({message:h||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞",details:null,type:"error"})}function oe(h){y.value={message:h.message||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞",details:h.details||null,type:h.type||"error",timestamp:new Date},console.error("Dashboard error:",y.value),t.error(y.value.message)}function Ie(){y.value=null}function Y(){y.value=null,D.value=!0,S.value="–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."}async function $(){if(typeof window>"u"||!window.jsPDF||!window.html2canvas){t.warning("–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ jspdf –∏ html2canvas."),console.warn("–î–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: npm install jspdf html2canvas");return}g.value=!0;try{const h=document.querySelector(".chart-container");if(!h)throw new Error("–ì—Ä–∞—Ñ–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω");const _=window.html2canvas,x=await _(h,{scale:2,useCORS:!0,logging:!1,backgroundColor:e("--b24-bg-white","#ffffff")}),L=window.jsPDF,I=new L("landscape","mm","a4"),W=297,O=x.height*W/x.width;I.setFontSize(18),I.text("–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",148.5,15,{align:"center"});const B=new Date().toLocaleDateString("ru-RU");I.setFontSize(10);const q=n.value.startDate&&n.value.endDate?`–ü–µ—Ä–∏–æ–¥: ${n.value.startDate} - ${n.value.endDate}`:"–ü–µ—Ä–∏–æ–¥: –Ω–µ —É–∫–∞–∑–∞–Ω";I.text(q,148.5,25,{align:"center"}),I.text(`–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç ${B}`,148.5,30,{align:"center"}),I.addImage(x.toDataURL("image/png"),"PNG",10,35,W-20,O-20),I.setProperties({title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",subject:`–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç ${B}`,author:"Bitrix24 Dashboard"});const G=`graph-state-${B.replace(/\//g,"-")}.pdf`;I.save(G),t.success("–ì—Ä–∞—Ñ–∏–∫ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ PDF")}catch(h){console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF:",h),oe({message:"–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF: "+(h.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"),details:h.stack,type:"error"})}finally{g.value=!1}}function u(h){var _;if((_=h==null?void 0:h.preventDefault)==null||_.call(h),!z.value){z.value=!0;try{if(R.value){s.back();return}console.warn("GraphStateDashboard: fallback navigation to dashboard-sector-1c"),s.push(r)}finally{z.value=!1}}}function v(){typeof window<"u"&&(T.value=window.innerWidth)}async function b(){try{const h=await Je.checkAccess();h.allowed&&(w.value=h.user)}catch(h){console.error("Error loading user:",h)}}return ue(()=>{f(),b(),typeof window<"u"&&(T.value=window.innerWidth,window.addEventListener("resize",v))}),Te(()=>{typeof window<"u"&&window.removeEventListener("resize",v)}),(h,_)=>{const x=ot("router-link");return k(),E("div",ds,[D.value?(k(),he(Xe,{key:0,message:S.value},null,8,["message"])):U("",!0),y.value?(k(),E("div",us,[i("div",ps,[i("div",{class:"error-header"},[_[1]||(_[1]=i("span",{class:"error-icon"},"‚ùå",-1)),_[2]||(_[2]=i("h3",null,"–û—à–∏–±–∫–∞",-1)),i("button",{onClick:Ie,class:"error-close","aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"‚úï")]),i("p",fs,N(y.value.message),1),y.value.details?(k(),E("div",gs,[i("details",null,[_[3]||(_[3]=i("summary",null,"–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏",-1)),i("pre",null,N(y.value.details),1)])])):U("",!0),i("div",{class:"error-actions"},[i("button",{onClick:Y,class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])])])):U("",!0),i("div",hs,[i("div",ms,[i("div",vs,[i("button",{class:"btn-back-link",type:"button",onClick:u,"aria-label":_s,"aria-disabled":!R.value,"data-fallback":!R.value,disabled:z.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,ys),i("nav",ws,[X(x,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:_e(()=>[..._[4]||(_[4]=[De(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),_[5]||(_[5]=i("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),_[6]||(_[6]=i("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",-1))])]),_[7]||(_[7]=i("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),_[8]||(_[8]=i("p",{class:"dashboard-subtitle"}," –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏ ",-1))]),i("div",Ss,[i("button",{onClick:$,class:"btn-export-pdf",disabled:g.value||D.value,title:"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –≤ PDF"},[g.value?(k(),E("span",Ds,"‚è≥ –≠–∫—Å–ø–æ—Ä—Ç...")):(k(),E("span",bs,"üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF"))],8,ks),X(ha,{user:w.value,onSnapshotCreated:ye},null,8,["user"])])]),H.value?(k(),E("button",{key:2,class:"mobile-filters-toggle",onClick:_[0]||(_[0]=L=>m.value=!m.value)},[_[9]||(_[9]=i("span",null,"–§–∏–ª—å—Ç—Ä—ã",-1)),i("span",{class:V(["toggle-icon",{open:m.value}])},"‚ñº",2)])):U("",!0),i("div",{class:V({"mobile-open":m.value&&H.value,"mobile-closed":!m.value&&H.value})},[X(is,{stages:ie(a).stages,employees:ie(a).employees,dateRange:ie(a).dateRange,customDateRange:ie(a).customDateRange,hasActiveFilters:ie(c),"onUpdate:stages":C,"onUpdate:employees":M,"onUpdate:dateRange":K,"onUpdate:customDateRange":J,onReset:$e,onApply:Z},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])],2),!D.value&&!y.value?(k(),E("div",Es,[i("div",Ts,[X(qt,{period:ie(n),"show-current-state":p.value,onDataLoaded:Ae,onError:Ce},null,8,["period","show-current-state"])])])):U("",!0)])}}},Rs=ne($s,[["__scopeId","data-v-e995acfd"]]);export{Rs as default};
