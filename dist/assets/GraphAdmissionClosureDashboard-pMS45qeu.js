const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ticketListUtils-DJgh0NR_.js","assets/priority-config-MOhmkIiu.js","assets/main-D1gGpxH4.js","assets/main-hkNOQW78.css","assets/priority-config-Bxxce_5E.css","assets/ticket-mapper-CUMx74Wa.js"])))=>i.map(i=>d[i]);
var Pe=Object.defineProperty;var Fe=(f,s,t)=>s in f?Pe(f,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[s]=t;var ye=(f,s,t)=>Fe(f,typeof s!="symbol"?s+"":s,t);import{_ as ee,g as I,G as te,m as _e,H as Oe,f as X,o as r,j as G,k as x,a as d,d as F,b as e,y as ae,n as K,B as J,I as Ve,c as L,J as R,t as w,F as j,e as H,K as ve,L as Ye,x as xe,l as se,z as Re,r as Ne,S as Ge,T as he,M as ke,N as Ue}from"./main-D1gGpxH4.js";import{F as Le}from"./FiltersPanel-B_m-WnDy.js";import{L as ne,D as je,B as ze}from"./index-Cdt2Pj36.js";import{B as le,g as Me,a as He,b as Be,D as qe,T as me,c as pe}from"./priority-config-MOhmkIiu.js";const Ze={key:0,class:"modal-overlay"},Je={class:"modal-container",role:"dialog","aria-labelledby":"modal-title","aria-modal":"true"},Ke={class:"modal-body"},Xe={class:"mode-description"},Qe={__name:"PeriodModeInfoModal",props:{isVisible:{type:Boolean,required:!0},currentMode:{type:String,default:"weeks",validator:f=>["weeks","months"].includes(f)}},emits:["close","start-loading","select-mode"],setup(f,{emit:s}){const t=f,l=s,c=I(t.currentMode);function v(i){if(!["weeks","months"].includes(i)){console.warn("[PeriodModeInfoModal] Invalid mode:",i);return}c.value=i,console.log("[DEBUG Modal] handleModeSelect: mode =",i),console.log("[DEBUG Modal] Emitting select-mode event"),l("select-mode",i),console.log("[DEBUG Modal] Emitting close event"),l("close"),console.log("[DEBUG Modal] Scheduling start-loading event in 100ms"),setTimeout(()=>{console.log("[DEBUG Modal] Emitting start-loading event"),l("start-loading")},100)}function E(){console.log("[DEBUG Modal] handleClose called, selectedMode =",c.value),console.log("[DEBUG Modal] Emitting select-mode event with",c.value),l("select-mode",c.value),console.log("[DEBUG Modal] Emitting close event"),l("close")}function m(i){i.key==="Escape"&&t.isVisible&&E()}return te(()=>t.currentMode,i=>{["weeks","months"].includes(i)&&(c.value=i)}),_e(()=>{t.isVisible&&document.addEventListener("keydown",m)}),Oe(()=>{document.removeEventListener("keydown",m)}),te(()=>t.isVisible,i=>{i?(document.addEventListener("keydown",m),c.value=t.currentMode):document.removeEventListener("keydown",m)}),(i,k)=>(r(),X(Ve,{to:"body"},[G(J,{name:"modal-fade"},{default:x(()=>[f.isVisible?(r(),d("div",Ze,[e("div",Je,[e("div",{class:"modal-header"},[k[2]||(k[2]=e("h2",{id:"modal-title",class:"modal-title"},[e("span",{class:"modal-icon"},"‚ÑπÔ∏è"),ae(" –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ")],-1)),e("button",{class:"modal-close-btn",onClick:E,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å",type:"button"}," √ó ")]),e("div",Ke,[k[5]||(k[5]=e("p",{class:"modal-description"}," –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π: ",-1)),e("div",Xe,[e("button",{class:K(["mode-item mode-item--clickable",{"mode-item--selected":c.value==="weeks"}]),onClick:k[0]||(k[0]=y=>v("weeks")),type:"button"},[...k[3]||(k[3]=[e("div",{class:"mode-header"},[e("span",{class:"mode-icon"},"üìÖ"),e("h3",{class:"mode-title"},"4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏")],-1),e("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 –Ω–µ–¥–µ–ª–∏ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –Ω–µ–¥–µ–ª—è–º. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç–∏–∫–µ—Ç–æ–≤. ",-1)])],2),e("button",{class:K(["mode-item mode-item--clickable",{"mode-item--selected":c.value==="months"}]),onClick:k[1]||(k[1]=y=>v("months")),type:"button"},[...k[4]||(k[4]=[e("div",{class:"mode-header"},[e("span",{class:"mode-icon"},"üìä"),e("h3",{class:"mode-title"},"3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞")],-1),e("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—Ü–µ–≤. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤. ",-1)])],2)])])])])):F("",!0)]),_:1})]))}},et=ee(Qe,[["__scopeId","data-v-4a42a9a6"]]),tt={class:"ac-chart"},st={class:"ac-chart__header"},at={class:"ac-chart__subtitle"},ot={class:"ac-chart__controls"},rt={class:"chart-type-selector"},lt=["onClick"],nt={class:"chart-type-icon"},it={class:"chart-type-label"},dt={class:"ac-chart__summary"},ct={class:"summary-card__value"},ut={class:"summary-card__value-main"},kt={class:"summary-card__breakdown"},vt={class:"breakdown-item breakdown-item--this-week"},ht={class:"breakdown-item__value"},mt={class:"breakdown-item breakdown-item--other-week"},yt={class:"breakdown-item__value"},gt={class:"summary-card__value-main"},_t={class:"summary-card__breakdown"},pt={class:"breakdown-item breakdown-item--this-week"},bt={class:"breakdown-item__value"},ft={class:"breakdown-item breakdown-item--other-week"},wt={class:"breakdown-item__value"},Tt={class:"summary-card summary-card--stages"},Ct={class:"summary-card__tags"},Dt={key:0,class:"stage-tag stage-tag--empty"},$t={class:"ac-chart__body"},Et={key:0,class:"split-charts-container"},Wt={class:"chart-wrapper chart-wrapper--left"},It={class:"chart-canvas-wrapper"},At={class:"chart-wrapper chart-wrapper--right"},St={class:"chart-canvas-wrapper"},Ut={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(f,{emit:s}){const t=f,l=s,c=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],v=I("line");L(()=>{var g;return((g=t.meta)==null?void 0:g.weekNumber)??"‚Äî"});const E=()=>{var o,A;const g=((o=t.meta)==null?void 0:o.weeks)||[];return g.length>0?g.map(T=>`–ù–µ–¥–µ–ª—è ${T.weekNumber}`):[(A=t.meta)!=null&&A.weekNumber?`–ù–µ–¥–µ–ª—è ${t.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"]},m=L(()=>{var _,N,D,S;const g=E(),o=Array.isArray((_=t.data.series)==null?void 0:_.new)&&t.data.series.new.length>0?t.data.series.new:[t.data.newTickets??0],A=Array.isArray((N=t.data.series)==null?void 0:N.closed)&&t.data.series.closed.length>0?t.data.series.closed:[t.data.closedTickets??0],T=Array.isArray((D=t.data.series)==null?void 0:D.closedCreatedThisWeek)&&t.data.series.closedCreatedThisWeek.length>0?t.data.series.closedCreatedThisWeek:[t.data.closedTicketsCreatedThisWeek??0],u=Array.isArray((S=t.data.series)==null?void 0:S.closedCreatedOtherWeek)&&t.data.series.closedCreatedOtherWeek.length>0?t.data.series.closedCreatedOtherWeek:[t.data.closedTicketsCreatedOtherWeek??0];return{labels:g,datasets:[{label:"–ù–æ–≤—ã–µ",data:o,backgroundColor:R.primary,borderColor:R.primary,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:A,backgroundColor:R.success,borderColor:R.success,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:T,backgroundColor:R.successLight,borderColor:R.successLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:u,backgroundColor:R.warning,borderColor:R.warning,tension:.3,fill:!1,borderDash:[5,5]}]}}),i=L(()=>{var u,_,N;const g=E(),o=Array.isArray((u=t.data.series)==null?void 0:u.carryover)&&t.data.series.carryover.length>0?t.data.series.carryover:[t.data.carryoverTickets??0],A=Array.isArray((_=t.data.series)==null?void 0:_.carryoverCreatedThisWeek)&&t.data.series.carryoverCreatedThisWeek.length>0?t.data.series.carryoverCreatedThisWeek:[t.data.carryoverTicketsCreatedThisWeek??0],T=Array.isArray((N=t.data.series)==null?void 0:N.carryoverCreatedOtherWeek)&&t.data.series.carryoverCreatedOtherWeek.length>0?t.data.series.carryoverCreatedOtherWeek:[t.data.carryoverTicketsCreatedOtherWeek??0];return{labels:g,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:o,backgroundColor:R.carryover,borderColor:R.carryover,tension:.3,fill:!1},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:A,backgroundColor:R.carryoverLight,borderColor:R.carryoverLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:T,backgroundColor:R.carryoverDark,borderColor:R.carryoverDark,tension:.3,fill:!1,borderDash:[5,5]}]}}),k=L(()=>{var P,V,q,Z,h,a,n,W,M;const g=((P=t.meta)==null?void 0:P.weeks)||[],o=g.length>0?g.map(U=>`–ù–µ–¥–µ–ª—è ${U.weekNumber}`):[(V=t.meta)!=null&&V.weekNumber?`–ù–µ–¥–µ–ª—è ${t.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"],A=Array.isArray((q=t.data.series)==null?void 0:q.new)&&t.data.series.new.length>0?t.data.series.new:[t.data.newTickets??0],T=Array.isArray((Z=t.data.series)==null?void 0:Z.closed)&&t.data.series.closed.length>0?t.data.series.closed:[t.data.closedTickets??0],u=Array.isArray((h=t.data.series)==null?void 0:h.closedCreatedThisWeek)&&t.data.series.closedCreatedThisWeek.length>0?t.data.series.closedCreatedThisWeek:[t.data.closedTicketsCreatedThisWeek??0],_=Array.isArray((a=t.data.series)==null?void 0:a.closedCreatedOtherWeek)&&t.data.series.closedCreatedOtherWeek.length>0?t.data.series.closedCreatedOtherWeek:[t.data.closedTicketsCreatedOtherWeek??0],N=Array.isArray((n=t.data.series)==null?void 0:n.carryover)&&t.data.series.carryover.length>0?t.data.series.carryover:[t.data.carryoverTickets??0],D=Array.isArray((W=t.data.series)==null?void 0:W.carryoverCreatedThisWeek)&&t.data.series.carryoverCreatedThisWeek.length>0?t.data.series.carryoverCreatedThisWeek:[t.data.carryoverTicketsCreatedThisWeek??0],S=Array.isArray((M=t.data.series)==null?void 0:M.carryoverCreatedOtherWeek)&&t.data.series.carryoverCreatedOtherWeek.length>0?t.data.series.carryoverCreatedOtherWeek:[t.data.carryoverTicketsCreatedOtherWeek??0];return{labels:o,datasets:[{label:"–ù–æ–≤—ã–µ",data:A,backgroundColor:R.primary,borderColor:R.primary,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:T,backgroundColor:R.success,borderColor:R.success,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:u,backgroundColor:R.successLight,borderColor:R.successLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:_,backgroundColor:R.warning,borderColor:R.warning,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:N,backgroundColor:R.carryover,borderColor:R.carryover,tension:.3,fill:!1},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:D,backgroundColor:R.carryoverLight,borderColor:R.carryoverLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:S,backgroundColor:R.carryoverDark,borderColor:R.carryoverDark,tension:.3,fill:!1,borderDash:[5,5]}]}}),y=L(()=>({labels:["–ù–æ–≤—ã–µ","–ó–∞–∫—Ä—ã—Ç—ã–µ","–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ"],datasets:[{data:[t.data.newTickets??0,t.data.closedTickets??0,t.data.carryoverTickets??0],backgroundColor:[R.primary,R.success,R.carryover],borderWidth:1}]})),C=L(()=>{switch(v.value){case"line":return ne;case"bar":return ze;case"doughnut":return je;default:return ne}}),b=L(()=>v.value==="doughnut"?y.value:k.value),$=g=>{if(!g)return"‚Äî";try{return new Date(g).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return g}},Y=L(()=>({responsive:!0,maintainAspectRatio:!1,resizeDelay:0,plugins:{tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12,callbacks:{title:g=>{var N,D,S,P,V,q;const o=(N=g[0])==null?void 0:N.dataIndex,A=((D=t.meta)==null?void 0:D.weeks)||[];if(A.length>0&&o!==void 0&&A[o]){const Z=A[o];return`–ù–µ–¥–µ–ª—è ${Z.weekNumber} (${$(Z.weekStartUtc)} ‚Äî ${$(Z.weekEndUtc)})`}const T=(S=t.meta)==null?void 0:S.weekNumber,u=(P=t.meta)==null?void 0:P.weekStartUtc,_=(V=t.meta)==null?void 0:V.weekEndUtc;return T&&u&&_?`–ù–µ–¥–µ–ª—è ${T} (${$(u)} ‚Äî ${$(_)})`:((q=g[0])==null?void 0:q.label)||""}}},legend:{position:"top",labels:{font:{size:15,weight:"500"},padding:16,boxWidth:20,boxHeight:12}}},scales:v.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},title:{display:!1},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:45,minRotation:45,font:{size:14},padding:10},title:{display:!1},grid:{lineWidth:1.5}}}})),B=L(()=>{var g,o,A,T;if((g=t.data)!=null&&g.series){const u=t.data.series,_=Math.max((Array.isArray(u.new)?u.new.length:0)-1,(Array.isArray(u.closed)?u.closed.length:0)-1,(Array.isArray(u.carryover)?u.carryover.length:0)-1,-1);if(_>=0){const N={newTickets:Array.isArray(u.new)&&u.new[_]!==void 0?u.new[_]:0,closedTickets:Array.isArray(u.closed)&&u.closed[_]!==void 0?u.closed[_]:0,closedTicketsCreatedThisWeek:Array.isArray(u.closedCreatedThisWeek)&&u.closedCreatedThisWeek[_]!==void 0?u.closedCreatedThisWeek[_]:0,closedTicketsCreatedOtherWeek:Array.isArray(u.closedCreatedOtherWeek)&&u.closedCreatedOtherWeek[_]!==void 0?u.closedCreatedOtherWeek[_]:0,carryoverTickets:Array.isArray(u.carryover)&&u.carryover[_]!==void 0?u.carryover[_]:0,carryoverTicketsCreatedThisWeek:Array.isArray(u.carryoverCreatedThisWeek)&&u.carryoverCreatedThisWeek[_]!==void 0?u.carryoverCreatedThisWeek[_]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(u.carryoverCreatedOtherWeek)&&u.carryoverCreatedOtherWeek[_]!==void 0?u.carryoverCreatedOtherWeek[_]:0};if(N.newTickets>0||N.closedTickets>0||N.carryoverTickets>0)return N}}if((o=t.data)!=null&&o.currentWeek&&typeof t.data.currentWeek=="object"){const u=t.data.currentWeek;if((u.newTickets??0)>0||(u.closedTickets??0)>0||(u.carryoverTickets??0)>0)return u}if((A=t.data)!=null&&A.weeksData&&Array.isArray(t.data.weeksData)&&t.data.weeksData.length>0){const u=t.data.weeksData[t.data.weeksData.length-1];if((u.newTickets??0)>0||(u.closedTickets??0)>0||(u.carryoverTickets??0)>0)return u}if((T=t.data)!=null&&T.series){const u=t.data.series,_=Math.max((Array.isArray(u.new)?u.new.length:0)-1,(Array.isArray(u.closed)?u.closed.length:0)-1,(Array.isArray(u.carryover)?u.carryover.length:0)-1,-1);if(_>=0)return{newTickets:Array.isArray(u.new)&&u.new[_]!==void 0?u.new[_]:0,closedTickets:Array.isArray(u.closed)&&u.closed[_]!==void 0?u.closed[_]:0,closedTicketsCreatedThisWeek:Array.isArray(u.closedCreatedThisWeek)&&u.closedCreatedThisWeek[_]!==void 0?u.closedCreatedThisWeek[_]:0,closedTicketsCreatedOtherWeek:Array.isArray(u.closedCreatedOtherWeek)&&u.closedCreatedOtherWeek[_]!==void 0?u.closedCreatedOtherWeek[_]:0,carryoverTickets:Array.isArray(u.carryover)&&u.carryover[_]!==void 0?u.carryover[_]:0,carryoverTicketsCreatedThisWeek:Array.isArray(u.carryoverCreatedThisWeek)&&u.carryoverCreatedThisWeek[_]!==void 0?u.carryoverCreatedThisWeek[_]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(u.carryoverCreatedOtherWeek)&&u.carryoverCreatedOtherWeek[_]!==void 0?u.carryoverCreatedOtherWeek[_]:0}}return t.data||{}}),O=g=>{var _;const o=B.value,A=(o==null?void 0:o.newTickets)??0,T=(o==null?void 0:o.closedTickets)??0,u=(o==null?void 0:o.carryoverTickets)??0;g==="new"&&A>0?l("open-stages"):g==="closed"&&T>0?(((_=t.data)==null?void 0:_.responsible)||[]).length>0&&l("open-responsible"):g==="carryover"&&u>0&&l("open-carryover")};return(g,o)=>{var A,T,u,_,N,D,S,P,V,q,Z,h,a,n,W,M;return r(),d("div",tt,[e("header",st,[e("div",null,[o[3]||(o[3]=e("h2",{class:"ac-chart__title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),e("p",at," –ù–µ–¥–µ–ª—è "+w(((T=(A=f.meta)==null?void 0:A.currentWeek)==null?void 0:T.weekNumber)??((u=f.meta)==null?void 0:u.weekNumber)??"‚Äî")+" ¬∑ "+w((((N=(_=f.meta)==null?void 0:_.currentWeek)==null?void 0:N.weekStartUtc)??((D=f.meta)==null?void 0:D.weekStartUtc))||"‚Äî")+" ‚Äî "+w((((P=(S=f.meta)==null?void 0:S.currentWeek)==null?void 0:P.weekEndUtc)??((V=f.meta)==null?void 0:V.weekEndUtc))||"‚Äî")+" (UTC) ",1)]),e("div",ot,[e("div",rt,[(r(),d(j,null,H(c,U=>e("button",{key:U.value,class:K(["chart-type-btn",{active:v.value===U.value}]),onClick:p=>v.value=U.value},[e("span",nt,w(U.icon),1),e("span",it,w(U.label),1)],10,lt)),64))])])]),e("section",dt,[e("div",{class:"summary-card summary-card--new",onClick:o[0]||(o[0]=U=>O("new"))},[o[4]||(o[4]=e("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),e("div",ct,w(((q=B.value)==null?void 0:q.newTickets)??0),1)]),e("div",{class:"summary-card summary-card--closed-breakdown",onClick:o[1]||(o[1]=U=>O("closed"))},[o[9]||(o[9]=e("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),e("div",ut,w(((Z=B.value)==null?void 0:Z.closedTickets)??0),1),e("div",kt,[e("div",vt,[o[5]||(o[5]=e("span",{class:"breakdown-item__icon"},"‚úì",-1)),e("span",ht,w(((h=B.value)==null?void 0:h.closedTicketsCreatedThisWeek)??0),1),o[6]||(o[6]=e("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),e("div",mt,[o[7]||(o[7]=e("span",{class:"breakdown-item__icon"},"‚Üª",-1)),e("span",yt,w(((a=B.value)==null?void 0:a.closedTicketsCreatedOtherWeek)??0),1),o[8]||(o[8]=e("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),e("div",{class:"summary-card summary-card--carryover-breakdown",onClick:o[2]||(o[2]=U=>O("carryover"))},[o[14]||(o[14]=e("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),e("div",gt,w(((n=B.value)==null?void 0:n.carryoverTickets)??0),1),e("div",_t,[e("div",pt,[o[10]||(o[10]=e("span",{class:"breakdown-item__icon"},"‚úì",-1)),e("span",bt,w(((W=B.value)==null?void 0:W.carryoverTicketsCreatedThisWeek)??0),1),o[11]||(o[11]=e("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),e("div",ft,[o[12]||(o[12]=e("span",{class:"breakdown-item__icon"},"‚Üª",-1)),e("span",wt,w(((M=B.value)==null?void 0:M.carryoverTicketsCreatedOtherWeek)??0),1),o[13]||(o[13]=e("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–∏—Ö",-1))])])]),e("div",Tt,[o[15]||(o[15]=e("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),e("div",Ct,[(r(!0),d(j,null,H(f.data.stages||[],U=>(r(),d("span",{key:U.stageId,class:"stage-tag"},w(U.stageName||U.stageId)+" ‚Äî "+w(U.count),1))),128)),!f.data.stages||f.data.stages.length===0?(r(),d("span",Dt," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):F("",!0)])])]),e("div",$t,[v.value==="line"?(r(),d("div",Et,[e("div",Wt,[o[16]||(o[16]=e("h3",{class:"chart-subtitle"},"–ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",It,[G(ve(ne),{data:m.value,options:Y.value},null,8,["data","options"])])]),e("div",At,[o[17]||(o[17]=e("h3",{class:"chart-subtitle"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",St,[G(ve(ne),{data:i.value,options:Y.value},null,8,["data","options"])])])])):(r(),X(Ye(C.value),{key:1,data:b.value,options:Y.value},null,8,["data","options"]))])])}}},Mt=ee(Ut,[["__scopeId","data-v-73ab5a50"]]),Bt={class:"summary-cards-months"},Ot={class:"summary-card summary-card--new"},Rt={class:"card-content"},Nt={class:"card-main-value"},Gt={class:"card-month-breakdown"},Lt={class:"month-name"},Pt={class:"month-value"},Ft={key:0,class:"month-item month-item--empty"},Vt={class:"summary-card summary-card--closed"},Yt={class:"card-content"},xt={class:"card-main-value"},jt={class:"card-month-breakdown-hierarchical"},zt={class:"month-header"},Ht={class:"month-name"},qt={class:"month-value"},Zt={class:"month-breakdown"},Jt={class:"breakdown-item breakdown-this-week"},Kt={class:"breakdown-value"},Xt={class:"breakdown-item breakdown-other-week"},Qt={class:"breakdown-value"},es={key:0,class:"month-item-hierarchical month-item--empty"},ts={class:"summary-card summary-card--carryover"},ss={class:"card-content"},as={class:"card-main-value"},os={class:"card-month-breakdown"},rs={class:"month-name"},ls={class:"month-value"},ns={key:0,class:"month-item month-item--empty"},is={class:"summary-card summary-card--stages"},ds={class:"card-content"},cs={class:"stages-list"},us={class:"stage-icon"},ks={class:"stage-name"},vs={class:"stage-value"},hs={key:0,class:"stage-item stage-item--empty"},ms={__name:"SummaryCardsMonths",props:{data:{type:Object,required:!0,default:()=>({newTickets:0,newTicketsByMonth:[],closedTickets:0,closedTicketsByMonth:[],carryoverTickets:0,carryoverTicketsByMonth:[],stages:[]})}},setup(f){const s=f;function t(y){return y==null||isNaN(y)?"0":y>=1e6?(y/1e6).toFixed(1)+"M":y>=1e3?y.toLocaleString("ru-RU"):y.toString()}const l=L(()=>{var y;return((y=s.data)==null?void 0:y.newTickets)||0}),c=L(()=>t(l.value)),v=L(()=>{var y;return((y=s.data)==null?void 0:y.newTicketsByMonth)||[]}),E=L(()=>{var y;return((y=s.data)==null?void 0:y.closedTicketsByMonth)||[]}),m=L(()=>{var y;return((y=s.data)==null?void 0:y.carryoverTicketsByMonth)||[]});function i(y){return{"DT140_12:SUCCESS":"stage-success","DT140_12:FAIL":"stage-fail","DT140_12:UC_0GBU8Z":"stage-other"}[y]||""}function k(y){return{"DT140_12:SUCCESS":"‚úì","DT140_12:FAIL":"‚úó","DT140_12:UC_0GBU8Z":"‚ö†"}[y]||"‚Ä¢"}return(y,C)=>(r(),d("div",Bt,[e("div",Ot,[C[0]||(C[0]=e("h3",{class:"card-title"},"–ù–æ–≤—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥",-1)),e("div",Rt,[e("div",Nt,w(c.value),1),e("div",Gt,[(r(!0),d(j,null,H(v.value,b=>(r(),d("div",{key:`new-${b.month}`,class:"month-item"},[e("span",Lt,w(b.monthName)+":",1),e("span",Pt,w(t(b.count)),1)]))),128)),v.value.length===0?(r(),d("div",Ft," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):F("",!0)])])]),e("div",Vt,[C[5]||(C[5]=e("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –≤—Å–µ–≥–æ",-1)),e("div",Yt,[e("div",xt,w(t(f.data.closedTickets||0)),1),e("div",jt,[(r(!0),d(j,null,H(E.value,b=>(r(),d("div",{key:`closed-${b.month}`,class:"month-item-hierarchical"},[e("div",zt,[e("span",Ht,w(b.monthName)+":",1),e("span",qt,w(t(b.count||0)),1)]),e("div",Zt,[e("div",Jt,[C[1]||(C[1]=e("span",{class:"breakdown-icon"},"‚úì",-1)),C[2]||(C[2]=e("span",{class:"breakdown-label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π:",-1)),e("span",Kt,w(t(b.closedCreatedThisWeek||0)),1)]),e("div",Xt,[C[3]||(C[3]=e("span",{class:"breakdown-icon"},"‚Üª",-1)),C[4]||(C[4]=e("span",{class:"breakdown-label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π:",-1)),e("span",Qt,w(t(b.closedCreatedOtherWeek||0)),1)])])]))),128)),E.value.length===0?(r(),d("div",es," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):F("",!0)])])]),e("div",ts,[C[6]||(C[6]=e("h3",{class:"card-title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ –≤—Å–µ–≥–æ",-1)),e("div",ss,[e("div",as,w(t(f.data.carryoverTickets||0)),1),e("div",os,[(r(!0),d(j,null,H(m.value,b=>(r(),d("div",{key:`carryover-${b.month}`,class:"month-item"},[e("span",rs,w(b.monthName)+":",1),e("span",ls,w(t(b.count||0)),1)]))),128)),m.value.length===0?(r(),d("div",ns," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):F("",!0)])])]),e("div",is,[C[8]||(C[8]=e("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),e("div",ds,[e("div",cs,[(r(!0),d(j,null,H(f.data.stages||[],b=>(r(),d("div",{key:b.stageId,class:K(["stage-item",i(b.stageId)])},[e("span",us,w(k(b.stageId)),1),e("span",ks,w(b.stageName||b.stageId)+":",1),e("span",vs,w(t(b.count||0)),1)],2))),128)),!f.data.stages||f.data.stages.length===0?(r(),d("div",hs,[...C[7]||(C[7]=[e("span",{class:"stage-name"},"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö",-1)])])):F("",!0)])])])]))}},ys=ee(ms,[["__scopeId","data-v-7325e15b"]]),gs={class:"line-chart-months"},_s={class:"chart-section"},ps={class:"chart-container"},bs={class:"chart-section"},fs={class:"chart-container"},ws={class:"chart-table-section"},Ts={class:"chart-table-wrapper"},Cs={class:"data-table"},Ds={class:"data-row data-row--new"},$s={class:"data-row data-row--closed"},Es={class:"data-row data-row--carryover"},Ws={__name:"LineChartMonths",props:{data:{type:Object,required:!0,default:()=>({newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]})},meta:{type:Object,default:()=>({months:[]})}},setup(f){const s=f;function t(i){return i==null||isNaN(i)?"0":i>=1e3?i.toLocaleString("ru-RU"):i.toString()}const l=L(()=>{var k,y,C;const i=new Set;return(k=s.data.newTicketsByMonth)==null||k.forEach(b=>{b.weeks&&Array.isArray(b.weeks)&&b.weeks.forEach($=>{$&&$.weekNumber&&i.add($.weekNumber)})}),(y=s.data.closedTicketsByMonth)==null||y.forEach(b=>{b.weeks&&Array.isArray(b.weeks)&&b.weeks.forEach($=>{$&&$.weekNumber&&i.add($.weekNumber)})}),(C=s.data.carryoverTicketsByMonth)==null||C.forEach(b=>{b.weeks&&Array.isArray(b.weeks)&&b.weeks.forEach($=>{$&&$.weekNumber&&i.add($.weekNumber)})}),Array.from(i).sort((b,$)=>b-$)}),c=L(()=>{const i=s.data.newTicketsByMonth||[],k=i.map(b=>b.monthName||`–ú–µ—Å—è—Ü ${b.month}`),y=i.map(b=>b.count||0),C=(s.data.closedTicketsByMonth||[]).map(b=>b.count||0);return{labels:k,datasets:[{label:"–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã",data:y,borderColor:R.primary,backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",data:C,borderColor:R.success,backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4,fill:!1}]}}),v=L(()=>{const i=s.data.carryoverTicketsByMonth||[],k=i.map(C=>C.monthName||`–ú–µ—Å—è—Ü ${C.month}`),y=i.map(C=>C.count||0);return{labels:k,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",data:y,borderColor:R.carryover,backgroundColor:"rgba(255, 152, 0, 0.1)",tension:.4,fill:!1}]}}),E={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{font:{size:14,weight:"500"},padding:16,boxWidth:20,boxHeight:12}},tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12}},scales:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:0,minRotation:0,font:{size:14},padding:10},grid:{lineWidth:1.5}}}};function m(i,k){let y=[];switch(i){case"new":y=s.data.newTicketsByMonth||[];break;case"closed":y=s.data.closedTicketsByMonth||[];break;case"carryover":y=s.data.carryoverTicketsByMonth||[];break;default:return"-"}for(const C of y){if(!C.weeks||!Array.isArray(C.weeks))continue;const b=C.weeks.find($=>$&&$.weekNumber===k);if(b){const $=b.count||0;return $>0?t($):"-"}}return"-"}return(i,k)=>(r(),d("div",gs,[e("div",_s,[k[0]||(k[0]=e("h3",{class:"chart-title"},"–ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",ps,[G(ve(ne),{data:c.value,options:E},null,8,["data"])])]),e("div",bs,[k[1]||(k[1]=e("h3",{class:"chart-title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",fs,[G(ve(ne),{data:v.value,options:E},null,8,["data"])])]),e("div",ws,[k[6]||(k[6]=e("h3",{class:"chart-title"},"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º",-1)),e("div",Ts,[e("table",Cs,[e("thead",null,[e("tr",null,[k[2]||(k[2]=e("th",{class:"month-header-cell"},"–ú–µ—Å—è—Ü",-1)),(r(!0),d(j,null,H(l.value,y=>(r(),d("th",{key:`week-${y}`,class:"week-header-cell"}," –ù–µ–¥–µ–ª—è "+w(y),1))),128))])]),e("tbody",null,[e("tr",Ds,[k[3]||(k[3]=e("td",{class:"data-type-cell"},"–ù–æ–≤—ã–µ",-1)),(r(!0),d(j,null,H(l.value,y=>(r(),d("td",{key:`new-${y}`,class:"week-data-cell"},w(m("new",y)),1))),128))]),e("tr",$s,[k[4]||(k[4]=e("td",{class:"data-type-cell"},"–ó–∞–∫—Ä—ã—Ç—ã–µ",-1)),(r(!0),d(j,null,H(l.value,y=>(r(),d("td",{key:`closed-${y}`,class:"week-data-cell"},w(m("closed",y)),1))),128))]),e("tr",Es,[k[5]||(k[5]=e("td",{class:"data-type-cell"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),(r(!0),d(j,null,H(l.value,y=>(r(),d("td",{key:`carryover-${y}`,class:"week-data-cell"},w(m("carryover",y)),1))),128))])])])])])]))}},Is=ee(Ws,[["__scopeId","data-v-f048a2de"]]),As={class:"months-preloader"},Ss={class:"preloader-content"},Us={class:"progress-container"},Ms={class:"progress-bar"},Bs={class:"progress-text"},Os={class:"preloader-message"},Rs={class:"stages-list"},Ns={class:"stage-icon"},Gs={class:"stage-text"},Ls={__name:"MonthsModePreloader",props:{progress:{type:Number,required:!0,validator:f=>f>=0&&f<=100},currentStage:{type:String,default:""}},setup(f){const s=f,t=[{label:"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",threshold:10},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –æ–∫—Ç—è–±—Ä—å...",threshold:40},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –Ω–æ—è–±—Ä—å...",threshold:70},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –¥–µ–∫–∞–±—Ä—å...",threshold:90},{label:"–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...",threshold:95},{label:"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",threshold:100}];function l(v){return s.progress>=t[v].threshold}function c(v){const E=t[v].threshold,m=v>0?t[v-1].threshold:0;return s.progress>=m&&s.progress<E}return(v,E)=>(r(),d("div",As,[e("div",Ss,[E[0]||(E[0]=xe('<div class="preloader-spinner" data-v-23ab71eb><div class="spinner-ring" data-v-23ab71eb></div><div class="spinner-ring" data-v-23ab71eb></div><div class="spinner-ring" data-v-23ab71eb></div></div><h3 class="preloader-title" data-v-23ab71eb>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 3 –º–µ—Å—è—Ü–∞</h3>',2)),e("div",Us,[e("div",Ms,[e("div",{class:"progress-fill",style:se({width:`${f.progress}%`})},null,4)]),e("div",Bs,w(Math.round(f.progress))+"%",1)]),e("p",Os,w(f.currentStage),1),e("div",Rs,[(r(),d(j,null,H(t,(m,i)=>e("div",{key:i,class:K(["stage-item",{"stage-completed":l(i),"stage-current":c(i)}])},[e("span",Ns,w(l(i)?"‚úì":c(i)?"‚Üí":"‚óã"),1),e("span",Gs,w(m.label),1)],2)),64))])])]))}},Ps=ee(Ls,[["__scopeId","data-v-23ab71eb"]]),Fs="/api/graph-1c-admission-closure.php";function Vs(f){var l,c,v,E,m,i,k,y,C,b,$,Y,B,O,g,o,A,T,u,_,N,D,S,P,V,q,Z,h,a,n,W,M,U,p,z,Q,ie,de,ce,ue,oe,be,fe,we,Te,Ce,De,$e,Ee,We,Ie,Ae,Se;if(!f)return{meta:null,data:{currentWeek:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0},newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},weeksData:[],stages:[],responsible:[],responsibleCreatedThisWeek:[],responsibleCreatedOtherWeek:[]}};const s=f.data||f.result||f,t=s.meta||f.meta||null;return{meta:{...t,currentWeek:(t==null?void 0:t.currentWeek)||(t?{weekNumber:t.weekNumber,weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc}:null),weeks:(t==null?void 0:t.weeks)||[]},data:{currentWeek:((l=s.data)==null?void 0:l.currentWeek)||(s.data?{newTickets:s.data.newTickets??0,closedTickets:s.data.closedTickets??0,closedTicketsCreatedThisWeek:s.data.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:s.data.closedTicketsCreatedOtherWeek??0,carryoverTickets:s.data.carryoverTickets??0,carryoverTicketsCreatedThisWeek:s.data.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:s.data.carryoverTicketsCreatedOtherWeek??0}:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0}),newTickets:((v=(c=s.data)==null?void 0:c.currentWeek)==null?void 0:v.newTickets)??((E=s.data)==null?void 0:E.newTickets)??s.newTickets??0,closedTickets:((i=(m=s.data)==null?void 0:m.currentWeek)==null?void 0:i.closedTickets)??((k=s.data)==null?void 0:k.closedTickets)??s.closedTickets??0,closedTicketsCreatedThisWeek:((C=(y=s.data)==null?void 0:y.currentWeek)==null?void 0:C.closedTicketsCreatedThisWeek)??((b=s.data)==null?void 0:b.closedTicketsCreatedThisWeek)??s.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:((Y=($=s.data)==null?void 0:$.currentWeek)==null?void 0:Y.closedTicketsCreatedOtherWeek)??((B=s.data)==null?void 0:B.closedTicketsCreatedOtherWeek)??s.closedTicketsCreatedOtherWeek??0,carryoverTickets:((g=(O=s.data)==null?void 0:O.currentWeek)==null?void 0:g.carryoverTickets)??((o=s.data)==null?void 0:o.carryoverTickets)??s.carryoverTickets??0,carryoverTicketsCreatedThisWeek:((T=(A=s.data)==null?void 0:A.currentWeek)==null?void 0:T.carryoverTicketsCreatedThisWeek)??((u=s.data)==null?void 0:u.carryoverTicketsCreatedThisWeek)??s.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:((N=(_=s.data)==null?void 0:_.currentWeek)==null?void 0:N.carryoverTicketsCreatedOtherWeek)??((D=s.data)==null?void 0:D.carryoverTicketsCreatedOtherWeek)??s.carryoverTicketsCreatedOtherWeek??0,series:{new:((P=(S=s.data)==null?void 0:S.series)==null?void 0:P.new)??((V=s.series)==null?void 0:V.new)??[0],closed:((Z=(q=s.data)==null?void 0:q.series)==null?void 0:Z.closed)??((h=s.series)==null?void 0:h.closed)??[0],closedCreatedThisWeek:((n=(a=s.data)==null?void 0:a.series)==null?void 0:n.closedCreatedThisWeek)??((W=s.series)==null?void 0:W.closedCreatedThisWeek)??[0],closedCreatedOtherWeek:((U=(M=s.data)==null?void 0:M.series)==null?void 0:U.closedCreatedOtherWeek)??((p=s.series)==null?void 0:p.closedCreatedOtherWeek)??[0],carryover:((Q=(z=s.data)==null?void 0:z.series)==null?void 0:Q.carryover)??((ie=s.series)==null?void 0:ie.carryover)??[0],carryoverCreatedThisWeek:((ce=(de=s.data)==null?void 0:de.series)==null?void 0:ce.carryoverCreatedThisWeek)??((ue=s.series)==null?void 0:ue.carryoverCreatedThisWeek)??[0],carryoverCreatedOtherWeek:((be=(oe=s.data)==null?void 0:oe.series)==null?void 0:be.carryoverCreatedOtherWeek)??((fe=s.series)==null?void 0:fe.carryoverCreatedOtherWeek)??[0]},weeksData:((we=s.data)==null?void 0:we.weeksData)??s.weeksData??[],stages:((Te=s.data)==null?void 0:Te.stages)??s.stages??[],responsible:((Ce=s.data)==null?void 0:Ce.responsible)??s.responsible??[],responsibleCreatedThisWeek:((De=s.data)==null?void 0:De.responsibleCreatedThisWeek)??s.responsibleCreatedThisWeek??[],responsibleCreatedOtherWeek:(($e=s.data)==null?void 0:$e.responsibleCreatedOtherWeek)??s.responsibleCreatedOtherWeek??[],newTicketsByStages:((Ee=s.data)==null?void 0:Ee.newTicketsByStages)??s.newTicketsByStages??null,carryoverTicketsByDuration:((We=s.data)==null?void 0:We.carryoverTicketsByDuration)??s.carryoverTicketsByDuration??null,newTicketsByMonth:((Ie=s.data)==null?void 0:Ie.newTicketsByMonth)??s.newTicketsByMonth??[],closedTicketsByMonth:((Ae=s.data)==null?void 0:Ae.closedTicketsByMonth)??s.closedTicketsByMonth??[],carryoverTicketsByMonth:((Se=s.data)==null?void 0:Se.carryoverTicketsByMonth)??s.carryoverTicketsByMonth??[]}}}async function re(f={}){const{endpoint:s=Fs,product:t="1C",weekStartUtc:l=null,weekEndUtc:c=null,periodMode:v="weeks",useCache:E=!0,forceRefresh:m=!1,includeTickets:i=!1,includeNewTicketsByStages:k=!1,includeCarryoverTickets:y=!0,includeCarryoverTicketsByDuration:C=!1}=f,$=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({product:t,weekStartUtc:l,weekEndUtc:c,periodMode:v,useCache:E,forceRefresh:m,includeTickets:i,includeNewTicketsByStages:k,includeCarryoverTickets:y,includeCarryoverTicketsByDuration:C})});if(!$.ok)throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (${$.status})`);const Y=await $.json();if((Y==null?void 0:Y.success)===!1)throw new Error(Y.message||"–ë—ç–∫–µ–Ω–¥ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É");return Vs(Y)}const Ys={class:"ac-dashboard-months"},xs={key:"content"},js={class:"dashboard-header"},zs={class:"header-content"},Hs={class:"breadcrumbs-row"},qs=["aria-label","aria-disabled","data-fallback","disabled"],Zs={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Js={class:"dashboard-layout"},Ks={class:"filters-container"},Xs={class:"chart-container"},Qs={__name:"GraphAdmissionClosureMonthsDashboard",setup(f){const s=Re(),t=I(!0),l=I(0),c=I("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."),v=I(null),E=I(null),m=I({newTickets:0,closedTickets:0,carryoverTickets:0,newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]}),i=I(!1),k=L(()=>typeof window>"u"?!1:window.history.length>1),y=L(()=>k.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),C={name:"dashboard-sector-1c"};function b(D){var S;if((S=D==null?void 0:D.preventDefault)==null||S.call(D),!i.value){i.value=!0;try{if(k.value){s.back();return}console.warn("GraphAdmissionClosureMonthsDashboard: fallback navigation to dashboard-sector-1c"),s.push(C)}finally{i.value=!1}}}const $=I({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),Y=L(()=>{const D=$.value.customDateRange.startDate||$.value.customDateRange.endDate,S=$.value.employees.length===1&&$.value.employees.includes("all");return D||!S});async function B(D,S,P=500){const V=l.value,q=10,Z=(D-V)/q,h=P/q;for(let a=0;a<q;a++)await new Promise(n=>setTimeout(n,h)),l.value=Math.min(V+Z*(a+1),D);l.value=D,c.value=S}async function O(){console.log("[DEBUG MonthsDashboard] loadData called"),console.log("[DEBUG MonthsDashboard] isLoading before:",t.value),t.value=!0,v.value=null,l.value=0,c.value="–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",console.log("[DEBUG MonthsDashboard] isLoading set to true");try{console.log("[DEBUG MonthsDashboard] Starting API call"),await B(10,"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",300),await B(40,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –æ–∫—Ç—è–±—Ä—å...",800),await B(70,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –Ω–æ—è–±—Ä—å...",800),await B(90,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –¥–µ–∫–∞–±—Ä—å...",800),await B(95,"–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...",400);const D=await re({product:"1C",periodMode:"months",includeTickets:!0});await B(100,"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",300),console.log("[DEBUG MonthsDashboard] API call successful, result:",D);const{meta:S,data:P}=D;E.value=S,m.value=P,console.log("[DEBUG MonthsDashboard] Data set, meta:",S,"data keys:",Object.keys(P)),await new Promise(V=>setTimeout(V,200))}catch(D){console.error("[DEBUG MonthsDashboard] API call failed:",D),v.value=D instanceof Error?D:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureMonthsDashboard] loadData error:",D),l.value=100}finally{console.log("[DEBUG MonthsDashboard] Finally block: setting isLoading to false"),t.value=!1,console.log("[DEBUG MonthsDashboard] isLoading after:",t.value)}}function g(D){$.value.stages=D}function o(D){$.value.employees=D}function A(D){$.value.dateRange=D}function T(D){$.value.customDateRange=D}function u(){$.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},_()}function _(){O()}function N(D){if(!["weeks","months"].includes(D)){console.warn("[GraphAdmissionClosureMonthsDashboard] Invalid periodMode:",D);return}D==="weeks"&&window.dispatchEvent(new CustomEvent("period-mode-change",{detail:{mode:D}}))}return _e(()=>{console.log("[DEBUG MonthsDashboard] onMounted called"),console.log("[DEBUG MonthsDashboard] isLoading before loadData:",t.value),O()}),(D,S)=>{const P=Ne("router-link");return r(),d("div",Ys,[G(J,{name:"fade",mode:"out-in"},{default:x(()=>[t.value?(r(),X(Ps,{key:"preloader",progress:l.value,"current-stage":c.value},null,8,["progress","current-stage"])):(r(),d("div",xs,[e("div",js,[e("div",zs,[e("div",Hs,[e("button",{class:"btn-back-link",type:"button",onClick:b,"aria-label":y.value,"aria-disabled":!k.value,"data-fallback":!k.value,disabled:i.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,qs),e("nav",Zs,[G(P,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:x(()=>[...S[0]||(S[0]=[ae(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),S[2]||(S[2]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),G(P,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:x(()=>[...S[1]||(S[1]=[ae(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),S[3]||(S[3]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),S[4]||(S[4]=e("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),S[5]||(S[5]=e("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),S[6]||(S[6]=e("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),e("div",Js,[e("div",Ks,[G(Le,{stages:$.value.stages,employees:$.value.employees,dateRange:$.value.dateRange,customDateRange:$.value.customDateRange,hasActiveFilters:Y.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":"months","onUpdate:stages":g,"onUpdate:employees":o,"onUpdate:dateRange":A,"onUpdate:customDateRange":T,"onUpdate:periodMode":N,onReset:u,onApply:_},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])]),e("div",Xs,[v.value?(r(),X(Ge,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:v.value.message},null,8,["message"])):(r(),d(j,{key:1},[G(ys,{data:m.value},null,8,["data"]),G(Is,{data:m.value,meta:E.value},null,8,["data","meta"])],64))])])]))]),_:1})])}}},ea=ee(Qs,[["__scopeId","data-v-e7421cc0"]]);class ge{static async getSectorData(){try{const s=await this.getAllTickets();console.log("Total tickets loaded:",s.length);const t=this.extractUniqueEmployeeIds(s);console.log("Unique employee IDs:",t);const l=await this.getEmployeesByIds(t);return console.log("Loaded employees:",l.length),{stages:this.groupTicketsByStages(s,l),employees:l,zeroPointTickets:this.getZeroPointTickets(s)}}catch(s){throw console.error("Error getting sector data:",s),s}}static async getAllTickets(){const s=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],t=[];for(const l of s){console.log(`Loading tickets for stage: ${l}`);const c=await this.getTicketsByStage(l);t.push(...c),console.log(`Loaded ${c.length} tickets for stage ${l}`)}return t}static async getTicketsByStage(s){const t=[];let l=0;const c=50;let v=!0;for(;v;)try{const m=await le.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:s},select:["*"],order:{id:"DESC"},start:l,useOriginalUfNames:"Y"});let i=[];m&&m.result&&(Array.isArray(m.result)?i=m.result:m.result.items&&Array.isArray(m.result.items)?i=m.result.items:m.result.data&&Array.isArray(m.result.data)&&(i=m.result.data)),i.length>0?(t.push(...i),l+=i.length,v=i.length===c):v=!1}catch(m){console.error(`Error loading tickets batch for stage ${s} (start: ${l}):`,m),v=!1}t.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(t[0],null,2)),console.log("Sample ticket keys:",Object.keys(t[0])),console.log("Sample ticket assignedById variants:",{assignedById:t[0].assignedById,assignedByIdId:t[0].assignedByIdId,ASSIGNED_BY_ID:t[0].ASSIGNED_BY_ID}));const E=t.filter(m=>{const i=m.UF_CRM_7_TYPE_PRODUCT||m.uf_crm_7_type_product||m.ufCrm7TypeProduct||m.UF_CRM_7_TYPE_PRODUCT||m.uf_crm_7_type_product;return Array.isArray(i)?i.includes(this.SECTOR_TAG):typeof i=="object"&&i!==null?i.value===this.SECTOR_TAG||i===this.SECTOR_TAG:i===this.SECTOR_TAG});return console.log(`Filtered ${E.length} tickets from ${t.length} for stage ${s} (sector tag: ${this.SECTOR_TAG})`),E}static extractUniqueEmployeeIds(s){if(!Array.isArray(s))return[];const t=new Set;return s.forEach(l=>{const c=l.assignedById||l.assignedByIdId||l.ASSIGNED_BY_ID||l.assignedById||l.assignedById&&typeof l.assignedById=="object"&&(l.assignedById.id||l.assignedById.ID)||l.assignedById&&typeof l.assignedById=="object"&&l.assignedById.value;if(c){const v=parseInt(c);v&&!isNaN(v)&&v>0&&t.add(v)}}),s.length>0&&(console.log("Sample ticket for employee extraction:",s[0]),console.log("Sample ticket assignedById variants:",{assignedById:s[0].assignedById,assignedByIdId:s[0].assignedByIdId,ASSIGNED_BY_ID:s[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(t))),Array.from(t)}static async getEmployeesByIds(s){if(!Array.isArray(s)||s.length===0)return[];try{const t=await le.call("user.get",{filter:{ID:s}});let l=[];return t&&t.result&&(Array.isArray(t.result)?l=t.result:console.warn("Unexpected user.get result format:",t)),l.map(c=>({id:parseInt(c.ID||c.id||0),name:`${c.NAME||c.name||""} ${c.LAST_NAME||c.lastName||""}`.trim()||c.EMAIL||c.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:c.WORK_POSITION||c.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:c.EMAIL||c.email||"",tickets:[]}))}catch(t){return console.error("Error getting employees by IDs:",t),[]}}static groupTicketsByStages(s,t){Array.isArray(s)||(console.warn("Tickets is not an array:",s),s=[]),Array.isArray(t)||(console.warn("Employees is not an array:",t),t=[]);const l=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:t.map(c=>({...c,tickets:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:t.map(c=>({...c,tickets:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:t.map(c=>({...c,tickets:[]}))}];return s.forEach(c=>{const v=this.mapStageId(c.stageId||c.STAGE_ID||""),E=l.find(m=>m.id===v);if(E){const m=c.assignedById||c.ASSIGNED_BY_ID||null,i=m?parseInt(m):null;if(i){let k=E.employees.find(y=>y.id===i);k||(k={id:i,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${i}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",tickets:[]},E.employees.push(k)),k.tickets.push(this.mapTicket(c))}}}),l}static mapStageId(s){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[s]||"formed"}static mapStageIdToBitrix(s){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[s]||"DT140_12:UC_0VHWE2"}static mapTicket(s){const t=parseInt(s.id||s.ID||0),l=s.title||s.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",c=s.stageId||s.STAGE_ID||"",v=s.assignedById||s.ASSIGNED_BY_ID||null,E=s.createdTime||s.CREATED_DATE||s.CREATED_TIME||"",m=s.updatedTime||s.MODIFY_DATE||s.UPDATED_TIME||"",i=s.UF_CRM_7_UF_PRIORITY||s.uf_crm_7_uf_priority||s.ufCrm7UfPriority||s.UF_CRM_7_UF_PRIORITY||s.uf_crm_7_uf_priority||s.priority||s.PRIORITY||null,k=Me(i),y=He(k);return{id:t,title:l,priorityId:k.id,priorityLabel:k.label,priorityColors:y,priority:k.id,priorityBitrixValue:k.bitrixValue||null,status:this.mapStatus(c),assigneeId:v?parseInt(v):null,stageId:this.mapStageId(c),createdAt:E,modifiedAt:m,amount:s.opportunity||s.OPPORTUNITY||0,currency:s.currencyId||s.CURRENCY_ID||"RUB",description:s.comments||s.COMMENTS||""}}static mapPriority(s){return Me(s).id}static mapPriorityToBitrix(s){if(s&&typeof s=="object")return s.bitrixValue||null;const t=Be(s);if(t&&t.bitrixValue)return t.bitrixValue;const l={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return l[s]?l[s]:Be(qe).bitrixValue}static mapStatus(s){return"in_progress"}static getZeroPointTickets(s){const t={formed:[],review:[],execution:[]};return Array.isArray(s)?(s.filter(l=>!(l.assignedById||l.ASSIGNED_BY_ID)).forEach(l=>{const c=this.mapStageId(l.stageId||l.STAGE_ID||"");t[c]&&t[c].push(this.mapTicket(l))}),t):(console.warn("Tickets is not an array in getZeroPointTickets:",s),t)}static async assignTicket(s,t,l){try{const c=this.mapStageIdToBitrix(l);return(await le.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:s,fields:{assignedById:t,stageId:c}})).result===!0}catch(c){throw console.error("Error assigning ticket:",c),c}}static async createTicket(s){try{const t=await le.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:s.title,assignedById:s.employeeId,stageId:this.mapStageIdToBitrix(s.stageId)}});return t.result?parseInt(t.result):0}catch(t){throw console.error("Error creating ticket:",t),t}}static async getTicket(s){try{const t=await le.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:s});return this.mapTicket(t.result)}catch(t){throw console.error("Error getting ticket:",t),t}}static async addComment(s,t){try{return(await le.call("crm.timeline.comment.add",{fields:{entityId:s,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:t}})).result!==void 0}catch(l){throw console.error("Error adding comment:",l),l}}}ye(ge,"ENTITY_TYPE_ID",140),ye(ge,"SECTOR_TAG","1C");const ta={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},sa={class:"modal"},aa={key:0,class:"modal__tabs"},oa={key:"level-0-categories",class:"level-0"},ra={class:"modal__header"},la={class:"modal__title"},na={key:0},ia={class:"modal__body"},da={class:"categories-list"},ca=["onClick"],ua={class:"category-item"},ka={class:"category-item__icon"},va={key:0},ha={key:1},ma={class:"category-item__content"},ya={class:"category-item__label"},ga={class:"category-item__count"},_a={key:0,class:"category-item__arrow"},pa={class:"modal__footer"},ba={key:"level-1-categories",class:"level-1"},fa={class:"modal__header"},wa={class:"modal__body"},Ta={key:"loading",class:"loading-names"},Ca={key:"empty",class:"modal__empty"},Da={key:"list",class:"responsible-list"},$a=["onClick"],Ea={class:"responsible-list__name"},Wa={class:"responsible-list__count"},Ia={key:0,class:"responsible-list__arrow"},Aa={class:"modal__footer"},Sa={key:"level-2-categories",class:"level-2"},Ua={class:"modal__header"},Ma={class:"modal__title"},Ba={class:"modal__body"},Oa={key:"loading",class:"loading-state"},Ra={key:"error",class:"error-state"},Na={class:"error-message"},Ga={key:"empty",class:"empty-state"},La={key:"tickets",class:"tickets-list-container"},Pa={key:"level-0-employees",class:"level-0"},Fa={class:"modal__header"},Va={class:"modal__title"},Ya={key:0},xa={class:"modal__body"},ja={key:"loading",class:"loading-names"},za={key:"empty",class:"modal__empty"},Ha={key:"list",class:"responsible-list"},qa=["onClick"],Za={class:"responsible-list__name"},Ja={class:"responsible-list__count"},Ka={key:0,class:"responsible-list__arrow"},Xa={class:"modal__footer"},Qa={key:"level-1-employees",class:"level-1"},eo={class:"modal__header"},to={class:"modal__title"},so={class:"modal__body"},ao={class:"categories-list"},oo=["onClick"],ro={class:"category-item"},lo={class:"category-item__icon"},no={key:0},io={key:1},co={class:"category-item__content"},uo={class:"category-item__label"},ko={class:"category-item__count"},vo={key:0,class:"category-item__arrow"},ho={class:"modal__footer"},mo={key:"level-2-employees",class:"level-2"},yo={class:"modal__header"},go={class:"modal__title"},_o={class:"modal__body"},po={key:"loading",class:"loading-state"},bo={key:"error",class:"error-state"},fo={class:"error-message"},wo={key:"empty",class:"empty-state"},To={class:"empty-state-message"},Co={key:"tickets",class:"tickets-list-container"},Do={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(f){const s=f,t=I(0),l=I("categories"),c=I(null),v=I(null),E=I(null),m=I([]),i=I(!1),k=I(null),y=I([]),C=I([]),b=I(!1),$=L(()=>[{id:"created-this-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é",count:s.closedTicketsCreatedThisWeek??0,responsible:s.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ",count:s.closedTicketsCreatedOtherWeek??0,responsible:s.responsibleCreatedOtherWeek??[]}]),Y=L(()=>{const h=new Map;return(s.responsibleCreatedThisWeek||[]).forEach(a=>{const n=a.id??"unassigned";h.has(n)||h.set(n,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const W=h.get(n);W.thisWeekCount=a.count??0,W.thisWeekTickets=a.tickets||[],W.totalCount+=W.thisWeekCount}),(s.responsibleCreatedOtherWeek||[]).forEach(a=>{const n=a.id??"unassigned";h.has(n)||h.set(n,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const W=h.get(n);W.otherWeekCount=a.count??0,W.otherWeekTickets=a.tickets||[],W.totalCount+=W.otherWeekCount}),Array.from(h.values())}),B=L(()=>{if(!v.value)return[];const h=v.value.thisWeekTickets||[],a=v.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:v.value.id,name:v.value.name,thisWeekCount:v.value.thisWeekCount,otherWeekCount:v.value.otherWeekCount,thisWeekTickets:h.length,otherWeekTickets:a.length,employee:v.value}),[{id:"this-week",label:"–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ",count:v.value.thisWeekCount??0,tickets:h,employeeId:v.value.id},{id:"other-week",label:"–ù–∞ –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ",count:v.value.otherWeekCount??0,tickets:a,employeeId:v.value.id}]}),O=L(()=>(C.value||[]).length>0);async function g(h){const a=h.filter(n=>n.id!==null&&n.id!==void 0).map(n=>n.id);if(a.length===0)return h;try{const n=await ge.getEmployeesByIds(a),W=new Map;return n.forEach(M=>{W.set(M.id,M.name)}),h.map(M=>M.id&&W.has(M.id)?{...M,name:W.get(M.id)}:M)}catch(n){return console.error("[ResponsibleModal] Error enriching names:",n),h}}te([()=>l.value,()=>Y.value],async([h,a])=>{if(!(h!=="employees"||t.value!==0)){if(!a||a.length===0){C.value=[];return}b.value=!0;try{C.value=await g(a)}catch(n){console.error("[ResponsibleModal] Error loading employee names:",n),C.value=a}finally{b.value=!1}}},{immediate:!0}),te(()=>s.responsible,async h=>{if(!(t.value!==0||c.value||l.value!=="categories")){if(!h||h.length===0){y.value=[];return}b.value=!0;try{y.value=await g(h)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),y.value=h}finally{b.value=!1}}},{immediate:!1});const o=L(()=>(y.value||[]).length>0);function A(h){l.value!==h&&(l.value=h,t.value=0,c.value=null,v.value=null,E.value=null,m.value=[],k.value=null,y.value=[],C.value=[])}async function T(h){if(!(!h||h.count===0)){c.value=h,t.value=1,b.value=!0;try{y.value=await g(h.responsible)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),y.value=h.responsible}finally{b.value=!1}}}async function u(h,a=null){var n,W;!h||!h.id||h.totalCount===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:h.id,name:h.name,thisWeekCount:h.thisWeekCount,otherWeekCount:h.otherWeekCount,thisWeekTickets:((n=h.thisWeekTickets)==null?void 0:n.length)||0,otherWeekTickets:((W=h.otherWeekTickets)==null?void 0:W.length)||0,employee:h}),v.value={...h,thisWeekTickets:h.thisWeekTickets||[],otherWeekTickets:h.otherWeekTickets||[]},t.value=1)}async function _(h){var n;if(!h||h.count===0)return;E.value=h,t.value=2;const a=h.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:h.id,label:h.label,count:h.count,ticketsInGradation:a.length,selectedEmployee:(n=v.value)==null?void 0:n.id}),a.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",a.length),await N(a)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await D(h))}async function N(h){i.value=!0,k.value=null;try{try{const{prepareTicketsForDisplay:a}=await ke(async()=>{const{prepareTicketsForDisplay:n}=await import("./ticketListUtils-DJgh0NR_.js").then(W=>W.t);return{prepareTicketsForDisplay:n}},__vite__mapDeps([0,1,2,3,4,5]));m.value=await a(h,null,null)}catch(a){console.error("[ResponsibleModal] Error preparing tickets:",a),m.value=h}m.value.length===0&&(k.value=null)}catch(a){k.value=a.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",a),m.value=[]}finally{i.value=!1}}async function D(h){i.value=!0,k.value=null;try{if(!s.weekStartUtc||!s.weekEndUtc||!v.value)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫");const a=await re({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeTickets:!0}),n=h.id==="this-week"?a.data.responsibleCreatedThisWeek:a.data.responsibleCreatedOtherWeek,W=n==null?void 0:n.find(U=>U.id===v.value.id),M=(W==null?void 0:W.tickets)||[];try{const{prepareTicketsForDisplay:U}=await ke(async()=>{const{prepareTicketsForDisplay:p}=await import("./ticketListUtils-DJgh0NR_.js").then(z=>z.t);return{prepareTicketsForDisplay:p}},__vite__mapDeps([0,1,2,3,4,5]));m.value=await U(M,null,null)}catch(U){console.error("[ResponsibleModal] Error preparing tickets:",U),m.value=M}m.value.length===0&&(k.value=null)}catch(a){k.value=a.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets from API:",a),m.value=[]}finally{i.value=!1}}async function S(h,a=null){!h||!h.id||h.count===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),v.value=h,t.value=2,await P(h.id))}async function P(h){var a;i.value=!0,k.value=null;try{let n=[];if(c.value&&c.value.responsible){const W=c.value.responsible.find(M=>M.id===h);n=(W==null?void 0:W.tickets)||[]}if(n.length===0&&s.weekStartUtc&&s.weekEndUtc){const W=await re({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeTickets:!0}),M=((a=c.value)==null?void 0:a.id)==="created-this-week"?W.data.responsibleCreatedThisWeek:W.data.responsibleCreatedOtherWeek,U=M==null?void 0:M.find(p=>p.id===h);n=(U==null?void 0:U.tickets)||[]}try{const{prepareTicketsForDisplay:W}=await ke(async()=>{const{prepareTicketsForDisplay:M}=await import("./ticketListUtils-DJgh0NR_.js").then(U=>U.t);return{prepareTicketsForDisplay:M}},__vite__mapDeps([0,1,2,3,4,5]));m.value=await W(n,null,null)}catch(W){console.error("[ResponsibleModal] Error preparing tickets:",W),m.value=n}m.value.length===0&&(k.value=null)}catch(n){k.value=n.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",n),m.value=[]}finally{i.value=!1}}function V(){t.value===2?(t.value=1,l.value==="categories"?v.value=null:E.value=null,m.value=[],k.value=null):t.value===1&&(t.value=0,l.value==="categories"?(c.value=null,y.value=[]):v.value=null)}function q(h){const a=pe(h.id);window.open(a,"_blank")}function Z(){l.value==="employees"&&E.value?N(E.value.tickets):l.value==="categories"&&v.value&&P(v.value.id)}return te(()=>s.isVisible,h=>{h||(t.value=0,l.value="categories",c.value=null,v.value=null,E.value=null,m.value=[],k.value=null,y.value=[],C.value=[])}),(h,a)=>f.isVisible?(r(),d("div",ta,[e("div",sa,[t.value===0?(r(),d("div",aa,[e("button",{class:K(["modal__tab",{"modal__tab--active":l.value==="categories"}]),onClick:a[0]||(a[0]=n=>A("categories"))}," –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º ",2),e("button",{class:K(["modal__tab",{"modal__tab--active":l.value==="employees"}]),onClick:a[1]||(a[1]=n=>A("employees"))}," –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º ",2)])):F("",!0),G(J,{name:"level",mode:"out-in"},{default:x(()=>{var n,W,M,U;return[l.value==="categories"&&t.value===0?(r(),d("div",oa,[e("header",ra,[e("h3",la,[a[12]||(a[12]=ae(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),f.weekNumber?(r(),d("span",na," ¬∑ –ù–µ–¥–µ–ª—è "+w(f.weekNumber),1)):F("",!0)]),e("button",{class:"modal__close",onClick:a[2]||(a[2]=p=>h.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",ia,[e("ul",da,[(r(!0),d(j,null,H($.value,p=>(r(),d("li",{key:p.id,class:K(["categories-list__item",{"categories-list__item--clickable":p.count>0}]),onClick:z=>T(p)},[e("div",ua,[e("div",ka,[p.id==="created-this-week"?(r(),d("span",va,"‚úì")):(r(),d("span",ha,"‚Üª"))]),e("div",ma,[e("div",ya,w(p.label),1),e("div",ga,w(p.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),p.count>0?(r(),d("span",_a,"‚Üí")):F("",!0)])],10,ca))),128))])]),e("footer",pa,[e("button",{class:"btn",onClick:a[3]||(a[3]=p=>h.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="categories"&&t.value===1?(r(),d("div",ba,[e("header",fa,[e("button",{class:"btn-back",onClick:V,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),a[13]||(a[13]=e("h3",{class:"modal__title"},"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),e("button",{class:"modal__close",onClick:a[4]||(a[4]=p=>h.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",wa,[G(J,{name:"loading",mode:"out-in"},{default:x(()=>[b.value?(r(),d("div",Ta,[...a[14]||(a[14]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):o.value?(r(),d("ul",Da,[(r(!0),d(j,null,H(y.value,p=>(r(),d("li",{key:p.id||p.name,class:K(["responsible-list__item",{"responsible-list__item--clickable":p.id&&p.count>0}]),onClick:z=>S(p,z),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[e("span",Ea,w(p.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),e("span",Wa,w(p.count??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),p.id&&p.count>0?(r(),d("span",Ia,"‚Üí")):F("",!0)],10,$a))),128))])):(r(),d("p",Ca,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º"))]),_:1})]),e("footer",Aa,[e("button",{class:"btn",onClick:a[5]||(a[5]=p=>h.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="categories"&&t.value===2?(r(),d("div",Sa,[e("header",Ua,[e("button",{class:"btn-back",onClick:V,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",Ma,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+w(((n=v.value)==null?void 0:n.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:a[6]||(a[6]=p=>h.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",Ba,[G(J,{name:"loading",mode:"out-in"},{default:x(()=>[i.value?(r(),d("div",Oa,[...a[15]||(a[15]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):k.value?(r(),d("div",Ra,[a[16]||(a[16]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),a[17]||(a[17]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",Na,w(k.value),1),e("button",{class:"btn btn-retry",onClick:Z},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):m.value.length===0?(r(),d("div",Ga,[...a[18]||(a[18]=[e("div",{class:"empty-state-icon"},"üìã",-1),e("p",{class:"empty-state-message"},"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é",-1)])])):(r(),d("div",La,[G(he,{name:"ticket",tag:"div",class:"tickets-list"},{default:x(()=>[(r(!0),d(j,null,H(m.value,(p,z)=>(r(),X(me,{key:p.id,ticket:p,draggable:!1,style:se({"--ticket-index":z}),onClick:q},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):l.value==="employees"&&t.value===0?(r(),d("div",Pa,[e("header",Fa,[e("h3",Va,[a[19]||(a[19]=ae(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),f.weekNumber?(r(),d("span",Ya," ¬∑ –ù–µ–¥–µ–ª—è "+w(f.weekNumber),1)):F("",!0)]),e("button",{class:"modal__close",onClick:a[7]||(a[7]=p=>h.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",xa,[G(J,{name:"loading",mode:"out-in"},{default:x(()=>[b.value?(r(),d("div",ja,[...a[20]||(a[20]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):O.value?(r(),d("ul",Ha,[(r(!0),d(j,null,H(C.value,p=>(r(),d("li",{key:p.id||p.name,class:K(["responsible-list__item",{"responsible-list__item--clickable":p.id&&p.totalCount>0}]),onClick:z=>u(p,z),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞–¥–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[e("span",Za,w(p.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),e("span",Ja,w(p.totalCount??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),p.id&&p.totalCount>0?(r(),d("span",Ka,"‚Üí")):F("",!0)],10,qa))),128))])):(r(),d("p",za,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"))]),_:1})]),e("footer",Xa,[e("button",{class:"btn",onClick:a[8]||(a[8]=p=>h.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="employees"&&t.value===1?(r(),d("div",Qa,[e("header",eo,[e("button",{class:"btn-back",onClick:V,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",to,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+w(((W=v.value)==null?void 0:W.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:a[9]||(a[9]=p=>h.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",so,[e("ul",ao,[(r(!0),d(j,null,H(B.value,p=>(r(),d("li",{key:p.id,class:K(["categories-list__item",{"categories-list__item--clickable":p.count>0}]),onClick:z=>_(p)},[e("div",ro,[e("div",lo,[p.id==="this-week"?(r(),d("span",no,"‚úì")):(r(),d("span",io,"‚Üª"))]),e("div",co,[e("div",uo,w(p.label),1),e("div",ko,w(p.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),p.count>0?(r(),d("span",vo,"‚Üí")):F("",!0)])],10,oo))),128))])]),e("footer",ho,[e("button",{class:"btn",onClick:a[10]||(a[10]=p=>h.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="employees"&&t.value===2?(r(),d("div",mo,[e("header",yo,[e("button",{class:"btn-back",onClick:V,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",go," –¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+w(((M=v.value)==null?void 0:M.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")+" ("+w(((U=E.value)==null?void 0:U.label)||"")+") ",1),e("button",{class:"modal__close",onClick:a[11]||(a[11]=p=>h.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",_o,[G(J,{name:"loading",mode:"out-in"},{default:x(()=>{var p;return[i.value?(r(),d("div",po,[...a[21]||(a[21]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):k.value?(r(),d("div",bo,[a[22]||(a[22]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),a[23]||(a[23]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",fo,w(k.value),1),e("button",{class:"btn btn-retry",onClick:Z},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):m.value.length===0?(r(),d("div",wo,[a[24]||(a[24]=e("div",{class:"empty-state-icon"},"üìã",-1)),e("p",To,w(l.value==="employees"?`–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${((p=E.value)==null?void 0:p.label)||""}"`:"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é"),1)])):(r(),d("div",Co,[G(he,{name:"ticket",tag:"div",class:"tickets-list"},{default:x(()=>[(r(!0),d(j,null,H(m.value,(z,Q)=>(r(),X(me,{key:z.id,ticket:z,draggable:!1,style:se({"--ticket-index":Q}),onClick:q},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):F("",!0)]}),_:1})])])):F("",!0)}},$o=ee(Do,[["__scopeId","data-v-3b229bb4"]]),Eo={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Wo={class:"modal"},Io={key:"level-1",class:"level-1"},Ao={class:"modal__header"},So={class:"modal__title"},Uo={key:0},Mo={class:"modal__body"},Bo={key:"loading",class:"loading-names"},Oo={key:"empty",class:"modal__empty"},Ro={key:"list",class:"stages-list"},No=["onClick"],Go={class:"stages-list__name"},Lo={class:"stages-list__count"},Po={key:0,class:"stages-list__arrow"},Fo={class:"modal__footer"},Vo={key:"level-2",class:"level-2"},Yo={class:"modal__header"},xo={class:"modal__title"},jo={class:"modal__body"},zo={key:"loading",class:"loading-state"},Ho={key:"error",class:"error-state"},qo={class:"error-message"},Zo={key:"empty",class:"empty-state"},Jo={class:"empty-state-message"},Ko={key:"tickets",class:"tickets-list-container"},Xo={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:s}){const t=f,l=I(1),c=I(null),v=I([]),E=I(!1),m=I(!1),i=I(null),k=I([]),y=L(()=>k.value.length>0&&k.value.some(g=>g.count>0));async function C(){if(!t.weekStartUtc||!t.weekEndUtc){k.value=[];return}m.value=!0,i.value=null;try{const g=await re({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0});k.value=g.data.newTicketsByStages||[]}catch(g){i.value=g.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–π",console.error("[StagesModal] Error loading stages:",g),k.value=[]}finally{m.value=!1}}async function b(g,o=null){!g||g.count===0||(o&&o.currentTarget&&(o.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{o.currentTarget&&(o.currentTarget.style.transform="")},150)),c.value=g,l.value=2,await $(g.stageId))}async function $(g){var o;E.value=!0,i.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const T=(o=(await re({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:o.find(_=>_.stageId===g),u=(T==null?void 0:T.tickets)||[];try{const{prepareTicketsForDisplay:_}=await ke(async()=>{const{prepareTicketsForDisplay:N}=await import("./ticketListUtils-DJgh0NR_.js").then(D=>D.t);return{prepareTicketsForDisplay:N}},__vite__mapDeps([0,1,2,3,4,5]));v.value=await _(u,null,null)}catch(_){console.error("[StagesModal] Error preparing tickets:",_),v.value=u}v.value.length===0&&(i.value=null)}catch(A){i.value=A.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[StagesModal] Error loading tickets:",A),v.value=[]}finally{E.value=!1}}function Y(){l.value=1,c.value=null,v.value=[],i.value=null}function B(g){const o=pe(g.id);window.open(o,"_blank")}function O(){c.value&&$(c.value.stageId)}return te(()=>t.isVisible,g=>{g?C():(l.value=1,c.value=null,v.value=[],i.value=null,k.value=[])}),te([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&C()}),(g,o)=>f.isVisible?(r(),d("div",Eo,[e("div",Wo,[G(J,{name:"level",mode:"out-in"},{default:x(()=>{var A;return[l.value===1?(r(),d("div",Io,[e("header",Ao,[e("h3",So,[o[3]||(o[3]=ae(" –ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),f.weekNumber?(r(),d("span",Uo," ¬∑ –ù–µ–¥–µ–ª—è "+w(f.weekNumber),1)):F("",!0)]),e("button",{class:"modal__close",onClick:o[0]||(o[0]=T=>g.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",Mo,[G(J,{name:"loading",mode:"out-in"},{default:x(()=>[m.value?(r(),d("div",Bo,[...o[4]||(o[4]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–π...",-1)])])):y.value?(r(),d("ul",Ro,[(r(!0),d(j,null,H(k.value,T=>(r(),d("li",{key:T.stageId,class:K(["stages-list__item",{"stages-list__item--clickable":T.count>0}]),style:se({"--stage-color":T.color}),onClick:u=>b(T,u),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏"},[e("span",{class:"stages-list__color",style:se({backgroundColor:T.color})},null,4),e("span",Go,w(T.stageName),1),e("span",Lo,w(T.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),T.count>0?(r(),d("span",Po,"‚Üí")):F("",!0)],14,No))),128))])):(r(),d("p",Oo," –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),e("footer",Fo,[e("button",{class:"btn",onClick:o[1]||(o[1]=T=>g.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value===2?(r(),d("div",Vo,[e("header",Yo,[e("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",xo," –¢–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏: "+w(((A=c.value)==null?void 0:A.stageName)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:o[2]||(o[2]=T=>g.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",jo,[G(J,{name:"loading",mode:"out-in"},{default:x(()=>{var T;return[E.value?(r(),d("div",zo,[...o[5]||(o[5]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):i.value?(r(),d("div",Ho,[o[6]||(o[6]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),o[7]||(o[7]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",qo,w(i.value),1),e("button",{class:"btn btn-retry",onClick:O},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):v.value.length===0?(r(),d("div",Zo,[o[8]||(o[8]=e("div",{class:"empty-state-icon"},"üìã",-1)),e("p",Jo," –ù–∞ —Å—Ç–∞–¥–∏–∏ ¬´"+w((T=c.value)==null?void 0:T.stageName)+"¬ª –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é ",1)])):(r(),d("div",Ko,[G(he,{name:"ticket",tag:"div",class:"tickets-list"},{default:x(()=>[(r(!0),d(j,null,H(v.value,(u,_)=>(r(),X(me,{key:u.id,ticket:u,draggable:!1,style:se({"--ticket-index":_}),onClick:B},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):F("",!0)]}),_:1})])])):F("",!0)}},Qo=ee(Xo,[["__scopeId","data-v-4af0cfce"]]),er={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},tr={class:"modal"},sr={key:"level-1",class:"level-1"},ar={class:"modal__header"},or={class:"modal__title"},rr={key:0},lr={class:"modal__body"},nr={key:"loading",class:"loading-names"},ir={key:"empty",class:"modal__empty"},dr={key:"list",class:"duration-list"},cr=["onClick"],ur={class:"duration-list__name"},kr={class:"duration-list__count"},vr={key:0,class:"duration-list__arrow"},hr={class:"modal__footer"},mr={key:"level-2",class:"level-2"},yr={class:"modal__header"},gr={class:"modal__title"},_r={class:"modal__body"},pr={key:"loading",class:"loading-state"},br={key:"error",class:"error-state"},fr={class:"error-message"},wr={key:"empty",class:"empty-state"},Tr={class:"empty-state-message"},Cr={key:"tickets",class:"tickets-list-container"},Dr={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:s}){const t=f,l=I(1),c=I(null),v=I([]),E=I(!1),m=I(!1),i=I(null),k=I([]),y=L(()=>k.value.length>0&&k.value.some(g=>g.count>0));async function C(){if(!t.weekStartUtc||!t.weekEndUtc){k.value=[];return}m.value=!0,i.value=null;try{const g=await re({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});k.value=g.data.carryoverTicketsByDuration||[]}catch(g){i.value=g.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π",console.error("[CarryoverDurationModal] Error loading categories:",g),k.value=[]}finally{m.value=!1}}async function b(g,o=null){!g||g.count===0||(o&&o.currentTarget&&(o.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{o.currentTarget&&(o.currentTarget.style.transform="")},150)),c.value=g,l.value=2,await $(g.durationCategory))}async function $(g){var o;E.value=!0,i.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const T=(o=(await re({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})).data.carryoverTicketsByDuration)==null?void 0:o.find(_=>_.durationCategory===g),u=(T==null?void 0:T.tickets)||[];try{const{prepareTicketsForDisplay:_}=await ke(async()=>{const{prepareTicketsForDisplay:N}=await import("./ticketListUtils-DJgh0NR_.js").then(D=>D.t);return{prepareTicketsForDisplay:N}},__vite__mapDeps([0,1,2,3,4,5]));v.value=await _(u,null,null)}catch(_){console.error("[CarryoverDurationModal] Error preparing tickets:",_),v.value=u}v.value.length===0&&(i.value=null)}catch(A){i.value=A.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[CarryoverDurationModal] Error loading tickets:",A),v.value=[]}finally{E.value=!1}}function Y(){l.value=1,c.value=null,v.value=[],i.value=null}function B(g){const o=pe(g.id);window.open(o,"_blank")}function O(){c.value&&$(c.value.durationCategory)}return te(()=>t.isVisible,g=>{g?C():(l.value=1,c.value=null,v.value=[],i.value=null,k.value=[])}),te([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&C()}),(g,o)=>f.isVisible?(r(),d("div",er,[e("div",tr,[G(J,{name:"level",mode:"out-in"},{default:x(()=>{var A;return[l.value===1?(r(),d("div",sr,[e("header",ar,[e("h3",or,[o[3]||(o[3]=ae(" –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ä–æ–∫–∞–º",-1)),f.weekNumber?(r(),d("span",rr," ¬∑ –ù–µ–¥–µ–ª—è "+w(f.weekNumber),1)):F("",!0)]),e("button",{class:"modal__close",onClick:o[0]||(o[0]=T=>g.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",lr,[G(J,{name:"loading",mode:"out-in"},{default:x(()=>[m.value?(r(),d("div",nr,[...o[4]||(o[4]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...",-1)])])):y.value?(r(),d("ul",dr,[(r(!0),d(j,null,H(k.value,T=>(r(),d("li",{key:T.durationCategory,class:K(["duration-list__item",{"duration-list__item--clickable":T.count>0}]),style:se({"--duration-color":T.color}),onClick:u=>b(T,u),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},[e("span",{class:"duration-list__color",style:se({backgroundColor:T.color})},null,4),e("span",ur,w(T.durationLabel),1),e("span",kr,w(T.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),T.count>0?(r(),d("span",vr,"‚Üí")):F("",!0)],14,cr))),128))])):(r(),d("p",ir," –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),e("footer",hr,[e("button",{class:"btn",onClick:o[1]||(o[1]=T=>g.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value===2?(r(),d("div",mr,[e("header",yr,[e("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",gr," –¢–∏–∫–µ—Ç—ã: "+w(((A=c.value)==null?void 0:A.durationLabel)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:o[2]||(o[2]=T=>g.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",_r,[G(J,{name:"loading",mode:"out-in"},{default:x(()=>{var T;return[E.value?(r(),d("div",pr,[...o[5]||(o[5]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):i.value?(r(),d("div",br,[o[6]||(o[6]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),o[7]||(o[7]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",fr,w(i.value),1),e("button",{class:"btn btn-retry",onClick:O},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):v.value.length===0?(r(),d("div",wr,[o[8]||(o[8]=e("div",{class:"empty-state-icon"},"üìã",-1)),e("p",Tr," –í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´"+w((T=c.value)==null?void 0:T.durationLabel)+"¬ª –Ω–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ ",1)])):(r(),d("div",Cr,[G(he,{name:"ticket",tag:"div",class:"tickets-list"},{default:x(()=>[(r(!0),d(j,null,H(v.value,(u,_)=>(r(),X(me,{key:u.id,ticket:u,draggable:!1,style:se({"--ticket-index":_}),onClick:B},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):F("",!0)]}),_:1})])])):F("",!0)}},$r=ee(Dr,[["__scopeId","data-v-c26f06c2"]]),Er={class:"ac-dashboard"},Wr={key:"preloader",class:"chart-preloader"},Ir={class:"preloader-content"},Ar={class:"preloader-message"},Sr={key:"content"},Ur={key:1,class:"weeks-dashboard"},Mr={class:"dashboard-header"},Br={class:"header-content"},Or={class:"breadcrumbs-row"},Rr=["aria-label","aria-disabled","data-fallback","disabled"],Nr={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Gr={class:"dashboard-layout"},Lr={class:"filters-container"},Pr={class:"chart-container"},Fr={__name:"GraphAdmissionClosureDashboard",setup(f){const s=Re(),t=I(!1),l=I(null),c=I(null),v=I({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),E=I(!1),m=I(!1),i=I(!1),k=I(!0),y=I(!1),C=L(()=>typeof window>"u"?!1:window.history.length>1),b=L(()=>C.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),$={name:"dashboard-sector-1c"};function Y(a){var n;if((n=a==null?void 0:a.preventDefault)==null||n.call(a),!y.value){y.value=!0;try{if(C.value){s.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),s.push($)}finally{y.value=!1}}}const B=I({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),O=I("weeks"),g=L(()=>{const a=B.value.customDateRange.startDate||B.value.customDateRange.endDate,n=B.value.employees.length===1&&B.value.employees.includes("all");return a||!n});async function o(){if(console.log("[DEBUG] loadData called"),console.log("[DEBUG] periodMode:",O.value),console.log("[DEBUG] isLoading before:",t.value),O.value!=="weeks"){console.log("[DEBUG] loadData: periodMode is not weeks, returning and resetting isLoading"),t.value=!1;return}console.log("[DEBUG] Setting isLoading to true"),t.value=!0,l.value=null;const a=new Promise(n=>setTimeout(n,300));try{console.log("[DEBUG] Starting API call");const n=h(),W=n.weekStartUtc,M=n.weekEndUtc;console.log("[DEBUG] Week bounds:",{weekStartUtc:W,weekEndUtc:M});const[U,p]=await Promise.all([a,re({product:"1C",periodMode:"weeks",weekStartUtc:W,weekEndUtc:M,includeTickets:!0})]);console.log("[DEBUG] API call successful, result:",p);const{meta:z,data:Q}=p;c.value=z,v.value=Q,console.log("[DEBUG] Data set, meta:",z,"data keys:",Object.keys(Q))}catch(n){console.error("[DEBUG] API call failed:",n),l.value=n instanceof Error?n:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureDashboard] loadData error:",n)}finally{console.log("[DEBUG] Finally block: setting isLoading to false"),t.value=!1,console.log("[DEBUG] isLoading after:",t.value)}}function A(a){B.value.stages=a}function T(a){B.value.employees=a}function u(a){B.value.dateRange=a}function _(a){B.value.customDateRange=a}function N(a){if(!["weeks","months"].includes(a)){console.warn("[GraphAdmissionClosureDashboard] Invalid periodMode:",a);return}a!==O.value&&(O.value=a,o())}function D(a){const{mode:n}=a.detail;["weeks","months"].includes(n)&&N(n)}function S(){B.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},P()}function P(){o()}function V(a){["weeks","months"].includes(a)&&(O.value=a)}function q(){console.log("[DEBUG] handleCloseModal called"),console.log("[DEBUG] showPeriodModeInfo before:",k.value),console.log("[DEBUG] isLoading before:",t.value),console.log("[DEBUG] periodMode:",O.value),k.value=!1,t.value=!0,console.log("[DEBUG] showPeriodModeInfo after:",k.value),console.log("[DEBUG] isLoading after:",t.value),Ue(()=>{console.log("[DEBUG] handleCloseModal: calling handleStartLoading in nextTick"),Z()})}function Z(){console.log("[DEBUG] handleStartLoading called"),console.log("[DEBUG] periodMode before check:",O.value),console.log("[DEBUG] showPeriodModeInfo:",k.value),console.log("[DEBUG] isLoading:",t.value),(!O.value||!["weeks","months"].includes(O.value))&&(console.warn('[GraphAdmissionClosureDashboard] Period mode not set, using default "weeks"'),O.value="weeks"),console.log("[GraphAdmissionClosureDashboard] Starting loading, periodMode:",O.value),Ue(()=>{console.log("[DEBUG] nextTick callback, periodMode:",O.value),console.log("[DEBUG] isLoading in nextTick:",t.value),O.value==="weeks"?(console.log("[GraphAdmissionClosureDashboard] Loading data for weeks mode"),o()):O.value==="months"&&(console.log("[GraphAdmissionClosureDashboard] Months mode - data will be loaded by GraphAdmissionClosureMonthsDashboard"),t.value=!1,console.log("[DEBUG] Reset parent isLoading to false for months mode"))})}_e(()=>{try{const a="graph-admission-closure-period-mode-info-shown";localStorage.getItem(a)&&localStorage.removeItem(a);const n="graph-admission-closure-period-mode";localStorage.getItem(n)&&localStorage.removeItem(n)}catch(a){console.warn("[GraphAdmissionClosureDashboard] Failed to clean localStorage:",a)}window.addEventListener("period-mode-change",D)}),Oe(()=>{window.removeEventListener("period-mode-change",D)});function h(){const a=new Date,n=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())),W=n.getUTCDay(),M=n.getUTCDate()-W+(W===0?-6:1),U=new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),M,0,0,0)),p=new Date(U);return p.setUTCDate(p.getUTCDate()+6),p.setUTCHours(23,59,59,999),{weekStartUtc:U.toISOString(),weekEndUtc:p.toISOString()}}return(a,n)=>{var M,U,p,z,Q,ie,de,ce,ue;const W=Ne("router-link");return r(),d("div",Er,[G(J,{name:"fade",mode:"out-in"},{default:x(()=>[t.value?(r(),d("div",Wr,[e("div",Ir,[n[6]||(n[6]=e("div",{class:"preloader-spinner"},[e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"})],-1)),n[7]||(n[7]=e("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞",-1)),e("p",Ar," –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ "+w(O.value==="weeks"?"4 –Ω–µ–¥–µ–ª–∏":"3 –º–µ—Å—è—Ü–∞")+"... ",1),n[8]||(n[8]=e("div",{class:"preloader-dots"},[e("span",{class:"dot"}),e("span",{class:"dot"}),e("span",{class:"dot"})],-1))])])):!k.value&&!t.value?(r(),d("div",Sr,[O.value==="months"?(r(),X(ea,{key:0})):(r(),d("div",Ur,[e("div",Mr,[e("div",Br,[e("div",Or,[e("button",{class:"btn-back-link",type:"button",onClick:Y,"aria-label":b.value,"aria-disabled":!C.value,"data-fallback":!C.value,disabled:y.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,Rr),e("nav",Nr,[G(W,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:x(()=>[...n[9]||(n[9]=[ae(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),n[11]||(n[11]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),G(W,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:x(()=>[...n[10]||(n[10]=[ae(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),n[12]||(n[12]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),n[13]||(n[13]=e("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),n[14]||(n[14]=e("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),n[15]||(n[15]=e("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),e("div",Gr,[e("div",Lr,[G(Le,{stages:B.value.stages,employees:B.value.employees,dateRange:B.value.dateRange,customDateRange:B.value.customDateRange,hasActiveFilters:g.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":O.value,"onUpdate:stages":A,"onUpdate:employees":T,"onUpdate:dateRange":u,"onUpdate:customDateRange":_,"onUpdate:periodMode":N,onReset:S,onApply:P},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","period-mode"])]),e("div",Pr,[l.value?(r(),X(Ge,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:l.value.message},null,8,["message"])):(r(),X(Mt,{key:1,meta:c.value,data:v.value,onOpenResponsible:n[0]||(n[0]=oe=>E.value=!0),onOpenStages:n[1]||(n[1]=oe=>m.value=!0),onOpenCarryover:n[2]||(n[2]=oe=>i.value=!0)},null,8,["meta","data"]))])])]))])):F("",!0)]),_:1}),G($o,{"is-visible":E.value,responsible:v.value.responsible||[],"closed-tickets-created-this-week":v.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":v.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":v.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":v.value.responsibleCreatedOtherWeek||[],"week-number":((M=c.value)==null?void 0:M.weekNumber)||null,"week-start-utc":((U=c.value)==null?void 0:U.weekStartUtc)||null,"week-end-utc":((p=c.value)==null?void 0:p.weekEndUtc)||null,onClose:n[3]||(n[3]=oe=>E.value=!1)},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),G(Qo,{"is-visible":m.value,"week-number":((z=c.value)==null?void 0:z.weekNumber)||null,"week-start-utc":((Q=c.value)==null?void 0:Q.weekStartUtc)||null,"week-end-utc":((ie=c.value)==null?void 0:ie.weekEndUtc)||null,onClose:n[4]||(n[4]=oe=>m.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"]),G($r,{"is-visible":i.value,"week-number":((de=c.value)==null?void 0:de.weekNumber)||null,"week-start-utc":((ce=c.value)==null?void 0:ce.weekStartUtc)||null,"week-end-utc":((ue=c.value)==null?void 0:ue.weekEndUtc)||null,onClose:n[5]||(n[5]=oe=>i.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"]),k.value?(r(),X(et,{key:0,"is-visible":k.value,"current-mode":O.value,onClose:q,onSelectMode:V},null,8,["is-visible","current-mode"])):F("",!0)])}}},Hr=ee(Fr,[["__scopeId","data-v-6c4434cd"]]);export{Hr as default};
