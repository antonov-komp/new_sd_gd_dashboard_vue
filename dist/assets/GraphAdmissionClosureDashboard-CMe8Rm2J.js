const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ticketListUtils-CjnchaEh.js","assets/priority-config-B4dmV9Ku.js","assets/main-BT0hfMCe.js","assets/main-hkNOQW78.css","assets/priority-config-Bxxce_5E.css","assets/ticket-mapper-C8r0j9gE.js"])))=>i.map(i=>d[i]);
var De=Object.defineProperty;var Se=(f,e,s)=>e in f?De(f,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):f[e]=s;var ie=(f,e,s)=>Se(f,typeof e!="symbol"?e+"":e,s);import{_ as le,g as E,c as G,a as d,o as i,b as t,t as C,F as z,e as J,n as K,d as q,f as x,G as Ue,H as F,I as ee,j as N,k as Y,B as Z,T as re,l as Q,J as ae,m as Oe,S as Ae,z as Be,r as Re,y as Ee,L as Ne}from"./main-BT0hfMCe.js";import{F as Me}from"./FiltersPanel-Dxta_X6q.js";import{L as Ie,D as Pe,B as Le}from"./index-D13D_rXM.js";import{B as se,g as We,a as Fe,b as $e,D as Ye,T as ne,c as de}from"./priority-config-B4dmV9Ku.js";const Ge={class:"ac-chart"},Ve={class:"ac-chart__header"},je={class:"ac-chart__subtitle"},He={class:"ac-chart__controls"},qe={class:"chart-type-selector"},ze=["onClick"],Je={class:"chart-type-icon"},Ze={class:"chart-type-label"},Xe={class:"ac-chart__summary"},Ke={class:"summary-card__value"},xe={class:"summary-card__value-main"},Qe={class:"summary-card__breakdown"},et={class:"breakdown-item breakdown-item--this-week"},tt={class:"breakdown-item__value"},st={class:"breakdown-item breakdown-item--other-week"},at={class:"breakdown-item__value"},lt={class:"summary-card__value-main"},ot={class:"summary-card__breakdown"},rt={class:"breakdown-item breakdown-item--this-week"},nt={class:"breakdown-item__value"},it={class:"breakdown-item breakdown-item--other-week"},ct={class:"breakdown-item__value"},dt={class:"summary-card summary-card--stages"},ut={class:"summary-card__tags"},kt={key:0,class:"stage-tag stage-tag--empty"},vt={class:"ac-chart__body"},_t={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(f,{emit:e}){const s=f,o=e,n=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],c=E("line");G(()=>{var I;return((I=s.meta)==null?void 0:I.weekNumber)??"‚Äî"});const w=G(()=>{var j,H,X,b,g,P,V,l,a,p,T,$,U,m,L;const I=(j=s.meta)==null?void 0:j.weekNumber,S=[I?`–ù–µ–¥–µ–ª—è ${I}`:"–ù–µ–¥–µ–ª—è"],M=[((X=(H=s.data.series)==null?void 0:H.new)==null?void 0:X[0])??s.data.newTickets??0],k=[((g=(b=s.data.series)==null?void 0:b.closed)==null?void 0:g[0])??s.data.closedTickets??0],r=[((V=(P=s.data.series)==null?void 0:P.closedCreatedThisWeek)==null?void 0:V[0])??s.data.closedTicketsCreatedThisWeek??0],D=[((a=(l=s.data.series)==null?void 0:l.closedCreatedOtherWeek)==null?void 0:a[0])??s.data.closedTicketsCreatedOtherWeek??0],h=[((T=(p=s.data.series)==null?void 0:p.carryover)==null?void 0:T[0])??s.data.carryoverTickets??0],A=[((U=($=s.data.series)==null?void 0:$.carryoverCreatedThisWeek)==null?void 0:U[0])??s.data.carryoverTicketsCreatedThisWeek??0],B=[((L=(m=s.data.series)==null?void 0:m.carryoverCreatedOtherWeek)==null?void 0:L[0])??s.data.carryoverTicketsCreatedOtherWeek??0];return{labels:S,datasets:[{label:"–ù–æ–≤—ã–µ",data:M,backgroundColor:F.primary,borderColor:F.primary,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:k,backgroundColor:F.success,borderColor:F.success,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:r,backgroundColor:F.successLight,borderColor:F.successLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:D,backgroundColor:F.warning,borderColor:F.warning,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:h,backgroundColor:F.carryover,borderColor:F.carryover,tension:.3,fill:!1},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:A,backgroundColor:F.carryoverLight,borderColor:F.carryoverLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:B,backgroundColor:F.carryoverDark,borderColor:F.carryoverDark,tension:.3,fill:!1,borderDash:[5,5]}]}}),u=G(()=>({labels:["–ù–æ–≤—ã–µ","–ó–∞–∫—Ä—ã—Ç—ã–µ","–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ"],datasets:[{data:[s.data.newTickets??0,s.data.closedTickets??0,s.data.carryoverTickets??0],backgroundColor:[F.primary,F.success,F.carryover],borderWidth:1}]})),v=G(()=>{switch(c.value){case"line":return Ie;case"bar":return Le;case"doughnut":return Pe;default:return Ie}}),y=G(()=>c.value==="doughnut"?u.value:w.value),W=I=>{if(!I)return"‚Äî";try{return new Date(I).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return I}},R=G(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{enabled:!0,callbacks:{title:I=>{var k,r,D,h;const _=(k=s.meta)==null?void 0:k.weekNumber,S=(r=s.meta)==null?void 0:r.weekStartUtc,M=(D=s.meta)==null?void 0:D.weekEndUtc;return _&&S&&M?`–ù–µ–¥–µ–ª—è ${_} (${W(S)} ‚Äî ${W(M)})`:((h=I[0])==null?void 0:h.label)||""}}},legend:{position:"top"}},scales:c.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0}},x:{ticks:{maxRotation:45,minRotation:45}}}})),O=I=>{var k,r,D,h;const _=((k=s.data)==null?void 0:k.newTickets)??0,S=((r=s.data)==null?void 0:r.closedTickets)??0,M=((D=s.data)==null?void 0:D.carryoverTickets)??0;I==="new"&&_>0?o("open-stages"):I==="closed"&&S>0?(((h=s.data)==null?void 0:h.responsible)||[]).length>0&&o("open-responsible"):I==="carryover"&&M>0&&o("open-carryover")};return(I,_)=>{var S,M,k;return i(),d("div",Ge,[t("header",Ve,[t("div",null,[_[3]||(_[3]=t("h2",{class:"ac-chart__title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),t("p",je," –ù–µ–¥–µ–ª—è "+C(((S=f.meta)==null?void 0:S.weekNumber)??"‚Äî")+" ¬∑ "+C(((M=f.meta)==null?void 0:M.weekStartUtc)||"‚Äî")+" ‚Äî "+C(((k=f.meta)==null?void 0:k.weekEndUtc)||"‚Äî")+" (UTC) ",1)]),t("div",He,[t("div",qe,[(i(),d(z,null,J(n,r=>t("button",{key:r.value,class:K(["chart-type-btn",{active:c.value===r.value}]),onClick:D=>c.value=r.value},[t("span",Je,C(r.icon),1),t("span",Ze,C(r.label),1)],10,ze)),64))])])]),t("section",Xe,[t("div",{class:"summary-card summary-card--new",onClick:_[0]||(_[0]=r=>O("new"))},[_[4]||(_[4]=t("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),t("div",Ke,C(f.data.newTickets??0),1)]),t("div",{class:"summary-card summary-card--closed-breakdown",onClick:_[1]||(_[1]=r=>O("closed"))},[_[9]||(_[9]=t("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),t("div",xe,C(f.data.closedTickets??0),1),t("div",Qe,[t("div",et,[_[5]||(_[5]=t("span",{class:"breakdown-item__icon"},"‚úì",-1)),t("span",tt,C(f.data.closedTicketsCreatedThisWeek??0),1),_[6]||(_[6]=t("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),t("div",st,[_[7]||(_[7]=t("span",{class:"breakdown-item__icon"},"‚Üª",-1)),t("span",at,C(f.data.closedTicketsCreatedOtherWeek??0),1),_[8]||(_[8]=t("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),t("div",{class:"summary-card summary-card--carryover-breakdown",onClick:_[2]||(_[2]=r=>O("carryover"))},[_[14]||(_[14]=t("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),t("div",lt,C(f.data.carryoverTickets??0),1),t("div",ot,[t("div",rt,[_[10]||(_[10]=t("span",{class:"breakdown-item__icon"},"‚úì",-1)),t("span",nt,C(f.data.carryoverTicketsCreatedThisWeek??0),1),_[11]||(_[11]=t("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),t("div",it,[_[12]||(_[12]=t("span",{class:"breakdown-item__icon"},"‚Üª",-1)),t("span",ct,C(f.data.carryoverTicketsCreatedOtherWeek??0),1),_[13]||(_[13]=t("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–∏—Ö",-1))])])]),t("div",dt,[_[15]||(_[15]=t("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),t("div",ut,[(i(!0),d(z,null,J(f.data.stages||[],r=>(i(),d("span",{key:r.stageId,class:"stage-tag"},C(r.stageName||r.stageId)+" ‚Äî "+C(r.count),1))),128)),!f.data.stages||f.data.stages.length===0?(i(),d("span",kt," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):q("",!0)])])]),t("div",vt,[(i(),x(Ue(v.value),{data:y.value,options:R.value},null,8,["data","options"]))])])}}},mt=le(_t,[["__scopeId","data-v-7d96ca95"]]);class ce{static async getSectorData(){try{const e=await this.getAllTickets();console.log("Total tickets loaded:",e.length);const s=this.extractUniqueEmployeeIds(e);console.log("Unique employee IDs:",s);const o=await this.getEmployeesByIds(s);return console.log("Loaded employees:",o.length),{stages:this.groupTicketsByStages(e,o),employees:o,zeroPointTickets:this.getZeroPointTickets(e)}}catch(e){throw console.error("Error getting sector data:",e),e}}static async getAllTickets(){const e=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],s=[];for(const o of e){console.log(`Loading tickets for stage: ${o}`);const n=await this.getTicketsByStage(o);s.push(...n),console.log(`Loaded ${n.length} tickets for stage ${o}`)}return s}static async getTicketsByStage(e){const s=[];let o=0;const n=50;let c=!0;for(;c;)try{const u=await se.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:e},select:["*"],order:{id:"DESC"},start:o,useOriginalUfNames:"Y"});let v=[];u&&u.result&&(Array.isArray(u.result)?v=u.result:u.result.items&&Array.isArray(u.result.items)?v=u.result.items:u.result.data&&Array.isArray(u.result.data)&&(v=u.result.data)),v.length>0?(s.push(...v),o+=v.length,c=v.length===n):c=!1}catch(u){console.error(`Error loading tickets batch for stage ${e} (start: ${o}):`,u),c=!1}s.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(s[0],null,2)),console.log("Sample ticket keys:",Object.keys(s[0])),console.log("Sample ticket assignedById variants:",{assignedById:s[0].assignedById,assignedByIdId:s[0].assignedByIdId,ASSIGNED_BY_ID:s[0].ASSIGNED_BY_ID}));const w=s.filter(u=>{const v=u.UF_CRM_7_TYPE_PRODUCT||u.uf_crm_7_type_product||u.ufCrm7TypeProduct||u.UF_CRM_7_TYPE_PRODUCT||u.uf_crm_7_type_product;return Array.isArray(v)?v.includes(this.SECTOR_TAG):typeof v=="object"&&v!==null?v.value===this.SECTOR_TAG||v===this.SECTOR_TAG:v===this.SECTOR_TAG});return console.log(`Filtered ${w.length} tickets from ${s.length} for stage ${e} (sector tag: ${this.SECTOR_TAG})`),w}static extractUniqueEmployeeIds(e){if(!Array.isArray(e))return[];const s=new Set;return e.forEach(o=>{const n=o.assignedById||o.assignedByIdId||o.ASSIGNED_BY_ID||o.assignedById||o.assignedById&&typeof o.assignedById=="object"&&(o.assignedById.id||o.assignedById.ID)||o.assignedById&&typeof o.assignedById=="object"&&o.assignedById.value;if(n){const c=parseInt(n);c&&!isNaN(c)&&c>0&&s.add(c)}}),e.length>0&&(console.log("Sample ticket for employee extraction:",e[0]),console.log("Sample ticket assignedById variants:",{assignedById:e[0].assignedById,assignedByIdId:e[0].assignedByIdId,ASSIGNED_BY_ID:e[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(s))),Array.from(s)}static async getEmployeesByIds(e){if(!Array.isArray(e)||e.length===0)return[];try{const s=await se.call("user.get",{filter:{ID:e}});let o=[];return s&&s.result&&(Array.isArray(s.result)?o=s.result:console.warn("Unexpected user.get result format:",s)),o.map(n=>({id:parseInt(n.ID||n.id||0),name:`${n.NAME||n.name||""} ${n.LAST_NAME||n.lastName||""}`.trim()||n.EMAIL||n.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:n.WORK_POSITION||n.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:n.EMAIL||n.email||"",tickets:[]}))}catch(s){return console.error("Error getting employees by IDs:",s),[]}}static groupTicketsByStages(e,s){Array.isArray(e)||(console.warn("Tickets is not an array:",e),e=[]),Array.isArray(s)||(console.warn("Employees is not an array:",s),s=[]);const o=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:s.map(n=>({...n,tickets:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:s.map(n=>({...n,tickets:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:s.map(n=>({...n,tickets:[]}))}];return e.forEach(n=>{const c=this.mapStageId(n.stageId||n.STAGE_ID||""),w=o.find(u=>u.id===c);if(w){const u=n.assignedById||n.ASSIGNED_BY_ID||null,v=u?parseInt(u):null;if(v){let y=w.employees.find(W=>W.id===v);y||(y={id:v,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${v}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",tickets:[]},w.employees.push(y)),y.tickets.push(this.mapTicket(n))}}}),o}static mapStageId(e){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[e]||"formed"}static mapStageIdToBitrix(e){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[e]||"DT140_12:UC_0VHWE2"}static mapTicket(e){const s=parseInt(e.id||e.ID||0),o=e.title||e.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",n=e.stageId||e.STAGE_ID||"",c=e.assignedById||e.ASSIGNED_BY_ID||null,w=e.createdTime||e.CREATED_DATE||e.CREATED_TIME||"",u=e.updatedTime||e.MODIFY_DATE||e.UPDATED_TIME||"",v=e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.ufCrm7UfPriority||e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.priority||e.PRIORITY||null,y=We(v),W=Fe(y);return{id:s,title:o,priorityId:y.id,priorityLabel:y.label,priorityColors:W,priority:y.id,priorityBitrixValue:y.bitrixValue||null,status:this.mapStatus(n),assigneeId:c?parseInt(c):null,stageId:this.mapStageId(n),createdAt:w,modifiedAt:u,amount:e.opportunity||e.OPPORTUNITY||0,currency:e.currencyId||e.CURRENCY_ID||"RUB",description:e.comments||e.COMMENTS||""}}static mapPriority(e){return We(e).id}static mapPriorityToBitrix(e){if(e&&typeof e=="object")return e.bitrixValue||null;const s=$e(e);if(s&&s.bitrixValue)return s.bitrixValue;const o={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return o[e]?o[e]:$e(Ye).bitrixValue}static mapStatus(e){return"in_progress"}static getZeroPointTickets(e){const s={formed:[],review:[],execution:[]};return Array.isArray(e)?(e.filter(o=>!(o.assignedById||o.ASSIGNED_BY_ID)).forEach(o=>{const n=this.mapStageId(o.stageId||o.STAGE_ID||"");s[n]&&s[n].push(this.mapTicket(o))}),s):(console.warn("Tickets is not an array in getZeroPointTickets:",e),s)}static async assignTicket(e,s,o){try{const n=this.mapStageIdToBitrix(o);return(await se.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:e,fields:{assignedById:s,stageId:n}})).result===!0}catch(n){throw console.error("Error assigning ticket:",n),n}}static async createTicket(e){try{const s=await se.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:e.title,assignedById:e.employeeId,stageId:this.mapStageIdToBitrix(e.stageId)}});return s.result?parseInt(s.result):0}catch(s){throw console.error("Error creating ticket:",s),s}}static async getTicket(e){try{const s=await se.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:e});return this.mapTicket(s.result)}catch(s){throw console.error("Error getting ticket:",s),s}}static async addComment(e,s){try{return(await se.call("crm.timeline.comment.add",{fields:{entityId:e,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:s}})).result!==void 0}catch(o){throw console.error("Error adding comment:",o),o}}}ie(ce,"ENTITY_TYPE_ID",140),ie(ce,"SECTOR_TAG","1C");const yt="/api/graph-1c-admission-closure.php";function pt(f){var o,n,c,w,u,v,y,W,R,O,I,_,S,M,k,r,D,h,A,B,j,H,X,b,g,P,V,l,a,p,T,$,U,m,L,oe,ue,ke,ve,_e,me,ye,pe,he,ge,Te,fe,be,Ce,we;if(!f)return{meta:null,data:{currentWeek:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0},newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},weeksData:[],stages:[],responsible:[],responsibleCreatedThisWeek:[],responsibleCreatedOtherWeek:[]}};const e=f.data||f.result||f,s=e.meta||f.meta||null;return{meta:{...s,currentWeek:(s==null?void 0:s.currentWeek)||(s?{weekNumber:s.weekNumber,weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc}:null),weeks:(s==null?void 0:s.weeks)||[]},data:{currentWeek:((o=e.data)==null?void 0:o.currentWeek)||(e.data?{newTickets:e.data.newTickets??0,closedTickets:e.data.closedTickets??0,closedTicketsCreatedThisWeek:e.data.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:e.data.closedTicketsCreatedOtherWeek??0,carryoverTickets:e.data.carryoverTickets??0,carryoverTicketsCreatedThisWeek:e.data.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:e.data.carryoverTicketsCreatedOtherWeek??0}:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0}),newTickets:((c=(n=e.data)==null?void 0:n.currentWeek)==null?void 0:c.newTickets)??((w=e.data)==null?void 0:w.newTickets)??e.newTickets??0,closedTickets:((v=(u=e.data)==null?void 0:u.currentWeek)==null?void 0:v.closedTickets)??((y=e.data)==null?void 0:y.closedTickets)??e.closedTickets??0,closedTicketsCreatedThisWeek:((R=(W=e.data)==null?void 0:W.currentWeek)==null?void 0:R.closedTicketsCreatedThisWeek)??((O=e.data)==null?void 0:O.closedTicketsCreatedThisWeek)??e.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:((_=(I=e.data)==null?void 0:I.currentWeek)==null?void 0:_.closedTicketsCreatedOtherWeek)??((S=e.data)==null?void 0:S.closedTicketsCreatedOtherWeek)??e.closedTicketsCreatedOtherWeek??0,carryoverTickets:((k=(M=e.data)==null?void 0:M.currentWeek)==null?void 0:k.carryoverTickets)??((r=e.data)==null?void 0:r.carryoverTickets)??e.carryoverTickets??0,carryoverTicketsCreatedThisWeek:((h=(D=e.data)==null?void 0:D.currentWeek)==null?void 0:h.carryoverTicketsCreatedThisWeek)??((A=e.data)==null?void 0:A.carryoverTicketsCreatedThisWeek)??e.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:((j=(B=e.data)==null?void 0:B.currentWeek)==null?void 0:j.carryoverTicketsCreatedOtherWeek)??((H=e.data)==null?void 0:H.carryoverTicketsCreatedOtherWeek)??e.carryoverTicketsCreatedOtherWeek??0,series:{new:((b=(X=e.data)==null?void 0:X.series)==null?void 0:b.new)??((g=e.series)==null?void 0:g.new)??[0],closed:((V=(P=e.data)==null?void 0:P.series)==null?void 0:V.closed)??((l=e.series)==null?void 0:l.closed)??[0],closedCreatedThisWeek:((p=(a=e.data)==null?void 0:a.series)==null?void 0:p.closedCreatedThisWeek)??((T=e.series)==null?void 0:T.closedCreatedThisWeek)??[0],closedCreatedOtherWeek:((U=($=e.data)==null?void 0:$.series)==null?void 0:U.closedCreatedOtherWeek)??((m=e.series)==null?void 0:m.closedCreatedOtherWeek)??[0],carryover:((oe=(L=e.data)==null?void 0:L.series)==null?void 0:oe.carryover)??((ue=e.series)==null?void 0:ue.carryover)??[0],carryoverCreatedThisWeek:((ve=(ke=e.data)==null?void 0:ke.series)==null?void 0:ve.carryoverCreatedThisWeek)??((_e=e.series)==null?void 0:_e.carryoverCreatedThisWeek)??[0],carryoverCreatedOtherWeek:((ye=(me=e.data)==null?void 0:me.series)==null?void 0:ye.carryoverCreatedOtherWeek)??((pe=e.series)==null?void 0:pe.carryoverCreatedOtherWeek)??[0]},weeksData:((he=e.data)==null?void 0:he.weeksData)??e.weeksData??[],stages:((ge=e.data)==null?void 0:ge.stages)??e.stages??[],responsible:((Te=e.data)==null?void 0:Te.responsible)??e.responsible??[],responsibleCreatedThisWeek:((fe=e.data)==null?void 0:fe.responsibleCreatedThisWeek)??e.responsibleCreatedThisWeek??[],responsibleCreatedOtherWeek:((be=e.data)==null?void 0:be.responsibleCreatedOtherWeek)??e.responsibleCreatedOtherWeek??[],newTicketsByStages:((Ce=e.data)==null?void 0:Ce.newTicketsByStages)??e.newTicketsByStages??null,carryoverTicketsByDuration:((we=e.data)==null?void 0:we.carryoverTicketsByDuration)??e.carryoverTicketsByDuration??null}}}async function te(f={}){const{endpoint:e=yt,product:s="1C",weekStartUtc:o=null,weekEndUtc:n=null,useCache:c=!0,forceRefresh:w=!1,includeTickets:u=!1,includeNewTicketsByStages:v=!1,includeCarryoverTickets:y=!0,includeCarryoverTicketsByDuration:W=!1}=f,O=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({product:s,weekStartUtc:o,weekEndUtc:n,useCache:c,forceRefresh:w,includeTickets:u,includeNewTicketsByStages:v,includeCarryoverTickets:y,includeCarryoverTicketsByDuration:W})});if(!O.ok)throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (${O.status})`);const I=await O.json();if((I==null?void 0:I.success)===!1)throw new Error(I.message||"–ë—ç–∫–µ–Ω–¥ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É");return pt(I)}const ht={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},gt={class:"modal"},Tt={key:0,class:"modal__tabs"},ft={key:"level-0-categories",class:"level-0"},bt={class:"modal__header"},Ct={class:"modal__body"},wt={class:"categories-list"},Et=["onClick"],It={class:"category-item"},Wt={class:"category-item__icon"},$t={key:0},Dt={key:1},St={class:"category-item__content"},Ut={class:"category-item__label"},Ot={class:"category-item__count"},At={key:0,class:"category-item__arrow"},Bt={class:"modal__footer"},Rt={key:"level-1-categories",class:"level-1"},Nt={class:"modal__header"},Mt={class:"modal__body"},Pt={key:"loading",class:"loading-names"},Lt={key:"empty",class:"modal__empty"},Ft={key:"list",class:"responsible-list"},Yt=["onClick"],Gt={class:"responsible-list__name"},Vt={class:"responsible-list__count"},jt={key:0,class:"responsible-list__arrow"},Ht={class:"modal__footer"},qt={key:"level-2-categories",class:"level-2"},zt={class:"modal__header"},Jt={class:"modal__title"},Zt={class:"modal__body"},Xt={key:"loading",class:"loading-state"},Kt={key:"error",class:"error-state"},xt={class:"error-message"},Qt={key:"empty",class:"empty-state"},es={key:"tickets",class:"tickets-list-container"},ts={key:"level-0-employees",class:"level-0"},ss={class:"modal__header"},as={class:"modal__body"},ls={key:"loading",class:"loading-names"},os={key:"empty",class:"modal__empty"},rs={key:"list",class:"responsible-list"},ns=["onClick"],is={class:"responsible-list__name"},cs={class:"responsible-list__count"},ds={key:0,class:"responsible-list__arrow"},us={class:"modal__footer"},ks={key:"level-1-employees",class:"level-1"},vs={class:"modal__header"},_s={class:"modal__title"},ms={class:"modal__body"},ys={class:"categories-list"},ps=["onClick"],hs={class:"category-item"},gs={class:"category-item__icon"},Ts={key:0},fs={key:1},bs={class:"category-item__content"},Cs={class:"category-item__label"},ws={class:"category-item__count"},Es={key:0,class:"category-item__arrow"},Is={class:"modal__footer"},Ws={key:"level-2-employees",class:"level-2"},$s={class:"modal__header"},Ds={class:"modal__title"},Ss={class:"modal__body"},Us={key:"loading",class:"loading-state"},Os={key:"error",class:"error-state"},As={class:"error-message"},Bs={key:"empty",class:"empty-state"},Rs={class:"empty-state-message"},Ns={key:"tickets",class:"tickets-list-container"},Ms={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(f){const e=f,s=E(0),o=E("categories"),n=E(null),c=E(null),w=E(null),u=E([]),v=E(!1),y=E(null),W=E([]),R=E([]),O=E(!1),I=G(()=>[{id:"created-this-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é",count:e.closedTicketsCreatedThisWeek??0,responsible:e.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ",count:e.closedTicketsCreatedOtherWeek??0,responsible:e.responsibleCreatedOtherWeek??[]}]),_=G(()=>{const l=new Map;return(e.responsibleCreatedThisWeek||[]).forEach(a=>{const p=a.id??"unassigned";l.has(p)||l.set(p,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const T=l.get(p);T.thisWeekCount=a.count??0,T.thisWeekTickets=a.tickets||[],T.totalCount+=T.thisWeekCount}),(e.responsibleCreatedOtherWeek||[]).forEach(a=>{const p=a.id??"unassigned";l.has(p)||l.set(p,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const T=l.get(p);T.otherWeekCount=a.count??0,T.otherWeekTickets=a.tickets||[],T.totalCount+=T.otherWeekCount}),Array.from(l.values())}),S=G(()=>{if(!c.value)return[];const l=c.value.thisWeekTickets||[],a=c.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:c.value.id,name:c.value.name,thisWeekCount:c.value.thisWeekCount,otherWeekCount:c.value.otherWeekCount,thisWeekTickets:l.length,otherWeekTickets:a.length,employee:c.value}),[{id:"this-week",label:"–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ",count:c.value.thisWeekCount??0,tickets:l,employeeId:c.value.id},{id:"other-week",label:"–ù–∞ –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ",count:c.value.otherWeekCount??0,tickets:a,employeeId:c.value.id}]}),M=G(()=>(R.value||[]).length>0);async function k(l){const a=l.filter(p=>p.id!==null&&p.id!==void 0).map(p=>p.id);if(a.length===0)return l;try{const p=await ce.getEmployeesByIds(a),T=new Map;return p.forEach($=>{T.set($.id,$.name)}),l.map($=>$.id&&T.has($.id)?{...$,name:T.get($.id)}:$)}catch(p){return console.error("[ResponsibleModal] Error enriching names:",p),l}}ee([()=>o.value,()=>_.value],async([l,a])=>{if(!(l!=="employees"||s.value!==0)){if(!a||a.length===0){R.value=[];return}O.value=!0;try{R.value=await k(a)}catch(p){console.error("[ResponsibleModal] Error loading employee names:",p),R.value=a}finally{O.value=!1}}},{immediate:!0}),ee(()=>e.responsible,async l=>{if(!(s.value!==0||n.value||o.value!=="categories")){if(!l||l.length===0){W.value=[];return}O.value=!0;try{W.value=await k(l)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),W.value=l}finally{O.value=!1}}},{immediate:!1});const r=G(()=>(W.value||[]).length>0);function D(l){o.value!==l&&(o.value=l,s.value=0,n.value=null,c.value=null,w.value=null,u.value=[],y.value=null,W.value=[],R.value=[])}async function h(l){if(!(!l||l.count===0)){n.value=l,s.value=1,O.value=!0;try{W.value=await k(l.responsible)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),W.value=l.responsible}finally{O.value=!1}}}async function A(l,a=null){var p,T;!l||!l.id||l.totalCount===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:l.id,name:l.name,thisWeekCount:l.thisWeekCount,otherWeekCount:l.otherWeekCount,thisWeekTickets:((p=l.thisWeekTickets)==null?void 0:p.length)||0,otherWeekTickets:((T=l.otherWeekTickets)==null?void 0:T.length)||0,employee:l}),c.value={...l,thisWeekTickets:l.thisWeekTickets||[],otherWeekTickets:l.otherWeekTickets||[]},s.value=1)}async function B(l){var p;if(!l||l.count===0)return;w.value=l,s.value=2;const a=l.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:l.id,label:l.label,count:l.count,ticketsInGradation:a.length,selectedEmployee:(p=c.value)==null?void 0:p.id}),a.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",a.length),await j(a)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await H(l))}async function j(l){v.value=!0,y.value=null;try{try{const{prepareTicketsForDisplay:a}=await ae(async()=>{const{prepareTicketsForDisplay:p}=await import("./ticketListUtils-CjnchaEh.js").then(T=>T.t);return{prepareTicketsForDisplay:p}},__vite__mapDeps([0,1,2,3,4,5]));u.value=await a(l,null,null)}catch(a){console.error("[ResponsibleModal] Error preparing tickets:",a),u.value=l}u.value.length===0&&(y.value=null)}catch(a){y.value=a.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",a),u.value=[]}finally{v.value=!1}}async function H(l){v.value=!0,y.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc||!c.value)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫");const a=await te({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeTickets:!0}),p=l.id==="this-week"?a.data.responsibleCreatedThisWeek:a.data.responsibleCreatedOtherWeek,T=p==null?void 0:p.find(U=>U.id===c.value.id),$=(T==null?void 0:T.tickets)||[];try{const{prepareTicketsForDisplay:U}=await ae(async()=>{const{prepareTicketsForDisplay:m}=await import("./ticketListUtils-CjnchaEh.js").then(L=>L.t);return{prepareTicketsForDisplay:m}},__vite__mapDeps([0,1,2,3,4,5]));u.value=await U($,null,null)}catch(U){console.error("[ResponsibleModal] Error preparing tickets:",U),u.value=$}u.value.length===0&&(y.value=null)}catch(a){y.value=a.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets from API:",a),u.value=[]}finally{v.value=!1}}async function X(l,a=null){!l||!l.id||l.count===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),c.value=l,s.value=2,await b(l.id))}async function b(l){var a;v.value=!0,y.value=null;try{let p=[];if(n.value&&n.value.responsible){const T=n.value.responsible.find($=>$.id===l);p=(T==null?void 0:T.tickets)||[]}if(p.length===0&&e.weekStartUtc&&e.weekEndUtc){const T=await te({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeTickets:!0}),$=((a=n.value)==null?void 0:a.id)==="created-this-week"?T.data.responsibleCreatedThisWeek:T.data.responsibleCreatedOtherWeek,U=$==null?void 0:$.find(m=>m.id===l);p=(U==null?void 0:U.tickets)||[]}try{const{prepareTicketsForDisplay:T}=await ae(async()=>{const{prepareTicketsForDisplay:$}=await import("./ticketListUtils-CjnchaEh.js").then(U=>U.t);return{prepareTicketsForDisplay:$}},__vite__mapDeps([0,1,2,3,4,5]));u.value=await T(p,null,null)}catch(T){console.error("[ResponsibleModal] Error preparing tickets:",T),u.value=p}u.value.length===0&&(y.value=null)}catch(p){y.value=p.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",p),u.value=[]}finally{v.value=!1}}function g(){s.value===2?(s.value=1,o.value==="categories"?c.value=null:w.value=null,u.value=[],y.value=null):s.value===1&&(s.value=0,o.value==="categories"?(n.value=null,W.value=[]):c.value=null)}function P(l){const a=de(l.id);window.open(a,"_blank")}function V(){o.value==="employees"&&w.value?j(w.value.tickets):o.value==="categories"&&c.value&&b(c.value.id)}return ee(()=>e.isVisible,l=>{l||(s.value=0,o.value="categories",n.value=null,c.value=null,w.value=null,u.value=[],y.value=null,W.value=[],R.value=[])}),(l,a)=>f.isVisible?(i(),d("div",ht,[t("div",gt,[s.value===0?(i(),d("div",Tt,[t("button",{class:K(["modal__tab",{"modal__tab--active":o.value==="categories"}]),onClick:a[0]||(a[0]=p=>D("categories"))}," –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º ",2),t("button",{class:K(["modal__tab",{"modal__tab--active":o.value==="employees"}]),onClick:a[1]||(a[1]=p=>D("employees"))}," –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º ",2)])):q("",!0),N(Z,{name:"level",mode:"out-in"},{default:Y(()=>{var p,T,$,U;return[o.value==="categories"&&s.value===0?(i(),d("div",ft,[t("header",bt,[a[12]||(a[12]=t("h3",{class:"modal__title"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),t("button",{class:"modal__close",onClick:a[2]||(a[2]=m=>l.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),t("section",Ct,[t("ul",wt,[(i(!0),d(z,null,J(I.value,m=>(i(),d("li",{key:m.id,class:K(["categories-list__item",{"categories-list__item--clickable":m.count>0}]),onClick:L=>h(m)},[t("div",It,[t("div",Wt,[m.id==="created-this-week"?(i(),d("span",$t,"‚úì")):(i(),d("span",Dt,"‚Üª"))]),t("div",St,[t("div",Ut,C(m.label),1),t("div",Ot,C(m.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),m.count>0?(i(),d("span",At,"‚Üí")):q("",!0)])],10,Et))),128))])]),t("footer",Bt,[t("button",{class:"btn",onClick:a[3]||(a[3]=m=>l.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):o.value==="categories"&&s.value===1?(i(),d("div",Rt,[t("header",Nt,[t("button",{class:"btn-back",onClick:g,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),a[13]||(a[13]=t("h3",{class:"modal__title"},"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),t("button",{class:"modal__close",onClick:a[4]||(a[4]=m=>l.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),t("section",Mt,[N(Z,{name:"loading",mode:"out-in"},{default:Y(()=>[O.value?(i(),d("div",Pt,[...a[14]||(a[14]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):r.value?(i(),d("ul",Ft,[(i(!0),d(z,null,J(W.value,m=>(i(),d("li",{key:m.id||m.name,class:K(["responsible-list__item",{"responsible-list__item--clickable":m.id&&m.count>0}]),onClick:L=>X(m,L),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[t("span",Gt,C(m.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),t("span",Vt,C(m.count??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),m.id&&m.count>0?(i(),d("span",jt,"‚Üí")):q("",!0)],10,Yt))),128))])):(i(),d("p",Lt,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º"))]),_:1})]),t("footer",Ht,[t("button",{class:"btn",onClick:a[5]||(a[5]=m=>l.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):o.value==="categories"&&s.value===2?(i(),d("div",qt,[t("header",zt,[t("button",{class:"btn-back",onClick:g,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),t("h3",Jt,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+C(((p=c.value)==null?void 0:p.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),t("button",{class:"modal__close",onClick:a[6]||(a[6]=m=>l.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),t("section",Zt,[N(Z,{name:"loading",mode:"out-in"},{default:Y(()=>[v.value?(i(),d("div",Xt,[...a[15]||(a[15]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):y.value?(i(),d("div",Kt,[a[16]||(a[16]=t("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),a[17]||(a[17]=t("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),t("p",xt,C(y.value),1),t("button",{class:"btn btn-retry",onClick:V},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):u.value.length===0?(i(),d("div",Qt,[...a[18]||(a[18]=[t("div",{class:"empty-state-icon"},"üìã",-1),t("p",{class:"empty-state-message"},"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é",-1)])])):(i(),d("div",es,[N(re,{name:"ticket",tag:"div",class:"tickets-list"},{default:Y(()=>[(i(!0),d(z,null,J(u.value,(m,L)=>(i(),x(ne,{key:m.id,ticket:m,draggable:!1,style:Q({"--ticket-index":L}),onClick:P},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):o.value==="employees"&&s.value===0?(i(),d("div",ts,[t("header",ss,[a[19]||(a[19]=t("h3",{class:"modal__title"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),t("button",{class:"modal__close",onClick:a[7]||(a[7]=m=>l.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),t("section",as,[N(Z,{name:"loading",mode:"out-in"},{default:Y(()=>[O.value?(i(),d("div",ls,[...a[20]||(a[20]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):M.value?(i(),d("ul",rs,[(i(!0),d(z,null,J(R.value,m=>(i(),d("li",{key:m.id||m.name,class:K(["responsible-list__item",{"responsible-list__item--clickable":m.id&&m.totalCount>0}]),onClick:L=>A(m,L),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞–¥–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[t("span",is,C(m.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),t("span",cs,C(m.totalCount??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),m.id&&m.totalCount>0?(i(),d("span",ds,"‚Üí")):q("",!0)],10,ns))),128))])):(i(),d("p",os,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"))]),_:1})]),t("footer",us,[t("button",{class:"btn",onClick:a[8]||(a[8]=m=>l.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):o.value==="employees"&&s.value===1?(i(),d("div",ks,[t("header",vs,[t("button",{class:"btn-back",onClick:g,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),t("h3",_s,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+C(((T=c.value)==null?void 0:T.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),t("button",{class:"modal__close",onClick:a[9]||(a[9]=m=>l.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),t("section",ms,[t("ul",ys,[(i(!0),d(z,null,J(S.value,m=>(i(),d("li",{key:m.id,class:K(["categories-list__item",{"categories-list__item--clickable":m.count>0}]),onClick:L=>B(m)},[t("div",hs,[t("div",gs,[m.id==="this-week"?(i(),d("span",Ts,"‚úì")):(i(),d("span",fs,"‚Üª"))]),t("div",bs,[t("div",Cs,C(m.label),1),t("div",ws,C(m.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),m.count>0?(i(),d("span",Es,"‚Üí")):q("",!0)])],10,ps))),128))])]),t("footer",Is,[t("button",{class:"btn",onClick:a[10]||(a[10]=m=>l.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):o.value==="employees"&&s.value===2?(i(),d("div",Ws,[t("header",$s,[t("button",{class:"btn-back",onClick:g,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),t("h3",Ds," –¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+C((($=c.value)==null?void 0:$.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")+" ("+C(((U=w.value)==null?void 0:U.label)||"")+") ",1),t("button",{class:"modal__close",onClick:a[11]||(a[11]=m=>l.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),t("section",Ss,[N(Z,{name:"loading",mode:"out-in"},{default:Y(()=>{var m;return[v.value?(i(),d("div",Us,[...a[21]||(a[21]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):y.value?(i(),d("div",Os,[a[22]||(a[22]=t("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),a[23]||(a[23]=t("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),t("p",As,C(y.value),1),t("button",{class:"btn btn-retry",onClick:V},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):u.value.length===0?(i(),d("div",Bs,[a[24]||(a[24]=t("div",{class:"empty-state-icon"},"üìã",-1)),t("p",Rs,C(o.value==="employees"?`–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${((m=w.value)==null?void 0:m.label)||""}"`:"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é"),1)])):(i(),d("div",Ns,[N(re,{name:"ticket",tag:"div",class:"tickets-list"},{default:Y(()=>[(i(!0),d(z,null,J(u.value,(L,oe)=>(i(),x(ne,{key:L.id,ticket:L,draggable:!1,style:Q({"--ticket-index":oe}),onClick:P},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):q("",!0)]}),_:1})])])):q("",!0)}},Ps=le(Ms,[["__scopeId","data-v-a33ffe22"]]),Ls={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Fs={class:"modal"},Ys={key:"level-1",class:"level-1"},Gs={class:"modal__header"},Vs={class:"modal__body"},js={key:"loading",class:"loading-names"},Hs={key:"empty",class:"modal__empty"},qs={key:"list",class:"stages-list"},zs=["onClick"],Js={class:"stages-list__name"},Zs={class:"stages-list__count"},Xs={key:0,class:"stages-list__arrow"},Ks={class:"modal__footer"},xs={key:"level-2",class:"level-2"},Qs={class:"modal__header"},ea={class:"modal__title"},ta={class:"modal__body"},sa={key:"loading",class:"loading-state"},aa={key:"error",class:"error-state"},la={class:"error-message"},oa={key:"empty",class:"empty-state"},ra={class:"empty-state-message"},na={key:"tickets",class:"tickets-list-container"},ia={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:e}){const s=f,o=E(1),n=E(null),c=E([]),w=E(!1),u=E(!1),v=E(null),y=E([]),W=G(()=>y.value.length>0&&y.value.some(k=>k.count>0));async function R(){if(!s.weekStartUtc||!s.weekEndUtc){y.value=[];return}u.value=!0,v.value=null;try{const k=await te({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeNewTicketsByStages:!0});y.value=k.data.newTicketsByStages||[]}catch(k){v.value=k.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–π",console.error("[StagesModal] Error loading stages:",k),y.value=[]}finally{u.value=!1}}async function O(k,r=null){!k||k.count===0||(r&&r.currentTarget&&(r.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{r.currentTarget&&(r.currentTarget.style.transform="")},150)),n.value=k,o.value=2,await I(k.stageId))}async function I(k){var r;w.value=!0,v.value=null;try{if(!s.weekStartUtc||!s.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const h=(r=(await te({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:r.find(B=>B.stageId===k),A=(h==null?void 0:h.tickets)||[];try{const{prepareTicketsForDisplay:B}=await ae(async()=>{const{prepareTicketsForDisplay:j}=await import("./ticketListUtils-CjnchaEh.js").then(H=>H.t);return{prepareTicketsForDisplay:j}},__vite__mapDeps([0,1,2,3,4,5]));c.value=await B(A,null,null)}catch(B){console.error("[StagesModal] Error preparing tickets:",B),c.value=A}c.value.length===0&&(v.value=null)}catch(D){v.value=D.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[StagesModal] Error loading tickets:",D),c.value=[]}finally{w.value=!1}}function _(){o.value=1,n.value=null,c.value=[],v.value=null}function S(k){const r=de(k.id);window.open(r,"_blank")}function M(){n.value&&I(n.value.stageId)}return ee(()=>s.isVisible,k=>{k?R():(o.value=1,n.value=null,c.value=[],v.value=null,y.value=[])}),ee([()=>s.weekStartUtc,()=>s.weekEndUtc],()=>{s.isVisible&&R()}),(k,r)=>f.isVisible?(i(),d("div",Ls,[t("div",Fs,[N(Z,{name:"level",mode:"out-in"},{default:Y(()=>{var D;return[o.value===1?(i(),d("div",Ys,[t("header",Gs,[r[3]||(r[3]=t("h3",{class:"modal__title"},"–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),t("button",{class:"modal__close",onClick:r[0]||(r[0]=h=>k.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),t("section",Vs,[N(Z,{name:"loading",mode:"out-in"},{default:Y(()=>[u.value?(i(),d("div",js,[...r[4]||(r[4]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–π...",-1)])])):W.value?(i(),d("ul",qs,[(i(!0),d(z,null,J(y.value,h=>(i(),d("li",{key:h.stageId,class:K(["stages-list__item",{"stages-list__item--clickable":h.count>0}]),style:Q({"--stage-color":h.color}),onClick:A=>O(h,A),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏"},[t("span",{class:"stages-list__color",style:Q({backgroundColor:h.color})},null,4),t("span",Js,C(h.stageName),1),t("span",Zs,C(h.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),h.count>0?(i(),d("span",Xs,"‚Üí")):q("",!0)],14,zs))),128))])):(i(),d("p",Hs," –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),t("footer",Ks,[t("button",{class:"btn",onClick:r[1]||(r[1]=h=>k.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):o.value===2?(i(),d("div",xs,[t("header",Qs,[t("button",{class:"btn-back",onClick:_,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),t("h3",ea," –¢–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏: "+C(((D=n.value)==null?void 0:D.stageName)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),t("button",{class:"modal__close",onClick:r[2]||(r[2]=h=>k.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),t("section",ta,[N(Z,{name:"loading",mode:"out-in"},{default:Y(()=>{var h;return[w.value?(i(),d("div",sa,[...r[5]||(r[5]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):v.value?(i(),d("div",aa,[r[6]||(r[6]=t("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),r[7]||(r[7]=t("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),t("p",la,C(v.value),1),t("button",{class:"btn btn-retry",onClick:M},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):c.value.length===0?(i(),d("div",oa,[r[8]||(r[8]=t("div",{class:"empty-state-icon"},"üìã",-1)),t("p",ra," –ù–∞ —Å—Ç–∞–¥–∏–∏ ¬´"+C((h=n.value)==null?void 0:h.stageName)+"¬ª –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é ",1)])):(i(),d("div",na,[N(re,{name:"ticket",tag:"div",class:"tickets-list"},{default:Y(()=>[(i(!0),d(z,null,J(c.value,(A,B)=>(i(),x(ne,{key:A.id,ticket:A,draggable:!1,style:Q({"--ticket-index":B}),onClick:S},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):q("",!0)]}),_:1})])])):q("",!0)}},ca=le(ia,[["__scopeId","data-v-d15a3c66"]]),da={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},ua={class:"modal"},ka={key:"level-1",class:"level-1"},va={class:"modal__header"},_a={class:"modal__body"},ma={key:"loading",class:"loading-names"},ya={key:"empty",class:"modal__empty"},pa={key:"list",class:"duration-list"},ha=["onClick"],ga={class:"duration-list__name"},Ta={class:"duration-list__count"},fa={key:0,class:"duration-list__arrow"},ba={class:"modal__footer"},Ca={key:"level-2",class:"level-2"},wa={class:"modal__header"},Ea={class:"modal__title"},Ia={class:"modal__body"},Wa={key:"loading",class:"loading-state"},$a={key:"error",class:"error-state"},Da={class:"error-message"},Sa={key:"empty",class:"empty-state"},Ua={class:"empty-state-message"},Oa={key:"tickets",class:"tickets-list-container"},Aa={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:e}){const s=f,o=E(1),n=E(null),c=E([]),w=E(!1),u=E(!1),v=E(null),y=E([]),W=G(()=>y.value.length>0&&y.value.some(k=>k.count>0));async function R(){if(!s.weekStartUtc||!s.weekEndUtc){y.value=[];return}u.value=!0,v.value=null;try{const k=await te({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});y.value=k.data.carryoverTicketsByDuration||[]}catch(k){v.value=k.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π",console.error("[CarryoverDurationModal] Error loading categories:",k),y.value=[]}finally{u.value=!1}}async function O(k,r=null){!k||k.count===0||(r&&r.currentTarget&&(r.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{r.currentTarget&&(r.currentTarget.style.transform="")},150)),n.value=k,o.value=2,await I(k.durationCategory))}async function I(k){var r;w.value=!0,v.value=null;try{if(!s.weekStartUtc||!s.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const h=(r=(await te({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})).data.carryoverTicketsByDuration)==null?void 0:r.find(B=>B.durationCategory===k),A=(h==null?void 0:h.tickets)||[];try{const{prepareTicketsForDisplay:B}=await ae(async()=>{const{prepareTicketsForDisplay:j}=await import("./ticketListUtils-CjnchaEh.js").then(H=>H.t);return{prepareTicketsForDisplay:j}},__vite__mapDeps([0,1,2,3,4,5]));c.value=await B(A,null,null)}catch(B){console.error("[CarryoverDurationModal] Error preparing tickets:",B),c.value=A}c.value.length===0&&(v.value=null)}catch(D){v.value=D.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[CarryoverDurationModal] Error loading tickets:",D),c.value=[]}finally{w.value=!1}}function _(){o.value=1,n.value=null,c.value=[],v.value=null}function S(k){const r=de(k.id);window.open(r,"_blank")}function M(){n.value&&I(n.value.durationCategory)}return ee(()=>s.isVisible,k=>{k?R():(o.value=1,n.value=null,c.value=[],v.value=null,y.value=[])}),ee([()=>s.weekStartUtc,()=>s.weekEndUtc],()=>{s.isVisible&&R()}),(k,r)=>f.isVisible?(i(),d("div",da,[t("div",ua,[N(Z,{name:"level",mode:"out-in"},{default:Y(()=>{var D;return[o.value===1?(i(),d("div",ka,[t("header",va,[r[3]||(r[3]=t("h3",{class:"modal__title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ä–æ–∫–∞–º",-1)),t("button",{class:"modal__close",onClick:r[0]||(r[0]=h=>k.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),t("section",_a,[N(Z,{name:"loading",mode:"out-in"},{default:Y(()=>[u.value?(i(),d("div",ma,[...r[4]||(r[4]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...",-1)])])):W.value?(i(),d("ul",pa,[(i(!0),d(z,null,J(y.value,h=>(i(),d("li",{key:h.durationCategory,class:K(["duration-list__item",{"duration-list__item--clickable":h.count>0}]),style:Q({"--duration-color":h.color}),onClick:A=>O(h,A),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},[t("span",{class:"duration-list__color",style:Q({backgroundColor:h.color})},null,4),t("span",ga,C(h.durationLabel),1),t("span",Ta,C(h.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),h.count>0?(i(),d("span",fa,"‚Üí")):q("",!0)],14,ha))),128))])):(i(),d("p",ya," –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),t("footer",ba,[t("button",{class:"btn",onClick:r[1]||(r[1]=h=>k.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):o.value===2?(i(),d("div",Ca,[t("header",wa,[t("button",{class:"btn-back",onClick:_,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),t("h3",Ea," –¢–∏–∫–µ—Ç—ã: "+C(((D=n.value)==null?void 0:D.durationLabel)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),t("button",{class:"modal__close",onClick:r[2]||(r[2]=h=>k.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),t("section",Ia,[N(Z,{name:"loading",mode:"out-in"},{default:Y(()=>{var h;return[w.value?(i(),d("div",Wa,[...r[5]||(r[5]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):v.value?(i(),d("div",$a,[r[6]||(r[6]=t("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),r[7]||(r[7]=t("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),t("p",Da,C(v.value),1),t("button",{class:"btn btn-retry",onClick:M},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):c.value.length===0?(i(),d("div",Sa,[r[8]||(r[8]=t("div",{class:"empty-state-icon"},"üìã",-1)),t("p",Ua," –í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´"+C((h=n.value)==null?void 0:h.durationLabel)+"¬ª –Ω–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ ",1)])):(i(),d("div",Oa,[N(re,{name:"ticket",tag:"div",class:"tickets-list"},{default:Y(()=>[(i(!0),d(z,null,J(c.value,(A,B)=>(i(),x(ne,{key:A.id,ticket:A,draggable:!1,style:Q({"--ticket-index":B}),onClick:S},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):q("",!0)]}),_:1})])])):q("",!0)}},Ba=le(Aa,[["__scopeId","data-v-83a6f8c8"]]),Ra={class:"ac-dashboard"},Na={key:1},Ma={class:"dashboard-header"},Pa={class:"header-content"},La={class:"breadcrumbs-row"},Fa=["aria-label","aria-disabled","data-fallback","disabled"],Ya={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Ga={class:"dashboard-layout"},Va={class:"filters-container"},ja={class:"chart-container"},Ha={__name:"GraphAdmissionClosureDashboard",setup(f){const e=Be(),s=E(!0),o=E(null),n=E(null),c=E({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),w=E(!1),u=E(!1),v=E(!1),y=E(!1),W=G(()=>typeof window>"u"?!1:window.history.length>1),R=G(()=>W.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),O={name:"dashboard-sector-1c"};function I(b){var g;if((g=b==null?void 0:b.preventDefault)==null||g.call(b),!y.value){y.value=!0;try{if(W.value){e.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),e.push(O)}finally{y.value=!1}}}const _=E({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),S=E(null),M=G(()=>{const b=_.value.customDateRange.startDate||_.value.customDateRange.endDate,g=_.value.employees.length===1&&_.value.employees.includes("all");return b||!g});async function k(){s.value=!0,o.value=null;try{let b,g;if(S.value)b=S.value.startUtc,g=S.value.endUtc;else{const l=X();b=l.weekStartUtc,g=l.weekEndUtc}const{meta:P,data:V}=await te({product:"1C",weekStartUtc:b,weekEndUtc:g,includeTickets:!0});n.value=P,c.value=V,!S.value&&P&&(S.value={weekNumber:P.weekNumber,startUtc:P.weekStartUtc,endUtc:P.weekEndUtc})}catch(b){o.value=b instanceof Error?b:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureDashboard] loadData error:",b)}finally{s.value=!1}}function r(b){_.value.stages=b}function D(b){_.value.employees=b}function h(b){_.value.dateRange=b}function A(b){_.value.customDateRange=b}function B(b){S.value=b}function j(){_.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},H()}function H(){k()}Oe(()=>{k()});function X(){const b=new Date,g=new Date(Date.UTC(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate())),P=g.getUTCDay(),V=g.getUTCDate()-P+(P===0?-6:1),l=new Date(Date.UTC(g.getUTCFullYear(),g.getUTCMonth(),V,0,0,0)),a=new Date(l);return a.setUTCDate(a.getUTCDate()+6),a.setUTCHours(23,59,59,999),{weekStartUtc:l.toISOString(),weekEndUtc:a.toISOString()}}return(b,g)=>{var V,l,a,p,T,$;const P=Re("router-link");return i(),d("div",Ra,[s.value?(i(),x(Ne,{key:0,message:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."})):(i(),d("div",Na,[t("div",Ma,[t("div",Pa,[t("div",La,[t("button",{class:"btn-back-link",type:"button",onClick:I,"aria-label":R.value,"aria-disabled":!W.value,"data-fallback":!W.value,disabled:y.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,Fa),t("nav",Ya,[N(P,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:Y(()=>[...g[6]||(g[6]=[Ee(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),g[8]||(g[8]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),N(P,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:Y(()=>[...g[7]||(g[7]=[Ee(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),g[9]||(g[9]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),g[10]||(g[10]=t("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),g[11]||(g[11]=t("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),g[12]||(g[12]=t("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),t("div",Ga,[t("div",Va,[N(Me,{stages:_.value.stages,employees:_.value.employees,dateRange:_.value.dateRange,customDateRange:_.value.customDateRange,hasActiveFilters:M.value,hideStages:!0,weekPickerMode:!0,selectedWeek:S.value,weeksCount:52,"onUpdate:stages":r,"onUpdate:employees":D,"onUpdate:dateRange":h,"onUpdate:customDateRange":A,"onUpdate:selectedWeek":B,onReset:j,onApply:H},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","selectedWeek"])]),t("div",ja,[o.value?(i(),x(Ae,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:o.value.message},null,8,["message"])):(i(),x(mt,{key:1,meta:n.value,data:c.value,onOpenResponsible:g[0]||(g[0]=U=>w.value=!0),onOpenStages:g[1]||(g[1]=U=>u.value=!0),onOpenCarryover:g[2]||(g[2]=U=>v.value=!0)},null,8,["meta","data"]))])])])),N(Ps,{"is-visible":w.value,responsible:c.value.responsible||[],"closed-tickets-created-this-week":c.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":c.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":c.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":c.value.responsibleCreatedOtherWeek||[],"week-start-utc":((V=n.value)==null?void 0:V.weekStartUtc)||null,"week-end-utc":((l=n.value)==null?void 0:l.weekEndUtc)||null,onClose:g[3]||(g[3]=U=>w.value=!1)},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-start-utc","week-end-utc"]),N(ca,{"is-visible":u.value,"week-start-utc":((a=n.value)==null?void 0:a.weekStartUtc)||null,"week-end-utc":((p=n.value)==null?void 0:p.weekEndUtc)||null,onClose:g[4]||(g[4]=U=>u.value=!1)},null,8,["is-visible","week-start-utc","week-end-utc"]),N(Ba,{"is-visible":v.value,"week-start-utc":((T=n.value)==null?void 0:T.weekStartUtc)||null,"week-end-utc":(($=n.value)==null?void 0:$.weekEndUtc)||null,onClose:g[5]||(g[5]=U=>v.value=!1)},null,8,["is-visible","week-start-utc","week-end-utc"])])}}},Ka=le(Ha,[["__scopeId","data-v-56000c45"]]);export{Ka as default};
