const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./direct-access-config-CmlMIQE4.js","./chunk-SN5klnRu.js","./chunk-BeqOLNMR.js","./access-config-async-R2Y78dGz.js","./chunk-J8T_k_VI.js","./chunk-DdeY5zWL.js","./chunk-DvnTAM4m.js","./WebhookLogsDashboard.vue-BGYExqNL.js","./WebhookLogDetails.vue-BKgU23H6.js","./DashboardSector1C.vue-DKspsb1P.js","./chunk-LHRoIqC4.js","./chunk-DDkaCoCd.js","./chunk-B5D7QuKi.js","./chunk-0VTR1C-m.js","./GraphAdmissionClosureDashboard.vue-KTxjjqOg.js","./chunk-g5F8XVHr.js","./dashboard-sector-1c-service-e577qKlQ.js","./GraphStateDashboard.vue-BL-vXA16.js","./TicketsTimeTrackingDashboard.vue-CHHGCIex.js"])))=>i.map(i=>d[i]);
var Wt=Object.defineProperty;var qt=(n,e,a)=>e in n?Wt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var Re=(n,e,a)=>qt(n,typeof e!="symbol"?e+"":e,a);import{r as W,c as d,o as c,a as J,b as M,d as Ht,t as g,n as N,e as s,f as re,g as p,h as de,w as _e,i as G,F as $,j,k as fe,l as D,u as Ye,m as ee,p as Xt,T as Ie,q as z,v as Ge,s as Ne,x as Ee,y as be,z as De,A as ne,B as qe,C as Jt,D as kt,E as Ct,G as tt,H as Ue,I as ct,L as dt,P as St,J as Dt,K as ut,M as gt,N as mt,O as Tt,Q as At,R as Et,S as Mt,U as Yt,V as Kt,W as Gt,X as Qt,Y as Zt,Z as es,_ as ts,$ as ss}from"./chunk-J8T_k_VI.js";import{a as xt,_ as ve,g as Ae}from"./chunk-SN5klnRu.js";import{C as yt}from"./chunk-DdeY5zWL.js";import{A as as}from"./chunk-DvnTAM4m.js";import"./chunk-BeqOLNMR.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const H=(n,e)=>{const a=n.__vccOpts||n;for(const[t,r]of e)a[t]=r;return a},os={name:"App"},ns={id:"app"};function rs(n,e,a,t,r,i){const o=W("router-view");return c(),d("div",ns,[J(o)])}const is=H(os,[["render",rs]]),ls={name:"StatusMessage",props:{type:{type:String,required:!0,validator:n=>["success","error","info","warning"].includes(n)},title:{type:String,default:null},message:{type:String,default:null}}},cs={key:0},ds={key:1};function us(n,e,a,t,r,i){return c(),d("div",{class:N(["status-message",`status-message--${a.type}`])},[a.title?(c(),d("strong",cs,g(a.title),1)):M("",!0),a.message?(c(),d("p",ds,g(a.message),1)):M("",!0),Ht(n.$slots,"default",{},void 0)],2)}const It=H(ls,[["render",us],["__scopeId","data-v-7f15d2d7"]]),gs={name:"LoadingSpinner",props:{message:{type:String,default:"–ó–∞–≥—Ä—É–∑–∫–∞..."}}},ms={class:"loading-spinner"},hs={key:0,class:"message"};function vs(n,e,a,t,r,i){return c(),d("div",ms,[e[0]||(e[0]=s("div",{class:"spinner"},null,-1)),a.message?(c(),d("p",hs,g(a.message),1)):M("",!0)])}const Lt=H(gs,[["render",vs],["__scopeId","data-v-375eac16"]]);function Ve(){try{if(window.self===window.top)return!1;if(typeof BX24<"u")return!0;try{const n=window.parent.location.origin;return n.includes("bitrix24")||n.includes("kompo.by")}catch{return!1}}catch(n){return console.warn("Error checking Bitrix24 context:",n),!1}}function fs(){return typeof BX24<"u"}class Le{static init(e){return new Promise((a,t)=>{if(!Ve()){console.log("Not inside Bitrix24, skipping BX24.init()"),e&&e(),a();return}if(typeof BX24>"u"){t(new Error("Bitrix24 API not loaded. Make sure script is included: //api.bitrix24.com/api/v1/"));return}const r=setTimeout(()=>{t(new Error("BX24.init() timeout: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥"))},5e3);try{BX24.init(()=>{clearTimeout(r),e&&e(),a()})}catch(i){clearTimeout(r),t(i)}})}static installFinish(){return new Promise((e,a)=>{if(typeof BX24>"u"){a(new Error("Bitrix24 API not loaded"));return}try{BX24.installFinish(),e()}catch(t){a(t)}})}static callMethod(e,a={}){return new Promise((t,r)=>{if(typeof BX24>"u"){r(new Error("Bitrix24 API not loaded"));return}const i=setTimeout(()=>{r(new Error(`BX24.callMethod(${e}) timeout: –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—ã—Å–∏–ª 10 —Å–µ–∫—É–Ω–¥`))},1e4);try{BX24.callMethod(e,a,o=>{if(clearTimeout(i),o.error()){const l=o.error();r(new Error(l.error_description||l.error||"Unknown error"))}else t(o.data())})}catch(o){clearTimeout(i),r(o)}})}static async getCurrentUser(){if(Ve()&&fs())try{const e=await Promise.race([this.callMethod("user.current",{}),new Promise((a,t)=>setTimeout(()=>t(new Error("Timeout")),5e3))]);return console.log("Got user from BX24.callMethod() (interface user):",e?.ID||"unknown"),e}catch(e){console.warn("BX24.callMethod() failed, using proxy API as fallback:",e);try{const t=await new yt().getCurrentUser();return console.log("Got user from proxy API (token owner, fallback):",t),t}catch(a){throw console.error("Both BX24 API and proxy API failed:",a),e.message&&e.message.includes("timeout")?new Error("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Bitrix24 API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç."):new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}else return console.warn("Not inside Bitrix24, using proxy API (will return token owner, not interface user)"),await new yt().getCurrentUser()}static getUser(){return new Promise((e,a)=>{if(typeof BX24>"u"){a(new Error("Bitrix24 API not loaded"));return}if(typeof BX24.getUser!="function"){a(new Error("BX24.getUser is not available"));return}BX24.getUser(t=>{e(t)})})}static getAuth(){return new Promise((e,a)=>{if(typeof BX24>"u"){a(new Error("Bitrix24 API not loaded"));return}BX24.getAuth(t=>{e(t)})})}}const ps={name:"InstallPage",components:{StatusMessage:It,LoadingSpinner:Lt},setup(){const n=p(!0),e=p(null),a=p(null);return de(async()=>{try{let t=null;if(window.INSTALL_RESULT)t=window.INSTALL_RESULT;else{const r=xt("/install.php"),i=await fetch(`${r}?get_result=1`);i.ok&&(t=await i.json())}if(!t)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏");if(a.value=t,t.rest_only===!1)if(t.install===!0){e.value={type:"success",title:"‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!",message:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24."};try{await Le.init(()=>{Le.installFinish()})}catch(r){console.error("Error finishing installation:",r)}}else e.value={type:"error",title:"‚úó –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."};else e.value={type:"info",title:"REST-only —Ä–µ–∂–∏–º",message:"–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ REST API, –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."}}catch(t){console.error("Error loading install result:",t),e.value={type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ."}}finally{n.value=!1}}),{loading:n,installStatus:e,installInfo:a}}},ys={class:"install-page"},_s={class:"container"},bs={key:1,class:"info"};function ws(n,e,a,t,r,i){const o=W("StatusMessage"),l=W("LoadingSpinner");return c(),d("div",ys,[s("div",_s,[e[1]||(e[1]=s("h1",null,"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1)),t.installStatus?(c(),re(o,{key:0,type:t.installStatus.type,title:t.installStatus.title,message:t.installStatus.message},null,8,["type","title","message"])):M("",!0),t.installInfo?(c(),d("div",bs,[e[0]||(e[0]=s("h3",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:",-1)),s("pre",null,g(JSON.stringify(t.installInfo,null,2)),1)])):M("",!0),t.loading?(c(),re(l,{key:2,message:"–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."})):M("",!0)])])}const ks=H(ps,[["render",ws],["__scopeId","data-v-d082ec9e"]]),Be={allowedDepartmentIds:[369,366,7],adminDepartmentIds:[369]};function Pt(n){return!n||typeof n!="number"?!1:Be.allowedDepartmentIds.includes(n)}function Ft(n){if(!n||!n.UF_DEPARTMENT)return!1;const e=Array.isArray(n.UF_DEPARTMENT)?n.UF_DEPARTMENT:[];return e.length===0?!1:e.some(a=>Be.adminDepartmentIds.includes(a))}const Te={USER_NOT_DETERMINED:"USER_NOT_DETERMINED",ACCESS_DENIED:"ACCESS_DENIED",API_ERROR:"API_ERROR"};class Me{constructor(e,a=null,t=null,r=null){this.allowed=e,this.errorCode=a,this.errorMessage=t,this.user=r}}class Oe{static async checkAccess(){try{const e=Ve();if(console.log("AccessControlService.checkAccess - isInsideBitrix24:",e),console.log("AccessControlService.checkAccess - window.self === window.top:",window.self===window.top),console.log("AccessControlService.checkAccess - typeof BX24:",typeof BX24),e)console.log("AccessControlService.checkAccess - Inside Bitrix24, skipping direct access check");else{console.log("AccessControlService.checkAccess - Not inside Bitrix24, checking direct access config...");const{isDirectAccessAllowed:i,getDenyMessage:o}=await ve(async()=>{const{isDirectAccessAllowed:u,getDenyMessage:h}=await import("./direct-access-config-CmlMIQE4.js");return{isDirectAccessAllowed:u,getDenyMessage:h}},__vite__mapDeps([0,1]),import.meta.url),l=await i();if(console.log("AccessControlService.checkAccess - allowDirectAccess:",l),!l){const u=await o();return console.warn("Direct access denied: Application opened directly in browser, but direct access is disabled in config"),console.warn("Deny message:",u),new Me(!1,Te.ACCESS_DENIED,u,null)}console.log("Direct access allowed: Using primary administrator token from settings.php")}if(e)try{await Promise.race([Le.init(),new Promise((i,o)=>setTimeout(()=>o(new Error("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥")),5e3))])}catch(i){console.warn("BX24.init() failed, will try proxy API:",i)}let a;try{a=await Promise.race([Le.getCurrentUser(),new Promise((i,o)=>setTimeout(()=>o(new Error("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø—Ä–µ–≤—ã—Å–∏–ª–æ 10 —Å–µ–∫—É–Ω–¥")),1e4))])}catch(i){console.warn("Bitrix24BxApi.getCurrentUser() failed, trying proxy API:",i);const{Bitrix24ApiProvider:o}=await ve(async()=>{const{Bitrix24ApiProvider:l}=await import("./chunk-BeqOLNMR.js").then(u=>u.b);return{Bitrix24ApiProvider:l}},__vite__mapDeps([2,1]),import.meta.url);try{const l=await o.getInstance();a=await Promise.race([l.getCurrentUser(),new Promise((u,h)=>setTimeout(()=>h(new Error("–ü—Ä–æ–∫—Å–∏ API –ø—Ä–µ–≤—ã—Å–∏–ª–æ 5 —Å–µ–∫—É–Ω–¥")),5e3))]),console.log("Got user from proxy API:",a?.ID||"unknown")}catch(l){throw console.error("Both BX24 API and proxy API failed:",l),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}if(!a||!a.ID)return console.warn("AccessControlService.checkAccess - user not determined:",a),new Me(!1,Te.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.");console.log("AccessControlService.checkAccess - user determined:",{id:a.ID,name:a.NAME,departments:a.UF_DEPARTMENT});const t=a.UF_DEPARTMENT||[];if(console.log("AccessControlService.checkAccess - departmentIds:",t),!Array.isArray(t)||t.length===0){if(console.log("AccessControlService.checkAccess - user has no departments"),!e){const{isDirectAccessAllowed:i}=await ve(async()=>{const{isDirectAccessAllowed:l}=await import("./direct-access-config-CmlMIQE4.js");return{isDirectAccessAllowed:l}},__vite__mapDeps([0,1]),import.meta.url);if(await i())return console.log("AccessControlService.checkAccess - Direct access allowed, granting access despite no departments"),new Me(!0,null,null,a)}return console.warn("AccessControlService.checkAccess - Access denied: user has no departments"),new Me(!1,Te.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ—Ç–¥–µ–ª—É.")}const r=t.some(i=>Pt(i));return console.log("AccessControlService.checkAccess - hasAccess:",r),r?(console.log("AccessControlService.checkAccess - Access granted"),new Me(!0,null,null,a)):(console.warn("AccessControlService.checkAccess - Access denied: no allowed departments"),new Me(!1,Te.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"))}catch(e){return console.error("AccessControlService.checkAccess error:",e),e.message&&(e.message.includes("CORS")||e.message.includes("blocked")||e.message.includes("ERR_FAILED")||e.message.includes("unknown address space"))&&Ve()?(console.error("CORS error inside Bitrix24: Cannot determine interface user."),new Me(!1,Te.API_ERROR,"–û—à–∏–±–∫–∞ CORS: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")):e.message&&e.message.includes("not loaded")?new Me(!1,Te.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."):new Me(!1,Te.API_ERROR,"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}static async getCurrentUser(){try{return Ve()&&await Le.init(),await Le.getCurrentUser()}catch(e){return console.error("AccessControlService.getCurrentUser error:",e),null}}}class Qe{static async logAppEntry(e,a=null){if(!e||!e.ID)return console.warn("[ActivityLoggingService] Invalid user object for app entry logging"),!1;const t={timestamp:new Date().toISOString(),type:"app_entry",user_id:e.ID,user_name:this.getUserName(e),user_email:e.EMAIL||null,ip:a||this.getClientIp(),user_agent:navigator.userAgent,session_id:this.getSessionId()};return await this.saveLog(t)}static async logPageVisit(e,a,t=null){if(!a||!a.ID)return console.warn("[ActivityLoggingService] Invalid user object for page visit logging"),!1;if(!e||!e.path)return console.warn("[ActivityLoggingService] Invalid route object for page visit logging"),!1;const r={timestamp:new Date().toISOString(),type:"page_visit",user_id:a.ID,user_name:this.getUserName(a),route_path:e.path,route_name:e.name||null,route_title:e.meta?.title||null,from_path:t?.path||null,from_name:t?.name||null,session_id:this.getSessionId()};return await this.saveLog(r)}static async saveLog(e){try{const a=Ae("/api/user-activity-log.php"),t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)});if(!t.ok){const i=await t.text();return console.error("[ActivityLoggingService] Failed to save log:",{status:t.status,statusText:t.statusText,error:i}),!1}const r=await t.json();return r.success?!0:(console.error("[ActivityLoggingService] API returned error:",r.error),!1)}catch(a){return a.name==="AbortError"?console.warn("[ActivityLoggingService] Request timeout (activity logging skipped)"):console.error("[ActivityLoggingService] Error saving log:",a),!1}}static getSessionId(){const e="activity_session_id";if(sessionStorage.getItem(e))return sessionStorage.getItem(e);const a=this.generateSessionId();return sessionStorage.setItem(e,a),a}static generateSessionId(){const e=Date.now(),a=Math.random().toString(36).substring(2,11);return`${e}-${a}`}static getUserName(e){const a=e.NAME||"",t=e.LAST_NAME||"";return`${a} ${t}`.trim()||e.EMAIL||`User #${e.ID}`}static getClientIp(){return null}static isAppEntryLogged(){return sessionStorage.getItem("app_entry_logged")==="true"}static markAppEntryLogged(){sessionStorage.setItem("app_entry_logged","true")}}const Cs={reports:[{id:1,title:"–û—Ç—á—ë—Ç –ø–æ —Ç–∏–∫–µ—Ç–∞–º",icon:"üìä",route:"/reports/tickets",description:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º",active:!1},{id:2,title:"–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",icon:"üìà",route:"/reports/performance",description:"–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞",active:!1},{id:3,title:"–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º",icon:"üìâ",route:"/reports/deadlines",description:"–ê–Ω–∞–ª–∏–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á",active:!1},{id:4,title:"–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç",icon:"üìã",route:"/reports/summary",description:"–û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",active:!1},{id:5,title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",route:"/dashboard/sector-1c",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0},{id:6,title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",icon:"üìä",route:"/dashboard/graph-state",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–° –≤–æ –≤—Ä–µ–º–µ–Ω–∏",active:!0,category:"analytics",order:6},{id:7,title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–°",icon:"üìà",route:"/dashboard/graph-admission-closure",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0,category:"analytics",order:7},{id:8,title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"‚è±",route:"/dashboard/tickets-time-tracking",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",active:!0,category:"analytics",order:8}]};function Ss(){return Cs.reports.filter(n=>n.active===!0)}const Ds={adminInterfaces:[{id:1,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"üë•",route:"/admin/users",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"},{id:2,title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã",icon:"‚öôÔ∏è",route:"/admin/settings",description:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:3,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",icon:"üìã",route:"/admin/webhook-logs",description:"–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤"},{id:4,title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",icon:"üìä",route:"/admin/usage-stats",description:"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:5,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",icon:"üóëÔ∏è",route:"/admin/cache",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –º–æ–¥—É–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"}]};function Ts(){return[...Ds.adminInterfaces]}const As={name:"IndexPage",components:{StatusMessage:It,LoadingSpinner:Lt},beforeCreate(){console.log("[IndexPage] beforeCreate() called")},created(){console.log("[IndexPage] created() called")},beforeMount(){console.log("[IndexPage] beforeMount() called")},setup(){console.log("[IndexPage] setup() called");const n=Ye(),e=p(!0),a=p(null),t=p(!1),r=p(!1),i=p(""),o=p(null),l=p(null),u=p(!1);console.log("[IndexPage] Initial state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value});const h=p(Ss()),v=p(!1),m=p(Ts()),C=D(()=>o.value?Ft(o.value):!1),A=D(()=>{if(!o.value)return"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";const w=o.value.FIRST_NAME?o.value.FIRST_NAME.trim():"",_=o.value.LAST_NAME?o.value.LAST_NAME.trim():"",b=o.value.NAME?o.value.NAME.trim():"";return w&&_?`${w} ${_}`:b&&_&&b!==_?`${b} ${_}`:w&&b&&w!==b?`${w} ${b}`:b&&b.includes(" ")?b:w||_||b||`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${o.value.ID}`}),I=D(()=>a.value?a.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ":"–û—à–∏–±–∫–∞ API":null),k=D(()=>a.value?a.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É.":a.value:null),T=D(()=>a.value&&a.value.includes("no_install_app")),f=D(()=>xt("/install.php"));de(async()=>{console.log("[IndexPage] onMounted() called");try{console.log("[IndexPage] Calling AccessControlService.checkAccess()...");const w=await Oe.checkAccess();if(console.log("[IndexPage] Access result:",{allowed:w.allowed,hasUser:!!w.user,user:w.user,errorCode:w.errorCode,errorMessage:w.errorMessage}),w.allowed){if(console.log("[IndexPage] Setting accessAllowed to true"),t.value=!0,o.value=w.user,console.log("[IndexPage] Access allowed, setting state:",{accessAllowed:t.value,hasUser:!!o.value,loading:e.value,accessDenied:r.value}),!Qe.isAppEntryLogged())try{w.user&&await Qe.logAppEntry(w.user)&&Qe.markAppEntryLogged()}catch(_){console.error("[IndexPage] Error logging app entry:",_)}}else{r.value=!0;const _=Ve(),b=!_&&w.errorCode===Te.ACCESS_DENIED&&w.errorMessage&&w.errorMessage.includes("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø");if(console.log("IndexPage - accessResult:",{errorCode:w.errorCode,errorMessage:w.errorMessage,isInsideB24:_,isDirectAccessDeniedCheck:b}),u.value=b,b&&(i.value=w.errorMessage,console.log("IndexPage - Set direct access denied message:",w.errorMessage)),console.log("IndexPage - State after check:",{accessDenied:r.value,isDirectAccessDenied:u.value,accessErrorMessage:i.value}),!b){if(w.user){const{getAllowedDepartmentIds:L}=await ve(async()=>{const{getAllowedDepartmentIds:V}=await import("./access-config-async-R2Y78dGz.js");return{getAllowedDepartmentIds:V}},__vite__mapDeps([3,4,1,5,6,2]),import.meta.url);l.value={userId:w.user.ID,departmentIds:w.user.UF_DEPARTMENT||[],allowedIds:L()}}w.errorCode===Te.USER_NOT_DETERMINED?i.value="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.":w.errorCode===Te.ACCESS_DENIED?i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω":i.value=w.errorMessage||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."}}}catch(w){a.value=w.message,console.error("Error checking access:",w)}finally{e.value=!1,console.log("[IndexPage] Final state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value,hasUser:!!o.value,error:a.value})}});const y=w=>{if(!w){console.error("Route is not defined for report");return}n.push(w)},E=()=>{v.value=!0},O=()=>{v.value=!1};return{loading:e,error:a,accessAllowed:t,accessDenied:r,accessErrorMessage:i,currentUser:o,userName:A,debugInfo:l,isDirectAccessDenied:u,errorTitle:I,errorMessage:k,showInstallLink:T,installPageUrl:f,reportsButtons:h,navigateToReport:y,isAdmin:C,showAdminPopup:v,adminButtons:m,openAdminPopup:E,closeAdminPopup:O,navigateToAdmin:w=>{if(!w){console.error("Route is not defined for admin interface");return}n.push(w),O()}}}},Es={class:"index-page"},Ms={class:"container"},xs={key:0,class:"install-link"},Is=["href"],Ls={key:0,class:"direct-access-denied-info",style:{"margin-top":"15px",padding:"15px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px"}},Ps={key:1,class:"debug-info",style:{"margin-top":"15px",padding:"10px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px","font-size":"12px"}},Fs={key:3,class:"main-content"},Us={class:"greeting-section"},Rs={class:"greeting-header"},Os={class:"greeting-header-content"},Ns={class:"greeting-text"},Bs={class:"reports-section"},Vs={class:"reports-grid"},$s=["onClick"],js={class:"report-icon"},zs={class:"report-title"},Ws={key:0,class:"report-description"},qs={class:"admin-popup-header"},Hs={class:"admin-popup-content"},Xs={class:"admin-buttons-grid"},Js=["onClick"],Ys={class:"admin-icon"},Ks={class:"admin-title"},Gs={key:0,class:"admin-description"};function Qs(n,e,a,t,r,i){const o=W("StatusMessage"),l=W("LoadingSpinner");return c(),d("div",Es,[s("div",Ms,[t.error?(c(),re(o,{key:0,type:"error",title:t.errorTitle,message:t.errorMessage},{default:_e(()=>[t.showInstallLink?(c(),d("div",xs,[s("a",{href:t.installPageUrl},"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",8,Is)])):M("",!0)]),_:1},8,["title","message"])):M("",!0),t.loading?(c(),re(l,{key:1,message:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞..."})):M("",!0),!t.loading&&t.accessDenied?(c(),re(o,{key:2,type:"error",title:"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",message:t.accessErrorMessage},{default:_e(()=>[t.isDirectAccessDenied?(c(),d("div",Ls,[...e[4]||(e[4]=[s("p",{style:{margin:"0 0 10px 0","font-weight":"600",color:"#856404"}},[s("strong",null,"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")],-1),s("ol",{style:{margin:"0","padding-left":"20px",color:"#856404"}},[s("li",null,"–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24"),s("li",null,"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Bitrix24 (placement, –≤–∏–¥–∂–µ—Ç –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É)")],-1)])])):t.debugInfo?(c(),d("div",Ps,[e[5]||(e[5]=s("strong",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e[6]||(e[6]=s("br",null,null,-1)),G(" ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+g(t.debugInfo.userId),1),e[7]||(e[7]=s("br",null,null,-1)),G(" ID –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+g(t.debugInfo.departmentIds),1),e[8]||(e[8]=s("br",null,null,-1)),G(" –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ID –æ—Ç–¥–µ–ª–æ–≤: "+g(t.debugInfo.allowedIds),1),e[9]||(e[9]=s("br",null,null,-1)),e[10]||(e[10]=s("small",{style:{color:"#856404"}},"–î–æ–±–∞–≤—å—Ç–µ ID –æ—Ç–¥–µ–ª–∞ –≤ —Ñ–∞–π–ª vue-app/src/config/access-config.js",-1))])):M("",!0)]),_:1},8,["message"])):M("",!0),!t.loading&&!t.accessDenied&&t.accessAllowed?(c(),d("div",Fs,[s("div",Us,[s("div",Rs,[s("div",Os,[e[13]||(e[13]=s("h2",{class:"greeting-title"},"–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ò–¢ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –ü–ª–∞–Ω–µ—Ä–∫–∏ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ü–∏–∏",-1)),s("p",Ns,[e[11]||(e[11]=G(" –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",-1)),s("strong",null,g(t.userName),1),e[12]||(e[12]=G("! ",-1))])]),t.isAdmin?(c(),d("button",{key:0,class:"admin-button-header",onClick:e[0]||(e[0]=(...u)=>t.openAdminPopup&&t.openAdminPopup(...u)),title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"}," ‚öôÔ∏è ")):M("",!0)])]),s("div",Bs,[s("div",Vs,[(c(!0),d($,null,j(t.reportsButtons,u=>(c(),d("div",{key:u.id,class:"report-button",onClick:h=>t.navigateToReport(u.route)},[s("div",js,g(u.icon),1),s("div",zs,g(u.title),1),u.description?(c(),d("div",Ws,g(u.description),1)):M("",!0)],8,$s))),128))])]),t.showAdminPopup&&t.isAdmin?(c(),d("div",{key:0,class:"admin-popup-overlay",onClick:e[3]||(e[3]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))},[s("div",{class:"admin-popup",onClick:e[2]||(e[2]=fe(()=>{},["stop"]))},[s("div",qs,[e[14]||(e[14]=s("h3",{class:"admin-popup-title"},"‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",-1)),s("button",{class:"admin-popup-close",onClick:e[1]||(e[1]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))}," ‚úï ")]),s("div",Hs,[s("div",Xs,[(c(!0),d($,null,j(t.adminButtons,u=>(c(),d("div",{key:u.id,class:"admin-interface-button",onClick:h=>t.navigateToAdmin(u.route)},[s("div",Ys,g(u.icon),1),s("div",Ks,g(u.title),1),u.description?(c(),d("div",Gs,g(u.description),1)):M("",!0)],8,Js))),128))])])])])):M("",!0)])):M("",!0)])])}const Zs=H(As,[["render",Qs],["__scopeId","data-v-6cc28966"]]),ye=p(new Map),Se=p({hits:0,misses:0,sets:0,invalidations:0}),nt={defaultTTL:5*60*1e3,maxSize:100,enableStats:!0};function ea(n={}){const{ttl:e=nt.defaultTTL,maxSize:a=nt.maxSize,enableStats:t=nt.enableStats}=n,r=T=>{const f=new WeakSet;return JSON.stringify(T,(y,E)=>{if(typeof E=="object"&&E!==null){if(f.has(E))return"[Circular]";f.add(E)}return typeof E=="function"||E===void 0?null:E})},i=(T,f={})=>{const y=Object.keys(f).sort().reduce((E,O)=>{const F=f[O];if(F==null)E[O]=null;else if(typeof F=="object")try{E[O]=r(F)}catch{E[O]=String(F)}else E[O]=F;return E},{});try{return`${T}_${r(y)}`}catch{const O=Object.keys(y).sort().map(F=>`${F}=${y[F]}`).join("&");return`${T}_${O}`}},o=T=>{const f=ye.value.get(T);return f?Date.now()-f.timestamp>f.ttl?(ye.value.delete(T),t&&Se.value.misses++,null):(f.lastAccessed=Date.now(),t&&Se.value.hits++,f.data):(t&&Se.value.misses++,null)},l=(T,f,y=null)=>{ye.value.size>=a&&u(),ye.value.set(T,{data:f,timestamp:Date.now(),lastAccessed:Date.now(),ttl:y||e}),t&&Se.value.sets++},u=()=>{let T=null,f=1/0;for(const[y,E]of ye.value.entries())E.lastAccessed<f&&(f=E.lastAccessed,T=y);T&&ye.value.delete(T)},h=()=>{ye.value.clear(),t&&(Se.value={hits:0,misses:0,sets:0,invalidations:0})},v=T=>{const f=typeof T=="string"?new RegExp(T):T;let y=0;for(const E of ye.value.keys())f.test(E)&&(ye.value.delete(E),y++);return t&&(Se.value.invalidations+=y),y},m=()=>{const T=Date.now();let f=0;for(const[y,E]of ye.value.entries())T-E.timestamp>E.ttl&&(ye.value.delete(y),f++);return f},C=()=>{const T=Se.value.hits+Se.value.misses,f=T>0?(Se.value.hits/T*100).toFixed(2):0;return{...Se.value,size:ye.value.size,hitRate:`${f}%`}};let A=null;const I=(T=5*60*1e3)=>{A&&clearInterval(A),A=setInterval(()=>{m()},T)},k=()=>{A&&(clearInterval(A),A=null)};return I(),{get:o,set:l,clear:h,invalidate:v,cleanup:m,getCacheKey:i,getStats:C,startAutoCleanup:I,stopAutoCleanup:k}}function xe(n){if(!n||typeof n!="object"||!n.timestamp||typeof n.timestamp!="string"||!n.event||typeof n.event!="string"||!n.category||typeof n.category!="string"||!["tasks","smart-processes","errors"].includes(n.category))return!1;try{new Date(n.timestamp)}catch{return!1}return!0}function ta(n){if(!n||typeof n!="object")return!1;for(const[e,a]of Object.entries(n))if(typeof a=="function")return!1;return!0}function ze(n){if(!xe(n))return null;const e={timestamp:n.timestamp,event:n.event,category:n.category};return n.ip&&typeof n.ip=="string"&&(e.ip=n.ip),n.payload&&typeof n.payload=="object"&&(e.payload=n.payload),n.details&&ta(n.details)&&(e.details=n.details),e}function ht(n){return Array.isArray(n)?n.map(e=>ze(e)).filter(e=>e!==null):[]}const{get:sa,set:aa,getCacheKey:oa,invalidate:_t}=ea({ttl:2*60*1e3,maxSize:50});class bt{static getBaseUrl(){return Ae("/api/webhook-logs.php")}static get BASE_URL(){return this.getBaseUrl()}static async getLogs(e={},a=1,t=50,r=!1){if(a<1)throw new Error("Page must be greater than 0");if(t<1||t>1e3)throw new Error("Limit must be between 1 and 1000");const i={category:e.category||null,event:e.event||null,date:e.date||null,hour:e.hour!==void 0?e.hour:null,dateFrom:e.dateFrom||null,dateTo:e.dateTo||null,ip:e.ip||null,status:e.status||null},o=this.getBaseUrl(),l=oa(o,{filters:i,page:a,limit:t});if(!r){const h=sa(l);if(h)return console.log("[WebhookLogsApiService] Cache hit:",l.substring(0,50)+"..."),h}console.log("[WebhookLogsApiService] Cache miss:",l.substring(0,50)+"...");const u=new URLSearchParams({page:a.toString(),limit:t.toString()});i.category&&u.append("category",i.category),i.event&&u.append("event",i.event),i.date&&u.append("date",i.date),i.hour!==null&&u.append("hour",i.hour.toString()),i.dateFrom&&u.append("dateFrom",i.dateFrom),i.dateTo&&u.append("dateTo",i.dateTo),i.ip&&u.append("ip",i.ip),i.status&&u.append("status",i.status);try{const h=this.getBaseUrl(),v=await fetch(`${h}?${u.toString()}`);if(!v.ok){const I=await v.text();let k;try{k=JSON.parse(I)}catch{k={error:I}}throw new Error(k.error_description||k.error||`HTTP error! status: ${v.status}`)}const m=await v.json();if(console.log("[WebhookLogsApiService] API response:",{success:m.success,logsCount:m.logs?.length||0,pagination:m.pagination,hasError:!!m.error}),m.error)throw new Error(m.error_description||m.error);if(!m.success)throw console.warn("[WebhookLogsApiService] API returned success=false:",m),new Error("API request failed");if(!Array.isArray(m.logs))throw console.error("[WebhookLogsApiService] Invalid logs format:",m.logs),new Error("Invalid logs format: expected array");const C=ht(m.logs);(!m.pagination||typeof m.pagination!="object")&&(console.warn("[WebhookLogsApiService] Invalid pagination format:",m.pagination),m.pagination={page:a,limit:t,total:C.length,pages:Math.ceil(C.length/t)});const A={success:!0,logs:C,pagination:{page:m.pagination.page||a,limit:m.pagination.limit||t,total:m.pagination.total||C.length,pages:m.pagination.pages||Math.ceil((m.pagination.total||C.length)/t)}};return aa(l,A),A}catch(h){throw console.error("[WebhookLogsApiService] Error:",h),h}}static invalidateCacheOnFilterChange(e={},a={}){const t=_t(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Invalidated ${t} entries on filter change`)}static clearCache(){const e=_t(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Cleared ${e} entries`)}static async getLogDetails(e,a=null){const t={};return a&&(t.date=a),(await this.getLogs(t,1,1e3)).logs.find(o=>`${o.timestamp}_${o.event}`===e)||null}static async getErrors(e={},a=1,t=50){return this.getLogs({...e,category:"errors"},a,t)}static async getStats(e={}){const a=await this.getLogs(e,1,1e3),t={total:a.pagination.total||a.logs.length,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}};return a.logs.forEach(r=>{r.category==="tasks"?t.tasks++:r.category==="smart-processes"?t.smartProcesses++:r.category==="errors"&&t.errors++,t.byEvent[r.event]||(t.byEvent[r.event]=0),t.byEvent[r.event]++;const i=r.timestamp.split("T")[0];t.byDate[i]||(t.byDate[i]=0),t.byDate[i]++}),t}}function na(){const n=Xt(),e=Ye(),a=new Date().toISOString().split("T")[0],t=p({category:null,event:null,dateFrom:a,dateTo:null,hour:null,ip:null,search:null,status:null}),r=()=>{const h=n.query;t.value={category:h.category||null,event:h.event||null,dateFrom:h.dateFrom||h.date||a,dateTo:h.dateTo||null,hour:h.hour?parseInt(h.hour):null,ip:h.ip||null,search:h.search||null,status:h.status||null}},i=h=>{if(u)return;const v={...n.query};Object.keys(h).forEach(C=>{const A=h[C];A!==null&&A!==""&&A!==void 0?v[C]=A.toString():delete v[C]}),JSON.stringify(v)!==JSON.stringify(n.query)&&(u=!0,e.replace({path:n.path,query:v}).finally(()=>{setTimeout(()=>{u=!1},100)}))},o=h=>{const v={...t.value,...h};JSON.stringify(t.value)!==JSON.stringify(v)&&(t.value=v,i(t.value))},l=()=>{t.value={category:null,event:null,dateFrom:a,dateTo:null,hour:null,ip:null,search:null,status:null},i(t.value)};de(()=>{r()});let u=!1;return ee(()=>n.query,(h,v)=>{if(u)return;JSON.stringify(h)!==JSON.stringify(v)&&r()},{deep:!0}),{filters:t,updateFilters:o,clearFilters:l,loadFiltersFromUrl:r}}function ra(n,e,a={}){if(!e||!e.trim())return n;const{caseSensitive:t=!1,searchInEvent:r=!0,searchInPayload:i=!0,searchInDetails:o=!0,searchInIp:l=!0,searchInTimestamp:u=!1}=a,h=t?e.trim():e.trim().toLowerCase();return n.filter(v=>{if(r&&v.event&&(t?v.event:v.event.toLowerCase()).includes(h))return!0;if(i&&v.payload)try{const m=JSON.stringify(v.payload);if((t?m:m.toLowerCase()).includes(h))return!0}catch(m){console.warn("Error searching in payload:",m)}if(o&&v.details)try{const m=JSON.stringify(v.details);if((t?m:m.toLowerCase()).includes(h))return!0}catch(m){console.warn("Error searching in details:",m)}return!!(l&&v.ip&&(t?v.ip:v.ip.toLowerCase()).includes(h)||u&&v.timestamp&&(t?v.timestamp:v.timestamp.toLowerCase()).includes(h))})}function lt(n){if(!n||typeof n!="object"||n.category!==void 0&&n.category!==null&&!["tasks","smart-processes","errors"].includes(n.category)||n.date!==void 0&&n.date!==null&&!/^\d{4}-\d{2}-\d{2}$/.test(n.date))return!1;if(n.hour!==void 0&&n.hour!==null){const e=parseInt(n.hour,10);if(isNaN(e)||e<0||e>23)return!1}return!(n.ip!==void 0&&n.ip!==null&&(typeof n.ip!="string"||n.ip.length===0))}function ia(n){if(!n||typeof n!="object")return!1;const e=parseInt(n.page,10),a=parseInt(n.limit,10),t=parseInt(n.total,10),r=parseInt(n.pages,10);return!(isNaN(e)||e<1||isNaN(a)||a<1||a>1e3||isNaN(t)||t<0||isNaN(r)||r<0)}function wt(n){if(n==null)return"";const e=String(n),a=e.replace(/"/g,'""');return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${a}"`:a}function la(n){return n==null?"":typeof n=="object"?JSON.stringify(n):String(n)}function ca(n,e="webhook-logs.csv",a={}){return new Promise((t,r)=>{try{if(!Array.isArray(n)||n.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{columns:i=null,onProgress:o=null}=a,l=i||Object.keys(n[0]),h=[l.map(I=>wt(I)).join(",")],v=n.length,m=1e3;for(let I=0;I<v;I+=m){const k=n.slice(I,I+m);if(k.forEach(T=>{const f=l.map(y=>{const E=T[y];return wt(la(E))});h.push(f.join(","))}),o){const T=Math.min(100,Math.round((I+k.length)/v*100));o(T)}}const C="\uFEFF"+h.join(`
`),A=new Blob([C],{type:"text/csv;charset=utf-8;"});Ut(A,e),o&&o(100),t()}catch(i){r(i)}})}function da(n,e="webhook-logs.json",a={}){return new Promise((t,r)=>{try{if(!Array.isArray(n)||n.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{pretty:i=!0,onProgress:o=null}=a,l=i?JSON.stringify(n,null,2):JSON.stringify(n);o&&o(50);const u=new Blob([l],{type:"application/json;charset=utf-8;"});Ut(u,e),o&&o(100),t()}catch(i){r(i)}})}function Ut(n,e){const a=URL.createObjectURL(n),t=document.createElement("a");t.href=a,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(a)},100)}function ua(n,e={},a=0){const t=new Date().toISOString().split("T")[0],r=new Date().toTimeString().split(" ")[0].replace(/:/g,"-");let i=`webhook-logs_${t}_${r}`;const o=[];return e.category&&o.push(`cat-${e.category}`),e.event&&o.push(`evt-${e.event.substring(0,10)}`),e.dateFrom&&o.push(`from-${e.dateFrom}`),e.dateTo&&o.push(`to-${e.dateTo}`),o.length>0&&(i+=`_${o.join("-")}`),a>0&&(i+=`_${a}records`),`${i}.${n}`}function ga(n){const e=[];if(!Array.isArray(n))return e.push("–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),{valid:!1,errors:e,estimatedSize:0};if(n.length===0)return e.push("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"),{valid:!1,errors:e,estimatedSize:0};const a=JSON.stringify(n).length,t=50*1024*1024;return a>t&&e.push(`–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö (${Math.round(a/1024/1024)} MB). –≠–∫—Å–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è.`),{valid:e.length===0,errors:e,estimatedSize:a}}function vt(n,e="short"){if(!n)return"‚Äî";try{const a=new Date(n);if(isNaN(a.getTime()))return"Invalid date";switch(e){case"short":return a.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});case"long":return a.toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});case"relative":return ma(a);default:return a.toLocaleString("ru-RU")}}catch{return"Invalid date"}}function ma(n){const a=new Date-n,t=Math.floor(a/1e3),r=Math.floor(t/60),i=Math.floor(r/60),o=Math.floor(i/24);return t<60?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":r<60?`${r} ${rt(r,"–º–∏–Ω—É—Ç—É","–º–∏–Ω—É—Ç—ã","–º–∏–Ω—É—Ç")} –Ω–∞–∑–∞–¥`:i<24?`${i} ${rt(i,"—á–∞—Å","—á–∞—Å–∞","—á–∞—Å–æ–≤")} –Ω–∞–∑–∞–¥`:o<7?`${o} ${rt(o,"–¥–µ–Ω—å","–¥–Ω—è","–¥–Ω–µ–π")} –Ω–∞–∑–∞–¥`:vt(n.toISOString(),"short")}function rt(n,e,a,t){const r=n%10,i=n%100;return r===1&&i!==11?e:r>=2&&r<=4&&(i<10||i>=20)?a:t}function We(n){return n?n.replace(/^ON/,"").split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):"‚Äî"}function Pe(n){return{tasks:"–ó–∞–¥–∞—á–∏","smart-processes":"–°–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å—ã",errors:"–û—à–∏–±–∫–∏"}[n]||n}function ft(n){if(!n||typeof n!="object")return"‚Äî";const e=[];if(n.task_id&&e.push(`–ó–∞–¥–∞—á–∞ #${n.task_id}`),n.entity_id&&e.push(`–°—É—â–Ω–æ—Å—Ç—å #${n.entity_id}`),n.task_title&&e.push(`"${n.task_title}"`),n.title&&e.push(`"${n.title}"`),n.comment_text){const a=n.comment_text.length>50?n.comment_text.substring(0,50)+"...":n.comment_text;e.push(`–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${a}`)}return e.length>0?e.join(" ‚Ä¢ "):"‚Äî"}const ha={name:"WebhookLogsExport",props:{logs:{type:Array,default:()=>[]},selectedLogs:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},totalCount:{type:Number,default:0}},emits:["export-start","export-complete","export-error"],setup(n,{emit:e}){const a=p(!1),t=p("csv"),r=p("all"),i=p(!0),o=p(!1),l=p(0),u=p([]),h=p(null),v=D(()=>n.selectedLogs.length),m=D(()=>n.logs.length>0||n.totalCount>0),C=D(()=>n.filters.category||n.filters.event||n.filters.dateFrom||n.filters.dateTo),A=D(()=>r.value==="selected"?v.value:n.logs.length||n.totalCount),I=D(()=>r.value==="selected"?v.value>0:m.value),k=()=>{l.value=0,u.value=[],h.value=null,v.value>0?r.value="selected":r.value="all",a.value=!0,f()},T=()=>{o.value||(a.value=!1)},f=()=>{const F=y(),w=ga(F);u.value=w.errors,h.value=w.estimatedSize},y=()=>(r.value==="selected"?n.selectedLogs:n.logs).map(_=>ze(_)).filter(_=>xe(_)?!0:(console.warn("[WebhookLogsExport] Skipping invalid log:",_),!1)),E=async()=>{try{o.value=!0,l.value=0;let F=y();if(F.length===0)throw new Error("–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const w=F.map(L=>({timestamp:L.timestamp,event:L.event,category:L.category,ip:L.ip||null,details:L.details||null,payload:L.payload||null,formatted:{timestamp:vt(L.timestamp),event:We(L.event),category:Pe(L.category),details:ft(L.details)}}));e("export-start",{format:t.value,scope:r.value,count:w.length});const _=ua(t.value,n.filters,w.length),b=L=>{l.value=L};t.value==="csv"?await ca(w,_,{onProgress:b}):await da(w,_,{pretty:i.value,onProgress:b}),e("export-complete",{format:t.value,filename:_,count:w.length}),setTimeout(()=>{o.value=!1,a.value=!1,l.value=0},500)}catch(F){console.error("[WebhookLogsExport] Export error:",F),e("export-error",F),o.value=!1,l.value=0,alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${F.message}`)}},O=F=>F<1024?`${F} B`:F<1024*1024?`${(F/1024).toFixed(2)} KB`:`${(F/1024/1024).toFixed(2)} MB`;return ee([r,()=>n.logs,()=>n.selectedLogs],()=>{a.value&&f()}),{showExportModal:a,exportFormat:t,exportScope:r,jsonPretty:i,exporting:o,exportProgress:l,exportWarnings:u,estimatedSize:h,selectedCount:v,hasAllLogs:m,hasFilters:C,exportCount:A,canExport:I,openExportModal:k,closeExportModal:T,handleExport:E,formatSize:O}}},va={class:"webhook-logs-export"},fa=["disabled","title"],pa={key:0,class:"selected-badge"},ya={class:"export-modal-header"},_a={class:"export-modal-body"},ba={class:"export-section"},wa={class:"radio-group"},ka={class:"export-section"},Ca={class:"radio-group"},Sa=["disabled"],Da={class:"radio-label"},Ta={key:0},Aa={key:1},Ea=["disabled"],Ma={class:"radio-label"},xa={key:0,class:"export-section"},Ia={class:"checkbox-option"},La={class:"export-info"},Pa={class:"info-item"},Fa={class:"info-value"},Ua={key:0,class:"info-item"},Ra={class:"info-value"},Oa={key:1,class:"export-warnings"},Na={key:0,class:"export-progress"},Ba={class:"progress-bar"},Va={class:"progress-text"},$a={class:"export-modal-footer"},ja=["disabled"],za={key:0},Wa={key:1},qa=["disabled"];function Ha(n,e,a,t,r,i){return c(),d("div",va,[s("button",{onClick:e[0]||(e[0]=(...o)=>t.openExportModal&&t.openExportModal(...o)),class:"btn-export",disabled:!t.canExport,title:t.canExport?"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"},[e[11]||(e[11]=s("span",{class:"btn-icon"},"üì•",-1)),e[12]||(e[12]=s("span",{class:"btn-text"},"–≠–∫—Å–ø–æ—Ä—Ç",-1)),t.selectedCount>0?(c(),d("span",pa,g(t.selectedCount),1)):M("",!0)],8,fa),J(Ie,{name:"modal"},{default:_e(()=>[t.showExportModal?(c(),d("div",{key:0,class:"export-modal-overlay",onClick:e[10]||(e[10]=(...o)=>t.closeExportModal&&t.closeExportModal(...o))},[s("div",{class:"export-modal",onClick:e[9]||(e[9]=fe(()=>{},["stop"]))},[s("div",ya,[e[13]||(e[13]=s("h3",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",-1)),s("button",{onClick:e[1]||(e[1]=(...o)=>t.closeExportModal&&t.closeExportModal(...o)),class:"btn-close"},"‚úï")]),s("div",_a,[s("div",ba,[e[16]||(e[16]=s("h4",null,"–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞",-1)),s("div",wa,[s("label",{class:N(["radio-option",{active:t.exportFormat==="csv"}])},[z(s("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=o=>t.exportFormat=o),value:"csv",class:"radio-input"},null,512),[[Ge,t.exportFormat]]),e[14]||(e[14]=s("span",{class:"radio-label"},[s("strong",null,"CSV"),s("small",null,"–î–ª—è Excel, LibreOffice")],-1))],2),s("label",{class:N(["radio-option",{active:t.exportFormat==="json"}])},[z(s("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=o=>t.exportFormat=o),value:"json",class:"radio-input"},null,512),[[Ge,t.exportFormat]]),e[15]||(e[15]=s("span",{class:"radio-label"},[s("strong",null,"JSON"),s("small",null,"–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, API")],-1))],2)])]),s("div",ka,[e[19]||(e[19]=s("h4",null,"–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",-1)),s("div",Ca,[s("label",{class:N(["radio-option",{active:t.exportScope==="all",disabled:!t.hasAllLogs}])},[z(s("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=o=>t.exportScope=o),value:"all",disabled:!t.hasAllLogs,class:"radio-input"},null,8,Sa),[[Ge,t.exportScope]]),s("span",Da,[e[17]||(e[17]=s("strong",null,"–í—Å–µ –∑–∞–ø–∏—Å–∏",-1)),t.hasFilters?(c(),d("small",Ta,"–° –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ ("+g(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π)",1)):(c(),d("small",Aa,"–í—Å–µ–≥–æ: "+g(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π",1))])],2),s("label",{class:N(["radio-option",{active:t.exportScope==="selected",disabled:t.selectedCount===0}])},[z(s("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=o=>t.exportScope=o),value:"selected",disabled:t.selectedCount===0,class:"radio-input"},null,8,Ea),[[Ge,t.exportScope]]),s("span",Ma,[e[18]||(e[18]=s("strong",null,"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏",-1)),s("small",null,g(t.selectedCount)+" –∑–∞–ø–∏—Å–µ–π –≤—ã–±—Ä–∞–Ω–æ",1)])],2)])]),t.exportFormat==="json"?(c(),d("div",xa,[e[21]||(e[21]=s("h4",null,"–û–ø—Ü–∏–∏ JSON",-1)),s("label",Ia,[z(s("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=o=>t.jsonPretty=o),class:"checkbox-input"},null,512),[[Ne,t.jsonPretty]]),e[20]||(e[20]=s("span",{class:"checkbox-label"},"–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)",-1))])])):M("",!0),s("div",La,[s("div",Pa,[e[22]||(e[22]=s("span",{class:"info-label"},"–ó–∞–ø–∏—Å–µ–π –∫ —ç–∫—Å–ø–æ—Ä—Ç—É:",-1)),s("span",Fa,g(t.exportCount),1)]),t.estimatedSize?(c(),d("div",Ua,[e[23]||(e[23]=s("span",{class:"info-label"},"–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä:",-1)),s("span",Ra,g(t.formatSize(t.estimatedSize)),1)])):M("",!0)]),t.exportWarnings.length>0?(c(),d("div",Oa,[(c(!0),d($,null,j(t.exportWarnings,(o,l)=>(c(),d("div",{key:l,class:"warning-item"}," ‚ö†Ô∏è "+g(o),1))),128))])):M("",!0)]),t.exporting?(c(),d("div",Na,[s("div",Ba,[s("div",{class:"progress-fill",style:Ee({width:`${t.exportProgress}%`})},null,4)]),s("div",Va," –≠–∫—Å–ø–æ—Ä—Ç: "+g(t.exportProgress)+"% ",1)])):M("",!0),s("div",$a,[s("button",{onClick:e[7]||(e[7]=(...o)=>t.handleExport&&t.handleExport(...o)),disabled:t.exporting||!t.canExport,class:"btn-primary"},[t.exporting?(c(),d("span",za,"–≠–∫—Å–ø–æ—Ä—Ç...")):(c(),d("span",Wa,"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"))],8,ja),s("button",{onClick:e[8]||(e[8]=(...o)=>t.closeExportModal&&t.closeExportModal(...o)),disabled:t.exporting,class:"btn-secondary"}," –û—Ç–º–µ–Ω–∞ ",8,qa)])])])):M("",!0)]),_:1})])}const Xa=H(ha,[["render",Ha],["__scopeId","data-v-7ae66f8c"]]);function Rt(n,e=300){let a;return function(...r){const i=()=>{clearTimeout(a),n(...r)};clearTimeout(a),a=setTimeout(i,e)}}const Ja={name:"WebhookLogSearch",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","search"],setup(n,{emit:e}){const a=p(n.modelValue||""),t=p(!1),r=p(null),i=Rt(A=>{t.value=!1,e("search",A)},400),o=()=>{t.value=!0,e("update:modelValue",a.value),i(a.value)},l=()=>{t.value=!1,e("search",a.value)},u=()=>{a.value="",t.value=!1,r.value=null,e("update:modelValue",""),e("search","")};return ee(()=>n.modelValue,A=>{A!==a.value&&(a.value=A)}),{searchQuery:a,isSearching:t,searchResultsCount:r,handleSearchInput:o,handleSearch:l,clearSearch:u,setResultsCount:A=>{r.value=A},getResultsText:A=>{const I=A%10,k=A%100;return k>=11&&k<=19?"–∑–∞–ø–∏—Å–µ–π":I===1?"–∑–∞–ø–∏—Å—å":I>=2&&I<=4?"–∑–∞–ø–∏—Å–∏":"–∑–∞–ø–∏—Å–µ–π"},performSearch:(A,I)=>{if(!A||!I||!Array.isArray(I))return[];const k=A.toLowerCase().trim();return k.length===0?I:I.map(f=>ze(f)).filter(f=>xe(f)).filter(f=>{if(f.event&&f.event.toLowerCase().includes(k)||f.category&&f.category.toLowerCase().includes(k)||f.ip&&f.ip.toLowerCase().includes(k)||f.details&&typeof f.details=="object"&&(f.details.task_id&&String(f.details.task_id).includes(k)||f.details.task_title&&f.details.task_title.toLowerCase().includes(k)||f.details.entity_id&&String(f.details.entity_id).includes(k)||f.details.title&&f.details.title.toLowerCase().includes(k)||f.details.comment_text&&f.details.comment_text.toLowerCase().includes(k)))return!0;if(f.payload&&typeof f.payload=="object")try{if(JSON.stringify(f.payload).toLowerCase().includes(k))return!0}catch{}return!1})},formatSearchResult:A=>{const I=[];if(A.event&&I.push(We(A.event)),A.category&&I.push(Pe(A.category)),A.details){const k=ft(A.details);k!=="‚Äî"&&I.push(k)}return I.join(" ‚Ä¢ ")}}}},Ya={class:"webhook-search"},Ka={class:"search-wrapper"},Ga={key:0,class:"search-indicator"},Qa={key:1,class:"search-results"};function Za(n,e,a,t,r,i){return c(),d("div",Ya,[s("div",Ka,[e[5]||(e[5]=s("span",{class:"search-icon"},"üîç",-1)),z(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.searchQuery=o),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ª–æ–≥–æ–≤ (—Å–æ–±—ã—Ç–∏–µ, payload, IP, –¥–µ—Ç–∞–ª–∏)...",class:"search-input",onInput:e[1]||(e[1]=(...o)=>t.handleSearchInput&&t.handleSearchInput(...o)),onKeyup:[e[2]||(e[2]=De((...o)=>t.handleSearch&&t.handleSearch(...o),["enter"])),e[3]||(e[3]=De((...o)=>t.clearSearch&&t.clearSearch(...o),["esc"]))]},null,544),[[be,t.searchQuery]]),t.searchQuery?(c(),d("button",{key:0,onClick:e[4]||(e[4]=(...o)=>t.clearSearch&&t.clearSearch(...o)),class:"clear-button",title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ (Esc)","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):M("",!0)]),t.isSearching?(c(),d("div",Ga,[...e[6]||(e[6]=[s("span",{class:"spinner"},null,-1),G(" –ü–æ–∏—Å–∫... ",-1)])])):M("",!0),t.searchQuery&&t.searchResultsCount!==null?(c(),d("div",Qa," –ù–∞–π–¥–µ–Ω–æ: "+g(t.searchResultsCount)+" "+g(t.getResultsText(t.searchResultsCount)),1)):M("",!0)])}const eo=H(Ja,[["render",Za],["__scopeId","data-v-db228863"]]);function to(n,e=null){const a=()=>{try{const o=localStorage.getItem(n);return o?JSON.parse(o):e}catch(o){return console.error(`Error loading ${n} from localStorage:`,o),e}},t=o=>{try{localStorage.setItem(n,JSON.stringify(o))}catch(l){console.error(`Error saving ${n} to localStorage:`,l)}},r=()=>{try{localStorage.removeItem(n)}catch(o){console.error(`Error clearing ${n} from localStorage:`,o)}},i=p(a());return ee(i,o=>{t(o)},{deep:!0}),{value:i,save:t,load:a,clear:r}}const so={name:"WebhookLogFilters",props:{filters:{type:Object,required:!0}},emits:["update:filters","reset"],setup(n,{emit:e}){const a=p(null),t=to("webhook-filters",{category:null,event:null,dateFrom:null,dateTo:null,hour:null,ip:null,status:null}),r=_=>(a.value=null,lt(_)?(e("update:filters",_),!0):(a.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",console.error("[WebhookLogFilters] Validation error:",a.value),!1)),i=new Date().toISOString().split("T")[0],o=p({category:t.value.category||n.filters.category||null,event:t.value.event||n.filters.event||null,dateFrom:t.value.dateFrom||n.filters.dateFrom||n.filters.date||i,dateTo:t.value.dateTo||n.filters.dateTo||null,hour:t.value.hour!==void 0?t.value.hour:n.filters.hour!==void 0?n.filters.hour:null,ip:t.value.ip||n.filters.ip||null,status:t.value.status||n.filters.status||null}),l=p(null),u=[{id:"today",label:"–°–µ–≥–æ–¥–Ω—è",getDates:()=>({from:i,to:i})},{id:"yesterday",label:"–í—á–µ—Ä–∞",getDates:()=>{const _=new Date;_.setDate(_.getDate()-1);const b=_.toISOString().split("T")[0];return{from:b,to:b}}},{id:"last7days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",getDates:()=>{const _=new Date;return _.setDate(_.getDate()-7),{from:_.toISOString().split("T")[0],to:i}}},{id:"last30days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π",getDates:()=>{const _=new Date;return _.setDate(_.getDate()-30),{from:_.toISOString().split("T")[0],to:i}}}],h=_=>{const b=u.find(L=>L.id===_);if(b){const L=b.getDates();o.value.dateFrom=L.from,o.value.dateTo=L.to,l.value=_,F()}};ee(()=>n.filters,_=>{o.value={category:_.category||null,event:_.event||null,dateFrom:_.dateFrom||_.date||i,dateTo:_.dateTo||null,hour:_.hour!==void 0?_.hour:null,ip:_.ip||null,status:_.status||null}},{deep:!0}),ee(o,_=>{t.value={..._},e("update:filters",{..._})},{deep:!0});const v=D(()=>{const _={};return o.value.category&&(_.category=o.value.category),o.value.event&&(_.event=o.value.event),o.value.hour!==null&&(_.hour=o.value.hour),o.value.ip&&(_.ip=o.value.ip),o.value.status&&(_.status=o.value.status),o.value.dateFrom&&o.value.dateFrom!==i&&(_.dateFrom=o.value.dateFrom),o.value.dateTo&&(_.dateTo=o.value.dateTo),_}),m=D(()=>Object.keys(v.value).length>0),C=_=>({category:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è",event:"–°–æ–±—ã—Ç–∏–µ",hour:"–ß–∞—Å",ip:"IP –∞–¥—Ä–µ—Å",status:"–°—Ç–∞—Ç—É—Å",dateFrom:"–î–∞—Ç–∞ –æ—Ç",dateTo:"–î–∞—Ç–∞ –¥–æ"})[_]||_,A=(_,b)=>_==="category"?Pe(b)||b:_==="hour"?`${String(b).padStart(2,"0")}:00`:_==="event"?We(b)||b:_==="status"&&{success:"–£—Å–ø–µ—à–Ω–æ",error:"–û—à–∏–±–∫–∞",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"}[b]||b,I=D(()=>[{value:null,label:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},{value:"tasks",label:Pe("tasks")},{value:"smart-processes",label:Pe("smart-processes")},{value:"errors",label:Pe("errors")}]),k=D(()=>[{value:null,label:"–í—Å–µ —Å–æ–±—ã—Ç–∏—è"},...["ONTASKADD","ONTASKUPDATE","ONTASKDELETE","ONTASKCOMMENTADD","ONTASKCOMMENTUPDATE","ONTASKCOMMENTDELETE","ONCRMDYNAMICITEMADD","ONCRMDYNAMICITEMUPDATE","ONCRMDYNAMICITEMDELETE"].map(b=>({value:b,label:We(b)}))]),T=_=>{_==="hour"?o.value[_]=null:_==="dateFrom"?o.value[_]=i:o.value[_]=null,l.value=null},f=_=>{const b={...o.value,category:_||null};r(b)&&(o.value.category=_)},y=_=>{const b={...o.value,event:_||null};r(b)&&(o.value.event=_)},E=(_,b)=>{if(_&&!/^\d{4}-\d{2}-\d{2}$/.test(_)){console.error("[WebhookLogFilters] Invalid date format:",_),a.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã";return}const L={...o.value,[b]:_||null};r(L)&&(o.value[b]=_)},O=_=>{if(_!=null){const L=parseInt(_,10);if(isNaN(L)||L<0||L>23){console.error("[WebhookLogFilters] Invalid hour:",_),a.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∞—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23)";return}}const b={...o.value,hour:_!=null?parseInt(_,10):null};r(b)&&(o.value.hour=_!=null?parseInt(_,10):null)},F=()=>{r({...o.value})},w=()=>{o.value={category:null,event:null,dateFrom:i,dateTo:null,hour:null,ip:null,status:null},l.value=null,t.clear(),e("reset")};return de(()=>{t.value&&Object.keys(t.value).length>0&&e("update:filters",{...t.value})}),{localFilters:o,activeFilters:v,hasActiveFilters:m,getFilterLabel:C,getFilterValue:A,clearFilter:T,handleFilterChange:F,handleCategoryChange:f,handleEventChange:y,handleDateChange:E,handleHourChange:O,handleReset:w,quickFilters:u,activeQuickFilter:l,applyQuickFilter:h,categoryOptions:I,eventOptions:k,validationError:a}}},ao={class:"webhook-log-filters"},oo={key:0,class:"active-filters-indicator"},no=["onClick"],ro={key:1,class:"validation-error"},io={class:"quick-filters"},lo=["onClick"],co={class:"filters-row"},uo={class:"filter-group"},go=["value"],mo={class:"filter-group"},ho=["value"],vo={class:"filter-group"},fo={class:"filter-group"},po={class:"filter-group"},yo={class:"filter-group"},_o={class:"filter-group"};function bo(n,e,a,t,r,i){return c(),d("div",ao,[t.hasActiveFilters?(c(),d("div",oo,[e[14]||(e[14]=s("span",{class:"indicator-text"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d($,null,j(t.activeFilters,(o,l)=>(c(),d("span",{key:l,class:"filter-badge"},[G(g(t.getFilterLabel(l))+": "+g(t.getFilterValue(l,o))+" ",1),s("button",{onClick:u=>t.clearFilter(l),class:"filter-badge-remove",title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"}," √ó ",8,no)]))),128)),s("button",{onClick:e[0]||(e[0]=(...o)=>t.handleReset&&t.handleReset(...o)),class:"btn-clear-all"}," –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ ")])):M("",!0),t.validationError?(c(),d("div",ro," ‚ö†Ô∏è "+g(t.validationError),1)):M("",!0),s("div",io,[e[15]||(e[15]=s("span",{class:"quick-filters-label"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d($,null,j(t.quickFilters,o=>(c(),d("button",{key:o.id,onClick:l=>t.applyQuickFilter(o.id),class:N(["quick-filter-btn",{active:t.activeQuickFilter===o.id}])},g(o.label),11,lo))),128))]),s("div",co,[s("div",uo,[e[16]||(e[16]=s("label",{for:"category-filter"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è:",-1)),z(s("select",{id:"category-filter","onUpdate:modelValue":e[1]||(e[1]=o=>t.localFilters.category=o),onChange:e[2]||(e[2]=o=>t.handleCategoryChange(t.localFilters.category)),class:"filter-select"},[(c(!0),d($,null,j(t.categoryOptions,o=>(c(),d("option",{key:o.value,value:o.value},g(o.label),9,go))),128))],544),[[ne,t.localFilters.category]])]),s("div",mo,[e[17]||(e[17]=s("label",{for:"event-filter"},"–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:",-1)),z(s("select",{id:"event-filter","onUpdate:modelValue":e[3]||(e[3]=o=>t.localFilters.event=o),onChange:e[4]||(e[4]=o=>t.handleEventChange(t.localFilters.event)),class:"filter-select"},[(c(!0),d($,null,j(t.eventOptions,o=>(c(),d("option",{key:o.value,value:o.value},g(o.label),9,ho))),128))],544),[[ne,t.localFilters.event]])]),s("div",vo,[e[18]||(e[18]=s("label",{for:"date-from-filter"},"–î–∞—Ç–∞ –æ—Ç:",-1)),z(s("input",{id:"date-from-filter","onUpdate:modelValue":e[5]||(e[5]=o=>t.localFilters.dateFrom=o),type:"date",onChange:e[6]||(e[6]=o=>t.handleDateChange(t.localFilters.dateFrom,"dateFrom")),class:"filter-input"},null,544),[[be,t.localFilters.dateFrom]])]),s("div",fo,[e[19]||(e[19]=s("label",{for:"date-to-filter"},"–î–∞—Ç–∞ –¥–æ:",-1)),z(s("input",{id:"date-to-filter","onUpdate:modelValue":e[7]||(e[7]=o=>t.localFilters.dateTo=o),type:"date",onChange:e[8]||(e[8]=o=>t.handleDateChange(t.localFilters.dateTo,"dateTo")),class:"filter-input"},null,544),[[be,t.localFilters.dateTo]])]),s("div",po,[e[20]||(e[20]=s("label",{for:"ip-filter"},"IP –∞–¥—Ä–µ—Å:",-1)),z(s("input",{id:"ip-filter","onUpdate:modelValue":e[9]||(e[9]=o=>t.localFilters.ip=o),type:"text",placeholder:"192.168.1.1",onInput:e[10]||(e[10]=(...o)=>t.handleFilterChange&&t.handleFilterChange(...o)),class:"filter-input"},null,544),[[be,t.localFilters.ip]])]),s("div",yo,[e[22]||(e[22]=s("label",{for:"status-filter"},"–°—Ç–∞—Ç—É—Å:",-1)),z(s("select",{id:"status-filter","onUpdate:modelValue":e[11]||(e[11]=o=>t.localFilters.status=o),onChange:e[12]||(e[12]=(...o)=>t.handleFilterChange&&t.handleFilterChange(...o)),class:"filter-select"},[...e[21]||(e[21]=[s("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),s("option",{value:"success"},"–£—Å–ø–µ—à–Ω–æ",-1),s("option",{value:"error"},"–û—à–∏–±–∫–∞",-1),s("option",{value:"warning"},"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",-1)])],544),[[ne,t.localFilters.status]])]),s("div",_o,[s("button",{onClick:e[13]||(e[13]=(...o)=>t.handleReset&&t.handleReset(...o)),class:"btn-reset"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])])}const wo=H(so,[["render",bo],["__scopeId","data-v-2a150a46"]]),ko={name:"WebhookLogList",props:{logs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null},pagination:{type:Object,default:null},selectedLogs:{type:Array,default:()=>[]}},emits:["select-log","page-change","update:selectedLogs"],setup(n,{emit:e}){const a=D(()=>!n.logs||!Array.isArray(n.logs)?(console.warn("[WebhookLogList] Invalid logs prop:",n.logs),[]):n.logs.map(b=>ze(b)).filter(b=>xe(b)?!0:(console.warn("[WebhookLogList] Invalid log entry:",b),!1))),t=p("timestamp"),r=p("desc"),i=b=>{t.value===b?r.value=r.value==="asc"?"desc":"asc":(t.value=b,r.value="desc")},o=D(()=>!a.value||a.value.length===0?[]:[...a.value].sort((L,V)=>{let U,S;switch(t.value){case"timestamp":U=new Date(L.timestamp||0).getTime(),S=new Date(V.timestamp||0).getTime();break;case"event":U=(L.event||"").toLowerCase(),S=(V.event||"").toLowerCase();break;case"category":U=(L.category||"").toLowerCase(),S=(V.category||"").toLowerCase();break;case"ip":U=(L.ip||"").toLowerCase(),S=(V.ip||"").toLowerCase();break;default:return 0}return U<S?r.value==="asc"?-1:1:U>S?r.value==="asc"?1:-1:0})),l=b=>t.value!==b?"‚ÜïÔ∏è":r.value==="asc"?"‚Üë":"‚Üì",u=b=>b.category==="errors"?"status-error":"status-success",h=b=>b.category==="errors"?"‚ùå":"‚úÖ",v=b=>b.category==="errors"?"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏":"–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ",m=b=>`${b.timestamp}_${b.event}_${b.ip||"unknown"}`,C=b=>b?vt(b,"short"):"‚Äî",A=b=>b?We(b):"‚Äî",I=b=>b?Pe(b):"‚Äî",k=b=>!b||typeof b!="object"?"‚Äî":ft(b),T=b=>`category-${b}`,f=b=>b?.startsWith("ONTASK")?"event-task":b?.startsWith("ONCRMDYNAMIC")?"event-smart-process":"event-other",y=b=>{e("select-log",b)},E=b=>{b>=1&&b<=n.pagination.pages&&e("page-change",b)},O=b=>n.selectedLogs.some(L=>m(L)===m(b)),F=(b,L)=>{L.stopPropagation();const V=[...n.selectedLogs],U=m(b),S=V.findIndex(X=>m(X)===U);L.target.checked?S===-1&&V.push(b):S!==-1&&V.splice(S,1),e("update:selectedLogs",V)},w=b=>{b.target.checked?e("update:selectedLogs",[...n.logs]):e("update:selectedLogs",[])},_=D(()=>a.value.length>0&&a.value.every(b=>O(b)));return ee(()=>n.logs,b=>{if(b&&Array.isArray(b)){const L=b.filter(V=>!xe(V)).length;L>0&&console.warn(`[WebhookLogList] Received ${L} invalid log entries out of ${b.length}`)}},{immediate:!0}),{validatedLogs:a,sortBy:t,sortOrder:r,sortedLogs:o,handleSort:i,getSortIcon:l,getStatusClass:u,getStatusIcon:h,getStatusTitle:v,getLogId:m,formatTimestamp:C,formatEvent:A,formatCategoryLabel:I,formatDetailsPreview:k,getCategoryClass:T,getEventClass:f,handleLogClick:y,handlePageChange:E,isSelected:O,handleSelectLog:F,handleSelectAll:w,allSelected:_}}},Co={class:"webhook-log-list"},So={key:0,class:"logs-table-container"},Do={class:"logs-table"},To={class:"checkbox-header"},Ao=["checked"],Eo={class:"sort-icon"},Mo={class:"sort-icon"},xo={class:"sort-icon"},Io={class:"sort-icon"},Lo=["onClick"],Po=["checked","onChange"],Fo=["title"],Uo={class:"details-preview"},Ro=["onClick"],Oo={key:0,class:"pagination"},No=["disabled"],Bo={class:"pagination-info"},Vo=["disabled"];function $o(n,e,a,t,r,i){return c(),d("div",Co,[a.logs.length>0?(c(),d("div",So,[s("table",Do,[s("thead",null,[s("tr",null,[s("th",To,[s("input",{type:"checkbox",checked:t.allSelected,onChange:e[0]||(e[0]=(...o)=>t.handleSelectAll&&t.handleSelectAll(...o)),onClick:e[1]||(e[1]=fe(()=>{},["stop"])),class:"checkbox-input",title:"–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"},null,40,Ao)]),s("th",{onClick:e[2]||(e[2]=o=>t.handleSort("timestamp")),class:N(["sortable",{"sort-asc":t.sortBy==="timestamp"&&t.sortOrder==="asc","sort-desc":t.sortBy==="timestamp"&&t.sortOrder==="desc"}])},[e[9]||(e[9]=G(" –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è ",-1)),s("span",Eo,g(t.getSortIcon("timestamp")),1)],2),s("th",{onClick:e[3]||(e[3]=o=>t.handleSort("event")),class:N(["sortable",{"sort-asc":t.sortBy==="event"&&t.sortOrder==="asc","sort-desc":t.sortBy==="event"&&t.sortOrder==="desc"}])},[e[10]||(e[10]=G(" –¢–∏–ø —Å–æ–±—ã—Ç–∏—è ",-1)),s("span",Mo,g(t.getSortIcon("event")),1)],2),s("th",{onClick:e[4]||(e[4]=o=>t.handleSort("category")),class:N(["sortable",{"sort-asc":t.sortBy==="category"&&t.sortOrder==="asc","sort-desc":t.sortBy==="category"&&t.sortOrder==="desc"}])},[e[11]||(e[11]=G(" –ö–∞—Ç–µ–≥–æ—Ä–∏—è ",-1)),s("span",xo,g(t.getSortIcon("category")),1)],2),s("th",{onClick:e[5]||(e[5]=o=>t.handleSort("ip")),class:N(["sortable",{"sort-asc":t.sortBy==="ip"&&t.sortOrder==="asc","sort-desc":t.sortBy==="ip"&&t.sortOrder==="desc"}])},[e[12]||(e[12]=G(" IP ",-1)),s("span",Io,g(t.getSortIcon("ip")),1)],2),e[13]||(e[13]=s("th",null,"–î–µ—Ç–∞–ª–∏",-1)),e[14]||(e[14]=s("th",null,"–î–µ–π—Å—Ç–≤–∏—è",-1))])]),s("tbody",null,[(c(!0),d($,null,j(t.sortedLogs,o=>(c(),d("tr",{key:t.getLogId(o),onClick:l=>t.handleLogClick(o),class:N(["log-row",{"row-selected":t.isSelected(o)}])},[s("td",{onClick:e[6]||(e[6]=fe(()=>{},["stop"]))},[s("input",{type:"checkbox",checked:t.isSelected(o),onChange:l=>t.handleSelectLog(o,l),class:"checkbox-input"},null,40,Po)]),s("td",null,g(t.formatTimestamp(o.timestamp)),1),s("td",null,[s("span",{class:N(["status-indicator",t.getStatusClass(o)]),title:t.getStatusTitle(o)},g(t.getStatusIcon(o)),11,Fo),s("span",{class:N(["event-badge",t.getEventClass(o.event)])},g(t.formatEvent(o.event)),3)]),s("td",null,[s("span",{class:N(["category-badge",t.getCategoryClass(o.category)])},g(t.formatCategoryLabel(o.category)),3)]),s("td",null,g(o.ip||"N/A"),1),s("td",null,[s("div",Uo,g(t.formatDetailsPreview(o.details)),1)]),s("td",null,[s("button",{onClick:fe(l=>t.handleLogClick(o),["stop"]),class:"btn-view"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,Ro)])],10,Lo))),128))])]),a.pagination&&a.pagination.pages>1?(c(),d("div",Oo,[s("button",{onClick:e[7]||(e[7]=o=>t.handlePageChange(a.pagination.page-1)),disabled:a.pagination.page<=1,class:"btn-pagination"}," –ù–∞–∑–∞–¥ ",8,No),s("span",Bo," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+g(a.pagination.page)+" –∏–∑ "+g(a.pagination.pages)+" (–≤—Å–µ–≥–æ: "+g(a.pagination.total)+") ",1),s("button",{onClick:e[8]||(e[8]=o=>t.handlePageChange(a.pagination.page+1)),disabled:a.pagination.page>=a.pagination.pages,class:"btn-pagination"}," –í–ø–µ—Ä—ë–¥ ",8,Vo)])):M("",!0)])):M("",!0)])}const jo=H(ko,[["render",$o],["__scopeId","data-v-fddd3018"]]),zo={name:"LoadingSkeleton",props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"20px"},variant:{type:String,default:"rect",validator:n=>["rect","circle","text","table-row"].includes(n)},animated:{type:Boolean,default:!0},borderRadius:{type:String,default:null}},setup(n){return{skeletonStyle:D(()=>{const a={width:typeof n.width=="number"?`${n.width}px`:n.width,height:typeof n.height=="number"?`${n.height}px`:n.height};return n.borderRadius&&(a.borderRadius=n.borderRadius),a})}}},Wo={key:0,class:"skeleton-shimmer"};function qo(n,e,a,t,r,i){return c(),d("div",{class:N(["skeleton",[`skeleton-${a.variant}`,{"skeleton-animated":a.animated}]]),style:Ee(t.skeletonStyle)},[a.animated?(c(),d("div",Wo)):M("",!0)],6)}const Ho=H(zo,[["render",qo],["__scopeId","data-v-014f86e6"]]),Xo={name:"SkeletonLogList",components:{LoadingSkeleton:Ho},props:{rows:{type:Number,default:5}},setup(){return{getColumnWidth:e=>["40px","15%","20%","15%","15%","20%","15%"][e-1]||"100%"}}},Jo={class:"skeleton-log-list"},Yo={class:"skeleton-table-header"};function Ko(n,e,a,t,r,i){const o=W("LoadingSkeleton");return c(),d("div",Jo,[s("div",Yo,[(c(),d($,null,j(7,l=>J(o,{key:l,width:"120px",height:"16px",variant:"text"})),64))]),(c(!0),d($,null,j(a.rows,l=>(c(),d("div",{key:l,class:"skeleton-table-row"},[(c(),d($,null,j(7,u=>J(o,{key:u,width:"100%",height:"20px",variant:"text",style:Ee({width:t.getColumnWidth(u)})},null,8,["style"])),64))]))),128))])}const Go=H(Xo,[["render",Ko],["__scopeId","data-v-475c4e73"]]),Qo={name:"EmptyState",props:{icon:{type:String,default:"üì≠"},title:{type:String,required:!0},description:{type:String,required:!0},actionLabel:{type:String,default:null},actions:{type:Array,default:null},hints:{type:Array,default:()=>[]},variant:{type:String,default:"default",validator:n=>["default","error","warning","info"].includes(n)}},emits:["action","action-click"]},Zo={class:"empty-icon"},en={class:"empty-title"},tn={class:"empty-description"},sn={key:0,class:"empty-hints"},an={key:1,class:"empty-actions"},on=["onClick"];function nn(n,e,a,t,r,i){return c(),d("div",{class:N(["empty-state",`empty-state-${a.variant}`])},[s("div",Zo,g(a.icon),1),s("h3",en,g(a.title),1),s("p",tn,g(a.description),1),a.hints&&a.hints.length>0?(c(),d("div",sn,[(c(!0),d($,null,j(a.hints,(o,l)=>(c(),d("div",{key:l,class:"hint-item"}," üí° "+g(o),1))),128))])):M("",!0),a.actionLabel||a.actions?(c(),d("div",an,[a.actionLabel?(c(),d("button",{key:0,onClick:e[0]||(e[0]=o=>n.$emit("action")),class:"btn-primary"},g(a.actionLabel),1)):M("",!0),(c(!0),d($,null,j(a.actions,(o,l)=>(c(),d("button",{key:l,onClick:u=>n.$emit("action-click",o.id),class:N(["btn",`btn-${o.variant||"secondary"}`])},g(o.label),11,on))),128))])):M("",!0)],2)}const rn=H(Qo,[["render",nn],["__scopeId","data-v-081c13b9"]]),ln={name:"ErrorDisplay",props:{title:{type:String,default:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"},message:{type:String,required:!0},details:{type:String,default:null},severity:{type:String,default:"error",validator:n=>["error","warning","critical"].includes(n)},retryable:{type:Boolean,default:!1}},emits:["retry"],setup(){return{showDetails:p(!1)}}},cn={class:"error-icon"},dn={class:"error-content"},un={class:"error-title"},gn={class:"error-message"},mn={key:0,class:"error-details"},hn={class:"error-actions"};function vn(n,e,a,t,r,i){return c(),d("div",{class:N(["error-display",`error-${a.severity}`])},[s("div",cn,g(a.severity==="critical"?"üö®":"‚ö†Ô∏è"),1),s("div",dn,[s("h4",un,g(a.title),1),s("p",gn,g(a.message),1),a.details&&t.showDetails?(c(),d("div",mn,[s("pre",null,g(a.details),1)])):M("",!0),s("div",hn,[a.retryable?(c(),d("button",{key:0,onClick:e[0]||(e[0]=o=>n.$emit("retry")),class:"btn-retry"}," üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")):M("",!0),a.details?(c(),d("button",{key:1,onClick:e[1]||(e[1]=o=>t.showDetails=!t.showDetails),class:"btn-details"},g(t.showDetails?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å")+" –¥–µ—Ç–∞–ª–∏ ",1)):M("",!0)])])],2)}const fn=H(ln,[["render",vn],["__scopeId","data-v-3f2f4c14"]]),Xe=p([]);let pn=0;function Ot(){const n=(l,u="info",h=3e3)=>{const v=++pn,m={id:v,message:l,type:u,duration:h,timestamp:Date.now()};return Xe.value.push(m),h>0&&setTimeout(()=>{e(v)},h),v},e=l=>{const u=Xe.value.findIndex(h=>h.id===l);u>-1&&Xe.value.splice(u,1)};return{notifications:Xe,showNotification:n,removeNotification:e,clearNotifications:()=>{Xe.value=[]},success:(l,u=3e3)=>n(l,"success",u),error:(l,u=5e3)=>n(l,"error",u),warning:(l,u=4e3)=>n(l,"warning",u),info:(l,u=3e3)=>n(l,"info",u)}}const yn={name:"Notification",props:{notification:{type:Object,required:!0}},emits:["close"],setup(n,{emit:e}){const a=p(100),t=D(()=>n.notification.duration>0);let r=null;const i={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},o=D(()=>i[n.notification.type]||"‚ÑπÔ∏è"),l=()=>{e("close")},u=()=>{n.notification.onClick&&n.notification.onClick()};return de(()=>{if(t.value&&n.notification.duration>0){const h=Date.now(),v=n.notification.duration;r=setInterval(()=>{const m=Date.now()-h;a.value=Math.max(0,100-m/v*100),a.value<=0&&(clearInterval(r),l())},50)}}),qe(()=>{r&&clearInterval(r)}),{icon:o,progress:a,showProgress:t,close:l,handleClick:u}}},_n={class:"notification-content"},bn={class:"notification-icon"},wn={class:"notification-message"},kn={key:0,class:"notification-progress"};function Cn(n,e,a,t,r,i){return c(),d("div",{class:N(["notification",`notification-${a.notification.type}`]),onClick:e[1]||(e[1]=(...o)=>t.handleClick&&t.handleClick(...o))},[s("div",_n,[s("span",bn,g(t.icon),1),s("span",wn,g(a.notification.message),1)]),s("button",{onClick:e[0]||(e[0]=fe((...o)=>t.close&&t.close(...o),["stop"])),class:"notification-close"},"‚úï"),t.showProgress?(c(),d("div",kn,[s("div",{class:"progress-bar",style:Ee({width:`${t.progress}%`})},null,4)])):M("",!0)],2)}const Sn=H(yn,[["render",Cn],["__scopeId","data-v-1b602bdf"]]),Dn={name:"NotificationContainer",components:{Notification:Sn},setup(){const{notifications:n,removeNotification:e}=Ot();return{notifications:n,removeNotification:e}}},Tn={class:"notification-container"};function An(n,e,a,t,r,i){const o=W("Notification");return c(),re(kt,{to:"body"},[s("div",Tn,[J(Jt,{name:"notification",tag:"div"},{default:_e(()=>[(c(!0),d($,null,j(t.notifications,l=>(c(),re(o,{key:l.id,notification:l,onClose:u=>t.removeNotification(l.id)},null,8,["notification","onClose"]))),128))]),_:1})])])}const En=H(Dn,[["render",An],["__scopeId","data-v-dd8772c8"]]),Mn={name:"RealtimeControls",props:{enabled:{type:Boolean,default:!1},connectionState:{type:String,default:"disconnected"},error:{type:String,default:null}},emits:["toggle"],setup(n,{emit:e}){const a=p(n.enabled);ee(()=>n.enabled,m=>{a.value=m});const t=D(()=>n.connectionState==="connecting"),r=D(()=>!!n.error),i=D(()=>({"status-connected":n.connectionState==="connected","status-connecting":n.connectionState==="connecting","status-disconnected":n.connectionState==="disconnected","status-error":n.connectionState==="error"})),o=D(()=>{switch(n.connectionState){case"connected":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";case"connecting":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...";case"disconnected":return"–û—Ç–∫–ª—é—á–µ–Ω–æ";case"error":return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}}),l=D(()=>o.value),u=D(()=>({"status-connected":n.connectionState==="connected","status-connecting":n.connectionState==="connecting","status-disconnected":n.connectionState==="disconnected","status-error":n.connectionState==="error"})),h=D(()=>n.error?typeof n.error=="string"?n.error:n.error.message?n.error.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞":null);return{localEnabled:a,isConnecting:t,hasError:r,statusClass:i,statusText:o,connectionStatusText:l,connectionStatusClass:u,displayError:h,handleToggle:()=>{e("toggle",a.value)}}}},xn={class:"realtime-controls"},In={class:"control-toggle"},Ln=["disabled"],Pn={class:"status-text"},Fn={key:0,class:"error-message"};function Un(n,e,a,t,r,i){return c(),d("div",xn,[s("label",In,[z(s("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=o=>t.localEnabled=o),onChange:e[1]||(e[1]=(...o)=>t.handleToggle&&t.handleToggle(...o)),disabled:t.isConnecting},null,40,Ln),[[Ne,t.localEnabled]]),e[2]||(e[2]=s("span",{class:"toggle-label"},"–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",-1))]),s("div",{class:N(["status-indicator",t.statusClass])},[e[3]||(e[3]=s("span",{class:"status-dot"},null,-1)),s("span",Pn,g(t.statusText),1)],2),t.hasError&&t.displayError?(c(),d("div",Fn," ‚ö†Ô∏è "+g(t.displayError),1)):M("",!0)])}const Rn=H(Mn,[["render",Un],["__scopeId","data-v-af36f073"]]),On={name:"NewLogsIndicator",props:{count:{type:Number,default:0},newLogs:{type:Array,default:()=>[]}},emits:["apply","dismiss"],setup(n,{emit:e}){const a=(o,l,u,h)=>{const v=o%10,m=o%100;return m>=11&&m<=19?h:v===1?l:v>=2&&v<=4?u:h},t=D(()=>!n.newLogs||!Array.isArray(n.newLogs)||n.newLogs.length===0?[]:n.newLogs.map(l=>ze(l)).filter(l=>xe(l)).slice(0,5).map(l=>({...l,formatted:{event:We(l.event),category:Pe(l.category)}})));return{pluralize:a,newLogsPreview:t,handleApply:()=>{if(!n.newLogs||n.newLogs.length===0)return;const o=n.newLogs.map(l=>ze(l)).filter(l=>xe(l));if(o.length===0){console.warn("[NewLogsIndicator] No valid logs to apply");return}e("apply",o)},handleDismiss:()=>{e("dismiss")}}}},Nn={key:0,class:"new-logs-indicator"},Bn={class:"indicator-content"},Vn={class:"indicator-text"},$n={class:"indicator-actions"};function jn(n,e,a,t,r,i){return c(),re(Ie,{name:"slide-down"},{default:_e(()=>[a.count>0?(c(),d("div",Nn,[s("div",Bn,[e[2]||(e[2]=s("span",{class:"indicator-icon"},"üîî",-1)),s("span",Vn,g(a.count)+" "+g(t.pluralize(a.count,"–Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π")),1),s("div",$n,[s("button",{onClick:e[0]||(e[0]=(...o)=>t.handleApply&&t.handleApply(...o)),class:"btn-apply"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å "),s("button",{onClick:e[1]||(e[1]=(...o)=>t.handleDismiss&&t.handleDismiss(...o)),class:"btn-dismiss"}," ‚úï ")])])])):M("",!0)]),_:1})}const zn=H(On,[["render",jn],["__scopeId","data-v-19791dbc"]]);class Wn{constructor(e,a={}){this.url=e,this.options={reconnectInterval:3e3,maxReconnectAttempts:10,reconnectDelay:1e3,lastTimestamp:null,...a},this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.reconnectTimer=null,this.isManualDisconnect=!1,this.connectionState="disconnected"}updateOptions(e){this.options={...this.options,...e}}connect(){if(this.connectionState==="connected"||this.connectionState==="connecting"){console.warn("[RealtimeService] Already connected or connecting");return}this.isManualDisconnect=!1,this.connectionState="connecting",this.notifyListeners("state-change",{state:this.connectionState});try{let e=this.url;if(!e.startsWith("http://")&&!e.startsWith("https://")){const a=new URL(e,window.location.origin);this.options.lastTimestamp&&a.searchParams.set("last_timestamp",this.options.lastTimestamp),e=a.toString()}else{const a=new URL(e);this.options.lastTimestamp&&a.searchParams.set("last_timestamp",this.options.lastTimestamp),e=a.toString()}console.log("[RealtimeService] Connecting to:",e),this.eventSource=new EventSource(e),this.eventSource.onopen=()=>{console.log("[RealtimeService] EventSource opened"),this.notifyListeners("open",{timestamp:new Date().toISOString()})},this.eventSource.onmessage=a=>{try{const t=JSON.parse(a.data);this.notifyListeners("message",t)}catch(t){console.error("[RealtimeService] Error parsing message:",t)}},this.eventSource.addEventListener("connected",a=>{try{const t=JSON.parse(a.data);console.log("[RealtimeService] Connected event received:",t),this.connectionState="connected",this.reconnectAttempts=0,this.notifyListeners("connected",t),this.notifyListeners("state-change",{state:this.connectionState})}catch(t){console.error("[RealtimeService] Error parsing connected event:",t)}}),this.eventSource.addEventListener("new_logs",a=>{const t=JSON.parse(a.data);if(t.logs&&t.logs.length>0){const r=t.logs[t.logs.length-1];r.timestamp&&(this.options.lastTimestamp=r.timestamp)}this.notifyListeners("new_logs",t)}),this.eventSource.addEventListener("error",a=>{try{const t=JSON.parse(a.data);this.notifyListeners("error",t)}catch{this.notifyListeners("error",{message:"Server error"})}}),this.eventSource.addEventListener("timeout",a=>{try{const t=JSON.parse(a.data);this.notifyListeners("timeout",t)}catch{this.notifyListeners("timeout",{message:"Connection timeout"})}this.reconnect()}),this.eventSource.addEventListener("closed",a=>{try{const t=JSON.parse(a.data);this.notifyListeners("closed",t)}catch{this.notifyListeners("closed",{message:"Connection closed"})}this.isManualDisconnect||this.reconnect()}),this.eventSource.onerror=a=>{console.error("[RealtimeService] Connection error:",a),console.error("[RealtimeService] EventSource readyState:",this.eventSource?.readyState),this.eventSource?.readyState===EventSource.CLOSED?(console.log("[RealtimeService] EventSource closed by server"),this.connectionState="disconnected",this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()):this.eventSource?.readyState===EventSource.CONNECTING?console.log("[RealtimeService] Still connecting..."):(this.connectionState="error",this.notifyListeners("error",{error:a,type:"connection",message:"Failed to connect to realtime stream",readyState:this.eventSource?.readyState}),this.notifyListeners("state-change",{state:this.connectionState}),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isManualDisconnect||this.reconnect())}}catch(e){console.error("[RealtimeService] Error creating EventSource:",e),this.connectionState="error",this.notifyListeners("error",{error:e,type:"initialization"}),this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()}}reconnect(){if(this.isManualDisconnect)return;if(this.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("[RealtimeService] Max reconnect attempts reached"),this.notifyListeners("max-reconnect-attempts",{attempts:this.reconnectAttempts});return}this.reconnectAttempts++;const e=Math.min(this.options.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.options.reconnectInterval);console.log(`[RealtimeService] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},e)}disconnect(){this.isManualDisconnect=!0,this.connectionState="disconnected",this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.notifyListeners("disconnected",{timestamp:new Date().toISOString()}),this.notifyListeners("state-change",{state:this.connectionState})}on(e,a){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(a)}off(e,a){if(this.listeners.has(e)){const t=this.listeners.get(e),r=t.indexOf(a);r>-1&&t.splice(r,1)}}notifyListeners(e,a){this.listeners.has(e)&&this.listeners.get(e).forEach(t=>{try{t(a)}catch(r){console.error(`[RealtimeService] Error in listener for ${e}:`,r)}})}getState(){return this.connectionState}isConnected(){return this.connectionState==="connected"}}function qn(n,e={}){const{autoConnect:a=!1,enableSound:t=!1,onNewLogs:r=null,validateLogs:i=!0}=e,o=new Wn(n,e),l=p("disconnected"),u=p([]),h=p(0),v=p(null),m=p(null),C=p(0),A=D(()=>l.value==="connected"),I=D(()=>l.value==="connecting"),k=D(()=>l.value==="error"),T=D(()=>h.value>0),f=U=>{l.value=U.state,U.state==="connected"&&(C.value=0,m.value=null)},y=U=>{let S=U.logs||[];if(i){S=ht(S);const X=S.filter(R=>xe(R));X.length!==S.length&&console.warn("[useRealtime] Filtered out invalid logs:",S.length-X.length),S=X}S.length!==0&&(u.value.push(...S),h.value+=S.length,v.value=new Date().toISOString(),t&&S.length>0&&V(),r&&r(S))},E=U=>{const S=U.message||U.error?.message||"Connection error";m.value=S,l.value="error",console.error("[useRealtime] Error:",U)},O=U=>{console.warn("[useRealtime] Connection timeout:",U)},F=U=>{m.value=`Max reconnect attempts reached (${U.attempts})`,console.error("[useRealtime] Max reconnect attempts:",U)},w=(U={})=>{m.value=null,U.lastTimestamp!==void 0&&o.updateOptions({lastTimestamp:U.lastTimestamp}),o.on("state-change",f),o.on("new_logs",y),o.on("error",E),o.on("timeout",O),o.on("max-reconnect-attempts",F),o.connect()},_=()=>{o.off("state-change",f),o.off("new_logs",y),o.off("error",E),o.off("timeout",O),o.off("max-reconnect-attempts",F),o.disconnect()},b=()=>{u.value=[],h.value=0},L=U=>{U&&Array.isArray(U)&&(U.unshift(...u.value),b())},V=()=>{try{const U=new Audio("/sounds/notification.mp3");U.volume=.3,U.play().catch(S=>{console.warn("[useRealtime] Failed to play sound:",S)})}catch(U){console.warn("[useRealtime] Sound not available:",U)}};return a&&de(()=>{w()}),qe(()=>{_()}),{connectionState:l,isConnected:A,isConnecting:I,hasError:k,newLogs:u,newLogsCount:h,hasNewLogs:T,lastUpdateTime:v,error:m,reconnectAttempts:C,connect:w,disconnect:_,clearNewLogs:b,applyNewLogs:L}}const Hn=Ct(()=>ve(()=>import("./WebhookLogsDashboard.vue-BGYExqNL.js"),__vite__mapDeps([7,4,1,5,6,2]),import.meta.url)),Xn=Ct(()=>ve(()=>import("./WebhookLogDetails.vue-BKgU23H6.js"),__vite__mapDeps([8,4,1,5,6,2]),import.meta.url)),Jn={name:"WebhookLogsPage",components:{WebhookLogsDashboard:Hn,WebhookLogsExport:Xa,WebhookLogSearch:eo,WebhookLogFilters:wo,WebhookLogList:jo,WebhookLogDetails:Xn,SkeletonLogList:Go,EmptyState:rn,ErrorDisplay:fn,NotificationContainer:En,RealtimeControls:Rn,NewLogsIndicator:zn},setup(){const n=Ye(),{success:e,error:a}=Ot(),t=p(!1),r=p(!1),i=p(null),o=p(null),l=p([]),u=(x,q=2)=>{if(x==null)return String(x);if(typeof x=="string")return x;const se=(K,me=0)=>{if(me>10)return"[Max Depth]";if(K==null||typeof K!="object")return K;if(Array.isArray(K))return K.map(ge=>se(ge,me+1));const Ce={};try{for(const ge in K)if(Object.prototype.hasOwnProperty.call(K,ge))try{const Ke=K[ge];if(typeof Ke=="function"||Ke===void 0)continue;Ce[ge]=se(Ke,me+1)}catch{Ce[ge]="[Error reading property]"}}catch{return"[Error reading object]"}return Ce};try{const K=se(x),me=new WeakSet;return JSON.stringify(K,(Ce,ge)=>{if(typeof ge=="object"&&ge!==null){if(me.has(ge))return"[Circular]";me.add(ge)}return ge},q)}catch(K){return console.error("[WebhookLogsPage] Error in safeStringify:",K),`[Error: ${K.message}]`}},h=p(null),v=p([]),m=p(""),C=p(null),A=p(null),I=p(!1),{connectionState:k,newLogsCount:T,error:f,connect:y,disconnect:E,applyNewLogs:O,clearNewLogs:F}=qn(Ae("/api/webhook-realtime.php"),{autoConnect:!1,enableSound:!0,validateLogs:!0,onNewLogs:x=>{console.log("[WebhookLogsPage] New logs received:",x.length),x.length>0&&(l.value.unshift(...x),L.value.total+=x.length,e(`–ü–æ–ª—É—á–µ–Ω–æ ${x.length} –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π`))}}),{filters:w,updateFilters:_,clearFilters:b}=na(),L=p({page:1,limit:50,total:0,pages:0}),V=D(()=>{let x=[...l.value];return m.value&&m.value.trim()&&(x=ra(x,m.value,{caseSensitive:!1,searchInEvent:!0,searchInPayload:!0,searchInDetails:!0,searchInIp:!0})),w.value.category&&(x=x.filter(q=>q.category===w.value.category)),w.value.event&&(x=x.filter(q=>q.event===w.value.event)),w.value.ip&&(x=x.filter(q=>q.ip&&q.ip.includes(w.value.ip))),w.value.status&&(x=x.filter(q=>w.value.status==="error"?q.category==="errors":w.value.status==="success"?q.category!=="errors":!0)),w.value.dateFrom&&(x=x.filter(q=>q.timestamp?new Date(q.timestamp).toISOString().split("T")[0]>=w.value.dateFrom:!1)),w.value.dateTo&&(x=x.filter(q=>q.timestamp?new Date(q.timestamp).toISOString().split("T")[0]<=w.value.dateTo:!1)),w.value.hour!==null&&(x=x.filter(q=>q.timestamp?new Date(q.timestamp).getHours()===w.value.hour:!1)),x});ee(V,x=>{C.value&&m.value&&C.value.setResultsCount(x.length)});const U=async()=>{try{await Le.init();const x=await Le.getCurrentUser();if(console.log("[WebhookLogsPage] User data:",x),!x||!x.ID){console.warn("[WebhookLogsPage] User not determined"),o.value=u({error:"User not determined",userId:x?.ID||null,userName:x?`${x.NAME||""} ${x.LAST_NAME||""}`.trim():null}),t.value=!1;return}const q=x?.UF_DEPARTMENT||[];if(console.log("[WebhookLogsPage] User departments:",q),console.log("[WebhookLogsPage] Allowed departments:",Be.allowedDepartmentIds),q.length>0){const se=q.some(K=>Pt(K));console.log("[WebhookLogsPage] Has access:",se),t.value=se,se||(o.value=u({userId:x.ID,userName:`${x.NAME||""} ${x.LAST_NAME||""}`.trim(),userDepartments:q,allowedDepartments:Be.allowedDepartmentIds,message:"User departments do not match allowed departments"}))}else console.warn("[WebhookLogsPage] User has no departments"),o.value=u({userId:x.ID,userName:`${x.NAME||""} ${x.LAST_NAME||""}`.trim(),userDepartments:[],allowedDepartments:Be.allowedDepartmentIds,message:"User has no departments assigned"}),t.value=!1}catch(x){console.error("[WebhookLogsPage] Error checking access:",x),o.value=u({error:x.message,stack:x.stack}),t.value=!1}},S=D(()=>Be.allowedDepartmentIds.join(", ")),X=async(x=!1)=>{if(t.value&&!(ae&&!x)){ae=!0,r.value=!0,i.value=null;try{const q=new Date().toISOString().split("T")[0],se={category:w.value.category||null,event:w.value.event||null,date:w.value.dateFrom||q,hour:w.value.hour!==null&&w.value.hour!==void 0?w.value.hour:null,ip:w.value.ip||null,status:w.value.status||null,dateFrom:w.value.dateFrom||q,dateTo:w.value.dateTo||null};if(!lt(se))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");console.log("[WebhookLogsPage] Loading logs with filters:",se);const K=await bt.getLogs(se,L.value.page,L.value.limit,x);if(console.log("[WebhookLogsPage] API result:",K),console.log("[WebhookLogsPage] Logs count:",K?.logs?.length||0),console.log("[WebhookLogsPage] Pagination:",K?.pagination),!K.success)throw new Error(K.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤");ia(K.pagination)?L.value=K.pagination:(console.warn("[WebhookLogsPage] Invalid pagination format, using defaults"),L.value={page:L.value.page,limit:L.value.limit,total:K.logs.length,pages:Math.ceil(K.logs.length/L.value.limit)});const me=ht(K.logs),Ce=me.filter(ge=>xe(ge));Ce.length!==me.length&&console.warn("[WebhookLogsPage] Filtered out invalid logs:",me.length-Ce.length),l.value=Ce,x&&e("–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")}catch(q){R(q)}finally{r.value=!1,ae=!1}}},R=x=>{console.error("[WebhookLogsPage] API Error:",x),x.status===403?(i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",a("–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º –≤–µ–±—Ö—É–∫–æ–≤")):x.status===404?(i.value="–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",a("–õ–æ–≥–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")):x.status>=500?(i.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",a("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")):(i.value=x.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",a(i.value)),x.status>=500&&(l.value=[])},ue=x=>{m.value=x,_({search:x||null})};let ae=!1;const P=x=>{if(!lt(x)){a("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");return}const q={category:w.value.category,event:w.value.event,dateFrom:w.value.dateFrom,dateTo:w.value.dateTo,hour:w.value.hour,ip:w.value.ip,status:w.value.status},se={category:x?.category||null,event:x?.event||null,dateFrom:x?.dateFrom||null,dateTo:x?.dateTo||null,hour:x?.hour!==void 0?x.hour:null,ip:x?.ip||null,status:x?.status||null},K=Object.keys(se).some(me=>{const Ce=q[me],ge=se[me];return Ce!==ge});if(!(!K&&!ae)){if(_(se),L.value.page=1,K)try{bt.invalidateCacheOnFilterChange(q,se)}catch(me){console.error("[WebhookLogsPage] Error invalidating cache:",me)}ae||(ae=!0,X(!0).finally(()=>{ae=!1}))}},Y=()=>{b(),m.value="",L.value.page=1,X()},oe=x=>{h.value=x},ie=()=>{h.value=null},Q=x=>{L.value.page=x,X()},le=()=>{try{n.push("/")}catch(x){console.error("Navigation error:",x),window.location.hash="#/"}},B=x=>{v.value=x},Z=x=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—á–∞—Ç:",x)},ce=x=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω:",x),e(`–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω: ${x.count} –∑–∞–ø–∏—Å–µ–π –≤ —Ñ–∞–π–ª–µ ${x.filename}`)},he=x=>{console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:",x),a(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${x.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`)},we=()=>{m.value="",Y()},He=x=>{if(console.log("[WebhookLogsPage] Toggle auto-update:",x),I.value=x,x){let q=null;if(l.value.length>0){const se=l.value[0];se.timestamp&&(q=se.timestamp,console.log("[WebhookLogsPage] Using lastTimestamp:",q))}y({lastTimestamp:q})}else E()},ke=()=>{O(l.value),e("–ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")},ot=()=>{F()};return de(async()=>{await U(),t.value&&(w.value.search&&(m.value=w.value.search),await X())}),{hasAccess:t,loading:r,error:i,logs:l,filteredLogs:V,selectedLog:h,selectedLogs:v,filters:w,searchQuery:m,searchComponent:C,pagination:L,previousPeriodStats:A,handleFiltersUpdate:P,handleFiltersReset:Y,handleSearch:ue,handleLogSelect:oe,handleLogClose:ie,handlePageChange:Q,handleSelectedLogsUpdate:B,handleExportStart:Z,handleExportComplete:ce,handleExportError:he,handleClearSearch:we,autoUpdateEnabled:I,connectionState:k,newLogsCount:T,realtimeError:f,handleToggleAutoUpdate:He,handleApplyNewLogs:ke,handleDismissNewLogs:ot,allowedDepartmentsText:S,accessDebugInfo:o,goBack:le}}},Yn={class:"webhook-logs-page"},Kn={class:"page-header"},Gn={class:"page-header-top"},Qn={key:0,class:"access-denied"},Zn={class:"access-denied-content"},er={class:"access-hint"},tr={key:0,class:"access-debug"},sr={key:1,class:"page-content"},ar={class:"actions-bar"};function or(n,e,a,t,r,i){const o=W("WebhookLogsDashboard"),l=W("WebhookLogsExport"),u=W("WebhookLogSearch"),h=W("RealtimeControls"),v=W("NewLogsIndicator"),m=W("WebhookLogFilters"),C=W("SkeletonLogList"),A=W("WebhookLogList"),I=W("EmptyState"),k=W("ErrorDisplay"),T=W("WebhookLogDetails"),f=W("NotificationContainer");return c(),d("div",Yn,[s("div",Kn,[s("div",Gn,[s("button",{onClick:e[0]||(e[0]=(...y)=>t.goBack&&t.goBack(...y)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[3]||(e[3]=[s("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),s("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[4]||(e[4]=s("h1",null,"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ Bitrix24",-1))]),t.hasAccess?(c(),d("div",sr,[J(o,{logs:t.logs,pagination:t.pagination,"previous-period-stats":t.previousPeriodStats},null,8,["logs","pagination","previous-period-stats"]),s("div",ar,[J(l,{logs:t.filteredLogs,"selected-logs":t.selectedLogs,filters:t.filters,"total-count":t.filteredLogs.length,onExportStart:t.handleExportStart,onExportComplete:t.handleExportComplete,onExportError:t.handleExportError},null,8,["logs","selected-logs","filters","total-count","onExportStart","onExportComplete","onExportError"]),J(u,{modelValue:t.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=y=>t.searchQuery=y),onSearch:t.handleSearch,ref:"searchComponent"},null,8,["modelValue","onSearch"])]),J(h,{enabled:t.autoUpdateEnabled,"connection-state":t.connectionState,error:t.realtimeError,onToggle:t.handleToggleAutoUpdate},null,8,["enabled","connection-state","error","onToggle"]),J(v,{count:t.newLogsCount,onApply:t.handleApplyNewLogs,onDismiss:t.handleDismissNewLogs},null,8,["count","onApply","onDismiss"]),J(m,{filters:t.filters,"onUpdate:filters":t.handleFiltersUpdate,onReset:t.handleFiltersReset},null,8,["filters","onUpdate:filters","onReset"]),J(Ie,{name:"fade"},{default:_e(()=>[t.loading&&t.logs.length===0?(c(),re(C,{key:0,rows:5})):M("",!0)]),_:1}),J(Ie,{name:"fade"},{default:_e(()=>[!t.loading&&t.filteredLogs.length>0?(c(),re(A,{key:0,logs:t.filteredLogs,loading:!1,error:null,pagination:t.pagination,"selected-logs":t.selectedLogs,onSelectLog:t.handleLogSelect,onPageChange:t.handlePageChange,"onUpdate:selectedLogs":t.handleSelectedLogsUpdate},null,8,["logs","pagination","selected-logs","onSelectLog","onPageChange","onUpdate:selectedLogs"])):M("",!0)]),_:1}),J(Ie,{name:"fade"},{default:_e(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length===0?(c(),re(I,{key:0,icon:"üì≠",title:"–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",description:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Bitrix24.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è","–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",onAction:t.handleFiltersReset},null,8,["onAction"])):M("",!0)]),_:1}),J(Ie,{name:"fade"},{default:_e(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length>0?(c(),re(I,{key:0,icon:"üîç",title:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",description:"–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã","–û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",onAction:t.handleClearSearch},null,8,["onAction"])):M("",!0)]),_:1}),J(Ie,{name:"fade"},{default:_e(()=>[t.error?(c(),re(k,{key:0,title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤",message:t.error,retryable:!0,onRetry:n.loadLogs},null,8,["message","onRetry"])):M("",!0)]),_:1}),t.selectedLog?(c(),d("div",{key:0,class:"modal-overlay",onClick:e[2]||(e[2]=(...y)=>t.handleLogClose&&t.handleLogClose(...y))})):M("",!0),J(Ie,{name:"modal"},{default:_e(()=>[t.selectedLog?(c(),re(T,{key:0,log:t.selectedLog,onClose:t.handleLogClose},null,8,["log","onClose"])):M("",!0)]),_:1})])):(c(),d("div",Qn,[s("div",Zn,[e[7]||(e[7]=s("h2",null,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",-1)),e[8]||(e[8]=s("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤.",-1)),s("p",er,[e[5]||(e[5]=G(" –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ –æ—Ç–¥–µ–ª–æ–≤: ",-1)),s("strong",null,g(t.allowedDepartmentsText),1)]),e[9]||(e[9]=s("p",{class:"access-hint"}," –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã. ",-1)),t.accessDebugInfo?(c(),d("details",tr,[e[6]||(e[6]=s("summary",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",-1)),s("pre",null,g(t.accessDebugInfo),1)])):M("",!0)])])),J(f)])}const nr=H(Jn,[["render",or],["__scopeId","data-v-628bf174"]]);class $e{static analyzeUsagePatterns(e){return!Array.isArray(e)||e.length===0?this.getEmptyPatterns():{peakHours:this.calculatePeakHours(e),sessionDuration:this.calculateAverageSession(e),userRetention:this.calculateRetention(e),popularPaths:this.findPopularPaths(e),deviceBreakdown:this.analyzeDevices(e),browserStats:this.analyzeBrowsers(e)}}static groupActivity(e,a){if(!Array.isArray(e))return[];const t=new Map;e.forEach(i=>{let o;switch(a){case"hour":o=i.timestamp?new Date(i.timestamp).getHours():"unknown";break;case"day":o=i.timestamp?new Date(i.timestamp).toISOString().split("T")[0]:"unknown";break;case"week":const l=i.timestamp?new Date(i.timestamp):new Date;o=new Date(l.setDate(l.getDate()-l.getDay())).toISOString().split("T")[0];break;case"month":o=i.timestamp?new Date(i.timestamp).toISOString().substring(0,7):"unknown";break;case"user":o=i.user_id||"unknown";break;case"page":o=i.route_path||i.route_title||i.route_name||"unknown";break;case"session":o=this.calculateSessionId(i);break;default:o="all"}t.has(o)||t.set(o,{key:o,entries:[],count:0,metadata:this.getGroupMetadata(o,a)}),t.get(o).entries.push(i),t.get(o).count++});const r=Array.from(t.values());return this.sortGroups(r,a)}static calculateDashboardMetrics(e,a=[]){const t=this.calculateMetrics(e),r=a.length>0?this.calculateMetrics(a):{},i={};return Object.keys(t).forEach(o=>{const l=t[o],u=r[o]||0;i[o]={value:l,previousValue:u,change:l-u,changePercent:u>0?(l-u)/u*100:0,trend:l>u?"up":l<u?"down":"neutral"}}),i}static analyzeUserSessions(e){if(!Array.isArray(e)||e.length===0)return[];const a=[...e].sort((o,l)=>new Date(o.timestamp)-new Date(l.timestamp)),t=[];let r=null;const i=30*60*1e3;return a.forEach(o=>{const l=new Date(o.timestamp).getTime();(!r||l-r.endTime>i)&&(r={id:`session_${t.length+1}`,startTime:l,endTime:l,entries:[],duration:0,pages:new Set,device:o.user_agent,actions:new Map},t.push(r)),r.entries.push(o),r.endTime=l,r.pages.add(o.route_path);const u=o.type||"unknown";r.actions.set(u,(r.actions.get(u)||0)+1)}),t.forEach(o=>{o.duration=o.endTime-o.startTime,o.pageCount=o.pages.size,o.entriesCount=o.entries.length,o.actions=Object.fromEntries(o.actions)}),t}static calculateUserStats(e){if(!Array.isArray(e)||e.length===0)return this.getEmptyUserStats();const a=this.analyzeUserSessions(e),t=a.reduce((o,l)=>o+l.duration,0),r=this.groupActivity(e,"day"),i=this.findFavoritePages(e);return{total_actions:e.length,total_sessions:a.length,avg_session_duration:a.length>0?t/a.length:0,total_duration:t,favorite_page:i[0]?.page||null,peak_hour:this.calculateUserPeakHour(e),device_preference:this.calculateDevicePreference(e),activity_by_day:r.map(o=>({date:o.key,count:o.count,sessions:this.analyzeUserSessions(o.entries).length})),retention_days:this.calculateUserRetention(e)}}static calculatePeakHours(e){const a=new Array(24).fill(0);return e.forEach(t=>{if(t.timestamp){const r=new Date(t.timestamp).getHours();a[r]++}}),a.map((t,r)=>({hour:r,count:t}))}static calculateAverageSession(e){const a=this.analyzeUserSessions(e);return a.length===0?0:a.reduce((r,i)=>r+i.duration,0)/a.length}static calculateRetention(e){if(e.length===0)return{"1d":0,"7d":0,"30d":0};const a=new Map,t=new Map;e.forEach(u=>{const h=u.user_id,v=new Date(u.timestamp).getTime();(!a.has(h)||v<a.get(h))&&a.set(h,v),(!t.has(h)||v>t.get(h))&&t.set(h,v)});let r=0,i=0,o=0;const l=a.size;return t.forEach((u,h)=>{const v=a.get(h),m=(u-v)/(1e3*60*60*24);m>=1&&r++,m>=7&&i++,m>=30&&o++}),{"1d":l>0?r/l*100:0,"7d":l>0?i/l*100:0,"30d":l>0?o/l*100:0}}static findPopularPaths(e){const a=new Map;return e.filter(t=>t.type==="page_visit").forEach(t=>{const r=t.route_path||t.route_name||"unknown";a.set(r,(a.get(r)||0)+1)}),Array.from(a.entries()).sort((t,r)=>r[1]-t[1]).slice(0,10).map(([t,r])=>({path:t,count:r}))}static analyzeDevices(e){const a={desktop:0,mobile:0,tablet:0,unknown:0};return e.forEach(t=>{const r=this.detectDevice(t.user_agent);a[r]++}),a}static analyzeBrowsers(e){const a=new Map;return e.forEach(t=>{const r=this.detectBrowser(t.user_agent);a.set(r,(a.get(r)||0)+1)}),Object.fromEntries(a)}static detectDevice(e){if(!e)return"unknown";const a=e.toLowerCase();return a.includes("mobile")||a.includes("android")||a.includes("iphone")?"mobile":a.includes("tablet")||a.includes("ipad")?"tablet":"desktop"}static detectBrowser(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const a=e.toLowerCase();return a.includes("chrome")&&!a.includes("edg")?"Chrome":a.includes("firefox")?"Firefox":a.includes("safari")&&!a.includes("chrome")?"Safari":a.includes("edg")?"Edge":a.includes("opera")?"Opera":"–î—Ä—É–≥–æ–µ"}static calculateSessionId(e){const a=e.user_id||"unknown",t=e.timestamp?new Date(e.timestamp).toISOString().split("T")[0]:"unknown";return`${a}_${t}`}static getGroupMetadata(e,a){switch(a){case"hour":return{label:`${e}:00`,type:"hour"};case"day":return{label:this.formatDate(e),type:"day"};case"week":return{label:`–ù–µ–¥–µ–ª—è ${e}`,type:"week"};case"month":return{label:this.formatMonth(e),type:"month"};case"user":return{label:`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${e}`,type:"user"};case"page":return{label:e,type:"page"};case"session":return{label:`–°–µ—Å—Å–∏—è ${e}`,type:"session"};default:return{label:e,type:"unknown"}}}static sortGroups(e,a){return e.sort((t,r)=>["day","week","month"].includes(a)?new Date(r.key)-new Date(t.key):r.count-t.count)}static calculateMetrics(e){return Array.isArray(e)?{total_entries:e.length,unique_users:new Set(e.map(t=>t.user_id).filter(t=>t)).size,total_app_entries:e.filter(t=>t.type==="app_entry").length,total_page_visits:e.filter(t=>t.type==="page_visit").length,total_sessions:this.analyzeUserSessions(e).length}:this.getEmptyMetrics()}static findFavoritePages(e){const a=new Map;return e.filter(t=>t.type==="page_visit").forEach(t=>{const r=t.route_path||t.route_title||t.route_name||"unknown";a.set(r,(a.get(r)||0)+1)}),Array.from(a.entries()).sort((t,r)=>r[1]-t[1]).map(([t,r])=>({page:t,count:r}))}static calculateUserPeakHour(e){const a=new Array(24).fill(0);e.forEach(r=>{if(r.timestamp){const i=new Date(r.timestamp).getHours();a[i]++}});const t=Math.max(...a);return t>0?a.indexOf(t):0}static calculateDevicePreference(e){const a={desktop:0,mobile:0,tablet:0};e.forEach(r=>{const i=this.detectDevice(r.user_agent);a.hasOwnProperty(i)&&a[i]++});const t=Object.keys(a).reduce((r,i)=>a[r]>a[i]?r:i);return a[t]>0?t:"unknown"}static calculateUserRetention(e){if(e.length===0)return 0;const a=e.map(o=>new Date(o.timestamp).getTime()).sort((o,l)=>o-l),t=a[0],i=(a[a.length-1]-t)/(1e3*60*60*24);return Math.max(0,Math.floor(i))}static formatDate(e){try{return new Date(e).toLocaleDateString("ru-RU")}catch{return e}}static formatMonth(e){try{const[a,t]=e.split("-");return new Date(a,t-1,1).toLocaleDateString("ru-RU",{year:"numeric",month:"long"})}catch{return e}}static getEmptyPatterns(){return{peakHours:new Array(24).fill(0).map((e,a)=>({hour:a,count:0})),sessionDuration:0,userRetention:{"1d":0,"7d":0,"30d":0},popularPaths:[],deviceBreakdown:{desktop:0,mobile:0,tablet:0,unknown:0},browserStats:{}}}static getEmptyMetrics(){return{total_entries:0,unique_users:0,total_app_entries:0,total_page_visits:0,total_sessions:0}}static getEmptyUserStats(){return{total_actions:0,total_sessions:0,avg_session_duration:0,total_duration:0,favorite_page:null,peak_hour:0,device_preference:"unknown",activity_by_day:[],retention_days:0}}}const Je=new Map,rr=5*60*1e3;class Fe{static createCacheKey(e){return JSON.stringify({userId:e.userId,dateFrom:e.dateFrom,dateTo:e.dateTo,type:e.type,limit:e.limit})}static clearCache(){Je.clear()}static async getActivity(e={}){const{userId:a=null,dateFrom:t=null,dateTo:r=null,type:i=null,limit:o=1e3,useCache:l=!0}=e,u=this.createCacheKey({userId:a,dateFrom:t,dateTo:r,type:i,limit:o});if(l&&Je.has(u)){const v=Je.get(u);if(Date.now()-v.timestamp<rr)return v.data;Je.delete(u)}const h=new URLSearchParams;a&&h.append("user_id",a),t&&h.append("date_from",t),r&&h.append("date_to",r),i&&h.append("type",i),o&&h.append("limit",o);try{const v=Ae("/api/user-activity-get.php"),m=await fetch(`${v}?${h.toString()}`);if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);const C=await m.json();if(C.success){const A=C.data||[];return l&&Je.set(u,{data:A,timestamp:Date.now()}),A}else throw new Error(C.error||"Failed to get activity")}catch(v){throw console.error("[UserActivityService] Error getting activity:",v),v}}static async getActivityStats(e={}){const a=await this.getActivity(e),t={total_entries:a.length,total_app_entries:0,total_page_visits:0,unique_users:new Set,pages_visited:{},activity_by_date:{},activity_by_hour:{}};return a.forEach(r=>{if(r.type==="app_entry")t.total_app_entries++,t.unique_users.add(r.user_id);else if(r.type==="page_visit"){t.total_page_visits++;const i=r.route_title||r.route_path||r.route_name||"unknown";t.pages_visited[i]=(t.pages_visited[i]||0)+1}if(r.timestamp){const i=new Date(r.timestamp).toISOString().split("T")[0];t.activity_by_date[i]=(t.activity_by_date[i]||0)+1;const o=new Date(r.timestamp).getHours();t.activity_by_hour[o]=(t.activity_by_hour[o]||0)+1}}),t.unique_users_count=t.unique_users.size,t.unique_users=Array.from(t.unique_users),t}static async getUserActivity(e,a={}){return await this.getActivity({...a,userId:e})}static async getDashboardMetrics(e={}){try{const a=await this.getActivity({...e,limit:1e4}),t=this.getPreviousPeriodFilters(e),r=await this.getActivity({...t,limit:1e4});return $e.calculateDashboardMetrics(a,r)}catch(a){throw console.error("[UserActivityService] Error getting dashboard metrics:",a),a}}static async getUserProfileAnalytics(e,a={}){try{const t=await this.getUserInfo(e),r=await this.getUserActivity(e,a),i=$e.calculateUserStats(r),o=$e.analyzeUserSessions(r);return{user:t,activity:r,analytics:i,sessions:o}}catch(t){throw console.error("[UserActivityService] Error getting user profile analytics:",t),t}}static async getUserInfo(e){return{id:e,name:`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${e}`,email:`user${e}@example.com`,departments:["–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª"],first_visit:null,last_visit:null}}static getPreviousPeriodFilters(e){const a={...e};if(a.dateFrom&&a.dateTo){const t=new Date(a.dateFrom),i=new Date(a.dateTo)-t,o=new Date(t.getTime()-i),l=new Date(t.getTime()-1);a.dateFrom=o.toISOString().split("T")[0],a.dateTo=l.toISOString().split("T")[0]}else{const t=new Date,r=new Date(t.getTime()-7*24*60*60*1e3),i=new Date(t.getTime()-14*24*60*60*1e3);a.dateFrom=i.toISOString().split("T")[0],a.dateTo=r.toISOString().split("T")[0]}return a}static exportData(e,a="json"){switch(a){case"csv":return this.exportToCSV(e);case"json":default:return JSON.stringify(e,null,2)}}static exportToCSV(e){if(!e||e.length===0)return"";const a=["timestamp","user_id","user_name","type","route_path","route_title","user_agent"];return[a.join(","),...e.map(r=>a.map(i=>{const o=r[i]||"";return`"${String(o).replace(/"/g,'""')}"`}).join(","))].join(`
`)}}const at="hidden_users_list";function je(){try{const n=localStorage.getItem(at);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e.map(a=>Number(a)):[]}catch(n){return console.error("[HiddenUsersManager] Error reading hidden users:",n),[]}}function ir(n){const e=je(),a=Number(n);if(!e.includes(a)){e.push(a);try{localStorage.setItem(at,JSON.stringify(e))}catch(t){console.error("[HiddenUsersManager] Error saving hidden users:",t)}}}function lr(n){const e=je(),a=Number(n),t=e.filter(r=>r!==a);if(t.length!==e.length)try{localStorage.setItem(at,JSON.stringify(t))}catch(r){console.error("[HiddenUsersManager] Error saving hidden users:",r)}}function cr(){try{localStorage.removeItem(at)}catch(n){console.error("[HiddenUsersManager] Error clearing hidden users:",n)}}function dr(n){const e=new Map;return n.forEach(a=>{if(a.user_id){const t=Number(a.user_id);e.has(t)||e.set(t,{id:t,name:a.user_name||`User #${t}`,count:0}),e.get(t).count++}}),Array.from(e.values()).sort((a,t)=>t.count-a.count)}function Nt(n){const e=je();return e.length===0?n:n.filter(a=>a.user_id?!e.includes(Number(a.user_id)):!0)}const ur={name:"UserActivityCard",props:{entry:{type:Object,required:!0}},computed:{cardClass(){return{"activity-entry":this.entry.type==="app_entry","activity-visit":this.entry.type==="page_visit"}}},methods:{formatTime(n){return n?new Date(n).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}}},gr={class:"activity-icon"},mr={key:0},hr={key:1},vr={class:"activity-content"},fr={class:"activity-header"},pr={class:"user-name"},yr={class:"activity-time"},_r={class:"activity-details"},br={key:0,class:"activity-type"},wr={key:1,class:"activity-type"},kr={key:0,class:"activity-from"};function Cr(n,e,a,t,r,i){return c(),d("div",{class:N(["user-activity-card",i.cardClass])},[s("div",gr,[a.entry.type==="app_entry"?(c(),d("span",mr,"üö™")):a.entry.type==="page_visit"?(c(),d("span",hr,"üìÑ")):M("",!0)]),s("div",vr,[s("div",fr,[s("span",pr,g(a.entry.user_name||`User #${a.entry.user_id}`),1),s("span",yr,g(i.formatTime(a.entry.timestamp)),1)]),s("div",_r,[a.entry.type==="app_entry"?(c(),d("span",br," –û—Ç–∫—Ä—ã–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ")):a.entry.type==="page_visit"?(c(),d("span",wr," –û—Ç–∫—Ä—ã–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É: "+g(a.entry.route_title||a.entry.route_path||a.entry.route_name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"),1)):M("",!0)]),a.entry.type==="page_visit"&&a.entry.from_path?(c(),d("div",kr," –°: "+g(a.entry.from_name||a.entry.from_path),1)):M("",!0)])],2)}const Sr=H(ur,[["render",Cr],["__scopeId","data-v-fe61b287"]]),Dr={name:"HiddenUsersManager",props:{filters:{type:Object,default:()=>({})}},emits:["hidden-users-changed"],setup(n,{emit:e}){const a=p(!1),t=p(null),r=p([]),i=p([]),o=D(()=>dr(r.value)),l=D(()=>{const m=je();return o.value.filter(C=>m.includes(C.id))}),u=async()=>{a.value=!0,t.value=null;try{const m={...n.filters,limit:1e3};r.value=await Fe.getActivity(m);const C=je();i.value=C.filter(A=>o.value.some(I=>I.id===A))}catch(m){t.value=m.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",console.error("[HiddenUsersManager] Error loading activity:",m)}finally{a.value=!1}},h=()=>{const m=je(),C=i.value.map(A=>Number(A));C.forEach(A=>{m.includes(A)||ir(A)}),m.forEach(A=>{C.includes(A)||lr(A)}),e("hidden-users-changed"),window.dispatchEvent(new CustomEvent("hidden-users-changed"))},v=()=>{cr(),i.value=[],e("hidden-users-changed"),window.dispatchEvent(new CustomEvent("hidden-users-changed"))};return de(()=>{u()}),ee(()=>n.filters,()=>{u()},{deep:!0}),ee(()=>l.value,m=>{i.value=m.map(C=>C.id)},{deep:!0}),{loading:a,error:t,availableUsers:o,hiddenUsers:l,selectedUsers:i,applySelection:h,showAll:v}}},Tr={class:"hidden-users-manager"},Ar={class:"manager-controls"},Er={class:"dropdown-wrapper"},Mr=["disabled"],xr=["value"],Ir={key:0,class:"empty-hint"},Lr={class:"actions"},Pr=["disabled"],Fr=["disabled"],Ur={key:0,class:"loading"},Rr={key:1,class:"error"};function Or(n,e,a,t,r,i){return c(),d("div",Tr,[s("div",Ar,[s("div",Er,[e[3]||(e[3]=s("label",{class:"dropdown-label"}," üëÅÔ∏è –°–∫—Ä—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ",-1)),z(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.selectedUsers=o),multiple:"",class:"users-dropdown",disabled:t.loading||t.availableUsers.length===0,size:"5"},[(c(!0),d($,null,j(t.availableUsers,o=>(c(),d("option",{key:o.id,value:o.id},g(o.name)+" ("+g(o.count)+" "+g(o.count===1?"–∑–∞–ø–∏—Å—å":"–∑–∞–ø–∏—Å–µ–π")+") ",9,xr))),128))],8,Mr),[[ne,t.selectedUsers]]),t.availableUsers.length===0&&!t.loading?(c(),d("div",Ir," –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∑–∞–ø–∏—Å—è—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ")):M("",!0)]),s("div",Lr,[s("button",{onClick:e[1]||(e[1]=(...o)=>t.applySelection&&t.applySelection(...o)),class:"apply-btn",disabled:t.loading,title:"–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å ",8,Pr),t.hiddenUsers.length>0?(c(),d("button",{key:0,onClick:e[2]||(e[2]=(...o)=>t.showAll&&t.showAll(...o)),class:"show-all-btn",disabled:t.loading,title:"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"}," –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö ("+g(t.hiddenUsers.length)+") ",9,Fr)):M("",!0)])]),t.loading?(c(),d("div",Ur," –ó–∞–≥—Ä—É–∑–∫–∞... ")):M("",!0),t.error?(c(),d("div",Rr,g(t.error),1)):M("",!0)])}const Bt=H(Dr,[["render",Or],["__scopeId","data-v-4fdc2eaa"]]),Nr={name:"UserActivityFilters",props:{filters:{type:Object,default:()=>({})},users:{type:Array,default:()=>[]}},emits:["update-filters"],setup(n,{emit:e}){const a=p({userId:n.filters.userId||null,type:n.filters.type||null,dateFrom:n.filters.dateFrom||null,dateTo:n.filters.dateTo||null}),t=()=>{e("update-filters",{...a.value})},r=()=>{a.value={userId:null,type:null,dateFrom:null,dateTo:null},t()},i=o=>{const l=o.NAME||"",u=o.LAST_NAME||"";return`${l} ${u}`.trim()||o.EMAIL||`User #${o.ID}`};return ee(()=>n.filters,o=>{a.value={...o}},{deep:!0}),{localFilters:a,updateFilters:t,resetFilters:r,getUserName:i}}},Br={class:"user-activity-filters"},Vr={class:"filter-group"},$r=["value"],jr={class:"filter-group"},zr={class:"filter-group"},Wr={class:"filter-group"};function qr(n,e,a,t,r,i){return c(),d("div",Br,[s("div",Vr,[e[10]||(e[10]=s("label",null,"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:",-1)),z(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.localFilters.userId=o),onChange:e[1]||(e[1]=(...o)=>t.updateFilters&&t.updateFilters(...o))},[e[9]||(e[9]=s("option",{value:null},"–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",-1)),(c(!0),d($,null,j(a.users,o=>(c(),d("option",{key:o.ID,value:o.ID},g(t.getUserName(o)),9,$r))),128))],544),[[ne,t.localFilters.userId]])]),s("div",jr,[e[12]||(e[12]=s("label",null,"–¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:",-1)),z(s("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.localFilters.type=o),onChange:e[3]||(e[3]=(...o)=>t.updateFilters&&t.updateFilters(...o))},[...e[11]||(e[11]=[s("option",{value:null},"–í—Å–µ —Ç–∏–ø—ã",-1),s("option",{value:"app_entry"},"–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1),s("option",{value:"page_visit"},"–ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",-1)])],544),[[ne,t.localFilters.type]])]),s("div",zr,[e[13]||(e[13]=s("label",null,"–î–∞—Ç–∞ –æ—Ç:",-1)),z(s("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=o=>t.localFilters.dateFrom=o),onChange:e[5]||(e[5]=(...o)=>t.updateFilters&&t.updateFilters(...o))},null,544),[[be,t.localFilters.dateFrom]])]),s("div",Wr,[e[14]||(e[14]=s("label",null,"–î–∞—Ç–∞ –¥–æ:",-1)),z(s("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=o=>t.localFilters.dateTo=o),onChange:e[7]||(e[7]=(...o)=>t.updateFilters&&t.updateFilters(...o))},null,544),[[be,t.localFilters.dateTo]])]),s("button",{onClick:e[8]||(e[8]=(...o)=>t.resetFilters&&t.resetFilters(...o)),class:"btn-reset"},"–°–±—Ä–æ—Å–∏—Ç—å")])}const Vt=H(Nr,[["render",qr],["__scopeId","data-v-f4c5efa9"]]),Hr={name:"UserActivityStats",props:{filters:{type:Object,default:()=>({})}},setup(n){const e=p({total_entries:0,unique_users_count:0,total_app_entries:0,total_page_visits:0,pages_visited:{}}),a=p(!1),t=p(null),r=D(()=>e.value),i=async()=>{a.value=!0,t.value=null;try{const u=await Fe.getActivity({...n.filters,limit:1e4}),h=Nt(u);e.value=await Fe.getActivityStats({...n.filters});const v={total_entries:h.length,unique_users_count:new Set(h.map(m=>m.user_id)).size,total_app_entries:h.filter(m=>m.type==="app_entry").length,total_page_visits:h.filter(m=>m.type==="page_visit").length,pages_visited:{}};h.filter(m=>m.type==="page_visit"&&m.route_path).forEach(m=>{const C=m.route_title||m.route_path||m.route_name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞";v.pages_visited[C]=(v.pages_visited[C]||0)+1}),e.value=v}catch(u){t.value=u.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏",console.error("[UserActivityStats] Error loading stats:",u)}finally{a.value=!1}},o=D(()=>{const u=r.value.pages_visited||{};return Object.entries(u).sort((h,v)=>v[1]-h[1]).slice(0,10).reduce((h,[v,m])=>(h[v]=m,h),{})}),l=()=>{i()};return de(()=>{i(),window.addEventListener("hidden-users-changed",l)}),qe(()=>{window.removeEventListener("hidden-users-changed",l)}),ee(()=>n.filters,()=>{i()},{deep:!0}),{stats:r,loading:a,error:t,sortedPages:o}}},Xr={class:"user-activity-stats"},Jr={key:0,class:"loading"},Yr={key:1,class:"error"},Kr={key:2},Gr={class:"stats-grid"},Qr={class:"stat-card"},Zr={class:"stat-value"},ei={class:"stat-card"},ti={class:"stat-value"},si={class:"stat-card"},ai={class:"stat-value"},oi={class:"stat-card"},ni={class:"stat-value"},ri={key:0,class:"pages-stats"};function ii(n,e,a,t,r,i){return c(),d("div",Xr,[t.loading?(c(),d("div",Jr," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏... ")):t.error?(c(),d("div",Yr,g(t.error),1)):(c(),d("div",Kr,[s("div",Gr,[s("div",Qr,[s("div",Zr,g(t.stats.total_entries),1),e[0]||(e[0]=s("div",{class:"stat-label"},"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",-1))]),s("div",ei,[s("div",ti,g(t.stats.unique_users_count),1),e[1]||(e[1]=s("div",{class:"stat-label"},"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1))]),s("div",si,[s("div",ai,g(t.stats.total_app_entries),1),e[2]||(e[2]=s("div",{class:"stat-label"},"–û—Ç–∫—Ä—ã—Ç–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1))]),s("div",oi,[s("div",ni,g(t.stats.total_page_visits),1),e[3]||(e[3]=s("div",{class:"stat-label"},"–ü–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",-1))])]),Object.keys(t.stats.pages_visited).length>0?(c(),d("div",ri,[e[5]||(e[5]=s("h3",null,"–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:",-1)),s("ul",null,[(c(!0),d($,null,j(t.sortedPages,(o,l)=>(c(),d("li",{key:l},[G(g(l)+": ",1),s("strong",null,g(o),1),e[4]||(e[4]=G(" –ø–æ—Å–µ—â–µ–Ω–∏–π ",-1))]))),128))])])):M("",!0)]))])}const $t=H(Hr,[["render",ii],["__scopeId","data-v-d896786e"]]),li={name:"MetricCard",props:{metric:{type:Object,required:!0,validator:n=>n.id&&n.title&&typeof n.value<"u"},interactive:{type:Boolean,default:!0},showTrend:{type:Boolean,default:!0},showComparison:{type:Boolean,default:!1},drillDown:{type:Boolean,default:!1}},emits:["click","drill-down"],computed:{title(){return this.metric.title||""},value(){return this.metric.value||0},previousValue(){return this.metric.previousValue},change(){return this.metric.change||0},changePercent(){return this.metric.changePercent||0},trend(){return this.metric.trend||"neutral"},icon(){return this.metric.icon||"üìä"},color(){return this.metric.color||"#2196F3"},drillDownRoute(){return this.metric.drillDownRoute},subtitle(){return this.metric.subtitle},formattedValue(){return this.formatValue(this.value)},formattedPreviousValue(){return this.formatValue(this.previousValue)},formattedChange(){const n=Math.abs(this.change),e=Math.abs(this.changePercent);return e!==0?`${this.change>=0?"+":"-"}${e.toFixed(1)}%`:n!==0?this.formatValue(n,!0):""},formattedChangePercent(){return`${this.changePercent>=0?"+":""}${this.changePercent.toFixed(1)}%`},trendClass(){return{"trend-up":this.trend==="up","trend-down":this.trend==="down","trend-neutral":this.trend==="neutral",interactive:this.interactive,"has-drill-down":this.drillDown}},trendIcon(){switch(this.trend){case"up":return"üìà";case"down":return"üìâ";default:return"‚û°Ô∏è"}}},methods:{formatValue(n,e=!1){return n==null?"0":typeof n=="string"&&(n.includes("–º")||n.includes("—Å")||n.includes("—á"))?n:typeof n=="number"?n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":Number.isInteger(n)?n.toLocaleString("ru-RU"):n.toFixed(1):String(n)},handleClick(){this.interactive&&this.$emit("click",this.metric)},handleDrillDown(){this.$emit("drill-down",this.metric)}}},ci={class:"metric-header"},di={class:"metric-icon"},ui={key:0,class:"metric-trend"},gi={class:"trend-icon"},mi={class:"trend-value"},hi={class:"metric-content"},vi={class:"metric-title"},fi={key:0,class:"metric-subtitle"},pi={key:1,class:"metric-comparison"},yi={class:"comparison-value"},_i={key:0,class:"metric-actions"},bi={key:1,class:"metric-hover-overlay"},wi={class:"hover-content"},ki={key:0,class:"hover-subtitle"};function Ci(n,e,a,t,r,i){return c(),d("div",{class:N(["metric-card",i.trendClass]),onClick:e[1]||(e[1]=(...o)=>i.handleClick&&i.handleClick(...o))},[s("div",ci,[s("div",di,[s("span",null,g(i.icon),1)]),a.showTrend&&(i.change!==0||i.changePercent!==0)?(c(),d("div",ui,[s("span",gi,g(i.trendIcon),1),s("span",mi,g(i.formattedChange),1)])):M("",!0)]),s("div",hi,[s("div",{class:"metric-value",style:Ee({color:i.color})},g(i.formattedValue),5),s("div",vi,g(i.title),1),i.subtitle?(c(),d("div",fi,g(i.subtitle),1)):M("",!0),a.showComparison&&i.previousValue!==void 0?(c(),d("div",pi,[e[2]||(e[2]=s("span",{class:"comparison-label"},"vs –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–µ—Ä–∏–æ–¥:",-1)),s("span",yi,g(i.formattedPreviousValue),1)])):M("",!0)]),a.drillDown?(c(),d("div",_i,[s("button",{class:"drill-down-btn",onClick:e[0]||(e[0]=fe((...o)=>i.handleDrillDown&&i.handleDrillDown(...o),["stop"]))}," –ü–æ–¥—Ä–æ–±–Ω–µ–µ ")])):M("",!0),a.interactive?(c(),d("div",bi,[s("div",wi,[e[3]||(e[3]=s("div",{class:"hover-title"},"–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π",-1)),i.changePercent!==0?(c(),d("div",ki," –ò–∑–º–µ–Ω–µ–Ω–∏–µ: "+g(i.formattedChangePercent),1)):M("",!0)])])):M("",!0)],2)}const Si=H(li,[["render",Ci],["__scopeId","data-v-0e808c5a"]]),Di={name:"AdvancedFilters",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(n,{emit:e}){const a=p(!1),t=p(!1),r=p(""),i=p("all"),o=p("all"),l=p({timeRange:{type:"preset",preset:"week",custom:{from:null,to:null}},activityTypes:[],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"day",sortBy:"timestamp",sortOrder:"desc"}),u=[{key:"today",name:"–°–µ–≥–æ–¥–Ω—è",description:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ —Å–µ–≥–æ–¥–Ω—è",icon:"üìÖ",filters:{timeRange:{type:"preset",preset:"today"},activityTypes:[],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"hour",sortBy:"timestamp",sortOrder:"desc"}},{key:"active_users",name:"–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",description:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –≤—ã—Å–æ–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é",icon:"üöÄ",filters:{timeRange:{type:"preset",preset:"week"},activityTypes:["app_entry","page_visit"],departments:[],userActivity:"active",devices:[],browsers:[],groupBy:"user",sortBy:"timestamp",sortOrder:"desc"}},{key:"problem_sessions",name:"–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–µ—Å—Å–∏–∏",description:"–ö–æ—Ä–æ—Ç–∫–∏–µ —Å–µ—Å—Å–∏–∏ –∏ —á–∞—Å—Ç—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã",icon:"‚ö†Ô∏è",filters:{timeRange:{type:"preset",preset:"3days"},activityTypes:["app_entry"],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"session",sortBy:"timestamp",sortOrder:"desc"}},{key:"new_traffic",name:"–ù–æ–≤—ã–π —Ç—Ä–∞—Ñ–∏–∫",description:"–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ",icon:"üÜï",filters:{timeRange:{type:"preset",preset:"month"},activityTypes:[],departments:[],userActivity:"new",devices:[],browsers:[],groupBy:"day",sortBy:"timestamp",sortOrder:"desc"}}],h=[{value:"app_entry",label:"–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",icon:"üö™"},{value:"page_visit",label:"–ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",icon:"üìÑ"}],v=[{value:"desktop",label:"–ö–æ–º–ø—å—é—Ç–µ—Ä",icon:"üñ•Ô∏è"},{value:"mobile",label:"–¢–µ–ª–µ—Ñ–æ–Ω",icon:"üì±"},{value:"tablet",label:"–ü–ª–∞–Ω—à–µ—Ç",icon:"üì±"}],m=[{value:"chrome",label:"Chrome",icon:"üåê"},{value:"firefox",label:"Firefox",icon:"ü¶ä"},{value:"safari",label:"Safari",icon:"üß≠"},{value:"edge",label:"Edge",icon:"‚ö°"},{value:"opera",label:"Opera",icon:"üé≠"}],C=[{id:369,name:"–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª"},{id:366,name:"–°–µ–∫—Ç–æ—Ä 1–°"}],A=p([]);ee(()=>n.modelValue,L=>{L&&Object.keys(L).length>0&&(l.value={...L})},{deep:!0,immediate:!0});const I=()=>{try{const L=localStorage.getItem("activity_filter_presets");L&&(A.value=JSON.parse(L))}catch(L){console.error("[AdvancedFilters] Error loading saved filters:",L)}},k=()=>{try{localStorage.setItem("activity_filter_presets",JSON.stringify(A.value))}catch(L){console.error("[AdvancedFilters] Error saving filters:",L)}},T=()=>{l.value.timeRange.type==="preset"&&(l.value.timeRange.preset="week",f())},f=()=>{const L=l.value.timeRange.preset,V=new Date;let U,S;switch(L){case"today":U=new Date(V.getFullYear(),V.getMonth(),V.getDate()),S=new Date(V.getFullYear(),V.getMonth(),V.getDate(),23,59,59);break;case"yesterday":const X=new Date(V);X.setDate(X.getDate()-1),U=new Date(X.getFullYear(),X.getMonth(),X.getDate()),S=new Date(X.getFullYear(),X.getMonth(),X.getDate(),23,59,59);break;case"3days":U=new Date(V),U.setDate(U.getDate()-3),S=V;break;case"week":U=new Date(V),U.setDate(U.getDate()-7),S=V;break;case"month":U=new Date(V),U.setMonth(U.getMonth()-1),S=V;break;case"quarter":U=new Date(V),U.setMonth(U.getMonth()-3),S=V;break;case"year":U=new Date(V),U.setFullYear(U.getFullYear()-1),S=V;break}l.value.timeRange.custom.from=U.toISOString().split("T")[0],l.value.timeRange.custom.to=S.toISOString().split("T")[0]},y=L=>{l.value={...L.filters},a.value=!1,E()},E=()=>{const L={dateFrom:null,dateTo:null,userId:null,type:l.value.activityTypes.length>0?l.value.activityTypes:null,departments:l.value.departments,userActivity:l.value.userActivity,devices:l.value.devices,browsers:l.value.browsers,groupBy:l.value.groupBy,sortBy:l.value.sortBy,sortOrder:l.value.sortOrder};l.value.timeRange.type,l.value.timeRange.custom.from&&(L.dateFrom=l.value.timeRange.custom.from),l.value.timeRange.custom.to&&(L.dateTo=l.value.timeRange.custom.to),e("update:modelValue",L),e("change",L)},O=()=>{l.value={timeRange:{type:"preset",preset:"week",custom:{from:null,to:null}},activityTypes:[],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"day",sortBy:"timestamp",sortOrder:"desc"},i.value="all",o.value="all",E()},F=()=>{if(!r.value.trim())return;const L={id:Date.now().toString(),name:r.value.trim(),filters:{...l.value},createdAt:new Date().toISOString()};A.value.push(L),k(),r.value="",t.value=!1},w=L=>{l.value={...L.filters},E()},_=L=>{A.value=A.value.filter(V=>V.id!==L),k()},b=L=>{try{return new Date(L).toLocaleDateString("ru-RU")}catch{return L}};return I(),{showPresets:a,showSaveDialog:t,saveFilterName:r,localFilters:l,selectedDepartmentMode:i,selectedBrowserMode:o,filterPresets:u,activityTypeOptions:h,deviceOptions:v,browserOptions:m,availableDepartments:C,savedFilters:A,handleTimeRangeTypeChange:T,applyTimePreset:f,applyPreset:y,applyFilters:E,resetFilters:O,saveCurrentFilter:F,loadSavedFilter:w,deleteSavedFilter:_,formatDate:b}}},Ti={class:"advanced-filters"},Ai={class:"filters-header"},Ei={class:"filters-actions"},Mi={key:0,class:"presets-panel"},xi={class:"presets-grid"},Ii=["onClick"],Li={class:"preset-icon"},Pi={class:"preset-content"},Fi={class:"preset-name"},Ui={class:"preset-description"},Ri={class:"filters-content"},Oi={class:"filter-group time-range"},Ni={class:"time-range-controls"},Bi={key:0,class:"preset-options"},Vi={key:1,class:"custom-range"},$i={class:"filter-group activity-types"},ji={class:"checkbox-group"},zi=["value"],Wi={class:"checkbox-label"},qi={class:"type-icon"},Hi={class:"filter-group departments"},Xi={class:"departments-controls"},Ji={key:0,class:"departments-list"},Yi={class:"department-checkbox"},Ki=["value"],Gi={class:"checkbox-label"},Qi={class:"filter-group usage-frequency"},Zi={class:"filter-group devices"},el={class:"checkbox-group"},tl=["value"],sl={class:"checkbox-label"},al={class:"device-icon"},ol={class:"filter-group browsers"},nl={class:"browsers-controls"},rl={key:0,class:"browsers-list"},il={class:"browser-checkbox"},ll=["value"],cl={class:"checkbox-label"},dl={class:"browser-icon"},ul={class:"filter-group grouping"},gl={class:"grouping-controls"},ml={class:"group-by-control"},hl={class:"sort-control"},vl={class:"saved-filters"},fl={class:"saved-filters-header"},pl={key:0,class:"saved-filters-list"},yl={class:"filter-info"},_l={class:"filter-name"},bl={class:"filter-date"},wl={class:"filter-actions"},kl=["onClick"],Cl=["onClick"],Sl={key:1,class:"no-saved-filters"},Dl={class:"dialog-content"},Tl={class:"dialog-actions"},Al=["disabled"];function El(n,e,a,t,r,i){return c(),d("div",Ti,[s("div",Ai,[e[26]||(e[26]=s("h4",{class:"filters-title"},"üîç –§–∏–ª—å—Ç—Ä—ã –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞",-1)),s("div",Ei,[s("button",{onClick:e[0]||(e[0]=o=>t.showPresets=!t.showPresets),class:"presets-btn"}," üìã –®–∞–±–ª–æ–Ω—ã "),s("button",{onClick:e[1]||(e[1]=(...o)=>t.resetFilters&&t.resetFilters(...o)),class:"reset-btn"}," üîÑ –°–±—Ä–æ—Å "),s("button",{onClick:e[2]||(e[2]=(...o)=>t.applyFilters&&t.applyFilters(...o)),class:"apply-btn"}," ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å ")])]),t.showPresets?(c(),d("div",Mi,[s("div",xi,[(c(!0),d($,null,j(t.filterPresets,o=>(c(),d("button",{key:o.key,onClick:l=>t.applyPreset(o),class:"preset-btn"},[s("div",Li,g(o.icon),1),s("div",Pi,[s("div",Fi,g(o.name),1),s("div",Ui,g(o.description),1)])],8,Ii))),128))])])):M("",!0),s("div",Ri,[s("div",Oi,[e[30]||(e[30]=s("label",{class:"filter-label"},"üìÖ –í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω",-1)),s("div",Ni,[z(s("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.localFilters.timeRange.type=o),onChange:e[4]||(e[4]=(...o)=>t.handleTimeRangeTypeChange&&t.handleTimeRangeTypeChange(...o)),class:"range-type-select"},[...e[27]||(e[27]=[s("option",{value:"preset"},"–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞",-1),s("option",{value:"custom"},"–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π",-1)])],544),[[ne,t.localFilters.timeRange.type]]),t.localFilters.timeRange.type==="preset"?(c(),d("div",Bi,[z(s("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>t.localFilters.timeRange.preset=o),onChange:e[6]||(e[6]=(...o)=>t.applyTimePreset&&t.applyTimePreset(...o)),class:"time-preset-select"},[...e[28]||(e[28]=[tt('<option value="today" data-v-22b9cf1c>–°–µ–≥–æ–¥–Ω—è</option><option value="yesterday" data-v-22b9cf1c>–í—á–µ—Ä–∞</option><option value="3days" data-v-22b9cf1c>3 –¥–Ω—è</option><option value="week" data-v-22b9cf1c>–ù–µ–¥–µ–ª—è</option><option value="month" data-v-22b9cf1c>–ú–µ—Å—è—Ü</option><option value="quarter" data-v-22b9cf1c>–ö–≤–∞—Ä—Ç–∞–ª</option><option value="year" data-v-22b9cf1c>–ì–æ–¥</option>',7)])],544),[[ne,t.localFilters.timeRange.preset]])])):(c(),d("div",Vi,[z(s("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=o=>t.localFilters.timeRange.custom.from=o),class:"date-input",placeholder:"–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞"},null,512),[[be,t.localFilters.timeRange.custom.from]]),e[29]||(e[29]=s("span",{class:"date-separator"},"‚Äî",-1)),z(s("input",{type:"date","onUpdate:modelValue":e[8]||(e[8]=o=>t.localFilters.timeRange.custom.to=o),class:"date-input",placeholder:"–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è"},null,512),[[be,t.localFilters.timeRange.custom.to]])]))])]),s("div",$i,[e[31]||(e[31]=s("label",{class:"filter-label"},"üéØ –¢–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),s("div",ji,[(c(!0),d($,null,j(t.activityTypeOptions,o=>(c(),d("label",{key:o.value,class:"checkbox-item"},[z(s("input",{type:"checkbox",value:o.value,"onUpdate:modelValue":e[9]||(e[9]=l=>t.localFilters.activityTypes=l),class:"checkbox-input"},null,8,zi),[[Ne,t.localFilters.activityTypes]]),s("span",Wi,[s("span",qi,g(o.icon),1),G(" "+g(o.label),1)])]))),128))])]),s("div",Hi,[e[33]||(e[33]=s("label",{class:"filter-label"},"üè¢ –û—Ç–¥–µ–ª—ã",-1)),s("div",Xi,[z(s("select",{"onUpdate:modelValue":e[10]||(e[10]=o=>t.selectedDepartmentMode=o),class:"mode-select"},[...e[32]||(e[32]=[s("option",{value:"all"},"–í—Å–µ –æ—Ç–¥–µ–ª—ã",-1),s("option",{value:"specific"},"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –æ—Ç–¥–µ–ª—ã",-1)])],512),[[ne,t.selectedDepartmentMode]]),t.selectedDepartmentMode==="specific"?(c(),d("div",Ji,[(c(!0),d($,null,j(t.availableDepartments,o=>(c(),d("div",{class:"department-item",key:o.id},[s("label",Yi,[z(s("input",{type:"checkbox",value:o.id,"onUpdate:modelValue":e[11]||(e[11]=l=>t.localFilters.departments=l),class:"checkbox-input"},null,8,Ki),[[Ne,t.localFilters.departments]]),s("span",Gi,g(o.name),1)])]))),128))])):M("",!0)])]),s("div",Qi,[e[35]||(e[35]=s("label",{class:"filter-label"},"üìä –ß–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",-1)),z(s("select",{"onUpdate:modelValue":e[12]||(e[12]=o=>t.localFilters.userActivity=o),class:"frequency-select"},[...e[34]||(e[34]=[s("option",{value:"all"},"–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",-1),s("option",{value:"new"},"–ù–æ–≤—ã–µ (–ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –∑–∞ –ø–µ—Ä–∏–æ–¥)",-1),s("option",{value:"active"},"–ê–∫—Ç–∏–≤–Ω—ã–µ (‚â•5 –¥–µ–π—Å—Ç–≤–∏–π)",-1),s("option",{value:"inactive"},"–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ (<5 –¥–µ–π—Å—Ç–≤–∏–π)",-1)])],512),[[ne,t.localFilters.userActivity]])]),s("div",Zi,[e[36]||(e[36]=s("label",{class:"filter-label"},"üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞",-1)),s("div",el,[(c(!0),d($,null,j(t.deviceOptions,o=>(c(),d("label",{key:o.value,class:"checkbox-item"},[z(s("input",{type:"checkbox",value:o.value,"onUpdate:modelValue":e[13]||(e[13]=l=>t.localFilters.devices=l),class:"checkbox-input"},null,8,tl),[[Ne,t.localFilters.devices]]),s("span",sl,[s("span",al,g(o.icon),1),G(" "+g(o.label),1)])]))),128))])]),s("div",ol,[e[38]||(e[38]=s("label",{class:"filter-label"},"üåê –ë—Ä–∞—É–∑–µ—Ä—ã",-1)),s("div",nl,[z(s("select",{"onUpdate:modelValue":e[14]||(e[14]=o=>t.selectedBrowserMode=o),class:"mode-select"},[...e[37]||(e[37]=[s("option",{value:"all"},"–í—Å–µ –±—Ä–∞—É–∑–µ—Ä—ã",-1),s("option",{value:"specific"},"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã",-1)])],512),[[ne,t.selectedBrowserMode]]),t.selectedBrowserMode==="specific"?(c(),d("div",rl,[(c(!0),d($,null,j(t.browserOptions,o=>(c(),d("div",{class:"browser-item",key:o.value},[s("label",il,[z(s("input",{type:"checkbox",value:o.value,"onUpdate:modelValue":e[15]||(e[15]=l=>t.localFilters.browsers=l),class:"checkbox-input"},null,8,ll),[[Ne,t.localFilters.browsers]]),s("span",cl,[s("span",dl,g(o.icon),1),G(" "+g(o.label),1)])])]))),128))])):M("",!0)])]),s("div",ul,[e[44]||(e[44]=s("label",{class:"filter-label"},"üìã –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞",-1)),s("div",gl,[s("div",ml,[e[40]||(e[40]=s("label",{class:"sub-label"},"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ:",-1)),z(s("select",{"onUpdate:modelValue":e[16]||(e[16]=o=>t.localFilters.groupBy=o),class:"group-by-select"},[...e[39]||(e[39]=[tt('<option value="day" data-v-22b9cf1c>–î–Ω—è–º</option><option value="week" data-v-22b9cf1c>–ù–µ–¥–µ–ª—è–º</option><option value="month" data-v-22b9cf1c>–ú–µ—Å—è—Ü–∞–º</option><option value="user" data-v-22b9cf1c>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</option><option value="page" data-v-22b9cf1c>–°—Ç—Ä–∞–Ω–∏—Ü–∞–º</option><option value="session" data-v-22b9cf1c>–°–µ—Å—Å–∏—è–º</option>',6)])],512),[[ne,t.localFilters.groupBy]])]),s("div",hl,[e[43]||(e[43]=s("label",{class:"sub-label"},"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:",-1)),z(s("select",{"onUpdate:modelValue":e[17]||(e[17]=o=>t.localFilters.sortBy=o),class:"sort-by-select"},[...e[41]||(e[41]=[s("option",{value:"timestamp"},"–ü–æ –≤—Ä–µ–º–µ–Ω–∏",-1),s("option",{value:"user"},"–ü–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é",-1),s("option",{value:"type"},"–ü–æ —Ç–∏–ø—É",-1),s("option",{value:"page"},"–ü–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ",-1)])],512),[[ne,t.localFilters.sortBy]]),z(s("select",{"onUpdate:modelValue":e[18]||(e[18]=o=>t.localFilters.sortOrder=o),class:"sort-order-select"},[...e[42]||(e[42]=[s("option",{value:"desc"},"–£–±—ã–≤–∞–Ω–∏–µ",-1),s("option",{value:"asc"},"–í–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ",-1)])],512),[[ne,t.localFilters.sortOrder]])])])])]),s("div",vl,[s("div",fl,[e[45]||(e[45]=s("h5",{class:"saved-title"},"üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã",-1)),s("button",{onClick:e[19]||(e[19]=o=>t.showSaveDialog=!0),class:"save-current-btn"}," –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π ")]),t.savedFilters.length>0?(c(),d("div",pl,[(c(!0),d($,null,j(t.savedFilters,o=>(c(),d("div",{key:o.id,class:"saved-filter-item"},[s("div",yl,[s("div",_l,g(o.name),1),s("div",bl,"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: "+g(t.formatDate(o.createdAt)),1)]),s("div",wl,[s("button",{onClick:l=>t.loadSavedFilter(o),class:"load-btn"},"–ó–∞–≥—Ä—É–∑–∏—Ç—å",8,kl),s("button",{onClick:l=>t.deleteSavedFilter(o.id),class:"delete-btn"},"–£–¥–∞–ª–∏—Ç—å",8,Cl)])]))),128))])):(c(),d("div",Sl," –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ "))]),t.showSaveDialog?(c(),d("div",{key:1,class:"save-dialog-overlay",onClick:e[25]||(e[25]=o=>t.showSaveDialog=!1)},[s("div",{class:"save-dialog",onClick:e[24]||(e[24]=fe(()=>{},["stop"]))},[e[47]||(e[47]=s("h4",null,"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä",-1)),s("div",Dl,[e[46]||(e[46]=s("label",{class:"dialog-label"},"–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞:",-1)),z(s("input",{"onUpdate:modelValue":e[20]||(e[20]=o=>t.saveFilterName=o),type:"text",class:"save-name-input",placeholder:"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ...",onKeyup:e[21]||(e[21]=De((...o)=>t.saveCurrentFilter&&t.saveCurrentFilter(...o),["enter"]))},null,544),[[be,t.saveFilterName]])]),s("div",Tl,[s("button",{onClick:e[22]||(e[22]=o=>t.showSaveDialog=!1),class:"cancel-btn"},"–û—Ç–º–µ–Ω–∞"),s("button",{onClick:e[23]||(e[23]=(...o)=>t.saveCurrentFilter&&t.saveCurrentFilter(...o)),disabled:!t.saveFilterName.trim(),class:"save-btn"},"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",8,Al)])])])):M("",!0)])}const Ml=H(Di,[["render",El],["__scopeId","data-v-22b9cf1c"]]);class pe{static prepareTimeChartData(e,a="day",t={}){if(!Array.isArray(e))return this.getEmptyTimeChartData();const{ActivityAnalyticsService:r}=t,i=r?r.groupActivity(e,a):this.fallbackGroupByTime(e,a);return{labels:i.map(o=>this.formatGroupLabel(o.key,a)),datasets:[{label:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",data:i.map(o=>o.count),borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"#2196F3",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]}}static prepareDistributionChartData(e,a,t="doughnut"){if(!Array.isArray(e))return this.getEmptyDistributionData();const r=this.calculateDistribution(e,a),i=this.generateColors(Object.keys(r).length),o={labels:Object.keys(r),datasets:[{data:Object.values(r),backgroundColor:i,borderColor:i.map(l=>this.adjustColorBrightness(l,-20)),borderWidth:t==="doughnut"?2:1,hoverBorderWidth:t==="doughnut"?3:2}]};return t==="bar"&&(o.datasets[0].borderRadius=4,o.datasets[0].borderSkipped=!1),o}static prepareUserRankingData(e,a=10){if(!Array.isArray(e))return[];const t=new Map;return e.forEach(r=>{const i=r.user_id;if(!i)return;t.has(i)||t.set(i,{id:i,name:r.user_name||`User #${i}`,count:0,app_entries:0,page_visits:0,last_activity:r.timestamp});const o=t.get(i);o.count++,r.type==="app_entry"?o.app_entries++:r.type==="page_visit"&&o.page_visits++,r.timestamp&&(!o.last_activity||r.timestamp>o.last_activity)&&(o.last_activity=r.timestamp)}),Array.from(t.values()).sort((r,i)=>i.count-r.count).slice(0,a).map((r,i)=>({...r,rank:i+1,lastActivityFormatted:this.formatTimestamp(r.last_activity)}))}static prepareSessionTimelineData(e){return Array.isArray(e)?e.map(a=>({id:a.id,startTime:a.startTime,endTime:a.endTime,duration:a.duration,pageCount:a.pageCount,entriesCount:a.entriesCount,actions:a.actions,device:a.device,formattedStartTime:this.formatTimestamp(new Date(a.startTime)),formattedDuration:this.formatDuration(a.duration),color:this.getSessionColor(a)})):[]}static formatActivityData(e){return Array.isArray(e)?e.map(a=>({...a,formattedTimestamp:this.formatTimestamp(a.timestamp),formattedDuration:a.duration?this.formatDuration(a.duration):null,userDisplayName:a.user_name||`User #${a.user_id}`,pageDisplayName:this.formatPageName(a),deviceInfo:this.parseUserAgent(a.user_agent),actionIcon:this.getActionIcon(a.type),actionColor:this.getActionColor(a.type)})):[]}static prepareComparisonChartData(e,a,t="day"){const r=this.prepareTimeChartData(e,t),i=this.prepareTimeChartData(a,t),o=new Set([...r.labels,...i.labels]),l=Array.from(o).sort(),u=new Map(r.labels.map((v,m)=>[v,r.datasets[0].data[m]])),h=new Map(i.labels.map((v,m)=>[v,i.datasets[0].data[m]]));return{labels:l,datasets:[{label:"–¢–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥",data:l.map(v=>u.get(v)||0),borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",fill:!0,tension:.4},{label:"–ü—Ä–µ–¥—ã–¥—É—â–∏–π –ø–µ—Ä–∏–æ–¥",data:l.map(v=>h.get(v)||0),borderColor:"#FF9800",backgroundColor:"rgba(255, 152, 0, 0.1)",fill:!0,tension:.4}]}}static calculateDistribution(e,a){const t={};return e.forEach(r=>{let i;switch(a){case"activity_types":i=r.type||"unknown";break;case"devices":i=this.detectDevice(r.user_agent);break;case"browsers":i=this.detectBrowser(r.user_agent);break;case"departments":i=r.user_department||"–ù–µ —É–∫–∞–∑–∞–Ω";break;case"pages":i=r.route_path||r.route_title||r.route_name||"unknown";break;default:i="–î—Ä—É–≥–æ–µ"}t[i]=(t[i]||0)+1}),t}static fallbackGroupByTime(e,a){const t=new Map;return e.forEach(r=>{if(!r.timestamp)return;let i;const o=new Date(r.timestamp);switch(a){case"hour":i=o.getHours();break;case"day":i=o.toISOString().split("T")[0];break;case"week":i=new Date(o.setDate(o.getDate()-o.getDay())).toISOString().split("T")[0];break;case"month":i=o.toISOString().substring(0,7);break;default:i="all"}t.has(i)||t.set(i,{key:i,entries:[],count:0}),t.get(i).entries.push(r),t.get(i).count++}),Array.from(t.values()).sort((r,i)=>["day","week","month"].includes(a)?new Date(i.key)-new Date(r.key):i.count-r.count)}static formatGroupLabel(e,a){switch(a){case"hour":return`${e}:00`;case"day":return this.formatDate(e);case"week":return`–ù–µ–¥–µ–ª—è ${e}`;case"month":return this.formatMonth(e);default:return e}}static detectDevice(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const a=e.toLowerCase();return a.includes("mobile")||a.includes("android")||a.includes("iphone")?"Mobile":a.includes("tablet")||a.includes("ipad")?"Tablet":"Desktop"}static detectBrowser(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const a=e.toLowerCase();return a.includes("chrome")&&!a.includes("edg")?"Chrome":a.includes("firefox")?"Firefox":a.includes("safari")&&!a.includes("chrome")?"Safari":a.includes("edg")?"Edge":a.includes("opera")?"Opera":"–î—Ä—É–≥–æ–µ"}static parseUserAgent(e){return e?{device:this.detectDevice(e),browser:this.detectBrowser(e),os:this.detectOS(e)}:{device:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",browser:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",os:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}}static detectOS(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const a=e.toLowerCase();return a.includes("windows")?"Windows":a.includes("macintosh")||a.includes("mac os x")?"macOS":a.includes("linux")?"Linux":a.includes("android")?"Android":a.includes("ios")||a.includes("iphone")||a.includes("ipad")?"iOS":"–î—Ä—É–≥–æ–µ"}static generateColors(e){const a=["#2196F3","#4CAF50","#FF9800","#F44336","#9C27B0","#00BCD4","#8BC34A","#FFC107","#795548","#607D8B"];if(e<=a.length)return a.slice(0,e);const t=[];for(let r=a.length;r<e;r++)t.push(this.generateRandomColor());return[...a,...t]}static generateRandomColor(){return`hsl(${Math.floor(Math.random()*360)}, 70%, 50%)`}static adjustColorBrightness(e,a){if(e.startsWith("#")){const t=e[0]==="#",r=t?e.slice(1):e,i=parseInt(r,16);let o=(i>>16)+a,l=(i>>8&255)+a,u=(i&255)+a;return o=o>255?255:o<0?0:o,l=l>255?255:l<0?0:l,u=u>255?255:u<0?0:u,(t?"#":"")+(o<<16|l<<8|u).toString(16)}return e}static formatDate(e){try{return new Date(e).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return e}}static formatMonth(e){try{const[a,t]=e.split("-");return new Date(a,t-1,1).toLocaleDateString("ru-RU",{year:"numeric",month:"long"})}catch{return e}}static formatTimestamp(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{return new Date(e).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return e}}static formatDuration(e){if(!e||e<0)return"0—Å";const a=Math.floor(e/1e3),t=Math.floor(a/60),r=Math.floor(t/60);return r>0?`${r}—á ${t%60}–º`:t>0?`${t}–º ${a%60}—Å`:`${a}—Å`}static formatPageName(e){return e&&(e.route_title||e.route_path||e.route_name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}static getActionIcon(e){switch(e){case"app_entry":return"üö™";case"page_visit":return"üìÑ";default:return"‚ùì"}}static getActionColor(e){switch(e){case"app_entry":return"#4CAF50";case"page_visit":return"#2196F3";default:return"#9E9E9E"}}static getSessionColor(e){const a=e.duration||0;return a<5*60*1e3?"#4CAF50":a<15*60*1e3?"#FF9800":"#F44336"}static getEmptyTimeChartData(){return{labels:[],datasets:[{label:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",data:[],borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",fill:!0,tension:.4}]}}static getEmptyDistributionData(){return{labels:[],datasets:[{data:[],backgroundColor:[],borderColor:[],borderWidth:2}]}}}Ue.register(ct,dt,St,Dt,ut,gt,mt,Tt);const xl={name:"TimeChart",props:{data:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},title:{type:String,default:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏"},height:{type:Number,default:300},interactive:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},groupBy:{type:String,default:"day",validator:n=>["hour","day","week","month"].includes(n)}},emits:["time-range-change","data-point-click"],setup(n,{emit:e}){const a=p(null),t=p(null),r=p(!1),i=p(null),o=p(n.groupBy),l=D(()=>{if(!n.data||n.data.length===0)return pe.getEmptyTimeChartData();try{return pe.prepareTimeChartData(n.data,o.value,{ActivityAnalyticsService:null})}catch(T){return console.error("[TimeChart] Error preparing chart data:",T),i.value="–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞",pe.getEmptyTimeChartData()}}),u=D(()=>!l.value.datasets||l.value.datasets.length===0?0:Math.max(...l.value.datasets[0].data)),h=D(()=>{if(!l.value.datasets||l.value.datasets.length===0)return 0;const T=l.value.datasets[0].data;return T.length>0?T.reduce((f,y)=>f+y,0)/T.length:0}),v=()=>{if(!a.value||!l.value)return;k();const T=a.value.getContext("2d");t.value=new Ue(T,{type:"line",data:l.value,options:{responsive:!0,maintainAspectRatio:!1,height:n.height,interaction:{intersect:!1,mode:"index"},plugins:{legend:{display:!0,position:"top"},tooltip:{enabled:n.interactive,callbacks:{label:f=>{const y=f.dataset.label||"",E=f.parsed.y;return`${y}: ${E}`},title:f=>f.length===0?"":f[0].label}}},scales:{x:{display:!0,title:{display:!0,text:A()}},y:{display:!0,beginAtZero:!0,title:{display:!0,text:"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π"},ticks:{precision:0}}},onClick:n.interactive?m:null,onHover:n.interactive?C:null}})},m=(T,f)=>{if(f.length>0){const y=f[0].index,E=l.value.labels[y],O=l.value.datasets[0].data[y];e("data-point-click",{label:E,value:O,groupBy:o.value,index:y})}},C=(T,f)=>{T.native.target.style.cursor=f.length>0?"pointer":"default"},A=()=>{switch(o.value){case"hour":return"–ß–∞—Å—ã";case"day":return"–î–Ω–∏";case"week":return"–ù–µ–¥–µ–ª–∏";case"month":return"–ú–µ—Å—è—Ü—ã";default:return"–í—Ä–µ–º—è"}},I=async()=>{if(t.value){r.value=!0,i.value=null;try{await At(),t.value.data=l.value,t.value.options.scales.x.title.text=A(),t.value.update("none")}catch(T){console.error("[TimeChart] Error updating chart:",T),i.value="–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞"}finally{r.value=!1}}},k=()=>{t.value&&(t.value.destroy(),t.value=null)};return ee(()=>n.data,()=>{I()},{deep:!0}),ee(()=>n.groupBy,T=>{o.value=T}),de(()=>{v()}),qe(()=>{k()}),{chartCanvas:a,chartData:l,loading:r,error:i,selectedGroupBy:o,maxValue:u,averageValue:h,updateChart:I}}},Il={class:"time-chart-container"},Ll={class:"chart-header"},Pl={class:"chart-title"},Fl={class:"chart-controls"},Ul={key:0,class:"chart-loading"},Rl={key:1,class:"chart-error"},Ol={key:2,class:"chart-canvas-container"},Nl={ref:"chartCanvas"},Bl={key:0,class:"chart-stats"},Vl={class:"stat-item"},$l={class:"stat-value"},jl={class:"stat-item"},zl={class:"stat-value"},Wl={class:"stat-item"},ql={class:"stat-value"};function Hl(n,e,a,t,r,i){return c(),d("div",Il,[s("div",Ll,[s("h3",Pl,g(a.title),1),s("div",Fl,[z(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.selectedGroupBy=o),onChange:e[1]||(e[1]=(...o)=>t.updateChart&&t.updateChart(...o)),class:"group-by-select"},[...e[2]||(e[2]=[s("option",{value:"hour"},"–ü–æ —á–∞—Å–∞–º",-1),s("option",{value:"day"},"–ü–æ –¥–Ω—è–º",-1),s("option",{value:"week"},"–ü–æ –Ω–µ–¥–µ–ª—è–º",-1),s("option",{value:"month"},"–ü–æ –º–µ—Å—è—Ü–∞–º",-1)])],544),[[ne,t.selectedGroupBy]])])]),s("div",{class:N(["chart-wrapper",{loading:t.loading}])},[t.loading?(c(),d("div",Ul," –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞... ")):t.error?(c(),d("div",Rl,g(t.error),1)):(c(),d("div",Ol,[s("canvas",Nl,null,512)]))],2),a.showStats&&t.chartData.labels.length>0?(c(),d("div",Bl,[s("div",Vl,[e[3]||(e[3]=s("span",{class:"stat-label"},"–í—Å–µ–≥–æ —Ç–æ—á–µ–∫:",-1)),s("span",$l,g(t.chartData.labels.length),1)]),s("div",jl,[e[4]||(e[4]=s("span",{class:"stat-label"},"–ú–∞–∫—Å–∏–º—É–º:",-1)),s("span",zl,g(t.maxValue),1)]),s("div",Wl,[e[5]||(e[5]=s("span",{class:"stat-label"},"–°—Ä–µ–¥–Ω–µ–µ:",-1)),s("span",ql,g(t.averageValue.toFixed(1)),1)])])):M("",!0)])}const jt=H(xl,[["render",Hl],["__scopeId","data-v-61df5f94"]]);Ue.register(ct,dt,Et,Mt,ut,gt,mt);const Xl={name:"DistributionChart",props:{data:{type:Array,default:()=>[]},type:{type:String,default:"activity_types",validator:n=>["activity_types","devices","browsers","departments","pages"].includes(n)},chartType:{type:String,default:"doughnut",validator:n=>["doughnut","bar","pie"].includes(n)},title:{type:String,default:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ"},height:{type:Number,default:300},showLegend:{type:Boolean,default:!0},maxItems:{type:Number,default:10}},emits:["segment-click","type-change"],setup(n,{emit:e}){const a=p(null),t=p(null),r=p(!1),i=p(null),o=p(n.type),l=p(n.chartType),u=D(()=>{if(!n.data||n.data.length===0)return pe.getEmptyDistributionData();try{return pe.prepareDistributionChartData(n.data,o.value,l.value)}catch(f){return console.error("[DistributionChart] Error preparing chart data:",f),i.value="–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º—ã",pe.getEmptyDistributionData()}}),h=D(()=>u.value.datasets&&u.value.datasets.length>0&&u.value.datasets[0].data&&u.value.datasets[0].data.length>0&&u.value.datasets[0].data.some(f=>f>0)),v=D(()=>{if(!h.value||!u.value.labels)return[];const f=u.value.labels,y=u.value.datasets[0].data,E=u.value.datasets[0].backgroundColor,O=y.reduce((F,w)=>F+w,0);return f.map((F,w)=>({label:F.length>20?F.substring(0,20)+"...":F,fullLabel:F,value:y[w],percentage:O>0?y[w]/O*100:0,color:E[w]})).sort((F,w)=>w.value-F.value)}),m=()=>{if(!a.value||!h.value)return;T();const f=a.value.getContext("2d"),y=C(l.value);t.value=new y({ctx:f,data:u.value,options:A()})},C=f=>{switch(f){case"bar":return Gt;case"pie":return Kt;case"doughnut":default:return Yt}},A=()=>{const f={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:y=>{const E=y.label||"",O=y.parsed,F=y.dataset.data.reduce((_,b)=>_+b,0),w=F>0?(O/F*100).toFixed(1):0;return`${E}: ${O} (${w}%)`}}}},onClick:I};return l.value==="bar"&&(f.scales={y:{beginAtZero:!0,ticks:{precision:0}}}),(l.value==="doughnut"||l.value==="pie")&&(f.plugins.tooltip.callbacks.title=y=>y[0]?.label||""),f},I=(f,y)=>{if(y.length>0){const E=y[0].index,O=u.value.labels[E],F=u.value.datasets[0].data[E];e("segment-click",{type:o.value,label:O,value:F,index:E})}},k=async()=>{r.value=!0,i.value=null;try{await At(),T(),m()}catch(f){console.error("[DistributionChart] Error updating chart:",f),i.value="–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã"}finally{r.value=!1}},T=()=>{t.value&&(t.value.destroy(),t.value=null)};return ee(()=>n.data,()=>{k()},{deep:!0}),ee(()=>n.type,f=>{o.value=f}),ee(()=>n.chartType,f=>{l.value=f}),de(()=>{m()}),qe(()=>{T()}),{chartCanvas:a,chartData:u,loading:r,error:i,selectedType:o,selectedChartType:l,hasData:h,legendItems:v,updateChart:k}}},Jl={class:"distribution-chart-container"},Yl={class:"chart-header"},Kl={class:"chart-title"},Gl={class:"chart-controls"},Ql={key:0,class:"chart-loading"},Zl={key:1,class:"chart-error"},ec={key:2,class:"chart-empty"},tc={key:3,class:"chart-canvas-container"},sc={ref:"chartCanvas"},ac={key:0,class:"chart-legend"},oc={class:"legend-label"},nc={class:"legend-value"};function rc(n,e,a,t,r,i){return c(),d("div",Jl,[s("div",Yl,[s("h3",Kl,g(a.title),1),s("div",Gl,[z(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.selectedType=o),onChange:e[1]||(e[1]=(...o)=>t.updateChart&&t.updateChart(...o)),class:"chart-type-select"},[...e[4]||(e[4]=[tt('<option value="activity_types" data-v-3784fb82>–¢–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</option><option value="devices" data-v-3784fb82>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</option><option value="browsers" data-v-3784fb82>–ë—Ä–∞—É–∑–µ—Ä—ã</option><option value="departments" data-v-3784fb82>–û—Ç–¥–µ–ª—ã</option><option value="pages" data-v-3784fb82>–°—Ç—Ä–∞–Ω–∏—Ü—ã</option>',5)])],544),[[ne,t.selectedType]]),z(s("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.selectedChartType=o),onChange:e[3]||(e[3]=(...o)=>t.updateChart&&t.updateChart(...o)),class:"chart-style-select"},[...e[5]||(e[5]=[s("option",{value:"doughnut"},"–ö—Ä—É–≥–æ–≤–∞—è",-1),s("option",{value:"bar"},"–°—Ç–æ–ª–±—á–∞—Ç–∞—è",-1),s("option",{value:"pie"},"–°–µ–∫—Ç–æ—Ä–Ω–∞—è",-1)])],544),[[ne,t.selectedChartType]])])]),s("div",{class:N(["chart-wrapper",{loading:t.loading}])},[t.loading?(c(),d("div",Ql," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã... ")):t.error?(c(),d("div",Zl,g(t.error),1)):t.hasData?(c(),d("div",tc,[s("canvas",sc,null,512)])):(c(),d("div",ec," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "))],2),a.showLegend&&t.legendItems.length>0?(c(),d("div",ac,[(c(!0),d($,null,j(t.legendItems,o=>(c(),d("div",{class:"legend-item",key:o.label},[s("div",{class:"legend-color",style:Ee({backgroundColor:o.color})},null,4),s("span",oc,g(o.label),1),s("span",nc,g(o.value)+" ("+g(o.percentage.toFixed(1))+"%)",1)]))),128))])):M("",!0)])}const ic=H(Xl,[["render",rc],["__scopeId","data-v-3784fb82"]]),lc={name:"UserRanking",props:{data:{type:Array,default:()=>[]},limit:{type:Number,default:10},title:{type:String,default:"–¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},showPagination:{type:Boolean,default:!1},itemsPerPage:{type:Number,default:10}},emits:["user-select"],setup(n,{emit:e}){const a=p("count"),t=p(!0),r=p(!1),i=p(null),o=p(1),l=D(()=>{if(!n.data||n.data.length===0)return[];try{let y=pe.prepareUserRankingData(n.data,n.limit*3);return y.sort((E,O)=>{switch(a.value){case"sessions":return(O.sessions||0)-(E.sessions||0);case"recent":return new Date(O.lastActivityFormatted)-new Date(E.lastActivityFormatted);case"count":default:return O.count-E.count}}),y.slice(0,n.limit)}catch(y){return console.error("[UserRanking] Error preparing ranking data:",y),i.value="–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–π—Ç–∏–Ω–≥–∞",[]}}),u=D(()=>Math.ceil(l.value.length/n.itemsPerPage)),h=D(()=>{if(!n.showPagination)return l.value;const y=(o.value-1)*n.itemsPerPage,E=y+n.itemsPerPage;return l.value.slice(y,E)}),v=y=>{y>=1&&y<=u.value&&(o.value=y)},m=()=>{t.value=!t.value},C=()=>{o.value=1},A=y=>{e("user-select",y)},I=y=>y===1?"rank-gold":y===2?"rank-silver":y===3?"rank-bronze":"rank-normal",k=y=>{const E=["#2196F3","#4CAF50","#FF9800","#F44336","#9C27B0","#00BCD4","#8BC34A","#FFC107","#795548","#607D8B"],O=Math.abs(y)%E.length;return E[O]},T=y=>{if(!y)return"?";const E=y.split(" ");return E.length>=2?(E[0][0]+E[1][0]).toUpperCase():y.substring(0,2).toUpperCase()},f=y=>{if(!y||y==="–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{const E=new Date(y),F=new Date-E,w=Math.floor(F/(1e3*60*60*24));return w===0?"–°–µ–≥–æ–¥–Ω—è":w===1?"–í—á–µ—Ä–∞":w<7?`${w} –¥–Ω–µ–π –Ω–∞–∑–∞–¥`:E.toLocaleDateString("ru-RU")}catch{return y}};return ee(()=>n.data,()=>{o.value=1},{deep:!0}),{sortBy:a,showAsList:t,loading:r,error:i,currentPage:o,users:l,displayedUsers:h,totalPages:u,goToPage:v,toggleView:m,updateRanking:C,viewUserProfile:A,getRankClass:I,getAvatarColor:k,getUserInitials:T,formatLastActivity:f}}},cc={class:"user-ranking-container"},dc={class:"ranking-header"},uc={class:"ranking-title"},gc={class:"ranking-controls"},mc={key:0,class:"ranking-loading"},hc={key:1,class:"ranking-error"},vc={key:2,class:"ranking-empty"},fc={key:3,class:"ranking-list"},pc={class:"user-info"},yc={class:"user-name"},_c={class:"user-stats"},bc={class:"stat-item"},wc={class:"stat-item"},kc={class:"user-actions"},Cc=["onClick"],Sc={key:4,class:"ranking-cards"},Dc={class:"card-header"},Tc={class:"card-content"},Ac={class:"user-name-large"},Ec={class:"user-stats-large"},Mc={class:"stat-large"},xc={class:"stat-value"},Ic={class:"stat-large"},Lc={class:"stat-value"},Pc={class:"last-activity"},Fc={class:"card-actions"},Uc=["onClick"],Rc={key:0,class:"ranking-pagination"},Oc=["disabled"],Nc={class:"page-info"},Bc=["disabled"];function Vc(n,e,a,t,r,i){return c(),d("div",cc,[s("div",dc,[s("h3",uc,g(a.title),1),s("div",gc,[z(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.sortBy=o),onChange:e[1]||(e[1]=(...o)=>t.updateRanking&&t.updateRanking(...o)),class:"sort-select"},[...e[5]||(e[5]=[s("option",{value:"count"},"–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–µ–π—Å—Ç–≤–∏–π",-1),s("option",{value:"sessions"},"–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–µ—Å—Å–∏–π",-1),s("option",{value:"recent"},"–ü–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)])],544),[[ne,t.sortBy]]),s("button",{onClick:e[2]||(e[2]=(...o)=>t.toggleView&&t.toggleView(...o)),class:"view-toggle-btn"},g(t.showAsList?"–ö–∞—Ä—Ç–æ—á–∫–∏":"–°–ø–∏—Å–æ–∫"),1)])]),s("div",{class:N(["ranking-content",{loading:t.loading}])},[t.loading?(c(),d("div",mc," –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞... ")):t.error?(c(),d("div",hc,g(t.error),1)):t.users.length===0?(c(),d("div",vc," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö ")):t.showAsList?(c(),d("div",fc,[(c(!0),d($,null,j(t.displayedUsers,o=>(c(),d("div",{class:"ranking-item",key:o.id},[s("div",{class:N(["rank-badge",t.getRankClass(o.rank)])},g(o.rank),3),s("div",{class:"user-avatar",style:Ee({backgroundColor:t.getAvatarColor(o.id)})},g(t.getUserInitials(o.name)),5),s("div",pc,[s("div",yc,g(o.name),1),s("div",_c,[s("span",bc,[e[6]||(e[6]=s("i",{class:"stat-icon"},"üìä",-1)),G(" "+g(o.count)+" –¥–µ–π—Å—Ç–≤–∏–π ",1)]),s("span",wc,[e[7]||(e[7]=s("i",{class:"stat-icon"},"‚è∞",-1)),G(" "+g(t.formatLastActivity(o.lastActivityFormatted)),1)])])]),s("div",kc,[s("button",{onClick:l=>t.viewUserProfile(o),class:"profile-btn",title:"–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"}," üë§ ",8,Cc)])]))),128))])):(c(),d("div",Sc,[(c(!0),d($,null,j(t.displayedUsers,o=>(c(),d("div",{class:"ranking-card",key:o.id},[s("div",Dc,[s("div",{class:N(["rank-badge-large",t.getRankClass(o.rank)])}," #"+g(o.rank),3),s("div",{class:"user-avatar-large",style:Ee({backgroundColor:t.getAvatarColor(o.id)})},g(t.getUserInitials(o.name)),5)]),s("div",Tc,[s("h4",Ac,g(o.name),1),s("div",Ec,[s("div",Mc,[s("div",xc,g(o.count),1),e[8]||(e[8]=s("div",{class:"stat-label"},"–¥–µ–π—Å—Ç–≤–∏–π",-1))]),s("div",Ic,[s("div",Lc,g(o.sessions||0),1),e[9]||(e[9]=s("div",{class:"stat-label"},"—Å–µ—Å—Å–∏–π",-1))])]),s("div",Pc," –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: "+g(t.formatLastActivity(o.lastActivityFormatted)),1)]),s("div",Fc,[s("button",{onClick:l=>t.viewUserProfile(o),class:"profile-btn-large"}," –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ",8,Uc)])]))),128))]))],2),a.showPagination&&t.totalPages>1?(c(),d("div",Rc,[s("button",{onClick:e[3]||(e[3]=o=>t.goToPage(t.currentPage-1)),disabled:t.currentPage===1,class:"page-btn"}," ‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,Oc),s("span",Nc," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+g(t.currentPage)+" –∏–∑ "+g(t.totalPages),1),s("button",{onClick:e[4]||(e[4]=o=>t.goToPage(t.currentPage+1)),disabled:t.currentPage===t.totalPages,class:"page-btn"}," –°–ª–µ–¥—É—é—â–∞—è ‚Ä∫ ",8,Bc)])):M("",!0)])}const $c=H(lc,[["render",Vc],["__scopeId","data-v-8824ae6b"]]),jc={name:"ActivityDataTable",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},filters:{type:Object,default:()=>({})},pageSize:{type:Number,default:25},maxPagesShown:{type:Number,default:7}},emits:["sort-change","row-click","export","filter-change"],setup(n,{emit:e}){const a=p(""),t=p(""),r=p("table"),i=p("timestamp"),o=p("desc"),l=p(1),u=[{key:"timestamp",label:"–í—Ä–µ–º—è",sortable:!0,width:"150px",component:"span"},{key:"user_name",label:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",sortable:!0,width:"200px",component:"span"},{key:"type",label:"–î–µ–π—Å—Ç–≤–∏–µ",sortable:!0,width:"120px",component:"span"},{key:"route_title",label:"–°—Ç—Ä–∞–Ω–∏—Ü–∞",sortable:!0,width:"250px",component:"span"},{key:"device",label:"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ",sortable:!1,width:"100px",component:"span"}],h=D(()=>u),v=Rt(P=>{a.value=P},300),m=D(()=>{let P=[...n.data];if(a.value.trim()){const Y=a.value.toLowerCase();P=P.filter(oe=>(oe.user_name||"").toLowerCase().includes(Y)||(oe.route_title||"").toLowerCase().includes(Y)||(oe.route_path||"").toLowerCase().includes(Y)||(oe.type||"").toLowerCase().includes(Y))}return P.sort((Y,oe)=>{let ie=Y[i.value],Q=oe[i.value];return i.value==="timestamp"&&(ie=new Date(ie).getTime(),Q=new Date(Q).getTime()),typeof ie=="string"&&(ie=ie.toLowerCase()),typeof Q=="string"&&(Q=Q.toLowerCase()),ie<Q?o.value==="asc"?-1:1:ie>Q?o.value==="asc"?1:-1:0}),P}),C=D(()=>m.value.length),A=D(()=>Math.ceil(C.value/n.pageSize)),I=D(()=>{const P=(l.value-1)*n.pageSize,Y=P+n.pageSize;return m.value.slice(P,Y)}),k=D(()=>I.value),T=D(()=>{const P=A.value,Y=l.value,oe=n.maxPagesShown;if(P<=oe)return Array.from({length:P},(B,Z)=>Z+1);const ie=Math.floor(oe/2);let Q=Math.max(1,Y-ie),le=Math.min(P,Q+oe-1);return le-Q+1<oe&&(Q=Math.max(1,le-oe+1)),Array.from({length:le-Q+1},(B,Z)=>Q+Z)}),f=D(()=>Object.values(n.filters).some(P=>P!=null&&P!=="")||a.value.trim()),y=D(()=>{const P=[];return n.filters.dateFrom&&P.push({key:"dateFrom",label:"–î–∞—Ç–∞ –æ—Ç",value:n.filters.dateFrom}),n.filters.dateTo&&P.push({key:"dateTo",label:"–î–∞—Ç–∞ –¥–æ",value:n.filters.dateTo}),n.filters.userId&&P.push({key:"userId",label:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",value:`ID ${n.filters.userId}`}),n.filters.type&&P.push({key:"type",label:"–¢–∏–ø",value:n.filters.type}),a.value.trim()&&P.push({key:"search",label:"–ü–æ–∏—Å–∫",value:a.value}),P}),E=P=>{i.value===P?o.value=o.value==="asc"?"desc":"asc":(i.value=P,o.value="asc"),e("sort-change",{sortBy:i.value,sortOrder:o.value})},O=P=>{e("row-click",P)},F=()=>{e("export",{data:m.value,filters:n.filters,searchQuery:a.value})},w=P=>{v(P.target.value)},_=P=>{P==="search"?(a.value="",t.value=""):e("filter-change",{...n.filters,[P]:null})},b=P=>{P>=1&&P<=A.value&&(l.value=P)},L=P=>`${P.timestamp}-${P.user_id}-${P.type}-${P.route_path||""}`,V=P=>({"row-app-entry":P.type==="app_entry","row-page-visit":P.type==="page_visit"}),U=(P,Y)=>{switch(P.key){case"timestamp":return ue(Y.timestamp);case"user_name":return Y.user_name||`User #${Y.user_id}`;case"type":return R(Y);case"route_title":return Y.route_title||Y.route_path||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞";case"device":return ae(Y.user_agent).device;default:return Y[P.key]||""}},S=(P,Y)=>({}),X=P=>pe.getActionIcon(P),R=P=>{switch(P.type){case"app_entry":return"–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è";case"page_visit":return"–ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º";default:return P.type||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ"}},ue=P=>pe.formatTimestamp(P),ae=P=>pe.parseUserAgent(P);return ee(()=>n.data,()=>{l.value=1}),ee(a,()=>{l.value=1}),{searchQuery:a,searchInput:t,viewMode:r,sortBy:i,sortOrder:o,currentPage:l,visibleColumns:h,filteredData:m,totalCount:C,totalPages:A,paginatedData:I,displayedData:k,visiblePages:T,filtersApplied:f,activeFilters:y,handleSort:E,handleRowClick:O,handleExport:F,handleSearchInput:w,removeFilter:_,goToPage:b,getEntryKey:L,getRowClass:V,getCellValue:U,getCellProps:S,getActionIcon:X,getActionDescription:R,formatTimestamp:ue,parseUserAgent:ae}}},zc={class:"activity-data-table"},Wc={class:"table-header"},qc={class:"table-info"},Hc={class:"table-subtitle"},Xc={key:0,class:"filters-indicator"},Jc={class:"table-actions"},Yc={class:"view-options"},Kc={class:"table-filters"},Gc={class:"search-container"},Qc={class:"filter-badges"},Zc=["onClick"],ed={key:0,class:"table-loading"},td={key:1,class:"table-empty"},sd={key:2,class:"data-table"},ad=["onClick"],od={class:"column-header"},nd={key:0,class:"sort-icon"},rd={key:0},id={key:1},ld={key:2},cd=["onClick"],dd={key:1,class:"cards-container"},ud=["onClick"],gd={class:"card-header"},md={class:"card-icon"},hd={class:"card-timestamp"},vd={class:"card-content"},fd={class:"card-user"},pd={class:"card-action"},yd={key:0,class:"card-page"},_d={key:1,class:"card-device"},bd={key:2,class:"table-pagination"},wd={class:"pagination-info"},kd={class:"pagination-controls"},Cd=["disabled"],Sd=["disabled"],Dd={class:"page-numbers"},Td=["onClick"],Ad=["disabled"],Ed=["disabled"];function Md(n,e,a,t,r,i){return c(),d("div",zc,[s("div",Wc,[s("div",qc,[e[9]||(e[9]=s("h3",{class:"table-title"},"–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1)),s("p",Hc,[G(" –ü–æ–∫–∞–∑–∞–Ω–æ "+g(t.displayedData.length)+" –∏–∑ "+g(t.totalCount)+" –∑–∞–ø–∏—Å–µ–π ",1),t.filtersApplied?(c(),d("span",Xc,"‚Ä¢ –§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")):M("",!0)])]),s("div",Jc,[s("div",Yc,[s("button",{onClick:e[0]||(e[0]=o=>t.viewMode="table"),class:N([{active:t.viewMode==="table"},"view-btn"])}," üìã –¢–∞–±–ª–∏—Ü–∞ ",2),s("button",{onClick:e[1]||(e[1]=o=>t.viewMode="cards"),class:N([{active:t.viewMode==="cards"},"view-btn"])}," üÉè –ö–∞—Ä—Ç–æ—á–∫–∏ ",2)]),s("button",{onClick:e[2]||(e[2]=(...o)=>t.handleExport&&t.handleExport(...o)),class:"export-btn"}," üì• –≠–∫—Å–ø–æ—Ä—Ç ")])]),s("div",Kc,[s("div",Gc,[z(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.searchInput=o),onInput:e[4]||(e[4]=(...o)=>t.handleSearchInput&&t.handleSearchInput(...o)),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏—é...",class:"search-input"},null,544),[[be,t.searchInput]]),e[10]||(e[10]=s("span",{class:"search-icon"},"üîç",-1))]),s("div",Qc,[(c(!0),d($,null,j(t.activeFilters,o=>(c(),d("span",{key:o.key,class:"filter-badge"},[G(g(o.label)+": "+g(o.value)+" ",1),s("button",{onClick:l=>t.removeFilter(o.key),class:"remove-filter"},"√ó",8,Zc)]))),128))])]),t.viewMode==="table"?(c(),d("div",{key:0,class:N(["table-container",{loading:a.loading}])},[a.loading?(c(),d("div",ed," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):t.displayedData.length===0?(c(),d("div",td," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ")):(c(),d("table",sd,[s("thead",null,[s("tr",null,[(c(!0),d($,null,j(t.visibleColumns,o=>(c(),d("th",{key:o.key,class:N({sortable:o.sortable}),onClick:l=>o.sortable&&t.handleSort(o.key)},[s("div",od,[s("span",null,g(o.label),1),o.sortable?(c(),d("span",nd,[t.sortBy===o.key&&t.sortOrder==="asc"?(c(),d("span",rd,"‚Üë")):t.sortBy===o.key&&t.sortOrder==="desc"?(c(),d("span",id,"‚Üì")):(c(),d("span",ld,"‚Üï"))])):M("",!0)])],10,ad))),128))])]),s("tbody",null,[(c(!0),d($,null,j(t.paginatedData,o=>(c(),d("tr",{key:t.getEntryKey(o),class:N(t.getRowClass(o)),onClick:l=>t.handleRowClick(o)},[(c(!0),d($,null,j(t.visibleColumns,l=>(c(),d("td",{key:l.key},[s("div",{class:N(["cell-content",`cell-${l.key}`])},[(c(),re(Zt(l.component||"span"),Qt({ref_for:!0},t.getCellProps(l,o)),{default:_e(()=>[G(g(t.getCellValue(l,o)),1)]),_:2},1040))],2)]))),128))],10,cd))),128))])]))],2)):t.viewMode==="cards"?(c(),d("div",dd,[(c(!0),d($,null,j(t.paginatedData,o=>(c(),d("div",{key:t.getEntryKey(o),class:N(["activity-card",t.getRowClass(o)]),onClick:l=>t.handleRowClick(o)},[s("div",gd,[s("div",md,g(t.getActionIcon(o.type)),1),s("div",hd,g(t.formatTimestamp(o.timestamp)),1)]),s("div",vd,[s("div",fd,[s("strong",null,g(o.user_name||`User #${o.user_id}`),1)]),s("div",pd,g(t.getActionDescription(o)),1),o.route_path?(c(),d("div",yd," –°—Ç—Ä–∞–Ω–∏—Ü–∞: "+g(o.route_title||o.route_path),1)):M("",!0),o.user_agent?(c(),d("div",_d," –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: "+g(t.parseUserAgent(o.user_agent).device),1)):M("",!0)])],10,ud))),128))])):M("",!0),t.totalPages>1?(c(),d("div",bd,[s("div",wd," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+g(t.currentPage)+" –∏–∑ "+g(t.totalPages)+" ("+g(t.totalCount)+" –∑–∞–ø–∏—Å–µ–π) ",1),s("div",kd,[s("button",{onClick:e[5]||(e[5]=o=>t.goToPage(1)),disabled:t.currentPage===1,class:"page-btn"}," ¬´¬´ –ü–µ—Ä–≤–∞—è ",8,Cd),s("button",{onClick:e[6]||(e[6]=o=>t.goToPage(t.currentPage-1)),disabled:t.currentPage===1,class:"page-btn"}," ‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,Sd),s("div",Dd,[(c(!0),d($,null,j(t.visiblePages,o=>(c(),d("button",{key:o,onClick:l=>t.goToPage(o),class:N([{active:o===t.currentPage},"page-number"])},g(o),11,Td))),128))]),s("button",{onClick:e[7]||(e[7]=o=>t.goToPage(t.currentPage+1)),disabled:t.currentPage===t.totalPages,class:"page-btn"}," –°–ª–µ–¥—É—é—â–∞—è ‚Ä∫ ",8,Ad),s("button",{onClick:e[8]||(e[8]=o=>t.goToPage(t.totalPages)),disabled:t.currentPage===t.totalPages,class:"page-btn"}," –ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª¬ª ",8,Ed)])])):M("",!0)])}const zt=H(jc,[["render",Md],["__scopeId","data-v-f8241d4e"]]),xd={name:"ActivityDashboard",components:{MetricCard:Si,AdvancedFilters:Ml,TimeChart:jt,DistributionChart:ic,UserRanking:$c,ActivityDataTable:zt},props:{initialFilters:{type:Object,default:()=>({dateFrom:null,dateTo:null,userId:null,type:null})},refreshInterval:{type:Number,default:3e5}},emits:["user-profile-request","filters-changed"],setup(n,{emit:e}){const a=p([]),t=p([]),r=p([]),i=p(!1),o=p(null),l=p({...n.initialFilters}),u=p("day"),h=p("activity_types"),v=p(!1),m=p(""),C=p(null);let A=null;const I=D(()=>{const R=l.value.dateFrom||"–Ω–∞—á–∞–ª–∞",ue=l.value.dateTo||"—Å–µ–π—á–∞—Å";return`${R} –ø–æ ${ue}`}),k=async()=>{i.value=!0,o.value=null;try{a.value=await Fe.getActivity({...l.value,limit:1e4}),t.value=a.value;const R=$e.calculateDashboardMetrics(t.value);r.value=T(R)}catch(R){o.value=R.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞",console.error("[ActivityDashboard] Error loading dashboard data:",R)}finally{i.value=!1}},T=R=>[{id:"total_entries",title:"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",value:R.total_entries?.value||0,previousValue:R.total_entries?.previousValue||0,change:R.total_entries?.change||0,changePercent:R.total_entries?.changePercent||0,trend:R.total_entries?.trend||"neutral",icon:"üìä",color:"#2196F3",drillDownRoute:"activity-details"},{id:"unique_users",title:"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",value:R.unique_users?.value||0,previousValue:R.unique_users?.previousValue||0,change:R.unique_users?.change||0,changePercent:R.unique_users?.changePercent||0,trend:R.unique_users?.trend||"neutral",icon:"üë•",color:"#4CAF50",drillDownRoute:"user-list"},{id:"total_sessions",title:"–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π",value:R.total_sessions?.value||0,previousValue:R.total_sessions?.previousValue||0,change:R.total_sessions?.change||0,changePercent:R.total_sessions?.changePercent||0,trend:R.total_sessions?.trend||"neutral",icon:"üéØ",color:"#FF9800",drillDownRoute:"session-analysis"},{id:"avg_session_duration",title:"–°—Ä. –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏",value:f(R.total_sessions?.value||0),previousValue:f(R.total_sessions?.previousValue||0),change:0,changePercent:0,trend:"neutral",icon:"‚è±Ô∏è",color:"#9C27B0",drillDownRoute:"session-details"}],f=R=>{if(!R)return"0—Å";const ue=Math.floor(R/60),ae=R%60;return ue>0?`${ue}–º ${ae}—Å`:`${ae}—Å`},y=R=>{l.value={...R},e("filters-changed",l.value),k()},E=R=>{v.value=!0,m.value=`–î–µ—Ç–∞–ª–∏: ${R.title}`,C.value={metric:R,filters:l.value,timestamp:new Date().toISOString()}},O=R=>{console.log("Time range changed:",R)},F=R=>{v.value=!0,m.value=`–î–µ—Ç–∞–ª–∏ —Å–µ–≥–º–µ–Ω—Ç–∞: ${R.label}`,C.value=R},w=R=>{e("user-profile-request",R)},_=R=>{console.log("Sort changed:",R)},b=R=>{console.log("Table export:",R)},L=()=>{v.value=!1,m.value="",C.value=null},V=()=>{k()},U=()=>{const R={filters:l.value,metrics:r.value,activityCount:t.value.length,timestamp:new Date().toISOString()},ue=JSON.stringify(R,null,2),ae=new Blob([ue],{type:"application/json"}),P=URL.createObjectURL(ae),Y=document.createElement("a");Y.href=P,Y.download=`activity-dashboard-${new Date().toISOString().split("T")[0]}.json`,Y.click()},S=()=>{A&&clearInterval(A),n.refreshInterval>0&&(A=setInterval(()=>{i.value||k()},n.refreshInterval))};return de(()=>{k(),S()}),ee(()=>n.initialFilters,R=>{l.value={...R},k()},{deep:!0}),{activityData:a,filteredActivityData:t,dashboardMetrics:r,loading:i,error:o,filters:l,timeGroupBy:u,distributionType:h,showDetailsModal:v,detailsModalTitle:m,detailsModalData:C,formatDateRange:I,handleFiltersChange:y,handleMetricDrillDown:E,handleTimeRangeChange:O,handleSegmentClick:F,handleUserSelect:w,handleSortChange:_,handleTableExport:b,closeDetailsModal:L,refresh:V,exportData:U,cleanup:()=>{A&&clearInterval(A)}}},beforeUnmount(){this.cleanup()}},Id={class:"activity-dashboard"},Ld={class:"dashboard-header"},Pd={class:"header-content"},Fd={class:"dashboard-subtitle"},Ud={class:"header-actions"},Rd=["disabled"],Od={key:0},Nd={key:1},Bd={class:"metrics-section"},Vd={class:"metrics-grid"},$d={class:"filters-section"},jd={class:"charts-section"},zd={class:"chart-row"},Wd={class:"chart-container time-chart"},qd={class:"chart-row"},Hd={class:"chart-container distribution-chart"},Xd={class:"chart-container user-ranking"},Jd={class:"data-table-section"},Yd={class:"modal-header"},Kd={class:"modal-content"};function Gd(n,e,a,t,r,i){const o=W("MetricCard"),l=W("AdvancedFilters"),u=W("TimeChart"),h=W("DistributionChart"),v=W("UserRanking"),m=W("ActivityDataTable");return c(),d("div",Id,[s("div",Ld,[s("div",Pd,[e[6]||(e[6]=s("h1",{class:"dashboard-title"},"üìä –î–∞—à–±–æ—Ä–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),s("p",Fd," –ê–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å "+g(t.formatDateRange),1)]),s("div",Ud,[s("button",{onClick:e[0]||(e[0]=(...C)=>t.refresh&&t.refresh(...C)),disabled:t.loading,class:"refresh-btn"},[t.loading?(c(),d("span",Od,"‚è≥")):(c(),d("span",Nd,"üîÑ")),G(" "+g(t.loading?"–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...":"–û–±–Ω–æ–≤–∏—Ç—å"),1)],8,Rd),s("button",{onClick:e[1]||(e[1]=(...C)=>t.exportData&&t.exportData(...C)),class:"export-btn"}," üì• –≠–∫—Å–ø–æ—Ä—Ç ")])]),s("div",Bd,[s("div",Vd,[(c(!0),d($,null,j(t.dashboardMetrics,C=>(c(),re(o,{key:C.id,metric:C,onDrillDown:t.handleMetricDrillDown},null,8,["metric","onDrillDown"]))),128))])]),s("div",$d,[J(l,{modelValue:t.filters,"onUpdate:modelValue":e[2]||(e[2]=C=>t.filters=C),onChange:t.handleFiltersChange},null,8,["modelValue","onChange"])]),s("div",jd,[s("div",zd,[s("div",Wd,[J(u,{data:t.activityData,"group-by":t.timeGroupBy,filters:t.filters,title:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏",onTimeRangeChange:t.handleTimeRangeChange},null,8,["data","group-by","filters","onTimeRangeChange"])])]),s("div",qd,[s("div",Hd,[J(h,{data:t.activityData,type:t.distributionType,title:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",onSegmentClick:t.handleSegmentClick},null,8,["data","type","onSegmentClick"])]),s("div",Xd,[J(v,{data:t.activityData,limit:10,title:"–¢–æ–ø –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",onUserSelect:t.handleUserSelect},null,8,["data","onUserSelect"])])])]),s("div",Jd,[J(m,{data:t.filteredActivityData,loading:t.loading,filters:t.filters,onSortChange:t.handleSortChange,onExport:t.handleTableExport},null,8,["data","loading","filters","onSortChange","onExport"])]),t.showDetailsModal?(c(),d("div",{key:0,class:"details-modal-overlay",onClick:e[5]||(e[5]=(...C)=>t.closeDetailsModal&&t.closeDetailsModal(...C))},[s("div",{class:"details-modal",onClick:e[4]||(e[4]=fe(()=>{},["stop"]))},[s("div",Yd,[s("h3",null,g(t.detailsModalTitle),1),s("button",{onClick:e[3]||(e[3]=(...C)=>t.closeDetailsModal&&t.closeDetailsModal(...C)),class:"close-btn"},"‚úï")]),s("div",Kd,[s("pre",null,g(JSON.stringify(t.detailsModalData,null,2)),1)])])])):M("",!0)])}const Qd=H(xd,[["render",Gd],["__scopeId","data-v-496834ef"]]),Zd={name:"UserProfileAnalysis",components:{TimeChart:jt,ActivityDataTable:zt},props:{userId:{type:Number,required:!0},filters:{type:Object,default:()=>({})}},emits:["back","export"],setup(n,{emit:e}){const a=p(null),t=p([]),r=p(!1),i=p(null),o=p("day"),l=p("timeline"),u=p("week"),h=p(null),v=D(()=>a.value?.sessions?[...a.value.sessions].sort((S,X)=>new Date(X.startTime)-new Date(S.startTime)):[]),m=D(()=>a.value?.sessions?.length?a.value.sessions.reduce((X,R)=>X+R.duration,0)/a.value.sessions.length:0),C=async()=>{r.value=!0,i.value=null;try{const S=await Fe.getUserProfileAnalytics(n.userId,n.filters);a.value=S,t.value=S.activity,await A()}catch(S){i.value=S.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",console.error("[UserProfileAnalysis] Error loading user profile:",S)}finally{r.value=!1}},A=async()=>{try{const S=new Date;let X,R,ue,ae;switch(u.value){case"week":X=new Date(S.getTime()-7*24*60*60*1e3),R=S,ue=new Date(S.getTime()-14*24*60*60*1e3),ae=new Date(S.getTime()-7*24*60*60*1e3);break;case"month":X=new Date(S.getFullYear(),S.getMonth(),1),R=S,ue=new Date(S.getFullYear(),S.getMonth()-1,1),ae=new Date(S.getFullYear(),S.getMonth(),0);break;case"quarter":const B=Math.floor(S.getMonth()/3);X=new Date(S.getFullYear(),B*3,1),R=S,ue=new Date(S.getFullYear(),(B-1)*3,1),ae=new Date(S.getFullYear(),B*3,0);break}const P={...n.filters,dateFrom:X.toISOString().split("T")[0],dateTo:R.toISOString().split("T")[0]},Y={...n.filters,dateFrom:ue.toISOString().split("T")[0],dateTo:ae.toISOString().split("T")[0]},[oe,ie]=await Promise.all([Fe.getUserActivity(n.userId,P),Fe.getUserActivity(n.userId,Y)]),Q=$e.analyzeUserSessions(oe),le=$e.analyzeUserSessions(ie);h.value={current:{actions:oe.length,sessions:Q.length,avgDuration:Q.length>0?Q.reduce((B,Z)=>B+Z.duration,0)/Q.length:0},previous:{actions:ie.length,sessions:le.length,avgDuration:le.length>0?le.reduce((B,Z)=>B+Z.duration,0)/le.length:0},change:{actions:oe.length-ie.length,sessions:Q.length-le.length,avgDuration:(Q.length>0?Q.reduce((B,Z)=>B+Z.duration,0)/Q.length:0)-(le.length>0?le.reduce((B,Z)=>B+Z.duration,0)/le.length:0)},changePercent:{actions:ie.length>0?(oe.length-ie.length)/ie.length*100:0,sessions:le.length>0?(Q.length-le.length)/le.length*100:0,avgDuration:0}}}catch(S){console.error("[UserProfileAnalysis] Error loading comparison data:",S)}},I=()=>{const S={userId:n.userId,profile:a.value,activity:t.value,filters:n.filters,timestamp:new Date().toISOString()};e("export",S)},k=S=>{console.log("Time range changed:",S)},T=S=>{console.log("Sort changed:",S)},f=S=>{console.log("Export data:",S)},y=S=>{if(!S)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{return new Date(S).toLocaleDateString("ru-RU")}catch{return S}},E=S=>pe.formatTimestamp(S),O=S=>pe.formatDuration(S),F=S=>({desktop:"–ö–æ–º–ø—å—é—Ç–µ—Ä",mobile:"–ú–æ–±–∏–ª—å–Ω—ã–π",tablet:"–ü–ª–∞–Ω—à–µ—Ç",unknown:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"})[S]||S||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",w=S=>S==null?"–ù–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω":`${S}:00`,_=S=>{const X=S.duration||0;return X<5*60*1e3?"session-short":X<15*60*1e3?"session-medium":"session-long"},b=S=>pe.getSessionColor(S),L=S=>{switch(S){case"app_entry":return"–í—Ö–æ–¥";case"page_visit":return"–ü–µ—Ä–µ—Ö–æ–¥";default:return S}},V=S=>S>0?"positive":S<0?"negative":"neutral",U=S=>S===0?"0%":`${S>0?"+":""}${S.toFixed(1)}%`;return ee(()=>n.userId,()=>{C()}),ee(()=>n.filters,()=>{C()},{deep:!0}),ee(u,()=>{A()}),de(()=>{C()}),{userProfile:a,userActivity:t,loading:r,error:i,chartGroupBy:o,sessionViewMode:l,comparisonPeriod:u,comparisonData:h,sortedSessions:v,avgSessionDuration:m,loadUserProfile:C,exportProfile:I,handleTimeRangeChange:k,handleSortChange:T,handleExport:f,formatDate:y,formatTimestamp:E,formatDuration:O,formatDevice:F,formatHour:w,getSessionClass:_,getSessionColor:b,getActionLabel:L,getChangeClass:V,formatChange:U}}},eu={class:"user-profile-analysis"},tu={class:"profile-header"},su={class:"header-content"},au={class:"user-info"},ou={class:"user-name"},nu={class:"user-details"},ru={key:0},iu={class:"header-actions"},lu={key:0,class:"profile-summary"},cu={class:"summary-cards"},du={class:"summary-card"},uu={class:"card-content"},gu={class:"card-value"},mu={class:"summary-card"},hu={class:"card-content"},vu={class:"card-value"},fu={class:"summary-card"},pu={class:"card-content"},yu={class:"card-value"},_u={class:"summary-card"},bu={class:"card-content"},wu={class:"card-value"},ku={key:1,class:"profile-stats"},Cu={class:"stats-grid"},Su={class:"stat-item"},Du={class:"stat-value"},Tu={class:"stat-item"},Au={class:"stat-value"},Eu={class:"stat-item"},Mu={class:"stat-value"},xu={class:"stat-item"},Iu={class:"stat-value"},Lu={class:"stat-item"},Pu={class:"stat-value"},Fu={class:"stat-item"},Uu={class:"stat-value"},Ru={class:"activity-chart-section"},Ou={class:"chart-container"},Nu={key:1,class:"no-data"},Bu={key:2,class:"sessions-section"},Vu={class:"sessions-controls"},$u={class:"session-stats"},ju={class:"stat"},zu={class:"stat"},Wu={key:0,class:"sessions-timeline"},qu={class:"timeline-container"},Hu={class:"timeline-content"},Xu={class:"session-header"},Ju={class:"session-time"},Yu={class:"session-duration"},Ku={class:"session-details"},Gu={class:"session-stats"},Qu={key:0,class:"session-actions"},Zu={key:1,class:"sessions-list"},eg={class:"session-info"},tg={class:"session-time-range"},sg={class:"session-meta"},ag={class:"session-device"},og={class:"detailed-activity-section"},ng={class:"comparison-section"},rg={class:"comparison-controls"},ig={key:0,class:"comparison-results"},lg={class:"comparison-metrics"},cg={class:"metric-comparison"},dg={class:"metric-values"},ug={class:"current"},gg={class:"previous"},mg={class:"metric-comparison"},hg={class:"metric-values"},vg={class:"current"},fg={class:"previous"},pg={class:"metric-comparison"},yg={class:"metric-values"},_g={class:"current"},bg={class:"previous"},wg={key:3,class:"loading-overlay"},kg={key:4,class:"error-message"};function Cg(n,e,a,t,r,i){const o=W("TimeChart"),l=W("ActivityDataTable");return c(),d("div",eu,[s("div",tu,[s("div",su,[s("button",{onClick:e[0]||(e[0]=u=>n.$emit("back")),class:"back-btn"},"‚Üê –ù–∞–∑–∞–¥"),s("div",au,[s("h1",ou,g(t.userProfile?.user?.name||"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"),1),s("p",nu,[G(" ID: "+g(a.userId)+" ",1),t.userProfile?.user?.email?(c(),d("span",ru,"‚Ä¢ "+g(t.userProfile.user.email),1)):M("",!0)])])]),s("div",iu,[s("button",{onClick:e[1]||(e[1]=(...u)=>t.exportProfile&&t.exportProfile(...u)),class:"export-btn"}," üì• –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ—Ñ–∏–ª—è ")])]),t.userProfile?(c(),d("div",lu,[s("div",cu,[s("div",du,[e[6]||(e[6]=s("div",{class:"card-icon"},"üìÖ",-1)),s("div",uu,[s("div",gu,g(t.formatDate(t.userProfile.analytics?.first_visit)),1),e[5]||(e[5]=s("div",{class:"card-label"},"–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥",-1))])]),s("div",mu,[e[8]||(e[8]=s("div",{class:"card-icon"},"‚è∞",-1)),s("div",hu,[s("div",vu,g(t.formatDate(t.userProfile.analytics?.last_visit)),1),e[7]||(e[7]=s("div",{class:"card-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥",-1))])]),s("div",fu,[e[10]||(e[10]=s("div",{class:"card-icon"},"üéØ",-1)),s("div",pu,[s("div",yu,g(t.userProfile.analytics?.total_sessions||0),1),e[9]||(e[9]=s("div",{class:"card-label"},"–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π",-1))])]),s("div",_u,[e[12]||(e[12]=s("div",{class:"card-icon"},"üìä",-1)),s("div",bu,[s("div",wu,g(t.userProfile.analytics?.total_actions||0),1),e[11]||(e[11]=s("div",{class:"card-label"},"–í—Å–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–π",-1))])])])])):M("",!0),t.userProfile?.analytics?(c(),d("div",ku,[e[19]||(e[19]=s("h2",{class:"section-title"},"üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),s("div",Cu,[s("div",Su,[e[13]||(e[13]=s("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–∏",-1)),s("div",Du,g(t.formatDuration(t.userProfile.analytics.avg_session_duration)),1)]),s("div",Tu,[e[14]||(e[14]=s("div",{class:"stat-label"},"–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ",-1)),s("div",Au,g(t.formatDevice(t.userProfile.analytics.device_preference)),1)]),s("div",Eu,[e[15]||(e[15]=s("div",{class:"stat-label"},"–õ—é–±–∏–º–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",-1)),s("div",Mu,g(t.userProfile.analytics.favorite_page||"–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞"),1)]),s("div",xu,[e[16]||(e[16]=s("div",{class:"stat-label"},"–ü–∏–∫–æ–≤—ã–π —á–∞—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),s("div",Iu,g(t.formatHour(t.userProfile.analytics.peak_hour)),1)]),s("div",Lu,[e[17]||(e[17]=s("div",{class:"stat-label"},"–û–±—â–µ–µ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",-1)),s("div",Pu,g(t.formatDuration(t.userProfile.analytics.total_duration)),1)]),s("div",Fu,[e[18]||(e[18]=s("div",{class:"stat-label"},"Retention (–¥–Ω–∏)",-1)),s("div",Uu,g(t.userProfile.analytics.retention_days)+" –¥–Ω–µ–π",1)])])])):M("",!0),s("div",Ru,[e[20]||(e[20]=s("h2",{class:"section-title"},"üìà –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),s("div",Ou,[t.userActivity.length>0?(c(),re(o,{key:0,data:t.userActivity,"group-by":t.chartGroupBy,title:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏",onTimeRangeChange:t.handleTimeRangeChange},null,8,["data","group-by","onTimeRangeChange"])):(c(),d("div",Nu," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ "))])]),t.userProfile?.sessions?.length>0?(c(),d("div",Bu,[e[22]||(e[22]=s("h2",{class:"section-title"},"üé≠ –°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",-1)),s("div",Vu,[z(s("select",{"onUpdate:modelValue":e[2]||(e[2]=u=>t.sessionViewMode=u),class:"view-mode-select"},[...e[21]||(e[21]=[s("option",{value:"timeline"},"–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è",-1),s("option",{value:"list"},"–°–ø–∏—Å–æ–∫",-1)])],512),[[ne,t.sessionViewMode]]),s("div",$u,[s("span",ju,"–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π: "+g(t.userProfile.sessions.length),1),s("span",zu,"–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: "+g(t.formatDuration(t.avgSessionDuration)),1)])]),t.sessionViewMode==="timeline"?(c(),d("div",Wu,[s("div",qu,[(c(!0),d($,null,j(t.sortedSessions,u=>(c(),d("div",{key:u.id,class:N(["timeline-item",t.getSessionClass(u)])},[s("div",{class:"timeline-marker",style:Ee({backgroundColor:t.getSessionColor(u)})},null,4),s("div",Hu,[s("div",Xu,[s("div",Ju,g(t.formatTimestamp(u.startTime)),1),s("div",Yu,g(t.formatDuration(u.duration)),1)]),s("div",Ku,[s("div",Gu,[s("span",null,g(u.entriesCount)+" –¥–µ–π—Å—Ç–≤–∏–π",1),s("span",null,g(u.pageCount)+" —Å—Ç—Ä–∞–Ω–∏—Ü",1),s("span",null,g(u.device||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),u.actions?(c(),d("div",Qu,[(c(!0),d($,null,j(Object.entries(u.actions),([h,v],m)=>(c(),d("span",{key:h,class:"action-badge"},g(t.getActionLabel(h))+": "+g(v),1))),128))])):M("",!0)])])],2))),128))])])):(c(),d("div",Zu,[(c(!0),d($,null,j(t.sortedSessions,u=>(c(),d("div",{class:"session-item",key:u.id},[s("div",eg,[s("div",tg,g(t.formatTimestamp(u.startTime))+" ‚Äî "+g(t.formatTimestamp(u.endTime)),1),s("div",sg," –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: "+g(t.formatDuration(u.duration))+" | –î–µ–π—Å—Ç–≤–∏–π: "+g(u.entriesCount)+" | –°—Ç—Ä–∞–Ω–∏—Ü: "+g(u.pageCount),1)]),s("div",ag,g(u.device||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]))),128))]))])):M("",!0),s("div",og,[e[23]||(e[23]=s("h2",{class:"section-title"},"üìã –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1)),J(l,{data:t.userActivity,loading:t.loading,onSortChange:t.handleSortChange,onExport:t.handleExport},null,8,["data","loading","onSortChange","onExport"])]),s("div",ng,[e[31]||(e[31]=s("h2",{class:"section-title"},"‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤",-1)),s("div",rg,[z(s("select",{"onUpdate:modelValue":e[3]||(e[3]=u=>t.comparisonPeriod=u),class:"period-select"},[...e[24]||(e[24]=[s("option",{value:"week"},"–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è vs –ø—Ä–µ–¥—ã–¥—É—â–∞—è",-1),s("option",{value:"month"},"–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü vs –ø—Ä–µ–¥—ã–¥—É—â–∏–π",-1),s("option",{value:"quarter"},"–¢–µ–∫—É—â–∏–π –∫–≤–∞—Ä—Ç–∞–ª vs –ø—Ä–µ–¥—ã–¥—É—â–∏–π",-1)])],512),[[ne,t.comparisonPeriod]])]),t.comparisonData?(c(),d("div",ig,[s("div",lg,[s("div",cg,[e[26]||(e[26]=s("div",{class:"metric-name"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π",-1)),s("div",dg,[s("span",ug,g(t.comparisonData.current.actions),1),e[25]||(e[25]=s("span",{class:"vs"},"vs",-1)),s("span",gg,g(t.comparisonData.previous.actions),1),s("span",{class:N(["change",t.getChangeClass(t.comparisonData.change.actions)])},g(t.formatChange(t.comparisonData.changePercent.actions)),3)])]),s("div",mg,[e[28]||(e[28]=s("div",{class:"metric-name"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π",-1)),s("div",hg,[s("span",vg,g(t.comparisonData.current.sessions),1),e[27]||(e[27]=s("span",{class:"vs"},"vs",-1)),s("span",fg,g(t.comparisonData.previous.sessions),1),s("span",{class:N(["change",t.getChangeClass(t.comparisonData.change.sessions)])},g(t.formatChange(t.comparisonData.changePercent.sessions)),3)])]),s("div",pg,[e[30]||(e[30]=s("div",{class:"metric-name"},"–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏",-1)),s("div",yg,[s("span",_g,g(t.formatDuration(t.comparisonData.current.avgDuration)),1),e[29]||(e[29]=s("span",{class:"vs"},"vs",-1)),s("span",bg,g(t.formatDuration(t.comparisonData.previous.avgDuration)),1),s("span",{class:N(["change",t.getChangeClass(t.comparisonData.change.avgDuration)])},g(t.formatChange(t.comparisonData.changePercent.avgDuration)),3)])])])])):M("",!0)]),t.loading?(c(),d("div",wg,[...e[32]||(e[32]=[s("div",{class:"loading-content"},[s("div",{class:"loading-spinner"}),s("div",{class:"loading-text"},"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...")],-1)])])):M("",!0),t.error?(c(),d("div",kg,[G(g(t.error)+" ",1),s("button",{onClick:e[4]||(e[4]=(...u)=>t.loadUserProfile&&t.loadUserProfile(...u)),class:"retry-btn"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):M("",!0)])}const Sg=H(Zd,[["render",Cg],["__scopeId","data-v-67f0e5a7"]]),Dg={name:"UserActivityList",components:{UserActivityCard:Sr,HiddenUsersManager:Bt,UserActivityFilters:Vt,UserActivityStats:$t,ActivityDashboard:Qd,UserProfileAnalysis:Sg},props:{userId:{type:Number,default:null},dateFrom:{type:String,default:null},dateTo:{type:String,default:null},type:{type:String,default:null}},emits:["view-details"],setup(n,{emit:e}){const a=p("list"),t=p(null),r=p([]),i=p(!1),o=p(null),l=p({userId:n.userId,dateFrom:n.dateFrom,dateTo:n.dateTo,type:n.type}),u=p([]),h=D(()=>Nt(r.value)),v=async()=>{i.value=!0,o.value=null;try{r.value=await Fe.getActivity(l.value);const E=new Map;r.value.forEach(O=>{O.user_id&&!E.has(O.user_id)&&E.set(O.user_id,{ID:O.user_id,NAME:O.user_name||"",LAST_NAME:"",EMAIL:O.user_email||""})}),u.value=Array.from(E.values())}catch(E){o.value=E.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",console.error("[UserActivityList] Error:",E)}finally{i.value=!1}},m=()=>{a.value="dashboard"},C=E=>{t.value=E.id,a.value="profile"},A=()=>{a.value="list"},I=E=>{e("view-details",E)},k=E=>{l.value={...E},v()},T=E=>{console.log("Export profile:",E)},f=E=>`${E.timestamp}-${E.user_id}-${E.type}-${E.route_path||""}`,y=()=>{v()};return de(()=>{v(),window.addEventListener("hidden-users-changed",y)}),qe(()=>{window.removeEventListener("hidden-users-changed",y)}),ee(()=>[n.userId,n.dateFrom,n.dateTo,n.type],()=>{l.value={userId:n.userId,dateFrom:n.dateFrom,dateTo:n.dateTo,type:n.type},v()},{deep:!0}),{viewMode:a,selectedUserId:t,activity:h,loading:i,error:o,filters:l,availableUsers:u,switchToDashboard:m,switchToUserProfile:C,switchToList:A,handleViewDetails:I,handleFiltersUpdate:k,handleProfileExport:T,getEntryKey:f}}},Tg={class:"user-activity-container"},Ag={key:0,class:"user-activity-list"},Eg={class:"list-header"},Mg={class:"header-actions"},xg={class:"filters-section"},Ig={key:0,class:"loading"},Lg={key:1,class:"error"},Pg={key:2,class:"empty"},Fg={key:3,class:"activity-items"},Ug={key:1,class:"analysis-dashboard"},Rg={key:2,class:"user-profile"};function Og(n,e,a,t,r,i){const o=W("HiddenUsersManager"),l=W("UserActivityFilters"),u=W("UserActivityStats"),h=W("UserActivityCard"),v=W("ActivityDashboard"),m=W("UserProfileAnalysis");return c(),d("div",Tg,[t.viewMode==="list"?(c(),d("div",Ag,[s("div",Eg,[e[1]||(e[1]=s("div",{class:"header-info"},[s("h2",{class:"list-title"},"üìã –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),s("p",{class:"list-subtitle"}," –ê–Ω–∞–ª–∏–∑ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ ")],-1)),s("div",Mg,[s("button",{onClick:e[0]||(e[0]=(...C)=>t.switchToDashboard&&t.switchToDashboard(...C)),class:"dashboard-btn"}," üìä –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏–∑–∞ ")])]),s("div",xg,[J(o,{filters:t.filters},null,8,["filters"]),J(l,{filters:t.filters,users:t.availableUsers,onUpdateFilters:t.handleFiltersUpdate},null,8,["filters","users","onUpdateFilters"])]),J(u,{filters:t.filters},null,8,["filters"]),t.loading?(c(),d("div",Ig," –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏... ")):t.error?(c(),d("div",Lg,g(t.error),1)):t.activity.length===0?(c(),d("div",Pg," –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ")):(c(),d("div",Fg,[(c(!0),d($,null,j(t.activity,C=>(c(),re(h,{key:t.getEntryKey(C),entry:C,onClick:A=>t.handleViewDetails(C)},null,8,["entry","onClick"]))),128))]))])):t.viewMode==="dashboard"?(c(),d("div",Ug,[J(v,{"initial-filters":t.filters,onUserProfileRequest:t.switchToUserProfile},null,8,["initial-filters","onUserProfileRequest"])])):t.viewMode==="profile"?(c(),d("div",Rg,[J(m,{"user-id":t.selectedUserId,filters:t.filters,onBack:t.switchToDashboard,onExport:t.handleProfileExport},null,8,["user-id","filters","onBack","onExport"])])):M("",!0)])}const Ng=H(Dg,[["render",Og],["__scopeId","data-v-be7508ea"]]),Bg={name:"UsersManagementPage",components:{UserActivityList:Ng,UserActivityFilters:Vt,UserActivityStats:$t,HiddenUsersManager:Bt},setup(){const n=Ye(),e=p([]),a=p({userId:null,type:null,dateFrom:null,dateTo:null}),t=async()=>{try{const h=await new as().getUsersList();e.value=h}catch(u){console.error("[UsersManagementPage] Error loading users:",u)}},r=u=>{a.value={...u}},i=u=>{console.log("View activity details:",u)},o=()=>{window.dispatchEvent(new CustomEvent("hidden-users-changed"))},l=()=>{n.push("/")};return de(async()=>{try{if(!(await Oe.checkAccess()).allowed){n.push("/");return}if(!await Oe.getCurrentUser()){n.push("/");return}await t()}catch(u){console.error("[UsersManagementPage] Error:",u),n.push("/")}}),{users:e,activityFilters:a,handleFiltersUpdate:r,handleViewActivityDetails:i,handleHiddenUsersChanged:o,goBack:l}}},Vg={class:"users-management-page"},$g={class:"page-header"},jg={class:"page-header-top"},zg={class:"page-content"},Wg={class:"activity-section"};function qg(n,e,a,t,r,i){const o=W("UserActivityFilters"),l=W("HiddenUsersManager"),u=W("UserActivityStats"),h=W("UserActivityList");return c(),d("div",Vg,[s("div",$g,[s("div",jg,[s("button",{onClick:e[0]||(e[0]=(...v)=>t.goBack&&t.goBack(...v)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[s("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),s("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=s("h1",null,"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",-1))]),s("div",zg,[s("div",Wg,[e[3]||(e[3]=s("h2",null,"üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),J(o,{filters:t.activityFilters,users:t.users,onUpdateFilters:t.handleFiltersUpdate},null,8,["filters","users","onUpdateFilters"]),J(l,{filters:t.activityFilters,onHiddenUsersChanged:t.handleHiddenUsersChanged},null,8,["filters","onHiddenUsersChanged"]),J(u,{filters:t.activityFilters},null,8,["filters"]),J(h,{userId:t.activityFilters.userId,dateFrom:t.activityFilters.dateFrom,dateTo:t.activityFilters.dateTo,type:t.activityFilters.type,onViewDetails:t.handleViewActivityDetails},null,8,["userId","dateFrom","dateTo","type","onViewDetails"])])])])}const Hg=H(Bg,[["render",qg],["__scopeId","data-v-d7aa0377"]]);class te{static async getCacheStatus(){try{const e=Ae("/api/admin/cache-status.php"),a=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!a.ok){const r=await a.text();throw new Error(`HTTP error! status: ${a.status}, message: ${r}`)}const t=await a.json();if(t.success){const r=t.modules||[];return r.length===0?{primaryModules:[],secondaryModules:[],metadata:{totalModules:0,primaryCount:0,secondaryCount:0}}:this.categorizeAndSortModules(r)}else throw new Error(t.error||"Failed to get cache status")}catch(e){throw console.error("[CacheManagementService] Error getting cache status:",e),e}}static async clearCache(e){try{const a=Ae("/api/admin/cache-clear.php"),t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,confirm:!0})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return!0;throw new Error(r.error||"Failed to clear cache")}catch(a){throw console.error("[CacheManagementService] Error clearing cache:",a),a}}static async getCacheStats(){try{const e=Ae("/api/admin/cache-stats.php"),a=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const t=await a.json();if(t.success)return t.stats||{};throw new Error(t.error||"Failed to get cache stats")}catch(e){throw console.error("[CacheManagementService] Error getting cache stats:",e),e}}static formatCacheSize(e){if(e===0)return"0 B";const a=1024,t=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(a));return Math.round(e/Math.pow(a,r)*100)/100+" "+t[r]}static categorizeAndSortModules(e,a={}){const t=this.generateCacheKey(e),r=this.getCachedResult(t);if(r&&!a.forceRefresh)return r;const i=performance.now(),o=this.performCategorization(e),l=performance.now();return o.metadata={processingTime:l-i,totalModules:e.length,primaryCount:o.primaryModules.length,secondaryCount:o.secondaryModules.length,cached:!1},this.setCachedResult(t,o),o}static performCategorization(e){const a=[],t=[];return e.forEach(r=>{this.validateModule(r),this.PRIMARY_MODULE_IDS.includes(r.id)?a.push({...r,category:"primary",priority:this.PRIMARY_MODULE_PRIORITIES[r.id]||999}):t.push({...r,category:"secondary",groupType:this.getModuleType(r.id)})}),{primaryModules:this.sortPrimaryModules(a),secondaryModules:this.sortSecondaryModules(t)}}static sortPrimaryModules(e){return e.sort((a,t)=>{const r=this.PRIMARY_MODULE_PRIORITIES[a.id]||999,i=this.PRIMARY_MODULE_PRIORITIES[t.id]||999;return r-i})}static sortSecondaryModules(e){return e.sort((a,t)=>{const r=this.getModuleType(a.id),i=this.getModuleType(t.id);return r!==i?this.compareModuleTypes(r,i):a.name.localeCompare(t.name)})}static compareModuleTypes(e,a){const t=["users","activity","webhooks","other"],r=t.indexOf(e),i=t.indexOf(a);return(r===-1?999:r)-(i===-1?999:i)}static getModuleType(e){for(const[a,t]of Object.entries(this.SECONDARY_MODULE_TYPES))if(e.startsWith(t.prefix))return a;return e.includes("time-tracking")?"time-tracking":e.includes("graph")?"graphs":e.includes("dashboard")?"dashboards":"other"}static getModuleTypeConfig(e){return this.SECONDARY_MODULE_TYPES[e]||{title:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏",description:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã"}}static validateModule(e){if(!e||typeof e!="object")throw new Error("Module must be an object");if(!e.id||typeof e.id!="string")throw new Error("Module must have a valid id");if(!e.name||typeof e.name!="string")throw new Error("Module must have a valid name");return!0}static generateCacheKey(e){const a=e.map(t=>t.id).sort().join(",");return btoa(a).substring(0,16)}static getCachedResult(e){const a=this.categorizationCache.get(e);return a?Date.now()-a.timestamp>this.CACHE_TTL?(this.categorizationCache.delete(e),null):{...a.data,metadata:{...a.data.metadata,cached:!0}}:null}static setCachedResult(e,a){if(this.categorizationCache.set(e,{data:{...a,metadata:{...a.metadata,cached:!1}},timestamp:Date.now()}),this.categorizationCache.size>10){const t=this.categorizationCache.keys().next().value;this.categorizationCache.delete(t)}}static clearCategorizationCache(){this.categorizationCache.clear()}static getCategorizationStats(){return{cacheSize:this.categorizationCache.size,cacheEntries:Array.from(this.categorizationCache.entries()).map(([e,a])=>({key:e,age:Date.now()-a.timestamp,modulesCount:a.data.primaryModules.length+a.data.secondaryModules.length}))}}static formatTTL(e){return e<60?`${e} —Å–µ–∫`:e<3600?`${Math.floor(e/60)} –º–∏–Ω`:`${Math.floor(e/3600)} —á`}static formatCreationTime(e){return e<1e3?`${Math.round(e)}–º—Å`:e<6e4?`${Math.round(e/1e3*10)/10}—Å–µ–∫`:`${Math.round(e/6e4*10)/10}–º–∏–Ω`}static formatCacheHitRatio(e){return`${Math.round(e*100)}%`}static formatDataFreshness(e){return`${Math.round(e*100)}%`}static getExpiryColor(e){if(!e)return"gray";const a=Date.now()/1e3,t=(e-a)/3600;return t>2?"green":t>.5?"yellow":"red"}static getEfficiencyColor(e){return e>=.85?"green":e>=.7?"yellow":"red"}static getCreationTimeColor(e){return e<=2e3?"green":e<=1e4?"yellow":"red"}static getFreshnessColor(e){return e>=.9?"green":e>=.7?"yellow":"red"}static generateModuleMetadata(e){const a=Math.floor(Date.now()/1e3),t=e.metadata||{},r=this.PRIMARY_MODULE_IDS.includes(e.id);return{version:t.version||"1.0",module_id:e.id,module_name:e.name,created_at:t.created_at||a-Math.random()*86400*7,created_by:t.created_by||(Math.random()>.5?"system":"cron"),creation_time_ms:t.creation_time_ms||500+Math.random()*9500,last_accessed_at:t.last_accessed_at||a-Math.random()*3600,access_count:t.access_count||Math.floor(Math.random()*100)+1,expires_at:t.expires_at||a+(e.ttl||3600),ttl_seconds:e.ttl||3600,file_size_bytes:e.total_size||Math.floor(Math.random()*1e7)+1e6,compression_ratio:t.compression_ratio||.7+Math.random()*.3,data_version:t.data_version||`2026.01.12.v${Math.floor(Math.random()*10)+1}`,source_params:t.source_params||{period:r?Math.random()>.5?"weeks":"months":"default",sector_id:e.id.includes("sector-1c")?"1c":"all",filters:Math.random()>.5?["active_only"]:[],limit:Math.floor(Math.random()*1e3)+500},performance_metrics:t.performance_metrics||{avg_response_time_ms:20+Math.random()*80,cache_hit_ratio:.7+Math.random()*.3,data_freshness_score:.8+Math.random()*.2}}}static enrichModulesWithMetadata(e){return e.map(a=>({...a,metadata:this.generateModuleMetadata(a)}))}}Re(te,"PRIMARY_MODULE_IDS",["dashboard-sector-1c","graph-state","graph-admission-closure-weeks","graph-admission-closure-months","time-tracking-default","time-tracking-detailed","time-tracking-summary"]),Re(te,"PRIMARY_MODULE_PRIORITIES",{"dashboard-sector-1c":1,"graph-state":2,"graph-admission-closure-weeks":3,"graph-admission-closure-months":4,"time-tracking-default":5,"time-tracking-detailed":6,"time-tracking-summary":7}),Re(te,"SECONDARY_MODULE_TYPES",{users:{prefix:"users-management",title:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –æ—Ç–¥–µ–ª–∞–º–∏"},activity:{prefix:"user-activity",title:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",description:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},webhooks:{prefix:"webhook-logs",title:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",description:"–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±—Ö—É–∫–æ–≤"}}),Re(te,"categorizationCache",new Map),Re(te,"CACHE_TTL",3e4);function Xg(n){const e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),a=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-a);const t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}class it{static async createCache(e,a=null,t={}){try{const r=Ae("/api/admin/cache-create.php"),i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,mode:a,params:t})});if(!i.ok){const l=await i.json().catch(()=>({}));throw new Error(l.error||`HTTP error! status: ${i.status}`)}const o=await i.json();if(o.success)return o;throw new Error(o.error||"Failed to create cache")}catch(r){throw console.error("[CacheCreationService] Error creating cache:",r),r}}static async getCreationStatus(e){try{const a=Ae(`/api/admin/cache-create-status.php?task_id=${e}`),t=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return r;throw new Error(r.error||"Failed to get creation status")}catch(a){throw console.error("[CacheCreationService] Error getting creation status:",a),a}}static getDefaultParams(e){if(e.includes("graph-admission-closure"))if((e.includes("weeks")?"weeks":"months")==="weeks"){const t=new Date,r=t.getUTCFullYear(),i=Xg(t),o=new Date(r,0,1+(i-1)*7),l=o.getUTCDay(),u=o.getUTCDate()-l+(l===0?-6:1);o.setUTCDate(u),o.setUTCHours(0,0,0,0);const h=new Date(o);return h.setUTCDate(o.getUTCDate()+6),h.setUTCHours(23,59,59,999),{product:"1C",periodMode:"weeks",weekStartUtc:o.toISOString(),weekEndUtc:h.toISOString(),includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,useCache:!0,forceRefresh:!0}}else return{product:"1C",periodMode:"months",includeTickets:!0,includeNewTicketsByStages:!1,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!1};if(e.includes("dashboard-sector-1c"))return{forceRefresh:!0,ttl:600};if(e.includes("graph-state"))return{type:"current",forceRefresh:!0,ttl:3600};if(e.includes("time-tracking")){const a=e.includes("detailed")?"detailed":e.includes("summary")?"summary":"default";return{product:"1C",includeTaskDetails:a==="detailed",summary:a==="summary"}}return{}}}class Ze{static notifyCacheCreationStarted(e){this.showNotification({content:`–ù–∞—á–∞—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}"...`,type:"info",autoHideDelay:3e3})}static notifyCacheCreationSuccess(e){this.showNotification({content:`‚úÖ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,type:"success",autoHideDelay:5e3})}static notifyCacheCreationError(e,a){this.showNotification({content:`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}": ${a}`,type:"error",autoHideDelay:7e3})}static notifyCacheUpdated(e,a="auto"){const t=a==="manual"?"–≤—Ä—É—á–Ω—É—é":"–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏";this.showNotification({content:`üîÑ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" –æ–±–Ω–æ–≤–ª—ë–Ω ${t}`,type:"info",autoHideDelay:4e3})}static notifyCacheUsed(e){this.showNotification({content:`‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}"`,type:"success",autoHideDelay:3e3})}static showNotification(e){typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:e.content,autoHideDelay:e.autoHideDelay||3e3}):console.log("[CacheNotification]",e.content)}}const Hv=Object.freeze(Object.defineProperty({__proto__:null,CacheNotificationService:Ze},Symbol.toStringTag,{value:"Module"})),Jg={name:"CacheCreateProgress",props:{progress:{type:Number,required:!0,validator:n=>n>=0&&n<=100},message:{type:String,default:"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞..."}}},Yg={class:"cache-create-progress"},Kg={class:"progress-bar"},Gg={class:"progress-text"};function Qg(n,e,a,t,r,i){return c(),d("div",Yg,[s("div",Kg,[s("div",{class:"progress-fill",style:Ee({width:a.progress+"%"})},null,4)]),s("div",Gg,g(a.progress)+"% - "+g(a.message),1)])}const Zg=H(Jg,[["render",Qg],["__scopeId","data-v-7071de3b"]]),em={name:"CacheCreateModal",components:{CacheCreateProgress:Zg},props:{module:{type:Object,required:!0}},emits:["close","create"],setup(n,{emit:e}){const a=p(!1),t=p(0),r=p(""),i=p(null),o=p(""),l=D(()=>n.module.id.includes("graph-admission-closure")||n.module.id.includes("time-tracking")),u=D(()=>n.module.id.includes("graph-admission-closure")?["months","weeks"]:n.module.id.includes("time-tracking")?["default","detailed","summary"]:[]),h=()=>{e("close")},v=C=>{C.target===C.currentTarget&&h()},m=async()=>{a.value=!0,t.value=0,r.value="–ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞...";try{let C={};if(o.value.trim())try{C=JSON.parse(o.value)}catch{throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")}else C=it.getDefaultParams(n.module.id);Ze.notifyCacheCreationStarted(n.module.name),t.value=25,r.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24...";const A=await it.createCache(n.module.id,i.value,C);t.value=75,r.value="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∞...",await new Promise(I=>setTimeout(I,500)),t.value=100,r.value="–ö–µ—à —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",Ze.notifyCacheCreationSuccess(n.module.name),setTimeout(()=>{e("create",A),h()},1e3)}catch(C){console.error("[CacheCreateModal] Error creating cache:",C),Ze.notifyCacheCreationError(n.module.name,C.message),a.value=!1}};return de(()=>{u.value.length>0&&(i.value=u.value[0]);const C=it.getDefaultParams(n.module.id);o.value=JSON.stringify(C,null,2)}),{creating:a,progress:t,progressMessage:r,selectedMode:i,paramsJson:o,supportsModes:l,availableModes:u,close:h,handleOverlayClick:v,handleCreate:m}}},tm={class:"modal-header"},sm={class:"modal-body"},am={key:1,class:"create-form"},om={key:0,class:"form-group"},nm=["value"],rm={class:"form-group"},im={class:"modal-footer"},lm=["disabled"],cm=["disabled"],dm={key:0},um={key:1};function gm(n,e,a,t,r,i){const o=W("CacheCreateProgress");return c(),d("div",{class:"modal-overlay",onClick:e[6]||(e[6]=(...l)=>t.handleOverlayClick&&t.handleOverlayClick(...l))},[s("div",{class:"modal-content",onClick:e[5]||(e[5]=fe(()=>{},["stop"]))},[s("div",tm,[s("h2",null,"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞: "+g(a.module.name),1),s("button",{onClick:e[0]||(e[0]=(...l)=>t.close&&t.close(...l)),class:"btn-close"},"√ó")]),s("div",sm,[t.creating?(c(),re(o,{key:0,progress:t.progress,message:t.progressMessage},null,8,["progress","message"])):(c(),d("div",am,[t.supportsModes?(c(),d("div",om,[e[7]||(e[7]=s("label",null,"–†–µ–∂–∏–º –∫–µ—à–∞:",-1)),z(s("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.selectedMode=l),class:"form-control"},[(c(!0),d($,null,j(t.availableModes,l=>(c(),d("option",{key:l,value:l},g(l),9,nm))),128))],512),[[ne,t.selectedMode]])])):M("",!0),s("div",rm,[e[8]||(e[8]=s("label",null,"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):",-1)),z(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.paramsJson=l),placeholder:'{"product": "1C", ...}',rows:"5",class:"form-control"},null,512),[[be,t.paramsJson]]),e[9]||(e[9]=s("small",{class:"form-text"},"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",-1))])]))]),s("div",im,[s("button",{onClick:e[3]||(e[3]=(...l)=>t.close&&t.close(...l)),class:"btn-cancel",disabled:t.creating},"–û—Ç–º–µ–Ω–∞",8,lm),s("button",{onClick:e[4]||(e[4]=(...l)=>t.handleCreate&&t.handleCreate(...l)),disabled:t.creating,class:"btn-create"},[t.creating?(c(),d("span",dm,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",um,"–°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],8,cm)])])])}const mm=H(em,[["render",gm],["__scopeId","data-v-da24811e"]]),hm={name:"CacheCreateButton",components:{CacheCreateModal:mm},props:{module:{type:Object,required:!0}},emits:["created"],setup(n,{emit:e}){const a=p(!1),t=p(!1);return{showModal:a,creating:t,openModal:()=>{a.value=!0},closeModal:()=>{a.value=!1},handleCreate:async l=>{t.value=!0;try{e("created",l)}finally{t.value=!1}}}}},vm={class:"cache-create-button"},fm=["disabled"],pm={key:0},ym={key:1};function _m(n,e,a,t,r,i){const o=W("CacheCreateModal");return c(),d("div",vm,[s("button",{onClick:e[0]||(e[0]=(...l)=>t.openModal&&t.openModal(...l)),disabled:t.creating,class:N(["btn-create",{"btn-disabled":t.creating}])},[t.creating?(c(),d("span",pm,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",ym,"‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],10,fm),t.showModal?(c(),re(o,{key:0,module:a.module,onClose:t.closeModal,onCreate:t.handleCreate},null,8,["module","onClose","onCreate"])):M("",!0)])}const bm=H(hm,[["render",_m],["__scopeId","data-v-177605d5"]]),wm={name:"CacheModuleCard",components:{CacheCreateButton:bm},props:{module:{type:Object,required:!0,validator:n=>n&&typeof n.id=="string"&&typeof n.name=="string"},isPrimary:{type:Boolean,default:!1},priority:{type:Number,default:999},groupType:{type:String,default:null}},emits:["clear","refresh","details"],setup(n,{emit:e}){const a=p(!1),t=p(!1),r=p(!1),i=p(!1);de(()=>{const B=()=>{i.value=window.innerWidth<768};B(),window.addEventListener("resize",B)});const o=D(()=>({"cache-module-card":!0,"primary-module":n.isPrimary,"secondary-module":!n.isPrimary,"high-priority":n.priority<=3,"expiring-soon":A.value,"empty-cache":C.value,loading:a.value||t.value})),l=D(()=>n.isPrimary?"üèÜ":{users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"}[n.groupType]||"üîß"),u=D(()=>({"primary-icon":n.isPrimary,"secondary-icon":!n.isPrimary})),h=D(()=>n.isPrimary?"–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å":n.groupType?te.getModuleTypeConfig(n.groupType).title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞":""),v=D(()=>n.priority?`priority-${n.priority}`:""),m=D(()=>`status-${n.module.status||"empty"}`),C=D(()=>(n.module.file_count||0)===0),A=D(()=>{if(!n.module.expires_at)return!1;const ce=(new Date(n.module.expires_at*1e3)-new Date)/(1e3*60*60);return ce>0&&ce<=2}),I=D(()=>{const B=n.module.status;return B==="active"?"–ê–∫—Ç–∏–≤–µ–Ω":B==="expired"?"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω":B==="empty"?"–ü—É—Å—Ç":"–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}),k=D(()=>te.formatCacheSize(n.module.total_size||0)),T=D(()=>te.formatTTL(n.module.ttl||0)),f=D(()=>{if(!n.module.cache_dir)return"";const B=n.module.cache_dir.split("/");return B.length>2?"..."+B.slice(-2).join("/"):n.module.cache_dir}),y=D(()=>n.module.metadata?.creation_time_ms?te.formatCreationTime(n.module.metadata.creation_time_ms):"‚Äî"),E=D(()=>{if(!n.module.metadata?.last_accessed_at)return"‚Äî";const B=new Date(n.module.metadata.last_accessed_at*1e3),ce=new Date-B;return ce<6e4?"–¢–æ–ª—å–∫–æ —á—Ç–æ":ce<36e5?`${Math.floor(ce/6e4)} –º–∏–Ω –Ω–∞–∑–∞–¥`:B.toLocaleString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),O=D(()=>n.module.metadata?.access_count||0),F=D(()=>n.module.metadata?.performance_metrics?.cache_hit_ratio?te.formatCacheHitRatio(n.module.metadata.performance_metrics.cache_hit_ratio):"‚Äî"),w=D(()=>n.module.metadata?.performance_metrics?.data_freshness_score?te.formatDataFreshness(n.module.metadata.performance_metrics.data_freshness_score):"‚Äî"),_=D(()=>n.module.expires_at?`metric-${te.getExpiryColor(n.module.expires_at)}`:""),b=D(()=>n.module.metadata?.creation_time_ms?`metric-${te.getCreationTimeColor(n.module.metadata.creation_time_ms)}`:""),L=D(()=>n.module.metadata?.performance_metrics?.cache_hit_ratio?`metric-${te.getEfficiencyColor(n.module.metadata.performance_metrics.cache_hit_ratio)}`:""),V=D(()=>n.module.metadata?.performance_metrics?.data_freshness_score?`metric-${te.getFreshnessColor(n.module.metadata.performance_metrics.data_freshness_score)}`:""),U=D(()=>!C.value&&!a.value),S=D(()=>n.isPrimary&&!C.value),X=D(()=>C.value?"–ö–µ—à –º–æ–¥—É–ª—è –ø—É—Å—Ç":`–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è ${n.module.name}`),R=D(()=>{if(!n.module.created_at)return"‚Äî";const B=new Date(n.module.created_at*1e3),Z=new Date,ce=Z-B;if(ce<6e4)return"–¢–æ–ª—å–∫–æ —á—Ç–æ";if(ce<36e5){const we=Math.floor(ce/6e4);return`${we} ${we===1?"–º–∏–Ω—É—Ç—É":we<5?"–º–∏–Ω—É—Ç—ã":"–º–∏–Ω—É—Ç"} –Ω–∞–∑–∞–¥`}if(B.toDateString()===Z.toDateString())return`–°–µ–≥–æ–¥–Ω—è –≤ ${B.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`;const he=new Date(Z);return he.setDate(he.getDate()-1),B.toDateString()===he.toDateString()?`–í—á–µ—Ä–∞ –≤ ${B.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:B.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),ue=D(()=>{if(!n.module.expires_at)return"‚Äî";const B=new Date(n.module.expires_at*1e3),ce=B-new Date;if(ce<0)return`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω (${B.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})`;const he=Math.floor(ce/6e4),we=Math.floor(he/60);return we>0?`${we} —á ${he%60} –º–∏–Ω`:he>0?`${he} –º–∏–Ω`:"–ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã"}),ae=async()=>{if(!(!U.value||!await le({title:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏",message:`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${n.module.name}"?`,type:"danger",confirmText:"–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à",cancelText:"–û—Ç–º–µ–Ω–∞"}))){a.value=!0;try{await te.clearCache(n.module.id),e("clear",n.module.id),Q({type:"success",title:"–ö–µ—à –æ—á–∏—â–µ–Ω",message:`–ö–µ—à –º–æ–¥—É–ª—è "${n.module.name}" —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω`})}catch(Z){Q({type:"error",title:"–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏",message:Z.message})}finally{a.value=!1}}},P=()=>{e("refresh")},Y=B=>{t.value=B},oe=()=>{r.value=!0,e("details",n.module)},ie=()=>{r.value=!1},Q=({type:B,title:Z,message:ce})=>{typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:`${Z}: ${ce}`,autoHideDelay:B==="error"?5e3:3e3}):alert(`${Z}: ${ce}`)},le=async({title:B,message:Z,type:ce,confirmText:he,cancelText:we})=>new Promise(He=>{const ke=document.createElement("div");ke.className="confirmation-modal-overlay",ke.innerHTML=`
          <div class="confirmation-modal" role="dialog" aria-modal="true">
            <div class="modal-header">
              <h3>${B}</h3>
            </div>
            <div class="modal-body">
              <p>${Z}</p>
              <div class="warning-info">
                <p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ:</p>
                <ul>
                  <li>–£–¥–∞–ª–∏—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∫–µ—à–∞</li>
                  <li>–ü—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É —Å–æ–∑–¥–∞–Ω–∏—é –∫–µ—à–∞ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ</li>
                  <li>–ú–æ–∂–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–µ–¥–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É –º–æ–¥—É–ª—è</li>
                </ul>
              </div>
            </div>
            <div class="modal-actions">
              <button class="btn-cancel">${we}</button>
              <button class="btn-confirm">${he}</button>
            </div>
          </div>
        `;const ot=ke.querySelector(".btn-cancel"),x=ke.querySelector(".btn-confirm");ot.addEventListener("click",()=>{ke.remove(),He(!1)}),x.addEventListener("click",()=>{ke.remove(),He(!0)}),document.addEventListener("keydown",function q(se){se.key==="Escape"&&(ke.remove(),He(!1),document.removeEventListener("keydown",q))}),document.body.appendChild(ke)});return{clearing:a,creating:t,showDetailModal:r,isMobile:i,moduleClasses:o,moduleIcon:l,iconClass:u,moduleTypeText:h,priorityClass:v,statusClass:m,isEmpty:C,isExpiringSoon:A,statusText:I,formattedSize:k,formattedTTL:T,shortCacheDir:f,formattedCreationTime:y,formattedLastAccess:E,accessCount:O,cacheEfficiency:F,dataFreshness:w,expiresClass:_,creationTimeClass:b,cacheEfficiencyClass:L,dataFreshnessClass:V,canClear:U,canShowDetails:S,clearButtonLabel:X,formattedCreatedAt:R,formattedExpiresAt:ue,handleClear:ae,handleCacheCreated:P,handleCreatingState:Y,showDetails:oe,closeDetails:ie}}},km=["aria-labelledby","aria-describedby"],Cm={class:"card-header"},Sm={class:"module-identity"},Dm={class:"module-info"},Tm=["id"],Am={class:"module-type"},Em={class:"header-meta"},Mm=["id"],xm={class:"card-content"},Im={class:"data-grid"},Lm={class:"data-section statistics"},Pm={class:"data-items"},Fm={class:"data-item"},Um={class:"data-value"},Rm={class:"data-item"},Om={class:"data-value"},Nm={key:0,class:"data-item full-width"},Bm=["title"],Vm={class:"data-section lifetime"},$m={class:"data-items"},jm={class:"data-item"},zm={class:"data-value"},Wm={key:0,class:"data-item"},qm={class:"data-value"},Hm={key:1,class:"data-item"},Xm={key:0,class:"data-section performance"},Jm={class:"data-items"},Ym={class:"data-item"},Km={class:"data-item"},Gm={class:"data-value"},Qm={class:"data-item"},Zm={class:"data-value"},eh={class:"data-item"},th={class:"data-item"},sh={class:"primary-actions"},ah={class:"secondary-actions"},oh=["disabled","aria-label"],nh={key:0,class:"button-content"},rh={key:1,class:"button-content"},ih={key:2,class:"button-content"},lh=["aria-label"],ch={class:"detail-modal",role:"dialog","aria-modal":"true"},dh={class:"modal-header"},uh={class:"modal-content"},gh={class:"json-data"};function mh(n,e,a,t,r,i){const o=W("CacheCreateButton");return c(),d("article",{class:N(["cache-module-card",t.moduleClasses]),role:"article","aria-labelledby":`module-${a.module.id}-title`,"aria-describedby":`module-${a.module.id}-status`},[s("div",Cm,[s("div",Sm,[s("div",{class:N(["module-icon",t.iconClass])},g(t.moduleIcon),3),s("div",Dm,[s("h3",{class:"module-name",id:`module-${a.module.id}-title`},g(a.module.name),9,Tm),s("span",Am,g(t.moduleTypeText),1)])]),s("div",Em,[a.isPrimary&&a.priority?(c(),d("span",{key:0,class:N(["priority-badge",t.priorityClass])},g(a.priority),3)):M("",!0),s("span",{class:N(["status-badge",t.statusClass]),id:`module-${a.module.id}-status`,role:"status"},g(t.statusText),11,Mm)])]),s("div",xm,[s("div",Im,[s("div",Lm,[e[14]||(e[14]=s("div",{class:"section-header"},[s("span",{class:"section-icon"},"üìä"),s("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],-1)),s("div",Pm,[s("div",Fm,[e[11]||(e[11]=s("span",{class:"data-label"},"–§–∞–π–ª–æ–≤:",-1)),s("span",Um,g(a.module.file_count||0),1)]),s("div",Rm,[e[12]||(e[12]=s("span",{class:"data-label"},"–†–∞–∑–º–µ—Ä:",-1)),s("span",Om,g(t.formattedSize),1)]),a.module.cache_dir?(c(),d("div",Nm,[e[13]||(e[13]=s("span",{class:"data-label"},"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:",-1)),s("span",{class:"data-value cache-dir",title:a.module.cache_dir},g(t.shortCacheDir),9,Bm)])):M("",!0)])]),s("div",Vm,[e[18]||(e[18]=s("div",{class:"section-header"},[s("span",{class:"section-icon"},"‚è∞"),s("h4",{class:"section-title"},"–í—Ä–µ–º—è –∂–∏–∑–Ω–∏")],-1)),s("div",$m,[s("div",jm,[e[15]||(e[15]=s("span",{class:"data-label"},"TTL:",-1)),s("span",zm,g(t.formattedTTL),1)]),a.module.created_at?(c(),d("div",Wm,[e[16]||(e[16]=s("span",{class:"data-label"},"–°–æ–∑–¥–∞–Ω:",-1)),s("span",qm,g(t.formattedCreatedAt),1)])):M("",!0),a.module.expires_at?(c(),d("div",Hm,[e[17]||(e[17]=s("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç:",-1)),s("span",{class:N(["data-value",t.expiresClass])},g(t.formattedExpiresAt),3)])):M("",!0)])]),a.isPrimary&&a.module.metadata?(c(),d("div",Xm,[e[24]||(e[24]=s("div",{class:"section-header"},[s("span",{class:"section-icon"},"‚ö°"),s("h4",{class:"section-title"},"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")],-1)),s("div",Jm,[s("div",Ym,[e[19]||(e[19]=s("span",{class:"data-label"},"–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:",-1)),s("span",{class:N(["data-value",t.creationTimeClass])},g(t.formattedCreationTime),3)]),s("div",Km,[e[20]||(e[20]=s("span",{class:"data-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—Å—Ç—É–ø:",-1)),s("span",Gm,g(t.formattedLastAccess),1)]),s("div",Qm,[e[21]||(e[21]=s("span",{class:"data-label"},"–û–±—Ä–∞—â–µ–Ω–∏–π:",-1)),s("span",Zm,g(t.accessCount),1)]),s("div",eh,[e[22]||(e[22]=s("span",{class:"data-label"},"–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),s("span",{class:N(["data-value",t.cacheEfficiencyClass])},g(t.cacheEfficiency),3)]),s("div",th,[e[23]||(e[23]=s("span",{class:"data-label"},"–°–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:",-1)),s("span",{class:N(["data-value",t.dataFreshnessClass])},g(t.dataFreshness),3)])])])):M("",!0)])]),s("div",{class:N(["card-actions",{"mobile-layout":t.isMobile}])},[s("div",sh,[J(o,{module:a.module,disabled:t.creating,onCreated:t.handleCacheCreated,onCreating:t.handleCreatingState,class:N(["action-button create-button",{loading:t.creating}])},null,8,["module","disabled","onCreated","onCreating","class"])]),s("div",ah,[s("button",{onClick:e[0]||(e[0]=(...l)=>t.handleClear&&t.handleClear(...l)),onKeydown:[e[1]||(e[1]=De((...l)=>t.handleClear&&t.handleClear(...l),["enter"])),e[2]||(e[2]=De(fe((...l)=>t.handleClear&&t.handleClear(...l),["prevent"]),["space"]))],disabled:!t.canClear,class:N(["action-button clear-button",{disabled:!t.canClear,loading:t.clearing}]),"aria-label":t.clearButtonLabel,tabindex:"0"},[t.clearing?(c(),d("span",nh,[...e[25]||(e[25]=[s("span",{class:"spinner"},null,-1),G(" –û—á–∏—Å—Ç–∫–∞... ",-1)])])):t.isEmpty?(c(),d("span",rh," üìÅ –ö–µ—à –ø—É—Å—Ç ")):(c(),d("span",ih," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å "))],42,oh),t.canShowDetails?(c(),d("button",{key:0,onClick:e[3]||(e[3]=(...l)=>t.showDetails&&t.showDetails(...l)),onKeydown:[e[4]||(e[4]=De((...l)=>t.showDetails&&t.showDetails(...l),["enter"])),e[5]||(e[5]=De(fe((...l)=>t.showDetails&&t.showDetails(...l),["prevent"]),["space"]))],class:"action-button details-button","aria-label":`–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞ ${a.module.name}`,title:"–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞",tabindex:"0"}," üìä ",40,lh)):M("",!0)])],2),(c(),re(kt,{to:"body"},[t.showDetailModal?(c(),d("div",{key:0,class:"detail-modal-overlay",onClick:e[9]||(e[9]=fe((...l)=>t.closeDetails&&t.closeDetails(...l),["self"])),onKeydown:e[10]||(e[10]=De((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))},[s("div",ch,[s("div",dh,[s("h3",null,"–î–µ—Ç–∞–ª–∏ –∫–µ—à–∞: "+g(a.module.name),1),s("button",{onClick:e[6]||(e[6]=(...l)=>t.closeDetails&&t.closeDetails(...l)),onKeydown:[e[7]||(e[7]=De((...l)=>t.closeDetails&&t.closeDetails(...l),["enter"])),e[8]||(e[8]=De((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))],class:"close-button","aria-label":"–ó–∞–∫—Ä—ã—Ç—å",tabindex:"0"}," ‚úï ",32)]),s("div",uh,[s("pre",gh,g(JSON.stringify(a.module,null,2)),1)])])],32)):M("",!0)]))],10,km)}const hh=H(wm,[["render",mh],["__scopeId","data-v-c700185b"]]),vh={name:"CacheStats",props:{modules:{type:Array,required:!1,default:()=>[]}},setup(n){console.log("[CacheStats] setup called with modules:",n.modules);const e=D(()=>n.modules||[]),a=D(()=>{console.log("[CacheStats] Computing primaryModules, total modules:",e.value?.length||0);const I=e.value.filter(k=>te.PRIMARY_MODULE_IDS.includes(k.id));return console.log("[CacheStats] Primary modules count:",I.length),I}),t=D(()=>{console.log("[CacheStats] Computing secondaryModules, total modules:",e.value?.length||0);const I=e.value.filter(k=>!te.PRIMARY_MODULE_IDS.includes(k.id));return console.log("[CacheStats] Secondary modules count:",I.length),I}),r=D(()=>a.value?.length||0),i=D(()=>t.value?.length||0),o=D(()=>e.value?.length||0),l=D(()=>e.value.reduce((I,k)=>I+(k.file_count||0),0)),u=D(()=>(n.modules||[]).reduce((I,k)=>I+(k.total_size||0),0)),h=D(()=>te.formatCacheSize(u.value)),v=D(()=>{const I=n.modules||[];if(I.length===0)return"0 –º–∏–Ω";const k=I.reduce((f,y)=>f+(y.ttl||0),0),T=Math.round(k/I.length);return te.formatTTL(T)}),m=D(()=>(e.value||[]).filter(I=>I.status==="active").length),C=D(()=>{if((i.value||0)===0)return[];const I={};(t.value||[]).forEach(T=>{const f=te.getModuleType(T.id);if(!I[f]){const y=te.getModuleTypeConfig(f);I[f]={type:f,title:y.title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞",icon:A(f),count:0}}I[f].count++});const k=i.value||0;return Object.values(I).map(T=>({...T,percentage:k>0?Math.round(T.count/k*100):0})).sort((T,f)=>f.count-T.count)}),A=I=>{const k={users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"};return k[I]||k.other};return{modules:e,primaryModulesCount:r,secondaryModulesCount:i,totalModules:o,totalFiles:l,totalSizeFormatted:h,avgTTL:v,activeModules:m,groupStats:C}}},fh={key:0,class:"cache-stats"},ph={class:"stats-overview"},yh={class:"overview-grid"},_h={class:"overview-card primary"},bh={class:"overview-content"},wh={class:"overview-value"},kh={class:"overview-card secondary"},Ch={class:"overview-content"},Sh={class:"overview-value"},Dh={class:"overview-card total"},Th={class:"overview-content"},Ah={class:"overview-value"},Eh={class:"detailed-stats"},Mh={class:"stats-grid"},xh={class:"stat-card"},Ih={class:"stat-content"},Lh={class:"stat-value"},Ph={class:"stat-card"},Fh={class:"stat-content"},Uh={class:"stat-value"},Rh={class:"stat-card"},Oh={class:"stat-content"},Nh={class:"stat-value"},Bh={class:"stat-card"},Vh={class:"stat-content"},$h={class:"stat-value"},jh={key:0,class:"group-distribution"},zh={class:"distribution-grid"},Wh={class:"group-icon"},qh={class:"group-info"},Hh={class:"group-name"},Xh={class:"group-count"},Jh={class:"group-percentage"},Yh={key:1,class:"cache-stats-loading"};function Kh(n,e,a,t,r,i){return(t.modules||[]).length>0?(c(),d("div",fh,[e[18]||(e[18]=s("h2",{class:"stats-title"},"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",-1)),s("div",ph,[s("div",yh,[s("div",_h,[e[2]||(e[2]=s("div",{class:"overview-icon"},"üèÜ",-1)),s("div",bh,[s("div",wh,g(t.primaryModulesCount),1),e[0]||(e[0]=s("div",{class:"overview-label"},"–û—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[1]||(e[1]=s("div",{class:"overview-desc"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ",-1))])]),s("div",kh,[e[5]||(e[5]=s("div",{class:"overview-icon"},"üîß",-1)),s("div",Ch,[s("div",Sh,g(t.secondaryModulesCount),1),e[3]||(e[3]=s("div",{class:"overview-label"},"–ü–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[4]||(e[4]=s("div",{class:"overview-desc"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),s("div",Dh,[e[8]||(e[8]=s("div",{class:"overview-icon"},"üì¶",-1)),s("div",Th,[s("div",Ah,g(t.totalModules),1),e[6]||(e[6]=s("div",{class:"overview-label"},"–í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π",-1)),e[7]||(e[7]=s("div",{class:"overview-desc"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö",-1))])])])]),s("div",Eh,[s("div",Mh,[s("div",xh,[e[10]||(e[10]=s("div",{class:"stat-icon"},"üìÑ",-1)),s("div",Ih,[s("div",Lh,g(t.totalFiles),1),e[9]||(e[9]=s("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤",-1))])]),s("div",Ph,[e[12]||(e[12]=s("div",{class:"stat-icon"},"üíæ",-1)),s("div",Fh,[s("div",Uh,g(t.totalSizeFormatted),1),e[11]||(e[11]=s("div",{class:"stat-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä",-1))])]),s("div",Rh,[e[14]||(e[14]=s("div",{class:"stat-icon"},"‚è±Ô∏è",-1)),s("div",Oh,[s("div",Nh,g(t.avgTTL),1),e[13]||(e[13]=s("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–∏–π TTL",-1))])]),s("div",Bh,[e[16]||(e[16]=s("div",{class:"stat-icon"},"‚ö°",-1)),s("div",Vh,[s("div",$h,g(t.activeModules),1),e[15]||(e[15]=s("div",{class:"stat-label"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–µ—à–µ–π",-1))])])])]),t.secondaryModulesCount>0?(c(),d("div",jh,[e[17]||(e[17]=s("h3",{class:"distribution-title"},"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),s("div",zh,[(c(!0),d($,null,j(t.groupStats,o=>(c(),d("div",{key:o.type,class:"distribution-item"},[s("div",Wh,g(o.icon),1),s("div",qh,[s("div",Hh,g(o.title),1),s("div",Xh,g(o.count)+" –º–æ–¥—É–ª–µ–π",1)]),s("div",Jh,g(o.percentage)+"%",1)]))),128))])])):M("",!0)])):(c(),d("div",Yh,[...e[19]||(e[19]=[s("p",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])]))}const Gh=H(vh,[["render",Kh],["__scopeId","data-v-9fa190bb"]]),Qh={name:"CacheManagement",components:{CacheModuleCard:hh,CacheStats:Gh},setup(){const n=p([]),e=p([]),a=p(!0),t=p(null),r=D(()=>(n.value?.length||0)+(e.value?.length||0)),i=D(()=>{const k=o.value?.length||0,T=(l.value?.length||0)>0?1:0;return k+T}),o=D(()=>{const k=(n.value||[]).filter(T=>!T.id.includes("time-tracking"));return console.log("[CacheManagement] individualPrimaryModules:",k.length,k.map(T=>T.id)),k}),l=D(()=>{const k=(n.value||[]).filter(T=>T.id.includes("time-tracking")).sort((T,f)=>{const y=["time-tracking-default","time-tracking-detailed","time-tracking-summary"];return y.indexOf(T.id)-y.indexOf(f.id)});return console.log("[CacheManagement] timeTrackingModules:",k.length,k.map(T=>T.id)),k}),u=D(()=>{const k={};return(e.value||[]).forEach(f=>{const y=te.getModuleType(f.id);k[y]||(k[y]={type:y,title:v(y),modules:[]}),k[y].modules.push(f)}),Object.values(k).sort((f,y)=>{const E=["users","activity","webhooks","other"],O=E.indexOf(f.type),F=E.indexOf(y.type);return(O===-1?999:O)-(F===-1?999:F)})}),h=async()=>{a.value=!0,t.value=null;try{const k=[{id:"dashboard-sector-1c",name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",status:"active",file_count:5,total_size:1024e3,ttl:600,created_at:Math.floor(Date.now()/1e3)-7200,expires_at:Math.floor(Date.now()/1e3)+1800,cache_dir:"/var/cache/dashboard/sector-1c",metadata:{version:"1.0",module_id:"dashboard-sector-1c",module_name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",created_at:Math.floor(Date.now()/1e3)-7200,created_by:"system",creation_time_ms:1250,last_accessed_at:Math.floor(Date.now()/1e3)-300,access_count:45,expires_at:Math.floor(Date.now()/1e3)+1800,ttl_seconds:600,file_size_bytes:1024e3,compression_ratio:.75,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only"],limit:1e3},performance_metrics:{avg_response_time_ms:45,cache_hit_ratio:.92,data_freshness_score:.95}}},{id:"graph-state",name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",status:"active",file_count:3,total_size:512e3,ttl:3600,created_at:Math.floor(Date.now()/1e3)-10800,expires_at:Math.floor(Date.now()/1e3)+7200,cache_dir:"/var/cache/graphs/state",metadata:{version:"1.0",module_id:"graph-state",module_name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",created_at:Math.floor(Date.now()/1e3)-10800,created_by:"cron",creation_time_ms:890,last_accessed_at:Math.floor(Date.now()/1e3)-600,access_count:23,expires_at:Math.floor(Date.now()/1e3)+7200,ttl_seconds:3600,file_size_bytes:512e3,compression_ratio:.82,data_version:"2026.01.12.v2",source_params:{period:"months",sector_id:"all",filters:[],limit:500},performance_metrics:{avg_response_time_ms:32,cache_hit_ratio:.88,data_freshness_score:.91}}},{id:"graph-admission-closure-weeks",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",status:"active",file_count:8,total_size:2048e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-1800,expires_at:Math.floor(Date.now()/1e3)+120,cache_dir:"/var/cache/graphs/admission-closure/weeks",metadata:{version:"1.0",module_id:"graph-admission-closure-weeks",module_name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",created_at:Math.floor(Date.now()/1e3)-1800,created_by:"system",creation_time_ms:2100,last_accessed_at:Math.floor(Date.now()/1e3)-60,access_count:67,expires_at:Math.floor(Date.now()/1e3)+120,ttl_seconds:300,file_size_bytes:2048e3,compression_ratio:.68,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only","resolved_only"],limit:2e3},performance_metrics:{avg_response_time_ms:78,cache_hit_ratio:.95,data_freshness_score:.98}}},{id:"graph-admission-closure-months",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",status:"active",file_count:12,total_size:3072e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-3600,expires_at:Math.floor(Date.now()/1e3)+240,cache_dir:"/var/cache/graphs/admission-closure/months",metadata:{version:"1.0",module_id:"graph-admission-closure-months",module_name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",created_at:Math.floor(Date.now()/1e3)-3600,created_by:"cron",creation_time_ms:3400,last_accessed_at:Math.floor(Date.now()/1e3)-120,access_count:34,expires_at:Math.floor(Date.now()/1e3)+240,ttl_seconds:300,file_size_bytes:3072e3,compression_ratio:.71,data_version:"2026.01.12.v3",source_params:{period:"months",sector_id:"1c",filters:["active_only"],limit:3e3},performance_metrics:{avg_response_time_ms:92,cache_hit_ratio:.89,data_freshness_score:.93}}},{id:"time-tracking-default",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",status:"active",file_count:4,total_size:768e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-900,expires_at:Math.floor(Date.now()/1e3)+2100,cache_dir:"/var/cache/time-tracking/default",metadata:{version:"1.0",module_id:"time-tracking-default",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",created_at:Math.floor(Date.now()/1e3)-900,created_by:"system",creation_time_ms:560,last_accessed_at:Math.floor(Date.now()/1e3)-180,access_count:12,expires_at:Math.floor(Date.now()/1e3)+2100,ttl_seconds:300,file_size_bytes:768e3,compression_ratio:.79,data_version:"2026.01.12.v2",source_params:{period:"weeks",sector_id:"1c",filters:["active_only"],limit:800},performance_metrics:{avg_response_time_ms:28,cache_hit_ratio:.96,data_freshness_score:.97}}},{id:"time-tracking-detailed",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:6,total_size:1536e3,ttl:120,created_at:Math.floor(Date.now()/1e3)-600,expires_at:Math.floor(Date.now()/1e3)+3540,cache_dir:"/var/cache/time-tracking/detailed",metadata:{version:"1.0",module_id:"time-tracking-detailed",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",created_at:Math.floor(Date.now()/1e3)-600,created_by:"user",creation_time_ms:890,last_accessed_at:Math.floor(Date.now()/1e3)-90,access_count:8,expires_at:Math.floor(Date.now()/1e3)+3540,ttl_seconds:120,file_size_bytes:1536e3,compression_ratio:.74,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only","detailed_view"],limit:1500},performance_metrics:{avg_response_time_ms:45,cache_hit_ratio:.91,data_freshness_score:.94}}},{id:"time-tracking-summary",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:2,total_size:384e3,ttl:600,created_at:Math.floor(Date.now()/1e3)-1800,expires_at:Math.floor(Date.now()/1e3)+4200,cache_dir:"/var/cache/time-tracking/summary",metadata:{version:"1.0",module_id:"time-tracking-summary",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",created_at:Math.floor(Date.now()/1e3)-1800,created_by:"cron",creation_time_ms:340,last_accessed_at:Math.floor(Date.now()/1e3)-240,access_count:19,expires_at:Math.floor(Date.now()/1e3)+4200,ttl_seconds:600,file_size_bytes:384e3,compression_ratio:.85,data_version:"2026.01.12.v3",source_params:{period:"months",sector_id:"1c",filters:["summary_view"],limit:300},performance_metrics:{avg_response_time_ms:18,cache_hit_ratio:.98,data_freshness_score:.99}}},{id:"users-management-departments",name:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–æ—Ç–¥–µ–ª—ã)",status:"active",file_count:2,total_size:256e3,ttl:3600,created_at:Math.floor(Date.now()/1e3)-7200,expires_at:Math.floor(Date.now()/1e3)+28800,cache_dir:"/var/cache/users/departments"},{id:"webhook-logs-api",name:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ (API –∑–∞–ø—Ä–æ—Å—ã)",status:"active",file_count:15,total_size:512e4,ttl:300,created_at:Math.floor(Date.now()/1e3)-3600,expires_at:Math.floor(Date.now()/1e3)+2400,cache_dir:"/var/cache/webhooks/api"}],T=te.enrichModulesWithMetadata(k),f=te.categorizeAndSortModules(T);n.value=f.primaryModules||[],e.value=f.secondaryModules||[],console.log("[CacheManagement] Primary modules:",n.value.length,n.value.map(y=>({id:y.id,name:y.name}))),console.log("[CacheManagement] Secondary modules:",e.value.length,e.value.map(y=>({id:y.id,name:y.name})))}catch(k){console.error("[CacheManagement] Error loading modules:",k),t.value=k.message}finally{a.value=!1}},v=k=>{const T={users:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",activity:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",webhooks:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",other:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏"};return T[k]||T.other},m=async k=>{console.log(`[CacheManagement] Clearing module: ${k}`),await h()},C=async k=>{console.log(`[CacheManagement] Creating cache for: ${k.name} (${k.id})`),alert(`–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${k.name}
ID: ${k.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},A=async k=>{console.log(`[CacheManagement] Clearing cache for: ${k.name} (${k.id})`),alert(`–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${k.name}
ID: ${k.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},I=()=>{h()};return de(()=>{h()}),{primaryModules:n,secondaryModules:e,loading:a,error:t,totalModules:r,groupedSecondaryModules:u,individualPrimaryModules:o,timeTrackingModules:l,logicalPrimaryCount:i,handleModuleClear:m,handleCreateMock:C,handleClearMock:A,refreshModules:I}}},Zh={class:"cache-management"},ev={key:0,class:"header-section"},tv={class:"stats-bar"},sv={class:"stat-item"},av={class:"stat-item"},ov={class:"stat-item"},nv={class:"section-header"},rv={class:"section-meta"},iv={class:"module-count","aria-label":"{{ logicalPrimaryCount }} –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},lv={key:0,class:"modules-container"},cv={style:{background:"#f0f8ff",padding:"10px",margin:"10px 0",border:"1px solid #007bff","border-radius":"4px"}},dv={key:0,class:"modules-grid"},uv={key:1,class:"time-tracking-group"},gv={class:"modules-grid"},mv={key:1,class:"empty-state"},hv={key:2,class:"section-divider"},vv={key:3,class:"cache-section secondary-modules","aria-labelledby":"secondary-modules-heading"},fv={class:"section-header"},pv={class:"section-meta"},yv={class:"module-count","aria-label":"{{ (secondaryModules || []).length }} –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},_v={class:"grouped-modules"},bv={class:"group-header"},wv={class:"group-title"},kv={class:"group-badge secondary"},Cv={class:"modules-grid"},Sv={key:4,class:"error-message",role:"alert","aria-live":"assertive"},Dv={key:5,class:"loading-overlay",role:"status","aria-live":"polite","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"};function Tv(n,e,a,t,r,i){const o=W("CacheModuleCard");return c(),d("div",Zh,[!t.loading&&!t.error?(c(),d("div",ev,[e[5]||(e[5]=s("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1)),e[6]||(e[6]=s("p",{class:"description"}," –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º —Å–∏—Å—Ç–µ–º—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è ",-1)),s("div",tv,[s("span",sv,[s("strong",null,g(t.totalModules),1),e[2]||(e[2]=G(" –≤—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π ",-1))]),s("span",av,[s("strong",null,g(t.logicalPrimaryCount),1),e[3]||(e[3]=G(" –æ—Å–Ω–æ–≤–Ω—ã—Ö ",-1))]),s("span",ov,[s("strong",null,g((t.secondaryModules||[]).length),1),e[4]||(e[4]=G(" –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ",-1))])])])):M("",!0),!t.loading&&!t.error?(c(),d("section",{key:1,class:N(["cache-section primary-modules",{empty:(t.primaryModules||[]).length===0}]),"aria-labelledby":"primary-modules-heading"},[s("div",nv,[e[8]||(e[8]=s("h2",{id:"primary-modules-heading"},"üèÜ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),s("div",rv,[s("span",iv,g(t.logicalPrimaryCount),1),e[7]||(e[7]=s("span",{class:"section-badge primary",role:"status","aria-label":"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",-1))])]),e[16]||(e[16]=s("p",{class:"section-description"}," 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã: –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°, –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏–µ–º–∞-–∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°. ",-1)),(t.primaryModules||[]).length>0?(c(),d("div",lv,[s("div",cv,[s("strong",null,"DEBUG: Primary modules loaded: "+g(t.primaryModules.length),1),e[9]||(e[9]=s("br",null,null,-1)),s("strong",null,"Individual modules: "+g(t.individualPrimaryModules.length),1),e[10]||(e[10]=s("br",null,null,-1)),s("strong",null,"Time tracking modules: "+g(t.timeTrackingModules.length),1),e[11]||(e[11]=s("br",null,null,-1)),e[12]||(e[12]=s("strong",null,"IDs:",-1)),G(" "+g(t.primaryModules.map(l=>l.id).join(", ")),1)]),t.individualPrimaryModules.length>0?(c(),d("div",dv,[(c(!0),d($,null,j(t.individualPrimaryModules,l=>(c(),d("div",{key:l.id,class:"module-wrapper"},[J(o,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])):M("",!0),(t.timeTrackingModules||[]).length>0?(c(),d("div",uv,[e[13]||(e[13]=s("div",{class:"group-header"},[s("h3",{class:"group-title"},"‚è±Ô∏è –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"),s("span",{class:"group-badge"},"–û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞")],-1)),e[14]||(e[14]=s("p",{class:"group-description"},"–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),s("div",gv,[(c(!0),d($,null,j(t.timeTrackingModules,l=>(c(),d("div",{key:l.id,class:"module-wrapper"},[J(o,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])])):M("",!0)])):(c(),d("div",mv,[e[15]||(e[15]=s("p",null,"‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)),s("button",{onClick:e[0]||(e[0]=(...l)=>t.refreshModules&&t.refreshModules(...l)),class:"refresh-btn"},"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫")]))],2)):M("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("div",hv,[...e[17]||(e[17]=[tt('<div class="divider-line" data-v-02719b2e></div><div class="divider-content" data-v-02719b2e><span class="divider-icon" data-v-02719b2e>üîß</span><span class="divider-text" data-v-02719b2e>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏</span><span class="divider-subtitle" data-v-02719b2e>–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</span></div><div class="divider-line" data-v-02719b2e></div>',3)])])):M("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("section",vv,[s("div",fv,[e[19]||(e[19]=s("h2",{id:"secondary-modules-heading"},"üîß –ü–æ–±–æ—á–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),s("div",pv,[s("span",yv,g((t.secondaryModules||[]).length),1),e[18]||(e[18]=s("span",{class:"section-badge secondary",role:"status","aria-label":"–°–ª—É–∂–µ–±–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),e[20]||(e[20]=s("p",{class:"section-description"}," –ú–æ–¥—É–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã. ",-1)),s("div",_v,[(c(!0),d($,null,j(t.groupedSecondaryModules,l=>(c(),d("div",{key:l.type,class:N(["module-group",`group-${l.type}`])},[s("div",bv,[s("h3",wv,g(l.title),1),s("span",kv,g(l.modules.length),1)]),s("div",Cv,[(c(!0),d($,null,j(l.modules,u=>(c(),d("div",{key:u.id,class:"module-wrapper"},[J(o,{module:u,"is-primary":!1,"group-type":l.type,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","group-type","onClear","onRefresh"])]))),128))])],2))),128))])])):M("",!0),t.error?(c(),d("div",Sv,[e[21]||(e[21]=s("h3",null,"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞",-1)),s("p",null,g(t.error),1),s("button",{onClick:e[1]||(e[1]=(...l)=>n.loadModules&&n.loadModules(...l)),class:"retry-btn","aria-label":"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):M("",!0),t.loading?(c(),d("div",Dv,[...e[22]||(e[22]=[s("div",{class:"loading-spinner","aria-hidden":"true"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞...",-1)])])):M("",!0)])}const Av=H(Qh,[["render",Tv],["__scopeId","data-v-02719b2e"]]),Ev={name:"CacheManagementPage",components:{CacheManagement:Av},beforeCreate(){console.log("[CacheManagementPage] beforeCreate() called")},created(){console.log("[CacheManagementPage] created() called")},beforeMount(){console.log("[CacheManagementPage] beforeMount() called")},setup(){console.log("[CacheManagementPage] setup() called with new hierarchical UI");const n=Ye(),e=p(!1),a=p(null),t=()=>{n.push({name:"index"})};return de(()=>{console.log("[CacheManagementPage] onMounted() called - hierarchical cache management ready")}),{loading:e,error:a,goBack:t}}},Mv={class:"cache-management-page"},xv={class:"page-header"},Iv={class:"page-header-top"},Lv={key:0,class:"loading"},Pv={key:1,class:"error"},Fv={key:2,class:"cache-content"};function Uv(n,e,a,t,r,i){const o=W("CacheManagement");return c(),d("div",Mv,[s("div",xv,[s("div",Iv,[s("button",{onClick:e[0]||(e[0]=(...l)=>t.goBack&&t.goBack(...l)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[s("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),s("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=s("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1))]),t.loading?(c(),d("div",Lv," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–µ—à–∞... ")):t.error?(c(),d("div",Pv,g(t.error),1)):(c(),d("div",Fv,[J(o)]))])}const Rv=H(Ev,[["render",Uv],["__scopeId","data-v-a20ded38"]]),Ov=[{path:"/install",name:"install",component:ks},{path:"/",name:"index",component:Zs},{path:"/webhook-logs",name:"webhook-logs",redirect:"/admin/webhook-logs"},{path:"/admin/webhook-logs",name:"admin-webhook-logs",component:nr,meta:{requiresAuth:!0,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",adminOnly:!0}},{path:"/admin/users",name:"admin-users",component:Hg,meta:{requiresAuth:!0,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",adminOnly:!0}},{path:"/admin/cache",name:"admin-cache",component:Rv,meta:{requiresAuth:!0,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",adminOnly:!0}},{path:"/dashboard/sector-1c",name:"dashboard-sector-1c",component:()=>ve(()=>import("./DashboardSector1C.vue-DKspsb1P.js"),__vite__mapDeps([9,4,10,11,12,6,2,1,13,5]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector1c"}},{path:"/dashboard/graph-admission-closure",name:"dashboard-graph-admission-closure",component:()=>ve(()=>import("./GraphAdmissionClosureDashboard.vue-KTxjjqOg.js"),__vite__mapDeps([14,4,15,12,6,2,1,11,16,10,5]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–æ–≤—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",requiresAuth:!0,chunk:"admission-dashboard"}},{path:"/dashboard/graph-state",name:"dashboard-graph-state",component:()=>ve(()=>import("./GraphStateDashboard.vue-BL-vXA16.js"),__vite__mapDeps([17,4,1,13,12,6,2,11,10,15,5]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏",requiresAuth:!0,chunk:"graph-state"}},{path:"/dashboard/tickets-time-tracking",name:"dashboard-tickets-time-tracking",component:()=>ve(()=>import("./TicketsTimeTrackingDashboard.vue-CHHGCIex.js"),__vite__mapDeps([18,4,1,5,6,2]),import.meta.url),meta:{title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",requiresAuth:!0,chunk:"tickets-tracking"}}],st=es({history:ts(),routes:Ov});st.beforeEach(async(n,e,a)=>{if(console.log("[Router] beforeEach:",{to:n.path,from:e.path,name:n.name}),n.meta.title&&(document.title=`${n.meta.title} - Bitrix24 Dashboard`),n.meta.requiresAuth){console.log("[Router] requiresAuth check for:",n.path);try{const t=await Oe.checkAccess();if(!t.allowed){console.warn("Unauthorized access attempt to:",n.path,t.errorMessage),a({name:"index"});return}}catch(t){console.error("Error checking access in navigation guard:",t),a();return}}if(n.meta.adminOnly)try{const t=await Oe.getCurrentUser();if(!t||!Ft(t)){console.warn("Admin access required for:",n.path),a({name:"index"});return}}catch(t){console.error("Error checking admin access in navigation guard:",t),a({name:"index"});return}if(e.name!==null&&n.path!==e.path)try{if((await Oe.checkAccess()).allowed){const r=await Oe.getCurrentUser();r&&Qe.logPageVisit(n,r,e).catch(i=>{console.error("[Router] Error logging page visit:",i)})}}catch(t){console.error("[Router] Error in activity logging:",t)}if(n.name==="index"&&!e.name&&setTimeout(()=>{ve(()=>import("./DashboardSector1C.vue-DKspsb1P.js"),__vite__mapDeps([9,4,10,11,12,6,2,1,13,5]),import.meta.url)},1e3),n.meta.chunk)switch(n.meta.chunk){case"dashboard-sector1c":setTimeout(()=>{ve(()=>import("./dashboard-sector-1c-service-e577qKlQ.js"),__vite__mapDeps([16,12,6,2,1,11]),import.meta.url)},500);break;case"admission-dashboard":setTimeout(()=>{ve(()=>import("./chunk-BeqOLNMR.js").then(t=>t.l),__vite__mapDeps([2,1]),import.meta.url)},500);break}console.log("[Router] Allowing navigation to:",n.path),a()});setTimeout(()=>{const n=window.location.pathname,e=window.location.hash;e&&e!=="#/"||(n.includes("install.php")?st.replace("/install"):st.replace("/"))},0);Ue.register(ct,dt,St,Dt,Mt,Et,ut,gt,mt,Tt);Ue.defaults.responsive=!0;Ue.defaults.maintainAspectRatio=!1;Ue.defaults.plugins.legend.display=!0;Ue.defaults.plugins.legend.position="top";const Xv={primary:"#007bff",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8",carryover:"#ff9800",successLight:"#6cbf47",carryoverLight:"#ffb74d",carryoverDark:"#f57c00"};class et{static startBundleLoad(){this.metrics.bundleLoadTime=performance.now()}static endBundleLoad(e){const a=performance.now()-this.metrics.bundleLoadTime;this.metrics.chunkLoadTimes.set(e,a),console.log(`üì¶ Chunk "${e}" loaded in ${a.toFixed(2)}ms`),window.gtag&&window.gtag("event","bundle_load",{chunk_name:e,load_time:a}),a>1e3&&console.warn(`üêå Slow chunk load: ${e} took ${a.toFixed(2)}ms`)}static trackComponentLoad(e,a){const t=performance.now()-a;this.metrics.componentLoadTime.set(e,t),console.log(`üß© Component "${e}" loaded in ${t.toFixed(2)}ms`),t>500&&console.warn(`üêå Slow component load: ${e} took ${t.toFixed(2)}ms`)}static trackApiCall(e,a){this.metrics.apiResponseTime.set(e,a),a>1e3&&console.warn(`üêå Slow API call to ${e}: ${a}ms`)}static getReport(){const e=Array.from(this.metrics.componentLoadTime.values()),a=Array.from(this.metrics.apiResponseTime.values()),t=Array.from(this.metrics.chunkLoadTimes.values());return{totalChunks:this.metrics.chunkLoadTimes.size,totalComponents:this.metrics.componentLoadTime.size,totalApiCalls:this.metrics.apiResponseTime.size,averageComponentLoadTime:e.length>0?e.reduce((r,i)=>r+i,0)/e.length:0,averageApiResponseTime:a.length>0?a.reduce((r,i)=>r+i,0)/a.length:0,averageChunkLoadTime:t.length>0?t.reduce((r,i)=>r+i,0)/t.length:0,slowestComponents:Array.from(this.metrics.componentLoadTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i})),slowestApiCalls:Array.from(this.metrics.apiResponseTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({endpoint:r,time:i})),slowestChunks:Array.from(this.metrics.chunkLoadTimes.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i}))}}static clearMetrics(){this.metrics.bundleLoadTime=0,this.metrics.componentLoadTime.clear(),this.metrics.apiResponseTime.clear(),this.metrics.chunkLoadTimes.clear()}}Re(et,"metrics",{bundleLoadTime:0,componentLoadTime:new Map,apiResponseTime:new Map,chunkLoadTimes:new Map});class Nv{static init(){this.initChunkLoadErrorHandling(),this.initUnhandledErrorHandling(),this.initNetworkErrorHandling()}static initChunkLoadErrorHandling(){if(window.addEventListener("error",e=>{e.target.tagName==="SCRIPT"&&(console.error("‚ùå Chunk loading error:",e.target.src),this.reportError("chunk_load_error",{url:e.target.src,message:e.message||"Script load failed"}))}),"PerformanceObserver"in window)try{new PerformanceObserver(a=>{for(const t of a.getEntries())if(t.entryType==="resource"&&t.name.includes(".js")){const r=t.responseEnd-t.requestStart;et.trackApiCall(t.name,r)}}).observe({entryTypes:["resource"]})}catch{console.warn("PerformanceObserver not supported")}}static initUnhandledErrorHandling(){window.addEventListener("unhandledrejection",e=>{console.error("‚ùå Unhandled promise rejection:",e.reason),this.reportError("unhandled_rejection",{reason:e.reason?.message||String(e.reason),stack:e.reason?.stack})}),window.addEventListener("error",e=>{e.error&&e.filename&&(console.error("‚ùå Unhandled error:",e.error),this.reportError("unhandled_error",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error.stack}))})}static initNetworkErrorHandling(){const e=window.fetch;window.fetch=function(...a){const t=performance.now();return e.apply(this,a).then(r=>{const i=performance.now()-t;return et.trackApiCall(a[0],i),r.ok||console.warn(`üö® API error: ${r.status} ${r.statusText} for ${a[0]}`),r}).catch(r=>{const i=performance.now()-t;throw console.error(`‚ùå Network error for ${a[0]}:`,r),et.trackApiCall(a[0],i),this.reportError("network_error",{url:a[0],message:r.message,loadTime:i}),r})}}static reportError(e,a){const t={type:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...a};if(console.error("üìä Error report:",t),window.Sentry&&window.Sentry.captureException(new Error(`${e}: ${JSON.stringify(a)}`)),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:"/api/log-error.php",method:"POST",data:t})}catch(r){console.error("Failed to send error report to Bitrix24:",r)}window.gtag&&window.gtag("event","exception",{description:`${e}: ${a.message||"Unknown error"}`,fatal:!1})}static getErrorStats(){return{chunkLoadErrors:0,networkErrors:0,unhandledErrors:0,totalErrors:0}}}const pt=ss(is);pt.use(st);const Bv=n=>{try{const e=new WeakSet;return JSON.stringify(n,(a,t)=>{if(typeof t=="object"&&t!==null){if(e.has(t))return"[Circular]";e.add(t)}return typeof t=="function"||t===void 0?null:t})}catch{return String(n)}};pt.config.errorHandler=(n,e,a)=>{if(console.error("Vue error:",n,a),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:Ae("/api/log-error.php"),method:"POST",data:{error:n?.message||String(n),info:typeof a=="string"?a:Bv(a),component:e?.$options?.name||"Unknown"}})}catch(t){console.error("Failed to log error:",t)}};pt.mount("#app");Nv.init();export{Oe as A,Ze as C,Lt as L,It as S,H as _,Be as a,Pe as b,Xv as c,xe as d,ta as e,We as f,vt as g,Hv as h,Ft as i,ze as n,Ot as u};
