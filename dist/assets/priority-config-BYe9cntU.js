import{_ as V,g as B,c as i,a as g,d as A,b as f,t as _,l as T,o as b}from"./main-CQt2BzHV.js";const O={SECTOR_1C:366,SECTOR_HARDWARE:368,SECTOR_BITRIX24:369,SECTOR_PDM:367,KEEPER:1051},p=[O.SECTOR_1C,O.SECTOR_HARDWARE,O.SECTOR_BITRIX24,O.SECTOR_PDM];function Ct(t){return p.includes(t)}const U=140,y={FORMED:{name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",bitrixId:"DT140_12:UC_0VHWE2"},REVIEW:{name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",bitrixId:"DT140_12:PREPARATION"},EXECUTION:{name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",bitrixId:"DT140_12:CLIENT"}},Et={"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"},gt={formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"};function Tt(){return[y.FORMED.bitrixId,y.REVIEW.bitrixId,y.EXECUTION.bitrixId]}const F="https://bitrix24.kompo.by",z="servisdeskitotdel";function K(t){return`${F}/page/${z}/servisdesk/type/${U}/details/${t}/`}const l={TODAY:"today",YESTERDAY:"yesterday",THIS_WEEK:"this_week",LAST_WEEK:"last_week",MORE_THAN_TWO_WEEKS:"more_than_two_weeks",UP_TO_ONE_MONTH:"up_to_one_month",MORE_THAN_TWO_MONTHS:"more_than_two_months",MORE_THAN_HALF_YEAR:"more_than_half_year",MORE_THAN_YEAR:"more_than_year"},j={[l.TODAY]:{label:"–°–ï–ì–û–î–ù–Ø",color:"#28a745",backgroundColor:"#d4edda",textColor:"#155724"},[l.YESTERDAY]:{label:"–í–ß–ï–†–ê",color:"#20c997",backgroundColor:"#d1f2eb",textColor:"#0c5460"},[l.THIS_WEEK]:{label:"–ù–ê –≠–¢–û–ô –ù–ï–î–ï–õ–ï",color:"#17a2b8",backgroundColor:"#d1ecf1",textColor:"#0c5460"},[l.LAST_WEEK]:{label:"–ù–ê –ü–†–û–®–õ–û–ô –ù–ï–î–ï–õ–ï",color:"#ffc107",backgroundColor:"#fff3cd",textColor:"#856404"},[l.MORE_THAN_TWO_WEEKS]:{label:"–ë–û–õ–ï–ï –î–í–£–• –ù–ï–î–ï–õ–¨",color:"#fd7e14",backgroundColor:"#ffe5d0",textColor:"#7d3f00"},[l.UP_TO_ONE_MONTH]:{label:"–î–û 1 –ú–ï–°–Ø–¶–ê",color:"#dc3545",backgroundColor:"#f8d7da",textColor:"#721c24"},[l.MORE_THAN_TWO_MONTHS]:{label:"–ë–û–õ–ï–ï 2 –ú–ï–°–Ø–¶–ï–í",color:"#6c757d",backgroundColor:"#e2e3e5",textColor:"#383d41"},[l.MORE_THAN_HALF_YEAR]:{label:"–ë–û–õ–ï–ï –ü–û–õ–£–ì–û–î–ê",color:"#6c757d",backgroundColor:"#d6d8db",textColor:"#212529"},[l.MORE_THAN_YEAR]:{label:"–ë–û–õ–ï–ï –ì–û–î–ê",color:"#343a40",backgroundColor:"#c6c8ca",textColor:"#000000"}};function v(t){if(!t)return null;const e=String(t).trim();if(e.length===0)return null;try{const o=new Date(e);return isNaN(o.getTime())?(console.warn("Invalid date format:",t),null):o}catch(o){return console.error("Error parsing date:",t,o),null}}function N(t){if(!t)return"";let e;if(t instanceof Date?e=t:e=new Date(t),isNaN(e.getTime()))return"";const o=e.getDate(),r=e.getMonth()+1,c=e.getFullYear(),s=String(o).padStart(2,"0"),d=String(r).padStart(2,"0"),n=String(c);return`${s}.${d}.${n}`}function X(t,e=new Date){if(!t)return"";const o=t instanceof Date?t:new Date(t),r=e instanceof Date?e:new Date(e);if(isNaN(o.getTime())||isNaN(r.getTime()))return N(o);const c=new Date(o.getFullYear(),o.getMonth(),o.getDate()),d=new Date(r.getFullYear(),r.getMonth(),r.getDate())-c,n=Math.floor(d/(1e3*60*60*24));return n===0?"–°–µ–≥–æ–¥–Ω—è":N(o)}function G(t,e=new Date){if(!t)return l.MORE_THAN_YEAR;const o=t instanceof Date?t:new Date(t),r=e instanceof Date?e:new Date(e);if(isNaN(o.getTime())||isNaN(r.getTime()))return l.MORE_THAN_YEAR;const c=new Date(o.getFullYear(),o.getMonth(),o.getDate()),s=new Date(r.getFullYear(),r.getMonth(),r.getDate()),d=s-c;if(d<0)return l.TODAY;const n=Math.floor(d/(1e3*60*60*24)),R=Math.floor(n/7),C=Math.floor(n/30),I=Math.floor(n/365);if(n===0)return l.TODAY;if(n===1)return l.YESTERDAY;const u=new Date(s),k=s.getDay(),h=k===0?6:k-1;if(u.setDate(s.getDate()-h),u.setHours(0,0,0,0),c>=u&&n<7)return l.THIS_WEEK;const D=new Date(u);return D.setDate(u.getDate()-7),c>=D&&c<u?l.LAST_WEEK:R>=2&&C<1?l.MORE_THAN_TWO_WEEKS:C>=1&&C<2?l.UP_TO_ONE_MONTH:C>=2&&C<6?l.MORE_THAN_TWO_MONTHS:C>=6&&I<1?l.MORE_THAN_HALF_YEAR:l.MORE_THAN_YEAR}const q={name:"TicketCard",props:{ticket:{type:Object,required:!0},draggable:{type:Boolean,default:!0}},emits:["click","drag-start","drag-end"],setup(t,{emit:e}){const o=B(!1),r=i(()=>!1),c={color:"#ced4da",backgroundColor:"#f1f3f5",textColor:"#6c757d"},s={color:"#ced4da",backgroundColor:"#f8f9fa",textColor:"#6c757d"},d={color:"#dee2e6",backgroundColor:"#f8f9fa",textColor:"#6c757d"},n=i(()=>({label:t.ticket.priorityLabel||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",colors:t.ticket.priorityColors||c})),R=i(()=>n.value.label||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),C=i(()=>({color:n.value.colors.textColor||c.textColor,backgroundColor:n.value.colors.backgroundColor||c.backgroundColor,borderColor:n.value.colors.color||c.color})),I=i(()=>({borderLeftColor:n.value.colors.color||c.color})),u=i(()=>{const a=t.ticket.service||{};return{label:a.label||t.ticket.serviceLabel||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",colors:a.colors||t.ticket.serviceColors||s}}),k=i(()=>u.value.label||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),h=i(()=>({color:u.value.colors.textColor||s.textColor,backgroundColor:u.value.colors.backgroundColor||s.backgroundColor,borderColor:u.value.colors.color||s.color})),D=i(()=>{const a=t.ticket.actionStr||t.ticket.ufActionStr||null;if(!a)return null;const S=String(a).trim();return S.length>0?S:null}),Y=i(()=>({color:d.textColor,backgroundColor:d.backgroundColor,borderColor:d.color})),L=i(()=>{if(!t.ticket.createdAt)return"";const a=v(t.ticket.createdAt);return a?X(a):""}),m=i(()=>{if(!t.ticket.createdAt)return null;const a=v(t.ticket.createdAt);return G(a)}),x=i(()=>{const a=m.value;return a&&j[a]||null}),W=i(()=>{const a=x.value;return a?{color:a.textColor,backgroundColor:a.backgroundColor,borderColor:a.color,border:`1px solid ${a.color}`}:{}});return{handleDragStart:a=>{r.value&&(a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("application/json",JSON.stringify(t.ticket)),a.dataTransfer.setDragImage(a.target,0,0),o.value=!0,e("drag-start",t.ticket))},handleDragEnd:()=>{r.value&&(o.value=!1,e("drag-end"))},handleCardClick:a=>{if(o.value)return;const S=K(t.ticket.id);window.open(S,"_blank"),e("click",t.ticket)},isDragEnabled:r,priorityChipStyle:C,displayPriorityLabel:R,priorityBorderStyle:I,displayServiceLabel:k,serviceChipStyle:h,actionStrValue:D,actionChipStyle:Y,formattedCreatedDate:L,dateAccentCategory:m,dateAccentConfig:x,dateAccentStyle:W}}},J=["draggable"],Q={key:0,class:"ticket-department"},Z={class:"ticket-header"},$={class:"ticket-id"},tt={class:"ticket-title"},et={class:"ticket-meta"},rt={key:1,class:"ticket-action"},ot={key:2,class:"ticket-description"},at={class:"ticket-date-label"},nt={class:"ticket-date-value"};function ct(t,e,o,r,c,s){var d;return b(),g("div",{class:"ticket-card",draggable:r.isDragEnabled,style:T(r.priorityBorderStyle),onClick:e[0]||(e[0]=(...n)=>r.handleCardClick&&r.handleCardClick(...n)),onDragstart:e[1]||(e[1]=(...n)=>r.handleDragStart&&r.handleDragStart(...n)),onDragend:e[2]||(e[2]=(...n)=>r.handleDragEnd&&r.handleDragEnd(...n))},[o.ticket.departmentHead?(b(),g("div",Q,_(o.ticket.departmentHead),1)):A("",!0),f("div",Z,[e[3]||(e[3]=f("span",{class:"ticket-icon"},"üé´",-1)),f("span",$,"#"+_(o.ticket.id),1)]),f("div",tt,_(o.ticket.ufSubject||o.ticket.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),f("div",et,[f("span",{class:"ticket-priority",style:T(r.priorityChipStyle)},_(r.displayPriorityLabel),5),f("span",{class:"ticket-service",style:T(r.serviceChipStyle)},_(r.displayServiceLabel),5)]),r.actionStrValue?(b(),g("div",rt,[f("span",{class:"ticket-action-chip",style:T(r.actionChipStyle)},_(r.actionStrValue),5)])):A("",!0),o.ticket.description?(b(),g("div",ot,_(o.ticket.description),1)):A("",!0),r.formattedCreatedDate?(b(),g("div",{key:3,class:"ticket-created-date",style:T(r.dateAccentStyle)},[f("span",at,_(((d=r.dateAccentConfig)==null?void 0:d.label)||""),1),f("span",nt,_(r.formattedCreatedDate),1)],4)):A("",!0)],44,J)}const bt=V(q,[["render",ct],["__scopeId","data-v-9cda001c"]]);class kt{static getApiUrl(){const e=window.location.pathname;return e.substring(0,e.lastIndexOf("/"))+"/api/bitrix24.php"}static async call(e,o={}){try{const r=await fetch(this.getApiUrl(),{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({method:e,params:o})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const c=await r.json();if(c.error)throw new Error(c.error_description||c.error);return c}catch(r){throw console.error("Bitrix24 API error:",r),r}}static async getProfile(){return this.call("profile",{})}static async getLeads(e={},o=["ID","NAME","EMAIL","PHONE"],r={ID:"DESC"}){return(await this.call("crm.lead.list",{filter:e,select:o,order:r})).result||[]}}function M(t){return t==null?null:String(t).trim().toLowerCase()||null}const w=[{id:"general",label:"–ì–µ–Ω–µ—Ä–∞–ª—å—Å–∫–∏–π",bitrixValue:"–ì–µ–Ω–µ—Ä–∞–ª—å—Å–∫–∏–π",color:"#6f42c1",backgroundColor:"#f4edfd",textColor:"#3a275f",order:1,description:"–í—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–≥–µ–Ω–µ—Ä–∞–ª—å—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å)"},{id:"external",label:"–í–Ω–µ—à–Ω–∏–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞",bitrixValue:"–í–Ω–µ—à–Ω–∏–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞",color:"#d63384",backgroundColor:"#fce8f3",textColor:"#8a1c56",order:2,description:"–í–Ω–µ—à–Ω–∏–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞/–±–ª–æ–∫–µ—Ä—ã"},{id:"board",label:"–ó–∞–¥–∞—á–∏ –ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Å–æ–≤–µ—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤",bitrixValue:"–ó–∞–¥–∞—á–∏ –ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Å–æ–≤–µ—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤",color:"#0d6efd",backgroundColor:"#e7f1ff",textColor:"#0a58ca",order:3,description:"–ó–∞–¥–∞—á–∏ –ø—Ä–∞–≤–ª–µ–Ω–∏—è / —Å–æ–≤–µ—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤"},{id:"errors",label:"–û—à–∏–±–∫–∏/—Å–±–æ–∏",bitrixValue:"–û—à–∏–±–∫–∏/—Å–±–æ–∏",color:"#dc3545",backgroundColor:"#fdecef",textColor:"#8c1b29",order:4,description:"–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã, –æ—à–∏–±–∫–∏ –∏ —Å–±–æ–∏"},{id:"operations",label:"–¢–µ–∫—É—â–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å",bitrixValue:"–¢–µ–∫—É—â–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å",color:"#6c757d",backgroundColor:"#f1f3f5",textColor:"#343a40",order:5,description:"–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å"},{id:"projects",label:"–ü—Ä–æ–µ–∫—Ç—ã",bitrixValue:"–ü—Ä–æ–µ–∫—Ç—ã",color:"#198754",backgroundColor:"#e9f6ef",textColor:"#0f5132",order:6,description:"–ü—Ä–æ–µ–∫—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏"},{id:"optimization",label:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è",bitrixValue:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è",color:"#ffc107",backgroundColor:"#fff8e1",textColor:"#8c6d1f",order:7,description:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è"}],E={id:"unknown",label:"–ù–µ —É–∫–∞–∑–∞–Ω–æ",bitrixValue:null,color:"#ced4da",backgroundColor:"#f1f3f5",textColor:"#6c757d",order:99,description:"Fallback –¥–ª—è –ø—É—Å—Ç—ã—Ö/–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π"},Dt=E.id,H={},P={};[...w,E].forEach(t=>{H[t.id]=t;const e=M(t.bitrixValue);e&&(P[e]=t)});function lt(t){if(!t)return E;const e=String(t).trim();return H[e]||E}function it(t){const e=M(t);if(!e)return E;const o=P[e];return o||E}function st(){return[...w,E].sort((t,e)=>t.order-e.order)}function St(t){if(t&&typeof t=="object"&&t.color)return{color:t.color,backgroundColor:t.backgroundColor,textColor:t.textColor};const e=lt(t)||it(t)||E;return{color:e.color,backgroundColor:e.backgroundColor,textColor:e.textColor}}st();export{kt as B,Dt as D,U as E,y as S,bt as T,St as a,lt as b,K as c,gt as d,O as e,l as f,it as g,j as h,Ct as i,G as j,Tt as k,Et as l};
