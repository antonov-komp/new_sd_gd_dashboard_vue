const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./chunk-rKmNpCr3.js","./chunk-IDUYkvJI.js","./chunk-BTnG7_Rn.js","./chunk-Bwkg0lDb.js","./chunk-B5yqeUNo.js","./chunk-DVSMqPZp.js","./chunk-DLgBCjTL.js","./chunk-UTsEWqhV.js","./graph-state-components-q2unGHzB.css","./dashboard-components-cU3ZvHcC.css","./GraphAdmissionClosureDashboard.vue-DnAojWG5.js","./dashboard-sector-1c-service-DzGLFJL1.js","./chunk-Ch9Gh45J.js","./pages-cdIqBUQj.css","./GraphAdmissionClosureDashboard-Fwc1aneR.css","./TicketsTimeTrackingDashboard.vue-DHC9hBNs.js","./TicketsTimeTrackingDashboard-CHSHrzo1.css"])))=>i.map(i=>d[i]);
var re=Object.defineProperty;var oe=(s,e,r)=>e in s?re(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var M=(s,e,r)=>oe(s,typeof e!="symbol"?e+"":e,r);import{e as I,a as u,o as c,j as se,b as m,a1 as ne,t as h,i as ie,d as a,g as k,r as p,l as B,k as R,u as w,F as N,f as O,h as ae,c as y,y as le,a2 as ce,a3 as de,a4 as ue}from"./chunk-IDUYkvJI.js";import{_ as L,B as U,A,q as ge,r as x}from"./chunk-rKmNpCr3.js";import{b as $,g as q,_}from"./chunk-B5yqeUNo.js";import{L as F}from"./chunk-DVSMqPZp.js";import{a as j}from"./chunk-DLgBCjTL.js";import{W as me,U as pe,C as fe}from"./chunk-Ch9Gh45J.js";import"./chunk-BTnG7_Rn.js";import"./chunk-Bwkg0lDb.js";import"./chunk-UTsEWqhV.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const he={name:"App"},_e={id:"app"};function ve(s,e,r,t,o,n){const l=I("router-view");return c(),u("div",_e,[se(l)])}const ye=L(he,[["render",ve]]),we={name:"StatusMessage",props:{type:{type:String,required:!0,validator:s=>["success","error","info","warning"].includes(s)},title:{type:String,default:null},message:{type:String,default:null}}},Ae={key:0},ke={key:1};function Ie(s,e,r,t,o,n){return c(),u("div",{class:ie(["status-message",`status-message--${r.type}`])},[r.title?(c(),u("strong",Ae,h(r.title),1)):m("",!0),r.message?(c(),u("p",ke,h(r.message),1)):m("",!0),ne(s.$slots,"default",{},void 0)],2)}const V=L(we,[["render",Ie],["__scopeId","data-v-7f15d2d7"]]),Ee={name:"InstallPage",components:{StatusMessage:V,LoadingSpinner:F},setup(){const s=p(!0),e=p(null),r=p(null);return B(async()=>{try{let t=null;if(window.INSTALL_RESULT)t=window.INSTALL_RESULT;else{const o=$("/install.php"),n=await fetch(`${o}?get_result=1`);n.ok&&(t=await n.json())}if(!t)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏");if(r.value=t,t.rest_only===!1)if(t.install===!0){e.value={type:"success",title:"‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!",message:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24."};try{await U.init(()=>{U.installFinish()})}catch(o){console.error("Error finishing installation:",o)}}else e.value={type:"error",title:"‚úó –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."};else e.value={type:"info",title:"REST-only —Ä–µ–∂–∏–º",message:"–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ REST API, –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."}}catch(t){console.error("Error loading install result:",t),e.value={type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ."}}finally{s.value=!1}}),{loading:s,installStatus:e,installInfo:r}}},Se={class:"install-page"},be={class:"container"},Le={key:1,class:"info"};function Te(s,e,r,t,o,n){const l=I("StatusMessage"),v=I("LoadingSpinner");return c(),u("div",Se,[a("div",be,[e[1]||(e[1]=a("h1",null,"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1)),t.installStatus?(c(),k(l,{key:0,type:t.installStatus.type,title:t.installStatus.title,message:t.installStatus.message},null,8,["type","title","message"])):m("",!0),t.installInfo?(c(),u("div",Le,[e[0]||(e[0]=a("h3",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:",-1)),a("pre",null,h(JSON.stringify(t.installInfo,null,2)),1)])):m("",!0),t.loading?(c(),k(v,{key:2,message:"–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."})):m("",!0)])])}const Pe=L(Ee,[["render",Te],["__scopeId","data-v-d082ec9e"]]);class E{static async logAppEntry(e,r=null){if(!e||!e.ID)return console.warn("[ActivityLoggingService] Invalid user object for app entry logging"),!1;const t={timestamp:new Date().toISOString(),type:"app_entry",user_id:e.ID,user_name:this.getUserName(e),user_email:e.EMAIL||null,ip:r||this.getClientIp(),user_agent:navigator.userAgent,session_id:this.getSessionId()};return await this.saveLog(t)}static async logPageVisit(e,r,t=null){if(!r||!r.ID)return console.warn("[ActivityLoggingService] Invalid user object for page visit logging"),!1;if(!e||!e.path)return console.warn("[ActivityLoggingService] Invalid route object for page visit logging"),!1;const o={timestamp:new Date().toISOString(),type:"page_visit",user_id:r.ID,user_name:this.getUserName(r),route_path:e.path,route_name:e.name||null,route_title:e.meta?.title||null,from_path:t?.path||null,from_name:t?.name||null,session_id:this.getSessionId()};return await this.saveLog(o)}static async saveLog(e){try{const r=q("/api/user-activity-log.php"),t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)});if(!t.ok){const n=await t.text();return console.error("[ActivityLoggingService] Failed to save log:",{status:t.status,statusText:t.statusText,error:n}),!1}const o=await t.json();return o.success?!0:(console.error("[ActivityLoggingService] API returned error:",o.error),!1)}catch(r){return r.name==="AbortError"?console.warn("[ActivityLoggingService] Request timeout (activity logging skipped)"):console.error("[ActivityLoggingService] Error saving log:",r),!1}}static getSessionId(){const e="activity_session_id";if(sessionStorage.getItem(e))return sessionStorage.getItem(e);const r=this.generateSessionId();return sessionStorage.setItem(e,r),r}static generateSessionId(){const e=Date.now(),r=Math.random().toString(36).substring(2,11);return`${e}-${r}`}static getUserName(e){const r=e.NAME||"",t=e.LAST_NAME||"";return`${r} ${t}`.trim()||e.EMAIL||`User #${e.ID}`}static getClientIp(){return null}static isAppEntryLogged(){return sessionStorage.getItem("app_entry_logged")==="true"}static markAppEntryLogged(){sessionStorage.setItem("app_entry_logged","true")}}const xe={reports:[{id:1,title:"–û—Ç—á—ë—Ç –ø–æ —Ç–∏–∫–µ—Ç–∞–º",icon:"üìä",route:"/reports/tickets",description:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º",active:!1},{id:2,title:"–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",icon:"üìà",route:"/reports/performance",description:"–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞",active:!1},{id:3,title:"–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º",icon:"üìâ",route:"/reports/deadlines",description:"–ê–Ω–∞–ª–∏–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á",active:!1},{id:4,title:"–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç",icon:"üìã",route:"/reports/summary",description:"–û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",active:!1},{id:5,title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",route:"/dashboard/sector-1c",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0},{id:6,title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",icon:"üìä",route:"/dashboard/graph-state",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–° –≤–æ –≤—Ä–µ–º–µ–Ω–∏",active:!0,category:"analytics",order:6},{id:7,title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–°",icon:"üìà",route:"/dashboard/graph-admission-closure",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0,category:"analytics",order:7},{id:8,title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"‚è±",route:"/dashboard/tickets-time-tracking",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",active:!0,category:"analytics",order:8}]};function Ce(){return xe.reports.filter(s=>s.active===!0)}const De={adminInterfaces:[{id:1,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"üë•",route:"/admin/users",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"},{id:2,title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã",icon:"‚öôÔ∏è",route:"/admin/settings",description:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:3,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",icon:"üìã",route:"/admin/webhook-logs",description:"–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤"},{id:4,title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",icon:"üìä",route:"/admin/usage-stats",description:"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:5,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",icon:"üóëÔ∏è",route:"/admin/cache",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –º–æ–¥—É–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"}]};function Me(){return[...De.adminInterfaces]}const Re={name:"IndexPage",components:{StatusMessage:V,LoadingSpinner:F},beforeCreate(){console.log("[IndexPage] beforeCreate() called")},created(){console.log("[IndexPage] created() called")},beforeMount(){console.log("[IndexPage] beforeMount() called")},setup(){console.log("[IndexPage] setup() called");const s=le(),e=p(!0),r=p(null),t=p(!1),o=p(!1),n=p(""),l=p(null),v=p(null),d=p(!1);console.log("[IndexPage] Initial state:",{loading:e.value,accessAllowed:t.value,accessDenied:o.value});const T=p(Ce()),P=p(!1),H=p(Me()),X=y(()=>l.value?j(l.value):!1),z=y(()=>{if(!l.value)return"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";const i=l.value.FIRST_NAME?l.value.FIRST_NAME.trim():"",f=l.value.LAST_NAME?l.value.LAST_NAME.trim():"",g=l.value.NAME?l.value.NAME.trim():"";return i&&f?`${i} ${f}`:g&&f&&g!==f?`${g} ${f}`:i&&g&&i!==g?`${i} ${g}`:g&&g.includes(" ")?g:i||f||g||`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${l.value.ID}`}),W=y(()=>r.value?r.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ":"–û—à–∏–±–∫–∞ API":null),J=y(()=>r.value?r.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É.":r.value:null),K=y(()=>r.value&&r.value.includes("no_install_app")),G=y(()=>$("/install.php"));B(async()=>{console.log("[IndexPage] onMounted() called");try{console.log("[IndexPage] Calling AccessControlService.checkAccess()...");const i=await A.checkAccess();if(console.log("[IndexPage] Access result:",{allowed:i.allowed,hasUser:!!i.user,user:i.user,errorCode:i.errorCode,errorMessage:i.errorMessage}),i.allowed){if(console.log("[IndexPage] Setting accessAllowed to true"),t.value=!0,l.value=i.user,console.log("[IndexPage] Access allowed, setting state:",{accessAllowed:t.value,hasUser:!!l.value,loading:e.value,accessDenied:o.value}),!E.isAppEntryLogged())try{i.user&&await E.logAppEntry(i.user)&&E.markAppEntryLogged()}catch(f){console.error("[IndexPage] Error logging app entry:",f)}}else{o.value=!0;const f=ge(),g=!f&&i.errorCode===x.ACCESS_DENIED&&i.errorMessage&&i.errorMessage.includes("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø");if(console.log("IndexPage - accessResult:",{errorCode:i.errorCode,errorMessage:i.errorMessage,isInsideB24:f,isDirectAccessDeniedCheck:g}),d.value=g,g&&(n.value=i.errorMessage,console.log("IndexPage - Set direct access denied message:",i.errorMessage)),console.log("IndexPage - State after check:",{accessDenied:o.value,isDirectAccessDenied:d.value,accessErrorMessage:n.value}),!g){if(i.user){const{getAllowedDepartmentIds:Z}=await _(async()=>{const{getAllowedDepartmentIds:ee}=await import("./chunk-DLgBCjTL.js").then(te=>te.c);return{getAllowedDepartmentIds:ee}},[],import.meta.url);v.value={userId:i.user.ID,departmentIds:i.user.UF_DEPARTMENT||[],allowedIds:Z()}}i.errorCode===x.USER_NOT_DETERMINED?n.value="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.":i.errorCode===x.ACCESS_DENIED?n.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω":n.value=i.errorMessage||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."}}}catch(i){r.value=i.message,console.error("Error checking access:",i)}finally{e.value=!1,console.log("[IndexPage] Final state:",{loading:e.value,accessAllowed:t.value,accessDenied:o.value,hasUser:!!l.value,error:r.value})}});const Q=i=>{if(!i){console.error("Route is not defined for report");return}s.push(i)},Y=()=>{P.value=!0},D=()=>{P.value=!1};return{loading:e,error:r,accessAllowed:t,accessDenied:o,accessErrorMessage:n,currentUser:l,userName:z,debugInfo:v,isDirectAccessDenied:d,errorTitle:W,errorMessage:J,showInstallLink:K,installPageUrl:G,reportsButtons:T,navigateToReport:Q,isAdmin:X,showAdminPopup:P,adminButtons:H,openAdminPopup:Y,closeAdminPopup:D,navigateToAdmin:i=>{if(!i){console.error("Route is not defined for admin interface");return}s.push(i),D()}}}},Ne={class:"index-page"},Oe={class:"container"},Ue={key:0,class:"install-link"},Be=["href"],$e={key:0,class:"direct-access-denied-info",style:{"margin-top":"15px",padding:"15px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px"}},qe={key:1,class:"debug-info",style:{"margin-top":"15px",padding:"10px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px","font-size":"12px"}},Fe={key:3,class:"main-content"},je={class:"greeting-section"},Ve={class:"greeting-header"},He={class:"greeting-header-content"},Xe={class:"greeting-text"},ze={class:"reports-section"},We={class:"reports-grid"},Je=["onClick"],Ke={class:"report-icon"},Ge={class:"report-title"},Qe={key:0,class:"report-description"},Ye={class:"admin-popup-header"},Ze={class:"admin-popup-content"},et={class:"admin-buttons-grid"},tt=["onClick"],rt={class:"admin-icon"},ot={class:"admin-title"},st={key:0,class:"admin-description"};function nt(s,e,r,t,o,n){const l=I("StatusMessage"),v=I("LoadingSpinner");return c(),u("div",Ne,[a("div",Oe,[t.error?(c(),k(l,{key:0,type:"error",title:t.errorTitle,message:t.errorMessage},{default:R(()=>[t.showInstallLink?(c(),u("div",Ue,[a("a",{href:t.installPageUrl},"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",8,Be)])):m("",!0)]),_:1},8,["title","message"])):m("",!0),t.loading?(c(),k(v,{key:1,message:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞..."})):m("",!0),!t.loading&&t.accessDenied?(c(),k(l,{key:2,type:"error",title:"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",message:t.accessErrorMessage},{default:R(()=>[t.isDirectAccessDenied?(c(),u("div",$e,[...e[4]||(e[4]=[a("p",{style:{margin:"0 0 10px 0","font-weight":"600",color:"#856404"}},[a("strong",null,"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")],-1),a("ol",{style:{margin:"0","padding-left":"20px",color:"#856404"}},[a("li",null,"–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24"),a("li",null,"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Bitrix24 (placement, –≤–∏–¥–∂–µ—Ç –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É)")],-1)])])):t.debugInfo?(c(),u("div",qe,[e[5]||(e[5]=a("strong",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e[6]||(e[6]=a("br",null,null,-1)),w(" ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+h(t.debugInfo.userId),1),e[7]||(e[7]=a("br",null,null,-1)),w(" ID –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+h(t.debugInfo.departmentIds),1),e[8]||(e[8]=a("br",null,null,-1)),w(" –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ID –æ—Ç–¥–µ–ª–æ–≤: "+h(t.debugInfo.allowedIds),1),e[9]||(e[9]=a("br",null,null,-1)),e[10]||(e[10]=a("small",{style:{color:"#856404"}},"–î–æ–±–∞–≤—å—Ç–µ ID –æ—Ç–¥–µ–ª–∞ –≤ —Ñ–∞–π–ª vue-app/src/config/access-config.js",-1))])):m("",!0)]),_:1},8,["message"])):m("",!0),!t.loading&&!t.accessDenied&&t.accessAllowed?(c(),u("div",Fe,[a("div",je,[a("div",Ve,[a("div",He,[e[13]||(e[13]=a("h2",{class:"greeting-title"},"–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ò–¢ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –ü–ª–∞–Ω–µ—Ä–∫–∏ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ü–∏–∏",-1)),a("p",Xe,[e[11]||(e[11]=w(" –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",-1)),a("strong",null,h(t.userName),1),e[12]||(e[12]=w("! ",-1))])]),t.isAdmin?(c(),u("button",{key:0,class:"admin-button-header",onClick:e[0]||(e[0]=(...d)=>t.openAdminPopup&&t.openAdminPopup(...d)),title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"}," ‚öôÔ∏è ")):m("",!0)])]),a("div",ze,[a("div",We,[(c(!0),u(N,null,O(t.reportsButtons,d=>(c(),u("div",{key:d.id,class:"report-button",onClick:T=>t.navigateToReport(d.route)},[a("div",Ke,h(d.icon),1),a("div",Ge,h(d.title),1),d.description?(c(),u("div",Qe,h(d.description),1)):m("",!0)],8,Je))),128))])]),t.showAdminPopup&&t.isAdmin?(c(),u("div",{key:0,class:"admin-popup-overlay",onClick:e[3]||(e[3]=(...d)=>t.closeAdminPopup&&t.closeAdminPopup(...d))},[a("div",{class:"admin-popup",onClick:e[2]||(e[2]=ae(()=>{},["stop"]))},[a("div",Ye,[e[14]||(e[14]=a("h3",{class:"admin-popup-title"},"‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",-1)),a("button",{class:"admin-popup-close",onClick:e[1]||(e[1]=(...d)=>t.closeAdminPopup&&t.closeAdminPopup(...d))}," ‚úï ")]),a("div",Ze,[a("div",et,[(c(!0),u(N,null,O(t.adminButtons,d=>(c(),u("div",{key:d.id,class:"admin-interface-button",onClick:T=>t.navigateToAdmin(d.route)},[a("div",rt,h(d.icon),1),a("div",ot,h(d.title),1),d.description?(c(),u("div",st,h(d.description),1)):m("",!0)],8,tt))),128))])])])])):m("",!0)])):m("",!0)])])}const it=L(Re,[["render",nt],["__scopeId","data-v-6cc28966"]]),at=[{path:"/install",name:"install",component:Pe},{path:"/",name:"index",component:it},{path:"/webhook-logs",name:"webhook-logs",redirect:"/admin/webhook-logs"},{path:"/admin/webhook-logs",name:"admin-webhook-logs",component:me,meta:{requiresAuth:!0,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",adminOnly:!0}},{path:"/admin/users",name:"admin-users",component:pe,meta:{requiresAuth:!0,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",adminOnly:!0}},{path:"/admin/cache",name:"admin-cache",component:fe,meta:{requiresAuth:!0,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",adminOnly:!0}},{path:"/dashboard/sector-1c",name:"dashboard-sector-1c",component:()=>_(()=>import("./chunk-rKmNpCr3.js").then(s=>s.s),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector1c"}},{path:"/dashboard/graph-admission-closure",name:"dashboard-graph-admission-closure",component:()=>_(()=>import("./GraphAdmissionClosureDashboard.vue-DnAojWG5.js"),__vite__mapDeps([10,1,5,3,4,0,2,6,7,9,8,11,12,13,14]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–æ–≤—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",requiresAuth:!0,chunk:"admission-dashboard"}},{path:"/dashboard/graph-state",name:"dashboard-graph-state",component:()=>_(()=>import("./chunk-DVSMqPZp.js").then(s=>s.G),__vite__mapDeps([5,1,3,4,0,2,6,7,9,8]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏",requiresAuth:!0,chunk:"graph-state"}},{path:"/dashboard/tickets-time-tracking",name:"dashboard-tickets-time-tracking",component:()=>_(()=>import("./TicketsTimeTrackingDashboard.vue-DHC9hBNs.js"),__vite__mapDeps([15,1,4,0,2,3,5,6,7,8,9,16]),import.meta.url),meta:{title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",requiresAuth:!0,chunk:"tickets-tracking"}}],b=ce({history:de(),routes:at});b.beforeEach(async(s,e,r)=>{if(console.log("[Router] beforeEach:",{to:s.path,from:e.path,name:s.name}),s.meta.title&&(document.title=`${s.meta.title} - Bitrix24 Dashboard`),s.meta.requiresAuth){console.log("[Router] requiresAuth check for:",s.path);try{const t=await A.checkAccess();if(!t.allowed){console.warn("Unauthorized access attempt to:",s.path,t.errorMessage),r({name:"index"});return}}catch(t){console.error("Error checking access in navigation guard:",t),r();return}}if(s.meta.adminOnly)try{const t=await A.getCurrentUser();if(!t||!j(t)){console.warn("Admin access required for:",s.path),r({name:"index"});return}}catch(t){console.error("Error checking admin access in navigation guard:",t),r({name:"index"});return}if(e.name!==null&&s.path!==e.path)try{if((await A.checkAccess()).allowed){const o=await A.getCurrentUser();o&&E.logPageVisit(s,o,e).catch(n=>{console.error("[Router] Error logging page visit:",n)})}}catch(t){console.error("[Router] Error in activity logging:",t)}if(s.name==="index"&&!e.name&&setTimeout(()=>{_(()=>import("./chunk-rKmNpCr3.js").then(t=>t.s),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url)},1e3),s.meta.chunk)switch(s.meta.chunk){case"dashboard-sector1c":setTimeout(()=>{_(()=>import("./dashboard-sector-1c-service-DzGLFJL1.js"),__vite__mapDeps([11,7,4,2,1,0,6,9,3,5,8]),import.meta.url)},500);break;case"admission-dashboard":setTimeout(()=>{_(()=>import("./chunk-BTnG7_Rn.js").then(t=>t.p),__vite__mapDeps([2,1,0,6,7,4,9,3,5,8]),import.meta.url)},500);break}console.log("[Router] Allowing navigation to:",s.path),r()});setTimeout(()=>{const s=window.location.pathname,e=window.location.hash;e&&e!=="#/"||(s.includes("install.php")?b.replace("/install"):b.replace("/"))},0);class S{static startBundleLoad(){this.metrics.bundleLoadTime=performance.now()}static endBundleLoad(e){const r=performance.now()-this.metrics.bundleLoadTime;this.metrics.chunkLoadTimes.set(e,r),console.log(`üì¶ Chunk "${e}" loaded in ${r.toFixed(2)}ms`),window.gtag&&window.gtag("event","bundle_load",{chunk_name:e,load_time:r}),r>1e3&&console.warn(`üêå Slow chunk load: ${e} took ${r.toFixed(2)}ms`)}static trackComponentLoad(e,r){const t=performance.now()-r;this.metrics.componentLoadTime.set(e,t),console.log(`üß© Component "${e}" loaded in ${t.toFixed(2)}ms`),t>500&&console.warn(`üêå Slow component load: ${e} took ${t.toFixed(2)}ms`)}static trackApiCall(e,r){this.metrics.apiResponseTime.set(e,r),r>1e3&&console.warn(`üêå Slow API call to ${e}: ${r}ms`)}static getReport(){const e=Array.from(this.metrics.componentLoadTime.values()),r=Array.from(this.metrics.apiResponseTime.values()),t=Array.from(this.metrics.chunkLoadTimes.values());return{totalChunks:this.metrics.chunkLoadTimes.size,totalComponents:this.metrics.componentLoadTime.size,totalApiCalls:this.metrics.apiResponseTime.size,averageComponentLoadTime:e.length>0?e.reduce((o,n)=>o+n,0)/e.length:0,averageApiResponseTime:r.length>0?r.reduce((o,n)=>o+n,0)/r.length:0,averageChunkLoadTime:t.length>0?t.reduce((o,n)=>o+n,0)/t.length:0,slowestComponents:Array.from(this.metrics.componentLoadTime.entries()).sort(([,o],[,n])=>n-o).slice(0,5).map(([o,n])=>({name:o,time:n})),slowestApiCalls:Array.from(this.metrics.apiResponseTime.entries()).sort(([,o],[,n])=>n-o).slice(0,5).map(([o,n])=>({endpoint:o,time:n})),slowestChunks:Array.from(this.metrics.chunkLoadTimes.entries()).sort(([,o],[,n])=>n-o).slice(0,5).map(([o,n])=>({name:o,time:n}))}}static clearMetrics(){this.metrics.bundleLoadTime=0,this.metrics.componentLoadTime.clear(),this.metrics.apiResponseTime.clear(),this.metrics.chunkLoadTimes.clear()}}M(S,"metrics",{bundleLoadTime:0,componentLoadTime:new Map,apiResponseTime:new Map,chunkLoadTimes:new Map});class lt{static init(){this.initChunkLoadErrorHandling(),this.initUnhandledErrorHandling(),this.initNetworkErrorHandling()}static initChunkLoadErrorHandling(){if(window.addEventListener("error",e=>{e.target.tagName==="SCRIPT"&&(console.error("‚ùå Chunk loading error:",e.target.src),this.reportError("chunk_load_error",{url:e.target.src,message:e.message||"Script load failed"}))}),"PerformanceObserver"in window)try{new PerformanceObserver(r=>{for(const t of r.getEntries())if(t.entryType==="resource"&&t.name.includes(".js")){const o=t.responseEnd-t.requestStart;S.trackApiCall(t.name,o)}}).observe({entryTypes:["resource"]})}catch{console.warn("PerformanceObserver not supported")}}static initUnhandledErrorHandling(){window.addEventListener("unhandledrejection",e=>{console.error("‚ùå Unhandled promise rejection:",e.reason),this.reportError("unhandled_rejection",{reason:e.reason?.message||String(e.reason),stack:e.reason?.stack})}),window.addEventListener("error",e=>{e.error&&e.filename&&(console.error("‚ùå Unhandled error:",e.error),this.reportError("unhandled_error",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error.stack}))})}static initNetworkErrorHandling(){const e=window.fetch;window.fetch=function(...r){const t=performance.now();return e.apply(this,r).then(o=>{const n=performance.now()-t;return S.trackApiCall(r[0],n),o.ok||console.warn(`üö® API error: ${o.status} ${o.statusText} for ${r[0]}`),o}).catch(o=>{const n=performance.now()-t;throw console.error(`‚ùå Network error for ${r[0]}:`,o),S.trackApiCall(r[0],n),this.reportError("network_error",{url:r[0],message:o.message,loadTime:n}),o})}}static reportError(e,r){const t={type:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...r};if(console.error("üìä Error report:",t),window.Sentry&&window.Sentry.captureException(new Error(`${e}: ${JSON.stringify(r)}`)),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:"/api/log-error.php",method:"POST",data:t})}catch(o){console.error("Failed to send error report to Bitrix24:",o)}window.gtag&&window.gtag("event","exception",{description:`${e}: ${r.message||"Unknown error"}`,fatal:!1})}static getErrorStats(){return{chunkLoadErrors:0,networkErrors:0,unhandledErrors:0,totalErrors:0}}}const C=ue(ye);C.use(b);const ct=s=>{try{const e=new WeakSet;return JSON.stringify(s,(r,t)=>{if(typeof t=="object"&&t!==null){if(e.has(t))return"[Circular]";e.add(t)}return typeof t=="function"||t===void 0?null:t})}catch{return String(s)}};C.config.errorHandler=(s,e,r)=>{if(console.error("Vue error:",s,r),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:q("/api/log-error.php"),method:"POST",data:{error:s?.message||String(s),info:typeof r=="string"?r:ct(r),component:e?.$options?.name||"Unknown"}})}catch(t){console.error("Failed to log error:",t)}};C.mount("#app");lt.init();export{V as S};
