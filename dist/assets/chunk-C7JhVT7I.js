var o=Object.defineProperty;var c=(i,t,r)=>t in i?o(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r;var a=(i,t,r)=>c(i,typeof t!="symbol"?t+"":t,r);import{g as l}from"./chunk-CEPkt3e7.js";import{L as u}from"./chunk-zzKzT0er.js";class h{static getApiUrl(){return l("/api/bitrix24.php")}static async call(t,r={}){try{const e=await fetch(this.getApiUrl(),{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({method:t,params:r})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();if(s.error)throw new Error(s.error_description||s.error);return s}catch(e){throw console.error("Bitrix24 API error:",e),e}}static async getProfile(){return this.call("profile",{})}static async getCurrentUser(){const t=await this.call("user.current",{});return t&&t.result?t.result:t}static async getLeads(t={},r=["ID","NAME","EMAIL","PHONE"],e={ID:"DESC"}){return(await this.call("crm.lead.list",{filter:t,select:r,order:e})).result||[]}}const g=Object.freeze(Object.defineProperty({__proto__:null,Bitrix24ApiService:h},Symbol.toStringTag,{value:"Module"}));class n{static async getInstance(){if(this.instance)return this.instance;if(this.loading)return new Promise((t,r)=>{const e=()=>{this.instance?t(this.instance):setTimeout(e,10)};e()});try{this.loading=!0;const{Bitrix24ApiService:t}=await u.loadBitrix24Api();this.instance=new t}catch(t){throw console.error("Failed to load Bitrix24ApiService:",t),t}finally{this.loading=!1}return this.instance}static clearInstance(){this.instance=null,this.loading=!1}static hasInstance(){return this.instance!==null}}a(n,"instance",null),a(n,"loading",!1);const y=Object.freeze(Object.defineProperty({__proto__:null,Bitrix24ApiProvider:n},Symbol.toStringTag,{value:"Module"}));export{h as B,y as a,g as b};
