const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ticketListUtils-CPelAA9m.js","assets/priority-config-PuX3KHxj.js","assets/main-DXL9_ymK.js","assets/main-hkNOQW78.css","assets/priority-config-Bxxce_5E.css","assets/ticket-mapper-DBDNtlX4.js"])))=>i.map(i=>d[i]);
var De=Object.defineProperty;var Ae=(b,t,e)=>t in b?De(b,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):b[t]=e;var ce=(b,t,e)=>Ae(b,typeof t!="symbol"?t+"":t,e);import{_ as oe,g as I,c as H,a as d,o as n,b as s,t as W,F as z,e as J,n as K,d as V,f as Q,G as Se,H as j,I as te,j as M,k as q,y as re,B as Z,T as ie,l as ee,J as le,m as Ue,S as Oe,z as Be,r as Re,L as Ne}from"./main-DXL9_ymK.js";import{F as Me}from"./FiltersPanel-CWZCyteD.js";import{L as Ee,D as Pe,B as Le}from"./index-RRw3s1D3.js";import{B as ae,g as Ie,a as Fe,b as $e,D as Ye,T as ne,c as ue}from"./priority-config-PuX3KHxj.js";const Ge={class:"ac-chart"},Ve={class:"ac-chart__header"},je={class:"ac-chart__subtitle"},He={class:"ac-chart__controls"},qe={class:"chart-type-selector"},xe=["onClick"],ze={class:"chart-type-icon"},Je={class:"chart-type-label"},Ze={class:"ac-chart__summary"},Xe={class:"summary-card__value"},Ke={class:"summary-card__value-main"},Qe={class:"summary-card__breakdown"},et={class:"breakdown-item breakdown-item--this-week"},tt={class:"breakdown-item__value"},st={class:"breakdown-item breakdown-item--other-week"},at={class:"breakdown-item__value"},rt={class:"summary-card__value-main"},lt={class:"summary-card__breakdown"},ot={class:"breakdown-item breakdown-item--this-week"},it={class:"breakdown-item__value"},nt={class:"breakdown-item breakdown-item--other-week"},ct={class:"breakdown-item__value"},dt={class:"summary-card summary-card--stages"},ut={class:"summary-card__tags"},kt={key:0,class:"stage-tag stage-tag--empty"},vt={class:"ac-chart__body"},yt={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(b,{emit:t}){const e=b,o=t,i=[{value:"line",label:"Ð›Ð¸Ð½ÐµÐ¹Ð½Ñ‹Ð¹",icon:"ðŸ“ˆ"},{value:"bar",label:"Ð¡Ñ‚Ð¾Ð»Ð±Ñ‡Ð°Ñ‚Ñ‹Ð¹",icon:"ðŸ“Š"},{value:"doughnut",label:"ÐšÑ€ÑƒÐ³Ð¾Ð²Ð°Ñ",icon:"ðŸ©"}],c=I("line");H(()=>{var C;return((C=e.meta)==null?void 0:C.weekNumber)??"â€”"});const E=H(()=>{var P,L,x,f,T,B,Y,l,r;const C=((P=e.meta)==null?void 0:P.weeks)||[],u=C.length>0?C.map(v=>`ÐÐµÐ´ÐµÐ»Ñ ${v.weekNumber}`):[(L=e.meta)!=null&&L.weekNumber?`ÐÐµÐ´ÐµÐ»Ñ ${e.meta.weekNumber}`:"ÐÐµÐ´ÐµÐ»Ñ"],O=Array.isArray((x=e.data.series)==null?void 0:x.new)&&e.data.series.new.length>0?e.data.series.new:[e.data.newTickets??0],k=Array.isArray((f=e.data.series)==null?void 0:f.closed)&&e.data.series.closed.length>0?e.data.series.closed:[e.data.closedTickets??0],a=Array.isArray((T=e.data.series)==null?void 0:T.closedCreatedThisWeek)&&e.data.series.closedCreatedThisWeek.length>0?e.data.series.closedCreatedThisWeek:[e.data.closedTicketsCreatedThisWeek??0],m=Array.isArray((B=e.data.series)==null?void 0:B.closedCreatedOtherWeek)&&e.data.series.closedCreatedOtherWeek.length>0?e.data.series.closedCreatedOtherWeek:[e.data.closedTicketsCreatedOtherWeek??0],p=Array.isArray((Y=e.data.series)==null?void 0:Y.carryover)&&e.data.series.carryover.length>0?e.data.series.carryover:[e.data.carryoverTickets??0],A=Array.isArray((l=e.data.series)==null?void 0:l.carryoverCreatedThisWeek)&&e.data.series.carryoverCreatedThisWeek.length>0?e.data.series.carryoverCreatedThisWeek:[e.data.carryoverTicketsCreatedThisWeek??0],S=Array.isArray((r=e.data.series)==null?void 0:r.carryoverCreatedOtherWeek)&&e.data.series.carryoverCreatedOtherWeek.length>0?e.data.series.carryoverCreatedOtherWeek:[e.data.carryoverTicketsCreatedOtherWeek??0];return{labels:u,datasets:[{label:"ÐÐ¾Ð²Ñ‹Ðµ",data:O,backgroundColor:j.primary,borderColor:j.primary,tension:.3,fill:!1},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (Ð²ÑÐµ)",data:k,backgroundColor:j.success,borderColor:j.success,tension:.3,fill:!1},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:a,backgroundColor:j.successLight,borderColor:j.successLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:m,backgroundColor:j.warning,borderColor:j.warning,tension:.3,fill:!1,borderDash:[5,5]},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (Ð²ÑÐµ)",data:p,backgroundColor:j.carryover,borderColor:j.carryover,tension:.3,fill:!1},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:A,backgroundColor:j.carryoverLight,borderColor:j.carryoverLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:S,backgroundColor:j.carryoverDark,borderColor:j.carryoverDark,tension:.3,fill:!1,borderDash:[5,5]}]}}),y=H(()=>({labels:["ÐÐ¾Ð²Ñ‹Ðµ","Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ","ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ"],datasets:[{data:[e.data.newTickets??0,e.data.closedTickets??0,e.data.carryoverTickets??0],backgroundColor:[j.primary,j.success,j.carryover],borderWidth:1}]})),_=H(()=>{switch(c.value){case"line":return Ee;case"bar":return Le;case"doughnut":return Pe;default:return Ee}}),g=H(()=>c.value==="doughnut"?y.value:E.value),$=C=>{if(!C)return"â€”";try{return new Date(C).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return C}},N=H(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{enabled:!0,callbacks:{title:C=>{var p,A,S,P,L,x;const u=(p=C[0])==null?void 0:p.dataIndex,O=((A=e.meta)==null?void 0:A.weeks)||[];if(O.length>0&&u!==void 0&&O[u]){const f=O[u];return`ÐÐµÐ´ÐµÐ»Ñ ${f.weekNumber} (${$(f.weekStartUtc)} â€” ${$(f.weekEndUtc)})`}const k=(S=e.meta)==null?void 0:S.weekNumber,a=(P=e.meta)==null?void 0:P.weekStartUtc,m=(L=e.meta)==null?void 0:L.weekEndUtc;return k&&a&&m?`ÐÐµÐ´ÐµÐ»Ñ ${k} (${$(a)} â€” ${$(m)})`:((x=C[0])==null?void 0:x.label)||""}}},legend:{position:"top"}},scales:c.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0}},x:{ticks:{maxRotation:45,minRotation:45}}}})),D=H(()=>{var C,u,O,k;if((C=e.data)!=null&&C.series){const a=e.data.series,m=Math.max((Array.isArray(a.new)?a.new.length:0)-1,(Array.isArray(a.closed)?a.closed.length:0)-1,(Array.isArray(a.carryover)?a.carryover.length:0)-1,-1);if(m>=0){const p={newTickets:Array.isArray(a.new)&&a.new[m]!==void 0?a.new[m]:0,closedTickets:Array.isArray(a.closed)&&a.closed[m]!==void 0?a.closed[m]:0,closedTicketsCreatedThisWeek:Array.isArray(a.closedCreatedThisWeek)&&a.closedCreatedThisWeek[m]!==void 0?a.closedCreatedThisWeek[m]:0,closedTicketsCreatedOtherWeek:Array.isArray(a.closedCreatedOtherWeek)&&a.closedCreatedOtherWeek[m]!==void 0?a.closedCreatedOtherWeek[m]:0,carryoverTickets:Array.isArray(a.carryover)&&a.carryover[m]!==void 0?a.carryover[m]:0,carryoverTicketsCreatedThisWeek:Array.isArray(a.carryoverCreatedThisWeek)&&a.carryoverCreatedThisWeek[m]!==void 0?a.carryoverCreatedThisWeek[m]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(a.carryoverCreatedOtherWeek)&&a.carryoverCreatedOtherWeek[m]!==void 0?a.carryoverCreatedOtherWeek[m]:0};if(p.newTickets>0||p.closedTickets>0||p.carryoverTickets>0)return p}}if((u=e.data)!=null&&u.currentWeek&&typeof e.data.currentWeek=="object"){const a=e.data.currentWeek;if((a.newTickets??0)>0||(a.closedTickets??0)>0||(a.carryoverTickets??0)>0)return a}if((O=e.data)!=null&&O.weeksData&&Array.isArray(e.data.weeksData)&&e.data.weeksData.length>0){const a=e.data.weeksData[e.data.weeksData.length-1];if((a.newTickets??0)>0||(a.closedTickets??0)>0||(a.carryoverTickets??0)>0)return a}if((k=e.data)!=null&&k.series){const a=e.data.series,m=Math.max((Array.isArray(a.new)?a.new.length:0)-1,(Array.isArray(a.closed)?a.closed.length:0)-1,(Array.isArray(a.carryover)?a.carryover.length:0)-1,-1);if(m>=0)return{newTickets:Array.isArray(a.new)&&a.new[m]!==void 0?a.new[m]:0,closedTickets:Array.isArray(a.closed)&&a.closed[m]!==void 0?a.closed[m]:0,closedTicketsCreatedThisWeek:Array.isArray(a.closedCreatedThisWeek)&&a.closedCreatedThisWeek[m]!==void 0?a.closedCreatedThisWeek[m]:0,closedTicketsCreatedOtherWeek:Array.isArray(a.closedCreatedOtherWeek)&&a.closedCreatedOtherWeek[m]!==void 0?a.closedCreatedOtherWeek[m]:0,carryoverTickets:Array.isArray(a.carryover)&&a.carryover[m]!==void 0?a.carryover[m]:0,carryoverTicketsCreatedThisWeek:Array.isArray(a.carryoverCreatedThisWeek)&&a.carryoverCreatedThisWeek[m]!==void 0?a.carryoverCreatedThisWeek[m]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(a.carryoverCreatedOtherWeek)&&a.carryoverCreatedOtherWeek[m]!==void 0?a.carryoverCreatedOtherWeek[m]:0}}return e.data||{}}),R=C=>{var m;const u=D.value,O=(u==null?void 0:u.newTickets)??0,k=(u==null?void 0:u.closedTickets)??0,a=(u==null?void 0:u.carryoverTickets)??0;C==="new"&&O>0?o("open-stages"):C==="closed"&&k>0?(((m=e.data)==null?void 0:m.responsible)||[]).length>0&&o("open-responsible"):C==="carryover"&&a>0&&o("open-carryover")};return(C,u)=>{var O,k,a,m,p,A,S,P,L,x,f,T,B,Y,l,r;return n(),d("div",Ge,[s("header",Ve,[s("div",null,[u[3]||(u[3]=s("h2",{class:"ac-chart__title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),s("p",je," ÐÐµÐ´ÐµÐ»Ñ "+W(((k=(O=b.meta)==null?void 0:O.currentWeek)==null?void 0:k.weekNumber)??((a=b.meta)==null?void 0:a.weekNumber)??"â€”")+" Â· "+W((((p=(m=b.meta)==null?void 0:m.currentWeek)==null?void 0:p.weekStartUtc)??((A=b.meta)==null?void 0:A.weekStartUtc))||"â€”")+" â€” "+W((((P=(S=b.meta)==null?void 0:S.currentWeek)==null?void 0:P.weekEndUtc)??((L=b.meta)==null?void 0:L.weekEndUtc))||"â€”")+" (UTC) ",1)]),s("div",He,[s("div",qe,[(n(),d(z,null,J(i,v=>s("button",{key:v.value,class:K(["chart-type-btn",{active:c.value===v.value}]),onClick:w=>c.value=v.value},[s("span",ze,W(v.icon),1),s("span",Je,W(v.label),1)],10,xe)),64))])])]),s("section",Ze,[s("div",{class:"summary-card summary-card--new",onClick:u[0]||(u[0]=v=>R("new"))},[u[4]||(u[4]=s("div",{class:"summary-card__label"},"ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),s("div",Xe,W(((x=D.value)==null?void 0:x.newTickets)??0),1)]),s("div",{class:"summary-card summary-card--closed-breakdown",onClick:u[1]||(u[1]=v=>R("closed"))},[u[9]||(u[9]=s("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),s("div",Ke,W(((f=D.value)==null?void 0:f.closedTickets)??0),1),s("div",Qe,[s("div",et,[u[5]||(u[5]=s("span",{class:"breakdown-item__icon"},"âœ“",-1)),s("span",tt,W(((T=D.value)==null?void 0:T.closedTicketsCreatedThisWeek)??0),1),u[6]||(u[6]=s("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))]),s("div",st,[u[7]||(u[7]=s("span",{class:"breakdown-item__icon"},"â†»",-1)),s("span",at,W(((B=D.value)==null?void 0:B.closedTicketsCreatedOtherWeek)??0),1),u[8]||(u[8]=s("span",{class:"breakdown-item__label"},"Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))])])]),s("div",{class:"summary-card summary-card--carryover-breakdown",onClick:u[2]||(u[2]=v=>R("carryover"))},[u[14]||(u[14]=s("div",{class:"summary-card__label"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",-1)),s("div",rt,W(((Y=D.value)==null?void 0:Y.carryoverTickets)??0),1),s("div",lt,[s("div",ot,[u[10]||(u[10]=s("span",{class:"breakdown-item__icon"},"âœ“",-1)),s("span",it,W(((l=D.value)==null?void 0:l.carryoverTicketsCreatedThisWeek)??0),1),u[11]||(u[11]=s("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),s("div",nt,[u[12]||(u[12]=s("span",{class:"breakdown-item__icon"},"â†»",-1)),s("span",ct,W(((r=D.value)==null?void 0:r.carryoverTicketsCreatedOtherWeek)??0),1),u[13]||(u[13]=s("span",{class:"breakdown-item__label"},"Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ…",-1))])])]),s("div",dt,[u[15]||(u[15]=s("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),s("div",ut,[(n(!0),d(z,null,J(b.data.stages||[],v=>(n(),d("span",{key:v.stageId,class:"stage-tag"},W(v.stageName||v.stageId)+" â€” "+W(v.count),1))),128)),!b.data.stages||b.data.stages.length===0?(n(),d("span",kt," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):V("",!0)])])]),s("div",vt,[(n(),Q(Se(_.value),{data:g.value,options:N.value},null,8,["data","options"]))])])}}},mt=oe(yt,[["__scopeId","data-v-af9ae5a3"]]);class de{static async getSectorData(){try{const t=await this.getAllTickets();console.log("Total tickets loaded:",t.length);const e=this.extractUniqueEmployeeIds(t);console.log("Unique employee IDs:",e);const o=await this.getEmployeesByIds(e);return console.log("Loaded employees:",o.length),{stages:this.groupTicketsByStages(t,o),employees:o,zeroPointTickets:this.getZeroPointTickets(t)}}catch(t){throw console.error("Error getting sector data:",t),t}}static async getAllTickets(){const t=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],e=[];for(const o of t){console.log(`Loading tickets for stage: ${o}`);const i=await this.getTicketsByStage(o);e.push(...i),console.log(`Loaded ${i.length} tickets for stage ${o}`)}return e}static async getTicketsByStage(t){const e=[];let o=0;const i=50;let c=!0;for(;c;)try{const y=await ae.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:t},select:["*"],order:{id:"DESC"},start:o,useOriginalUfNames:"Y"});let _=[];y&&y.result&&(Array.isArray(y.result)?_=y.result:y.result.items&&Array.isArray(y.result.items)?_=y.result.items:y.result.data&&Array.isArray(y.result.data)&&(_=y.result.data)),_.length>0?(e.push(..._),o+=_.length,c=_.length===i):c=!1}catch(y){console.error(`Error loading tickets batch for stage ${t} (start: ${o}):`,y),c=!1}e.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(e[0],null,2)),console.log("Sample ticket keys:",Object.keys(e[0])),console.log("Sample ticket assignedById variants:",{assignedById:e[0].assignedById,assignedByIdId:e[0].assignedByIdId,ASSIGNED_BY_ID:e[0].ASSIGNED_BY_ID}));const E=e.filter(y=>{const _=y.UF_CRM_7_TYPE_PRODUCT||y.uf_crm_7_type_product||y.ufCrm7TypeProduct||y.UF_CRM_7_TYPE_PRODUCT||y.uf_crm_7_type_product;return Array.isArray(_)?_.includes(this.SECTOR_TAG):typeof _=="object"&&_!==null?_.value===this.SECTOR_TAG||_===this.SECTOR_TAG:_===this.SECTOR_TAG});return console.log(`Filtered ${E.length} tickets from ${e.length} for stage ${t} (sector tag: ${this.SECTOR_TAG})`),E}static extractUniqueEmployeeIds(t){if(!Array.isArray(t))return[];const e=new Set;return t.forEach(o=>{const i=o.assignedById||o.assignedByIdId||o.ASSIGNED_BY_ID||o.assignedById||o.assignedById&&typeof o.assignedById=="object"&&(o.assignedById.id||o.assignedById.ID)||o.assignedById&&typeof o.assignedById=="object"&&o.assignedById.value;if(i){const c=parseInt(i);c&&!isNaN(c)&&c>0&&e.add(c)}}),t.length>0&&(console.log("Sample ticket for employee extraction:",t[0]),console.log("Sample ticket assignedById variants:",{assignedById:t[0].assignedById,assignedByIdId:t[0].assignedByIdId,ASSIGNED_BY_ID:t[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(e))),Array.from(e)}static async getEmployeesByIds(t){if(!Array.isArray(t)||t.length===0)return[];try{const e=await ae.call("user.get",{filter:{ID:t}});let o=[];return e&&e.result&&(Array.isArray(e.result)?o=e.result:console.warn("Unexpected user.get result format:",e)),o.map(i=>({id:parseInt(i.ID||i.id||0),name:`${i.NAME||i.name||""} ${i.LAST_NAME||i.lastName||""}`.trim()||i.EMAIL||i.email||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹",position:i.WORK_POSITION||i.workPosition||"Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº",email:i.EMAIL||i.email||"",tickets:[]}))}catch(e){return console.error("Error getting employees by IDs:",e),[]}}static groupTicketsByStages(t,e){Array.isArray(t)||(console.warn("Tickets is not an array:",t),t=[]),Array.isArray(e)||(console.warn("Employees is not an array:",e),e=[]);const o=[{id:"formed",name:"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ",color:"#007bff",employees:e.map(i=>({...i,tickets:[]}))},{id:"review",name:"Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—",color:"#ffc107",employees:e.map(i=>({...i,tickets:[]}))},{id:"execution",name:"Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ",color:"#28a745",employees:e.map(i=>({...i,tickets:[]}))}];return t.forEach(i=>{const c=this.mapStageId(i.stageId||i.STAGE_ID||""),E=o.find(y=>y.id===c);if(E){const y=i.assignedById||i.ASSIGNED_BY_ID||null,_=y?parseInt(y):null;if(_){let g=E.employees.find($=>$.id===_);g||(g={id:_,name:`Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº #${_}`,position:"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾",email:"",tickets:[]},E.employees.push(g)),g.tickets.push(this.mapTicket(i))}}}),o}static mapStageId(t){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[t]||"formed"}static mapStageIdToBitrix(t){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[t]||"DT140_12:UC_0VHWE2"}static mapTicket(t){const e=parseInt(t.id||t.ID||0),o=t.title||t.TITLE||"Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ",i=t.stageId||t.STAGE_ID||"",c=t.assignedById||t.ASSIGNED_BY_ID||null,E=t.createdTime||t.CREATED_DATE||t.CREATED_TIME||"",y=t.updatedTime||t.MODIFY_DATE||t.UPDATED_TIME||"",_=t.UF_CRM_7_UF_PRIORITY||t.uf_crm_7_uf_priority||t.ufCrm7UfPriority||t.UF_CRM_7_UF_PRIORITY||t.uf_crm_7_uf_priority||t.priority||t.PRIORITY||null,g=Ie(_),$=Fe(g);return{id:e,title:o,priorityId:g.id,priorityLabel:g.label,priorityColors:$,priority:g.id,priorityBitrixValue:g.bitrixValue||null,status:this.mapStatus(i),assigneeId:c?parseInt(c):null,stageId:this.mapStageId(i),createdAt:E,modifiedAt:y,amount:t.opportunity||t.OPPORTUNITY||0,currency:t.currencyId||t.CURRENCY_ID||"RUB",description:t.comments||t.COMMENTS||""}}static mapPriority(t){return Ie(t).id}static mapPriorityToBitrix(t){if(t&&typeof t=="object")return t.bitrixValue||null;const e=$e(t);if(e&&e.bitrixValue)return e.bitrixValue;const o={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return o[t]?o[t]:$e(Ye).bitrixValue}static mapStatus(t){return"in_progress"}static getZeroPointTickets(t){const e={formed:[],review:[],execution:[]};return Array.isArray(t)?(t.filter(o=>!(o.assignedById||o.ASSIGNED_BY_ID)).forEach(o=>{const i=this.mapStageId(o.stageId||o.STAGE_ID||"");e[i]&&e[i].push(this.mapTicket(o))}),e):(console.warn("Tickets is not an array in getZeroPointTickets:",t),e)}static async assignTicket(t,e,o){try{const i=this.mapStageIdToBitrix(o);return(await ae.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:t,fields:{assignedById:e,stageId:i}})).result===!0}catch(i){throw console.error("Error assigning ticket:",i),i}}static async createTicket(t){try{const e=await ae.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:t.title,assignedById:t.employeeId,stageId:this.mapStageIdToBitrix(t.stageId)}});return e.result?parseInt(e.result):0}catch(e){throw console.error("Error creating ticket:",e),e}}static async getTicket(t){try{const e=await ae.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:t});return this.mapTicket(e.result)}catch(e){throw console.error("Error getting ticket:",e),e}}static async addComment(t,e){try{return(await ae.call("crm.timeline.comment.add",{fields:{entityId:t,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:e}})).result!==void 0}catch(o){throw console.error("Error adding comment:",o),o}}}ce(de,"ENTITY_TYPE_ID",140),ce(de,"SECTOR_TAG","1C");const _t="/api/graph-1c-admission-closure.php";function ht(b){var o,i,c,E,y,_,g,$,N,D,R,C,u,O,k,a,m,p,A,S,P,L,x,f,T,B,Y,l,r,v,w,U,F,h,G,X,ke,ve,ye,me,_e,he,pe,ge,Te,fe,be,Ce,we,We;if(!b)return{meta:null,data:{currentWeek:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0},newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},weeksData:[],stages:[],responsible:[],responsibleCreatedThisWeek:[],responsibleCreatedOtherWeek:[]}};const t=b.data||b.result||b,e=t.meta||b.meta||null;return{meta:{...e,currentWeek:(e==null?void 0:e.currentWeek)||(e?{weekNumber:e.weekNumber,weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc}:null),weeks:(e==null?void 0:e.weeks)||[]},data:{currentWeek:((o=t.data)==null?void 0:o.currentWeek)||(t.data?{newTickets:t.data.newTickets??0,closedTickets:t.data.closedTickets??0,closedTicketsCreatedThisWeek:t.data.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:t.data.closedTicketsCreatedOtherWeek??0,carryoverTickets:t.data.carryoverTickets??0,carryoverTicketsCreatedThisWeek:t.data.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:t.data.carryoverTicketsCreatedOtherWeek??0}:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0}),newTickets:((c=(i=t.data)==null?void 0:i.currentWeek)==null?void 0:c.newTickets)??((E=t.data)==null?void 0:E.newTickets)??t.newTickets??0,closedTickets:((_=(y=t.data)==null?void 0:y.currentWeek)==null?void 0:_.closedTickets)??((g=t.data)==null?void 0:g.closedTickets)??t.closedTickets??0,closedTicketsCreatedThisWeek:((N=($=t.data)==null?void 0:$.currentWeek)==null?void 0:N.closedTicketsCreatedThisWeek)??((D=t.data)==null?void 0:D.closedTicketsCreatedThisWeek)??t.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:((C=(R=t.data)==null?void 0:R.currentWeek)==null?void 0:C.closedTicketsCreatedOtherWeek)??((u=t.data)==null?void 0:u.closedTicketsCreatedOtherWeek)??t.closedTicketsCreatedOtherWeek??0,carryoverTickets:((k=(O=t.data)==null?void 0:O.currentWeek)==null?void 0:k.carryoverTickets)??((a=t.data)==null?void 0:a.carryoverTickets)??t.carryoverTickets??0,carryoverTicketsCreatedThisWeek:((p=(m=t.data)==null?void 0:m.currentWeek)==null?void 0:p.carryoverTicketsCreatedThisWeek)??((A=t.data)==null?void 0:A.carryoverTicketsCreatedThisWeek)??t.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:((P=(S=t.data)==null?void 0:S.currentWeek)==null?void 0:P.carryoverTicketsCreatedOtherWeek)??((L=t.data)==null?void 0:L.carryoverTicketsCreatedOtherWeek)??t.carryoverTicketsCreatedOtherWeek??0,series:{new:((f=(x=t.data)==null?void 0:x.series)==null?void 0:f.new)??((T=t.series)==null?void 0:T.new)??[0],closed:((Y=(B=t.data)==null?void 0:B.series)==null?void 0:Y.closed)??((l=t.series)==null?void 0:l.closed)??[0],closedCreatedThisWeek:((v=(r=t.data)==null?void 0:r.series)==null?void 0:v.closedCreatedThisWeek)??((w=t.series)==null?void 0:w.closedCreatedThisWeek)??[0],closedCreatedOtherWeek:((F=(U=t.data)==null?void 0:U.series)==null?void 0:F.closedCreatedOtherWeek)??((h=t.series)==null?void 0:h.closedCreatedOtherWeek)??[0],carryover:((X=(G=t.data)==null?void 0:G.series)==null?void 0:X.carryover)??((ke=t.series)==null?void 0:ke.carryover)??[0],carryoverCreatedThisWeek:((ye=(ve=t.data)==null?void 0:ve.series)==null?void 0:ye.carryoverCreatedThisWeek)??((me=t.series)==null?void 0:me.carryoverCreatedThisWeek)??[0],carryoverCreatedOtherWeek:((he=(_e=t.data)==null?void 0:_e.series)==null?void 0:he.carryoverCreatedOtherWeek)??((pe=t.series)==null?void 0:pe.carryoverCreatedOtherWeek)??[0]},weeksData:((ge=t.data)==null?void 0:ge.weeksData)??t.weeksData??[],stages:((Te=t.data)==null?void 0:Te.stages)??t.stages??[],responsible:((fe=t.data)==null?void 0:fe.responsible)??t.responsible??[],responsibleCreatedThisWeek:((be=t.data)==null?void 0:be.responsibleCreatedThisWeek)??t.responsibleCreatedThisWeek??[],responsibleCreatedOtherWeek:((Ce=t.data)==null?void 0:Ce.responsibleCreatedOtherWeek)??t.responsibleCreatedOtherWeek??[],newTicketsByStages:((we=t.data)==null?void 0:we.newTicketsByStages)??t.newTicketsByStages??null,carryoverTicketsByDuration:((We=t.data)==null?void 0:We.carryoverTicketsByDuration)??t.carryoverTicketsByDuration??null}}}async function se(b={}){const{endpoint:t=_t,product:e="1C",weekStartUtc:o=null,weekEndUtc:i=null,useCache:c=!0,forceRefresh:E=!1,includeTickets:y=!1,includeNewTicketsByStages:_=!1,includeCarryoverTickets:g=!0,includeCarryoverTicketsByDuration:$=!1}=b,D=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({product:e,weekStartUtc:o,weekEndUtc:i,useCache:c,forceRefresh:E,includeTickets:y,includeNewTicketsByStages:_,includeCarryoverTickets:g,includeCarryoverTicketsByDuration:$})});if(!D.ok)throw new Error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° (${D.status})`);const R=await D.json();if((R==null?void 0:R.success)===!1)throw new Error(R.message||"Ð‘ÑÐºÐµÐ½Ð´ Ð²ÐµÑ€Ð½ÑƒÐ» Ð¾ÑˆÐ¸Ð±ÐºÑƒ");return ht(R)}const pt={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},gt={class:"modal"},Tt={key:0,class:"modal__tabs"},ft={key:"level-0-categories",class:"level-0"},bt={class:"modal__header"},Ct={class:"modal__title"},wt={key:0},Wt={class:"modal__body"},Et={class:"categories-list"},It=["onClick"],$t={class:"category-item"},Dt={class:"category-item__icon"},At={key:0},St={key:1},Ut={class:"category-item__content"},Ot={class:"category-item__label"},Bt={class:"category-item__count"},Rt={key:0,class:"category-item__arrow"},Nt={class:"modal__footer"},Mt={key:"level-1-categories",class:"level-1"},Pt={class:"modal__header"},Lt={class:"modal__body"},Ft={key:"loading",class:"loading-names"},Yt={key:"empty",class:"modal__empty"},Gt={key:"list",class:"responsible-list"},Vt=["onClick"],jt={class:"responsible-list__name"},Ht={class:"responsible-list__count"},qt={key:0,class:"responsible-list__arrow"},xt={class:"modal__footer"},zt={key:"level-2-categories",class:"level-2"},Jt={class:"modal__header"},Zt={class:"modal__title"},Xt={class:"modal__body"},Kt={key:"loading",class:"loading-state"},Qt={key:"error",class:"error-state"},es={class:"error-message"},ts={key:"empty",class:"empty-state"},ss={key:"tickets",class:"tickets-list-container"},as={key:"level-0-employees",class:"level-0"},rs={class:"modal__header"},ls={class:"modal__title"},os={key:0},is={class:"modal__body"},ns={key:"loading",class:"loading-names"},cs={key:"empty",class:"modal__empty"},ds={key:"list",class:"responsible-list"},us=["onClick"],ks={class:"responsible-list__name"},vs={class:"responsible-list__count"},ys={key:0,class:"responsible-list__arrow"},ms={class:"modal__footer"},_s={key:"level-1-employees",class:"level-1"},hs={class:"modal__header"},ps={class:"modal__title"},gs={class:"modal__body"},Ts={class:"categories-list"},fs=["onClick"],bs={class:"category-item"},Cs={class:"category-item__icon"},ws={key:0},Ws={key:1},Es={class:"category-item__content"},Is={class:"category-item__label"},$s={class:"category-item__count"},Ds={key:0,class:"category-item__arrow"},As={class:"modal__footer"},Ss={key:"level-2-employees",class:"level-2"},Us={class:"modal__header"},Os={class:"modal__title"},Bs={class:"modal__body"},Rs={key:"loading",class:"loading-state"},Ns={key:"error",class:"error-state"},Ms={class:"error-message"},Ps={key:"empty",class:"empty-state"},Ls={class:"empty-state-message"},Fs={key:"tickets",class:"tickets-list-container"},Ys={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(b){const t=b,e=I(0),o=I("categories"),i=I(null),c=I(null),E=I(null),y=I([]),_=I(!1),g=I(null),$=I([]),N=I([]),D=I(!1),R=H(()=>[{id:"created-this-week",label:"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ",count:t.closedTicketsCreatedThisWeek??0,responsible:t.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ€Ð°Ð½ÐµÐµ",count:t.closedTicketsCreatedOtherWeek??0,responsible:t.responsibleCreatedOtherWeek??[]}]),C=H(()=>{const l=new Map;return(t.responsibleCreatedThisWeek||[]).forEach(r=>{const v=r.id??"unassigned";l.has(v)||l.set(v,{id:r.id,name:r.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const w=l.get(v);w.thisWeekCount=r.count??0,w.thisWeekTickets=r.tickets||[],w.totalCount+=w.thisWeekCount}),(t.responsibleCreatedOtherWeek||[]).forEach(r=>{const v=r.id??"unassigned";l.has(v)||l.set(v,{id:r.id,name:r.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const w=l.get(v);w.otherWeekCount=r.count??0,w.otherWeekTickets=r.tickets||[],w.totalCount+=w.otherWeekCount}),Array.from(l.values())}),u=H(()=>{if(!c.value)return[];const l=c.value.thisWeekTickets||[],r=c.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:c.value.id,name:c.value.name,thisWeekCount:c.value.thisWeekCount,otherWeekCount:c.value.otherWeekCount,thisWeekTickets:l.length,otherWeekTickets:r.length,employee:c.value}),[{id:"this-week",label:"ÐÐ° ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ðµ",count:c.value.thisWeekCount??0,tickets:l,employeeId:c.value.id},{id:"other-week",label:"ÐÐ° Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ðµ",count:c.value.otherWeekCount??0,tickets:r,employeeId:c.value.id}]}),O=H(()=>(N.value||[]).length>0);async function k(l){const r=l.filter(v=>v.id!==null&&v.id!==void 0).map(v=>v.id);if(r.length===0)return l;try{const v=await de.getEmployeesByIds(r),w=new Map;return v.forEach(U=>{w.set(U.id,U.name)}),l.map(U=>U.id&&w.has(U.id)?{...U,name:w.get(U.id)}:U)}catch(v){return console.error("[ResponsibleModal] Error enriching names:",v),l}}te([()=>o.value,()=>C.value],async([l,r])=>{if(!(l!=="employees"||e.value!==0)){if(!r||r.length===0){N.value=[];return}D.value=!0;try{N.value=await k(r)}catch(v){console.error("[ResponsibleModal] Error loading employee names:",v),N.value=r}finally{D.value=!1}}},{immediate:!0}),te(()=>t.responsible,async l=>{if(!(e.value!==0||i.value||o.value!=="categories")){if(!l||l.length===0){$.value=[];return}D.value=!0;try{$.value=await k(l)}catch(r){console.error("[ResponsibleModal] Error loading employee names:",r),$.value=l}finally{D.value=!1}}},{immediate:!1});const a=H(()=>($.value||[]).length>0);function m(l){o.value!==l&&(o.value=l,e.value=0,i.value=null,c.value=null,E.value=null,y.value=[],g.value=null,$.value=[],N.value=[])}async function p(l){if(!(!l||l.count===0)){i.value=l,e.value=1,D.value=!0;try{$.value=await k(l.responsible)}catch(r){console.error("[ResponsibleModal] Error loading employee names:",r),$.value=l.responsible}finally{D.value=!1}}}async function A(l,r=null){var v,w;!l||!l.id||l.totalCount===0||(r&&r.currentTarget&&(r.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{r.currentTarget&&(r.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:l.id,name:l.name,thisWeekCount:l.thisWeekCount,otherWeekCount:l.otherWeekCount,thisWeekTickets:((v=l.thisWeekTickets)==null?void 0:v.length)||0,otherWeekTickets:((w=l.otherWeekTickets)==null?void 0:w.length)||0,employee:l}),c.value={...l,thisWeekTickets:l.thisWeekTickets||[],otherWeekTickets:l.otherWeekTickets||[]},e.value=1)}async function S(l){var v;if(!l||l.count===0)return;E.value=l,e.value=2;const r=l.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:l.id,label:l.label,count:l.count,ticketsInGradation:r.length,selectedEmployee:(v=c.value)==null?void 0:v.id}),r.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",r.length),await P(r)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await L(l))}async function P(l){_.value=!0,g.value=null;try{try{const{prepareTicketsForDisplay:r}=await le(async()=>{const{prepareTicketsForDisplay:v}=await import("./ticketListUtils-CPelAA9m.js").then(w=>w.t);return{prepareTicketsForDisplay:v}},__vite__mapDeps([0,1,2,3,4,5]));y.value=await r(l,null,null)}catch(r){console.error("[ResponsibleModal] Error preparing tickets:",r),y.value=l}y.value.length===0&&(g.value=null)}catch(r){g.value=r.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets:",r),y.value=[]}finally{_.value=!1}}async function L(l){_.value=!0,g.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc||!c.value)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸ Ð¸Ð»Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº");const r=await se({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeTickets:!0}),v=l.id==="this-week"?r.data.responsibleCreatedThisWeek:r.data.responsibleCreatedOtherWeek,w=v==null?void 0:v.find(F=>F.id===c.value.id),U=(w==null?void 0:w.tickets)||[];try{const{prepareTicketsForDisplay:F}=await le(async()=>{const{prepareTicketsForDisplay:h}=await import("./ticketListUtils-CPelAA9m.js").then(G=>G.t);return{prepareTicketsForDisplay:h}},__vite__mapDeps([0,1,2,3,4,5]));y.value=await F(U,null,null)}catch(F){console.error("[ResponsibleModal] Error preparing tickets:",F),y.value=U}y.value.length===0&&(g.value=null)}catch(r){g.value=r.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets from API:",r),y.value=[]}finally{_.value=!1}}async function x(l,r=null){!l||!l.id||l.count===0||(r&&r.currentTarget&&(r.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{r.currentTarget&&(r.currentTarget.style.transform="")},150)),c.value=l,e.value=2,await f(l.id))}async function f(l){var r;_.value=!0,g.value=null;try{let v=[];if(i.value&&i.value.responsible){const w=i.value.responsible.find(U=>U.id===l);v=(w==null?void 0:w.tickets)||[]}if(v.length===0&&t.weekStartUtc&&t.weekEndUtc){const w=await se({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeTickets:!0}),U=((r=i.value)==null?void 0:r.id)==="created-this-week"?w.data.responsibleCreatedThisWeek:w.data.responsibleCreatedOtherWeek,F=U==null?void 0:U.find(h=>h.id===l);v=(F==null?void 0:F.tickets)||[]}try{const{prepareTicketsForDisplay:w}=await le(async()=>{const{prepareTicketsForDisplay:U}=await import("./ticketListUtils-CPelAA9m.js").then(F=>F.t);return{prepareTicketsForDisplay:U}},__vite__mapDeps([0,1,2,3,4,5]));y.value=await w(v,null,null)}catch(w){console.error("[ResponsibleModal] Error preparing tickets:",w),y.value=v}y.value.length===0&&(g.value=null)}catch(v){g.value=v.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets:",v),y.value=[]}finally{_.value=!1}}function T(){e.value===2?(e.value=1,o.value==="categories"?c.value=null:E.value=null,y.value=[],g.value=null):e.value===1&&(e.value=0,o.value==="categories"?(i.value=null,$.value=[]):c.value=null)}function B(l){const r=ue(l.id);window.open(r,"_blank")}function Y(){o.value==="employees"&&E.value?P(E.value.tickets):o.value==="categories"&&c.value&&f(c.value.id)}return te(()=>t.isVisible,l=>{l||(e.value=0,o.value="categories",i.value=null,c.value=null,E.value=null,y.value=[],g.value=null,$.value=[],N.value=[])}),(l,r)=>b.isVisible?(n(),d("div",pt,[s("div",gt,[e.value===0?(n(),d("div",Tt,[s("button",{class:K(["modal__tab",{"modal__tab--active":o.value==="categories"}]),onClick:r[0]||(r[0]=v=>m("categories"))}," ÐŸÐ¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼ ",2),s("button",{class:K(["modal__tab",{"modal__tab--active":o.value==="employees"}]),onClick:r[1]||(r[1]=v=>m("employees"))}," ÐŸÐ¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼ ",2)])):V("",!0),M(Z,{name:"level",mode:"out-in"},{default:q(()=>{var v,w,U,F;return[o.value==="categories"&&e.value===0?(n(),d("div",ft,[s("header",bt,[s("h3",Ct,[r[12]||(r[12]=re(" Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),b.weekNumber?(n(),d("span",wt," Â· ÐÐµÐ´ÐµÐ»Ñ "+W(b.weekNumber),1)):V("",!0)]),s("button",{class:"modal__close",onClick:r[2]||(r[2]=h=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Wt,[s("ul",Et,[(n(!0),d(z,null,J(R.value,h=>(n(),d("li",{key:h.id,class:K(["categories-list__item",{"categories-list__item--clickable":h.count>0}]),onClick:G=>p(h)},[s("div",$t,[s("div",Dt,[h.id==="created-this-week"?(n(),d("span",At,"âœ“")):(n(),d("span",St,"â†»"))]),s("div",Ut,[s("div",Ot,W(h.label),1),s("div",Bt,W(h.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1)]),h.count>0?(n(),d("span",Rt,"â†’")):V("",!0)])],10,It))),128))])]),s("footer",Nt,[s("button",{class:"btn",onClick:r[3]||(r[3]=h=>l.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):o.value==="categories"&&e.value===1?(n(),d("div",Mt,[s("header",Pt,[s("button",{class:"btn-back",onClick:T,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),r[13]||(r[13]=s("h3",{class:"modal__title"},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),s("button",{class:"modal__close",onClick:r[4]||(r[4]=h=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Lt,[M(Z,{name:"loading",mode:"out-in"},{default:q(()=>[D.value?(n(),d("div",Ft,[...r[14]||(r[14]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð¼Ñ‘Ð½ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²...",-1)])])):a.value?(n(),d("ul",Gt,[(n(!0),d(z,null,J($.value,h=>(n(),d("li",{key:h.id||h.name,class:K(["responsible-list__item",{"responsible-list__item--clickable":h.id&&h.count>0}]),onClick:G=>x(h,G),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°"},[s("span",jt,W(h.name||"ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½"),1),s("span",Ht,W(h.count??0)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),h.id&&h.count>0?(n(),d("span",qt,"â†’")):V("",!0)],10,Vt))),128))])):(n(),d("p",Yt,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¼"))]),_:1})]),s("footer",xt,[s("button",{class:"btn",onClick:r[5]||(r[5]=h=>l.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):o.value==="categories"&&e.value===2?(n(),d("div",zt,[s("header",Jt,[s("button",{class:"btn-back",onClick:T,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",Zt,"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+W(((v=c.value)==null?void 0:v.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),s("button",{class:"modal__close",onClick:r[6]||(r[6]=h=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Xt,[M(Z,{name:"loading",mode:"out-in"},{default:q(()=>[_.value?(n(),d("div",Kt,[...r[15]||(r[15]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):g.value?(n(),d("div",Qt,[r[16]||(r[16]=s("div",{class:"error-icon"},"âš ï¸",-1)),r[17]||(r[17]=s("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),s("p",es,W(g.value),1),s("button",{class:"btn btn-retry",onClick:Y},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):y.value.length===0?(n(),d("div",ts,[...r[18]||(r[18]=[s("div",{class:"empty-state-icon"},"ðŸ“‹",-1),s("p",{class:"empty-state-message"},"Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)])])):(n(),d("div",ss,[M(ie,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(n(!0),d(z,null,J(y.value,(h,G)=>(n(),Q(ne,{key:h.id,ticket:h,draggable:!1,style:ee({"--ticket-index":G}),onClick:B},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):o.value==="employees"&&e.value===0?(n(),d("div",as,[s("header",rs,[s("h3",ls,[r[19]||(r[19]=re(" Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),b.weekNumber?(n(),d("span",os," Â· ÐÐµÐ´ÐµÐ»Ñ "+W(b.weekNumber),1)):V("",!0)]),s("button",{class:"modal__close",onClick:r[7]||(r[7]=h=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",is,[M(Z,{name:"loading",mode:"out-in"},{default:q(()=>[D.value?(n(),d("div",ns,[...r[20]||(r[20]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð¼Ñ‘Ð½ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²...",-1)])])):O.value?(n(),d("ul",ds,[(n(!0),d(z,null,J(N.value,h=>(n(),d("li",{key:h.id||h.name,class:K(["responsible-list__item",{"responsible-list__item--clickable":h.id&&h.totalCount>0}]),onClick:G=>A(h,G),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð³Ñ€Ð°Ð´Ð°Ñ†Ð¸Ð¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°"},[s("span",ks,W(h.name||"ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½"),1),s("span",vs,W(h.totalCount??0)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),h.id&&h.totalCount>0?(n(),d("span",ys,"â†’")):V("",!0)],10,us))),128))])):(n(),d("p",cs,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼"))]),_:1})]),s("footer",ms,[s("button",{class:"btn",onClick:r[8]||(r[8]=h=>l.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):o.value==="employees"&&e.value===1?(n(),d("div",_s,[s("header",hs,[s("button",{class:"btn-back",onClick:T,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",ps,"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+W(((w=c.value)==null?void 0:w.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),s("button",{class:"modal__close",onClick:r[9]||(r[9]=h=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",gs,[s("ul",Ts,[(n(!0),d(z,null,J(u.value,h=>(n(),d("li",{key:h.id,class:K(["categories-list__item",{"categories-list__item--clickable":h.count>0}]),onClick:G=>S(h)},[s("div",bs,[s("div",Cs,[h.id==="this-week"?(n(),d("span",ws,"âœ“")):(n(),d("span",Ws,"â†»"))]),s("div",Es,[s("div",Is,W(h.label),1),s("div",$s,W(h.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1)]),h.count>0?(n(),d("span",Ds,"â†’")):V("",!0)])],10,fs))),128))])]),s("footer",As,[s("button",{class:"btn",onClick:r[10]||(r[10]=h=>l.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):o.value==="employees"&&e.value===2?(n(),d("div",Ss,[s("header",Us,[s("button",{class:"btn-back",onClick:T,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",Os," Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+W(((U=c.value)==null?void 0:U.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾")+" ("+W(((F=E.value)==null?void 0:F.label)||"")+") ",1),s("button",{class:"modal__close",onClick:r[11]||(r[11]=h=>l.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Bs,[M(Z,{name:"loading",mode:"out-in"},{default:q(()=>{var h;return[_.value?(n(),d("div",Rs,[...r[21]||(r[21]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):g.value?(n(),d("div",Ns,[r[22]||(r[22]=s("div",{class:"error-icon"},"âš ï¸",-1)),r[23]||(r[23]=s("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),s("p",Ms,W(g.value),1),s("button",{class:"btn btn-retry",onClick:Y},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):y.value.length===0?(n(),d("div",Ps,[r[24]||(r[24]=s("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),s("p",Ls,W(o.value==="employees"?`Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${((h=E.value)==null?void 0:h.label)||""}"`:"Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ"),1)])):(n(),d("div",Fs,[M(ie,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(n(!0),d(z,null,J(y.value,(G,X)=>(n(),Q(ne,{key:G.id,ticket:G,draggable:!1,style:ee({"--ticket-index":X}),onClick:B},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):V("",!0)]}),_:1})])])):V("",!0)}},Gs=oe(Ys,[["__scopeId","data-v-3b229bb4"]]),Vs={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},js={class:"modal"},Hs={key:"level-1",class:"level-1"},qs={class:"modal__header"},xs={class:"modal__title"},zs={key:0},Js={class:"modal__body"},Zs={key:"loading",class:"loading-names"},Xs={key:"empty",class:"modal__empty"},Ks={key:"list",class:"stages-list"},Qs=["onClick"],ea={class:"stages-list__name"},ta={class:"stages-list__count"},sa={key:0,class:"stages-list__arrow"},aa={class:"modal__footer"},ra={key:"level-2",class:"level-2"},la={class:"modal__header"},oa={class:"modal__title"},ia={class:"modal__body"},na={key:"loading",class:"loading-state"},ca={key:"error",class:"error-state"},da={class:"error-message"},ua={key:"empty",class:"empty-state"},ka={class:"empty-state-message"},va={key:"tickets",class:"tickets-list-container"},ya={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(b,{emit:t}){const e=b,o=I(1),i=I(null),c=I([]),E=I(!1),y=I(!1),_=I(null),g=I([]),$=H(()=>g.value.length>0&&g.value.some(k=>k.count>0));async function N(){if(!e.weekStartUtc||!e.weekEndUtc){g.value=[];return}y.value=!0,_.value=null;try{const k=await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeNewTicketsByStages:!0});g.value=k.data.newTicketsByStages||[]}catch(k){_.value=k.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÑ‚Ð°Ð´Ð¸Ð¹",console.error("[StagesModal] Error loading stages:",k),g.value=[]}finally{y.value=!1}}async function D(k,a=null){!k||k.count===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),i.value=k,o.value=2,await R(k.stageId))}async function R(k){var a;E.value=!0,_.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const p=(a=(await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:a.find(S=>S.stageId===k),A=(p==null?void 0:p.tickets)||[];try{const{prepareTicketsForDisplay:S}=await le(async()=>{const{prepareTicketsForDisplay:P}=await import("./ticketListUtils-CPelAA9m.js").then(L=>L.t);return{prepareTicketsForDisplay:P}},__vite__mapDeps([0,1,2,3,4,5]));c.value=await S(A,null,null)}catch(S){console.error("[StagesModal] Error preparing tickets:",S),c.value=A}c.value.length===0&&(_.value=null)}catch(m){_.value=m.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[StagesModal] Error loading tickets:",m),c.value=[]}finally{E.value=!1}}function C(){o.value=1,i.value=null,c.value=[],_.value=null}function u(k){const a=ue(k.id);window.open(a,"_blank")}function O(){i.value&&R(i.value.stageId)}return te(()=>e.isVisible,k=>{k?N():(o.value=1,i.value=null,c.value=[],_.value=null,g.value=[])}),te([()=>e.weekStartUtc,()=>e.weekEndUtc],()=>{e.isVisible&&N()}),(k,a)=>b.isVisible?(n(),d("div",Vs,[s("div",js,[M(Z,{name:"level",mode:"out-in"},{default:q(()=>{var m;return[o.value===1?(n(),d("div",Hs,[s("header",qs,[s("h3",xs,[a[3]||(a[3]=re(" ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),b.weekNumber?(n(),d("span",zs," Â· ÐÐµÐ´ÐµÐ»Ñ "+W(b.weekNumber),1)):V("",!0)]),s("button",{class:"modal__close",onClick:a[0]||(a[0]=p=>k.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Js,[M(Z,{name:"loading",mode:"out-in"},{default:q(()=>[y.value?(n(),d("div",Zs,[...a[4]||(a[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÑ‚Ð°Ð´Ð¸Ð¹...",-1)])])):$.value?(n(),d("ul",Ks,[(n(!0),d(z,null,J(g.value,p=>(n(),d("li",{key:p.stageId,class:K(["stages-list__item",{"stages-list__item--clickable":p.count>0}]),style:ee({"--stage-color":p.color}),onClick:A=>D(p,A),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÑ‚Ð°Ð´Ð¸Ð¸"},[s("span",{class:"stages-list__color",style:ee({backgroundColor:p.color})},null,4),s("span",ea,W(p.stageName),1),s("span",ta,W(p.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),p.count>0?(n(),d("span",sa,"â†’")):V("",!0)],14,Qs))),128))])):(n(),d("p",Xs," ÐÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),s("footer",aa,[s("button",{class:"btn",onClick:a[1]||(a[1]=p=>k.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):o.value===2?(n(),d("div",ra,[s("header",la,[s("button",{class:"btn-back",onClick:C,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",oa," Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÑ‚Ð°Ð´Ð¸Ð¸: "+W(((m=i.value)==null?void 0:m.stageName)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),s("button",{class:"modal__close",onClick:a[2]||(a[2]=p=>k.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",ia,[M(Z,{name:"loading",mode:"out-in"},{default:q(()=>{var p;return[E.value?(n(),d("div",na,[...a[5]||(a[5]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):_.value?(n(),d("div",ca,[a[6]||(a[6]=s("div",{class:"error-icon"},"âš ï¸",-1)),a[7]||(a[7]=s("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),s("p",da,W(_.value),1),s("button",{class:"btn btn-retry",onClick:O},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):c.value.length===0?(n(),d("div",ua,[a[8]||(a[8]=s("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),s("p",ka," ÐÐ° ÑÑ‚Ð°Ð´Ð¸Ð¸ Â«"+W((p=i.value)==null?void 0:p.stageName)+"Â» Ð½ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ ",1)])):(n(),d("div",va,[M(ie,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(n(!0),d(z,null,J(c.value,(A,S)=>(n(),Q(ne,{key:A.id,ticket:A,draggable:!1,style:ee({"--ticket-index":S}),onClick:u},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):V("",!0)]}),_:1})])])):V("",!0)}},ma=oe(ya,[["__scopeId","data-v-4af0cfce"]]),_a={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},ha={class:"modal"},pa={key:"level-1",class:"level-1"},ga={class:"modal__header"},Ta={class:"modal__title"},fa={key:0},ba={class:"modal__body"},Ca={key:"loading",class:"loading-names"},wa={key:"empty",class:"modal__empty"},Wa={key:"list",class:"duration-list"},Ea=["onClick"],Ia={class:"duration-list__name"},$a={class:"duration-list__count"},Da={key:0,class:"duration-list__arrow"},Aa={class:"modal__footer"},Sa={key:"level-2",class:"level-2"},Ua={class:"modal__header"},Oa={class:"modal__title"},Ba={class:"modal__body"},Ra={key:"loading",class:"loading-state"},Na={key:"error",class:"error-state"},Ma={class:"error-message"},Pa={key:"empty",class:"empty-state"},La={class:"empty-state-message"},Fa={key:"tickets",class:"tickets-list-container"},Ya={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(b,{emit:t}){const e=b,o=I(1),i=I(null),c=I([]),E=I(!1),y=I(!1),_=I(null),g=I([]),$=H(()=>g.value.length>0&&g.value.some(k=>k.count>0));async function N(){if(!e.weekStartUtc||!e.weekEndUtc){g.value=[];return}y.value=!0,_.value=null;try{const k=await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});g.value=k.data.carryoverTicketsByDuration||[]}catch(k){_.value=k.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹",console.error("[CarryoverDurationModal] Error loading categories:",k),g.value=[]}finally{y.value=!1}}async function D(k,a=null){!k||k.count===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),i.value=k,o.value=2,await R(k.durationCategory))}async function R(k){var a;E.value=!0,_.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const p=(a=(await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})).data.carryoverTicketsByDuration)==null?void 0:a.find(S=>S.durationCategory===k),A=(p==null?void 0:p.tickets)||[];try{const{prepareTicketsForDisplay:S}=await le(async()=>{const{prepareTicketsForDisplay:P}=await import("./ticketListUtils-CPelAA9m.js").then(L=>L.t);return{prepareTicketsForDisplay:P}},__vite__mapDeps([0,1,2,3,4,5]));c.value=await S(A,null,null)}catch(S){console.error("[CarryoverDurationModal] Error preparing tickets:",S),c.value=A}c.value.length===0&&(_.value=null)}catch(m){_.value=m.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[CarryoverDurationModal] Error loading tickets:",m),c.value=[]}finally{E.value=!1}}function C(){o.value=1,i.value=null,c.value=[],_.value=null}function u(k){const a=ue(k.id);window.open(a,"_blank")}function O(){i.value&&R(i.value.durationCategory)}return te(()=>e.isVisible,k=>{k?N():(o.value=1,i.value=null,c.value=[],_.value=null,g.value=[])}),te([()=>e.weekStartUtc,()=>e.weekEndUtc],()=>{e.isVisible&&N()}),(k,a)=>b.isVisible?(n(),d("div",_a,[s("div",ha,[M(Z,{name:"level",mode:"out-in"},{default:q(()=>{var m;return[o.value===1?(n(),d("div",pa,[s("header",ga,[s("h3",Ta,[a[3]||(a[3]=re(" ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ€Ð¾ÐºÐ°Ð¼",-1)),b.weekNumber?(n(),d("span",fa," Â· ÐÐµÐ´ÐµÐ»Ñ "+W(b.weekNumber),1)):V("",!0)]),s("button",{class:"modal__close",onClick:a[0]||(a[0]=p=>k.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",ba,[M(Z,{name:"loading",mode:"out-in"},{default:q(()=>[y.value?(n(),d("div",Ca,[...a[4]||(a[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹...",-1)])])):$.value?(n(),d("ul",Wa,[(n(!0),d(z,null,J(g.value,p=>(n(),d("li",{key:p.durationCategory,class:K(["duration-list__item",{"duration-list__item--clickable":p.count>0}]),style:ee({"--duration-color":p.color}),onClick:A=>D(p,A),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"},[s("span",{class:"duration-list__color",style:ee({backgroundColor:p.color})},null,4),s("span",Ia,W(p.durationLabel),1),s("span",$a,W(p.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),p.count>0?(n(),d("span",Da,"â†’")):V("",!0)],14,Ea))),128))])):(n(),d("p",wa," ÐÐµÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),s("footer",Aa,[s("button",{class:"btn",onClick:a[1]||(a[1]=p=>k.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):o.value===2?(n(),d("div",Sa,[s("header",Ua,[s("button",{class:"btn-back",onClick:C,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),s("h3",Oa," Ð¢Ð¸ÐºÐµÑ‚Ñ‹: "+W(((m=i.value)==null?void 0:m.durationLabel)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),s("button",{class:"modal__close",onClick:a[2]||(a[2]=p=>k.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),s("section",Ba,[M(Z,{name:"loading",mode:"out-in"},{default:q(()=>{var p;return[E.value?(n(),d("div",Ra,[...a[5]||(a[5]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):_.value?(n(),d("div",Na,[a[6]||(a[6]=s("div",{class:"error-icon"},"âš ï¸",-1)),a[7]||(a[7]=s("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),s("p",Ma,W(_.value),1),s("button",{class:"btn btn-retry",onClick:O},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):c.value.length===0?(n(),d("div",Pa,[a[8]||(a[8]=s("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),s("p",La," Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Â«"+W((p=i.value)==null?void 0:p.durationLabel)+"Â» Ð½ÐµÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1)])):(n(),d("div",Fa,[M(ie,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(n(!0),d(z,null,J(c.value,(A,S)=>(n(),Q(ne,{key:A.id,ticket:A,draggable:!1,style:ee({"--ticket-index":S}),onClick:u},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):V("",!0)]}),_:1})])])):V("",!0)}},Ga=oe(Ya,[["__scopeId","data-v-c26f06c2"]]),Va={class:"ac-dashboard"},ja={key:1},Ha={class:"dashboard-header"},qa={class:"header-content"},xa={class:"breadcrumbs-row"},za=["aria-label","aria-disabled","data-fallback","disabled"],Ja={class:"breadcrumbs","aria-label":"ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ"},Za={class:"dashboard-layout"},Xa={class:"filters-container"},Ka={class:"chart-container"},Qa={__name:"GraphAdmissionClosureDashboard",setup(b){const t=Be(),e=I(!0),o=I(null),i=I(null),c=I({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),E=I(!1),y=I(!1),_=I(!1),g=I(!1),$=H(()=>typeof window>"u"?!1:window.history.length>1),N=H(()=>$.value?"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ":"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"),D={name:"dashboard-sector-1c"};function R(f){var T;if((T=f==null?void 0:f.preventDefault)==null||T.call(f),!g.value){g.value=!0;try{if($.value){t.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),t.push(D)}finally{g.value=!1}}}const C=I({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),u=I(null),O=H(()=>{const f=C.value.customDateRange.startDate||C.value.customDateRange.endDate,T=C.value.employees.length===1&&C.value.employees.includes("all");return f||!T});async function k(){e.value=!0,o.value=null;try{let f,T;if(u.value)f=u.value.startUtc,T=u.value.endUtc;else{const l=x();f=l.weekStartUtc,T=l.weekEndUtc}const{meta:B,data:Y}=await se({product:"1C",weekStartUtc:f,weekEndUtc:T,includeTickets:!0});i.value=B,c.value=Y,!u.value&&B&&(u.value={weekNumber:B.weekNumber,startUtc:B.weekStartUtc,endUtc:B.weekEndUtc})}catch(f){o.value=f instanceof Error?f:new Error("ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸"),console.error("[GraphAdmissionClosureDashboard] loadData error:",f)}finally{e.value=!1}}function a(f){C.value.stages=f}function m(f){C.value.employees=f}function p(f){C.value.dateRange=f}function A(f){C.value.customDateRange=f}function S(f){u.value=f}function P(){C.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},L()}function L(){k()}Ue(()=>{k()});function x(){const f=new Date,T=new Date(Date.UTC(f.getUTCFullYear(),f.getUTCMonth(),f.getUTCDate())),B=T.getUTCDay(),Y=T.getUTCDate()-B+(B===0?-6:1),l=new Date(Date.UTC(T.getUTCFullYear(),T.getUTCMonth(),Y,0,0,0)),r=new Date(l);return r.setUTCDate(r.getUTCDate()+6),r.setUTCHours(23,59,59,999),{weekStartUtc:l.toISOString(),weekEndUtc:r.toISOString()}}return(f,T)=>{var Y,l,r,v,w,U,F,h,G;const B=Re("router-link");return n(),d("div",Va,[e.value?(n(),Q(Ne,{key:0,message:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…..."})):(n(),d("div",ja,[s("div",Ha,[s("div",qa,[s("div",xa,[s("button",{class:"btn-back-link",type:"button",onClick:R,"aria-label":N.value,"aria-disabled":!$.value,"data-fallback":!$.value,disabled:g.value,title:"ÐÐ°Ð·Ð°Ð´"}," â† ",8,za),s("nav",Ja,[M(B,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:q(()=>[...T[6]||(T[6]=[re(" Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡ ",-1)])]),_:1}),T[8]||(T[8]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),M(B,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:q(()=>[...T[7]||(T[7]=[re(" Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ",-1)])]),_:1}),T[9]||(T[9]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),T[10]||(T[10]=s("span",{class:"breadcrumb-current"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹",-1))])]),T[11]||(T[11]=s("h1",{class:"dashboard-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),T[12]||(T[12]=s("p",{class:"dashboard-subtitle"}," Ð”Ð¾ÑÑ‚ÑƒÐ¿Ñ‹ Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ñ‹ Â«Ð“Ñ€Ð°Ñ„Ð¸ÐºÑƒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑÂ», ÑÐµÐ»ÐµÐºÑ‚Ð¾Ñ€ ÑÑ‚Ð°Ð¿Ð¾Ð² ÑÐºÑ€Ñ‹Ñ‚. ",-1))])]),s("div",Za,[s("div",Xa,[M(Me,{stages:C.value.stages,employees:C.value.employees,dateRange:C.value.dateRange,customDateRange:C.value.customDateRange,hasActiveFilters:O.value,hideStages:!0,weekPickerMode:!0,selectedWeek:u.value,weeksCount:52,"onUpdate:stages":a,"onUpdate:employees":m,"onUpdate:dateRange":p,"onUpdate:customDateRange":A,"onUpdate:selectedWeek":S,onReset:P,onApply:L},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","selectedWeek"])]),s("div",Ka,[o.value?(n(),Q(Oe,{key:0,type:"error",title:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",message:o.value.message},null,8,["message"])):(n(),Q(mt,{key:1,meta:i.value,data:c.value,onOpenResponsible:T[0]||(T[0]=X=>E.value=!0),onOpenStages:T[1]||(T[1]=X=>y.value=!0),onOpenCarryover:T[2]||(T[2]=X=>_.value=!0)},null,8,["meta","data"]))])])])),M(Gs,{"is-visible":E.value,responsible:c.value.responsible||[],"closed-tickets-created-this-week":c.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":c.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":c.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":c.value.responsibleCreatedOtherWeek||[],"week-number":((Y=i.value)==null?void 0:Y.weekNumber)||null,"week-start-utc":((l=i.value)==null?void 0:l.weekStartUtc)||null,"week-end-utc":((r=i.value)==null?void 0:r.weekEndUtc)||null,onClose:T[3]||(T[3]=X=>E.value=!1)},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),M(ma,{"is-visible":y.value,"week-number":((v=i.value)==null?void 0:v.weekNumber)||null,"week-start-utc":((w=i.value)==null?void 0:w.weekStartUtc)||null,"week-end-utc":((U=i.value)==null?void 0:U.weekEndUtc)||null,onClose:T[4]||(T[4]=X=>y.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"]),M(Ga,{"is-visible":_.value,"week-number":((F=i.value)==null?void 0:F.weekNumber)||null,"week-start-utc":((h=i.value)==null?void 0:h.weekStartUtc)||null,"week-end-utc":((G=i.value)==null?void 0:G.weekEndUtc)||null,onClose:T[5]||(T[5]=X=>_.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"])])}}},lr=oe(Qa,[["__scopeId","data-v-2a1bd13f"]]);export{lr as default};
