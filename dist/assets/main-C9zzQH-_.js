const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./direct-access-config-Cr8cz-Qg.js","./chunk-9iq4XG5J.js","./chunk-C85b5Dwb.js","./access-config-async-B4gCG9mT.js","./chunk-I0uP6mPC.js","./chunk-YawslCp9.js","./WebhookLogsDashboard.vue-D23kZ9Of.js","./WebhookLogDetails.vue-C4Gklzdp.js","./UserListPanel.vue-UqGTy9TV.js","./AnalysisPanel.vue-DqdvIlkS.js","./ManagementPanel.vue-BHFiu4LU.js","./UserProfileModal.vue-2CNq1MOy.js","./BulkActionsModal.vue-z8aWzErt.js","./ExportModal.vue-CuRWScbY.js","./DashboardSector1C.vue-Dme8qC4n.js","./chunk-Cubi9nfx.js","./chunk-D7CjRXFS.js","./chunk-C45358jQ.js","./chunk-CiP68a2J.js","./GraphAdmissionClosureDashboard.vue-BTFqDLca.js","./chunk-DtltKNO3.js","./dashboard-sector-1c-service-B72-t5O0.js","./GraphStateDashboard.vue-oo2YXe-k.js","./TicketsTimeTrackingDashboard.vue-TP2gbwh_.js"])))=>i.map(i=>d[i]);
var gs=Object.defineProperty;var ms=(o,e,s)=>e in o?gs(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var De=(o,e,s)=>ms(o,typeof e!="symbol"?e+"":e,s);import{r as J,c as d,o as c,a as te,b as w,d as fs,t as g,n as z,e as a,f as K,g as M,h as pe,w as we,i as se,F as Z,j as ee,k as Me,l as v,u as Ye,m as he,p as hs,T as Ie,q as ue,v as st,s as bt,x as Je,y as Ke,z as de,A as Ge,B as it,C as vs,D as _t,E as Ot,G as Ft,H as Rt,I as je,J as Bt,K as ys,L as ps,M as Qe,N as bs,O as _s,P as ws,Q as Cs,R as ks,S as Ss,U as xs,V as Ms,W as As,X as Es,Y as Ls}from"./chunk-I0uP6mPC.js";import{a as Vt,_ as re,g as Le}from"./chunk-9iq4XG5J.js";import{C as It}from"./chunk-YawslCp9.js";import"./chunk-C85b5Dwb.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function t(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();const Y=(o,e)=>{const s=o.__vccOpts||o;for(const[t,r]of e)s[t]=r;return s},Ts={name:"App"},Ds={id:"app"};function Is(o,e,s,t,r,l){const n=J("router-view");return c(),d("div",Ds,[te(n)])}const Ps=Y(Ts,[["render",Is]]),Us={name:"StatusMessage",props:{type:{type:String,required:!0,validator:o=>["success","error","info","warning"].includes(o)},title:{type:String,default:null},message:{type:String,default:null}}},Ns={key:0},Os={key:1};function Fs(o,e,s,t,r,l){return c(),d("div",{class:z(["status-message",`status-message--${s.type}`])},[s.title?(c(),d("strong",Ns,g(s.title),1)):w("",!0),s.message?(c(),d("p",Os,g(s.message),1)):w("",!0),fs(o.$slots,"default",{},void 0)],2)}const zt=Y(Us,[["render",Fs],["__scopeId","data-v-7f15d2d7"]]),Rs={name:"LoadingSpinner",props:{message:{type:String,default:"–ó–∞–≥—Ä—É–∑–∫–∞..."}}},Bs={class:"loading-spinner"},Vs={key:0,class:"message"};function zs(o,e,s,t,r,l){return c(),d("div",Bs,[e[0]||(e[0]=a("div",{class:"spinner"},null,-1)),s.message?(c(),d("p",Vs,g(s.message),1)):w("",!0)])}const Ht=Y(Rs,[["render",zs],["__scopeId","data-v-375eac16"]]);function We(){try{if(window.self===window.top)return!1;if(typeof BX24<"u")return!0;try{const o=window.parent.location.origin;return o.includes("bitrix24")||o.includes("kompo.by")}catch{return!1}}catch(o){return console.warn("Error checking Bitrix24 context:",o),!1}}function Hs(){return typeof BX24<"u"}class Pe{static init(e){return new Promise((s,t)=>{if(!We()){console.log("Not inside Bitrix24, skipping BX24.init()"),e&&e(),s();return}if(typeof BX24>"u"){t(new Error("Bitrix24 API not loaded. Make sure script is included: //api.bitrix24.com/api/v1/"));return}const r=setTimeout(()=>{t(new Error("BX24.init() timeout: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥"))},5e3);try{BX24.init(()=>{clearTimeout(r),e&&e(),s()})}catch(l){clearTimeout(r),t(l)}})}static installFinish(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}try{BX24.installFinish(),e()}catch(t){s(t)}})}static callMethod(e,s={}){return new Promise((t,r)=>{if(typeof BX24>"u"){r(new Error("Bitrix24 API not loaded"));return}const l=setTimeout(()=>{r(new Error(`BX24.callMethod(${e}) timeout: –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—ã—Å–∏–ª 10 —Å–µ–∫—É–Ω–¥`))},1e4);try{BX24.callMethod(e,s,n=>{if(clearTimeout(l),n.error()){const i=n.error();r(new Error(i.error_description||i.error||"Unknown error"))}else t(n.data())})}catch(n){clearTimeout(l),r(n)}})}static async getCurrentUser(){if(We()&&Hs())try{const e=await Promise.race([this.callMethod("user.current",{}),new Promise((s,t)=>setTimeout(()=>t(new Error("Timeout")),5e3))]);return console.log("Got user from BX24.callMethod() (interface user):",e?.ID||"unknown"),e}catch(e){console.warn("BX24.callMethod() failed, using proxy API as fallback:",e);try{const t=await new It().getCurrentUser();return console.log("Got user from proxy API (token owner, fallback):",t),t}catch(s){throw console.error("Both BX24 API and proxy API failed:",s),e.message&&e.message.includes("timeout")?new Error("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Bitrix24 API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç."):new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}else return console.warn("Not inside Bitrix24, using proxy API (will return token owner, not interface user)"),await new It().getCurrentUser()}static getUser(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}if(typeof BX24.getUser!="function"){s(new Error("BX24.getUser is not available"));return}BX24.getUser(t=>{e(t)})})}static getAuth(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}BX24.getAuth(t=>{e(t)})})}}const js={name:"InstallPage",components:{StatusMessage:zt,LoadingSpinner:Ht},setup(){const o=M(!0),e=M(null),s=M(null);return pe(async()=>{try{let t=null;if(window.INSTALL_RESULT)t=window.INSTALL_RESULT;else{const r=Vt("/install.php"),l=await fetch(`${r}?get_result=1`);l.ok&&(t=await l.json())}if(!t)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏");if(s.value=t,t.rest_only===!1)if(t.install===!0){e.value={type:"success",title:"‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!",message:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24."};try{await Pe.init(()=>{Pe.installFinish()})}catch(r){console.error("Error finishing installation:",r)}}else e.value={type:"error",title:"‚úó –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."};else e.value={type:"info",title:"REST-only —Ä–µ–∂–∏–º",message:"–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ REST API, –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."}}catch(t){console.error("Error loading install result:",t),e.value={type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ."}}finally{o.value=!1}}),{loading:o,installStatus:e,installInfo:s}}},Ws={class:"install-page"},qs={class:"container"},Xs={key:1,class:"info"};function Js(o,e,s,t,r,l){const n=J("StatusMessage"),i=J("LoadingSpinner");return c(),d("div",Ws,[a("div",qs,[e[1]||(e[1]=a("h1",null,"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1)),t.installStatus?(c(),K(n,{key:0,type:t.installStatus.type,title:t.installStatus.title,message:t.installStatus.message},null,8,["type","title","message"])):w("",!0),t.installInfo?(c(),d("div",Xs,[e[0]||(e[0]=a("h3",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:",-1)),a("pre",null,g(JSON.stringify(t.installInfo,null,2)),1)])):w("",!0),t.loading?(c(),K(i,{key:2,message:"–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."})):w("",!0)])])}const $s=Y(js,[["render",Js],["__scopeId","data-v-d082ec9e"]]),ze={allowedDepartmentIds:[369,366,7],adminDepartmentIds:[369]};function jt(o){return!o||typeof o!="number"?!1:ze.allowedDepartmentIds.includes(o)}function Wt(o){if(!o||!o.UF_DEPARTMENT)return!1;const e=Array.isArray(o.UF_DEPARTMENT)?o.UF_DEPARTMENT:[];return e.length===0?!1:e.some(s=>ze.adminDepartmentIds.includes(s))}const xe={USER_NOT_DETERMINED:"USER_NOT_DETERMINED",ACCESS_DENIED:"ACCESS_DENIED",API_ERROR:"API_ERROR"};class Ee{constructor(e,s=null,t=null,r=null){this.allowed=e,this.errorCode=s,this.errorMessage=t,this.user=r}}class Re{static async checkAccess(){try{const e=We();if(console.log("AccessControlService.checkAccess - isInsideBitrix24:",e),console.log("AccessControlService.checkAccess - window.self === window.top:",window.self===window.top),console.log("AccessControlService.checkAccess - typeof BX24:",typeof BX24),e)console.log("AccessControlService.checkAccess - Inside Bitrix24, skipping direct access check");else{console.log("AccessControlService.checkAccess - Not inside Bitrix24, checking direct access config...");const{isDirectAccessAllowed:l,getDenyMessage:n}=await re(async()=>{const{isDirectAccessAllowed:u,getDenyMessage:_}=await import("./direct-access-config-Cr8cz-Qg.js");return{isDirectAccessAllowed:u,getDenyMessage:_}},__vite__mapDeps([0,1]),import.meta.url),i=await l();if(console.log("AccessControlService.checkAccess - allowDirectAccess:",i),!i){const u=await n();return console.warn("Direct access denied: Application opened directly in browser, but direct access is disabled in config"),console.warn("Deny message:",u),new Ee(!1,xe.ACCESS_DENIED,u,null)}console.log("Direct access allowed: Using primary administrator token from settings.php")}if(e)try{await Promise.race([Pe.init(),new Promise((l,n)=>setTimeout(()=>n(new Error("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥")),5e3))])}catch(l){console.warn("BX24.init() failed, will try proxy API:",l)}let s;try{s=await Promise.race([Pe.getCurrentUser(),new Promise((l,n)=>setTimeout(()=>n(new Error("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø—Ä–µ–≤—ã—Å–∏–ª–æ 10 —Å–µ–∫—É–Ω–¥")),1e4))])}catch(l){console.warn("Bitrix24BxApi.getCurrentUser() failed, trying proxy API:",l);const{Bitrix24ApiProvider:n}=await re(async()=>{const{Bitrix24ApiProvider:i}=await import("./chunk-C85b5Dwb.js").then(u=>u.b);return{Bitrix24ApiProvider:i}},__vite__mapDeps([2,1]),import.meta.url);try{const i=await n.getInstance();s=await Promise.race([i.getCurrentUser(),new Promise((u,_)=>setTimeout(()=>_(new Error("–ü—Ä–æ–∫—Å–∏ API –ø—Ä–µ–≤—ã—Å–∏–ª–æ 5 —Å–µ–∫—É–Ω–¥")),5e3))]),console.log("Got user from proxy API:",s?.ID||"unknown")}catch(i){throw console.error("Both BX24 API and proxy API failed:",i),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}if(!s||!s.ID)return console.warn("AccessControlService.checkAccess - user not determined:",s),new Ee(!1,xe.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.");console.log("AccessControlService.checkAccess - user determined:",{id:s.ID,name:s.NAME,departments:s.UF_DEPARTMENT});const t=s.UF_DEPARTMENT||[];if(console.log("AccessControlService.checkAccess - departmentIds:",t),!Array.isArray(t)||t.length===0){if(console.log("AccessControlService.checkAccess - user has no departments"),!e){const{isDirectAccessAllowed:l}=await re(async()=>{const{isDirectAccessAllowed:i}=await import("./direct-access-config-Cr8cz-Qg.js");return{isDirectAccessAllowed:i}},__vite__mapDeps([0,1]),import.meta.url);if(await l())return console.log("AccessControlService.checkAccess - Direct access allowed, granting access despite no departments"),new Ee(!0,null,null,s)}return console.warn("AccessControlService.checkAccess - Access denied: user has no departments"),new Ee(!1,xe.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ—Ç–¥–µ–ª—É.")}const r=t.some(l=>jt(l));return console.log("AccessControlService.checkAccess - hasAccess:",r),r?(console.log("AccessControlService.checkAccess - Access granted"),new Ee(!0,null,null,s)):(console.warn("AccessControlService.checkAccess - Access denied: no allowed departments"),new Ee(!1,xe.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"))}catch(e){return console.error("AccessControlService.checkAccess error:",e),e.message&&(e.message.includes("CORS")||e.message.includes("blocked")||e.message.includes("ERR_FAILED")||e.message.includes("unknown address space"))&&We()?(console.error("CORS error inside Bitrix24: Cannot determine interface user."),new Ee(!1,xe.API_ERROR,"–û—à–∏–±–∫–∞ CORS: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")):e.message&&e.message.includes("not loaded")?new Ee(!1,xe.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."):new Ee(!1,xe.API_ERROR,"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}static async getCurrentUser(){try{return We()&&await Pe.init(),await Pe.getCurrentUser()}catch(e){return console.error("AccessControlService.getCurrentUser error:",e),null}}}class at{static async logAppEntry(e,s=null){if(!e||!e.ID)return console.warn("[ActivityLoggingService] Invalid user object for app entry logging"),!1;const t={timestamp:new Date().toISOString(),type:"app_entry",user_id:e.ID,user_name:this.getUserName(e),user_email:e.EMAIL||null,ip:s||this.getClientIp(),user_agent:navigator.userAgent,session_id:this.getSessionId()};return await this.saveLog(t)}static async logPageVisit(e,s,t=null){if(!s||!s.ID)return console.warn("[ActivityLoggingService] Invalid user object for page visit logging"),!1;if(!e||!e.path)return console.warn("[ActivityLoggingService] Invalid route object for page visit logging"),!1;const r={timestamp:new Date().toISOString(),type:"page_visit",user_id:s.ID,user_name:this.getUserName(s),route_path:e.path,route_name:e.name||null,route_title:e.meta?.title||null,from_path:t?.path||null,from_name:t?.name||null,session_id:this.getSessionId()};return await this.saveLog(r)}static async saveLog(e){try{const s=Le("/api/user-activity-log.php"),t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)});if(!t.ok){const l=await t.text();return console.error("[ActivityLoggingService] Failed to save log:",{status:t.status,statusText:t.statusText,error:l}),!1}const r=await t.json();return r.success?!0:(console.error("[ActivityLoggingService] API returned error:",r.error),!1)}catch(s){return s.name==="AbortError"?console.warn("[ActivityLoggingService] Request timeout (activity logging skipped)"):console.error("[ActivityLoggingService] Error saving log:",s),!1}}static getSessionId(){const e="activity_session_id";if(sessionStorage.getItem(e))return sessionStorage.getItem(e);const s=this.generateSessionId();return sessionStorage.setItem(e,s),s}static generateSessionId(){const e=Date.now(),s=Math.random().toString(36).substring(2,11);return`${e}-${s}`}static getUserName(e){const s=e.NAME||"",t=e.LAST_NAME||"";return`${s} ${t}`.trim()||e.EMAIL||`User #${e.ID}`}static getClientIp(){return null}static isAppEntryLogged(){return sessionStorage.getItem("app_entry_logged")==="true"}static markAppEntryLogged(){sessionStorage.setItem("app_entry_logged","true")}}const Ks={reports:[{id:1,title:"–û—Ç—á—ë—Ç –ø–æ —Ç–∏–∫–µ—Ç–∞–º",icon:"üìä",route:"/reports/tickets",description:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º",active:!1},{id:2,title:"–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",icon:"üìà",route:"/reports/performance",description:"–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞",active:!1},{id:3,title:"–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º",icon:"üìâ",route:"/reports/deadlines",description:"–ê–Ω–∞–ª–∏–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á",active:!1},{id:4,title:"–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç",icon:"üìã",route:"/reports/summary",description:"–û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",active:!1},{id:5,title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",route:"/dashboard/sector-1c",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0},{id:6,title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",icon:"üìä",route:"/dashboard/graph-state",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–° –≤–æ –≤—Ä–µ–º–µ–Ω–∏",active:!0,category:"analytics",order:6},{id:7,title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–°",icon:"üìà",route:"/dashboard/graph-admission-closure",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0,category:"analytics",order:7},{id:8,title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"‚è±",route:"/dashboard/tickets-time-tracking",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",active:!0,category:"analytics",order:8}]};function Gs(){return Ks.reports.filter(o=>o.active===!0)}const Ys={adminInterfaces:[{id:1,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"üë•",route:"/admin/users",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"},{id:2,title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã",icon:"‚öôÔ∏è",route:"/admin/settings",description:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:3,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",icon:"üìã",route:"/admin/webhook-logs",description:"–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤"},{id:4,title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",icon:"üìä",route:"/admin/usage-stats",description:"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:5,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",icon:"üóëÔ∏è",route:"/admin/cache",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –º–æ–¥—É–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"}]};function Qs(){return[...Ys.adminInterfaces]}const Zs={name:"IndexPage",components:{StatusMessage:zt,LoadingSpinner:Ht},beforeCreate(){console.log("[IndexPage] beforeCreate() called")},created(){console.log("[IndexPage] created() called")},beforeMount(){console.log("[IndexPage] beforeMount() called")},setup(){console.log("[IndexPage] setup() called");const o=Ye(),e=M(!0),s=M(null),t=M(!1),r=M(!1),l=M(""),n=M(null),i=M(null),u=M(!1);console.log("[IndexPage] Initial state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value});const _=M(Gs()),S=M(!1),b=M(Qs()),I=v(()=>n.value?Wt(n.value):!1),A=v(()=>{if(!n.value)return"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";const y=n.value.FIRST_NAME?n.value.FIRST_NAME.trim():"",f=n.value.LAST_NAME?n.value.LAST_NAME.trim():"",m=n.value.NAME?n.value.NAME.trim():"";return y&&f?`${y} ${f}`:m&&f&&m!==f?`${m} ${f}`:y&&m&&y!==m?`${y} ${m}`:m&&m.includes(" ")?m:y||f||m||`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${n.value.ID}`}),k=v(()=>s.value?s.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ":"–û—à–∏–±–∫–∞ API":null),U=v(()=>s.value?s.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É.":s.value:null),N=v(()=>s.value&&s.value.includes("no_install_app")),h=v(()=>Vt("/install.php"));pe(async()=>{console.log("[IndexPage] onMounted() called");try{console.log("[IndexPage] Calling AccessControlService.checkAccess()...");const y=await Re.checkAccess();if(console.log("[IndexPage] Access result:",{allowed:y.allowed,hasUser:!!y.user,user:y.user,errorCode:y.errorCode,errorMessage:y.errorMessage}),y.allowed){if(console.log("[IndexPage] Setting accessAllowed to true"),t.value=!0,n.value=y.user,console.log("[IndexPage] Access allowed, setting state:",{accessAllowed:t.value,hasUser:!!n.value,loading:e.value,accessDenied:r.value}),!at.isAppEntryLogged())try{y.user&&await at.logAppEntry(y.user)&&at.markAppEntryLogged()}catch(f){console.error("[IndexPage] Error logging app entry:",f)}}else{r.value=!0;const f=We(),m=!f&&y.errorCode===xe.ACCESS_DENIED&&y.errorMessage&&y.errorMessage.includes("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø");if(console.log("IndexPage - accessResult:",{errorCode:y.errorCode,errorMessage:y.errorMessage,isInsideB24:f,isDirectAccessDeniedCheck:m}),u.value=m,m&&(l.value=y.errorMessage,console.log("IndexPage - Set direct access denied message:",y.errorMessage)),console.log("IndexPage - State after check:",{accessDenied:r.value,isDirectAccessDenied:u.value,accessErrorMessage:l.value}),!m){if(y.user){const{getAllowedDepartmentIds:P}=await re(async()=>{const{getAllowedDepartmentIds:$}=await import("./access-config-async-B4gCG9mT.js");return{getAllowedDepartmentIds:$}},__vite__mapDeps([3,4,1,5,2]),import.meta.url);i.value={userId:y.user.ID,departmentIds:y.user.UF_DEPARTMENT||[],allowedIds:P()}}y.errorCode===xe.USER_NOT_DETERMINED?l.value="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.":y.errorCode===xe.ACCESS_DENIED?l.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω":l.value=y.errorMessage||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."}}}catch(y){s.value=y.message,console.error("Error checking access:",y)}finally{e.value=!1,console.log("[IndexPage] Final state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value,hasUser:!!n.value,error:s.value})}});const L=y=>{if(!y){console.error("Route is not defined for report");return}o.push(y)},E=()=>{S.value=!0},R=()=>{S.value=!1};return{loading:e,error:s,accessAllowed:t,accessDenied:r,accessErrorMessage:l,currentUser:n,userName:A,debugInfo:i,isDirectAccessDenied:u,errorTitle:k,errorMessage:U,showInstallLink:N,installPageUrl:h,reportsButtons:_,navigateToReport:L,isAdmin:I,showAdminPopup:S,adminButtons:b,openAdminPopup:E,closeAdminPopup:R,navigateToAdmin:y=>{if(!y){console.error("Route is not defined for admin interface");return}o.push(y),R()}}}},ea={class:"index-page"},ta={class:"container"},sa={key:0,class:"install-link"},aa=["href"],oa={key:0,class:"direct-access-denied-info",style:{"margin-top":"15px",padding:"15px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px"}},na={key:1,class:"debug-info",style:{"margin-top":"15px",padding:"10px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px","font-size":"12px"}},ra={key:3,class:"main-content"},ia={class:"greeting-section"},la={class:"greeting-header"},ca={class:"greeting-header-content"},da={class:"greeting-text"},ua={class:"reports-section"},ga={class:"reports-grid"},ma=["onClick"],fa={class:"report-icon"},ha={class:"report-title"},va={key:0,class:"report-description"},ya={class:"admin-popup-header"},pa={class:"admin-popup-content"},ba={class:"admin-buttons-grid"},_a=["onClick"],wa={class:"admin-icon"},Ca={class:"admin-title"},ka={key:0,class:"admin-description"};function Sa(o,e,s,t,r,l){const n=J("StatusMessage"),i=J("LoadingSpinner");return c(),d("div",ea,[a("div",ta,[t.error?(c(),K(n,{key:0,type:"error",title:t.errorTitle,message:t.errorMessage},{default:we(()=>[t.showInstallLink?(c(),d("div",sa,[a("a",{href:t.installPageUrl},"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",8,aa)])):w("",!0)]),_:1},8,["title","message"])):w("",!0),t.loading?(c(),K(i,{key:1,message:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞..."})):w("",!0),!t.loading&&t.accessDenied?(c(),K(n,{key:2,type:"error",title:"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",message:t.accessErrorMessage},{default:we(()=>[t.isDirectAccessDenied?(c(),d("div",oa,[...e[4]||(e[4]=[a("p",{style:{margin:"0 0 10px 0","font-weight":"600",color:"#856404"}},[a("strong",null,"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")],-1),a("ol",{style:{margin:"0","padding-left":"20px",color:"#856404"}},[a("li",null,"–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24"),a("li",null,"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Bitrix24 (placement, –≤–∏–¥–∂–µ—Ç –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É)")],-1)])])):t.debugInfo?(c(),d("div",na,[e[5]||(e[5]=a("strong",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e[6]||(e[6]=a("br",null,null,-1)),se(" ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+g(t.debugInfo.userId),1),e[7]||(e[7]=a("br",null,null,-1)),se(" ID –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+g(t.debugInfo.departmentIds),1),e[8]||(e[8]=a("br",null,null,-1)),se(" –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ID –æ—Ç–¥–µ–ª–æ–≤: "+g(t.debugInfo.allowedIds),1),e[9]||(e[9]=a("br",null,null,-1)),e[10]||(e[10]=a("small",{style:{color:"#856404"}},"–î–æ–±–∞–≤—å—Ç–µ ID –æ—Ç–¥–µ–ª–∞ –≤ —Ñ–∞–π–ª vue-app/src/config/access-config.js",-1))])):w("",!0)]),_:1},8,["message"])):w("",!0),!t.loading&&!t.accessDenied&&t.accessAllowed?(c(),d("div",ra,[a("div",ia,[a("div",la,[a("div",ca,[e[13]||(e[13]=a("h2",{class:"greeting-title"},"–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ò–¢ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –ü–ª–∞–Ω–µ—Ä–∫–∏ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ü–∏–∏",-1)),a("p",da,[e[11]||(e[11]=se(" –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",-1)),a("strong",null,g(t.userName),1),e[12]||(e[12]=se("! ",-1))])]),t.isAdmin?(c(),d("button",{key:0,class:"admin-button-header",onClick:e[0]||(e[0]=(...u)=>t.openAdminPopup&&t.openAdminPopup(...u)),title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"}," ‚öôÔ∏è ")):w("",!0)])]),a("div",ua,[a("div",ga,[(c(!0),d(Z,null,ee(t.reportsButtons,u=>(c(),d("div",{key:u.id,class:"report-button",onClick:_=>t.navigateToReport(u.route)},[a("div",fa,g(u.icon),1),a("div",ha,g(u.title),1),u.description?(c(),d("div",va,g(u.description),1)):w("",!0)],8,ma))),128))])]),t.showAdminPopup&&t.isAdmin?(c(),d("div",{key:0,class:"admin-popup-overlay",onClick:e[3]||(e[3]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))},[a("div",{class:"admin-popup",onClick:e[2]||(e[2]=Me(()=>{},["stop"]))},[a("div",ya,[e[14]||(e[14]=a("h3",{class:"admin-popup-title"},"‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",-1)),a("button",{class:"admin-popup-close",onClick:e[1]||(e[1]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))}," ‚úï ")]),a("div",pa,[a("div",ba,[(c(!0),d(Z,null,ee(t.adminButtons,u=>(c(),d("div",{key:u.id,class:"admin-interface-button",onClick:_=>t.navigateToAdmin(u.route)},[a("div",wa,g(u.icon),1),a("div",Ca,g(u.title),1),u.description?(c(),d("div",ka,g(u.description),1)):w("",!0)],8,_a))),128))])])])])):w("",!0)])):w("",!0)])])}const xa=Y(Zs,[["render",Sa],["__scopeId","data-v-6cc28966"]]),_e=M(new Map),ke=M({hits:0,misses:0,sets:0,invalidations:0}),ht={defaultTTL:5*60*1e3,maxSize:100,enableStats:!0};function Ma(o={}){const{ttl:e=ht.defaultTTL,maxSize:s=ht.maxSize,enableStats:t=ht.enableStats}=o,r=N=>{const h=new WeakSet;return JSON.stringify(N,(L,E)=>{if(typeof E=="object"&&E!==null){if(h.has(E))return"[Circular]";h.add(E)}return typeof E=="function"||E===void 0?null:E})},l=(N,h={})=>{const L=Object.keys(h).sort().reduce((E,R)=>{const F=h[R];if(F==null)E[R]=null;else if(typeof F=="object")try{E[R]=r(F)}catch{E[R]=String(F)}else E[R]=F;return E},{});try{return`${N}_${r(L)}`}catch{const R=Object.keys(L).sort().map(F=>`${F}=${L[F]}`).join("&");return`${N}_${R}`}},n=N=>{const h=_e.value.get(N);return h?Date.now()-h.timestamp>h.ttl?(_e.value.delete(N),t&&ke.value.misses++,null):(h.lastAccessed=Date.now(),t&&ke.value.hits++,h.data):(t&&ke.value.misses++,null)},i=(N,h,L=null)=>{_e.value.size>=s&&u(),_e.value.set(N,{data:h,timestamp:Date.now(),lastAccessed:Date.now(),ttl:L||e}),t&&ke.value.sets++},u=()=>{let N=null,h=1/0;for(const[L,E]of _e.value.entries())E.lastAccessed<h&&(h=E.lastAccessed,N=L);N&&_e.value.delete(N)},_=()=>{_e.value.clear(),t&&(ke.value={hits:0,misses:0,sets:0,invalidations:0})},S=N=>{const h=typeof N=="string"?new RegExp(N):N;let L=0;for(const E of _e.value.keys())h.test(E)&&(_e.value.delete(E),L++);return t&&(ke.value.invalidations+=L),L},b=()=>{const N=Date.now();let h=0;for(const[L,E]of _e.value.entries())N-E.timestamp>E.ttl&&(_e.value.delete(L),h++);return h},I=()=>{const N=ke.value.hits+ke.value.misses,h=N>0?(ke.value.hits/N*100).toFixed(2):0;return{...ke.value,size:_e.value.size,hitRate:`${h}%`}};let A=null;const k=(N=5*60*1e3)=>{A&&clearInterval(A),A=setInterval(()=>{b()},N)},U=()=>{A&&(clearInterval(A),A=null)};return k(),{get:n,set:i,clear:_,invalidate:S,cleanup:b,getCacheKey:l,getStats:I,startAutoCleanup:k,stopAutoCleanup:U}}function Te(o){if(!o||typeof o!="object"||!o.timestamp||typeof o.timestamp!="string"||!o.event||typeof o.event!="string"||!o.category||typeof o.category!="string"||!["tasks","smart-processes","errors"].includes(o.category))return!1;try{new Date(o.timestamp)}catch{return!1}return!0}function Aa(o){if(!o||typeof o!="object")return!1;for(const[e,s]of Object.entries(o))if(typeof s=="function")return!1;return!0}function qe(o){if(!Te(o))return null;const e={timestamp:o.timestamp,event:o.event,category:o.category};return o.ip&&typeof o.ip=="string"&&(e.ip=o.ip),o.payload&&typeof o.payload=="object"&&(e.payload=o.payload),o.details&&Aa(o.details)&&(e.details=o.details),e}function wt(o){return Array.isArray(o)?o.map(e=>qe(e)).filter(e=>e!==null):[]}const{get:Ea,set:La,getCacheKey:Ta,invalidate:Pt}=Ma({ttl:2*60*1e3,maxSize:50});class Ut{static getBaseUrl(){return Le("/api/webhook-logs.php")}static get BASE_URL(){return this.getBaseUrl()}static async getLogs(e={},s=1,t=50,r=!1){if(s<1)throw new Error("Page must be greater than 0");if(t<1||t>1e3)throw new Error("Limit must be between 1 and 1000");const l={category:e.category||null,event:e.event||null,date:e.date||null,hour:e.hour!==void 0?e.hour:null,dateFrom:e.dateFrom||null,dateTo:e.dateTo||null,ip:e.ip||null,status:e.status||null},n=this.getBaseUrl(),i=Ta(n,{filters:l,page:s,limit:t});if(!r){const _=Ea(i);if(_)return console.log("[WebhookLogsApiService] Cache hit:",i.substring(0,50)+"..."),_}console.log("[WebhookLogsApiService] Cache miss:",i.substring(0,50)+"...");const u=new URLSearchParams({page:s.toString(),limit:t.toString()});l.category&&u.append("category",l.category),l.event&&u.append("event",l.event),l.date&&u.append("date",l.date),l.hour!==null&&u.append("hour",l.hour.toString()),l.dateFrom&&u.append("dateFrom",l.dateFrom),l.dateTo&&u.append("dateTo",l.dateTo),l.ip&&u.append("ip",l.ip),l.status&&u.append("status",l.status);try{const _=this.getBaseUrl(),S=await fetch(`${_}?${u.toString()}`);if(!S.ok){const k=await S.text();let U;try{U=JSON.parse(k)}catch{U={error:k}}throw new Error(U.error_description||U.error||`HTTP error! status: ${S.status}`)}const b=await S.json();if(console.log("[WebhookLogsApiService] API response:",{success:b.success,logsCount:b.logs?.length||0,pagination:b.pagination,hasError:!!b.error}),b.error)throw new Error(b.error_description||b.error);if(!b.success)throw console.warn("[WebhookLogsApiService] API returned success=false:",b),new Error("API request failed");if(!Array.isArray(b.logs))throw console.error("[WebhookLogsApiService] Invalid logs format:",b.logs),new Error("Invalid logs format: expected array");const I=wt(b.logs);(!b.pagination||typeof b.pagination!="object")&&(console.warn("[WebhookLogsApiService] Invalid pagination format:",b.pagination),b.pagination={page:s,limit:t,total:I.length,pages:Math.ceil(I.length/t)});const A={success:!0,logs:I,pagination:{page:b.pagination.page||s,limit:b.pagination.limit||t,total:b.pagination.total||I.length,pages:b.pagination.pages||Math.ceil((b.pagination.total||I.length)/t)}};return La(i,A),A}catch(_){throw console.error("[WebhookLogsApiService] Error:",_),_}}static invalidateCacheOnFilterChange(e={},s={}){const t=Pt(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Invalidated ${t} entries on filter change`)}static clearCache(){const e=Pt(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Cleared ${e} entries`)}static async getLogDetails(e,s=null){const t={};return s&&(t.date=s),(await this.getLogs(t,1,1e3)).logs.find(n=>`${n.timestamp}_${n.event}`===e)||null}static async getErrors(e={},s=1,t=50){return this.getLogs({...e,category:"errors"},s,t)}static async getStats(e={}){const s=await this.getLogs(e,1,1e3),t={total:s.pagination.total||s.logs.length,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}};return s.logs.forEach(r=>{r.category==="tasks"?t.tasks++:r.category==="smart-processes"?t.smartProcesses++:r.category==="errors"&&t.errors++,t.byEvent[r.event]||(t.byEvent[r.event]=0),t.byEvent[r.event]++;const l=r.timestamp.split("T")[0];t.byDate[l]||(t.byDate[l]=0),t.byDate[l]++}),t}}function Da(){const o=hs(),e=Ye(),s=new Date().toISOString().split("T")[0],t=M({category:null,event:null,dateFrom:s,dateTo:null,hour:null,ip:null,search:null,status:null}),r=()=>{const _=o.query;t.value={category:_.category||null,event:_.event||null,dateFrom:_.dateFrom||_.date||s,dateTo:_.dateTo||null,hour:_.hour?parseInt(_.hour):null,ip:_.ip||null,search:_.search||null,status:_.status||null}},l=_=>{if(u)return;const S={...o.query};Object.keys(_).forEach(I=>{const A=_[I];A!==null&&A!==""&&A!==void 0?S[I]=A.toString():delete S[I]}),JSON.stringify(S)!==JSON.stringify(o.query)&&(u=!0,e.replace({path:o.path,query:S}).finally(()=>{setTimeout(()=>{u=!1},100)}))},n=_=>{const S={...t.value,..._};JSON.stringify(t.value)!==JSON.stringify(S)&&(t.value=S,l(t.value))},i=()=>{t.value={category:null,event:null,dateFrom:s,dateTo:null,hour:null,ip:null,search:null,status:null},l(t.value)};pe(()=>{r()});let u=!1;return he(()=>o.query,(_,S)=>{if(u)return;JSON.stringify(_)!==JSON.stringify(S)&&r()},{deep:!0}),{filters:t,updateFilters:n,clearFilters:i,loadFiltersFromUrl:r}}function Ia(o,e,s={}){if(!e||!e.trim())return o;const{caseSensitive:t=!1,searchInEvent:r=!0,searchInPayload:l=!0,searchInDetails:n=!0,searchInIp:i=!0,searchInTimestamp:u=!1}=s,_=t?e.trim():e.trim().toLowerCase();return o.filter(S=>{if(r&&S.event&&(t?S.event:S.event.toLowerCase()).includes(_))return!0;if(l&&S.payload)try{const b=JSON.stringify(S.payload);if((t?b:b.toLowerCase()).includes(_))return!0}catch(b){console.warn("Error searching in payload:",b)}if(n&&S.details)try{const b=JSON.stringify(S.details);if((t?b:b.toLowerCase()).includes(_))return!0}catch(b){console.warn("Error searching in details:",b)}return!!(i&&S.ip&&(t?S.ip:S.ip.toLowerCase()).includes(_)||u&&S.timestamp&&(t?S.timestamp:S.timestamp.toLowerCase()).includes(_))})}function pt(o){if(!o||typeof o!="object"||o.category!==void 0&&o.category!==null&&!["tasks","smart-processes","errors"].includes(o.category)||o.date!==void 0&&o.date!==null&&!/^\d{4}-\d{2}-\d{2}$/.test(o.date))return!1;if(o.hour!==void 0&&o.hour!==null){const e=parseInt(o.hour,10);if(isNaN(e)||e<0||e>23)return!1}return!(o.ip!==void 0&&o.ip!==null&&(typeof o.ip!="string"||o.ip.length===0))}function Pa(o){if(!o||typeof o!="object")return!1;const e=parseInt(o.page,10),s=parseInt(o.limit,10),t=parseInt(o.total,10),r=parseInt(o.pages,10);return!(isNaN(e)||e<1||isNaN(s)||s<1||s>1e3||isNaN(t)||t<0||isNaN(r)||r<0)}function Nt(o){if(o==null)return"";const e=String(o),s=e.replace(/"/g,'""');return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${s}"`:s}function Ua(o){return o==null?"":typeof o=="object"?JSON.stringify(o):String(o)}function Na(o,e="webhook-logs.csv",s={}){return new Promise((t,r)=>{try{if(!Array.isArray(o)||o.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{columns:l=null,onProgress:n=null}=s,i=l||Object.keys(o[0]),_=[i.map(k=>Nt(k)).join(",")],S=o.length,b=1e3;for(let k=0;k<S;k+=b){const U=o.slice(k,k+b);if(U.forEach(N=>{const h=i.map(L=>{const E=N[L];return Nt(Ua(E))});_.push(h.join(","))}),n){const N=Math.min(100,Math.round((k+U.length)/S*100));n(N)}}const I="\uFEFF"+_.join(`
`),A=new Blob([I],{type:"text/csv;charset=utf-8;"});qt(A,e),n&&n(100),t()}catch(l){r(l)}})}function Oa(o,e="webhook-logs.json",s={}){return new Promise((t,r)=>{try{if(!Array.isArray(o)||o.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{pretty:l=!0,onProgress:n=null}=s,i=l?JSON.stringify(o,null,2):JSON.stringify(o);n&&n(50);const u=new Blob([i],{type:"application/json;charset=utf-8;"});qt(u,e),n&&n(100),t()}catch(l){r(l)}})}function qt(o,e){const s=URL.createObjectURL(o),t=document.createElement("a");t.href=s,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(s)},100)}function Fa(o,e={},s=0){const t=new Date().toISOString().split("T")[0],r=new Date().toTimeString().split(" ")[0].replace(/:/g,"-");let l=`webhook-logs_${t}_${r}`;const n=[];return e.category&&n.push(`cat-${e.category}`),e.event&&n.push(`evt-${e.event.substring(0,10)}`),e.dateFrom&&n.push(`from-${e.dateFrom}`),e.dateTo&&n.push(`to-${e.dateTo}`),n.length>0&&(l+=`_${n.join("-")}`),s>0&&(l+=`_${s}records`),`${l}.${o}`}function Ra(o){const e=[];if(!Array.isArray(o))return e.push("–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),{valid:!1,errors:e,estimatedSize:0};if(o.length===0)return e.push("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"),{valid:!1,errors:e,estimatedSize:0};const s=JSON.stringify(o).length,t=50*1024*1024;return s>t&&e.push(`–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö (${Math.round(s/1024/1024)} MB). –≠–∫—Å–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è.`),{valid:e.length===0,errors:e,estimatedSize:s}}function Ct(o,e="short"){if(!o)return"‚Äî";try{const s=new Date(o);if(isNaN(s.getTime()))return"Invalid date";switch(e){case"short":return s.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});case"long":return s.toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});case"relative":return Ba(s);default:return s.toLocaleString("ru-RU")}}catch{return"Invalid date"}}function Ba(o){const s=new Date-o,t=Math.floor(s/1e3),r=Math.floor(t/60),l=Math.floor(r/60),n=Math.floor(l/24);return t<60?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":r<60?`${r} ${vt(r,"–º–∏–Ω—É—Ç—É","–º–∏–Ω—É—Ç—ã","–º–∏–Ω—É—Ç")} –Ω–∞–∑–∞–¥`:l<24?`${l} ${vt(l,"—á–∞—Å","—á–∞—Å–∞","—á–∞—Å–æ–≤")} –Ω–∞–∑–∞–¥`:n<7?`${n} ${vt(n,"–¥–µ–Ω—å","–¥–Ω—è","–¥–Ω–µ–π")} –Ω–∞–∑–∞–¥`:Ct(o.toISOString(),"short")}function vt(o,e,s,t){const r=o%10,l=o%100;return r===1&&l!==11?e:r>=2&&r<=4&&(l<10||l>=20)?s:t}function Xe(o){return o?o.replace(/^ON/,"").split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):"‚Äî"}function Ue(o){return{tasks:"–ó–∞–¥–∞—á–∏","smart-processes":"–°–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å—ã",errors:"–û—à–∏–±–∫–∏"}[o]||o}function kt(o){if(!o||typeof o!="object")return"‚Äî";const e=[];if(o.task_id&&e.push(`–ó–∞–¥–∞—á–∞ #${o.task_id}`),o.entity_id&&e.push(`–°—É—â–Ω–æ—Å—Ç—å #${o.entity_id}`),o.task_title&&e.push(`"${o.task_title}"`),o.title&&e.push(`"${o.title}"`),o.comment_text){const s=o.comment_text.length>50?o.comment_text.substring(0,50)+"...":o.comment_text;e.push(`–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${s}`)}return e.length>0?e.join(" ‚Ä¢ "):"‚Äî"}const Va={name:"WebhookLogsExport",props:{logs:{type:Array,default:()=>[]},selectedLogs:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},totalCount:{type:Number,default:0}},emits:["export-start","export-complete","export-error"],setup(o,{emit:e}){const s=M(!1),t=M("csv"),r=M("all"),l=M(!0),n=M(!1),i=M(0),u=M([]),_=M(null),S=v(()=>o.selectedLogs.length),b=v(()=>o.logs.length>0||o.totalCount>0),I=v(()=>o.filters.category||o.filters.event||o.filters.dateFrom||o.filters.dateTo),A=v(()=>r.value==="selected"?S.value:o.logs.length||o.totalCount),k=v(()=>r.value==="selected"?S.value>0:b.value),U=()=>{i.value=0,u.value=[],_.value=null,S.value>0?r.value="selected":r.value="all",s.value=!0,h()},N=()=>{n.value||(s.value=!1)},h=()=>{const F=L(),y=Ra(F);u.value=y.errors,_.value=y.estimatedSize},L=()=>(r.value==="selected"?o.selectedLogs:o.logs).map(f=>qe(f)).filter(f=>Te(f)?!0:(console.warn("[WebhookLogsExport] Skipping invalid log:",f),!1)),E=async()=>{try{n.value=!0,i.value=0;let F=L();if(F.length===0)throw new Error("–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const y=F.map(P=>({timestamp:P.timestamp,event:P.event,category:P.category,ip:P.ip||null,details:P.details||null,payload:P.payload||null,formatted:{timestamp:Ct(P.timestamp),event:Xe(P.event),category:Ue(P.category),details:kt(P.details)}}));e("export-start",{format:t.value,scope:r.value,count:y.length});const f=Fa(t.value,o.filters,y.length),m=P=>{i.value=P};t.value==="csv"?await Na(y,f,{onProgress:m}):await Oa(y,f,{pretty:l.value,onProgress:m}),e("export-complete",{format:t.value,filename:f,count:y.length}),setTimeout(()=>{n.value=!1,s.value=!1,i.value=0},500)}catch(F){console.error("[WebhookLogsExport] Export error:",F),e("export-error",F),n.value=!1,i.value=0,alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${F.message}`)}},R=F=>F<1024?`${F} B`:F<1024*1024?`${(F/1024).toFixed(2)} KB`:`${(F/1024/1024).toFixed(2)} MB`;return he([r,()=>o.logs,()=>o.selectedLogs],()=>{s.value&&h()}),{showExportModal:s,exportFormat:t,exportScope:r,jsonPretty:l,exporting:n,exportProgress:i,exportWarnings:u,estimatedSize:_,selectedCount:S,hasAllLogs:b,hasFilters:I,exportCount:A,canExport:k,openExportModal:U,closeExportModal:N,handleExport:E,formatSize:R}}},za={class:"webhook-logs-export"},Ha=["disabled","title"],ja={key:0,class:"selected-badge"},Wa={class:"export-modal-header"},qa={class:"export-modal-body"},Xa={class:"export-section"},Ja={class:"radio-group"},$a={class:"export-section"},Ka={class:"radio-group"},Ga=["disabled"],Ya={class:"radio-label"},Qa={key:0},Za={key:1},eo=["disabled"],to={class:"radio-label"},so={key:0,class:"export-section"},ao={class:"checkbox-option"},oo={class:"export-info"},no={class:"info-item"},ro={class:"info-value"},io={key:0,class:"info-item"},lo={class:"info-value"},co={key:1,class:"export-warnings"},uo={key:0,class:"export-progress"},go={class:"progress-bar"},mo={class:"progress-text"},fo={class:"export-modal-footer"},ho=["disabled"],vo={key:0},yo={key:1},po=["disabled"];function bo(o,e,s,t,r,l){return c(),d("div",za,[a("button",{onClick:e[0]||(e[0]=(...n)=>t.openExportModal&&t.openExportModal(...n)),class:"btn-export",disabled:!t.canExport,title:t.canExport?"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"},[e[11]||(e[11]=a("span",{class:"btn-icon"},"üì•",-1)),e[12]||(e[12]=a("span",{class:"btn-text"},"–≠–∫—Å–ø–æ—Ä—Ç",-1)),t.selectedCount>0?(c(),d("span",ja,g(t.selectedCount),1)):w("",!0)],8,Ha),te(Ie,{name:"modal"},{default:we(()=>[t.showExportModal?(c(),d("div",{key:0,class:"export-modal-overlay",onClick:e[10]||(e[10]=(...n)=>t.closeExportModal&&t.closeExportModal(...n))},[a("div",{class:"export-modal",onClick:e[9]||(e[9]=Me(()=>{},["stop"]))},[a("div",Wa,[e[13]||(e[13]=a("h3",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",-1)),a("button",{onClick:e[1]||(e[1]=(...n)=>t.closeExportModal&&t.closeExportModal(...n)),class:"btn-close"},"‚úï")]),a("div",qa,[a("div",Xa,[e[16]||(e[16]=a("h4",null,"–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞",-1)),a("div",Ja,[a("label",{class:z(["radio-option",{active:t.exportFormat==="csv"}])},[ue(a("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=n=>t.exportFormat=n),value:"csv",class:"radio-input"},null,512),[[st,t.exportFormat]]),e[14]||(e[14]=a("span",{class:"radio-label"},[a("strong",null,"CSV"),a("small",null,"–î–ª—è Excel, LibreOffice")],-1))],2),a("label",{class:z(["radio-option",{active:t.exportFormat==="json"}])},[ue(a("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=n=>t.exportFormat=n),value:"json",class:"radio-input"},null,512),[[st,t.exportFormat]]),e[15]||(e[15]=a("span",{class:"radio-label"},[a("strong",null,"JSON"),a("small",null,"–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, API")],-1))],2)])]),a("div",$a,[e[19]||(e[19]=a("h4",null,"–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",-1)),a("div",Ka,[a("label",{class:z(["radio-option",{active:t.exportScope==="all",disabled:!t.hasAllLogs}])},[ue(a("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=n=>t.exportScope=n),value:"all",disabled:!t.hasAllLogs,class:"radio-input"},null,8,Ga),[[st,t.exportScope]]),a("span",Ya,[e[17]||(e[17]=a("strong",null,"–í—Å–µ –∑–∞–ø–∏—Å–∏",-1)),t.hasFilters?(c(),d("small",Qa,"–° –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ ("+g(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π)",1)):(c(),d("small",Za,"–í—Å–µ–≥–æ: "+g(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π",1))])],2),a("label",{class:z(["radio-option",{active:t.exportScope==="selected",disabled:t.selectedCount===0}])},[ue(a("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=n=>t.exportScope=n),value:"selected",disabled:t.selectedCount===0,class:"radio-input"},null,8,eo),[[st,t.exportScope]]),a("span",to,[e[18]||(e[18]=a("strong",null,"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏",-1)),a("small",null,g(t.selectedCount)+" –∑–∞–ø–∏—Å–µ–π –≤—ã–±—Ä–∞–Ω–æ",1)])],2)])]),t.exportFormat==="json"?(c(),d("div",so,[e[21]||(e[21]=a("h4",null,"–û–ø—Ü–∏–∏ JSON",-1)),a("label",ao,[ue(a("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=n=>t.jsonPretty=n),class:"checkbox-input"},null,512),[[bt,t.jsonPretty]]),e[20]||(e[20]=a("span",{class:"checkbox-label"},"–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)",-1))])])):w("",!0),a("div",oo,[a("div",no,[e[22]||(e[22]=a("span",{class:"info-label"},"–ó–∞–ø–∏—Å–µ–π –∫ —ç–∫—Å–ø–æ—Ä—Ç—É:",-1)),a("span",ro,g(t.exportCount),1)]),t.estimatedSize?(c(),d("div",io,[e[23]||(e[23]=a("span",{class:"info-label"},"–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä:",-1)),a("span",lo,g(t.formatSize(t.estimatedSize)),1)])):w("",!0)]),t.exportWarnings.length>0?(c(),d("div",co,[(c(!0),d(Z,null,ee(t.exportWarnings,(n,i)=>(c(),d("div",{key:i,class:"warning-item"}," ‚ö†Ô∏è "+g(n),1))),128))])):w("",!0)]),t.exporting?(c(),d("div",uo,[a("div",go,[a("div",{class:"progress-fill",style:Je({width:`${t.exportProgress}%`})},null,4)]),a("div",mo," –≠–∫—Å–ø–æ—Ä—Ç: "+g(t.exportProgress)+"% ",1)])):w("",!0),a("div",fo,[a("button",{onClick:e[7]||(e[7]=(...n)=>t.handleExport&&t.handleExport(...n)),disabled:t.exporting||!t.canExport,class:"btn-primary"},[t.exporting?(c(),d("span",vo,"–≠–∫—Å–ø–æ—Ä—Ç...")):(c(),d("span",yo,"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"))],8,ho),a("button",{onClick:e[8]||(e[8]=(...n)=>t.closeExportModal&&t.closeExportModal(...n)),disabled:t.exporting,class:"btn-secondary"}," –û—Ç–º–µ–Ω–∞ ",8,po)])])])):w("",!0)]),_:1})])}const _o=Y(Va,[["render",bo],["__scopeId","data-v-7ae66f8c"]]);function wo(o,e=300){let s;return function(...r){const l=()=>{clearTimeout(s),o(...r)};clearTimeout(s),s=setTimeout(l,e)}}const Co={name:"WebhookLogSearch",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","search"],setup(o,{emit:e}){const s=M(o.modelValue||""),t=M(!1),r=M(null),l=wo(A=>{t.value=!1,e("search",A)},400),n=()=>{t.value=!0,e("update:modelValue",s.value),l(s.value)},i=()=>{t.value=!1,e("search",s.value)},u=()=>{s.value="",t.value=!1,r.value=null,e("update:modelValue",""),e("search","")};return he(()=>o.modelValue,A=>{A!==s.value&&(s.value=A)}),{searchQuery:s,isSearching:t,searchResultsCount:r,handleSearchInput:n,handleSearch:i,clearSearch:u,setResultsCount:A=>{r.value=A},getResultsText:A=>{const k=A%10,U=A%100;return U>=11&&U<=19?"–∑–∞–ø–∏—Å–µ–π":k===1?"–∑–∞–ø–∏—Å—å":k>=2&&k<=4?"–∑–∞–ø–∏—Å–∏":"–∑–∞–ø–∏—Å–µ–π"},performSearch:(A,k)=>{if(!A||!k||!Array.isArray(k))return[];const U=A.toLowerCase().trim();return U.length===0?k:k.map(h=>qe(h)).filter(h=>Te(h)).filter(h=>{if(h.event&&h.event.toLowerCase().includes(U)||h.category&&h.category.toLowerCase().includes(U)||h.ip&&h.ip.toLowerCase().includes(U)||h.details&&typeof h.details=="object"&&(h.details.task_id&&String(h.details.task_id).includes(U)||h.details.task_title&&h.details.task_title.toLowerCase().includes(U)||h.details.entity_id&&String(h.details.entity_id).includes(U)||h.details.title&&h.details.title.toLowerCase().includes(U)||h.details.comment_text&&h.details.comment_text.toLowerCase().includes(U)))return!0;if(h.payload&&typeof h.payload=="object")try{if(JSON.stringify(h.payload).toLowerCase().includes(U))return!0}catch{}return!1})},formatSearchResult:A=>{const k=[];if(A.event&&k.push(Xe(A.event)),A.category&&k.push(Ue(A.category)),A.details){const U=kt(A.details);U!=="‚Äî"&&k.push(U)}return k.join(" ‚Ä¢ ")}}}},ko={class:"webhook-search"},So={class:"search-wrapper"},xo={key:0,class:"search-indicator"},Mo={key:1,class:"search-results"};function Ao(o,e,s,t,r,l){return c(),d("div",ko,[a("div",So,[e[5]||(e[5]=a("span",{class:"search-icon"},"üîç",-1)),ue(a("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>t.searchQuery=n),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ª–æ–≥–æ–≤ (—Å–æ–±—ã—Ç–∏–µ, payload, IP, –¥–µ—Ç–∞–ª–∏)...",class:"search-input",onInput:e[1]||(e[1]=(...n)=>t.handleSearchInput&&t.handleSearchInput(...n)),onKeyup:[e[2]||(e[2]=de((...n)=>t.handleSearch&&t.handleSearch(...n),["enter"])),e[3]||(e[3]=de((...n)=>t.clearSearch&&t.clearSearch(...n),["esc"]))]},null,544),[[Ke,t.searchQuery]]),t.searchQuery?(c(),d("button",{key:0,onClick:e[4]||(e[4]=(...n)=>t.clearSearch&&t.clearSearch(...n)),class:"clear-button",title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ (Esc)","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):w("",!0)]),t.isSearching?(c(),d("div",xo,[...e[6]||(e[6]=[a("span",{class:"spinner"},null,-1),se(" –ü–æ–∏—Å–∫... ",-1)])])):w("",!0),t.searchQuery&&t.searchResultsCount!==null?(c(),d("div",Mo," –ù–∞–π–¥–µ–Ω–æ: "+g(t.searchResultsCount)+" "+g(t.getResultsText(t.searchResultsCount)),1)):w("",!0)])}const Eo=Y(Co,[["render",Ao],["__scopeId","data-v-db228863"]]);function Lo(o,e=null){const s=()=>{try{const n=localStorage.getItem(o);return n?JSON.parse(n):e}catch(n){return console.error(`Error loading ${o} from localStorage:`,n),e}},t=n=>{try{localStorage.setItem(o,JSON.stringify(n))}catch(i){console.error(`Error saving ${o} to localStorage:`,i)}},r=()=>{try{localStorage.removeItem(o)}catch(n){console.error(`Error clearing ${o} from localStorage:`,n)}},l=M(s());return he(l,n=>{t(n)},{deep:!0}),{value:l,save:t,load:s,clear:r}}const To={name:"WebhookLogFilters",props:{filters:{type:Object,required:!0}},emits:["update:filters","reset"],setup(o,{emit:e}){const s=M(null),t=Lo("webhook-filters",{category:null,event:null,dateFrom:null,dateTo:null,hour:null,ip:null,status:null}),r=f=>(s.value=null,pt(f)?(e("update:filters",f),!0):(s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",console.error("[WebhookLogFilters] Validation error:",s.value),!1)),l=new Date().toISOString().split("T")[0],n=M({category:t.value.category||o.filters.category||null,event:t.value.event||o.filters.event||null,dateFrom:t.value.dateFrom||o.filters.dateFrom||o.filters.date||l,dateTo:t.value.dateTo||o.filters.dateTo||null,hour:t.value.hour!==void 0?t.value.hour:o.filters.hour!==void 0?o.filters.hour:null,ip:t.value.ip||o.filters.ip||null,status:t.value.status||o.filters.status||null}),i=M(null),u=[{id:"today",label:"–°–µ–≥–æ–¥–Ω—è",getDates:()=>({from:l,to:l})},{id:"yesterday",label:"–í—á–µ—Ä–∞",getDates:()=>{const f=new Date;f.setDate(f.getDate()-1);const m=f.toISOString().split("T")[0];return{from:m,to:m}}},{id:"last7days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",getDates:()=>{const f=new Date;return f.setDate(f.getDate()-7),{from:f.toISOString().split("T")[0],to:l}}},{id:"last30days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π",getDates:()=>{const f=new Date;return f.setDate(f.getDate()-30),{from:f.toISOString().split("T")[0],to:l}}}],_=f=>{const m=u.find(P=>P.id===f);if(m){const P=m.getDates();n.value.dateFrom=P.from,n.value.dateTo=P.to,i.value=f,F()}};he(()=>o.filters,f=>{n.value={category:f.category||null,event:f.event||null,dateFrom:f.dateFrom||f.date||l,dateTo:f.dateTo||null,hour:f.hour!==void 0?f.hour:null,ip:f.ip||null,status:f.status||null}},{deep:!0}),he(n,f=>{t.value={...f},e("update:filters",{...f})},{deep:!0});const S=v(()=>{const f={};return n.value.category&&(f.category=n.value.category),n.value.event&&(f.event=n.value.event),n.value.hour!==null&&(f.hour=n.value.hour),n.value.ip&&(f.ip=n.value.ip),n.value.status&&(f.status=n.value.status),n.value.dateFrom&&n.value.dateFrom!==l&&(f.dateFrom=n.value.dateFrom),n.value.dateTo&&(f.dateTo=n.value.dateTo),f}),b=v(()=>Object.keys(S.value).length>0),I=f=>({category:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è",event:"–°–æ–±—ã—Ç–∏–µ",hour:"–ß–∞—Å",ip:"IP –∞–¥—Ä–µ—Å",status:"–°—Ç–∞—Ç—É—Å",dateFrom:"–î–∞—Ç–∞ –æ—Ç",dateTo:"–î–∞—Ç–∞ –¥–æ"})[f]||f,A=(f,m)=>f==="category"?Ue(m)||m:f==="hour"?`${String(m).padStart(2,"0")}:00`:f==="event"?Xe(m)||m:f==="status"&&{success:"–£—Å–ø–µ—à–Ω–æ",error:"–û—à–∏–±–∫–∞",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"}[m]||m,k=v(()=>[{value:null,label:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},{value:"tasks",label:Ue("tasks")},{value:"smart-processes",label:Ue("smart-processes")},{value:"errors",label:Ue("errors")}]),U=v(()=>[{value:null,label:"–í—Å–µ —Å–æ–±—ã—Ç–∏—è"},...["ONTASKADD","ONTASKUPDATE","ONTASKDELETE","ONTASKCOMMENTADD","ONTASKCOMMENTUPDATE","ONTASKCOMMENTDELETE","ONCRMDYNAMICITEMADD","ONCRMDYNAMICITEMUPDATE","ONCRMDYNAMICITEMDELETE"].map(m=>({value:m,label:Xe(m)}))]),N=f=>{f==="hour"?n.value[f]=null:f==="dateFrom"?n.value[f]=l:n.value[f]=null,i.value=null},h=f=>{const m={...n.value,category:f||null};r(m)&&(n.value.category=f)},L=f=>{const m={...n.value,event:f||null};r(m)&&(n.value.event=f)},E=(f,m)=>{if(f&&!/^\d{4}-\d{2}-\d{2}$/.test(f)){console.error("[WebhookLogFilters] Invalid date format:",f),s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã";return}const P={...n.value,[m]:f||null};r(P)&&(n.value[m]=f)},R=f=>{if(f!=null){const P=parseInt(f,10);if(isNaN(P)||P<0||P>23){console.error("[WebhookLogFilters] Invalid hour:",f),s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∞—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23)";return}}const m={...n.value,hour:f!=null?parseInt(f,10):null};r(m)&&(n.value.hour=f!=null?parseInt(f,10):null)},F=()=>{r({...n.value})},y=()=>{n.value={category:null,event:null,dateFrom:l,dateTo:null,hour:null,ip:null,status:null},i.value=null,t.clear(),e("reset")};return pe(()=>{t.value&&Object.keys(t.value).length>0&&e("update:filters",{...t.value})}),{localFilters:n,activeFilters:S,hasActiveFilters:b,getFilterLabel:I,getFilterValue:A,clearFilter:N,handleFilterChange:F,handleCategoryChange:h,handleEventChange:L,handleDateChange:E,handleHourChange:R,handleReset:y,quickFilters:u,activeQuickFilter:i,applyQuickFilter:_,categoryOptions:k,eventOptions:U,validationError:s}}},Do={class:"webhook-log-filters"},Io={key:0,class:"active-filters-indicator"},Po=["onClick"],Uo={key:1,class:"validation-error"},No={class:"quick-filters"},Oo=["onClick"],Fo={class:"filters-row"},Ro={class:"filter-group"},Bo=["value"],Vo={class:"filter-group"},zo=["value"],Ho={class:"filter-group"},jo={class:"filter-group"},Wo={class:"filter-group"},qo={class:"filter-group"},Xo={class:"filter-group"};function Jo(o,e,s,t,r,l){return c(),d("div",Do,[t.hasActiveFilters?(c(),d("div",Io,[e[14]||(e[14]=a("span",{class:"indicator-text"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(Z,null,ee(t.activeFilters,(n,i)=>(c(),d("span",{key:i,class:"filter-badge"},[se(g(t.getFilterLabel(i))+": "+g(t.getFilterValue(i,n))+" ",1),a("button",{onClick:u=>t.clearFilter(i),class:"filter-badge-remove",title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"}," √ó ",8,Po)]))),128)),a("button",{onClick:e[0]||(e[0]=(...n)=>t.handleReset&&t.handleReset(...n)),class:"btn-clear-all"}," –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ ")])):w("",!0),t.validationError?(c(),d("div",Uo," ‚ö†Ô∏è "+g(t.validationError),1)):w("",!0),a("div",No,[e[15]||(e[15]=a("span",{class:"quick-filters-label"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(Z,null,ee(t.quickFilters,n=>(c(),d("button",{key:n.id,onClick:i=>t.applyQuickFilter(n.id),class:z(["quick-filter-btn",{active:t.activeQuickFilter===n.id}])},g(n.label),11,Oo))),128))]),a("div",Fo,[a("div",Ro,[e[16]||(e[16]=a("label",{for:"category-filter"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è:",-1)),ue(a("select",{id:"category-filter","onUpdate:modelValue":e[1]||(e[1]=n=>t.localFilters.category=n),onChange:e[2]||(e[2]=n=>t.handleCategoryChange(t.localFilters.category)),class:"filter-select"},[(c(!0),d(Z,null,ee(t.categoryOptions,n=>(c(),d("option",{key:n.value,value:n.value},g(n.label),9,Bo))),128))],544),[[Ge,t.localFilters.category]])]),a("div",Vo,[e[17]||(e[17]=a("label",{for:"event-filter"},"–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:",-1)),ue(a("select",{id:"event-filter","onUpdate:modelValue":e[3]||(e[3]=n=>t.localFilters.event=n),onChange:e[4]||(e[4]=n=>t.handleEventChange(t.localFilters.event)),class:"filter-select"},[(c(!0),d(Z,null,ee(t.eventOptions,n=>(c(),d("option",{key:n.value,value:n.value},g(n.label),9,zo))),128))],544),[[Ge,t.localFilters.event]])]),a("div",Ho,[e[18]||(e[18]=a("label",{for:"date-from-filter"},"–î–∞—Ç–∞ –æ—Ç:",-1)),ue(a("input",{id:"date-from-filter","onUpdate:modelValue":e[5]||(e[5]=n=>t.localFilters.dateFrom=n),type:"date",onChange:e[6]||(e[6]=n=>t.handleDateChange(t.localFilters.dateFrom,"dateFrom")),class:"filter-input"},null,544),[[Ke,t.localFilters.dateFrom]])]),a("div",jo,[e[19]||(e[19]=a("label",{for:"date-to-filter"},"–î–∞—Ç–∞ –¥–æ:",-1)),ue(a("input",{id:"date-to-filter","onUpdate:modelValue":e[7]||(e[7]=n=>t.localFilters.dateTo=n),type:"date",onChange:e[8]||(e[8]=n=>t.handleDateChange(t.localFilters.dateTo,"dateTo")),class:"filter-input"},null,544),[[Ke,t.localFilters.dateTo]])]),a("div",Wo,[e[20]||(e[20]=a("label",{for:"ip-filter"},"IP –∞–¥—Ä–µ—Å:",-1)),ue(a("input",{id:"ip-filter","onUpdate:modelValue":e[9]||(e[9]=n=>t.localFilters.ip=n),type:"text",placeholder:"192.168.1.1",onInput:e[10]||(e[10]=(...n)=>t.handleFilterChange&&t.handleFilterChange(...n)),class:"filter-input"},null,544),[[Ke,t.localFilters.ip]])]),a("div",qo,[e[22]||(e[22]=a("label",{for:"status-filter"},"–°—Ç–∞—Ç—É—Å:",-1)),ue(a("select",{id:"status-filter","onUpdate:modelValue":e[11]||(e[11]=n=>t.localFilters.status=n),onChange:e[12]||(e[12]=(...n)=>t.handleFilterChange&&t.handleFilterChange(...n)),class:"filter-select"},[...e[21]||(e[21]=[a("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),a("option",{value:"success"},"–£—Å–ø–µ—à–Ω–æ",-1),a("option",{value:"error"},"–û—à–∏–±–∫–∞",-1),a("option",{value:"warning"},"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",-1)])],544),[[Ge,t.localFilters.status]])]),a("div",Xo,[a("button",{onClick:e[13]||(e[13]=(...n)=>t.handleReset&&t.handleReset(...n)),class:"btn-reset"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])])}const $o=Y(To,[["render",Jo],["__scopeId","data-v-2a150a46"]]),Ko={name:"WebhookLogList",props:{logs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null},pagination:{type:Object,default:null},selectedLogs:{type:Array,default:()=>[]}},emits:["select-log","page-change","update:selectedLogs"],setup(o,{emit:e}){const s=v(()=>!o.logs||!Array.isArray(o.logs)?(console.warn("[WebhookLogList] Invalid logs prop:",o.logs),[]):o.logs.map(m=>qe(m)).filter(m=>Te(m)?!0:(console.warn("[WebhookLogList] Invalid log entry:",m),!1))),t=M("timestamp"),r=M("desc"),l=m=>{t.value===m?r.value=r.value==="asc"?"desc":"asc":(t.value=m,r.value="desc")},n=v(()=>!s.value||s.value.length===0?[]:[...s.value].sort((P,$)=>{let j,X;switch(t.value){case"timestamp":j=new Date(P.timestamp||0).getTime(),X=new Date($.timestamp||0).getTime();break;case"event":j=(P.event||"").toLowerCase(),X=($.event||"").toLowerCase();break;case"category":j=(P.category||"").toLowerCase(),X=($.category||"").toLowerCase();break;case"ip":j=(P.ip||"").toLowerCase(),X=($.ip||"").toLowerCase();break;default:return 0}return j<X?r.value==="asc"?-1:1:j>X?r.value==="asc"?1:-1:0})),i=m=>t.value!==m?"‚ÜïÔ∏è":r.value==="asc"?"‚Üë":"‚Üì",u=m=>m.category==="errors"?"status-error":"status-success",_=m=>m.category==="errors"?"‚ùå":"‚úÖ",S=m=>m.category==="errors"?"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏":"–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ",b=m=>`${m.timestamp}_${m.event}_${m.ip||"unknown"}`,I=m=>m?Ct(m,"short"):"‚Äî",A=m=>m?Xe(m):"‚Äî",k=m=>m?Ue(m):"‚Äî",U=m=>!m||typeof m!="object"?"‚Äî":kt(m),N=m=>`category-${m}`,h=m=>m?.startsWith("ONTASK")?"event-task":m?.startsWith("ONCRMDYNAMIC")?"event-smart-process":"event-other",L=m=>{e("select-log",m)},E=m=>{m>=1&&m<=o.pagination.pages&&e("page-change",m)},R=m=>o.selectedLogs.some(P=>b(P)===b(m)),F=(m,P)=>{P.stopPropagation();const $=[...o.selectedLogs],j=b(m),X=$.findIndex(T=>b(T)===j);P.target.checked?X===-1&&$.push(m):X!==-1&&$.splice(X,1),e("update:selectedLogs",$)},y=m=>{m.target.checked?e("update:selectedLogs",[...o.logs]):e("update:selectedLogs",[])},f=v(()=>s.value.length>0&&s.value.every(m=>R(m)));return he(()=>o.logs,m=>{if(m&&Array.isArray(m)){const P=m.filter($=>!Te($)).length;P>0&&console.warn(`[WebhookLogList] Received ${P} invalid log entries out of ${m.length}`)}},{immediate:!0}),{validatedLogs:s,sortBy:t,sortOrder:r,sortedLogs:n,handleSort:l,getSortIcon:i,getStatusClass:u,getStatusIcon:_,getStatusTitle:S,getLogId:b,formatTimestamp:I,formatEvent:A,formatCategoryLabel:k,formatDetailsPreview:U,getCategoryClass:N,getEventClass:h,handleLogClick:L,handlePageChange:E,isSelected:R,handleSelectLog:F,handleSelectAll:y,allSelected:f}}},Go={class:"webhook-log-list"},Yo={key:0,class:"logs-table-container"},Qo={class:"logs-table"},Zo={class:"checkbox-header"},en=["checked"],tn={class:"sort-icon"},sn={class:"sort-icon"},an={class:"sort-icon"},on={class:"sort-icon"},nn=["onClick"],rn=["checked","onChange"],ln=["title"],cn={class:"details-preview"},dn=["onClick"],un={key:0,class:"pagination"},gn=["disabled"],mn={class:"pagination-info"},fn=["disabled"];function hn(o,e,s,t,r,l){return c(),d("div",Go,[s.logs.length>0?(c(),d("div",Yo,[a("table",Qo,[a("thead",null,[a("tr",null,[a("th",Zo,[a("input",{type:"checkbox",checked:t.allSelected,onChange:e[0]||(e[0]=(...n)=>t.handleSelectAll&&t.handleSelectAll(...n)),onClick:e[1]||(e[1]=Me(()=>{},["stop"])),class:"checkbox-input",title:"–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"},null,40,en)]),a("th",{onClick:e[2]||(e[2]=n=>t.handleSort("timestamp")),class:z(["sortable",{"sort-asc":t.sortBy==="timestamp"&&t.sortOrder==="asc","sort-desc":t.sortBy==="timestamp"&&t.sortOrder==="desc"}])},[e[9]||(e[9]=se(" –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è ",-1)),a("span",tn,g(t.getSortIcon("timestamp")),1)],2),a("th",{onClick:e[3]||(e[3]=n=>t.handleSort("event")),class:z(["sortable",{"sort-asc":t.sortBy==="event"&&t.sortOrder==="asc","sort-desc":t.sortBy==="event"&&t.sortOrder==="desc"}])},[e[10]||(e[10]=se(" –¢–∏–ø —Å–æ–±—ã—Ç–∏—è ",-1)),a("span",sn,g(t.getSortIcon("event")),1)],2),a("th",{onClick:e[4]||(e[4]=n=>t.handleSort("category")),class:z(["sortable",{"sort-asc":t.sortBy==="category"&&t.sortOrder==="asc","sort-desc":t.sortBy==="category"&&t.sortOrder==="desc"}])},[e[11]||(e[11]=se(" –ö–∞—Ç–µ–≥–æ—Ä–∏—è ",-1)),a("span",an,g(t.getSortIcon("category")),1)],2),a("th",{onClick:e[5]||(e[5]=n=>t.handleSort("ip")),class:z(["sortable",{"sort-asc":t.sortBy==="ip"&&t.sortOrder==="asc","sort-desc":t.sortBy==="ip"&&t.sortOrder==="desc"}])},[e[12]||(e[12]=se(" IP ",-1)),a("span",on,g(t.getSortIcon("ip")),1)],2),e[13]||(e[13]=a("th",null,"–î–µ—Ç–∞–ª–∏",-1)),e[14]||(e[14]=a("th",null,"–î–µ–π—Å—Ç–≤–∏—è",-1))])]),a("tbody",null,[(c(!0),d(Z,null,ee(t.sortedLogs,n=>(c(),d("tr",{key:t.getLogId(n),onClick:i=>t.handleLogClick(n),class:z(["log-row",{"row-selected":t.isSelected(n)}])},[a("td",{onClick:e[6]||(e[6]=Me(()=>{},["stop"]))},[a("input",{type:"checkbox",checked:t.isSelected(n),onChange:i=>t.handleSelectLog(n,i),class:"checkbox-input"},null,40,rn)]),a("td",null,g(t.formatTimestamp(n.timestamp)),1),a("td",null,[a("span",{class:z(["status-indicator",t.getStatusClass(n)]),title:t.getStatusTitle(n)},g(t.getStatusIcon(n)),11,ln),a("span",{class:z(["event-badge",t.getEventClass(n.event)])},g(t.formatEvent(n.event)),3)]),a("td",null,[a("span",{class:z(["category-badge",t.getCategoryClass(n.category)])},g(t.formatCategoryLabel(n.category)),3)]),a("td",null,g(n.ip||"N/A"),1),a("td",null,[a("div",cn,g(t.formatDetailsPreview(n.details)),1)]),a("td",null,[a("button",{onClick:Me(i=>t.handleLogClick(n),["stop"]),class:"btn-view"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,dn)])],10,nn))),128))])]),s.pagination&&s.pagination.pages>1?(c(),d("div",un,[a("button",{onClick:e[7]||(e[7]=n=>t.handlePageChange(s.pagination.page-1)),disabled:s.pagination.page<=1,class:"btn-pagination"}," –ù–∞–∑–∞–¥ ",8,gn),a("span",mn," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+g(s.pagination.page)+" –∏–∑ "+g(s.pagination.pages)+" (–≤—Å–µ–≥–æ: "+g(s.pagination.total)+") ",1),a("button",{onClick:e[8]||(e[8]=n=>t.handlePageChange(s.pagination.page+1)),disabled:s.pagination.page>=s.pagination.pages,class:"btn-pagination"}," –í–ø–µ—Ä—ë–¥ ",8,fn)])):w("",!0)])):w("",!0)])}const vn=Y(Ko,[["render",hn],["__scopeId","data-v-fddd3018"]]),yn={name:"LoadingSkeleton",props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"20px"},variant:{type:String,default:"rect",validator:o=>["rect","circle","text","table-row"].includes(o)},animated:{type:Boolean,default:!0},borderRadius:{type:String,default:null}},setup(o){return{skeletonStyle:v(()=>{const s={width:typeof o.width=="number"?`${o.width}px`:o.width,height:typeof o.height=="number"?`${o.height}px`:o.height};return o.borderRadius&&(s.borderRadius=o.borderRadius),s})}}},pn={key:0,class:"skeleton-shimmer"};function bn(o,e,s,t,r,l){return c(),d("div",{class:z(["skeleton",[`skeleton-${s.variant}`,{"skeleton-animated":s.animated}]]),style:Je(t.skeletonStyle)},[s.animated?(c(),d("div",pn)):w("",!0)],6)}const _n=Y(yn,[["render",bn],["__scopeId","data-v-014f86e6"]]),wn={name:"SkeletonLogList",components:{LoadingSkeleton:_n},props:{rows:{type:Number,default:5}},setup(){return{getColumnWidth:e=>["40px","15%","20%","15%","15%","20%","15%"][e-1]||"100%"}}},Cn={class:"skeleton-log-list"},kn={class:"skeleton-table-header"};function Sn(o,e,s,t,r,l){const n=J("LoadingSkeleton");return c(),d("div",Cn,[a("div",kn,[(c(),d(Z,null,ee(7,i=>te(n,{key:i,width:"120px",height:"16px",variant:"text"})),64))]),(c(!0),d(Z,null,ee(s.rows,i=>(c(),d("div",{key:i,class:"skeleton-table-row"},[(c(),d(Z,null,ee(7,u=>te(n,{key:u,width:"100%",height:"20px",variant:"text",style:Je({width:t.getColumnWidth(u)})},null,8,["style"])),64))]))),128))])}const xn=Y(wn,[["render",Sn],["__scopeId","data-v-475c4e73"]]),Mn={name:"EmptyState",props:{icon:{type:String,default:"üì≠"},title:{type:String,required:!0},description:{type:String,required:!0},actionLabel:{type:String,default:null},actions:{type:Array,default:null},hints:{type:Array,default:()=>[]},variant:{type:String,default:"default",validator:o=>["default","error","warning","info"].includes(o)}},emits:["action","action-click"]},An={class:"empty-icon"},En={class:"empty-title"},Ln={class:"empty-description"},Tn={key:0,class:"empty-hints"},Dn={key:1,class:"empty-actions"},In=["onClick"];function Pn(o,e,s,t,r,l){return c(),d("div",{class:z(["empty-state",`empty-state-${s.variant}`])},[a("div",An,g(s.icon),1),a("h3",En,g(s.title),1),a("p",Ln,g(s.description),1),s.hints&&s.hints.length>0?(c(),d("div",Tn,[(c(!0),d(Z,null,ee(s.hints,(n,i)=>(c(),d("div",{key:i,class:"hint-item"}," üí° "+g(n),1))),128))])):w("",!0),s.actionLabel||s.actions?(c(),d("div",Dn,[s.actionLabel?(c(),d("button",{key:0,onClick:e[0]||(e[0]=n=>o.$emit("action")),class:"btn-primary"},g(s.actionLabel),1)):w("",!0),(c(!0),d(Z,null,ee(s.actions,(n,i)=>(c(),d("button",{key:i,onClick:u=>o.$emit("action-click",n.id),class:z(["btn",`btn-${n.variant||"secondary"}`])},g(n.label),11,In))),128))])):w("",!0)],2)}const Un=Y(Mn,[["render",Pn],["__scopeId","data-v-081c13b9"]]),Nn={name:"ErrorDisplay",props:{title:{type:String,default:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"},message:{type:String,required:!0},details:{type:String,default:null},severity:{type:String,default:"error",validator:o=>["error","warning","critical"].includes(o)},retryable:{type:Boolean,default:!1}},emits:["retry"],setup(){return{showDetails:M(!1)}}},On={class:"error-icon"},Fn={class:"error-content"},Rn={class:"error-title"},Bn={class:"error-message"},Vn={key:0,class:"error-details"},zn={class:"error-actions"};function Hn(o,e,s,t,r,l){return c(),d("div",{class:z(["error-display",`error-${s.severity}`])},[a("div",On,g(s.severity==="critical"?"üö®":"‚ö†Ô∏è"),1),a("div",Fn,[a("h4",Rn,g(s.title),1),a("p",Bn,g(s.message),1),s.details&&t.showDetails?(c(),d("div",Vn,[a("pre",null,g(s.details),1)])):w("",!0),a("div",zn,[s.retryable?(c(),d("button",{key:0,onClick:e[0]||(e[0]=n=>o.$emit("retry")),class:"btn-retry"}," üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")):w("",!0),s.details?(c(),d("button",{key:1,onClick:e[1]||(e[1]=n=>t.showDetails=!t.showDetails),class:"btn-details"},g(t.showDetails?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å")+" –¥–µ—Ç–∞–ª–∏ ",1)):w("",!0)])])],2)}const jn=Y(Nn,[["render",Hn],["__scopeId","data-v-3f2f4c14"]]),$e=M([]);let Wn=0;function Xt(){const o=(i,u="info",_=3e3)=>{const S=++Wn,b={id:S,message:i,type:u,duration:_,timestamp:Date.now()};return $e.value.push(b),_>0&&setTimeout(()=>{e(S)},_),S},e=i=>{const u=$e.value.findIndex(_=>_.id===i);u>-1&&$e.value.splice(u,1)};return{notifications:$e,showNotification:o,removeNotification:e,clearNotifications:()=>{$e.value=[]},success:(i,u=3e3)=>o(i,"success",u),error:(i,u=5e3)=>o(i,"error",u),warning:(i,u=4e3)=>o(i,"warning",u),info:(i,u=3e3)=>o(i,"info",u)}}const qn={name:"Notification",props:{notification:{type:Object,required:!0}},emits:["close"],setup(o,{emit:e}){const s=M(100),t=v(()=>o.notification.duration>0);let r=null;const l={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},n=v(()=>l[o.notification.type]||"‚ÑπÔ∏è"),i=()=>{e("close")},u=()=>{o.notification.onClick&&o.notification.onClick()};return pe(()=>{if(t.value&&o.notification.duration>0){const _=Date.now(),S=o.notification.duration;r=setInterval(()=>{const b=Date.now()-_;s.value=Math.max(0,100-b/S*100),s.value<=0&&(clearInterval(r),i())},50)}}),it(()=>{r&&clearInterval(r)}),{icon:n,progress:s,showProgress:t,close:i,handleClick:u}}},Xn={class:"notification-content"},Jn={class:"notification-icon"},$n={class:"notification-message"},Kn={key:0,class:"notification-progress"};function Gn(o,e,s,t,r,l){return c(),d("div",{class:z(["notification",`notification-${s.notification.type}`]),onClick:e[1]||(e[1]=(...n)=>t.handleClick&&t.handleClick(...n))},[a("div",Xn,[a("span",Jn,g(t.icon),1),a("span",$n,g(s.notification.message),1)]),a("button",{onClick:e[0]||(e[0]=Me((...n)=>t.close&&t.close(...n),["stop"])),class:"notification-close"},"‚úï"),t.showProgress?(c(),d("div",Kn,[a("div",{class:"progress-bar",style:Je({width:`${t.progress}%`})},null,4)])):w("",!0)],2)}const Yn=Y(qn,[["render",Gn],["__scopeId","data-v-1b602bdf"]]),Qn={name:"NotificationContainer",components:{Notification:Yn},setup(){const{notifications:o,removeNotification:e}=Xt();return{notifications:o,removeNotification:e}}},Zn={class:"notification-container"};function er(o,e,s,t,r,l){const n=J("Notification");return c(),K(_t,{to:"body"},[a("div",Zn,[te(vs,{name:"notification",tag:"div"},{default:we(()=>[(c(!0),d(Z,null,ee(t.notifications,i=>(c(),K(n,{key:i.id,notification:i,onClose:u=>t.removeNotification(i.id)},null,8,["notification","onClose"]))),128))]),_:1})])])}const tr=Y(Qn,[["render",er],["__scopeId","data-v-dd8772c8"]]),sr={name:"RealtimeControls",props:{enabled:{type:Boolean,default:!1},connectionState:{type:String,default:"disconnected"},error:{type:String,default:null}},emits:["toggle"],setup(o,{emit:e}){const s=M(o.enabled);he(()=>o.enabled,b=>{s.value=b});const t=v(()=>o.connectionState==="connecting"),r=v(()=>!!o.error),l=v(()=>({"status-connected":o.connectionState==="connected","status-connecting":o.connectionState==="connecting","status-disconnected":o.connectionState==="disconnected","status-error":o.connectionState==="error"})),n=v(()=>{switch(o.connectionState){case"connected":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";case"connecting":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...";case"disconnected":return"–û—Ç–∫–ª—é—á–µ–Ω–æ";case"error":return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}}),i=v(()=>n.value),u=v(()=>({"status-connected":o.connectionState==="connected","status-connecting":o.connectionState==="connecting","status-disconnected":o.connectionState==="disconnected","status-error":o.connectionState==="error"})),_=v(()=>o.error?typeof o.error=="string"?o.error:o.error.message?o.error.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞":null);return{localEnabled:s,isConnecting:t,hasError:r,statusClass:l,statusText:n,connectionStatusText:i,connectionStatusClass:u,displayError:_,handleToggle:()=>{e("toggle",s.value)}}}},ar={class:"realtime-controls"},or={class:"control-toggle"},nr=["disabled"],rr={class:"status-text"},ir={key:0,class:"error-message"};function lr(o,e,s,t,r,l){return c(),d("div",ar,[a("label",or,[ue(a("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=n=>t.localEnabled=n),onChange:e[1]||(e[1]=(...n)=>t.handleToggle&&t.handleToggle(...n)),disabled:t.isConnecting},null,40,nr),[[bt,t.localEnabled]]),e[2]||(e[2]=a("span",{class:"toggle-label"},"–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",-1))]),a("div",{class:z(["status-indicator",t.statusClass])},[e[3]||(e[3]=a("span",{class:"status-dot"},null,-1)),a("span",rr,g(t.statusText),1)],2),t.hasError&&t.displayError?(c(),d("div",ir," ‚ö†Ô∏è "+g(t.displayError),1)):w("",!0)])}const cr=Y(sr,[["render",lr],["__scopeId","data-v-af36f073"]]),dr={name:"NewLogsIndicator",props:{count:{type:Number,default:0},newLogs:{type:Array,default:()=>[]}},emits:["apply","dismiss"],setup(o,{emit:e}){const s=(n,i,u,_)=>{const S=n%10,b=n%100;return b>=11&&b<=19?_:S===1?i:S>=2&&S<=4?u:_},t=v(()=>!o.newLogs||!Array.isArray(o.newLogs)||o.newLogs.length===0?[]:o.newLogs.map(i=>qe(i)).filter(i=>Te(i)).slice(0,5).map(i=>({...i,formatted:{event:Xe(i.event),category:Ue(i.category)}})));return{pluralize:s,newLogsPreview:t,handleApply:()=>{if(!o.newLogs||o.newLogs.length===0)return;const n=o.newLogs.map(i=>qe(i)).filter(i=>Te(i));if(n.length===0){console.warn("[NewLogsIndicator] No valid logs to apply");return}e("apply",n)},handleDismiss:()=>{e("dismiss")}}}},ur={key:0,class:"new-logs-indicator"},gr={class:"indicator-content"},mr={class:"indicator-text"},fr={class:"indicator-actions"};function hr(o,e,s,t,r,l){return c(),K(Ie,{name:"slide-down"},{default:we(()=>[s.count>0?(c(),d("div",ur,[a("div",gr,[e[2]||(e[2]=a("span",{class:"indicator-icon"},"üîî",-1)),a("span",mr,g(s.count)+" "+g(t.pluralize(s.count,"–Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π")),1),a("div",fr,[a("button",{onClick:e[0]||(e[0]=(...n)=>t.handleApply&&t.handleApply(...n)),class:"btn-apply"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å "),a("button",{onClick:e[1]||(e[1]=(...n)=>t.handleDismiss&&t.handleDismiss(...n)),class:"btn-dismiss"}," ‚úï ")])])])):w("",!0)]),_:1})}const vr=Y(dr,[["render",hr],["__scopeId","data-v-19791dbc"]]);class yr{constructor(e,s={}){this.url=e,this.options={reconnectInterval:3e3,maxReconnectAttempts:10,reconnectDelay:1e3,lastTimestamp:null,...s},this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.reconnectTimer=null,this.isManualDisconnect=!1,this.connectionState="disconnected"}updateOptions(e){this.options={...this.options,...e}}connect(){if(this.connectionState==="connected"||this.connectionState==="connecting"){console.warn("[RealtimeService] Already connected or connecting");return}this.isManualDisconnect=!1,this.connectionState="connecting",this.notifyListeners("state-change",{state:this.connectionState});try{let e=this.url;if(!e.startsWith("http://")&&!e.startsWith("https://")){const s=new URL(e,window.location.origin);this.options.lastTimestamp&&s.searchParams.set("last_timestamp",this.options.lastTimestamp),e=s.toString()}else{const s=new URL(e);this.options.lastTimestamp&&s.searchParams.set("last_timestamp",this.options.lastTimestamp),e=s.toString()}console.log("[RealtimeService] Connecting to:",e),this.eventSource=new EventSource(e),this.eventSource.onopen=()=>{console.log("[RealtimeService] EventSource opened"),this.notifyListeners("open",{timestamp:new Date().toISOString()})},this.eventSource.onmessage=s=>{try{const t=JSON.parse(s.data);this.notifyListeners("message",t)}catch(t){console.error("[RealtimeService] Error parsing message:",t)}},this.eventSource.addEventListener("connected",s=>{try{const t=JSON.parse(s.data);console.log("[RealtimeService] Connected event received:",t),this.connectionState="connected",this.reconnectAttempts=0,this.notifyListeners("connected",t),this.notifyListeners("state-change",{state:this.connectionState})}catch(t){console.error("[RealtimeService] Error parsing connected event:",t)}}),this.eventSource.addEventListener("new_logs",s=>{const t=JSON.parse(s.data);if(t.logs&&t.logs.length>0){const r=t.logs[t.logs.length-1];r.timestamp&&(this.options.lastTimestamp=r.timestamp)}this.notifyListeners("new_logs",t)}),this.eventSource.addEventListener("error",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("error",t)}catch{this.notifyListeners("error",{message:"Server error"})}}),this.eventSource.addEventListener("timeout",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("timeout",t)}catch{this.notifyListeners("timeout",{message:"Connection timeout"})}this.reconnect()}),this.eventSource.addEventListener("closed",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("closed",t)}catch{this.notifyListeners("closed",{message:"Connection closed"})}this.isManualDisconnect||this.reconnect()}),this.eventSource.onerror=s=>{console.error("[RealtimeService] Connection error:",s),console.error("[RealtimeService] EventSource readyState:",this.eventSource?.readyState),this.eventSource?.readyState===EventSource.CLOSED?(console.log("[RealtimeService] EventSource closed by server"),this.connectionState="disconnected",this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()):this.eventSource?.readyState===EventSource.CONNECTING?console.log("[RealtimeService] Still connecting..."):(this.connectionState="error",this.notifyListeners("error",{error:s,type:"connection",message:"Failed to connect to realtime stream",readyState:this.eventSource?.readyState}),this.notifyListeners("state-change",{state:this.connectionState}),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isManualDisconnect||this.reconnect())}}catch(e){console.error("[RealtimeService] Error creating EventSource:",e),this.connectionState="error",this.notifyListeners("error",{error:e,type:"initialization"}),this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()}}reconnect(){if(this.isManualDisconnect)return;if(this.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("[RealtimeService] Max reconnect attempts reached"),this.notifyListeners("max-reconnect-attempts",{attempts:this.reconnectAttempts});return}this.reconnectAttempts++;const e=Math.min(this.options.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.options.reconnectInterval);console.log(`[RealtimeService] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},e)}disconnect(){this.isManualDisconnect=!0,this.connectionState="disconnected",this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.notifyListeners("disconnected",{timestamp:new Date().toISOString()}),this.notifyListeners("state-change",{state:this.connectionState})}on(e,s){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(s)}off(e,s){if(this.listeners.has(e)){const t=this.listeners.get(e),r=t.indexOf(s);r>-1&&t.splice(r,1)}}notifyListeners(e,s){this.listeners.has(e)&&this.listeners.get(e).forEach(t=>{try{t(s)}catch(r){console.error(`[RealtimeService] Error in listener for ${e}:`,r)}})}getState(){return this.connectionState}isConnected(){return this.connectionState==="connected"}}function pr(o,e={}){const{autoConnect:s=!1,enableSound:t=!1,onNewLogs:r=null,validateLogs:l=!0}=e,n=new yr(o,e),i=M("disconnected"),u=M([]),_=M(0),S=M(null),b=M(null),I=M(0),A=v(()=>i.value==="connected"),k=v(()=>i.value==="connecting"),U=v(()=>i.value==="error"),N=v(()=>_.value>0),h=j=>{i.value=j.state,j.state==="connected"&&(I.value=0,b.value=null)},L=j=>{let X=j.logs||[];if(l){X=wt(X);const T=X.filter(W=>Te(W));T.length!==X.length&&console.warn("[useRealtime] Filtered out invalid logs:",X.length-T.length),X=T}X.length!==0&&(u.value.push(...X),_.value+=X.length,S.value=new Date().toISOString(),t&&X.length>0&&$(),r&&r(X))},E=j=>{const X=j.message||j.error?.message||"Connection error";b.value=X,i.value="error",console.error("[useRealtime] Error:",j)},R=j=>{console.warn("[useRealtime] Connection timeout:",j)},F=j=>{b.value=`Max reconnect attempts reached (${j.attempts})`,console.error("[useRealtime] Max reconnect attempts:",j)},y=(j={})=>{b.value=null,j.lastTimestamp!==void 0&&n.updateOptions({lastTimestamp:j.lastTimestamp}),n.on("state-change",h),n.on("new_logs",L),n.on("error",E),n.on("timeout",R),n.on("max-reconnect-attempts",F),n.connect()},f=()=>{n.off("state-change",h),n.off("new_logs",L),n.off("error",E),n.off("timeout",R),n.off("max-reconnect-attempts",F),n.disconnect()},m=()=>{u.value=[],_.value=0},P=j=>{j&&Array.isArray(j)&&(j.unshift(...u.value),m())},$=()=>{try{const j=new Audio("/sounds/notification.mp3");j.volume=.3,j.play().catch(X=>{console.warn("[useRealtime] Failed to play sound:",X)})}catch(j){console.warn("[useRealtime] Sound not available:",j)}};return s&&pe(()=>{y()}),it(()=>{f()}),{connectionState:i,isConnected:A,isConnecting:k,hasError:U,newLogs:u,newLogsCount:_,hasNewLogs:N,lastUpdateTime:S,error:b,reconnectAttempts:I,connect:y,disconnect:f,clearNewLogs:m,applyNewLogs:P}}const br=Ot(()=>re(()=>import("./WebhookLogsDashboard.vue-D23kZ9Of.js"),__vite__mapDeps([6,4,1,5,2]),import.meta.url)),_r=Ot(()=>re(()=>import("./WebhookLogDetails.vue-C4Gklzdp.js"),__vite__mapDeps([7,4,1,5,2]),import.meta.url)),wr={name:"WebhookLogsPage",components:{WebhookLogsDashboard:br,WebhookLogsExport:_o,WebhookLogSearch:Eo,WebhookLogFilters:$o,WebhookLogList:vn,WebhookLogDetails:_r,SkeletonLogList:xn,EmptyState:Un,ErrorDisplay:jn,NotificationContainer:tr,RealtimeControls:cr,NewLogsIndicator:vr},setup(){const o=Ye(),{success:e,error:s}=Xt(),t=M(!1),r=M(!1),l=M(null),n=M(null),i=M([]),u=(C,p=2)=>{if(C==null)return String(C);if(typeof C=="string")return C;const H=(B,G=0)=>{if(G>10)return"[Max Depth]";if(B==null||typeof B!="object")return B;if(Array.isArray(B))return B.map(ne=>H(ne,G+1));const oe={};try{for(const ne in B)if(Object.prototype.hasOwnProperty.call(B,ne))try{const Ve=B[ne];if(typeof Ve=="function"||Ve===void 0)continue;oe[ne]=H(Ve,G+1)}catch{oe[ne]="[Error reading property]"}}catch{return"[Error reading object]"}return oe};try{const B=H(C),G=new WeakSet;return JSON.stringify(B,(oe,ne)=>{if(typeof ne=="object"&&ne!==null){if(G.has(ne))return"[Circular]";G.add(ne)}return ne},p)}catch(B){return console.error("[WebhookLogsPage] Error in safeStringify:",B),`[Error: ${B.message}]`}},_=M(null),S=M([]),b=M(""),I=M(null),A=M(null),k=M(!1),{connectionState:U,newLogsCount:N,error:h,connect:L,disconnect:E,applyNewLogs:R,clearNewLogs:F}=pr(Le("/api/webhook-realtime.php"),{autoConnect:!1,enableSound:!0,validateLogs:!0,onNewLogs:C=>{console.log("[WebhookLogsPage] New logs received:",C.length),C.length>0&&(i.value.unshift(...C),P.value.total+=C.length,e(`–ü–æ–ª—É—á–µ–Ω–æ ${C.length} –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π`))}}),{filters:y,updateFilters:f,clearFilters:m}=Da(),P=M({page:1,limit:50,total:0,pages:0}),$=v(()=>{let C=[...i.value];return b.value&&b.value.trim()&&(C=Ia(C,b.value,{caseSensitive:!1,searchInEvent:!0,searchInPayload:!0,searchInDetails:!0,searchInIp:!0})),y.value.category&&(C=C.filter(p=>p.category===y.value.category)),y.value.event&&(C=C.filter(p=>p.event===y.value.event)),y.value.ip&&(C=C.filter(p=>p.ip&&p.ip.includes(y.value.ip))),y.value.status&&(C=C.filter(p=>y.value.status==="error"?p.category==="errors":y.value.status==="success"?p.category!=="errors":!0)),y.value.dateFrom&&(C=C.filter(p=>p.timestamp?new Date(p.timestamp).toISOString().split("T")[0]>=y.value.dateFrom:!1)),y.value.dateTo&&(C=C.filter(p=>p.timestamp?new Date(p.timestamp).toISOString().split("T")[0]<=y.value.dateTo:!1)),y.value.hour!==null&&(C=C.filter(p=>p.timestamp?new Date(p.timestamp).getHours()===y.value.hour:!1)),C});he($,C=>{I.value&&b.value&&I.value.setResultsCount(C.length)});const j=async()=>{try{await Pe.init();const C=await Pe.getCurrentUser();if(console.log("[WebhookLogsPage] User data:",C),!C||!C.ID){console.warn("[WebhookLogsPage] User not determined"),n.value=u({error:"User not determined",userId:C?.ID||null,userName:C?`${C.NAME||""} ${C.LAST_NAME||""}`.trim():null}),t.value=!1;return}const p=C?.UF_DEPARTMENT||[];if(console.log("[WebhookLogsPage] User departments:",p),console.log("[WebhookLogsPage] Allowed departments:",ze.allowedDepartmentIds),p.length>0){const H=p.some(B=>jt(B));console.log("[WebhookLogsPage] Has access:",H),t.value=H,H||(n.value=u({userId:C.ID,userName:`${C.NAME||""} ${C.LAST_NAME||""}`.trim(),userDepartments:p,allowedDepartments:ze.allowedDepartmentIds,message:"User departments do not match allowed departments"}))}else console.warn("[WebhookLogsPage] User has no departments"),n.value=u({userId:C.ID,userName:`${C.NAME||""} ${C.LAST_NAME||""}`.trim(),userDepartments:[],allowedDepartments:ze.allowedDepartmentIds,message:"User has no departments assigned"}),t.value=!1}catch(C){console.error("[WebhookLogsPage] Error checking access:",C),n.value=u({error:C.message,stack:C.stack}),t.value=!1}},X=v(()=>ze.allowedDepartmentIds.join(", ")),T=async(C=!1)=>{if(t.value&&!(ge&&!C)){ge=!0,r.value=!0,l.value=null;try{const p=new Date().toISOString().split("T")[0],H={category:y.value.category||null,event:y.value.event||null,date:y.value.dateFrom||p,hour:y.value.hour!==null&&y.value.hour!==void 0?y.value.hour:null,ip:y.value.ip||null,status:y.value.status||null,dateFrom:y.value.dateFrom||p,dateTo:y.value.dateTo||null};if(!pt(H))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");console.log("[WebhookLogsPage] Loading logs with filters:",H);const B=await Ut.getLogs(H,P.value.page,P.value.limit,C);if(console.log("[WebhookLogsPage] API result:",B),console.log("[WebhookLogsPage] Logs count:",B?.logs?.length||0),console.log("[WebhookLogsPage] Pagination:",B?.pagination),!B.success)throw new Error(B.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤");Pa(B.pagination)?P.value=B.pagination:(console.warn("[WebhookLogsPage] Invalid pagination format, using defaults"),P.value={page:P.value.page,limit:P.value.limit,total:B.logs.length,pages:Math.ceil(B.logs.length/P.value.limit)});const G=wt(B.logs),oe=G.filter(ne=>Te(ne));oe.length!==G.length&&console.warn("[WebhookLogsPage] Filtered out invalid logs:",G.length-oe.length),i.value=oe,C&&e("–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")}catch(p){W(p)}finally{r.value=!1,ge=!1}}},W=C=>{console.error("[WebhookLogsPage] API Error:",C),C.status===403?(l.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",s("–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º –≤–µ–±—Ö—É–∫–æ–≤")):C.status===404?(l.value="–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",s("–õ–æ–≥–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")):C.status>=500?(l.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",s("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")):(l.value=C.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",s(l.value)),C.status>=500&&(i.value=[])},ie=C=>{b.value=C,f({search:C||null})};let ge=!1;const Ne=C=>{if(!pt(C)){s("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");return}const p={category:y.value.category,event:y.value.event,dateFrom:y.value.dateFrom,dateTo:y.value.dateTo,hour:y.value.hour,ip:y.value.ip,status:y.value.status},H={category:C?.category||null,event:C?.event||null,dateFrom:C?.dateFrom||null,dateTo:C?.dateTo||null,hour:C?.hour!==void 0?C.hour:null,ip:C?.ip||null,status:C?.status||null},B=Object.keys(H).some(G=>{const oe=p[G],ne=H[G];return oe!==ne});if(!(!B&&!ge)){if(f(H),P.value.page=1,B)try{Ut.invalidateCacheOnFilterChange(p,H)}catch(G){console.error("[WebhookLogsPage] Error invalidating cache:",G)}ge||(ge=!0,T(!0).finally(()=>{ge=!1}))}},ye=()=>{m(),b.value="",P.value.page=1,T()},Oe=C=>{_.value=C},me=()=>{_.value=null},Fe=C=>{P.value.page=C,T()},be=()=>{try{o.push("/")}catch(C){console.error("Navigation error:",C),window.location.hash="#/"}},x=C=>{S.value=C},O=C=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—á–∞—Ç:",C)},V=C=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω:",C),e(`–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω: ${C.count} –∑–∞–ø–∏—Å–µ–π –≤ —Ñ–∞–π–ª–µ ${C.filename}`)},ae=C=>{console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:",C),s(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${C.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`)},fe=()=>{b.value="",ye()},Ze=C=>{if(console.log("[WebhookLogsPage] Toggle auto-update:",C),k.value=C,C){let p=null;if(i.value.length>0){const H=i.value[0];H.timestamp&&(p=H.timestamp,console.log("[WebhookLogsPage] Using lastTimestamp:",p))}L({lastTimestamp:p})}else E()},et=()=>{R(i.value),e("–ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")},tt=()=>{F()};return pe(async()=>{await j(),t.value&&(y.value.search&&(b.value=y.value.search),await T())}),{hasAccess:t,loading:r,error:l,logs:i,filteredLogs:$,selectedLog:_,selectedLogs:S,filters:y,searchQuery:b,searchComponent:I,pagination:P,previousPeriodStats:A,handleFiltersUpdate:Ne,handleFiltersReset:ye,handleSearch:ie,handleLogSelect:Oe,handleLogClose:me,handlePageChange:Fe,handleSelectedLogsUpdate:x,handleExportStart:O,handleExportComplete:V,handleExportError:ae,handleClearSearch:fe,autoUpdateEnabled:k,connectionState:U,newLogsCount:N,realtimeError:h,handleToggleAutoUpdate:Ze,handleApplyNewLogs:et,handleDismissNewLogs:tt,allowedDepartmentsText:X,accessDebugInfo:n,goBack:be}}},Cr={class:"webhook-logs-page"},kr={class:"page-header"},Sr={class:"page-header-top"},xr={key:0,class:"access-denied"},Mr={class:"access-denied-content"},Ar={class:"access-hint"},Er={key:0,class:"access-debug"},Lr={key:1,class:"page-content"},Tr={class:"actions-bar"};function Dr(o,e,s,t,r,l){const n=J("WebhookLogsDashboard"),i=J("WebhookLogsExport"),u=J("WebhookLogSearch"),_=J("RealtimeControls"),S=J("NewLogsIndicator"),b=J("WebhookLogFilters"),I=J("SkeletonLogList"),A=J("WebhookLogList"),k=J("EmptyState"),U=J("ErrorDisplay"),N=J("WebhookLogDetails"),h=J("NotificationContainer");return c(),d("div",Cr,[a("div",kr,[a("div",Sr,[a("button",{onClick:e[0]||(e[0]=(...L)=>t.goBack&&t.goBack(...L)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[3]||(e[3]=[a("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),a("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[4]||(e[4]=a("h1",null,"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ Bitrix24",-1))]),t.hasAccess?(c(),d("div",Lr,[te(n,{logs:t.logs,pagination:t.pagination,"previous-period-stats":t.previousPeriodStats},null,8,["logs","pagination","previous-period-stats"]),a("div",Tr,[te(i,{logs:t.filteredLogs,"selected-logs":t.selectedLogs,filters:t.filters,"total-count":t.filteredLogs.length,onExportStart:t.handleExportStart,onExportComplete:t.handleExportComplete,onExportError:t.handleExportError},null,8,["logs","selected-logs","filters","total-count","onExportStart","onExportComplete","onExportError"]),te(u,{modelValue:t.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=L=>t.searchQuery=L),onSearch:t.handleSearch,ref:"searchComponent"},null,8,["modelValue","onSearch"])]),te(_,{enabled:t.autoUpdateEnabled,"connection-state":t.connectionState,error:t.realtimeError,onToggle:t.handleToggleAutoUpdate},null,8,["enabled","connection-state","error","onToggle"]),te(S,{count:t.newLogsCount,onApply:t.handleApplyNewLogs,onDismiss:t.handleDismissNewLogs},null,8,["count","onApply","onDismiss"]),te(b,{filters:t.filters,"onUpdate:filters":t.handleFiltersUpdate,onReset:t.handleFiltersReset},null,8,["filters","onUpdate:filters","onReset"]),te(Ie,{name:"fade"},{default:we(()=>[t.loading&&t.logs.length===0?(c(),K(I,{key:0,rows:5})):w("",!0)]),_:1}),te(Ie,{name:"fade"},{default:we(()=>[!t.loading&&t.filteredLogs.length>0?(c(),K(A,{key:0,logs:t.filteredLogs,loading:!1,error:null,pagination:t.pagination,"selected-logs":t.selectedLogs,onSelectLog:t.handleLogSelect,onPageChange:t.handlePageChange,"onUpdate:selectedLogs":t.handleSelectedLogsUpdate},null,8,["logs","pagination","selected-logs","onSelectLog","onPageChange","onUpdate:selectedLogs"])):w("",!0)]),_:1}),te(Ie,{name:"fade"},{default:we(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length===0?(c(),K(k,{key:0,icon:"üì≠",title:"–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",description:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Bitrix24.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è","–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",onAction:t.handleFiltersReset},null,8,["onAction"])):w("",!0)]),_:1}),te(Ie,{name:"fade"},{default:we(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length>0?(c(),K(k,{key:0,icon:"üîç",title:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",description:"–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã","–û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",onAction:t.handleClearSearch},null,8,["onAction"])):w("",!0)]),_:1}),te(Ie,{name:"fade"},{default:we(()=>[t.error?(c(),K(U,{key:0,title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤",message:t.error,retryable:!0,onRetry:o.loadLogs},null,8,["message","onRetry"])):w("",!0)]),_:1}),t.selectedLog?(c(),d("div",{key:0,class:"modal-overlay",onClick:e[2]||(e[2]=(...L)=>t.handleLogClose&&t.handleLogClose(...L))})):w("",!0),te(Ie,{name:"modal"},{default:we(()=>[t.selectedLog?(c(),K(N,{key:0,log:t.selectedLog,onClose:t.handleLogClose},null,8,["log","onClose"])):w("",!0)]),_:1})])):(c(),d("div",xr,[a("div",Mr,[e[7]||(e[7]=a("h2",null,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",-1)),e[8]||(e[8]=a("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤.",-1)),a("p",Ar,[e[5]||(e[5]=se(" –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ –æ—Ç–¥–µ–ª–æ–≤: ",-1)),a("strong",null,g(t.allowedDepartmentsText),1)]),e[9]||(e[9]=a("p",{class:"access-hint"}," –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã. ",-1)),t.accessDebugInfo?(c(),d("details",Er,[e[6]||(e[6]=a("summary",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",-1)),a("pre",null,g(t.accessDebugInfo),1)])):w("",!0)])])),te(h)])}const Ir=Y(wr,[["render",Dr],["__scopeId","data-v-628bf174"]]);class Pr{constructor(){this.currentContext="global",this.contexts={global:new Ur,user:new Nr,management:new Or},this.listeners=new Set,this.history=[],this.maxHistorySize=10,this.initializeContexts()}initializeContexts(){Object.values(this.contexts).forEach(e=>{e.initialize&&e.initialize()})}async switchContext(e,s={},t={}){const r=this.currentContext;try{if(!this.contexts[e])throw new Error(`Unknown context type: ${e}`);await this.beforeContextSwitch(r,e,s),await this.contexts[e].activate(s,t),this.currentContext=e,this.addToHistory({from:r,to:e,data:s,timestamp:Date.now(),options:t}),this.notifyListeners("context-changed",{previousContext:r,currentContext:e,data:s,options:t}),await this.afterContextSwitch(r,e,s)}catch(l){throw console.error("[ContextManager] Context switch failed:",l),this.notifyListeners("context-switch-error",{error:l,attemptedContext:e,data:s}),l}}getCurrentContext(){return this.currentContext}getCurrentContextObject(){return this.contexts[this.currentContext]}getCurrentContextData(){return this.getCurrentContextObject().getData()}getCurrentFilters(){return this.getCurrentContextObject().getFilters()}getCurrentMetrics(){return this.getCurrentContextObject().getMetrics()}getCurrentPermissions(){return this.getCurrentContextObject().getPermissions()}canPerformAction(e){const s=this.getCurrentPermissions();return s&&s[e]===!0}async goBack(){if(this.history.length===0)return!1;const e=this.history[this.history.length-1];return await this.switchContext(e.from,e.data,{...e.options,isBackNavigation:!0}),!0}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}notifyListeners(e,s){this.listeners.forEach(t=>{try{t(e,s)}catch(r){console.error("[ContextManager] Listener error:",r)}})}addToHistory(e){this.history.push(e),this.history.length>this.maxHistorySize&&this.history.shift()}getHistory(e=this.maxHistorySize){return this.history.slice(-e)}clearHistory(){this.history=[]}async beforeContextSwitch(e,s,t){const r=this.contexts[e];r&&r.saveState&&await r.saveState();const l=this.contexts[s];if(l&&l.validateData&&!await l.validateData(t))throw new Error(`Invalid data for context ${s}`)}async afterContextSwitch(e,s,t){const r=this.contexts[s];r&&r.loadData&&await r.loadData(t),typeof window<"u"&&window.analytics&&window.analytics.track("context_switched",{from_context:e,to_context:s,data_keys:Object.keys(t||{}),timestamp:Date.now()})}async reset(){this.currentContext="global",this.clearHistory();for(const e of Object.values(this.contexts))e.reset&&await e.reset();this.notifyListeners("contexts-reset",{})}exportState(){return{currentContext:this.currentContext,history:this.history,contextsState:Object.fromEntries(Object.entries(this.contexts).map(([e,s])=>[e,s.exportState?s.exportState():{}]))}}async importState(e){if(e.currentContext&&(this.currentContext=e.currentContext),e.history&&(this.history=e.history),e.contextsState)for(const[s,t]of Object.entries(e.contextsState)){const r=this.contexts[s];r&&r.importState&&await r.importState(t)}}}class Ur{constructor(){this.data={users:[],globalMetrics:{},filters:{search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc"}},this.permissions={view_users:!0,filter_users:!0,export_data:!0,bulk_actions:!0}}async activate(e={},s={}){(s.forceReload||!this.data.users.length)&&await this.loadGlobalData(),e.filters&&(this.data.filters={...this.data.filters,...e.filters})}async loadGlobalData(){try{this.data.users=[],this.data.globalMetrics={total_users:0,active_users:0,new_users_today:0}}catch(e){throw console.error("[GlobalContext] Failed to load global data:",e),e}}getData(){return this.data}getFilters(){return this.data.filters}getMetrics(){return this.data.globalMetrics}getPermissions(){return this.permissions}async saveState(){localStorage.setItem("um-global-context",JSON.stringify({filters:this.data.filters,timestamp:Date.now()}))}async validateData(e){return!0}exportState(){return{data:this.data,permissions:this.permissions}}async importState(e){e.data&&(this.data={...this.data,...e.data})}}class Nr{constructor(){this.data={user:null,userStats:{},activityData:[],sessionData:[],filters:{timeRange:"week",activity_types:[],devices:[]}},this.permissions={view_user_profile:!0,view_user_activity:!0,edit_user_permissions:!1,delete_user:!1}}async activate(e={},s={}){if(!e.user||!e.user.id)throw new Error("User data is required for user context");this.data.user=e.user,await this.loadUserData(e.user.id)}async loadUserData(e){try{this.data.userStats={total_actions:0,total_sessions:0,avg_session_duration:0,activity_score:0},this.data.activityData=[],this.data.sessionData=[]}catch(s){throw console.error("[UserContext] Failed to load user data:",s),s}}getData(){return this.data}getFilters(){return this.data.filters}getMetrics(){return this.data.userStats}getPermissions(){return this.permissions}async saveState(){localStorage.setItem("um-user-context",JSON.stringify({user_id:this.data.user?.id,filters:this.data.filters,timestamp:Date.now()}))}async validateData(e){return e.user&&typeof e.user=="object"&&e.user.id}exportState(){return{data:this.data,permissions:this.permissions}}async importState(e){e.data&&(this.data={...this.data,...e.data})}}class Or{constructor(){this.data={selectedUsers:[],bulkOperations:[],permissions:{},departments:[],filters:{role_filter:"all",department_filter:"all"}},this.permissions={edit_user_permissions:!0,manage_departments:!0,bulk_edit:!0,view_audit_log:!0}}async activate(e={},s={}){e.selectedUsers&&(this.data.selectedUsers=e.selectedUsers),await this.loadManagementData()}async loadManagementData(){try{this.data.bulkOperations=[],this.data.permissions={},this.data.departments=[]}catch(e){throw console.error("[ManagementContext] Failed to load management data:",e),e}}getData(){return this.data}getFilters(){return this.data.filters}getMetrics(){return{}}getPermissions(){return this.permissions}async saveState(){localStorage.setItem("um-management-context",JSON.stringify({selected_users:this.data.selectedUsers.map(e=>e.id),filters:this.data.filters,timestamp:Date.now()}))}async validateData(e){return!0}exportState(){return{data:this.data,permissions:this.permissions}}async importState(e){e.data&&(this.data={...this.data,...e.data})}}const Ce=new Pr;class St{constructor(){this.migrationVersion="1.0.0",this.migrationHistory=[]}static async migrateUserManagementState(){const e=new St,s={success:!0,migrated:[],skipped:[],errors:[],version:e.migrationVersion};try{if(console.log("[StateMigration] Starting user management state migration..."),e.isMigrationNeeded()){const t=[{name:"viewMode",fn:()=>e.migrateViewMode()},{name:"hiddenUsers",fn:()=>e.migrateHiddenUsers()},{name:"filters",fn:()=>e.migrateFilters()},{name:"userPreferences",fn:()=>e.migrateUserPreferences()},{name:"activityFilters",fn:()=>e.migrateActivityFilters()},{name:"uiState",fn:()=>e.migrateUIState()},{name:"bookmarks",fn:()=>e.migrateBookmarks()}];for(const{name:r,fn:l}of t)try{await l()?(s.migrated.push(r),e.migrationHistory.push({name:r,status:"success",timestamp:Date.now()})):s.skipped.push(r)}catch(n){console.error(`[StateMigration] Migration failed for ${r}:`,n),s.errors.push({name:r,error:n.message}),e.migrationHistory.push({name:r,status:"error",error:n.message,timestamp:Date.now()})}e.saveMigrationVersion(),e.cleanupOldKeys(),console.log("[StateMigration] Migration completed:",s)}else console.log("[StateMigration] Migration not needed - already migrated"),s.skipped.push("all")}catch(t){console.error("[StateMigration] Critical migration error:",t),s.success=!1,s.errors.push({name:"critical",error:t.message})}return e.sendMigrationAnalytics(s),s}isMigrationNeeded(){const e=localStorage.getItem("um-migration-version");return!e||e!==this.migrationVersion}migrateViewMode(){const e=localStorage.getItem("user-management-view-mode");if(!e)return!1;let s="global";switch(e){case"dashboard":s="user";break;case"list":default:s="global";break}return localStorage.setItem("um-context",s),console.log(`[StateMigration] Migrated view mode: ${e} -> ${s}`),!0}migrateHiddenUsers(){const e=localStorage.getItem("hidden-users-list");if(!e)return!1;try{const s=JSON.parse(e);if(!Array.isArray(s))return console.warn("[StateMigration] Invalid hidden users format"),!1;const t=s.map(r=>({id:r.id||r,hidden_at:r.hidden_at||Date.now(),hidden_by:r.hidden_by||"migration"}));return localStorage.setItem("um-hidden-users",JSON.stringify(t)),console.log(`[StateMigration] Migrated ${t.length} hidden users`),!0}catch(s){return console.error("[StateMigration] Failed to parse hidden users:",s),!1}}migrateFilters(){const e=localStorage.getItem("activity-filters");if(!e)return!1;try{const s=JSON.parse(e),t={search:s.search||"",department_ids:s.departments||[],activity_filter:this.convertActivityFilter(s.activityFilter),sort_by:s.sortBy||"last_activity",sort_order:s.sortOrder||"desc",time_range:this.convertTimeRange(s.timeRange),activity_types:s.activityTypes||[],user_status:s.userStatus||"all"};return this.validateFilters(t)?(localStorage.setItem("um-filters",JSON.stringify(t)),console.log("[StateMigration] Migrated filters:",t),!0):(console.warn("[StateMigration] Invalid filters, using defaults"),!1)}catch(s){return console.error("[StateMigration] Failed to parse filters:",s),!1}}migrateUserPreferences(){const e={theme:localStorage.getItem("user-theme")||"light",language:localStorage.getItem("user-language")||"ru",itemsPerPage:this.parseIntSafe(localStorage.getItem("items-per-page"),50),autoRefresh:localStorage.getItem("auto-refresh")==="true",refreshInterval:this.parseIntSafe(localStorage.getItem("refresh-interval"),3e4),compactView:localStorage.getItem("compact-view")==="true",showExtendedMetrics:localStorage.getItem("show-extended-metrics")==="true"};return localStorage.setItem("um-preferences",JSON.stringify(e)),console.log("[StateMigration] Migrated user preferences"),!0}migrateActivityFilters(){const e=localStorage.getItem("activity-dashboard-filters");if(!e)return!1;try{const s=JSON.parse(e),t={dateRange:{start:s.startDate||null,end:s.endDate||null,preset:this.convertDateRangePreset(s.dateRange)},userSegments:s.userSegments||[],activityThresholds:{minActions:s.minActions||0,maxActions:s.maxActions||null,minScore:s.minScore||0},deviceFilters:s.devices||[],locationFilters:s.locations||[],customConditions:s.customFilters||[]};return localStorage.setItem("um-activity-filters",JSON.stringify(t)),console.log("[StateMigration] Migrated activity filters"),!0}catch(s){return console.error("[StateMigration] Failed to parse activity filters:",s),!1}}migrateUIState(){const e={sidebarCollapsed:localStorage.getItem("sidebar-collapsed")==="true",lastSelectedUser:localStorage.getItem("last-selected-user")||null,lastContext:localStorage.getItem("last-context")||"global",navigationHistory:this.parseJsonSafe(localStorage.getItem("navigation-history"),[]),bookmarkedUsers:this.parseJsonSafe(localStorage.getItem("bookmarked-users"),[]),quickActions:this.parseJsonSafe(localStorage.getItem("quick-actions"),[])};return localStorage.setItem("um-ui-state",JSON.stringify(e)),console.log("[StateMigration] Migrated UI state"),!0}migrateBookmarks(){const e=localStorage.getItem("user-bookmarks");if(!e)return!1;try{const t=JSON.parse(e).map(r=>({id:r.id||`bookmark-${Date.now()}`,name:r.name||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",type:r.type||"user",data:r.data||{},created_at:r.created_at||Date.now(),color:r.color||"#2196f3"}));return localStorage.setItem("um-bookmarks",JSON.stringify(t)),console.log(`[StateMigration] Migrated ${t.length} bookmarks`),!0}catch(s){return console.error("[StateMigration] Failed to parse bookmarks:",s),!1}}convertActivityFilter(e){return{active:"active",inactive:"inactive",new:"new",all:"all"}[e]||"all"}convertTimeRange(e){return{today:"today",yesterday:"yesterday",week:"week",month:"month",quarter:"quarter",year:"year",custom:"custom"}[e]||"week"}convertDateRangePreset(e){return{last7days:"week",last30days:"month",last90days:"quarter",last365days:"year",custom:"custom"}[e]||"week"}validateFilters(e){try{return!(typeof e.search!="string"||!Array.isArray(e.department_ids)||typeof e.activity_filter!="string"||typeof e.sort_by!="string"||!["asc","desc"].includes(e.sort_order)||!["name","email","last_activity","total_actions"].includes(e.sort_by)||!["all","active","inactive","new"].includes(e.activity_filter))}catch{return!1}}parseIntSafe(e,s){const t=parseInt(e,10);return isNaN(t)?s:t}parseJsonSafe(e,s){try{return e?JSON.parse(e):s}catch{return s}}saveMigrationVersion(){localStorage.setItem("um-migration-version",this.migrationVersion),localStorage.setItem("um-migration-timestamp",Date.now())}cleanupOldKeys(){const e=["user-management-view-mode","hidden-users-list","activity-filters","activity-dashboard-filters","user-theme","user-language","items-per-page","auto-refresh","refresh-interval","compact-view","show-extended-metrics","sidebar-collapsed","last-selected-user","last-context","navigation-history","bookmarked-users","quick-actions","user-bookmarks"];this.shouldCleanupOldKeys()&&(e.forEach(s=>{localStorage.removeItem(s)}),console.log("[StateMigration] Cleaned up old keys"))}shouldCleanupOldKeys(){return this.migrationHistory.every(e=>e.status==="success")}sendMigrationAnalytics(e){try{typeof window<"u"&&window.analytics&&window.analytics.track("state_migration_completed",{version:e.version,success:e.success,migrated_count:e.migrated.length,skipped_count:e.skipped.length,errors_count:e.errors.length,duration:Date.now()-(localStorage.getItem("um-migration-start")||Date.now()),user_agent:navigator.userAgent})}catch(s){console.warn("[StateMigration] Failed to send analytics:",s)}}static getMigrationStatus(){return{version:localStorage.getItem("um-migration-version"),timestamp:localStorage.getItem("um-migration-timestamp"),isMigrated:!!localStorage.getItem("um-migration-version")}}static resetMigration(){Object.keys(localStorage).filter(s=>s.startsWith("um-")||["user-management-view-mode","hidden-users-list","activity-filters"].includes(s)).forEach(s=>localStorage.removeItem(s)),console.log("[StateMigration] Migration reset completed")}}function Fr(o={}){const e={enablePersistence:o.enablePersistence!==!1,storagePrefix:o.storagePrefix||"um",maxHistorySize:o.maxHistorySize||10,defaultContext:o.defaultContext||"global",...o},s=Ft({users:[],filteredUsers:[],selectedUser:null,selectedUsers:[],currentContext:e.defaultContext,breadcrumbs:[],navigationHistory:[],filters:{search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc",time_range:"week",activity_types:[],user_status:"all"},globalMetrics:[],summaryStats:{total_users:0,active_users:0,new_users_today:0,total_sessions_today:0,avg_session_duration:0,retention_7d:0,retention_30d:0},loading:!1,loadingMessage:"",error:null,pagination:{current_page:1,per_page:50,total:0,total_pages:0},viewOptions:{compactView:!1,showExtendedMetrics:!1,itemsPerPage:50,autoRefresh:!1,refreshInterval:3e4}}),t=v(()=>s.selectedUsers.length>0),r=v(()=>s.selectedUser?.activity_stats?s.selectedUser.activity_stats:{}),l=v(()=>!0),n=v(()=>!0),i=v(()=>{switch(s.currentContext){case"global":return"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏";case"user":return`–ê–Ω–∞–ª–∏–∑: ${s.selectedUser?.name||"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"}`;case"management":return"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞";default:return"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"}}),u=v(()=>s.currentContext==="global"),_=v(()=>s.currentContext==="user"),S=v(()=>s.currentContext==="management"),b=async()=>{try{if(s.loading=!0,s.loadingMessage="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",e.enablePersistence)try{s.loadingMessage="–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞...";const x=await St.migrateUserManagementState();x.success&&x.migrated.length>0&&console.log("[useUnifiedUserManagement] State migration completed:",x)}catch(x){console.warn("[useUnifiedUserManagement] State migration failed, continuing with defaults:",x)}e.enablePersistence&&await I(),await k(),U(),s.viewOptions.autoRefresh&&N()}catch(x){console.error("[useUnifiedUserManagement] Initialization failed:",x),s.error=x.message}finally{s.loading=!1,s.loadingMessage=""}},I=async()=>{try{const x=localStorage.getItem(`${e.storagePrefix}-state`);if(x){const O=JSON.parse(x);Object.assign(s,O)}}catch(x){console.warn("[useUnifiedUserManagement] Failed to load persisted state:",x)}},A=()=>{if(e.enablePersistence)try{const x={filters:s.filters,viewOptions:s.viewOptions,currentContext:s.currentContext,selectedUser:s.selectedUser?.id||null};localStorage.setItem(`${e.storagePrefix}-state`,JSON.stringify(x))}catch(x){console.warn("[useUnifiedUserManagement] Failed to save state:",x)}},k=async()=>{await h(),await L(),await E()},U=()=>{Ce.addListener(Oe),s.currentContext=Ce.getCurrentContext(),T()},N=()=>{const x=setInterval(async()=>{s.loading||await ye()},s.viewOptions.refreshInterval);return()=>clearInterval(x)},h=async(x={})=>{try{s.loading=!0,s.loadingMessage="–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...";const O={page:x.page||s.pagination.current_page,per_page:x.per_page||s.viewOptions.itemsPerPage,...s.filters,...x},V=await me("/api/admin/users/unified",O);s.users=V.data.users||[],s.pagination=V.data.pagination||s.pagination,s.summaryStats=V.data.summary||s.summaryStats,m()}catch(O){throw console.error("[useUnifiedUserManagement] Failed to load users:",O),s.error="–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",O}finally{s.loading=!1,s.loadingMessage=""}},L=async()=>{try{const x=await me("/api/admin/analytics/global",{period:s.filters.time_range});s.globalMetrics=x.data.metrics||[],Object.assign(s.summaryStats,x.data.metrics)}catch(x){console.error("[useUnifiedUserManagement] Failed to load global metrics:",x)}},E=async()=>{try{const[x,O]=await Promise.all([me("/api/admin/departments"),me("/api/admin/activity-types")]);s.departments=x.data||[],s.activityTypes=O.data||[]}catch(x){console.error("[useUnifiedUserManagement] Failed to load filters data:",x)}},R=async x=>{try{s.selectedUser=x,s.selectedUsers=[x],await Ce.switchContext("user",{user:x})}catch(O){console.error("[useUnifiedUserManagement] Failed to select user:",O),s.error="–û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"}},F=()=>{s.selectedUser=null,s.selectedUsers=[]},y=async()=>{try{await Ce.switchContext("global")}catch(x){console.error("[useUnifiedUserManagement] Failed to switch to global:",x)}},f=async(x={})=>{try{await Ce.switchContext("management",x)}catch(O){console.error("[useUnifiedUserManagement] Failed to switch to management:",O)}},m=()=>{let x=[...s.users];if(s.filters.search){const O=s.filters.search.toLowerCase();x=x.filter(V=>V.name.toLowerCase().includes(O)||V.email.toLowerCase().includes(O))}s.filters.department_ids.length>0&&(x=x.filter(O=>O.departments?.some(V=>s.filters.department_ids.includes(V.id)))),s.filters.activity_filter!=="all"&&(x=x.filter(O=>{const V=O.activity_stats?.activity_score||0;switch(s.filters.activity_filter){case"active":return V>=70;case"inactive":return V<30;case"moderate":return V>=30&&V<70;default:return!0}})),x.sort((O,V)=>{let ae,fe;switch(s.filters.sort_by){case"name":ae=O.name.toLowerCase(),fe=V.name.toLowerCase();break;case"email":ae=O.email.toLowerCase(),fe=V.email.toLowerCase();break;case"last_activity":ae=new Date(O.activity_stats?.last_activity||0),fe=new Date(V.activity_stats?.last_activity||0);break;case"total_actions":ae=O.activity_stats?.total_actions||0,fe=V.activity_stats?.total_actions||0;break;default:ae=O.name.toLowerCase(),fe=V.name.toLowerCase()}return s.filters.sort_order==="asc"?ae<fe?-1:ae>fe?1:0:ae>fe?-1:ae<fe?1:0}),s.filteredUsers=x},P=x=>{Object.assign(s.filters,x),m(),A()},$=()=>{s.filters={search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc",time_range:"week",activity_types:[],user_status:"all"},m(),A()},j=(x,O)=>{const V=JSON.parse(localStorage.getItem(`${e.storagePrefix}-presets`)||"[]");V.push({id:Date.now().toString(),name:x,filters:{...O},created_at:new Date().toISOString()}),localStorage.setItem(`${e.storagePrefix}-presets`,JSON.stringify(V))},X=x=>{const V=JSON.parse(localStorage.getItem(`${e.storagePrefix}-presets`)||"[]").find(ae=>ae.id===x);V&&P(V.filters)},T=()=>{const x=[{id:"global",label:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"UsersIcon",action:y}];s.currentContext==="user"&&s.selectedUser&&x.push({id:"user",label:s.selectedUser.name,icon:"UserIcon",action:()=>R(s.selectedUser)}),s.currentContext==="management"&&x.push({id:"management",label:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏",icon:"SettingsIcon",action:f}),s.breadcrumbs=x},W=async()=>{if(!await Ce.goBack()&&s.breadcrumbs.length>1){const O=s.breadcrumbs[s.breadcrumbs.length-2];O?.action&&await O.action()}},ie=async(x,O)=>{try{s.loading=!0,s.loadingMessage="–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞...",await me(`/api/admin/users/${x}/permissions`,{method:"PUT",body:O});const V=s.users.findIndex(ae=>ae.id===x);V!==-1&&(s.users[V]={...s.users[V],...O},m()),be("–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã","success")}catch(V){throw console.error("[useUnifiedUserManagement] Failed to update permissions:",V),be("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞","error"),V}finally{s.loading=!1,s.loadingMessage=""}},ge=async x=>{try{const O=s.users.find(ae=>ae.id===x);if(!O)return;const V=!O.is_hidden;await me(`/api/admin/users/${x}/visibility`,{method:"PUT",body:{is_hidden:V}}),O.is_hidden=V,m()}catch(O){throw console.error("[useUnifiedUserManagement] Failed to toggle visibility:",O),O}},Ne=async(x,O,V={})=>{try{s.loading=!0,s.loadingMessage=`–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: ${x}...`,await me("/api/admin/users/bulk-update",{method:"POST",body:{user_ids:O,action:x,data:V}}),await ye(),be(`–û–ø–µ—Ä–∞—Ü–∏—è "${x}" –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–ª—è ${O.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`,"success")}catch(ae){throw console.error("[useUnifiedUserManagement] Bulk action failed:",ae),be(`–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ "${x}"`,"error"),ae}finally{s.loading=!1,s.loadingMessage=""}},ye=async()=>{await Promise.all([h(),L()])},Oe=x=>{s.currentContext=x.currentContext,x.data?.user&&(s.selectedUser=x.data.user),T(),A()},me=async(x,O={})=>{switch(await new Promise(V=>setTimeout(V,300)),x){case"/api/admin/users/unified":return{data:{users:Fe(O.per_page||50),pagination:{current_page:O.page||1,per_page:O.per_page||50,total:234,total_pages:Math.ceil(234/(O.per_page||50))},summary:{total_users:234,active_users:189,new_users_today:12,total_sessions_today:145,avg_session_duration:780,retention_7d:78.5,retention_30d:65.2}}};case"/api/admin/analytics/global":return{data:{metrics:[{id:"total_users",label:"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",value:234,change:5.2},{id:"active_users",label:"–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è",value:189,change:12.1},{id:"new_users",label:"–ù–æ–≤—ã—Ö —Å–µ–≥–æ–¥–Ω—è",value:12,change:-2.3},{id:"avg_session",label:"–°—Ä–µ–¥–Ω—è—è —Å–µ—Å—Å–∏—è",value:"13:00",change:8.7}]}};default:return{data:{}}}},Fe=x=>{const O=[];for(let V=1;V<=x;V++)O.push({id:V,name:`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${V}`,email:`user${V}@example.com`,departments:[{id:369,name:"–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª",color:"#2196F3"},{id:366,name:"–°–µ–∫—Ç–æ—Ä 1–°",color:"#4CAF50"}].slice(0,Math.floor(Math.random()*3)),is_admin:Math.random()>.9,is_hidden:Math.random()>.95,created_at:new Date(Date.now()-Math.random()*365*24*60*60*1e3).toISOString(),status:["online","away","offline"][Math.floor(Math.random()*3)],activity_stats:{total_actions:Math.floor(Math.random()*1e3),total_sessions:Math.floor(Math.random()*50),avg_session_duration:Math.floor(Math.random()*1800),last_activity:new Date(Date.now()-Math.random()*7*24*60*60*1e3).toISOString(),activity_score:Math.floor(Math.random()*100),actions_change_percent:(Math.random()-.5)*50}});return O},be=(x,O="info")=>{console.log(`[${O.toUpperCase()}] ${x}`),typeof window<"u"&&window.BX&&window.BX.UI&&window.BX.UI.Notification&&window.BX.UI.Notification.Center.notify({content:x,type:O==="error"?"error":O==="success"?"success":"info"})};return he(()=>s.filters,m,{deep:!0}),he(()=>s.users,m),he(()=>s.currentContext,T),Rt(()=>{b()}),{state:s,hasSelectedUsers:t,selectedUserStats:r,canEditPermissions:l,canDeleteUsers:n,contextTitle:i,isContextGlobal:u,isContextUser:_,isContextManagement:S,initialize:b,loadUsers:h,loadGlobalMetrics:L,selectUser:R,deselectUser:F,switchToGlobal:y,switchToManagement:f,applyFilters:m,updateFilters:P,resetFilters:$,saveFilterPreset:j,loadFilterPreset:X,updateBreadcrumbs:T,goBack:W,updateUserPermissions:ie,toggleUserVisibility:ge,performBulkAction:Ne,refreshData:ye,emitNotification:be}}function Rr(o={}){const e={enablePersistence:o.enablePersistence!==!1,storagePrefix:o.storagePrefix||"um-nav",maxHistorySize:o.maxHistorySize||10,enableKeyboardNavigation:o.enableKeyboardNavigation!==!1,...o},s=Ft({breadcrumbs:[],navigationHistory:[],currentDepth:0,maxDepth:0,isNavigating:!1,navigationError:null}),t=M(null),r=v(()=>s.breadcrumbs.length>1),l=v(()=>!1),n=v(()=>s.breadcrumbs[s.breadcrumbs.length-1]),i=v(()=>s.breadcrumbs[s.breadcrumbs.length-2]),u=v(()=>s.currentDepth===0),_=v(()=>s.breadcrumbs.map(T=>T.label).join(" > ")),S=()=>{Ce.addListener(j),e.enablePersistence&&f(),e.enableKeyboardNavigation&&$(),b()},b=()=>{const T=Ce.getCurrentContext(),W=Ce.getCurrentContextData(),ie=[{id:"global",label:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"UsersIcon",context:"global",action:()=>I("global"),data:{},depth:0}];switch(T){case"user":W.user&&ie.push({id:`user-${W.user.id}`,label:W.user.name,icon:"UserIcon",context:"user",action:()=>I("user",{user:W.user}),data:{user:W.user},depth:1});break;case"management":ie.push({id:"management",label:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏",icon:"SettingsIcon",context:"management",action:()=>I("management",W),data:W,depth:1});break}s.breadcrumbs=ie,s.currentDepth=ie.length-1,s.maxDepth=Math.max(s.maxDepth,s.currentDepth),e.enablePersistence&&m()},I=async(T,W={})=>{try{s.isNavigating=!0,s.navigationError=null;const ie={source:"breadcrumb",preserveFilters:!0};await Ce.switchContext(T,W,ie),R({context:T,data:W,timestamp:Date.now(),source:"breadcrumb"}),await P()}catch(ie){console.error("[useContextNavigation] Navigation failed:",ie),s.navigationError=ie.message,X(ie)}finally{s.isNavigating=!1}},A=async()=>{if(!r.value)return!1;try{s.isNavigating=!0;const T=await Ce.goBack();return T&&R({action:"back",timestamp:Date.now(),source:"navigation"}),T}catch(T){return console.error("[useContextNavigation] Go back failed:",T),s.navigationError=T.message,!1}finally{s.isNavigating=!1}},k=async()=>!1,U=async T=>{if(T.action)try{await T.action(),await P()}catch(W){console.error("[useContextNavigation] Navigate to crumb failed:",W),s.navigationError=W.message}},N=async()=>{await I("global")},h=T=>{if(!T.id||!T.label){console.warn("[useContextNavigation] Invalid crumb:",T);return}const W={depth:s.currentDepth+1,...T};s.breadcrumbs=s.breadcrumbs.slice(0,s.currentDepth+1),s.breadcrumbs.push(W),s.currentDepth++,s.maxDepth=Math.max(s.maxDepth,s.currentDepth),e.enablePersistence&&m()},L=()=>{s.breadcrumbs.length>1&&(s.breadcrumbs.pop(),s.currentDepth--,e.enablePersistence&&m())},E=()=>{s.breadcrumbs=[s.breadcrumbs[0]],s.currentDepth=0,s.navigationHistory=[],e.enablePersistence&&m()},R=T=>{s.navigationHistory.push({id:Date.now().toString(),...T}),s.navigationHistory.length>e.maxHistorySize&&(s.navigationHistory=s.navigationHistory.slice(-e.maxHistorySize))},F=(T=e.maxHistorySize)=>s.navigationHistory.slice(-T),y=()=>{s.navigationHistory=[],e.enablePersistence&&m()},f=()=>{try{const T=localStorage.getItem(`${e.storagePrefix}-state`);if(T){const W=JSON.parse(T);Object.assign(s,W)}}catch(T){console.warn("[useContextNavigation] Failed to load persisted state:",T)}},m=()=>{try{const T={breadcrumbs:s.breadcrumbs,navigationHistory:s.navigationHistory,currentDepth:s.currentDepth,maxDepth:s.maxDepth};localStorage.setItem(`${e.storagePrefix}-state`,JSON.stringify(T))}catch(T){console.warn("[useContextNavigation] Failed to save state:",T)}},P=async()=>{t.value&&(t.value.classList.add("navigating"),await new Promise(T=>setTimeout(T,150)),t.value.classList.remove("navigating"))},$=()=>{const T=W=>{W.altKey&&W.key==="ArrowLeft"&&r.value&&(W.preventDefault(),A()),W.altKey&&W.key==="Home"&&(W.preventDefault(),N()),W.key==="Escape"&&s.isNavigating&&(W.preventDefault(),s.isNavigating=!1,s.navigationError=null)};return document.addEventListener("keydown",T),()=>{document.removeEventListener("keydown",T)}},j=T=>{b(),typeof window<"u"&&window.analytics&&window.analytics.track("navigation_context_changed",{from_context:T.previousContext,to_context:T.currentContext,navigation_source:"context_manager",timestamp:Date.now()})},X=T=>{const W=`–û—à–∏–±–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏: ${T.message}`;console.error("[useContextNavigation]",W),typeof window<"u"&&window.BX&&window.BX.UI&&window.BX.UI.Notification&&window.BX.UI.Notification.Center.notify({content:W,type:"error"})};return he(()=>s.currentDepth,(T,W)=>{typeof window<"u"&&window.analytics&&window.analytics.track("navigation_depth_changed",{from_depth:W,to_depth:T,max_depth:s.maxDepth,timestamp:Date.now()})}),S(),{state:s,navigationContainer:t,canGoBack:r,canGoForward:l,currentCrumb:n,previousCrumb:i,isAtRoot:u,navigationPath:_,navigateToContext:I,goBack:A,goForward:k,navigateToCrumb:U,goToRoot:N,addCustomCrumb:h,removeLastCrumb:L,clearNavigation:E,getNavigationHistory:F,clearNavigationHistory:y,savePersistedState:m,loadPersistedState:f,animateTransition:P,emitNavigationError:X}}const Br={name:"DrillDownNavigation",props:{breadcrumbs:{type:Array,default:()=>[],validator:o=>Array.isArray(o)&&o.every(e=>typeof e=="object"&&typeof e.id=="string"&&typeof e.label=="string")},separator:{type:String,default:">"},showBackButton:{type:Boolean,default:!0},additionalActions:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},maxLabelLength:{type:Number,default:30}},emits:["navigate","back","action"],setup(o,{emit:e}){const s=v(()=>o.breadcrumbs.map(u=>({...u,label:r(u.label,o.maxLabelLength)}))),t=v(()=>{const u=s.value;return u.length<=5?u:[u[0],{id:"ellipsis-start",label:"...",isEllipsis:!0},...u.slice(-3)]}),r=(u,_)=>u.length<=_?u:u.substring(0,_-3)+"...";return{visibleBreadcrumbs:t,handleNavigate:u=>{u.action&&e("navigate",u)},handleBack:()=>{e("back")},handleAction:u=>{e("action",u)}}}},Vr={class:"drilldown-navigation",role:"navigation","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"},zr={class:"breadcrumb-list"},Hr={key:0,class:"breadcrumb-separator","aria-hidden":"true"},jr=["onClick","onKeydown","aria-label","title"],Wr={class:"breadcrumb-text"},qr={key:2,class:"breadcrumb-current-text","aria-current":"page"},Xr={class:"breadcrumb-text"},Jr={key:3,class:"breadcrumb-loading","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"},$r=["aria-label","title"],Kr={key:1,class:"breadcrumb-actions"},Gr=["onClick","onKeydown","aria-label","title","disabled"],Yr={key:1,class:"action-text"};function Qr(o,e,s,t,r,l){return c(),d("nav",Vr,[a("ol",zr,[(c(!0),d(Z,null,ee(s.breadcrumbs,(n,i)=>(c(),d("li",{key:n.id,class:z(["breadcrumb-item",{"breadcrumb-current":i===s.breadcrumbs.length-1,"breadcrumb-interactive":i<s.breadcrumbs.length-1}])},[i>0?(c(),d("span",Hr,g(s.separator),1)):w("",!0),i<s.breadcrumbs.length-1&&n.action?(c(),d("button",{key:1,class:"breadcrumb-link",onClick:u=>t.handleNavigate(n),onKeydown:[de(u=>t.handleNavigate(n),["enter"]),de(u=>t.handleNavigate(n),["space"])],"aria-label":`–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–∞–∑–¥–µ–ª—É ${n.label}`,title:`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${n.label}`},[n.icon?(c(),K(je(n.icon),{key:0,class:"breadcrumb-icon","aria-hidden":"true"})):w("",!0),a("span",Wr,g(n.label),1)],40,jr)):(c(),d("span",qr,[n.icon?(c(),K(je(n.icon),{key:0,class:"breadcrumb-icon","aria-hidden":"true"})):w("",!0),a("span",Xr,g(n.label),1)])),i===s.breadcrumbs.length-1&&s.isLoading?(c(),d("div",Jr,[...e[3]||(e[3]=[a("div",{class:"loading-spinner","aria-hidden":"true"},null,-1)])])):w("",!0)],2))),128))]),s.showBackButton&&s.breadcrumbs.length>1?(c(),d("button",{key:0,class:"back-button",onClick:e[0]||(e[0]=(...n)=>t.handleBack&&t.handleBack(...n)),onKeydown:[e[1]||(e[1]=de((...n)=>t.handleBack&&t.handleBack(...n),["enter"])),e[2]||(e[2]=de((...n)=>t.handleBack&&t.handleBack(...n),["space"]))],"aria-label":`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${s.breadcrumbs[s.breadcrumbs.length-2]?.label||"–ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Ä–∞–∑–¥–µ–ª—É"}`,title:`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${s.breadcrumbs[s.breadcrumbs.length-2]?.label||"–ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Ä–∞–∑–¥–µ–ª—É"}`},[...e[4]||(e[4]=[a("svg",{class:"back-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[a("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})],-1),a("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])],40,$r)):w("",!0),s.additionalActions.length>0?(c(),d("div",Kr,[(c(!0),d(Z,null,ee(s.additionalActions,n=>(c(),d("button",{key:n.id,class:z(["action-button",n.class]),onClick:i=>t.handleAction(n),onKeydown:[de(i=>t.handleAction(n),["enter"]),de(i=>t.handleAction(n),["space"])],"aria-label":n.label,title:n.title||n.label,disabled:n.disabled},[n.icon?(c(),K(je(n.icon),{key:0,class:"action-icon","aria-hidden":"true"})):w("",!0),n.text?(c(),d("span",Yr,g(n.text),1)):w("",!0)],42,Gr))),128))])):w("",!0)])}const Zr=Y(Br,[["render",Qr],["__scopeId","data-v-e0da3deb"]]),ei={name:"MetricCard",emits:["click"],props:{metric:{type:Object,default:()=>({})},title:{type:String,required:!0},value:{type:[Number,String],required:!0},unit:{type:String,default:""},subtitle:{type:String,default:""},icon:{type:String,default:""},trend:{type:Number,default:null},trendPeriod:{type:String,default:""},progress:{type:Number,default:null},size:{type:String,default:"medium",validator:o=>["small","medium","large","compact"].includes(o)},interactive:{type:Boolean,default:!1}},computed:{formattedValue(){return typeof this.value=="number"?this.value>=1e6?`${(this.value/1e6).toFixed(1)}M`:this.value>=1e3?`${(this.value/1e3).toFixed(1)}K`:this.value.toLocaleString():this.value}}},ti={class:"metric-header"},si=["innerHTML"],ai={class:"metric-title"},oi={class:"metric-value-section"},ni={class:"metric-value"},ri={key:0,class:"metric-unit"},ii={key:0,class:"metric-subtitle"},li={key:1,class:"metric-trend"},ci={class:"trend-indicator"},di={key:0,viewBox:"0 0 24 24",width:"12",height:"12"},ui={key:1,viewBox:"0 0 24 24",width:"12",height:"12"},gi={key:2,viewBox:"0 0 24 24",width:"12",height:"12"},mi={class:"trend-value"},fi={class:"trend-period"},hi={key:2,class:"metric-progress"},vi={class:"progress-bar"},yi={class:"progress-text"};function pi(o,e,s,t,r,l){return c(),d("div",{class:z(["metric-card",{[`size-${s.size}`]:!0,"has-trend":s.trend!==null,"trend-up":s.trend>0,"trend-down":s.trend<0,"trend-neutral":s.trend===0,interactive:s.interactive}]),onClick:e[0]||(e[0]=n=>s.interactive?o.$emit("click",s.metric):null)},[a("div",ti,[s.icon?(c(),d("div",{key:0,class:"metric-icon",innerHTML:s.icon},null,8,si)):w("",!0),a("div",ai,g(s.title),1)]),a("div",oi,[a("div",ni,g(l.formattedValue),1),s.unit?(c(),d("div",ri,g(s.unit),1)):w("",!0)]),s.subtitle?(c(),d("div",ii,g(s.subtitle),1)):w("",!0),s.trend!==null?(c(),d("div",li,[a("div",ci,[s.trend>0?(c(),d("svg",di,[...e[1]||(e[1]=[a("path",{d:"M7 14l5-5 5 5z",fill:"currentColor"},null,-1)])])):s.trend<0?(c(),d("svg",ui,[...e[2]||(e[2]=[a("path",{d:"M7 10l5 5 5-5z",fill:"currentColor"},null,-1)])])):(c(),d("svg",gi,[...e[3]||(e[3]=[a("path",{d:"M7 12h10v-2H7z",fill:"currentColor"},null,-1)])]))]),a("span",mi,g(Math.abs(s.trend))+"%",1),a("span",fi,g(s.trendPeriod||"vs prev"),1)])):w("",!0),s.progress!==null?(c(),d("div",hi,[a("div",vi,[a("div",{class:"progress-fill",style:Je({width:`${Math.min(s.progress,100)}%`})},null,4)]),a("span",yi,g(s.progress)+"%",1)])):w("",!0)],2)}const bi=Y(ei,[["render",pi],["__scopeId","data-v-b8d66bef"]]),_i={name:"ContextSidebar",components:{MetricCard:bi},props:{context:{type:String,default:"global",validator:o=>["global","user","management"].includes(o)},selectedUser:{type:Object,default:null},selectedUsers:{type:Array,default:()=>[]},globalMetrics:{type:Array,default:()=>[]},userStats:{type:Object,default:()=>({})},userFilters:{type:Object,default:()=>({timeRange:"week",activity_types:[]})},filterPresets:{type:Array,default:()=>[]},activePreset:{type:String,default:null},recentActivity:{type:Array,default:()=>[]},auditLog:{type:Array,default:()=>[]},activityTypes:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},collapsed:{type:Boolean,default:!1},canEditPermissions:{type:Boolean,default:!1}},emits:["toggle-collapse","metric-click","filter-preset-apply","activity-click","filter-change","view-profile","export-data","edit-permissions","bulk-action","user-select"],setup(o,{emit:e}){const s=M(o.collapsed),t=v(()=>{if(!o.selectedUser?.name)return"";const[E,R]=o.selectedUser.name.split(" ");return`${E?.[0]||""}${R?.[0]||""}`.toUpperCase()}),r=()=>{s.value=!s.value,e("toggle-collapse",s.value)},l=()=>{switch(o.context){case"global":return"–û–±–∑–æ—Ä";case"user":return"–ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è";case"management":return"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ";default:return"–û–±–∑–æ—Ä"}},n=()=>`${l()} - –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π`,i=E=>{switch(E){case"online":return"–û–Ω–ª–∞–π–Ω";case"away":return"–û—Ç–æ—à—ë–ª";case"offline":return"–û—Ñ—Ñ–ª–∞–π–Ω";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}},u=E=>{if(!E)return"";const[R,F]=E.split(" ");return`${R?.[0]||""}${F?.[0]||""}`.toUpperCase()},_=E=>{const R=Math.floor(E/60),F=E%60;return`${R}:${F.toString().padStart(2,"0")}`},S=E=>{const R=new Date(E),y=new Date-R,f=Math.floor(y/(1e3*60)),m=Math.floor(y/(1e3*60*60)),P=Math.floor(y/(1e3*60*60*24));return f<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":f<60?`${f} –º–∏–Ω –Ω–∞–∑–∞–¥`:m<24?`${m} —á –Ω–∞–∑–∞–¥`:P<7?`${P} –¥ –Ω–∞–∑–∞–¥`:R.toLocaleDateString()},b=E=>{e("metric-click",E)},I=E=>{e("filter-preset-apply",E)},A=E=>{e("activity-click",E)},k=()=>{e("filter-change",o.userFilters)},U=()=>{e("view-profile",o.selectedUser)},N=()=>{e("export-data",o.selectedUser)},h=()=>{e("edit-permissions",o.selectedUser)},L=E=>{e("bulk-action",{action:E,users:o.selectedUsers})};return he(()=>o.collapsed,E=>{s.value=E}),{isCollapsed:s,userInitials:t,toggleCollapse:r,getContextTitle:l,getAriaLabel:n,getStatusText:i,getUserInitials:u,formatDuration:_,formatTime:S,handleMetricClick:b,applyFilterPreset:I,handleActivityClick:A,handleFilterChange:k,viewDetailedProfile:U,exportUserData:N,editPermissions:h,performBulkAction:L}}},wi=["aria-label"],Ci=["aria-label","title"],ki={class:"sidebar-header"},Si={class:"context-title"},xi={key:0,class:"user-indicator"},Mi={class:"user-avatar"},Ai=["src","alt"],Ei={key:1,class:"avatar-placeholder"},Li={class:"user-info"},Ti={class:"user-name"},Di={key:0,class:"global-context-content"},Ii={class:"metrics-section"},Pi={class:"metrics-grid"},Ui={class:"filters-section"},Ni={class:"filter-presets"},Oi=["onClick","aria-label"],Fi={class:"preset-label"},Ri={key:0,class:"preset-count"},Bi={class:"recent-activity-section"},Vi={class:"recent-activity-list"},zi=["onClick"],Hi={class:"activity-content"},ji={class:"activity-text"},Wi={class:"activity-time"},qi={key:1,class:"user-context-content"},Xi={class:"user-stats-section"},Ji={class:"user-stats-grid"},$i={class:"stat-item"},Ki={class:"stat-value"},Gi={class:"stat-item"},Yi={class:"stat-value"},Qi={class:"stat-item"},Zi={class:"stat-value"},el={class:"stat-item"},tl={class:"stat-value"},sl={class:"analysis-filters-section"},al={class:"filter-controls"},ol={class:"filter-group"},nl={class:"filter-group"},rl={class:"checkbox-group"},il=["value"],ll={class:"user-actions-section"},cl={class:"action-buttons"},dl=["aria-label"],ul=["aria-label"],gl=["aria-label"],ml={key:2,class:"management-context-content"},fl={key:0,class:"selected-users-section"},hl={class:"section-title"},vl={class:"selected-users-list"},yl={class:"user-avatar small"},pl=["src","alt"],bl={key:1,class:"avatar-placeholder small"},_l={class:"user-name"},wl={key:0,class:"more-users"},Cl={class:"bulk-operations-section"},kl={class:"bulk-actions"},Sl=["disabled"],xl=["disabled"],Ml=["disabled"],Al={class:"audit-log-section"},El={class:"audit-log-list"},Ll={class:"audit-content"},Tl={class:"audit-text"},Dl={class:"audit-time"},Il={key:0,class:"sidebar-loading-overlay"};function Pl(o,e,s,t,r,l){const n=J("MetricCard");return c(),d("aside",{class:z(["context-sidebar",{collapsed:t.isCollapsed,"context-global":s.context==="global","context-user":s.context==="user","context-management":s.context==="management"}]),role:"complementary","aria-label":t.getAriaLabel()},[a("button",{class:"collapse-toggle",onClick:e[0]||(e[0]=(...i)=>t.toggleCollapse&&t.toggleCollapse(...i)),onKeydown:[e[1]||(e[1]=de((...i)=>t.toggleCollapse&&t.toggleCollapse(...i),["enter"])),e[2]||(e[2]=de((...i)=>t.toggleCollapse&&t.toggleCollapse(...i),["space"]))],"aria-label":t.isCollapsed?"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å":"–°–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å",title:t.isCollapsed?"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å":"–°–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å"},[(c(),d("svg",{class:z(["collapse-icon",{rotated:t.isCollapsed}]),viewBox:"0 0 24 24","aria-hidden":"true"},[...e[13]||(e[13]=[a("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"},null,-1)])],2))],40,Ci),a("header",ki,[a("h3",Si,g(t.getContextTitle()),1),s.context==="user"&&s.selectedUser?(c(),d("div",xi,[a("div",Mi,[s.selectedUser.avatar?(c(),d("img",{key:0,src:s.selectedUser.avatar,alt:`–ê–≤–∞—Ç–∞—Ä ${s.selectedUser.name}`},null,8,Ai)):(c(),d("div",Ei,g(t.userInitials),1))]),a("div",Li,[a("div",Ti,g(s.selectedUser.name),1),a("div",{class:z(["user-status",s.selectedUser.status])},g(t.getStatusText(s.selectedUser.status)),3)])])):w("",!0)]),a("div",{class:z(["sidebar-content",{"content-collapsed":t.isCollapsed}])},[s.context==="global"?(c(),d("div",Di,[a("section",Ii,[e[14]||(e[14]=a("h4",{class:"section-title"},"–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",-1)),a("div",Pi,[(c(!0),d(Z,null,ee(s.globalMetrics,i=>(c(),K(n,{key:i.id,metric:i,size:"compact",onClick:t.handleMetricClick},null,8,["metric","onClick"]))),128))])]),a("section",Ui,[e[15]||(e[15]=a("h4",{class:"section-title"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã",-1)),a("div",Ni,[(c(!0),d(Z,null,ee(s.filterPresets,i=>(c(),d("button",{key:i.id,class:z(["filter-preset",{active:s.activePreset===i.id}]),onClick:u=>t.applyFilterPreset(i),"aria-label":`–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä: ${i.label}`},[(c(),K(je(i.icon),{class:"preset-icon"})),a("span",Fi,g(i.label),1),i.count!==void 0?(c(),d("span",Ri,g(i.count),1)):w("",!0)],10,Oi))),128))])]),a("section",Bi,[e[16]||(e[16]=a("h4",{class:"section-title"},"–ù–µ–¥–∞–≤–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",-1)),a("div",Vi,[(c(!0),d(Z,null,ee(s.recentActivity,i=>(c(),d("div",{key:i.id,class:"activity-item",onClick:u=>t.handleActivityClick(i)},[a("div",{class:z(["activity-icon",i.type])},[(c(),K(je(i.icon)))],2),a("div",Hi,[a("div",ji,g(i.text),1),a("div",Wi,g(t.formatTime(i.timestamp)),1)])],8,zi))),128))])])])):s.context==="user"?(c(),d("div",qi,[a("section",Xi,[e[21]||(e[21]=a("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",-1)),a("div",Ji,[a("div",$i,[a("div",Ki,g(s.userStats.total_actions||0),1),e[17]||(e[17]=a("div",{class:"stat-label"},"–¥–µ–π—Å—Ç–≤–∏–π",-1)),s.userStats.actions_change!==0?(c(),d("div",{key:0,class:z(["stat-change",{positive:s.userStats.actions_change>0,negative:s.userStats.actions_change<0}])},g(s.userStats.actions_change>0?"+":"")+g(s.userStats.actions_change)+"% ",3)):w("",!0)]),a("div",Gi,[a("div",Yi,g(t.formatDuration(s.userStats.avg_session_duration||0)),1),e[18]||(e[18]=a("div",{class:"stat-label"},"—Å—Ä–µ–¥–Ω—è—è —Å–µ—Å—Å–∏—è",-1))]),a("div",Qi,[a("div",Zi,g(s.userStats.total_sessions||0),1),e[19]||(e[19]=a("div",{class:"stat-label"},"—Å–µ—Å—Å–∏–π",-1))]),a("div",el,[a("div",tl,g(s.userStats.activity_score||0)+"/100",1),e[20]||(e[20]=a("div",{class:"stat-label"},"–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1))])])]),a("section",sl,[e[26]||(e[26]=a("h4",{class:"section-title"},"–§–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞",-1)),a("div",al,[a("div",ol,[e[23]||(e[23]=a("label",{class:"filter-label"},"–ü–µ—Ä–∏–æ–¥:",-1)),ue(a("select",{"onUpdate:modelValue":e[3]||(e[3]=i=>s.userFilters.timeRange=i),class:"filter-select",onChange:e[4]||(e[4]=(...i)=>t.handleFilterChange&&t.handleFilterChange(...i))},[...e[22]||(e[22]=[Bt('<option value="today" data-v-abccaced>–°–µ–≥–æ–¥–Ω—è</option><option value="week" data-v-abccaced>–ù–µ–¥–µ–ª—è</option><option value="month" data-v-abccaced>–ú–µ—Å—è—Ü</option><option value="quarter" data-v-abccaced>–ö–≤–∞—Ä—Ç–∞–ª</option><option value="year" data-v-abccaced>–ì–æ–¥</option>',5)])],544),[[Ge,s.userFilters.timeRange]])]),a("div",nl,[e[25]||(e[25]=a("label",{class:"filter-label"},"–¢–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π:",-1)),a("div",rl,[(c(!0),d(Z,null,ee(s.activityTypes,i=>(c(),d("label",{key:i.id,class:"checkbox-label"},[ue(a("input",{type:"checkbox",value:i.id,"onUpdate:modelValue":e[5]||(e[5]=u=>s.userFilters.activity_types=u),onChange:e[6]||(e[6]=(...u)=>t.handleFilterChange&&t.handleFilterChange(...u))},null,40,il),[[bt,s.userFilters.activity_types]]),e[24]||(e[24]=a("span",{class:"checkmark"},null,-1)),se(" "+g(i.label),1)]))),128))])])])]),a("section",ll,[e[30]||(e[30]=a("h4",{class:"section-title"},"–î–µ–π—Å—Ç–≤–∏—è",-1)),a("div",cl,[a("button",{class:"action-button primary",onClick:e[7]||(e[7]=(...i)=>t.viewDetailedProfile&&t.viewDetailedProfile(...i)),"aria-label":`–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å ${s.selectedUser?.name}`},[...e[27]||(e[27]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L19 6.6C18.8 6 18.5 5.4 18.1 4.9L19 3L17 1L15.4 1.9C14.9 1.5 14.3 1.2 13.7 1L13 0V2C12.4 2 11.8 2.2 11.3 2.6L10.6 1.9L8.6 3L9.5 4.9C9.1 5.4 8.8 6 8.6 6.6L7 7V9L8.6 8.4C8.8 9 9.1 9.6 9.5 10.1L8.6 12L10.6 13.9L11.3 13.2C11.8 13.6 12.4 13.8 13 14V16H11V18H13V20H11V22H13V20H15V18H13V16H15V14C15.6 14 16.2 13.6 16.7 13.2L17.4 13.9L19.4 12L18.5 10.1C18.9 9.6 19.2 9 19.4 8.4L21 9ZM12 8C10.9 8 10 7.1 10 6C10 4.9 10.9 4 12 4C13.1 4 14 4.9 14 6C14 7.1 13.1 8 12 8Z"})],-1),se(" –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å ",-1)])],8,dl),a("button",{class:"action-button secondary",onClick:e[8]||(e[8]=(...i)=>t.exportUserData&&t.exportUserData(...i)),"aria-label":`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ ${s.selectedUser?.name}`},[...e[28]||(e[28]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),se(" –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö ",-1)])],8,ul),s.canEditPermissions?(c(),d("button",{key:0,class:"action-button warning",onClick:e[9]||(e[9]=(...i)=>t.editPermissions&&t.editPermissions(...i)),"aria-label":`–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ${s.selectedUser?.name}`},[...e[29]||(e[29]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),se(" –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ",-1)])],8,gl)):w("",!0)])])])):s.context==="management"?(c(),d("div",ml,[s.selectedUsers.length>0?(c(),d("section",fl,[a("h4",hl,"–í—ã–±—Ä–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: "+g(s.selectedUsers.length),1),a("div",vl,[(c(!0),d(Z,null,ee(s.selectedUsers.slice(0,3),i=>(c(),d("div",{key:i.id,class:"selected-user-item"},[a("div",yl,[i.avatar?(c(),d("img",{key:0,src:i.avatar,alt:i.name},null,8,pl)):(c(),d("div",bl,g(t.getUserInitials(i.name)),1))]),a("span",_l,g(i.name),1)]))),128)),s.selectedUsers.length>3?(c(),d("div",wl," +"+g(s.selectedUsers.length-3)+" –µ—â—ë ",1)):w("",!0)])])):w("",!0),a("section",Cl,[e[34]||(e[34]=a("h4",{class:"section-title"},"–ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",-1)),a("div",kl,[a("button",{class:"bulk-action-button",onClick:e[10]||(e[10]=i=>t.performBulkAction("change_department")),disabled:s.selectedUsers.length===0},[...e[31]||(e[31]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),se(" –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–¥–µ–ª ",-1)])],8,Sl),a("button",{class:"bulk-action-button",onClick:e[11]||(e[11]=i=>t.performBulkAction("toggle_admin")),disabled:s.selectedUsers.length===0},[...e[32]||(e[32]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),se(" –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ",-1)])],8,xl),a("button",{class:"bulk-action-button",onClick:e[12]||(e[12]=i=>t.performBulkAction("export")),disabled:s.selectedUsers.length===0},[...e[33]||(e[33]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24"},[a("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),se(" –≠–∫—Å–ø–æ—Ä—Ç ",-1)])],8,Ml)])]),a("section",Al,[e[35]||(e[35]=a("h4",{class:"section-title"},"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è",-1)),a("div",El,[(c(!0),d(Z,null,ee(s.auditLog.slice(0,5),i=>(c(),d("div",{key:i.id,class:"audit-entry"},[a("div",{class:z(["audit-icon",i.type])},[(c(),K(je(i.icon)))],2),a("div",Ll,[a("div",Tl,g(i.text),1),a("div",Dl,g(t.formatTime(i.timestamp)),1)])]))),128))])])])):w("",!0)],2),s.isLoading?(c(),d("div",Il,[...e[36]||(e[36]=[a("div",{class:"loading-spinner","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"},null,-1)])])):w("",!0)],10,wi)}const Ul=Y(_i,[["render",Pl],["__scopeId","data-v-abccaced"]]),Nl=()=>re(()=>import("./UserListPanel.vue-UqGTy9TV.js"),__vite__mapDeps([8,4,1,5,2]),import.meta.url),Ol=()=>re(()=>import("./AnalysisPanel.vue-DqdvIlkS.js"),__vite__mapDeps([9,4,1,5,2]),import.meta.url),Fl=()=>re(()=>import("./ManagementPanel.vue-BHFiu4LU.js"),__vite__mapDeps([10,4,1,5,2]),import.meta.url),Rl=()=>re(()=>import("./UserProfileModal.vue-2CNq1MOy.js"),__vite__mapDeps([11,4,1,5,2]),import.meta.url),Bl=()=>re(()=>import("./BulkActionsModal.vue-z8aWzErt.js"),__vite__mapDeps([12,4,1,5,2]),import.meta.url),Vl=()=>re(()=>import("./ExportModal.vue-CuRWScbY.js"),__vite__mapDeps([13,4,1,5,2]),import.meta.url),zl={name:"UnifiedUserManagement",components:{DrillDownNavigation:Zr,ContextSidebar:Ul,UserListPanel:Nl,AnalysisPanel:Ol,ManagementPanel:Fl,UserProfileModal:Rl,BulkActionsModal:Bl,ExportModal:Vl},props:{initialUsers:{type:Array,default:()=>[]},initialFilters:{type:Object,default:()=>({})},initialSelectedUser:{type:Object,default:null},config:{type:Object,default:()=>({enablePersistence:!0,enableKeyboardShortcuts:!0,defaultView:"global"})}},emits:["user-selected","context-changed","data-exported","permissions-updated","bulk-action-completed"],setup(o,{emit:e}){const{state:s,selectedUserStats:t,loadUsers:r,selectUser:l,switchToGlobal:n,switchToManagement:i,updateFilters:u,loadFilterPreset:_,goBack:S,updateUserPermissions:b,toggleUserVisibility:I,performBulkAction:A,refreshData:k,emitNotification:U}=Fr({enablePersistence:o.config.enablePersistence,defaultContext:o.config.defaultView}),{navigateToContext:N,addCustomCrumb:h,removeLastCrumb:L}=Rr({enablePersistence:o.config.enablePersistence}),E=M(!1),R=M(!1),F=M(!1),y=M(null),f=M(null),m=M("users"),P=M(null),$=M(null),j=v(()=>s.loading),X=v(()=>s.loadingMessage),T=v(()=>!!s.error),W=v(()=>s.error),ie=v(()=>s.currentContext),ge=v(()=>s.selectedUser),Ne=v(()=>s.selectedUsers),ye=v(()=>s.breadcrumbs),Oe=v(()=>s.filters),me=v(()=>s.filters),Fe=v(()=>s.filteredUsers),be=v(()=>s.pagination),x=v(()=>s.globalMetrics),O=v(()=>s.viewOptions),V=v(()=>s.departments||[]),ae=v(()=>s.activityTypes||[]),fe=v(()=>s.filterPresets||[]),Ze=v(()=>s.activePreset),et=v(()=>s.recentActivity||[]),tt=v(()=>s.auditLog||[]),C=v(()=>s.isNavigating),p=v(()=>[{id:"change_department",label:"–ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–¥–µ–ª",icon:"BuildingIcon"},{id:"toggle_admin",label:"–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",icon:"ShieldIcon"},{id:"export",label:"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",icon:"DownloadIcon"},{id:"hide_users",label:"–°–∫—Ä—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",icon:"EyeOffIcon"}]),H=v(()=>ge.value?{timeline:[],sessions:[],stats:t.value,trends:{}}:{}),B=async D=>{try{await l(D),e("user-selected",D)}catch{le("–û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è","error")}},G=D=>{s.selectedUsers=D},oe=D=>{u(D)},ne=async D=>{await r({page:D})},Ve=D=>{Object.assign(s.viewOptions,D),localStorage.setItem("um-view-options",JSON.stringify(s.viewOptions))},Jt=async(D,q)=>{try{switch(D){case"view-profile":await Mt(q);break;case"edit-permissions":await At(q);break;case"toggle-visibility":await I(q.id);break;case"delete":confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${q.name}?`)&&await A("delete",[q.id]);break;default:console.warn("[UnifiedUserManagement] Unknown user action:",D)}}catch(Ae){le(`–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è: ${Ae.message}`,"error")}},$t=async D=>{try{D.action?await D.action():await N(D.context,D.data)}catch{le("–û—à–∏–±–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏","error")}},Kt=async()=>{try{await S()||await n()}catch{le("–û—à–∏–±–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞","error")}},Gt=D=>{switch(D.id){case"refresh":ct();break;case"export":dt();break;case"settings":Lt();break;default:console.warn("[UnifiedUserManagement] Unknown additional action:",D)}},Yt=()=>[{id:"refresh",text:"–û–±–Ω–æ–≤–∏—Ç—å",icon:"RefreshCwIcon",class:"refresh"},{id:"export",text:"–≠–∫—Å–ø–æ—Ä—Ç",icon:"DownloadIcon",class:"export"},{id:"settings",text:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏",icon:"SettingsIcon",class:"settings"}],Mt=async D=>{y.value=D,f.value=await Tt(D.id),E.value=!0},At=async D=>{await i({selectedUsers:[D]})},Et=D=>{m.value="user",s.selectedUsers=[D],F.value=!0},Qt=()=>{Et(ge.value)},Zt=()=>{h({id:"detailed-analysis",label:"–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑",icon:"BarChartIcon",action:()=>L()})},es=async(D,q)=>{try{await b(D,q),le("–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã","success"),e("permissions-updated",{userId:D,permissions:q})}catch{le("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤","error")}},lt=async(D,q)=>{try{await A(D,s.selectedUsers.map(Ae=>Ae.id),q),le(`–ú–∞—Å—Å–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ "${D}" –≤—ã–ø–æ–ª–Ω–µ–Ω–æ`,"success"),e("bulk-action-completed",{action:D,data:q})}catch{le(`–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è "${D}"`,"error")}},ct=async()=>{try{await k(),le("–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã","success")}catch{le("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö","error")}},dt=()=>{m.value="users",F.value=!0},Lt=()=>{le("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ","info")},ut=()=>{E.value=!1,y.value=null,f.value=null},ts=async D=>{try{await new Promise(Ae=>setTimeout(Ae,500));const q=s.users.findIndex(Ae=>Ae.id===D.id);q!==-1&&(s.users[q]={...s.users[q],...D}),le("–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω","success"),ut()}catch{le("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è","error")}},gt=()=>{R.value=!1},ss=async D=>{await lt(D.id,D.data),gt()},mt=()=>{F.value=!1,m.value="users"},as=async D=>{try{await new Promise(q=>setTimeout(q,1e3)),le("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω","success"),mt(),e("data-exported",D)}catch{le("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞","error")}},os=D=>{localStorage.setItem("um-sidebar-collapsed",D)},ns=D=>{switch(D.id){case"active_users":u({activity_filter:"active"});break;case"new_users_today":u({time_range:"today",activity_filter:"new"});break}},rs=D=>{_(D.id),le(`–ü—Ä–∏–º–µ–Ω–µ–Ω —Ñ–∏–ª—å—Ç—Ä "${D.label}"`,"success")},is=D=>{console.log("Activity clicked:",D)},ls=D=>{u(D)},cs=async D=>{await lt(D.action,D.users.map(q=>q.id))},Tt=async D=>(await new Promise(q=>setTimeout(q,300)),{timeline:[],sessions:[],stats:t.value}),ds=async()=>{s.error=null;try{await k()}catch(D){s.error=D.message}},le=(D,q="info")=>{P.value={message:D,type:q},$.value&&clearTimeout($.value),$.value=setTimeout(()=>{Dt()},5e3),U(D,q)},Dt=()=>{P.value=null,$.value&&(clearTimeout($.value),$.value=null)},us=()=>{const D=q=>{(q.ctrlKey||q.metaKey)&&q.key==="r"&&(q.preventDefault(),ct()),(q.ctrlKey||q.metaKey)&&q.key==="e"&&(q.preventDefault(),dt()),q.key==="Escape"&&(E.value?ut():R.value?gt():F.value&&mt())};return document.addEventListener("keydown",D),()=>{document.removeEventListener("keydown",D)}};let ft;return pe(async()=>{o.config.enableKeyboardShortcuts&&(ft=us());try{o.initialUsers.length>0&&(s.users=o.initialUsers),o.initialSelectedUser&&await l(o.initialSelectedUser),await Rt()}catch(D){console.error("[UnifiedUserManagement] Initialization error:",D),s.error=D.message}}),it(()=>{ft&&ft(),$.value&&clearTimeout($.value)}),{showUserProfileModal:E,showBulkActionsModal:R,showExportModal:F,modalUser:y,modalActivityData:f,exportDataType:m,notification:P,isLoading:j,loadingMessage:X,hasError:T,errorMessage:W,currentContext:ie,selectedUser:ge,selectedUsers:Ne,breadcrumbs:ye,filters:Oe,userFilters:me,filteredUsers:Fe,pagination:be,globalMetrics:x,viewOptions:O,departments:V,activityTypes:ae,filterPresets:fe,activePreset:Ze,recentActivity:et,auditLog:tt,isNavigating:C,bulkActions:p,userActivityData:H,handleUserSelect:B,handleUserSelectMultiple:G,handleFiltersChange:oe,handlePaginationChange:ne,handleViewOptionsChange:Ve,handleUserAction:Jt,handleBreadcrumbNavigate:$t,handleGoBack:Kt,handleAdditionalAction:Gt,getAdditionalActions:Yt,handleViewProfile:Mt,handleEditPermissions:At,handleExportData:Et,handleExportUserData:Qt,handleViewDetailedAnalysis:Zt,handlePermissionsChange:es,handleBulkUpdate:lt,handleRefresh:ct,handleGlobalExport:dt,handleSettings:Lt,closeUserProfileModal:ut,handleUserProfileSave:ts,closeBulkActionsModal:gt,handleBulkActionExecute:ss,closeExportModal:mt,handleExportExecute:as,handleSidebarToggle:os,handleMetricClick:ns,handleFilterPresetApply:rs,handleActivityClick:is,handleUserFilterChange:ls,handleBulkAction:cs,loadUserActivityData:Tt,retryLoading:ds,showNotification:le,closeNotification:Dt}}},Hl={key:0,class:"loading-overlay","aria-live":"polite"},jl={class:"loading-message"},Wl={key:1,class:"error-state"},ql={class:"error-content"},Xl={class:"error-message"},Jl=["aria-label"],$l={key:2,class:"management-container"},Kl={class:"management-grid"},Gl={class:"main-content-area"},Yl={class:"global-actions"},Ql=["disabled"],Zl=["disabled"],ec={class:"notification-content"},tc={class:"notification-icon","aria-hidden":"true"},sc={class:"notification-message"};function ac(o,e,s,t,r,l){const n=J("DrillDownNavigation"),i=J("ContextSidebar"),u=J("UserListPanel"),_=J("AnalysisPanel"),S=J("ManagementPanel"),b=J("UserProfileModal"),I=J("BulkActionsModal"),A=J("ExportModal");return c(),d("div",{class:z(["unified-user-management",{loading:t.isLoading,error:t.hasError,"compact-view":t.viewOptions.compactView}]),role:"main","aria-label":"–ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"},[t.isLoading?(c(),d("div",Hl,[e[5]||(e[5]=a("div",{class:"loading-spinner","aria-hidden":"true"},null,-1)),a("div",jl,g(t.loadingMessage),1)])):t.hasError?(c(),d("div",Wl,[a("div",ql,[e[6]||(e[6]=a("div",{class:"error-icon","aria-hidden":"true"},"‚ö†Ô∏è",-1)),e[7]||(e[7]=a("h3",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),a("p",Xl,g(t.errorMessage),1),a("button",{class:"error-retry-btn",onClick:e[0]||(e[0]=(...k)=>t.retryLoading&&t.retryLoading(...k)),"aria-label":`–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É: ${t.errorMessage}`}," –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ",8,Jl)])])):(c(),d("div",$l,[te(n,{ref:"drilldownNav",breadcrumbs:t.breadcrumbs,"is-loading":t.isNavigating,"additional-actions":t.getAdditionalActions(),onNavigate:t.handleBreadcrumbNavigate,onBack:t.handleGoBack,onAction:t.handleAdditionalAction},null,8,["breadcrumbs","is-loading","additional-actions","onNavigate","onBack","onAction"]),a("div",Kl,[te(i,{context:t.currentContext,"selected-user":t.selectedUser,"selected-users":t.selectedUsers,"global-metrics":t.globalMetrics,"user-stats":o.selectedUserStats,"user-filters":t.userFilters,"filter-presets":t.filterPresets,"active-preset":t.activePreset,"recent-activity":t.recentActivity,"audit-log":t.auditLog,"activity-types":t.activityTypes,"is-loading":t.isLoading,"can-edit-permissions":o.canEditPermissions,onToggleCollapse:t.handleSidebarToggle,onMetricClick:t.handleMetricClick,onFilterPresetApply:t.handleFilterPresetApply,onActivityClick:t.handleActivityClick,onFilterChange:t.handleUserFilterChange,onViewProfile:t.handleViewProfile,onExportData:t.handleExportData,onEditPermissions:t.handleEditPermissions,onBulkAction:t.handleBulkAction},null,8,["context","selected-user","selected-users","global-metrics","user-stats","user-filters","filter-presets","active-preset","recent-activity","audit-log","activity-types","is-loading","can-edit-permissions","onToggleCollapse","onMetricClick","onFilterPresetApply","onActivityClick","onFilterChange","onViewProfile","onExportData","onEditPermissions","onBulkAction"]),a("div",Gl,[o.isContextGlobal?(c(),K(u,{key:0,users:t.filteredUsers,loading:t.isLoading,pagination:t.pagination,filters:t.filters,"view-options":t.viewOptions,"can-edit-permissions":o.canEditPermissions,"can-delete":o.canDeleteUsers,onUserSelect:t.handleUserSelect,onUserSelectMultiple:t.handleUserSelectMultiple,onFiltersChange:t.handleFiltersChange,onPaginationChange:t.handlePaginationChange,onViewOptionsChange:t.handleViewOptionsChange,onUserAction:t.handleUserAction},null,8,["users","loading","pagination","filters","view-options","can-edit-permissions","can-delete","onUserSelect","onUserSelectMultiple","onFiltersChange","onPaginationChange","onViewOptionsChange","onUserAction"])):o.isContextUser?(c(),K(_,{key:1,user:t.selectedUser,"activity-data":t.userActivityData,filters:t.userFilters,"time-range":t.filters.time_range,"is-loading":t.isLoading,onBack:t.handleGoBack,onFilterChange:t.handleUserFilterChange,onExport:t.handleExportUserData,onViewDetailed:t.handleViewDetailedAnalysis},null,8,["user","activity-data","filters","time-range","is-loading","onBack","onFilterChange","onExport","onViewDetailed"])):o.isContextManagement?(c(),K(S,{key:2,"selected-users":t.selectedUsers,"all-users":t.filteredUsers,departments:t.departments,"audit-log":t.auditLog,"is-loading":t.isLoading,"can-edit-permissions":o.canEditPermissions,onPermissionsChange:t.handlePermissionsChange,onBulkUpdate:t.handleBulkUpdate,onBack:t.handleGoBack},null,8,["selected-users","all-users","departments","audit-log","is-loading","can-edit-permissions","onPermissionsChange","onBulkUpdate","onBack"])):w("",!0)])]),a("div",Yl,[a("button",{class:"action-btn refresh",onClick:e[1]||(e[1]=(...k)=>t.handleRefresh&&t.handleRefresh(...k)),disabled:t.isLoading,"aria-label":"–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ",title:"–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (F5)"},[...e[8]||(e[8]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[a("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})],-1),se(" –û–±–Ω–æ–≤–∏—Ç—å ",-1)])],8,Ql),a("button",{class:"action-btn export",onClick:e[2]||(e[2]=(...k)=>t.handleGlobalExport&&t.handleGlobalExport(...k)),disabled:t.isLoading||t.filteredUsers.length===0,"aria-label":"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ",title:"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ"},[...e[9]||(e[9]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[a("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),se(" –≠–∫—Å–ø–æ—Ä—Ç ",-1)])],8,Zl),a("button",{class:"action-btn settings",onClick:e[3]||(e[3]=(...k)=>t.handleSettings&&t.handleSettings(...k)),"aria-label":"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞",title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞"},[...e[10]||(e[10]=[a("svg",{class:"action-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[a("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"})],-1),se(" –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ",-1)])])])])),t.showUserProfileModal?(c(),K(b,{key:3,user:t.modalUser,"activity-data":t.modalActivityData,onClose:t.closeUserProfileModal,onSave:t.handleUserProfileSave},null,8,["user","activity-data","onClose","onSave"])):w("",!0),t.showBulkActionsModal?(c(),K(I,{key:4,"selected-users":t.selectedUsers,"available-actions":t.bulkActions,onClose:t.closeBulkActionsModal,onExecute:t.handleBulkActionExecute},null,8,["selected-users","available-actions","onClose","onExecute"])):w("",!0),t.showExportModal?(c(),K(A,{key:5,"data-type":t.exportDataType,filters:t.filters,"selected-users":t.selectedUsers,onClose:t.closeExportModal,onExport:t.handleExportExecute},null,8,["data-type","filters","selected-users","onClose","onExport"])):w("",!0),t.notification?(c(),d("div",{key:6,class:z(["notification-toast",t.notification.type])},[a("div",ec,[a("div",tc,g(t.notification.type==="success"?"‚úÖ":t.notification.type==="error"?"‚ùå":"‚ÑπÔ∏è"),1),a("div",sc,g(t.notification.message),1),a("button",{class:"notification-close",onClick:e[4]||(e[4]=(...k)=>t.closeNotification&&t.closeNotification(...k)),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"}," ‚úï ")])],2)):w("",!0)],2)}const oc=Y(zl,[["render",ac],["__scopeId","data-v-27c64cb0"]]),nc={name:"UsersManagementPage",components:{UnifiedUserManagement:oc},setup(){const o=Ye();return pe(async()=>{try{if(!(await Re.checkAccess()).allowed){o.push("/");return}if(!await Re.getCurrentUser()){o.push("/");return}console.log("[UsersManagementPage] Access granted - loading unified interface")}catch(e){console.error("[UsersManagementPage] Access check failed:",e),o.push("/")}}),{}}},rc={class:"users-management-page"};function ic(o,e,s,t,r,l){const n=J("UnifiedUserManagement");return c(),d("div",rc,[te(n,{config:{enablePersistence:!0,enableKeyboardShortcuts:!0,defaultView:"global"}})])}const lc=Y(nc,[["render",ic],["__scopeId","data-v-b3f530f8"]]);class Q{static async getCacheStatus(){try{const e=Le("/api/admin/cache-status.php");console.log("[CacheManagementService] Fetching cache status from:",e);const s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("[CacheManagementService] Response status:",s.status),!s.ok){const r=await s.text();throw console.error("[CacheManagementService] HTTP error:",r),new Error(`HTTP error! status: ${s.status}, message: ${r}`)}const t=await s.json();if(console.log("[CacheManagementService] API result:",t),t.success){let r=t.modules||[];console.log("[CacheManagementService] Modules from API:",r.length,r),r.length===0&&(console.log("[CacheManagementService] Using mock data for UI demonstration"),r=this.getMockModules(),console.log("[CacheManagementService] Mock modules:",r.length));const l=this.categorizeAndSortModules(r);return console.log("[CacheManagementService] Categorized result:",l),l}else throw new Error(t.error||"Failed to get cache status")}catch(e){console.error("[CacheManagementService] Error getting cache status:",e),console.log("[CacheManagementService] Using mock data due to API error");const s=this.getMockModules(),t=this.categorizeAndSortModules(s);return console.log("[CacheManagementService] Mock categorized result:",t),t}}static async clearCache(e){try{const s=Le("/api/admin/cache-clear.php"),t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,confirm:!0})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return!0;throw new Error(r.error||"Failed to clear cache")}catch(s){throw console.error("[CacheManagementService] Error clearing cache:",s),s}}static async getCacheStats(){try{const e=Le("/api/admin/cache-stats.php"),s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();if(t.success)return t.stats||{};throw new Error(t.error||"Failed to get cache stats")}catch(e){throw console.error("[CacheManagementService] Error getting cache stats:",e),e}}static formatCacheSize(e){if(e===0)return"0 B";const s=1024,t=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(s));return Math.round(e/Math.pow(s,r)*100)/100+" "+t[r]}static categorizeAndSortModules(e,s={}){const t=this.generateCacheKey(e),r=this.getCachedResult(t);if(r&&!s.forceRefresh)return r;const l=performance.now(),n=this.performCategorization(e),i=performance.now();return n.metadata={processingTime:i-l,totalModules:e.length,primaryCount:n.primaryModules.length,secondaryCount:n.secondaryModules.length,cached:!1},this.setCachedResult(t,n),n}static performCategorization(e){const s=[],t=[];return e.forEach(r=>{this.validateModule(r),this.PRIMARY_MODULE_IDS.includes(r.id)?s.push({...r,category:"primary",priority:this.PRIMARY_MODULE_PRIORITIES[r.id]||999}):t.push({...r,category:"secondary",groupType:this.getModuleType(r.id)})}),{primaryModules:this.sortPrimaryModules(s),secondaryModules:this.sortSecondaryModules(t)}}static sortPrimaryModules(e){return e.sort((s,t)=>{const r=this.PRIMARY_MODULE_PRIORITIES[s.id]||999,l=this.PRIMARY_MODULE_PRIORITIES[t.id]||999;return r-l})}static sortSecondaryModules(e){return e.sort((s,t)=>{const r=this.getModuleType(s.id),l=this.getModuleType(t.id);return r!==l?this.compareModuleTypes(r,l):s.name.localeCompare(t.name)})}static compareModuleTypes(e,s){const t=["users","activity","webhooks","other"],r=t.indexOf(e),l=t.indexOf(s);return(r===-1?999:r)-(l===-1?999:l)}static getModuleType(e){for(const[s,t]of Object.entries(this.SECONDARY_MODULE_TYPES))if(e.startsWith(t.prefix))return s;return e.includes("time-tracking")?"time-tracking":e.includes("graph")?"graphs":e.includes("dashboard")?"dashboards":"other"}static getModuleTypeConfig(e){return this.SECONDARY_MODULE_TYPES[e]||{title:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏",description:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã"}}static validateModule(e){if(!e||typeof e!="object")throw new Error("Module must be an object");if(!e.id||typeof e.id!="string")throw new Error("Module must have a valid id");if(!e.name||typeof e.name!="string")throw new Error("Module must have a valid name");return!0}static generateCacheKey(e){const s=e.map(t=>t.id).sort().join(",");return btoa(s).substring(0,16)}static getCachedResult(e){const s=this.categorizationCache.get(e);return s?Date.now()-s.timestamp>this.CACHE_TTL?(this.categorizationCache.delete(e),null):{...s.data,metadata:{...s.data.metadata,cached:!0}}:null}static setCachedResult(e,s){if(this.categorizationCache.set(e,{data:{...s,metadata:{...s.metadata,cached:!1}},timestamp:Date.now()}),this.categorizationCache.size>10){const t=this.categorizationCache.keys().next().value;this.categorizationCache.delete(t)}}static clearCategorizationCache(){this.categorizationCache.clear()}static invalidateCacheAfterModuleOperation(){this.clearCategorizationCache()}static getCategorizationStats(){return{cacheSize:this.categorizationCache.size,cacheEntries:Array.from(this.categorizationCache.entries()).map(([e,s])=>({key:e,age:Date.now()-s.timestamp,modulesCount:s.data.primaryModules.length+s.data.secondaryModules.length}))}}static formatTTL(e){return e<60?`${e} —Å–µ–∫`:e<3600?`${Math.floor(e/60)} –º–∏–Ω`:`${Math.floor(e/3600)} —á`}static formatCreationTime(e){return e<1e3?`${Math.round(e)}–º—Å`:e<6e4?`${Math.round(e/1e3*10)/10}—Å–µ–∫`:`${Math.round(e/6e4*10)/10}–º–∏–Ω`}static formatCacheHitRatio(e){return`${Math.round(e*100)}%`}static formatDataFreshness(e){return`${Math.round(e*100)}%`}static getExpiryColor(e){if(!e)return"gray";const s=Date.now()/1e3,t=(e-s)/3600;return t>2?"green":t>.5?"yellow":"red"}static getEfficiencyColor(e){return e>=.85?"green":e>=.7?"yellow":"red"}static getCreationTimeColor(e){return e<=2e3?"green":e<=1e4?"yellow":"red"}static getFreshnessColor(e){return e>=.9?"green":e>=.7?"yellow":"red"}static generateModuleMetadata(e){const s=Math.floor(Date.now()/1e3),t=e.metadata||{},r=this.PRIMARY_MODULE_IDS.includes(e.id);return{version:t.version||"1.0",module_id:e.id,module_name:e.name,created_at:t.created_at||s-Math.random()*86400*7,created_by:t.created_by||(Math.random()>.5?"system":"cron"),creation_time_ms:t.creation_time_ms||500+Math.random()*9500,last_accessed_at:t.last_accessed_at||s-Math.random()*3600,access_count:t.access_count||Math.floor(Math.random()*100)+1,expires_at:t.expires_at||s+(e.ttl||3600),ttl_seconds:e.ttl||3600,file_size_bytes:e.total_size||Math.floor(Math.random()*1e7)+1e6,compression_ratio:t.compression_ratio||.7+Math.random()*.3,data_version:t.data_version||`2026.01.12.v${Math.floor(Math.random()*10)+1}`,source_params:t.source_params||{period:r?Math.random()>.5?"weeks":"months":"default",sector_id:e.id.includes("sector-1c")?"1c":"all",filters:Math.random()>.5?["active_only"]:[],limit:Math.floor(Math.random()*1e3)+500},performance_metrics:t.performance_metrics||{avg_response_time_ms:20+Math.random()*80,cache_hit_ratio:.7+Math.random()*.3,data_freshness_score:.8+Math.random()*.2}}}static getMockModules(){const e=Math.floor(Date.now()/1e3);return[{id:"dashboard-sector-1c",name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",status:"active",file_count:5,total_size:1024e3,ttl:600,created_at:e-7200,expires_at:e+1800,cache_dir:"api/cache/dashboard-sector-1c"},{id:"graph-state",name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",status:"active",file_count:3,total_size:512e3,ttl:3600,created_at:e-3600,expires_at:e+7200,cache_dir:"api/cache/graph-state"},{id:"graph-admission-closure-weeks",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–µ–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",status:"active",file_count:8,total_size:2048e3,ttl:300,created_at:e-1800,expires_at:e+120,cache_dir:"api/cache/graph-admission-closure/weeks"},{id:"graph-admission-closure-months",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–µ–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",status:"active",file_count:12,total_size:3072e3,ttl:300,created_at:e-3600,expires_at:e+240,cache_dir:"api/cache/graph-admission-closure/months"},{id:"time-tracking-default",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",status:"active",file_count:4,total_size:768e3,ttl:300,created_at:e-900,expires_at:e+2100,cache_dir:"api/cache/time-tracking-sector-1c/default"},{id:"time-tracking-detailed",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:6,total_size:1536e3,ttl:120,created_at:e-600,expires_at:e+3540,cache_dir:"api/cache/time-tracking-sector-1c/detailed"},{id:"time-tracking-summary",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:2,total_size:384e3,ttl:600,created_at:e-1800,expires_at:e+4200,cache_dir:"api/cache/time-tracking-sector-1c/summary"},{id:"users-management-departments",name:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–æ—Ç–¥–µ–ª—ã)",status:"active",file_count:2,total_size:256e3,ttl:3600,created_at:e-7200,expires_at:e+28800,cache_dir:"api/cache/users-management/departments"},{id:"webhook-logs-api",name:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ (API –∑–∞–ø—Ä–æ—Å—ã)",status:"active",file_count:15,total_size:512e4,ttl:300,created_at:e-3600,expires_at:e+2400,cache_dir:"api/cache/webhook-logs/api"}]}static enrichModulesWithMetadata(e){return e.map(s=>({...s,metadata:this.generateModuleMetadata(s)}))}}De(Q,"PRIMARY_MODULE_IDS",["dashboard-sector-1c","graph-state","graph-admission-closure-weeks","graph-admission-closure-months","time-tracking-default","time-tracking-detailed","time-tracking-summary"]),De(Q,"PRIMARY_MODULE_PRIORITIES",{"dashboard-sector-1c":1,"graph-state":2,"graph-admission-closure-weeks":3,"graph-admission-closure-months":4,"time-tracking-default":5,"time-tracking-detailed":6,"time-tracking-summary":7}),De(Q,"SECONDARY_MODULE_TYPES",{users:{prefix:"users-management",title:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –æ—Ç–¥–µ–ª–∞–º–∏"},activity:{prefix:"user-activity",title:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",description:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},webhooks:{prefix:"webhook-logs",title:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",description:"–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±—Ö—É–∫–æ–≤"}}),De(Q,"categorizationCache",new Map),De(Q,"CACHE_TTL",3e4);function cc(o){const e=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())),s=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-s);const t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}class yt{static async createCache(e,s=null,t={}){try{const r=Le("/api/admin/cache-create.php"),l=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,mode:s,params:t})});if(!l.ok){const i=await l.json().catch(()=>({}));throw new Error(i.error||`HTTP error! status: ${l.status}`)}const n=await l.json();if(n.success)return n;throw new Error(n.error||"Failed to create cache")}catch(r){throw console.error("[CacheCreationService] Error creating cache:",r),r}}static async getCreationStatus(e){try{const s=Le(`/api/admin/cache-create-status.php?task_id=${e}`),t=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return r;throw new Error(r.error||"Failed to get creation status")}catch(s){throw console.error("[CacheCreationService] Error getting creation status:",s),s}}static getDefaultParams(e){if(e.includes("graph-admission-closure"))if((e.includes("weeks")?"weeks":"months")==="weeks"){const t=new Date,r=t.getUTCFullYear(),l=cc(t),n=new Date(r,0,1+(l-1)*7),i=n.getUTCDay(),u=n.getUTCDate()-i+(i===0?-6:1);n.setUTCDate(u),n.setUTCHours(0,0,0,0);const _=new Date(n);return _.setUTCDate(n.getUTCDate()+6),_.setUTCHours(23,59,59,999),{product:"1C",periodMode:"weeks",weekStartUtc:n.toISOString(),weekEndUtc:_.toISOString(),includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,useCache:!0,forceRefresh:!0}}else return{product:"1C",periodMode:"months",includeTickets:!0,includeNewTicketsByStages:!1,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!1};if(e.includes("dashboard-sector-1c"))return{forceRefresh:!0,ttl:600};if(e.includes("graph-state"))return{type:"current",forceRefresh:!0,ttl:3600};if(e.includes("time-tracking")){const s=e.includes("detailed")?"detailed":e.includes("summary")?"summary":"default";return{product:"1C",includeTaskDetails:s==="detailed",summary:s==="summary"}}return{}}}class ot{static notifyCacheCreationStarted(e){this.showNotification({content:`–ù–∞—á–∞—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}"...`,type:"info",autoHideDelay:3e3})}static notifyCacheCreationSuccess(e){this.showNotification({content:`‚úÖ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,type:"success",autoHideDelay:5e3})}static notifyCacheCreationError(e,s){this.showNotification({content:`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}": ${s}`,type:"error",autoHideDelay:7e3})}static notifyCacheUpdated(e,s="auto"){const t=s==="manual"?"–≤—Ä—É—á–Ω—É—é":"–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏";this.showNotification({content:`üîÑ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" –æ–±–Ω–æ–≤–ª—ë–Ω ${t}`,type:"info",autoHideDelay:4e3})}static notifyCacheUsed(e){this.showNotification({content:`‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}"`,type:"success",autoHideDelay:3e3})}static showNotification(e){typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:e.content,autoHideDelay:e.autoHideDelay||3e3}):console.log("[CacheNotification]",e.content)}}const wg=Object.freeze(Object.defineProperty({__proto__:null,CacheNotificationService:ot},Symbol.toStringTag,{value:"Module"})),dc={name:"CacheCreateProgress",props:{progress:{type:Number,required:!0,validator:o=>o>=0&&o<=100},message:{type:String,default:"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞..."}}},uc={class:"cache-create-progress"},gc={class:"progress-bar"},mc={class:"progress-text"};function fc(o,e,s,t,r,l){return c(),d("div",uc,[a("div",gc,[a("div",{class:"progress-fill",style:Je({width:s.progress+"%"})},null,4)]),a("div",mc,g(s.progress)+"% - "+g(s.message),1)])}const hc=Y(dc,[["render",fc],["__scopeId","data-v-7071de3b"]]),vc={name:"CacheCreateModal",components:{CacheCreateProgress:hc},props:{module:{type:Object,required:!0}},emits:["close","create"],setup(o,{emit:e}){const s=M(!1),t=M(0),r=M(""),l=M(null),n=M(""),i=v(()=>o.module.id.includes("graph-admission-closure")||o.module.id.includes("time-tracking")),u=v(()=>o.module.id.includes("graph-admission-closure")?["months","weeks"]:o.module.id.includes("time-tracking")?["default","detailed","summary"]:[]),_=()=>{e("close")},S=I=>{I.preventDefault(),I.stopPropagation(),I.target===I.currentTarget&&_()},b=async()=>{s.value=!0,t.value=0,r.value="–ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞...";try{let I={};if(n.value.trim())try{I=JSON.parse(n.value)}catch{throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")}else I=yt.getDefaultParams(o.module.id);ot.notifyCacheCreationStarted(o.module.name),t.value=25,r.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24...";const A=await yt.createCache(o.module.id,l.value,I);t.value=75,r.value="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∞...",await new Promise(k=>setTimeout(k,500)),t.value=100,r.value="–ö–µ—à —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",ot.notifyCacheCreationSuccess(o.module.name),setTimeout(()=>{e("create",A),_()},1e3)}catch(I){console.error("[CacheCreateModal] Error creating cache:",I),ot.notifyCacheCreationError(o.module.name,I.message),s.value=!1}};return pe(()=>{u.value.length>0&&(l.value=u.value[0]);const I=yt.getDefaultParams(o.module.id);n.value=JSON.stringify(I,null,2)}),{creating:s,progress:t,progressMessage:r,selectedMode:l,paramsJson:n,supportsModes:i,availableModes:u,close:_,handleOverlayClick:S,handleCreate:b}}},yc={class:"modal-header"},pc={class:"modal-body"},bc={key:1,class:"create-form"},_c={key:0,class:"form-group"},wc=["value"],Cc={class:"form-group"},kc={class:"modal-footer"},Sc=["disabled"],xc=["disabled"],Mc={key:0},Ac={key:1};function Ec(o,e,s,t,r,l){const n=J("CacheCreateProgress");return c(),K(_t,{to:"body"},[a("div",{class:"modal-overlay",onClick:e[6]||(e[6]=(...i)=>t.handleOverlayClick&&t.handleOverlayClick(...i))},[a("div",{class:"modal-content",onClick:e[5]||(e[5]=Me(()=>{},["stop"])),style:{"pointer-events":"auto"}},[a("div",yc,[a("h2",null,"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞: "+g(s.module.name),1),a("button",{onClick:e[0]||(e[0]=(...i)=>t.close&&t.close(...i)),class:"btn-close"},"√ó")]),a("div",pc,[t.creating?(c(),K(n,{key:0,progress:t.progress,message:t.progressMessage},null,8,["progress","message"])):(c(),d("div",bc,[t.supportsModes?(c(),d("div",_c,[e[7]||(e[7]=a("label",null,"–†–µ–∂–∏–º –∫–µ—à–∞:",-1)),ue(a("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>t.selectedMode=i),class:"form-control"},[(c(!0),d(Z,null,ee(t.availableModes,i=>(c(),d("option",{key:i,value:i},g(i),9,wc))),128))],512),[[Ge,t.selectedMode]])])):w("",!0),a("div",Cc,[e[8]||(e[8]=a("label",null,"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):",-1)),ue(a("textarea",{"onUpdate:modelValue":e[2]||(e[2]=i=>t.paramsJson=i),placeholder:'{"product": "1C", ...}',rows:"5",class:"form-control"},null,512),[[Ke,t.paramsJson]]),e[9]||(e[9]=a("small",{class:"form-text"},"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",-1))])]))]),a("div",kc,[a("button",{onClick:e[3]||(e[3]=(...i)=>t.close&&t.close(...i)),class:"btn-cancel",disabled:t.creating},"–û—Ç–º–µ–Ω–∞",8,Sc),a("button",{onClick:e[4]||(e[4]=(...i)=>t.handleCreate&&t.handleCreate(...i)),disabled:t.creating,class:"btn-create"},[t.creating?(c(),d("span",Mc,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",Ac,"–°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],8,xc)])])])])}const Lc=Y(vc,[["render",Ec],["__scopeId","data-v-1fa7d83b"]]),Tc={name:"CacheCreateButton",components:{CacheCreateModal:Lc},props:{module:{type:Object,required:!0}},emits:["created"],setup(o,{emit:e}){const s=M(!1),t=M(!1);return{showModal:s,creating:t,openModal:()=>{s.value=!0},closeModal:()=>{s.value=!1},handleCreate:async i=>{t.value=!0;try{e("created",i)}finally{t.value=!1}}}}},Dc={class:"cache-create-button"},Ic=["disabled"],Pc={key:0},Uc={key:1};function Nc(o,e,s,t,r,l){const n=J("CacheCreateModal");return c(),d("div",Dc,[a("button",{onClick:e[0]||(e[0]=(...i)=>t.openModal&&t.openModal(...i)),disabled:t.creating,class:z(["btn-create",{"btn-disabled":t.creating}])},[t.creating?(c(),d("span",Pc,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",Uc,"‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],10,Ic),t.showModal?(c(),K(n,{key:0,module:s.module,onClose:t.closeModal,onCreate:t.handleCreate},null,8,["module","onClose","onCreate"])):w("",!0)])}const Oc=Y(Tc,[["render",Nc],["__scopeId","data-v-45e7d308"]]);class ve{static success(e,s,t={}){this.show("success",e,s,t)}static error(e,s,t={}){this.show("error",e,s,t)}static warning(e,s,t={}){this.show("warning",e,s,t)}static info(e,s,t={}){this.show("info",e,s,t)}static show(e,s,t,r={}){const l={autoHideDelay:r.autoHideDelay||5e3,position:r.position||"top-right",...r};this.isBitrix24Available()?this.showBitrix24Notification(e,s,t,l):this.showFallbackNotification(e,s,t,l)}static isBitrix24Available(){return typeof window<"u"&&window.BX&&window.BX.UI&&window.BX.UI.Notification&&window.BX.UI.Notification.Center&&typeof window.BX.UI.Notification.Center.notify=="function"}static showBitrix24Notification(e,s,t,r){try{const n={success:"success",error:"error",warning:"warning",info:"info"}[e]||"info",i=s?`${s}: ${t}`:t;window.BX.UI.Notification.Center.notify({content:i,autoHideDelay:r.autoHideDelay,category:`cache-management-${e}`,position:r.position}),console.log(`[NotificationSystem] Bitrix24 notification shown: ${e}`,{title:s,message:t,config:r})}catch(l){console.error("[NotificationSystem] Error showing Bitrix24 notification:",l),this.showFallbackNotification(e,s,t,r)}}static showFallbackNotification(e,s,t,r){if("Notification"in window&&Notification.permission==="granted")try{const l=new Notification(s||"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",{body:t,icon:this.getIconForType(e),tag:`cache-management-${e}`});setTimeout(()=>{l.close()},r.autoHideDelay),console.log(`[NotificationSystem] Browser notification shown: ${e}`,{title:s,message:t});return}catch(l){console.warn("[NotificationSystem] Browser notification failed:",l)}this.showCustomNotification(e,s,t,r)}static showCustomNotification(e,s,t,r){let l=document.getElementById("notification-container");if(!l){l=document.createElement("div"),l.id="notification-container",l.className="notification-container",document.body.appendChild(l);const u=document.createElement("style");u.textContent=this.getNotificationStyles(),document.head.appendChild(u)}const n=document.createElement("div");n.className=`custom-notification notification-${e}`,n.innerHTML=`
      <div class="notification-content">
        <div class="notification-title">${s||""}</div>
        <div class="notification-message">${t}</div>
      </div>
      <button class="notification-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">√ó</button>
    `,n.querySelector(".notification-close").addEventListener("click",()=>{this.removeCustomNotification(n)}),l.appendChild(n),setTimeout(()=>{this.removeCustomNotification(n)},r.autoHideDelay),console.log(`[NotificationSystem] Custom notification shown: ${e}`,{title:s,message:t})}static removeCustomNotification(e){e&&e.parentNode&&(e.classList.add("notification-hiding"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}static getIconForType(e){const s={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};return s[e]||s.info}static getNotificationStyles(){return`
      .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        pointer-events: none;
      }

      .custom-notification {
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 10px;
        min-width: 300px;
        max-width: 500px;
        pointer-events: auto;
        opacity: 0;
        transform: translateX(100%);
        animation: notificationSlideIn 0.3s ease forwards;
        border-left: 4px solid;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        padding: 16px;
        gap: 12px;
      }

      .custom-notification.notification-success {
        border-left-color: #28a745;
      }

      .custom-notification.notification-error {
        border-left-color: #dc3545;
      }

      .custom-notification.notification-warning {
        border-left-color: #ffc107;
      }

      .custom-notification.notification-info {
        border-left-color: #17a2b8;
      }

      .notification-content {
        flex: 1;
      }

      .notification-title {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
        color: #333;
      }

      .notification-message {
        font-size: 13px;
        color: #666;
        line-height: 1.4;
      }

      .notification-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #999;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        flex-shrink: 0;
      }

      .notification-close:hover {
        color: #333;
      }

      .notification-hiding {
        animation: notificationSlideOut 0.3s ease forwards;
      }

      @keyframes notificationSlideIn {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes notificationSlideOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(100%);
        }
      }

      @media (max-width: 768px) {
        .notification-container {
          left: 10px;
          right: 10px;
          top: 10px;
        }

        .custom-notification {
          min-width: auto;
          max-width: none;
        }
      }
    `}static clearAll(){try{this.isBitrix24Available()&&window.BX.UI.Notification.Center.clearAll&&window.BX.UI.Notification.Center.clearAll()}catch(s){console.warn("[NotificationSystem] Error clearing Bitrix24 notifications:",s)}const e=document.getElementById("notification-container");if(e&&(e.innerHTML=""),"Notification"in window&&"getNotifications"in Notification)try{Notification.getNotifications().forEach(t=>{t.tag&&t.tag.startsWith("cache-management-")&&t.close()})}catch(s){console.warn("[NotificationSystem] Error clearing browser notifications:",s)}}}ve.show.bind(ve);ve.success.bind(ve);ve.error.bind(ve);ve.warning.bind(ve);ve.info.bind(ve);let ce=null,Se=null;const He=class He{static show(e={}){return new Promise((s,t)=>{Se=s,ce||(ce=this.createModal(),document.body.appendChild(ce)),this.configureModal(e),this.showModal()})}static hide(){ce&&(this.hideModal(),Se&&(Se(!1),Se=null))}static createModal(){const e=document.createElement("div");return e.className="cache-confirmation-modal",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","confirmation-title"),e.setAttribute("aria-describedby","confirmation-message"),e.innerHTML=`
      <div class="modal-backdrop" data-action="cancel"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="confirmation-title" class="modal-title"></h3>
          <button
            class="modal-close"
            data-action="cancel"
            aria-label="–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"
          >
            √ó
          </button>
        </div>

        <div class="modal-body">
          <div class="modal-icon">
            <span class="icon-symbol"></span>
          </div>
          <p id="confirmation-message" class="modal-message"></p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-cancel" data-action="cancel"></button>
          <button class="btn btn-confirm" data-action="confirm"></button>
        </div>
      </div>
    `,this.attachEventListeners(e),this.addStyles(),e}static configureModal(e){const{title:s="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",message:t="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ?",type:r="warning",confirmText:l="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",cancelText:n="–û—Ç–º–µ–Ω–∞",showCancel:i=!0}=e,u=ce.querySelector(".modal-title");u.textContent=s;const _=ce.querySelector(".modal-message");_.textContent=t;const S=ce.querySelector(".icon-symbol"),b={danger:"‚ö†Ô∏è",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è",success:"‚úÖ"};S.textContent=b[r]||b.warning;const I=ce.querySelector(".btn-cancel"),A=ce.querySelector(".btn-confirm");I.textContent=n,A.textContent=l,i?I.style.display="inline-block":I.style.display="none",ce.className=`cache-confirmation-modal modal-${r}`}static showModal(){document.body.style.overflow="hidden",ce.style.display="flex",ce.classList.add("modal-visible"),setTimeout(()=>{const e=ce.querySelector(".btn-confirm");e&&e.focus()},100),document.addEventListener("keydown",this.handleKeyDown)}static hideModal(){document.body.style.overflow="",ce.classList.remove("modal-visible"),document.removeEventListener("keydown",this.handleKeyDown),setTimeout(()=>{ce&&(ce.style.display="none")},300)}static attachEventListeners(e){e.addEventListener("click",s=>{const t=s.target.closest("[data-action]")?.getAttribute("data-action");t==="confirm"?this.handleConfirm():t==="cancel"&&this.handleCancel()})}static handleConfirm(){Se&&(Se(!0),Se=null),this.hideModal()}static handleCancel(){Se&&(Se(!1),Se=null),this.hideModal()}static handleTabNavigation(e){const t=ce.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),r=t[0],l=t[t.length-1];e.shiftKey?document.activeElement===r&&(e.preventDefault(),l.focus()):document.activeElement===l&&(e.preventDefault(),r.focus())}static addStyles(){if(document.getElementById("cache-confirmation-styles"))return;const e=document.createElement("style");e.id="cache-confirmation-styles",e.textContent=`
      .cache-confirmation-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        align-items: center;
        justify-content: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      .cache-confirmation-modal.modal-visible {
        display: flex;
      }

      .modal-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(2px);
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        z-index: 10001;
        animation: modalSlideIn 0.3s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px 16px;
        border-bottom: 1px solid #e0e0e0;
      }

      .modal-title {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: #333;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .modal-close:hover {
        background: #f0f0f0;
        color: #333;
      }

      .modal-body {
        padding: 24px;
        text-align: center;
      }

      .modal-icon {
        margin-bottom: 16px;
      }

      .icon-symbol {
        font-size: 48px;
        display: block;
      }

      .modal-message {
        margin: 0;
        font-size: 16px;
        color: #555;
        line-height: 1.5;
      }

      .modal-footer {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        padding: 16px 24px 24px;
        border-top: 1px solid #e0e0e0;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
        min-width: 80px;
      }

      .btn:focus {
        outline: 2px solid #007bff;
        outline-offset: 2px;
      }

      .btn-cancel {
        background: #f8f9fa;
        color: #6c757d;
        border: 1px solid #dee2e6;
      }

      .btn-cancel:hover {
        background: #e9ecef;
        border-color: #adb5bd;
      }

      .btn-confirm {
        background: #007bff;
        color: white;
      }

      .btn-confirm:hover {
        background: #0056b3;
      }

      /* –¢–∏–ø—ã –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
      .modal-danger .btn-confirm {
        background: #dc3545;
      }

      .modal-danger .btn-confirm:hover {
        background: #c82333;
      }

      .modal-warning .btn-confirm {
        background: #ffc107;
        color: #212529;
      }

      .modal-warning .btn-confirm:hover {
        background: #e0a800;
      }

      .modal-info .btn-confirm {
        background: #17a2b8;
      }

      .modal-info .btn-confirm:hover {
        background: #138496;
      }

      .modal-success .btn-confirm {
        background: #28a745;
      }

      .modal-success .btn-confirm:hover {
        background: #1e7e34;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
      @media (max-width: 480px) {
        .modal-content {
          margin: 20px;
          width: calc(100% - 40px);
        }

        .modal-header,
        .modal-body,
        .modal-footer {
          padding-left: 20px;
          padding-right: 20px;
        }

        .modal-footer {
          flex-direction: column-reverse;
        }

        .btn {
          width: 100%;
        }
      }

      /* –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å */
      @media (prefers-reduced-motion: reduce) {
        .modal-content,
        .modal-close,
        .btn {
          animation: none;
          transition: none;
        }
      }

      /* –í—ã—Å–æ–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç */
      @media (prefers-contrast: high) {
        .modal-content {
          border: 2px solid #000;
        }

        .btn-cancel {
          border: 2px solid #000;
        }

        .btn-confirm {
          border: 2px solid #000;
        }
      }
    `,document.head.appendChild(e)}};De(He,"handleKeyDown",e=>{switch(e.key){case"Enter":e.preventDefault(),He.handleConfirm();break;case"Escape":e.preventDefault(),He.handleCancel();break;case"Tab":He.handleTabNavigation(e);break}});let Be=He;Be.show.bind(Be);Be.hide.bind(Be);const Fc={name:"CacheModuleCard",components:{CacheCreateButton:Oc},props:{module:{type:Object,required:!0,validator:o=>o&&typeof o.id=="string"&&typeof o.name=="string"},isPrimary:{type:Boolean,default:!1},priority:{type:Number,default:999},groupType:{type:String,default:null}},emits:["clear","refresh","details"],setup(o,{emit:e}){const s=M(!1),t=M(!1),r=M(!1),l=M(!1),n=p=>{if(!p.target.closest(".action-button"))switch(p.key){case"Enter":case" ":p.preventDefault();const H=p.currentTarget.querySelector(".action-button:not([disabled])");H&&H.focus();break}};pe(()=>{const p=()=>{l.value=window.innerWidth<768};p(),window.addEventListener("resize",p);const H=document.querySelector(`[data-module-id="${o.module.id}"]`);H&&H.addEventListener("keydown",n)}),it(()=>{const p=document.querySelector(`[data-module-id="${o.module.id}"]`);p&&p.removeEventListener("keydown",n)});const i=v(()=>({"cache-module-card":!0,"primary-module":o.isPrimary,"secondary-module":!o.isPrimary,"high-priority":o.priority<=3,"expiring-soon":U.value,"empty-cache":A.value,loading:s.value||t.value,[me.value]:!0})),u=v(()=>o.isPrimary?"üèÜ":{users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"}[o.groupType]||"üîß"),_=v(()=>({"primary-icon":o.isPrimary,"secondary-icon":!o.isPrimary})),S=v(()=>o.isPrimary?"–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å":o.groupType?Q.getModuleTypeConfig(o.groupType).title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞":""),b=v(()=>o.priority?`priority-${o.priority}`:""),I=v(()=>`status-${o.module.status||"empty"}`),A=v(()=>(o.module.file_count||0)===0),k=v(()=>o.module.expires_at?new Date(o.module.expires_at*1e3)<=new Date:!1),U=v(()=>{if(!o.module.expires_at)return!1;const B=(new Date(o.module.expires_at*1e3)-new Date)/(1e3*60*60);return B>0&&B<=2}),N=v(()=>{const p=o.module.status;return p==="active"?"–ê–∫—Ç–∏–≤–µ–Ω":p==="expired"?"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω":p==="empty"?"–ü—É—Å—Ç":"–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}),h=v(()=>Q.formatCacheSize(o.module.total_size||0)),L=v(()=>Q.formatTTL(o.module.ttl||0)),E=v(()=>{if(!o.module.cache_dir)return"";const p=o.module.cache_dir.split("/");return p.length>2?"..."+p.slice(-2).join("/"):o.module.cache_dir}),R=v(()=>o.module.metadata?.creation_time_ms?Q.formatCreationTime(o.module.metadata.creation_time_ms):"‚Äî"),F=v(()=>{if(!o.module.metadata?.last_accessed_at)return"‚Äî";const p=new Date(o.module.metadata.last_accessed_at*1e3),B=new Date-p;return B<6e4?"–¢–æ–ª—å–∫–æ —á—Ç–æ":B<36e5?`${Math.floor(B/6e4)} –º–∏–Ω –Ω–∞–∑–∞–¥`:p.toLocaleString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),y=v(()=>o.module.metadata?.access_count||0),f=v(()=>o.module.metadata?.performance_metrics?.cache_hit_ratio?Q.formatCacheHitRatio(o.module.metadata.performance_metrics.cache_hit_ratio):"‚Äî"),m=v(()=>o.module.metadata?.performance_metrics?.data_freshness_score?Q.formatDataFreshness(o.module.metadata.performance_metrics.data_freshness_score):"‚Äî"),P=v(()=>o.module.expires_at?`metric-${Q.getExpiryColor(o.module.expires_at)}`:""),$=v(()=>o.module.metadata?.creation_time_ms?`metric-${Q.getCreationTimeColor(o.module.metadata.creation_time_ms)}`:""),j=v(()=>o.module.metadata?.performance_metrics?.cache_hit_ratio?`metric-${Q.getEfficiencyColor(o.module.metadata.performance_metrics.cache_hit_ratio)}`:""),X=v(()=>o.module.metadata?.performance_metrics?.data_freshness_score?`metric-${Q.getFreshnessColor(o.module.metadata.performance_metrics.data_freshness_score)}`:""),T=v(()=>{if(!o.module.expires_at)return null;const p=new Date(o.module.expires_at*1e3);return Math.max(0,Math.floor((p-new Date)/1e3))}),W=v(()=>{if(T.value===null)return"‚Äî";if(T.value<=0)return"–ò—Å—Ç–µ–∫";const p=Math.floor(T.value/3600),H=Math.floor(T.value%3600/60),B=T.value%60;return p>0?`${p}—á ${H}–º`:H>0?`${H}–º ${B}—Å`:`${B}—Å`}),ie=v(()=>T.value===null?"":T.value<=0||T.value<=1800?"metric-red":T.value<=7200?"metric-orange":"metric-green"),ge=p=>{if(p===0)return"0 B";const H=1024,B=["B","KB","MB","GB","TB"],G=Math.floor(Math.log(p)/Math.log(H));return parseFloat((p/Math.pow(H,G)).toFixed(1))+" "+B[G]},Ne=p=>p<60?`${p}—Å`:p<3600?`${Math.floor(p/60)}–º`:p<86400?`${Math.floor(p/3600)}—á`:`${Math.floor(p/86400)}–¥`,ye=v(()=>{if(A.value)return"empty";if(k.value)return"expired";const p=T.value;return p===null?"fresh":p<=0?"expired":p<=30*60*1e3?"critical":p<=2*60*60*1e3?"warning":"fresh"}),Oe=v(()=>{const p=ye.value;return{fresh:"–°–≤–µ–∂–∏–π –∫–µ—à",warning:"–ò—Å—Ç–µ–∫–∞–µ—Ç —Å–∫–æ—Ä–æ",critical:"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç",expired:"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω",empty:"–ö–µ—à –ø—É—Å—Ç"}[p]||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}),me=v(()=>`cache-state-${ye.value}`),Fe=v(()=>({fresh:"üü¢",warning:"üü°",critical:"üî¥",expired:"‚ö´",empty:"‚ö™"})[ye.value]||"‚ùì"),be=v(()=>!A.value&&!s.value),x=v(()=>o.isPrimary&&!A.value),O=v(()=>A.value?"–ö–µ—à –º–æ–¥—É–ª—è –ø—É—Å—Ç":`–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è ${o.module.name}`),V=v(()=>{if(!o.module.created_at)return"‚Äî";const p=new Date(o.module.created_at*1e3),H=new Date,B=H-p;if(B<6e4)return"–¢–æ–ª—å–∫–æ —á—Ç–æ";if(B<36e5){const oe=Math.floor(B/6e4);return`${oe} ${oe===1?"–º–∏–Ω—É—Ç—É":oe<5?"–º–∏–Ω—É—Ç—ã":"–º–∏–Ω—É—Ç"} –Ω–∞–∑–∞–¥`}if(p.toDateString()===H.toDateString())return`–°–µ–≥–æ–¥–Ω—è –≤ ${p.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`;const G=new Date(H);return G.setDate(G.getDate()-1),p.toDateString()===G.toDateString()?`–í—á–µ—Ä–∞ –≤ ${p.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:p.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),ae=v(()=>{if(!o.module.expires_at)return"‚Äî";const p=new Date(o.module.expires_at*1e3),B=p-new Date;if(B<0)return`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω (${p.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})`;const G=Math.floor(B/6e4),oe=Math.floor(G/60);return oe>0?`${oe} —á ${G%60} –º–∏–Ω`:G>0?`${G} –º–∏–Ω`:"–ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã"});return{clearing:s,creating:t,showDetailModal:r,isMobile:l,moduleClasses:i,moduleIcon:u,iconClass:_,moduleTypeText:S,priorityClass:b,statusClass:I,isEmpty:A,isExpired:k,isExpiringSoon:U,statusText:N,formattedSize:h,formattedTTL:L,shortCacheDir:E,formattedCreationTime:R,formattedLastAccess:F,accessCount:y,cacheEfficiency:f,dataFreshness:m,expiresClass:P,creationTimeClass:$,cacheEfficiencyClass:j,dataFreshnessClass:X,cacheState:ye,cacheStateText:Oe,cacheStateClass:me,cacheStateIcon:Fe,timeToExpiry:T,formatTimeToExpiry:W,timeToExpiryClass:ie,formatBytes:ge,formatTTL:Ne,canClear:be,canShowDetails:x,clearButtonLabel:O,formattedCreatedAt:V,formattedExpiresAt:ae,handleClear:async()=>{if(be.value)try{if(!await Be.show({title:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",message:`–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${o.module.name}"?

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`,type:"danger",confirmText:"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à",cancelText:"–û—Ç–º–µ–Ω–∞"}))return;s.value=!0,await Q.clearCache(o.module.id),e("clear",o.module.id),ve.success("–ö–µ—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω",`–ö–µ—à –º–æ–¥—É–ª—è "${o.module.name}" –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω`)}catch(p){console.error("[CacheModuleCard] Error clearing cache:",p),ve.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${o.module.name}": ${p.message}`)}finally{s.value=!1}},handleCacheCreated:()=>{Q.invalidateCacheAfterModuleOperation(),e("refresh")},handleCreatingState:p=>{t.value=p},showDetails:()=>{r.value=!0,e("details",o.module)},closeDetails:()=>{r.value=!1}}}},Rc=["aria-labelledby","aria-describedby","data-module-id"],Bc={class:"card-header"},Vc={class:"module-identity"},zc={class:"module-info"},Hc=["id"],jc={class:"module-type"},Wc={class:"header-meta"},qc=["id"],Xc={class:"card-content"},Jc={class:"data-grid",role:"region","aria-label":"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–µ—à–µ"},$c={class:"data-section statistics"},Kc={class:"data-items"},Gc={class:"data-item"},Yc={class:"data-value"},Qc={class:"data-item"},Zc={class:"data-value"},ed={key:0,class:"data-item full-width"},td=["title"],sd={class:"data-section lifetime"},ad={class:"data-items"},od={class:"data-item"},nd={class:"data-value"},rd={key:0,class:"data-item"},id={class:"data-value"},ld={key:1,class:"data-item"},cd={class:"data-section cache-state"},dd={class:"section-header"},ud=["aria-label"],gd={class:"data-items"},md={class:"data-value cache-state-text"},fd={key:0,class:"data-section performance"},hd={class:"data-items"},vd={key:0,class:"data-item"},yd={key:1,class:"data-item"},pd={class:"data-value"},bd={key:2,class:"data-item"},_d={class:"data-value"},wd={key:3,class:"data-item"},Cd={key:4,class:"data-item"},kd={key:5,class:"data-item"},Sd={class:"data-value"},xd={key:6,class:"data-item"},Md={class:"data-value"},Ad={key:7,class:"data-item"},Ed=["aria-label"],Ld={class:"primary-actions"},Td={class:"secondary-actions"},Dd=["disabled","aria-label"],Id={key:0,class:"button-content"},Pd={key:1,class:"button-content"},Ud={key:2,class:"button-content"},Nd=["aria-label"],Od={class:"detail-modal",role:"dialog","aria-modal":"true"},Fd={class:"modal-header"},Rd={class:"modal-content"},Bd={class:"json-data"};function Vd(o,e,s,t,r,l){const n=J("CacheCreateButton");return c(),d("article",{class:z(["cache-module-card",t.moduleClasses]),role:"article","aria-labelledby":`module-${s.module.id}-title`,"aria-describedby":`module-${s.module.id}-status`,"data-module-id":s.module.id,tabindex:"0"},[a("div",Bc,[a("div",Vc,[a("div",{class:z(["module-icon",t.iconClass])},g(t.moduleIcon),3),a("div",zc,[a("h3",{class:"module-name",id:`module-${s.module.id}-title`},g(s.module.name),9,Hc),a("span",jc,g(t.moduleTypeText),1)])]),a("div",Wc,[s.isPrimary&&s.priority?(c(),d("span",{key:0,class:z(["priority-badge",t.priorityClass])},g(s.priority),3)):w("",!0),a("span",{class:z(["status-badge",t.statusClass]),id:`module-${s.module.id}-status`,role:"status"},g(t.statusText),11,qc)])]),a("div",Xc,[a("div",Jc,[a("div",$c,[e[14]||(e[14]=a("div",{class:"section-header"},[a("span",{class:"section-icon","aria-hidden":"true"},"üìä"),a("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],-1)),a("div",Kc,[a("div",Gc,[e[11]||(e[11]=a("span",{class:"data-label"},"–§–∞–π–ª–æ–≤:",-1)),a("span",Yc,g(s.module.file_count||0),1)]),a("div",Qc,[e[12]||(e[12]=a("span",{class:"data-label"},"–†–∞–∑–º–µ—Ä:",-1)),a("span",Zc,g(t.formattedSize),1)]),s.module.cache_dir?(c(),d("div",ed,[e[13]||(e[13]=a("span",{class:"data-label"},"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:",-1)),a("span",{class:"data-value cache-dir",title:s.module.cache_dir},g(t.shortCacheDir),9,td)])):w("",!0)])]),a("div",sd,[e[18]||(e[18]=a("div",{class:"section-header"},[a("span",{class:"section-icon","aria-hidden":"true"},"‚è∞"),a("h4",{class:"section-title"},"–í—Ä–µ–º—è –∂–∏–∑–Ω–∏")],-1)),a("div",ad,[a("div",od,[e[15]||(e[15]=a("span",{class:"data-label"},"TTL:",-1)),a("span",nd,g(t.formattedTTL),1)]),s.module.created_at?(c(),d("div",rd,[e[16]||(e[16]=a("span",{class:"data-label"},"–°–æ–∑–¥–∞–Ω:",-1)),a("span",id,g(t.formattedCreatedAt),1)])):w("",!0),s.module.expires_at?(c(),d("div",ld,[e[17]||(e[17]=a("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç:",-1)),a("span",{class:z(["data-value",t.expiresClass])},g(t.formattedExpiresAt),3)])):w("",!0)])]),a("div",cd,[a("div",dd,[a("span",{class:"section-icon","aria-label":t.cacheStateText,"aria-hidden":"false"},g(t.cacheStateIcon),9,ud),e[19]||(e[19]=a("h4",{class:"section-title"},"–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–µ—à–∞",-1))]),a("div",gd,[a("div",{class:z(["data-item cache-state-indicator",t.cacheStateClass])},[e[20]||(e[20]=a("span",{class:"data-label"},"–°—Ç–∞—Ç—É—Å:",-1)),a("span",md,g(t.cacheStateText),1)],2)])]),s.module.metadata||s.module.created_at?(c(),d("div",fd,[e[29]||(e[29]=a("div",{class:"section-header"},[a("span",{class:"section-icon","aria-hidden":"true"},"‚ö°"),a("h4",{class:"section-title"},"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")],-1)),a("div",hd,[t.formattedCreationTime?(c(),d("div",vd,[e[21]||(e[21]=a("span",{class:"data-label"},"–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:",-1)),a("span",{class:z(["data-value",t.creationTimeClass])},g(t.formattedCreationTime),3)])):w("",!0),t.formattedLastAccess?(c(),d("div",yd,[e[22]||(e[22]=a("span",{class:"data-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—Å—Ç—É–ø:",-1)),a("span",pd,g(t.formattedLastAccess),1)])):w("",!0),t.accessCount!==null?(c(),d("div",bd,[e[23]||(e[23]=a("span",{class:"data-label"},"–û–±—Ä–∞—â–µ–Ω–∏–π:",-1)),a("span",_d,g(t.accessCount),1)])):w("",!0),t.cacheEfficiency?(c(),d("div",wd,[e[24]||(e[24]=a("span",{class:"data-label"},"–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),a("span",{class:z(["data-value",t.cacheEfficiencyClass])},g(t.cacheEfficiency),3)])):w("",!0),t.dataFreshness?(c(),d("div",Cd,[e[25]||(e[25]=a("span",{class:"data-label"},"–°–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:",-1)),a("span",{class:z(["data-value",t.dataFreshnessClass])},g(t.dataFreshness),3)])):w("",!0),s.module.total_size?(c(),d("div",kd,[e[26]||(e[26]=a("span",{class:"data-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:",-1)),a("span",Sd,g(t.formatBytes(s.module.total_size)),1)])):w("",!0),s.module.ttl?(c(),d("div",xd,[e[27]||(e[27]=a("span",{class:"data-label"},"TTL:",-1)),a("span",Md,g(t.formatTTL(s.module.ttl)),1)])):w("",!0),t.timeToExpiry!==null?(c(),d("div",Ad,[e[28]||(e[28]=a("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑:",-1)),a("span",{class:z(["data-value",t.timeToExpiryClass])},g(t.formatTimeToExpiry),3)])):w("",!0)])])):w("",!0)])]),a("div",{class:z(["card-actions",{"mobile-layout":t.isMobile}]),role:"group","aria-label":`–î–µ–π—Å—Ç–≤–∏—è —Å –∫–µ—à–µ–º ${s.module.name}`},[a("div",Ld,[te(n,{module:s.module,disabled:t.creating,onCreated:t.handleCacheCreated,onCreating:t.handleCreatingState,class:z({loading:t.creating})},null,8,["module","disabled","onCreated","onCreating","class"])]),a("div",Td,[a("button",{onClick:e[0]||(e[0]=(...i)=>t.handleClear&&t.handleClear(...i)),onKeydown:[e[1]||(e[1]=de((...i)=>t.handleClear&&t.handleClear(...i),["enter"])),e[2]||(e[2]=de(Me((...i)=>t.handleClear&&t.handleClear(...i),["prevent"]),["space"]))],disabled:!t.canClear,class:z(["action-button clear-button",{disabled:!t.canClear,loading:t.clearing}]),"aria-label":t.clearButtonLabel,tabindex:"0"},[t.clearing?(c(),d("span",Id,[...e[30]||(e[30]=[a("span",{class:"spinner"},null,-1),se(" –û—á–∏—Å—Ç–∫–∞... ",-1)])])):t.isEmpty?(c(),d("span",Pd," üìÅ –ö–µ—à –ø—É—Å—Ç ")):(c(),d("span",Ud," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å "))],42,Dd),t.canShowDetails?(c(),d("button",{key:0,onClick:e[3]||(e[3]=(...i)=>t.showDetails&&t.showDetails(...i)),onKeydown:[e[4]||(e[4]=de((...i)=>t.showDetails&&t.showDetails(...i),["enter"])),e[5]||(e[5]=de(Me((...i)=>t.showDetails&&t.showDetails(...i),["prevent"]),["space"]))],class:"action-button details-button","aria-label":`–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞ ${s.module.name}`,title:"–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞",tabindex:"0"}," üìä ",40,Nd)):w("",!0)])],10,Ed),(c(),K(_t,{to:"body"},[t.showDetailModal?(c(),d("div",{key:0,class:"detail-modal-overlay",onClick:e[9]||(e[9]=Me((...i)=>t.closeDetails&&t.closeDetails(...i),["self"])),onKeydown:e[10]||(e[10]=de((...i)=>t.closeDetails&&t.closeDetails(...i),["escape"]))},[a("div",Od,[a("div",Fd,[a("h3",null,"–î–µ—Ç–∞–ª–∏ –∫–µ—à–∞: "+g(s.module.name),1),a("button",{onClick:e[6]||(e[6]=(...i)=>t.closeDetails&&t.closeDetails(...i)),onKeydown:[e[7]||(e[7]=de((...i)=>t.closeDetails&&t.closeDetails(...i),["enter"])),e[8]||(e[8]=de((...i)=>t.closeDetails&&t.closeDetails(...i),["escape"]))],class:"close-button","aria-label":"–ó–∞–∫—Ä—ã—Ç—å",tabindex:"0"}," ‚úï ",32)]),a("div",Rd,[a("pre",Bd,g(JSON.stringify(s.module,null,2)),1)])])],32)):w("",!0)]))],10,Rc)}const zd=Y(Fc,[["render",Vd],["__scopeId","data-v-bc59cd77"]]),Hd={name:"CacheStats",props:{modules:{type:Array,required:!1,default:()=>[]}},setup(o){console.log("[CacheStats] setup called with modules:",o.modules);const e=v(()=>o.modules||[]),s=v(()=>{console.log("[CacheStats] Computing primaryModules, total modules:",e.value?.length||0);const k=e.value.filter(U=>Q.PRIMARY_MODULE_IDS.includes(U.id));return console.log("[CacheStats] Primary modules count:",k.length),k}),t=v(()=>{console.log("[CacheStats] Computing secondaryModules, total modules:",e.value?.length||0);const k=e.value.filter(U=>!Q.PRIMARY_MODULE_IDS.includes(U.id));return console.log("[CacheStats] Secondary modules count:",k.length),k}),r=v(()=>s.value?.length||0),l=v(()=>t.value?.length||0),n=v(()=>e.value?.length||0),i=v(()=>e.value.reduce((k,U)=>k+(U.file_count||0),0)),u=v(()=>(o.modules||[]).reduce((k,U)=>k+(U.total_size||0),0)),_=v(()=>Q.formatCacheSize(u.value)),S=v(()=>{const k=o.modules||[];if(k.length===0)return"0 –º–∏–Ω";const U=k.reduce((h,L)=>h+(L.ttl||0),0),N=Math.round(U/k.length);return Q.formatTTL(N)}),b=v(()=>(e.value||[]).filter(k=>k.status==="active").length),I=v(()=>{if((l.value||0)===0)return[];const k={};(t.value||[]).forEach(N=>{const h=Q.getModuleType(N.id);if(!k[h]){const L=Q.getModuleTypeConfig(h);k[h]={type:h,title:L.title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞",icon:A(h),count:0}}k[h].count++});const U=l.value||0;return Object.values(k).map(N=>({...N,percentage:U>0?Math.round(N.count/U*100):0})).sort((N,h)=>h.count-N.count)}),A=k=>{const U={users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"};return U[k]||U.other};return{modules:e,primaryModulesCount:r,secondaryModulesCount:l,totalModules:n,totalFiles:i,totalSizeFormatted:_,avgTTL:S,activeModules:b,groupStats:I}}},jd={key:0,class:"cache-stats"},Wd={class:"stats-overview"},qd={class:"overview-grid"},Xd={class:"overview-card primary"},Jd={class:"overview-content"},$d={class:"overview-value"},Kd={class:"overview-card secondary"},Gd={class:"overview-content"},Yd={class:"overview-value"},Qd={class:"overview-card total"},Zd={class:"overview-content"},eu={class:"overview-value"},tu={class:"detailed-stats"},su={class:"stats-grid"},au={class:"stat-card"},ou={class:"stat-content"},nu={class:"stat-value"},ru={class:"stat-card"},iu={class:"stat-content"},lu={class:"stat-value"},cu={class:"stat-card"},du={class:"stat-content"},uu={class:"stat-value"},gu={class:"stat-card"},mu={class:"stat-content"},fu={class:"stat-value"},hu={key:0,class:"group-distribution"},vu={class:"distribution-grid"},yu={class:"group-icon"},pu={class:"group-info"},bu={class:"group-name"},_u={class:"group-count"},wu={class:"group-percentage"},Cu={key:1,class:"cache-stats-loading"};function ku(o,e,s,t,r,l){return(t.modules||[]).length>0?(c(),d("div",jd,[e[18]||(e[18]=a("h2",{class:"stats-title"},"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",-1)),a("div",Wd,[a("div",qd,[a("div",Xd,[e[2]||(e[2]=a("div",{class:"overview-icon"},"üèÜ",-1)),a("div",Jd,[a("div",$d,g(t.primaryModulesCount),1),e[0]||(e[0]=a("div",{class:"overview-label"},"–û—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[1]||(e[1]=a("div",{class:"overview-desc"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ",-1))])]),a("div",Kd,[e[5]||(e[5]=a("div",{class:"overview-icon"},"üîß",-1)),a("div",Gd,[a("div",Yd,g(t.secondaryModulesCount),1),e[3]||(e[3]=a("div",{class:"overview-label"},"–ü–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[4]||(e[4]=a("div",{class:"overview-desc"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),a("div",Qd,[e[8]||(e[8]=a("div",{class:"overview-icon"},"üì¶",-1)),a("div",Zd,[a("div",eu,g(t.totalModules),1),e[6]||(e[6]=a("div",{class:"overview-label"},"–í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π",-1)),e[7]||(e[7]=a("div",{class:"overview-desc"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö",-1))])])])]),a("div",tu,[a("div",su,[a("div",au,[e[10]||(e[10]=a("div",{class:"stat-icon"},"üìÑ",-1)),a("div",ou,[a("div",nu,g(t.totalFiles),1),e[9]||(e[9]=a("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤",-1))])]),a("div",ru,[e[12]||(e[12]=a("div",{class:"stat-icon"},"üíæ",-1)),a("div",iu,[a("div",lu,g(t.totalSizeFormatted),1),e[11]||(e[11]=a("div",{class:"stat-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä",-1))])]),a("div",cu,[e[14]||(e[14]=a("div",{class:"stat-icon"},"‚è±Ô∏è",-1)),a("div",du,[a("div",uu,g(t.avgTTL),1),e[13]||(e[13]=a("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–∏–π TTL",-1))])]),a("div",gu,[e[16]||(e[16]=a("div",{class:"stat-icon"},"‚ö°",-1)),a("div",mu,[a("div",fu,g(t.activeModules),1),e[15]||(e[15]=a("div",{class:"stat-label"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–µ—à–µ–π",-1))])])])]),t.secondaryModulesCount>0?(c(),d("div",hu,[e[17]||(e[17]=a("h3",{class:"distribution-title"},"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),a("div",vu,[(c(!0),d(Z,null,ee(t.groupStats,n=>(c(),d("div",{key:n.type,class:"distribution-item"},[a("div",yu,g(n.icon),1),a("div",pu,[a("div",bu,g(n.title),1),a("div",_u,g(n.count)+" –º–æ–¥—É–ª–µ–π",1)]),a("div",wu,g(n.percentage)+"%",1)]))),128))])])):w("",!0)])):(c(),d("div",Cu,[...e[19]||(e[19]=[a("p",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])]))}const Su=Y(Hd,[["render",ku],["__scopeId","data-v-9fa190bb"]]),xu={name:"CacheManagement",components:{CacheModuleCard:zd,CacheStats:Su},setup(){const o=M([]),e=M([]),s=M(!0),t=M(null),r=M(!1),l=v(()=>(o.value?.length||0)+(e.value?.length||0)),n=v(()=>{const h=i.value?.length||0,L=(u.value?.length||0)>0?1:0;return h+L}),i=v(()=>{const h=(o.value||[]).filter(L=>!L.id.includes("time-tracking"));return console.log("[CacheManagement] individualPrimaryModules:",h.length,h.map(L=>L.id)),h}),u=v(()=>{const h=(o.value||[]).filter(L=>L.id.includes("time-tracking")).sort((L,E)=>{const R=["time-tracking-default","time-tracking-detailed","time-tracking-summary"];return R.indexOf(L.id)-R.indexOf(E.id)});return console.log("[CacheManagement] timeTrackingModules:",h.length,h.map(L=>L.id)),h}),_=v(()=>{const h={};return(e.value||[]).forEach(E=>{const R=Q.getModuleType(E.id);h[R]||(h[R]={type:R,title:b(R),modules:[]}),h[R].modules.push(E)}),Object.values(h).sort((E,R)=>{const F=["users","activity","webhooks","other"],y=F.indexOf(E.type),f=F.indexOf(R.type);return(y===-1?999:y)-(f===-1?999:f)})}),S=async()=>{s.value=!0,t.value=null;try{const h=await Q.getCacheStatus();o.value=h.primaryModules||[],e.value=h.secondaryModules||[],console.log("[CacheManagement] Primary modules:",o.value.length,o.value.map(L=>({id:L.id,name:L.name}))),console.log("[CacheManagement] Secondary modules:",e.value.length,e.value.map(L=>({id:L.id,name:L.name})))}catch(h){console.error("[CacheManagement] Error loading modules:",h),t.value=h.message}finally{s.value=!1}},b=h=>{const L={users:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",activity:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",webhooks:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",other:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏"};return L[h]||L.other},I=async h=>{console.log(`[CacheManagement] Clearing module: ${h}`),Q.invalidateCacheAfterModuleOperation(),await S()},A=async()=>{console.log("[CacheManagement] Clearing all cache"),r.value=!0;try{await Q.clearCache("all"),Q.invalidateCacheAfterModuleOperation(),ve.success("–ö–µ—à –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω","–í—Å–µ —Ñ–∞–π–ª—ã –∫–µ—à–∞ –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã"),await S()}catch(h){console.error("[CacheManagement] Error clearing all cache:",h),ve.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à: ${h.message}`)}finally{r.value=!1}},k=async h=>{console.log(`[CacheManagement] Creating cache for: ${h.name} (${h.id})`),alert(`–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${h.name}
ID: ${h.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},U=async h=>{console.log(`[CacheManagement] Clearing cache for: ${h.name} (${h.id})`),alert(`–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${h.name}
ID: ${h.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},N=()=>{S()};return pe(()=>{S()}),{primaryModules:o,secondaryModules:e,loading:s,error:t,totalModules:l,groupedSecondaryModules:_,individualPrimaryModules:i,timeTrackingModules:u,logicalPrimaryCount:n,clearingAll:r,handleModuleClear:I,handleClearAllCache:A,handleCreateMock:k,handleClearMock:U,refreshModules:N}}},Mu={class:"cache-management"},Au={key:0,class:"header-section"},Eu={class:"stats-bar"},Lu={class:"stat-item"},Tu={class:"stat-item"},Du={class:"stat-item"},Iu={key:0,class:"global-actions"},Pu=["disabled"],Uu={key:0},Nu={key:1},Ou={class:"section-header"},Fu={class:"section-meta"},Ru={class:"module-count","aria-label":"{{ logicalPrimaryCount }} –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},Bu={key:0,class:"modules-container"},Vu={key:0,class:"modules-grid"},zu={key:1,class:"time-tracking-group"},Hu={class:"modules-grid"},ju={key:1,class:"empty-state"},Wu={key:2,class:"section-divider"},qu={key:3,class:"cache-section secondary-modules","aria-labelledby":"secondary-modules-heading"},Xu={class:"section-header"},Ju={class:"section-meta"},$u={class:"module-count","aria-label":"{{ (secondaryModules || []).length }} –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},Ku={class:"grouped-modules"},Gu={class:"group-header"},Yu={class:"group-title"},Qu={class:"group-badge secondary"},Zu={class:"modules-grid"},eg={key:4,class:"error-message",role:"alert","aria-live":"assertive"},tg={key:5,class:"loading-overlay",role:"status","aria-live":"polite","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"};function sg(o,e,s,t,r,l){const n=J("CacheModuleCard");return c(),d("div",Mu,[!t.loading&&!t.error?(c(),d("div",Au,[e[6]||(e[6]=a("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1)),e[7]||(e[7]=a("p",{class:"description"}," –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º —Å–∏—Å—Ç–µ–º—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è ",-1)),a("div",Eu,[a("span",Lu,[a("strong",null,g(t.totalModules),1),e[3]||(e[3]=se(" –≤—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π ",-1))]),a("span",Tu,[a("strong",null,g(t.logicalPrimaryCount),1),e[4]||(e[4]=se(" –æ—Å–Ω–æ–≤–Ω—ã—Ö ",-1))]),a("span",Du,[a("strong",null,g((t.secondaryModules||[]).length),1),e[5]||(e[5]=se(" –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ",-1))])]),!t.loading&&!t.error?(c(),d("div",Iu,[a("button",{onClick:e[0]||(e[0]=(...i)=>t.handleClearAllCache&&t.handleClearAllCache(...i)),disabled:t.clearingAll,class:z(["btn-clear-all",{"btn-disabled":t.clearingAll}])},[t.clearingAll?(c(),d("span",Uu,"üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫–µ—à–∞...")):(c(),d("span",Nu,"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à"))],10,Pu)])):w("",!0)])):w("",!0),!t.loading&&!t.error?(c(),d("section",{key:1,class:z(["cache-section primary-modules",{empty:(t.primaryModules||[]).length===0}]),"aria-labelledby":"primary-modules-heading"},[a("div",Ou,[e[9]||(e[9]=a("h2",{id:"primary-modules-heading"},"üèÜ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),a("div",Fu,[a("span",Ru,g(t.logicalPrimaryCount),1),e[8]||(e[8]=a("span",{class:"section-badge primary",role:"status","aria-label":"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",-1))])]),e[13]||(e[13]=a("p",{class:"section-description"}," 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã: –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°, –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏–µ–º–∞-–∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°. ",-1)),(t.primaryModules||[]).length>0?(c(),d("div",Bu,[t.individualPrimaryModules.length>0?(c(),d("div",Vu,[(c(!0),d(Z,null,ee(t.individualPrimaryModules,i=>(c(),d("div",{key:i.id,class:"module-wrapper"},[te(n,{module:i,"is-primary":!0,priority:i.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])):w("",!0),(t.timeTrackingModules||[]).length>0?(c(),d("div",zu,[e[10]||(e[10]=a("div",{class:"group-header"},[a("h3",{class:"group-title"},"‚è±Ô∏è –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"),a("span",{class:"group-badge"},"–û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞")],-1)),e[11]||(e[11]=a("p",{class:"group-description"},"–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),a("div",Hu,[(c(!0),d(Z,null,ee(t.timeTrackingModules,i=>(c(),d("div",{key:i.id,class:"module-wrapper"},[te(n,{module:i,"is-primary":!0,priority:i.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])])):w("",!0)])):(c(),d("div",ju,[e[12]||(e[12]=a("p",null,"‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)),a("button",{onClick:e[1]||(e[1]=(...i)=>t.refreshModules&&t.refreshModules(...i)),class:"refresh-btn"},"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫")]))],2)):w("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("div",Wu,[...e[14]||(e[14]=[Bt('<div class="divider-line" data-v-6a4e8216></div><div class="divider-content" data-v-6a4e8216><span class="divider-icon" data-v-6a4e8216>üîß</span><span class="divider-text" data-v-6a4e8216>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏</span><span class="divider-subtitle" data-v-6a4e8216>–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</span></div><div class="divider-line" data-v-6a4e8216></div>',3)])])):w("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("section",qu,[a("div",Xu,[e[16]||(e[16]=a("h2",{id:"secondary-modules-heading"},"üîß –ü–æ–±–æ—á–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),a("div",Ju,[a("span",$u,g((t.secondaryModules||[]).length),1),e[15]||(e[15]=a("span",{class:"section-badge secondary",role:"status","aria-label":"–°–ª—É–∂–µ–±–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),e[17]||(e[17]=a("p",{class:"section-description"}," –ú–æ–¥—É–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã. ",-1)),a("div",Ku,[(c(!0),d(Z,null,ee(t.groupedSecondaryModules,i=>(c(),d("div",{key:i.type,class:z(["module-group",`group-${i.type}`])},[a("div",Gu,[a("h3",Yu,g(i.title),1),a("span",Qu,g(i.modules.length),1)]),a("div",Zu,[(c(!0),d(Z,null,ee(i.modules,u=>(c(),d("div",{key:u.id,class:"module-wrapper"},[te(n,{module:u,"is-primary":!1,"group-type":i.type,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","group-type","onClear","onRefresh"])]))),128))])],2))),128))])])):w("",!0),t.error?(c(),d("div",eg,[e[18]||(e[18]=a("h3",null,"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞",-1)),a("p",null,g(t.error),1),a("button",{onClick:e[2]||(e[2]=(...i)=>o.loadModules&&o.loadModules(...i)),class:"retry-btn","aria-label":"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):w("",!0),t.loading?(c(),d("div",tg,[...e[19]||(e[19]=[a("div",{class:"loading-spinner","aria-hidden":"true"},null,-1),a("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞...",-1)])])):w("",!0)])}const ag=Y(xu,[["render",sg],["__scopeId","data-v-6a4e8216"]]),og={name:"CacheManagementPage",components:{CacheManagement:ag},beforeCreate(){console.log("[CacheManagementPage] beforeCreate() called")},created(){console.log("[CacheManagementPage] created() called")},beforeMount(){console.log("[CacheManagementPage] beforeMount() called")},setup(){console.log("[CacheManagementPage] setup() called with new hierarchical UI");const o=Ye(),e=M(!1),s=M(null),t=()=>{o.push({name:"index"})};return pe(()=>{console.log("[CacheManagementPage] onMounted() called - hierarchical cache management ready")}),{loading:e,error:s,goBack:t}}},ng={class:"cache-management-page"},rg={class:"page-header"},ig={class:"page-header-top"},lg={key:0,class:"loading"},cg={key:1,class:"error"},dg={key:2,class:"cache-content"};function ug(o,e,s,t,r,l){const n=J("CacheManagement");return c(),d("div",ng,[a("div",rg,[a("div",ig,[a("button",{onClick:e[0]||(e[0]=(...i)=>t.goBack&&t.goBack(...i)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[a("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),a("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=a("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1))]),t.loading?(c(),d("div",lg," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–µ—à–∞... ")):t.error?(c(),d("div",cg,g(t.error),1)):(c(),d("div",dg,[te(n)]))])}const gg=Y(og,[["render",ug],["__scopeId","data-v-a20ded38"]]),mg=[{path:"/install",name:"install",component:$s},{path:"/",name:"index",component:xa},{path:"/webhook-logs",name:"webhook-logs",redirect:"/admin/webhook-logs"},{path:"/admin/webhook-logs",name:"admin-webhook-logs",component:Ir,meta:{requiresAuth:!0,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",adminOnly:!0}},{path:"/admin/users",name:"admin-users",component:lc,meta:{requiresAuth:!0,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",adminOnly:!0}},{path:"/admin/cache",name:"admin-cache",component:gg,meta:{requiresAuth:!0,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",adminOnly:!0}},{path:"/dashboard/sector-1c",name:"dashboard-sector-1c",component:()=>re(()=>import("./DashboardSector1C.vue-Dme8qC4n.js"),__vite__mapDeps([14,4,15,16,17,5,2,1,18]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector1c"}},{path:"/dashboard/graph-admission-closure",name:"dashboard-graph-admission-closure",component:()=>re(()=>import("./GraphAdmissionClosureDashboard.vue-BTFqDLca.js"),__vite__mapDeps([19,4,20,17,5,2,1,16,21,15]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–æ–≤—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",requiresAuth:!0,chunk:"admission-dashboard"}},{path:"/dashboard/graph-state",name:"dashboard-graph-state",component:()=>re(()=>import("./GraphStateDashboard.vue-oo2YXe-k.js"),__vite__mapDeps([22,4,1,18,17,5,2,16,15,20]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏",requiresAuth:!0,chunk:"graph-state"}},{path:"/dashboard/tickets-time-tracking",name:"dashboard-tickets-time-tracking",component:()=>re(()=>import("./TicketsTimeTrackingDashboard.vue-TP2gbwh_.js"),__vite__mapDeps([23,4,1,5,2]),import.meta.url),meta:{title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",requiresAuth:!0,chunk:"tickets-tracking"}}],rt=ys({history:ps(),routes:mg});rt.beforeEach(async(o,e,s)=>{if(console.log("[Router] beforeEach:",{to:o.path,from:e.path,name:o.name}),o.meta.title&&(document.title=`${o.meta.title} - Bitrix24 Dashboard`),o.meta.requiresAuth){console.log("[Router] requiresAuth check for:",o.path);try{const t=await Re.checkAccess();if(!t.allowed){console.warn("Unauthorized access attempt to:",o.path,t.errorMessage),s({name:"index"});return}}catch(t){console.error("Error checking access in navigation guard:",t),s();return}}if(o.meta.adminOnly)try{const t=await Re.getCurrentUser();if(!t||!Wt(t)){console.warn("Admin access required for:",o.path),s({name:"index"});return}}catch(t){console.error("Error checking admin access in navigation guard:",t),s({name:"index"});return}if(e.name!==null&&o.path!==e.path)try{if((await Re.checkAccess()).allowed){const r=await Re.getCurrentUser();r&&at.logPageVisit(o,r,e).catch(l=>{console.error("[Router] Error logging page visit:",l)})}}catch(t){console.error("[Router] Error in activity logging:",t)}if(o.name==="index"&&!e.name&&setTimeout(()=>{re(()=>import("./DashboardSector1C.vue-Dme8qC4n.js"),__vite__mapDeps([14,4,15,16,17,5,2,1,18]),import.meta.url)},1e3),o.meta.chunk)switch(o.meta.chunk){case"dashboard-sector1c":setTimeout(()=>{re(()=>import("./dashboard-sector-1c-service-B72-t5O0.js"),__vite__mapDeps([21,17,5,2,1,16]),import.meta.url)},500);break;case"admission-dashboard":setTimeout(()=>{re(()=>import("./chunk-C85b5Dwb.js").then(t=>t.l),__vite__mapDeps([2,1]),import.meta.url)},500);break}console.log("[Router] Allowing navigation to:",o.path),s()});setTimeout(()=>{const o=window.location.pathname,e=window.location.hash;e&&e!=="#/"||(o.includes("install.php")?rt.replace("/install"):rt.replace("/"))},0);Qe.register(bs,_s,ws,Cs,ks,Ss,xs,Ms,As,Es);Qe.defaults.responsive=!0;Qe.defaults.maintainAspectRatio=!1;Qe.defaults.plugins.legend.display=!0;Qe.defaults.plugins.legend.position="top";const Cg={primary:"#007bff",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8",carryover:"#ff9800",successLight:"#6cbf47",carryoverLight:"#ffb74d",carryoverDark:"#f57c00"};class nt{static startBundleLoad(){this.metrics.bundleLoadTime=performance.now()}static endBundleLoad(e){const s=performance.now()-this.metrics.bundleLoadTime;this.metrics.chunkLoadTimes.set(e,s),console.log(`üì¶ Chunk "${e}" loaded in ${s.toFixed(2)}ms`),window.gtag&&window.gtag("event","bundle_load",{chunk_name:e,load_time:s}),s>1e3&&console.warn(`üêå Slow chunk load: ${e} took ${s.toFixed(2)}ms`)}static trackComponentLoad(e,s){const t=performance.now()-s;this.metrics.componentLoadTime.set(e,t),console.log(`üß© Component "${e}" loaded in ${t.toFixed(2)}ms`),t>500&&console.warn(`üêå Slow component load: ${e} took ${t.toFixed(2)}ms`)}static trackApiCall(e,s){this.metrics.apiResponseTime.set(e,s),s>1e3&&console.warn(`üêå Slow API call to ${e}: ${s}ms`)}static getReport(){const e=Array.from(this.metrics.componentLoadTime.values()),s=Array.from(this.metrics.apiResponseTime.values()),t=Array.from(this.metrics.chunkLoadTimes.values());return{totalChunks:this.metrics.chunkLoadTimes.size,totalComponents:this.metrics.componentLoadTime.size,totalApiCalls:this.metrics.apiResponseTime.size,averageComponentLoadTime:e.length>0?e.reduce((r,l)=>r+l,0)/e.length:0,averageApiResponseTime:s.length>0?s.reduce((r,l)=>r+l,0)/s.length:0,averageChunkLoadTime:t.length>0?t.reduce((r,l)=>r+l,0)/t.length:0,slowestComponents:Array.from(this.metrics.componentLoadTime.entries()).sort(([,r],[,l])=>l-r).slice(0,5).map(([r,l])=>({name:r,time:l})),slowestApiCalls:Array.from(this.metrics.apiResponseTime.entries()).sort(([,r],[,l])=>l-r).slice(0,5).map(([r,l])=>({endpoint:r,time:l})),slowestChunks:Array.from(this.metrics.chunkLoadTimes.entries()).sort(([,r],[,l])=>l-r).slice(0,5).map(([r,l])=>({name:r,time:l}))}}static clearMetrics(){this.metrics.bundleLoadTime=0,this.metrics.componentLoadTime.clear(),this.metrics.apiResponseTime.clear(),this.metrics.chunkLoadTimes.clear()}}De(nt,"metrics",{bundleLoadTime:0,componentLoadTime:new Map,apiResponseTime:new Map,chunkLoadTimes:new Map});class fg{static init(){this.initChunkLoadErrorHandling(),this.initUnhandledErrorHandling(),this.initNetworkErrorHandling()}static initChunkLoadErrorHandling(){if(window.addEventListener("error",e=>{e.target.tagName==="SCRIPT"&&(console.error("‚ùå Chunk loading error:",e.target.src),this.reportError("chunk_load_error",{url:e.target.src,message:e.message||"Script load failed"}))}),"PerformanceObserver"in window)try{new PerformanceObserver(s=>{for(const t of s.getEntries())if(t.entryType==="resource"&&t.name.includes(".js")){const r=t.responseEnd-t.requestStart;nt.trackApiCall(t.name,r)}}).observe({entryTypes:["resource"]})}catch{console.warn("PerformanceObserver not supported")}}static initUnhandledErrorHandling(){window.addEventListener("unhandledrejection",e=>{console.error("‚ùå Unhandled promise rejection:",e.reason),this.reportError("unhandled_rejection",{reason:e.reason?.message||String(e.reason),stack:e.reason?.stack})}),window.addEventListener("error",e=>{e.error&&e.filename&&(console.error("‚ùå Unhandled error:",e.error),this.reportError("unhandled_error",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error.stack}))})}static initNetworkErrorHandling(){const e=window.fetch;window.fetch=function(...s){const t=performance.now();return e.apply(this,s).then(r=>{const l=performance.now()-t;return nt.trackApiCall(s[0],l),r.ok||console.warn(`üö® API error: ${r.status} ${r.statusText} for ${s[0]}`),r}).catch(r=>{const l=performance.now()-t;throw console.error(`‚ùå Network error for ${s[0]}:`,r),nt.trackApiCall(s[0],l),this.reportError("network_error",{url:s[0],message:r.message,loadTime:l}),r})}}static reportError(e,s){const t={type:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...s};if(console.error("üìä Error report:",t),window.Sentry&&window.Sentry.captureException(new Error(`${e}: ${JSON.stringify(s)}`)),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:"/api/log-error.php",method:"POST",data:t})}catch(r){console.error("Failed to send error report to Bitrix24:",r)}window.gtag&&window.gtag("event","exception",{description:`${e}: ${s.message||"Unknown error"}`,fatal:!1})}static getErrorStats(){return{chunkLoadErrors:0,networkErrors:0,unhandledErrors:0,totalErrors:0}}}const xt=Ls(Ps);xt.use(rt);const hg=o=>{try{const e=new WeakSet;return JSON.stringify(o,(s,t)=>{if(typeof t=="object"&&t!==null){if(e.has(t))return"[Circular]";e.add(t)}return typeof t=="function"||t===void 0?null:t})}catch{return String(o)}};xt.config.errorHandler=(o,e,s)=>{if(o instanceof TypeError&&o.message.includes("Cannot read properties of undefined (reading 'type')")){console.warn("Caught undefined.type error:",{error:o.message,component:e?.$options?.name||"Unknown",info:s,stack:o.stack});return}if(console.error("Vue error:",o,s),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:Le("/api/log-error.php"),method:"POST",data:{error:o?.message||String(o),info:typeof s=="string"?s:hg(s),component:e?.$options?.name||"Unknown"}})}catch(t){console.error("Failed to log error:",t)}};xt.mount("#app");fg.init();export{Re as A,ot as C,Ht as L,zt as S,Y as _,ze as a,Ue as b,Cg as c,Te as d,Aa as e,Xe as f,Ct as g,wg as h,Wt as i,qe as n,Xt as u};
