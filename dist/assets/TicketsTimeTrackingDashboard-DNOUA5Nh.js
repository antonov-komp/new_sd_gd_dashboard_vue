import{_ as ae,c as N,a as o,o as n,b as e,t as c,F as L,e as I,n as q,y as S,i as ne,K as W,g as M,G as ie,f as te,d as U,j as z,k as H,B as oe,T as ke,N as ve,I as pe,m as ye,z as be,r as ge}from"./main-BdU1HCXe.js";const de="/api/tickets-time-tracking-sector-1c.php";function fe(s){var w,k,r,g,f;if(!s)return{meta:null,data:{totalElapsedTime:0,totalElapsedTimeUnit:"hours",totalRecordsCount:0,weeks:[],employeesSummary:[]}};const b=s.data||s.result||s,a=b.meta||s.meta||null;return{meta:{weekNumber:(a==null?void 0:a.weekNumber)??null,weekStartUtc:(a==null?void 0:a.weekStartUtc)??null,weekEndUtc:(a==null?void 0:a.weekEndUtc)??null,totalWeeks:(a==null?void 0:a.totalWeeks)??0,sector1CEmployeesCount:(a==null?void 0:a.sector1CEmployeesCount)??0},data:{totalElapsedTime:((w=b.data)==null?void 0:w.totalElapsedTime)??b.totalElapsedTime??0,totalElapsedTimeUnit:((k=b.data)==null?void 0:k.totalElapsedTimeUnit)??b.totalElapsedTimeUnit??"hours",totalRecordsCount:((r=b.data)==null?void 0:r.totalRecordsCount)??b.totalRecordsCount??0,weeks:((g=b.data)==null?void 0:g.weeks)??b.weeks??[],employeesSummary:((f=b.data)==null?void 0:f.employeesSummary)??b.employeesSummary??[]}}}async function _e(s={}){const{product:b="1C",weekStartUtc:a=null,weekEndUtc:w=null,weeksCount:k=4}=s;try{const r=await fetch(de,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:b,weekStartUtc:a,weekEndUtc:w,weeksCount:k})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const g=await r.json();if(g.error)throw new Error(g.error_description||g.error||"Unknown error");return fe(g)}catch(r){throw console.error("[TimeTrackingService] Error fetching time tracking data:",r),r}}async function we({taskIds:s,employeeId:b,weekNumber:a,page:w=1,perPage:k=10}){if(!s||!Array.isArray(s)||s.length===0)return{tasks:[],pagination:{totalTasks:0,currentPage:1,perPage:k,totalPages:0}};try{const r=await fetch(de,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:"1C",includeTaskDetails:!0,taskIds:s,employeeId:b||void 0,weekNumber:a||void 0,page:w,perPage:k})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const g=await r.json();if(!g.success)throw new Error(g.error||g.error_description||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–¥–∞—á–∞—Ö");return{tasks:g.data.tasks||[],pagination:g.data.pagination||{totalTasks:0,currentPage:1,perPage:k,totalPages:0}}}catch(r){throw console.error("[timeTrackingService] Error loading tasks details:",r),r}}const ce={getTimeTrackingData:_e,getTasksDetails:we};function E(s,b=1){return typeof s!="number"||isNaN(s)?"0 —á":`${s.toFixed(b)} —á`}function ee(s,b){if(!s||!b)return`–ù–µ–¥–µ–ª—è ${s||"?"}`;try{const a=new Date(b),w=new Date(a);w.setDate(w.getDate()+6);const k=a.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}),r=w.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"});return`–ù–µ–¥–µ–ª—è ${s} (${k} - ${r})`}catch(a){return console.error("[TimeTrackingUtils] Error formatting week label:",a),`–ù–µ–¥–µ–ª—è ${s}`}}function Te(s){return!s||!s.data?!1:s.data.totalRecordsCount>0||s.data.weeks&&s.data.weeks.length>0}const De={class:"ttt-summary"},he={class:"summary-cards"},$e={class:"summary-card summary-card--total"},Ce={class:"summary-card__content"},Ne={class:"summary-card__value"},Ee={class:"summary-card summary-card--employees"},Pe={class:"summary-card__content"},Se={class:"summary-card__value"},Ue={class:"summary-card summary-card--average"},Me={class:"summary-card__content"},We={class:"summary-card__value"},xe={__name:"TicketsTimeTrackingSummary",props:{data:{type:Object,required:!0}},setup(s){const b=s,a=N(()=>{var f,v;return((v=(f=b.data)==null?void 0:f.data)==null?void 0:v.totalElapsedTime)||0}),w=N(()=>{var f,v;return((v=(f=b.data)==null?void 0:f.meta)==null?void 0:v.sector1CEmployeesCount)||0}),k=N(()=>{const f=a.value,v=w.value;return v>0?f/v:0}),r=N(()=>a.value===0?"0.0 —á":E(a.value,1)),g=N(()=>k.value===0?"0.00 —á":E(k.value,2));return(f,v)=>(n(),o("div",De,[e("div",he,[e("div",$e,[v[1]||(v[1]=e("div",{class:"summary-card__icon"},"‚è±",-1)),e("div",Ce,[v[0]||(v[0]=e("div",{class:"summary-card__label"},"–û–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç",-1)),e("div",Ne,c(r.value),1)])]),e("div",Ee,[v[3]||(v[3]=e("div",{class:"summary-card__icon"},"üë•",-1)),e("div",Pe,[v[2]||(v[2]=e("div",{class:"summary-card__label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ —Å–µ–∫—Ç–æ—Ä–µ",-1)),e("div",Se,c(w.value),1)])]),e("div",Ue,[v[5]||(v[5]=e("div",{class:"summary-card__icon"},"üìä",-1)),e("div",Me,[v[4]||(v[4]=e("div",{class:"summary-card__label"},"–°—Ä–µ–¥–Ω—è—è –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞",-1)),e("div",We,c(g.value),1)])])])]))}},Le=ae(xe,[["__scopeId","data-v-51b124c7"]]),Ie={class:"ttt-table-container"},Oe={key:0,class:"ttt-table-loading"},Re={key:1,class:"ttt-table-error"},je={key:2,class:"ttt-table-empty"},Ae={key:3,class:"ttt-table-wrapper"},Be={class:"ttt-table"},Ve=["onClick"],Fe={class:"ttt-table__header-week-date"},qe=["onClick"],ze={class:"ttt-table__cell-employee"},He=["onClick"],Ke={class:"ttt-table__cell-total"},Ge={class:"ttt-table__row-total"},Je=["onClick"],Qe={class:"ttt-table__cell-total"},Xe={__name:"TicketsTimeTrackingTable",props:{data:{type:Object,required:!0},loading:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["cell-click","employee-click","week-click"],setup(s,{emit:b}){const a=s,w=b,k=N(()=>{var _,d;return((d=(_=a.data)==null?void 0:_.data)==null?void 0:d.weeks)||[]}),r=N(()=>{if(!a.data||!a.data.data||!a.data.data.weeks)return null;const _=a.data.data.weeks||[],m=(a.data.data.employeesSummary||[]).map(u=>{const P={};let O=0;return _.forEach(R=>{var X;const J=(X=R.employees)==null?void 0:X.find(Y=>Y.id===u.id),Q=(J==null?void 0:J.elapsedTime)||0;P[R.weekNumber]=Q,O+=Q}),{id:u.id,name:u.name,weeks:P,total:O}}),y={};let D=0;return _.forEach(u=>{y[u.weekNumber]=u.totalElapsedTime||0,D+=u.totalElapsedTime||0}),{employees:m,weekTotals:y,grandTotal:D}}),g=(_,d)=>{var y;const m=(y=r.value)==null?void 0:y.employees.find(D=>D.id===_);return(m==null?void 0:m.weeks[d])||0},f=_=>{var d;return((d=r.value)==null?void 0:d.weekTotals[_])||0},v=_=>{if(!_)return"";try{return new Date(_).toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}catch{return""}},K=(_,d)=>{var D,u,P,O;const m=(D=r.value)==null?void 0:D.employees.find(R=>R.id===_),y=(O=(P=(u=a.data)==null?void 0:u.data)==null?void 0:P.weeks)==null?void 0:O.find(R=>R.weekNumber===d);m&&y&&w("cell-click",{employee:m,week:y,elapsedTime:g(_,d)})},G=_=>{var m;const d=(m=r.value)==null?void 0:m.employees.find(y=>y.id===_);d&&w("employee-click",{employee:d,weeks:k.value.map(y=>({week:y,elapsedTime:g(_,y.weekNumber)}))})},F=_=>{var m;const d=k.value.find(y=>y.weekNumber===_);d&&w("week-click",{week:d,employees:(m=r.value)==null?void 0:m.employees.map(y=>({employee:y,elapsedTime:g(y.id,_)})).filter(y=>y.elapsedTime>0)})};return(_,d)=>(n(),o("div",Ie,[s.loading?(n(),o("div",Oe," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):s.error?(n(),o("div",Re,c(s.error),1)):!r.value||r.value.employees.length===0?(n(),o("div",je," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ")):(n(),o("div",Ae,[e("table",Be,[e("thead",null,[e("tr",null,[d[1]||(d[1]=e("th",{class:"ttt-table__header-employee"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",-1)),(n(!0),o(L,null,I(k.value,m=>(n(),o("th",{key:m.weekNumber,class:q(["ttt-table__header-week",{"ttt-table__header--clickable":!0}]),onClick:y=>F(m.weekNumber)},[S(" –ù–µ–¥–µ–ª—è "+c(m.weekNumber),1),d[0]||(d[0]=e("br",null,null,-1)),e("span",Fe,c(v(m.weekStartUtc)),1)],8,Ve))),128)),d[2]||(d[2]=e("th",{class:"ttt-table__header-total"},"–ò—Ç–æ–≥–æ",-1))])]),e("tbody",null,[(n(!0),o(L,null,I(r.value.employees,m=>(n(),o("tr",{key:m.id,class:q(["ttt-table__row",{"ttt-table__row--clickable":!0}]),onClick:y=>G(m.id)},[e("td",ze,c(m.name),1),(n(!0),o(L,null,I(k.value,y=>(n(),o("td",{key:`${m.id}-${y.weekNumber}`,class:q(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:ne(D=>K(m.id,y.weekNumber),["stop"])},c(W(E)(g(m.id,y.weekNumber))),9,He))),128)),e("td",Ke,[e("strong",null,c(W(E)(m.total)),1)])],8,qe))),128)),e("tr",Ge,[d[3]||(d[3]=e("td",{class:"ttt-table__cell-employee"},[e("strong",null,"–í–°–ï–ì–û")],-1)),(n(!0),o(L,null,I(k.value,m=>(n(),o("td",{key:`total-${m.weekNumber}`,class:q(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:y=>F(m.weekNumber)},[e("strong",null,c(W(E)(f(m.weekNumber))),1)],8,Je))),128)),e("td",Qe,[e("strong",null,c(W(E)(r.value.grandTotal)),1)])])])])]))]))}},Ye=ae(Xe,[["__scopeId","data-v-8021e5e4"]]),Ze={class:"modal-header"},et={class:"modal-body"},tt={key:"level-1",class:"detail-cell"},at={class:"detail-info"},st={key:0,class:"tasks-list"},lt={class:"task-header"},nt={class:"task-label"},ot={class:"task-time"},rt={key:0,class:"ticket-info"},it={class:"ticket-label"},dt=["title"],ct={key:1,class:"ticket-title"},ut={key:1,class:"ticket-info ticket-info--no-ticket"},mt={class:"detail-total"},kt={key:0,class:"detail-actions"},vt={key:"level-2",class:"tasks-list-level"},pt={class:"tasks-list-header"},yt={class:"tasks-list-title"},bt={class:"tasks-list-content"},gt={key:"loading",class:"loading-state"},ft={key:"error",class:"error-state"},_t={class:"error-message"},wt={key:"empty",class:"empty-state"},Tt={key:"tasks",class:"tasks-cards-container"},Dt=["onClick"],ht={class:"task-card__header"},$t={class:"task-card__number"},Ct={key:0,class:"task-card__time"},Nt={class:"task-card__title"},Et={class:"task-card__dates"},Pt={class:"task-card__date-item"},St={class:"date-value"},Ut={class:"task-card__date-item"},Mt={class:"task-card__date-item"},Wt={class:"date-value"},xt={key:0,class:"tasks-pagination"},Lt=["disabled"],It={class:"pagination-pages"},Ot=["onClick"],Rt=["disabled"],jt={key:"employee",class:"detail-employee"},At={class:"detail-info"},Bt={class:"weeks-list"},Vt={class:"week-header"},Ft={class:"week-label"},qt={class:"week-time"},zt={key:"week",class:"detail-week"},Ht={class:"detail-info"},Kt={class:"employees-list"},Gt={class:"employee-header"},Jt={class:"employee-label"},Qt={class:"employee-time"},Xt={__name:"TimeTrackingDetailModal",props:{cellData:{type:Object,default:null}},emits:["close"],setup(s,{emit:b}){const a=s,w=b,k=M(1),r=M([]),g=M(!1),f=M(null),v=M(1),K=M(10),G=N(()=>{var $,h,j,A,B,V;if(!a.cellData)return"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç";if(k.value===2)return`–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: ${(($=a.cellData.employee)==null?void 0:$.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}, –ù–µ–¥–µ–ª—è ${((h=a.cellData.week)==null?void 0:h.weekNumber)||"?"}`;if(a.cellData.type==="employee")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${((j=a.cellData.employee)==null?void 0:j.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}`;if(a.cellData.type==="week")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: –ù–µ–¥–µ–ª—è ${((A=a.cellData.week)==null?void 0:A.weekNumber)||"?"}`;const l=((B=a.cellData.employee)==null?void 0:B.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",t=((V=a.cellData.week)==null?void 0:V.weekNumber)||"?",p=E(a.cellData.elapsedTime||0);return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${l}, –ù–µ–¥–µ–ª—è ${t} (${p})`}),F=N(()=>{var t,p;if(!((p=(t=a.cellData)==null?void 0:t.week)!=null&&p.employees))return 0;const l=a.cellData.week.employees.find($=>{var h;return $.id===((h=a.cellData.employee)==null?void 0:h.id)});return(l==null?void 0:l.tasksCount)||0}),_=N(()=>{var t,p;if(!((p=(t=a.cellData)==null?void 0:t.week)!=null&&p.employees))return 0;const l=a.cellData.week.employees.find($=>{var h;return $.id===((h=a.cellData.employee)==null?void 0:h.id)});return(l==null?void 0:l.ticketsCount)||0}),d=M({totalTasks:0,currentPage:1,perPage:10,totalPages:0}),m=N(()=>d.value.totalPages),y=N(()=>r.value),D=N(()=>{const l=[];let p=Math.max(1,d.value.currentPage-Math.floor(2.5)),$=Math.min(m.value,p+5-1);$-p<4&&(p=Math.max(1,$-5+1));for(let h=p;h<=$;h++)l.push(h);return l}),u=l=>{if(!l||l.length===0)return"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω";if(l.length===1)return ee(l[0].week.weekNumber,l[0].week.weekStartUtc);const t=l[0].week,p=l[l.length-1].week;return`${ee(t.weekNumber,t.weekStartUtc)} - ${ee(p.weekNumber,p.weekStartUtc)}`},P=l=>l?ee(l.weekNumber,l.weekStartUtc):"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω",O=l=>{if(!l)return"-";try{const t=new Date(l);return isNaN(t.getTime())?"-":t.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return console.warn("[TimeTrackingDetailModal] Error formatting date:",l,t),"-"}},R=(l,t)=>{if(t)try{const p=new Date(t);if(!isNaN(p.getTime()))return!1}catch{}if(!l)return!1;try{const p=new Date(l);return isNaN(p.getTime())?!1:new Date>p}catch(p){return console.warn("[TimeTrackingDetailModal] Error checking overdue:",l,p),!1}},J=l=>{const t=l.closedDate?new Date(l.closedDate):null,p=R(l.deadline,l.closedDate);return{"task-card--completed":!!t,"task-card--overdue":p,"task-card--in-progress":!t&&!p}},Q=async()=>{k.value=2,await se()},X=()=>{k.value=1,r.value=[],f.value=null,v.value=1,d.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0}},Y=l=>!l||typeof l!="object"?!1:!l.id||typeof l.id!="number"?(console.warn("[TimeTrackingDetailModal] Invalid task (no ID):",l),!1):!0,se=async()=>{var l,t,p,$,h,j,A,B,V;if(!((t=(l=a.cellData)==null?void 0:l.week)!=null&&t.employees)||!a.cellData.employee){f.value="–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á";return}g.value=!0,f.value=null;try{const x=a.cellData.week.employees.find(C=>{var re;return C.id===((re=a.cellData.employee)==null?void 0:re.id)});if(!x){r.value=[];return}let i=[];if(Array.isArray(x.tasks)&&x.tasks.length>0&&(i=x.tasks.map(C=>typeof C=="object"&&C!==null&&C.id?C.id:typeof C=="number"?C:null).filter(C=>C!==null&&C>0)),i.length===0){r.value=[];return}const T=await ce.getTasksDetails({taskIds:i,employeeId:a.cellData.employee.id,weekNumber:a.cellData.week.weekNumber,page:v.value,perPage:K.value});if(!T||!Array.isArray(T.tasks)){console.error("[TimeTrackingDetailModal] Invalid response format:",T),f.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞",r.value=[];return}r.value=T.tasks.filter(Y),d.value=T.pagination||{totalTasks:0,currentPage:1,perPage:K.value,totalPages:0},v.value=d.value.currentPage}catch(x){console.error("[TimeTrackingDetailModal] Error loading tasks details:",{error:x,taskIds:((A=(j=(h=($=(p=a.cellData)==null?void 0:p.week)==null?void 0:$.employees)==null?void 0:h.find(T=>{var C;return T.id===((C=a.cellData.employee)==null?void 0:C.id)}))==null?void 0:j.tasks)==null?void 0:A.map(T=>T.id))||[],employeeId:(B=a.cellData.employee)==null?void 0:B.id,weekNumber:(V=a.cellData.week)==null?void 0:V.weekNumber,timestamp:new Date().toISOString()});const i=x.message||"";i.includes("network")||i.includes("fetch")||i.includes("Failed to fetch")?f.value="–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.":i.includes("timeout")?f.value="–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":i.includes("403")||i.includes("401")?f.value="–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.":i.includes("404")?f.value="–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.":i.includes("500")?f.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":f.value=i||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á",r.value=[]}finally{g.value=!1}},ue=()=>{v.value=1,se()};ie(v,()=>{k.value===2&&se()});const le=l=>{if(l>=1&&l<=m.value&&l!==v.value){v.value=l;const t=document.querySelector(".tasks-cards-container");t&&(t.scrollTop=0)}},me=l=>{console.log("[TimeTrackingDetailModal] Task clicked:",l.id)},Z=()=>{w("close")};return ie(()=>a.cellData,l=>{l||(k.value=1,r.value=[],f.value=null,v.value=1,d.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0})}),(l,t)=>(n(),te(pe,{to:"body"},[s.cellData?(n(),o("div",{key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:ne(Z,["self"]),onKeydown:ve(Z,["esc"])},[e("div",{class:"modal-content",onClick:t[2]||(t[2]=ne(()=>{},["stop"]))},[e("div",Ze,[e("h2",null,c(G.value),1),e("button",{class:"close-button",onClick:Z,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),e("div",et,[z(oe,{name:"level",mode:"out-in"},{default:H(()=>{var p,$,h,j,A,B,V,x;return[k.value===1&&(s.cellData.type==="cell"||!s.cellData.type&&s.cellData.employee&&s.cellData.week)?(n(),o("div",tt,[e("div",at,[e("p",null,[t[3]||(t[3]=e("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),S(" "+c(((p=s.cellData.employee)==null?void 0:p.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),S(" "+c((($=s.cellData.week)==null?void 0:$.weekNumber)||"?"),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),S(" "+c(W(E)(s.cellData.elapsedTime||0)),1)])]),(h=s.cellData.week)!=null&&h.employees?(n(),o("div",st,[t[8]||(t[8]=e("h3",null,"–ó–∞–¥–∞—á–∏ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã:",-1)),(n(!0),o(L,null,I(s.cellData.week.employees.filter(i=>{var T;return i.id===((T=s.cellData.employee)==null?void 0:T.id)}),i=>(n(),o("div",{key:i.id,class:"employee-tasks"},[(n(!0),o(L,null,I(i.tasks,(T,C)=>(n(),o("div",{class:"task-item",key:C},[e("div",lt,[e("span",nt,"–ó–∞–¥–∞—á–∞ #"+c(T.id||C+1),1),e("span",ot,c(W(E)(T.elapsedTime||0)),1)]),T.ticket?(n(),o("div",rt,[e("span",it,"–¢–∏–∫–µ—Ç #"+c(T.ticket.id),1),T.ticket.createdWeek&&T.ticket.createdWeek!==s.cellData.week.weekNumber?(n(),o("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${T.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${s.cellData.week.weekNumber}`}," (—Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ "+c(T.ticket.createdWeek)+") ",9,dt)):U("",!0),T.ticket.title?(n(),o("div",ct,c(T.ticket.title),1)):U("",!0)])):(n(),o("div",ut,[...t[6]||(t[6]=[e("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])]))]))),128))]))),128)),e("div",mt,[e("p",null,[t[7]||(t[7]=e("strong",null,"–ò—Ç–æ–≥–æ:",-1)),S(" "+c(W(E)(s.cellData.elapsedTime||0))+" ("+c(F.value)+" –∑–∞–¥–∞—á, "+c(_.value)+" —Ç–∏–∫–µ—Ç–æ–≤) ",1)])]),F.value>0?(n(),o("div",kt,[e("button",{class:"btn btn-primary btn-tasks-list",onClick:Q}," üìã –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á ")])):U("",!0)])):U("",!0)])):k.value===2?(n(),o("div",vt,[e("div",pt,[e("button",{class:"btn-back",onClick:X,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê –ù–∞–∑–∞–¥ "),e("h3",yt," –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: "+c(((j=s.cellData.employee)==null?void 0:j.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫")+", –ù–µ–¥–µ–ª—è "+c(((A=s.cellData.week)==null?void 0:A.weekNumber)||"?"),1)]),e("div",bt,[z(oe,{name:"loading",mode:"out-in"},{default:H(()=>[g.value?(n(),o("div",gt,[...t[9]||(t[9]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...",-1)])])):f.value?(n(),o("div",ft,[t[10]||(t[10]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),t[11]||(t[11]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",_t,c(f.value),1),e("button",{class:"btn btn-retry",onClick:ue},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):r.value.length===0?(n(),o("div",wt,[...t[12]||(t[12]=[e("div",{class:"empty-state-icon"},"üìã",-1),e("p",{class:"empty-state-message"},"–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)])])):(n(),o("div",Tt,[z(ke,{name:"task-card",tag:"div",class:"tasks-cards-list"},{default:H(()=>[(n(!0),o(L,null,I(y.value.filter(Y),i=>(n(),o("div",{key:i.id,class:q(["task-card",J(i)]),onClick:T=>me(i)},[e("div",ht,[e("span",$t,"–ó–∞–¥–∞—á–∞ #"+c(i.id),1),i.elapsedTime?(n(),o("span",Ct,c(W(E)(i.elapsedTime)),1)):U("",!0)]),e("div",Nt,c(i.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),e("div",Et,[e("div",Pt,[t[13]||(t[13]=e("span",{class:"date-icon"},"üìÖ",-1)),t[14]||(t[14]=e("span",{class:"date-label"},"–ù–∞—á–∞–ª–æ:",-1)),e("span",St,c(O(i.startDate)),1)]),e("div",Ut,[t[15]||(t[15]=e("span",{class:"date-icon"},"‚è∞",-1)),t[16]||(t[16]=e("span",{class:"date-label"},"–î–µ–¥–ª–∞–π–Ω:",-1)),e("span",{class:q(["date-value",{"date-value--overdue":R(i.deadline,i.closedDate)}])},c(O(i.deadline)||"-"),3)]),e("div",Mt,[t[17]||(t[17]=e("span",{class:"date-icon"},"‚úì",-1)),t[18]||(t[18]=e("span",{class:"date-label"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ:",-1)),e("span",Wt,c(O(i.closedDate)||"-"),1)])]),t[19]||(t[19]=e("div",{class:"task-card__status-placeholder"},null,-1))],10,Dt))),128))]),_:1}),m.value>1?(n(),o("div",xt,[e("button",{class:"pagination-btn",disabled:d.value.currentPage===1,onClick:t[0]||(t[0]=i=>le(d.value.currentPage-1))}," ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,Lt),e("div",It,[(n(!0),o(L,null,I(D.value,i=>(n(),o("button",{key:i,class:q(["pagination-page",{"pagination-page--active":i===d.value.currentPage}]),onClick:T=>le(i)},c(i),11,Ot))),128))]),e("button",{class:"pagination-btn",disabled:d.value.currentPage===m.value,onClick:t[1]||(t[1]=i=>le(d.value.currentPage+1))}," –°–ª–µ–¥—É—é—â–∞—è ‚Üí ",8,Rt)])):U("",!0)]))]),_:1})])])):k.value===1&&s.cellData.type==="employee"?(n(),o("div",jt,[e("div",At,[e("p",null,[t[20]||(t[20]=e("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),S(" "+c(((B=s.cellData.employee)==null?void 0:B.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),e("p",null,[t[21]||(t[21]=e("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),S(" "+c(u(s.cellData.weeks)),1)])]),e("div",Bt,[t[22]||(t[22]=e("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –Ω–µ–¥–µ–ª—è–º:",-1)),(n(!0),o(L,null,I(s.cellData.weeks,i=>(n(),o("div",{key:i.week.weekNumber,class:"week-item"},[e("div",Vt,[e("span",Ft,"–ù–µ–¥–µ–ª—è "+c(i.week.weekNumber),1),e("span",qt,c(W(E)(i.elapsedTime||0)),1)])]))),128))])])):k.value===1&&s.cellData.type==="week"?(n(),o("div",zt,[e("div",Ht,[e("p",null,[t[23]||(t[23]=e("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),S(" "+c(((V=s.cellData.week)==null?void 0:V.weekNumber)||"?"),1)]),e("p",null,[t[24]||(t[24]=e("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),S(" "+c(P(s.cellData.week)),1)]),e("p",null,[t[25]||(t[25]=e("strong",null,"–û–±—â–∏–µ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),S(" "+c(W(E)(((x=s.cellData.week)==null?void 0:x.totalElapsedTime)||0)),1)])]),e("div",Kt,[t[26]||(t[26]=e("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:",-1)),(n(!0),o(L,null,I(s.cellData.employees,i=>(n(),o("div",{key:i.employee.id,class:"employee-item"},[e("div",Gt,[e("span",Jt,c(i.employee.name),1),e("span",Qt,c(W(E)(i.elapsedTime||0)),1)])]))),128))])])):U("",!0)]}),_:1})]),e("div",{class:"modal-footer"},[e("button",{class:"close-btn",onClick:Z},"–ó–∞–∫—Ä—ã—Ç—å")])])],32)):U("",!0)]))}},Yt=ae(Xt,[["__scopeId","data-v-ec959b4a"]]),Zt={class:"tickets-time-tracking-dashboard"},ea={class:"dashboard-header"},ta={class:"breadcrumbs-row"},aa=["aria-label","aria-disabled","data-fallback","disabled"],sa={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},la={key:"preloader",class:"time-tracking-preloader"},na={key:"error",class:"error-state"},oa={key:"empty",class:"empty-state"},ra={key:"content",class:"dashboard-content"},ia={__name:"TicketsTimeTrackingDashboard",setup(s){const b=be(),a=M(!0),w=M(null),k=M(null),r=M(null),g=M(!1),f=N(()=>Te(k.value)),v=async()=>{a.value=!0,w.value=null;const D=new Promise(u=>setTimeout(u,300));try{const[u,P]=await Promise.all([D,ce.getTimeTrackingData({product:"1C",weeksCount:4})]);k.value=P}catch(u){console.error("[TicketsTimeTrackingDashboard] Error loading data:",u),w.value=u.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}finally{a.value=!1}},K=D=>{r.value=D},G=D=>{r.value={type:"employee",...D}},F=D=>{r.value={type:"week",...D}},_=()=>{r.value=null},d=N(()=>typeof window>"u"?!1:window.history.length>1),m=N(()=>d.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"),y=()=>{g.value||(g.value=!0,d.value?b.go(-1):b.push({name:"dashboard-sector-1c"}),setTimeout(()=>{g.value=!1},300))};return ye(()=>{v()}),(D,u)=>{const P=ge("router-link");return n(),o("div",Zt,[e("div",ea,[e("div",ta,[e("button",{class:"btn-back-link",type:"button",onClick:y,"aria-label":m.value,"aria-disabled":!d.value,"data-fallback":!d.value,disabled:g.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,aa),e("nav",sa,[z(P,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:H(()=>[...u[0]||(u[0]=[S(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),u[3]||(u[3]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),z(P,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:H(()=>[...u[1]||(u[1]=[S(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),u[4]||(u[4]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),z(P,{to:{name:"dashboard-graph-admission-closure"},class:"breadcrumb-link"},{default:H(()=>[...u[2]||(u[2]=[S(" –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π ",-1)])]),_:1}),u[5]||(u[5]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),u[6]||(u[6]=e("span",{class:"breadcrumb-current"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã",-1))])])]),u[9]||(u[9]=e("h1",{class:"dashboard-title"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),U("",!0),z(oe,{name:"fade",mode:"out-in"},{default:H(()=>[a.value?(n(),o("div",la,[...u[7]||(u[7]=[e("div",{class:"preloader-content"},[e("div",{class:"preloader-spinner"},[e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"})]),e("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"),e("p",{class:"preloader-message"},"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö..."),e("div",{class:"preloader-dots"},[e("span",{class:"dot"}),e("span",{class:"dot"}),e("span",{class:"dot"})])],-1)])])):w.value?(n(),o("div",na,[e("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: "+c(w.value),1),e("button",{onClick:v,class:"retry-button"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):f.value?(n(),o("div",ra,[k.value?(n(),te(Le,{key:0,data:k.value},null,8,["data"])):U("",!0),k.value?(n(),te(Ye,{key:1,data:k.value,loading:a.value,error:w.value,onCellClick:K,onEmployeeClick:G,onWeekClick:F},null,8,["data","loading","error"])):U("",!0)])):(n(),o("div",oa,[...u[8]||(u[8]=[e("p",null,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])]))]),_:1}),r.value?(n(),te(Yt,{key:1,"cell-data":r.value,onClose:_},null,8,["cell-data"])):U("",!0)])}}},ca=ae(ia,[["__scopeId","data-v-f9084975"]]);export{ca as default};
