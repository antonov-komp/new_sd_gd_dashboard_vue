const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ticketListUtils-DaVyNT-C.js","assets/priority-config-JtDDO0H0.js","assets/main-DfGCSA03.js","assets/main-hkNOQW78.css","assets/priority-config-Bxxce_5E.css","assets/ticket-mapper-EZDOpk0a.js"])))=>i.map(i=>d[i]);
var Fe=Object.defineProperty;var Ge=(p,s,t)=>s in p?Fe(p,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[s]=t;var ye=(p,s,t)=>Ge(p,typeof s!="symbol"?s+"":s,t);import{_ as te,m as me,G as Re,a as d,o as n,b as e,y as X,n as K,g as I,H as se,f as ee,j as R,k as x,d as F,B as J,I as Ye,c as P,J as N,t as f,F as z,e as q,K as ue,L as xe,x as ze,l as ae,z as Ne,r as Pe,S as Le,T as ke,M as ce}from"./main-DfGCSA03.js";import{F as Ve}from"./FiltersPanel-BxnlwTLm.js";import{L as ne,D as je,B as qe}from"./index-CGx8Ev9d.js";import{B as le,g as Ue,a as He,b as Oe,D as Ze,T as ve,c as pe}from"./priority-config-JtDDO0H0.js";const Ke={class:"period-mode-selector"},Je={class:"selector-options"},Xe=["checked"],Qe=["checked"],he="graph-admission-closure-period-mode",et={__name:"PeriodModeSelector",props:{modelValue:{type:String,required:!0,validator:p=>["weeks","months"].includes(p)?!0:(console.warn(`[PeriodModeSelector] Invalid modelValue: ${p}. Using default 'weeks'.`),!1)}},emits:["update:modelValue","change"],setup(p,{emit:s}){const t=p,l=s;function c(_){if(!["weeks","months"].includes(_)){console.warn(`[PeriodModeSelector] Invalid value: ${_}. Ignoring change.`);return}try{localStorage.setItem(he,_),l("update:modelValue",_),l("change",_)}catch(m){console.warn("[PeriodModeSelector] Failed to save to localStorage:",m),l("update:modelValue",_),l("change",_)}}function k(_){_.key===he&&_.newValue&&(_.newValue==="weeks"||_.newValue==="months")&&_.newValue!==t.modelValue&&l("update:modelValue",_.newValue)}return me(()=>{try{const _=localStorage.getItem(he);(_==="weeks"||_==="months")&&_!==t.modelValue&&l("update:modelValue",_)}catch(_){console.warn("[PeriodModeSelector] Failed to read from localStorage:",_)}window.addEventListener("storage",k)}),Re(()=>{window.removeEventListener("storage",k)}),(_,m)=>(n(),d("div",Ke,[m[4]||(m[4]=e("h3",{class:"selector-title"},[e("span",{class:"selector-icon"},"üìÖ"),X(" –†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ")],-1)),e("div",Je,[e("label",{class:K(["option-label",{"option-selected":p.modelValue==="weeks"}])},[e("input",{type:"radio",value:"weeks",checked:p.modelValue==="weeks",onChange:m[0]||(m[0]=i=>c("weeks")),class:"option-input","aria-label":"4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏"},null,40,Xe),m[2]||(m[2]=e("span",{class:"option-text"},[e("span",{class:"option-icon"},"üìÖ"),X(" 4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ ")],-1))],2),e("label",{class:K(["option-label",{"option-selected":p.modelValue==="months"}])},[e("input",{type:"radio",value:"months",checked:p.modelValue==="months",onChange:m[1]||(m[1]=i=>c("months")),class:"option-input","aria-label":"3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞"},null,40,Qe),m[3]||(m[3]=e("span",{class:"option-text"},[e("span",{class:"option-icon"},"üìä"),X(" 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞ ")],-1))],2)])]))}},tt=te(et,[["__scopeId","data-v-3786bef5"]]),st={key:0,class:"modal-overlay"},at={class:"modal-container",role:"dialog","aria-labelledby":"modal-title","aria-modal":"true"},rt={class:"modal-body"},ot={class:"mode-description"},Be="graph-admission-closure-period-mode-info-shown",lt={__name:"PeriodModeInfoModal",props:{isVisible:{type:Boolean,required:!0},currentMode:{type:String,default:"weeks",validator:p=>["weeks","months"].includes(p)}},emits:["close","start-loading","select-mode"],setup(p,{emit:s}){const t=p,l=s,c=I(t.currentMode);function k(i){if(!["weeks","months"].includes(i)){console.warn("[PeriodModeInfoModal] Invalid mode:",i);return}c.value=i;try{localStorage.setItem(Be,"true")}catch(v){console.warn("[PeriodModeInfoModal] Failed to save to localStorage:",v)}l("select-mode",i),l("close"),setTimeout(()=>{l("start-loading")},100)}function _(){try{localStorage.setItem(Be,"true")}catch(i){console.warn("[PeriodModeInfoModal] Failed to save to localStorage:",i)}l("select-mode",c.value),l("close"),setTimeout(()=>{l("start-loading")},100)}function m(i){i.key==="Escape"&&t.isVisible&&_()}return se(()=>t.currentMode,i=>{["weeks","months"].includes(i)&&(c.value=i)}),me(()=>{t.isVisible&&document.addEventListener("keydown",m)}),Re(()=>{document.removeEventListener("keydown",m)}),se(()=>t.isVisible,i=>{i?(document.addEventListener("keydown",m),c.value=t.currentMode):document.removeEventListener("keydown",m)}),(i,v)=>(n(),ee(Ye,{to:"body"},[R(J,{name:"modal-fade"},{default:x(()=>[p.isVisible?(n(),d("div",st,[e("div",at,[e("div",{class:"modal-header"},[v[2]||(v[2]=e("h2",{id:"modal-title",class:"modal-title"},[e("span",{class:"modal-icon"},"‚ÑπÔ∏è"),X(" –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ")],-1)),e("button",{class:"modal-close-btn",onClick:_,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å",type:"button"}," √ó ")]),e("div",rt,[v[5]||(v[5]=e("p",{class:"modal-description"}," –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π: ",-1)),e("div",ot,[e("button",{class:K(["mode-item mode-item--clickable",{"mode-item--selected":c.value==="weeks"}]),onClick:v[0]||(v[0]=y=>k("weeks")),type:"button"},[...v[3]||(v[3]=[e("div",{class:"mode-header"},[e("span",{class:"mode-icon"},"üìÖ"),e("h3",{class:"mode-title"},"4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏")],-1),e("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 –Ω–µ–¥–µ–ª–∏ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –Ω–µ–¥–µ–ª—è–º. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç–∏–∫–µ—Ç–æ–≤. ",-1)])],2),e("button",{class:K(["mode-item mode-item--clickable",{"mode-item--selected":c.value==="months"}]),onClick:v[1]||(v[1]=y=>k("months")),type:"button"},[...v[4]||(v[4]=[e("div",{class:"mode-header"},[e("span",{class:"mode-icon"},"üìä"),e("h3",{class:"mode-title"},"3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞")],-1),e("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—Ü–µ–≤. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤. ",-1)])],2)])])])])):F("",!0)]),_:1})]))}},nt=te(lt,[["__scopeId","data-v-79329a91"]]),it={class:"ac-chart"},dt={class:"ac-chart__header"},ct={class:"ac-chart__subtitle"},ut={class:"ac-chart__controls"},kt={class:"chart-type-selector"},vt=["onClick"],mt={class:"chart-type-icon"},yt={class:"chart-type-label"},ht={class:"ac-chart__summary"},_t={class:"summary-card__value"},pt={class:"summary-card__value-main"},gt={class:"summary-card__breakdown"},bt={class:"breakdown-item breakdown-item--this-week"},ft={class:"breakdown-item__value"},wt={class:"breakdown-item breakdown-item--other-week"},Tt={class:"breakdown-item__value"},Ct={class:"summary-card__value-main"},$t={class:"summary-card__breakdown"},Wt={class:"breakdown-item breakdown-item--this-week"},St={class:"breakdown-item__value"},Dt={class:"breakdown-item breakdown-item--other-week"},Et={class:"breakdown-item__value"},It={class:"summary-card summary-card--stages"},At={class:"summary-card__tags"},Mt={key:0,class:"stage-tag stage-tag--empty"},Ut={class:"ac-chart__body"},Ot={key:0,class:"split-charts-container"},Bt={class:"chart-wrapper chart-wrapper--left"},Rt={class:"chart-canvas-wrapper"},Nt={class:"chart-wrapper chart-wrapper--right"},Pt={class:"chart-canvas-wrapper"},Lt={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(p,{emit:s}){const t=p,l=s,c=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],k=I("line");P(()=>{var h;return((h=t.meta)==null?void 0:h.weekNumber)??"‚Äî"});const _=()=>{var r,M;const h=((r=t.meta)==null?void 0:r.weeks)||[];return h.length>0?h.map(w=>`–ù–µ–¥–µ–ª—è ${w.weekNumber}`):[(M=t.meta)!=null&&M.weekNumber?`–ù–µ–¥–µ–ª—è ${t.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"]},m=P(()=>{var g,W,A,V;const h=_(),r=Array.isArray((g=t.data.series)==null?void 0:g.new)&&t.data.series.new.length>0?t.data.series.new:[t.data.newTickets??0],M=Array.isArray((W=t.data.series)==null?void 0:W.closed)&&t.data.series.closed.length>0?t.data.series.closed:[t.data.closedTickets??0],w=Array.isArray((A=t.data.series)==null?void 0:A.closedCreatedThisWeek)&&t.data.series.closedCreatedThisWeek.length>0?t.data.series.closedCreatedThisWeek:[t.data.closedTicketsCreatedThisWeek??0],u=Array.isArray((V=t.data.series)==null?void 0:V.closedCreatedOtherWeek)&&t.data.series.closedCreatedOtherWeek.length>0?t.data.series.closedCreatedOtherWeek:[t.data.closedTicketsCreatedOtherWeek??0];return{labels:h,datasets:[{label:"–ù–æ–≤—ã–µ",data:r,backgroundColor:N.primary,borderColor:N.primary,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:M,backgroundColor:N.success,borderColor:N.success,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:w,backgroundColor:N.successLight,borderColor:N.successLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:u,backgroundColor:N.warning,borderColor:N.warning,tension:.3,fill:!1,borderDash:[5,5]}]}}),i=P(()=>{var u,g,W;const h=_(),r=Array.isArray((u=t.data.series)==null?void 0:u.carryover)&&t.data.series.carryover.length>0?t.data.series.carryover:[t.data.carryoverTickets??0],M=Array.isArray((g=t.data.series)==null?void 0:g.carryoverCreatedThisWeek)&&t.data.series.carryoverCreatedThisWeek.length>0?t.data.series.carryoverCreatedThisWeek:[t.data.carryoverTicketsCreatedThisWeek??0],w=Array.isArray((W=t.data.series)==null?void 0:W.carryoverCreatedOtherWeek)&&t.data.series.carryoverCreatedOtherWeek.length>0?t.data.series.carryoverCreatedOtherWeek:[t.data.carryoverTicketsCreatedOtherWeek??0];return{labels:h,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:r,backgroundColor:N.carryover,borderColor:N.carryover,tension:.3,fill:!1},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:M,backgroundColor:N.carryoverLight,borderColor:N.carryoverLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:w,backgroundColor:N.carryoverDark,borderColor:N.carryoverDark,tension:.3,fill:!1,borderDash:[5,5]}]}}),v=P(()=>{var j,Y,H,D,a,o,$,E,U;const h=((j=t.meta)==null?void 0:j.weeks)||[],r=h.length>0?h.map(B=>`–ù–µ–¥–µ–ª—è ${B.weekNumber}`):[(Y=t.meta)!=null&&Y.weekNumber?`–ù–µ–¥–µ–ª—è ${t.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"],M=Array.isArray((H=t.data.series)==null?void 0:H.new)&&t.data.series.new.length>0?t.data.series.new:[t.data.newTickets??0],w=Array.isArray((D=t.data.series)==null?void 0:D.closed)&&t.data.series.closed.length>0?t.data.series.closed:[t.data.closedTickets??0],u=Array.isArray((a=t.data.series)==null?void 0:a.closedCreatedThisWeek)&&t.data.series.closedCreatedThisWeek.length>0?t.data.series.closedCreatedThisWeek:[t.data.closedTicketsCreatedThisWeek??0],g=Array.isArray((o=t.data.series)==null?void 0:o.closedCreatedOtherWeek)&&t.data.series.closedCreatedOtherWeek.length>0?t.data.series.closedCreatedOtherWeek:[t.data.closedTicketsCreatedOtherWeek??0],W=Array.isArray(($=t.data.series)==null?void 0:$.carryover)&&t.data.series.carryover.length>0?t.data.series.carryover:[t.data.carryoverTickets??0],A=Array.isArray((E=t.data.series)==null?void 0:E.carryoverCreatedThisWeek)&&t.data.series.carryoverCreatedThisWeek.length>0?t.data.series.carryoverCreatedThisWeek:[t.data.carryoverTicketsCreatedThisWeek??0],V=Array.isArray((U=t.data.series)==null?void 0:U.carryoverCreatedOtherWeek)&&t.data.series.carryoverCreatedOtherWeek.length>0?t.data.series.carryoverCreatedOtherWeek:[t.data.carryoverTicketsCreatedOtherWeek??0];return{labels:r,datasets:[{label:"–ù–æ–≤—ã–µ",data:M,backgroundColor:N.primary,borderColor:N.primary,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:w,backgroundColor:N.success,borderColor:N.success,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:u,backgroundColor:N.successLight,borderColor:N.successLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:g,backgroundColor:N.warning,borderColor:N.warning,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:W,backgroundColor:N.carryover,borderColor:N.carryover,tension:.3,fill:!1},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:A,backgroundColor:N.carryoverLight,borderColor:N.carryoverLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:V,backgroundColor:N.carryoverDark,borderColor:N.carryoverDark,tension:.3,fill:!1,borderDash:[5,5]}]}}),y=P(()=>({labels:["–ù–æ–≤—ã–µ","–ó–∞–∫—Ä—ã—Ç—ã–µ","–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ"],datasets:[{data:[t.data.newTickets??0,t.data.closedTickets??0,t.data.carryoverTickets??0],backgroundColor:[N.primary,N.success,N.carryover],borderWidth:1}]})),C=P(()=>{switch(k.value){case"line":return ne;case"bar":return qe;case"doughnut":return je;default:return ne}}),b=P(()=>k.value==="doughnut"?y.value:v.value),S=h=>{if(!h)return"‚Äî";try{return new Date(h).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return h}},G=P(()=>({responsive:!0,maintainAspectRatio:!1,resizeDelay:0,plugins:{tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12,callbacks:{title:h=>{var W,A,V,j,Y,H;const r=(W=h[0])==null?void 0:W.dataIndex,M=((A=t.meta)==null?void 0:A.weeks)||[];if(M.length>0&&r!==void 0&&M[r]){const D=M[r];return`–ù–µ–¥–µ–ª—è ${D.weekNumber} (${S(D.weekStartUtc)} ‚Äî ${S(D.weekEndUtc)})`}const w=(V=t.meta)==null?void 0:V.weekNumber,u=(j=t.meta)==null?void 0:j.weekStartUtc,g=(Y=t.meta)==null?void 0:Y.weekEndUtc;return w&&u&&g?`–ù–µ–¥–µ–ª—è ${w} (${S(u)} ‚Äî ${S(g)})`:((H=h[0])==null?void 0:H.label)||""}}},legend:{position:"top",labels:{font:{size:15,weight:"500"},padding:16,boxWidth:20,boxHeight:12}}},scales:k.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},title:{display:!1},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:45,minRotation:45,font:{size:14},padding:10},title:{display:!1},grid:{lineWidth:1.5}}}})),O=P(()=>{var h,r,M,w;if((h=t.data)!=null&&h.series){const u=t.data.series,g=Math.max((Array.isArray(u.new)?u.new.length:0)-1,(Array.isArray(u.closed)?u.closed.length:0)-1,(Array.isArray(u.carryover)?u.carryover.length:0)-1,-1);if(g>=0){const W={newTickets:Array.isArray(u.new)&&u.new[g]!==void 0?u.new[g]:0,closedTickets:Array.isArray(u.closed)&&u.closed[g]!==void 0?u.closed[g]:0,closedTicketsCreatedThisWeek:Array.isArray(u.closedCreatedThisWeek)&&u.closedCreatedThisWeek[g]!==void 0?u.closedCreatedThisWeek[g]:0,closedTicketsCreatedOtherWeek:Array.isArray(u.closedCreatedOtherWeek)&&u.closedCreatedOtherWeek[g]!==void 0?u.closedCreatedOtherWeek[g]:0,carryoverTickets:Array.isArray(u.carryover)&&u.carryover[g]!==void 0?u.carryover[g]:0,carryoverTicketsCreatedThisWeek:Array.isArray(u.carryoverCreatedThisWeek)&&u.carryoverCreatedThisWeek[g]!==void 0?u.carryoverCreatedThisWeek[g]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(u.carryoverCreatedOtherWeek)&&u.carryoverCreatedOtherWeek[g]!==void 0?u.carryoverCreatedOtherWeek[g]:0};if(W.newTickets>0||W.closedTickets>0||W.carryoverTickets>0)return W}}if((r=t.data)!=null&&r.currentWeek&&typeof t.data.currentWeek=="object"){const u=t.data.currentWeek;if((u.newTickets??0)>0||(u.closedTickets??0)>0||(u.carryoverTickets??0)>0)return u}if((M=t.data)!=null&&M.weeksData&&Array.isArray(t.data.weeksData)&&t.data.weeksData.length>0){const u=t.data.weeksData[t.data.weeksData.length-1];if((u.newTickets??0)>0||(u.closedTickets??0)>0||(u.carryoverTickets??0)>0)return u}if((w=t.data)!=null&&w.series){const u=t.data.series,g=Math.max((Array.isArray(u.new)?u.new.length:0)-1,(Array.isArray(u.closed)?u.closed.length:0)-1,(Array.isArray(u.carryover)?u.carryover.length:0)-1,-1);if(g>=0)return{newTickets:Array.isArray(u.new)&&u.new[g]!==void 0?u.new[g]:0,closedTickets:Array.isArray(u.closed)&&u.closed[g]!==void 0?u.closed[g]:0,closedTicketsCreatedThisWeek:Array.isArray(u.closedCreatedThisWeek)&&u.closedCreatedThisWeek[g]!==void 0?u.closedCreatedThisWeek[g]:0,closedTicketsCreatedOtherWeek:Array.isArray(u.closedCreatedOtherWeek)&&u.closedCreatedOtherWeek[g]!==void 0?u.closedCreatedOtherWeek[g]:0,carryoverTickets:Array.isArray(u.carryover)&&u.carryover[g]!==void 0?u.carryover[g]:0,carryoverTicketsCreatedThisWeek:Array.isArray(u.carryoverCreatedThisWeek)&&u.carryoverCreatedThisWeek[g]!==void 0?u.carryoverCreatedThisWeek[g]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(u.carryoverCreatedOtherWeek)&&u.carryoverCreatedOtherWeek[g]!==void 0?u.carryoverCreatedOtherWeek[g]:0}}return t.data||{}}),L=h=>{var g;const r=O.value,M=(r==null?void 0:r.newTickets)??0,w=(r==null?void 0:r.closedTickets)??0,u=(r==null?void 0:r.carryoverTickets)??0;h==="new"&&M>0?l("open-stages"):h==="closed"&&w>0?(((g=t.data)==null?void 0:g.responsible)||[]).length>0&&l("open-responsible"):h==="carryover"&&u>0&&l("open-carryover")};return(h,r)=>{var M,w,u,g,W,A,V,j,Y,H,D,a,o,$,E,U;return n(),d("div",it,[e("header",dt,[e("div",null,[r[3]||(r[3]=e("h2",{class:"ac-chart__title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),e("p",ct," –ù–µ–¥–µ–ª—è "+f(((w=(M=p.meta)==null?void 0:M.currentWeek)==null?void 0:w.weekNumber)??((u=p.meta)==null?void 0:u.weekNumber)??"‚Äî")+" ¬∑ "+f((((W=(g=p.meta)==null?void 0:g.currentWeek)==null?void 0:W.weekStartUtc)??((A=p.meta)==null?void 0:A.weekStartUtc))||"‚Äî")+" ‚Äî "+f((((j=(V=p.meta)==null?void 0:V.currentWeek)==null?void 0:j.weekEndUtc)??((Y=p.meta)==null?void 0:Y.weekEndUtc))||"‚Äî")+" (UTC) ",1)]),e("div",ut,[e("div",kt,[(n(),d(z,null,q(c,B=>e("button",{key:B.value,class:K(["chart-type-btn",{active:k.value===B.value}]),onClick:T=>k.value=B.value},[e("span",mt,f(B.icon),1),e("span",yt,f(B.label),1)],10,vt)),64))])])]),e("section",ht,[e("div",{class:"summary-card summary-card--new",onClick:r[0]||(r[0]=B=>L("new"))},[r[4]||(r[4]=e("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),e("div",_t,f(((H=O.value)==null?void 0:H.newTickets)??0),1)]),e("div",{class:"summary-card summary-card--closed-breakdown",onClick:r[1]||(r[1]=B=>L("closed"))},[r[9]||(r[9]=e("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),e("div",pt,f(((D=O.value)==null?void 0:D.closedTickets)??0),1),e("div",gt,[e("div",bt,[r[5]||(r[5]=e("span",{class:"breakdown-item__icon"},"‚úì",-1)),e("span",ft,f(((a=O.value)==null?void 0:a.closedTicketsCreatedThisWeek)??0),1),r[6]||(r[6]=e("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),e("div",wt,[r[7]||(r[7]=e("span",{class:"breakdown-item__icon"},"‚Üª",-1)),e("span",Tt,f(((o=O.value)==null?void 0:o.closedTicketsCreatedOtherWeek)??0),1),r[8]||(r[8]=e("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),e("div",{class:"summary-card summary-card--carryover-breakdown",onClick:r[2]||(r[2]=B=>L("carryover"))},[r[14]||(r[14]=e("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),e("div",Ct,f((($=O.value)==null?void 0:$.carryoverTickets)??0),1),e("div",$t,[e("div",Wt,[r[10]||(r[10]=e("span",{class:"breakdown-item__icon"},"‚úì",-1)),e("span",St,f(((E=O.value)==null?void 0:E.carryoverTicketsCreatedThisWeek)??0),1),r[11]||(r[11]=e("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),e("div",Dt,[r[12]||(r[12]=e("span",{class:"breakdown-item__icon"},"‚Üª",-1)),e("span",Et,f(((U=O.value)==null?void 0:U.carryoverTicketsCreatedOtherWeek)??0),1),r[13]||(r[13]=e("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–∏—Ö",-1))])])]),e("div",It,[r[15]||(r[15]=e("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),e("div",At,[(n(!0),d(z,null,q(p.data.stages||[],B=>(n(),d("span",{key:B.stageId,class:"stage-tag"},f(B.stageName||B.stageId)+" ‚Äî "+f(B.count),1))),128)),!p.data.stages||p.data.stages.length===0?(n(),d("span",Mt," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):F("",!0)])])]),e("div",Ut,[k.value==="line"?(n(),d("div",Ot,[e("div",Bt,[r[16]||(r[16]=e("h3",{class:"chart-subtitle"},"–ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",Rt,[R(ue(ne),{data:m.value,options:G.value},null,8,["data","options"])])]),e("div",Nt,[r[17]||(r[17]=e("h3",{class:"chart-subtitle"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",Pt,[R(ue(ne),{data:i.value,options:G.value},null,8,["data","options"])])])])):(n(),ee(xe(C.value),{key:1,data:b.value,options:G.value},null,8,["data","options"]))])])}}},Vt=te(Lt,[["__scopeId","data-v-73ab5a50"]]),Ft={class:"summary-cards-months"},Gt={class:"summary-card summary-card--new"},Yt={class:"card-content"},xt={class:"card-main-value"},zt={class:"card-month-breakdown"},jt={class:"month-name"},qt={class:"month-value"},Ht={key:0,class:"month-item month-item--empty"},Zt={class:"summary-card summary-card--closed"},Kt={class:"card-content"},Jt={class:"card-main-value"},Xt={class:"card-month-breakdown-hierarchical"},Qt={class:"month-header"},es={class:"month-name"},ts={class:"month-value"},ss={class:"month-breakdown"},as={class:"breakdown-item breakdown-this-week"},rs={class:"breakdown-value"},os={class:"breakdown-item breakdown-other-week"},ls={class:"breakdown-value"},ns={key:0,class:"month-item-hierarchical month-item--empty"},is={class:"summary-card summary-card--carryover"},ds={class:"card-content"},cs={class:"card-main-value"},us={class:"card-month-breakdown"},ks={class:"month-name"},vs={class:"month-value"},ms={key:0,class:"month-item month-item--empty"},ys={class:"summary-card summary-card--stages"},hs={class:"card-content"},_s={class:"stages-list"},ps={class:"stage-icon"},gs={class:"stage-name"},bs={class:"stage-value"},fs={key:0,class:"stage-item stage-item--empty"},ws={__name:"SummaryCardsMonths",props:{data:{type:Object,required:!0,default:()=>({newTickets:0,newTicketsByMonth:[],closedTickets:0,closedTicketsByMonth:[],carryoverTickets:0,carryoverTicketsByMonth:[],stages:[]})}},setup(p){const s=p;function t(y){return y==null||isNaN(y)?"0":y>=1e6?(y/1e6).toFixed(1)+"M":y>=1e3?y.toLocaleString("ru-RU"):y.toString()}const l=P(()=>{var y;return((y=s.data)==null?void 0:y.newTickets)||0}),c=P(()=>t(l.value)),k=P(()=>{var y;return((y=s.data)==null?void 0:y.newTicketsByMonth)||[]}),_=P(()=>{var y;return((y=s.data)==null?void 0:y.closedTicketsByMonth)||[]}),m=P(()=>{var y;return((y=s.data)==null?void 0:y.carryoverTicketsByMonth)||[]});function i(y){return{"DT140_12:SUCCESS":"stage-success","DT140_12:FAIL":"stage-fail","DT140_12:UC_0GBU8Z":"stage-other"}[y]||""}function v(y){return{"DT140_12:SUCCESS":"‚úì","DT140_12:FAIL":"‚úó","DT140_12:UC_0GBU8Z":"‚ö†"}[y]||"‚Ä¢"}return(y,C)=>(n(),d("div",Ft,[e("div",Gt,[C[0]||(C[0]=e("h3",{class:"card-title"},"–ù–æ–≤—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥",-1)),e("div",Yt,[e("div",xt,f(c.value),1),e("div",zt,[(n(!0),d(z,null,q(k.value,b=>(n(),d("div",{key:`new-${b.month}`,class:"month-item"},[e("span",jt,f(b.monthName)+":",1),e("span",qt,f(t(b.count)),1)]))),128)),k.value.length===0?(n(),d("div",Ht," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):F("",!0)])])]),e("div",Zt,[C[5]||(C[5]=e("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –≤—Å–µ–≥–æ",-1)),e("div",Kt,[e("div",Jt,f(t(p.data.closedTickets||0)),1),e("div",Xt,[(n(!0),d(z,null,q(_.value,b=>(n(),d("div",{key:`closed-${b.month}`,class:"month-item-hierarchical"},[e("div",Qt,[e("span",es,f(b.monthName)+":",1),e("span",ts,f(t(b.count||0)),1)]),e("div",ss,[e("div",as,[C[1]||(C[1]=e("span",{class:"breakdown-icon"},"‚úì",-1)),C[2]||(C[2]=e("span",{class:"breakdown-label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π:",-1)),e("span",rs,f(t(b.closedCreatedThisWeek||0)),1)]),e("div",os,[C[3]||(C[3]=e("span",{class:"breakdown-icon"},"‚Üª",-1)),C[4]||(C[4]=e("span",{class:"breakdown-label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π:",-1)),e("span",ls,f(t(b.closedCreatedOtherWeek||0)),1)])])]))),128)),_.value.length===0?(n(),d("div",ns," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):F("",!0)])])]),e("div",is,[C[6]||(C[6]=e("h3",{class:"card-title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ –≤—Å–µ–≥–æ",-1)),e("div",ds,[e("div",cs,f(t(p.data.carryoverTickets||0)),1),e("div",us,[(n(!0),d(z,null,q(m.value,b=>(n(),d("div",{key:`carryover-${b.month}`,class:"month-item"},[e("span",ks,f(b.monthName)+":",1),e("span",vs,f(t(b.count||0)),1)]))),128)),m.value.length===0?(n(),d("div",ms," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):F("",!0)])])]),e("div",ys,[C[8]||(C[8]=e("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),e("div",hs,[e("div",_s,[(n(!0),d(z,null,q(p.data.stages||[],b=>(n(),d("div",{key:b.stageId,class:K(["stage-item",i(b.stageId)])},[e("span",ps,f(v(b.stageId)),1),e("span",gs,f(b.stageName||b.stageId)+":",1),e("span",bs,f(t(b.count||0)),1)],2))),128)),!p.data.stages||p.data.stages.length===0?(n(),d("div",fs,[...C[7]||(C[7]=[e("span",{class:"stage-name"},"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö",-1)])])):F("",!0)])])])]))}},Ts=te(ws,[["__scopeId","data-v-7325e15b"]]),Cs={class:"line-chart-months"},$s={class:"chart-section"},Ws={class:"chart-container"},Ss={class:"chart-section"},Ds={class:"chart-container"},Es={class:"chart-table-section"},Is={class:"chart-table-wrapper"},As={class:"data-table"},Ms={class:"data-row data-row--new"},Us={class:"data-row data-row--closed"},Os={class:"data-row data-row--carryover"},Bs={__name:"LineChartMonths",props:{data:{type:Object,required:!0,default:()=>({newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]})},meta:{type:Object,default:()=>({months:[]})}},setup(p){const s=p;function t(i){return i==null||isNaN(i)?"0":i>=1e3?i.toLocaleString("ru-RU"):i.toString()}const l=P(()=>{var v,y,C;const i=new Set;return(v=s.data.newTicketsByMonth)==null||v.forEach(b=>{b.weeks&&Array.isArray(b.weeks)&&b.weeks.forEach(S=>{S&&S.weekNumber&&i.add(S.weekNumber)})}),(y=s.data.closedTicketsByMonth)==null||y.forEach(b=>{b.weeks&&Array.isArray(b.weeks)&&b.weeks.forEach(S=>{S&&S.weekNumber&&i.add(S.weekNumber)})}),(C=s.data.carryoverTicketsByMonth)==null||C.forEach(b=>{b.weeks&&Array.isArray(b.weeks)&&b.weeks.forEach(S=>{S&&S.weekNumber&&i.add(S.weekNumber)})}),Array.from(i).sort((b,S)=>b-S)}),c=P(()=>{const i=s.data.newTicketsByMonth||[],v=i.map(b=>b.monthName||`–ú–µ—Å—è—Ü ${b.month}`),y=i.map(b=>b.count||0),C=(s.data.closedTicketsByMonth||[]).map(b=>b.count||0);return{labels:v,datasets:[{label:"–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã",data:y,borderColor:N.primary,backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",data:C,borderColor:N.success,backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4,fill:!1}]}}),k=P(()=>{const i=s.data.carryoverTicketsByMonth||[],v=i.map(C=>C.monthName||`–ú–µ—Å—è—Ü ${C.month}`),y=i.map(C=>C.count||0);return{labels:v,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",data:y,borderColor:N.carryover,backgroundColor:"rgba(255, 152, 0, 0.1)",tension:.4,fill:!1}]}}),_={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{font:{size:14,weight:"500"},padding:16,boxWidth:20,boxHeight:12}},tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12}},scales:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:0,minRotation:0,font:{size:14},padding:10},grid:{lineWidth:1.5}}}};function m(i,v){let y=[];switch(i){case"new":y=s.data.newTicketsByMonth||[];break;case"closed":y=s.data.closedTicketsByMonth||[];break;case"carryover":y=s.data.carryoverTicketsByMonth||[];break;default:return"-"}for(const C of y){if(!C.weeks||!Array.isArray(C.weeks))continue;const b=C.weeks.find(S=>S&&S.weekNumber===v);if(b){const S=b.count||0;return S>0?t(S):"-"}}return"-"}return(i,v)=>(n(),d("div",Cs,[e("div",$s,[v[0]||(v[0]=e("h3",{class:"chart-title"},"–ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",Ws,[R(ue(ne),{data:c.value,options:_},null,8,["data"])])]),e("div",Ss,[v[1]||(v[1]=e("h3",{class:"chart-title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",Ds,[R(ue(ne),{data:k.value,options:_},null,8,["data"])])]),e("div",Es,[v[6]||(v[6]=e("h3",{class:"chart-title"},"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º",-1)),e("div",Is,[e("table",As,[e("thead",null,[e("tr",null,[v[2]||(v[2]=e("th",{class:"month-header-cell"},"–ú–µ—Å—è—Ü",-1)),(n(!0),d(z,null,q(l.value,y=>(n(),d("th",{key:`week-${y}`,class:"week-header-cell"}," –ù–µ–¥–µ–ª—è "+f(y),1))),128))])]),e("tbody",null,[e("tr",Ms,[v[3]||(v[3]=e("td",{class:"data-type-cell"},"–ù–æ–≤—ã–µ",-1)),(n(!0),d(z,null,q(l.value,y=>(n(),d("td",{key:`new-${y}`,class:"week-data-cell"},f(m("new",y)),1))),128))]),e("tr",Us,[v[4]||(v[4]=e("td",{class:"data-type-cell"},"–ó–∞–∫—Ä—ã—Ç—ã–µ",-1)),(n(!0),d(z,null,q(l.value,y=>(n(),d("td",{key:`closed-${y}`,class:"week-data-cell"},f(m("closed",y)),1))),128))]),e("tr",Os,[v[5]||(v[5]=e("td",{class:"data-type-cell"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),(n(!0),d(z,null,q(l.value,y=>(n(),d("td",{key:`carryover-${y}`,class:"week-data-cell"},f(m("carryover",y)),1))),128))])])])])])]))}},Rs=te(Bs,[["__scopeId","data-v-f048a2de"]]),Ns={class:"months-preloader"},Ps={class:"preloader-content"},Ls={class:"progress-container"},Vs={class:"progress-bar"},Fs={class:"progress-text"},Gs={class:"preloader-message"},Ys={class:"stages-list"},xs={class:"stage-icon"},zs={class:"stage-text"},js={__name:"MonthsModePreloader",props:{progress:{type:Number,required:!0,validator:p=>p>=0&&p<=100},currentStage:{type:String,default:""}},setup(p){const s=p,t=[{label:"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",threshold:10},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –æ–∫—Ç—è–±—Ä—å...",threshold:40},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –Ω–æ—è–±—Ä—å...",threshold:70},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –¥–µ–∫–∞–±—Ä—å...",threshold:90},{label:"–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...",threshold:95},{label:"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",threshold:100}];function l(k){return s.progress>=t[k].threshold}function c(k){const _=t[k].threshold,m=k>0?t[k-1].threshold:0;return s.progress>=m&&s.progress<_}return(k,_)=>(n(),d("div",Ns,[e("div",Ps,[_[0]||(_[0]=ze('<div class="preloader-spinner" data-v-23ab71eb><div class="spinner-ring" data-v-23ab71eb></div><div class="spinner-ring" data-v-23ab71eb></div><div class="spinner-ring" data-v-23ab71eb></div></div><h3 class="preloader-title" data-v-23ab71eb>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 3 –º–µ—Å—è—Ü–∞</h3>',2)),e("div",Ls,[e("div",Vs,[e("div",{class:"progress-fill",style:ae({width:`${p.progress}%`})},null,4)]),e("div",Fs,f(Math.round(p.progress))+"%",1)]),e("p",Gs,f(p.currentStage),1),e("div",Ys,[(n(),d(z,null,q(t,(m,i)=>e("div",{key:i,class:K(["stage-item",{"stage-completed":l(i),"stage-current":c(i)}])},[e("span",xs,f(l(i)?"‚úì":c(i)?"‚Üí":"‚óã"),1),e("span",zs,f(m.label),1)],2)),64))])])]))}},qs=te(js,[["__scopeId","data-v-23ab71eb"]]),Hs="/api/graph-1c-admission-closure.php";function Zs(p){var l,c,k,_,m,i,v,y,C,b,S,G,O,L,h,r,M,w,u,g,W,A,V,j,Y,H,D,a,o,$,E,U,B,T,Z,oe,ie,de,Q,ge,be,fe,we,Te,Ce,$e,We,Se,De,Ee,Ie,Ae,Me;if(!p)return{meta:null,data:{currentWeek:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0},newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},weeksData:[],stages:[],responsible:[],responsibleCreatedThisWeek:[],responsibleCreatedOtherWeek:[]}};const s=p.data||p.result||p,t=s.meta||p.meta||null;return{meta:{...t,currentWeek:(t==null?void 0:t.currentWeek)||(t?{weekNumber:t.weekNumber,weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc}:null),weeks:(t==null?void 0:t.weeks)||[]},data:{currentWeek:((l=s.data)==null?void 0:l.currentWeek)||(s.data?{newTickets:s.data.newTickets??0,closedTickets:s.data.closedTickets??0,closedTicketsCreatedThisWeek:s.data.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:s.data.closedTicketsCreatedOtherWeek??0,carryoverTickets:s.data.carryoverTickets??0,carryoverTicketsCreatedThisWeek:s.data.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:s.data.carryoverTicketsCreatedOtherWeek??0}:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0}),newTickets:((k=(c=s.data)==null?void 0:c.currentWeek)==null?void 0:k.newTickets)??((_=s.data)==null?void 0:_.newTickets)??s.newTickets??0,closedTickets:((i=(m=s.data)==null?void 0:m.currentWeek)==null?void 0:i.closedTickets)??((v=s.data)==null?void 0:v.closedTickets)??s.closedTickets??0,closedTicketsCreatedThisWeek:((C=(y=s.data)==null?void 0:y.currentWeek)==null?void 0:C.closedTicketsCreatedThisWeek)??((b=s.data)==null?void 0:b.closedTicketsCreatedThisWeek)??s.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:((G=(S=s.data)==null?void 0:S.currentWeek)==null?void 0:G.closedTicketsCreatedOtherWeek)??((O=s.data)==null?void 0:O.closedTicketsCreatedOtherWeek)??s.closedTicketsCreatedOtherWeek??0,carryoverTickets:((h=(L=s.data)==null?void 0:L.currentWeek)==null?void 0:h.carryoverTickets)??((r=s.data)==null?void 0:r.carryoverTickets)??s.carryoverTickets??0,carryoverTicketsCreatedThisWeek:((w=(M=s.data)==null?void 0:M.currentWeek)==null?void 0:w.carryoverTicketsCreatedThisWeek)??((u=s.data)==null?void 0:u.carryoverTicketsCreatedThisWeek)??s.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:((W=(g=s.data)==null?void 0:g.currentWeek)==null?void 0:W.carryoverTicketsCreatedOtherWeek)??((A=s.data)==null?void 0:A.carryoverTicketsCreatedOtherWeek)??s.carryoverTicketsCreatedOtherWeek??0,series:{new:((j=(V=s.data)==null?void 0:V.series)==null?void 0:j.new)??((Y=s.series)==null?void 0:Y.new)??[0],closed:((D=(H=s.data)==null?void 0:H.series)==null?void 0:D.closed)??((a=s.series)==null?void 0:a.closed)??[0],closedCreatedThisWeek:(($=(o=s.data)==null?void 0:o.series)==null?void 0:$.closedCreatedThisWeek)??((E=s.series)==null?void 0:E.closedCreatedThisWeek)??[0],closedCreatedOtherWeek:((B=(U=s.data)==null?void 0:U.series)==null?void 0:B.closedCreatedOtherWeek)??((T=s.series)==null?void 0:T.closedCreatedOtherWeek)??[0],carryover:((oe=(Z=s.data)==null?void 0:Z.series)==null?void 0:oe.carryover)??((ie=s.series)==null?void 0:ie.carryover)??[0],carryoverCreatedThisWeek:((Q=(de=s.data)==null?void 0:de.series)==null?void 0:Q.carryoverCreatedThisWeek)??((ge=s.series)==null?void 0:ge.carryoverCreatedThisWeek)??[0],carryoverCreatedOtherWeek:((fe=(be=s.data)==null?void 0:be.series)==null?void 0:fe.carryoverCreatedOtherWeek)??((we=s.series)==null?void 0:we.carryoverCreatedOtherWeek)??[0]},weeksData:((Te=s.data)==null?void 0:Te.weeksData)??s.weeksData??[],stages:((Ce=s.data)==null?void 0:Ce.stages)??s.stages??[],responsible:(($e=s.data)==null?void 0:$e.responsible)??s.responsible??[],responsibleCreatedThisWeek:((We=s.data)==null?void 0:We.responsibleCreatedThisWeek)??s.responsibleCreatedThisWeek??[],responsibleCreatedOtherWeek:((Se=s.data)==null?void 0:Se.responsibleCreatedOtherWeek)??s.responsibleCreatedOtherWeek??[],newTicketsByStages:((De=s.data)==null?void 0:De.newTicketsByStages)??s.newTicketsByStages??null,carryoverTicketsByDuration:((Ee=s.data)==null?void 0:Ee.carryoverTicketsByDuration)??s.carryoverTicketsByDuration??null,newTicketsByMonth:((Ie=s.data)==null?void 0:Ie.newTicketsByMonth)??s.newTicketsByMonth??[],closedTicketsByMonth:((Ae=s.data)==null?void 0:Ae.closedTicketsByMonth)??s.closedTicketsByMonth??[],carryoverTicketsByMonth:((Me=s.data)==null?void 0:Me.carryoverTicketsByMonth)??s.carryoverTicketsByMonth??[]}}}async function re(p={}){const{endpoint:s=Hs,product:t="1C",weekStartUtc:l=null,weekEndUtc:c=null,periodMode:k="weeks",useCache:_=!0,forceRefresh:m=!1,includeTickets:i=!1,includeNewTicketsByStages:v=!1,includeCarryoverTickets:y=!0,includeCarryoverTicketsByDuration:C=!1}=p,S=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({product:t,weekStartUtc:l,weekEndUtc:c,periodMode:k,useCache:_,forceRefresh:m,includeTickets:i,includeNewTicketsByStages:v,includeCarryoverTickets:y,includeCarryoverTicketsByDuration:C})});if(!S.ok)throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (${S.status})`);const G=await S.json();if((G==null?void 0:G.success)===!1)throw new Error(G.message||"–ë—ç–∫–µ–Ω–¥ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É");return Zs(G)}const Ks={class:"ac-dashboard-months"},Js={key:"content"},Xs={class:"dashboard-header"},Qs={class:"header-content"},ea={class:"breadcrumbs-row"},ta=["aria-label","aria-disabled","data-fallback","disabled"],sa={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},aa={class:"dashboard-layout"},ra={class:"filters-container"},oa={class:"chart-container"},la={__name:"GraphAdmissionClosureMonthsDashboard",setup(p){const s=Ne(),t=I(!0),l=I(0),c=I("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."),k=I(null),_=I(null),m=I({newTickets:0,closedTickets:0,carryoverTickets:0,newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]}),i=I(!1),v=P(()=>typeof window>"u"?!1:window.history.length>1),y=P(()=>v.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),C={name:"dashboard-sector-1c"};function b(W){var A;if((A=W==null?void 0:W.preventDefault)==null||A.call(W),!i.value){i.value=!0;try{if(v.value){s.back();return}console.warn("GraphAdmissionClosureMonthsDashboard: fallback navigation to dashboard-sector-1c"),s.push(C)}finally{i.value=!1}}}const S=I({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),G=P(()=>{const W=S.value.customDateRange.startDate||S.value.customDateRange.endDate,A=S.value.employees.length===1&&S.value.employees.includes("all");return W||!A});async function O(W,A,V=500){const j=l.value,Y=10,H=(W-j)/Y,D=V/Y;for(let a=0;a<Y;a++)await new Promise(o=>setTimeout(o,D)),l.value=Math.min(j+H*(a+1),W);l.value=W,c.value=A}async function L(){t.value=!0,k.value=null,l.value=0,c.value="–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...";try{await O(10,"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",300),await O(40,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –æ–∫—Ç—è–±—Ä—å...",800),await O(70,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –Ω–æ—è–±—Ä—å...",800),await O(90,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –¥–µ–∫–∞–±—Ä—å...",800),await O(95,"–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...",400);const W=await re({product:"1C",periodMode:"months",includeTickets:!0});await O(100,"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",300);const{meta:A,data:V}=W;_.value=A,m.value=V,await new Promise(j=>setTimeout(j,200))}catch(W){k.value=W instanceof Error?W:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureMonthsDashboard] loadData error:",W),l.value=100}finally{t.value=!1}}function h(W){S.value.stages=W}function r(W){S.value.employees=W}function M(W){S.value.dateRange=W}function w(W){S.value.customDateRange=W}function u(){S.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},g()}function g(){L()}return me(()=>{L()}),(W,A)=>{const V=Pe("router-link");return n(),d("div",Ks,[R(J,{name:"fade",mode:"out-in"},{default:x(()=>[t.value?(n(),ee(qs,{key:"preloader",progress:l.value,"current-stage":c.value},null,8,["progress","current-stage"])):(n(),d("div",Js,[e("div",Xs,[e("div",Qs,[e("div",ea,[e("button",{class:"btn-back-link",type:"button",onClick:b,"aria-label":y.value,"aria-disabled":!v.value,"data-fallback":!v.value,disabled:i.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,ta),e("nav",sa,[R(V,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:x(()=>[...A[0]||(A[0]=[X(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),A[2]||(A[2]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),R(V,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:x(()=>[...A[1]||(A[1]=[X(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),A[3]||(A[3]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),A[4]||(A[4]=e("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),A[5]||(A[5]=e("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),A[6]||(A[6]=e("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),e("div",aa,[e("div",ra,[R(Ve,{stages:S.value.stages,employees:S.value.employees,dateRange:S.value.dateRange,customDateRange:S.value.customDateRange,hasActiveFilters:G.value,hideStages:!0,weekPickerMode:!1,"onUpdate:stages":h,"onUpdate:employees":r,"onUpdate:dateRange":M,"onUpdate:customDateRange":w,onReset:u,onApply:g},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])]),e("div",oa,[k.value?(n(),ee(Le,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:k.value.message},null,8,["message"])):(n(),d(z,{key:1},[R(Ts,{data:m.value},null,8,["data"]),R(Rs,{data:m.value,meta:_.value},null,8,["data","meta"])],64))])])]))]),_:1})])}}},na=te(la,[["__scopeId","data-v-117104d3"]]);class _e{static async getSectorData(){try{const s=await this.getAllTickets();console.log("Total tickets loaded:",s.length);const t=this.extractUniqueEmployeeIds(s);console.log("Unique employee IDs:",t);const l=await this.getEmployeesByIds(t);return console.log("Loaded employees:",l.length),{stages:this.groupTicketsByStages(s,l),employees:l,zeroPointTickets:this.getZeroPointTickets(s)}}catch(s){throw console.error("Error getting sector data:",s),s}}static async getAllTickets(){const s=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],t=[];for(const l of s){console.log(`Loading tickets for stage: ${l}`);const c=await this.getTicketsByStage(l);t.push(...c),console.log(`Loaded ${c.length} tickets for stage ${l}`)}return t}static async getTicketsByStage(s){const t=[];let l=0;const c=50;let k=!0;for(;k;)try{const m=await le.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:s},select:["*"],order:{id:"DESC"},start:l,useOriginalUfNames:"Y"});let i=[];m&&m.result&&(Array.isArray(m.result)?i=m.result:m.result.items&&Array.isArray(m.result.items)?i=m.result.items:m.result.data&&Array.isArray(m.result.data)&&(i=m.result.data)),i.length>0?(t.push(...i),l+=i.length,k=i.length===c):k=!1}catch(m){console.error(`Error loading tickets batch for stage ${s} (start: ${l}):`,m),k=!1}t.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(t[0],null,2)),console.log("Sample ticket keys:",Object.keys(t[0])),console.log("Sample ticket assignedById variants:",{assignedById:t[0].assignedById,assignedByIdId:t[0].assignedByIdId,ASSIGNED_BY_ID:t[0].ASSIGNED_BY_ID}));const _=t.filter(m=>{const i=m.UF_CRM_7_TYPE_PRODUCT||m.uf_crm_7_type_product||m.ufCrm7TypeProduct||m.UF_CRM_7_TYPE_PRODUCT||m.uf_crm_7_type_product;return Array.isArray(i)?i.includes(this.SECTOR_TAG):typeof i=="object"&&i!==null?i.value===this.SECTOR_TAG||i===this.SECTOR_TAG:i===this.SECTOR_TAG});return console.log(`Filtered ${_.length} tickets from ${t.length} for stage ${s} (sector tag: ${this.SECTOR_TAG})`),_}static extractUniqueEmployeeIds(s){if(!Array.isArray(s))return[];const t=new Set;return s.forEach(l=>{const c=l.assignedById||l.assignedByIdId||l.ASSIGNED_BY_ID||l.assignedById||l.assignedById&&typeof l.assignedById=="object"&&(l.assignedById.id||l.assignedById.ID)||l.assignedById&&typeof l.assignedById=="object"&&l.assignedById.value;if(c){const k=parseInt(c);k&&!isNaN(k)&&k>0&&t.add(k)}}),s.length>0&&(console.log("Sample ticket for employee extraction:",s[0]),console.log("Sample ticket assignedById variants:",{assignedById:s[0].assignedById,assignedByIdId:s[0].assignedByIdId,ASSIGNED_BY_ID:s[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(t))),Array.from(t)}static async getEmployeesByIds(s){if(!Array.isArray(s)||s.length===0)return[];try{const t=await le.call("user.get",{filter:{ID:s}});let l=[];return t&&t.result&&(Array.isArray(t.result)?l=t.result:console.warn("Unexpected user.get result format:",t)),l.map(c=>({id:parseInt(c.ID||c.id||0),name:`${c.NAME||c.name||""} ${c.LAST_NAME||c.lastName||""}`.trim()||c.EMAIL||c.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:c.WORK_POSITION||c.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:c.EMAIL||c.email||"",tickets:[]}))}catch(t){return console.error("Error getting employees by IDs:",t),[]}}static groupTicketsByStages(s,t){Array.isArray(s)||(console.warn("Tickets is not an array:",s),s=[]),Array.isArray(t)||(console.warn("Employees is not an array:",t),t=[]);const l=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:t.map(c=>({...c,tickets:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:t.map(c=>({...c,tickets:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:t.map(c=>({...c,tickets:[]}))}];return s.forEach(c=>{const k=this.mapStageId(c.stageId||c.STAGE_ID||""),_=l.find(m=>m.id===k);if(_){const m=c.assignedById||c.ASSIGNED_BY_ID||null,i=m?parseInt(m):null;if(i){let v=_.employees.find(y=>y.id===i);v||(v={id:i,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${i}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",tickets:[]},_.employees.push(v)),v.tickets.push(this.mapTicket(c))}}}),l}static mapStageId(s){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[s]||"formed"}static mapStageIdToBitrix(s){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[s]||"DT140_12:UC_0VHWE2"}static mapTicket(s){const t=parseInt(s.id||s.ID||0),l=s.title||s.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",c=s.stageId||s.STAGE_ID||"",k=s.assignedById||s.ASSIGNED_BY_ID||null,_=s.createdTime||s.CREATED_DATE||s.CREATED_TIME||"",m=s.updatedTime||s.MODIFY_DATE||s.UPDATED_TIME||"",i=s.UF_CRM_7_UF_PRIORITY||s.uf_crm_7_uf_priority||s.ufCrm7UfPriority||s.UF_CRM_7_UF_PRIORITY||s.uf_crm_7_uf_priority||s.priority||s.PRIORITY||null,v=Ue(i),y=He(v);return{id:t,title:l,priorityId:v.id,priorityLabel:v.label,priorityColors:y,priority:v.id,priorityBitrixValue:v.bitrixValue||null,status:this.mapStatus(c),assigneeId:k?parseInt(k):null,stageId:this.mapStageId(c),createdAt:_,modifiedAt:m,amount:s.opportunity||s.OPPORTUNITY||0,currency:s.currencyId||s.CURRENCY_ID||"RUB",description:s.comments||s.COMMENTS||""}}static mapPriority(s){return Ue(s).id}static mapPriorityToBitrix(s){if(s&&typeof s=="object")return s.bitrixValue||null;const t=Oe(s);if(t&&t.bitrixValue)return t.bitrixValue;const l={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return l[s]?l[s]:Oe(Ze).bitrixValue}static mapStatus(s){return"in_progress"}static getZeroPointTickets(s){const t={formed:[],review:[],execution:[]};return Array.isArray(s)?(s.filter(l=>!(l.assignedById||l.ASSIGNED_BY_ID)).forEach(l=>{const c=this.mapStageId(l.stageId||l.STAGE_ID||"");t[c]&&t[c].push(this.mapTicket(l))}),t):(console.warn("Tickets is not an array in getZeroPointTickets:",s),t)}static async assignTicket(s,t,l){try{const c=this.mapStageIdToBitrix(l);return(await le.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:s,fields:{assignedById:t,stageId:c}})).result===!0}catch(c){throw console.error("Error assigning ticket:",c),c}}static async createTicket(s){try{const t=await le.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:s.title,assignedById:s.employeeId,stageId:this.mapStageIdToBitrix(s.stageId)}});return t.result?parseInt(t.result):0}catch(t){throw console.error("Error creating ticket:",t),t}}static async getTicket(s){try{const t=await le.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:s});return this.mapTicket(t.result)}catch(t){throw console.error("Error getting ticket:",t),t}}static async addComment(s,t){try{return(await le.call("crm.timeline.comment.add",{fields:{entityId:s,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:t}})).result!==void 0}catch(l){throw console.error("Error adding comment:",l),l}}}ye(_e,"ENTITY_TYPE_ID",140),ye(_e,"SECTOR_TAG","1C");const ia={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},da={class:"modal"},ca={key:0,class:"modal__tabs"},ua={key:"level-0-categories",class:"level-0"},ka={class:"modal__header"},va={class:"modal__title"},ma={key:0},ya={class:"modal__body"},ha={class:"categories-list"},_a=["onClick"],pa={class:"category-item"},ga={class:"category-item__icon"},ba={key:0},fa={key:1},wa={class:"category-item__content"},Ta={class:"category-item__label"},Ca={class:"category-item__count"},$a={key:0,class:"category-item__arrow"},Wa={class:"modal__footer"},Sa={key:"level-1-categories",class:"level-1"},Da={class:"modal__header"},Ea={class:"modal__body"},Ia={key:"loading",class:"loading-names"},Aa={key:"empty",class:"modal__empty"},Ma={key:"list",class:"responsible-list"},Ua=["onClick"],Oa={class:"responsible-list__name"},Ba={class:"responsible-list__count"},Ra={key:0,class:"responsible-list__arrow"},Na={class:"modal__footer"},Pa={key:"level-2-categories",class:"level-2"},La={class:"modal__header"},Va={class:"modal__title"},Fa={class:"modal__body"},Ga={key:"loading",class:"loading-state"},Ya={key:"error",class:"error-state"},xa={class:"error-message"},za={key:"empty",class:"empty-state"},ja={key:"tickets",class:"tickets-list-container"},qa={key:"level-0-employees",class:"level-0"},Ha={class:"modal__header"},Za={class:"modal__title"},Ka={key:0},Ja={class:"modal__body"},Xa={key:"loading",class:"loading-names"},Qa={key:"empty",class:"modal__empty"},er={key:"list",class:"responsible-list"},tr=["onClick"],sr={class:"responsible-list__name"},ar={class:"responsible-list__count"},rr={key:0,class:"responsible-list__arrow"},or={class:"modal__footer"},lr={key:"level-1-employees",class:"level-1"},nr={class:"modal__header"},ir={class:"modal__title"},dr={class:"modal__body"},cr={class:"categories-list"},ur=["onClick"],kr={class:"category-item"},vr={class:"category-item__icon"},mr={key:0},yr={key:1},hr={class:"category-item__content"},_r={class:"category-item__label"},pr={class:"category-item__count"},gr={key:0,class:"category-item__arrow"},br={class:"modal__footer"},fr={key:"level-2-employees",class:"level-2"},wr={class:"modal__header"},Tr={class:"modal__title"},Cr={class:"modal__body"},$r={key:"loading",class:"loading-state"},Wr={key:"error",class:"error-state"},Sr={class:"error-message"},Dr={key:"empty",class:"empty-state"},Er={class:"empty-state-message"},Ir={key:"tickets",class:"tickets-list-container"},Ar={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(p){const s=p,t=I(0),l=I("categories"),c=I(null),k=I(null),_=I(null),m=I([]),i=I(!1),v=I(null),y=I([]),C=I([]),b=I(!1),S=P(()=>[{id:"created-this-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é",count:s.closedTicketsCreatedThisWeek??0,responsible:s.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ",count:s.closedTicketsCreatedOtherWeek??0,responsible:s.responsibleCreatedOtherWeek??[]}]),G=P(()=>{const a=new Map;return(s.responsibleCreatedThisWeek||[]).forEach(o=>{const $=o.id??"unassigned";a.has($)||a.set($,{id:o.id,name:o.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const E=a.get($);E.thisWeekCount=o.count??0,E.thisWeekTickets=o.tickets||[],E.totalCount+=E.thisWeekCount}),(s.responsibleCreatedOtherWeek||[]).forEach(o=>{const $=o.id??"unassigned";a.has($)||a.set($,{id:o.id,name:o.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const E=a.get($);E.otherWeekCount=o.count??0,E.otherWeekTickets=o.tickets||[],E.totalCount+=E.otherWeekCount}),Array.from(a.values())}),O=P(()=>{if(!k.value)return[];const a=k.value.thisWeekTickets||[],o=k.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:k.value.id,name:k.value.name,thisWeekCount:k.value.thisWeekCount,otherWeekCount:k.value.otherWeekCount,thisWeekTickets:a.length,otherWeekTickets:o.length,employee:k.value}),[{id:"this-week",label:"–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ",count:k.value.thisWeekCount??0,tickets:a,employeeId:k.value.id},{id:"other-week",label:"–ù–∞ –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ",count:k.value.otherWeekCount??0,tickets:o,employeeId:k.value.id}]}),L=P(()=>(C.value||[]).length>0);async function h(a){const o=a.filter($=>$.id!==null&&$.id!==void 0).map($=>$.id);if(o.length===0)return a;try{const $=await _e.getEmployeesByIds(o),E=new Map;return $.forEach(U=>{E.set(U.id,U.name)}),a.map(U=>U.id&&E.has(U.id)?{...U,name:E.get(U.id)}:U)}catch($){return console.error("[ResponsibleModal] Error enriching names:",$),a}}se([()=>l.value,()=>G.value],async([a,o])=>{if(!(a!=="employees"||t.value!==0)){if(!o||o.length===0){C.value=[];return}b.value=!0;try{C.value=await h(o)}catch($){console.error("[ResponsibleModal] Error loading employee names:",$),C.value=o}finally{b.value=!1}}},{immediate:!0}),se(()=>s.responsible,async a=>{if(!(t.value!==0||c.value||l.value!=="categories")){if(!a||a.length===0){y.value=[];return}b.value=!0;try{y.value=await h(a)}catch(o){console.error("[ResponsibleModal] Error loading employee names:",o),y.value=a}finally{b.value=!1}}},{immediate:!1});const r=P(()=>(y.value||[]).length>0);function M(a){l.value!==a&&(l.value=a,t.value=0,c.value=null,k.value=null,_.value=null,m.value=[],v.value=null,y.value=[],C.value=[])}async function w(a){if(!(!a||a.count===0)){c.value=a,t.value=1,b.value=!0;try{y.value=await h(a.responsible)}catch(o){console.error("[ResponsibleModal] Error loading employee names:",o),y.value=a.responsible}finally{b.value=!1}}}async function u(a,o=null){var $,E;!a||!a.id||a.totalCount===0||(o&&o.currentTarget&&(o.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{o.currentTarget&&(o.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:a.id,name:a.name,thisWeekCount:a.thisWeekCount,otherWeekCount:a.otherWeekCount,thisWeekTickets:(($=a.thisWeekTickets)==null?void 0:$.length)||0,otherWeekTickets:((E=a.otherWeekTickets)==null?void 0:E.length)||0,employee:a}),k.value={...a,thisWeekTickets:a.thisWeekTickets||[],otherWeekTickets:a.otherWeekTickets||[]},t.value=1)}async function g(a){var $;if(!a||a.count===0)return;_.value=a,t.value=2;const o=a.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:a.id,label:a.label,count:a.count,ticketsInGradation:o.length,selectedEmployee:($=k.value)==null?void 0:$.id}),o.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",o.length),await W(o)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await A(a))}async function W(a){i.value=!0,v.value=null;try{try{const{prepareTicketsForDisplay:o}=await ce(async()=>{const{prepareTicketsForDisplay:$}=await import("./ticketListUtils-DaVyNT-C.js").then(E=>E.t);return{prepareTicketsForDisplay:$}},__vite__mapDeps([0,1,2,3,4,5]));m.value=await o(a,null,null)}catch(o){console.error("[ResponsibleModal] Error preparing tickets:",o),m.value=a}m.value.length===0&&(v.value=null)}catch(o){v.value=o.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",o),m.value=[]}finally{i.value=!1}}async function A(a){i.value=!0,v.value=null;try{if(!s.weekStartUtc||!s.weekEndUtc||!k.value)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫");const o=await re({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeTickets:!0}),$=a.id==="this-week"?o.data.responsibleCreatedThisWeek:o.data.responsibleCreatedOtherWeek,E=$==null?void 0:$.find(B=>B.id===k.value.id),U=(E==null?void 0:E.tickets)||[];try{const{prepareTicketsForDisplay:B}=await ce(async()=>{const{prepareTicketsForDisplay:T}=await import("./ticketListUtils-DaVyNT-C.js").then(Z=>Z.t);return{prepareTicketsForDisplay:T}},__vite__mapDeps([0,1,2,3,4,5]));m.value=await B(U,null,null)}catch(B){console.error("[ResponsibleModal] Error preparing tickets:",B),m.value=U}m.value.length===0&&(v.value=null)}catch(o){v.value=o.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets from API:",o),m.value=[]}finally{i.value=!1}}async function V(a,o=null){!a||!a.id||a.count===0||(o&&o.currentTarget&&(o.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{o.currentTarget&&(o.currentTarget.style.transform="")},150)),k.value=a,t.value=2,await j(a.id))}async function j(a){var o;i.value=!0,v.value=null;try{let $=[];if(c.value&&c.value.responsible){const E=c.value.responsible.find(U=>U.id===a);$=(E==null?void 0:E.tickets)||[]}if($.length===0&&s.weekStartUtc&&s.weekEndUtc){const E=await re({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeTickets:!0}),U=((o=c.value)==null?void 0:o.id)==="created-this-week"?E.data.responsibleCreatedThisWeek:E.data.responsibleCreatedOtherWeek,B=U==null?void 0:U.find(T=>T.id===a);$=(B==null?void 0:B.tickets)||[]}try{const{prepareTicketsForDisplay:E}=await ce(async()=>{const{prepareTicketsForDisplay:U}=await import("./ticketListUtils-DaVyNT-C.js").then(B=>B.t);return{prepareTicketsForDisplay:U}},__vite__mapDeps([0,1,2,3,4,5]));m.value=await E($,null,null)}catch(E){console.error("[ResponsibleModal] Error preparing tickets:",E),m.value=$}m.value.length===0&&(v.value=null)}catch($){v.value=$.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",$),m.value=[]}finally{i.value=!1}}function Y(){t.value===2?(t.value=1,l.value==="categories"?k.value=null:_.value=null,m.value=[],v.value=null):t.value===1&&(t.value=0,l.value==="categories"?(c.value=null,y.value=[]):k.value=null)}function H(a){const o=pe(a.id);window.open(o,"_blank")}function D(){l.value==="employees"&&_.value?W(_.value.tickets):l.value==="categories"&&k.value&&j(k.value.id)}return se(()=>s.isVisible,a=>{a||(t.value=0,l.value="categories",c.value=null,k.value=null,_.value=null,m.value=[],v.value=null,y.value=[],C.value=[])}),(a,o)=>p.isVisible?(n(),d("div",ia,[e("div",da,[t.value===0?(n(),d("div",ca,[e("button",{class:K(["modal__tab",{"modal__tab--active":l.value==="categories"}]),onClick:o[0]||(o[0]=$=>M("categories"))}," –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º ",2),e("button",{class:K(["modal__tab",{"modal__tab--active":l.value==="employees"}]),onClick:o[1]||(o[1]=$=>M("employees"))}," –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º ",2)])):F("",!0),R(J,{name:"level",mode:"out-in"},{default:x(()=>{var $,E,U,B;return[l.value==="categories"&&t.value===0?(n(),d("div",ua,[e("header",ka,[e("h3",va,[o[12]||(o[12]=X(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),p.weekNumber?(n(),d("span",ma," ¬∑ –ù–µ–¥–µ–ª—è "+f(p.weekNumber),1)):F("",!0)]),e("button",{class:"modal__close",onClick:o[2]||(o[2]=T=>a.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",ya,[e("ul",ha,[(n(!0),d(z,null,q(S.value,T=>(n(),d("li",{key:T.id,class:K(["categories-list__item",{"categories-list__item--clickable":T.count>0}]),onClick:Z=>w(T)},[e("div",pa,[e("div",ga,[T.id==="created-this-week"?(n(),d("span",ba,"‚úì")):(n(),d("span",fa,"‚Üª"))]),e("div",wa,[e("div",Ta,f(T.label),1),e("div",Ca,f(T.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),T.count>0?(n(),d("span",$a,"‚Üí")):F("",!0)])],10,_a))),128))])]),e("footer",Wa,[e("button",{class:"btn",onClick:o[3]||(o[3]=T=>a.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="categories"&&t.value===1?(n(),d("div",Sa,[e("header",Da,[e("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),o[13]||(o[13]=e("h3",{class:"modal__title"},"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),e("button",{class:"modal__close",onClick:o[4]||(o[4]=T=>a.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",Ea,[R(J,{name:"loading",mode:"out-in"},{default:x(()=>[b.value?(n(),d("div",Ia,[...o[14]||(o[14]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):r.value?(n(),d("ul",Ma,[(n(!0),d(z,null,q(y.value,T=>(n(),d("li",{key:T.id||T.name,class:K(["responsible-list__item",{"responsible-list__item--clickable":T.id&&T.count>0}]),onClick:Z=>V(T,Z),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[e("span",Oa,f(T.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),e("span",Ba,f(T.count??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),T.id&&T.count>0?(n(),d("span",Ra,"‚Üí")):F("",!0)],10,Ua))),128))])):(n(),d("p",Aa,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º"))]),_:1})]),e("footer",Na,[e("button",{class:"btn",onClick:o[5]||(o[5]=T=>a.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="categories"&&t.value===2?(n(),d("div",Pa,[e("header",La,[e("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",Va,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+f((($=k.value)==null?void 0:$.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:o[6]||(o[6]=T=>a.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",Fa,[R(J,{name:"loading",mode:"out-in"},{default:x(()=>[i.value?(n(),d("div",Ga,[...o[15]||(o[15]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):v.value?(n(),d("div",Ya,[o[16]||(o[16]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),o[17]||(o[17]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",xa,f(v.value),1),e("button",{class:"btn btn-retry",onClick:D},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):m.value.length===0?(n(),d("div",za,[...o[18]||(o[18]=[e("div",{class:"empty-state-icon"},"üìã",-1),e("p",{class:"empty-state-message"},"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é",-1)])])):(n(),d("div",ja,[R(ke,{name:"ticket",tag:"div",class:"tickets-list"},{default:x(()=>[(n(!0),d(z,null,q(m.value,(T,Z)=>(n(),ee(ve,{key:T.id,ticket:T,draggable:!1,style:ae({"--ticket-index":Z}),onClick:H},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):l.value==="employees"&&t.value===0?(n(),d("div",qa,[e("header",Ha,[e("h3",Za,[o[19]||(o[19]=X(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),p.weekNumber?(n(),d("span",Ka," ¬∑ –ù–µ–¥–µ–ª—è "+f(p.weekNumber),1)):F("",!0)]),e("button",{class:"modal__close",onClick:o[7]||(o[7]=T=>a.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",Ja,[R(J,{name:"loading",mode:"out-in"},{default:x(()=>[b.value?(n(),d("div",Xa,[...o[20]||(o[20]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):L.value?(n(),d("ul",er,[(n(!0),d(z,null,q(C.value,T=>(n(),d("li",{key:T.id||T.name,class:K(["responsible-list__item",{"responsible-list__item--clickable":T.id&&T.totalCount>0}]),onClick:Z=>u(T,Z),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞–¥–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[e("span",sr,f(T.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),e("span",ar,f(T.totalCount??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),T.id&&T.totalCount>0?(n(),d("span",rr,"‚Üí")):F("",!0)],10,tr))),128))])):(n(),d("p",Qa,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"))]),_:1})]),e("footer",or,[e("button",{class:"btn",onClick:o[8]||(o[8]=T=>a.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="employees"&&t.value===1?(n(),d("div",lr,[e("header",nr,[e("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",ir,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+f(((E=k.value)==null?void 0:E.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:o[9]||(o[9]=T=>a.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",dr,[e("ul",cr,[(n(!0),d(z,null,q(O.value,T=>(n(),d("li",{key:T.id,class:K(["categories-list__item",{"categories-list__item--clickable":T.count>0}]),onClick:Z=>g(T)},[e("div",kr,[e("div",vr,[T.id==="this-week"?(n(),d("span",mr,"‚úì")):(n(),d("span",yr,"‚Üª"))]),e("div",hr,[e("div",_r,f(T.label),1),e("div",pr,f(T.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),T.count>0?(n(),d("span",gr,"‚Üí")):F("",!0)])],10,ur))),128))])]),e("footer",br,[e("button",{class:"btn",onClick:o[10]||(o[10]=T=>a.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="employees"&&t.value===2?(n(),d("div",fr,[e("header",wr,[e("button",{class:"btn-back",onClick:Y,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",Tr," –¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+f(((U=k.value)==null?void 0:U.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")+" ("+f(((B=_.value)==null?void 0:B.label)||"")+") ",1),e("button",{class:"modal__close",onClick:o[11]||(o[11]=T=>a.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",Cr,[R(J,{name:"loading",mode:"out-in"},{default:x(()=>{var T;return[i.value?(n(),d("div",$r,[...o[21]||(o[21]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):v.value?(n(),d("div",Wr,[o[22]||(o[22]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),o[23]||(o[23]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",Sr,f(v.value),1),e("button",{class:"btn btn-retry",onClick:D},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):m.value.length===0?(n(),d("div",Dr,[o[24]||(o[24]=e("div",{class:"empty-state-icon"},"üìã",-1)),e("p",Er,f(l.value==="employees"?`–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${((T=_.value)==null?void 0:T.label)||""}"`:"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é"),1)])):(n(),d("div",Ir,[R(ke,{name:"ticket",tag:"div",class:"tickets-list"},{default:x(()=>[(n(!0),d(z,null,q(m.value,(Z,oe)=>(n(),ee(ve,{key:Z.id,ticket:Z,draggable:!1,style:ae({"--ticket-index":oe}),onClick:H},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):F("",!0)]}),_:1})])])):F("",!0)}},Mr=te(Ar,[["__scopeId","data-v-3b229bb4"]]),Ur={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Or={class:"modal"},Br={key:"level-1",class:"level-1"},Rr={class:"modal__header"},Nr={class:"modal__title"},Pr={key:0},Lr={class:"modal__body"},Vr={key:"loading",class:"loading-names"},Fr={key:"empty",class:"modal__empty"},Gr={key:"list",class:"stages-list"},Yr=["onClick"],xr={class:"stages-list__name"},zr={class:"stages-list__count"},jr={key:0,class:"stages-list__arrow"},qr={class:"modal__footer"},Hr={key:"level-2",class:"level-2"},Zr={class:"modal__header"},Kr={class:"modal__title"},Jr={class:"modal__body"},Xr={key:"loading",class:"loading-state"},Qr={key:"error",class:"error-state"},eo={class:"error-message"},to={key:"empty",class:"empty-state"},so={class:"empty-state-message"},ao={key:"tickets",class:"tickets-list-container"},ro={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(p,{emit:s}){const t=p,l=I(1),c=I(null),k=I([]),_=I(!1),m=I(!1),i=I(null),v=I([]),y=P(()=>v.value.length>0&&v.value.some(h=>h.count>0));async function C(){if(!t.weekStartUtc||!t.weekEndUtc){v.value=[];return}m.value=!0,i.value=null;try{const h=await re({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0});v.value=h.data.newTicketsByStages||[]}catch(h){i.value=h.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–π",console.error("[StagesModal] Error loading stages:",h),v.value=[]}finally{m.value=!1}}async function b(h,r=null){!h||h.count===0||(r&&r.currentTarget&&(r.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{r.currentTarget&&(r.currentTarget.style.transform="")},150)),c.value=h,l.value=2,await S(h.stageId))}async function S(h){var r;_.value=!0,i.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const w=(r=(await re({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:r.find(g=>g.stageId===h),u=(w==null?void 0:w.tickets)||[];try{const{prepareTicketsForDisplay:g}=await ce(async()=>{const{prepareTicketsForDisplay:W}=await import("./ticketListUtils-DaVyNT-C.js").then(A=>A.t);return{prepareTicketsForDisplay:W}},__vite__mapDeps([0,1,2,3,4,5]));k.value=await g(u,null,null)}catch(g){console.error("[StagesModal] Error preparing tickets:",g),k.value=u}k.value.length===0&&(i.value=null)}catch(M){i.value=M.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[StagesModal] Error loading tickets:",M),k.value=[]}finally{_.value=!1}}function G(){l.value=1,c.value=null,k.value=[],i.value=null}function O(h){const r=pe(h.id);window.open(r,"_blank")}function L(){c.value&&S(c.value.stageId)}return se(()=>t.isVisible,h=>{h?C():(l.value=1,c.value=null,k.value=[],i.value=null,v.value=[])}),se([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&C()}),(h,r)=>p.isVisible?(n(),d("div",Ur,[e("div",Or,[R(J,{name:"level",mode:"out-in"},{default:x(()=>{var M;return[l.value===1?(n(),d("div",Br,[e("header",Rr,[e("h3",Nr,[r[3]||(r[3]=X(" –ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),p.weekNumber?(n(),d("span",Pr," ¬∑ –ù–µ–¥–µ–ª—è "+f(p.weekNumber),1)):F("",!0)]),e("button",{class:"modal__close",onClick:r[0]||(r[0]=w=>h.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",Lr,[R(J,{name:"loading",mode:"out-in"},{default:x(()=>[m.value?(n(),d("div",Vr,[...r[4]||(r[4]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–π...",-1)])])):y.value?(n(),d("ul",Gr,[(n(!0),d(z,null,q(v.value,w=>(n(),d("li",{key:w.stageId,class:K(["stages-list__item",{"stages-list__item--clickable":w.count>0}]),style:ae({"--stage-color":w.color}),onClick:u=>b(w,u),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏"},[e("span",{class:"stages-list__color",style:ae({backgroundColor:w.color})},null,4),e("span",xr,f(w.stageName),1),e("span",zr,f(w.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),w.count>0?(n(),d("span",jr,"‚Üí")):F("",!0)],14,Yr))),128))])):(n(),d("p",Fr," –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),e("footer",qr,[e("button",{class:"btn",onClick:r[1]||(r[1]=w=>h.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value===2?(n(),d("div",Hr,[e("header",Zr,[e("button",{class:"btn-back",onClick:G,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",Kr," –¢–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏: "+f(((M=c.value)==null?void 0:M.stageName)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:r[2]||(r[2]=w=>h.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",Jr,[R(J,{name:"loading",mode:"out-in"},{default:x(()=>{var w;return[_.value?(n(),d("div",Xr,[...r[5]||(r[5]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):i.value?(n(),d("div",Qr,[r[6]||(r[6]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),r[7]||(r[7]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",eo,f(i.value),1),e("button",{class:"btn btn-retry",onClick:L},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):k.value.length===0?(n(),d("div",to,[r[8]||(r[8]=e("div",{class:"empty-state-icon"},"üìã",-1)),e("p",so," –ù–∞ —Å—Ç–∞–¥–∏–∏ ¬´"+f((w=c.value)==null?void 0:w.stageName)+"¬ª –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é ",1)])):(n(),d("div",ao,[R(ke,{name:"ticket",tag:"div",class:"tickets-list"},{default:x(()=>[(n(!0),d(z,null,q(k.value,(u,g)=>(n(),ee(ve,{key:u.id,ticket:u,draggable:!1,style:ae({"--ticket-index":g}),onClick:O},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):F("",!0)]}),_:1})])])):F("",!0)}},oo=te(ro,[["__scopeId","data-v-4af0cfce"]]),lo={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},no={class:"modal"},io={key:"level-1",class:"level-1"},co={class:"modal__header"},uo={class:"modal__title"},ko={key:0},vo={class:"modal__body"},mo={key:"loading",class:"loading-names"},yo={key:"empty",class:"modal__empty"},ho={key:"list",class:"duration-list"},_o=["onClick"],po={class:"duration-list__name"},go={class:"duration-list__count"},bo={key:0,class:"duration-list__arrow"},fo={class:"modal__footer"},wo={key:"level-2",class:"level-2"},To={class:"modal__header"},Co={class:"modal__title"},$o={class:"modal__body"},Wo={key:"loading",class:"loading-state"},So={key:"error",class:"error-state"},Do={class:"error-message"},Eo={key:"empty",class:"empty-state"},Io={class:"empty-state-message"},Ao={key:"tickets",class:"tickets-list-container"},Mo={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(p,{emit:s}){const t=p,l=I(1),c=I(null),k=I([]),_=I(!1),m=I(!1),i=I(null),v=I([]),y=P(()=>v.value.length>0&&v.value.some(h=>h.count>0));async function C(){if(!t.weekStartUtc||!t.weekEndUtc){v.value=[];return}m.value=!0,i.value=null;try{const h=await re({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});v.value=h.data.carryoverTicketsByDuration||[]}catch(h){i.value=h.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π",console.error("[CarryoverDurationModal] Error loading categories:",h),v.value=[]}finally{m.value=!1}}async function b(h,r=null){!h||h.count===0||(r&&r.currentTarget&&(r.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{r.currentTarget&&(r.currentTarget.style.transform="")},150)),c.value=h,l.value=2,await S(h.durationCategory))}async function S(h){var r;_.value=!0,i.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const w=(r=(await re({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})).data.carryoverTicketsByDuration)==null?void 0:r.find(g=>g.durationCategory===h),u=(w==null?void 0:w.tickets)||[];try{const{prepareTicketsForDisplay:g}=await ce(async()=>{const{prepareTicketsForDisplay:W}=await import("./ticketListUtils-DaVyNT-C.js").then(A=>A.t);return{prepareTicketsForDisplay:W}},__vite__mapDeps([0,1,2,3,4,5]));k.value=await g(u,null,null)}catch(g){console.error("[CarryoverDurationModal] Error preparing tickets:",g),k.value=u}k.value.length===0&&(i.value=null)}catch(M){i.value=M.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[CarryoverDurationModal] Error loading tickets:",M),k.value=[]}finally{_.value=!1}}function G(){l.value=1,c.value=null,k.value=[],i.value=null}function O(h){const r=pe(h.id);window.open(r,"_blank")}function L(){c.value&&S(c.value.durationCategory)}return se(()=>t.isVisible,h=>{h?C():(l.value=1,c.value=null,k.value=[],i.value=null,v.value=[])}),se([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&C()}),(h,r)=>p.isVisible?(n(),d("div",lo,[e("div",no,[R(J,{name:"level",mode:"out-in"},{default:x(()=>{var M;return[l.value===1?(n(),d("div",io,[e("header",co,[e("h3",uo,[r[3]||(r[3]=X(" –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ä–æ–∫–∞–º",-1)),p.weekNumber?(n(),d("span",ko," ¬∑ –ù–µ–¥–µ–ª—è "+f(p.weekNumber),1)):F("",!0)]),e("button",{class:"modal__close",onClick:r[0]||(r[0]=w=>h.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",vo,[R(J,{name:"loading",mode:"out-in"},{default:x(()=>[m.value?(n(),d("div",mo,[...r[4]||(r[4]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...",-1)])])):y.value?(n(),d("ul",ho,[(n(!0),d(z,null,q(v.value,w=>(n(),d("li",{key:w.durationCategory,class:K(["duration-list__item",{"duration-list__item--clickable":w.count>0}]),style:ae({"--duration-color":w.color}),onClick:u=>b(w,u),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},[e("span",{class:"duration-list__color",style:ae({backgroundColor:w.color})},null,4),e("span",po,f(w.durationLabel),1),e("span",go,f(w.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),w.count>0?(n(),d("span",bo,"‚Üí")):F("",!0)],14,_o))),128))])):(n(),d("p",yo," –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),e("footer",fo,[e("button",{class:"btn",onClick:r[1]||(r[1]=w=>h.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value===2?(n(),d("div",wo,[e("header",To,[e("button",{class:"btn-back",onClick:G,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",Co," –¢–∏–∫–µ—Ç—ã: "+f(((M=c.value)==null?void 0:M.durationLabel)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:r[2]||(r[2]=w=>h.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",$o,[R(J,{name:"loading",mode:"out-in"},{default:x(()=>{var w;return[_.value?(n(),d("div",Wo,[...r[5]||(r[5]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):i.value?(n(),d("div",So,[r[6]||(r[6]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),r[7]||(r[7]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",Do,f(i.value),1),e("button",{class:"btn btn-retry",onClick:L},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):k.value.length===0?(n(),d("div",Eo,[r[8]||(r[8]=e("div",{class:"empty-state-icon"},"üìã",-1)),e("p",Io," –í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´"+f((w=c.value)==null?void 0:w.durationLabel)+"¬ª –Ω–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ ",1)])):(n(),d("div",Ao,[R(ke,{name:"ticket",tag:"div",class:"tickets-list"},{default:x(()=>[(n(!0),d(z,null,q(k.value,(u,g)=>(n(),ee(ve,{key:u.id,ticket:u,draggable:!1,style:ae({"--ticket-index":g}),onClick:O},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):F("",!0)]}),_:1})])])):F("",!0)}},Uo=te(Mo,[["__scopeId","data-v-c26f06c2"]]),Oo={class:"ac-dashboard"},Bo={key:"preloader",class:"chart-preloader"},Ro={class:"preloader-content"},No={class:"preloader-message"},Po={key:"content"},Lo={class:"period-selector-container"},Vo={key:1,class:"weeks-dashboard"},Fo={class:"dashboard-header"},Go={class:"header-content"},Yo={class:"breadcrumbs-row"},xo=["aria-label","aria-disabled","data-fallback","disabled"],zo={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},jo={class:"dashboard-layout"},qo={class:"filters-container"},Ho={class:"chart-container"},Zo={__name:"GraphAdmissionClosureDashboard",setup(p){const s=Ne(),t=I(!1),l=I(null),c=I(null),k=I({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),_=I(!1),m=I(!1),i=I(!1),v=I(!1),y=I(!1),C=P(()=>typeof window>"u"?!1:window.history.length>1),b=P(()=>C.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),S={name:"dashboard-sector-1c"};function G(D){var a;if((a=D==null?void 0:D.preventDefault)==null||a.call(D),!y.value){y.value=!0;try{if(C.value){s.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),s.push(S)}finally{y.value=!1}}}const O=I({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),L=I("weeks"),h=P(()=>{const D=O.value.customDateRange.startDate||O.value.customDateRange.endDate,a=O.value.employees.length===1&&O.value.employees.includes("all");return D||!a});async function r(){if(L.value!=="weeks")return;t.value=!0,l.value=null;const D=new Promise(a=>setTimeout(a,300));try{const a=H(),o=a.weekStartUtc,$=a.weekEndUtc,[E,U]=await Promise.all([D,re({product:"1C",periodMode:"weeks",weekStartUtc:o,weekEndUtc:$,includeTickets:!0})]),{meta:B,data:T}=U;c.value=B,k.value=T}catch(a){l.value=a instanceof Error?a:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureDashboard] loadData error:",a)}finally{t.value=!1}}function M(D){O.value.stages=D}function w(D){O.value.employees=D}function u(D){O.value.dateRange=D}function g(D){O.value.customDateRange=D}function W(D){L.value=D,r()}function A(){O.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},V()}function V(){r()}function j(D){if(["weeks","months"].includes(D)){L.value=D;try{localStorage.setItem("graph-admission-closure-period-mode",D)}catch(a){console.warn("[GraphAdmissionClosureDashboard] Failed to save mode to localStorage:",a)}}}function Y(){r()}me(()=>{try{const D=localStorage.getItem("graph-admission-closure-period-mode");(D==="weeks"||D==="months")&&(L.value=D)}catch(D){console.warn("[GraphAdmissionClosureDashboard] Failed to read from localStorage:",D)}try{const a=localStorage.getItem("graph-admission-closure-period-mode-info-shown");if(!a||a!=="true"){v.value=!0;return}}catch(D){console.warn("[GraphAdmissionClosureDashboard] Failed to read info modal flag from localStorage:",D),v.value=!0;return}r()});function H(){const D=new Date,a=new Date(Date.UTC(D.getUTCFullYear(),D.getUTCMonth(),D.getUTCDate())),o=a.getUTCDay(),$=a.getUTCDate()-o+(o===0?-6:1),E=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),$,0,0,0)),U=new Date(E);return U.setUTCDate(U.getUTCDate()+6),U.setUTCHours(23,59,59,999),{weekStartUtc:E.toISOString(),weekEndUtc:U.toISOString()}}return(D,a)=>{var $,E,U,B,T,Z,oe,ie,de;const o=Pe("router-link");return n(),d("div",Oo,[R(J,{name:"fade",mode:"out-in"},{default:x(()=>[t.value?(n(),d("div",Bo,[e("div",Ro,[a[8]||(a[8]=e("div",{class:"preloader-spinner"},[e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"})],-1)),a[9]||(a[9]=e("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞",-1)),e("p",No," –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ "+f(L.value==="weeks"?"4 –Ω–µ–¥–µ–ª–∏":"3 –º–µ—Å—è—Ü–∞")+"... ",1),a[10]||(a[10]=e("div",{class:"preloader-dots"},[e("span",{class:"dot"}),e("span",{class:"dot"}),e("span",{class:"dot"})],-1))])])):v.value?F("",!0):(n(),d("div",Po,[e("div",Lo,[R(tt,{modelValue:L.value,"onUpdate:modelValue":a[0]||(a[0]=Q=>L.value=Q),onChange:W},null,8,["modelValue"])]),L.value==="months"?(n(),ee(na,{key:0})):(n(),d("div",Vo,[e("div",Fo,[e("div",Go,[e("div",Yo,[e("button",{class:"btn-back-link",type:"button",onClick:G,"aria-label":b.value,"aria-disabled":!C.value,"data-fallback":!C.value,disabled:y.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,xo),e("nav",zo,[R(o,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:x(()=>[...a[11]||(a[11]=[X(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),a[13]||(a[13]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),R(o,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:x(()=>[...a[12]||(a[12]=[X(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),a[14]||(a[14]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),a[15]||(a[15]=e("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),a[16]||(a[16]=e("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),a[17]||(a[17]=e("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),e("div",jo,[e("div",qo,[R(Ve,{stages:O.value.stages,employees:O.value.employees,dateRange:O.value.dateRange,customDateRange:O.value.customDateRange,hasActiveFilters:h.value,hideStages:!0,weekPickerMode:!1,"onUpdate:stages":M,"onUpdate:employees":w,"onUpdate:dateRange":u,"onUpdate:customDateRange":g,onReset:A,onApply:V},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])]),e("div",Ho,[l.value?(n(),ee(Le,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:l.value.message},null,8,["message"])):(n(),ee(Vt,{key:1,meta:c.value,data:k.value,onOpenResponsible:a[1]||(a[1]=Q=>_.value=!0),onOpenStages:a[2]||(a[2]=Q=>m.value=!0),onOpenCarryover:a[3]||(a[3]=Q=>i.value=!0)},null,8,["meta","data"]))])])]))]))]),_:1}),R(Mr,{"is-visible":_.value,responsible:k.value.responsible||[],"closed-tickets-created-this-week":k.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":k.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":k.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":k.value.responsibleCreatedOtherWeek||[],"week-number":(($=c.value)==null?void 0:$.weekNumber)||null,"week-start-utc":((E=c.value)==null?void 0:E.weekStartUtc)||null,"week-end-utc":((U=c.value)==null?void 0:U.weekEndUtc)||null,onClose:a[4]||(a[4]=Q=>_.value=!1)},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),R(oo,{"is-visible":m.value,"week-number":((B=c.value)==null?void 0:B.weekNumber)||null,"week-start-utc":((T=c.value)==null?void 0:T.weekStartUtc)||null,"week-end-utc":((Z=c.value)==null?void 0:Z.weekEndUtc)||null,onClose:a[5]||(a[5]=Q=>m.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"]),R(Uo,{"is-visible":i.value,"week-number":((oe=c.value)==null?void 0:oe.weekNumber)||null,"week-start-utc":((ie=c.value)==null?void 0:ie.weekStartUtc)||null,"week-end-utc":((de=c.value)==null?void 0:de.weekEndUtc)||null,onClose:a[6]||(a[6]=Q=>i.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"]),R(nt,{"is-visible":v.value,"current-mode":L.value,onClose:a[7]||(a[7]=Q=>v.value=!1),onStartLoading:Y,onSelectMode:j},null,8,["is-visible","current-mode"])])}}},tl=te(Zo,[["__scopeId","data-v-d992aead"]]);export{tl as default};
