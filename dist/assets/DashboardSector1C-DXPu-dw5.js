var Ce=Object.defineProperty;var Ae=(t,e,r)=>e in t?Ce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var x=(t,e,r)=>Ae(t,typeof e!="symbol"?e+"":e,r);import{_ as N,c as h,a as u,b as k,t as _,n as F,o as y,d as D,w as H,s as ce,r as b,F as R,e as P,f as L,g as E,h as we,i as be,j as A,k as z,T as q,l as pe,m as he,p as le,v as Ne,q as Re,u as Oe,x as Le,y as Me,z as Be,A as de,B as Pe}from"./main-BvNsPnXX.js";const Fe={name:"TicketCard",props:{ticket:{type:Object,required:!0},draggable:{type:Boolean,default:!0}},emits:["click","drag-start","drag-end"],setup(t,{emit:e}){return{getPriorityLabel:i=>({high:"–í—ã—Å–æ–∫–∏–π",medium:"–°—Ä–µ–¥–Ω–∏–π",low:"–ù–∏–∑–∫–∏–π"})[i]||i,getStatusLabel:i=>({in_progress:"–í —Ä–∞–±–æ—Ç–µ",new:"–ù–æ–≤—ã–π",done:"–í—ã–ø–æ–ª–Ω–µ–Ω–æ",pending:"–û–∂–∏–¥–∞–Ω–∏–µ"})[i]||i,handleDragStart:i=>{i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("application/json",JSON.stringify(t.ticket)),i.dataTransfer.setDragImage(i.target,0,0),e("drag-start",t.ticket)},handleDragEnd:()=>{e("drag-end")}}}},xe=["draggable"],Ue={class:"ticket-header"},Ve={class:"ticket-id"},je={class:"ticket-title"},ze={class:"ticket-meta"},Ke={class:"ticket-status"},We={key:0,class:"ticket-description"};function Ye(t,e,r,n,s,o){return y(),h("div",{class:F(["ticket-card",{"priority-high":r.ticket.priority==="high","priority-medium":r.ticket.priority==="medium","priority-low":r.ticket.priority==="low"}]),draggable:r.draggable,onClick:e[0]||(e[0]=i=>t.$emit("click",r.ticket)),onDragstart:e[1]||(e[1]=(...i)=>n.handleDragStart&&n.handleDragStart(...i)),onDragend:e[2]||(e[2]=(...i)=>n.handleDragEnd&&n.handleDragEnd(...i))},[u("div",Ue,[e[3]||(e[3]=u("span",{class:"ticket-icon"},"üé´",-1)),u("span",Ve,"#"+_(r.ticket.id),1)]),u("div",je,_(r.ticket.title),1),u("div",ze,[u("span",{class:F(["ticket-priority",`priority-${r.ticket.priority}`])},_(n.getPriorityLabel(r.ticket.priority)),3),u("span",Ke,_(n.getStatusLabel(r.ticket.status)),1)]),r.ticket.description?(y(),h("div",We,_(r.ticket.description),1)):k("",!0)],42,xe)}const Te=N(Fe,[["render",Ye],["__scopeId","data-v-b255f359"]]),Ge={name:"ZeroPoint",components:{TicketCard:Te},props:{tickets:{type:Array,required:!0,default:()=>[]},stageId:{type:String,required:!0}},emits:{"ticket-dragged":t=>typeof t=="object"&&t!==null,"ticket-assigned":t=>typeof t=="object"&&t!==null,"ticket-clicked":t=>typeof t=="object"&&t!==null},setup(t,{emit:e}){return{hasTickets:D(()=>Array.isArray(t.tickets)&&t.tickets.length>0),handleTicketDragStart:s=>{e("ticket-dragged",s)}}}},He={class:"zero-point"},Xe={key:0,class:"empty-state"};function $e(t,e,r,n,s,o){const i=b("TicketCard");return y(),h("div",He,[e[3]||(e[3]=u("div",{class:"zero-point-header"},[u("h3",null,"–ù—É–ª–µ–≤–∞—è —Ç–æ—á–∫–∞")],-1)),H([r.tickets.length,r.tickets.map(a=>a.id).join(",")],()=>(y(),h("div",{class:"zero-point-tickets"},[(y(!0),h(R,null,P(r.tickets,a=>(y(),L(i,{key:a.id,ticket:a,draggable:!0,onDragStart:c=>n.handleTicketDragStart(a),onClick:c=>t.$emit("ticket-clicked",a)},null,8,["ticket","onDragStart","onClick"]))),128))])),e,0),e[1]||(ce(-1,!0),(e[1]=n.hasTickets?k("",!0):(y(),h("div",Xe,[...e[2]||(e[2]=[u("p",null,"–ù–µ—Ç –Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –≤ —Å—Ç–∞–¥–∏–∏",-1)])]))).cacheIndex=1,ce(1),e[1])])}const qe=N(Ge,[["render",$e],["__scopeId","data-v-c5370e55"]]);function Ze(t){return typeof t=="number"&&t>0&&!isNaN(t)}function ke(t){return typeof t=="number"&&t>0&&!isNaN(t)}function _e(t){return typeof t=="string"&&["formed","review","execution"].includes(t)}function Je(t){return!t||typeof t!="object"?!1:Ze(t.id)&&typeof t.title=="string"&&t.title.trim().length>0}function ve(t,e,r){return!(!Je(t)||!ke(e)||!_e(r)||t.assigneeId===e&&t.stageId===r)}function Qe(t){const e=[];return!t||typeof t!="object"?(e.push("–î–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{valid:!1,errors:e}):((!t.title||typeof t.title!="string"||t.title.trim().length===0)&&e.push("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"),t.stageId&&!_e(t.stageId)&&e.push("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Å—Ç–∞–¥–∏–∏"),t.employeeId&&!ke(t.employeeId)&&e.push("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"),{valid:e.length===0,errors:e})}const Z="dashboard-sector-1c-logger-level",U={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4};class M{static getLevel(){if(typeof localStorage<"u"){const e=localStorage.getItem(Z);if(e&&U[e]!==void 0)return e}return"ERROR"}static setLevel(e){return U[e]!==void 0?(typeof localStorage<"u"&&localStorage.setItem(Z,e),!0):!1}static isEnabled(e,r=null){const n=r||this.getLevel();if(n==="NONE")return!1;const s=U[e]||0,o=U[n]||0;return s<=o}static getLevels(){return{...U}}static reset(){typeof localStorage<"u"&&localStorage.removeItem(Z)}}let S=class{static getLevelColor(e){return{ERROR:"#dc3545",WARN:"#ffc107",INFO:"#17a2b8",DEBUG:"#6c757d"}[e]||"#6c757d"}static formatMessage(e,r,n=""){const s=new Date().toISOString(),o=this.getLevelColor(e),i=`%c[${s}] %c[${e}] %c[${n||"Unknown"}] %c${r}`,a=["color: #6c757d; font-weight: normal",`color: ${o}; font-weight: bold`,"color: #007bff; font-weight: normal","color: #212529; font-weight: normal"];return{formatted:i,styles:a}}static log(e,r,n="",s=null){if(!M.isEnabled(e))return;const o=this.formatMessage(e,r,n),i=[o.formatted,...o.styles];switch(s!=null&&i.push(s),e){case"ERROR":console.error(...i);break;case"WARN":console.warn(...i);break;case"INFO":console.info(...i);break;case"DEBUG":console.log(...i);break;default:console.log(...i)}}static error(e,r="",n=null){this.log("ERROR",e,r,n)}static warn(e,r="",n=null){this.log("WARN",e,r,n)}static info(e,r="",n=null){this.log("INFO",e,r,n)}static debug(e,r="",n=null){this.log("DEBUG",e,r,n)}};function Se(){const t=(o,i="info",a=5e3)=>{typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:o,autoHideDelay:a}):S.info(`[${i.toUpperCase()}] ${o}`,"useNotifications")};return{notify:t,success:(o,i=3e3)=>{t(o,"success",i)},error:(o,i=5e3)=>{t(o,"error",i)},info:(o,i=4e3)=>{t(o,"info",i)},warning:(o,i=4e3)=>{t(o,"warning",i)}}}function et(t){const e=Se(),r=E(!1);return{isDropZoneActive:r,handleDragStart:(c,g)=>{c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("application/json",JSON.stringify(g)),c.dataTransfer.setDragImage(c.target,0,0)},handleDragOver:c=>{c.preventDefault(),c.dataTransfer.dropEffect="move",r.value=!0},handleDragLeave:c=>{const g=c.currentTarget.getBoundingClientRect(),l=c.clientX,m=c.clientY;(l<g.left||l>g.right||m<g.top||m>g.bottom)&&(r.value=!1)},handleDrop:async(c,g,l)=>{c.preventDefault(),r.value=!1;const m=c.dataTransfer.getData("application/json");if(m)try{const d=JSON.parse(m);if(!ve(d,g,l)){e.warning("–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–∫–µ—Ç —Å—é–¥–∞");return}t&&typeof t=="function"&&await t(d,g,l)}catch(d){S.error("Error parsing ticket data","useDragAndDrop",d),e.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ç–∞")}},handleDragEnd:c=>{r.value=!1}}}function De(t=null){var g,l;const e=we(),r=((g=e==null?void 0:e.type)==null?void 0:g.name)||((l=e==null?void 0:e.type)==null?void 0:l.__name)||null,n=t||r||"Unknown",s=(m,d,f=null)=>{S.log(m,d,n,f)};return{error:(m,d=null)=>{s("ERROR",m,d)},warn:(m,d=null)=>{s("WARN",m,d)},info:(m,d=null)=>{s("INFO",m,d)},debug:(m,d=null)=>{s("DEBUG",m,d)},log:s,context:n}}const tt={name:"EmployeeColumn",components:{TicketCard:Te},props:{employee:{type:Object,required:!0},stageId:{type:String,required:!0}},emits:["ticket-clicked","ticket-dropped"],setup(t,{emit:e}){De("EmployeeColumn");const n=et(async(l,m,d)=>{e("ticket-dropped",l,m)}),s=D(()=>t.employee.isFromSector1C?Array.isArray(t.employee.tickets)?t.employee.tickets:[]:Array.isArray(t.employee.ticketsInsideSector)?t.employee.ticketsInsideSector:[]),o=D(()=>t.employee.isFromSector1C?[]:Array.isArray(t.employee.ticketsOutsideSector)?t.employee.ticketsOutsideSector:Array.isArray(t.employee.tickets)?t.employee.tickets:[]),i=D(()=>t.employee.isFromSector1C?Array.isArray(t.employee.tickets)?t.employee.tickets:[]:[]),a=D(()=>s.value.length+o.value.length),c=l=>{n.handleDrop(l,t.employee.id,t.stageId)},g=l=>{};return{isDropZoneActive:n.isDropZoneActive,handleDragOver:n.handleDragOver,handleDragLeave:n.handleDragLeave,handleDrop:c,ticketsInsideSector:s,ticketsOutsideSector:o,ticketsToDisplay:i,totalTicketsCount:a,handleTicketDragStart:g}}},nt={class:"employee-header"},rt={class:"employee-info"},it={class:"employee-details"},st={class:"employee-name"},ot={key:0,class:"employee-position"},at={class:"tickets-count"},ct={class:"tickets-list"},lt={class:"section-header"},dt={class:"section-count"},ut={key:2,class:"empty-state"};function gt(t,e,r,n,s,o){const i=b("TicketCard");return y(),h("div",{class:F(["employee-column",{"drop-zone-active":n.isDropZoneActive}]),onDragover:e[3]||(e[3]=be((...a)=>n.handleDragOver&&n.handleDragOver(...a),["prevent"])),onDragleave:e[4]||(e[4]=(...a)=>n.handleDragLeave&&n.handleDragLeave(...a)),onDrop:e[5]||(e[5]=(...a)=>n.handleDrop&&n.handleDrop(...a))},[u("div",nt,[u("div",rt,[e[6]||(e[6]=u("span",{class:"employee-icon"},"üë§",-1)),u("div",it,[u("div",st,_(r.employee.name),1),r.employee.position?(y(),h("div",ot,_(r.employee.position),1)):k("",!0)])]),u("div",at," üìä –¢–∏–∫–µ—Ç–æ–≤: "+_(n.totalTicketsCount),1)]),u("div",ct,[r.employee.isFromSector1C?H([n.ticketsToDisplay.length,n.ticketsToDisplay.map(a=>a.id).join(",")],()=>(y(),h("div",{key:0},[A(q,{name:"ticket",tag:"div"},{default:z(()=>[(y(!0),h(R,null,P(n.ticketsToDisplay,a=>(y(),L(i,{key:a.id,ticket:a,draggable:!0,onClick:c=>t.$emit("ticket-clicked",a),onDragStart:n.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),e,0):(y(),h(R,{key:1},[n.ticketsInsideSector.length>0?H([n.ticketsInsideSector.length,n.ticketsInsideSector.map(a=>a.id).join(",")],()=>(y(),h("div",{key:0,class:"tickets-section tickets-inside-sector"},[A(q,{name:"ticket",tag:"div"},{default:z(()=>[(y(!0),h(R,null,P(n.ticketsInsideSector,a=>(y(),L(i,{key:a.id,ticket:a,draggable:!0,onClick:c=>t.$emit("ticket-clicked",a),onDragStart:n.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),e,1):k("",!0),n.ticketsOutsideSector.length>0?H([n.ticketsOutsideSector.length,n.ticketsOutsideSector.map(a=>a.id).join(",")],()=>(y(),h("div",{key:1,class:"tickets-section tickets-outside-sector"},[u("div",lt,[e[7]||(e[7]=u("span",{class:"section-badge"},"–í–Ω–µ —Å–µ–∫—Ç–æ—Ä–∞",-1)),u("span",dt,_(n.ticketsOutsideSector.length),1)]),A(q,{name:"ticket",tag:"div"},{default:z(()=>[(y(!0),h(R,null,P(n.ticketsOutsideSector,a=>(y(),L(i,{key:a.id,ticket:a,draggable:!0,class:"ticket-outside-sector",onClick:c=>t.$emit("ticket-clicked",a),onDragStart:n.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),e,2):k("",!0)],64)),n.totalTicketsCount===0?(y(),h("div",ut,[...e[8]||(e[8]=[u("p",null,"–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤",-1)])])):k("",!0)])],34)}const ft=N(tt,[["render",gt],["__scopeId","data-v-cdec5b5c"]]),yt={name:"DashboardStage",components:{ZeroPoint:qe,EmployeeColumn:ft},props:{stage:{type:Object,required:!0},zeroPointTickets:{type:Array,default:()=>[]}},emits:["ticket-moved","ticket-assigned","ticket-clicked"],setup(t,{emit:e}){const r=De("DashboardStage"),n=E(!1),s=D(()=>{const d=Array.isArray(t.zeroPointTickets)?t.zeroPointTickets.length:0,f=Array.isArray(t.stage.employees)?t.stage.employees.reduce((T,p)=>Array.isArray(p.ticketsInsideSector)?T+p.ticketsInsideSector.length:p.isFromSector1C&&Array.isArray(p.tickets)?T+p.tickets.length:T,0):0;return d+f}),o=D(()=>Array.isArray(t.stage.employees)?t.stage.employees.reduce((d,f)=>Array.isArray(f.ticketsOutsideSector)?d+f.ticketsOutsideSector.length:!f.isFromSector1C&&Array.isArray(f.tickets)?d+f.tickets.length:d,0):0),i=D(()=>s.value+o.value),a=D(()=>{var p;const d=((p=t.stage)==null?void 0:p.name)||"–°—Ç–∞–¥–∏—è",f=s.value,T=o.value;return T===0?`${d} (${f})`:`${d} (${f} / ${T})`});return{isDragging:n,ticketsCountInsideSector:s,ticketsCountOutsideSector:o,totalTicketsCount:i,stageNameWithCount:a,handleTicketDragged:d=>{n.value=!0},handleTicketAssigned:(d,f)=>{e("ticket-assigned",d,f)},handleTicketDropped:(d,f)=>{e("ticket-moved",d,f,t.stage.id),n.value=!1},handleTicketClicked:d=>{r.debug("Ticket clicked",d),e("ticket-clicked",d)}}}},mt={class:"stage-header"},pt={class:"stage-content"},ht={class:"employees-container"};function Tt(t,e,r,n,s,o){const i=b("ZeroPoint"),a=b("EmployeeColumn");return y(),h("div",{class:"dashboard-stage",style:pe({borderLeftColor:r.stage.color})},[u("div",mt,[u("h2",null,_(n.stageNameWithCount),1)]),u("div",pt,[A(i,{tickets:r.zeroPointTickets,"stage-id":r.stage.id,onTicketDragged:n.handleTicketDragged,onTicketAssigned:n.handleTicketAssigned,onTicketClicked:n.handleTicketClicked},null,8,["tickets","stage-id","onTicketDragged","onTicketAssigned","onTicketClicked"]),u("div",ht,[(y(!0),h(R,null,P(r.stage.employees,c=>(y(),L(a,{key:c.id,employee:c,"stage-id":r.stage.id,onTicketClicked:n.handleTicketClicked,onTicketDropped:n.handleTicketDropped},null,8,["employee","stage-id","onTicketClicked","onTicketDropped"]))),128))])])],4)}const kt=N(yt,[["render",Tt],["__scopeId","data-v-c6fbde76"]]),J={cache_check:{title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞",description:"–ü–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."},cache_hit:{title:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",description:"–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞..."},loading_tickets:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24..."},filtering:{title:"–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤",description:"–û—Ç–±–æ—Ä —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°..."},extracting_employees:{title:"–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ê–Ω–∞–ª–∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."},loading_employees:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö..."},grouping:{title:"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",description:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º..."},caching:{title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à",description:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."},complete:{title:"–ì–æ—Ç–æ–≤–æ!",description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"},error:{title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}},_t={loading_tickets:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24..."},filtering:{title:"–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤",description:"–û—Ç–±–æ—Ä —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°..."},extracting_employees:{title:"–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ê–Ω–∞–ª–∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."},loading_employees:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö..."},grouping:{title:"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",description:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º..."},caching:{title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à",description:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."},cache_check:{title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞",description:"–ü–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."},cache_hit:{title:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",description:"–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞..."},complete:{title:"–ì–æ—Ç–æ–≤–æ!",description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"},error:{title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}},vt={name:"LoadingPreloader",props:{currentStep:{type:String,default:null},progress:{type:Number,default:0},stepDetails:{type:Object,default:()=>({})},error:{type:String,default:null}},emits:["retry"],setup(t,{emit:e}){const r=D(()=>{var m;const{currentStep:g,stepDetails:l}=t;return l!=null&&l.description?{title:g?((m=J[g])==null?void 0:m.title)||g:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:l.description}:g?J[g]?J[g]:_t[g]||{title:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ..."}:{title:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è..."}}),n=D(()=>r.value.title),s=D(()=>r.value.description),o=D(()=>t.stepDetails),i=D(()=>{const g=t.progress;return g==null||isNaN(g)?0:Math.round(Math.max(0,Math.min(100,g)))});return{stepTitle:n,stepDescription:s,details:o,displayProgress:i,getStageDisplayName:g=>g?{"DT140_12:UC_0VHWE2":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","DT140_12:PREPARATION":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó","DT140_12:CLIENT":"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ","–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"}[g]||g:"",handleRetry:()=>{e("retry")}}}},St={class:"preloader-backdrop"},Dt={class:"preloader-container"},Et={class:"preloader-content-scrollable"},It={key:0,class:"spinner-container"},Ct={class:"preloader-content"},At={class:"step-title"},wt={key:0,class:"step-description"},bt={key:1,class:"progress-container"},Nt={class:"progress-bar"},Rt={class:"progress-text"},Ot={key:2,class:"step-details"},Lt={key:0,class:"detail-description"},Mt={key:1,class:"detail-item"},Bt={class:"detail-value"},Pt={key:0,class:"detail-total"},Ft={key:2,class:"detail-item"},xt={class:"detail-value"},Ut={key:0,class:"detail-total"},Vt={key:3,class:"detail-item"},jt={class:"detail-value"},zt={key:0,class:"detail-total"},Kt={key:4,class:"detail-item"},Wt={class:"detail-value"},Yt={key:5,class:"detail-warning"},Gt={key:0,class:"error-container"},Ht={class:"error-content"},Xt={class:"error-message"};function $t(t,e,r,n,s,o){return y(),h("div",{class:F(["loading-preloader",{"has-error":r.error}])},[u("div",St,[u("div",Dt,[u("div",Et,[r.error?k("",!0):(y(),h("div",It,[...e[1]||(e[1]=[u("div",{class:"spinner"},null,-1)])])),u("div",Ct,[u("h3",At,_(n.stepTitle),1),n.stepDescription?(y(),h("p",wt,_(n.stepDescription),1)):k("",!0),r.error?k("",!0):(y(),h("div",bt,[u("div",Nt,[u("div",{class:"progress-fill",style:pe({width:n.displayProgress+"%"})},null,4)]),u("span",Rt,_(n.displayProgress)+"%",1)])),r.error?k("",!0):(y(),h("div",Ot,[n.details.description?(y(),h("div",Lt,_(n.details.description),1)):k("",!0),n.details.count!==void 0?(y(),h("div",Mt,[e[2]||(e[2]=u("span",{class:"detail-label"},"–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–∏–∫–µ—Ç–æ–≤:",-1)),u("span",Bt,_(n.details.count),1),n.details.total!==void 0?(y(),h("span",Pt," –∏–∑ "+_(n.details.total),1)):k("",!0)])):k("",!0),n.details.filteredTickets!==void 0?(y(),h("div",Ft,[e[3]||(e[3]=u("span",{class:"detail-label"},"–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∏–∫–µ—Ç–æ–≤:",-1)),u("span",xt,_(n.details.filteredTickets),1),n.details.totalTickets!==void 0?(y(),h("span",Ut," –∏–∑ "+_(n.details.totalTickets),1)):k("",!0)])):k("",!0),n.details.stage?(y(),h("div",Vt,[e[4]||(e[4]=u("span",{class:"detail-label"},"–°—Ç–∞–¥–∏—è:",-1)),u("span",jt,_(n.getStageDisplayName(n.details.stage)),1),n.details.stageIndex&&n.details.totalStages?(y(),h("span",zt," ("+_(n.details.stageIndex)+"/"+_(n.details.totalStages)+") ",1)):k("",!0)])):k("",!0),n.details.employeeCount!==void 0?(y(),h("div",Kt,[e[5]||(e[5]=u("span",{class:"detail-label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",-1)),u("span",Wt,_(n.details.employeeCount),1)])):k("",!0),n.details.warning?(y(),h("div",Yt,[u("span",null,"‚ö†Ô∏è "+_(n.details.warning),1)])):k("",!0)]))])])])]),r.error?(y(),h("div",Gt,[u("div",Ht,[e[6]||(e[6]=u("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),u("p",Xt,_(r.error),1),u("button",{onClick:e[0]||(e[0]=(...i)=>n.handleRetry&&n.handleRetry(...i)),class:"retry-button"}," –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É ")])])):k("",!0)],2)}const qt=N(vt,[["render",$t],["__scopeId","data-v-d129ff19"]]),Zt={name:"LoggerControl",props:{showControl:{type:Boolean,default:!1}},setup(){const t=E(!1),e=E("ERROR"),r=E(!0),n=c=>({NONE:"–û—Ç–∫–ª—é—á–µ–Ω–æ",ERROR:"–¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏",WARN:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏",INFO:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏",DEBUG:"–í—Å–µ –ª–æ–≥–∏ (–æ—Ç–ª–∞–¥–∫–∞)"})[c]||c;return he(()=>{const c=M.getLevel();e.value=c,t.value=c!=="NONE"}),{enabled:t,level:e,isExpanded:r,getLevelDescription:n,handleToggle:()=>{t.value?(e.value==="NONE"&&(e.value="ERROR"),M.setLevel(e.value)):(M.setLevel("NONE"),e.value="NONE")},handleLevelChange:()=>{t.value&&M.setLevel(e.value)},resetToDefault:()=>{const c="ERROR";e.value=c,t.value=!0,M.setLevel(c)},toggleVisibility:()=>{r.value=!r.value}}}},Jt={key:0,class:"logger-control"},Qt={class:"logger-control-header"},en=["aria-label"],tn={key:0,class:"logger-control-content"},nn={class:"logger-control-section"},rn={class:"logger-control-label"},sn={key:0,class:"logger-control-section"},on={class:"logger-control-label"},an={key:1,class:"logger-control-info"},cn={class:"logger-control-info-text"},ln={key:2,class:"logger-control-section"};function dn(t,e,r,n,s,o){return r.showControl?(y(),h("div",Jt,[u("div",Qt,[e[6]||(e[6]=u("h3",{class:"logger-control-title"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º",-1)),u("button",{class:"logger-control-toggle",onClick:e[0]||(e[0]=(...i)=>n.toggleVisibility&&n.toggleVisibility(...i)),"aria-label":n.isExpanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"},_(n.isExpanded?"‚ñº":"‚ñ∂"),9,en)]),n.isExpanded?(y(),h("div",tn,[u("div",nn,[u("label",rn,[le(u("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=i=>n.enabled=i),onChange:e[2]||(e[2]=(...i)=>n.handleToggle&&n.handleToggle(...i)),class:"logger-control-checkbox"},null,544),[[Ne,n.enabled]]),e[7]||(e[7]=u("span",{class:"logger-control-label-text"},"–í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ",-1))])]),n.enabled?(y(),h("div",sn,[u("label",on,[e[9]||(e[9]=u("span",{class:"logger-control-label-text"},"–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:",-1)),le(u("select",{"onUpdate:modelValue":e[3]||(e[3]=i=>n.level=i),onChange:e[4]||(e[4]=(...i)=>n.handleLevelChange&&n.handleLevelChange(...i)),class:"logger-control-select"},[...e[8]||(e[8]=[Oe('<option value="NONE" data-v-bc546e6e>–û—Ç–∫–ª—é—á–µ–Ω–æ</option><option value="ERROR" data-v-bc546e6e>–¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏</option><option value="WARN" data-v-bc546e6e>–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏</option><option value="INFO" data-v-bc546e6e>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏</option><option value="DEBUG" data-v-bc546e6e>–í—Å–µ –ª–æ–≥–∏ (–æ—Ç–ª–∞–¥–∫–∞)</option>',5)])],544),[[Re,n.level]])])])):k("",!0),n.enabled?(y(),h("div",an,[u("span",cn,[e[10]||(e[10]=Le(" –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: ",-1)),u("strong",null,_(n.getLevelDescription(n.level)),1)])])):k("",!0),n.enabled?(y(),h("div",ln,[u("button",{onClick:e[5]||(e[5]=(...i)=>n.resetToDefault&&n.resetToDefault(...i)),class:"logger-control-reset-btn",title:"–°–±—Ä–æ—Å–∏—Ç—å –∫ –∑–Ω–∞—á–µ–Ω–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"}," –°–±—Ä–æ—Å–∏—Ç—å –∫ —É–º–æ–ª—á–∞–Ω–∏—é ")])):k("",!0)])):k("",!0)])):k("",!0)}const un=N(Zt,[["render",dn],["__scopeId","data-v-bc546e6e"]]);function gn(){const t=Me(),e=Be();return{goBack:(i="/")=>{window.history.length>1?t.back():t.push(i)},goTo:(i,a={})=>{t.push({path:i,...a})},goHome:(i={})=>{t.push({path:"/",...i})},isCurrentRoute:i=>e.path===i,router:t,route:e}}const fn={name:"BackButton",props:{variant:{type:String,default:"header",validator:t=>["header","floating"].includes(t)},text:{type:String,default:"–ù–ê–ó–ê–î"},to:{type:String,default:null},showIcon:{type:Boolean,default:!0},ariaLabel:{type:String,default:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"},title:{type:String,default:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"}},setup(t){const{goBack:e,goHome:r}=gn();return{buttonClasses:D(()=>[t.variant==="header"?"back-button":"floating-back-button"]),handleClick:()=>{t.to?r({path:t.to}):e()}}}},yn=["aria-label","title"],mn={key:0,class:"back-button-icon"},pn={key:1,class:"back-button-text"};function hn(t,e,r,n,s,o){return y(),h("button",{class:F(n.buttonClasses),onClick:e[0]||(e[0]=(...i)=>n.handleClick&&n.handleClick(...i)),"aria-label":r.ariaLabel,title:r.title},[r.showIcon?(y(),h("span",mn,"‚Üê")):k("",!0),r.variant==="header"?(y(),h("span",pn,_(r.text),1)):k("",!0)],10,yn)}const Tn=N(fn,[["render",hn],["__scopeId","data-v-c4a15d94"]]);function kn(){const t=E(!1),e=E(null),r=E([{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:[]},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:[]},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:[]}]),n=E({formed:[],review:[],execution:[]}),s=E([]),o=E(null);return{isLoading:t,error:e,stages:r,zeroPointTickets:n,employees:s,draggedTicket:o,updateState:l=>{l.stages&&(r.value=l.stages),l.employees&&(s.value=l.employees),l.zeroPointTickets&&(n.value=l.zeroPointTickets)},resetState:()=>{t.value=!1,e.value=null,r.value=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:[]},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:[]},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:[]}],n.value={formed:[],review:[],execution:[]},s.value=[],o.value=null},updateLocalStateAfterMove:(l,m,d)=>{const f=r.value.find(p=>p.employees.some(I=>I.tickets.some($=>$.id===l.id)));if(f){const p=f.employees.find(I=>I.tickets.some($=>$.id===l.id));p&&(p.tickets=p.tickets.filter(I=>I.id!==l.id))}const T=r.value.find(p=>p.id===d);if(T){const p=T.employees.find(I=>I.id===m);if(p){const I={...l,assigneeId:m,stageId:d};p.tickets.push(I)}}Object.keys(n.value).forEach(p=>{n.value[p]=n.value[p].filter(I=>I.id!==l.id)})},getEmployeeTickets:(l,m)=>{const d=r.value.find(T=>T.id===m);if(!d)return[];const f=d.employees.find(T=>T.id===l);return f?f.tickets||[]:[]}}}class _n{static getApiUrl(){const e=window.location.pathname;return e.substring(0,e.lastIndexOf("/"))+"/api/bitrix24.php"}static async call(e,r={}){try{const n=await fetch(this.getApiUrl(),{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({method:e,params:r})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();if(s.error)throw new Error(s.error_description||s.error);return s}catch(n){throw console.error("Bitrix24 API error:",n),n}}static async getProfile(){return this.call("profile",{})}static async getLeads(e={},r=["ID","NAME","EMAIL","PHONE"],n={ID:"DESC"}){return(await this.call("crm.lead.list",{filter:e,select:r,order:n})).result||[]}}class B{static async call(e,r={}){return await _n.call(e,r)}}class v{static get(e){const r=this.cache.get(e);return r?Date.now()-r.timestamp>r.ttl?(this.cache.delete(e),null):r.data:null}static set(e,r,n=this.DEFAULT_TTL){this.cache.set(e,{data:r,timestamp:Date.now(),ttl:n})}static delete(e){this.cache.delete(e)}static clear(){this.cache.clear()}static invalidateByPrefix(e){const r=[];for(const n of this.cache.keys())n.startsWith(e)&&r.push(n);r.forEach(n=>this.cache.delete(n))}static cleanExpired(){const e=Date.now(),r=[];for(const[n,s]of this.cache.entries())e-s.timestamp>s.ttl&&r.push(n);r.forEach(n=>this.cache.delete(n))}static getStats(){const e=Date.now();let r=0,n=0;for(const s of this.cache.values())e-s.timestamp>s.ttl?r++:n++;return{total:this.cache.size,valid:n,expired:r}}static getTicketsCacheKey(e){return`tickets:stage:${e}`}static getAllTicketsCacheKey(){return"tickets:all"}static getEmployeesCacheKey(e){return`employees:ids:${[...e].sort((n,s)=>n-s).join(",")}`}static getSectorDataCacheKey(){return"sector:data"}static invalidateTicketsCache(){this.invalidateByPrefix("tickets:"),this.invalidateByPrefix("sector:")}static invalidateEmployeesCache(){this.invalidateByPrefix("employees:")}}x(v,"cache",new Map),x(v,"DEFAULT_TTL",5*60*1e3),x(v,"EMPLOYEES_TTL",30*60*1e3),x(v,"TICKETS_TTL",5*60*1e3);typeof window<"u"&&setInterval(()=>{v.cleanExpired()},5*60*1e3);function C(t,e,r={}){if(!t||typeof t!="string")throw new Error("Step must be a non-empty string");const n=typeof e=="number"&&!isNaN(e)?Math.max(0,Math.min(100,e)):0;let s=r.description;return s||(s=vn(t,r)),{step:t,progress:n,details:{...r,description:s}}}function vn(t,e){return t==="loading_tickets"&&e.stageName&&e.stageIndex!==void 0?`–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏ "${e.stageName}" (${e.stageIndex}/${e.totalStages||1})...`:t==="filtering"&&e.filteredTickets!==void 0&&e.totalTickets!==void 0?`–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤: ${e.filteredTickets} –∏–∑ ${e.totalTickets}...`:t==="grouping"&&e.employeeCount!==void 0?`–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ ${e.employeeCount} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º...`:e.count!==void 0&&e.total!==void 0?`–û–±—Ä–∞–±–æ—Ç–∫–∞: ${e.count} –∏–∑ ${e.total}...`:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."}function X(t){if(!t||typeof t!="object")throw new Error("Progress info must be an object");const e=t.step||null;if(!e)throw new Error("Step is required in progress info");const r=t.progress!==void 0&&t.progress!==null?t.progress:t.percent!==void 0&&t.percent!==null?t.percent:void 0,n=t.details||{};return t.stage&&(n.stage=t.stage),t.stageName&&(n.stageName=t.stageName),t.stageIndex!==void 0&&(n.stageIndex=t.stageIndex),t.totalStages!==void 0&&(n.totalStages=t.totalStages),t.count!==void 0&&(n.count=t.count),t.total!==void 0&&(n.total=t.total),t.warning&&(n.warning=t.warning),{step:e,progress:r!=null?Math.max(0,Math.min(100,r)):void 0,details:n}}function Ee(t,e,r){const n=typeof t=="number"&&!isNaN(t)?Math.max(0,Math.min(100,t)):0,s=typeof e=="number"&&!isNaN(e)?Math.max(0,Math.min(100,e)):0,o=typeof r=="number"&&!isNaN(r)?Math.max(0,Math.min(100,r)):0,i=n+s*o/100;return Math.max(0,Math.min(100,i))}const W=140;class V{static async getAllTickets(e,r=null){const n=[],s=e.length;try{for(let o=0;o<e.length;o++){const i=e[o],a=this.getStageName(i);if(r){const c=o/s*100;r(C("loading_tickets",c,{stage:i,stageName:a,stageIndex:o+1,totalStages:s}))}try{const c=await this.getTicketsByStage(i,!0,r?g=>{const l=Ee(o/s*100,1/s*100,g.percent||0);r(C("loading_tickets",l,{stage:i,stageName:a,stageIndex:o+1,totalStages:s,count:g.count,total:g.total}))}:null);n.push(...c)}catch(c){S.error(`Error loading tickets for stage ${i}`,"TicketRepository",c);let g=`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–∏ "${a}"`;throw c.message&&(c.message.includes("HTTP error")||c.message.includes("network")?g=`–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞–¥–∏–∏ "${a}". –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.`:c.message.includes("timeout")?g=`–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞–¥–∏–∏ "${a}". –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.`:c.message.includes("403")||c.message.includes("401")?g=`–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞–¥–∏–∏ "${a}". –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.`:g=`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–∏ "${a}": ${c.message}`),new Error(g)}}}catch(o){throw S.error("Error in getAllTickets","TicketRepository",o),o}return n}static getStageName(e){return{"DT140_12:UC_0VHWE2":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","DT140_12:PREPARATION":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó","DT140_12:CLIENT":"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"}[e]||e}static async getTicketsByStage(e,r=!0,n=null){if(r){const l=v.getTicketsCacheKey(e),m=v.get(l);if(m!==null)return n&&n(X({step:"loading_tickets",percent:100,count:m.length,total:m.length})),m}const s=[];let o=0;const i=50;let a=!0,c=0,g=null;for(;a;)try{const l=await B.call("crm.item.list",{entityTypeId:W,filter:{stageId:e},select:["*"],order:{id:"DESC"},start:o,useOriginalUfNames:"Y"});let m=[];if(l&&l.result&&(Array.isArray(l.result)?m=l.result:l.result.items&&Array.isArray(l.result.items)?m=l.result.items:l.result.data&&Array.isArray(l.result.data)&&(m=l.result.data)),m.length>0){if(s.push(...m),o+=m.length,a=m.length===i,a?c=o+i:c=s.length,n){const d=c>0?Math.min(100,s.length/c*100):0;n(X({step:"loading_tickets",percent:d,count:s.length,total:c}))}g=null}else a=!1}catch(l){if(S.error(`Error loading tickets batch for stage ${e} (start: ${o})`,"TicketRepository",l),o===0)throw g=l,new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∏–∫–µ—Ç—ã –¥–ª—è —Å—Ç–∞–¥–∏–∏ ${e}: ${l.message||l}`);a=!1,n&&s.length>0&&n(C("loading_tickets",100,{count:s.length,total:s.length,warning:`–ó–∞–≥—Ä—É–∂–µ–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ: ${s.length} —Ç–∏–∫–µ—Ç–æ–≤. –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.`}))}if(g&&s.length===0)throw g;if(r){const l=v.getTicketsCacheKey(e);v.set(l,s,v.TICKETS_TTL)}return s}static async getTicket(e){return(await B.call("crm.item.get",{entityTypeId:W,id:e})).result||null}static async updateTicket(e,r){const s=(await B.call("crm.item.update",{entityTypeId:W,id:e,fields:r})).result===!0;return s&&v.invalidateTicketsCache(),s}static async createTicket(e){const r=await B.call("crm.item.add",{entityTypeId:W,fields:e}),n=r.result?parseInt(r.result):0;return n>0&&v.invalidateTicketsCache(),n}static async assignTicket(e,r,n){return await this.updateTicket(e,{assignedById:r,stageId:n})}}class Sn{static async getEmployeesByIds(e,r=!0){if(!Array.isArray(e)||e.length===0)return[];if(r){const n=v.getEmployeesCacheKey(e),s=v.get(n);if(s!==null)return S.debug(`Cache hit for employees: ${e.length} employees`,"EmployeeRepository"),s}try{const n=await B.call("user.get",{filter:{ID:e},select:["ID","NAME","LAST_NAME","EMAIL","WORK_POSITION","UF_DEPARTMENT"]});let s=[];if(n&&n.result&&(Array.isArray(n.result)?s=n.result:S.warn("Unexpected user.get result format","EmployeeRepository",n)),r){const o=v.getEmployeesCacheKey(e);v.set(o,s,v.EMPLOYEES_TTL)}return s}catch(n){return S.error("Error getting employees by IDs","EmployeeRepository",n),[]}}}const O={SECTOR_1C:366,SECTOR_HARDWARE:368,SECTOR_BITRIX24:369,SECTOR_PDM:367},Dn=[O.SECTOR_1C,O.SECTOR_HARDWARE,O.SECTOR_BITRIX24,O.SECTOR_PDM];function En(t){return Dn.includes(t)}const In=140,Q={FORMED:{bitrixId:"DT140_12:UC_0VHWE2"},REVIEW:{bitrixId:"DT140_12:PREPARATION"},EXECUTION:{bitrixId:"DT140_12:CLIENT"}},Cn={"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"},An={formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"},wn={3:"high",2:"medium",1:"low"};function bn(){return[Q.FORMED.bitrixId,Q.REVIEW.bitrixId,Q.EXECUTION.bitrixId]}function re(t){return Cn[t]||"formed"}function ue(t){return An[t]||"DT140_12:UC_0VHWE2"}function Nn(){return bn()}function ie(t){const e=parseInt(t.id||t.ID||0),r=t.title||t.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",n=t.stageId||t.STAGE_ID||"",s=t.assignedById||t.ASSIGNED_BY_ID||null,o=t.createdTime||t.CREATED_DATE||t.CREATED_TIME||"",i=t.updatedTime||t.MODIFY_DATE||t.UPDATED_TIME||"";return{id:e,title:r,priority:Rn(t.priority||t.PRIORITY),status:On(),assigneeId:s?parseInt(s):null,stageId:re(n),createdAt:o,modifiedAt:i,amount:t.opportunity||t.OPPORTUNITY||0,currency:t.currencyId||t.CURRENCY_ID||"RUB",description:t.comments||t.COMMENTS||""}}function Rn(t){return wn[t]||"medium"}function On(t){return"in_progress"}const j=new Map;function Ln(){j.clear()}function Mn(t){if(!t)return[];if(Array.isArray(t))return t.filter(r=>typeof r=="number"||!isNaN(parseInt(r))).map(r=>typeof r=="number"?r:parseInt(r));if(typeof t=="number")return[t];const e=parseInt(t);return isNaN(e)?[]:[e]}function Bn(t,e=!0){const r=t.id||t.ID;if(!t||!r)return null;if(e&&j.has(r))return j.get(r);const n=t.UF_DEPARTMENT||t.departmentId,s=Mn(n);for(const o of s)if(En(o)){const a=o;return e&&j.set(r,a),a}return e&&j.set(r,null),null}function Pn(t){const e=Bn(t);return{id:parseInt(t.ID||t.id||0),name:`${t.NAME||t.name||""} ${t.LAST_NAME||t.lastName||""}`.trim()||t.EMAIL||t.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:t.WORK_POSITION||t.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:t.EMAIL||t.email||"",sectorId:e,departmentId:t.UF_DEPARTMENT||null,tickets:[]}}function Fn(t){return Array.isArray(t)?t.map(e=>Pn(e)):[]}const Y="1C",K=new Map,ge=100;function xn(t){return t.UF_CRM_7_TYPE_PRODUCT||t.uf_crm_7_type_product||t.ufCrm7TypeProduct||t.UF_CRM_7_TYPE_PRODUCT||t.uf_crm_7_type_product||null}function Un(t){const e=xn(t);return e?Array.isArray(e)?e.includes(Y):typeof e=="object"&&e!==null&&e.value===Y||e===Y:!1}function Vn(t){return`filter:${t.map(r=>r.id||r.ID||"").sort().join(",")}`}function jn(){K.size>ge&&Array.from(K.keys()).slice(0,Math.floor(ge*.2)).forEach(e=>K.delete(e))}function zn(t){if(!Array.isArray(t))return[];const e=Vn(t),r=K.get(e);if(r!==void 0)return r;const n=t.filter(Un);return K.set(e,n),jn(),n}const ne=1051;function se(t){if(!t||typeof t!="object")return null;let e=t.assignedById||t.ASSIGNED_BY_ID||t.assignedByIdId||t.assignedById;return e&&typeof e=="object"&&(e=e.id||e.ID||e.value||null),e||null}function oe(t){if(t==null)return null;typeof t=="object"&&(t=t.id||t.ID||t.value||null);const e=typeof t=="number"?t:parseInt(t);return isNaN(e)||e<=0?null:e}function Kn(t,e=ne){const r=se(t),n=oe(r);return n===null||n===e}function Wn(t,e){Array.isArray(t)||(S.warn("Tickets is not an array","TicketGrouper",t),t=[]),Array.isArray(e)||(S.warn("Employees is not an array","TicketGrouper",e),e=[]);const r=e.filter(i=>(i.id?parseInt(i.id):null)!==ne),n=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:r.map(i=>({...i,isFromSector1C:i.sectorId===O.SECTOR_1C,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:r.map(i=>({...i,isFromSector1C:i.sectorId===O.SECTOR_1C,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:r.map(i=>({...i,isFromSector1C:i.sectorId===O.SECTOR_1C,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]}))}],s=new Map(n.map(i=>[i.id,i])),o=new Map;return n.forEach(i=>{const a=new Map(i.employees.map(c=>[c.id,c]));o.set(i.id,a)}),t.forEach(i=>{const a=re(i.stageId||i.STAGE_ID||""),c=s.get(a);if(c){const g=se(i),l=oe(g);if(l===ne)return;if(l){const m=o.get(a);let d=m.get(l);d||(d={id:l,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${l}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",sectorId:null,departmentId:null,isFromSector1C:!1,tickets:[],ticketsInsideSector:[],ticketsOutsideSector:[]},c.employees.push(d),m.set(l,d));const f=ie(i);d.tickets.push(f),d.isFromSector1C?d.ticketsInsideSector.push(f):d.ticketsOutsideSector.push(f)}}}),n.forEach(i=>{i.employees.sort((a,c)=>a.isFromSector1C&&!c.isFromSector1C?-1:!a.isFromSector1C&&c.isFromSector1C?1:(a.id||0)-(c.id||0))}),n}function Yn(t){const e={formed:[],review:[],execution:[]};return Array.isArray(t)?(t.filter(r=>Kn(r)).forEach(r=>{const n=re(r.stageId||r.STAGE_ID||"");e[n]&&e[n].push(ie(r))}),e):(S.warn("Tickets is not an array in getZeroPointTickets","TicketGrouper",t),e)}function Gn(t){if(!Array.isArray(t))return[];const e=new Set;return t.forEach(r=>{const n=se(r),s=oe(n);s&&e.add(s)}),Array.from(e)}const G=new Map,Hn=10*60*1e3;function Xn(t){if(!t||typeof t!="object")return{};const e={},r=Object.keys(t);for(const n of r)n.toUpperCase().startsWith("UF_")&&(e[n]=t[n]);return e}function $n(t,e=null,r=!0){if(r&&e&&G.has(e)){const o=G.get(e),i=Date.now();if(o.timestamp&&i-o.timestamp<Hn)return o.data;G.delete(e)}const n=Xn(t),s={typeProduct:n.UF_CRM_7_TYPE_PRODUCT||n.uf_crm_7_type_product||n.ufCrm7TypeProduct||null,all:n};return r&&e&&G.set(e,{data:s,timestamp:Date.now()}),s}class qn{static async getTicketDetails(e,r={}){const{select:n=["*"],useOriginalUfNames:s=!0,useCache:o=!0}=r;try{const i=await V.getTicket(e);if(!i)throw new Error(`–¢–∏–∫–µ—Ç —Å ID ${e} –Ω–µ –Ω–∞–π–¥–µ–Ω`);const a=$n(i,e,o);return{id:i.id||i.ID,title:i.title||i.TITLE,stageId:i.stageId||i.STAGE_ID,assignedById:i.assignedById||i.ASSIGNED_BY_ID,createdAt:i.createdTime||i.CREATED_TIME||i.CREATED_DATE,updatedAt:i.updatedTime||i.UPDATED_TIME||i.MODIFY_DATE,priority:i.priority||i.PRIORITY,opportunity:i.opportunity||i.OPPORTUNITY,currencyId:i.currencyId||i.CURRENCY_ID,comments:i.comments||i.COMMENTS,additionalFields:a,rawData:i}}catch(i){throw S.error("Error getting ticket details","TicketDetailsService",i),i}}}class ee{static async getSectorData(e=!0,r=null){if(r&&r(C("cache_check",0,{description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏..."})),e){const n=v.getSectorDataCacheKey(),s=v.get(n);if(s!==null)return r&&r(C("cache_hit",100,{description:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –∫–µ—à–∞"})),s}try{r&&r(C("loading_tickets",10,{description:"–ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤ –∏–∑ Bitrix24..."}));const n=Nn(),s=await V.getAllTickets(n,m=>{if(r){const d=X(m),f=Ee(10,40,d.progress||0);r(C(d.step||"loading_tickets",f,{...d.details,warning:d.details.warning}))}});r&&r(C("filtering",50,{totalTickets:s.length,description:`–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è ${s.length} —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —Å–µ–∫—Ç–æ—Ä—É 1–°...`}));const o=zn(s);r&&r(C("filtering",50,{totalTickets:s.length,filteredTickets:o.length,description:`–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ ${o.length} —Ç–∏–∫–µ—Ç–æ–≤ –∏–∑ ${s.length}`})),r&&r(C("extracting_employees",60,{filteredTickets:o.length,description:`–ê–Ω–∞–ª–∏–∑ ${o.length} —Ç–∏–∫–µ—Ç–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...`}));const i=Gn(o);r&&r(C("extracting_employees",60,{employeeCount:i.length,description:`–ù–∞–π–¥–µ–Ω–æ ${i.length} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`})),r&&r(C("loading_employees",65,{employeeCount:i.length,description:`–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ${i.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...`})),Ln();const a=await Sn.getEmployeesByIds(i),c=Fn(a);r&&r(C("loading_employees",90,{employeeCount:c.length,description:`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –¥–∞–Ω–Ω—ã—Ö ${c.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`})),r&&r(C("grouping",90,{filteredTickets:o.length,employeeCount:c.length,description:`–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ ${o.length} —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º –∏ ${c.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º...`}));const l={stages:Wn(o,c),employees:c,zeroPointTickets:Yn(o)};if(r&&r(C("caching",95,{description:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –∫–µ—à –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."})),e){const m=v.getSectorDataCacheKey();v.set(m,l,v.TICKETS_TTL)}return r&&r(C("complete",100,{description:"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"})),l}catch(n){throw S.error("Error getting sector data","DashboardSector1CService",n),r&&r({step:"error",progress:0,error:n.message}),n}}static async assignTicket(e,r,n){try{const s=ue(n),o=await V.assignTicket(e,r,s);return o&&v.invalidateTicketsCache(),o}catch(s){throw S.error("Error assigning ticket","DashboardSector1CService",s),s}}static async createTicket(e){try{const r=ue(e.stageId||"formed"),n={title:e.title,stageId:r};e.employeeId&&(n.assignedById=e.employeeId);const s=await V.createTicket(n);return s>0&&v.invalidateTicketsCache(),s}catch(r){throw S.error("Error creating ticket","DashboardSector1CService",r),r}}static async getTicket(e){try{const r=await V.getTicket(e);return ie(r)}catch(r){throw S.error("Error getting ticket","DashboardSector1CService",r),r}}static async getTicketDetails(e,r={}){try{return await qn.getTicketDetails(e,r)}catch(n){throw S.error("Error getting ticket details","DashboardSector1CService",n),n}}static async addComment(e,r){try{return(await B.call("crm.timeline.comment.add",{fields:{entityId:e,entityType:"DYNAMIC_"+In,comment:r}})).result!==void 0}catch(n){throw S.error("Error adding comment","DashboardSector1CService",n),n}}}function Zn(){const t=E(null),e=E(0),r=E(null),n=E(null),s=E({}),o=(d,f={})=>{t.value=d,s.value=f},i=d=>{const f=typeof d=="number"&&!isNaN(d)?d:0;e.value=Math.min(100,Math.max(0,f))},a=d=>{r.value=d,n.value=null},c=d=>{n.value=d},g=()=>{n.value=null},l=()=>{t.value=null,e.value=0,r.value=null,n.value=null,s.value={}},m=D(()=>r.value||n.value);return{currentStep:t,progress:e,error:r,temporaryError:n,displayError:m,stepDetails:s,updateStep:o,updateProgress:i,setError:a,setTemporaryError:c,clearTemporaryError:g,reset:l}}const w={fadeOutDuration:400,fadeInDuration:400,delayBetween:150,readyDisplayTime:800,fadeOutEasing:"ease-out",fadeInEasing:"ease-in",fadeOutTransform:"scale(0.95)",fadeInTransform:"translateY(10px)"},fe={fadeInDuration:400,fadeInEasing:"ease-in"};function Ie(t,e,r="opacity, transform"){return`${r} ${t}ms ${e}`}function Jn(){return Ie(w.fadeOutDuration,w.fadeOutEasing)}function Qn(){return Ie(fe.fadeInDuration,fe.fadeInEasing)}function er(){const t=E(!1),e=E(null),r=i=>{t.value=!0,e.value=Date.now(),i&&i()},n=i=>{t.value=!1,e.value=null,i&&i()},s=(i,a,c=w)=>{r(()=>{i&&i(),setTimeout(()=>{a&&a()},c.delayBetween),setTimeout(()=>{n()},c.fadeOutDuration)})},o=D(()=>e.value?Date.now()-e.value:0);return{isTransitioning:D(()=>t.value),startTransition:r,endTransition:n,executeTransition:s,transitionDuration:o}}function tr(t,e=""){if(Logger.error(`API Error ${e?`(${e})`:""}`,"ErrorHandler",t),t.message){if(t.message.includes("HTTP error"))return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.";if(t.message.includes("timeout"))return"–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";if(t.message.includes("403")||t.message.includes("401"))return"–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.";if(t.message.includes("500"))return"–û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."}return t.message||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}function nr(t,e="",r={}){const n={message:t.message,stack:t.stack,context:e,...r,timestamp:new Date().toISOString()};Logger.error("Error logged","ErrorHandler",n)}function te(t,e="",r=null){const n=tr(t,e);nr(t,e),r&&typeof r=="function"?r(n,"error"):typeof BX<"u"&&BX.UI&&BX.UI.Notification&&BX.UI.Notification.Center.notify({content:n,autoHideDelay:5e3})}function rr(t){const e=Se(),r=Zn(),{isTransitioning:n,executeTransition:s}=er();function o(f,T){const p=X(f);p.step&&T.updateStep(p.step,p.details||{}),p.progress!==void 0&&p.progress!==null&&(T.updateProgress(p.progress),T.clearTemporaryError())}const i=async(f=!0)=>{t.isLoading.value=!0,t.error.value=null,r.reset(),r.updateStep("cache_check",{description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö..."}),r.updateProgress(0);try{const T=await ee.getSectorData(f,p=>{o(p,r)});t.updateState(T)}catch(T){t.error.value=T.message,r.setError(T.message),te(T,"loading sector data",e.error)}finally{if(t.error.value)t.isLoading.value=!1;else{r.updateStep("complete",{description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"}),r.updateProgress(100);const T=w.readyDisplayTime||800;setTimeout(()=>{s(()=>{},()=>{t.isLoading.value=!1},w),setTimeout(()=>{r.reset()},w.fadeOutDuration)},T)}}},a=async(f,T,p)=>{if(!ve(f,T,p))return e.warning("–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–∫–µ—Ç —Å—é–¥–∞"),!1;try{const I=await ee.assignTicket(f.id,T,p);return I&&(t.updateLocalStateAfterMove(f,T,p),e.success("–¢–∏–∫–µ—Ç –ø–µ—Ä–µ–º–µ—â—ë–Ω")),I}catch(I){return te(I,"assigning ticket",e.error),!1}finally{t.draggedTicket.value=null}};return{loadSectorData:i,assignTicket:a,moveTicketToStage:async(f,T)=>await a(f,f.assigneeId,T),assignTicketToEmployee:async(f,T)=>await a(f,T,f.stageId),createTicket:async f=>{const T=Qe(f);if(!T.valid){const p=T.errors.join(", ");return e.error(p),0}try{const p=await ee.createTicket(f);return p>0&&(await i(!1),e.success("–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω")),p}catch(p){return te(p,"creating ticket",e.error),0}},handleTicketDragStart:f=>{t.draggedTicket.value=f},handleTicketDrop:async(f,T,p)=>{await a(f,T,p)},loadingProgress:r,isTransitioning:n}}const ae={name:"DashboardSector1C",components:{DashboardStage:kt,LoadingPreloader:qt,LoggerControl:un,BackButton:Tn},setup(){const t=kn(),e=rr(t);he(()=>{e.loadSectorData()});const r=Jn(),n=Qn(),s=`${w.delayBetween}ms`,o=w.fadeOutTransform,i=w.fadeInTransform,a=()=>{e.loadSectorData(!1)},c=e.loadingProgress,g=D(()=>typeof localStorage<"u"?localStorage.getItem("dashboard-sector-1c-show-logger-control")==="true":!1);return{isLoading:t.isLoading,error:t.error,stages:t.stages,zeroPointTickets:t.zeroPointTickets,employees:t.employees,draggedTicket:t.draggedTicket,currentStep:c.currentStep,progress:c.progress,stepDetails:c.stepDetails,loadingProgress:c,loadSectorData:e.loadSectorData,handleTicketDragStart:e.handleTicketDragStart,handleTicketDrop:e.handleTicketDrop,assignTicketToEmployee:e.assignTicketToEmployee,moveTicketToStage:e.moveTicketToStage,createTicket:e.createTicket,getEmployeeTickets:t.getEmployeeTickets,showLoggerControl:g,handleRetry:a,isTransitioning:e.isTransitioning,preloaderFadeOutTransition:r,dashboardFadeInTransition:n,transitionDelay:s,preloaderFadeOutTransform:o,dashboardFadeInTransform:i}}},ye=()=>{Pe(t=>({v3c49e6c2:t.preloaderFadeOutTransition,e92e8a3c:t.preloaderFadeOutTransform,v2a09459c:t.dashboardFadeInTransition,v57ce51a0:t.transitionDelay,c37e2376:t.dashboardFadeInTransform}))},me=ae.setup;ae.setup=me?(t,e)=>(ye(),me(t,e)):ye;const ir={class:"dashboard-header"},sr={key:0,class:"dashboard-content"},or={class:"stages-container"};function ar(t,e,r,n,s,o){const i=b("BackButton"),a=b("LoadingPreloader"),c=b("DashboardStage"),g=b("LoggerControl");return y(),h("div",{class:F(["dashboard-sector-1c",{"is-dragging":n.draggedTicket}])},[u("div",ir,[A(i,{variant:"header"}),e[0]||(e[0]=u("h1",null,"–î–∞—à–±–æ—Ä–¥ - –°–µ–∫—Ç–æ—Ä 1–°",-1))]),A(de,{name:"preloader-fade"},{default:z(()=>[n.isLoading||n.error||n.currentStep?(y(),L(a,{key:0,"current-step":n.currentStep,progress:n.progress,"step-details":n.stepDetails,error:n.error||null,onRetry:n.handleRetry},null,8,["current-step","progress","step-details","error","onRetry"])):k("",!0)]),_:1}),A(de,{name:"dashboard-fade"},{default:z(()=>[!n.isLoading&&!n.error&&!n.currentStep?(y(),h("div",sr,[u("div",or,[(y(!0),h(R,null,P(n.stages,l=>(y(),L(c,{key:l.id,stage:l,"zero-point-tickets":n.zeroPointTickets[l.id]||[],onTicketMoved:n.handleTicketDrop,onTicketAssigned:n.assignTicketToEmployee},null,8,["stage","zero-point-tickets","onTicketMoved","onTicketAssigned"]))),128))])])):k("",!0)]),_:1}),A(i,{variant:"floating"}),A(g,{"show-control":n.showLoggerControl},null,8,["show-control"])],2)}const ur=N(ae,[["render",ar],["__scopeId","data-v-372e3950"]]);export{ur as default};
