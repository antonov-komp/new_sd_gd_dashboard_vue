const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ticketListUtils-G6myjvIn.js","assets/priority-config-DRNuuCnQ.js","assets/main-D_e3Y8Mz.js","assets/main-hkNOQW78.css","assets/priority-config-Bxxce_5E.css","assets/ticket-mapper-C_gZSjzs.js"])))=>i.map(i=>d[i]);
var De=Object.defineProperty;var Se=(f,t,e)=>t in f?De(f,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):f[t]=e;var _e=(f,t,e)=>Se(f,typeof t!="symbol"?t+"":t,e);import{_ as ue,g as E,c as H,a as d,o as i,b as s,t as w,F as J,e as Z,n as X,d as q,f as K,G as Ae,H as V,I as te,j as M,k as j,B as x,T as ve,l as Q,J as de,m as Ue,S as Oe,z as Be,r as Re,y as We,L as Ne}from"./main-D_e3Y8Mz.js";import{F as Me}from"./FiltersPanel-BrdiwM_M.js";import{L as Ee,D as Pe,B as Le}from"./index-D-R0pJ3w.js";import{B as ae,g as Ie,a as Fe,b as $e,D as Ye,T as ye,c as he}from"./priority-config-DRNuuCnQ.js";const Ge={class:"ac-chart"},Ve={class:"ac-chart__header"},je={class:"ac-chart__subtitle"},He={class:"ac-chart__controls"},qe={class:"chart-type-selector"},ze=["onClick"],Je={class:"chart-type-icon"},Ze={class:"chart-type-label"},xe={class:"ac-chart__summary"},Xe={class:"summary-card__value"},Ke={class:"summary-card__value-main"},Qe={class:"summary-card__breakdown"},et={class:"breakdown-item breakdown-item--this-week"},tt={class:"breakdown-item__value"},st={class:"breakdown-item breakdown-item--other-week"},at={class:"breakdown-item__value"},rt={class:"summary-card__value-main"},lt={class:"summary-card__breakdown"},ot={class:"breakdown-item breakdown-item--this-week"},it={class:"breakdown-item__value"},nt={class:"breakdown-item breakdown-item--other-week"},ct={class:"breakdown-item__value"},dt={class:"summary-card summary-card--stages"},ut={class:"summary-card__tags"},kt={key:0,class:"stage-tag stage-tag--empty"},vt={class:"ac-chart__body"},yt={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:null},data:{type:Object,default:()=>({currentWeek:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0},newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},weeksData:[],stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(f,{emit:t}){const e=f,l=t,o=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],n=E("line"),W=H(()=>{var T;return((T=e.meta)==null?void 0:T.weekNumber)??"‚Äî"}),k=H(()=>{var L,G,z,C,g,B,F,r,a,p,b,$,U,_,Y,ee,re,le,oe,ie,ne,ce;const T=((L=e.meta)==null?void 0:L.weeks)||[],u=T.length>0?T.map(ke=>`–ù–µ–¥–µ–ª—è ${ke.weekNumber}`):["–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è"],P=Array.isArray((G=e.data.series)==null?void 0:G.new)&&e.data.series.new.length===4||Array.isArray((z=e.data.series)==null?void 0:z.new)?e.data.series.new:[((C=e.data.currentWeek)==null?void 0:C.newTickets)??e.data.newTickets??0],v=Array.isArray((g=e.data.series)==null?void 0:g.closed)&&e.data.series.closed.length===4||Array.isArray((B=e.data.series)==null?void 0:B.closed)?e.data.series.closed:[((F=e.data.currentWeek)==null?void 0:F.closedTickets)??e.data.closedTickets??0],c=Array.isArray((r=e.data.series)==null?void 0:r.closedCreatedThisWeek)&&e.data.series.closedCreatedThisWeek.length===4||Array.isArray((a=e.data.series)==null?void 0:a.closedCreatedThisWeek)?e.data.series.closedCreatedThisWeek:[((p=e.data.currentWeek)==null?void 0:p.closedTicketsCreatedThisWeek)??e.data.closedTicketsCreatedThisWeek??0],I=Array.isArray((b=e.data.series)==null?void 0:b.closedCreatedOtherWeek)&&e.data.series.closedCreatedOtherWeek.length===4||Array.isArray(($=e.data.series)==null?void 0:$.closedCreatedOtherWeek)?e.data.series.closedCreatedOtherWeek:[((U=e.data.currentWeek)==null?void 0:U.closedTicketsCreatedOtherWeek)??e.data.closedTicketsCreatedOtherWeek??0],m=Array.isArray((_=e.data.series)==null?void 0:_.carryover)&&e.data.series.carryover.length===4||Array.isArray((Y=e.data.series)==null?void 0:Y.carryover)?e.data.series.carryover:[((ee=e.data.currentWeek)==null?void 0:ee.carryoverTickets)??e.data.carryoverTickets??0],S=Array.isArray((re=e.data.series)==null?void 0:re.carryoverCreatedThisWeek)&&e.data.series.carryoverCreatedThisWeek.length===4||Array.isArray((le=e.data.series)==null?void 0:le.carryoverCreatedThisWeek)?e.data.series.carryoverCreatedThisWeek:[((oe=e.data.currentWeek)==null?void 0:oe.carryoverTicketsCreatedThisWeek)??e.data.carryoverTicketsCreatedThisWeek??0],A=Array.isArray((ie=e.data.series)==null?void 0:ie.carryoverCreatedOtherWeek)&&e.data.series.carryoverCreatedOtherWeek.length===4||Array.isArray((ne=e.data.series)==null?void 0:ne.carryoverCreatedOtherWeek)?e.data.series.carryoverCreatedOtherWeek:[((ce=e.data.currentWeek)==null?void 0:ce.carryoverTicketsCreatedOtherWeek)??e.data.carryoverTicketsCreatedOtherWeek??0];return{labels:u,datasets:[{label:"–ù–æ–≤—ã–µ",data:P,backgroundColor:V.primary,borderColor:V.primary,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:v,backgroundColor:V.success,borderColor:V.success,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:c,backgroundColor:V.successLight,borderColor:V.successLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:I,backgroundColor:V.warning,borderColor:V.warning,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:m,backgroundColor:V.carryover,borderColor:V.carryover,tension:.3,fill:!1},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:S,backgroundColor:V.carryoverLight,borderColor:V.carryoverLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:A,backgroundColor:V.carryoverDark,borderColor:V.carryoverDark,tension:.3,fill:!1,borderDash:[5,5]}]}}),y=H(()=>{var u;const T=(u=e.data)==null?void 0:u.currentWeek;return{labels:["–ù–æ–≤—ã–µ","–ó–∞–∫—Ä—ã—Ç—ã–µ","–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ"],datasets:[{data:[(T==null?void 0:T.newTickets)??e.data.newTickets??0,(T==null?void 0:T.closedTickets)??e.data.closedTickets??0,(T==null?void 0:T.carryoverTickets)??e.data.carryoverTickets??0],backgroundColor:[V.primary,V.success,V.carryover],borderWidth:1}]}}),h=H(()=>{switch(n.value){case"line":return Ee;case"bar":return Le;case"doughnut":return Pe;default:return Ee}}),D=H(()=>n.value==="doughnut"?y.value:k.value),R=T=>{if(!T)return"‚Äî";try{return new Date(T).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return T}},O=H(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{enabled:!0,callbacks:{title:T=>{var P,v,c,I;const u=(P=T[0])==null?void 0:P.dataIndex;if(u!==void 0&&((c=(v=e.meta)==null?void 0:v.weeks)!=null&&c[u])){const m=e.meta.weeks[u];return`–ù–µ–¥–µ–ª—è ${m.weekNumber} (${R(m.weekStartUtc)} ‚Äî ${R(m.weekEndUtc)})`}return((I=T[0])==null?void 0:I.label)||""}}},legend:{position:"top"}},scales:n.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0}},x:{ticks:{maxRotation:45,minRotation:45}}}})),N=T=>{var I,m,S,A,L;const u=(I=e.data)==null?void 0:I.currentWeek,P=(u==null?void 0:u.newTickets)??((m=e.data)==null?void 0:m.newTickets)??0,v=(u==null?void 0:u.closedTickets)??((S=e.data)==null?void 0:S.closedTickets)??0,c=(u==null?void 0:u.carryoverTickets)??((A=e.data)==null?void 0:A.carryoverTickets)??0;T==="new"&&P>0?l("open-stages"):T==="closed"&&v>0?(((L=e.data)==null?void 0:L.responsible)||[]).length>0&&l("open-responsible"):T==="carryover"&&c>0&&l("open-carryover")};return(T,u)=>{var P,v,c,I,m,S,A,L,G,z,C,g,B,F,r;return i(),d("div",Ge,[s("header",Ve,[s("div",null,[u[3]||(u[3]=s("h2",{class:"ac-chart__title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),s("p",je," –ù–µ–¥–µ–ª—è "+w(((v=(P=f.meta)==null?void 0:P.currentWeek)==null?void 0:v.weekNumber)??W.value)+" ¬∑ "+w(((I=(c=f.meta)==null?void 0:c.currentWeek)==null?void 0:I.weekStartUtc)||((m=f.meta)==null?void 0:m.weekStartUtc)||"‚Äî")+" ‚Äî "+w(((A=(S=f.meta)==null?void 0:S.currentWeek)==null?void 0:A.weekEndUtc)||((L=f.meta)==null?void 0:L.weekEndUtc)||"‚Äî")+" (UTC) ",1)]),s("div",He,[s("div",qe,[(i(),d(J,null,Z(o,a=>s("button",{key:a.value,class:X(["chart-type-btn",{active:n.value===a.value}]),onClick:p=>n.value=a.value},[s("span",Je,w(a.icon),1),s("span",Ze,w(a.label),1)],10,ze)),64))])])]),s("section",xe,[s("div",{class:"summary-card summary-card--new",onClick:u[0]||(u[0]=a=>N("new"))},[u[4]||(u[4]=s("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s("div",Xe,w(((G=f.data.currentWeek)==null?void 0:G.newTickets)??f.data.newTickets??0),1)]),s("div",{class:"summary-card summary-card--closed-breakdown",onClick:u[1]||(u[1]=a=>N("closed"))},[u[9]||(u[9]=s("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s("div",Ke,w(((z=f.data.currentWeek)==null?void 0:z.closedTickets)??f.data.closedTickets??0),1),s("div",Qe,[s("div",et,[u[5]||(u[5]=s("span",{class:"breakdown-item__icon"},"‚úì",-1)),s("span",tt,w(((C=f.data.currentWeek)==null?void 0:C.closedTicketsCreatedThisWeek)??f.data.closedTicketsCreatedThisWeek??0),1),u[6]||(u[6]=s("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),s("div",st,[u[7]||(u[7]=s("span",{class:"breakdown-item__icon"},"‚Üª",-1)),s("span",at,w(((g=f.data.currentWeek)==null?void 0:g.closedTicketsCreatedOtherWeek)??f.data.closedTicketsCreatedOtherWeek??0),1),u[8]||(u[8]=s("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),s("div",{class:"summary-card summary-card--carryover-breakdown",onClick:u[2]||(u[2]=a=>N("carryover"))},[u[14]||(u[14]=s("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),s("div",rt,w(((B=f.data.currentWeek)==null?void 0:B.carryoverTickets)??f.data.carryoverTickets??0),1),s("div",lt,[s("div",ot,[u[10]||(u[10]=s("span",{class:"breakdown-item__icon"},"‚úì",-1)),s("span",it,w(((F=f.data.currentWeek)==null?void 0:F.carryoverTicketsCreatedThisWeek)??f.data.carryoverTicketsCreatedThisWeek??0),1),u[11]||(u[11]=s("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),s("div",nt,[u[12]||(u[12]=s("span",{class:"breakdown-item__icon"},"‚Üª",-1)),s("span",ct,w(((r=f.data.currentWeek)==null?void 0:r.carryoverTicketsCreatedOtherWeek)??f.data.carryoverTicketsCreatedOtherWeek??0),1),u[13]||(u[13]=s("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),s("div",dt,[u[15]||(u[15]=s("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),s("div",ut,[(i(!0),d(J,null,Z(f.data.stages||[],a=>(i(),d("span",{key:a.stageId,class:"stage-tag"},w(a.stageName||a.stageId)+" ‚Äî "+w(a.count),1))),128)),!f.data.stages||f.data.stages.length===0?(i(),d("span",kt," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):q("",!0)])])]),s("div",vt,[(i(),K(Ae(h.value),{data:D.value,options:O.value},null,8,["data","options"]))])])}}},_t=ue(yt,[["__scopeId","data-v-454bfad4"]]);class me{static async getSectorData(){try{const t=await this.getAllTickets();console.log("Total tickets loaded:",t.length);const e=this.extractUniqueEmployeeIds(t);console.log("Unique employee IDs:",e);const l=await this.getEmployeesByIds(e);return console.log("Loaded employees:",l.length),{stages:this.groupTicketsByStages(t,l),employees:l,zeroPointTickets:this.getZeroPointTickets(t)}}catch(t){throw console.error("Error getting sector data:",t),t}}static async getAllTickets(){const t=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],e=[];for(const l of t){console.log(`Loading tickets for stage: ${l}`);const o=await this.getTicketsByStage(l);e.push(...o),console.log(`Loaded ${o.length} tickets for stage ${l}`)}return e}static async getTicketsByStage(t){const e=[];let l=0;const o=50;let n=!0;for(;n;)try{const k=await ae.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:t},select:["*"],order:{id:"DESC"},start:l,useOriginalUfNames:"Y"});let y=[];k&&k.result&&(Array.isArray(k.result)?y=k.result:k.result.items&&Array.isArray(k.result.items)?y=k.result.items:k.result.data&&Array.isArray(k.result.data)&&(y=k.result.data)),y.length>0?(e.push(...y),l+=y.length,n=y.length===o):n=!1}catch(k){console.error(`Error loading tickets batch for stage ${t} (start: ${l}):`,k),n=!1}e.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(e[0],null,2)),console.log("Sample ticket keys:",Object.keys(e[0])),console.log("Sample ticket assignedById variants:",{assignedById:e[0].assignedById,assignedByIdId:e[0].assignedByIdId,ASSIGNED_BY_ID:e[0].ASSIGNED_BY_ID}));const W=e.filter(k=>{const y=k.UF_CRM_7_TYPE_PRODUCT||k.uf_crm_7_type_product||k.ufCrm7TypeProduct||k.UF_CRM_7_TYPE_PRODUCT||k.uf_crm_7_type_product;return Array.isArray(y)?y.includes(this.SECTOR_TAG):typeof y=="object"&&y!==null?y.value===this.SECTOR_TAG||y===this.SECTOR_TAG:y===this.SECTOR_TAG});return console.log(`Filtered ${W.length} tickets from ${e.length} for stage ${t} (sector tag: ${this.SECTOR_TAG})`),W}static extractUniqueEmployeeIds(t){if(!Array.isArray(t))return[];const e=new Set;return t.forEach(l=>{const o=l.assignedById||l.assignedByIdId||l.ASSIGNED_BY_ID||l.assignedById||l.assignedById&&typeof l.assignedById=="object"&&(l.assignedById.id||l.assignedById.ID)||l.assignedById&&typeof l.assignedById=="object"&&l.assignedById.value;if(o){const n=parseInt(o);n&&!isNaN(n)&&n>0&&e.add(n)}}),t.length>0&&(console.log("Sample ticket for employee extraction:",t[0]),console.log("Sample ticket assignedById variants:",{assignedById:t[0].assignedById,assignedByIdId:t[0].assignedByIdId,ASSIGNED_BY_ID:t[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(e))),Array.from(e)}static async getEmployeesByIds(t){if(!Array.isArray(t)||t.length===0)return[];try{const e=await ae.call("user.get",{filter:{ID:t}});let l=[];return e&&e.result&&(Array.isArray(e.result)?l=e.result:console.warn("Unexpected user.get result format:",e)),l.map(o=>({id:parseInt(o.ID||o.id||0),name:`${o.NAME||o.name||""} ${o.LAST_NAME||o.lastName||""}`.trim()||o.EMAIL||o.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:o.WORK_POSITION||o.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:o.EMAIL||o.email||"",tickets:[]}))}catch(e){return console.error("Error getting employees by IDs:",e),[]}}static groupTicketsByStages(t,e){Array.isArray(t)||(console.warn("Tickets is not an array:",t),t=[]),Array.isArray(e)||(console.warn("Employees is not an array:",e),e=[]);const l=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:e.map(o=>({...o,tickets:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:e.map(o=>({...o,tickets:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:e.map(o=>({...o,tickets:[]}))}];return t.forEach(o=>{const n=this.mapStageId(o.stageId||o.STAGE_ID||""),W=l.find(k=>k.id===n);if(W){const k=o.assignedById||o.ASSIGNED_BY_ID||null,y=k?parseInt(k):null;if(y){let h=W.employees.find(D=>D.id===y);h||(h={id:y,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${y}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",tickets:[]},W.employees.push(h)),h.tickets.push(this.mapTicket(o))}}}),l}static mapStageId(t){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[t]||"formed"}static mapStageIdToBitrix(t){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[t]||"DT140_12:UC_0VHWE2"}static mapTicket(t){const e=parseInt(t.id||t.ID||0),l=t.title||t.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",o=t.stageId||t.STAGE_ID||"",n=t.assignedById||t.ASSIGNED_BY_ID||null,W=t.createdTime||t.CREATED_DATE||t.CREATED_TIME||"",k=t.updatedTime||t.MODIFY_DATE||t.UPDATED_TIME||"",y=t.UF_CRM_7_UF_PRIORITY||t.uf_crm_7_uf_priority||t.ufCrm7UfPriority||t.UF_CRM_7_UF_PRIORITY||t.uf_crm_7_uf_priority||t.priority||t.PRIORITY||null,h=Ie(y),D=Fe(h);return{id:e,title:l,priorityId:h.id,priorityLabel:h.label,priorityColors:D,priority:h.id,priorityBitrixValue:h.bitrixValue||null,status:this.mapStatus(o),assigneeId:n?parseInt(n):null,stageId:this.mapStageId(o),createdAt:W,modifiedAt:k,amount:t.opportunity||t.OPPORTUNITY||0,currency:t.currencyId||t.CURRENCY_ID||"RUB",description:t.comments||t.COMMENTS||""}}static mapPriority(t){return Ie(t).id}static mapPriorityToBitrix(t){if(t&&typeof t=="object")return t.bitrixValue||null;const e=$e(t);if(e&&e.bitrixValue)return e.bitrixValue;const l={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return l[t]?l[t]:$e(Ye).bitrixValue}static mapStatus(t){return"in_progress"}static getZeroPointTickets(t){const e={formed:[],review:[],execution:[]};return Array.isArray(t)?(t.filter(l=>!(l.assignedById||l.ASSIGNED_BY_ID)).forEach(l=>{const o=this.mapStageId(l.stageId||l.STAGE_ID||"");e[o]&&e[o].push(this.mapTicket(l))}),e):(console.warn("Tickets is not an array in getZeroPointTickets:",t),e)}static async assignTicket(t,e,l){try{const o=this.mapStageIdToBitrix(l);return(await ae.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:t,fields:{assignedById:e,stageId:o}})).result===!0}catch(o){throw console.error("Error assigning ticket:",o),o}}static async createTicket(t){try{const e=await ae.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:t.title,assignedById:t.employeeId,stageId:this.mapStageIdToBitrix(t.stageId)}});return e.result?parseInt(e.result):0}catch(e){throw console.error("Error creating ticket:",e),e}}static async getTicket(t){try{const e=await ae.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:t});return this.mapTicket(e.result)}catch(e){throw console.error("Error getting ticket:",e),e}}static async addComment(t,e){try{return(await ae.call("crm.timeline.comment.add",{fields:{entityId:t,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:e}})).result!==void 0}catch(l){throw console.error("Error adding comment:",l),l}}}_e(me,"ENTITY_TYPE_ID",140),_e(me,"SECTOR_TAG","1C");const mt="/api/graph-1c-admission-closure.php";function ht(f){var l,o,n,W,k,y,h,D,R,O,N,T,u,P,v,c,I,m,S,A,L,G,z,C,g,B,F,r,a,p,b,$,U,_,Y,ee,re,le,oe,ie,ne,ce,ke,ge,pe,Te,fe,be,Ce,we;if(!f)return{meta:null,data:{currentWeek:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0},newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},weeksData:[],stages:[],responsible:[],responsibleCreatedThisWeek:[],responsibleCreatedOtherWeek:[]}};const t=f.data||f.result||f,e=t.meta||f.meta||null;return{meta:{...e,currentWeek:(e==null?void 0:e.currentWeek)||(e?{weekNumber:e.weekNumber,weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc}:null),weeks:(e==null?void 0:e.weeks)||[]},data:{currentWeek:((l=t.data)==null?void 0:l.currentWeek)||(t.data?{newTickets:t.data.newTickets??0,closedTickets:t.data.closedTickets??0,closedTicketsCreatedThisWeek:t.data.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:t.data.closedTicketsCreatedOtherWeek??0,carryoverTickets:t.data.carryoverTickets??0,carryoverTicketsCreatedThisWeek:t.data.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:t.data.carryoverTicketsCreatedOtherWeek??0}:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0}),newTickets:((n=(o=t.data)==null?void 0:o.currentWeek)==null?void 0:n.newTickets)??((W=t.data)==null?void 0:W.newTickets)??t.newTickets??0,closedTickets:((y=(k=t.data)==null?void 0:k.currentWeek)==null?void 0:y.closedTickets)??((h=t.data)==null?void 0:h.closedTickets)??t.closedTickets??0,closedTicketsCreatedThisWeek:((R=(D=t.data)==null?void 0:D.currentWeek)==null?void 0:R.closedTicketsCreatedThisWeek)??((O=t.data)==null?void 0:O.closedTicketsCreatedThisWeek)??t.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:((T=(N=t.data)==null?void 0:N.currentWeek)==null?void 0:T.closedTicketsCreatedOtherWeek)??((u=t.data)==null?void 0:u.closedTicketsCreatedOtherWeek)??t.closedTicketsCreatedOtherWeek??0,carryoverTickets:((v=(P=t.data)==null?void 0:P.currentWeek)==null?void 0:v.carryoverTickets)??((c=t.data)==null?void 0:c.carryoverTickets)??t.carryoverTickets??0,carryoverTicketsCreatedThisWeek:((m=(I=t.data)==null?void 0:I.currentWeek)==null?void 0:m.carryoverTicketsCreatedThisWeek)??((S=t.data)==null?void 0:S.carryoverTicketsCreatedThisWeek)??t.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:((L=(A=t.data)==null?void 0:A.currentWeek)==null?void 0:L.carryoverTicketsCreatedOtherWeek)??((G=t.data)==null?void 0:G.carryoverTicketsCreatedOtherWeek)??t.carryoverTicketsCreatedOtherWeek??0,series:{new:((C=(z=t.data)==null?void 0:z.series)==null?void 0:C.new)??((g=t.series)==null?void 0:g.new)??[0],closed:((F=(B=t.data)==null?void 0:B.series)==null?void 0:F.closed)??((r=t.series)==null?void 0:r.closed)??[0],closedCreatedThisWeek:((p=(a=t.data)==null?void 0:a.series)==null?void 0:p.closedCreatedThisWeek)??((b=t.series)==null?void 0:b.closedCreatedThisWeek)??[0],closedCreatedOtherWeek:((U=($=t.data)==null?void 0:$.series)==null?void 0:U.closedCreatedOtherWeek)??((_=t.series)==null?void 0:_.closedCreatedOtherWeek)??[0],carryover:((ee=(Y=t.data)==null?void 0:Y.series)==null?void 0:ee.carryover)??((re=t.series)==null?void 0:re.carryover)??[0],carryoverCreatedThisWeek:((oe=(le=t.data)==null?void 0:le.series)==null?void 0:oe.carryoverCreatedThisWeek)??((ie=t.series)==null?void 0:ie.carryoverCreatedThisWeek)??[0],carryoverCreatedOtherWeek:((ce=(ne=t.data)==null?void 0:ne.series)==null?void 0:ce.carryoverCreatedOtherWeek)??((ke=t.series)==null?void 0:ke.carryoverCreatedOtherWeek)??[0]},weeksData:((ge=t.data)==null?void 0:ge.weeksData)??t.weeksData??[],stages:((pe=t.data)==null?void 0:pe.stages)??t.stages??[],responsible:((Te=t.data)==null?void 0:Te.responsible)??t.responsible??[],responsibleCreatedThisWeek:((fe=t.data)==null?void 0:fe.responsibleCreatedThisWeek)??t.responsibleCreatedThisWeek??[],responsibleCreatedOtherWeek:((be=t.data)==null?void 0:be.responsibleCreatedOtherWeek)??t.responsibleCreatedOtherWeek??[],newTicketsByStages:((Ce=t.data)==null?void 0:Ce.newTicketsByStages)??t.newTicketsByStages??null,carryoverTicketsByDuration:((we=t.data)==null?void 0:we.carryoverTicketsByDuration)??t.carryoverTicketsByDuration??null}}}async function se(f={}){const{endpoint:t=mt,product:e="1C",weekStartUtc:l=null,weekEndUtc:o=null,useCache:n=!0,forceRefresh:W=!1,includeTickets:k=!1,includeNewTicketsByStages:y=!1,includeCarryoverTickets:h=!0,includeCarryoverTicketsByDuration:D=!1}=f,O=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({product:e,weekStartUtc:l,weekEndUtc:o,useCache:n,forceRefresh:W,includeTickets:k,includeNewTicketsByStages:y,includeCarryoverTickets:h,includeCarryoverTicketsByDuration:D})});if(!O.ok)throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (${O.status})`);const N=await O.json();if((N==null?void 0:N.success)===!1)throw new Error(N.message||"–ë—ç–∫–µ–Ω–¥ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É");return ht(N)}const gt={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},pt={class:"modal"},Tt={key:0,class:"modal__tabs"},ft={key:"level-0-categories",class:"level-0"},bt={class:"modal__header"},Ct={class:"modal__body"},wt={class:"categories-list"},Wt=["onClick"],Et={class:"category-item"},It={class:"category-item__icon"},$t={key:0},Dt={key:1},St={class:"category-item__content"},At={class:"category-item__label"},Ut={class:"category-item__count"},Ot={key:0,class:"category-item__arrow"},Bt={class:"modal__footer"},Rt={key:"level-1-categories",class:"level-1"},Nt={class:"modal__header"},Mt={class:"modal__body"},Pt={key:"loading",class:"loading-names"},Lt={key:"empty",class:"modal__empty"},Ft={key:"list",class:"responsible-list"},Yt=["onClick"],Gt={class:"responsible-list__name"},Vt={class:"responsible-list__count"},jt={key:0,class:"responsible-list__arrow"},Ht={class:"modal__footer"},qt={key:"level-2-categories",class:"level-2"},zt={class:"modal__header"},Jt={class:"modal__title"},Zt={class:"modal__body"},xt={key:"loading",class:"loading-state"},Xt={key:"error",class:"error-state"},Kt={class:"error-message"},Qt={key:"empty",class:"empty-state"},es={key:"tickets",class:"tickets-list-container"},ts={key:"level-0-employees",class:"level-0"},ss={class:"modal__header"},as={class:"modal__body"},rs={key:"loading",class:"loading-names"},ls={key:"empty",class:"modal__empty"},os={key:"list",class:"responsible-list"},is=["onClick"],ns={class:"responsible-list__name"},cs={class:"responsible-list__count"},ds={key:0,class:"responsible-list__arrow"},us={class:"modal__footer"},ks={key:"level-1-employees",class:"level-1"},vs={class:"modal__header"},ys={class:"modal__title"},_s={class:"modal__body"},ms={class:"categories-list"},hs=["onClick"],gs={class:"category-item"},ps={class:"category-item__icon"},Ts={key:0},fs={key:1},bs={class:"category-item__content"},Cs={class:"category-item__label"},ws={class:"category-item__count"},Ws={key:0,class:"category-item__arrow"},Es={class:"modal__footer"},Is={key:"level-2-employees",class:"level-2"},$s={class:"modal__header"},Ds={class:"modal__title"},Ss={class:"modal__body"},As={key:"loading",class:"loading-state"},Us={key:"error",class:"error-state"},Os={class:"error-message"},Bs={key:"empty",class:"empty-state"},Rs={class:"empty-state-message"},Ns={key:"tickets",class:"tickets-list-container"},Ms={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(f){const t=f,e=E(0),l=E("categories"),o=E(null),n=E(null),W=E(null),k=E([]),y=E(!1),h=E(null),D=E([]),R=E([]),O=E(!1),N=H(()=>[{id:"created-this-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é",count:t.closedTicketsCreatedThisWeek??0,responsible:t.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ",count:t.closedTicketsCreatedOtherWeek??0,responsible:t.responsibleCreatedOtherWeek??[]}]),T=H(()=>{const r=new Map;return(t.responsibleCreatedThisWeek||[]).forEach(a=>{const p=a.id??"unassigned";r.has(p)||r.set(p,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const b=r.get(p);b.thisWeekCount=a.count??0,b.thisWeekTickets=a.tickets||[],b.totalCount+=b.thisWeekCount}),(t.responsibleCreatedOtherWeek||[]).forEach(a=>{const p=a.id??"unassigned";r.has(p)||r.set(p,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const b=r.get(p);b.otherWeekCount=a.count??0,b.otherWeekTickets=a.tickets||[],b.totalCount+=b.otherWeekCount}),Array.from(r.values())}),u=H(()=>{if(!n.value)return[];const r=n.value.thisWeekTickets||[],a=n.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:n.value.id,name:n.value.name,thisWeekCount:n.value.thisWeekCount,otherWeekCount:n.value.otherWeekCount,thisWeekTickets:r.length,otherWeekTickets:a.length,employee:n.value}),[{id:"this-week",label:"–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ",count:n.value.thisWeekCount??0,tickets:r,employeeId:n.value.id},{id:"other-week",label:"–ù–∞ –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ",count:n.value.otherWeekCount??0,tickets:a,employeeId:n.value.id}]}),P=H(()=>(R.value||[]).length>0);async function v(r){const a=r.filter(p=>p.id!==null&&p.id!==void 0).map(p=>p.id);if(a.length===0)return r;try{const p=await me.getEmployeesByIds(a),b=new Map;return p.forEach($=>{b.set($.id,$.name)}),r.map($=>$.id&&b.has($.id)?{...$,name:b.get($.id)}:$)}catch(p){return console.error("[ResponsibleModal] Error enriching names:",p),r}}te([()=>l.value,()=>T.value],async([r,a])=>{if(!(r!=="employees"||e.value!==0)){if(!a||a.length===0){R.value=[];return}O.value=!0;try{R.value=await v(a)}catch(p){console.error("[ResponsibleModal] Error loading employee names:",p),R.value=a}finally{O.value=!1}}},{immediate:!0}),te(()=>t.responsible,async r=>{if(!(e.value!==0||o.value||l.value!=="categories")){if(!r||r.length===0){D.value=[];return}O.value=!0;try{D.value=await v(r)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),D.value=r}finally{O.value=!1}}},{immediate:!1});const c=H(()=>(D.value||[]).length>0);function I(r){l.value!==r&&(l.value=r,e.value=0,o.value=null,n.value=null,W.value=null,k.value=[],h.value=null,D.value=[],R.value=[])}async function m(r){if(!(!r||r.count===0)){o.value=r,e.value=1,O.value=!0;try{D.value=await v(r.responsible)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),D.value=r.responsible}finally{O.value=!1}}}async function S(r,a=null){var p,b;!r||!r.id||r.totalCount===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:r.id,name:r.name,thisWeekCount:r.thisWeekCount,otherWeekCount:r.otherWeekCount,thisWeekTickets:((p=r.thisWeekTickets)==null?void 0:p.length)||0,otherWeekTickets:((b=r.otherWeekTickets)==null?void 0:b.length)||0,employee:r}),n.value={...r,thisWeekTickets:r.thisWeekTickets||[],otherWeekTickets:r.otherWeekTickets||[]},e.value=1)}async function A(r){var p;if(!r||r.count===0)return;W.value=r,e.value=2;const a=r.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:r.id,label:r.label,count:r.count,ticketsInGradation:a.length,selectedEmployee:(p=n.value)==null?void 0:p.id}),a.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",a.length),await L(a)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await G(r))}async function L(r){y.value=!0,h.value=null;try{try{const{prepareTicketsForDisplay:a}=await de(async()=>{const{prepareTicketsForDisplay:p}=await import("./ticketListUtils-G6myjvIn.js").then(b=>b.t);return{prepareTicketsForDisplay:p}},__vite__mapDeps([0,1,2,3,4,5]));k.value=await a(r,null,null)}catch(a){console.error("[ResponsibleModal] Error preparing tickets:",a),k.value=r}k.value.length===0&&(h.value=null)}catch(a){h.value=a.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",a),k.value=[]}finally{y.value=!1}}async function G(r){y.value=!0,h.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc||!n.value)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫");const a=await se({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeTickets:!0}),p=r.id==="this-week"?a.data.responsibleCreatedThisWeek:a.data.responsibleCreatedOtherWeek,b=p==null?void 0:p.find(U=>U.id===n.value.id),$=(b==null?void 0:b.tickets)||[];try{const{prepareTicketsForDisplay:U}=await de(async()=>{const{prepareTicketsForDisplay:_}=await import("./ticketListUtils-G6myjvIn.js").then(Y=>Y.t);return{prepareTicketsForDisplay:_}},__vite__mapDeps([0,1,2,3,4,5]));k.value=await U($,null,null)}catch(U){console.error("[ResponsibleModal] Error preparing tickets:",U),k.value=$}k.value.length===0&&(h.value=null)}catch(a){h.value=a.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets from API:",a),k.value=[]}finally{y.value=!1}}async function z(r,a=null){!r||!r.id||r.count===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),n.value=r,e.value=2,await C(r.id))}async function C(r){var a;y.value=!0,h.value=null;try{let p=[];if(o.value&&o.value.responsible){const b=o.value.responsible.find($=>$.id===r);p=(b==null?void 0:b.tickets)||[]}if(p.length===0&&t.weekStartUtc&&t.weekEndUtc){const b=await se({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeTickets:!0}),$=((a=o.value)==null?void 0:a.id)==="created-this-week"?b.data.responsibleCreatedThisWeek:b.data.responsibleCreatedOtherWeek,U=$==null?void 0:$.find(_=>_.id===r);p=(U==null?void 0:U.tickets)||[]}try{const{prepareTicketsForDisplay:b}=await de(async()=>{const{prepareTicketsForDisplay:$}=await import("./ticketListUtils-G6myjvIn.js").then(U=>U.t);return{prepareTicketsForDisplay:$}},__vite__mapDeps([0,1,2,3,4,5]));k.value=await b(p,null,null)}catch(b){console.error("[ResponsibleModal] Error preparing tickets:",b),k.value=p}k.value.length===0&&(h.value=null)}catch(p){h.value=p.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",p),k.value=[]}finally{y.value=!1}}function g(){e.value===2?(e.value=1,l.value==="categories"?n.value=null:W.value=null,k.value=[],h.value=null):e.value===1&&(e.value=0,l.value==="categories"?(o.value=null,D.value=[]):n.value=null)}function B(r){const a=he(r.id);window.open(a,"_blank")}function F(){l.value==="employees"&&W.value?L(W.value.tickets):l.value==="categories"&&n.value&&C(n.value.id)}return te(()=>t.isVisible,r=>{r||(e.value=0,l.value="categories",o.value=null,n.value=null,W.value=null,k.value=[],h.value=null,D.value=[],R.value=[])}),(r,a)=>f.isVisible?(i(),d("div",gt,[s("div",pt,[e.value===0?(i(),d("div",Tt,[s("button",{class:X(["modal__tab",{"modal__tab--active":l.value==="categories"}]),onClick:a[0]||(a[0]=p=>I("categories"))}," –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º ",2),s("button",{class:X(["modal__tab",{"modal__tab--active":l.value==="employees"}]),onClick:a[1]||(a[1]=p=>I("employees"))}," –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º ",2)])):q("",!0),M(x,{name:"level",mode:"out-in"},{default:j(()=>{var p,b,$,U;return[l.value==="categories"&&e.value===0?(i(),d("div",ft,[s("header",bt,[a[12]||(a[12]=s("h3",{class:"modal__title"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s("button",{class:"modal__close",onClick:a[2]||(a[2]=_=>r.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Ct,[s("ul",wt,[(i(!0),d(J,null,Z(N.value,_=>(i(),d("li",{key:_.id,class:X(["categories-list__item",{"categories-list__item--clickable":_.count>0}]),onClick:Y=>m(_)},[s("div",Et,[s("div",It,[_.id==="created-this-week"?(i(),d("span",$t,"‚úì")):(i(),d("span",Dt,"‚Üª"))]),s("div",St,[s("div",At,w(_.label),1),s("div",Ut,w(_.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),_.count>0?(i(),d("span",Ot,"‚Üí")):q("",!0)])],10,Wt))),128))])]),s("footer",Bt,[s("button",{class:"btn",onClick:a[3]||(a[3]=_=>r.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="categories"&&e.value===1?(i(),d("div",Rt,[s("header",Nt,[s("button",{class:"btn-back",onClick:g,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),a[13]||(a[13]=s("h3",{class:"modal__title"},"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s("button",{class:"modal__close",onClick:a[4]||(a[4]=_=>r.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Mt,[M(x,{name:"loading",mode:"out-in"},{default:j(()=>[O.value?(i(),d("div",Pt,[...a[14]||(a[14]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):c.value?(i(),d("ul",Ft,[(i(!0),d(J,null,Z(D.value,_=>(i(),d("li",{key:_.id||_.name,class:X(["responsible-list__item",{"responsible-list__item--clickable":_.id&&_.count>0}]),onClick:Y=>z(_,Y),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[s("span",Gt,w(_.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),s("span",Vt,w(_.count??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),_.id&&_.count>0?(i(),d("span",jt,"‚Üí")):q("",!0)],10,Yt))),128))])):(i(),d("p",Lt,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º"))]),_:1})]),s("footer",Ht,[s("button",{class:"btn",onClick:a[5]||(a[5]=_=>r.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="categories"&&e.value===2?(i(),d("div",qt,[s("header",zt,[s("button",{class:"btn-back",onClick:g,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),s("h3",Jt,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+w(((p=n.value)==null?void 0:p.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),s("button",{class:"modal__close",onClick:a[6]||(a[6]=_=>r.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Zt,[M(x,{name:"loading",mode:"out-in"},{default:j(()=>[y.value?(i(),d("div",xt,[...a[15]||(a[15]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):h.value?(i(),d("div",Xt,[a[16]||(a[16]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),a[17]||(a[17]=s("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),s("p",Kt,w(h.value),1),s("button",{class:"btn btn-retry",onClick:F},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):k.value.length===0?(i(),d("div",Qt,[...a[18]||(a[18]=[s("div",{class:"empty-state-icon"},"üìã",-1),s("p",{class:"empty-state-message"},"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é",-1)])])):(i(),d("div",es,[M(ve,{name:"ticket",tag:"div",class:"tickets-list"},{default:j(()=>[(i(!0),d(J,null,Z(k.value,(_,Y)=>(i(),K(ye,{key:_.id,ticket:_,draggable:!1,style:Q({"--ticket-index":Y}),onClick:B},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):l.value==="employees"&&e.value===0?(i(),d("div",ts,[s("header",ss,[a[19]||(a[19]=s("h3",{class:"modal__title"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),s("button",{class:"modal__close",onClick:a[7]||(a[7]=_=>r.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",as,[M(x,{name:"loading",mode:"out-in"},{default:j(()=>[O.value?(i(),d("div",rs,[...a[20]||(a[20]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):P.value?(i(),d("ul",os,[(i(!0),d(J,null,Z(R.value,_=>(i(),d("li",{key:_.id||_.name,class:X(["responsible-list__item",{"responsible-list__item--clickable":_.id&&_.totalCount>0}]),onClick:Y=>S(_,Y),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞–¥–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[s("span",ns,w(_.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),s("span",cs,w(_.totalCount??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),_.id&&_.totalCount>0?(i(),d("span",ds,"‚Üí")):q("",!0)],10,is))),128))])):(i(),d("p",ls,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"))]),_:1})]),s("footer",us,[s("button",{class:"btn",onClick:a[8]||(a[8]=_=>r.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="employees"&&e.value===1?(i(),d("div",ks,[s("header",vs,[s("button",{class:"btn-back",onClick:g,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),s("h3",ys,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+w(((b=n.value)==null?void 0:b.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),s("button",{class:"modal__close",onClick:a[9]||(a[9]=_=>r.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",_s,[s("ul",ms,[(i(!0),d(J,null,Z(u.value,_=>(i(),d("li",{key:_.id,class:X(["categories-list__item",{"categories-list__item--clickable":_.count>0}]),onClick:Y=>A(_)},[s("div",gs,[s("div",ps,[_.id==="this-week"?(i(),d("span",Ts,"‚úì")):(i(),d("span",fs,"‚Üª"))]),s("div",bs,[s("div",Cs,w(_.label),1),s("div",ws,w(_.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),_.count>0?(i(),d("span",Ws,"‚Üí")):q("",!0)])],10,hs))),128))])]),s("footer",Es,[s("button",{class:"btn",onClick:a[10]||(a[10]=_=>r.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value==="employees"&&e.value===2?(i(),d("div",Is,[s("header",$s,[s("button",{class:"btn-back",onClick:g,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),s("h3",Ds," –¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+w((($=n.value)==null?void 0:$.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")+" ("+w(((U=W.value)==null?void 0:U.label)||"")+") ",1),s("button",{class:"modal__close",onClick:a[11]||(a[11]=_=>r.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Ss,[M(x,{name:"loading",mode:"out-in"},{default:j(()=>{var _;return[y.value?(i(),d("div",As,[...a[21]||(a[21]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):h.value?(i(),d("div",Us,[a[22]||(a[22]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),a[23]||(a[23]=s("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),s("p",Os,w(h.value),1),s("button",{class:"btn btn-retry",onClick:F},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):k.value.length===0?(i(),d("div",Bs,[a[24]||(a[24]=s("div",{class:"empty-state-icon"},"üìã",-1)),s("p",Rs,w(l.value==="employees"?`–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${((_=W.value)==null?void 0:_.label)||""}"`:"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é"),1)])):(i(),d("div",Ns,[M(ve,{name:"ticket",tag:"div",class:"tickets-list"},{default:j(()=>[(i(!0),d(J,null,Z(k.value,(Y,ee)=>(i(),K(ye,{key:Y.id,ticket:Y,draggable:!1,style:Q({"--ticket-index":ee}),onClick:B},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):q("",!0)]}),_:1})])])):q("",!0)}},Ps=ue(Ms,[["__scopeId","data-v-a33ffe22"]]),Ls={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Fs={class:"modal"},Ys={key:"level-1",class:"level-1"},Gs={class:"modal__header"},Vs={class:"modal__body"},js={key:"loading",class:"loading-names"},Hs={key:"empty",class:"modal__empty"},qs={key:"list",class:"stages-list"},zs=["onClick"],Js={class:"stages-list__name"},Zs={class:"stages-list__count"},xs={key:0,class:"stages-list__arrow"},Xs={class:"modal__footer"},Ks={key:"level-2",class:"level-2"},Qs={class:"modal__header"},ea={class:"modal__title"},ta={class:"modal__body"},sa={key:"loading",class:"loading-state"},aa={key:"error",class:"error-state"},ra={class:"error-message"},la={key:"empty",class:"empty-state"},oa={class:"empty-state-message"},ia={key:"tickets",class:"tickets-list-container"},na={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:t}){const e=f,l=E(1),o=E(null),n=E([]),W=E(!1),k=E(!1),y=E(null),h=E([]),D=H(()=>h.value.length>0&&h.value.some(v=>v.count>0));async function R(){if(!e.weekStartUtc||!e.weekEndUtc){h.value=[];return}k.value=!0,y.value=null;try{const v=await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeNewTicketsByStages:!0});h.value=v.data.newTicketsByStages||[]}catch(v){y.value=v.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–π",console.error("[StagesModal] Error loading stages:",v),h.value=[]}finally{k.value=!1}}async function O(v,c=null){!v||v.count===0||(c&&c.currentTarget&&(c.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{c.currentTarget&&(c.currentTarget.style.transform="")},150)),o.value=v,l.value=2,await N(v.stageId))}async function N(v){var c;W.value=!0,y.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const m=(c=(await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:c.find(A=>A.stageId===v),S=(m==null?void 0:m.tickets)||[];try{const{prepareTicketsForDisplay:A}=await de(async()=>{const{prepareTicketsForDisplay:L}=await import("./ticketListUtils-G6myjvIn.js").then(G=>G.t);return{prepareTicketsForDisplay:L}},__vite__mapDeps([0,1,2,3,4,5]));n.value=await A(S,null,null)}catch(A){console.error("[StagesModal] Error preparing tickets:",A),n.value=S}n.value.length===0&&(y.value=null)}catch(I){y.value=I.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[StagesModal] Error loading tickets:",I),n.value=[]}finally{W.value=!1}}function T(){l.value=1,o.value=null,n.value=[],y.value=null}function u(v){const c=he(v.id);window.open(c,"_blank")}function P(){o.value&&N(o.value.stageId)}return te(()=>e.isVisible,v=>{v?R():(l.value=1,o.value=null,n.value=[],y.value=null,h.value=[])}),te([()=>e.weekStartUtc,()=>e.weekEndUtc],()=>{e.isVisible&&R()}),(v,c)=>f.isVisible?(i(),d("div",Ls,[s("div",Fs,[M(x,{name:"level",mode:"out-in"},{default:j(()=>{var I;return[l.value===1?(i(),d("div",Ys,[s("header",Gs,[c[3]||(c[3]=s("h3",{class:"modal__title"},"–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),s("button",{class:"modal__close",onClick:c[0]||(c[0]=m=>v.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Vs,[M(x,{name:"loading",mode:"out-in"},{default:j(()=>[k.value?(i(),d("div",js,[...c[4]||(c[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–π...",-1)])])):D.value?(i(),d("ul",qs,[(i(!0),d(J,null,Z(h.value,m=>(i(),d("li",{key:m.stageId,class:X(["stages-list__item",{"stages-list__item--clickable":m.count>0}]),style:Q({"--stage-color":m.color}),onClick:S=>O(m,S),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏"},[s("span",{class:"stages-list__color",style:Q({backgroundColor:m.color})},null,4),s("span",Js,w(m.stageName),1),s("span",Zs,w(m.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),m.count>0?(i(),d("span",xs,"‚Üí")):q("",!0)],14,zs))),128))])):(i(),d("p",Hs," –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),s("footer",Xs,[s("button",{class:"btn",onClick:c[1]||(c[1]=m=>v.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value===2?(i(),d("div",Ks,[s("header",Qs,[s("button",{class:"btn-back",onClick:T,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),s("h3",ea," –¢–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏: "+w(((I=o.value)==null?void 0:I.stageName)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),s("button",{class:"modal__close",onClick:c[2]||(c[2]=m=>v.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",ta,[M(x,{name:"loading",mode:"out-in"},{default:j(()=>{var m;return[W.value?(i(),d("div",sa,[...c[5]||(c[5]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):y.value?(i(),d("div",aa,[c[6]||(c[6]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),c[7]||(c[7]=s("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),s("p",ra,w(y.value),1),s("button",{class:"btn btn-retry",onClick:P},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):n.value.length===0?(i(),d("div",la,[c[8]||(c[8]=s("div",{class:"empty-state-icon"},"üìã",-1)),s("p",oa," –ù–∞ —Å—Ç–∞–¥–∏–∏ ¬´"+w((m=o.value)==null?void 0:m.stageName)+"¬ª –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é ",1)])):(i(),d("div",ia,[M(ve,{name:"ticket",tag:"div",class:"tickets-list"},{default:j(()=>[(i(!0),d(J,null,Z(n.value,(S,A)=>(i(),K(ye,{key:S.id,ticket:S,draggable:!1,style:Q({"--ticket-index":A}),onClick:u},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):q("",!0)]}),_:1})])])):q("",!0)}},ca=ue(na,[["__scopeId","data-v-d15a3c66"]]),da={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},ua={class:"modal"},ka={key:"level-1",class:"level-1"},va={class:"modal__header"},ya={class:"modal__body"},_a={key:"loading",class:"loading-names"},ma={key:"empty",class:"modal__empty"},ha={key:"list",class:"duration-list"},ga=["onClick"],pa={class:"duration-list__name"},Ta={class:"duration-list__count"},fa={key:0,class:"duration-list__arrow"},ba={class:"modal__footer"},Ca={key:"level-2",class:"level-2"},wa={class:"modal__header"},Wa={class:"modal__title"},Ea={class:"modal__body"},Ia={key:"loading",class:"loading-state"},$a={key:"error",class:"error-state"},Da={class:"error-message"},Sa={key:"empty",class:"empty-state"},Aa={class:"empty-state-message"},Ua={key:"tickets",class:"tickets-list-container"},Oa={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:t}){const e=f,l=E(1),o=E(null),n=E([]),W=E(!1),k=E(!1),y=E(null),h=E([]),D=H(()=>h.value.length>0&&h.value.some(v=>v.count>0));async function R(){if(!e.weekStartUtc||!e.weekEndUtc){h.value=[];return}k.value=!0,y.value=null;try{const v=await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});h.value=v.data.carryoverTicketsByDuration||[]}catch(v){y.value=v.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π",console.error("[CarryoverDurationModal] Error loading categories:",v),h.value=[]}finally{k.value=!1}}async function O(v,c=null){!v||v.count===0||(c&&c.currentTarget&&(c.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{c.currentTarget&&(c.currentTarget.style.transform="")},150)),o.value=v,l.value=2,await N(v.durationCategory))}async function N(v){var c;W.value=!0,y.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const m=(c=(await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})).data.carryoverTicketsByDuration)==null?void 0:c.find(A=>A.durationCategory===v),S=(m==null?void 0:m.tickets)||[];try{const{prepareTicketsForDisplay:A}=await de(async()=>{const{prepareTicketsForDisplay:L}=await import("./ticketListUtils-G6myjvIn.js").then(G=>G.t);return{prepareTicketsForDisplay:L}},__vite__mapDeps([0,1,2,3,4,5]));n.value=await A(S,null,null)}catch(A){console.error("[CarryoverDurationModal] Error preparing tickets:",A),n.value=S}n.value.length===0&&(y.value=null)}catch(I){y.value=I.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[CarryoverDurationModal] Error loading tickets:",I),n.value=[]}finally{W.value=!1}}function T(){l.value=1,o.value=null,n.value=[],y.value=null}function u(v){const c=he(v.id);window.open(c,"_blank")}function P(){o.value&&N(o.value.durationCategory)}return te(()=>e.isVisible,v=>{v?R():(l.value=1,o.value=null,n.value=[],y.value=null,h.value=[])}),te([()=>e.weekStartUtc,()=>e.weekEndUtc],()=>{e.isVisible&&R()}),(v,c)=>f.isVisible?(i(),d("div",da,[s("div",ua,[M(x,{name:"level",mode:"out-in"},{default:j(()=>{var I;return[l.value===1?(i(),d("div",ka,[s("header",va,[c[3]||(c[3]=s("h3",{class:"modal__title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ä–æ–∫–∞–º",-1)),s("button",{class:"modal__close",onClick:c[0]||(c[0]=m=>v.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",ya,[M(x,{name:"loading",mode:"out-in"},{default:j(()=>[k.value?(i(),d("div",_a,[...c[4]||(c[4]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...",-1)])])):D.value?(i(),d("ul",ha,[(i(!0),d(J,null,Z(h.value,m=>(i(),d("li",{key:m.durationCategory,class:X(["duration-list__item",{"duration-list__item--clickable":m.count>0}]),style:Q({"--duration-color":m.color}),onClick:S=>O(m,S),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},[s("span",{class:"duration-list__color",style:Q({backgroundColor:m.color})},null,4),s("span",pa,w(m.durationLabel),1),s("span",Ta,w(m.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),m.count>0?(i(),d("span",fa,"‚Üí")):q("",!0)],14,ga))),128))])):(i(),d("p",ma," –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),s("footer",ba,[s("button",{class:"btn",onClick:c[1]||(c[1]=m=>v.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):l.value===2?(i(),d("div",Ca,[s("header",wa,[s("button",{class:"btn-back",onClick:T,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),s("h3",Wa," –¢–∏–∫–µ—Ç—ã: "+w(((I=o.value)==null?void 0:I.durationLabel)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),s("button",{class:"modal__close",onClick:c[2]||(c[2]=m=>v.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),s("section",Ea,[M(x,{name:"loading",mode:"out-in"},{default:j(()=>{var m;return[W.value?(i(),d("div",Ia,[...c[5]||(c[5]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):y.value?(i(),d("div",$a,[c[6]||(c[6]=s("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),c[7]||(c[7]=s("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),s("p",Da,w(y.value),1),s("button",{class:"btn btn-retry",onClick:P},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):n.value.length===0?(i(),d("div",Sa,[c[8]||(c[8]=s("div",{class:"empty-state-icon"},"üìã",-1)),s("p",Aa," –í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´"+w((m=o.value)==null?void 0:m.durationLabel)+"¬ª –Ω–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ ",1)])):(i(),d("div",Ua,[M(ve,{name:"ticket",tag:"div",class:"tickets-list"},{default:j(()=>[(i(!0),d(J,null,Z(n.value,(S,A)=>(i(),K(ye,{key:S.id,ticket:S,draggable:!1,style:Q({"--ticket-index":A}),onClick:u},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):q("",!0)]}),_:1})])])):q("",!0)}},Ba=ue(Oa,[["__scopeId","data-v-83a6f8c8"]]),Ra={class:"ac-dashboard"},Na={key:1},Ma={class:"dashboard-header"},Pa={class:"header-content"},La={class:"breadcrumbs-row"},Fa=["aria-label","aria-disabled","data-fallback","disabled"],Ya={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Ga={class:"dashboard-layout"},Va={class:"filters-container"},ja={class:"chart-container"},Ha={__name:"GraphAdmissionClosureDashboard",setup(f){const t=Be(),e=E(!0),l=E(null),o=E(null),n=E({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),W=E(!1),k=E(!1),y=E(!1),h=E(!1),D=H(()=>typeof window>"u"?!1:window.history.length>1),R=H(()=>D.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),O={name:"dashboard-sector-1c"};function N(C){var g;if((g=C==null?void 0:C.preventDefault)==null||g.call(C),!h.value){h.value=!0;try{if(D.value){t.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),t.push(O)}finally{h.value=!1}}}const T=E({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),u=E(null),P=H(()=>{const C=T.value.customDateRange.startDate||T.value.customDateRange.endDate,g=T.value.employees.length===1&&T.value.employees.includes("all");return C||!g});async function v(){e.value=!0,l.value=null;try{let C,g;if(u.value)C=u.value.startUtc,g=u.value.endUtc;else{const r=z();C=r.weekStartUtc,g=r.weekEndUtc}const{meta:B,data:F}=await se({product:"1C",weekStartUtc:C,weekEndUtc:g,includeTickets:!0});o.value=B,n.value=F,!u.value&&B&&(u.value={weekNumber:B.weekNumber,startUtc:B.weekStartUtc,endUtc:B.weekEndUtc})}catch(C){l.value=C instanceof Error?C:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureDashboard] loadData error:",C)}finally{e.value=!1}}function c(C){T.value.stages=C}function I(C){T.value.employees=C}function m(C){T.value.dateRange=C}function S(C){T.value.customDateRange=C}function A(C){u.value=C}function L(){T.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},G()}function G(){v()}Ue(()=>{v()});function z(){const C=new Date,g=new Date(Date.UTC(C.getUTCFullYear(),C.getUTCMonth(),C.getUTCDate())),B=g.getUTCDay(),F=g.getUTCDate()-B+(B===0?-6:1),r=new Date(Date.UTC(g.getUTCFullYear(),g.getUTCMonth(),F,0,0,0)),a=new Date(r);return a.setUTCDate(a.getUTCDate()+6),a.setUTCHours(23,59,59,999),{weekStartUtc:r.toISOString(),weekEndUtc:a.toISOString()}}return(C,g)=>{var F,r,a,p,b,$;const B=Re("router-link");return i(),d("div",Ra,[e.value?(i(),K(Ne,{key:0,message:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."})):(i(),d("div",Na,[s("div",Ma,[s("div",Pa,[s("div",La,[s("button",{class:"btn-back-link",type:"button",onClick:N,"aria-label":R.value,"aria-disabled":!D.value,"data-fallback":!D.value,disabled:h.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,Fa),s("nav",Ya,[M(B,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:j(()=>[...g[6]||(g[6]=[We(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),g[8]||(g[8]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),M(B,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:j(()=>[...g[7]||(g[7]=[We(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),g[9]||(g[9]=s("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),g[10]||(g[10]=s("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),g[11]||(g[11]=s("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),g[12]||(g[12]=s("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),s("div",Ga,[s("div",Va,[M(Me,{stages:T.value.stages,employees:T.value.employees,dateRange:T.value.dateRange,customDateRange:T.value.customDateRange,hasActiveFilters:P.value,hideStages:!0,weekPickerMode:!0,selectedWeek:u.value,weeksCount:52,"onUpdate:stages":c,"onUpdate:employees":I,"onUpdate:dateRange":m,"onUpdate:customDateRange":S,"onUpdate:selectedWeek":A,onReset:L,onApply:G},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","selectedWeek"])]),s("div",ja,[l.value?(i(),K(Oe,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:l.value.message},null,8,["message"])):(i(),K(_t,{key:1,meta:o.value,data:n.value,onOpenResponsible:g[0]||(g[0]=U=>W.value=!0),onOpenStages:g[1]||(g[1]=U=>k.value=!0),onOpenCarryover:g[2]||(g[2]=U=>y.value=!0)},null,8,["meta","data"]))])])])),M(Ps,{"is-visible":W.value,responsible:n.value.responsible||[],"closed-tickets-created-this-week":n.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":n.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":n.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":n.value.responsibleCreatedOtherWeek||[],"week-start-utc":((F=o.value)==null?void 0:F.weekStartUtc)||null,"week-end-utc":((r=o.value)==null?void 0:r.weekEndUtc)||null,onClose:g[3]||(g[3]=U=>W.value=!1)},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-start-utc","week-end-utc"]),M(ca,{"is-visible":k.value,"week-start-utc":((a=o.value)==null?void 0:a.weekStartUtc)||null,"week-end-utc":((p=o.value)==null?void 0:p.weekEndUtc)||null,onClose:g[4]||(g[4]=U=>k.value=!1)},null,8,["is-visible","week-start-utc","week-end-utc"]),M(Ba,{"is-visible":y.value,"week-start-utc":((b=o.value)==null?void 0:b.weekStartUtc)||null,"week-end-utc":(($=o.value)==null?void 0:$.weekEndUtc)||null,onClose:g[5]||(g[5]=U=>y.value=!1)},null,8,["is-visible","week-start-utc","week-end-utc"])])}}},Xa=ue(Ha,[["__scopeId","data-v-56000c45"]]);export{Xa as default};
