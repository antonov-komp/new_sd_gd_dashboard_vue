const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./main-mT8e_jU8.js","./chunk-J8T_k_VI.js","./chunk-D6qpehdW.js","./chunk-D7RN4oku.js","./chunk-CTkRI_nh.js","./chunk-DXXtrsqw.js"])))=>i.map(i=>d[i]);
import{l as h,c as r,o as n,e,t as i,F as U,j as W,n as A,i as $,k as K,a6 as S,g as E,m as Z,f as z,b as N,a as I,w as O,T as Q,C as oe,z as ne,D as ie,h as re,u as ce,r as de}from"./chunk-J8T_k_VI.js";import{g as ee,_ as ue}from"./chunk-D6qpehdW.js";import{_ as H}from"./main-mT8e_jU8.js";import"./chunk-D7RN4oku.js";import"./chunk-CTkRI_nh.js";import"./chunk-DXXtrsqw.js";const te="/api/tickets-time-tracking-sector-1c.php";function me(s){if(!s)return{meta:null,data:{totalElapsedTime:0,totalElapsedTimeUnit:"hours",totalRecordsCount:0,weeks:[],employeesSummary:[]}};const p=s.data||s.result||s,l=p.meta||s.meta||null;return{meta:{weekNumber:l?.weekNumber??null,weekStartUtc:l?.weekStartUtc??null,weekEndUtc:l?.weekEndUtc??null,totalWeeks:l?.totalWeeks??0,sector1CEmployeesCount:l?.sector1CEmployeesCount??0},data:{totalElapsedTime:p.data?.totalElapsedTime??p.totalElapsedTime??0,totalElapsedTimeUnit:p.data?.totalElapsedTimeUnit??p.totalElapsedTimeUnit??"hours",totalRecordsCount:p.data?.totalRecordsCount??p.totalRecordsCount??0,weeks:p.data?.weeks??p.weeks??[],employeesSummary:p.data?.employeesSummary??p.employeesSummary??[]}}}async function ke(s={}){const{product:p="1C",weekStartUtc:l=null,weekEndUtc:g=null,weeksCount:m=4}=s;try{const d=ee(te),b=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:p,weekStartUtc:l,weekEndUtc:g,weeksCount:m})});if(!b.ok)throw new Error(`HTTP error! status: ${b.status}`);const v=await b.json();if(v.error)throw new Error(v.error_description||v.error||"Unknown error");const y=me(v);if(v.cache_used===!0){const{CacheNotificationService:x}=await ue(async()=>{const{CacheNotificationService:L}=await import("./main-mT8e_jU8.js").then(M=>M.h);return{CacheNotificationService:L}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);x.notifyCacheUsed("–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°")}return y}catch(d){throw console.error("[TimeTrackingService] Error fetching time tracking data:",d),d}}async function ve({taskIds:s,employeeId:p,weekNumber:l,page:g=1,perPage:m=10}){if(!s||!Array.isArray(s)||s.length===0)return{tasks:[],pagination:{totalTasks:0,currentPage:1,perPage:m,totalPages:0}};try{const d=ee(te),b=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:"1C",includeTaskDetails:!0,taskIds:s,employeeId:p||void 0,weekNumber:l||void 0,page:g,perPage:m})});if(!b.ok)throw new Error(`HTTP error! status: ${b.status}`);const v=await b.json();if(!v.success)throw new Error(v.error||v.error_description||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–¥–∞—á–∞—Ö");return{tasks:v.data.tasks||[],pagination:v.data.pagination||{totalTasks:0,currentPage:1,perPage:m,totalPages:0}}}catch(d){throw console.error("[timeTrackingService] Error loading tasks details:",d),d}}const ae={getTimeTrackingData:ke,getTasksDetails:ve};function D(s,p=1){return typeof s!="number"||isNaN(s)?"0 —á":`${s.toFixed(p)} —á`}function F(s,p){if(!s||!p)return`–ù–µ–¥–µ–ª—è ${s||"?"}`;try{const l=new Date(p),g=new Date(l);g.setDate(g.getDate()+6);const m=l.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}),d=g.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"});return`–ù–µ–¥–µ–ª—è ${s} (${m} - ${d})`}catch(l){return console.error("[TimeTrackingUtils] Error formatting week label:",l),`–ù–µ–¥–µ–ª—è ${s}`}}function pe(s){return!s||!s.data?!1:s.data.totalRecordsCount>0||s.data.weeks&&s.data.weeks.length>0}const ye={class:"ttt-summary"},_e={class:"summary-cards"},be={class:"summary-card summary-card--total"},fe={class:"summary-card__content"},ge={class:"summary-card__value"},we={class:"summary-card summary-card--employees"},Te={class:"summary-card__content"},he={class:"summary-card__value"},De={class:"summary-card summary-card--average"},Ce={class:"summary-card__content"},$e={class:"summary-card__value"},Ne={__name:"TicketsTimeTrackingSummary",props:{data:{type:Object,required:!0}},setup(s){const p=s,l=h(()=>p.data?.data?.totalElapsedTime||0),g=h(()=>p.data?.meta?.sector1CEmployeesCount||0),m=h(()=>{const v=l.value,y=g.value;return y>0?v/y:0}),d=h(()=>l.value===0?"0.0 —á":D(l.value,1)),b=h(()=>m.value===0?"0.00 —á":D(m.value,2));return(v,y)=>(n(),r("div",ye,[e("div",_e,[e("div",be,[y[1]||(y[1]=e("div",{class:"summary-card__icon"},"‚è±",-1)),e("div",fe,[y[0]||(y[0]=e("div",{class:"summary-card__label"},"–û–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç",-1)),e("div",ge,i(d.value),1)])]),e("div",we,[y[3]||(y[3]=e("div",{class:"summary-card__icon"},"üë•",-1)),e("div",Te,[y[2]||(y[2]=e("div",{class:"summary-card__label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ —Å–µ–∫—Ç–æ—Ä–µ",-1)),e("div",he,i(g.value),1)])]),e("div",De,[y[5]||(y[5]=e("div",{class:"summary-card__icon"},"üìä",-1)),e("div",Ce,[y[4]||(y[4]=e("div",{class:"summary-card__label"},"–°—Ä–µ–¥–Ω—è—è –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞",-1)),e("div",$e,i(b.value),1)])])])]))}},Ee=H(Ne,[["__scopeId","data-v-51b124c7"]]),Pe={class:"ttt-table-container"},Se={key:0,class:"ttt-table-loading"},Ue={key:1,class:"ttt-table-error"},We={key:2,class:"ttt-table-empty"},Me={key:3,class:"ttt-table-wrapper"},xe={class:"ttt-table"},Le=["onClick"],Ae={class:"ttt-table__header-week-date"},Ie=["onClick"],Oe={class:"ttt-table__cell-employee"},Re=["onClick"],je={class:"ttt-table__cell-total"},Ve={class:"ttt-table__row-total"},Be=["onClick"],Fe={class:"ttt-table__cell-total"},ze={__name:"TicketsTimeTrackingTable",props:{data:{type:Object,required:!0},loading:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["cell-click","employee-click","week-click"],setup(s,{emit:p}){const l=s,g=p,m=h(()=>l.data?.data?.weeks||[]),d=h(()=>{if(!l.data||!l.data.data||!l.data.data.weeks)return null;const f=l.data.data.weeks||[],c=(l.data.data.employeesSummary||[]).map(T=>{const k={};let C=0;return f.forEach(j=>{const V=j.employees?.find(q=>q.id===T.id)?.elapsedTime||0;k[j.weekNumber]=V,C+=V}),{id:T.id,name:T.name,weeks:k,total:C}}),w={};let P=0;return f.forEach(T=>{w[T.weekNumber]=T.totalElapsedTime||0,P+=T.totalElapsedTime||0}),{employees:c,weekTotals:w,grandTotal:P}}),b=(f,u)=>d.value?.employees.find(w=>w.id===f)?.weeks[u]||0,v=f=>d.value?.weekTotals[f]||0,y=f=>{if(!f)return"";try{return new Date(f).toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}catch{return""}},x=(f,u)=>{const c=d.value?.employees.find(P=>P.id===f),w=l.data?.data?.weeks?.find(P=>P.weekNumber===u);c&&w&&g("cell-click",{employee:c,week:w,elapsedTime:b(f,u)})},L=f=>{const u=d.value?.employees.find(c=>c.id===f);u&&g("employee-click",{employee:u,weeks:m.value.map(c=>({week:c,elapsedTime:b(f,c.weekNumber)}))})},M=f=>{const u=m.value.find(c=>c.weekNumber===f);u&&g("week-click",{week:u,employees:d.value?.employees.map(c=>({employee:c,elapsedTime:b(c.id,f)})).filter(c=>c.elapsedTime>0)})};return(f,u)=>(n(),r("div",Pe,[s.loading?(n(),r("div",Se," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):s.error?(n(),r("div",Ue,i(s.error),1)):!d.value||d.value.employees.length===0?(n(),r("div",We," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ")):(n(),r("div",Me,[e("table",xe,[e("thead",null,[e("tr",null,[u[1]||(u[1]=e("th",{class:"ttt-table__header-employee"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",-1)),(n(!0),r(U,null,W(m.value,c=>(n(),r("th",{key:c.weekNumber,class:A(["ttt-table__header-week",{"ttt-table__header--clickable":!0}]),onClick:w=>M(c.weekNumber)},[$(" –ù–µ–¥–µ–ª—è "+i(c.weekNumber),1),u[0]||(u[0]=e("br",null,null,-1)),e("span",Ae,i(y(c.weekStartUtc)),1)],8,Le))),128)),u[2]||(u[2]=e("th",{class:"ttt-table__header-total"},"–ò—Ç–æ–≥–æ",-1))])]),e("tbody",null,[(n(!0),r(U,null,W(d.value.employees,c=>(n(),r("tr",{key:c.id,class:A(["ttt-table__row",{"ttt-table__row--clickable":!0}]),onClick:w=>L(c.id)},[e("td",Oe,i(c.name),1),(n(!0),r(U,null,W(m.value,w=>(n(),r("td",{key:`${c.id}-${w.weekNumber}`,class:A(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:K(P=>x(c.id,w.weekNumber),["stop"])},i(S(D)(b(c.id,w.weekNumber))),9,Re))),128)),e("td",je,[e("strong",null,i(S(D)(c.total)),1)])],8,Ie))),128)),e("tr",Ve,[u[3]||(u[3]=e("td",{class:"ttt-table__cell-employee"},[e("strong",null,"–í–°–ï–ì–û")],-1)),(n(!0),r(U,null,W(m.value,c=>(n(),r("td",{key:`total-${c.weekNumber}`,class:A(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:w=>M(c.weekNumber)},[e("strong",null,i(S(D)(v(c.weekNumber))),1)],8,Be))),128)),e("td",Fe,[e("strong",null,i(S(D)(d.value.grandTotal)),1)])])])])]))]))}},He=H(ze,[["__scopeId","data-v-8021e5e4"]]),qe={class:"modal-header"},Ge={class:"modal-body"},Je={key:"level-1",class:"detail-cell"},Ke={class:"detail-info"},Qe={key:0,class:"tasks-list"},Xe={class:"task-header"},Ye={class:"task-label"},Ze={class:"task-time"},et={key:0,class:"ticket-info"},tt={class:"ticket-label"},at=["title"],st={key:1,class:"ticket-title"},lt={key:1,class:"ticket-info ticket-info--no-ticket"},ot={class:"detail-total"},nt={key:0,class:"detail-actions"},it={key:"level-2",class:"tasks-list-level"},rt={class:"tasks-list-header"},ct={class:"tasks-list-title"},dt={class:"tasks-list-content"},ut={key:"loading",class:"loading-state"},mt={key:"error",class:"error-state"},kt={class:"error-message"},vt={key:"empty",class:"empty-state"},pt={key:"tasks",class:"tasks-cards-container"},yt=["onClick"],_t={class:"task-card__header"},bt={class:"task-card__number"},ft={key:0,class:"task-card__time"},gt={class:"task-card__title"},wt={class:"task-card__dates"},Tt={class:"task-card__date-item"},ht={class:"date-value"},Dt={class:"task-card__date-item"},Ct={class:"task-card__date-item"},$t={class:"date-value"},Nt={key:0,class:"task-card__ticket"},Et={class:"ticket-header"},Pt={class:"ticket-header__left"},St={class:"ticket-id"},Ut=["title"],Wt={class:"ticket-title"},Mt={class:"ticket-meta"},xt={class:"ticket-meta__row"},Lt={class:"ticket-meta__item"},At={class:"meta-value"},It={class:"ticket-meta__item"},Ot={class:"meta-value"},Rt={class:"ticket-meta__row"},jt={class:"ticket-meta__item"},Vt={class:"meta-value"},Bt={class:"ticket-meta__item"},Ft={class:"meta-value"},zt={class:"ticket-dates"},Ht={class:"ticket-date-item"},qt={class:"date-value"},Gt={key:1,class:"task-card__no-ticket"},Jt={key:0,class:"tasks-pagination"},Kt=["disabled"],Qt={class:"pagination-pages"},Xt=["onClick"],Yt=["disabled"],Zt={key:"employee",class:"detail-employee"},ea={class:"detail-info"},ta={class:"weeks-list"},aa={class:"week-header"},sa={class:"week-label"},la={class:"week-time"},oa={key:"week",class:"detail-week"},na={class:"detail-info"},ia={class:"employees-list"},ra={class:"employee-header"},ca={class:"employee-label"},da={class:"employee-time"},ua={__name:"TimeTrackingDetailModal",props:{cellData:{type:Object,default:null}},emits:["close"],setup(s,{emit:p}){const l=s,g=p,m=E(1),d=E([]),b=E(!1),v=E(null),y=E(1),x=E(10),L=h(()=>{if(!l.cellData)return"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç";if(m.value===2)return`–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: ${l.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}, –ù–µ–¥–µ–ª—è ${l.cellData.week?.weekNumber||"?"}`;if(l.cellData.type==="employee")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${l.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}`;if(l.cellData.type==="week")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: –ù–µ–¥–µ–ª—è ${l.cellData.week?.weekNumber||"?"}`;const o=l.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",t=l.cellData.week?.weekNumber||"?",a=D(l.cellData.elapsedTime||0);return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${o}, –ù–µ–¥–µ–ª—è ${t} (${a})`}),M=h(()=>l.cellData?.week?.employees&&l.cellData.week.employees.find(t=>t.id===l.cellData.employee?.id)?.tasksCount||0),f=h(()=>l.cellData?.week?.employees&&l.cellData.week.employees.find(t=>t.id===l.cellData.employee?.id)?.ticketsCount||0);h(()=>l.cellData?.week?.weekNumber||null);const u=E({totalTasks:0,currentPage:1,perPage:10,totalPages:0}),c=h(()=>u.value.totalPages),w=h(()=>d.value),P=h(()=>{const o=[];let a=Math.max(1,u.value.currentPage-Math.floor(2.5)),_=Math.min(c.value,a+5-1);_-a<4&&(a=Math.max(1,_-5+1));for(let R=a;R<=_;R++)o.push(R);return o}),T=o=>{if(!o||o.length===0)return"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω";if(o.length===1)return F(o[0].week.weekNumber,o[0].week.weekStartUtc);const t=o[0].week,a=o[o.length-1].week;return`${F(t.weekNumber,t.weekStartUtc)} - ${F(a.weekNumber,a.weekStartUtc)}`},k=o=>o?F(o.weekNumber,o.weekStartUtc):"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω",C=o=>{if(!o)return"-";try{const t=new Date(o);return isNaN(t.getTime())?"-":t.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return console.warn("[TimeTrackingDetailModal] Error formatting date:",o,t),"-"}},j=(o,t)=>{if(t)try{const a=new Date(t);if(!isNaN(a.getTime()))return!1}catch{}if(!o)return!1;try{const a=new Date(o);return isNaN(a.getTime())?!1:new Date>a}catch(a){return console.warn("[TimeTrackingDetailModal] Error checking overdue:",o,a),!1}},X=o=>{const t=o.closedDate?new Date(o.closedDate):null,a=j(o.deadline,o.closedDate);return{"task-card--completed":!!t,"task-card--overdue":a,"task-card--in-progress":!t&&!a}},V=async()=>{m.value=2,await G()},q=()=>{m.value=1,d.value=[],v.value=null,y.value=1,u.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0}},Y=o=>!o||typeof o!="object"?!1:!o.id||typeof o.id!="number"?(console.warn("[TimeTrackingDetailModal] Invalid task (no ID):",o),!1):!0,G=async()=>{if(!l.cellData?.week?.employees||!l.cellData.employee){v.value="–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á";return}b.value=!0,v.value=null;try{const o=l.cellData.week.employees.find(_=>_.id===l.cellData.employee?.id);if(!o){d.value=[];return}let t=[];if(Array.isArray(o.tasks)&&o.tasks.length>0&&(t=o.tasks.map(_=>typeof _=="object"&&_!==null&&_.id?_.id:typeof _=="number"?_:null).filter(_=>_!==null&&_>0)),t.length===0){d.value=[];return}const a=await ae.getTasksDetails({taskIds:t,employeeId:l.cellData.employee.id,weekNumber:l.cellData.week.weekNumber,page:y.value,perPage:x.value});if(!a||!Array.isArray(a.tasks)){console.error("[TimeTrackingDetailModal] Invalid response format:",a),v.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞",d.value=[];return}d.value=a.tasks.filter(Y),u.value=a.pagination||{totalTasks:0,currentPage:1,perPage:x.value,totalPages:0},y.value=u.value.currentPage}catch(o){console.error("[TimeTrackingDetailModal] Error loading tasks details:",{error:o,taskIds:l.cellData?.week?.employees?.find(a=>a.id===l.cellData.employee?.id)?.tasks?.map(a=>a.id)||[],employeeId:l.cellData.employee?.id,weekNumber:l.cellData.week?.weekNumber,timestamp:new Date().toISOString()});const t=o.message||"";t.includes("network")||t.includes("fetch")||t.includes("Failed to fetch")?v.value="–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.":t.includes("timeout")?v.value="–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":t.includes("403")||t.includes("401")?v.value="–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.":t.includes("404")?v.value="–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.":t.includes("500")?v.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":v.value=t||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á",d.value=[]}finally{b.value=!1}},se=()=>{y.value=1,G()};Z(y,()=>{m.value===2&&G()});const J=o=>{if(o>=1&&o<=c.value&&o!==y.value){y.value=o;const t=document.querySelector(".tasks-cards-container");t&&(t.scrollTop=0)}},le=o=>{console.log("[TimeTrackingDetailModal] Task clicked:",o.id)},B=()=>{g("close")};return Z(()=>l.cellData,o=>{o||(m.value=1,d.value=[],v.value=null,y.value=1,u.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0})}),(o,t)=>(n(),z(ie,{to:"body"},[s.cellData?(n(),r("div",{key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:K(B,["self"]),onKeydown:ne(B,["esc"])},[e("div",{class:"modal-content",onClick:t[2]||(t[2]=K(()=>{},["stop"]))},[e("div",qe,[e("h2",null,i(L.value),1),e("button",{class:"close-button",onClick:B,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),e("div",Ge,[I(Q,{name:"level",mode:"out-in"},{default:O(()=>[m.value===1&&(s.cellData.type==="cell"||!s.cellData.type&&s.cellData.employee&&s.cellData.week)?(n(),r("div",Je,[e("div",Ke,[e("p",null,[t[3]||(t[3]=e("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),$(" "+i(s.cellData.employee?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),$(" "+i(s.cellData.week?.weekNumber||"?"),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),$(" "+i(S(D)(s.cellData.elapsedTime||0)),1)])]),s.cellData.week?.employees?(n(),r("div",Qe,[t[8]||(t[8]=e("h3",null,"–ó–∞–¥–∞—á–∏ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã:",-1)),(n(!0),r(U,null,W(s.cellData.week.employees.filter(a=>a.id===s.cellData.employee?.id),a=>(n(),r("div",{key:a.id,class:"employee-tasks"},[(n(!0),r(U,null,W(a.tasks,(_,R)=>(n(),r("div",{class:"task-item",key:R},[e("div",Xe,[e("span",Ye,"–ó–∞–¥–∞—á–∞ #"+i(_.id||R+1),1),e("span",Ze,i(S(D)(_.elapsedTime||0)),1)]),_.ticket?(n(),r("div",et,[e("span",tt,"–¢–∏–∫–µ—Ç #"+i(_.ticket.id),1),_.ticket.createdWeek&&_.ticket.createdWeek!==s.cellData.week.weekNumber?(n(),r("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${_.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${s.cellData.week.weekNumber}`}," (—Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ "+i(_.ticket.createdWeek)+") ",9,at)):N("",!0),_.ticket.title?(n(),r("div",st,i(_.ticket.title),1)):N("",!0)])):(n(),r("div",lt,[...t[6]||(t[6]=[e("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])]))]))),128))]))),128)),e("div",ot,[e("p",null,[t[7]||(t[7]=e("strong",null,"–ò—Ç–æ–≥–æ:",-1)),$(" "+i(S(D)(s.cellData.elapsedTime||0))+" ("+i(M.value)+" –∑–∞–¥–∞—á, "+i(f.value)+" —Ç–∏–∫–µ—Ç–æ–≤) ",1)])]),M.value>0?(n(),r("div",nt,[e("button",{class:"btn btn-primary btn-tasks-list",onClick:V}," üìã –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á ")])):N("",!0)])):N("",!0)])):m.value===2?(n(),r("div",it,[e("div",rt,[e("button",{class:"btn-back",onClick:q,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê –ù–∞–∑–∞–¥ "),e("h3",ct," –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: "+i(s.cellData.employee?.name||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫")+", –ù–µ–¥–µ–ª—è "+i(s.cellData.week?.weekNumber||"?"),1)]),e("div",dt,[I(Q,{name:"loading",mode:"out-in"},{default:O(()=>[b.value?(n(),r("div",ut,[...t[9]||(t[9]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...",-1)])])):v.value?(n(),r("div",mt,[t[10]||(t[10]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),t[11]||(t[11]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",kt,i(v.value),1),e("button",{class:"btn btn-retry",onClick:se},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):d.value.length===0?(n(),r("div",vt,[...t[12]||(t[12]=[e("div",{class:"empty-state-icon"},"üìã",-1),e("p",{class:"empty-state-message"},"–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)])])):(n(),r("div",pt,[I(oe,{name:"task-card",tag:"div",class:"tasks-cards-list"},{default:O(()=>[(n(!0),r(U,null,W(w.value.filter(Y),a=>(n(),r("div",{key:a.id,class:A(["task-card",X(a)]),onClick:_=>le(a)},[e("div",_t,[e("span",bt,"–ó–∞–¥–∞—á–∞ #"+i(a.id),1),a.elapsedTime?(n(),r("span",ft,i(S(D)(a.elapsedTime)),1)):N("",!0)]),e("div",gt,i(a.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),e("div",wt,[e("div",Tt,[t[13]||(t[13]=e("span",{class:"date-icon"},"üìÖ",-1)),t[14]||(t[14]=e("span",{class:"date-label"},"–ù–∞—á–∞–ª–æ:",-1)),e("span",ht,i(C(a.startDate)),1)]),e("div",Dt,[t[15]||(t[15]=e("span",{class:"date-icon"},"‚è∞",-1)),t[16]||(t[16]=e("span",{class:"date-label"},"–î–µ–¥–ª–∞–π–Ω:",-1)),e("span",{class:A(["date-value",{"date-value--overdue":j(a.deadline,a.closedDate)}])},i(C(a.deadline)||"-"),3)]),e("div",Ct,[t[17]||(t[17]=e("span",{class:"date-icon"},"‚úì",-1)),t[18]||(t[18]=e("span",{class:"date-label"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ:",-1)),e("span",$t,i(C(a.closedDate)||"-"),1)])]),a.ticket?(n(),r("div",Nt,[e("div",Et,[e("div",Pt,[e("span",St,"–¢–∏–∫–µ—Ç #"+i(a.ticket.id),1),a.ticket.createdWeek&&a.ticket.createdWeek!==s.cellData.week?.weekNumber?(n(),r("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${a.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${s.cellData.week?.weekNumber}`}," –°–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥. "+i(a.ticket.createdWeek),9,Ut)):N("",!0)])]),e("div",Wt,i(a.ticket.title||a.ticket.ufSubject||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),e("div",Mt,[e("div",xt,[e("div",Lt,[t[19]||(t[19]=e("span",{class:"meta-label"},"–°–µ–∫—Ç–æ—Ä:",-1)),e("span",At,i(a.ticket.ufSlaBlockStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)]),e("div",It,[t[20]||(t[20]=e("span",{class:"meta-label"},"–°–µ—Ä–≤–∏—Å:",-1)),e("span",Ot,i(a.ticket.ufSlaServiceStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])]),e("div",Rt,[e("div",jt,[t[21]||(t[21]=e("span",{class:"meta-label"},"–î–µ–π—Å—Ç–≤–∏–µ:",-1)),e("span",Vt,i(a.ticket.ufActionStr||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),1)]),e("div",Bt,[t[22]||(t[22]=e("span",{class:"meta-label"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:",-1)),e("span",Ft,i(a.ticket.ufCrm7UfPriority||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])])]),e("div",zt,[e("div",Ht,[t[23]||(t[23]=e("span",{class:"date-icon"},"üìÖ",-1)),t[24]||(t[24]=e("span",{class:"date-label"},"–°–æ–∑–¥–∞–Ω:",-1)),e("span",qt,i(C(a.ticket.createdTime)),1)])])])):(n(),r("div",Gt,[...t[25]||(t[25]=[e("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])])),t[26]||(t[26]=e("div",{class:"task-card__status-placeholder"},null,-1))],10,yt))),128))]),_:1}),c.value>1?(n(),r("div",Jt,[e("button",{class:"pagination-btn",disabled:u.value.currentPage===1,onClick:t[0]||(t[0]=a=>J(u.value.currentPage-1))}," ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,Kt),e("div",Qt,[(n(!0),r(U,null,W(P.value,a=>(n(),r("button",{key:a,class:A(["pagination-page",{"pagination-page--active":a===u.value.currentPage}]),onClick:_=>J(a)},i(a),11,Xt))),128))]),e("button",{class:"pagination-btn",disabled:u.value.currentPage===c.value,onClick:t[1]||(t[1]=a=>J(u.value.currentPage+1))}," –°–ª–µ–¥—É—é—â–∞—è ‚Üí ",8,Yt)])):N("",!0)]))]),_:1})])])):m.value===1&&s.cellData.type==="employee"?(n(),r("div",Zt,[e("div",ea,[e("p",null,[t[27]||(t[27]=e("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),$(" "+i(s.cellData.employee?.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),e("p",null,[t[28]||(t[28]=e("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),$(" "+i(T(s.cellData.weeks)),1)])]),e("div",ta,[t[29]||(t[29]=e("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –Ω–µ–¥–µ–ª—è–º:",-1)),(n(!0),r(U,null,W(s.cellData.weeks,a=>(n(),r("div",{key:a.week.weekNumber,class:"week-item"},[e("div",aa,[e("span",sa,"–ù–µ–¥–µ–ª—è "+i(a.week.weekNumber),1),e("span",la,i(S(D)(a.elapsedTime||0)),1)])]))),128))])])):m.value===1&&s.cellData.type==="week"?(n(),r("div",oa,[e("div",na,[e("p",null,[t[30]||(t[30]=e("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),$(" "+i(s.cellData.week?.weekNumber||"?"),1)]),e("p",null,[t[31]||(t[31]=e("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),$(" "+i(k(s.cellData.week)),1)]),e("p",null,[t[32]||(t[32]=e("strong",null,"–û–±—â–∏–µ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),$(" "+i(S(D)(s.cellData.week?.totalElapsedTime||0)),1)])]),e("div",ia,[t[33]||(t[33]=e("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:",-1)),(n(!0),r(U,null,W(s.cellData.employees,a=>(n(),r("div",{key:a.employee.id,class:"employee-item"},[e("div",ra,[e("span",ca,i(a.employee.name),1),e("span",da,i(S(D)(a.elapsedTime||0)),1)])]))),128))])])):N("",!0)]),_:1})]),e("div",{class:"modal-footer"},[e("button",{class:"close-btn",onClick:B},"–ó–∞–∫—Ä—ã—Ç—å")])])],32)):N("",!0)]))}},ma=H(ua,[["__scopeId","data-v-fc33390b"]]),ka={class:"tickets-time-tracking-dashboard"},va={class:"dashboard-header"},pa={class:"breadcrumbs-row"},ya=["aria-label","aria-disabled","data-fallback","disabled"],_a={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},ba={key:"preloader",class:"time-tracking-preloader"},fa={key:"error",class:"error-state"},ga={key:"empty",class:"empty-state"},wa={key:"content",class:"dashboard-content"},Ta={__name:"TicketsTimeTrackingDashboard",setup(s){const p=ce(),l=E(!0),g=E(null),m=E(null),d=E(null),b=E(!1),v=h(()=>pe(m.value)),y=async()=>{l.value=!0,g.value=null;const T=new Promise(k=>setTimeout(k,300));try{const[k,C]=await Promise.all([T,ae.getTimeTrackingData({product:"1C",weeksCount:4})]);m.value=C}catch(k){console.error("[TicketsTimeTrackingDashboard] Error loading data:",k),g.value=k.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}finally{l.value=!1}},x=T=>{d.value=T},L=T=>{d.value={type:"employee",...T}},M=T=>{d.value={type:"week",...T}},f=()=>{d.value=null},u=h(()=>typeof window>"u"?!1:window.history.length>1),c=h(()=>u.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"),w=()=>{b.value||(b.value=!0,u.value?p.go(-1):p.push({name:"dashboard-sector-1c"}),setTimeout(()=>{b.value=!1},300))},P=()=>{p.push("/")};return re(()=>{y()}),(T,k)=>{const C=de("router-link");return n(),r("div",ka,[e("div",va,[e("div",pa,[e("button",{class:"btn-home-link",type:"button",onClick:P,title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),k[7]||(k[7]=e("span",{class:"breadcrumb-separator"},"/",-1)),e("button",{class:"btn-back-link",type:"button",onClick:w,"aria-label":c.value,"aria-disabled":!u.value,"data-fallback":!u.value,disabled:b.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,ya),e("nav",_a,[I(C,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:O(()=>[...k[0]||(k[0]=[$(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),k[3]||(k[3]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),I(C,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:O(()=>[...k[1]||(k[1]=[$(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),k[4]||(k[4]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),I(C,{to:{name:"dashboard-graph-admission-closure"},class:"breadcrumb-link"},{default:O(()=>[...k[2]||(k[2]=[$(" –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π ",-1)])]),_:1}),k[5]||(k[5]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),k[6]||(k[6]=e("span",{class:"breadcrumb-current"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã",-1))])])]),k[10]||(k[10]=e("h1",{class:"dashboard-title"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),N("",!0),I(Q,{name:"fade",mode:"out-in"},{default:O(()=>[l.value?(n(),r("div",ba,[...k[8]||(k[8]=[e("div",{class:"preloader-content"},[e("div",{class:"preloader-spinner"},[e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"})]),e("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"),e("p",{class:"preloader-message"},"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö..."),e("div",{class:"preloader-dots"},[e("span",{class:"dot"}),e("span",{class:"dot"}),e("span",{class:"dot"})])],-1)])])):g.value?(n(),r("div",fa,[e("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: "+i(g.value),1),e("button",{onClick:y,class:"retry-button"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):v.value?(n(),r("div",wa,[m.value?(n(),z(Ee,{key:0,data:m.value},null,8,["data"])):N("",!0),m.value?(n(),z(He,{key:1,data:m.value,loading:l.value,error:g.value,onCellClick:x,onEmployeeClick:L,onWeekClick:M},null,8,["data","loading","error"])):N("",!0)])):(n(),r("div",ga,[...k[9]||(k[9]=[e("p",null,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])]))]),_:1}),d.value?(n(),z(ma,{key:1,"cell-data":d.value,onClose:f},null,8,["cell-data"])):N("",!0)])}}},Pa=H(Ta,[["__scopeId","data-v-2f7848de"]]);export{Pa as default};
