import{_ as I,g as N,c as U,I as V,m as B,P as H,a as f,o as v,b as e,j as M,t as S,n as $,k as K,d as R,p as Q,i as O,R as G,l as z,F,e as Y,B as J,U as W,y as L}from"./main-DF09cIPx.js";import{S as q,B as X}from"./bitrix24-api-Irr5mCDD.js";const Z=20,ee=5*60*1e3;async function te({search:l="",limit:T=Z,sectorDepartmentId:c=q.SECTOR_1C}={}){const i=`sector1c_employees_${l}_${T}_${c||"all"}`,y=sessionStorage.getItem(i);if(y)try{const{data:a,timestamp:u}=JSON.parse(y);if(Date.now()-u<ee)return a}catch(a){console.warn("[sector1cEmployees] Cache parse error:",a)}try{const a={ACTIVE:"Y"};c?Array.isArray(c)?a.UF_DEPARTMENT=c:a.UF_DEPARTMENT=[c]:a.UF_DEPARTMENT=[q.SECTOR_1C],l&&l.length>=2&&(a["%NAME"]=l,a["%LAST_NAME"]=l,a["%WORK_POSITION"]=l);const w=((await X.call("user.get",{filter:a,select:["ID","NAME","LAST_NAME","SECOND_NAME","WORK_POSITION","UF_DEPARTMENT"],order:{LAST_NAME:"ASC",NAME:"ASC"},start:0})).result||[]).slice(0,T).map(k=>({id:parseInt(k.ID),name:se(k),position:k.WORK_POSITION||"",department:k.UF_DEPARTMENT||null}));try{sessionStorage.setItem(i,JSON.stringify({data:w,timestamp:Date.now()}))}catch(k){console.warn("[sector1cEmployees] Cache write error:",k)}return w}catch(a){throw console.error("[sector1cEmployees] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",a),new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${a.message}`)}}function se(l){const T=[l.LAST_NAME,l.NAME,l.SECOND_NAME].filter(Boolean);return T.length>0?T.join(" "):l.NAME||"–ë–µ–∑ –∏–º–µ–Ω–∏"}const le={class:"employee-select-field-text"},ne={key:0,class:"employee-select-dropdown"},ae={class:"employee-select-dropdown-search"},oe={key:0,class:"employee-select-state"},ce={key:1,class:"employee-select-state employee-select-state--error"},ie={key:2,class:"employee-select-state"},re=["checked"],de=["checked","onChange"],ue={class:"employee-select-item-content"},pe={class:"employee-select-item-name"},me={key:0,class:"employee-select-item-position"},fe={__name:"EmployeeSelect",props:{selected:{type:Array,default:()=>["all"]},multiple:{type:Boolean,default:!0},placeholder:{type:String,default:"–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°"},maxHeight:{type:Number,default:300}},emits:["update:selected","search","error"],setup(l,{emit:T}){const c=l,i=T,y=N(null),a=N(null),u=N(""),b=N([]),w=N(!1),k=N(null),D=N(!1),x=U(()=>{if(!u.value)return b.value;const d=u.value.toLowerCase();return b.value.filter(o=>o.name.toLowerCase().includes(d)||o.position&&o.position.toLowerCase().includes(d))}),p=U(()=>{if(c.selected.includes("all")||c.selected.length===0)return c.placeholder;if(c.selected.length===1){const d=b.value.find(o=>o.id===c.selected[0]);return d?d.name:c.placeholder}return`–í—ã–±—Ä–∞–Ω–æ: ${c.selected.length} ${_(c.selected.length,"—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞","—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤","—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤")}`});async function g(d=""){w.value=!0,k.value=null;try{b.value=await te({search:d})}catch(o){k.value=o,i("error",o)}finally{w.value=!1}}function n(){i("search",u.value)}function t(){w.value||(D.value=!D.value,D.value?(b.value.length===0&&g(),W(()=>{a.value&&a.value.focus()})):u.value="")}function s(d){y.value&&!y.value.contains(d.target)&&(D.value=!1,u.value="")}function r(d){const o=[...c.selected],C=o.indexOf(d);if(d==="all")if(C>-1)o.splice(C,1);else return i("update:selected",["all"]);else if(C>-1)o.splice(C,1);else{const A=o.indexOf("all");A>-1&&o.splice(A,1),o.push(d)}i("update:selected",o)}function m(d){return d==="all"?c.selected.includes("all"):c.selected.includes(d)||c.selected.includes("all")}const h=U(()=>u.value?`–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É "${u.value}"`:"–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°");function _(d,o,C,A){const P=d%10,j=d%100;return j>=11&&j<=19?A:P===1?o:P>=2&&P<=4?C:A}function E(){g(u.value)}return V(()=>c.selected,d=>{(!d||d.length===0)&&i("update:selected",["all"])},{immediate:!0}),B(()=>{document.addEventListener("click",s),(!c.selected||c.selected.length===0)&&i("update:selected",["all"])}),H(()=>{document.removeEventListener("click",s)}),(d,o)=>(v(),f("div",{class:"employee-select",ref_key:"selectContainer",ref:y},[e("div",{class:$(["employee-select-field",{"employee-select-field--open":D.value,"employee-select-field--disabled":w.value}]),onClick:t},[e("span",le,S(p.value),1),e("span",{class:$(["employee-select-field-icon",{open:D.value}])},"‚ñº",2)],2),M(J,{name:"dropdown-fade"},{default:K(()=>[D.value?(v(),f("div",ne,[e("div",ae,[Q(e("input",{"onUpdate:modelValue":o[0]||(o[0]=C=>u.value=C),type:"text",placeholder:"üîç –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...",class:"employee-select-search-input",onInput:n,onClick:o[1]||(o[1]=O(()=>{},["stop"])),ref_key:"searchInput",ref:a},null,544),[[G,u.value]])]),w.value?(v(),f("div",oe,[...o[6]||(o[6]=[e("span",{class:"spinner"},"‚è≥",-1),e("span",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°...",-1)])])):k.value?(v(),f("div",ce,[e("span",null,"‚ùå "+S(k.value.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤"),1),e("button",{onClick:[E,o[2]||(o[2]=O(()=>{},["stop"]))],class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):!w.value&&x.value.length===0&&!k.value?(v(),f("div",ie,[e("span",null,"üì≠ "+S(h.value),1)])):(v(),f("div",{key:3,class:"employee-select-list",style:z({maxHeight:`${l.maxHeight}px`})},[e("label",{class:$(["employee-select-item",{"employee-select-item--selected":m("all")}]),onClick:o[4]||(o[4]=O(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:m("all"),onChange:o[3]||(o[3]=C=>r("all"))},null,40,re),o[7]||(o[7]=e("div",{class:"employee-select-item-content"},[e("span",{class:"employee-select-item-name"},"–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏")],-1))],2),(v(!0),f(F,null,Y(x.value,C=>(v(),f("label",{key:C.id,class:$(["employee-select-item",{"employee-select-item--selected":m(C.id)}]),onClick:o[5]||(o[5]=O(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:m(C.id),onChange:A=>r(C.id)},null,40,de),e("div",ue,[e("span",pe,S(C.name),1),C.position?(v(),f("span",me,S(C.position),1)):R("",!0)])],2))),128))],4))])):R("",!0)]),_:1})],512))}},ve=I(fe,[["__scopeId","data-v-6b8c949b"]]),ge={class:"stage-select-field-text"},ke={key:0,class:"stage-select-dropdown"},he={class:"stage-select-list"},ye=["checked"],we=["checked","onChange"],Ce={class:"stage-select-item-content"},De={class:"stage-select-item-name"},_e={__name:"StageSelect",props:{selected:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},stages:{type:Array,required:!0,default:()=>[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff"},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107"},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745"}]},placeholder:{type:String,default:"–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø—ã"}},emits:["update:selected","change"],setup(l,{emit:T}){const c=l,i=T,y=N(null),a=N(!1),u=U(()=>Object.values(c.selected).every(p=>p===!0)),b=U(()=>{if(u.value)return c.placeholder;const p=c.stages.filter(g=>c.selected[g.id]);return p.length===0?"–≠—Ç–∞–ø—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã":p.length===1?p[0].name:`–í—ã–±—Ä–∞–Ω–æ: ${p.length} —ç—Ç–∞–ø–∞(–æ–≤)`});function w(){a.value=!a.value,a.value}function k(p){y.value&&!y.value.contains(p.target)&&(a.value=!1)}function D(p,g){const n={...c.selected};n[p]=g,i("update:selected",n),i("change",p,g)}function x(){const p=u.value,g={};c.stages.forEach(n=>{g[n.id]=!p}),i("update:selected",g),i("change","all",!p)}return B(()=>{document.addEventListener("click",k)}),H(()=>{document.removeEventListener("click",k)}),(p,g)=>(v(),f("div",{class:"stage-select",ref_key:"selectContainer",ref:y},[e("div",{class:$(["stage-select-field",{"stage-select-field--open":a.value,"stage-select-field--disabled":!1}]),onClick:w},[e("span",ge,S(b.value),1),e("span",{class:$(["stage-select-field-icon",{open:a.value}])},"‚ñº",2)],2),M(J,{name:"dropdown-fade"},{default:K(()=>[a.value?(v(),f("div",ke,[e("div",he,[e("label",{class:$(["stage-select-item",{"stage-select-item--selected":u.value}]),onClick:g[0]||(g[0]=O(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:u.value,onChange:x},null,40,ye),g[2]||(g[2]=e("div",{class:"stage-select-item-content"},[e("span",{class:"stage-select-item-name"},"–í—Å–µ —ç—Ç–∞–ø—ã")],-1))],2),(v(!0),f(F,null,Y(l.stages,n=>(v(),f("label",{key:n.id,class:$(["stage-select-item",{"stage-select-item--selected":l.selected[n.id]}]),onClick:g[1]||(g[1]=O(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:l.selected[n.id],onChange:t=>D(n.id,t.target.checked)},null,40,we),e("div",Ce,[e("span",{class:"stage-select-item-color",style:z({backgroundColor:n.color})},null,4),e("span",De,S(n.name),1)])],2))),128))])])):R("",!0)]),_:1})],512))}},Se=I(_e,[["__scopeId","data-v-ce2229b2"]]),Te={class:"week-picker"},be={class:"week-picker-items"},Ne=["data-week-number","onClick"],Ee={class:"week-item-content"},$e={class:"week-number"},xe={class:"week-dates"},Ue={key:0,class:"week-picker-selected"},Ae={class:"selected-week-info"},Oe={class:"selected-week-dates"},Re={__name:"WeekPicker",props:{selectedWeek:{type:Object,default:null},weeksCount:{type:Number,default:52}},emits:["update:selectedWeek","change"],setup(l,{emit:T}){const c=l,i=T,y=N(null),a=N([]),u=N(!1);function b(n=52){const t=[],r=w(new Date);for(let m=0;m<n;m++){const h=new Date(r.start);h.setDate(h.getUTCDate()-m*7);const _=w(h),E=k(h);t.push({weekNumber:E,startUtc:_.start.toISOString(),endUtc:_.end.toISOString(),start:_.start,end:_.end})}return t}function w(n){const t=new Date(n),s=t.getUTCDay(),r=t.getUTCDate()-s+(s===0?-6:1),m=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),r,0,0,0)),h=new Date(m);return h.setUTCDate(h.getUTCDate()+6),h.setUTCHours(23,59,59,999),{start:m,end:h}}function k(n){const t=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate()));t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));const s=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-s)/864e5+1)/7)}function D(n){const t=new Date(n),s=t.getUTCFullYear(),r=String(t.getUTCMonth()+1).padStart(2,"0"),m=String(t.getUTCDate()).padStart(2,"0");return`${s}-${r}-${m}`}function x(n){i("update:selectedWeek",n),i("change",n),W(()=>{p(n.weekNumber)})}function p(n){if(!y.value)return;const t=y.value.querySelector(`[data-week-number="${n}"]`);if(t){const s=y.value,r=t.offsetTop,m=s.clientHeight,h=t.clientHeight,_=r-m/2+h/2;s.scrollTo({top:_,behavior:"smooth"})}}function g(){u.value||(u.value=!0,clearTimeout(window.weekPickerScrollTimeout),window.weekPickerScrollTimeout=setTimeout(()=>{if(!y.value){u.value=!1;return}const n=y.value,t=n.getBoundingClientRect(),s=t.top+t.height/2,r=n.querySelectorAll(".week-picker-item");let m=null,h=1/0;if(r.forEach(_=>{const E=_.getBoundingClientRect(),d=E.top+E.height/2,o=Math.abs(d-s);o<h&&(h=o,m=_)}),m){const _=parseInt(m.dataset.weekNumber),E=a.value.find(d=>d.weekNumber===_);E&&(!c.selectedWeek||E.weekNumber!==c.selectedWeek.weekNumber)&&(i("update:selectedWeek",E),i("change",E))}u.value=!1},150))}return B(()=>{if(a.value=b(c.weeksCount),c.selectedWeek)W(()=>{p(c.selectedWeek.weekNumber)});else{w(new Date);const n=k(new Date);W(()=>{p(n)})}}),H(()=>{window.weekPickerScrollTimeout&&clearTimeout(window.weekPickerScrollTimeout)}),V(()=>c.selectedWeek,n=>{n&&!u.value&&W(()=>{p(n.weekNumber)})},{deep:!0}),(n,t)=>(v(),f("div",Te,[t[0]||(t[0]=e("div",{class:"week-picker-label"},[e("span",{class:"section-icon"},"üìÖ"),e("span",null,"–ù–µ–¥–µ–ª—è")],-1)),e("div",{class:"week-picker-wheel",ref_key:"wheelContainer",ref:y,onScroll:g},[e("div",be,[(v(!0),f(F,null,Y(a.value,(s,r)=>{var m;return v(),f("div",{key:s.weekNumber,class:$(["week-picker-item",{active:s.weekNumber===((m=l.selectedWeek)==null?void 0:m.weekNumber)}]),"data-week-number":s.weekNumber,onClick:h=>x(s)},[e("div",Ee,[e("div",$e,"–ù–µ–¥–µ–ª—è "+S(s.weekNumber),1),e("div",xe,S(D(s.startUtc))+" ‚Äî "+S(D(s.endUtc)),1)])],10,Ne)}),128))])],544),l.selectedWeek?(v(),f("div",Ue,[e("div",Ae,[e("strong",null,"–ù–µ–¥–µ–ª—è "+S(l.selectedWeek.weekNumber),1),e("span",Oe,S(D(l.selectedWeek.startUtc))+" ‚Äî "+S(D(l.selectedWeek.endUtc)),1)])])):R("",!0)]))}},We=I(Re,[["__scopeId","data-v-1e43a0a8"]]),Me={class:"filters-panel"},Ie={class:"filters-header"},Fe=["disabled"],Pe={class:"filters-content"},Le={key:0,class:"filter-section"},Be={class:"section-content"},He={class:"filter-section"},Ye={class:"section-content"},je={class:"filter-section"},qe={key:0,class:"section-content"},Ve={class:"section-content"},Ke=["value"],ze={key:0,class:"custom-date-range"},Je={class:"date-range-inputs"},Qe={class:"date-input-group"},Ge=["value","max"],Xe={class:"date-input-group"},Ze=["value","min","max"],et={key:0,class:"filter-error"},tt={key:1,class:"filter-hint"},st={__name:"FiltersPanel",props:{stages:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},employees:{type:Array,default:()=>["all"]},dateRange:{type:String,default:"last-week"},customDateRange:{type:Object,default:()=>({startDate:null,endDate:null})},hasActiveFilters:{type:Boolean,default:!1},hideStages:{type:Boolean,default:!1},weekPickerMode:{type:Boolean,default:!1},selectedWeek:{type:Object,default:null},weeksCount:{type:Number,default:52}},emits:["update:stages","update:employees","update:dateRange","update:customDateRange","update:selectedWeek","reset","apply"],setup(l,{emit:T}){const c=l,i=T,y=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"var(--b24-primary, #007bff)"},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"var(--b24-warning, #ffc107)"},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"var(--b24-success, #28a745)"}],a=N(null),u=U(()=>{const t=new Date;return t.setFullYear(t.getFullYear()-1),t.toISOString().split("T")[0]}),b=U(()=>new Date().toISOString().split("T")[0]);function w(t){i("update:stages",t),i("apply")}function k(t,s){i("apply")}function D(t){i("update:employees",t),i("apply")}function x(t){i("update:dateRange",t),a.value=null,i("apply")}function p(t,s){const r={...c.customDateRange};if(r[t]=s,r.startDate&&r.endDate){const m=new Date(r.startDate),h=new Date(r.endDate);if(m>h){a.value="–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω–µ—á–Ω–æ–π";return}if(Math.ceil((h-m)/(1e3*60*60*24))>365){a.value="–ü–µ—Ä–∏–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 365 –¥–Ω–µ–π";return}}a.value=null,i("update:customDateRange",r),i("apply")}function g(t){i("update:selectedWeek",t),i("apply")}function n(){a.value=null,i("reset")}return(t,s)=>(v(),f("div",Me,[e("div",Ie,[s[3]||(s[3]=e("h2",null,"–§–∏–ª—å—Ç—Ä—ã",-1)),e("button",{onClick:n,class:"btn-reset-filters",disabled:!l.hasActiveFilters}," –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã ",8,Fe)]),e("div",Pe,[l.hideStages?R("",!0):(v(),f("div",Le,[s[4]||(s[4]=e("h3",{class:"section-title"},[e("span",{class:"section-icon"},"üìä"),L(" –≠—Ç–∞–ø—ã ")],-1)),e("div",Be,[M(Se,{selected:l.stages,stages:y,placeholder:"–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø—ã","onUpdate:selected":w,onChange:k},null,8,["selected"])])])),e("div",He,[s[5]||(s[5]=e("h3",{class:"section-title"},[e("span",{class:"section-icon"},"üë•"),L(" –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ")],-1)),e("div",Ye,[M(ve,{selected:l.employees,"onUpdate:selected":D},null,8,["selected"])])]),e("div",je,[l.weekPickerMode?(v(),f("div",qe,[M(We,{selectedWeek:l.selectedWeek,weeksCount:l.weeksCount,"onUpdate:selectedWeek":g,onChange:g},null,8,["selectedWeek","weeksCount"])])):(v(),f(F,{key:1},[s[9]||(s[9]=e("h3",{class:"section-title"},[e("span",{class:"section-icon"},"üìÖ"),L(" –ü–µ—Ä–∏–æ–¥ ")],-1)),e("div",Ve,[e("select",{value:l.dateRange,onChange:s[0]||(s[0]=r=>x(r.target.value)),class:"date-range-select"},[...s[6]||(s[6]=[e("option",{value:"last-week"},"–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–¥–µ–ª—è",-1),e("option",{value:"last-2-weeks"},"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏",-1),e("option",{value:"last-month"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü",-1),e("option",{value:"custom"},"–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])],40,Ke),l.dateRange==="custom"?(v(),f("div",ze,[e("div",Je,[e("div",Qe,[s[7]||(s[7]=e("label",null,"–°:",-1)),e("input",{type:"date",value:l.customDateRange.startDate,onChange:s[1]||(s[1]=r=>p("startDate",r.target.value)),max:l.customDateRange.endDate||b.value,class:"date-input"},null,40,Ge)]),e("div",Xe,[s[8]||(s[8]=e("label",null,"–ü–æ:",-1)),e("input",{type:"date",value:l.customDateRange.endDate,onChange:s[2]||(s[2]=r=>p("endDate",r.target.value)),min:l.customDateRange.startDate||u.value,max:b.value,class:"date-input"},null,40,Ze)])]),a.value?(v(),f("small",et,S(a.value),1)):(v(),f("small",tt," –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –∏ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö "))])):R("",!0)])],64))])])]))}},at=I(st,[["__scopeId","data-v-b81cf3a7"]]);export{at as F};
