const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ticketListUtils-CpKfsjsI.js","./chunk-rKmNpCr3.js","./chunk-IDUYkvJI.js","./chunk-BTnG7_Rn.js","./chunk-Bwkg0lDb.js","./chunk-B5yqeUNo.js","./chunk-UTsEWqhV.js","./chunk-DLgBCjTL.js","./dashboard-components-cU3ZvHcC.css"])))=>i.map(i=>d[i]);
import{a as w,d as e,b as Y,t as F,o as y,C as ke,B as wt,L as Ct,P as Dt,D as _t,E as Et,G as St,H as Tt,I as $t,J as Mt,K as Nt,r as A,c as te,M as Ae,l as Te,N as ze,j as re,i as Q,k as be,m as Ke,h as ae,O as xt,n as he,F as oe,f as ue,x as Re,Q as Qe,u as Ee,g as Se,R as je,T as st,S as dt,U as Je,q as At,V as It,W as nt,X as Ft,Y as Lt,Z as Oe,y as Pt,e as Bt}from"./chunk-IDUYkvJI.js";import{T as pt,S as xe,a as mt}from"./chunk-Bwkg0lDb.js";import{e as Xe,f as Ht}from"./chunk-BTnG7_Rn.js";import{_ as we,g as Ot,S as Rt,a as Wt,b as ot,D as ve,c as lt,d as Ut,T as rt,e as jt,A as gt}from"./chunk-rKmNpCr3.js";import{_ as _e}from"./chunk-B5yqeUNo.js";import{a as zt}from"./chunk-DLgBCjTL.js";import{B as Yt}from"./chunk-UTsEWqhV.js";const Kt={name:"LoadingSpinner",props:{message:{type:String,default:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°..."}}},Vt={class:"loading-spinner"},Gt={key:0,class:"message"};function qt(s,t,o,a,p,r){return y(),w("div",Vt,[t[0]||(t[0]=e("div",{class:"spinner"},null,-1)),o.message?(y(),w("p",Gt,F(o.message),1)):Y("",!0)])}const ft=we(Kt,[["render",qt],["__scopeId","data-v-375eac16"]]);function Rl(s,t=300){let o;return function(...p){const r=()=>{clearTimeout(o),s(...p)};clearTimeout(o),o=setTimeout(r,t)}}ke.register(wt,Ct,Dt,_t,Et,St,Tt,$t,Mt,Nt);ke.defaults.responsive=!0;ke.defaults.maintainAspectRatio=!1;ke.defaults.plugins.legend.display=!0;ke.defaults.plugins.legend.position="top";const Wl={primary:"#007bff",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8",carryover:"#ff9800",successLight:"#6cbf47",carryoverLight:"#ffb74d",carryoverDark:"#f57c00"};function Ve(s){return Wt[s]||"formed"}function Ul(s){return Rt[s]||"DT140_12:UC_0VHWE2"}function jl(){return Ot()}const Xt=20,Jt=5*60*1e3;async function Zt({search:s="",limit:t=Xt,sectorDepartmentId:o=ot.SECTOR_1C}={}){const a=`sector1c_employees_${s}_${t}_${o||"all"}`,p=sessionStorage.getItem(a);if(p)try{const{data:r,timestamp:l}=JSON.parse(p);if(Date.now()-l<Jt)return r}catch(r){console.warn("[sector1cEmployees] Cache parse error:",r)}try{const r={ACTIVE:"Y"};o?Array.isArray(o)?r.UF_DEPARTMENT=o:r.UF_DEPARTMENT=[o]:r.UF_DEPARTMENT=[ot.SECTOR_1C],s&&s.length>=2&&(r["%NAME"]=s,r["%LAST_NAME"]=s,r["%WORK_POSITION"]=s);const i=((await Yt.call("user.get",{filter:r,select:["ID","NAME","LAST_NAME","SECOND_NAME","WORK_POSITION","UF_DEPARTMENT"],order:{LAST_NAME:"ASC",NAME:"ASC"},start:0})).result||[]).slice(0,t).map(n=>({id:parseInt(n.ID),name:Qt(n),position:n.WORK_POSITION||"",department:n.UF_DEPARTMENT||null}));try{sessionStorage.setItem(a,JSON.stringify({data:i,timestamp:Date.now()}))}catch(n){console.warn("[sector1cEmployees] Cache write error:",n)}return i}catch(r){throw console.error("[sector1cEmployees] ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²:",r),new Error(`ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²: ${r.message}`)}}function Qt(s){const t=[s.LAST_NAME,s.NAME,s.SECOND_NAME].filter(Boolean);return t.length>0?t.join(" "):s.NAME||"Ð‘ÐµÐ· Ð¸Ð¼ÐµÐ½Ð¸"}const ea={class:"employee-select-field-text"},ta={key:0,class:"employee-select-dropdown"},aa={class:"employee-select-dropdown-search"},sa={key:0,class:"employee-select-state"},na={key:1,class:"employee-select-state employee-select-state--error"},oa={key:2,class:"employee-select-state"},la=["checked"],ra=["checked","onChange"],ia={class:"employee-select-item-content"},ca={class:"employee-select-item-name"},ua={key:0,class:"employee-select-item-position"},da={__name:"EmployeeSelect",props:{selected:{type:Array,default:()=>["all"]},multiple:{type:Boolean,default:!0},placeholder:{type:String,default:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð² ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡"},maxHeight:{type:Number,default:300}},emits:["update:selected","search","error"],setup(s,{emit:t}){const o=s,a=t,p=A(null),r=A(null),l=A(""),d=A([]),i=A(!1),n=A(null),C=A(!1),_=te(()=>{if(!l.value)return d.value;const $=l.value.toLowerCase();return d.value.filter(T=>T.name.toLowerCase().includes($)||T.position&&T.position.toLowerCase().includes($))}),u=te(()=>{if(o.selected.includes("all")||o.selected.length===0)return o.placeholder;if(o.selected.length===1){const $=d.value.find(T=>T.id===o.selected[0]);return $?$.name:o.placeholder}return`Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð¾: ${o.selected.length} ${V(o.selected.length,"ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°","ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²","ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²")}`});async function v($=""){i.value=!0,n.value=null;try{d.value=await Zt({search:$})}catch(T){n.value=T,a("error",T)}finally{i.value=!1}}function b(){a("search",l.value)}function N(){i.value||(C.value=!C.value,C.value?(d.value.length===0&&v(),Qe(()=>{r.value&&r.value.focus()})):l.value="")}function S($){p.value&&!p.value.contains($.target)&&(C.value=!1,l.value="")}function D($){const T=[...o.selected],O=T.indexOf($);if($==="all")if(O>-1)T.splice(O,1);else return a("update:selected",["all"]);else if(O>-1)T.splice(O,1);else{const R=T.indexOf("all");R>-1&&T.splice(R,1),T.push($)}a("update:selected",T)}function L($){return $==="all"?o.selected.includes("all"):o.selected.includes($)||o.selected.includes("all")}const U=te(()=>l.value?`ÐÐµÑ‚ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð² Ð¿Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ "${l.value}"`:"ÐÐµÑ‚ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð² ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡");function V($,T,O,R){const G=$%10,J=$%100;return J>=11&&J<=19?R:G===1?T:G>=2&&G<=4?O:R}function P(){v(l.value)}return Ae(()=>o.selected,$=>{(!$||$.length===0)&&a("update:selected",["all"])},{immediate:!0}),Te(()=>{document.addEventListener("click",S),(!o.selected||o.selected.length===0)&&a("update:selected",["all"])}),ze(()=>{document.removeEventListener("click",S)}),($,T)=>(y(),w("div",{class:"employee-select",ref_key:"selectContainer",ref:p},[e("div",{class:Q(["employee-select-field",{"employee-select-field--open":C.value,"employee-select-field--disabled":i.value}]),onClick:N},[e("span",ea,F(u.value),1),e("span",{class:Q(["employee-select-field-icon",{open:C.value}])},"â–¼",2)],2),re(Re,{name:"dropdown-fade"},{default:be(()=>[C.value?(y(),w("div",ta,[e("div",aa,[Ke(e("input",{"onUpdate:modelValue":T[0]||(T[0]=O=>l.value=O),type:"text",placeholder:"ðŸ” ÐŸÐ¾Ð¸ÑÐº ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°...",class:"employee-select-search-input",onInput:b,onClick:T[1]||(T[1]=ae(()=>{},["stop"])),ref_key:"searchInput",ref:r},null,544),[[xt,l.value]])]),i.value?(y(),w("div",sa,[...T[6]||(T[6]=[e("span",{class:"spinner"},"â³",-1),e("span",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð² ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡...",-1)])])):n.value?(y(),w("div",na,[e("span",null,"âŒ "+F(n.value.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²"),1),e("button",{onClick:[P,T[2]||(T[2]=ae(()=>{},["stop"]))],class:"btn-retry"},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):!i.value&&_.value.length===0&&!n.value?(y(),w("div",oa,[e("span",null,"ðŸ“­ "+F(U.value),1)])):(y(),w("div",{key:3,class:"employee-select-list",style:he({maxHeight:`${s.maxHeight}px`})},[e("label",{class:Q(["employee-select-item",{"employee-select-item--selected":L("all")}]),onClick:T[4]||(T[4]=ae(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:L("all"),onChange:T[3]||(T[3]=O=>D("all"))},null,40,la),T[7]||(T[7]=e("div",{class:"employee-select-item-content"},[e("span",{class:"employee-select-item-name"},"Ð’ÑÐµ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¸")],-1))],2),(y(!0),w(oe,null,ue(_.value,O=>(y(),w("label",{key:O.id,class:Q(["employee-select-item",{"employee-select-item--selected":L(O.id)}]),onClick:T[5]||(T[5]=ae(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:L(O.id),onChange:R=>D(O.id)},null,40,ra),e("div",ia,[e("span",ca,F(O.name),1),O.position?(y(),w("span",ua,F(O.position),1)):Y("",!0)])],2))),128))],4))])):Y("",!0)]),_:1})],512))}},pa=we(da,[["__scopeId","data-v-6b8c949b"]]),ma={class:"stage-select-field-text"},ga={key:0,class:"stage-select-dropdown"},fa={class:"stage-select-list"},va=["checked"],ha=["checked","onChange"],ya={class:"stage-select-item-content"},ka={class:"stage-select-item-name"},ba={__name:"StageSelect",props:{selected:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},stages:{type:Array,required:!0,default:()=>[{id:"formed",name:"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ",color:"#007bff"},{id:"review",name:"Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—",color:"#ffc107"},{id:"execution",name:"Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ",color:"#28a745"}]},placeholder:{type:String,default:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ð¿Ñ‹"}},emits:["update:selected","change"],setup(s,{emit:t}){const o=s,a=t,p=A(null),r=A(!1),l=te(()=>Object.values(o.selected).every(u=>u===!0)),d=te(()=>{if(l.value)return o.placeholder;const u=o.stages.filter(v=>o.selected[v.id]);return u.length===0?"Ð­Ñ‚Ð°Ð¿Ñ‹ Ð½Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ñ‹":u.length===1?u[0].name:`Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð¾: ${u.length} ÑÑ‚Ð°Ð¿Ð°(Ð¾Ð²)`});function i(){r.value=!r.value,r.value}function n(u){p.value&&!p.value.contains(u.target)&&(r.value=!1)}function C(u,v){const b={...o.selected};b[u]=v,a("update:selected",b),a("change",u,v)}function _(){const u=l.value,v={};o.stages.forEach(b=>{v[b.id]=!u}),a("update:selected",v),a("change","all",!u)}return Te(()=>{document.addEventListener("click",n)}),ze(()=>{document.removeEventListener("click",n)}),(u,v)=>(y(),w("div",{class:"stage-select",ref_key:"selectContainer",ref:p},[e("div",{class:Q(["stage-select-field",{"stage-select-field--open":r.value,"stage-select-field--disabled":!1}]),onClick:i},[e("span",ma,F(d.value),1),e("span",{class:Q(["stage-select-field-icon",{open:r.value}])},"â–¼",2)],2),re(Re,{name:"dropdown-fade"},{default:be(()=>[r.value?(y(),w("div",ga,[e("div",fa,[e("label",{class:Q(["stage-select-item",{"stage-select-item--selected":l.value}]),onClick:v[0]||(v[0]=ae(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:l.value,onChange:_},null,40,va),v[2]||(v[2]=e("div",{class:"stage-select-item-content"},[e("span",{class:"stage-select-item-name"},"Ð’ÑÐµ ÑÑ‚Ð°Ð¿Ñ‹")],-1))],2),(y(!0),w(oe,null,ue(s.stages,b=>(y(),w("label",{key:b.id,class:Q(["stage-select-item",{"stage-select-item--selected":s.selected[b.id]}]),onClick:v[1]||(v[1]=ae(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:s.selected[b.id],onChange:N=>C(b.id,N.target.checked)},null,40,ha),e("div",ya,[e("span",{class:"stage-select-item-color",style:he({backgroundColor:b.color})},null,4),e("span",ka,F(b.name),1)])],2))),128))])])):Y("",!0)]),_:1})],512))}},wa=we(ba,[["__scopeId","data-v-ce2229b2"]]),Ca={class:"trigger-text"},Da={class:"week-picker-items"},_a=["data-week-number","onClick"],Ea={class:"week-item-content"},Sa={class:"week-number"},Ta={class:"week-dates"},$a={class:"week-picker-actions"},Ma=["disabled"],Na={__name:"WeekPicker",props:{selectedWeek:{type:Object,default:null},weeksCount:{type:Number,default:52}},emits:["update:selectedWeek","change"],setup(s,{emit:t}){const o=s,a=t,p=A(null),r=A(null),l=A([]),d=A(!1),i=A(!1),n=A(null);function C(P=52,$=4){const T=[],O=new Date,R=_(O),G=u(O);for(let J=0;J<P;J++){const Z=new Date(R.start);Z.setUTCDate(Z.getUTCDate()-J*7);const ee=_(Z),pe=u(Z);T.unshift({weekNumber:pe,startUtc:ee.start.toISOString(),endUtc:ee.end.toISOString(),start:ee.start,end:ee.end})}(T.length===0||T[T.length-1].weekNumber!==G)&&T.push({weekNumber:G,startUtc:R.start.toISOString(),endUtc:R.end.toISOString(),start:R.start,end:R.end});for(let J=1;J<=$;J++){const Z=new Date(R.start);Z.setUTCDate(Z.getUTCDate()+J*7);const ee=_(Z),pe=u(Z);T.push({weekNumber:pe,startUtc:ee.start.toISOString(),endUtc:ee.end.toISOString(),start:ee.start,end:ee.end})}return T.sort((J,Z)=>J.start-Z.start),T}function _(P){const $=new Date(P),T=$.getUTCDay(),O=$.getUTCDate()-T+(T===0?-6:1),R=new Date(Date.UTC($.getUTCFullYear(),$.getUTCMonth(),O,0,0,0)),G=new Date(R);return G.setUTCDate(G.getUTCDate()+6),G.setUTCHours(23,59,59,999),{start:R,end:G}}function u(P){const $=new Date(Date.UTC(P.getFullYear(),P.getMonth(),P.getDate()));$.setUTCDate($.getUTCDate()+4-($.getUTCDay()||7));const T=new Date(Date.UTC($.getUTCFullYear(),0,1));return Math.ceil((($-T)/864e5+1)/7)}function v(P){const $=new Date(P),T=$.getUTCFullYear(),O=String($.getUTCMonth()+1).padStart(2,"0"),R=String($.getUTCDate()).padStart(2,"0");return`${T}-${O}-${R}`}function b(){i.value=!i.value,i.value&&(l.value=C(o.weeksCount,4),n.value=o.selectedWeek||l.value.find(P=>{const T=u(new Date);return P.weekNumber===T})||l.value[0],Qe(()=>{n.value&&L(n.value.weekNumber)}))}function N(P){n.value=P,L(P.weekNumber)}function S(){n.value&&(a("update:selectedWeek",n.value),a("change",n.value),i.value=!1)}function D(){n.value=o.selectedWeek||null,i.value=!1}function L(P){if(!r.value)return;const $=r.value.querySelector(`[data-week-number="${P}"]`);if($){const T=r.value,O=$.offsetTop,R=T.clientHeight,G=$.clientHeight,J=O-R/2+G/2;T.scrollTo({top:J,behavior:"smooth"})}}function U(){d.value||!i.value||(d.value=!0,clearTimeout(window.weekPickerScrollTimeout),window.weekPickerScrollTimeout=setTimeout(()=>{if(!r.value){d.value=!1;return}const P=r.value,$=P.getBoundingClientRect(),T=$.top+$.height/2,O=P.querySelectorAll(".week-picker-item");let R=null,G=1/0;if(O.forEach(J=>{const Z=J.getBoundingClientRect(),ee=Z.top+Z.height/2,pe=Math.abs(ee-T);pe<G&&(G=pe,R=J)}),R){const J=parseInt(R.dataset.weekNumber),Z=l.value.find(ee=>ee.weekNumber===J);Z&&(!n.value||Z.weekNumber!==n.value.weekNumber)&&(n.value=Z)}d.value=!1},150))}function V(P){p.value&&!p.value.contains(P.target)&&i.value&&D()}return Te(()=>{if(l.value=C(o.weeksCount,4),o.selectedWeek)n.value=o.selectedWeek;else{const $=u(new Date),T=l.value.find(O=>O.weekNumber===$);T?n.value=T:n.value=l.value[0]}document.addEventListener("click",V)}),ze(()=>{window.weekPickerScrollTimeout&&clearTimeout(window.weekPickerScrollTimeout),document.removeEventListener("click",V)}),Ae(()=>o.selectedWeek,P=>{P&&(n.value=P,i.value&&!d.value&&Qe(()=>{L(P.weekNumber)}))},{deep:!0}),(P,$)=>(y(),w("div",{class:"week-picker",ref_key:"pickerContainer",ref:p},[$[1]||($[1]=e("div",{class:"week-picker-label"},[e("span",{class:"section-icon"},"ðŸ“…"),e("span",null,"ÐŸÐµÑ€Ð¸Ð¾Ð´")],-1)),e("div",{class:Q(["week-picker-trigger",{"is-open":i.value}]),onClick:b},[e("span",Ca,[s.selectedWeek?(y(),w(oe,{key:0},[Ee(" ÐÐµÐ´ÐµÐ»Ñ "+F(s.selectedWeek.weekNumber)+" Â· "+F(v(s.selectedWeek.startUtc))+" â€” "+F(v(s.selectedWeek.endUtc)),1)],64)):(y(),w(oe,{key:1},[Ee(" Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½ÐµÐ´ÐµÐ»ÑŽ ")],64))]),e("span",{class:Q(["trigger-icon",{"is-open":i.value}])},"â–¼",2)],2),re(Re,{name:"dropdown-fade"},{default:be(()=>[i.value?(y(),w("div",{key:0,class:"week-picker-dropdown",onClick:$[0]||($[0]=ae(()=>{},["stop"]))},[e("div",{class:"week-picker-wheel",ref_key:"wheelContainer",ref:r,onScroll:U},[e("div",Da,[(y(!0),w(oe,null,ue(l.value,(T,O)=>(y(),w("div",{key:T.weekNumber,class:Q(["week-picker-item",{active:T.weekNumber===n.value?.weekNumber}]),"data-week-number":T.weekNumber,onClick:R=>N(T)},[e("div",Ea,[e("div",Sa,"ÐÐµÐ´ÐµÐ»Ñ "+F(T.weekNumber),1),e("div",Ta,F(v(T.startUtc))+" â€” "+F(v(T.endUtc)),1)])],10,_a))),128))])],544),e("div",$a,[e("button",{class:"btn-cancel",onClick:D},"ÐžÑ‚Ð¼ÐµÐ½Ð°"),e("button",{class:"btn-apply",onClick:S,disabled:!n.value},"ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ",8,Ma)])])):Y("",!0)]),_:1})],512))}},xa=we(Na,[["__scopeId","data-v-daae25a6"]]),Aa={class:"filters-panel"},Ia={class:"filters-header"},Fa=["disabled"],La={class:"filters-content"},Pa={key:0,class:"filter-section"},Ba={class:"section-content"},Ha={class:"filter-section"},Oa={class:"section-content"},Ra={class:"filter-section"},Wa={key:0,class:"section-content"},Ua={class:"section-content"},ja={key:0,class:"period-mode-group"},za=["value"],Ya=["disabled"],Ka=["disabled"],Va={key:0,class:"period-mode-hint"},Ga={key:1,class:"period-mode-hint"},qa=["value"],Xa={key:0,class:"custom-date-range"},Ja={class:"date-range-inputs"},Za={class:"date-input-group"},Qa=["value","max"],es={class:"date-input-group"},ts=["value","min","max"],as={key:0,class:"filter-error"},ss={key:1,class:"filter-hint"},ns={__name:"FiltersPanel",props:{stages:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},employees:{type:Array,default:()=>["all"]},dateRange:{type:String,default:"last-week"},customDateRange:{type:Object,default:()=>({startDate:null,endDate:null})},hasActiveFilters:{type:Boolean,default:!1},hideStages:{type:Boolean,default:!1},weekPickerMode:{type:Boolean,default:!1},selectedWeek:{type:Object,default:null},weeksCount:{type:Number,default:52},showPeriodMode:{type:Boolean,default:!1},periodMode:{type:String,default:"weeks",validator:s=>["weeks","months"].includes(s)}},emits:["update:stages","update:employees","update:dateRange","update:customDateRange","update:selectedWeek","update:periodMode","reset","apply"],setup(s,{emit:t}){const o=s,a=t,p=[{id:"formed",name:"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ",color:"var(--b24-primary, #007bff)"},{id:"review",name:"Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—",color:"var(--b24-warning, #ffc107)"},{id:"execution",name:"Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ",color:"var(--b24-success, #28a745)"}],r=A(null),l=te(()=>{const S=new Date;return S.setFullYear(S.getFullYear()-1),S.toISOString().split("T")[0]}),d=te(()=>new Date().toISOString().split("T")[0]);function i(S){a("update:stages",S),a("apply")}function n(S,D){a("apply")}function C(S){a("update:employees",S),a("apply")}function _(S){a("update:dateRange",S),r.value=null,a("apply")}function u(S,D){const L={...o.customDateRange};if(L[S]=D,L.startDate&&L.endDate){const U=new Date(L.startDate),V=new Date(L.endDate);if(U>V){r.value="ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ð°Ñ Ð´Ð°Ñ‚Ð° Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ ÐºÐ¾Ð½ÐµÑ‡Ð½Ð¾Ð¹";return}if(Math.ceil((V-U)/(1e3*60*60*24))>365){r.value="ÐŸÐµÑ€Ð¸Ð¾Ð´ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°Ñ‚ÑŒ 365 Ð´Ð½ÐµÐ¹";return}}r.value=null,a("update:customDateRange",L),a("apply")}function v(S){a("update:selectedWeek",S),a("apply")}function b(S){if(!["weeks","months"].includes(S)){console.warn("[FiltersPanel] Invalid periodMode:",S);return}S!==o.periodMode&&(a("update:periodMode",S),a("apply"))}function N(){r.value=null,a("reset")}return(S,D)=>(y(),w("div",Aa,[e("div",Ia,[D[4]||(D[4]=e("h2",null,"Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹",-1)),e("button",{onClick:N,class:"btn-reset-filters",disabled:!s.hasActiveFilters}," Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ ",8,Fa)]),e("div",La,[s.hideStages?Y("",!0):(y(),w("div",Pa,[D[5]||(D[5]=e("h3",{class:"section-title"},[e("span",{class:"section-icon"},"ðŸ“Š"),Ee(" Ð­Ñ‚Ð°Ð¿Ñ‹ ")],-1)),e("div",Ba,[re(wa,{selected:s.stages,stages:p,placeholder:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ð¿Ñ‹","onUpdate:selected":i,onChange:n},null,8,["selected"])])])),e("div",Ha,[D[6]||(D[6]=e("h3",{class:"section-title"},[e("span",{class:"section-icon"},"ðŸ‘¥"),Ee(" Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡ ")],-1)),e("div",Oa,[re(pa,{selected:s.employees,"onUpdate:selected":C},null,8,["selected"])])]),e("div",Ra,[s.weekPickerMode?(y(),w("div",Wa,[re(xa,{selectedWeek:s.selectedWeek,weeksCount:s.weeksCount,"onUpdate:selectedWeek":v,onChange:v},null,8,["selectedWeek","weeksCount"])])):(y(),w(oe,{key:1},[D[11]||(D[11]=e("h3",{class:"section-title"},[e("span",{class:"section-icon"},"ðŸ“…"),Ee(" ÐŸÐµÑ€Ð¸Ð¾Ð´ ")],-1)),e("div",Ua,[s.showPeriodMode?(y(),w("div",ja,[D[7]||(D[7]=e("label",{class:"period-mode-label"},"Ð ÐµÐ¶Ð¸Ð¼ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ:",-1)),e("select",{value:s.periodMode,onChange:D[0]||(D[0]=L=>b(L.target.value)),class:Q(["period-mode-select",{"period-mode-select--current-weeks":s.periodMode==="weeks","period-mode-select--current-months":s.periodMode==="months"}])},[e("option",{value:"weeks",disabled:s.periodMode==="weeks"}," 4 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð½ÐµÐ´ÐµÐ»Ð¸ ",8,Ya),e("option",{value:"months",disabled:s.periodMode==="months"}," 3 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… Ð¼ÐµÑÑÑ†Ð° ",8,Ka)],42,za),s.periodMode==="weeks"?(y(),w("small",Va," Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼: 4 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð½ÐµÐ´ÐµÐ»Ð¸ ")):s.periodMode==="months"?(y(),w("small",Ga," Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼: 3 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… Ð¼ÐµÑÑÑ†Ð° ")):Y("",!0)])):Y("",!0),s.showPeriodMode?Y("",!0):(y(),w(oe,{key:1},[e("select",{value:s.dateRange,onChange:D[1]||(D[1]=L=>_(L.target.value)),class:"date-range-select"},[...D[8]||(D[8]=[e("option",{value:"last-week"},"ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð½ÐµÐ´ÐµÐ»Ñ",-1),e("option",{value:"last-2-weeks"},"ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 2 Ð½ÐµÐ´ÐµÐ»Ð¸",-1),e("option",{value:"last-month"},"ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð¼ÐµÑÑÑ†",-1),e("option",{value:"custom"},"ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´",-1)])],40,qa),s.dateRange==="custom"?(y(),w("div",Xa,[e("div",Ja,[e("div",Za,[D[9]||(D[9]=e("label",null,"Ð¡:",-1)),e("input",{type:"date",value:s.customDateRange.startDate,onChange:D[2]||(D[2]=L=>u("startDate",L.target.value)),max:s.customDateRange.endDate||d.value,class:"date-input"},null,40,Qa)]),e("div",es,[D[10]||(D[10]=e("label",null,"ÐŸÐ¾:",-1)),e("input",{type:"date",value:s.customDateRange.endDate,onChange:D[3]||(D[3]=L=>u("endDate",L.target.value)),min:s.customDateRange.startDate||l.value,max:d.value,class:"date-input"},null,40,ts)])]),r.value?(y(),w("small",as,F(r.value),1)):(y(),w("small",ss," Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½ÑƒÑŽ Ð¸ ÐºÐ¾Ð½ÐµÑ‡Ð½ÑƒÑŽ Ð´Ð°Ñ‚Ñƒ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… "))])):Y("",!0)],64))])],64))])])]))}},os=we(ns,[["__scopeId","data-v-5970a362"]]);class Ze{static compareTwoSnapshots(t,o,a={}){const{includeTickets:p=!1,includeEmployees:r=!0}=a,l=this.validateSnapshot(t),d=this.validateSnapshot(o);if(!l.valid||!d.valid)throw new Error("Invalid snapshot structure: "+[...l.errors,...d.errors].join(", "));const i=this.buildComparisonMetadata(t,o),n=this.compareStages(t.statistics.stages,o.statistics.stages),C=r?this.compareEmployees(t.statistics.employees||[],o.statistics.employees||[]):[],_=this.compareZeroPoint(t.statistics.zeroPoint||{},o.statistics.zeroPoint||{}),u=p?this.compareTickets(t.ticketIds||[],o.ticketIds||[],t.tickets||[],o.tickets||[]):null,v=this.buildSummary(n,C,_,u);return{metadata:i,stages:n,employees:C,zeroPoint:_,tickets:u,summary:v}}static calculateDelta(t,o){const a=this.normalizeValue(t),p=this.normalizeValue(o),r=p-a;let l=0;a!==0?l=r/a*100:p!==0&&(l=p>0?1/0:-1/0);const d=this.getTrend(r);return{value1:a,value2:p,delta:r,deltaPercent:Math.round(l*100)/100,trend:d}}static normalizeValue(t){return t==null||isNaN(t)?0:Number(t)}static getTrend(t){return t>0?"increase":t<0?"decrease":"stable"}static compareStages(t,o){const a=["formed","review","execution"],p={};for(const d of a){const i=t[d]?.count||0,n=o[d]?.count||0;p[d]=this.calculateDelta(i,n)}const r=t.total||0,l=o.total||0;return p.total=this.calculateDelta(r,l),p}static compareEmployees(t,o){const a=new Map(t.map(d=>[d.id,d])),p=new Map(o.map(d=>[d.id,d])),r=new Set([...a.keys(),...p.keys()]),l=[];for(const d of r){const i=a.get(d)||null,n=p.get(d)||null;if(!i||!n){l.push({id:d,name:i?.name||n?.name||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹",snapshot1:i?{ticketsByStage:i.ticketsByStage||{},totalTickets:i.totalTickets||0}:null,snapshot2:n?{ticketsByStage:n.ticketsByStage||{},totalTickets:n.totalTickets||0}:null,delta:this.calculateEmployeeDelta(i,n),trend:i?"removed":"new"});continue}const C={},_=["formed","review","execution"];for(const v of _){const b=i.ticketsByStage?.[v]||0,N=n.ticketsByStage?.[v]||0;C[v]=this.calculateDelta(b,N)}const u=this.calculateDelta(i.totalTickets||0,n.totalTickets||0);l.push({id:d,name:i.name,snapshot1:{ticketsByStage:i.ticketsByStage||{},totalTickets:i.totalTickets||0},snapshot2:{ticketsByStage:n.ticketsByStage||{},totalTickets:n.totalTickets||0},delta:{ticketsByStage:C,totalTickets:u},trend:u.trend})}return l}static calculateEmployeeDelta(t,o){if(!t&&!o)return{ticketsByStage:{},totalTickets:{delta:0,trend:"stable"}};const a={},p=["formed","review","execution"];for(const l of p){const d=t?.ticketsByStage?.[l]||0,i=o?.ticketsByStage?.[l]||0;a[l]=this.calculateDelta(d,i)}const r=this.calculateDelta(t?.totalTickets||0,o?.totalTickets||0);return{ticketsByStage:a,totalTickets:r}}static compareZeroPoint(t,o){return{unassigned:this.calculateDelta(t?.unassigned||0,o?.unassigned||0),keeper:this.calculateDelta(t?.keeper||0,o?.keeper||0),total:this.calculateDelta(t?.total||0,o?.total||0)}}static compareTickets(t,o,a,p){const r=new Set(t),l=new Set(o),d=o.filter(v=>!r.has(v)),i=t.filter(v=>!l.has(v)),n=[],C=[],_=new Map(a.map(v=>[v.id,v])),u=new Map(p.map(v=>[v.id,v]));for(const v of t){if(!l.has(v))continue;const b=_.get(v),N=u.get(v);if(!b||!N)continue;const S=(b.assignedTo?.id||null)!==(N.assignedTo?.id||null),D=(b.stageId||null)!==(N.stageId||null);S||D?n.push(v):C.push(v)}return{new:d,removed:i,changed:n,unchanged:C}}static buildComparisonMetadata(t,o){const a=new Date(t.metadata.createdAt),p=new Date(o.metadata.createdAt),r=new Date,l=p.getTime()-a.getTime(),d=Math.floor(l/(1e3*60*60*24)),i=Math.floor(l%(1e3*60*60*24)/(1e3*60*60)),n=Math.floor(l%(1e3*60*60)/(1e3*60));return{snapshot1Date:t.metadata.createdAt,snapshot2Date:o.metadata.createdAt,comparisonDate:r.toISOString(),timeDiff:{days:d,hours:i,minutes:n,totalMinutes:Math.floor(l/(1e3*60))}}}static buildSummary(t,o,a,p){const r=t.total.delta,l=Object.keys(t).filter(n=>n==="total"?!1:t[n].delta!==0).length,d=o.filter(n=>n.trend==="new"||n.trend==="removed"?!0:n.delta.totalTickets.delta!==0).length,i=r!==0||l>0||d>0;return{totalDelta:r,stagesChanged:l,employeesChanged:d,hasChanges:i,newTicketsCount:p?.new?.length||0,removedTicketsCount:p?.removed?.length||0,changedTicketsCount:p?.changed?.length||0}}static validateSnapshot(t){const o=[],a=[];if(!t)return o.push("Snapshot is null or undefined"),{valid:!1,errors:o,warnings:a};if(t.metadata?(t.metadata.createdAt||o.push("Missing metadata.createdAt"),t.metadata.type||o.push("Missing metadata.type")):o.push("Missing metadata field"),!t.statistics)o.push("Missing statistics field");else{if(!t.statistics.stages)o.push("Missing statistics.stages");else{const p=["formed","review","execution"];for(const r of p)t.statistics.stages[r]||a.push(`Missing stage: ${r}`)}t.statistics.employees||a.push("Missing statistics.employees (may be empty array)"),t.statistics.zeroPoint||a.push("Missing statistics.zeroPoint")}return{valid:o.length===0,errors:o,warnings:a}}static compareMultipleSnapshots(t,o={}){if(!Array.isArray(t)||t.length<2)throw new Error("At least 2 snapshots required for comparison");for(const l of t){const d=this.validateSnapshot(l);if(!d.valid)throw new Error("Invalid snapshot: "+d.errors.join(", "))}const a=[...t].sort((l,d)=>{const i=new Date(l.metadata.createdAt),n=new Date(d.metadata.createdAt);return i-n}),p=[];for(let l=0;l<a.length-1;l++)p.push({from:l,to:l+1,result:this.compareTwoSnapshots(a[l],a[l+1],o)});const r=this.buildTrends(a);return{snapshots:a.map((l,d)=>({index:d,date:l.metadata.createdAt,type:l.metadata.type,data:l})),comparisons:p,trends:r}}static buildTrends(t){const o={stages:{formed:[],review:[],execution:[],total:[]},zeroPoint:{unassigned:[],keeper:[],total:[]}};for(const a of t){const p=a.statistics;o.stages.formed.push(p.stages?.formed?.count||0),o.stages.review.push(p.stages?.review?.count||0),o.stages.execution.push(p.stages?.execution?.count||0),o.stages.total.push(p.stages?.total||0),o.zeroPoint.unassigned.push(p.zeroPoint?.unassigned||0),o.zeroPoint.keeper.push(p.zeroPoint?.keeper||0),o.zeroPoint.total.push(p.zeroPoint?.total||0)}return o}}const ls={class:"stages-container"},rs={class:"stages-chips"},is=["checked","disabled","onChange"],cs={class:"stage-chip-label"},us={__name:"StageChips",props:{stages:{type:Array,required:!0,validator:s=>s.every(t=>t.id&&t.name&&t.color)},selected:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},emits:["update:selected","change"],setup(s,{emit:t}){const o=s,a=t;function p(r,l){const d={...o.selected};d[r]=l,a("update:selected",d),a("change",r,l)}return(r,l)=>(y(),w("div",ls,[l[0]||(l[0]=e("h4",{class:"stages-title"},"Ð­Ñ‚Ð°Ð¿Ñ‹ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ:",-1)),e("div",rs,[(y(!0),w(oe,null,ue(s.stages,d=>(y(),w("label",{key:d.id,class:Q(["stage-chip",{"stage-chip--active":s.selected[d.id],"stage-chip--disabled":s.disabled}])},[e("input",{type:"checkbox",checked:s.selected[d.id],disabled:s.disabled,onChange:i=>p(d.id,i.target.checked)},null,40,is),e("span",{class:"stage-chip-color",style:he({backgroundColor:d.color})},null,4),e("span",cs,F(d.name),1)],2))),128))])]))}},ds=we(us,[["__scopeId","data-v-fe03c03c"]]);async function ps(s,t,o,a=null){if(console.log("[popupNavigationUtils] getEmployeeTicketsForStage called:",{employeeId:s,stageId:t,hasSnapshot:!!o,snapshotType:o?typeof o:"null",snapshotKeys:o?Object.keys(o):[],hasTickets:!!o?.tickets,ticketsIsArray:Array.isArray(o?.tickets),ticketsLength:o?.tickets?.length||0}),!s||!t)return console.warn("[popupNavigationUtils] Employee ID and stage ID are required"),[];if(!o)return console.warn("[popupNavigationUtils] Snapshot is null or undefined"),[];if(!o.tickets)return console.warn("[popupNavigationUtils] Snapshot.tickets is missing. Snapshot keys:",Object.keys(o)),[];if(!Array.isArray(o.tickets))return console.warn("[popupNavigationUtils] Snapshot.tickets is not an array. Type:",typeof o.tickets),[];const p=o.tickets.filter(n=>{const C=n.assignedTo;return C?(typeof C=="object"?C.id:C)===s:!1});if(p.length===0)return[];const r=!p[0].stageId||!p[0].departmentHead;let l=null;if(r){const n=p.map(C=>C.id);if(a&&typeof a=="object")l=a;else try{const C=await pt.getTicketsDetails(n);l=new Map,C.forEach(_=>{_&&_.id&&l.set(_.id,_)})}catch(C){console.warn("[popupNavigationUtils] Failed to load ticket details from API, using snapshot data:",C),l=null}}return p.map(n=>{const C=n.id,_={id:C,title:n.title||"Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ",assignedTo:n.assignedTo,createdAt:n.createdAt,updatedAt:n.updatedAt};if(l){const u=l instanceof Map?l.get(C):l[C];u?(_.stageId=u.stageId||null,_.departmentHead=u.departmentHead||null,_.departmentHeadFull=u.departmentHeadFull||u.departmentHead||null):(_.stageId=null,_.departmentHead=null)}else _.stageId=n.stageId||null,_.departmentHead=n.departmentHead||null,_.departmentHeadFull=n.departmentHeadFull||n.departmentHead||null;return _}).filter(n=>n.stageId?Ve(n.stageId)===t:!0)}function it(s,t=new Date){if(!s||s.length===0)return[];const o=s.length,a={};return Object.values(ve).forEach(r=>{a[r]={category:r,label:lt[r].label,count:0,tickets:[],percentage:0,progressBarWidth:0,progressBarColor:lt[r].color}}),s.forEach(r=>{if(!r.createdAt){a[ve.MORE_THAN_YEAR].count++,a[ve.MORE_THAN_YEAR].tickets.push(r);return}const l=Ut(r.createdAt,t);a[l]&&(a[l].count++,a[l].tickets.push(r))}),Object.values(a).filter(r=>r.count>0).map(r=>{const l=o>0?parseFloat((r.count/o*100).toFixed(1)):0;return{...r,percentage:l,progressBarWidth:l}}).sort((r,l)=>{const d=[ve.TODAY,ve.YESTERDAY,ve.THIS_WEEK,ve.LAST_WEEK,ve.MORE_THAN_TWO_WEEKS,ve.UP_TO_ONE_MONTH,ve.MORE_THAN_TWO_MONTHS,ve.MORE_THAN_HALF_YEAR,ve.MORE_THAN_YEAR];return d.indexOf(r.category)-d.indexOf(l.category)})}function ct(s){if(!s||s.length===0)return[];const t={};s.forEach(a=>{let p=a.departmentHeadFull||a.departmentHead;s.indexOf(a)<3&&console.log("[popupNavigationUtils] groupTicketsByDepartment - ticket sample:",{ticketId:a.id,departmentHead:a.departmentHead,departmentHeadFull:a.departmentHeadFull,allKeys:Object.keys(a).filter(r=>r.toLowerCase().includes("department"))}),p?(p=String(p).trim(),p.length===0&&(p="Ð‘ÐµÐ· Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°")):p="Ð‘ÐµÐ· Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°",t[p]||(t[p]={departmentName:p,count:0}),t[p].count++});const o=Object.values(t);return o.sort((a,p)=>p.count!==a.count?p.count-a.count:a.departmentName.localeCompare(p.departmentName,"ru")),o}const We=10;function Ge(s,t){if(!t||!t.statistics)return[];const o=[];t.statistics.employees&&Array.isArray(t.statistics.employees)&&t.statistics.employees.filter(p=>p.ticketsByStage&&p.ticketsByStage[s]>0).forEach(p=>{o.push({id:p.id,name:p.name,count:p.ticketsByStage[s]||0})});const a=ms(s,t);return a>0&&o.push({id:1051,name:"Ð¥Ñ€Ð°Ð½Ð¸Ñ‚ÐµÐ»ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð² (ÐÐµÑ€Ð°Ð·Ð¾Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ)",count:a,isKeeper:!0}),o.sort((p,r)=>r.count-p.count)}function ms(s,t){if(!t||!t.statistics)return 0;if(t.statistics.zeroPointByStage&&t.statistics.zeroPointByStage[s])return t.statistics.zeroPointByStage[s].keeper||0;if(t.statistics.zeroPoint){const o=t.statistics.zeroPoint.keeper||0;return Math.floor(o/3)}return 0}function vt(s,t){return!t||!t.statistics||!t.statistics.stages?0:t.statistics.stages[s]?.count||0}function qe(s,t=We){if(!s||s.length===0)return{visible:[],others:{employees:[],count:0,employeeCount:0}};const o=[...s].sort((l,d)=>d.count-l.count),a=o.slice(0,t),p=o.slice(t),r=p.reduce((l,d)=>l+d.count,0);return{visible:a,others:{employees:p,count:r,employeeCount:p.length}}}function ht(s,t){return!s||s.length===0?[]:t===0?s.map(o=>({...o,percentage:0})):s.map(o=>({...o,percentage:parseFloat((o.count/t*100).toFixed(1))}))}function Ye(s,t,o="#007bff",a=We){if(!s||s.length===0)return{employees:[],others:null};const{visible:p,others:r}=qe(s,a),l=ht(p,t).map(i=>({...i,progressBarWidth:i.percentage,progressBarColor:i.isKeeper?"#f59e0b":o}));let d=null;if(r.count>0){const i=parseFloat((r.count/t*100).toFixed(1));d={...r,percentage:i,progressBarWidth:i,progressBarColor:"#6c757d"}}return{employees:l,others:d}}function gs(s,t){const o={weekStart:[],weekEnd:[],current:[],others:{weekStart:{count:0,employeeCount:0},weekEnd:{count:0,employeeCount:0},current:{count:0,employeeCount:0}}};return["weekStart","weekEnd","current"].forEach(p=>{const r=t[p];if(!r)return;const l=Ge(s,r),d=vt(s,r);if(l.length===0)return;const{visible:i,others:n}=qe(l,We),C=ht(i,d);o[p]=C,n.count>0&&(o.others[p]={count:n.count,employeeCount:n.employeeCount,percentage:parseFloat((n.count/d*100).toFixed(1))})}),o}function fs(s,t="current",o=[]){const a=s[t];if(!a)return{labels:[],datasets:[]};const p=new Map;o.forEach(_=>{Ge(_.id,a).forEach(v=>{p.has(v.id)||p.set(v.id,{id:v.id,name:v.name,isKeeper:v.isKeeper||!1,ticketsByStage:{}}),p.get(v.id).ticketsByStage[_.id]=v.count})});const r=Array.from(p.values()).map(_=>{const u=Object.values(_.ticketsByStage).reduce((v,b)=>v+b,0);return{..._,totalTickets:u}});r.sort((_,u)=>u.totalTickets-_.totalTickets);const{visible:l,others:d}=qe(r,We),i=o.map(()=>""),n={};o.forEach(_=>{const u=Ge(_.id,a),{visible:v}=qe(u,We);n[_.id]=v.map(b=>({id:b.id,name:b.name,count:b.count}))});const C=l.map((_,u)=>{const v=o.map(N=>_.ticketsByStage[N.id]||0),b=o.map(N=>{if((_.ticketsByStage[N.id]||0)===0)return"transparent";const L=N.color.replace("#",""),U=parseInt(L.substring(0,2),16),V=parseInt(L.substring(2,4),16),P=parseInt(L.substring(4,6),16),$=.6+u*.05;return`rgba(${U}, ${V}, ${P}, ${Math.min($,.95)})`});return{label:_.name,data:v,backgroundColor:b,borderColor:o.map(N=>{const S=N.color.replace("#",""),D=parseInt(S.substring(0,2),16),L=parseInt(S.substring(2,4),16),U=parseInt(S.substring(4,6),16);return`rgba(${D}, ${L}, ${U}, 0.8)`}),borderWidth:1,meta:{employeeId:_.id,employeeName:_.name}}});if(d.count>0){const _=o.map(u=>d.employees.reduce((v,b)=>v+(b.ticketsByStage[u.id]||0),0));C.push({label:`Ð”Ñ€ÑƒÐ³Ð¸Ðµ (${d.employeeCount})`,data:_,backgroundColor:"rgba(108, 117, 125, 0.5)",borderColor:"#6c757d",borderWidth:1})}return{labels:i,datasets:C,meta:{employeesByStage:n}}}function vs(s,t,o=[]){if(!t)return{stageName:"",totalCount:0,employees:[],others:null};const a=o.find(n=>n.id===s),p=a?a.name:"",r=a?a.color:"#007bff",l=Ge(s,t),d=vt(s,t);if(l.length===0)return{stageName:p,totalCount:0,employees:[],others:null};const i=Ye(l,d,r,We);return{stageName:p,totalCount:d,employees:i.employees,others:i.others}}function hs(s,t){return t?.[s]||s}function ys(s,t){return t?.[s]||"#007bff"}function et({snapshots:s,graphType:t,timePoint:o,snapshotType:a}){return s?t==="line"&&o?s[o]||null:t==="bar"&&a?s[a]||null:s.current||s.weekEnd||s.weekStart||null:null}function tt(s,t){return t?.statistics?.stages?.[s]?.count||0}function ks({stageId:s,timePoint:t,meta:o,snapshots:a,stageColor:p,maxVisible:r}){if(!o?.employees||!t)return null;const l=o.employees[t];if(!l||l.length===0)return null;const d=a?.[t]||null,i=tt(s,d)||l.reduce((C,_)=>C+(_.count||0),0),n=Ye(l,i,p,r);return{stageId:s,totalCount:i,employees:n.employees,others:n.others,snapshot:d}}function bs({stageId:s,meta:t,snapshots:o,stageColor:a,maxVisible:p}){const r=t?.employees?.[s];if(!r||!r.employees||r.employees.length===0)return null;const l=et({snapshots:o,graphType:"doughnut"}),d=r.totalCount??tt(s,l)??r.employees.reduce((n,C)=>n+(C.count||0),0),i=Ye(r.employees,d,a,p);return{stageId:s,totalCount:d,employees:i.employees,others:i.others,snapshot:l}}function ws({stageId:s,meta:t,snapshots:o,stageColor:a,maxVisible:p,snapshotType:r}){const l=t?.employeesByStage?.[s];if(!l||l.length===0)return null;const d=et({snapshots:o,graphType:"bar",snapshotType:r}),i=tt(s,d)||l.reduce((C,_)=>C+(_.count||0),0),n=Ye(l,i,a,p);return{stageId:s,totalCount:i,employees:n.employees,others:n.others,snapshot:d}}async function yt({stageId:s,graphType:t,timePoint:o=null,snapshotType:a=null,snapshots:p=null,meta:r=null,stageColorMap:l=null,stageNameMap:d=null,maxVisible:i=10,restLoader:n=null}){if(!s)throw new Error("stageId Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑƒÑ€Ð¾Ð²Ð½Ñ 1");const C=hs(s,d),_=ys(s,l);let u=null;if(t==="line"?u=ks({stageId:s,timePoint:o,meta:r?.line,snapshots:p,stageColor:_,maxVisible:i}):t==="doughnut"?u=bs({stageId:s,meta:r?.doughnut,snapshots:p,stageColor:_,maxVisible:i}):t==="bar"&&(u=ws({stageId:s,meta:r?.bar,snapshots:p,stageColor:_,maxVisible:i,snapshotType:a})),u)return{stageId:s,stageName:C,color:_,totalCount:u.totalCount,employees:u.employees,others:u.others,snapshot:u.snapshot};if(typeof n=="function"){const v=await n({stageId:s,graphType:t,timePoint:o,snapshotType:a,snapshots:p});if(v&&Array.isArray(v.employees)){const b=v.totalCount??v.employees.reduce((S,D)=>S+(D.count||0),0),N=Ye(v.employees,b,_,i);return{stageId:s,stageName:C,color:_,totalCount:b,employees:N.employees,others:N.others,snapshot:v.snapshot||et({snapshots:p,graphType:t,timePoint:o,snapshotType:a})}}}throw new Error("Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¹ ÑÑ‚Ð°Ð´Ð¸Ð¸ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ (meta/REST)")}const Cs={key:"level-1",class:"level-1"},Ds={class:"modal-header"},_s={class:"stage-header"},Es=["aria-expanded","onKeydown"],Ss={class:"stage-title"},Ts=["aria-selected","onClick","onKeydown"],$s={class:"stage-name"},Ms={class:"modal-total"},Ns={class:"view-switcher"},xs={class:"modal-body"},As={key:0,class:"load-error"},Is={key:1,class:"stage-loader"},Fs={key:2},Ls={key:0,class:"no-employees"},Ps={key:1,class:"employees-list"},Bs=["onClick"],Hs={class:"employee-name"},Os={class:"employee-progress"},Rs={class:"employee-count"},Ws={key:0,class:"employee-item employee-others"},Us={class:"employee-name"},js={class:"employee-progress"},zs={class:"employee-count"},Ys={key:3,class:"view-time"},Ks={key:0,class:"no-data"},Vs={key:1,class:"date-categories-list"},Gs=["onClick"],qs={class:"category-label"},Xs={class:"category-progress"},Js={class:"category-count"},Zs={key:4,class:"view-departments"},Qs={key:0,class:"no-data"},en={key:1,class:"departments-table-container"},tn={class:"departments-table"},an=["onClick"],sn={class:"col-department"},nn={class:"department-name"},on={class:"col-count"},ln={class:"count-value"},rn={key:"level-2",class:"level-2"},cn={class:"modal-header"},un={class:"modal-total"},dn={class:"modal-body"},pn={class:"stage-info level2-stage-row"},mn={class:"stage-badge"},gn={class:"level2-sort-switch",role:"group","aria-label":"ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ¸"},fn={key:0},vn={key:0,class:"no-data"},hn={key:1,class:"date-categories-list"},yn=["onClick"],kn={class:"category-label"},bn={class:"category-progress"},wn={class:"category-count"},Cn={key:1,class:"view-departments"},Dn={key:0,class:"no-data"},_n={key:1,class:"departments-table-container"},En={class:"departments-table"},Sn=["onClick"],Tn={class:"col-department"},$n={class:"department-name"},Mn={class:"col-count"},Nn={class:"count-value"},xn={key:"level-3",class:"level-3"},An={class:"modal-header"},In={class:"header-info"},Fn={class:"header-badges"},Ln={class:"date-badge"},Pn={class:"stage-badge"},Bn={class:"modal-total"},Hn={class:"modal-body"},On={key:0,class:"no-data"},Rn={key:1,class:"departments-table-container"},Wn={class:"departments-table"},Un=["onClick"],jn={class:"col-department"},zn={class:"department-name"},Yn={class:"col-count"},Kn={class:"count-value"},Vn={key:"level-4",class:"level-4"},Gn={class:"modal-header"},qn={class:"header-info"},Xn={key:0,class:"header-badges"},Jn={key:0,class:"date-badge"},Zn={key:1,class:"department-badge"},Qn={class:"stage-badge"},eo={class:"modal-total"},to={class:"modal-body"},ao={key:"loading",class:"loading-state"},so={key:"error-fallback",class:"error-state-with-fallback"},no={class:"tickets-list-container"},oo={key:"error",class:"error-state"},lo={class:"error-message"},ro={key:"empty",class:"empty-state"},io={class:"empty-state-title"},co={class:"empty-state-message"},uo={key:"tickets",class:"tickets-list-container"},po={__name:"EmployeeDetailsModal",props:{isVisible:{type:Boolean,default:!1},stageName:{type:String,required:!0},stageId:{type:String,default:""},totalCount:{type:Number,required:!0},employees:{type:Array,default:()=>[]},others:{type:Object,default:null},snapshot:{type:Object,default:null},ticketDetails:{type:Object,default:null},stageSwitchContext:{type:Object,default:null}},emits:["close"],setup(s,{expose:t,emit:o}){const a=s,p=o,r=Xe(),l=A(1),d=A("time"),i=A("employees"),n=A(null),C=A([]),_=A([]),u=A(null),v=A(null),b=A(null),N=A(a.stageSwitchContext||null),S=A(!1),D=A(null),L=A(null),U=A(!1),V=A(null),P=A(null),$=te(()=>{const g=N.value?.stageNameMap||{},m=N.value?.stageColorMap||{};return Object.keys(g).map(c=>({id:c,name:g[c],color:m[c]||"#007bff",disabled:c===(n.value?.stageId||a.stageId)}))});te(()=>l.value>1);const T=te(()=>{switch(l.value){case 1:return n.value?.stageName||a.stageName;case 2:return u.value?.employeeName||"";case 3:return`${u.value?.employeeName||""} â€” ${v.value?.dateCategoryLabel||""}`;case 4:if(!b.value?.context)return"Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²";const g=b.value.context,m=[];return g.employeeName&&m.push(g.employeeName),g.dateCategoryLabel&&m.push(g.dateCategoryLabel),g.departmentName&&m.push(g.departmentName),g.stageName&&m.push(g.stageName),m.length>0?m.join(" â€” "):"Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²";default:return""}});function O(){console.log("[EmployeeDetailsModal] Initializing level 1 with props:",{stageName:a.stageName,stageId:a.stageId,totalCount:a.totalCount,employeesCount:a.employees?.length||0,hasSnapshot:!!a.snapshot,snapshotTicketIds:a.snapshot?.ticketIds?.length||0,hasTicketDetails:!!a.ticketDetails,snapshotKeys:a.snapshot?Object.keys(a.snapshot):[]}),n.value={stageName:a.stageName,stageId:a.stageId,totalCount:a.totalCount,employees:a.employees||[],others:a.others||null,snapshot:a.snapshot||null,ticketDetails:a.ticketDetails||null},console.log("[EmployeeDetailsModal] Level 1 data initialized:",{stageId:n.value.stageId,hasSnapshot:!!n.value.snapshot,employeesCount:n.value.employees.length,snapshotType:n.value.snapshot?typeof n.value.snapshot:"null"}),u.value=null,v.value=null,b.value=null,l.value=1,d.value="time",i.value="employees",R(),console.log("[EmployeeDetailsModal] Popup level set to 1, ready for clicks")}async function R(){if(!n.value||!n.value.snapshot||!n.value.stageId){console.warn("[EmployeeDetailsModal] Cannot load level 1 view data - missing required data");return}try{const g=n.value.snapshot.tickets||[],m=n.value.stageId;console.log("[EmployeeDetailsModal] Loading level 1 view data:",{totalSnapshotTickets:g.length,currentStageId:m,sampleTicket:g[0]?{id:g[0].id,stageId:g[0].stageId,hasDepartmentHead:!!g[0].departmentHead,departmentHead:g[0].departmentHead,hasDepartmentHeadFull:!!g[0].departmentHeadFull,departmentHeadFull:g[0].departmentHeadFull,allKeys:Object.keys(g[0])}:null});let c=g.filter(B=>B.stageId?Ve(B.stageId)===m:!0);console.log("[EmployeeDetailsModal] Filtered tickets by stage:",{beforeFilter:g.length,afterFilter:c.length,stageId:m,ticketsWithStageId:c.filter(B=>B.stageId).length,ticketsWithoutStageId:c.filter(B=>!B.stageId).length});const M=c.filter(B=>!B.departmentHead&&!B.departmentHeadFull);if(M.length>0){console.log("[EmployeeDetailsModal] DepartmentHead missing for some tickets, loading via API...",{ticketsNeedingDetails:M.length,totalTickets:c.length,ticketsWithDepartment:c.filter(k=>k.departmentHead||k.departmentHeadFull).length});const B=M.map(k=>k.id).filter(k=>k);try{console.log("[EmployeeDetailsModal] Loading details for tickets:",{ticketIdsCount:B.length,ticketIdsSample:B.slice(0,10)});const k=await pt.getTicketsDetails(B),f=new Map;k.forEach(h=>{h&&h.id&&f.set(h.id,h)}),console.log("[EmployeeDetailsModal] Details loaded from API:",{detailsCount:k.length,detailsMapSize:f.size,sampleDetail:k[0]?{id:k[0].id,departmentHead:k[0].departmentHead,departmentHeadFull:k[0].departmentHeadFull}:null}),c=c.map(h=>{const I=f.get(h.id);return I?{...h,stageId:I.stageId||h.stageId||null,departmentHead:I.departmentHead||h.departmentHead||null,departmentHeadFull:I.departmentHeadFull||I.departmentHead||h.departmentHead||null}:h}),c=c.filter(h=>h.stageId?Ve(h.stageId)===m:!0),console.log("[EmployeeDetailsModal] Ticket details merged (before stage filter):",{totalTickets:c.length,ticketsWithDepartment:c.filter(h=>h.departmentHead||h.departmentHeadFull).length,ticketsWithoutDepartment:c.filter(h=>!h.departmentHead&&!h.departmentHeadFull).length,ticketsWithStageId:c.filter(h=>h.stageId).length,ticketsWithoutStageId:c.filter(h=>!h.stageId).length});const E=c.length,x=c.slice(0,3).map(h=>({id:h.id,departmentHead:h.departmentHead,departmentHeadFull:h.departmentHeadFull,stageId:h.stageId}));c=c.filter(h=>h.stageId?Ve(h.stageId)===m:!0);const H=c.slice(0,3).map(h=>({id:h.id,departmentHead:h.departmentHead,departmentHeadFull:h.departmentHeadFull,stageId:h.stageId}));console.log("[EmployeeDetailsModal] Ticket details merged (after stage filter):",{beforeStageFilter:E,afterStageFilter:c.length,filteredOut:E-c.length,currentStageId:m,ticketsWithDepartment:c.filter(h=>h.departmentHead||h.departmentHeadFull).length,ticketsWithoutDepartment:c.filter(h=>!h.departmentHead&&!h.departmentHeadFull).length,sampleBeforeFilter:x,sampleAfterFilter:H,sampleWithDepartment:c.find(h=>h.departmentHead||h.departmentHeadFull)?{id:c.find(h=>h.departmentHead||h.departmentHeadFull).id,departmentHead:c.find(h=>h.departmentHead||h.departmentHeadFull).departmentHead,departmentHeadFull:c.find(h=>h.departmentHead||h.departmentHeadFull).departmentHeadFull,allKeys:Object.keys(c.find(h=>h.departmentHead||h.departmentHeadFull)).filter(h=>h.toLowerCase().includes("department"))}:null})}catch(k){console.warn("[EmployeeDetailsModal] Failed to load ticket details via API, using snapshot data:",k),console.error("[EmployeeDetailsModal] Error details:",{message:k.message,stack:k.stack})}}else console.log("[EmployeeDetailsModal] All tickets have departmentHead, skipping API load");console.log("[EmployeeDetailsModal] Final tickets for grouping (only current stage):",{totalTickets:c.length,currentStageId:m,ticketsWithStageId:c.filter(B=>B.stageId).length,ticketsWithoutStageId:c.filter(B=>!B.stageId).length,ticketsWithDepartment:c.filter(B=>B.departmentHead||B.departmentHeadFull).length,ticketsWithoutDepartment:c.filter(B=>!B.departmentHead&&!B.departmentHeadFull).length});const se=it(c);C.value=se,console.log("[EmployeeDetailsModal] Before groupTicketsByDepartment:",{ticketsCount:c.length,sampleTickets:c.slice(0,5).map(B=>({id:B.id,departmentHead:B.departmentHead,departmentHeadFull:B.departmentHeadFull,hasDepartmentHead:!!B.departmentHead,hasDepartmentHeadFull:!!B.departmentHeadFull,allKeys:Object.keys(B).filter(k=>k.toLowerCase().includes("department"))})),ticketsWithDepartment:c.filter(B=>B.departmentHead||B.departmentHeadFull).length,ticketsWithoutDepartment:c.filter(B=>!B.departmentHead&&!B.departmentHeadFull).length});const ye=ct(c);_.value=ye;const de=se.reduce((B,k)=>B+k.count,0),Me=ye.reduce((B,k)=>B+k.count,0);console.log("[EmployeeDetailsModal] Level 1 view data loaded (only current stage):",{currentStageId:m,totalTicketsForGrouping:c.length,timeCategoriesCount:se.length,totalTicketsInTimeCategories:de,departmentsCount:ye.length,totalTicketsInDepartments:Me,departmentsSample:ye.slice(0,5),ticketsWithDepartment:c.filter(B=>B.departmentHead||B.departmentHeadFull).length,ticketsWithoutDepartment:c.filter(B=>!B.departmentHead&&!B.departmentHeadFull).length,consistencyCheck:{totalTickets:c.length,timeCategoriesTotal:de,departmentsTotal:Me,isConsistent:c.length===de&&c.length===Me}})}catch(g){console.error("[EmployeeDetailsModal] Error loading level 1 view data:",g),console.error("[EmployeeDetailsModal] Error stack:",g.stack)}}async function G(g){if(!g){r.error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½ stageId Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…");return}if(n.value?.stageId===g)return;if(!N.value){r.error("ÐÐµÑ‚ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° Ð´Ð»Ñ ÑÐ¼ÐµÐ½Ñ‹ ÑÑ‚Ð°Ð´Ð¸Ð¸ (stageSwitchContext)");return}S.value=!0,D.value=null;const m=n.value?{...n.value}:null;L.value=m?.stageId||null;try{const c=await yt({...N.value,stageId:g});n.value={stageId:c.stageId,stageName:c.stageName,stageColor:c.color,totalCount:c.totalCount,employees:c.employees,others:c.others,snapshot:c.snapshot||m?.snapshot||null,ticketDetails:c.ticketDetails||null},u.value=null,v.value=null,b.value=null,l.value=1,d.value="time",i.value="employees",await R()}catch(c){console.error("[EmployeeDetailsModal] Failed to reload stage data:",c),D.value=c?.message||"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÑ‚Ð°Ð´Ð¸Ð¸",m&&(n.value=m),r.error(D.value)}finally{S.value=!1}}async function J(g){if(!g||g.count===0){r.info(`Ð£ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ° "${g?.departmentName||"Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹"}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`);return}if(!v.value){console.error("[EmployeeDetailsModal] Level 3 data not found"),r.error("ÐžÑˆÐ¸Ð±ÐºÐ°: Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑƒÑ€Ð¾Ð²Ð½Ñ 3 Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹");return}try{const{createContextFromLevel3:m}=await _e(async()=>{const{createContextFromLevel3:M}=await import("./ticketListUtils-CpKfsjsI.js");return{createContextFromLevel3:M}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),c=await m(v.value,g);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 3:",{employeeName:c.employeeName,dateCategory:c.dateCategoryLabel,departmentName:c.departmentName,ticketsCount:c.tickets.length}),await fe(c)}catch(m){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 3:",m),r.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð° Ð½Ð° ÑÐ¿Ð¸ÑÐ¾Ðº Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: "+m.message)}}async function Z(g){if(!g||g.count===0){r.info(`Ð£ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ° "${g?.departmentName||"Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹"}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`);return}if(!n.value){console.error("[EmployeeDetailsModal] Level 1 data not found"),r.error("ÐžÑˆÐ¸Ð±ÐºÐ°: Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑƒÑ€Ð¾Ð²Ð½Ñ 1 Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹");return}try{const{createContextFromLevel1Department:m}=await _e(async()=>{const{createContextFromLevel1Department:M}=await import("./ticketListUtils-CpKfsjsI.js");return{createContextFromLevel1Department:M}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),c=m(n.value,g);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 1 (department):",{stageName:c.stageName,departmentName:c.departmentName,ticketsCount:c.tickets.length}),await fe(c)}catch(m){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 1 (department):",m),r.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð° Ð½Ð° ÑÐ¿Ð¸ÑÐ¾Ðº Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: "+m.message)}}async function ee(g){if(!g||g.count===0){r.info(`Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${g?.label||"Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ"}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`);return}if(!g.tickets||g.tickets.length===0){r.info(`Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${g.label}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`);return}if(!n.value){console.error("[EmployeeDetailsModal] Level 1 data not found"),r.error("ÐžÑˆÐ¸Ð±ÐºÐ°: Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑƒÑ€Ð¾Ð²Ð½Ñ 1 Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹");return}try{const{createContextFromLevel1Time:m}=await _e(async()=>{const{createContextFromLevel1Time:M}=await import("./ticketListUtils-CpKfsjsI.js");return{createContextFromLevel1Time:M}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),c=m(n.value,g);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 1 (time):",{stageName:c.stageName,dateCategory:c.dateCategoryLabel,ticketsCount:c.tickets.length}),await fe(c)}catch(m){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 1 (time):",m),r.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð° Ð½Ð° ÑÐ¿Ð¸ÑÐ¾Ðº Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: "+m.message)}}Ae(()=>a.isVisible,g=>{g?O():(Fe(),me())}),Ae(()=>a.stageSwitchContext,g=>{N.value=g},{deep:!0}),Te(()=>{a.isVisible&&O()});async function pe(g,m=null){if(console.log("[EmployeeDetailsModal] ====== handleEmployeeClick START ======"),console.log("[EmployeeDetailsModal] Employee clicked:",g),console.log("[EmployeeDetailsModal] Current popup level:",l.value),m&&m.currentTarget&&(m.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{m.currentTarget&&(m.currentTarget.style.transform="")},150)),!g||!g.id){console.warn("[EmployeeDetailsModal] Invalid employee data:",g);return}if(n.value||(console.log("[EmployeeDetailsModal] Level 1 data not found, initializing from props"),n.value={stageName:a.stageName,stageId:a.stageId,totalCount:a.totalCount,employees:a.employees||[],others:a.others||null,snapshot:a.snapshot||null,ticketDetails:a.ticketDetails||null}),console.log("[EmployeeDetailsModal] Level 1 data:",{stageId:n.value.stageId,stageName:n.value.stageName,hasSnapshot:!!n.value.snapshot,snapshotType:n.value.snapshot?typeof n.value.snapshot:"null",snapshotKeys:n.value.snapshot?Object.keys(n.value.snapshot):[]}),!n.value.stageId){console.error("[EmployeeDetailsModal] ERROR: ID ÑÑ‚Ð°Ð´Ð¸Ð¸ Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½"),r.warning("ID ÑÑ‚Ð°Ð´Ð¸Ð¸ Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½");return}if(!n.value.snapshot){console.error("[EmployeeDetailsModal] ERROR: Ð¡Ð»ÐµÐ¿Ð¾Ðº Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½"),console.error("[EmployeeDetailsModal] Props snapshot:",a.snapshot),r.warning("Ð¡Ð»ÐµÐ¿Ð¾Ðº Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½");return}try{console.log("[EmployeeDetailsModal] Loading tickets for employee:",g.id,"stage:",n.value.stageId);const{filterTicketsByDepartment:c}=await _e(async()=>{const{filterTicketsByDepartment:de}=await import("./chunk-BTnG7_Rn.js").then(Me=>Me.p);return{filterTicketsByDepartment:de}},__vite__mapDeps([3,2,1,7,6,5,8,4]),import.meta.url).then(de=>de.LazyServiceLoader.loadTicketListUtils()),M=await ps(g.id,n.value.stageId,n.value.snapshot,n.value.ticketDetails);if(console.log("[EmployeeDetailsModal] Loaded tickets:",M?.length||0,M),!M||M.length===0){console.warn("[EmployeeDetailsModal] No tickets found for employee"),r.info(`Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° "${g.name}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð½Ð° ÑÑ‚Ð°Ð´Ð¸Ð¸ "${n.value.stageName}"`);return}const se=it(M);console.log("[EmployeeDetailsModal] Date categories:",se?.length||0,se);const ye=ct(M).map(de=>({...de,tickets:c(M,de.departmentName)}));console.log("[EmployeeDetailsModal] Employee departments:",ye?.length||0,ye),u.value={employeeId:g.id,employeeName:g.name,stageId:n.value.stageId,stageName:n.value.stageName,totalCount:M.length,dateCategories:se,departments:ye,tickets:M,snapshot:n.value.snapshot,ticketDetails:n.value.ticketDetails},d.value="time",console.log("[EmployeeDetailsModal] Level 2 data set:",{employeeName:u.value.employeeName,totalCount:u.value.totalCount,dateCategoriesCount:u.value.dateCategories.length,departmentsCount:u.value.departments.length}),console.log("[EmployeeDetailsModal] Transitioning to level 2"),console.log("[EmployeeDetailsModal] Level 2 data before set:",u.value),l.value=2,console.log("[EmployeeDetailsModal] Popup level set to:",l.value),console.log("[EmployeeDetailsModal] Level 2 data after set:",u.value),console.log("[EmployeeDetailsModal] Level 2 data check:",{hasLevel2Data:!!u.value,employeeName:u.value?.employeeName,dateCategoriesCount:u.value?.dateCategories?.length||0}),setTimeout(()=>{console.log("[EmployeeDetailsModal] After timeout - popupLevel:",l.value),console.log("[EmployeeDetailsModal] After timeout - level2Data:",u.value)},100),console.log("[EmployeeDetailsModal] ====== handleEmployeeClick END ======")}catch(c){console.error("[EmployeeDetailsModal] ERROR loading employee tickets:",c),console.error("[EmployeeDetailsModal] Error stack:",c.stack),r.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ Ñ‚Ð¸ÐºÐµÑ‚Ð°Ñ…: "+c.message)}}async function Ue(g){if(!g||g.count===0){r.info(`Ð£ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ° "${g?.departmentName||"Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹"}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`);return}if(!u.value){r.error("ÐžÑˆÐ¸Ð±ÐºÐ°: Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹");return}try{const{createContextFromLevel2Department:m}=await _e(async()=>{const{createContextFromLevel2Department:M}=await import("./ticketListUtils-CpKfsjsI.js");return{createContextFromLevel2Department:M}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),c=m(u.value,g);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 2 (department):",{employeeName:c.employeeName,departmentName:c.departmentName,ticketsCount:c.tickets.length}),await fe(c)}catch(m){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 2 (department):",m),r.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð° Ð½Ð° ÑÐ¿Ð¸ÑÐ¾Ðº Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: "+m.message)}}async function Ie(g){if(!g||g.count===0){r.info(`Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${g?.label||"Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ"}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`);return}if(!g.tickets||g.tickets.length===0){r.info(`Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${g.label}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`);return}if(!u.value){console.error("[EmployeeDetailsModal] Level 2 data not found"),r.error("ÐžÑˆÐ¸Ð±ÐºÐ°: Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑƒÑ€Ð¾Ð²Ð½Ñ 2 Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹");return}try{const{createContextFromLevel2:m}=await _e(async()=>{const{createContextFromLevel2:M}=await import("./ticketListUtils-CpKfsjsI.js");return{createContextFromLevel2:M}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),c=m(u.value,g);console.log("[EmployeeDetailsModal] Transitioning to level 4 from level 2:",{employeeName:c.employeeName,dateCategory:c.dateCategoryLabel,ticketsCount:c.tickets.length}),await fe(c)}catch(m){console.error("[EmployeeDetailsModal] Error transitioning to level 4 from level 2:",m),r.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð° Ð½Ð° ÑÐ¿Ð¸ÑÐ¾Ðº Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: "+m.message)}}async function fe(g){if(console.time("[Performance] goToLevel4"),!g){console.error("[EmployeeDetailsModal] Context is required for level 4"),r.error("ÐžÑˆÐ¸Ð±ÐºÐ°: ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð° Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½"),console.timeEnd("[Performance] goToLevel4");return}console.log("[EmployeeDetailsModal] Transitioning to level 4:",{sourceLevel:g.sourceLevel,employeeId:g.employeeId,stageId:g.stageId,dateCategory:g.dateCategory,departmentName:g.departmentName,ticketsCount:g.tickets?.length||0});try{b.value={context:g,tickets:[],totalCount:0,isLoading:!0,error:null};let m=g.tickets||[];if(m.length===0&&g.snapshot){const{filterTicketsByContext:M}=await _e(async()=>{const{filterTicketsByContext:se}=await import("./ticketListUtils-CpKfsjsI.js");return{filterTicketsByContext:se}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url);m=await M(g)}(!m||m.length===0)&&(console.warn("[EmployeeDetailsModal] No tickets found after filtering, using context tickets"),m=g.tickets||[]),(!m||m.length===0)&&(console.warn("[EmployeeDetailsModal] No tickets in context, trying snapshot"),g.snapshot&&g.snapshot.tickets&&(m=g.snapshot.tickets||[],console.log("[EmployeeDetailsModal] Using tickets from snapshot:",m.length)));let c=[];try{console.time("[Performance] prepareTicketsForDisplay");const{prepareTicketsForDisplay:M}=await _e(async()=>{const{prepareTicketsForDisplay:se}=await import("./ticketListUtils-CpKfsjsI.js");return{prepareTicketsForDisplay:se}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url);c=await M(m,g.snapshot,g.ticketDetails),console.timeEnd("[Performance] prepareTicketsForDisplay")}catch(M){console.error("[EmployeeDetailsModal] Error preparing tickets:",M),console.timeEnd("[Performance] prepareTicketsForDisplay"),c=m||[],r.warning("ÐÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ. ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ.")}console.log("[EmployeeDetailsModal] Tickets prepared for level 4:",{filteredCount:m.length,preparedCount:c.length}),b.value={context:g,tickets:c,totalCount:c.length,isLoading:!1,error:null},l.value=4,console.log("[EmployeeDetailsModal] Level 4 initialized:",{totalCount:b.value.totalCount,ticketsCount:b.value.tickets.length,isLoading:b.value.isLoading}),console.timeEnd("[Performance] goToLevel4")}catch(m){console.error("[EmployeeDetailsModal] Error transitioning to level 4:",m),console.error("[EmployeeDetailsModal] Error details:",{message:m.message,stack:m.stack,context:g});let c=[];if(g.snapshot&&g.snapshot.tickets)try{const M=g.stageId;M?c=(g.snapshot.tickets||[]).filter(se=>se.stageId===M):c=g.snapshot.tickets||[],console.log("[EmployeeDetailsModal] Using fallback tickets from snapshot:",c.length)}catch(M){console.error("[EmployeeDetailsModal] Error using fallback tickets:",M)}b.value={context:g,tickets:c,totalCount:c.length,isLoading:!1,error:{message:m.message,hasFallback:c.length>0}},c.length>0?(r.warning("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· ÐºÐµÑˆÐ°."),l.value=4):(r.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: "+m.message),Ce()),console.timeEnd("[Performance] goToLevel4")}}function Ce(){if(l.value===4){if(b.value&&b.value.context){const g=b.value.context.sourceLevel;l.value=g}else l.value=1;b.value=null}else l.value===3?(l.value=2,v.value=null,b.value=null):l.value===2&&(l.value=1,u.value=null,v.value=null,b.value=null)}function Fe(){l.value=1,n.value=null,u.value=null,v.value=null,b.value=null,d.value="time"}function De(){if(!b.value?.context)return"ÐÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²";const{sourceLevel:g,employeeName:m,dateCategoryLabel:c,departmentName:M}=b.value.context;return g===2&&m&&c?`ÐÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ñƒ ${m} Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${c}"`:g===2&&m&&M?`ÐÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ñƒ ${m} Ñƒ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ° "${M}"`:g===3&&m&&M?`ÐÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ñƒ ${m} Ñƒ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ° "${M}"`:g===1&&c?`ÐÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${c}"`:g===1&&M?`ÐÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ñƒ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ° "${M}"`:"ÐÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ"}function Le(){if(!b.value?.context)return"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³ÑƒÑŽ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ Ð¸Ð»Ð¸ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°.";const{stageName:g}=b.value.context;return g?`ÐÐ° ÑÑ‚Ð°Ð´Ð¸Ð¸ "${g}" Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð², ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¼ ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸ÑÐ¼.`:"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³ÑƒÑŽ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ Ð¸Ð»Ð¸ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°."}async function Pe(){if(!b.value?.context){console.error("[EmployeeDetailsModal] Cannot retry: context not found");return}const g=b.value.context;await fe(g)}function $e(g){if(!g){console.warn("[EmployeeDetailsModal] Ticket is null or undefined"),r.warning("ÐžÑˆÐ¸Ð±ÐºÐ°: Ñ‚Ð¸ÐºÐµÑ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½");return}if(!g.id){console.error("[EmployeeDetailsModal] Ticket ID is missing:",g),r.error("ÐžÑˆÐ¸Ð±ÐºÐ°: ID Ñ‚Ð¸ÐºÐµÑ‚Ð° Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½");return}try{const m=jt(g.id);if(console.log("[EmployeeDetailsModal] Opening ticket:",{ticketId:g.id,iframeUrl:m}),!m||typeof m!="string"||m.length===0)throw new Error("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÑ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ URL Ð´Ð»Ñ Ñ‚Ð¸ÐºÐµÑ‚Ð°");const c=window.open(m,"_blank","noopener,noreferrer");if(!c||c.closed||typeof c.closed>"u")try{const M=document.createElement("a");M.href=m,M.target="_blank",M.rel="noopener noreferrer",M.style.display="none",document.body.appendChild(M),M.click(),document.body.removeChild(M),console.log("[EmployeeDetailsModal] Ticket opened via alternative method:",{ticketId:g.id,iframeUrl:m})}catch{throw new Error("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð²ÐºÐ»Ð°Ð´ÐºÑƒ. Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾, Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½ popup blocker. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð²ÑÐ¿Ð»Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ðµ Ð¾ÐºÐ½Ð° Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ ÑÐ°Ð¹Ñ‚Ð°.")}else console.log("[EmployeeDetailsModal] Ticket opened successfully:",{ticketId:g.id,iframeUrl:m})}catch(m){console.error("[EmployeeDetailsModal] Error opening ticket:",m),console.error("[EmployeeDetailsModal] Error details:",{message:m.message,stack:m.stack,ticket:g}),r.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ñ‚Ð¸ÐºÐµÑ‚Ð°: "+m.message)}}function W(){Fe(),p("close")}t({reloadLevel1ForStage:G});function z(g){g&&g.stopPropagation(),U.value=!U.value}function me(){U.value&&(U.value=!1)}function Be(g){if(!U.value)return;const m=V.value,c=P.value;m&&m.contains(g.target)||c&&c.contains(g.target)||(U.value=!1)}async function ge(g){if(g.disabled){U.value=!1;return}U.value=!1,await G(g.id)}function He(g){if(U.value){g.stopPropagation(),me();return}W()}return(g,m)=>(y(),Se(dt,{to:"body"},[s.isVisible?(y(),w("div",{key:0,class:"employee-details-modal",onClick:ae(W,["self"]),onKeydown:je(He,["esc"])},[e("div",{class:"modal-content",onClick:Be},[re(Re,{name:"level",mode:"out-in"},{default:be(()=>[l.value===1?(y(),w("div",Cs,[e("div",Ds,[e("div",_s,[e("button",{ref_key:"stageTriggerRef",ref:P,class:"stage-trigger","aria-expanded":U.value,"aria-haspopup":"listbox",onClick:ae(z,["stop"]),onKeydown:[je(ae(z,["prevent"]),["enter"]),je(ae(z,["prevent"]),["space"]),je(ae(me,["stop","prevent"]),["esc"])]},[e("span",{class:"stage-color",style:he({backgroundColor:n.value?.stageColor||N.value?.stageColorMap?.[n.value?.stageId]||N.value?.stageColorMap?.[s.stageId]||"#007bff"})},null,4),e("span",Ss,F(n.value?.stageName||s.stageName),1),e("span",{class:Q(["stage-caret",{open:U.value}])},"â–¾",2)],40,Es),U.value?(y(),w("div",{key:0,ref_key:"stageDropdownRef",ref:V,class:"stage-dropdown",role:"listbox"},[(y(!0),w(oe,null,ue($.value,c=>(y(),w("div",{key:c.id,class:Q(["stage-option",{disabled:c.disabled}]),role:"option","aria-selected":c.disabled,onClick:ae(M=>ge(c),["stop"]),onKeydown:je(ae(M=>ge(c),["prevent"]),["enter"])},[e("span",{class:"stage-color",style:he({backgroundColor:c.color})},null,4),e("span",$s,F(c.name),1)],42,Ts))),128))],512)):Y("",!0)]),e("span",Ms,"Ð’ÑÐµÐ³Ð¾: "+F(n.value?.totalCount||s.totalCount)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1),e("button",{class:"modal-close",onClick:W,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"},"Ã—")]),e("div",Ns,[e("button",{class:Q(["view-switch-btn",{active:i.value==="employees"}]),onClick:m[0]||(m[0]=c=>i.value="employees"),title:"ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼"}," ðŸ‘¥ ÐŸÐ¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼ ",2),e("button",{class:Q(["view-switch-btn",{active:i.value==="time"}]),onClick:m[1]||(m[1]=c=>i.value="time"),title:"ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼ Ð³Ñ€Ð°Ð´Ð°Ñ†Ð¸ÑÐ¼"}," ðŸ“… ÐŸÐ¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ ",2),e("button",{class:Q(["view-switch-btn",{active:i.value==="departments"}]),onClick:m[2]||(m[2]=c=>i.value="departments"),title:"ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°Ð¼"}," ðŸ¢ ÐŸÐ¾ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°Ð¼ ",2)]),e("div",xs,[D.value?(y(),w("div",As,[e("span",null,"ÐžÑˆÐ¸Ð±ÐºÐ°: "+F(D.value),1),e("button",{class:"btn-retry-stage",onClick:m[3]||(m[3]=c=>G(n.value?.stageId||s.stageId))}," ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ ")])):Y("",!0),S.value?(y(),w("div",Is,[...m[7]||(m[7]=[e("div",{class:"loading-spinner small"},null,-1),e("span",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÑ‚Ð°Ð´Ð¸Ð¸...",-1)])])):Y("",!0),i.value==="employees"?(y(),w("div",Fs,[(n.value?.employees||s.employees).length===0&&(!(n.value?.others||s.others)||(n.value?.others||s.others).count===0)?(y(),w("div",Ls," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ñ… ")):(y(),w("div",Ps,[(y(!0),w(oe,null,ue(n.value?.employees||s.employees,c=>(y(),w("div",{key:c.id,class:Q(["employee-item",{"employee-keeper":c.isKeeper}]),onClick:ae(M=>pe(c,M),["stop"]),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼ Ð³Ñ€Ð°Ð´Ð°Ñ†Ð¸ÑÐ¼"},[e("span",Hs,F(c.name),1),e("div",Os,[e("div",{class:"progress-bar",style:he({width:c.progressBarWidth+"%",backgroundColor:c.progressBarColor})},null,4)]),e("span",Rs,F(c.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ("+F(c.percentage)+"%) ",1),m[8]||(m[8]=e("span",{class:"employee-arrow"},"â†’",-1))],10,Bs))),128)),(n.value?.others||s.others)&&(n.value?.others||s.others).count>0?(y(),w("div",Ws,[e("span",Us,"Ð”Ñ€ÑƒÐ³Ð¸Ðµ ("+F((n.value?.others||s.others).employeeCount)+")",1),e("div",js,[e("div",{class:"progress-bar",style:he({width:(n.value?.others||s.others).progressBarWidth+"%",backgroundColor:(n.value?.others||s.others).progressBarColor})},null,4)]),e("span",zs,F((n.value?.others||s.others).count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ("+F((n.value?.others||s.others).percentage)+"%) ",1)])):Y("",!0)]))])):i.value==="time"?(y(),w("div",Ys,[C.value.length===0?(y(),w("div",Ks," Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…... ")):(y(),w("div",Vs,[(y(!0),w(oe,null,ue(C.value,c=>(y(),w("div",{key:c.category,class:"category-item",onClick:ae(M=>ee(c),["stop"])},[e("span",qs,F(c.label),1),e("div",Xs,[e("div",{class:"progress-bar",style:he({width:c.progressBarWidth+"%",backgroundColor:c.progressBarColor})},null,4)]),e("span",Js,F(c.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ("+F(c.percentage)+"%) ",1),m[9]||(m[9]=e("span",{class:"category-arrow"},"â†’",-1))],8,Gs))),128))]))])):i.value==="departments"?(y(),w("div",Zs,[_.value.length===0?(y(),w("div",Qs," Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…... ")):(y(),w("div",en,[e("table",tn,[m[11]||(m[11]=e("thead",null,[e("tr",null,[e("th",{class:"col-department"},"Ð—Ð°ÐºÐ°Ð·Ñ‡Ð¸Ðº"),e("th",{class:"col-count"},"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²"),e("th",{class:"col-action"})])],-1)),e("tbody",null,[(y(!0),w(oe,null,ue(_.value,(c,M)=>(y(),w("tr",{key:M,class:"department-row",onClick:ae(se=>Z(c),["stop"]),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²"},[e("td",sn,[e("span",nn,F(c.departmentName),1)]),e("td",on,[e("span",ln,F(c.count),1)]),m[10]||(m[10]=e("td",{class:"col-action"},[e("span",{class:"department-arrow"},"â†’")],-1))],8,an))),128))])])]))])):Y("",!0)])])):l.value===2&&u.value?(y(),w("div",rn,[e("div",cn,[e("button",{class:"btn-back",onClick:Ce,"aria-label":"ÐÐ°Ð·Ð°Ð´"}," â† "),e("h3",null,F(u.value.employeeName),1),e("span",un,"Ð’ÑÐµÐ³Ð¾: "+F(u.value.totalCount)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1),e("button",{class:"modal-close",onClick:W,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"},"Ã—")]),e("div",dn,[e("div",pn,[e("span",mn,F(u.value.stageName),1),e("div",gn,[e("button",{class:Q(["level2-sort-btn",{active:d.value==="time"}]),onClick:m[4]||(m[4]=c=>d.value="time"),title:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸"}," ÐŸÐ¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ ",2),e("button",{class:Q(["level2-sort-btn",{active:d.value==="departments"}]),onClick:m[5]||(m[5]=c=>d.value="departments"),title:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¿Ð¾ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°Ð¼"}," ÐŸÐ¾ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°Ð¼ ",2)])]),d.value==="time"?(y(),w("div",fn,[u.value.dateCategories.length===0?(y(),w("div",vn," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ Ñ‚Ð¸ÐºÐµÑ‚Ð°Ñ… ")):(y(),w("div",hn,[(y(!0),w(oe,null,ue(u.value.dateCategories,c=>(y(),w("div",{key:c.category,class:"category-item",onClick:ae(M=>Ie(c),["stop"])},[e("span",kn,F(c.label),1),e("div",bn,[e("div",{class:"progress-bar",style:he({width:c.progressBarWidth+"%",backgroundColor:c.progressBarColor})},null,4)]),e("span",wn,F(c.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ("+F(c.percentage)+"%) ",1)],8,yn))),128))]))])):(y(),w("div",Cn,[!u.value.departments||u.value.departments.length===0?(y(),w("div",Dn,[m[12]||(m[12]=Ee(" Ð”Ð»Ñ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ ",-1)),e("button",{class:"btn-retry-stage",onClick:m[6]||(m[6]=c=>pe({id:u.value.employeeId,name:u.value.employeeName}))}," ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ")])):(y(),w("div",_n,[e("table",En,[m[14]||(m[14]=e("thead",null,[e("tr",null,[e("th",{class:"col-department"},"Ð—Ð°ÐºÐ°Ð·Ñ‡Ð¸Ðº"),e("th",{class:"col-count"},"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²"),e("th",{class:"col-action"})])],-1)),e("tbody",null,[(y(!0),w(oe,null,ue(u.value.departments,(c,M)=>(y(),w("tr",{key:M,class:"department-row",onClick:ae(se=>Ue(c),["stop"]),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²"},[e("td",Tn,[e("span",$n,F(c.departmentName),1)]),e("td",Mn,[e("span",Nn,F(c.count),1)]),m[13]||(m[13]=e("td",{class:"col-action"},[e("span",{class:"department-arrow"},"â†’")],-1))],8,Sn))),128))])])]))]))])])):l.value===3&&v.value?(y(),w("div",xn,[e("div",An,[e("button",{class:"btn-back",onClick:Ce,"aria-label":"ÐÐ°Ð·Ð°Ð´"}," â† "),e("div",In,[e("h3",null,F(v.value.employeeName),1),e("div",Fn,[e("span",Ln,F(v.value.dateCategoryLabel),1),e("span",Pn,F(v.value.stageName),1)])]),e("span",Bn,"Ð’ÑÐµÐ³Ð¾: "+F(v.value.totalCount)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1),e("button",{class:"modal-close",onClick:W,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"},"Ã—")]),e("div",Hn,[v.value.departments.length===0?(y(),w("div",On," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ Ð·Ð°ÐºÐ°Ð·Ñ‡Ð¸ÐºÐ°Ñ… ")):(y(),w("div",Rn,[e("table",Wn,[m[16]||(m[16]=e("thead",null,[e("tr",null,[e("th",{class:"col-department"},"Ð—Ð°ÐºÐ°Ð·Ñ‡Ð¸Ðº"),e("th",{class:"col-count"},"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²"),e("th",{class:"col-action"})])],-1)),e("tbody",null,[(y(!0),w(oe,null,ue(v.value.departments,(c,M)=>(y(),w("tr",{key:M,class:"department-row",onClick:ae(se=>J(c),["stop"]),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²"},[e("td",jn,[e("span",zn,F(c.departmentName),1)]),e("td",Yn,[e("span",Kn,F(c.count),1)]),m[15]||(m[15]=e("td",{class:"col-action"},[e("span",{class:"department-arrow"},"â†’")],-1))],8,Un))),128))])])]))])])):l.value===4&&b.value?(y(),w("div",Vn,[e("div",Gn,[e("button",{class:"btn-back",onClick:Ce,"aria-label":"ÐÐ°Ð·Ð°Ð´"}," â† "),e("div",qn,[e("h3",null,F(T.value),1),b.value.context?(y(),w("div",Xn,[b.value.context.dateCategoryLabel?(y(),w("span",Jn,F(b.value.context.dateCategoryLabel),1)):Y("",!0),b.value.context.departmentName?(y(),w("span",Zn,F(b.value.context.departmentName),1)):Y("",!0),e("span",Qn,F(b.value.context.stageName),1)])):Y("",!0)]),e("span",eo,"Ð’ÑÐµÐ³Ð¾: "+F(b.value.totalCount)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1),e("button",{class:"modal-close",onClick:W,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"},"Ã—")]),e("div",to,[re(Re,{name:"loading",mode:"out-in"},{default:be(()=>[b.value.isLoading?(y(),w("div",ao,[...m[17]||(m[17]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):b.value.error&&b.value.error.hasFallback?(y(),w("div",so,[m[18]||(m[18]=e("div",{class:"error-banner"},[e("span",{class:"error-icon"},"âš ï¸"),e("span",{class:"error-message"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· ÐºÐµÑˆÐ°.")],-1)),e("div",no,[re(st,{name:"ticket",tag:"div",class:"tickets-list"},{default:be(()=>[(y(!0),w(oe,null,ue(b.value.tickets,(c,M)=>(y(),Se(rt,{key:c.id,ticket:c,draggable:!1,style:he({"--ticket-index":M}),onClick:se=>$e(c)},null,8,["ticket","style","onClick"]))),128))]),_:1})])])):b.value.error&&!b.value.error.hasFallback?(y(),w("div",oo,[m[19]||(m[19]=e("div",{class:"error-icon"},"âŒ",-1)),m[20]||(m[20]=e("h3",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…",-1)),e("p",lo,F(b.value.error.message),1),e("button",{class:"btn-retry",onClick:Pe},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÑƒ")])):!b.value.tickets||b.value.tickets.length===0?(y(),w("div",ro,[m[21]||(m[21]=e("div",{class:"empty-state-icon"},"ðŸ“­",-1)),e("h3",io,F(De()),1),e("p",co,F(Le()),1)])):(y(),w("div",uo,[re(st,{name:"ticket",tag:"div",class:"tickets-list"},{default:be(()=>[(y(!0),w(oe,null,ue(b.value.tickets,(c,M)=>(y(),Se(rt,{key:c.id,ticket:c,draggable:!1,style:he({"--ticket-index":M}),onClick:se=>$e(c)},null,8,["ticket","style","onClick"]))),128))]),_:1})]))]),_:1})])])):Y("",!0)]),_:1})])],32)):Y("",!0)]))}},mo=we(po,[["__scopeId","data-v-7fbd8a12"]]);function go(s,t,o=.5){if(!t||!Array.isArray(t)||t.length===0||typeof s!="number"||s<0)return 0;(typeof o!="number"||o<=0)&&(console.warn("getOverlapCount: threshold Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼ Ñ‡Ð¸ÑÐ»Ð¾Ð¼, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ 0.5"),o=.5);const a=[];if(t.forEach((l,d)=>{if(!l||!l.data||!Array.isArray(l.data))return;const i=l.data[s];i!=null&&!isNaN(i)&&a.push({datasetIndex:d,value:Number(i),y:Number(i)})}),a.length<2)return 0;const p=[];return a.forEach(l=>{let d=!1;for(const i of p){const n=i.y;if(Math.abs(l.y-n)<o){i.points.push(l),i.y=i.points.reduce((_,u)=>_+u.y,0)/i.points.length,d=!0;break}}d||p.push({points:[l],y:l.y})}),p.length===0?0:p.reduce((l,d)=>d.points.length>l.points.length?d:l,p[0]).points.length}function fo(s,t){const o=[];return s.forEach(a=>{let p=!1;for(const r of o){const l=r.y;if(Math.abs(a.value-l)<t){r.points.push(a),r.y=r.points.reduce((d,i)=>d+i.value,0)/r.points.length,p=!0;break}}p||o.push({points:[a],y:a.value})}),o}function vo(s,t=.5){if(!s)return console.warn("findOverlappingPoints: chart Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½"),[];if(!s.config||s.config.type!=="line")return[];const o=s.data?.datasets,a=s.data?.labels||[];if(!o||!Array.isArray(o)||o.length===0)return[];if(!Array.isArray(a)||a.length===0)return[];(typeof t!="number"||t<=0)&&(console.warn("findOverlappingPoints: threshold Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼ Ñ‡Ð¸ÑÐ»Ð¾Ð¼, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ 0.5"),t=.5);const p=[];return a.forEach((r,l)=>{try{if(go(l,o,t)<2)return;const i=[];if(o.forEach((v,b)=>{if(!v||!v.data||!Array.isArray(v.data))return;const N=v.data[l];N==null||isNaN(N)||i.push({datasetIndex:b,value:Number(N),label:v.label||`Dataset ${b}`})}),i.length<2)return;const n=fo(i,t);if(n.length===0)return;const C=n.reduce((v,b)=>b.points.length>v.points.length?b:v,n[0]);if(C.points.length<2)return;let _=null,u=null;for(let v=0;v<o.length;v++)try{const b=s.getDatasetMeta(v);if(b&&b.data&&b.data[l]){_=b,u=b.data[l];break}}catch{continue}if(!u||typeof u.x!="number"||typeof u.y!="number")return;p.push({position:l,count:C.points.length,x:u.x,y:u.y,value:C.y,points:C.points.map(v=>({datasetIndex:v.datasetIndex,value:v.value,label:v.label}))})}catch(d){console.warn(`findOverlappingPoints: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ ${l}:`,d)}}),p}function ho(s,t){const o=[];return s.forEach(a=>{let p=!1;for(const r of o){const l=r.y;if(Math.abs(a.y-l)<t){r.points.push(a),r.y=r.points.reduce((d,i)=>d+i.y,0)/r.points.length,p=!0;break}}p||o.push({points:[a],y:a.y})}),o}function yo(s,t,o=.5){if(!s)return console.warn("calculatePointJitter: chart Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½"),[];if(!s.config||s.config.type!=="line")return[];if(typeof t!="number"||t<0)return console.warn("calculatePointJitter: positionIndex Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð½ÐµÐ¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼ Ñ‡Ð¸ÑÐ»Ð¾Ð¼"),[];(typeof o!="number"||o<=0)&&(console.warn("calculatePointJitter: threshold Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼ Ñ‡Ð¸ÑÐ»Ð¾Ð¼, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ 0.5"),o=.5);const a=s.data?.datasets,p=s.data?.labels||[];if(!a||!Array.isArray(a)||a.length===0)return[];if(!Array.isArray(p)||t>=p.length)return[];const r=[];if(a.forEach((n,C)=>{if(!n||!n.data||!Array.isArray(n.data))return;const _=n.data[t];if(!(_==null||isNaN(_)))try{const u=s.getDatasetMeta(C);if(u&&u.data&&u.data[t]){const v=u.data[t];v&&typeof v.x=="number"&&typeof v.y=="number"&&r.push({datasetIndex:C,value:Number(_),x:v.x,y:v.y})}}catch(u){console.warn(`calculatePointJitter: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ð¸ meta Ð´Ð»Ñ dataset ${C}:`,u)}}),r.length===0)return[];const l=ho(r,o),d=[];l.forEach(n=>{const C=n.points||[];C.length>1?C.forEach((u,v)=>{const b=(v-(C.length-1)/2)*4;d.push({datasetIndex:u.datasetIndex,jitterX:b,value:u.value})}):C.length===1&&d.push({datasetIndex:C[0].datasetIndex,jitterX:0,value:C[0].value})});const i=new Set(d.map(n=>n.datasetIndex));return r.forEach(n=>{i.has(n.datasetIndex)||d.push({datasetIndex:n.datasetIndex,jitterX:0,value:n.value})}),d}const ko=.5,ut=6,bo=2;function wo(s){return typeof s!="number"||s<2?ut:ut+(s-1)*bo}function Co(s,t){if(!s||!s.ctx){console.warn("drawEnlargedPoint: chart Ð¸Ð»Ð¸ ctx Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½");return}if(!t||typeof t.x!="number"||typeof t.y!="number"){console.warn("drawEnlargedPoint: Ð½ÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ñ‹Ðµ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹ overlap",t);return}const o=t.count;if(typeof o!="number"||o<2)return;const a=s.ctx,{x:p,y:r,points:l}=t,d=wo(o);if(a.canvas){a.save();try{a.beginPath(),a.arc(p,r,d,0,2*Math.PI);let n="rgba(128, 128, 128, 0.3)";if(l&&l.length>0&&s.data&&s.data.datasets){const C=l[0].datasetIndex,_=s.data.datasets[C];if(_&&_.pointBackgroundColor){const u=Array.isArray(_.pointBackgroundColor)?_.pointBackgroundColor[t.position]||_.pointBackgroundColor[0]:_.pointBackgroundColor;if(u)if(u.startsWith("#")){const v=parseInt(u.slice(1,3),16),b=parseInt(u.slice(3,5),16),N=parseInt(u.slice(5,7),16);n=`rgba(${v}, ${b}, ${N}, 0.4)`}else u.startsWith("rgba")?n=u.replace(/rgba?\(([^)]+)\)/,(v,b)=>{const N=b.split(",").map(S=>S.trim());return`rgba(${N[0]}, ${N[1]}, ${N[2]}, 0.4)`}):n=u+"66"}}a.fillStyle=n,a.fill(),a.strokeStyle=n.replace("0.4","0.6").replace("66","99"),a.lineWidth=1,a.stroke()}catch(n){console.warn("drawEnlargedPoint: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐµ ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð½Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸:",n)}finally{a.restore()}}}const Do={id:"overlappingPointsPlugin",afterDatasetsDraw:s=>{if(!(!s||!s.config||s.config.type!=="line")&&s.ctx)try{const t=vo(s,ko);if(!Array.isArray(t)||t.length===0)return;t.filter(a=>!(!a||typeof a!="object"||typeof a.count!="number"||a.count<2||typeof a.x!="number"||typeof a.y!="number"||!isFinite(a.x)||!isFinite(a.y))).forEach(a=>{try{Co(s,a)}catch(p){console.warn(`overlappingPointsPlugin: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐµ ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð½Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð´Ð»Ñ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ ${a.position}:`,p)}})}catch(t){console.warn("overlappingPointsPlugin: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð² afterDatasetsDraw:",t)}}},_o=.5,Eo={id:"pointJitterPlugin",beforeDatasetsDraw:s=>{if(!(!s||!s.config||s.config.type!=="line")){s._jitterData||(s._jitterData={});try{const t=s.data?.datasets,o=s.data?.labels||[];if(!t||!Array.isArray(t)||t.length===0||!Array.isArray(o)||o.length===0)return;s._jitterData={},o.forEach((a,p)=>{const r=yo(s,p,_o);r&&r.length>0&&r.forEach(l=>{const d=`${l.datasetIndex}_${p}`;s._jitterData[d]=l.jitterX})})}catch(t){console.warn("pointJitterPlugin: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð² beforeDatasetsDraw:",t)}}},afterDatasetsDraw:s=>{if(!(!s||!s.config||s.config.type!=="line")&&s.ctx&&!(!s._jitterData||Object.keys(s._jitterData).length===0))try{const t=s.ctx,o=s.data?.datasets;if(!o||!Array.isArray(o)||o.length===0)return;o.forEach((a,p)=>{const r=s.getDatasetMeta(p);!r||r.hidden||!a.data||!Array.isArray(a.data)||a.data.forEach((l,d)=>{const i=r.data[d];if(!i||typeof i.x!="number"||typeof i.y!="number"||l==null||isNaN(l))return;const n=`${p}_${d}`,C=s._jitterData[n];if(!(C===void 0||C===0)){t.save();try{const _=a.pointStyle||"circle",u=(a.pointRadius||7)+1,v=Array.isArray(a.pointBackgroundColor)?a.pointBackgroundColor[d]||a.pointBackgroundColor[0]:a.pointBackgroundColor,b=Array.isArray(a.pointBorderColor)?a.pointBorderColor[d]||a.pointBorderColor[0]:a.pointBorderColor,N=a.pointBorderWidth||1,S=i.x+C,D=i.y;switch(t.fillStyle=v||"#007bff",t.strokeStyle=b||"#ffffff",t.lineWidth=N,t.beginPath(),_){case"circle":t.arc(S,D,u,0,2*Math.PI);break;case"triangle":t.moveTo(S,D-u),t.lineTo(S-u,D+u),t.lineTo(S+u,D+u),t.closePath();break;case"rect":case"rectRounded":const L=u*1.4;t.rect(S-L/2,D-L/2,L,L);break;case"rectRot":const U=u*1.4;t.moveTo(S,D-U/2),t.lineTo(S+U/2,D),t.lineTo(S,D+U/2),t.lineTo(S-U/2,D),t.closePath();break;case"star":const V=u;for(let T=0;T<5;T++){const O=T*4*Math.PI/5-Math.PI/2,R=S+V*Math.cos(O),G=D+V*Math.sin(O);T===0?t.moveTo(R,G):t.lineTo(R,G)}t.closePath();break;case"cross":const P=u;t.moveTo(S-P,D-P),t.lineTo(S+P,D+P),t.moveTo(S+P,D-P),t.lineTo(S-P,D+P);break;case"crossRot":const $=u;t.moveTo(S-$,D),t.lineTo(S+$,D),t.moveTo(S,D-$),t.lineTo(S,D+$);break;default:t.arc(S,D,u,0,2*Math.PI)}_!=="cross"&&_!=="crossRot"&&t.fill(),t.stroke(),i._originalX||(i._originalX=i.x,i._originalY=i.y),i._jitterX=C,i._jitteredX=S,i._jitteredY=D}catch(_){console.warn(`pointJitterPlugin: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐµ Ñ‚Ð¾Ñ‡ÐºÐ¸ ${p}_${d}:`,_)}finally{t.restore()}}})})}catch(t){console.warn("pointJitterPlugin: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð² afterDatasetsDraw:",t)}},afterDraw:s=>{s._jitterData}},So={id:"pointLabelsPlugin",afterDatasetsDraw:s=>{if(!(!s||!s.config||s.config.type!=="line")&&s.ctx)try{const t=s.ctx,o=s.data?.datasets;if(!o||!Array.isArray(o)||o.length===0)return;o.forEach((a,p)=>{const r=s.getDatasetMeta(p);if(!r||r.hidden||!a.data||!Array.isArray(a.data))return;const l=Array.isArray(a.pointBackgroundColor)?a.pointBackgroundColor[0]||"#6b7280":a.pointBackgroundColor||"#6b7280";a.data.forEach((d,i)=>{const n=r.data[i];if(!n||typeof n.x!="number"||typeof n.y!="number"||d==null||isNaN(d))return;const C=n._jitteredX!==void 0?n._jitteredX:n.x,_=n._jitteredY!==void 0?n._jitteredY:n.y,u=C+8,v=_-5,b=String(Math.round(d));t.save();try{t.font="11px Arial, sans-serif",t.textAlign="left",t.textBaseline="middle";const S=t.measureText(b).width,D=11,L=3,U=u-L,V=v-D/2-L,P=S+L*2,$=D+L*2;t.fillStyle="rgba(255, 255, 255, 0.95)",t.fillRect(U,V,P,$),t.strokeStyle="rgba(0, 0, 0, 0.1)",t.lineWidth=1,t.strokeRect(U,V,P,$),t.fillStyle=l,t.font="11px Arial, sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillText(b,u,v)}catch(N){console.warn(`pointLabelsPlugin: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐµ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸ Ð´Ð»Ñ Ñ‚Ð¾Ñ‡ÐºÐ¸ ${p}_${i}:`,N)}finally{t.restore()}})})}catch(t){console.warn("pointLabelsPlugin: Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð² afterDatasetsDraw:",t)}}},To={class:"graph-state-chart"},$o={class:"chart-header"},Mo={class:"chart-type-selector"},No=["onClick","title"],xo={class:"chart-type-icon"},Ao={class:"chart-type-label"},Io={key:0,class:"comparison-type-selector"},Fo={class:"radio-group"},Lo={key:0},Po={key:1},Bo={key:2,class:"graph-legend"},Ho={key:4,class:"error-container"},Oo={class:"error-message"},Ro={class:"chart-wrapper"},Wo={class:"chart-canvas-container"},Uo={key:0,class:"bar-chart-stage-labels"},jo={key:6,class:"no-data"},zo={__name:"GraphStateChart",props:{period:{type:Object,default:null},showCurrentState:{type:Boolean,default:!0}},emits:["data-loaded","error"],setup(s,{emit:t}){const o=(k,f)=>typeof window>"u"?f:getComputedStyle(document.documentElement).getPropertyValue(k).trim()||f,a=s,p=t,r=A(!1),l=A(null),d=A(null),i=A({weekStart:null,weekEnd:null,current:null}),n=A(null),C=A("weekStartToWeekEnd"),_=[{value:"line",label:"Ð›Ð¸Ð½ÐµÐ¹Ð½Ñ‹Ð¹",icon:"ðŸ“ˆ"},{value:"bar",label:"Ð¡Ñ‚Ð¾Ð»Ð±Ñ‡Ð°Ñ‚Ñ‹Ð¹",icon:"ðŸ“Š"},{value:"doughnut",label:"ÐšÑ€ÑƒÐ³Ð¾Ð²Ð°Ñ",icon:"ðŸ©"}],u=A("line"),v=A(!1),b=A(""),N=A(""),S=A(0),D=A([]),L=A(null),U=A(null),V=A(null),P=A(null),$=A([]),T=te(()=>{switch(u.value){case"line":return nt;case"bar":return Lt;case"doughnut":return Ft;default:return nt}}),O={formed:o("--b24-primary","#007bff"),review:o("--b24-warning","#ffc107"),execution:o("--b24-success","#28a745")},R=[{id:"formed",name:"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ",color:O.formed},{id:"review",name:"Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—",color:O.review},{id:"execution",name:"Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ",color:O.execution}],G=te(()=>R.reduce((k,f)=>(k[f.id]=f.name,k),{})),J=["circle","triangle","rect","rectRot","star","cross","crossRot"],Z=A({formed:!0,review:!0,execution:!0}),ee=Xe(),pe={id:"employeeLabelsPlugin",afterDatasetsDraw:k=>{if(k.config.type==="bar")try{const f=k.ctx;if(!k.data||!k.data.datasets)return;const E=k.data.datasets,x=k.scales.y;E.forEach((H,h)=>{const I=k.getDatasetMeta(h);if(!I||I.hidden)return;const j=H.label||"";if(!j||j.includes("Ð”Ñ€ÑƒÐ³Ð¸Ðµ"))return;const K=j.trim().split(/\s+/);let q="";if(K.length===1)q=K[0];else{const X=K[0],ne=K.slice(1).join(" ");q=`${X}
${ne}`}const ie=q.split(`
`);H.data.forEach((X,ne)=>{if(X===0||!X)return;const ce=I.data[ne];if(!ce||typeof ce.x!="number"||typeof ce.y!="number")return;const le=ce.x,Ne=ce.y+ce.height+25;f.save(),f.font="bold 9px Arial, sans-serif",f.fillStyle="#6b7280",f.textAlign="center",f.textBaseline="top",f.translate(le,Ne),f.rotate(-12*Math.PI/180),ie.forEach((kt,bt)=>{const at=kt.trim();at&&f.fillText(at,0,bt*11)}),f.restore()})})}catch(f){console.error("Error in employeeLabelsPlugin:",f)}}},Ue={id:"doughnutCenterTextPlugin",afterDraw:k=>{if(k.config.type!=="doughnut")return;const{ctx:f,chartArea:E,width:x,height:H}=k;if(!k.data||!k.data.datasets||k.data.datasets.length===0)return;const I=k.data.datasets[0].meta?.totals?.overall??null;if(I===null||typeof I>"u")return;const j=["Ð’ÑÐµÐ³Ð¾ Ð² ÑÐµÐºÑ‚Ð¾Ñ€Ðµ 1Ð¡","Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð² Ñ€Ð°Ð±Ð¾Ñ‚Ðµ:",`${I}`];f.save(),f.font='600 16px "Roboto", sans-serif',f.fillStyle=o("--b24-text-primary","#1f2937"),f.textAlign="center",f.textBaseline="middle";const K=(E.left+E.right)/2,q=(E.top+E.bottom)/2,ie=18,X=ie*j.length,ne=q-X/2+4;j.forEach((ce,le)=>{le===j.length-1&&`${ce}`.length>4?f.font='700 18px "Roboto", sans-serif':f.font='600 16px "Roboto", sans-serif',f.fillText(ce,K,ne+le*ie)}),f.restore()}};ke.register(pe),ke.register(Ue);function Ie(){const k=new Map;[i.value.weekStart,i.value.weekEnd,i.value.current].forEach(f=>{!f||!f.statistics||!f.statistics.employees||f.statistics.employees.forEach(E=>{k.has(E.id)||k.set(E.id,{id:E.id,name:E.name})})}),$.value=Array.from(k.values()).sort((f,E)=>f.name.localeCompare(E.name))}function fe(k,f="background"){return{increase:{background:o("--b24-success","#28a745"),border:o("--b24-success-hover","#218838"),point:o("--b24-success","#28a745")},decrease:{background:o("--b24-danger","#dc3545"),border:o("--b24-danger-hover","#c82333"),point:o("--b24-danger","#dc3545")},stable:{background:o("--b24-text-muted","#9ca3af"),border:o("--b24-text-secondary","#6b7280"),point:o("--b24-text-muted","#9ca3af")}}[k]?.[f]||o("--b24-text-secondary","#6c757d")}function Ce(){if(!(!i.value.weekStart||!i.value.weekEnd))try{const k=Ze.compareTwoSnapshots(i.value.weekStart,i.value.weekEnd,{includeTickets:!1,includeEmployees:!0});let f=null,E=null;i.value.current&&(f=Ze.compareTwoSnapshots(i.value.weekEnd,i.value.current,{includeTickets:!1,includeEmployees:!0}),E=Ze.compareTwoSnapshots(i.value.weekStart,i.value.current,{includeTickets:!1,includeEmployees:!0})),n.value={weekStartToWeekEnd:k,weekEndToCurrent:f,weekStartToCurrent:E}}catch(k){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ¾Ð²:",k),ee.warning("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ÑÐ»ÐµÐ¿ÐºÐ¾Ð²: "+k.message)}}function Fe(k){return k?k.replace(/\s*\(\d+\)\s*$/,"").trim():""}function De(k){const f=Fe(k);return{"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ":"formed","Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—":"review",Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ:"execution"}[f]||"formed"}function Le(k){return De(k)}function Pe(k){return k===0?"weekStart":k===1?"weekEnd":k===2?"current":"weekEnd"}function $e(k,f,E,x,H=null,h=null,I=null,j=null){console.log("[GraphStateChart] openEmployeeDetailsModal called:",{stageName:k,stageId:f,totalCount:E,employeesCount:x?.length||0,hasSnapshot:!!h,snapshotTicketIds:h?.ticketIds?.length||0}),b.value=k,N.value=f||"",S.value=E,D.value=x||[],L.value=H&&H.count>0?H:null,U.value=h,V.value=I,P.value=j,v.value=!0,console.log("[GraphStateChart] Modal state set:",{modalStageId:N.value,hasCurrentSnapshot:!!U.value})}async function W(k,f,E){console.log("[GraphStateChart] openEmployeeDetailsModalForLine:",{stageId:k,timePoint:f,hasMeta:!!E});const x=R.find(h=>h.id===k);if(!x){console.warn("[GraphStateChart] Stage not found:",k);return}const H={graphType:"line",stageId:k,stageName:x.name,timePoint:f,snapshots:i.value,meta:{line:E||null,doughnut:d.value?.datasets?.[0]?.meta||null},stageColorMap:O,stageNameMap:G.value};try{const h=await yt({stageId:k,graphType:"line",timePoint:f,snapshots:i.value,meta:{line:E||null,doughnut:d.value?.datasets?.[0]?.meta||null},stageColorMap:O,stageNameMap:G.value,maxVisible:10});console.log("[GraphStateChart] Opening modal with level1:",{stageName:h.stageName,stageId:k,totalCount:h.totalCount,employeesCount:h.employees?.length||0,hasSnapshot:!!h.snapshot}),$e(h.stageName,k,h.totalCount,h.employees,h.others,h.snapshot,null,H)}catch(h){console.error("[GraphStateChart] Failed to open modal for line point:",h),ee.error("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð¿Ð°Ð¿ Ð´Ð»Ñ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°")}}function z(k,f){if(!f||!f.employees||f.employees.length===0){ee.warning("ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ñ… Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ ÑÑ‚Ð°Ð¿Ð°");return}const E=i.value.current||i.value.weekEnd||i.value.weekStart,x={graphType:"doughnut",stageId:k,stageName:f.stageName,snapshots:i.value,meta:{doughnut:d.value?.datasets?.[0]?.meta||null},stageColorMap:O,stageNameMap:G.value};$e(f.stageName,k,f.totalCount,f.employees,f.others,E,null,x)}function me(){v.value=!1,b.value="",N.value="",S.value=0,D.value=[],L.value=null,U.value=null,V.value=null}async function Be(k,f,E){if(u.value!=="line"||f.length===0)return;const x=f[0],H=x.datasetIndex,h=x.index,I=E.data.datasets[H];if(!I)return;const j=Le(I.label),K=Pe(h);await W(j,K,I.meta||null)}function ge(k,f,E){if(u.value!=="doughnut"||f.length===0)return;const H=f[0].index,h=E.data,I=h.labels[H],j=Le(I),q=h.datasets[0]?.meta?.employees?.[j];if(!q){console.warn("Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ñ… Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ Ð´Ð»Ñ ÑÑ‚Ð°Ð¿Ð°:",j);return}z(j,q)}function He(k){const f=R[k];if(!f)return 0;const E=i.value.current||i.value.weekEnd||i.value.weekStart;return!E||!E.statistics||!E.statistics.stages?0:E.statistics.stages[f.id]?.count||0}function g(k){const f=R.find(H=>H.id===k);if(!f)return"";const E=i.value.current||i.value.weekEnd||i.value.weekStart;if(!E||!E.statistics||!E.statistics.stages)return f.name;const x=E.statistics.stages[k]?.count||0;return`${f.name} (${x})`}const m=te(()=>{if(!d.value)return null;if(u.value==="doughnut"||u.value==="bar")return d.value;const k=d.value.datasets.filter(f=>{const E=R.find(x=>x.name===f.label);return E?Z.value[E.id]:!0});return{...d.value,datasets:k}});te(()=>u.value!=="bar"||!d.value||!d.value.meta?null:d.value.meta.employeesByStage||null);const c=te(()=>{const k={responsive:!0,maintainAspectRatio:!1,resizeDelay:0,layout:{padding:u.value==="bar"?{bottom:80}:{}},onClick:(f,E,x)=>{u.value==="line"?Be(f,E,x):u.value==="doughnut"&&ge(f,E,x)},onHover:(f,E,x)=>{u.value==="doughnut"&&(f.native.target.style.cursor=E.length>0?"pointer":"default")},plugins:{legend:{display:u.value!=="bar",position:u.value==="doughnut"?"right":"top",labels:{font:{size:u.value==="doughnut"?14:12,weight:u.value==="doughnut"?"600":"500"},boxWidth:u.value==="doughnut"?18:12,boxHeight:u.value==="doughnut"?18:12,padding:u.value==="doughnut"?14:10},onClick:(f,E,x)=>{if(u.value==="bar"){const h=E.datasetIndex;if(h!==void 0){const I=x.chart.getDatasetMeta(h);I.hidden=!I.hidden,x.chart.update()}return}const H=E.datasetIndex;if(H!==void 0){const h=x.chart.getDatasetMeta(H);h.hidden=!h.hidden,x.chart.update()}}},tooltip:{enabled:!0,mode:"index",intersect:!1,callbacks:{title:f=>{if(u.value==="bar"){const E=f[0].dataIndex,x=R[E];return x?x.name:""}return f[0].label||""},label:f=>{const E=f.dataset.label||"",x=f.parsed.y||f.parsed||0,H=f.dataIndex;if(u.value==="bar"){const h=f.dataset,I=f.dataIndex,j=R[I],K=j?j.name:"";return`${h.label}: ${x} Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð½Ð° ÑÑ‚Ð°Ð¿Ðµ "${K}"`}if(u.value==="doughnut"){const h=f.dataset.data.reduce((j,K)=>j+K,0),I=h>0?(x/h*100).toFixed(1):0;return`${E}: ${x} Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² (${I}%)`}else{if(!n.value||H===0)return`${E}: ${x} Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`;let h=null;const I=De(E);if(C.value==="weekStartToWeekEnd"&&H===1?h=n.value.weekStartToWeekEnd?.stages?.[I]:C.value==="weekEndToCurrent"&&H===2&&i.value.current?h=n.value.weekEndToCurrent?.stages?.[I]:C.value==="weekStartToCurrent"&&H===2&&i.value.current&&(h=n.value.weekStartToCurrent?.stages?.[I]),!h)return`${E}: ${x} Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`;const j=h.delta,K=h.deltaPercent,q=h.trend;let ie=`${E}: ${x} Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`;if(j!==0){const X=j>0?"+":"",ne=q==="increase"?"â†‘":q==="decrease"?"â†“":"â†’";ie+=` (${X}${j}, ${X}${K.toFixed(1)}%) ${ne}`}else ie+=" (Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹)";return ie}},afterBody:f=>{if(u.value==="bar"&&f.length>0){const h=f[0];h.dataset;const I=h.parsed.y||0,j=h.dataIndex,K=He(j);return[`${K>0?(I/K*100).toFixed(1):0}% Ð¾Ñ‚ Ð¾Ð±Ñ‰ÐµÐ³Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° ÑÑ‚Ð°Ð¿Ð°`]}if(u.value==="doughnut"&&f.length>0)return["ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼"];if(u.value==="line"){const h=[];if(n.value){const I=f[0].dataIndex;if(I!==0){let j=null;if(De(f[0].dataset.label||""),C.value==="weekStartToWeekEnd"&&I===1?j=n.value.weekStartToWeekEnd:C.value==="weekEndToCurrent"&&I===2?j=n.value.weekEndToCurrent:C.value==="weekStartToCurrent"&&I===2&&(j=n.value.weekStartToCurrent),j&&j.metadata){const K=j.metadata.timeDiff;h.push(`ÐŸÐµÑ€Ð¸Ð¾Ð´: ${K.days} Ð´Ð½. ${K.hours} Ñ‡. ${K.minutes} Ð¼Ð¸Ð½.`)}}}return h.push("ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼"),h}if(!n.value)return[];const E=f[0].dataIndex;if(E===0)return[];let x=null;if(De(f[0].dataset.label||""),C.value==="weekStartToWeekEnd"&&E===1?x=n.value.weekStartToWeekEnd:C.value==="weekEndToCurrent"&&E===2?x=n.value.weekEndToCurrent:C.value==="weekStartToCurrent"&&E===2&&(x=n.value.weekStartToCurrent),!x||!x.metadata)return[];const H=x.metadata.timeDiff;return[`ÐŸÐµÑ€Ð¸Ð¾Ð´: ${H.days} Ð´Ð½. ${H.hours} Ñ‡. ${H.minutes} Ð¼Ð¸Ð½.`]}}},title:{display:!1}}};return u.value==="line"||u.value==="bar"?{...k,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}:u.value==="doughnut"?{...k,cutout:"60%"}:k});function M(k){const f=new Date(k),E=f.getFullYear(),x=String(f.getMonth()+1).padStart(2,"0"),H=String(f.getDate()).padStart(2,"0");return`${E}-${x}-${H}`}function se(k){const{current:f,weekEnd:E}=k,x=f||E;if(!x||!x.statistics||!x.statistics.stages)return null;const H=[],h=[],I=[],j=[],K={},q={};if(R.forEach(X=>{const ne=x.statistics.stages[X.id]?.count||0;if(ne>0){H.push(`${X.name} (${ne})`),h.push(ne),I.push(X.color+"80"),j.push(X.color),q[X.id]=ne;const ce=vs(X.id,x,R);ce&&ce.employees&&(K[X.id]=ce)}}),h.length===0)return null;const ie=h.reduce((X,ne)=>X+ne,0);return{labels:H,datasets:[{label:"Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÑÑ‚Ð°Ð¿Ð°Ð¼",data:h,backgroundColor:I,borderColor:j,borderWidth:2,meta:{employees:K,totals:{overall:ie,stages:q}}}]}}function ye(k){if(u.value==="doughnut")return se(k);if(u.value==="bar"){const I=a.showCurrentState&&k.current?"current":k.weekEnd?"weekEnd":"weekStart";return fs(k,I,R)}const{weekStart:f,weekEnd:E,current:x}=k,H=[],h=[];return R.forEach((I,j)=>{const K=[];if(f&&f.statistics&&f.statistics.stages){const le=f.statistics.stages[I.id];if(H.length===0){const Ne=f.metadata?.createdAt?new Date(f.metadata.createdAt):null;H.push(Ne?M(Ne):"ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸")}K.push(le?.count||0)}else H.length===0&&H.push("ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸"),K.push(0);if(E&&E.statistics&&E.statistics.stages){const le=E.statistics.stages[I.id];if(H.length===1){const Ne=E.metadata?.createdAt?new Date(E.metadata.createdAt):null;H.push(Ne?M(Ne):"ÐšÐ¾Ð½ÐµÑ† Ð½ÐµÐ´ÐµÐ»Ð¸")}K.push(le?.count||0)}else H.length===1&&H.push("ÐšÐ¾Ð½ÐµÑ† Ð½ÐµÐ´ÐµÐ»Ð¸"),K.push(0);if(x&&a.showCurrentState&&x.statistics&&x.statistics.stages){const le=x.statistics.stages[I.id];H.length===2&&H.push("Ð¢ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ"),K.push(le?.count||0)}const q=["stable"];n.value?C.value==="weekStartToWeekEnd"?(q.push(n.value.weekStartToWeekEnd?.stages?.[I.id]?.trend||"stable"),x&&q.push(n.value.weekStartToCurrent?.stages?.[I.id]?.trend||"stable")):C.value==="weekEndToCurrent"&&x?(q.push("stable"),q.push(n.value.weekEndToCurrent?.stages?.[I.id]?.trend||"stable")):C.value==="weekStartToCurrent"&&x?(q.push(n.value.weekStartToWeekEnd?.stages?.[I.id]?.trend||"stable"),q.push(n.value.weekStartToCurrent?.stages?.[I.id]?.trend||"stable")):(q.push("stable"),x&&q.push("stable")):(q.push("stable"),x&&q.push("stable"));let ie,X,ne;n.value&&u.value!=="doughnut"?(ie=q.map(le=>fe(le,"background")+"40"),X=q.map(le=>fe(le,"border")),ne=q.map(le=>fe(le,"point"))):(ie=I.color+"40",X=I.color,ne=I.color);let ce=null;u.value==="line"&&(ce={employees:gs(I.id,k)}),h.push({label:I.name,data:K,backgroundColor:(Array.isArray(ie),ie),borderColor:(Array.isArray(X),X),borderWidth:2,...u.value==="line"&&{pointStyle:J[j%J.length]},pointBackgroundColor:(Array.isArray(ne),ne),pointBorderColor:(Array.isArray(X),X),pointRadius:7,pointHoverRadius:10,fill:u.value!=="line",tension:u.value==="line"?.4:0,meta:ce})}),H.length===0&&(H.push("ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸","ÐšÐ¾Ð½ÐµÑ† Ð½ÐµÐ´ÐµÐ»Ð¸"),a.showCurrentState&&H.push("Ð¢ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ")),{labels:H,datasets:h}}const de=async()=>{r.value=!0,l.value=null;try{const k=a.period?.endDate?new Date(a.period.endDate):new Date,f=a.period?.startDate?new Date(a.period.startDate):xe.getWeekStartDate(k),E=a.period?.endDate?new Date(a.period.endDate):xe.getWeekEndDate(k),x=xe.formatDate(f),H=xe.formatDate(E),[h,I]=await Promise.all([xe.getSnapshot(x,"week_start"),xe.getSnapshot(H,"week_end")]);let j=null;a.showCurrentState&&(j=await mt.getSectorDataForSnapshot({useCache:!1,normalize:!0})),i.value={weekStart:h,weekEnd:I,current:j},Ie(),Ce(),B(),p("data-loaded",{weekStart:h,weekEnd:I,current:j})}catch(k){console.error("Error loading chart data:",k),l.value=k.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°",ee.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°: "+l.value),p("error",l.value)}finally{r.value=!1}};Te(()=>{ke.register(Do),ke.register(Eo),ke.register(So),de()});function Me(k){Z.value=k}const B=()=>{const k=ye({weekStart:i.value.weekStart,weekEnd:i.value.weekEnd,current:i.value.current});if(!d.value||!d.value.labels||d.value.labels.length!==k?.labels?.length)d.value=k;else if(k){const f=JSON.stringify(d.value),E=JSON.stringify(k);f!==E&&(d.value=k)}};return Ae(()=>[a.period,a.showCurrentState],()=>{de()},{deep:!0}),Ae(u,()=>{(i.value.weekStart||i.value.weekEnd||i.value.current)&&B()}),Ae(C,()=>{(i.value.weekStart||i.value.weekEnd||i.value.current)&&B()}),(k,f)=>(y(),w("div",To,[e("div",$o,[f[3]||(f[3]=e("h3",{class:"chart-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),e("div",Mo,[(y(),w(oe,null,ue(_,E=>e("button",{key:E.value,onClick:x=>u.value=E.value,class:Q(["chart-type-btn",{active:u.value===E.value}]),title:E.label},[e("span",xo,F(E.icon),1),e("span",Ao,F(E.label),1)],10,No)),64))])]),!r.value&&!l.value&&n.value&&u.value!=="doughnut"?(y(),w("div",Io,[f[7]||(f[7]=e("h4",{class:"comparison-title"},"Ð¢Ð¸Ð¿ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ:",-1)),e("div",Fo,[e("label",null,[Ke(e("input",{type:"radio","onUpdate:modelValue":f[0]||(f[0]=E=>C.value=E),value:"weekStartToWeekEnd",onChange:B},null,544),[[Je,C.value]]),f[4]||(f[4]=e("span",null,"ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸ â†’ ÐšÐ¾Ð½ÐµÑ† Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),i.value.current?(y(),w("label",Lo,[Ke(e("input",{type:"radio","onUpdate:modelValue":f[1]||(f[1]=E=>C.value=E),value:"weekEndToCurrent",onChange:B},null,544),[[Je,C.value]]),f[5]||(f[5]=e("span",null,"ÐšÐ¾Ð½ÐµÑ† Ð½ÐµÐ´ÐµÐ»Ð¸ â†’ Ð¢ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ",-1))])):Y("",!0),i.value.current?(y(),w("label",Po,[Ke(e("input",{type:"radio","onUpdate:modelValue":f[2]||(f[2]=E=>C.value=E),value:"weekStartToCurrent",onChange:B},null,544),[[Je,C.value]]),f[6]||(f[6]=e("span",null,"ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸ â†’ Ð¢ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ",-1))])):Y("",!0)])])):Y("",!0),!r.value&&!l.value&&d.value?(y(),Se(ds,{key:1,stages:R,selected:Z.value,"onUpdate:selected":Me,onChange:B},null,8,["selected"])):Y("",!0),!r.value&&!l.value&&n.value&&u.value!=="doughnut"?(y(),w("div",Bo,[...f[8]||(f[8]=[At('<h4 class="legend-title" data-v-cbba196a>Ð›ÐµÐ³ÐµÐ½Ð´Ð°:</h4><div class="legend-items" data-v-cbba196a><div class="legend-item" data-v-cbba196a><span class="legend-color legend-increase" data-v-cbba196a></span><span data-v-cbba196a>Ð—ÐµÐ»Ñ‘Ð½Ñ‹Ð¹ â€” Ñ€Ð¾ÑÑ‚ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²</span></div><div class="legend-item" data-v-cbba196a><span class="legend-color legend-decrease" data-v-cbba196a></span><span data-v-cbba196a>ÐšÑ€Ð°ÑÐ½Ñ‹Ð¹ â€” ÑÐ½Ð¸Ð¶ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²</span></div><div class="legend-item" data-v-cbba196a><span class="legend-color legend-stable" data-v-cbba196a></span><span data-v-cbba196a>Ð¡ÐµÑ€Ñ‹Ð¹ â€” Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹</span></div></div>',2)])])):Y("",!0),r.value?(y(),Se(ft,{key:3,message:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°..."})):l.value?(y(),w("div",Ho,[e("p",Oo,"âŒ "+F(l.value),1),e("button",{onClick:de,class:"btn-retry"},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ")])):m.value?(y(),w("div",{key:5,class:Q(["chart-container",`chart-type-${u.value}`])},[e("div",Ro,[e("div",Wo,[(y(),Se(It(T.value),{data:m.value,options:c.value},null,8,["data","options"]))]),u.value==="bar"?(y(),w("div",Uo,[(y(),w(oe,null,ue(R,E=>e("div",{key:E.id,class:"stage-label-item"},F(g(E.id)),1)),64))])):Y("",!0)])],2)):(y(),w("div",jo,[...f[9]||(f[9]=[e("p",null,"ðŸ“Š ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ",-1),e("p",{class:"no-data-hint"},"Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÑÐ»ÐµÐ¿ÐºÐ¸ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°",-1)])])),re(mo,{"is-visible":v.value,"stage-name":b.value,"stage-id":N.value,"total-count":S.value,employees:D.value,others:L.value,snapshot:U.value,"ticket-details":V.value,"stage-switch-context":P.value,onClose:me},null,8,["is-visible","stage-name","stage-id","total-count","employees","others","snapshot","ticket-details","stage-switch-context"])]))}},Yo=we(zo,[["__scopeId","data-v-cbba196a"]]),Ko={key:0,class:"create-snapshot-button-container"},Vo=["disabled"],Go={class:"modal-content"},qo={class:"modal-header"},Xo=["disabled"],Jo={class:"modal-body"},Zo={key:0,class:"progress-container"},Qo={class:"progress-bar-wrapper"},el={class:"progress-text"},tl={class:"progress-percent"},al={class:"progress-description"},sl={key:1},nl={class:"modal-footer"},ol=["disabled"],ll=["disabled"],rl={key:0},il={key:0},cl={key:1},ul={key:2},dl={key:1},pl={__name:"CreateSnapshotButton",props:{user:{type:Object,default:null}},emits:["snapshot-created"],setup(s,{emit:t}){const o=s,a=t,p=A(o.user),r=A(!1),l=A(!1),d=A(0),i=A("idle"),n=A(""),C=Xe(),_=te(()=>p.value?zt(p.value):!1);Te(async()=>{if(!o.user)try{const S=await gt.checkAccess();S.allowed&&(p.value=S.user)}catch(S){console.error("Error loading user:",S)}});const u=()=>{if(!_.value){C.warning("Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñ‹ Ð¼Ð¾Ð³ÑƒÑ‚ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿ÐºÐ¸");return}r.value=!0},v=()=>{l.value||(r.value=!1,i.value="idle",d.value=0,n.value="")},b=async()=>{if(!l.value){if(!_.value){C.warning("Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñ‹ Ð¼Ð¾Ð³ÑƒÑ‚ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿ÐºÐ¸");return}l.value=!0,i.value="loading_data",d.value=0,n.value="Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…...";try{n.value="Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐµÐºÑ‚Ð¾Ñ€Ð° Ð¸Ð· Bitrix24...";const S=await mt.getSectorDataForSnapshot({useCache:!0,normalize:!0,onProgress:U=>{const V=Math.min(80,(U.progress||0)*.8);d.value=V,i.value="loading_data",n.value=U.description||U.details?.description||"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐµÐºÑ‚Ð¾Ñ€Ð°..."}});i.value="creating_snapshot",d.value=85,n.value="Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐ»ÐµÐ¿ÐºÐ°...";const D=p.value;if(!D)throw new Error("ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½");const L=await xe.createSnapshot(S,"manual",{createdBy:{id:D.ID,name:`${D.NAME||""} ${D.LAST_NAME||""}`.trim()||D.EMAIL||`User ${D.ID}`},sectorId:"1C"});i.value="success",d.value=100,n.value="Ð¡Ð»ÐµÐ¿Ð¾Ðº ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½!",C.success("Ð¡Ð»ÐµÐ¿Ð¾Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½"),a("snapshot-created",L),setTimeout(()=>{v()},1500)}catch(S){i.value="error",d.value=0,n.value="ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°",console.error("Error creating snapshot:",S);let D="ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°";S.message&&(S.message.includes("Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…")||S.message.includes("sector data")?D="ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐµÐºÑ‚Ð¾Ñ€Ð°. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Bitrix24.":S.message.includes("ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ°")||S.message.includes("snapshot")?D="ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿Ð¾Ðº. ÐžÐ±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ð² Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ.":S.message.includes("Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†")||S.message.includes("validation")?D="ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐµÐºÑ‚Ð¾Ñ€Ð°.":D=S.message),C.error(D)}finally{l.value=!1}}},N=S=>{S.key==="Escape"&&r.value&&!l.value&&v()};return Te(()=>{window.addEventListener("keydown",N)}),ze(()=>{window.removeEventListener("keydown",N)}),(S,D)=>_.value?(y(),w("div",Ko,[e("button",{class:"create-snapshot-btn",onClick:u,disabled:l.value,title:"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿Ð¾Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð°"},[...D[1]||(D[1]=[e("span",{class:"btn-icon"},"ðŸ“¸",-1),e("span",{class:"btn-text"},"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿Ð¾Ðº",-1)])],8,Vo),(y(),Se(dt,{to:"body"},[re(Re,{name:"modal"},{default:be(()=>[r.value?(y(),w("div",{key:0,class:"modal-overlay",onClick:D[0]||(D[0]=ae(L=>!l.value&&v(),["self"]))},[e("div",Go,[e("div",qo,[D[2]||(D[2]=e("h3",{class:"modal-title"},"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ¿Ð¾Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð°",-1)),e("button",{class:"modal-close",onClick:v,disabled:l.value,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ",8,Xo)]),e("div",Jo,[i.value!=="idle"?(y(),w("div",Zo,[e("div",Qo,[e("div",{class:"progress-bar",style:he({width:`${d.value}%`})},null,4)]),e("div",el,[e("span",tl,F(Math.round(d.value))+"%",1),e("span",al,F(n.value),1)])])):(y(),w("div",sl,[...D[3]||(D[3]=[e("p",{class:"modal-description"},' Ð‘ÑƒÐ´ÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð½ ÑÐ»ÐµÐ¿Ð¾Ðº Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡. Ð¡Ð»ÐµÐ¿Ð¾Ðº Ð±ÑƒÐ´ÐµÑ‚ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½ Ñ Ñ‚Ð¸Ð¿Ð¾Ð¼ "manual" (Ñ€ÑƒÑ‡Ð½Ð¾Ð¹). ',-1),e("p",{class:"modal-warning"}," âš ï¸ ÐŸÑ€Ð¾Ñ†ÐµÑÑ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ»ÐµÐ¿ÐºÐ° Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚ÑŒ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ. ",-1)])]))]),e("div",nl,[e("button",{class:"btn btn-secondary",onClick:v,disabled:l.value}," ÐžÑ‚Ð¼ÐµÐ½Ð° ",8,ol),e("button",{class:"btn btn-primary",onClick:b,disabled:l.value},[l.value?(y(),w("span",rl,[i.value==="loading_data"?(y(),w("span",il,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…...")):i.value==="creating_snapshot"?(y(),w("span",cl,"Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ...")):(y(),w("span",ul,"ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°..."))])):(y(),w("span",dl,"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ"))],8,ll)])])])):Y("",!0)]),_:1})]))])):Y("",!0)}},ml=we(pl,[["__scopeId","data-v-09bccee2"]]),gl={class:"graph-state-dashboard"},fl={key:1,class:"error-message-container"},vl={class:"error-message"},hl={class:"error-text"},yl={key:0,class:"error-details"},kl={class:"dashboard-header"},bl={class:"header-content"},wl={class:"breadcrumbs-row"},Cl=["aria-disabled","data-fallback","disabled"],Dl={class:"breadcrumbs","aria-label":"ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ"},_l={class:"header-actions"},El=["disabled"],Sl={key:0},Tl={key:1},$l={key:3,class:"dashboard-content"},Ml={class:"chart-container"},Nl="ÐÐ°Ð·Ð°Ð´",xl={__name:"GraphStateDashboard",setup(s){const t=(W,z)=>typeof window>"u"?z:getComputedStyle(document.documentElement).getPropertyValue(W).trim()||z,o=Xe(),a=Pt(),p={name:"dashboard-sector-1c"},{filters:r,selectedPeriod:l,hasActiveFilters:d,applyFilters:i,resetFilters:n,loadFiltersFromLocalStorage:C}=Ht(),_=A(null),u=A(!0),v=A(!1),b=A("Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…..."),N=A(null),S=A(!1),D=A(!1),L=A(typeof window<"u"?window.innerWidth:1024),U=A(null),V=A(!1),P=te(()=>L.value<768);te(()=>L.value>=768&&L.value<1024),te(()=>L.value>=1024);const $=te(()=>typeof window>"u"?!1:window.history.length>1);te(()=>{const W=new Date;return W.setFullYear(W.getFullYear()-1),W.toISOString().split("T")[0]}),te(()=>new Date().toISOString().split("T")[0]);function T(W){r.value.stages=W}function O(W){r.value.employees=W}function R(W){r.value.dateRange=W}function G(W){r.value.customDateRange=W}function J(){i()}function Z(){n(),U.value=null,J(),o.info("Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ ÑÐ±Ñ€Ð¾ÑˆÐµÐ½Ñ‹")}function ee(W){o.success("Ð¡Ð»ÐµÐ¿Ð¾Ðº ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½")}function pe(W){v.value=!1,b.value="",console.log("Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹:",W)}function Ue(W){v.value=!1,Ie({message:W||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°",details:null,type:"error"})}function Ie(W){N.value={message:W.message||"ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ°",details:W.details||null,type:W.type||"error",timestamp:new Date},console.error("Dashboard error:",N.value),o.error(N.value.message)}function fe(){N.value=null}function Ce(){N.value=null,v.value=!0,b.value="ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…..."}async function Fe(){if(typeof window>"u"||!window.jsPDF||!window.html2canvas){o.warning("Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð² PDF Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½. ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ¸ jspdf Ð¸ html2canvas."),console.warn("Ð”Ð»Ñ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð° Ð² PDF ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ: npm install jspdf html2canvas");return}S.value=!0;try{const W=document.querySelector(".chart-container");if(!W)throw new Error("Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½");const z=window.html2canvas,me=await z(W,{scale:2,useCORS:!0,logging:!1,backgroundColor:t("--b24-bg-white","#ffffff")}),Be=window.jsPDF,ge=new Be("landscape","mm","a4"),He=297,g=me.height*He/me.width;ge.setFontSize(18),ge.text("Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",148.5,15,{align:"center"});const m=new Date().toLocaleDateString("ru-RU");ge.setFontSize(10);const c=l.value.startDate&&l.value.endDate?`ÐŸÐµÑ€Ð¸Ð¾Ð´: ${l.value.startDate} - ${l.value.endDate}`:"ÐŸÐµÑ€Ð¸Ð¾Ð´: Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½";ge.text(c,148.5,25,{align:"center"}),ge.text(`Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð¾Ñ‚ ${m}`,148.5,30,{align:"center"}),ge.addImage(me.toDataURL("image/png"),"PNG",10,35,He-20,g-20),ge.setProperties({title:"Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",subject:`Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð¾Ñ‚ ${m}`,author:"Bitrix24 Dashboard"});const M=`graph-state-${m.replace(/\//g,"-")}.pdf`;ge.save(M),o.success("Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð² PDF")}catch(W){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð° Ð² PDF:",W),Ie({message:"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð° Ð² PDF: "+(W.message||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°"),details:W.stack,type:"error"})}finally{S.value=!1}}function De(W){if(W?.preventDefault?.(),!V.value){V.value=!0;try{if($.value){a.back();return}console.warn("GraphStateDashboard: fallback navigation to dashboard-sector-1c"),a.push(p)}finally{V.value=!1}}}function Le(){a.push("/")}function Pe(){typeof window<"u"&&(L.value=window.innerWidth)}async function $e(){try{const W=await gt.checkAccess();W.allowed&&(_.value=W.user)}catch(W){console.error("Error loading user:",W)}}return Te(()=>{C(),$e(),typeof window<"u"&&(L.value=window.innerWidth,window.addEventListener("resize",Pe))}),ze(()=>{typeof window<"u"&&window.removeEventListener("resize",Pe)}),(W,z)=>{const me=Bt("router-link");return y(),w("div",gl,[v.value?(y(),Se(ft,{key:0,message:b.value},null,8,["message"])):Y("",!0),N.value?(y(),w("div",fl,[e("div",vl,[e("div",{class:"error-header"},[z[1]||(z[1]=e("span",{class:"error-icon"},"âŒ",-1)),z[2]||(z[2]=e("h3",null,"ÐžÑˆÐ¸Ð±ÐºÐ°",-1)),e("button",{onClick:fe,class:"error-close","aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"},"âœ•")]),e("p",hl,F(N.value.message),1),N.value.details?(y(),w("div",yl,[e("details",null,[z[3]||(z[3]=e("summary",null,"Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸",-1)),e("pre",null,F(N.value.details),1)])])):Y("",!0),e("div",{class:"error-actions"},[e("button",{onClick:Ce,class:"btn-retry"},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÑƒ")])])])):Y("",!0),e("div",kl,[e("div",bl,[e("div",wl,[e("button",{class:"btn-home-link",type:"button",onClick:Le,title:"ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ","aria-label":"ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"}," Ð“Ð»Ð°Ð²Ð½Ð°Ñ "),z[9]||(z[9]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),e("button",{class:"btn-back-link",type:"button",onClick:De,"aria-label":Nl,"aria-disabled":!$.value,"data-fallback":!$.value,disabled:V.value,title:"ÐÐ°Ð·Ð°Ð´"}," â† ",8,Cl),e("nav",Dl,[re(me,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:be(()=>[...z[4]||(z[4]=[Ee(" Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡ ",-1)])]),_:1}),z[6]||(z[6]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),z[7]||(z[7]=e("span",{class:"breadcrumb-current"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ",-1)),z[8]||(z[8]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),re(me,{to:{name:"dashboard-graph-admission-closure"},class:"breadcrumb-link"},{default:be(()=>[...z[5]||(z[5]=[Ee(" Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ",-1)])]),_:1})])]),z[10]||(z[10]=e("h1",{class:"dashboard-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),z[11]||(z[11]=e("p",{class:"dashboard-subtitle"}," Ð’Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð° Ð²Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ ",-1))]),e("div",_l,[e("button",{onClick:Fe,class:"btn-export-pdf",disabled:S.value||v.value,title:"Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð³Ñ€Ð°Ñ„Ð¸Ðº Ð² PDF"},[S.value?(y(),w("span",Tl,"â³ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚...")):(y(),w("span",Sl,"ðŸ“„ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð² PDF"))],8,El),re(ml,{user:_.value,onSnapshotCreated:ee},null,8,["user"])])]),P.value?(y(),w("button",{key:2,class:"mobile-filters-toggle",onClick:z[0]||(z[0]=Be=>D.value=!D.value)},[z[12]||(z[12]=e("span",null,"Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹",-1)),e("span",{class:Q(["toggle-icon",{open:D.value}])},"â–¼",2)])):Y("",!0),e("div",{class:Q({"mobile-open":D.value&&P.value,"mobile-closed":!D.value&&P.value})},[re(os,{stages:Oe(r).stages,employees:Oe(r).employees,dateRange:Oe(r).dateRange,customDateRange:Oe(r).customDateRange,hasActiveFilters:Oe(d),"onUpdate:stages":T,"onUpdate:employees":O,"onUpdate:dateRange":R,"onUpdate:customDateRange":G,onReset:Z,onApply:J},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])],2),!v.value&&!N.value?(y(),w("div",$l,[e("div",Ml,[re(Yo,{period:Oe(l),"show-current-state":u.value,onDataLoaded:pe,onError:Ue},null,8,["period","show-current-state"])])])):Y("",!0)])}}},Al=we(xl,[["__scopeId","data-v-831b0079"]]),zl=Object.freeze(Object.defineProperty({__proto__:null,default:Al},Symbol.toStringTag,{value:"Module"}));export{os as F,zl as G,ft as L,Ul as a,ps as b,Wl as c,Rl as d,jl as g,Ve as m};
