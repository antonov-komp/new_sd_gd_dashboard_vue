const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ticketListUtils-DkB1WosI.js","assets/priority-config-tpU737O5.js","assets/main-DyQkl-jq.js","assets/main-hkNOQW78.css","assets/priority-config-Bxxce_5E.css","assets/ticket-mapper-BOa9czMp.js"])))=>i.map(i=>d[i]);
var De=Object.defineProperty;var Se=(f,s,e)=>s in f?De(f,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):f[s]=e;var de=(f,s,e)=>Se(f,typeof s!="symbol"?s+"":s,e);import{_ as oe,g as $,c as G,G as D,a as u,o as c,b as t,t as C,F as q,e as J,n as X,d as j,f as te,j as R,H as Ie,I as Ue,J as ee,k as z,y as re,B as Z,T as ne,l as Q,K as le,m as Oe,z as Be,r as Ne,S as Re}from"./main-DyQkl-jq.js";import{F as Me}from"./FiltersPanel-gujspc-Y.js";import{L as ie,D as Pe,B as Le}from"./index-frsp31Mo.js";import{B as ae,g as $e,a as Fe,b as Ae,D as Ye,T as ce,c as ke}from"./priority-config-tpU737O5.js";const Ge={class:"ac-chart"},Ve={class:"ac-chart__header"},je={class:"ac-chart__subtitle"},ze={class:"ac-chart__controls"},He={class:"chart-type-selector"},xe=["onClick"],qe={class:"chart-type-icon"},Je={class:"chart-type-label"},Ze={class:"ac-chart__summary"},Ke={class:"summary-card__value"},Xe={class:"summary-card__value-main"},Qe={class:"summary-card__breakdown"},et={class:"breakdown-item breakdown-item--this-week"},tt={class:"breakdown-item__value"},st={class:"breakdown-item breakdown-item--other-week"},at={class:"breakdown-item__value"},rt={class:"summary-card__value-main"},lt={class:"summary-card__breakdown"},ot={class:"breakdown-item breakdown-item--this-week"},it={class:"breakdown-item__value"},nt={class:"breakdown-item breakdown-item--other-week"},ct={class:"breakdown-item__value"},dt={class:"summary-card summary-card--stages"},ut={class:"summary-card__tags"},kt={key:0,class:"stage-tag stage-tag--empty"},vt={class:"ac-chart__body"},yt={key:0,class:"split-charts-container"},mt={class:"chart-wrapper chart-wrapper--left"},ht={class:"chart-canvas-wrapper"},_t={class:"chart-wrapper chart-wrapper--right"},pt={class:"chart-canvas-wrapper"},gt={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(f,{emit:s}){const e=f,i=s,n=[{value:"line",label:"Ğ›Ğ¸Ğ½ĞµĞ¹Ğ½Ñ‹Ğ¹",icon:"ğŸ“ˆ"},{value:"bar",label:"Ğ¡Ñ‚Ğ¾Ğ»Ğ±Ñ‡Ğ°Ñ‚Ñ‹Ğ¹",icon:"ğŸ“Š"},{value:"doughnut",label:"ĞšÑ€ÑƒĞ³Ğ¾Ğ²Ğ°Ñ",icon:"ğŸ©"}],k=$("line");G(()=>{var d;return((d=e.meta)==null?void 0:d.weekNumber)??"â€”"});const E=()=>{var r,w;const d=((r=e.meta)==null?void 0:r.weeks)||[];return d.length>0?d.map(h=>`ĞĞµĞ´ĞµĞ»Ñ ${h.weekNumber}`):[(w=e.meta)!=null&&w.weekNumber?`ĞĞµĞ´ĞµĞ»Ñ ${e.meta.weekNumber}`:"ĞĞµĞ´ĞµĞ»Ñ"]},m=G(()=>{var v,U,L,H;const d=E(),r=Array.isArray((v=e.data.series)==null?void 0:v.new)&&e.data.series.new.length>0?e.data.series.new:[e.data.newTickets??0],w=Array.isArray((U=e.data.series)==null?void 0:U.closed)&&e.data.series.closed.length>0?e.data.series.closed:[e.data.closedTickets??0],h=Array.isArray((L=e.data.series)==null?void 0:L.closedCreatedThisWeek)&&e.data.series.closedCreatedThisWeek.length>0?e.data.series.closedCreatedThisWeek:[e.data.closedTicketsCreatedThisWeek??0],l=Array.isArray((H=e.data.series)==null?void 0:H.closedCreatedOtherWeek)&&e.data.series.closedCreatedOtherWeek.length>0?e.data.series.closedCreatedOtherWeek:[e.data.closedTicketsCreatedOtherWeek??0];return{labels:d,datasets:[{label:"ĞĞ¾Ğ²Ñ‹Ğµ",data:r,backgroundColor:D.primary,borderColor:D.primary,tension:.3,fill:!1},{label:"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ (Ğ²ÑĞµ)",data:w,backgroundColor:D.success,borderColor:D.success,tension:.3,fill:!1},{label:"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹)",data:h,backgroundColor:D.successLight,borderColor:D.successLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹)",data:l,backgroundColor:D.warning,borderColor:D.warning,tension:.3,fill:!1,borderDash:[5,5]}]}}),_=G(()=>{var l,v,U;const d=E(),r=Array.isArray((l=e.data.series)==null?void 0:l.carryover)&&e.data.series.carryover.length>0?e.data.series.carryover:[e.data.carryoverTickets??0],w=Array.isArray((v=e.data.series)==null?void 0:v.carryoverCreatedThisWeek)&&e.data.series.carryoverCreatedThisWeek.length>0?e.data.series.carryoverCreatedThisWeek:[e.data.carryoverTicketsCreatedThisWeek??0],h=Array.isArray((U=e.data.series)==null?void 0:U.carryoverCreatedOtherWeek)&&e.data.series.carryoverCreatedOtherWeek.length>0?e.data.series.carryoverCreatedOtherWeek:[e.data.carryoverTicketsCreatedOtherWeek??0];return{labels:d,datasets:[{label:"ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ (Ğ²ÑĞµ)",data:r,backgroundColor:D.carryover,borderColor:D.carryover,tension:.3,fill:!1},{label:"ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹)",data:w,backgroundColor:D.carryoverLight,borderColor:D.carryoverLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹)",data:h,backgroundColor:D.carryoverDark,borderColor:D.carryoverDark,tension:.3,fill:!1,borderDash:[5,5]}]}}),T=G(()=>{var W,y,N,Y,o,a,g,b,A;const d=((W=e.meta)==null?void 0:W.weeks)||[],r=d.length>0?d.map(I=>`ĞĞµĞ´ĞµĞ»Ñ ${I.weekNumber}`):[(y=e.meta)!=null&&y.weekNumber?`ĞĞµĞ´ĞµĞ»Ñ ${e.meta.weekNumber}`:"ĞĞµĞ´ĞµĞ»Ñ"],w=Array.isArray((N=e.data.series)==null?void 0:N.new)&&e.data.series.new.length>0?e.data.series.new:[e.data.newTickets??0],h=Array.isArray((Y=e.data.series)==null?void 0:Y.closed)&&e.data.series.closed.length>0?e.data.series.closed:[e.data.closedTickets??0],l=Array.isArray((o=e.data.series)==null?void 0:o.closedCreatedThisWeek)&&e.data.series.closedCreatedThisWeek.length>0?e.data.series.closedCreatedThisWeek:[e.data.closedTicketsCreatedThisWeek??0],v=Array.isArray((a=e.data.series)==null?void 0:a.closedCreatedOtherWeek)&&e.data.series.closedCreatedOtherWeek.length>0?e.data.series.closedCreatedOtherWeek:[e.data.closedTicketsCreatedOtherWeek??0],U=Array.isArray((g=e.data.series)==null?void 0:g.carryover)&&e.data.series.carryover.length>0?e.data.series.carryover:[e.data.carryoverTickets??0],L=Array.isArray((b=e.data.series)==null?void 0:b.carryoverCreatedThisWeek)&&e.data.series.carryoverCreatedThisWeek.length>0?e.data.series.carryoverCreatedThisWeek:[e.data.carryoverTicketsCreatedThisWeek??0],H=Array.isArray((A=e.data.series)==null?void 0:A.carryoverCreatedOtherWeek)&&e.data.series.carryoverCreatedOtherWeek.length>0?e.data.series.carryoverCreatedOtherWeek:[e.data.carryoverTicketsCreatedOtherWeek??0];return{labels:r,datasets:[{label:"ĞĞ¾Ğ²Ñ‹Ğµ",data:w,backgroundColor:D.primary,borderColor:D.primary,tension:.3,fill:!1},{label:"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ (Ğ²ÑĞµ)",data:h,backgroundColor:D.success,borderColor:D.success,tension:.3,fill:!1},{label:"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹)",data:l,backgroundColor:D.successLight,borderColor:D.successLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹)",data:v,backgroundColor:D.warning,borderColor:D.warning,tension:.3,fill:!1,borderDash:[5,5]},{label:"ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ (Ğ²ÑĞµ)",data:U,backgroundColor:D.carryover,borderColor:D.carryover,tension:.3,fill:!1},{label:"ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹)",data:L,backgroundColor:D.carryoverLight,borderColor:D.carryoverLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹)",data:H,backgroundColor:D.carryoverDark,borderColor:D.carryoverDark,tension:.3,fill:!1,borderDash:[5,5]}]}}),S=G(()=>({labels:["ĞĞ¾Ğ²Ñ‹Ğµ","Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ","ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ"],datasets:[{data:[e.data.newTickets??0,e.data.closedTickets??0,e.data.carryoverTickets??0],backgroundColor:[D.primary,D.success,D.carryover],borderWidth:1}]})),F=G(()=>{switch(k.value){case"line":return ie;case"bar":return Le;case"doughnut":return Pe;default:return ie}}),M=G(()=>k.value==="doughnut"?S.value:T.value),P=d=>{if(!d)return"â€”";try{return new Date(d).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return d}},O=G(()=>({responsive:!0,maintainAspectRatio:!1,resizeDelay:0,plugins:{tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12,callbacks:{title:d=>{var U,L,H,W,y,N;const r=(U=d[0])==null?void 0:U.dataIndex,w=((L=e.meta)==null?void 0:L.weeks)||[];if(w.length>0&&r!==void 0&&w[r]){const Y=w[r];return`ĞĞµĞ´ĞµĞ»Ñ ${Y.weekNumber} (${P(Y.weekStartUtc)} â€” ${P(Y.weekEndUtc)})`}const h=(H=e.meta)==null?void 0:H.weekNumber,l=(W=e.meta)==null?void 0:W.weekStartUtc,v=(y=e.meta)==null?void 0:y.weekEndUtc;return h&&l&&v?`ĞĞµĞ´ĞµĞ»Ñ ${h} (${P(l)} â€” ${P(v)})`:((N=d[0])==null?void 0:N.label)||""}}},legend:{position:"top",labels:{font:{size:15,weight:"500"},padding:16,boxWidth:20,boxHeight:12}}},scales:k.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},title:{display:!1},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:45,minRotation:45,font:{size:14},padding:10},title:{display:!1},grid:{lineWidth:1.5}}}})),B=G(()=>{var d,r,w,h;if((d=e.data)!=null&&d.series){const l=e.data.series,v=Math.max((Array.isArray(l.new)?l.new.length:0)-1,(Array.isArray(l.closed)?l.closed.length:0)-1,(Array.isArray(l.carryover)?l.carryover.length:0)-1,-1);if(v>=0){const U={newTickets:Array.isArray(l.new)&&l.new[v]!==void 0?l.new[v]:0,closedTickets:Array.isArray(l.closed)&&l.closed[v]!==void 0?l.closed[v]:0,closedTicketsCreatedThisWeek:Array.isArray(l.closedCreatedThisWeek)&&l.closedCreatedThisWeek[v]!==void 0?l.closedCreatedThisWeek[v]:0,closedTicketsCreatedOtherWeek:Array.isArray(l.closedCreatedOtherWeek)&&l.closedCreatedOtherWeek[v]!==void 0?l.closedCreatedOtherWeek[v]:0,carryoverTickets:Array.isArray(l.carryover)&&l.carryover[v]!==void 0?l.carryover[v]:0,carryoverTicketsCreatedThisWeek:Array.isArray(l.carryoverCreatedThisWeek)&&l.carryoverCreatedThisWeek[v]!==void 0?l.carryoverCreatedThisWeek[v]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(l.carryoverCreatedOtherWeek)&&l.carryoverCreatedOtherWeek[v]!==void 0?l.carryoverCreatedOtherWeek[v]:0};if(U.newTickets>0||U.closedTickets>0||U.carryoverTickets>0)return U}}if((r=e.data)!=null&&r.currentWeek&&typeof e.data.currentWeek=="object"){const l=e.data.currentWeek;if((l.newTickets??0)>0||(l.closedTickets??0)>0||(l.carryoverTickets??0)>0)return l}if((w=e.data)!=null&&w.weeksData&&Array.isArray(e.data.weeksData)&&e.data.weeksData.length>0){const l=e.data.weeksData[e.data.weeksData.length-1];if((l.newTickets??0)>0||(l.closedTickets??0)>0||(l.carryoverTickets??0)>0)return l}if((h=e.data)!=null&&h.series){const l=e.data.series,v=Math.max((Array.isArray(l.new)?l.new.length:0)-1,(Array.isArray(l.closed)?l.closed.length:0)-1,(Array.isArray(l.carryover)?l.carryover.length:0)-1,-1);if(v>=0)return{newTickets:Array.isArray(l.new)&&l.new[v]!==void 0?l.new[v]:0,closedTickets:Array.isArray(l.closed)&&l.closed[v]!==void 0?l.closed[v]:0,closedTicketsCreatedThisWeek:Array.isArray(l.closedCreatedThisWeek)&&l.closedCreatedThisWeek[v]!==void 0?l.closedCreatedThisWeek[v]:0,closedTicketsCreatedOtherWeek:Array.isArray(l.closedCreatedOtherWeek)&&l.closedCreatedOtherWeek[v]!==void 0?l.closedCreatedOtherWeek[v]:0,carryoverTickets:Array.isArray(l.carryover)&&l.carryover[v]!==void 0?l.carryover[v]:0,carryoverTicketsCreatedThisWeek:Array.isArray(l.carryoverCreatedThisWeek)&&l.carryoverCreatedThisWeek[v]!==void 0?l.carryoverCreatedThisWeek[v]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(l.carryoverCreatedOtherWeek)&&l.carryoverCreatedOtherWeek[v]!==void 0?l.carryoverCreatedOtherWeek[v]:0}}return e.data||{}}),x=d=>{var v;const r=B.value,w=(r==null?void 0:r.newTickets)??0,h=(r==null?void 0:r.closedTickets)??0,l=(r==null?void 0:r.carryoverTickets)??0;d==="new"&&w>0?i("open-stages"):d==="closed"&&h>0?(((v=e.data)==null?void 0:v.responsible)||[]).length>0&&i("open-responsible"):d==="carryover"&&l>0&&i("open-carryover")};return(d,r)=>{var w,h,l,v,U,L,H,W,y,N,Y,o,a,g,b,A;return c(),u("div",Ge,[t("header",Ve,[t("div",null,[r[3]||(r[3]=t("h2",{class:"ac-chart__title"},"Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ° Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¹ ÑĞµĞºÑ‚Ğ¾Ñ€Ğ° 1Ğ¡",-1)),t("p",je," ĞĞµĞ´ĞµĞ»Ñ "+C(((h=(w=f.meta)==null?void 0:w.currentWeek)==null?void 0:h.weekNumber)??((l=f.meta)==null?void 0:l.weekNumber)??"â€”")+" Â· "+C((((U=(v=f.meta)==null?void 0:v.currentWeek)==null?void 0:U.weekStartUtc)??((L=f.meta)==null?void 0:L.weekStartUtc))||"â€”")+" â€” "+C((((W=(H=f.meta)==null?void 0:H.currentWeek)==null?void 0:W.weekEndUtc)??((y=f.meta)==null?void 0:y.weekEndUtc))||"â€”")+" (UTC) ",1)]),t("div",ze,[t("div",He,[(c(),u(q,null,J(n,I=>t("button",{key:I.value,class:X(["chart-type-btn",{active:k.value===I.value}]),onClick:p=>k.value=I.value},[t("span",qe,C(I.icon),1),t("span",Je,C(I.label),1)],10,xe)),64))])])]),t("section",Ze,[t("div",{class:"summary-card summary-card--new",onClick:r[0]||(r[0]=I=>x("new"))},[r[4]||(r[4]=t("div",{class:"summary-card__label"},"ĞĞ¾Ğ²Ñ‹Ğµ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ",-1)),t("div",Ke,C(((N=B.value)==null?void 0:N.newTickets)??0),1)]),t("div",{class:"summary-card summary-card--closed-breakdown",onClick:r[1]||(r[1]=I=>x("closed"))},[r[9]||(r[9]=t("div",{class:"summary-card__label"},"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ",-1)),t("div",Xe,C(((Y=B.value)==null?void 0:Y.closedTickets)??0),1),t("div",Qe,[t("div",et,[r[5]||(r[5]=t("span",{class:"breakdown-item__icon"},"âœ“",-1)),t("span",tt,C(((o=B.value)==null?void 0:o.closedTicketsCreatedThisWeek)??0),1),r[6]||(r[6]=t("span",{class:"breakdown-item__label"},"ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹",-1))]),t("div",st,[r[7]||(r[7]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",at,C(((a=B.value)==null?void 0:a.closedTicketsCreatedOtherWeek)??0),1),r[8]||(r[8]=t("span",{class:"breakdown-item__label"},"Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹",-1))])])]),t("div",{class:"summary-card summary-card--carryover-breakdown",onClick:r[2]||(r[2]=I=>x("carryover"))},[r[14]||(r[14]=t("div",{class:"summary-card__label"},"ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ",-1)),t("div",rt,C(((g=B.value)==null?void 0:g.carryoverTickets)??0),1),t("div",lt,[t("div",ot,[r[10]||(r[10]=t("span",{class:"breakdown-item__icon"},"âœ“",-1)),t("span",it,C(((b=B.value)==null?void 0:b.carryoverTicketsCreatedThisWeek)??0),1),r[11]||(r[11]=t("span",{class:"breakdown-item__label"},"ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»Ğ¸",-1))]),t("div",nt,[r[12]||(r[12]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",ct,C(((A=B.value)==null?void 0:A.carryoverTicketsCreatedOtherWeek)??0),1),r[13]||(r[13]=t("span",{class:"breakdown-item__label"},"Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ñ…",-1))])])]),t("div",dt,[r[15]||(r[15]=t("div",{class:"summary-card__label"},"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Ğ¿Ğ¾ ÑÑ‚Ğ°Ğ´Ğ¸ÑĞ¼",-1)),t("div",ut,[(c(!0),u(q,null,J(f.data.stages||[],I=>(c(),u("span",{key:I.stageId,class:"stage-tag"},C(I.stageName||I.stageId)+" â€” "+C(I.count),1))),128)),!f.data.stages||f.data.stages.length===0?(c(),u("span",kt," ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ")):j("",!0)])])]),t("div",vt,[k.value==="line"?(c(),u("div",yt,[t("div",mt,[r[16]||(r[16]=t("h3",{class:"chart-subtitle"},"ĞĞ¾Ğ²Ñ‹Ğµ Ğ¸ Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ñ‚Ğ¸ĞºĞµÑ‚Ñ‹",-1)),t("div",ht,[R(Ie(ie),{data:m.value,options:O.value},null,8,["data","options"])])]),t("div",_t,[r[17]||(r[17]=t("h3",{class:"chart-subtitle"},"ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ñ‚Ğ¸ĞºĞµÑ‚Ñ‹",-1)),t("div",pt,[R(Ie(ie),{data:_.value,options:O.value},null,8,["data","options"])])])])):(c(),te(Ue(F.value),{key:1,data:M.value,options:O.value},null,8,["data","options"]))])])}}},Tt=oe(gt,[["__scopeId","data-v-73ab5a50"]]);class ue{static async getSectorData(){try{const s=await this.getAllTickets();console.log("Total tickets loaded:",s.length);const e=this.extractUniqueEmployeeIds(s);console.log("Unique employee IDs:",e);const i=await this.getEmployeesByIds(e);return console.log("Loaded employees:",i.length),{stages:this.groupTicketsByStages(s,i),employees:i,zeroPointTickets:this.getZeroPointTickets(s)}}catch(s){throw console.error("Error getting sector data:",s),s}}static async getAllTickets(){const s=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],e=[];for(const i of s){console.log(`Loading tickets for stage: ${i}`);const n=await this.getTicketsByStage(i);e.push(...n),console.log(`Loaded ${n.length} tickets for stage ${i}`)}return e}static async getTicketsByStage(s){const e=[];let i=0;const n=50;let k=!0;for(;k;)try{const m=await ae.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:s},select:["*"],order:{id:"DESC"},start:i,useOriginalUfNames:"Y"});let _=[];m&&m.result&&(Array.isArray(m.result)?_=m.result:m.result.items&&Array.isArray(m.result.items)?_=m.result.items:m.result.data&&Array.isArray(m.result.data)&&(_=m.result.data)),_.length>0?(e.push(..._),i+=_.length,k=_.length===n):k=!1}catch(m){console.error(`Error loading tickets batch for stage ${s} (start: ${i}):`,m),k=!1}e.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(e[0],null,2)),console.log("Sample ticket keys:",Object.keys(e[0])),console.log("Sample ticket assignedById variants:",{assignedById:e[0].assignedById,assignedByIdId:e[0].assignedByIdId,ASSIGNED_BY_ID:e[0].ASSIGNED_BY_ID}));const E=e.filter(m=>{const _=m.UF_CRM_7_TYPE_PRODUCT||m.uf_crm_7_type_product||m.ufCrm7TypeProduct||m.UF_CRM_7_TYPE_PRODUCT||m.uf_crm_7_type_product;return Array.isArray(_)?_.includes(this.SECTOR_TAG):typeof _=="object"&&_!==null?_.value===this.SECTOR_TAG||_===this.SECTOR_TAG:_===this.SECTOR_TAG});return console.log(`Filtered ${E.length} tickets from ${e.length} for stage ${s} (sector tag: ${this.SECTOR_TAG})`),E}static extractUniqueEmployeeIds(s){if(!Array.isArray(s))return[];const e=new Set;return s.forEach(i=>{const n=i.assignedById||i.assignedByIdId||i.ASSIGNED_BY_ID||i.assignedById||i.assignedById&&typeof i.assignedById=="object"&&(i.assignedById.id||i.assignedById.ID)||i.assignedById&&typeof i.assignedById=="object"&&i.assignedById.value;if(n){const k=parseInt(n);k&&!isNaN(k)&&k>0&&e.add(k)}}),s.length>0&&(console.log("Sample ticket for employee extraction:",s[0]),console.log("Sample ticket assignedById variants:",{assignedById:s[0].assignedById,assignedByIdId:s[0].assignedByIdId,ASSIGNED_BY_ID:s[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(e))),Array.from(e)}static async getEmployeesByIds(s){if(!Array.isArray(s)||s.length===0)return[];try{const e=await ae.call("user.get",{filter:{ID:s}});let i=[];return e&&e.result&&(Array.isArray(e.result)?i=e.result:console.warn("Unexpected user.get result format:",e)),i.map(n=>({id:parseInt(n.ID||n.id||0),name:`${n.NAME||n.name||""} ${n.LAST_NAME||n.lastName||""}`.trim()||n.EMAIL||n.email||"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹",position:n.WORK_POSITION||n.workPosition||"Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº",email:n.EMAIL||n.email||"",tickets:[]}))}catch(e){return console.error("Error getting employees by IDs:",e),[]}}static groupTicketsByStages(s,e){Array.isArray(s)||(console.warn("Tickets is not an array:",s),s=[]),Array.isArray(e)||(console.warn("Employees is not an array:",e),e=[]);const i=[{id:"formed",name:"Ğ¡Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ",color:"#007bff",employees:e.map(n=>({...n,tickets:[]}))},{id:"review",name:"Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ğ¸Ğµ Ğ¢Ğ—",color:"#ffc107",employees:e.map(n=>({...n,tickets:[]}))},{id:"execution",name:"Ğ˜ÑĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ",color:"#28a745",employees:e.map(n=>({...n,tickets:[]}))}];return s.forEach(n=>{const k=this.mapStageId(n.stageId||n.STAGE_ID||""),E=i.find(m=>m.id===k);if(E){const m=n.assignedById||n.ASSIGNED_BY_ID||null,_=m?parseInt(m):null;if(_){let T=E.employees.find(S=>S.id===_);T||(T={id:_,name:`Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº #${_}`,position:"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾",email:"",tickets:[]},E.employees.push(T)),T.tickets.push(this.mapTicket(n))}}}),i}static mapStageId(s){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[s]||"formed"}static mapStageIdToBitrix(s){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[s]||"DT140_12:UC_0VHWE2"}static mapTicket(s){const e=parseInt(s.id||s.ID||0),i=s.title||s.TITLE||"Ğ‘ĞµĞ· Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ",n=s.stageId||s.STAGE_ID||"",k=s.assignedById||s.ASSIGNED_BY_ID||null,E=s.createdTime||s.CREATED_DATE||s.CREATED_TIME||"",m=s.updatedTime||s.MODIFY_DATE||s.UPDATED_TIME||"",_=s.UF_CRM_7_UF_PRIORITY||s.uf_crm_7_uf_priority||s.ufCrm7UfPriority||s.UF_CRM_7_UF_PRIORITY||s.uf_crm_7_uf_priority||s.priority||s.PRIORITY||null,T=$e(_),S=Fe(T);return{id:e,title:i,priorityId:T.id,priorityLabel:T.label,priorityColors:S,priority:T.id,priorityBitrixValue:T.bitrixValue||null,status:this.mapStatus(n),assigneeId:k?parseInt(k):null,stageId:this.mapStageId(n),createdAt:E,modifiedAt:m,amount:s.opportunity||s.OPPORTUNITY||0,currency:s.currencyId||s.CURRENCY_ID||"RUB",description:s.comments||s.COMMENTS||""}}static mapPriority(s){return $e(s).id}static mapPriorityToBitrix(s){if(s&&typeof s=="object")return s.bitrixValue||null;const e=Ae(s);if(e&&e.bitrixValue)return e.bitrixValue;const i={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return i[s]?i[s]:Ae(Ye).bitrixValue}static mapStatus(s){return"in_progress"}static getZeroPointTickets(s){const e={formed:[],review:[],execution:[]};return Array.isArray(s)?(s.filter(i=>!(i.assignedById||i.ASSIGNED_BY_ID)).forEach(i=>{const n=this.mapStageId(i.stageId||i.STAGE_ID||"");e[n]&&e[n].push(this.mapTicket(i))}),e):(console.warn("Tickets is not an array in getZeroPointTickets:",s),e)}static async assignTicket(s,e,i){try{const n=this.mapStageIdToBitrix(i);return(await ae.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:s,fields:{assignedById:e,stageId:n}})).result===!0}catch(n){throw console.error("Error assigning ticket:",n),n}}static async createTicket(s){try{const e=await ae.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:s.title,assignedById:s.employeeId,stageId:this.mapStageIdToBitrix(s.stageId)}});return e.result?parseInt(e.result):0}catch(e){throw console.error("Error creating ticket:",e),e}}static async getTicket(s){try{const e=await ae.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:s});return this.mapTicket(e.result)}catch(e){throw console.error("Error getting ticket:",e),e}}static async addComment(s,e){try{return(await ae.call("crm.timeline.comment.add",{fields:{entityId:s,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:e}})).result!==void 0}catch(i){throw console.error("Error adding comment:",i),i}}}de(ue,"ENTITY_TYPE_ID",140),de(ue,"SECTOR_TAG","1C");const bt="/api/graph-1c-admission-closure.php";function ft(f){var i,n,k,E,m,_,T,S,F,M,P,O,B,x,d,r,w,h,l,v,U,L,H,W,y,N,Y,o,a,g,b,A,I,p,V,K,ve,ye,me,he,_e,pe,ge,Te,be,fe,Ce,we,We,Ee;if(!f)return{meta:null,data:{currentWeek:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0},newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},weeksData:[],stages:[],responsible:[],responsibleCreatedThisWeek:[],responsibleCreatedOtherWeek:[]}};const s=f.data||f.result||f,e=s.meta||f.meta||null;return{meta:{...e,currentWeek:(e==null?void 0:e.currentWeek)||(e?{weekNumber:e.weekNumber,weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc}:null),weeks:(e==null?void 0:e.weeks)||[]},data:{currentWeek:((i=s.data)==null?void 0:i.currentWeek)||(s.data?{newTickets:s.data.newTickets??0,closedTickets:s.data.closedTickets??0,closedTicketsCreatedThisWeek:s.data.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:s.data.closedTicketsCreatedOtherWeek??0,carryoverTickets:s.data.carryoverTickets??0,carryoverTicketsCreatedThisWeek:s.data.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:s.data.carryoverTicketsCreatedOtherWeek??0}:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0}),newTickets:((k=(n=s.data)==null?void 0:n.currentWeek)==null?void 0:k.newTickets)??((E=s.data)==null?void 0:E.newTickets)??s.newTickets??0,closedTickets:((_=(m=s.data)==null?void 0:m.currentWeek)==null?void 0:_.closedTickets)??((T=s.data)==null?void 0:T.closedTickets)??s.closedTickets??0,closedTicketsCreatedThisWeek:((F=(S=s.data)==null?void 0:S.currentWeek)==null?void 0:F.closedTicketsCreatedThisWeek)??((M=s.data)==null?void 0:M.closedTicketsCreatedThisWeek)??s.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:((O=(P=s.data)==null?void 0:P.currentWeek)==null?void 0:O.closedTicketsCreatedOtherWeek)??((B=s.data)==null?void 0:B.closedTicketsCreatedOtherWeek)??s.closedTicketsCreatedOtherWeek??0,carryoverTickets:((d=(x=s.data)==null?void 0:x.currentWeek)==null?void 0:d.carryoverTickets)??((r=s.data)==null?void 0:r.carryoverTickets)??s.carryoverTickets??0,carryoverTicketsCreatedThisWeek:((h=(w=s.data)==null?void 0:w.currentWeek)==null?void 0:h.carryoverTicketsCreatedThisWeek)??((l=s.data)==null?void 0:l.carryoverTicketsCreatedThisWeek)??s.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:((U=(v=s.data)==null?void 0:v.currentWeek)==null?void 0:U.carryoverTicketsCreatedOtherWeek)??((L=s.data)==null?void 0:L.carryoverTicketsCreatedOtherWeek)??s.carryoverTicketsCreatedOtherWeek??0,series:{new:((W=(H=s.data)==null?void 0:H.series)==null?void 0:W.new)??((y=s.series)==null?void 0:y.new)??[0],closed:((Y=(N=s.data)==null?void 0:N.series)==null?void 0:Y.closed)??((o=s.series)==null?void 0:o.closed)??[0],closedCreatedThisWeek:((g=(a=s.data)==null?void 0:a.series)==null?void 0:g.closedCreatedThisWeek)??((b=s.series)==null?void 0:b.closedCreatedThisWeek)??[0],closedCreatedOtherWeek:((I=(A=s.data)==null?void 0:A.series)==null?void 0:I.closedCreatedOtherWeek)??((p=s.series)==null?void 0:p.closedCreatedOtherWeek)??[0],carryover:((K=(V=s.data)==null?void 0:V.series)==null?void 0:K.carryover)??((ve=s.series)==null?void 0:ve.carryover)??[0],carryoverCreatedThisWeek:((me=(ye=s.data)==null?void 0:ye.series)==null?void 0:me.carryoverCreatedThisWeek)??((he=s.series)==null?void 0:he.carryoverCreatedThisWeek)??[0],carryoverCreatedOtherWeek:((pe=(_e=s.data)==null?void 0:_e.series)==null?void 0:pe.carryoverCreatedOtherWeek)??((ge=s.series)==null?void 0:ge.carryoverCreatedOtherWeek)??[0]},weeksData:((Te=s.data)==null?void 0:Te.weeksData)??s.weeksData??[],stages:((be=s.data)==null?void 0:be.stages)??s.stages??[],responsible:((fe=s.data)==null?void 0:fe.responsible)??s.responsible??[],responsibleCreatedThisWeek:((Ce=s.data)==null?void 0:Ce.responsibleCreatedThisWeek)??s.responsibleCreatedThisWeek??[],responsibleCreatedOtherWeek:((we=s.data)==null?void 0:we.responsibleCreatedOtherWeek)??s.responsibleCreatedOtherWeek??[],newTicketsByStages:((We=s.data)==null?void 0:We.newTicketsByStages)??s.newTicketsByStages??null,carryoverTicketsByDuration:((Ee=s.data)==null?void 0:Ee.carryoverTicketsByDuration)??s.carryoverTicketsByDuration??null}}}async function se(f={}){const{endpoint:s=bt,product:e="1C",weekStartUtc:i=null,weekEndUtc:n=null,useCache:k=!0,forceRefresh:E=!1,includeTickets:m=!1,includeNewTicketsByStages:_=!1,includeCarryoverTickets:T=!0,includeCarryoverTicketsByDuration:S=!1}=f,M=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({product:e,weekStartUtc:i,weekEndUtc:n,useCache:k,forceRefresh:E,includeTickets:m,includeNewTicketsByStages:_,includeCarryoverTickets:T,includeCarryoverTicketsByDuration:S})});if(!M.ok)throw new Error(`ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° (${M.status})`);const P=await M.json();if((P==null?void 0:P.success)===!1)throw new Error(P.message||"Ğ‘ÑĞºĞµĞ½Ğ´ Ğ²ĞµÑ€Ğ½ÑƒĞ» Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ");return ft(P)}const Ct={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},wt={class:"modal"},Wt={key:0,class:"modal__tabs"},Et={key:"level-0-categories",class:"level-0"},It={class:"modal__header"},$t={class:"modal__title"},At={key:0},Dt={class:"modal__body"},St={class:"categories-list"},Ut=["onClick"],Ot={class:"category-item"},Bt={class:"category-item__icon"},Nt={key:0},Rt={key:1},Mt={class:"category-item__content"},Pt={class:"category-item__label"},Lt={class:"category-item__count"},Ft={key:0,class:"category-item__arrow"},Yt={class:"modal__footer"},Gt={key:"level-1-categories",class:"level-1"},Vt={class:"modal__header"},jt={class:"modal__body"},zt={key:"loading",class:"loading-names"},Ht={key:"empty",class:"modal__empty"},xt={key:"list",class:"responsible-list"},qt=["onClick"],Jt={class:"responsible-list__name"},Zt={class:"responsible-list__count"},Kt={key:0,class:"responsible-list__arrow"},Xt={class:"modal__footer"},Qt={key:"level-2-categories",class:"level-2"},es={class:"modal__header"},ts={class:"modal__title"},ss={class:"modal__body"},as={key:"loading",class:"loading-state"},rs={key:"error",class:"error-state"},ls={class:"error-message"},os={key:"empty",class:"empty-state"},is={key:"tickets",class:"tickets-list-container"},ns={key:"level-0-employees",class:"level-0"},cs={class:"modal__header"},ds={class:"modal__title"},us={key:0},ks={class:"modal__body"},vs={key:"loading",class:"loading-names"},ys={key:"empty",class:"modal__empty"},ms={key:"list",class:"responsible-list"},hs=["onClick"],_s={class:"responsible-list__name"},ps={class:"responsible-list__count"},gs={key:0,class:"responsible-list__arrow"},Ts={class:"modal__footer"},bs={key:"level-1-employees",class:"level-1"},fs={class:"modal__header"},Cs={class:"modal__title"},ws={class:"modal__body"},Ws={class:"categories-list"},Es=["onClick"],Is={class:"category-item"},$s={class:"category-item__icon"},As={key:0},Ds={key:1},Ss={class:"category-item__content"},Us={class:"category-item__label"},Os={class:"category-item__count"},Bs={key:0,class:"category-item__arrow"},Ns={class:"modal__footer"},Rs={key:"level-2-employees",class:"level-2"},Ms={class:"modal__header"},Ps={class:"modal__title"},Ls={class:"modal__body"},Fs={key:"loading",class:"loading-state"},Ys={key:"error",class:"error-state"},Gs={class:"error-message"},Vs={key:"empty",class:"empty-state"},js={class:"empty-state-message"},zs={key:"tickets",class:"tickets-list-container"},Hs={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(f){const s=f,e=$(0),i=$("categories"),n=$(null),k=$(null),E=$(null),m=$([]),_=$(!1),T=$(null),S=$([]),F=$([]),M=$(!1),P=G(()=>[{id:"created-this-week",label:"Ğ¢Ğ¸ĞºĞµÑ‚Ñ‹ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ÑŒÑ Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ÑŒÑ",count:s.closedTicketsCreatedThisWeek??0,responsible:s.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"Ğ¢Ğ¸ĞºĞµÑ‚Ñ‹ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ÑŒÑ Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ€Ğ°Ğ½ĞµĞµ",count:s.closedTicketsCreatedOtherWeek??0,responsible:s.responsibleCreatedOtherWeek??[]}]),O=G(()=>{const o=new Map;return(s.responsibleCreatedThisWeek||[]).forEach(a=>{const g=a.id??"unassigned";o.has(g)||o.set(g,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const b=o.get(g);b.thisWeekCount=a.count??0,b.thisWeekTickets=a.tickets||[],b.totalCount+=b.thisWeekCount}),(s.responsibleCreatedOtherWeek||[]).forEach(a=>{const g=a.id??"unassigned";o.has(g)||o.set(g,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const b=o.get(g);b.otherWeekCount=a.count??0,b.otherWeekTickets=a.tickets||[],b.totalCount+=b.otherWeekCount}),Array.from(o.values())}),B=G(()=>{if(!k.value)return[];const o=k.value.thisWeekTickets||[],a=k.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:k.value.id,name:k.value.name,thisWeekCount:k.value.thisWeekCount,otherWeekCount:k.value.otherWeekCount,thisWeekTickets:o.length,otherWeekTickets:a.length,employee:k.value}),[{id:"this-week",label:"ĞĞ° ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»Ğµ",count:k.value.thisWeekCount??0,tickets:o,employeeId:k.value.id},{id:"other-week",label:"ĞĞ° Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»Ğµ",count:k.value.otherWeekCount??0,tickets:a,employeeId:k.value.id}]}),x=G(()=>(F.value||[]).length>0);async function d(o){const a=o.filter(g=>g.id!==null&&g.id!==void 0).map(g=>g.id);if(a.length===0)return o;try{const g=await ue.getEmployeesByIds(a),b=new Map;return g.forEach(A=>{b.set(A.id,A.name)}),o.map(A=>A.id&&b.has(A.id)?{...A,name:b.get(A.id)}:A)}catch(g){return console.error("[ResponsibleModal] Error enriching names:",g),o}}ee([()=>i.value,()=>O.value],async([o,a])=>{if(!(o!=="employees"||e.value!==0)){if(!a||a.length===0){F.value=[];return}M.value=!0;try{F.value=await d(a)}catch(g){console.error("[ResponsibleModal] Error loading employee names:",g),F.value=a}finally{M.value=!1}}},{immediate:!0}),ee(()=>s.responsible,async o=>{if(!(e.value!==0||n.value||i.value!=="categories")){if(!o||o.length===0){S.value=[];return}M.value=!0;try{S.value=await d(o)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),S.value=o}finally{M.value=!1}}},{immediate:!1});const r=G(()=>(S.value||[]).length>0);function w(o){i.value!==o&&(i.value=o,e.value=0,n.value=null,k.value=null,E.value=null,m.value=[],T.value=null,S.value=[],F.value=[])}async function h(o){if(!(!o||o.count===0)){n.value=o,e.value=1,M.value=!0;try{S.value=await d(o.responsible)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),S.value=o.responsible}finally{M.value=!1}}}async function l(o,a=null){var g,b;!o||!o.id||o.totalCount===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:o.id,name:o.name,thisWeekCount:o.thisWeekCount,otherWeekCount:o.otherWeekCount,thisWeekTickets:((g=o.thisWeekTickets)==null?void 0:g.length)||0,otherWeekTickets:((b=o.otherWeekTickets)==null?void 0:b.length)||0,employee:o}),k.value={...o,thisWeekTickets:o.thisWeekTickets||[],otherWeekTickets:o.otherWeekTickets||[]},e.value=1)}async function v(o){var g;if(!o||o.count===0)return;E.value=o,e.value=2;const a=o.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:o.id,label:o.label,count:o.count,ticketsInGradation:a.length,selectedEmployee:(g=k.value)==null?void 0:g.id}),a.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",a.length),await U(a)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await L(o))}async function U(o){_.value=!0,T.value=null;try{try{const{prepareTicketsForDisplay:a}=await le(async()=>{const{prepareTicketsForDisplay:g}=await import("./ticketListUtils-DkB1WosI.js").then(b=>b.t);return{prepareTicketsForDisplay:g}},__vite__mapDeps([0,1,2,3,4,5]));m.value=await a(o,null,null)}catch(a){console.error("[ResponsibleModal] Error preparing tickets:",a),m.value=o}m.value.length===0&&(T.value=null)}catch(a){T.value=a.message||"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²",console.error("[ResponsibleModal] Error loading tickets:",a),m.value=[]}finally{_.value=!1}}async function L(o){_.value=!0,T.value=null;try{if(!s.weekStartUtc||!s.weekEndUtc||!k.value)throw new Error("ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ½ĞµĞ´ĞµĞ»Ğ¸ Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº");const a=await se({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeTickets:!0}),g=o.id==="this-week"?a.data.responsibleCreatedThisWeek:a.data.responsibleCreatedOtherWeek,b=g==null?void 0:g.find(I=>I.id===k.value.id),A=(b==null?void 0:b.tickets)||[];try{const{prepareTicketsForDisplay:I}=await le(async()=>{const{prepareTicketsForDisplay:p}=await import("./ticketListUtils-DkB1WosI.js").then(V=>V.t);return{prepareTicketsForDisplay:p}},__vite__mapDeps([0,1,2,3,4,5]));m.value=await I(A,null,null)}catch(I){console.error("[ResponsibleModal] Error preparing tickets:",I),m.value=A}m.value.length===0&&(T.value=null)}catch(a){T.value=a.message||"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²",console.error("[ResponsibleModal] Error loading tickets from API:",a),m.value=[]}finally{_.value=!1}}async function H(o,a=null){!o||!o.id||o.count===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),k.value=o,e.value=2,await W(o.id))}async function W(o){var a;_.value=!0,T.value=null;try{let g=[];if(n.value&&n.value.responsible){const b=n.value.responsible.find(A=>A.id===o);g=(b==null?void 0:b.tickets)||[]}if(g.length===0&&s.weekStartUtc&&s.weekEndUtc){const b=await se({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeTickets:!0}),A=((a=n.value)==null?void 0:a.id)==="created-this-week"?b.data.responsibleCreatedThisWeek:b.data.responsibleCreatedOtherWeek,I=A==null?void 0:A.find(p=>p.id===o);g=(I==null?void 0:I.tickets)||[]}try{const{prepareTicketsForDisplay:b}=await le(async()=>{const{prepareTicketsForDisplay:A}=await import("./ticketListUtils-DkB1WosI.js").then(I=>I.t);return{prepareTicketsForDisplay:A}},__vite__mapDeps([0,1,2,3,4,5]));m.value=await b(g,null,null)}catch(b){console.error("[ResponsibleModal] Error preparing tickets:",b),m.value=g}m.value.length===0&&(T.value=null)}catch(g){T.value=g.message||"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²",console.error("[ResponsibleModal] Error loading tickets:",g),m.value=[]}finally{_.value=!1}}function y(){e.value===2?(e.value=1,i.value==="categories"?k.value=null:E.value=null,m.value=[],T.value=null):e.value===1&&(e.value=0,i.value==="categories"?(n.value=null,S.value=[]):k.value=null)}function N(o){const a=ke(o.id);window.open(a,"_blank")}function Y(){i.value==="employees"&&E.value?U(E.value.tickets):i.value==="categories"&&k.value&&W(k.value.id)}return ee(()=>s.isVisible,o=>{o||(e.value=0,i.value="categories",n.value=null,k.value=null,E.value=null,m.value=[],T.value=null,S.value=[],F.value=[])}),(o,a)=>f.isVisible?(c(),u("div",Ct,[t("div",wt,[e.value===0?(c(),u("div",Wt,[t("button",{class:X(["modal__tab",{"modal__tab--active":i.value==="categories"}]),onClick:a[0]||(a[0]=g=>w("categories"))}," ĞŸĞ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼ ",2),t("button",{class:X(["modal__tab",{"modal__tab--active":i.value==="employees"}]),onClick:a[1]||(a[1]=g=>w("employees"))}," ĞŸĞ¾ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ°Ğ¼ ",2)])):j("",!0),R(Z,{name:"level",mode:"out-in"},{default:z(()=>{var g,b,A,I;return[i.value==="categories"&&e.value===0?(c(),u("div",Et,[t("header",It,[t("h3",$t,[a[12]||(a[12]=re(" Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ",-1)),f.weekNumber?(c(),u("span",At," Â· ĞĞµĞ´ĞµĞ»Ñ "+C(f.weekNumber),1)):j("",!0)]),t("button",{class:"modal__close",onClick:a[2]||(a[2]=p=>o.$emit("close")),"aria-label":"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Dt,[t("ul",St,[(c(!0),u(q,null,J(P.value,p=>(c(),u("li",{key:p.id,class:X(["categories-list__item",{"categories-list__item--clickable":p.count>0}]),onClick:V=>h(p)},[t("div",Ot,[t("div",Bt,[p.id==="created-this-week"?(c(),u("span",Nt,"âœ“")):(c(),u("span",Rt,"â†»"))]),t("div",Mt,[t("div",Pt,C(p.label),1),t("div",Lt,C(p.count)+" Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²",1)]),p.count>0?(c(),u("span",Ft,"â†’")):j("",!0)])],10,Ut))),128))])]),t("footer",Yt,[t("button",{class:"btn",onClick:a[3]||(a[3]=p=>o.$emit("close"))},"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ")])])):i.value==="categories"&&e.value===1?(c(),u("div",Gt,[t("header",Vt,[t("button",{class:"btn-back",onClick:y,"aria-label":"ĞĞ°Ğ·Ğ°Ğ´"},"â† ĞĞ°Ğ·Ğ°Ğ´"),a[13]||(a[13]=t("h3",{class:"modal__title"},"ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ",-1)),t("button",{class:"modal__close",onClick:a[4]||(a[4]=p=>o.$emit("close")),"aria-label":"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",jt,[R(Z,{name:"loading",mode:"out-in"},{default:z(()=>[M.value?(c(),u("div",zt,[...a[14]||(a[14]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ¼Ñ‘Ğ½ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ¾Ğ²...",-1)])])):r.value?(c(),u("ul",xt,[(c(!0),u(q,null,J(S.value,p=>(c(),u("li",{key:p.id||p.name,class:X(["responsible-list__item",{"responsible-list__item--clickable":p.id&&p.count>0}]),onClick:V=>H(p,V),title:"ĞšĞ»Ğ¸ĞºĞ½Ğ¸Ñ‚Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ°"},[t("span",Jt,C(p.name||"ĞĞµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½"),1),t("span",Zt,C(p.count??0)+" Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² ",1),p.id&&p.count>0?(c(),u("span",Kt,"â†’")):j("",!0)],10,qt))),128))])):(c(),u("p",Ht,"ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¼"))]),_:1})]),t("footer",Xt,[t("button",{class:"btn",onClick:a[5]||(a[5]=p=>o.$emit("close"))},"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ")])])):i.value==="categories"&&e.value===2?(c(),u("div",Qt,[t("header",es,[t("button",{class:"btn-back",onClick:y,"aria-label":"ĞĞ°Ğ·Ğ°Ğ´"},"â† ĞĞ°Ğ·Ğ°Ğ´"),t("h3",ts,"Ğ¢Ğ¸ĞºĞµÑ‚Ñ‹ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ°: "+C(((g=k.value)==null?void 0:g.name)||"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾"),1),t("button",{class:"modal__close",onClick:a[6]||(a[6]=p=>o.$emit("close")),"aria-label":"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",ss,[R(Z,{name:"loading",mode:"out-in"},{default:z(()=>[_.value?(c(),u("div",as,[...a[15]||(a[15]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²...",-1)])])):T.value?(c(),u("div",rs,[a[16]||(a[16]=t("div",{class:"error-icon"},"âš ï¸",-1)),a[17]||(a[17]=t("p",{class:"error-title"},"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸",-1)),t("p",ls,C(T.value),1),t("button",{class:"btn btn-retry",onClick:Y},"ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ")])):m.value.length===0?(c(),u("div",os,[...a[18]||(a[18]=[t("div",{class:"empty-state-icon"},"ğŸ“‹",-1),t("p",{class:"empty-state-message"},"Ğ£ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ° Ğ½ĞµÑ‚ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² Ğ·Ğ° Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ Ğ½ĞµĞ´ĞµĞ»Ñ",-1)])])):(c(),u("div",is,[R(ne,{name:"ticket",tag:"div",class:"tickets-list"},{default:z(()=>[(c(!0),u(q,null,J(m.value,(p,V)=>(c(),te(ce,{key:p.id,ticket:p,draggable:!1,style:Q({"--ticket-index":V}),onClick:N},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):i.value==="employees"&&e.value===0?(c(),u("div",ns,[t("header",cs,[t("h3",ds,[a[19]||(a[19]=re(" Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ",-1)),f.weekNumber?(c(),u("span",us," Â· ĞĞµĞ´ĞµĞ»Ñ "+C(f.weekNumber),1)):j("",!0)]),t("button",{class:"modal__close",onClick:a[7]||(a[7]=p=>o.$emit("close")),"aria-label":"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",ks,[R(Z,{name:"loading",mode:"out-in"},{default:z(()=>[M.value?(c(),u("div",vs,[...a[20]||(a[20]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ¼Ñ‘Ğ½ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ¾Ğ²...",-1)])])):x.value?(c(),u("ul",ms,[(c(!0),u(q,null,J(F.value,p=>(c(),u("li",{key:p.id||p.name,class:X(["responsible-list__item",{"responsible-list__item--clickable":p.id&&p.totalCount>0}]),onClick:V=>l(p,V),title:"ĞšĞ»Ğ¸ĞºĞ½Ğ¸Ñ‚Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ³Ñ€Ğ°Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ°"},[t("span",_s,C(p.name||"ĞĞµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½"),1),t("span",ps,C(p.totalCount??0)+" Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² ",1),p.id&&p.totalCount>0?(c(),u("span",gs,"â†’")):j("",!0)],10,hs))),128))])):(c(),u("p",ys,"ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ°Ğ¼"))]),_:1})]),t("footer",Ts,[t("button",{class:"btn",onClick:a[8]||(a[8]=p=>o.$emit("close"))},"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ")])])):i.value==="employees"&&e.value===1?(c(),u("div",bs,[t("header",fs,[t("button",{class:"btn-back",onClick:y,"aria-label":"ĞĞ°Ğ·Ğ°Ğ´"},"â† ĞĞ°Ğ·Ğ°Ğ´"),t("h3",Cs,"Ğ¢Ğ¸ĞºĞµÑ‚Ñ‹ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ°: "+C(((b=k.value)==null?void 0:b.name)||"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾"),1),t("button",{class:"modal__close",onClick:a[9]||(a[9]=p=>o.$emit("close")),"aria-label":"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",ws,[t("ul",Ws,[(c(!0),u(q,null,J(B.value,p=>(c(),u("li",{key:p.id,class:X(["categories-list__item",{"categories-list__item--clickable":p.count>0}]),onClick:V=>v(p)},[t("div",Is,[t("div",$s,[p.id==="this-week"?(c(),u("span",As,"âœ“")):(c(),u("span",Ds,"â†»"))]),t("div",Ss,[t("div",Us,C(p.label),1),t("div",Os,C(p.count)+" Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²",1)]),p.count>0?(c(),u("span",Bs,"â†’")):j("",!0)])],10,Es))),128))])]),t("footer",Ns,[t("button",{class:"btn",onClick:a[10]||(a[10]=p=>o.$emit("close"))},"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ")])])):i.value==="employees"&&e.value===2?(c(),u("div",Rs,[t("header",Ms,[t("button",{class:"btn-back",onClick:y,"aria-label":"ĞĞ°Ğ·Ğ°Ğ´"},"â† ĞĞ°Ğ·Ğ°Ğ´"),t("h3",Ps," Ğ¢Ğ¸ĞºĞµÑ‚Ñ‹ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ°: "+C(((A=k.value)==null?void 0:A.name)||"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾")+" ("+C(((I=E.value)==null?void 0:I.label)||"")+") ",1),t("button",{class:"modal__close",onClick:a[11]||(a[11]=p=>o.$emit("close")),"aria-label":"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Ls,[R(Z,{name:"loading",mode:"out-in"},{default:z(()=>{var p;return[_.value?(c(),u("div",Fs,[...a[21]||(a[21]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²...",-1)])])):T.value?(c(),u("div",Ys,[a[22]||(a[22]=t("div",{class:"error-icon"},"âš ï¸",-1)),a[23]||(a[23]=t("p",{class:"error-title"},"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸",-1)),t("p",Gs,C(T.value),1),t("button",{class:"btn btn-retry",onClick:Y},"ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ")])):m.value.length===0?(c(),u("div",Vs,[a[24]||(a[24]=t("div",{class:"empty-state-icon"},"ğŸ“‹",-1)),t("p",js,C(i.value==="employees"?`Ğ£ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ° Ğ½ĞµÑ‚ Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² Ğ² ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ "${((p=E.value)==null?void 0:p.label)||""}"`:"Ğ£ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ° Ğ½ĞµÑ‚ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² Ğ·Ğ° Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ Ğ½ĞµĞ´ĞµĞ»Ñ"),1)])):(c(),u("div",zs,[R(ne,{name:"ticket",tag:"div",class:"tickets-list"},{default:z(()=>[(c(!0),u(q,null,J(m.value,(V,K)=>(c(),te(ce,{key:V.id,ticket:V,draggable:!1,style:Q({"--ticket-index":K}),onClick:N},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):j("",!0)]}),_:1})])])):j("",!0)}},xs=oe(Hs,[["__scopeId","data-v-3b229bb4"]]),qs={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Js={class:"modal"},Zs={key:"level-1",class:"level-1"},Ks={class:"modal__header"},Xs={class:"modal__title"},Qs={key:0},ea={class:"modal__body"},ta={key:"loading",class:"loading-names"},sa={key:"empty",class:"modal__empty"},aa={key:"list",class:"stages-list"},ra=["onClick"],la={class:"stages-list__name"},oa={class:"stages-list__count"},ia={key:0,class:"stages-list__arrow"},na={class:"modal__footer"},ca={key:"level-2",class:"level-2"},da={class:"modal__header"},ua={class:"modal__title"},ka={class:"modal__body"},va={key:"loading",class:"loading-state"},ya={key:"error",class:"error-state"},ma={class:"error-message"},ha={key:"empty",class:"empty-state"},_a={class:"empty-state-message"},pa={key:"tickets",class:"tickets-list-container"},ga={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:s}){const e=f,i=$(1),n=$(null),k=$([]),E=$(!1),m=$(!1),_=$(null),T=$([]),S=G(()=>T.value.length>0&&T.value.some(d=>d.count>0));async function F(){if(!e.weekStartUtc||!e.weekEndUtc){T.value=[];return}m.value=!0,_.value=null;try{const d=await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeNewTicketsByStages:!0});T.value=d.data.newTicketsByStages||[]}catch(d){_.value=d.message||"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ÑÑ‚Ğ°Ğ´Ğ¸Ğ¹",console.error("[StagesModal] Error loading stages:",d),T.value=[]}finally{m.value=!1}}async function M(d,r=null){!d||d.count===0||(r&&r.currentTarget&&(r.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{r.currentTarget&&(r.currentTarget.style.transform="")},150)),n.value=d,i.value=2,await P(d.stageId))}async function P(d){var r;E.value=!0,_.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc)throw new Error("ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ½ĞµĞ´ĞµĞ»Ğ¸");const h=(r=(await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:r.find(v=>v.stageId===d),l=(h==null?void 0:h.tickets)||[];try{const{prepareTicketsForDisplay:v}=await le(async()=>{const{prepareTicketsForDisplay:U}=await import("./ticketListUtils-DkB1WosI.js").then(L=>L.t);return{prepareTicketsForDisplay:U}},__vite__mapDeps([0,1,2,3,4,5]));k.value=await v(l,null,null)}catch(v){console.error("[StagesModal] Error preparing tickets:",v),k.value=l}k.value.length===0&&(_.value=null)}catch(w){_.value=w.message||"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²",console.error("[StagesModal] Error loading tickets:",w),k.value=[]}finally{E.value=!1}}function O(){i.value=1,n.value=null,k.value=[],_.value=null}function B(d){const r=ke(d.id);window.open(r,"_blank")}function x(){n.value&&P(n.value.stageId)}return ee(()=>e.isVisible,d=>{d?F():(i.value=1,n.value=null,k.value=[],_.value=null,T.value=[])}),ee([()=>e.weekStartUtc,()=>e.weekEndUtc],()=>{e.isVisible&&F()}),(d,r)=>f.isVisible?(c(),u("div",qs,[t("div",Js,[R(Z,{name:"level",mode:"out-in"},{default:z(()=>{var w;return[i.value===1?(c(),u("div",Zs,[t("header",Ks,[t("h3",Xs,[r[3]||(r[3]=re(" ĞĞ¾Ğ²Ñ‹Ğµ Ñ‚Ğ¸ĞºĞµÑ‚Ñ‹ Ğ¿Ğ¾ ÑÑ‚Ğ°Ğ´Ğ¸ÑĞ¼",-1)),f.weekNumber?(c(),u("span",Qs," Â· ĞĞµĞ´ĞµĞ»Ñ "+C(f.weekNumber),1)):j("",!0)]),t("button",{class:"modal__close",onClick:r[0]||(r[0]=h=>d.$emit("close")),"aria-label":"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",ea,[R(Z,{name:"loading",mode:"out-in"},{default:z(()=>[m.value?(c(),u("div",ta,[...r[4]||(r[4]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑÑ‚Ğ°Ğ´Ğ¸Ğ¹...",-1)])])):S.value?(c(),u("ul",aa,[(c(!0),u(q,null,J(T.value,h=>(c(),u("li",{key:h.stageId,class:X(["stages-list__item",{"stages-list__item--clickable":h.count>0}]),style:Q({"--stage-color":h.color}),onClick:l=>M(h,l),title:"ĞšĞ»Ğ¸ĞºĞ½Ğ¸Ñ‚Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² ÑÑ‚Ğ°Ğ´Ğ¸Ğ¸"},[t("span",{class:"stages-list__color",style:Q({backgroundColor:h.color})},null,4),t("span",la,C(h.stageName),1),t("span",oa,C(h.count)+" Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² ",1),h.count>0?(c(),u("span",ia,"â†’")):j("",!0)],14,ra))),128))])):(c(),u("p",sa," ĞĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² Ğ·Ğ° Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ Ğ½ĞµĞ´ĞµĞ»Ñ "))]),_:1})]),t("footer",na,[t("button",{class:"btn",onClick:r[1]||(r[1]=h=>d.$emit("close"))},"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ")])])):i.value===2?(c(),u("div",ca,[t("header",da,[t("button",{class:"btn-back",onClick:O,"aria-label":"ĞĞ°Ğ·Ğ°Ğ´"},"â† ĞĞ°Ğ·Ğ°Ğ´"),t("h3",ua," Ğ¢Ğ¸ĞºĞµÑ‚Ñ‹ ÑÑ‚Ğ°Ğ´Ğ¸Ğ¸: "+C(((w=n.value)==null?void 0:w.stageName)||"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾"),1),t("button",{class:"modal__close",onClick:r[2]||(r[2]=h=>d.$emit("close")),"aria-label":"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",ka,[R(Z,{name:"loading",mode:"out-in"},{default:z(()=>{var h;return[E.value?(c(),u("div",va,[...r[5]||(r[5]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²...",-1)])])):_.value?(c(),u("div",ya,[r[6]||(r[6]=t("div",{class:"error-icon"},"âš ï¸",-1)),r[7]||(r[7]=t("p",{class:"error-title"},"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸",-1)),t("p",ma,C(_.value),1),t("button",{class:"btn btn-retry",onClick:x},"ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ")])):k.value.length===0?(c(),u("div",ha,[r[8]||(r[8]=t("div",{class:"empty-state-icon"},"ğŸ“‹",-1)),t("p",_a," ĞĞ° ÑÑ‚Ğ°Ğ´Ğ¸Ğ¸ Â«"+C((h=n.value)==null?void 0:h.stageName)+"Â» Ğ½ĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² Ğ·Ğ° Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ Ğ½ĞµĞ´ĞµĞ»Ñ ",1)])):(c(),u("div",pa,[R(ne,{name:"ticket",tag:"div",class:"tickets-list"},{default:z(()=>[(c(!0),u(q,null,J(k.value,(l,v)=>(c(),te(ce,{key:l.id,ticket:l,draggable:!1,style:Q({"--ticket-index":v}),onClick:B},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):j("",!0)]}),_:1})])])):j("",!0)}},Ta=oe(ga,[["__scopeId","data-v-4af0cfce"]]),ba={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},fa={class:"modal"},Ca={key:"level-1",class:"level-1"},wa={class:"modal__header"},Wa={class:"modal__title"},Ea={key:0},Ia={class:"modal__body"},$a={key:"loading",class:"loading-names"},Aa={key:"empty",class:"modal__empty"},Da={key:"list",class:"duration-list"},Sa=["onClick"],Ua={class:"duration-list__name"},Oa={class:"duration-list__count"},Ba={key:0,class:"duration-list__arrow"},Na={class:"modal__footer"},Ra={key:"level-2",class:"level-2"},Ma={class:"modal__header"},Pa={class:"modal__title"},La={class:"modal__body"},Fa={key:"loading",class:"loading-state"},Ya={key:"error",class:"error-state"},Ga={class:"error-message"},Va={key:"empty",class:"empty-state"},ja={class:"empty-state-message"},za={key:"tickets",class:"tickets-list-container"},Ha={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:s}){const e=f,i=$(1),n=$(null),k=$([]),E=$(!1),m=$(!1),_=$(null),T=$([]),S=G(()=>T.value.length>0&&T.value.some(d=>d.count>0));async function F(){if(!e.weekStartUtc||!e.weekEndUtc){T.value=[];return}m.value=!0,_.value=null;try{const d=await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});T.value=d.data.carryoverTicketsByDuration||[]}catch(d){_.value=d.message||"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹",console.error("[CarryoverDurationModal] Error loading categories:",d),T.value=[]}finally{m.value=!1}}async function M(d,r=null){!d||d.count===0||(r&&r.currentTarget&&(r.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{r.currentTarget&&(r.currentTarget.style.transform="")},150)),n.value=d,i.value=2,await P(d.durationCategory))}async function P(d){var r;E.value=!0,_.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc)throw new Error("ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ½ĞµĞ´ĞµĞ»Ğ¸");const h=(r=(await se({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})).data.carryoverTicketsByDuration)==null?void 0:r.find(v=>v.durationCategory===d),l=(h==null?void 0:h.tickets)||[];try{const{prepareTicketsForDisplay:v}=await le(async()=>{const{prepareTicketsForDisplay:U}=await import("./ticketListUtils-DkB1WosI.js").then(L=>L.t);return{prepareTicketsForDisplay:U}},__vite__mapDeps([0,1,2,3,4,5]));k.value=await v(l,null,null)}catch(v){console.error("[CarryoverDurationModal] Error preparing tickets:",v),k.value=l}k.value.length===0&&(_.value=null)}catch(w){_.value=w.message||"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²",console.error("[CarryoverDurationModal] Error loading tickets:",w),k.value=[]}finally{E.value=!1}}function O(){i.value=1,n.value=null,k.value=[],_.value=null}function B(d){const r=ke(d.id);window.open(r,"_blank")}function x(){n.value&&P(n.value.durationCategory)}return ee(()=>e.isVisible,d=>{d?F():(i.value=1,n.value=null,k.value=[],_.value=null,T.value=[])}),ee([()=>e.weekStartUtc,()=>e.weekEndUtc],()=>{e.isVisible&&F()}),(d,r)=>f.isVisible?(c(),u("div",ba,[t("div",fa,[R(Z,{name:"level",mode:"out-in"},{default:z(()=>{var w;return[i.value===1?(c(),u("div",Ca,[t("header",wa,[t("h3",Wa,[r[3]||(r[3]=re(" ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ñ‚Ğ¸ĞºĞµÑ‚Ñ‹ Ğ¿Ğ¾ ÑÑ€Ğ¾ĞºĞ°Ğ¼",-1)),f.weekNumber?(c(),u("span",Ea," Â· ĞĞµĞ´ĞµĞ»Ñ "+C(f.weekNumber),1)):j("",!0)]),t("button",{class:"modal__close",onClick:r[0]||(r[0]=h=>d.$emit("close")),"aria-label":"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Ia,[R(Z,{name:"loading",mode:"out-in"},{default:z(()=>[m.value?(c(),u("div",$a,[...r[4]||(r[4]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹...",-1)])])):S.value?(c(),u("ul",Da,[(c(!0),u(q,null,J(T.value,h=>(c(),u("li",{key:h.durationCategory,class:X(["duration-list__item",{"duration-list__item--clickable":h.count>0}]),style:Q({"--duration-color":h.color}),onClick:l=>M(h,l),title:"ĞšĞ»Ğ¸ĞºĞ½Ğ¸Ñ‚Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸"},[t("span",{class:"duration-list__color",style:Q({backgroundColor:h.color})},null,4),t("span",Ua,C(h.durationLabel),1),t("span",Oa,C(h.count)+" Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² ",1),h.count>0?(c(),u("span",Ba,"â†’")):j("",!0)],14,Sa))),128))])):(c(),u("p",Aa," ĞĞµÑ‚ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² Ğ·Ğ° Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ Ğ½ĞµĞ´ĞµĞ»Ñ "))]),_:1})]),t("footer",Na,[t("button",{class:"btn",onClick:r[1]||(r[1]=h=>d.$emit("close"))},"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ")])])):i.value===2?(c(),u("div",Ra,[t("header",Ma,[t("button",{class:"btn-back",onClick:O,"aria-label":"ĞĞ°Ğ·Ğ°Ğ´"},"â† ĞĞ°Ğ·Ğ°Ğ´"),t("h3",Pa," Ğ¢Ğ¸ĞºĞµÑ‚Ñ‹: "+C(((w=n.value)==null?void 0:w.durationLabel)||"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾"),1),t("button",{class:"modal__close",onClick:r[2]||(r[2]=h=>d.$emit("close")),"aria-label":"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",La,[R(Z,{name:"loading",mode:"out-in"},{default:z(()=>{var h;return[E.value?(c(),u("div",Fa,[...r[5]||(r[5]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²...",-1)])])):_.value?(c(),u("div",Ya,[r[6]||(r[6]=t("div",{class:"error-icon"},"âš ï¸",-1)),r[7]||(r[7]=t("p",{class:"error-title"},"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸",-1)),t("p",Ga,C(_.value),1),t("button",{class:"btn btn-retry",onClick:x},"ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ")])):k.value.length===0?(c(),u("div",Va,[r[8]||(r[8]=t("div",{class:"empty-state-icon"},"ğŸ“‹",-1)),t("p",ja," Ğ’ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Â«"+C((h=n.value)==null?void 0:h.durationLabel)+"Â» Ğ½ĞµÑ‚ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ² ",1)])):(c(),u("div",za,[R(ne,{name:"ticket",tag:"div",class:"tickets-list"},{default:z(()=>[(c(!0),u(q,null,J(k.value,(l,v)=>(c(),te(ce,{key:l.id,ticket:l,draggable:!1,style:Q({"--ticket-index":v}),onClick:B},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):j("",!0)]}),_:1})])])):j("",!0)}},xa=oe(Ha,[["__scopeId","data-v-c26f06c2"]]),qa={class:"ac-dashboard"},Ja={key:"preloader",class:"chart-preloader"},Za={key:"content"},Ka={class:"dashboard-header"},Xa={class:"header-content"},Qa={class:"breadcrumbs-row"},er=["aria-label","aria-disabled","data-fallback","disabled"],tr={class:"breadcrumbs","aria-label":"ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ"},sr={class:"dashboard-layout"},ar={class:"filters-container"},rr={class:"chart-container"},lr={__name:"GraphAdmissionClosureDashboard",setup(f){const s=Be(),e=$(!0),i=$(null),n=$(null),k=$({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),E=$(!1),m=$(!1),_=$(!1),T=$(!1),S=G(()=>typeof window>"u"?!1:window.history.length>1),F=G(()=>S.value?"Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ":"Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğ½Ğ° Ğ³Ğ»Ğ°Ğ²Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ"),M={name:"dashboard-sector-1c"};function P(W){var y;if((y=W==null?void 0:W.preventDefault)==null||y.call(W),!T.value){T.value=!0;try{if(S.value){s.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),s.push(M)}finally{T.value=!1}}}const O=$({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),B=$(null),x=G(()=>{const W=O.value.customDateRange.startDate||O.value.customDateRange.endDate,y=O.value.employees.length===1&&O.value.employees.includes("all");return W||!y});async function d(){e.value=!0,i.value=null;const W=new Promise(y=>setTimeout(y,300));try{let y,N;if(B.value)y=B.value.startUtc,N=B.value.endUtc;else{const b=H();y=b.weekStartUtc,N=b.weekEndUtc}const[Y,o]=await Promise.all([W,se({product:"1C",weekStartUtc:y,weekEndUtc:N,includeTickets:!0})]),{meta:a,data:g}=o;n.value=a,k.value=g,!B.value&&a&&(B.value={weekNumber:a.weekNumber,startUtc:a.weekStartUtc,endUtc:a.weekEndUtc})}catch(y){i.value=y instanceof Error?y:new Error("ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸"),console.error("[GraphAdmissionClosureDashboard] loadData error:",y)}finally{e.value=!1}}function r(W){O.value.stages=W}function w(W){O.value.employees=W}function h(W){O.value.dateRange=W}function l(W){O.value.customDateRange=W}function v(W){B.value=W}function U(){O.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},L()}function L(){d()}Oe(()=>{d()});function H(){const W=new Date,y=new Date(Date.UTC(W.getUTCFullYear(),W.getUTCMonth(),W.getUTCDate())),N=y.getUTCDay(),Y=y.getUTCDate()-N+(N===0?-6:1),o=new Date(Date.UTC(y.getUTCFullYear(),y.getUTCMonth(),Y,0,0,0)),a=new Date(o);return a.setUTCDate(a.getUTCDate()+6),a.setUTCHours(23,59,59,999),{weekStartUtc:o.toISOString(),weekEndUtc:a.toISOString()}}return(W,y)=>{var Y,o,a,g,b,A,I,p,V;const N=Ne("router-link");return c(),u("div",qa,[R(Z,{name:"fade",mode:"out-in"},{default:z(()=>[e.value?(c(),u("div",Ja,[...y[6]||(y[6]=[t("div",{class:"preloader-content"},[t("div",{class:"preloader-spinner"},[t("div",{class:"spinner-ring"}),t("div",{class:"spinner-ring"}),t("div",{class:"spinner-ring"})]),t("h3",{class:"preloader-title"},"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ°"),t("p",{class:"preloader-message"},"ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ·Ğ° 4 Ğ½ĞµĞ´ĞµĞ»Ğ¸..."),t("div",{class:"preloader-dots"},[t("span",{class:"dot"}),t("span",{class:"dot"}),t("span",{class:"dot"})])],-1)])])):(c(),u("div",Za,[t("div",Ka,[t("div",Xa,[t("div",Qa,[t("button",{class:"btn-back-link",type:"button",onClick:P,"aria-label":F.value,"aria-disabled":!S.value,"data-fallback":!S.value,disabled:T.value,title:"ĞĞ°Ğ·Ğ°Ğ´"}," â† ",8,er),t("nav",tr,[R(N,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:z(()=>[...y[7]||(y[7]=[re(" Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ ÑĞµĞºÑ‚Ğ¾Ñ€Ğ° 1Ğ¡ ",-1)])]),_:1}),y[9]||(y[9]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),R(N,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:z(()=>[...y[8]||(y[8]=[re(" Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ ",-1)])]),_:1}),y[10]||(y[10]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),y[11]||(y[11]=t("span",{class:"breadcrumb-current"},"Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ° Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¹",-1))])]),y[12]||(y[12]=t("h1",{class:"dashboard-title"},"Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ° Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¹ ÑĞµĞºÑ‚Ğ¾Ñ€Ğ° 1Ğ¡",-1)),y[13]||(y[13]=t("p",{class:"dashboard-subtitle"}," Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ñ‹ Ğ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ñ‹ Â«Ğ“Ñ€Ğ°Ñ„Ğ¸ĞºÑƒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ÑÂ», ÑĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€ ÑÑ‚Ğ°Ğ¿Ğ¾Ğ² ÑĞºÑ€Ñ‹Ñ‚. ",-1))])]),t("div",sr,[t("div",ar,[R(Me,{stages:O.value.stages,employees:O.value.employees,dateRange:O.value.dateRange,customDateRange:O.value.customDateRange,hasActiveFilters:x.value,hideStages:!0,weekPickerMode:!0,selectedWeek:B.value,weeksCount:52,"onUpdate:stages":r,"onUpdate:employees":w,"onUpdate:dateRange":h,"onUpdate:customDateRange":l,"onUpdate:selectedWeek":v,onReset:U,onApply:L},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","selectedWeek"])]),t("div",rr,[i.value?(c(),te(Re,{key:0,type:"error",title:"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸",message:i.value.message},null,8,["message"])):(c(),te(Tt,{key:1,meta:n.value,data:k.value,onOpenResponsible:y[0]||(y[0]=K=>E.value=!0),onOpenStages:y[1]||(y[1]=K=>m.value=!0),onOpenCarryover:y[2]||(y[2]=K=>_.value=!0)},null,8,["meta","data"]))])])]))]),_:1}),R(xs,{"is-visible":E.value,responsible:k.value.responsible||[],"closed-tickets-created-this-week":k.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":k.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":k.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":k.value.responsibleCreatedOtherWeek||[],"week-number":((Y=n.value)==null?void 0:Y.weekNumber)||null,"week-start-utc":((o=n.value)==null?void 0:o.weekStartUtc)||null,"week-end-utc":((a=n.value)==null?void 0:a.weekEndUtc)||null,onClose:y[3]||(y[3]=K=>E.value=!1)},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),R(Ta,{"is-visible":m.value,"week-number":((g=n.value)==null?void 0:g.weekNumber)||null,"week-start-utc":((b=n.value)==null?void 0:b.weekStartUtc)||null,"week-end-utc":((A=n.value)==null?void 0:A.weekEndUtc)||null,onClose:y[4]||(y[4]=K=>m.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"]),R(xa,{"is-visible":_.value,"week-number":((I=n.value)==null?void 0:I.weekNumber)||null,"week-start-utc":((p=n.value)==null?void 0:p.weekStartUtc)||null,"week-end-utc":((V=n.value)==null?void 0:V.weekEndUtc)||null,onClose:y[5]||(y[5]=K=>_.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"])])}}},ur=oe(lr,[["__scopeId","data-v-90264d1e"]]);export{ur as default};
