import{_ as N,r as S,c as T,a as r,b as i,d as f,t as l,n as B,o as a,w as x,s as q,e as E,F as D,f as C,g as O,u as Y,h as ce,i as de,j as I,k as R,T as U,l as K,m as Q,p as W,v as ge,q as ue,x as me,y as $,z as ee,A as te,B as X,C as ke,D as he,E as fe}from"./main-ZGXLZG87.js";import{g as ve,L as se,a as P,b as j,T as ye,D as z,n as _e,C as J,c as pe,i as Te}from"./index-DlvxMCs7.js";const be={name:"TicketCard",props:{ticket:{type:Object,required:!0},draggable:{type:Boolean,default:!0}},emits:["click","drag-start","drag-end"],setup(s,{emit:t}){const n=S(!1),e=T(()=>!1);return{getPriorityLabel:d=>({high:"–í—ã—Å–æ–∫–∏–π",medium:"–°—Ä–µ–¥–Ω–∏–π",low:"–ù–∏–∑–∫–∏–π"})[d]||d,getStatusLabel:d=>({in_progress:"–í —Ä–∞–±–æ—Ç–µ",new:"–ù–æ–≤—ã–π",done:"–í—ã–ø–æ–ª–Ω–µ–Ω–æ",pending:"–û–∂–∏–¥–∞–Ω–∏–µ"})[d]||d,handleDragStart:d=>{e.value&&(d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("application/json",JSON.stringify(s.ticket)),d.dataTransfer.setDragImage(d.target,0,0),n.value=!0,t("drag-start",s.ticket))},handleDragEnd:()=>{e.value&&(n.value=!1,t("drag-end"))},handleCardClick:d=>{if(n.value)return;const k=ve(s.ticket.id),v=g=>{try{if(g&&g.BX&&g.BX.SidePanel&&g.BX.SidePanel.Instance)return g.BX.SidePanel.Instance.open(k,{cacheable:!1,allowChangeHistory:!1,width:1200}),!0}catch(h){console.warn("SidePanel open failed in context:",h)}return!1};try{if(window.parent&&window.parent!==window){if(v(window.parent)){t("click",s.ticket);return}if(window.top&&window.top!==window.parent&&window.top!==window&&v(window.top)){t("click",s.ticket);return}window.parent.location.href=k,t("click",s.ticket);return}}catch(g){console.warn("Parent window navigation failed:",g)}v(window)||(typeof BX<"u"&&BX.helper?BX.helper.show(k,{width:1200,height:800}):window.open(k,"_blank")),t("click",s.ticket)},isDragEnabled:e}}},Se=["draggable"],De={class:"ticket-header"},Ce={class:"ticket-id"},we={class:"ticket-title"},Ie={class:"ticket-meta"},Ee={class:"ticket-status"},Ae={key:0,class:"ticket-description"};function Ne(s,t,n,e,m,p){return a(),r("div",{class:B(["ticket-card",{"priority-high":n.ticket.priority==="high","priority-medium":n.ticket.priority==="medium","priority-low":n.ticket.priority==="low"}]),draggable:e.isDragEnabled,onClick:t[0]||(t[0]=(...o)=>e.handleCardClick&&e.handleCardClick(...o)),onDragstart:t[1]||(t[1]=(...o)=>e.handleDragStart&&e.handleDragStart(...o)),onDragend:t[2]||(t[2]=(...o)=>e.handleDragEnd&&e.handleDragEnd(...o))},[i("div",De,[t[3]||(t[3]=i("span",{class:"ticket-icon"},"üé´",-1)),i("span",Ce,"#"+l(n.ticket.id),1)]),i("div",we,l(n.ticket.ufSubject||n.ticket.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),i("div",Ie,[i("span",{class:B(["ticket-priority",`priority-${n.ticket.priority}`])},l(e.getPriorityLabel(n.ticket.priority)),3),i("span",Ee,l(e.getStatusLabel(n.ticket.status)),1)]),n.ticket.description?(a(),r("div",Ae,l(n.ticket.description),1)):f("",!0)],42,Se)}const ie=N(be,[["render",Ne],["__scopeId","data-v-ef1211a2"]]),Oe={name:"ZeroPoint",components:{TicketCard:ie},props:{tickets:{type:Array,required:!0,default:()=>[]},stageId:{type:String,required:!0}},emits:{"ticket-dragged":s=>typeof s=="object"&&s!==null,"ticket-assigned":s=>typeof s=="object"&&s!==null,"ticket-clicked":s=>typeof s=="object"&&s!==null},setup(s,{emit:t}){return{hasTickets:T(()=>Array.isArray(s.tickets)&&s.tickets.length>0),handleTicketDragStart:m=>{t("ticket-dragged",m)}}}},Be={class:"zero-point"},Le={key:0,class:"empty-state"};function Pe(s,t,n,e,m,p){const o=E("TicketCard");return a(),r("div",Be,[t[3]||(t[3]=i("div",{class:"zero-point-header"},[i("h3",null,"–ù—É–ª–µ–≤–∞—è —Ç–æ—á–∫–∞")],-1)),x([n.tickets.length,n.tickets.map(c=>c.id).join(",")],()=>(a(),r("div",{class:"zero-point-tickets"},[(a(!0),r(D,null,C(n.tickets,c=>(a(),O(o,{key:c.id,ticket:c,draggable:!0,onDragStart:u=>e.handleTicketDragStart(c),onClick:u=>s.$emit("ticket-clicked",c)},null,8,["ticket","onDragStart","onClick"]))),128))])),t,0),t[1]||(q(-1,!0),(t[1]=e.hasTickets?f("",!0):(a(),r("div",Le,[...t[2]||(t[2]=[i("p",null,"–ù–µ—Ç –Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –≤ —Å—Ç–∞–¥–∏–∏",-1)])]))).cacheIndex=1,q(1),t[1])])}const Re=N(Oe,[["render",Pe],["__scopeId","data-v-c5370e55"]]);function xe(s){return typeof s=="number"&&s>0&&!isNaN(s)}function ne(s){return typeof s=="number"&&s>0&&!isNaN(s)}function oe(s){return typeof s=="string"&&["formed","review","execution"].includes(s)}function je(s){return!s||typeof s!="object"?!1:xe(s.id)&&typeof s.title=="string"&&s.title.trim().length>0}function ae(s,t,n){return!(!je(s)||!ne(t)||!oe(n)||s.assigneeId===t&&s.stageId===n)}function Ue(s){const t=[];return!s||typeof s!="object"?(t.push("–î–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{valid:!1,errors:t}):((!s.title||typeof s.title!="string"||s.title.trim().length===0)&&t.push("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"),s.stageId&&!oe(s.stageId)&&t.push("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Å—Ç–∞–¥–∏–∏"),s.employeeId&&!ne(s.employeeId)&&t.push("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"),{valid:t.length===0,errors:t})}function ze(s){const t=Y(),n=S(!1);return{isDropZoneActive:n,handleDragStart:(u,d)=>{u.dataTransfer.effectAllowed="move",u.dataTransfer.setData("application/json",JSON.stringify(d)),u.dataTransfer.setDragImage(u.target,0,0)},handleDragOver:u=>{u.preventDefault(),u.dataTransfer.dropEffect="move",n.value=!0},handleDragLeave:u=>{const d=u.currentTarget.getBoundingClientRect(),k=u.clientX,v=u.clientY;(k<d.left||k>d.right||v<d.top||v>d.bottom)&&(n.value=!1)},handleDrop:async(u,d,k)=>{u.preventDefault(),n.value=!1;const v=u.dataTransfer.getData("application/json");if(v)try{const g=JSON.parse(v);if(!ae(g,d,k)){t.warning("–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–∫–µ—Ç —Å—é–¥–∞");return}s&&typeof s=="function"&&await s(g,d,k)}catch(g){se.error("Error parsing ticket data","useDragAndDrop",g),t.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ç–∞")}},handleDragEnd:u=>{n.value=!1}}}function re(s=null){var d,k;const t=ce(),n=((d=t==null?void 0:t.type)==null?void 0:d.name)||((k=t==null?void 0:t.type)==null?void 0:k.__name)||null,e=s||n||"Unknown",m=(v,g,h=null)=>{se.log(v,g,e,h)};return{error:(v,g=null)=>{m("ERROR",v,g)},warn:(v,g=null)=>{m("WARN",v,g)},info:(v,g=null)=>{m("INFO",v,g)},debug:(v,g=null)=>{m("DEBUG",v,g)},log:m,context:e}}const Fe={name:"EmployeeColumn",components:{TicketCard:ie},props:{employee:{type:Object,required:!0},stageId:{type:String,required:!0}},emits:["ticket-clicked","ticket-dropped"],setup(s,{emit:t}){re("EmployeeColumn");const e=ze(async(k,v,g)=>{t("ticket-dropped",k,v)}),m=T(()=>s.employee.isFromSector1C?Array.isArray(s.employee.tickets)?s.employee.tickets:[]:Array.isArray(s.employee.ticketsInsideSector)?s.employee.ticketsInsideSector:[]),p=T(()=>s.employee.isFromSector1C?[]:Array.isArray(s.employee.ticketsOutsideSector)?s.employee.ticketsOutsideSector:Array.isArray(s.employee.tickets)?s.employee.tickets:[]),o=T(()=>s.employee.isFromSector1C?Array.isArray(s.employee.tickets)?s.employee.tickets:[]:[]),c=T(()=>m.value.length+p.value.length),u=k=>{e.handleDrop(k,s.employee.id,s.stageId)},d=k=>{};return{isDropZoneActive:e.isDropZoneActive,handleDragOver:e.handleDragOver,handleDragLeave:e.handleDragLeave,handleDrop:u,ticketsInsideSector:m,ticketsOutsideSector:p,ticketsToDisplay:o,totalTicketsCount:c,handleTicketDragStart:d}}},Me={class:"employee-header"},Ve={class:"employee-info"},qe={class:"employee-details"},We={class:"employee-name"},Xe={key:0,class:"employee-position"},Je={class:"tickets-count"},He={class:"tickets-list"},Ge={class:"section-header"},Ze={class:"section-count"},Ye={key:2,class:"empty-state"};function Ke(s,t,n,e,m,p){const o=E("TicketCard");return a(),r("div",{class:B(["employee-column",{"drop-zone-active":e.isDropZoneActive}]),onDragover:t[3]||(t[3]=de((...c)=>e.handleDragOver&&e.handleDragOver(...c),["prevent"])),onDragleave:t[4]||(t[4]=(...c)=>e.handleDragLeave&&e.handleDragLeave(...c)),onDrop:t[5]||(t[5]=(...c)=>e.handleDrop&&e.handleDrop(...c))},[i("div",Me,[i("div",Ve,[t[6]||(t[6]=i("span",{class:"employee-icon"},"üë§",-1)),i("div",qe,[i("div",We,l(n.employee.name),1),n.employee.position?(a(),r("div",Xe,l(n.employee.position),1)):f("",!0)])]),i("div",Je," üìä –¢–∏–∫–µ—Ç–æ–≤: "+l(e.totalTicketsCount),1)]),i("div",He,[n.employee.isFromSector1C?x([e.ticketsToDisplay.length,e.ticketsToDisplay.map(c=>c.id).join(",")],()=>(a(),r("div",{key:0},[I(U,{name:"ticket",tag:"div"},{default:R(()=>[(a(!0),r(D,null,C(e.ticketsToDisplay,c=>(a(),O(o,{key:c.id,ticket:c,draggable:!0,onClick:u=>s.$emit("ticket-clicked",c),onDragStart:e.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),t,0):(a(),r(D,{key:1},[e.ticketsInsideSector.length>0?x([e.ticketsInsideSector.length,e.ticketsInsideSector.map(c=>c.id).join(",")],()=>(a(),r("div",{key:0,class:"tickets-section tickets-inside-sector"},[I(U,{name:"ticket",tag:"div"},{default:R(()=>[(a(!0),r(D,null,C(e.ticketsInsideSector,c=>(a(),O(o,{key:c.id,ticket:c,draggable:!0,onClick:u=>s.$emit("ticket-clicked",c),onDragStart:e.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),t,1):f("",!0),e.ticketsOutsideSector.length>0?x([e.ticketsOutsideSector.length,e.ticketsOutsideSector.map(c=>c.id).join(",")],()=>(a(),r("div",{key:1,class:"tickets-section tickets-outside-sector"},[i("div",Ge,[t[7]||(t[7]=i("span",{class:"section-badge"},"–í–Ω–µ —Å–µ–∫—Ç–æ—Ä–∞",-1)),i("span",Ze,l(e.ticketsOutsideSector.length),1)]),I(U,{name:"ticket",tag:"div"},{default:R(()=>[(a(!0),r(D,null,C(e.ticketsOutsideSector,c=>(a(),O(o,{key:c.id,ticket:c,draggable:!0,class:"ticket-outside-sector",onClick:u=>s.$emit("ticket-clicked",c),onDragStart:e.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),t,2):f("",!0)],64)),e.totalTicketsCount===0?(a(),r("div",Ye,[...t[8]||(t[8]=[i("p",null,"–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤",-1)])])):f("",!0)])],34)}const Qe=N(Fe,[["render",Ke],["__scopeId","data-v-cdec5b5c"]]),$e={name:"DashboardStage",components:{ZeroPoint:Re,EmployeeColumn:Qe},props:{stage:{type:Object,required:!0},zeroPointTickets:{type:Array,default:()=>[]}},emits:["ticket-moved","ticket-assigned","ticket-clicked"],setup(s,{emit:t}){const n=re("DashboardStage"),e=S(!1),m=T(()=>{const g=Array.isArray(s.zeroPointTickets)?s.zeroPointTickets.length:0,h=Array.isArray(s.stage.employees)?s.stage.employees.reduce((_,y)=>Array.isArray(y.ticketsInsideSector)?_+y.ticketsInsideSector.length:y.isFromSector1C&&Array.isArray(y.tickets)?_+y.tickets.length:_,0):0;return g+h}),p=T(()=>Array.isArray(s.stage.employees)?s.stage.employees.reduce((g,h)=>Array.isArray(h.ticketsOutsideSector)?g+h.ticketsOutsideSector.length:!h.isFromSector1C&&Array.isArray(h.tickets)?g+h.tickets.length:g,0):0),o=T(()=>m.value+p.value),c=T(()=>{var y;const g=((y=s.stage)==null?void 0:y.name)||"–°—Ç–∞–¥–∏—è",h=m.value,_=p.value;return _===0?`${g} (${h})`:`${g} (${h} / ${_})`});return{isDragging:e,ticketsCountInsideSector:m,ticketsCountOutsideSector:p,totalTicketsCount:o,stageNameWithCount:c,handleTicketDragged:g=>{e.value=!0},handleTicketAssigned:(g,h)=>{t("ticket-assigned",g,h)},handleTicketDropped:(g,h)=>{t("ticket-moved",g,h,s.stage.id),e.value=!1},handleTicketClicked:g=>{n.debug("Ticket clicked",g),t("ticket-clicked",g)}}}},et={class:"stage-header"},tt={class:"stage-content"},st={class:"employees-container"};function it(s,t,n,e,m,p){const o=E("ZeroPoint"),c=E("EmployeeColumn");return a(),r("div",{class:"dashboard-stage",style:K({borderLeftColor:n.stage.color})},[i("div",et,[i("h2",null,l(e.stageNameWithCount),1)]),i("div",tt,[I(o,{tickets:n.zeroPointTickets,"stage-id":n.stage.id,onTicketDragged:e.handleTicketDragged,onTicketAssigned:e.handleTicketAssigned,onTicketClicked:e.handleTicketClicked},null,8,["tickets","stage-id","onTicketDragged","onTicketAssigned","onTicketClicked"]),i("div",st,[(a(!0),r(D,null,C(n.stage.employees,u=>(a(),O(c,{key:u.id,employee:u,"stage-id":n.stage.id,onTicketClicked:e.handleTicketClicked,onTicketDropped:e.handleTicketDropped},null,8,["employee","stage-id","onTicketClicked","onTicketDropped"]))),128))])])],4)}const nt=N($e,[["render",it],["__scopeId","data-v-c6fbde76"]]),F={cache_check:{title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞",description:"–ü–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."},cache_hit:{title:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",description:"–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞..."},loading_tickets:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24..."},filtering:{title:"–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤",description:"–û—Ç–±–æ—Ä —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°..."},extracting_employees:{title:"–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ê–Ω–∞–ª–∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."},loading_employees:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö..."},grouping:{title:"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",description:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º..."},caching:{title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à",description:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."},complete:{title:"–ì–æ—Ç–æ–≤–æ!",description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"},error:{title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}},ot={loading_tickets:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24..."},filtering:{title:"–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤",description:"–û—Ç–±–æ—Ä —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°..."},extracting_employees:{title:"–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ê–Ω–∞–ª–∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."},loading_employees:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö..."},grouping:{title:"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",description:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º..."},caching:{title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à",description:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."},cache_check:{title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞",description:"–ü–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."},cache_hit:{title:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",description:"–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞..."},complete:{title:"–ì–æ—Ç–æ–≤–æ!",description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"},error:{title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}},at={name:"LoadingPreloader",props:{currentStep:{type:String,default:null},progress:{type:Number,default:0},stepDetails:{type:Object,default:()=>({})},error:{type:String,default:null}},emits:["retry"],setup(s,{emit:t}){const n=T(()=>{var v;const{currentStep:d,stepDetails:k}=s;return k!=null&&k.description?{title:d?((v=F[d])==null?void 0:v.title)||d:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:k.description}:d?F[d]?F[d]:ot[d]||{title:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ..."}:{title:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è..."}}),e=T(()=>n.value.title),m=T(()=>n.value.description),p=T(()=>s.stepDetails),o=T(()=>{const d=s.progress;return d==null||isNaN(d)?0:Math.round(Math.max(0,Math.min(100,d)))});return{stepTitle:e,stepDescription:m,details:p,displayProgress:o,getStageDisplayName:d=>d?{"DT140_12:UC_0VHWE2":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","DT140_12:PREPARATION":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó","DT140_12:CLIENT":"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ","–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"}[d]||d:"",handleRetry:()=>{t("retry")}}}},rt={class:"preloader-backdrop"},lt={class:"preloader-container"},ct={class:"preloader-content-scrollable"},dt={key:0,class:"spinner-container"},gt={class:"preloader-content"},ut={class:"step-title"},mt={key:0,class:"step-description"},kt={key:1,class:"progress-container"},ht={class:"progress-bar"},ft={class:"progress-text"},vt={key:2,class:"step-details"},yt={key:0,class:"detail-description"},_t={key:1,class:"detail-item"},pt={class:"detail-value"},Tt={key:0,class:"detail-total"},bt={key:2,class:"detail-item"},St={class:"detail-value"},Dt={key:0,class:"detail-total"},Ct={key:3,class:"detail-item"},wt={class:"detail-value"},It={key:0,class:"detail-total"},Et={key:4,class:"detail-item"},At={class:"detail-value"},Nt={key:5,class:"detail-warning"},Ot={key:0,class:"error-container"},Bt={class:"error-content"},Lt={class:"error-message"};function Pt(s,t,n,e,m,p){return a(),r("div",{class:B(["loading-preloader",{"has-error":n.error}])},[i("div",rt,[i("div",lt,[i("div",ct,[n.error?f("",!0):(a(),r("div",dt,[...t[1]||(t[1]=[i("div",{class:"spinner"},null,-1)])])),i("div",gt,[i("h3",ut,l(e.stepTitle),1),e.stepDescription?(a(),r("p",mt,l(e.stepDescription),1)):f("",!0),n.error?f("",!0):(a(),r("div",kt,[i("div",ht,[i("div",{class:"progress-fill",style:K({width:e.displayProgress+"%"})},null,4)]),i("span",ft,l(e.displayProgress)+"%",1)])),n.error?f("",!0):(a(),r("div",vt,[e.details.description?(a(),r("div",yt,l(e.details.description),1)):f("",!0),e.details.count!==void 0?(a(),r("div",_t,[t[2]||(t[2]=i("span",{class:"detail-label"},"–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–∏–∫–µ—Ç–æ–≤:",-1)),i("span",pt,l(e.details.count),1),e.details.total!==void 0?(a(),r("span",Tt," –∏–∑ "+l(e.details.total),1)):f("",!0)])):f("",!0),e.details.filteredTickets!==void 0?(a(),r("div",bt,[t[3]||(t[3]=i("span",{class:"detail-label"},"–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∏–∫–µ—Ç–æ–≤:",-1)),i("span",St,l(e.details.filteredTickets),1),e.details.totalTickets!==void 0?(a(),r("span",Dt," –∏–∑ "+l(e.details.totalTickets),1)):f("",!0)])):f("",!0),e.details.stage?(a(),r("div",Ct,[t[4]||(t[4]=i("span",{class:"detail-label"},"–°—Ç–∞–¥–∏—è:",-1)),i("span",wt,l(e.getStageDisplayName(e.details.stage)),1),e.details.stageIndex&&e.details.totalStages?(a(),r("span",It," ("+l(e.details.stageIndex)+"/"+l(e.details.totalStages)+") ",1)):f("",!0)])):f("",!0),e.details.employeeCount!==void 0?(a(),r("div",Et,[t[5]||(t[5]=i("span",{class:"detail-label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",-1)),i("span",At,l(e.details.employeeCount),1)])):f("",!0),e.details.warning?(a(),r("div",Nt,[i("span",null,"‚ö†Ô∏è "+l(e.details.warning),1)])):f("",!0)]))])])])]),n.error?(a(),r("div",Ot,[i("div",Bt,[t[6]||(t[6]=i("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),i("p",Lt,l(n.error),1),i("button",{onClick:t[0]||(t[0]=(...o)=>e.handleRetry&&e.handleRetry(...o)),class:"retry-button"}," –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É ")])])):f("",!0)],2)}const Rt=N(at,[["render",Pt],["__scopeId","data-v-d129ff19"]]),xt={name:"LoggerControl",props:{showControl:{type:Boolean,default:!1}},setup(){const s=S(!1),t=S("ERROR"),n=S(!0),e=u=>({NONE:"–û—Ç–∫–ª—é—á–µ–Ω–æ",ERROR:"–¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏",WARN:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏",INFO:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏",DEBUG:"–í—Å–µ –ª–æ–≥–∏ (–æ—Ç–ª–∞–¥–∫–∞)"})[u]||u;return Q(()=>{const u=P.getLevel();t.value=u,s.value=u!=="NONE"}),{enabled:s,level:t,isExpanded:n,getLevelDescription:e,handleToggle:()=>{s.value?(t.value==="NONE"&&(t.value="ERROR"),P.setLevel(t.value)):(P.setLevel("NONE"),t.value="NONE")},handleLevelChange:()=>{s.value&&P.setLevel(t.value)},resetToDefault:()=>{const u="ERROR";t.value=u,s.value=!0,P.setLevel(u)},toggleVisibility:()=>{n.value=!n.value}}}},jt={key:0,class:"logger-control"},Ut={class:"logger-control-header"},zt=["aria-label"],Ft={key:0,class:"logger-control-content"},Mt={class:"logger-control-section"},Vt={class:"logger-control-label"},qt={key:0,class:"logger-control-section"},Wt={class:"logger-control-label"},Xt={key:1,class:"logger-control-info"},Jt={class:"logger-control-info-text"},Ht={key:2,class:"logger-control-section"};function Gt(s,t,n,e,m,p){return n.showControl?(a(),r("div",jt,[i("div",Ut,[t[6]||(t[6]=i("h3",{class:"logger-control-title"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º",-1)),i("button",{class:"logger-control-toggle",onClick:t[0]||(t[0]=(...o)=>e.toggleVisibility&&e.toggleVisibility(...o)),"aria-label":e.isExpanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"},l(e.isExpanded?"‚ñº":"‚ñ∂"),9,zt)]),e.isExpanded?(a(),r("div",Ft,[i("div",Mt,[i("label",Vt,[W(i("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=o=>e.enabled=o),onChange:t[2]||(t[2]=(...o)=>e.handleToggle&&e.handleToggle(...o)),class:"logger-control-checkbox"},null,544),[[ge,e.enabled]]),t[7]||(t[7]=i("span",{class:"logger-control-label-text"},"–í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ",-1))])]),e.enabled?(a(),r("div",qt,[i("label",Wt,[t[9]||(t[9]=i("span",{class:"logger-control-label-text"},"–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:",-1)),W(i("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>e.level=o),onChange:t[4]||(t[4]=(...o)=>e.handleLevelChange&&e.handleLevelChange(...o)),class:"logger-control-select"},[...t[8]||(t[8]=[me('<option value="NONE" data-v-ed57067c>–û—Ç–∫–ª—é—á–µ–Ω–æ</option><option value="ERROR" data-v-ed57067c>–¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏</option><option value="WARN" data-v-ed57067c>–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏</option><option value="INFO" data-v-ed57067c>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏</option><option value="DEBUG" data-v-ed57067c>–í—Å–µ –ª–æ–≥–∏ (–æ—Ç–ª–∞–¥–∫–∞)</option>',5)])],544),[[ue,e.level]])])])):f("",!0),e.enabled?(a(),r("div",Xt,[i("span",Jt,[t[10]||(t[10]=$(" –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: ",-1)),i("strong",null,l(e.getLevelDescription(e.level)),1)])])):f("",!0),e.enabled?(a(),r("div",Ht,[i("button",{onClick:t[5]||(t[5]=(...o)=>e.resetToDefault&&e.resetToDefault(...o)),class:"logger-control-reset-btn",title:"–°–±—Ä–æ—Å–∏—Ç—å –∫ –∑–Ω–∞—á–µ–Ω–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"}," –°–±—Ä–æ—Å–∏—Ç—å –∫ —É–º–æ–ª—á–∞–Ω–∏—é ")])):f("",!0)])):f("",!0)])):f("",!0)}const Zt=N(xt,[["render",Gt],["__scopeId","data-v-ed57067c"]]);function Yt(){const s=ee(),t=te();return{goBack:(o="/")=>{window.history.length>1?s.back():s.push(o)},goTo:(o,c={})=>{s.push({path:o,...c})},goHome:(o={})=>{s.push({path:"/",...o})},isCurrentRoute:o=>t.path===o,router:s,route:t}}const Kt={name:"BackButton",props:{variant:{type:String,default:"header",validator:s=>["header","floating"].includes(s)},text:{type:String,default:"–ù–ê–ó–ê–î"},to:{type:String,default:null},showIcon:{type:Boolean,default:!0},ariaLabel:{type:String,default:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"},title:{type:String,default:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"}},setup(s){const{goBack:t,goHome:n}=Yt();return{buttonClasses:T(()=>[s.variant==="header"?"back-button":"floating-back-button"]),handleClick:()=>{s.to?n({path:s.to}):t()}}}},Qt=["aria-label","title"],$t={key:0,class:"back-button-icon"},es={key:1,class:"back-button-text"};function ts(s,t,n,e,m,p){return a(),r("button",{class:B(e.buttonClasses),onClick:t[0]||(t[0]=(...o)=>e.handleClick&&e.handleClick(...o)),"aria-label":n.ariaLabel,title:n.title},[n.showIcon?(a(),r("span",$t,"‚Üê")):f("",!0),n.variant==="header"?(a(),r("span",es,l(n.text),1)):f("",!0)],10,Qt)}const ss=N(Kt,[["render",ts],["__scopeId","data-v-d605b6a0"]]),is={name:"DiagnosticsPanel",props:{isEnabled:{type:Boolean,default:!1},isUserAdmin:{type:Boolean,default:!1}},setup(s){const t=S(!0),n=j(),e=T(()=>!s.isEnabled||!s.isUserAdmin?{ticketsLoading:{stages:{},totalLoaded:0},filtering:{total:0,filtered:0,rejected:[],tagValueExamples:[]},employees:{uniqueIds:[],totalUnique:0,ticketsWithoutAssignedById:[],ticketsWithAssignedById1051:[]},grouping:{distributionByStages:{},ticketsNotInColumn:[],unknownStages:[]},zeroPoint:{byStage:{}}}:n?n.getMetrics():(console.warn("[DiagnosticsPanel] Diagnostics service not available"),{ticketsLoading:{stages:{},totalLoaded:0},filtering:{total:0,filtered:0,rejected:[],tagValueExamples:[]},employees:{uniqueIds:[],totalUnique:0,ticketsWithoutAssignedById:[],ticketsWithAssignedById1051:[]},grouping:{distributionByStages:{},ticketsNotInColumn:[],unknownStages:[]},zeroPoint:{byStage:{}}})),m=T(()=>!s.isEnabled||!s.isUserAdmin||!n?{withoutAssignedById:[],withAssignedById1051:[],withoutSectorTag:[],notInColumn:[],unknownStage:[]}:n.getProblematicTickets()),p=T(()=>{const d=m.value;return d.withoutAssignedById.length===0&&d.withAssignedById1051.length===0&&d.withoutSectorTag.length===0&&d.notInColumn.length===0&&d.unknownStage.length===0});return{isExpanded:t,metrics:e,problematicTickets:m,hasNoProblems:p,toggleExpanded:()=>{t.value=!t.value},downloadJSON:()=>{if(!n)return;const d=n.exportToJSON(),k=new Blob([d],{type:"application/json"}),v=URL.createObjectURL(k),g=document.createElement("a");g.href=v,g.download=`dashboard-diagnostics-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(v)},getStageName:d=>ye.getStageName(d)||d}}},ns={key:0,class:"diagnostics-panel"},os={class:"diagnostics-header"},as={class:"header-actions"},rs=["title"],ls={key:0,class:"diagnostics-content"},cs={class:"diagnostics-section"},ds={class:"metrics-grid"},gs={class:"metric-card"},us={class:"metric-value"},ms={class:"metric-label"},ks={class:"metric-value"},hs={class:"metric-detail"},fs={class:"diagnostics-section"},vs={class:"metrics-grid"},ys={class:"metric-card"},_s={class:"metric-value"},ps={class:"metric-card",style:{"border-left-color":"#28a745"}},Ts={class:"metric-value"},bs={class:"metric-card",style:{"border-left-color":"#dc3545"}},Ss={class:"metric-value"},Ds={key:0,class:"metric-detail"},Cs={key:0,class:"warning-box"},ws={key:1,class:"examples-box"},Is={class:"example-type"},Es={key:0,class:"normalized"},As={class:"diagnostics-section"},Ns={class:"metrics-grid"},Os={class:"metric-card"},Bs={class:"metric-value"},Ls={class:"metric-card"},Ps={class:"metric-value"},Rs={class:"metric-card"},xs={class:"metric-value"},js={class:"diagnostics-section"},Us={class:"metrics-grid"},zs={class:"metric-card"},Fs={class:"metric-value"},Ms={class:"metric-card",style:{"border-left-color":"#28a745"}},Vs={class:"metric-value"},qs={class:"metric-card",style:{"border-left-color":"#ffc107"}},Ws={class:"metric-value"},Xs={key:0,class:"employees-list"},Js={class:"diagnostics-section"},Hs={class:"metrics-grid"},Gs={class:"metric-label"},Zs={class:"metric-value"},Ys={class:"diagnostics-section problematic-tickets"},Ks={key:0,class:"problem-group"},Qs={class:"tickets-list"},$s={class:"ticket-id"},ei={class:"ticket-title"},ti={class:"ticket-stage"},si={key:0,class:"more-items"},ii={key:1,class:"problem-group"},ni={class:"tickets-list"},oi={class:"ticket-id"},ai={class:"ticket-title"},ri={class:"ticket-stage"},li={key:0,class:"more-items"},ci={key:2,class:"problem-group"},di={class:"tickets-list"},gi={class:"ticket-id"},ui={class:"ticket-title"},mi={class:"ticket-stage"},ki={key:0,class:"more-items"},hi={key:3,class:"problem-group"},fi={class:"tickets-list"},vi={class:"ticket-id"},yi={class:"ticket-title"},_i={class:"ticket-stage"},pi={key:0,class:"more-items"},Ti={key:4,class:"problem-group"},bi={class:"tickets-list"},Si={class:"ticket-id"},Di={class:"ticket-title"},Ci={class:"ticket-stage"},wi={key:0,class:"more-items"},Ii={key:5,class:"no-problems"};function Ei(s,t,n,e,m,p){return n.isEnabled&&n.isUserAdmin?(a(),r("div",ns,[i("div",os,[t[2]||(t[2]=i("h2",null,"üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞",-1)),i("div",as,[i("button",{onClick:t[0]||(t[0]=(...o)=>e.downloadJSON&&e.downloadJSON(...o)),class:"btn-download",title:"–°–∫–∞—á–∞—Ç—å JSON"}," üì• –°–∫–∞—á–∞—Ç—å JSON "),i("button",{onClick:t[1]||(t[1]=(...o)=>e.toggleExpanded&&e.toggleExpanded(...o)),class:"btn-toggle",title:e.isExpanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"},l(e.isExpanded?"‚ñº":"‚ñ∂"),9,rs)])]),e.isExpanded?(a(),r("div",ls,[i("section",cs,[t[4]||(t[4]=i("h3",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",-1)),i("div",ds,[i("div",gs,[t[3]||(t[3]=i("div",{class:"metric-label"},"–í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ",-1)),i("div",us,l(e.metrics.ticketsLoading.totalLoaded),1)]),(a(!0),r(D,null,C(e.metrics.ticketsLoading.stages,(o,c)=>(a(),r("div",{key:c,class:"metric-card"},[i("div",ms,l(e.getStageName(c)),1),i("div",ks,l(o.total),1),i("div",hs,"–ë–∞—Ç—á–µ–π: "+l(o.batches.length),1)]))),128))])]),i("section",fs,[t[10]||(t[10]=i("h3",null,"üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ç–æ—Ä—É 1–°",-1)),i("div",vs,[i("div",ys,[t[5]||(t[5]=i("div",{class:"metric-label"},"–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ",-1)),i("div",_s,l(e.metrics.filtering.total),1)]),i("div",ps,[t[6]||(t[6]=i("div",{class:"metric-label"},"–ü—Ä–æ—à–ª–æ —Ñ–∏–ª—å—Ç—Ä (—Ç–µ–≥ 1–°)",-1)),i("div",Ts,l(e.metrics.filtering.filtered),1)]),i("div",bs,[t[7]||(t[7]=i("div",{class:"metric-label"},"–û—Ç–∫–ª–æ–Ω–µ–Ω–æ (–Ω–µ—Ç —Ç–µ–≥–∞ 1–°)",-1)),i("div",Ss,l(e.metrics.filtering.rejected.length),1),e.metrics.filtering.total>0?(a(),r("div",Ds,l(Math.round(e.metrics.filtering.rejected.length/e.metrics.filtering.total*100))+"% –æ—Ç –≤—Å–µ—Ö ",1)):f("",!0)])]),e.metrics.filtering.rejected.length>0?(a(),r("div",Cs,[t[8]||(t[8]=i("strong",null,"‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:",-1)),$(" "+l(e.metrics.filtering.rejected.length)+" —Ç–∏–∫–µ—Ç–æ–≤ –Ω–µ –∏–º–µ—é—Ç —Ç–µ–≥–∞ —Å–µ–∫—Ç–æ—Ä–∞ 1–° (UF_CRM_7_TYPE_PRODUCT = '1C') –∏ –ø–æ—ç—Ç–æ–º—É –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –¥–∞—à–±–æ—Ä–¥–µ. –≠—Ç–∏ —Ç–∏–∫–µ—Ç—ã –µ—Å—Ç—å –≤ Bitrix24, –Ω–æ –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. ",1)])):f("",!0),e.metrics.filtering.tagValueExamples.length>0?(a(),r("div",ws,[t[9]||(t[9]=i("h4",null,"–ü—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π UF_CRM_7_TYPE_PRODUCT:",-1)),i("ul",null,[(a(!0),r(D,null,C(e.metrics.filtering.tagValueExamples.slice(0,10),(o,c)=>(a(),r("li",{key:c},[i("code",null,l(JSON.stringify(o.value)),1),i("span",Is,"("+l(o.type)+l(o.isArray?", –º–∞—Å—Å–∏–≤":"")+")",1),o.normalized&&o.normalized.length?(a(),r("span",Es," ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ: "+l(o.normalized.join(", ")),1)):f("",!0)]))),128))])])):f("",!0)]),i("section",As,[t[14]||(t[14]=i("h3",null,"üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏",-1)),i("div",Ns,[i("div",Os,[t[11]||(t[11]=i("div",{class:"metric-label"},"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID",-1)),i("div",Bs,l(e.metrics.employees.totalUnique),1)]),i("div",Ls,[t[12]||(t[12]=i("div",{class:"metric-label"},"–ë–µ–∑ assignedById",-1)),i("div",Ps,l(e.metrics.employees.ticketsWithoutAssignedById.length),1)]),i("div",Rs,[t[13]||(t[13]=i("div",{class:"metric-label"},"–° assignedById=1051",-1)),i("div",xs,l(e.metrics.employees.ticketsWithAssignedById1051.length),1)])])]),i("section",js,[t[18]||(t[18]=i("h3",null,"üì¶ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),(a(!0),r(D,null,C(e.metrics.grouping.distributionByStages,(o,c)=>(a(),r("div",{key:c,class:"stage-distribution"},[i("h4",null,l(e.getStageName(c)),1),i("div",Us,[i("div",zs,[t[15]||(t[15]=i("div",{class:"metric-label"},"–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤ –≤ —Å—Ç–∞–¥–∏–∏",-1)),i("div",Fs,l(o.total||0),1)]),i("div",Ms,[t[16]||(t[16]=i("div",{class:"metric-label"},"–í–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),i("div",Vs,l(o.insideSector||0),1)]),i("div",qs,[t[17]||(t[17]=i("div",{class:"metric-label"},"–í–Ω–µ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),i("div",Ws,l(o.outsideSector||0),1)])]),Object.keys(o.employees||{}).length>0?(a(),r("div",Xs,[(a(!0),r(D,null,C(o.employees,(u,d)=>(a(),r("div",{key:d,class:"employee-item"}," –°–æ—Ç—Ä—É–¥–Ω–∏–∫ #"+l(d)+": "+l(u)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1))),128))])):f("",!0)]))),128))]),i("section",Js,[t[19]||(t[19]=i("h3",null,"üéØ –ù—É–ª–µ–≤–∞—è —Ç–æ—á–∫–∞",-1)),i("div",Hs,[(a(!0),r(D,null,C(e.metrics.zeroPoint.byStage,(o,c)=>(a(),r("div",{key:c,class:"metric-card"},[i("div",Gs,l(e.getStageName(c)),1),i("div",Zs,l(o),1)]))),128))])]),i("section",Ys,[t[20]||(t[20]=i("h3",null,"‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),e.problematicTickets.withoutAssignedById.length>0?(a(),r("div",Ks,[i("h4",null,"–ë–µ–∑ assignedById ("+l(e.problematicTickets.withoutAssignedById.length)+")",1),i("div",Qs,[(a(!0),r(D,null,C(e.problematicTickets.withoutAssignedById.slice(0,10),o=>(a(),r("div",{key:o.id,class:"ticket-item"},[i("span",$s,"#"+l(o.id),1),i("span",ei,l(o.title),1),i("span",ti,l(e.getStageName(o.stageId)),1)]))),128)),e.problematicTickets.withoutAssignedById.length>10?(a(),r("div",si," ... –∏ –µ—â—ë "+l(e.problematicTickets.withoutAssignedById.length-10),1)):f("",!0)])])):f("",!0),e.problematicTickets.withAssignedById1051.length>0?(a(),r("div",ii,[i("h4",null,"–° assignedById=1051 ("+l(e.problematicTickets.withAssignedById1051.length)+")",1),i("div",ni,[(a(!0),r(D,null,C(e.problematicTickets.withAssignedById1051.slice(0,10),o=>(a(),r("div",{key:o.id,class:"ticket-item"},[i("span",oi,"#"+l(o.id),1),i("span",ai,l(o.title),1),i("span",ri,l(e.getStageName(o.stageId)),1)]))),128)),e.problematicTickets.withAssignedById1051.length>10?(a(),r("div",li," ... –∏ –µ—â—ë "+l(e.problematicTickets.withAssignedById1051.length-10),1)):f("",!0)])])):f("",!0),e.problematicTickets.withoutSectorTag.length>0?(a(),r("div",ci,[i("h4",null,"–ë–µ–∑/–Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–≥ —Å–µ–∫—Ç–æ—Ä–∞ ("+l(e.problematicTickets.withoutSectorTag.length)+")",1),i("div",di,[(a(!0),r(D,null,C(e.problematicTickets.withoutSectorTag.slice(0,10),o=>(a(),r("div",{key:o.id||o.ID,class:"ticket-item"},[i("span",gi,"#"+l(o.id||o.ID),1),i("span",ui,l(o.title||o.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),i("span",mi,l(e.getStageName(o.stageId||o.STAGE_ID)),1)]))),128)),e.problematicTickets.withoutSectorTag.length>10?(a(),r("div",ki," ... –∏ –µ—â—ë "+l(e.problematicTickets.withoutSectorTag.length-10),1)):f("",!0)])])):f("",!0),e.problematicTickets.notInColumn.length>0?(a(),r("div",hi,[i("h4",null,"–ù–µ –ø–æ–ø–∞–ª–∏ –≤ –∫–æ–ª–æ–Ω–∫—É ("+l(e.problematicTickets.notInColumn.length)+")",1),i("div",fi,[(a(!0),r(D,null,C(e.problematicTickets.notInColumn.slice(0,10),o=>(a(),r("div",{key:o.id,class:"ticket-item"},[i("span",vi,"#"+l(o.id),1),i("span",yi,l(o.title),1),i("span",_i,l(e.getStageName(o.stageId)),1)]))),128)),e.problematicTickets.notInColumn.length>10?(a(),r("div",pi," ... –∏ –µ—â—ë "+l(e.problematicTickets.notInColumn.length-10),1)):f("",!0)])])):f("",!0),e.problematicTickets.unknownStage.length>0?(a(),r("div",Ti,[i("h4",null,"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç–∞–¥–∏—è ("+l(e.problematicTickets.unknownStage.length)+")",1),i("div",bi,[(a(!0),r(D,null,C(e.problematicTickets.unknownStage.slice(0,10),o=>(a(),r("div",{key:o.id,class:"ticket-item"},[i("span",Si,"#"+l(o.id),1),i("span",Di,l(o.title),1),i("span",Ci,"–°—Ç–∞–¥–∏—è: "+l(o.stageId),1)]))),128)),e.problematicTickets.unknownStage.length>10?(a(),r("div",wi," ... –∏ –µ—â—ë "+l(e.problematicTickets.unknownStage.length-10),1)):f("",!0)])])):f("",!0),e.hasNoProblems?(a(),r("div",Ii," ‚úÖ –ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ ")):f("",!0)])])):f("",!0)])):f("",!0)}const Ai=N(is,[["render",Ei],["__scopeId","data-v-74a5e138"]]);function Ni(){const s=S(!1),t=S(null),n=S([{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:[]},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:[]},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:[]}]),e=S({formed:[],review:[],execution:[]}),m=S([]),p=S(null);return{isLoading:s,error:t,stages:n,zeroPointTickets:e,employees:m,draggedTicket:p,updateState:k=>{k.stages&&(n.value=k.stages),k.employees&&(m.value=k.employees),k.zeroPointTickets&&(e.value=k.zeroPointTickets)},resetState:()=>{s.value=!1,t.value=null,n.value=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:[]},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:[]},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:[]}],e.value={formed:[],review:[],execution:[]},m.value=[],p.value=null},updateLocalStateAfterMove:(k,v,g)=>{const h=n.value.find(y=>y.employees.some(b=>b.tickets.some(L=>L.id===k.id)));if(h){const y=h.employees.find(b=>b.tickets.some(L=>L.id===k.id));y&&(y.tickets=y.tickets.filter(b=>b.id!==k.id))}const _=n.value.find(y=>y.id===g);if(_){const y=_.employees.find(b=>b.id===v);if(y){const b={...k,assigneeId:v,stageId:g};y.tickets.push(b)}}Object.keys(e.value).forEach(y=>{e.value[y]=e.value[y].filter(b=>b.id!==k.id)})},getEmployeeTickets:(k,v)=>{const g=n.value.find(_=>_.id===v);if(!g)return[];const h=g.employees.find(_=>_.id===k);return h?h.tickets||[]:[]}}}function Oi(){const s=S(null),t=S(0),n=S(null),e=S(null),m=S({}),p=(g,h={})=>{s.value=g,m.value=h},o=g=>{const h=typeof g=="number"&&!isNaN(g)?g:0;t.value=Math.min(100,Math.max(0,h))},c=g=>{n.value=g,e.value=null},u=g=>{e.value=g},d=()=>{e.value=null},k=()=>{s.value=null,t.value=0,n.value=null,e.value=null,m.value={}},v=T(()=>n.value||e.value);return{currentStep:s,progress:t,error:n,temporaryError:e,displayError:v,stepDetails:m,updateStep:p,updateProgress:o,setError:c,setTemporaryError:u,clearTemporaryError:d,reset:k}}const A={fadeOutDuration:400,fadeInDuration:400,delayBetween:150,readyDisplayTime:800,fadeOutEasing:"ease-out",fadeInEasing:"ease-in",fadeOutTransform:"scale(0.95)",fadeInTransform:"translateY(10px)"},H={fadeInDuration:400,fadeInEasing:"ease-in"};function le(s,t,n="opacity, transform"){return`${n} ${s}ms ${t}`}function Bi(){return le(A.fadeOutDuration,A.fadeOutEasing)}function Li(){return le(H.fadeInDuration,H.fadeInEasing)}function Pi(){const s=S(!1),t=S(null),n=o=>{s.value=!0,t.value=Date.now(),o&&o()},e=o=>{s.value=!1,t.value=null,o&&o()},m=(o,c,u=A)=>{n(()=>{o&&o(),setTimeout(()=>{c&&c()},u.delayBetween),setTimeout(()=>{e()},u.fadeOutDuration)})},p=T(()=>t.value?Date.now()-t.value:0);return{isTransitioning:T(()=>s.value),startTransition:n,endTransition:e,executeTransition:m,transitionDuration:p}}function Ri(s,t=""){if(Logger.error(`API Error ${t?`(${t})`:""}`,"ErrorHandler",s),s.message){if(s.message.includes("HTTP error"))return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.";if(s.message.includes("timeout"))return"–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";if(s.message.includes("403")||s.message.includes("401"))return"–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.";if(s.message.includes("500"))return"–û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."}return s.message||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}function xi(s,t="",n={}){const e={message:s.message,stack:s.stack,context:t,...n,timestamp:new Date().toISOString()};Logger.error("Error logged","ErrorHandler",e)}function M(s,t="",n=null){const e=Ri(s,t);xi(s,t),n&&typeof n=="function"?n(e,"error"):typeof BX<"u"&&BX.UI&&BX.UI.Notification&&BX.UI.Notification.Center.notify({content:e,autoHideDelay:5e3})}function ji(s){const t=Y(),n=Oi(),{isTransitioning:e,executeTransition:m}=Pi();function p(h,_){const y=_e(h);y.step&&_.updateStep(y.step,y.details||{}),y.progress!==void 0&&y.progress!==null&&(_.updateProgress(y.progress),_.clearTemporaryError())}const o=async(h=!0)=>{s.isLoading.value=!0,s.error.value=null,n.reset(),n.updateStep("cache_check",{description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö..."}),n.updateProgress(0);try{const _=await z.getSectorData(h,y=>{p(y,n)});s.updateState(_)}catch(_){s.error.value=_.message,n.setError(_.message),M(_,"loading sector data",t.error)}finally{if(s.error.value)s.isLoading.value=!1;else{n.updateStep("complete",{description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"}),n.updateProgress(100);const _=A.readyDisplayTime||800;setTimeout(()=>{m(()=>{},()=>{s.isLoading.value=!1},A),setTimeout(()=>{n.reset()},A.fadeOutDuration)},_)}}},c=async(h,_,y)=>{if(!ae(h,_,y))return t.warning("–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–∫–µ—Ç —Å—é–¥–∞"),!1;try{const b=await z.assignTicket(h.id,_,y);return b&&(s.updateLocalStateAfterMove(h,_,y),t.success("–¢–∏–∫–µ—Ç –ø–µ—Ä–µ–º–µ—â—ë–Ω")),b}catch(b){return M(b,"assigning ticket",t.error),!1}finally{s.draggedTicket.value=null}};return{loadSectorData:o,assignTicket:c,moveTicketToStage:async(h,_)=>await c(h,h.assigneeId,_),assignTicketToEmployee:async(h,_)=>await c(h,_,h.stageId),createTicket:async h=>{const _=Ue(h);if(!_.valid){const y=_.errors.join(", ");return t.error(y),0}try{const y=await z.createTicket(h);return y>0&&(await o(!1),t.success("–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω")),y}catch(y){return M(y,"creating ticket",t.error),0}},handleTicketDragStart:h=>{s.draggedTicket.value=h},handleTicketDrop:async(h,_,y)=>{await c(h,_,y)},loadingProgress:n,isTransitioning:e}}const V={name:"DashboardSector1C",components:{DashboardStage:nt,LoadingPreloader:Rt,LoggerControl:Zt,BackButton:ss,DiagnosticsPanel:Ai},setup(){const s=ee(),t=te(),n=Ni(),e=ji(n),m=S(null),p=T(()=>m.value?he(m.value):!1),o=T(()=>Te(t,m.value)),c=()=>{s.push({name:"dashboard-sector-1c",query:{...t.query,diagnostics:"true"}}),typeof localStorage<"u"&&localStorage.setItem("dashboard-sector-1c-diagnostics","true");const w=j();w&&w.reset(),e.loadSectorData(!1)},u=()=>{J.invalidateTicketsCache(),J.invalidateEmployeesCache(),pe();const w=j();w&&w.reset(),e.loadSectorData(!1)};Q(async()=>{try{m.value=await ke.getCurrentUser()}catch(w){console.error("Error getting current user:",w),m.value=null}if(o.value){const w=j();w&&w.reset()}e.loadSectorData()});const d=Bi(),k=Li(),v=`${A.delayBetween}ms`,g=A.fadeOutTransform,h=A.fadeInTransform,_=()=>{e.loadSectorData(!1)},y=()=>{s.push({name:"dashboard-graph-state"})},b=e.loadingProgress,L=T(()=>typeof localStorage<"u"?localStorage.getItem("dashboard-sector-1c-show-logger-control")==="true":!1);return{isLoading:n.isLoading,error:n.error,stages:n.stages,zeroPointTickets:n.zeroPointTickets,employees:n.employees,draggedTicket:n.draggedTicket,currentStep:b.currentStep,progress:b.progress,stepDetails:b.stepDetails,loadingProgress:b,loadSectorData:e.loadSectorData,handleTicketDragStart:e.handleTicketDragStart,handleTicketDrop:e.handleTicketDrop,assignTicketToEmployee:e.assignTicketToEmployee,moveTicketToStage:e.moveTicketToStage,createTicket:e.createTicket,getEmployeeTickets:n.getEmployeeTickets,showLoggerControl:L,handleRetry:_,isTransitioning:e.isTransitioning,preloaderFadeOutTransition:d,dashboardFadeInTransition:k,transitionDelay:v,preloaderFadeOutTransform:g,dashboardFadeInTransform:h,navigateToGraphState:y,isDiagnosticsEnabled:o,enableDiagnostics:c,clearCache:u,isUserAdmin:p}}},G=()=>{fe(s=>({d45fb0ae:s.preloaderFadeOutTransition,v9b81d2d0:s.preloaderFadeOutTransform,v50dfa152:s.dashboardFadeInTransition,v16bbb8d6:s.transitionDelay,v6df543cf:s.dashboardFadeInTransform}))},Z=V.setup;V.setup=Z?(s,t)=>(G(),Z(s,t)):G;const Ui={class:"dashboard-header"},zi={class:"header-actions"},Fi={key:0,class:"dashboard-content"},Mi={class:"stages-container"};function Vi(s,t,n,e,m,p){const o=E("BackButton"),c=E("LoadingPreloader"),u=E("DashboardStage"),d=E("LoggerControl"),k=E("DiagnosticsPanel");return a(),r("div",{class:B(["dashboard-sector-1c",{"is-dragging":e.draggedTicket}])},[i("div",Ui,[I(o,{variant:"header"}),t[6]||(t[6]=i("h1",null,"–î–∞—à–±–æ—Ä–¥ - –°–µ–∫—Ç–æ—Ä 1–°",-1)),i("div",zi,[e.isDiagnosticsEnabled&&e.isUserAdmin?(a(),r("button",{key:0,onClick:t[0]||(t[0]=(...v)=>e.clearCache&&e.clearCache(...v)),class:"btn-clear-cache",title:"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à —Å–µ–∫—Ç–æ—Ä–∞ –∏ —Ç–∏–∫–µ—Ç–æ–≤"},[...t[3]||(t[3]=[i("span",{class:"icon"},"‚ôªÔ∏è",-1),i("span",null,"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à",-1)])])):f("",!0),!e.isDiagnosticsEnabled&&e.isUserAdmin?(a(),r("button",{key:1,onClick:t[1]||(t[1]=(...v)=>e.enableDiagnostics&&e.enableDiagnostics(...v)),class:"btn-enable-diagnostics",title:"–í–∫–ª—é—á–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º"},[...t[4]||(t[4]=[i("span",{class:"icon"},"üîç",-1),i("span",null,"–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",-1)])])):f("",!0),i("button",{onClick:t[2]||(t[2]=(...v)=>e.navigateToGraphState&&e.navigateToGraphState(...v)),class:"btn-navigate-graph-state",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞"},[...t[5]||(t[5]=[i("span",{class:"icon"},"üìä",-1),i("span",null,"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",-1)])])])]),I(X,{name:"preloader-fade"},{default:R(()=>[e.isLoading||e.error||e.currentStep?(a(),O(c,{key:0,"current-step":e.currentStep,progress:e.progress,"step-details":e.stepDetails,error:e.error||null,onRetry:e.handleRetry},null,8,["current-step","progress","step-details","error","onRetry"])):f("",!0)]),_:1}),I(X,{name:"dashboard-fade"},{default:R(()=>[!e.isLoading&&!e.error&&!e.currentStep?(a(),r("div",Fi,[i("div",Mi,[(a(!0),r(D,null,C(e.stages,v=>(a(),O(u,{key:v.id,stage:v,"zero-point-tickets":e.zeroPointTickets[v.id]||[],onTicketMoved:e.handleTicketDrop,onTicketAssigned:e.assignTicketToEmployee},null,8,["stage","zero-point-tickets","onTicketMoved","onTicketAssigned"]))),128))])])):f("",!0)]),_:1}),I(o,{variant:"floating"}),I(d,{"show-control":e.showLoggerControl},null,8,["show-control"]),I(k,{"is-enabled":e.isDiagnosticsEnabled,"is-user-admin":e.isUserAdmin},null,8,["is-enabled","is-user-admin"])],2)}const Xi=N(V,[["render",Vi],["__scopeId","data-v-760e168a"]]);export{Xi as default};
