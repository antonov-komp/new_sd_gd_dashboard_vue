const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./direct-access-config-DFDniWV1.js","./chunk-Bog3mblX.js","./chunk-BhH35ey2.js","./access-config-async-HAM1UZpc.js","./chunk-J8T_k_VI.js","./chunk-VYgea3_f.js","./chunk-BXCuceMq.js","./WebhookLogsDashboard.vue-XTRCf02I.js","./WebhookLogDetails.vue-wWg8bca7.js","./DashboardSector1C.vue-CrFGBEcl.js","./chunk-D2eOmgC5.js","./chunk-BKdxPY6O.js","./chunk-DmSjUvit.js","./chunk-BIrroo-R.js","./GraphAdmissionClosureDashboard.vue-DIrWkbeF.js","./chunk-CdN3AIrP.js","./dashboard-sector-1c-service-DF2NHvT_.js","./GraphStateDashboard.vue-DQL3JiAL.js","./TicketsTimeTrackingDashboard.vue-DrJxAyoq.js"])))=>i.map(i=>d[i]);
var Wt=Object.defineProperty;var Ht=(n,e,a)=>e in n?Wt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var Re=(n,e,a)=>Ht(n,typeof e!="symbol"?e+"":e,a);import{r as W,c as d,o as c,a as K,b as M,d as qt,t as m,n as N,e as s,f as ne,g as p,h as de,w as _e,i as Q,F as j,j as z,k as pe,l as T,u as Ye,m as ee,p as Jt,T as Ie,q as $,v as Ge,s as Be,x as Ee,y as be,z as De,A as re,B as He,C as Xt,D as Ct,E as kt,G as tt,H as Ue,I as ct,L as dt,P as St,J as Dt,K as ut,M as mt,N as gt,O as At,Q as Tt,R as Et,S as Mt,U as Yt,V as Kt,W as Gt,X as Qt,Y as Zt,Z as es,_ as ts,$ as ss}from"./chunk-J8T_k_VI.js";import{a as xt,_ as ve,g as Te}from"./chunk-Bog3mblX.js";import{C as yt}from"./chunk-VYgea3_f.js";import{A as as}from"./chunk-BXCuceMq.js";import"./chunk-BhH35ey2.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const J=(n,e)=>{const a=n.__vccOpts||n;for(const[t,r]of e)a[t]=r;return a},os={name:"App"},ns={id:"app"};function rs(n,e,a,t,r,i){const o=W("router-view");return c(),d("div",ns,[K(o)])}const is=J(os,[["render",rs]]),ls={name:"StatusMessage",props:{type:{type:String,required:!0,validator:n=>["success","error","info","warning"].includes(n)},title:{type:String,default:null},message:{type:String,default:null}}},cs={key:0},ds={key:1};function us(n,e,a,t,r,i){return c(),d("div",{class:N(["status-message",`status-message--${a.type}`])},[a.title?(c(),d("strong",cs,m(a.title),1)):M("",!0),a.message?(c(),d("p",ds,m(a.message),1)):M("",!0),qt(n.$slots,"default",{},void 0)],2)}const It=J(ls,[["render",us],["__scopeId","data-v-7f15d2d7"]]),ms={name:"LoadingSpinner",props:{message:{type:String,default:"–ó–∞–≥—Ä—É–∑–∫–∞..."}}},gs={class:"loading-spinner"},hs={key:0,class:"message"};function fs(n,e,a,t,r,i){return c(),d("div",gs,[e[0]||(e[0]=s("div",{class:"spinner"},null,-1)),a.message?(c(),d("p",hs,m(a.message),1)):M("",!0)])}const Lt=J(ms,[["render",fs],["__scopeId","data-v-375eac16"]]);function je(){try{if(window.self===window.top)return!1;if(typeof BX24<"u")return!0;try{const n=window.parent.location.origin;return n.includes("bitrix24")||n.includes("kompo.by")}catch{return!1}}catch(n){return console.warn("Error checking Bitrix24 context:",n),!1}}function vs(){return typeof BX24<"u"}class Le{static init(e){return new Promise((a,t)=>{if(!je()){console.log("Not inside Bitrix24, skipping BX24.init()"),e&&e(),a();return}if(typeof BX24>"u"){t(new Error("Bitrix24 API not loaded. Make sure script is included: //api.bitrix24.com/api/v1/"));return}const r=setTimeout(()=>{t(new Error("BX24.init() timeout: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥"))},5e3);try{BX24.init(()=>{clearTimeout(r),e&&e(),a()})}catch(i){clearTimeout(r),t(i)}})}static installFinish(){return new Promise((e,a)=>{if(typeof BX24>"u"){a(new Error("Bitrix24 API not loaded"));return}try{BX24.installFinish(),e()}catch(t){a(t)}})}static callMethod(e,a={}){return new Promise((t,r)=>{if(typeof BX24>"u"){r(new Error("Bitrix24 API not loaded"));return}const i=setTimeout(()=>{r(new Error(`BX24.callMethod(${e}) timeout: –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—ã—Å–∏–ª 10 —Å–µ–∫—É–Ω–¥`))},1e4);try{BX24.callMethod(e,a,o=>{if(clearTimeout(i),o.error()){const l=o.error();r(new Error(l.error_description||l.error||"Unknown error"))}else t(o.data())})}catch(o){clearTimeout(i),r(o)}})}static async getCurrentUser(){if(je()&&vs())try{const e=await Promise.race([this.callMethod("user.current",{}),new Promise((a,t)=>setTimeout(()=>t(new Error("Timeout")),5e3))]);return console.log("Got user from BX24.callMethod() (interface user):",e?.ID||"unknown"),e}catch(e){console.warn("BX24.callMethod() failed, using proxy API as fallback:",e);try{const t=await new yt().getCurrentUser();return console.log("Got user from proxy API (token owner, fallback):",t),t}catch(a){throw console.error("Both BX24 API and proxy API failed:",a),e.message&&e.message.includes("timeout")?new Error("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Bitrix24 API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç."):new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}else return console.warn("Not inside Bitrix24, using proxy API (will return token owner, not interface user)"),await new yt().getCurrentUser()}static getUser(){return new Promise((e,a)=>{if(typeof BX24>"u"){a(new Error("Bitrix24 API not loaded"));return}if(typeof BX24.getUser!="function"){a(new Error("BX24.getUser is not available"));return}BX24.getUser(t=>{e(t)})})}static getAuth(){return new Promise((e,a)=>{if(typeof BX24>"u"){a(new Error("Bitrix24 API not loaded"));return}BX24.getAuth(t=>{e(t)})})}}const ps={name:"InstallPage",components:{StatusMessage:It,LoadingSpinner:Lt},setup(){const n=p(!0),e=p(null),a=p(null);return de(async()=>{try{let t=null;if(window.INSTALL_RESULT)t=window.INSTALL_RESULT;else{const r=xt("/install.php"),i=await fetch(`${r}?get_result=1`);i.ok&&(t=await i.json())}if(!t)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏");if(a.value=t,t.rest_only===!1)if(t.install===!0){e.value={type:"success",title:"‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!",message:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24."};try{await Le.init(()=>{Le.installFinish()})}catch(r){console.error("Error finishing installation:",r)}}else e.value={type:"error",title:"‚úó –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."};else e.value={type:"info",title:"REST-only —Ä–µ–∂–∏–º",message:"–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ REST API, –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."}}catch(t){console.error("Error loading install result:",t),e.value={type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ."}}finally{n.value=!1}}),{loading:n,installStatus:e,installInfo:a}}},ys={class:"install-page"},_s={class:"container"},bs={key:1,class:"info"};function ws(n,e,a,t,r,i){const o=W("StatusMessage"),l=W("LoadingSpinner");return c(),d("div",ys,[s("div",_s,[e[1]||(e[1]=s("h1",null,"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1)),t.installStatus?(c(),ne(o,{key:0,type:t.installStatus.type,title:t.installStatus.title,message:t.installStatus.message},null,8,["type","title","message"])):M("",!0),t.installInfo?(c(),d("div",bs,[e[0]||(e[0]=s("h3",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:",-1)),s("pre",null,m(JSON.stringify(t.installInfo,null,2)),1)])):M("",!0),t.loading?(c(),ne(l,{key:2,message:"–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."})):M("",!0)])])}const Cs=J(ps,[["render",ws],["__scopeId","data-v-d082ec9e"]]),Ve={allowedDepartmentIds:[369,366,7],adminDepartmentIds:[369]};function Pt(n){return!n||typeof n!="number"?!1:Ve.allowedDepartmentIds.includes(n)}function Ft(n){if(!n||!n.UF_DEPARTMENT)return!1;const e=Array.isArray(n.UF_DEPARTMENT)?n.UF_DEPARTMENT:[];return e.length===0?!1:e.some(a=>Ve.adminDepartmentIds.includes(a))}const Ae={USER_NOT_DETERMINED:"USER_NOT_DETERMINED",ACCESS_DENIED:"ACCESS_DENIED",API_ERROR:"API_ERROR"};class Me{constructor(e,a=null,t=null,r=null){this.allowed=e,this.errorCode=a,this.errorMessage=t,this.user=r}}class Oe{static async checkAccess(){try{const e=je();if(console.log("AccessControlService.checkAccess - isInsideBitrix24:",e),console.log("AccessControlService.checkAccess - window.self === window.top:",window.self===window.top),console.log("AccessControlService.checkAccess - typeof BX24:",typeof BX24),e)console.log("AccessControlService.checkAccess - Inside Bitrix24, skipping direct access check");else{console.log("AccessControlService.checkAccess - Not inside Bitrix24, checking direct access config...");const{isDirectAccessAllowed:i,getDenyMessage:o}=await ve(async()=>{const{isDirectAccessAllowed:u,getDenyMessage:h}=await import("./direct-access-config-DFDniWV1.js");return{isDirectAccessAllowed:u,getDenyMessage:h}},__vite__mapDeps([0,1]),import.meta.url),l=await i();if(console.log("AccessControlService.checkAccess - allowDirectAccess:",l),!l){const u=await o();return console.warn("Direct access denied: Application opened directly in browser, but direct access is disabled in config"),console.warn("Deny message:",u),new Me(!1,Ae.ACCESS_DENIED,u,null)}console.log("Direct access allowed: Using primary administrator token from settings.php")}if(e)try{await Promise.race([Le.init(),new Promise((i,o)=>setTimeout(()=>o(new Error("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥")),5e3))])}catch(i){console.warn("BX24.init() failed, will try proxy API:",i)}let a;try{a=await Promise.race([Le.getCurrentUser(),new Promise((i,o)=>setTimeout(()=>o(new Error("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø—Ä–µ–≤—ã—Å–∏–ª–æ 10 —Å–µ–∫—É–Ω–¥")),1e4))])}catch(i){console.warn("Bitrix24BxApi.getCurrentUser() failed, trying proxy API:",i);const{Bitrix24ApiProvider:o}=await ve(async()=>{const{Bitrix24ApiProvider:l}=await import("./chunk-BhH35ey2.js").then(u=>u.b);return{Bitrix24ApiProvider:l}},__vite__mapDeps([2,1]),import.meta.url);try{const l=await o.getInstance();a=await Promise.race([l.getCurrentUser(),new Promise((u,h)=>setTimeout(()=>h(new Error("–ü—Ä–æ–∫—Å–∏ API –ø—Ä–µ–≤—ã—Å–∏–ª–æ 5 —Å–µ–∫—É–Ω–¥")),5e3))]),console.log("Got user from proxy API:",a?.ID||"unknown")}catch(l){throw console.error("Both BX24 API and proxy API failed:",l),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}if(!a||!a.ID)return console.warn("AccessControlService.checkAccess - user not determined:",a),new Me(!1,Ae.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.");console.log("AccessControlService.checkAccess - user determined:",{id:a.ID,name:a.NAME,departments:a.UF_DEPARTMENT});const t=a.UF_DEPARTMENT||[];if(console.log("AccessControlService.checkAccess - departmentIds:",t),!Array.isArray(t)||t.length===0){if(console.log("AccessControlService.checkAccess - user has no departments"),!e){const{isDirectAccessAllowed:i}=await ve(async()=>{const{isDirectAccessAllowed:l}=await import("./direct-access-config-DFDniWV1.js");return{isDirectAccessAllowed:l}},__vite__mapDeps([0,1]),import.meta.url);if(await i())return console.log("AccessControlService.checkAccess - Direct access allowed, granting access despite no departments"),new Me(!0,null,null,a)}return console.warn("AccessControlService.checkAccess - Access denied: user has no departments"),new Me(!1,Ae.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ—Ç–¥–µ–ª—É.")}const r=t.some(i=>Pt(i));return console.log("AccessControlService.checkAccess - hasAccess:",r),r?(console.log("AccessControlService.checkAccess - Access granted"),new Me(!0,null,null,a)):(console.warn("AccessControlService.checkAccess - Access denied: no allowed departments"),new Me(!1,Ae.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"))}catch(e){return console.error("AccessControlService.checkAccess error:",e),e.message&&(e.message.includes("CORS")||e.message.includes("blocked")||e.message.includes("ERR_FAILED")||e.message.includes("unknown address space"))&&je()?(console.error("CORS error inside Bitrix24: Cannot determine interface user."),new Me(!1,Ae.API_ERROR,"–û—à–∏–±–∫–∞ CORS: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")):e.message&&e.message.includes("not loaded")?new Me(!1,Ae.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."):new Me(!1,Ae.API_ERROR,"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}static async getCurrentUser(){try{return je()&&await Le.init(),await Le.getCurrentUser()}catch(e){return console.error("AccessControlService.getCurrentUser error:",e),null}}}class Qe{static async logAppEntry(e,a=null){if(!e||!e.ID)return console.warn("[ActivityLoggingService] Invalid user object for app entry logging"),!1;const t={timestamp:new Date().toISOString(),type:"app_entry",user_id:e.ID,user_name:this.getUserName(e),user_email:e.EMAIL||null,ip:a||this.getClientIp(),user_agent:navigator.userAgent,session_id:this.getSessionId()};return await this.saveLog(t)}static async logPageVisit(e,a,t=null){if(!a||!a.ID)return console.warn("[ActivityLoggingService] Invalid user object for page visit logging"),!1;if(!e||!e.path)return console.warn("[ActivityLoggingService] Invalid route object for page visit logging"),!1;const r={timestamp:new Date().toISOString(),type:"page_visit",user_id:a.ID,user_name:this.getUserName(a),route_path:e.path,route_name:e.name||null,route_title:e.meta?.title||null,from_path:t?.path||null,from_name:t?.name||null,session_id:this.getSessionId()};return await this.saveLog(r)}static async saveLog(e){try{const a=Te("/api/user-activity-log.php"),t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)});if(!t.ok){const i=await t.text();return console.error("[ActivityLoggingService] Failed to save log:",{status:t.status,statusText:t.statusText,error:i}),!1}const r=await t.json();return r.success?!0:(console.error("[ActivityLoggingService] API returned error:",r.error),!1)}catch(a){return a.name==="AbortError"?console.warn("[ActivityLoggingService] Request timeout (activity logging skipped)"):console.error("[ActivityLoggingService] Error saving log:",a),!1}}static getSessionId(){const e="activity_session_id";if(sessionStorage.getItem(e))return sessionStorage.getItem(e);const a=this.generateSessionId();return sessionStorage.setItem(e,a),a}static generateSessionId(){const e=Date.now(),a=Math.random().toString(36).substring(2,11);return`${e}-${a}`}static getUserName(e){const a=e.NAME||"",t=e.LAST_NAME||"";return`${a} ${t}`.trim()||e.EMAIL||`User #${e.ID}`}static getClientIp(){return null}static isAppEntryLogged(){return sessionStorage.getItem("app_entry_logged")==="true"}static markAppEntryLogged(){sessionStorage.setItem("app_entry_logged","true")}}const ks={reports:[{id:1,title:"–û—Ç—á—ë—Ç –ø–æ —Ç–∏–∫–µ—Ç–∞–º",icon:"üìä",route:"/reports/tickets",description:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º",active:!1},{id:2,title:"–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",icon:"üìà",route:"/reports/performance",description:"–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞",active:!1},{id:3,title:"–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º",icon:"üìâ",route:"/reports/deadlines",description:"–ê–Ω–∞–ª–∏–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á",active:!1},{id:4,title:"–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç",icon:"üìã",route:"/reports/summary",description:"–û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",active:!1},{id:5,title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",route:"/dashboard/sector-1c",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0},{id:6,title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",icon:"üìä",route:"/dashboard/graph-state",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–° –≤–æ –≤—Ä–µ–º–µ–Ω–∏",active:!0,category:"analytics",order:6},{id:7,title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–°",icon:"üìà",route:"/dashboard/graph-admission-closure",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0,category:"analytics",order:7},{id:8,title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"‚è±",route:"/dashboard/tickets-time-tracking",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",active:!0,category:"analytics",order:8}]};function Ss(){return ks.reports.filter(n=>n.active===!0)}const Ds={adminInterfaces:[{id:1,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"üë•",route:"/admin/users",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"},{id:2,title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã",icon:"‚öôÔ∏è",route:"/admin/settings",description:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:3,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",icon:"üìã",route:"/admin/webhook-logs",description:"–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤"},{id:4,title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",icon:"üìä",route:"/admin/usage-stats",description:"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:5,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",icon:"üóëÔ∏è",route:"/admin/cache",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –º–æ–¥—É–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"}]};function As(){return[...Ds.adminInterfaces]}const Ts={name:"IndexPage",components:{StatusMessage:It,LoadingSpinner:Lt},beforeCreate(){console.log("[IndexPage] beforeCreate() called")},created(){console.log("[IndexPage] created() called")},beforeMount(){console.log("[IndexPage] beforeMount() called")},setup(){console.log("[IndexPage] setup() called");const n=Ye(),e=p(!0),a=p(null),t=p(!1),r=p(!1),i=p(""),o=p(null),l=p(null),u=p(!1);console.log("[IndexPage] Initial state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value});const h=p(Ss()),y=p(!1),g=p(As()),k=T(()=>o.value?Ft(o.value):!1),A=T(()=>{if(!o.value)return"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";const C=o.value.FIRST_NAME?o.value.FIRST_NAME.trim():"",_=o.value.LAST_NAME?o.value.LAST_NAME.trim():"",b=o.value.NAME?o.value.NAME.trim():"";return C&&_?`${C} ${_}`:b&&_&&b!==_?`${b} ${_}`:C&&b&&C!==b?`${C} ${b}`:b&&b.includes(" ")?b:C||_||b||`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${o.value.ID}`}),E=T(()=>a.value?a.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ":"–û—à–∏–±–∫–∞ API":null),S=T(()=>a.value?a.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É.":a.value:null),I=T(()=>a.value&&a.value.includes("no_install_app")),f=T(()=>xt("/install.php"));de(async()=>{console.log("[IndexPage] onMounted() called");try{console.log("[IndexPage] Calling AccessControlService.checkAccess()...");const C=await Oe.checkAccess();if(console.log("[IndexPage] Access result:",{allowed:C.allowed,hasUser:!!C.user,user:C.user,errorCode:C.errorCode,errorMessage:C.errorMessage}),C.allowed){if(console.log("[IndexPage] Setting accessAllowed to true"),t.value=!0,o.value=C.user,console.log("[IndexPage] Access allowed, setting state:",{accessAllowed:t.value,hasUser:!!o.value,loading:e.value,accessDenied:r.value}),!Qe.isAppEntryLogged())try{C.user&&await Qe.logAppEntry(C.user)&&Qe.markAppEntryLogged()}catch(_){console.error("[IndexPage] Error logging app entry:",_)}}else{r.value=!0;const _=je(),b=!_&&C.errorCode===Ae.ACCESS_DENIED&&C.errorMessage&&C.errorMessage.includes("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø");if(console.log("IndexPage - accessResult:",{errorCode:C.errorCode,errorMessage:C.errorMessage,isInsideB24:_,isDirectAccessDeniedCheck:b}),u.value=b,b&&(i.value=C.errorMessage,console.log("IndexPage - Set direct access denied message:",C.errorMessage)),console.log("IndexPage - State after check:",{accessDenied:r.value,isDirectAccessDenied:u.value,accessErrorMessage:i.value}),!b){if(C.user){const{getAllowedDepartmentIds:L}=await ve(async()=>{const{getAllowedDepartmentIds:V}=await import("./access-config-async-HAM1UZpc.js");return{getAllowedDepartmentIds:V}},__vite__mapDeps([3,4,1,5,6,2]),import.meta.url);l.value={userId:C.user.ID,departmentIds:C.user.UF_DEPARTMENT||[],allowedIds:L()}}C.errorCode===Ae.USER_NOT_DETERMINED?i.value="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.":C.errorCode===Ae.ACCESS_DENIED?i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω":i.value=C.errorMessage||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."}}}catch(C){a.value=C.message,console.error("Error checking access:",C)}finally{e.value=!1,console.log("[IndexPage] Final state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value,hasUser:!!o.value,error:a.value})}});const v=C=>{if(!C){console.error("Route is not defined for report");return}n.push(C)},w=()=>{y.value=!0},F=()=>{y.value=!1};return{loading:e,error:a,accessAllowed:t,accessDenied:r,accessErrorMessage:i,currentUser:o,userName:A,debugInfo:l,isDirectAccessDenied:u,errorTitle:E,errorMessage:S,showInstallLink:I,installPageUrl:f,reportsButtons:h,navigateToReport:v,isAdmin:k,showAdminPopup:y,adminButtons:g,openAdminPopup:w,closeAdminPopup:F,navigateToAdmin:C=>{if(!C){console.error("Route is not defined for admin interface");return}n.push(C),F()}}}},Es={class:"index-page"},Ms={class:"container"},xs={key:0,class:"install-link"},Is=["href"],Ls={key:0,class:"direct-access-denied-info",style:{"margin-top":"15px",padding:"15px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px"}},Ps={key:1,class:"debug-info",style:{"margin-top":"15px",padding:"10px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px","font-size":"12px"}},Fs={key:3,class:"main-content"},Us={class:"greeting-section"},Rs={class:"greeting-header"},Os={class:"greeting-header-content"},Ns={class:"greeting-text"},Bs={class:"reports-section"},Vs={class:"reports-grid"},js=["onClick"],zs={class:"report-icon"},$s={class:"report-title"},Ws={key:0,class:"report-description"},Hs={class:"admin-popup-header"},qs={class:"admin-popup-content"},Js={class:"admin-buttons-grid"},Xs=["onClick"],Ys={class:"admin-icon"},Ks={class:"admin-title"},Gs={key:0,class:"admin-description"};function Qs(n,e,a,t,r,i){const o=W("StatusMessage"),l=W("LoadingSpinner");return c(),d("div",Es,[s("div",Ms,[t.error?(c(),ne(o,{key:0,type:"error",title:t.errorTitle,message:t.errorMessage},{default:_e(()=>[t.showInstallLink?(c(),d("div",xs,[s("a",{href:t.installPageUrl},"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",8,Is)])):M("",!0)]),_:1},8,["title","message"])):M("",!0),t.loading?(c(),ne(l,{key:1,message:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞..."})):M("",!0),!t.loading&&t.accessDenied?(c(),ne(o,{key:2,type:"error",title:"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",message:t.accessErrorMessage},{default:_e(()=>[t.isDirectAccessDenied?(c(),d("div",Ls,[...e[4]||(e[4]=[s("p",{style:{margin:"0 0 10px 0","font-weight":"600",color:"#856404"}},[s("strong",null,"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")],-1),s("ol",{style:{margin:"0","padding-left":"20px",color:"#856404"}},[s("li",null,"–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24"),s("li",null,"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Bitrix24 (placement, –≤–∏–¥–∂–µ—Ç –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É)")],-1)])])):t.debugInfo?(c(),d("div",Ps,[e[5]||(e[5]=s("strong",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e[6]||(e[6]=s("br",null,null,-1)),Q(" ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+m(t.debugInfo.userId),1),e[7]||(e[7]=s("br",null,null,-1)),Q(" ID –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+m(t.debugInfo.departmentIds),1),e[8]||(e[8]=s("br",null,null,-1)),Q(" –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ID –æ—Ç–¥–µ–ª–æ–≤: "+m(t.debugInfo.allowedIds),1),e[9]||(e[9]=s("br",null,null,-1)),e[10]||(e[10]=s("small",{style:{color:"#856404"}},"–î–æ–±–∞–≤—å—Ç–µ ID –æ—Ç–¥–µ–ª–∞ –≤ —Ñ–∞–π–ª vue-app/src/config/access-config.js",-1))])):M("",!0)]),_:1},8,["message"])):M("",!0),!t.loading&&!t.accessDenied&&t.accessAllowed?(c(),d("div",Fs,[s("div",Us,[s("div",Rs,[s("div",Os,[e[13]||(e[13]=s("h2",{class:"greeting-title"},"–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ò–¢ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –ü–ª–∞–Ω–µ—Ä–∫–∏ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ü–∏–∏",-1)),s("p",Ns,[e[11]||(e[11]=Q(" –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",-1)),s("strong",null,m(t.userName),1),e[12]||(e[12]=Q("! ",-1))])]),t.isAdmin?(c(),d("button",{key:0,class:"admin-button-header",onClick:e[0]||(e[0]=(...u)=>t.openAdminPopup&&t.openAdminPopup(...u)),title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"}," ‚öôÔ∏è ")):M("",!0)])]),s("div",Bs,[s("div",Vs,[(c(!0),d(j,null,z(t.reportsButtons,u=>(c(),d("div",{key:u.id,class:"report-button",onClick:h=>t.navigateToReport(u.route)},[s("div",zs,m(u.icon),1),s("div",$s,m(u.title),1),u.description?(c(),d("div",Ws,m(u.description),1)):M("",!0)],8,js))),128))])]),t.showAdminPopup&&t.isAdmin?(c(),d("div",{key:0,class:"admin-popup-overlay",onClick:e[3]||(e[3]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))},[s("div",{class:"admin-popup",onClick:e[2]||(e[2]=pe(()=>{},["stop"]))},[s("div",Hs,[e[14]||(e[14]=s("h3",{class:"admin-popup-title"},"‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",-1)),s("button",{class:"admin-popup-close",onClick:e[1]||(e[1]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))}," ‚úï ")]),s("div",qs,[s("div",Js,[(c(!0),d(j,null,z(t.adminButtons,u=>(c(),d("div",{key:u.id,class:"admin-interface-button",onClick:h=>t.navigateToAdmin(u.route)},[s("div",Ys,m(u.icon),1),s("div",Ks,m(u.title),1),u.description?(c(),d("div",Gs,m(u.description),1)):M("",!0)],8,Xs))),128))])])])])):M("",!0)])):M("",!0)])])}const Zs=J(Ts,[["render",Qs],["__scopeId","data-v-6cc28966"]]),ye=p(new Map),Se=p({hits:0,misses:0,sets:0,invalidations:0}),nt={defaultTTL:5*60*1e3,maxSize:100,enableStats:!0};function ea(n={}){const{ttl:e=nt.defaultTTL,maxSize:a=nt.maxSize,enableStats:t=nt.enableStats}=n,r=I=>{const f=new WeakSet;return JSON.stringify(I,(v,w)=>{if(typeof w=="object"&&w!==null){if(f.has(w))return"[Circular]";f.add(w)}return typeof w=="function"||w===void 0?null:w})},i=(I,f={})=>{const v=Object.keys(f).sort().reduce((w,F)=>{const U=f[F];if(U==null)w[F]=null;else if(typeof U=="object")try{w[F]=r(U)}catch{w[F]=String(U)}else w[F]=U;return w},{});try{return`${I}_${r(v)}`}catch{const F=Object.keys(v).sort().map(U=>`${U}=${v[U]}`).join("&");return`${I}_${F}`}},o=I=>{const f=ye.value.get(I);return f?Date.now()-f.timestamp>f.ttl?(ye.value.delete(I),t&&Se.value.misses++,null):(f.lastAccessed=Date.now(),t&&Se.value.hits++,f.data):(t&&Se.value.misses++,null)},l=(I,f,v=null)=>{ye.value.size>=a&&u(),ye.value.set(I,{data:f,timestamp:Date.now(),lastAccessed:Date.now(),ttl:v||e}),t&&Se.value.sets++},u=()=>{let I=null,f=1/0;for(const[v,w]of ye.value.entries())w.lastAccessed<f&&(f=w.lastAccessed,I=v);I&&ye.value.delete(I)},h=()=>{ye.value.clear(),t&&(Se.value={hits:0,misses:0,sets:0,invalidations:0})},y=I=>{const f=typeof I=="string"?new RegExp(I):I;let v=0;for(const w of ye.value.keys())f.test(w)&&(ye.value.delete(w),v++);return t&&(Se.value.invalidations+=v),v},g=()=>{const I=Date.now();let f=0;for(const[v,w]of ye.value.entries())I-w.timestamp>w.ttl&&(ye.value.delete(v),f++);return f},k=()=>{const I=Se.value.hits+Se.value.misses,f=I>0?(Se.value.hits/I*100).toFixed(2):0;return{...Se.value,size:ye.value.size,hitRate:`${f}%`}};let A=null;const E=(I=5*60*1e3)=>{A&&clearInterval(A),A=setInterval(()=>{g()},I)},S=()=>{A&&(clearInterval(A),A=null)};return E(),{get:o,set:l,clear:h,invalidate:y,cleanup:g,getCacheKey:i,getStats:k,startAutoCleanup:E,stopAutoCleanup:S}}function xe(n){if(!n||typeof n!="object"||!n.timestamp||typeof n.timestamp!="string"||!n.event||typeof n.event!="string"||!n.category||typeof n.category!="string"||!["tasks","smart-processes","errors"].includes(n.category))return!1;try{new Date(n.timestamp)}catch{return!1}return!0}function ta(n){if(!n||typeof n!="object")return!1;for(const[e,a]of Object.entries(n))if(typeof a=="function")return!1;return!0}function $e(n){if(!xe(n))return null;const e={timestamp:n.timestamp,event:n.event,category:n.category};return n.ip&&typeof n.ip=="string"&&(e.ip=n.ip),n.payload&&typeof n.payload=="object"&&(e.payload=n.payload),n.details&&ta(n.details)&&(e.details=n.details),e}function ht(n){return Array.isArray(n)?n.map(e=>$e(e)).filter(e=>e!==null):[]}const{get:sa,set:aa,getCacheKey:oa,invalidate:_t}=ea({ttl:2*60*1e3,maxSize:50});class bt{static getBaseUrl(){return Te("/api/webhook-logs.php")}static get BASE_URL(){return this.getBaseUrl()}static async getLogs(e={},a=1,t=50,r=!1){if(a<1)throw new Error("Page must be greater than 0");if(t<1||t>1e3)throw new Error("Limit must be between 1 and 1000");const i={category:e.category||null,event:e.event||null,date:e.date||null,hour:e.hour!==void 0?e.hour:null,dateFrom:e.dateFrom||null,dateTo:e.dateTo||null,ip:e.ip||null,status:e.status||null},o=this.getBaseUrl(),l=oa(o,{filters:i,page:a,limit:t});if(!r){const h=sa(l);if(h)return console.log("[WebhookLogsApiService] Cache hit:",l.substring(0,50)+"..."),h}console.log("[WebhookLogsApiService] Cache miss:",l.substring(0,50)+"...");const u=new URLSearchParams({page:a.toString(),limit:t.toString()});i.category&&u.append("category",i.category),i.event&&u.append("event",i.event),i.date&&u.append("date",i.date),i.hour!==null&&u.append("hour",i.hour.toString()),i.dateFrom&&u.append("dateFrom",i.dateFrom),i.dateTo&&u.append("dateTo",i.dateTo),i.ip&&u.append("ip",i.ip),i.status&&u.append("status",i.status);try{const h=this.getBaseUrl(),y=await fetch(`${h}?${u.toString()}`);if(!y.ok){const E=await y.text();let S;try{S=JSON.parse(E)}catch{S={error:E}}throw new Error(S.error_description||S.error||`HTTP error! status: ${y.status}`)}const g=await y.json();if(console.log("[WebhookLogsApiService] API response:",{success:g.success,logsCount:g.logs?.length||0,pagination:g.pagination,hasError:!!g.error}),g.error)throw new Error(g.error_description||g.error);if(!g.success)throw console.warn("[WebhookLogsApiService] API returned success=false:",g),new Error("API request failed");if(!Array.isArray(g.logs))throw console.error("[WebhookLogsApiService] Invalid logs format:",g.logs),new Error("Invalid logs format: expected array");const k=ht(g.logs);(!g.pagination||typeof g.pagination!="object")&&(console.warn("[WebhookLogsApiService] Invalid pagination format:",g.pagination),g.pagination={page:a,limit:t,total:k.length,pages:Math.ceil(k.length/t)});const A={success:!0,logs:k,pagination:{page:g.pagination.page||a,limit:g.pagination.limit||t,total:g.pagination.total||k.length,pages:g.pagination.pages||Math.ceil((g.pagination.total||k.length)/t)}};return aa(l,A),A}catch(h){throw console.error("[WebhookLogsApiService] Error:",h),h}}static invalidateCacheOnFilterChange(e={},a={}){const t=_t(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Invalidated ${t} entries on filter change`)}static clearCache(){const e=_t(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Cleared ${e} entries`)}static async getLogDetails(e,a=null){const t={};return a&&(t.date=a),(await this.getLogs(t,1,1e3)).logs.find(o=>`${o.timestamp}_${o.event}`===e)||null}static async getErrors(e={},a=1,t=50){return this.getLogs({...e,category:"errors"},a,t)}static async getStats(e={}){const a=await this.getLogs(e,1,1e3),t={total:a.pagination.total||a.logs.length,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}};return a.logs.forEach(r=>{r.category==="tasks"?t.tasks++:r.category==="smart-processes"?t.smartProcesses++:r.category==="errors"&&t.errors++,t.byEvent[r.event]||(t.byEvent[r.event]=0),t.byEvent[r.event]++;const i=r.timestamp.split("T")[0];t.byDate[i]||(t.byDate[i]=0),t.byDate[i]++}),t}}function na(){const n=Jt(),e=Ye(),a=new Date().toISOString().split("T")[0],t=p({category:null,event:null,dateFrom:a,dateTo:null,hour:null,ip:null,search:null,status:null}),r=()=>{const h=n.query;t.value={category:h.category||null,event:h.event||null,dateFrom:h.dateFrom||h.date||a,dateTo:h.dateTo||null,hour:h.hour?parseInt(h.hour):null,ip:h.ip||null,search:h.search||null,status:h.status||null}},i=h=>{if(u)return;const y={...n.query};Object.keys(h).forEach(k=>{const A=h[k];A!==null&&A!==""&&A!==void 0?y[k]=A.toString():delete y[k]}),JSON.stringify(y)!==JSON.stringify(n.query)&&(u=!0,e.replace({path:n.path,query:y}).finally(()=>{setTimeout(()=>{u=!1},100)}))},o=h=>{const y={...t.value,...h};JSON.stringify(t.value)!==JSON.stringify(y)&&(t.value=y,i(t.value))},l=()=>{t.value={category:null,event:null,dateFrom:a,dateTo:null,hour:null,ip:null,search:null,status:null},i(t.value)};de(()=>{r()});let u=!1;return ee(()=>n.query,(h,y)=>{if(u)return;JSON.stringify(h)!==JSON.stringify(y)&&r()},{deep:!0}),{filters:t,updateFilters:o,clearFilters:l,loadFiltersFromUrl:r}}function ra(n,e,a={}){if(!e||!e.trim())return n;const{caseSensitive:t=!1,searchInEvent:r=!0,searchInPayload:i=!0,searchInDetails:o=!0,searchInIp:l=!0,searchInTimestamp:u=!1}=a,h=t?e.trim():e.trim().toLowerCase();return n.filter(y=>{if(r&&y.event&&(t?y.event:y.event.toLowerCase()).includes(h))return!0;if(i&&y.payload)try{const g=JSON.stringify(y.payload);if((t?g:g.toLowerCase()).includes(h))return!0}catch(g){console.warn("Error searching in payload:",g)}if(o&&y.details)try{const g=JSON.stringify(y.details);if((t?g:g.toLowerCase()).includes(h))return!0}catch(g){console.warn("Error searching in details:",g)}return!!(l&&y.ip&&(t?y.ip:y.ip.toLowerCase()).includes(h)||u&&y.timestamp&&(t?y.timestamp:y.timestamp.toLowerCase()).includes(h))})}function lt(n){if(!n||typeof n!="object"||n.category!==void 0&&n.category!==null&&!["tasks","smart-processes","errors"].includes(n.category)||n.date!==void 0&&n.date!==null&&!/^\d{4}-\d{2}-\d{2}$/.test(n.date))return!1;if(n.hour!==void 0&&n.hour!==null){const e=parseInt(n.hour,10);if(isNaN(e)||e<0||e>23)return!1}return!(n.ip!==void 0&&n.ip!==null&&(typeof n.ip!="string"||n.ip.length===0))}function ia(n){if(!n||typeof n!="object")return!1;const e=parseInt(n.page,10),a=parseInt(n.limit,10),t=parseInt(n.total,10),r=parseInt(n.pages,10);return!(isNaN(e)||e<1||isNaN(a)||a<1||a>1e3||isNaN(t)||t<0||isNaN(r)||r<0)}function wt(n){if(n==null)return"";const e=String(n),a=e.replace(/"/g,'""');return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${a}"`:a}function la(n){return n==null?"":typeof n=="object"?JSON.stringify(n):String(n)}function ca(n,e="webhook-logs.csv",a={}){return new Promise((t,r)=>{try{if(!Array.isArray(n)||n.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{columns:i=null,onProgress:o=null}=a,l=i||Object.keys(n[0]),h=[l.map(E=>wt(E)).join(",")],y=n.length,g=1e3;for(let E=0;E<y;E+=g){const S=n.slice(E,E+g);if(S.forEach(I=>{const f=l.map(v=>{const w=I[v];return wt(la(w))});h.push(f.join(","))}),o){const I=Math.min(100,Math.round((E+S.length)/y*100));o(I)}}const k="\uFEFF"+h.join(`
`),A=new Blob([k],{type:"text/csv;charset=utf-8;"});Ut(A,e),o&&o(100),t()}catch(i){r(i)}})}function da(n,e="webhook-logs.json",a={}){return new Promise((t,r)=>{try{if(!Array.isArray(n)||n.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{pretty:i=!0,onProgress:o=null}=a,l=i?JSON.stringify(n,null,2):JSON.stringify(n);o&&o(50);const u=new Blob([l],{type:"application/json;charset=utf-8;"});Ut(u,e),o&&o(100),t()}catch(i){r(i)}})}function Ut(n,e){const a=URL.createObjectURL(n),t=document.createElement("a");t.href=a,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(a)},100)}function ua(n,e={},a=0){const t=new Date().toISOString().split("T")[0],r=new Date().toTimeString().split(" ")[0].replace(/:/g,"-");let i=`webhook-logs_${t}_${r}`;const o=[];return e.category&&o.push(`cat-${e.category}`),e.event&&o.push(`evt-${e.event.substring(0,10)}`),e.dateFrom&&o.push(`from-${e.dateFrom}`),e.dateTo&&o.push(`to-${e.dateTo}`),o.length>0&&(i+=`_${o.join("-")}`),a>0&&(i+=`_${a}records`),`${i}.${n}`}function ma(n){const e=[];if(!Array.isArray(n))return e.push("–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),{valid:!1,errors:e,estimatedSize:0};if(n.length===0)return e.push("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"),{valid:!1,errors:e,estimatedSize:0};const a=JSON.stringify(n).length,t=50*1024*1024;return a>t&&e.push(`–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö (${Math.round(a/1024/1024)} MB). –≠–∫—Å–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è.`),{valid:e.length===0,errors:e,estimatedSize:a}}function ft(n,e="short"){if(!n)return"‚Äî";try{const a=new Date(n);if(isNaN(a.getTime()))return"Invalid date";switch(e){case"short":return a.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});case"long":return a.toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});case"relative":return ga(a);default:return a.toLocaleString("ru-RU")}}catch{return"Invalid date"}}function ga(n){const a=new Date-n,t=Math.floor(a/1e3),r=Math.floor(t/60),i=Math.floor(r/60),o=Math.floor(i/24);return t<60?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":r<60?`${r} ${rt(r,"–º–∏–Ω—É—Ç—É","–º–∏–Ω—É—Ç—ã","–º–∏–Ω—É—Ç")} –Ω–∞–∑–∞–¥`:i<24?`${i} ${rt(i,"—á–∞—Å","—á–∞—Å–∞","—á–∞—Å–æ–≤")} –Ω–∞–∑–∞–¥`:o<7?`${o} ${rt(o,"–¥–µ–Ω—å","–¥–Ω—è","–¥–Ω–µ–π")} –Ω–∞–∑–∞–¥`:ft(n.toISOString(),"short")}function rt(n,e,a,t){const r=n%10,i=n%100;return r===1&&i!==11?e:r>=2&&r<=4&&(i<10||i>=20)?a:t}function We(n){return n?n.replace(/^ON/,"").split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):"‚Äî"}function Pe(n){return{tasks:"–ó–∞–¥–∞—á–∏","smart-processes":"–°–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å—ã",errors:"–û—à–∏–±–∫–∏"}[n]||n}function vt(n){if(!n||typeof n!="object")return"‚Äî";const e=[];if(n.task_id&&e.push(`–ó–∞–¥–∞—á–∞ #${n.task_id}`),n.entity_id&&e.push(`–°—É—â–Ω–æ—Å—Ç—å #${n.entity_id}`),n.task_title&&e.push(`"${n.task_title}"`),n.title&&e.push(`"${n.title}"`),n.comment_text){const a=n.comment_text.length>50?n.comment_text.substring(0,50)+"...":n.comment_text;e.push(`–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${a}`)}return e.length>0?e.join(" ‚Ä¢ "):"‚Äî"}const ha={name:"WebhookLogsExport",props:{logs:{type:Array,default:()=>[]},selectedLogs:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},totalCount:{type:Number,default:0}},emits:["export-start","export-complete","export-error"],setup(n,{emit:e}){const a=p(!1),t=p("csv"),r=p("all"),i=p(!0),o=p(!1),l=p(0),u=p([]),h=p(null),y=T(()=>n.selectedLogs.length),g=T(()=>n.logs.length>0||n.totalCount>0),k=T(()=>n.filters.category||n.filters.event||n.filters.dateFrom||n.filters.dateTo),A=T(()=>r.value==="selected"?y.value:n.logs.length||n.totalCount),E=T(()=>r.value==="selected"?y.value>0:g.value),S=()=>{l.value=0,u.value=[],h.value=null,y.value>0?r.value="selected":r.value="all",a.value=!0,f()},I=()=>{o.value||(a.value=!1)},f=()=>{const U=v(),C=ma(U);u.value=C.errors,h.value=C.estimatedSize},v=()=>(r.value==="selected"?n.selectedLogs:n.logs).map(_=>$e(_)).filter(_=>xe(_)?!0:(console.warn("[WebhookLogsExport] Skipping invalid log:",_),!1)),w=async()=>{try{o.value=!0,l.value=0;let U=v();if(U.length===0)throw new Error("–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const C=U.map(L=>({timestamp:L.timestamp,event:L.event,category:L.category,ip:L.ip||null,details:L.details||null,payload:L.payload||null,formatted:{timestamp:ft(L.timestamp),event:We(L.event),category:Pe(L.category),details:vt(L.details)}}));e("export-start",{format:t.value,scope:r.value,count:C.length});const _=ua(t.value,n.filters,C.length),b=L=>{l.value=L};t.value==="csv"?await ca(C,_,{onProgress:b}):await da(C,_,{pretty:i.value,onProgress:b}),e("export-complete",{format:t.value,filename:_,count:C.length}),setTimeout(()=>{o.value=!1,a.value=!1,l.value=0},500)}catch(U){console.error("[WebhookLogsExport] Export error:",U),e("export-error",U),o.value=!1,l.value=0,alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${U.message}`)}},F=U=>U<1024?`${U} B`:U<1024*1024?`${(U/1024).toFixed(2)} KB`:`${(U/1024/1024).toFixed(2)} MB`;return ee([r,()=>n.logs,()=>n.selectedLogs],()=>{a.value&&f()}),{showExportModal:a,exportFormat:t,exportScope:r,jsonPretty:i,exporting:o,exportProgress:l,exportWarnings:u,estimatedSize:h,selectedCount:y,hasAllLogs:g,hasFilters:k,exportCount:A,canExport:E,openExportModal:S,closeExportModal:I,handleExport:w,formatSize:F}}},fa={class:"webhook-logs-export"},va=["disabled","title"],pa={key:0,class:"selected-badge"},ya={class:"export-modal-header"},_a={class:"export-modal-body"},ba={class:"export-section"},wa={class:"radio-group"},Ca={class:"export-section"},ka={class:"radio-group"},Sa=["disabled"],Da={class:"radio-label"},Aa={key:0},Ta={key:1},Ea=["disabled"],Ma={class:"radio-label"},xa={key:0,class:"export-section"},Ia={class:"checkbox-option"},La={class:"export-info"},Pa={class:"info-item"},Fa={class:"info-value"},Ua={key:0,class:"info-item"},Ra={class:"info-value"},Oa={key:1,class:"export-warnings"},Na={key:0,class:"export-progress"},Ba={class:"progress-bar"},Va={class:"progress-text"},ja={class:"export-modal-footer"},za=["disabled"],$a={key:0},Wa={key:1},Ha=["disabled"];function qa(n,e,a,t,r,i){return c(),d("div",fa,[s("button",{onClick:e[0]||(e[0]=(...o)=>t.openExportModal&&t.openExportModal(...o)),class:"btn-export",disabled:!t.canExport,title:t.canExport?"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"},[e[11]||(e[11]=s("span",{class:"btn-icon"},"üì•",-1)),e[12]||(e[12]=s("span",{class:"btn-text"},"–≠–∫—Å–ø–æ—Ä—Ç",-1)),t.selectedCount>0?(c(),d("span",pa,m(t.selectedCount),1)):M("",!0)],8,va),K(Ie,{name:"modal"},{default:_e(()=>[t.showExportModal?(c(),d("div",{key:0,class:"export-modal-overlay",onClick:e[10]||(e[10]=(...o)=>t.closeExportModal&&t.closeExportModal(...o))},[s("div",{class:"export-modal",onClick:e[9]||(e[9]=pe(()=>{},["stop"]))},[s("div",ya,[e[13]||(e[13]=s("h3",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",-1)),s("button",{onClick:e[1]||(e[1]=(...o)=>t.closeExportModal&&t.closeExportModal(...o)),class:"btn-close"},"‚úï")]),s("div",_a,[s("div",ba,[e[16]||(e[16]=s("h4",null,"–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞",-1)),s("div",wa,[s("label",{class:N(["radio-option",{active:t.exportFormat==="csv"}])},[$(s("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=o=>t.exportFormat=o),value:"csv",class:"radio-input"},null,512),[[Ge,t.exportFormat]]),e[14]||(e[14]=s("span",{class:"radio-label"},[s("strong",null,"CSV"),s("small",null,"–î–ª—è Excel, LibreOffice")],-1))],2),s("label",{class:N(["radio-option",{active:t.exportFormat==="json"}])},[$(s("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=o=>t.exportFormat=o),value:"json",class:"radio-input"},null,512),[[Ge,t.exportFormat]]),e[15]||(e[15]=s("span",{class:"radio-label"},[s("strong",null,"JSON"),s("small",null,"–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, API")],-1))],2)])]),s("div",Ca,[e[19]||(e[19]=s("h4",null,"–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",-1)),s("div",ka,[s("label",{class:N(["radio-option",{active:t.exportScope==="all",disabled:!t.hasAllLogs}])},[$(s("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=o=>t.exportScope=o),value:"all",disabled:!t.hasAllLogs,class:"radio-input"},null,8,Sa),[[Ge,t.exportScope]]),s("span",Da,[e[17]||(e[17]=s("strong",null,"–í—Å–µ –∑–∞–ø–∏—Å–∏",-1)),t.hasFilters?(c(),d("small",Aa,"–° –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ ("+m(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π)",1)):(c(),d("small",Ta,"–í—Å–µ–≥–æ: "+m(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π",1))])],2),s("label",{class:N(["radio-option",{active:t.exportScope==="selected",disabled:t.selectedCount===0}])},[$(s("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=o=>t.exportScope=o),value:"selected",disabled:t.selectedCount===0,class:"radio-input"},null,8,Ea),[[Ge,t.exportScope]]),s("span",Ma,[e[18]||(e[18]=s("strong",null,"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏",-1)),s("small",null,m(t.selectedCount)+" –∑–∞–ø–∏—Å–µ–π –≤—ã–±—Ä–∞–Ω–æ",1)])],2)])]),t.exportFormat==="json"?(c(),d("div",xa,[e[21]||(e[21]=s("h4",null,"–û–ø—Ü–∏–∏ JSON",-1)),s("label",Ia,[$(s("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=o=>t.jsonPretty=o),class:"checkbox-input"},null,512),[[Be,t.jsonPretty]]),e[20]||(e[20]=s("span",{class:"checkbox-label"},"–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)",-1))])])):M("",!0),s("div",La,[s("div",Pa,[e[22]||(e[22]=s("span",{class:"info-label"},"–ó–∞–ø–∏—Å–µ–π –∫ —ç–∫—Å–ø–æ—Ä—Ç—É:",-1)),s("span",Fa,m(t.exportCount),1)]),t.estimatedSize?(c(),d("div",Ua,[e[23]||(e[23]=s("span",{class:"info-label"},"–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä:",-1)),s("span",Ra,m(t.formatSize(t.estimatedSize)),1)])):M("",!0)]),t.exportWarnings.length>0?(c(),d("div",Oa,[(c(!0),d(j,null,z(t.exportWarnings,(o,l)=>(c(),d("div",{key:l,class:"warning-item"}," ‚ö†Ô∏è "+m(o),1))),128))])):M("",!0)]),t.exporting?(c(),d("div",Na,[s("div",Ba,[s("div",{class:"progress-fill",style:Ee({width:`${t.exportProgress}%`})},null,4)]),s("div",Va," –≠–∫—Å–ø–æ—Ä—Ç: "+m(t.exportProgress)+"% ",1)])):M("",!0),s("div",ja,[s("button",{onClick:e[7]||(e[7]=(...o)=>t.handleExport&&t.handleExport(...o)),disabled:t.exporting||!t.canExport,class:"btn-primary"},[t.exporting?(c(),d("span",$a,"–≠–∫—Å–ø–æ—Ä—Ç...")):(c(),d("span",Wa,"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"))],8,za),s("button",{onClick:e[8]||(e[8]=(...o)=>t.closeExportModal&&t.closeExportModal(...o)),disabled:t.exporting,class:"btn-secondary"}," –û—Ç–º–µ–Ω–∞ ",8,Ha)])])])):M("",!0)]),_:1})])}const Ja=J(ha,[["render",qa],["__scopeId","data-v-7ae66f8c"]]);function Rt(n,e=300){let a;return function(...r){const i=()=>{clearTimeout(a),n(...r)};clearTimeout(a),a=setTimeout(i,e)}}const Xa={name:"WebhookLogSearch",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","search"],setup(n,{emit:e}){const a=p(n.modelValue||""),t=p(!1),r=p(null),i=Rt(A=>{t.value=!1,e("search",A)},400),o=()=>{t.value=!0,e("update:modelValue",a.value),i(a.value)},l=()=>{t.value=!1,e("search",a.value)},u=()=>{a.value="",t.value=!1,r.value=null,e("update:modelValue",""),e("search","")};return ee(()=>n.modelValue,A=>{A!==a.value&&(a.value=A)}),{searchQuery:a,isSearching:t,searchResultsCount:r,handleSearchInput:o,handleSearch:l,clearSearch:u,setResultsCount:A=>{r.value=A},getResultsText:A=>{const E=A%10,S=A%100;return S>=11&&S<=19?"–∑–∞–ø–∏—Å–µ–π":E===1?"–∑–∞–ø–∏—Å—å":E>=2&&E<=4?"–∑–∞–ø–∏—Å–∏":"–∑–∞–ø–∏—Å–µ–π"},performSearch:(A,E)=>{if(!A||!E||!Array.isArray(E))return[];const S=A.toLowerCase().trim();return S.length===0?E:E.map(f=>$e(f)).filter(f=>xe(f)).filter(f=>{if(f.event&&f.event.toLowerCase().includes(S)||f.category&&f.category.toLowerCase().includes(S)||f.ip&&f.ip.toLowerCase().includes(S)||f.details&&typeof f.details=="object"&&(f.details.task_id&&String(f.details.task_id).includes(S)||f.details.task_title&&f.details.task_title.toLowerCase().includes(S)||f.details.entity_id&&String(f.details.entity_id).includes(S)||f.details.title&&f.details.title.toLowerCase().includes(S)||f.details.comment_text&&f.details.comment_text.toLowerCase().includes(S)))return!0;if(f.payload&&typeof f.payload=="object")try{if(JSON.stringify(f.payload).toLowerCase().includes(S))return!0}catch{}return!1})},formatSearchResult:A=>{const E=[];if(A.event&&E.push(We(A.event)),A.category&&E.push(Pe(A.category)),A.details){const S=vt(A.details);S!=="‚Äî"&&E.push(S)}return E.join(" ‚Ä¢ ")}}}},Ya={class:"webhook-search"},Ka={class:"search-wrapper"},Ga={key:0,class:"search-indicator"},Qa={key:1,class:"search-results"};function Za(n,e,a,t,r,i){return c(),d("div",Ya,[s("div",Ka,[e[5]||(e[5]=s("span",{class:"search-icon"},"üîç",-1)),$(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.searchQuery=o),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ª–æ–≥–æ–≤ (—Å–æ–±—ã—Ç–∏–µ, payload, IP, –¥–µ—Ç–∞–ª–∏)...",class:"search-input",onInput:e[1]||(e[1]=(...o)=>t.handleSearchInput&&t.handleSearchInput(...o)),onKeyup:[e[2]||(e[2]=De((...o)=>t.handleSearch&&t.handleSearch(...o),["enter"])),e[3]||(e[3]=De((...o)=>t.clearSearch&&t.clearSearch(...o),["esc"]))]},null,544),[[be,t.searchQuery]]),t.searchQuery?(c(),d("button",{key:0,onClick:e[4]||(e[4]=(...o)=>t.clearSearch&&t.clearSearch(...o)),class:"clear-button",title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ (Esc)","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):M("",!0)]),t.isSearching?(c(),d("div",Ga,[...e[6]||(e[6]=[s("span",{class:"spinner"},null,-1),Q(" –ü–æ–∏—Å–∫... ",-1)])])):M("",!0),t.searchQuery&&t.searchResultsCount!==null?(c(),d("div",Qa," –ù–∞–π–¥–µ–Ω–æ: "+m(t.searchResultsCount)+" "+m(t.getResultsText(t.searchResultsCount)),1)):M("",!0)])}const eo=J(Xa,[["render",Za],["__scopeId","data-v-db228863"]]);function to(n,e=null){const a=()=>{try{const o=localStorage.getItem(n);return o?JSON.parse(o):e}catch(o){return console.error(`Error loading ${n} from localStorage:`,o),e}},t=o=>{try{localStorage.setItem(n,JSON.stringify(o))}catch(l){console.error(`Error saving ${n} to localStorage:`,l)}},r=()=>{try{localStorage.removeItem(n)}catch(o){console.error(`Error clearing ${n} from localStorage:`,o)}},i=p(a());return ee(i,o=>{t(o)},{deep:!0}),{value:i,save:t,load:a,clear:r}}const so={name:"WebhookLogFilters",props:{filters:{type:Object,required:!0}},emits:["update:filters","reset"],setup(n,{emit:e}){const a=p(null),t=to("webhook-filters",{category:null,event:null,dateFrom:null,dateTo:null,hour:null,ip:null,status:null}),r=_=>(a.value=null,lt(_)?(e("update:filters",_),!0):(a.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",console.error("[WebhookLogFilters] Validation error:",a.value),!1)),i=new Date().toISOString().split("T")[0],o=p({category:t.value.category||n.filters.category||null,event:t.value.event||n.filters.event||null,dateFrom:t.value.dateFrom||n.filters.dateFrom||n.filters.date||i,dateTo:t.value.dateTo||n.filters.dateTo||null,hour:t.value.hour!==void 0?t.value.hour:n.filters.hour!==void 0?n.filters.hour:null,ip:t.value.ip||n.filters.ip||null,status:t.value.status||n.filters.status||null}),l=p(null),u=[{id:"today",label:"–°–µ–≥–æ–¥–Ω—è",getDates:()=>({from:i,to:i})},{id:"yesterday",label:"–í—á–µ—Ä–∞",getDates:()=>{const _=new Date;_.setDate(_.getDate()-1);const b=_.toISOString().split("T")[0];return{from:b,to:b}}},{id:"last7days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",getDates:()=>{const _=new Date;return _.setDate(_.getDate()-7),{from:_.toISOString().split("T")[0],to:i}}},{id:"last30days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π",getDates:()=>{const _=new Date;return _.setDate(_.getDate()-30),{from:_.toISOString().split("T")[0],to:i}}}],h=_=>{const b=u.find(L=>L.id===_);if(b){const L=b.getDates();o.value.dateFrom=L.from,o.value.dateTo=L.to,l.value=_,U()}};ee(()=>n.filters,_=>{o.value={category:_.category||null,event:_.event||null,dateFrom:_.dateFrom||_.date||i,dateTo:_.dateTo||null,hour:_.hour!==void 0?_.hour:null,ip:_.ip||null,status:_.status||null}},{deep:!0}),ee(o,_=>{t.value={..._},e("update:filters",{..._})},{deep:!0});const y=T(()=>{const _={};return o.value.category&&(_.category=o.value.category),o.value.event&&(_.event=o.value.event),o.value.hour!==null&&(_.hour=o.value.hour),o.value.ip&&(_.ip=o.value.ip),o.value.status&&(_.status=o.value.status),o.value.dateFrom&&o.value.dateFrom!==i&&(_.dateFrom=o.value.dateFrom),o.value.dateTo&&(_.dateTo=o.value.dateTo),_}),g=T(()=>Object.keys(y.value).length>0),k=_=>({category:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è",event:"–°–æ–±—ã—Ç–∏–µ",hour:"–ß–∞—Å",ip:"IP –∞–¥—Ä–µ—Å",status:"–°—Ç–∞—Ç—É—Å",dateFrom:"–î–∞—Ç–∞ –æ—Ç",dateTo:"–î–∞—Ç–∞ –¥–æ"})[_]||_,A=(_,b)=>_==="category"?Pe(b)||b:_==="hour"?`${String(b).padStart(2,"0")}:00`:_==="event"?We(b)||b:_==="status"&&{success:"–£—Å–ø–µ—à–Ω–æ",error:"–û—à–∏–±–∫–∞",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"}[b]||b,E=T(()=>[{value:null,label:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},{value:"tasks",label:Pe("tasks")},{value:"smart-processes",label:Pe("smart-processes")},{value:"errors",label:Pe("errors")}]),S=T(()=>[{value:null,label:"–í—Å–µ —Å–æ–±—ã—Ç–∏—è"},...["ONTASKADD","ONTASKUPDATE","ONTASKDELETE","ONTASKCOMMENTADD","ONTASKCOMMENTUPDATE","ONTASKCOMMENTDELETE","ONCRMDYNAMICITEMADD","ONCRMDYNAMICITEMUPDATE","ONCRMDYNAMICITEMDELETE"].map(b=>({value:b,label:We(b)}))]),I=_=>{_==="hour"?o.value[_]=null:_==="dateFrom"?o.value[_]=i:o.value[_]=null,l.value=null},f=_=>{const b={...o.value,category:_||null};r(b)&&(o.value.category=_)},v=_=>{const b={...o.value,event:_||null};r(b)&&(o.value.event=_)},w=(_,b)=>{if(_&&!/^\d{4}-\d{2}-\d{2}$/.test(_)){console.error("[WebhookLogFilters] Invalid date format:",_),a.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã";return}const L={...o.value,[b]:_||null};r(L)&&(o.value[b]=_)},F=_=>{if(_!=null){const L=parseInt(_,10);if(isNaN(L)||L<0||L>23){console.error("[WebhookLogFilters] Invalid hour:",_),a.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∞—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23)";return}}const b={...o.value,hour:_!=null?parseInt(_,10):null};r(b)&&(o.value.hour=_!=null?parseInt(_,10):null)},U=()=>{r({...o.value})},C=()=>{o.value={category:null,event:null,dateFrom:i,dateTo:null,hour:null,ip:null,status:null},l.value=null,t.clear(),e("reset")};return de(()=>{t.value&&Object.keys(t.value).length>0&&e("update:filters",{...t.value})}),{localFilters:o,activeFilters:y,hasActiveFilters:g,getFilterLabel:k,getFilterValue:A,clearFilter:I,handleFilterChange:U,handleCategoryChange:f,handleEventChange:v,handleDateChange:w,handleHourChange:F,handleReset:C,quickFilters:u,activeQuickFilter:l,applyQuickFilter:h,categoryOptions:E,eventOptions:S,validationError:a}}},ao={class:"webhook-log-filters"},oo={key:0,class:"active-filters-indicator"},no=["onClick"],ro={key:1,class:"validation-error"},io={class:"quick-filters"},lo=["onClick"],co={class:"filters-row"},uo={class:"filter-group"},mo=["value"],go={class:"filter-group"},ho=["value"],fo={class:"filter-group"},vo={class:"filter-group"},po={class:"filter-group"},yo={class:"filter-group"},_o={class:"filter-group"};function bo(n,e,a,t,r,i){return c(),d("div",ao,[t.hasActiveFilters?(c(),d("div",oo,[e[14]||(e[14]=s("span",{class:"indicator-text"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(j,null,z(t.activeFilters,(o,l)=>(c(),d("span",{key:l,class:"filter-badge"},[Q(m(t.getFilterLabel(l))+": "+m(t.getFilterValue(l,o))+" ",1),s("button",{onClick:u=>t.clearFilter(l),class:"filter-badge-remove",title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"}," √ó ",8,no)]))),128)),s("button",{onClick:e[0]||(e[0]=(...o)=>t.handleReset&&t.handleReset(...o)),class:"btn-clear-all"}," –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ ")])):M("",!0),t.validationError?(c(),d("div",ro," ‚ö†Ô∏è "+m(t.validationError),1)):M("",!0),s("div",io,[e[15]||(e[15]=s("span",{class:"quick-filters-label"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(j,null,z(t.quickFilters,o=>(c(),d("button",{key:o.id,onClick:l=>t.applyQuickFilter(o.id),class:N(["quick-filter-btn",{active:t.activeQuickFilter===o.id}])},m(o.label),11,lo))),128))]),s("div",co,[s("div",uo,[e[16]||(e[16]=s("label",{for:"category-filter"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è:",-1)),$(s("select",{id:"category-filter","onUpdate:modelValue":e[1]||(e[1]=o=>t.localFilters.category=o),onChange:e[2]||(e[2]=o=>t.handleCategoryChange(t.localFilters.category)),class:"filter-select"},[(c(!0),d(j,null,z(t.categoryOptions,o=>(c(),d("option",{key:o.value,value:o.value},m(o.label),9,mo))),128))],544),[[re,t.localFilters.category]])]),s("div",go,[e[17]||(e[17]=s("label",{for:"event-filter"},"–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:",-1)),$(s("select",{id:"event-filter","onUpdate:modelValue":e[3]||(e[3]=o=>t.localFilters.event=o),onChange:e[4]||(e[4]=o=>t.handleEventChange(t.localFilters.event)),class:"filter-select"},[(c(!0),d(j,null,z(t.eventOptions,o=>(c(),d("option",{key:o.value,value:o.value},m(o.label),9,ho))),128))],544),[[re,t.localFilters.event]])]),s("div",fo,[e[18]||(e[18]=s("label",{for:"date-from-filter"},"–î–∞—Ç–∞ –æ—Ç:",-1)),$(s("input",{id:"date-from-filter","onUpdate:modelValue":e[5]||(e[5]=o=>t.localFilters.dateFrom=o),type:"date",onChange:e[6]||(e[6]=o=>t.handleDateChange(t.localFilters.dateFrom,"dateFrom")),class:"filter-input"},null,544),[[be,t.localFilters.dateFrom]])]),s("div",vo,[e[19]||(e[19]=s("label",{for:"date-to-filter"},"–î–∞—Ç–∞ –¥–æ:",-1)),$(s("input",{id:"date-to-filter","onUpdate:modelValue":e[7]||(e[7]=o=>t.localFilters.dateTo=o),type:"date",onChange:e[8]||(e[8]=o=>t.handleDateChange(t.localFilters.dateTo,"dateTo")),class:"filter-input"},null,544),[[be,t.localFilters.dateTo]])]),s("div",po,[e[20]||(e[20]=s("label",{for:"ip-filter"},"IP –∞–¥—Ä–µ—Å:",-1)),$(s("input",{id:"ip-filter","onUpdate:modelValue":e[9]||(e[9]=o=>t.localFilters.ip=o),type:"text",placeholder:"192.168.1.1",onInput:e[10]||(e[10]=(...o)=>t.handleFilterChange&&t.handleFilterChange(...o)),class:"filter-input"},null,544),[[be,t.localFilters.ip]])]),s("div",yo,[e[22]||(e[22]=s("label",{for:"status-filter"},"–°—Ç–∞—Ç—É—Å:",-1)),$(s("select",{id:"status-filter","onUpdate:modelValue":e[11]||(e[11]=o=>t.localFilters.status=o),onChange:e[12]||(e[12]=(...o)=>t.handleFilterChange&&t.handleFilterChange(...o)),class:"filter-select"},[...e[21]||(e[21]=[s("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),s("option",{value:"success"},"–£—Å–ø–µ—à–Ω–æ",-1),s("option",{value:"error"},"–û—à–∏–±–∫–∞",-1),s("option",{value:"warning"},"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",-1)])],544),[[re,t.localFilters.status]])]),s("div",_o,[s("button",{onClick:e[13]||(e[13]=(...o)=>t.handleReset&&t.handleReset(...o)),class:"btn-reset"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])])}const wo=J(so,[["render",bo],["__scopeId","data-v-2a150a46"]]),Co={name:"WebhookLogList",props:{logs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null},pagination:{type:Object,default:null},selectedLogs:{type:Array,default:()=>[]}},emits:["select-log","page-change","update:selectedLogs"],setup(n,{emit:e}){const a=T(()=>!n.logs||!Array.isArray(n.logs)?(console.warn("[WebhookLogList] Invalid logs prop:",n.logs),[]):n.logs.map(b=>$e(b)).filter(b=>xe(b)?!0:(console.warn("[WebhookLogList] Invalid log entry:",b),!1))),t=p("timestamp"),r=p("desc"),i=b=>{t.value===b?r.value=r.value==="asc"?"desc":"asc":(t.value=b,r.value="desc")},o=T(()=>!a.value||a.value.length===0?[]:[...a.value].sort((L,V)=>{let O,D;switch(t.value){case"timestamp":O=new Date(L.timestamp||0).getTime(),D=new Date(V.timestamp||0).getTime();break;case"event":O=(L.event||"").toLowerCase(),D=(V.event||"").toLowerCase();break;case"category":O=(L.category||"").toLowerCase(),D=(V.category||"").toLowerCase();break;case"ip":O=(L.ip||"").toLowerCase(),D=(V.ip||"").toLowerCase();break;default:return 0}return O<D?r.value==="asc"?-1:1:O>D?r.value==="asc"?1:-1:0})),l=b=>t.value!==b?"‚ÜïÔ∏è":r.value==="asc"?"‚Üë":"‚Üì",u=b=>b.category==="errors"?"status-error":"status-success",h=b=>b.category==="errors"?"‚ùå":"‚úÖ",y=b=>b.category==="errors"?"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏":"–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ",g=b=>`${b.timestamp}_${b.event}_${b.ip||"unknown"}`,k=b=>b?ft(b,"short"):"‚Äî",A=b=>b?We(b):"‚Äî",E=b=>b?Pe(b):"‚Äî",S=b=>!b||typeof b!="object"?"‚Äî":vt(b),I=b=>`category-${b}`,f=b=>b?.startsWith("ONTASK")?"event-task":b?.startsWith("ONCRMDYNAMIC")?"event-smart-process":"event-other",v=b=>{e("select-log",b)},w=b=>{b>=1&&b<=n.pagination.pages&&e("page-change",b)},F=b=>n.selectedLogs.some(L=>g(L)===g(b)),U=(b,L)=>{L.stopPropagation();const V=[...n.selectedLogs],O=g(b),D=V.findIndex(H=>g(H)===O);L.target.checked?D===-1&&V.push(b):D!==-1&&V.splice(D,1),e("update:selectedLogs",V)},C=b=>{b.target.checked?e("update:selectedLogs",[...n.logs]):e("update:selectedLogs",[])},_=T(()=>a.value.length>0&&a.value.every(b=>F(b)));return ee(()=>n.logs,b=>{if(b&&Array.isArray(b)){const L=b.filter(V=>!xe(V)).length;L>0&&console.warn(`[WebhookLogList] Received ${L} invalid log entries out of ${b.length}`)}},{immediate:!0}),{validatedLogs:a,sortBy:t,sortOrder:r,sortedLogs:o,handleSort:i,getSortIcon:l,getStatusClass:u,getStatusIcon:h,getStatusTitle:y,getLogId:g,formatTimestamp:k,formatEvent:A,formatCategoryLabel:E,formatDetailsPreview:S,getCategoryClass:I,getEventClass:f,handleLogClick:v,handlePageChange:w,isSelected:F,handleSelectLog:U,handleSelectAll:C,allSelected:_}}},ko={class:"webhook-log-list"},So={key:0,class:"logs-table-container"},Do={class:"logs-table"},Ao={class:"checkbox-header"},To=["checked"],Eo={class:"sort-icon"},Mo={class:"sort-icon"},xo={class:"sort-icon"},Io={class:"sort-icon"},Lo=["onClick"],Po=["checked","onChange"],Fo=["title"],Uo={class:"details-preview"},Ro=["onClick"],Oo={key:0,class:"pagination"},No=["disabled"],Bo={class:"pagination-info"},Vo=["disabled"];function jo(n,e,a,t,r,i){return c(),d("div",ko,[a.logs.length>0?(c(),d("div",So,[s("table",Do,[s("thead",null,[s("tr",null,[s("th",Ao,[s("input",{type:"checkbox",checked:t.allSelected,onChange:e[0]||(e[0]=(...o)=>t.handleSelectAll&&t.handleSelectAll(...o)),onClick:e[1]||(e[1]=pe(()=>{},["stop"])),class:"checkbox-input",title:"–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"},null,40,To)]),s("th",{onClick:e[2]||(e[2]=o=>t.handleSort("timestamp")),class:N(["sortable",{"sort-asc":t.sortBy==="timestamp"&&t.sortOrder==="asc","sort-desc":t.sortBy==="timestamp"&&t.sortOrder==="desc"}])},[e[9]||(e[9]=Q(" –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è ",-1)),s("span",Eo,m(t.getSortIcon("timestamp")),1)],2),s("th",{onClick:e[3]||(e[3]=o=>t.handleSort("event")),class:N(["sortable",{"sort-asc":t.sortBy==="event"&&t.sortOrder==="asc","sort-desc":t.sortBy==="event"&&t.sortOrder==="desc"}])},[e[10]||(e[10]=Q(" –¢–∏–ø —Å–æ–±—ã—Ç–∏—è ",-1)),s("span",Mo,m(t.getSortIcon("event")),1)],2),s("th",{onClick:e[4]||(e[4]=o=>t.handleSort("category")),class:N(["sortable",{"sort-asc":t.sortBy==="category"&&t.sortOrder==="asc","sort-desc":t.sortBy==="category"&&t.sortOrder==="desc"}])},[e[11]||(e[11]=Q(" –ö–∞—Ç–µ–≥–æ—Ä–∏—è ",-1)),s("span",xo,m(t.getSortIcon("category")),1)],2),s("th",{onClick:e[5]||(e[5]=o=>t.handleSort("ip")),class:N(["sortable",{"sort-asc":t.sortBy==="ip"&&t.sortOrder==="asc","sort-desc":t.sortBy==="ip"&&t.sortOrder==="desc"}])},[e[12]||(e[12]=Q(" IP ",-1)),s("span",Io,m(t.getSortIcon("ip")),1)],2),e[13]||(e[13]=s("th",null,"–î–µ—Ç–∞–ª–∏",-1)),e[14]||(e[14]=s("th",null,"–î–µ–π—Å—Ç–≤–∏—è",-1))])]),s("tbody",null,[(c(!0),d(j,null,z(t.sortedLogs,o=>(c(),d("tr",{key:t.getLogId(o),onClick:l=>t.handleLogClick(o),class:N(["log-row",{"row-selected":t.isSelected(o)}])},[s("td",{onClick:e[6]||(e[6]=pe(()=>{},["stop"]))},[s("input",{type:"checkbox",checked:t.isSelected(o),onChange:l=>t.handleSelectLog(o,l),class:"checkbox-input"},null,40,Po)]),s("td",null,m(t.formatTimestamp(o.timestamp)),1),s("td",null,[s("span",{class:N(["status-indicator",t.getStatusClass(o)]),title:t.getStatusTitle(o)},m(t.getStatusIcon(o)),11,Fo),s("span",{class:N(["event-badge",t.getEventClass(o.event)])},m(t.formatEvent(o.event)),3)]),s("td",null,[s("span",{class:N(["category-badge",t.getCategoryClass(o.category)])},m(t.formatCategoryLabel(o.category)),3)]),s("td",null,m(o.ip||"N/A"),1),s("td",null,[s("div",Uo,m(t.formatDetailsPreview(o.details)),1)]),s("td",null,[s("button",{onClick:pe(l=>t.handleLogClick(o),["stop"]),class:"btn-view"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,Ro)])],10,Lo))),128))])]),a.pagination&&a.pagination.pages>1?(c(),d("div",Oo,[s("button",{onClick:e[7]||(e[7]=o=>t.handlePageChange(a.pagination.page-1)),disabled:a.pagination.page<=1,class:"btn-pagination"}," –ù–∞–∑–∞–¥ ",8,No),s("span",Bo," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+m(a.pagination.page)+" –∏–∑ "+m(a.pagination.pages)+" (–≤—Å–µ–≥–æ: "+m(a.pagination.total)+") ",1),s("button",{onClick:e[8]||(e[8]=o=>t.handlePageChange(a.pagination.page+1)),disabled:a.pagination.page>=a.pagination.pages,class:"btn-pagination"}," –í–ø–µ—Ä—ë–¥ ",8,Vo)])):M("",!0)])):M("",!0)])}const zo=J(Co,[["render",jo],["__scopeId","data-v-fddd3018"]]),$o={name:"LoadingSkeleton",props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"20px"},variant:{type:String,default:"rect",validator:n=>["rect","circle","text","table-row"].includes(n)},animated:{type:Boolean,default:!0},borderRadius:{type:String,default:null}},setup(n){return{skeletonStyle:T(()=>{const a={width:typeof n.width=="number"?`${n.width}px`:n.width,height:typeof n.height=="number"?`${n.height}px`:n.height};return n.borderRadius&&(a.borderRadius=n.borderRadius),a})}}},Wo={key:0,class:"skeleton-shimmer"};function Ho(n,e,a,t,r,i){return c(),d("div",{class:N(["skeleton",[`skeleton-${a.variant}`,{"skeleton-animated":a.animated}]]),style:Ee(t.skeletonStyle)},[a.animated?(c(),d("div",Wo)):M("",!0)],6)}const qo=J($o,[["render",Ho],["__scopeId","data-v-014f86e6"]]),Jo={name:"SkeletonLogList",components:{LoadingSkeleton:qo},props:{rows:{type:Number,default:5}},setup(){return{getColumnWidth:e=>["40px","15%","20%","15%","15%","20%","15%"][e-1]||"100%"}}},Xo={class:"skeleton-log-list"},Yo={class:"skeleton-table-header"};function Ko(n,e,a,t,r,i){const o=W("LoadingSkeleton");return c(),d("div",Xo,[s("div",Yo,[(c(),d(j,null,z(7,l=>K(o,{key:l,width:"120px",height:"16px",variant:"text"})),64))]),(c(!0),d(j,null,z(a.rows,l=>(c(),d("div",{key:l,class:"skeleton-table-row"},[(c(),d(j,null,z(7,u=>K(o,{key:u,width:"100%",height:"20px",variant:"text",style:Ee({width:t.getColumnWidth(u)})},null,8,["style"])),64))]))),128))])}const Go=J(Jo,[["render",Ko],["__scopeId","data-v-475c4e73"]]),Qo={name:"EmptyState",props:{icon:{type:String,default:"üì≠"},title:{type:String,required:!0},description:{type:String,required:!0},actionLabel:{type:String,default:null},actions:{type:Array,default:null},hints:{type:Array,default:()=>[]},variant:{type:String,default:"default",validator:n=>["default","error","warning","info"].includes(n)}},emits:["action","action-click"]},Zo={class:"empty-icon"},en={class:"empty-title"},tn={class:"empty-description"},sn={key:0,class:"empty-hints"},an={key:1,class:"empty-actions"},on=["onClick"];function nn(n,e,a,t,r,i){return c(),d("div",{class:N(["empty-state",`empty-state-${a.variant}`])},[s("div",Zo,m(a.icon),1),s("h3",en,m(a.title),1),s("p",tn,m(a.description),1),a.hints&&a.hints.length>0?(c(),d("div",sn,[(c(!0),d(j,null,z(a.hints,(o,l)=>(c(),d("div",{key:l,class:"hint-item"}," üí° "+m(o),1))),128))])):M("",!0),a.actionLabel||a.actions?(c(),d("div",an,[a.actionLabel?(c(),d("button",{key:0,onClick:e[0]||(e[0]=o=>n.$emit("action")),class:"btn-primary"},m(a.actionLabel),1)):M("",!0),(c(!0),d(j,null,z(a.actions,(o,l)=>(c(),d("button",{key:l,onClick:u=>n.$emit("action-click",o.id),class:N(["btn",`btn-${o.variant||"secondary"}`])},m(o.label),11,on))),128))])):M("",!0)],2)}const rn=J(Qo,[["render",nn],["__scopeId","data-v-081c13b9"]]),ln={name:"ErrorDisplay",props:{title:{type:String,default:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"},message:{type:String,required:!0},details:{type:String,default:null},severity:{type:String,default:"error",validator:n=>["error","warning","critical"].includes(n)},retryable:{type:Boolean,default:!1}},emits:["retry"],setup(){return{showDetails:p(!1)}}},cn={class:"error-icon"},dn={class:"error-content"},un={class:"error-title"},mn={class:"error-message"},gn={key:0,class:"error-details"},hn={class:"error-actions"};function fn(n,e,a,t,r,i){return c(),d("div",{class:N(["error-display",`error-${a.severity}`])},[s("div",cn,m(a.severity==="critical"?"üö®":"‚ö†Ô∏è"),1),s("div",dn,[s("h4",un,m(a.title),1),s("p",mn,m(a.message),1),a.details&&t.showDetails?(c(),d("div",gn,[s("pre",null,m(a.details),1)])):M("",!0),s("div",hn,[a.retryable?(c(),d("button",{key:0,onClick:e[0]||(e[0]=o=>n.$emit("retry")),class:"btn-retry"}," üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")):M("",!0),a.details?(c(),d("button",{key:1,onClick:e[1]||(e[1]=o=>t.showDetails=!t.showDetails),class:"btn-details"},m(t.showDetails?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å")+" –¥–µ—Ç–∞–ª–∏ ",1)):M("",!0)])])],2)}const vn=J(ln,[["render",fn],["__scopeId","data-v-3f2f4c14"]]),Je=p([]);let pn=0;function Ot(){const n=(l,u="info",h=3e3)=>{const y=++pn,g={id:y,message:l,type:u,duration:h,timestamp:Date.now()};return Je.value.push(g),h>0&&setTimeout(()=>{e(y)},h),y},e=l=>{const u=Je.value.findIndex(h=>h.id===l);u>-1&&Je.value.splice(u,1)};return{notifications:Je,showNotification:n,removeNotification:e,clearNotifications:()=>{Je.value=[]},success:(l,u=3e3)=>n(l,"success",u),error:(l,u=5e3)=>n(l,"error",u),warning:(l,u=4e3)=>n(l,"warning",u),info:(l,u=3e3)=>n(l,"info",u)}}const yn={name:"Notification",props:{notification:{type:Object,required:!0}},emits:["close"],setup(n,{emit:e}){const a=p(100),t=T(()=>n.notification.duration>0);let r=null;const i={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},o=T(()=>i[n.notification.type]||"‚ÑπÔ∏è"),l=()=>{e("close")},u=()=>{n.notification.onClick&&n.notification.onClick()};return de(()=>{if(t.value&&n.notification.duration>0){const h=Date.now(),y=n.notification.duration;r=setInterval(()=>{const g=Date.now()-h;a.value=Math.max(0,100-g/y*100),a.value<=0&&(clearInterval(r),l())},50)}}),He(()=>{r&&clearInterval(r)}),{icon:o,progress:a,showProgress:t,close:l,handleClick:u}}},_n={class:"notification-content"},bn={class:"notification-icon"},wn={class:"notification-message"},Cn={key:0,class:"notification-progress"};function kn(n,e,a,t,r,i){return c(),d("div",{class:N(["notification",`notification-${a.notification.type}`]),onClick:e[1]||(e[1]=(...o)=>t.handleClick&&t.handleClick(...o))},[s("div",_n,[s("span",bn,m(t.icon),1),s("span",wn,m(a.notification.message),1)]),s("button",{onClick:e[0]||(e[0]=pe((...o)=>t.close&&t.close(...o),["stop"])),class:"notification-close"},"‚úï"),t.showProgress?(c(),d("div",Cn,[s("div",{class:"progress-bar",style:Ee({width:`${t.progress}%`})},null,4)])):M("",!0)],2)}const Sn=J(yn,[["render",kn],["__scopeId","data-v-1b602bdf"]]),Dn={name:"NotificationContainer",components:{Notification:Sn},setup(){const{notifications:n,removeNotification:e}=Ot();return{notifications:n,removeNotification:e}}},An={class:"notification-container"};function Tn(n,e,a,t,r,i){const o=W("Notification");return c(),ne(Ct,{to:"body"},[s("div",An,[K(Xt,{name:"notification",tag:"div"},{default:_e(()=>[(c(!0),d(j,null,z(t.notifications,l=>(c(),ne(o,{key:l.id,notification:l,onClose:u=>t.removeNotification(l.id)},null,8,["notification","onClose"]))),128))]),_:1})])])}const En=J(Dn,[["render",Tn],["__scopeId","data-v-dd8772c8"]]),Mn={name:"RealtimeControls",props:{enabled:{type:Boolean,default:!1},connectionState:{type:String,default:"disconnected"},error:{type:String,default:null}},emits:["toggle"],setup(n,{emit:e}){const a=p(n.enabled);ee(()=>n.enabled,g=>{a.value=g});const t=T(()=>n.connectionState==="connecting"),r=T(()=>!!n.error),i=T(()=>({"status-connected":n.connectionState==="connected","status-connecting":n.connectionState==="connecting","status-disconnected":n.connectionState==="disconnected","status-error":n.connectionState==="error"})),o=T(()=>{switch(n.connectionState){case"connected":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";case"connecting":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...";case"disconnected":return"–û—Ç–∫–ª—é—á–µ–Ω–æ";case"error":return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}}),l=T(()=>o.value),u=T(()=>({"status-connected":n.connectionState==="connected","status-connecting":n.connectionState==="connecting","status-disconnected":n.connectionState==="disconnected","status-error":n.connectionState==="error"})),h=T(()=>n.error?typeof n.error=="string"?n.error:n.error.message?n.error.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞":null);return{localEnabled:a,isConnecting:t,hasError:r,statusClass:i,statusText:o,connectionStatusText:l,connectionStatusClass:u,displayError:h,handleToggle:()=>{e("toggle",a.value)}}}},xn={class:"realtime-controls"},In={class:"control-toggle"},Ln=["disabled"],Pn={class:"status-text"},Fn={key:0,class:"error-message"};function Un(n,e,a,t,r,i){return c(),d("div",xn,[s("label",In,[$(s("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=o=>t.localEnabled=o),onChange:e[1]||(e[1]=(...o)=>t.handleToggle&&t.handleToggle(...o)),disabled:t.isConnecting},null,40,Ln),[[Be,t.localEnabled]]),e[2]||(e[2]=s("span",{class:"toggle-label"},"–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",-1))]),s("div",{class:N(["status-indicator",t.statusClass])},[e[3]||(e[3]=s("span",{class:"status-dot"},null,-1)),s("span",Pn,m(t.statusText),1)],2),t.hasError&&t.displayError?(c(),d("div",Fn," ‚ö†Ô∏è "+m(t.displayError),1)):M("",!0)])}const Rn=J(Mn,[["render",Un],["__scopeId","data-v-af36f073"]]),On={name:"NewLogsIndicator",props:{count:{type:Number,default:0},newLogs:{type:Array,default:()=>[]}},emits:["apply","dismiss"],setup(n,{emit:e}){const a=(o,l,u,h)=>{const y=o%10,g=o%100;return g>=11&&g<=19?h:y===1?l:y>=2&&y<=4?u:h},t=T(()=>!n.newLogs||!Array.isArray(n.newLogs)||n.newLogs.length===0?[]:n.newLogs.map(l=>$e(l)).filter(l=>xe(l)).slice(0,5).map(l=>({...l,formatted:{event:We(l.event),category:Pe(l.category)}})));return{pluralize:a,newLogsPreview:t,handleApply:()=>{if(!n.newLogs||n.newLogs.length===0)return;const o=n.newLogs.map(l=>$e(l)).filter(l=>xe(l));if(o.length===0){console.warn("[NewLogsIndicator] No valid logs to apply");return}e("apply",o)},handleDismiss:()=>{e("dismiss")}}}},Nn={key:0,class:"new-logs-indicator"},Bn={class:"indicator-content"},Vn={class:"indicator-text"},jn={class:"indicator-actions"};function zn(n,e,a,t,r,i){return c(),ne(Ie,{name:"slide-down"},{default:_e(()=>[a.count>0?(c(),d("div",Nn,[s("div",Bn,[e[2]||(e[2]=s("span",{class:"indicator-icon"},"üîî",-1)),s("span",Vn,m(a.count)+" "+m(t.pluralize(a.count,"–Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π")),1),s("div",jn,[s("button",{onClick:e[0]||(e[0]=(...o)=>t.handleApply&&t.handleApply(...o)),class:"btn-apply"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å "),s("button",{onClick:e[1]||(e[1]=(...o)=>t.handleDismiss&&t.handleDismiss(...o)),class:"btn-dismiss"}," ‚úï ")])])])):M("",!0)]),_:1})}const $n=J(On,[["render",zn],["__scopeId","data-v-19791dbc"]]);class Wn{constructor(e,a={}){this.url=e,this.options={reconnectInterval:3e3,maxReconnectAttempts:10,reconnectDelay:1e3,lastTimestamp:null,...a},this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.reconnectTimer=null,this.isManualDisconnect=!1,this.connectionState="disconnected"}updateOptions(e){this.options={...this.options,...e}}connect(){if(this.connectionState==="connected"||this.connectionState==="connecting"){console.warn("[RealtimeService] Already connected or connecting");return}this.isManualDisconnect=!1,this.connectionState="connecting",this.notifyListeners("state-change",{state:this.connectionState});try{let e=this.url;if(!e.startsWith("http://")&&!e.startsWith("https://")){const a=new URL(e,window.location.origin);this.options.lastTimestamp&&a.searchParams.set("last_timestamp",this.options.lastTimestamp),e=a.toString()}else{const a=new URL(e);this.options.lastTimestamp&&a.searchParams.set("last_timestamp",this.options.lastTimestamp),e=a.toString()}console.log("[RealtimeService] Connecting to:",e),this.eventSource=new EventSource(e),this.eventSource.onopen=()=>{console.log("[RealtimeService] EventSource opened"),this.notifyListeners("open",{timestamp:new Date().toISOString()})},this.eventSource.onmessage=a=>{try{const t=JSON.parse(a.data);this.notifyListeners("message",t)}catch(t){console.error("[RealtimeService] Error parsing message:",t)}},this.eventSource.addEventListener("connected",a=>{try{const t=JSON.parse(a.data);console.log("[RealtimeService] Connected event received:",t),this.connectionState="connected",this.reconnectAttempts=0,this.notifyListeners("connected",t),this.notifyListeners("state-change",{state:this.connectionState})}catch(t){console.error("[RealtimeService] Error parsing connected event:",t)}}),this.eventSource.addEventListener("new_logs",a=>{const t=JSON.parse(a.data);if(t.logs&&t.logs.length>0){const r=t.logs[t.logs.length-1];r.timestamp&&(this.options.lastTimestamp=r.timestamp)}this.notifyListeners("new_logs",t)}),this.eventSource.addEventListener("error",a=>{try{const t=JSON.parse(a.data);this.notifyListeners("error",t)}catch{this.notifyListeners("error",{message:"Server error"})}}),this.eventSource.addEventListener("timeout",a=>{try{const t=JSON.parse(a.data);this.notifyListeners("timeout",t)}catch{this.notifyListeners("timeout",{message:"Connection timeout"})}this.reconnect()}),this.eventSource.addEventListener("closed",a=>{try{const t=JSON.parse(a.data);this.notifyListeners("closed",t)}catch{this.notifyListeners("closed",{message:"Connection closed"})}this.isManualDisconnect||this.reconnect()}),this.eventSource.onerror=a=>{console.error("[RealtimeService] Connection error:",a),console.error("[RealtimeService] EventSource readyState:",this.eventSource?.readyState),this.eventSource?.readyState===EventSource.CLOSED?(console.log("[RealtimeService] EventSource closed by server"),this.connectionState="disconnected",this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()):this.eventSource?.readyState===EventSource.CONNECTING?console.log("[RealtimeService] Still connecting..."):(this.connectionState="error",this.notifyListeners("error",{error:a,type:"connection",message:"Failed to connect to realtime stream",readyState:this.eventSource?.readyState}),this.notifyListeners("state-change",{state:this.connectionState}),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isManualDisconnect||this.reconnect())}}catch(e){console.error("[RealtimeService] Error creating EventSource:",e),this.connectionState="error",this.notifyListeners("error",{error:e,type:"initialization"}),this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()}}reconnect(){if(this.isManualDisconnect)return;if(this.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("[RealtimeService] Max reconnect attempts reached"),this.notifyListeners("max-reconnect-attempts",{attempts:this.reconnectAttempts});return}this.reconnectAttempts++;const e=Math.min(this.options.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.options.reconnectInterval);console.log(`[RealtimeService] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},e)}disconnect(){this.isManualDisconnect=!0,this.connectionState="disconnected",this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.notifyListeners("disconnected",{timestamp:new Date().toISOString()}),this.notifyListeners("state-change",{state:this.connectionState})}on(e,a){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(a)}off(e,a){if(this.listeners.has(e)){const t=this.listeners.get(e),r=t.indexOf(a);r>-1&&t.splice(r,1)}}notifyListeners(e,a){this.listeners.has(e)&&this.listeners.get(e).forEach(t=>{try{t(a)}catch(r){console.error(`[RealtimeService] Error in listener for ${e}:`,r)}})}getState(){return this.connectionState}isConnected(){return this.connectionState==="connected"}}function Hn(n,e={}){const{autoConnect:a=!1,enableSound:t=!1,onNewLogs:r=null,validateLogs:i=!0}=e,o=new Wn(n,e),l=p("disconnected"),u=p([]),h=p(0),y=p(null),g=p(null),k=p(0),A=T(()=>l.value==="connected"),E=T(()=>l.value==="connecting"),S=T(()=>l.value==="error"),I=T(()=>h.value>0),f=O=>{l.value=O.state,O.state==="connected"&&(k.value=0,g.value=null)},v=O=>{let D=O.logs||[];if(i){D=ht(D);const H=D.filter(ge=>xe(ge));H.length!==D.length&&console.warn("[useRealtime] Filtered out invalid logs:",D.length-H.length),D=H}D.length!==0&&(u.value.push(...D),h.value+=D.length,y.value=new Date().toISOString(),t&&D.length>0&&V(),r&&r(D))},w=O=>{const D=O.message||O.error?.message||"Connection error";g.value=D,l.value="error",console.error("[useRealtime] Error:",O)},F=O=>{console.warn("[useRealtime] Connection timeout:",O)},U=O=>{g.value=`Max reconnect attempts reached (${O.attempts})`,console.error("[useRealtime] Max reconnect attempts:",O)},C=(O={})=>{g.value=null,O.lastTimestamp!==void 0&&o.updateOptions({lastTimestamp:O.lastTimestamp}),o.on("state-change",f),o.on("new_logs",v),o.on("error",w),o.on("timeout",F),o.on("max-reconnect-attempts",U),o.connect()},_=()=>{o.off("state-change",f),o.off("new_logs",v),o.off("error",w),o.off("timeout",F),o.off("max-reconnect-attempts",U),o.disconnect()},b=()=>{u.value=[],h.value=0},L=O=>{O&&Array.isArray(O)&&(O.unshift(...u.value),b())},V=()=>{try{const O=new Audio("/sounds/notification.mp3");O.volume=.3,O.play().catch(D=>{console.warn("[useRealtime] Failed to play sound:",D)})}catch(O){console.warn("[useRealtime] Sound not available:",O)}};return a&&de(()=>{C()}),He(()=>{_()}),{connectionState:l,isConnected:A,isConnecting:E,hasError:S,newLogs:u,newLogsCount:h,hasNewLogs:I,lastUpdateTime:y,error:g,reconnectAttempts:k,connect:C,disconnect:_,clearNewLogs:b,applyNewLogs:L}}const qn=kt(()=>ve(()=>import("./WebhookLogsDashboard.vue-XTRCf02I.js"),__vite__mapDeps([7,4,1,5,6,2]),import.meta.url)),Jn=kt(()=>ve(()=>import("./WebhookLogDetails.vue-wWg8bca7.js"),__vite__mapDeps([8,4,1,5,6,2]),import.meta.url)),Xn={name:"WebhookLogsPage",components:{WebhookLogsDashboard:qn,WebhookLogsExport:Ja,WebhookLogSearch:eo,WebhookLogFilters:wo,WebhookLogList:zo,WebhookLogDetails:Jn,SkeletonLogList:Go,EmptyState:rn,ErrorDisplay:vn,NotificationContainer:En,RealtimeControls:Rn,NewLogsIndicator:$n},setup(){const n=Ye(),{success:e,error:a}=Ot(),t=p(!1),r=p(!1),i=p(null),o=p(null),l=p([]),u=(x,q=2)=>{if(x==null)return String(x);if(typeof x=="string")return x;const oe=(G,he=0)=>{if(he>10)return"[Max Depth]";if(G==null||typeof G!="object")return G;if(Array.isArray(G))return G.map(me=>oe(me,he+1));const ke={};try{for(const me in G)if(Object.prototype.hasOwnProperty.call(G,me))try{const Ke=G[me];if(typeof Ke=="function"||Ke===void 0)continue;ke[me]=oe(Ke,he+1)}catch{ke[me]="[Error reading property]"}}catch{return"[Error reading object]"}return ke};try{const G=oe(x),he=new WeakSet;return JSON.stringify(G,(ke,me)=>{if(typeof me=="object"&&me!==null){if(he.has(me))return"[Circular]";he.add(me)}return me},q)}catch(G){return console.error("[WebhookLogsPage] Error in safeStringify:",G),`[Error: ${G.message}]`}},h=p(null),y=p([]),g=p(""),k=p(null),A=p(null),E=p(!1),{connectionState:S,newLogsCount:I,error:f,connect:v,disconnect:w,applyNewLogs:F,clearNewLogs:U}=Hn(Te("/api/webhook-realtime.php"),{autoConnect:!1,enableSound:!0,validateLogs:!0,onNewLogs:x=>{console.log("[WebhookLogsPage] New logs received:",x.length),x.length>0&&(l.value.unshift(...x),L.value.total+=x.length,e(`–ü–æ–ª—É—á–µ–Ω–æ ${x.length} –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π`))}}),{filters:C,updateFilters:_,clearFilters:b}=na(),L=p({page:1,limit:50,total:0,pages:0}),V=T(()=>{let x=[...l.value];return g.value&&g.value.trim()&&(x=ra(x,g.value,{caseSensitive:!1,searchInEvent:!0,searchInPayload:!0,searchInDetails:!0,searchInIp:!0})),C.value.category&&(x=x.filter(q=>q.category===C.value.category)),C.value.event&&(x=x.filter(q=>q.event===C.value.event)),C.value.ip&&(x=x.filter(q=>q.ip&&q.ip.includes(C.value.ip))),C.value.status&&(x=x.filter(q=>C.value.status==="error"?q.category==="errors":C.value.status==="success"?q.category!=="errors":!0)),C.value.dateFrom&&(x=x.filter(q=>q.timestamp?new Date(q.timestamp).toISOString().split("T")[0]>=C.value.dateFrom:!1)),C.value.dateTo&&(x=x.filter(q=>q.timestamp?new Date(q.timestamp).toISOString().split("T")[0]<=C.value.dateTo:!1)),C.value.hour!==null&&(x=x.filter(q=>q.timestamp?new Date(q.timestamp).getHours()===C.value.hour:!1)),x});ee(V,x=>{k.value&&g.value&&k.value.setResultsCount(x.length)});const O=async()=>{try{await Le.init();const x=await Le.getCurrentUser();if(console.log("[WebhookLogsPage] User data:",x),!x||!x.ID){console.warn("[WebhookLogsPage] User not determined"),o.value=u({error:"User not determined",userId:x?.ID||null,userName:x?`${x.NAME||""} ${x.LAST_NAME||""}`.trim():null}),t.value=!1;return}const q=x?.UF_DEPARTMENT||[];if(console.log("[WebhookLogsPage] User departments:",q),console.log("[WebhookLogsPage] Allowed departments:",Ve.allowedDepartmentIds),q.length>0){const oe=q.some(G=>Pt(G));console.log("[WebhookLogsPage] Has access:",oe),t.value=oe,oe||(o.value=u({userId:x.ID,userName:`${x.NAME||""} ${x.LAST_NAME||""}`.trim(),userDepartments:q,allowedDepartments:Ve.allowedDepartmentIds,message:"User departments do not match allowed departments"}))}else console.warn("[WebhookLogsPage] User has no departments"),o.value=u({userId:x.ID,userName:`${x.NAME||""} ${x.LAST_NAME||""}`.trim(),userDepartments:[],allowedDepartments:Ve.allowedDepartmentIds,message:"User has no departments assigned"}),t.value=!1}catch(x){console.error("[WebhookLogsPage] Error checking access:",x),o.value=u({error:x.message,stack:x.stack}),t.value=!1}},D=T(()=>Ve.allowedDepartmentIds.join(", ")),H=async(x=!1)=>{if(t.value&&!(X&&!x)){X=!0,r.value=!0,i.value=null;try{const q=new Date().toISOString().split("T")[0],oe={category:C.value.category||null,event:C.value.event||null,date:C.value.dateFrom||q,hour:C.value.hour!==null&&C.value.hour!==void 0?C.value.hour:null,ip:C.value.ip||null,status:C.value.status||null,dateFrom:C.value.dateFrom||q,dateTo:C.value.dateTo||null};if(!lt(oe))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");console.log("[WebhookLogsPage] Loading logs with filters:",oe);const G=await bt.getLogs(oe,L.value.page,L.value.limit,x);if(console.log("[WebhookLogsPage] API result:",G),console.log("[WebhookLogsPage] Logs count:",G?.logs?.length||0),console.log("[WebhookLogsPage] Pagination:",G?.pagination),!G.success)throw new Error(G.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤");ia(G.pagination)?L.value=G.pagination:(console.warn("[WebhookLogsPage] Invalid pagination format, using defaults"),L.value={page:L.value.page,limit:L.value.limit,total:G.logs.length,pages:Math.ceil(G.logs.length/L.value.limit)});const he=ht(G.logs),ke=he.filter(me=>xe(me));ke.length!==he.length&&console.warn("[WebhookLogsPage] Filtered out invalid logs:",he.length-ke.length),l.value=ke,x&&e("–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")}catch(q){ge(q)}finally{r.value=!1,X=!1}}},ge=x=>{console.error("[WebhookLogsPage] API Error:",x),x.status===403?(i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",a("–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º –≤–µ–±—Ö—É–∫–æ–≤")):x.status===404?(i.value="–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",a("–õ–æ–≥–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")):x.status>=500?(i.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",a("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")):(i.value=x.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",a(i.value)),x.status>=500&&(l.value=[])},R=x=>{g.value=x,_({search:x||null})};let X=!1;const P=x=>{if(!lt(x)){a("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");return}const q={category:C.value.category,event:C.value.event,dateFrom:C.value.dateFrom,dateTo:C.value.dateTo,hour:C.value.hour,ip:C.value.ip,status:C.value.status},oe={category:x?.category||null,event:x?.event||null,dateFrom:x?.dateFrom||null,dateTo:x?.dateTo||null,hour:x?.hour!==void 0?x.hour:null,ip:x?.ip||null,status:x?.status||null},G=Object.keys(oe).some(he=>{const ke=q[he],me=oe[he];return ke!==me});if(!(!G&&!X)){if(_(oe),L.value.page=1,G)try{bt.invalidateCacheOnFilterChange(q,oe)}catch(he){console.error("[WebhookLogsPage] Error invalidating cache:",he)}X||(X=!0,H(!0).finally(()=>{X=!1}))}},Y=()=>{b(),g.value="",L.value.page=1,H()},te=x=>{h.value=x},ie=()=>{h.value=null},Z=x=>{L.value.page=x,H()},le=()=>{try{n.push("/")}catch(x){console.error("Navigation error:",x),window.location.hash="#/"}},B=x=>{y.value=x},se=x=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—á–∞—Ç:",x)},ce=x=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω:",x),e(`–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω: ${x.count} –∑–∞–ø–∏—Å–µ–π –≤ —Ñ–∞–π–ª–µ ${x.filename}`)},fe=x=>{console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:",x),a(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${x.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`)},we=()=>{g.value="",Y()},qe=x=>{if(console.log("[WebhookLogsPage] Toggle auto-update:",x),E.value=x,x){let q=null;if(l.value.length>0){const oe=l.value[0];oe.timestamp&&(q=oe.timestamp,console.log("[WebhookLogsPage] Using lastTimestamp:",q))}v({lastTimestamp:q})}else w()},Ce=()=>{F(l.value),e("–ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")},ot=()=>{U()};return de(async()=>{await O(),t.value&&(C.value.search&&(g.value=C.value.search),await H())}),{hasAccess:t,loading:r,error:i,logs:l,filteredLogs:V,selectedLog:h,selectedLogs:y,filters:C,searchQuery:g,searchComponent:k,pagination:L,previousPeriodStats:A,handleFiltersUpdate:P,handleFiltersReset:Y,handleSearch:R,handleLogSelect:te,handleLogClose:ie,handlePageChange:Z,handleSelectedLogsUpdate:B,handleExportStart:se,handleExportComplete:ce,handleExportError:fe,handleClearSearch:we,autoUpdateEnabled:E,connectionState:S,newLogsCount:I,realtimeError:f,handleToggleAutoUpdate:qe,handleApplyNewLogs:Ce,handleDismissNewLogs:ot,allowedDepartmentsText:D,accessDebugInfo:o,goBack:le}}},Yn={class:"webhook-logs-page"},Kn={class:"page-header"},Gn={class:"page-header-top"},Qn={key:0,class:"access-denied"},Zn={class:"access-denied-content"},er={class:"access-hint"},tr={key:0,class:"access-debug"},sr={key:1,class:"page-content"},ar={class:"actions-bar"};function or(n,e,a,t,r,i){const o=W("WebhookLogsDashboard"),l=W("WebhookLogsExport"),u=W("WebhookLogSearch"),h=W("RealtimeControls"),y=W("NewLogsIndicator"),g=W("WebhookLogFilters"),k=W("SkeletonLogList"),A=W("WebhookLogList"),E=W("EmptyState"),S=W("ErrorDisplay"),I=W("WebhookLogDetails"),f=W("NotificationContainer");return c(),d("div",Yn,[s("div",Kn,[s("div",Gn,[s("button",{onClick:e[0]||(e[0]=(...v)=>t.goBack&&t.goBack(...v)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[3]||(e[3]=[s("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),s("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[4]||(e[4]=s("h1",null,"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ Bitrix24",-1))]),t.hasAccess?(c(),d("div",sr,[K(o,{logs:t.logs,pagination:t.pagination,"previous-period-stats":t.previousPeriodStats},null,8,["logs","pagination","previous-period-stats"]),s("div",ar,[K(l,{logs:t.filteredLogs,"selected-logs":t.selectedLogs,filters:t.filters,"total-count":t.filteredLogs.length,onExportStart:t.handleExportStart,onExportComplete:t.handleExportComplete,onExportError:t.handleExportError},null,8,["logs","selected-logs","filters","total-count","onExportStart","onExportComplete","onExportError"]),K(u,{modelValue:t.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=v=>t.searchQuery=v),onSearch:t.handleSearch,ref:"searchComponent"},null,8,["modelValue","onSearch"])]),K(h,{enabled:t.autoUpdateEnabled,"connection-state":t.connectionState,error:t.realtimeError,onToggle:t.handleToggleAutoUpdate},null,8,["enabled","connection-state","error","onToggle"]),K(y,{count:t.newLogsCount,onApply:t.handleApplyNewLogs,onDismiss:t.handleDismissNewLogs},null,8,["count","onApply","onDismiss"]),K(g,{filters:t.filters,"onUpdate:filters":t.handleFiltersUpdate,onReset:t.handleFiltersReset},null,8,["filters","onUpdate:filters","onReset"]),K(Ie,{name:"fade"},{default:_e(()=>[t.loading&&t.logs.length===0?(c(),ne(k,{key:0,rows:5})):M("",!0)]),_:1}),K(Ie,{name:"fade"},{default:_e(()=>[!t.loading&&t.filteredLogs.length>0?(c(),ne(A,{key:0,logs:t.filteredLogs,loading:!1,error:null,pagination:t.pagination,"selected-logs":t.selectedLogs,onSelectLog:t.handleLogSelect,onPageChange:t.handlePageChange,"onUpdate:selectedLogs":t.handleSelectedLogsUpdate},null,8,["logs","pagination","selected-logs","onSelectLog","onPageChange","onUpdate:selectedLogs"])):M("",!0)]),_:1}),K(Ie,{name:"fade"},{default:_e(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length===0?(c(),ne(E,{key:0,icon:"üì≠",title:"–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",description:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Bitrix24.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è","–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",onAction:t.handleFiltersReset},null,8,["onAction"])):M("",!0)]),_:1}),K(Ie,{name:"fade"},{default:_e(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length>0?(c(),ne(E,{key:0,icon:"üîç",title:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",description:"–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã","–û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",onAction:t.handleClearSearch},null,8,["onAction"])):M("",!0)]),_:1}),K(Ie,{name:"fade"},{default:_e(()=>[t.error?(c(),ne(S,{key:0,title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤",message:t.error,retryable:!0,onRetry:n.loadLogs},null,8,["message","onRetry"])):M("",!0)]),_:1}),t.selectedLog?(c(),d("div",{key:0,class:"modal-overlay",onClick:e[2]||(e[2]=(...v)=>t.handleLogClose&&t.handleLogClose(...v))})):M("",!0),K(Ie,{name:"modal"},{default:_e(()=>[t.selectedLog?(c(),ne(I,{key:0,log:t.selectedLog,onClose:t.handleLogClose},null,8,["log","onClose"])):M("",!0)]),_:1})])):(c(),d("div",Qn,[s("div",Zn,[e[7]||(e[7]=s("h2",null,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",-1)),e[8]||(e[8]=s("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤.",-1)),s("p",er,[e[5]||(e[5]=Q(" –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ –æ—Ç–¥–µ–ª–æ–≤: ",-1)),s("strong",null,m(t.allowedDepartmentsText),1)]),e[9]||(e[9]=s("p",{class:"access-hint"}," –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã. ",-1)),t.accessDebugInfo?(c(),d("details",tr,[e[6]||(e[6]=s("summary",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",-1)),s("pre",null,m(t.accessDebugInfo),1)])):M("",!0)])])),K(f)])}const nr=J(Xn,[["render",or],["__scopeId","data-v-628bf174"]]);class Ne{static analyzeUsagePatterns(e){return!Array.isArray(e)||e.length===0?this.getEmptyPatterns():{peakHours:this.calculatePeakHours(e),sessionDuration:this.calculateAverageSession(e),userRetention:this.calculateRetention(e),popularPaths:this.findPopularPaths(e),deviceBreakdown:this.analyzeDevices(e),browserStats:this.analyzeBrowsers(e)}}static groupActivity(e,a){if(!Array.isArray(e))return[];const t=new Map;e.forEach(i=>{let o;switch(a){case"hour":o=i.timestamp?new Date(i.timestamp).getHours():"unknown";break;case"day":o=i.timestamp?new Date(i.timestamp).toISOString().split("T")[0]:"unknown";break;case"week":const l=i.timestamp?new Date(i.timestamp):new Date;o=new Date(l.setDate(l.getDate()-l.getDay())).toISOString().split("T")[0];break;case"month":o=i.timestamp?new Date(i.timestamp).toISOString().substring(0,7):"unknown";break;case"user":o=i.user_id||"unknown";break;case"page":o=i.route_path||i.route_title||i.route_name||"unknown";break;case"session":o=this.calculateSessionId(i);break;default:o="all"}t.has(o)||t.set(o,{key:o,entries:[],count:0,metadata:this.getGroupMetadata(o,a)}),t.get(o).entries.push(i),t.get(o).count++});const r=Array.from(t.values());return this.sortGroups(r,a)}static calculateDashboardMetrics(e,a=[]){const t=this.calculateMetrics(e),r=a.length>0?this.calculateMetrics(a):{},i={};return Object.keys(t).forEach(o=>{const l=t[o],u=r[o]||0;i[o]={value:l,previousValue:u,change:l-u,changePercent:u>0?(l-u)/u*100:0,trend:l>u?"up":l<u?"down":"neutral"}}),i}static analyzeUserSessions(e){if(!Array.isArray(e)||e.length===0)return[];const a=[...e].sort((o,l)=>new Date(o.timestamp)-new Date(l.timestamp)),t=[];let r=null;const i=30*60*1e3;return a.forEach(o=>{if(!o||typeof o!="object"||!o.timestamp)return;const l=new Date(o.timestamp).getTime();(!r||l-r.endTime>i)&&(r={id:`session_${t.length+1}`,startTime:l,endTime:l,entries:[],duration:0,pages:new Set,device:o.user_agent,actions:new Map},t.push(r)),r.entries.push(o),r.endTime=l,o.route_path&&r.pages.add(o.route_path);const u=o.type||"unknown";r.actions.set(u,(r.actions.get(u)||0)+1)}),t.forEach(o=>{o.duration=o.endTime-o.startTime,o.pageCount=o.pages.size,o.entriesCount=o.entries.length,o.actions=Object.fromEntries(o.actions)}),t}static calculateUserStats(e){if(!Array.isArray(e)||e.length===0)return this.getEmptyUserStats();const a=this.analyzeUserSessions(e),t=a.reduce((o,l)=>o+l.duration,0),r=this.groupActivity(e,"day"),i=this.findFavoritePages(e);return{total_actions:e.length,total_sessions:a.length,avg_session_duration:a.length>0?t/a.length:0,total_duration:t,favorite_page:i[0]?.page||null,peak_hour:this.calculateUserPeakHour(e),device_preference:this.calculateDevicePreference(e),activity_by_day:r.map(o=>({date:o.key,count:o.count,sessions:this.analyzeUserSessions(o.entries).length})),retention_days:this.calculateUserRetention(e)}}static calculatePeakHours(e){const a=new Array(24).fill(0);return e.forEach(t=>{if(t.timestamp){const r=new Date(t.timestamp).getHours();a[r]++}}),a.map((t,r)=>({hour:r,count:t}))}static calculateAverageSession(e){const a=this.analyzeUserSessions(e);return a.length===0?0:a.reduce((r,i)=>r+i.duration,0)/a.length}static calculateRetention(e){if(e.length===0)return{"1d":0,"7d":0,"30d":0};const a=new Map,t=new Map;e.forEach(u=>{const h=u.user_id,y=new Date(u.timestamp).getTime();(!a.has(h)||y<a.get(h))&&a.set(h,y),(!t.has(h)||y>t.get(h))&&t.set(h,y)});let r=0,i=0,o=0;const l=a.size;return t.forEach((u,h)=>{const y=a.get(h),g=(u-y)/(1e3*60*60*24);g>=1&&r++,g>=7&&i++,g>=30&&o++}),{"1d":l>0?r/l*100:0,"7d":l>0?i/l*100:0,"30d":l>0?o/l*100:0}}static findPopularPaths(e){if(!Array.isArray(e))return new Map;const a=new Map;return e.filter(t=>t&&t.type==="page_visit").forEach(t=>{const r=t.route_path||t.route_name||"unknown";a.set(r,(a.get(r)||0)+1)}),Array.from(a.entries()).sort((t,r)=>r[1]-t[1]).slice(0,10).map(([t,r])=>({path:t,count:r}))}static analyzeDevices(e){const a={desktop:0,mobile:0,tablet:0,unknown:0};return e.forEach(t=>{const r=this.detectDevice(t.user_agent);a[r]++}),a}static analyzeBrowsers(e){const a=new Map;return e.forEach(t=>{const r=this.detectBrowser(t.user_agent);a.set(r,(a.get(r)||0)+1)}),Object.fromEntries(a)}static detectDevice(e){if(!e)return"unknown";const a=e.toLowerCase();return a.includes("mobile")||a.includes("android")||a.includes("iphone")?"mobile":a.includes("tablet")||a.includes("ipad")?"tablet":"desktop"}static detectBrowser(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const a=e.toLowerCase();return a.includes("chrome")&&!a.includes("edg")?"Chrome":a.includes("firefox")?"Firefox":a.includes("safari")&&!a.includes("chrome")?"Safari":a.includes("edg")?"Edge":a.includes("opera")?"Opera":"–î—Ä—É–≥–æ–µ"}static calculateSessionId(e){const a=e.user_id||"unknown",t=e.timestamp?new Date(e.timestamp).toISOString().split("T")[0]:"unknown";return`${a}_${t}`}static getGroupMetadata(e,a){switch(a){case"hour":return{label:`${e}:00`,type:"hour"};case"day":return{label:this.formatDate(e),type:"day"};case"week":return{label:`–ù–µ–¥–µ–ª—è ${e}`,type:"week"};case"month":return{label:this.formatMonth(e),type:"month"};case"user":return{label:`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${e}`,type:"user"};case"page":return{label:e,type:"page"};case"session":return{label:`–°–µ—Å—Å–∏—è ${e}`,type:"session"};default:return{label:e,type:"unknown"}}}static sortGroups(e,a){return e.sort((t,r)=>["day","week","month"].includes(a)?new Date(r.key)-new Date(t.key):r.count-t.count)}static calculateMetrics(e){return Array.isArray(e)?{total_entries:e.length,unique_users:new Set(e.map(t=>t.user_id).filter(t=>t)).size,total_app_entries:e.filter(t=>t.type==="app_entry").length,total_page_visits:e.filter(t=>t.type==="page_visit").length,total_sessions:this.analyzeUserSessions(e).length}:this.getEmptyMetrics()}static findFavoritePages(e){if(!Array.isArray(e))return[];const a=new Map;return e.filter(t=>t&&t.type==="page_visit").forEach(t=>{const r=t.route_path||t.route_title||t.route_name||"unknown";a.set(r,(a.get(r)||0)+1)}),Array.from(a.entries()).sort((t,r)=>r[1]-t[1]).map(([t,r])=>({page:t,count:r}))}static calculateUserPeakHour(e){const a=new Array(24).fill(0);e.forEach(r=>{if(r.timestamp){const i=new Date(r.timestamp).getHours();a[i]++}});const t=Math.max(...a);return t>0?a.indexOf(t):0}static calculateDevicePreference(e){const a={desktop:0,mobile:0,tablet:0};e.forEach(r=>{const i=this.detectDevice(r.user_agent);a.hasOwnProperty(i)&&a[i]++});const t=Object.keys(a).reduce((r,i)=>a[r]>a[i]?r:i);return a[t]>0?t:"unknown"}static calculateUserRetention(e){if(e.length===0)return 0;const a=e.map(o=>new Date(o.timestamp).getTime()).sort((o,l)=>o-l),t=a[0],i=(a[a.length-1]-t)/(1e3*60*60*24);return Math.max(0,Math.floor(i))}static formatDate(e){try{return new Date(e).toLocaleDateString("ru-RU")}catch{return e}}static formatMonth(e){try{const[a,t]=e.split("-");return new Date(a,t-1,1).toLocaleDateString("ru-RU",{year:"numeric",month:"long"})}catch{return e}}static getEmptyPatterns(){return{peakHours:new Array(24).fill(0).map((e,a)=>({hour:a,count:0})),sessionDuration:0,userRetention:{"1d":0,"7d":0,"30d":0},popularPaths:[],deviceBreakdown:{desktop:0,mobile:0,tablet:0,unknown:0},browserStats:{}}}static getEmptyMetrics(){return{total_entries:0,unique_users:0,total_app_entries:0,total_page_visits:0,total_sessions:0}}static getEmptyUserStats(){return{total_actions:0,total_sessions:0,avg_session_duration:0,total_duration:0,favorite_page:null,peak_hour:0,device_preference:"unknown",activity_by_day:[],retention_days:0}}}const Xe=new Map,rr=5*60*1e3;class Fe{static validateAndCleanActivityData(e){return Array.isArray(e)?e.filter(a=>{if(!a||typeof a!="object"||a===null)return console.warn("[UserActivityService] Invalid entry: not an object or null",a),!1;if(!a.user_id&&a.user_id!==0)return console.warn("[UserActivityService] Invalid entry: missing user_id",a),!1;if(!a.timestamp)return console.warn("[UserActivityService] Invalid entry: missing timestamp",a),!1;try{const t=new Date(a.timestamp);if(isNaN(t.getTime()))return console.warn("[UserActivityService] Invalid entry: invalid timestamp",a.timestamp),!1}catch(t){return console.warn("[UserActivityService] Invalid entry: timestamp parse error",a.timestamp,t),!1}return!0}).map(a=>{try{return{...a,user_id:Number(a.user_id)||0,timestamp:a.timestamp,type:a.type||"unknown",route_path:a.route_path||null,route_title:a.route_title||null,route_name:a.route_name||null,user_name:a.user_name||null,user_agent:a.user_agent||null}}catch(t){return console.warn("[UserActivityService] Error normalizing entry:",a,t),null}}).filter(a=>a!==null):(console.warn("[UserActivityService] Invalid data format: not an array"),[])}static createCacheKey(e){return JSON.stringify({userId:e.userId,dateFrom:e.dateFrom,dateTo:e.dateTo,type:e.type,limit:e.limit})}static clearCache(){Xe.clear()}static async getActivity(e={}){const{userId:a=null,dateFrom:t=null,dateTo:r=null,type:i=null,limit:o=1e3,useCache:l=!0}=e,u=this.createCacheKey({userId:a,dateFrom:t,dateTo:r,type:i,limit:o});if(l&&Xe.has(u)){const y=Xe.get(u);if(Date.now()-y.timestamp<rr)return y.data;Xe.delete(u)}const h=new URLSearchParams;a&&h.append("user_id",a),t&&h.append("date_from",t),r&&h.append("date_to",r),i&&h.append("type",i),o&&h.append("limit",o);try{const y=Te("/api/user-activity-get.php"),g=await fetch(`${y}?${h.toString()}`);if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);const k=await g.json();if(k.success){let A=k.data||[];return A=A.filter(E=>E!=null),A=this.validateAndCleanActivityData(A),A=A.filter(E=>E&&typeof E=="object"&&E.user_id&&E.timestamp&&typeof E.type=="string"&&E.type.trim()!==""),l&&Xe.set(u,{data:A,timestamp:Date.now()}),A}else throw new Error(k.error||"Failed to get activity")}catch(y){throw console.error("[UserActivityService] Error getting activity:",y),y}}static async getActivityStats(e={}){const a=await this.getActivity(e),t={total_entries:a.length,total_app_entries:0,total_page_visits:0,unique_users:new Set,pages_visited:{},activity_by_date:{},activity_by_hour:{}};return a.forEach(r=>{if(!(!r||typeof r!="object")){if(r.type==="app_entry")t.total_app_entries++,r.user_id&&t.unique_users.add(r.user_id);else if(r.type==="page_visit"){t.total_page_visits++;const i=r.route_title||r.route_path||r.route_name||"unknown";t.pages_visited[i]=(t.pages_visited[i]||0)+1}if(r.timestamp)try{const i=new Date(r.timestamp).toISOString().split("T")[0];t.activity_by_date[i]=(t.activity_by_date[i]||0)+1;const o=new Date(r.timestamp).getHours();t.activity_by_hour[o]=(t.activity_by_hour[o]||0)+1}catch{console.warn("[UserActivityService] Invalid timestamp:",r.timestamp)}}}),t.unique_users_count=t.unique_users.size,t.unique_users=Array.from(t.unique_users),t}static async getUserActivity(e,a={}){return await this.getActivity({...a,userId:e})}static async getDashboardMetrics(e={}){try{const a=await this.getActivity({...e,limit:1e4}),t=this.getPreviousPeriodFilters(e),r=await this.getActivity({...t,limit:1e4});return Ne.calculateDashboardMetrics(a,r)}catch(a){throw console.error("[UserActivityService] Error getting dashboard metrics:",a),a}}static async getUserProfileAnalytics(e,a={}){try{const t=await this.getUserInfo(e),r=await this.getUserActivity(e,a),i=Ne.calculateUserStats(r),o=Ne.analyzeUserSessions(r);return{user:t,activity:r,analytics:i,sessions:o}}catch(t){throw console.error("[UserActivityService] Error getting user profile analytics:",t),t}}static async getUserInfo(e){return{id:e,name:`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${e}`,email:`user${e}@example.com`,departments:["–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª"],first_visit:null,last_visit:null}}static getPreviousPeriodFilters(e){const a={...e};if(a.dateFrom&&a.dateTo){const t=new Date(a.dateFrom),i=new Date(a.dateTo)-t,o=new Date(t.getTime()-i),l=new Date(t.getTime()-1);a.dateFrom=o.toISOString().split("T")[0],a.dateTo=l.toISOString().split("T")[0]}else{const t=new Date,r=new Date(t.getTime()-7*24*60*60*1e3),i=new Date(t.getTime()-14*24*60*60*1e3);a.dateFrom=i.toISOString().split("T")[0],a.dateTo=r.toISOString().split("T")[0]}return a}static exportData(e,a="json"){switch(a){case"csv":return this.exportToCSV(e);case"json":default:return JSON.stringify(e,null,2)}}static exportToCSV(e){if(!e||e.length===0)return"";const a=["timestamp","user_id","user_name","type","route_path","route_title","user_agent"];return[a.join(","),...e.map(r=>a.map(i=>{const o=r[i]||"";return`"${String(o).replace(/"/g,'""')}"`}).join(","))].join(`
`)}}const at="hidden_users_list";function ze(){try{const n=localStorage.getItem(at);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e.map(a=>Number(a)):[]}catch(n){return console.error("[HiddenUsersManager] Error reading hidden users:",n),[]}}function ir(n){const e=ze(),a=Number(n);if(!e.includes(a)){e.push(a);try{localStorage.setItem(at,JSON.stringify(e))}catch(t){console.error("[HiddenUsersManager] Error saving hidden users:",t)}}}function lr(n){const e=ze(),a=Number(n),t=e.filter(r=>r!==a);if(t.length!==e.length)try{localStorage.setItem(at,JSON.stringify(t))}catch(r){console.error("[HiddenUsersManager] Error saving hidden users:",r)}}function cr(){try{localStorage.removeItem(at)}catch(n){console.error("[HiddenUsersManager] Error clearing hidden users:",n)}}function dr(n){const e=new Map;return n.forEach(a=>{if(a.user_id){const t=Number(a.user_id);e.has(t)||e.set(t,{id:t,name:a.user_name||`User #${t}`,count:0}),e.get(t).count++}}),Array.from(e.values()).sort((a,t)=>t.count-a.count)}function Nt(n){const e=ze();return e.length===0?n:n.filter(a=>a.user_id?!e.includes(Number(a.user_id)):!0)}const ur={name:"UserActivityCard",props:{entry:{type:Object,required:!0,validator:n=>n&&typeof n=="object"&&n!==null&&n.user_id&&n.timestamp&&typeof n.type=="string"}},computed:{isValidEntry(){return this.entry&&typeof this.entry=="object"&&this.entry!==null&&this.entry.user_id&&this.entry.timestamp&&typeof this.entry.type=="string"&&this.entry.type.trim()!==""},safeEntry(){return this.isValidEntry?{...this.entry,user_id:this.entry.user_id||"unknown",user_name:this.entry.user_name||`User #${this.entry.user_id}`,timestamp:this.entry.timestamp||new Date().toISOString(),type:this.entry.type||"unknown",route_title:this.entry.route_title||null,route_path:this.entry.route_path||null,route_name:this.entry.route_name||null,from_path:this.entry.from_path||null,from_name:this.entry.from_name||null}:{user_id:"unknown",user_name:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",timestamp:new Date().toISOString(),type:"unknown",route_title:null,route_path:null,route_name:null,from_path:null,from_name:null}},cardClass(){return this.isValidEntry?{"activity-entry":this.safeEntry.type==="app_entry","activity-visit":this.safeEntry.type==="page_visit"}:{}}},methods:{formatTime(n){if(!n)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{const e=new Date(n);return isNaN(e.getTime())?"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ":e.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}}}},mr={class:"activity-icon"},gr={key:0},hr={key:1},fr={key:2},vr={class:"activity-content"},pr={class:"activity-header"},yr={class:"user-name"},_r={class:"activity-time"},br={class:"activity-details"},wr={key:0,class:"activity-type"},Cr={key:1,class:"activity-type"},kr={key:2,class:"activity-type"},Sr={key:0,class:"activity-from"},Dr={key:1,class:"user-activity-card error-card"};function Ar(n,e,a,t,r,i){return i.isValidEntry?(c(),d("div",{key:0,class:N(["user-activity-card",i.cardClass])},[s("div",mr,[i.safeEntry.type==="app_entry"?(c(),d("span",gr,"üö™")):i.safeEntry.type==="page_visit"?(c(),d("span",hr,"üìÑ")):(c(),d("span",fr,"‚ùì"))]),s("div",vr,[s("div",pr,[s("span",yr,m(i.safeEntry.user_name||`User #${i.safeEntry.user_id}`),1),s("span",_r,m(i.formatTime(i.safeEntry.timestamp)),1)]),s("div",br,[i.safeEntry.type==="app_entry"?(c(),d("span",wr," –û—Ç–∫—Ä—ã–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ")):i.safeEntry.type==="page_visit"?(c(),d("span",Cr," –û—Ç–∫—Ä—ã–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É: "+m(i.safeEntry.route_title||i.safeEntry.route_path||i.safeEntry.route_name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"),1)):(c(),d("span",kr," –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ "))]),i.safeEntry.type==="page_visit"&&i.safeEntry.from_path?(c(),d("div",Sr," –°: "+m(i.safeEntry.from_name||i.safeEntry.from_path),1)):M("",!0)])],2)):(c(),d("div",Dr,[...e[0]||(e[0]=[s("div",{class:"activity-icon"},"‚ö†Ô∏è",-1),s("div",{class:"activity-content"},[s("div",{class:"activity-details"},[s("span",{class:"activity-type error"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö")])],-1)])]))}const Tr=J(ur,[["render",Ar],["__scopeId","data-v-cd4e1fda"]]),Er={name:"HiddenUsersManager",props:{filters:{type:Object,default:()=>({})}},emits:["hidden-users-changed"],setup(n,{emit:e}){const a=p(!1),t=p(null),r=p([]),i=p([]),o=T(()=>dr(r.value)),l=T(()=>{const g=ze();return o.value.filter(k=>g.includes(k.id))}),u=async()=>{a.value=!0,t.value=null;try{const g={...n.filters,limit:1e3};r.value=await Fe.getActivity(g);const k=ze();i.value=k.filter(A=>o.value.some(E=>E.id===A))}catch(g){t.value=g.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",console.error("[HiddenUsersManager] Error loading activity:",g)}finally{a.value=!1}},h=()=>{const g=ze(),k=i.value.map(A=>Number(A));k.forEach(A=>{g.includes(A)||ir(A)}),g.forEach(A=>{k.includes(A)||lr(A)}),e("hidden-users-changed"),window.dispatchEvent(new CustomEvent("hidden-users-changed"))},y=()=>{cr(),i.value=[],e("hidden-users-changed"),window.dispatchEvent(new CustomEvent("hidden-users-changed"))};return de(()=>{u()}),ee(()=>n.filters,()=>{u()},{deep:!0}),ee(()=>l.value,g=>{i.value=g.map(k=>k.id)},{deep:!0}),{loading:a,error:t,availableUsers:o,hiddenUsers:l,selectedUsers:i,applySelection:h,showAll:y}}},Mr={class:"hidden-users-manager"},xr={class:"manager-controls"},Ir={class:"dropdown-wrapper"},Lr=["disabled"],Pr=["value"],Fr={key:0,class:"empty-hint"},Ur={class:"actions"},Rr=["disabled"],Or=["disabled"],Nr={key:0,class:"loading"},Br={key:1,class:"error"};function Vr(n,e,a,t,r,i){return c(),d("div",Mr,[s("div",xr,[s("div",Ir,[e[3]||(e[3]=s("label",{class:"dropdown-label"}," üëÅÔ∏è –°–∫—Ä—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ",-1)),$(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.selectedUsers=o),multiple:"",class:"users-dropdown",disabled:t.loading||t.availableUsers.length===0,size:"5"},[(c(!0),d(j,null,z(t.availableUsers,o=>(c(),d("option",{key:o.id,value:o.id},m(o.name)+" ("+m(o.count)+" "+m(o.count===1?"–∑–∞–ø–∏—Å—å":"–∑–∞–ø–∏—Å–µ–π")+") ",9,Pr))),128))],8,Lr),[[re,t.selectedUsers]]),t.availableUsers.length===0&&!t.loading?(c(),d("div",Fr," –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∑–∞–ø–∏—Å—è—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ")):M("",!0)]),s("div",Ur,[s("button",{onClick:e[1]||(e[1]=(...o)=>t.applySelection&&t.applySelection(...o)),class:"apply-btn",disabled:t.loading,title:"–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å ",8,Rr),t.hiddenUsers.length>0?(c(),d("button",{key:0,onClick:e[2]||(e[2]=(...o)=>t.showAll&&t.showAll(...o)),class:"show-all-btn",disabled:t.loading,title:"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"}," –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö ("+m(t.hiddenUsers.length)+") ",9,Or)):M("",!0)])]),t.loading?(c(),d("div",Nr," –ó–∞–≥—Ä—É–∑–∫–∞... ")):M("",!0),t.error?(c(),d("div",Br,m(t.error),1)):M("",!0)])}const Bt=J(Er,[["render",Vr],["__scopeId","data-v-4fdc2eaa"]]),jr={name:"UserActivityFilters",props:{filters:{type:Object,default:()=>({})},users:{type:Array,default:()=>[]}},emits:["update-filters"],setup(n,{emit:e}){const a=p({userId:n.filters.userId||null,type:n.filters.type||null,dateFrom:n.filters.dateFrom||null,dateTo:n.filters.dateTo||null}),t=()=>{e("update-filters",{...a.value})},r=()=>{a.value={userId:null,type:null,dateFrom:null,dateTo:null},t()},i=o=>{const l=o.NAME||"",u=o.LAST_NAME||"";return`${l} ${u}`.trim()||o.EMAIL||`User #${o.ID}`};return ee(()=>n.filters,o=>{a.value={...o}},{deep:!0}),{localFilters:a,updateFilters:t,resetFilters:r,getUserName:i}}},zr={class:"user-activity-filters"},$r={class:"filter-group"},Wr=["value"],Hr={class:"filter-group"},qr={class:"filter-group"},Jr={class:"filter-group"};function Xr(n,e,a,t,r,i){return c(),d("div",zr,[s("div",$r,[e[10]||(e[10]=s("label",null,"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:",-1)),$(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.localFilters.userId=o),onChange:e[1]||(e[1]=(...o)=>t.updateFilters&&t.updateFilters(...o))},[e[9]||(e[9]=s("option",{value:null},"–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",-1)),(c(!0),d(j,null,z(a.users,o=>(c(),d("option",{key:o.ID,value:o.ID},m(t.getUserName(o)),9,Wr))),128))],544),[[re,t.localFilters.userId]])]),s("div",Hr,[e[12]||(e[12]=s("label",null,"–¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:",-1)),$(s("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.localFilters.type=o),onChange:e[3]||(e[3]=(...o)=>t.updateFilters&&t.updateFilters(...o))},[...e[11]||(e[11]=[s("option",{value:null},"–í—Å–µ —Ç–∏–ø—ã",-1),s("option",{value:"app_entry"},"–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1),s("option",{value:"page_visit"},"–ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",-1)])],544),[[re,t.localFilters.type]])]),s("div",qr,[e[13]||(e[13]=s("label",null,"–î–∞—Ç–∞ –æ—Ç:",-1)),$(s("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=o=>t.localFilters.dateFrom=o),onChange:e[5]||(e[5]=(...o)=>t.updateFilters&&t.updateFilters(...o))},null,544),[[be,t.localFilters.dateFrom]])]),s("div",Jr,[e[14]||(e[14]=s("label",null,"–î–∞—Ç–∞ –¥–æ:",-1)),$(s("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=o=>t.localFilters.dateTo=o),onChange:e[7]||(e[7]=(...o)=>t.updateFilters&&t.updateFilters(...o))},null,544),[[be,t.localFilters.dateTo]])]),s("button",{onClick:e[8]||(e[8]=(...o)=>t.resetFilters&&t.resetFilters(...o)),class:"btn-reset"},"–°–±—Ä–æ—Å–∏—Ç—å")])}const Vt=J(jr,[["render",Xr],["__scopeId","data-v-f4c5efa9"]]),Yr={name:"UserActivityStats",props:{filters:{type:Object,default:()=>({})}},setup(n){const e=p({total_entries:0,unique_users_count:0,total_app_entries:0,total_page_visits:0,pages_visited:{}}),a=p(!1),t=p(null),r=T(()=>e.value),i=async()=>{a.value=!0,t.value=null;try{const u=await Fe.getActivity({...n.filters,limit:1e4}),h=Nt(u);e.value=await Fe.getActivityStats({...n.filters});const y={total_entries:h.length,unique_users_count:new Set(h.filter(g=>g&&g.user_id).map(g=>g.user_id)).size,total_app_entries:h.filter(g=>g&&g.type==="app_entry").length,total_page_visits:h.filter(g=>g&&g.type==="page_visit").length,pages_visited:{}};h.filter(g=>g&&g.type==="page_visit"&&g.route_path).forEach(g=>{const k=g.route_title||g.route_path||g.route_name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞";y.pages_visited[k]=(y.pages_visited[k]||0)+1}),e.value=y}catch(u){t.value=u.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏",console.error("[UserActivityStats] Error loading stats:",u)}finally{a.value=!1}},o=T(()=>{const u=r.value.pages_visited||{};return Object.entries(u).sort((h,y)=>y[1]-h[1]).slice(0,10).reduce((h,[y,g])=>(h[y]=g,h),{})}),l=()=>{i()};return de(()=>{i(),window.addEventListener("hidden-users-changed",l)}),He(()=>{window.removeEventListener("hidden-users-changed",l)}),ee(()=>n.filters,()=>{i()},{deep:!0}),{stats:r,loading:a,error:t,sortedPages:o}}},Kr={class:"user-activity-stats"},Gr={key:0,class:"loading"},Qr={key:1,class:"error"},Zr={key:2},ei={class:"stats-grid"},ti={class:"stat-card"},si={class:"stat-value"},ai={class:"stat-card"},oi={class:"stat-value"},ni={class:"stat-card"},ri={class:"stat-value"},ii={class:"stat-card"},li={class:"stat-value"},ci={key:0,class:"pages-stats"};function di(n,e,a,t,r,i){return c(),d("div",Kr,[t.loading?(c(),d("div",Gr," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏... ")):t.error?(c(),d("div",Qr,m(t.error),1)):(c(),d("div",Zr,[s("div",ei,[s("div",ti,[s("div",si,m(t.stats.total_entries),1),e[0]||(e[0]=s("div",{class:"stat-label"},"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",-1))]),s("div",ai,[s("div",oi,m(t.stats.unique_users_count),1),e[1]||(e[1]=s("div",{class:"stat-label"},"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1))]),s("div",ni,[s("div",ri,m(t.stats.total_app_entries),1),e[2]||(e[2]=s("div",{class:"stat-label"},"–û—Ç–∫—Ä—ã—Ç–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1))]),s("div",ii,[s("div",li,m(t.stats.total_page_visits),1),e[3]||(e[3]=s("div",{class:"stat-label"},"–ü–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",-1))])]),Object.keys(t.stats.pages_visited).length>0?(c(),d("div",ci,[e[5]||(e[5]=s("h3",null,"–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:",-1)),s("ul",null,[(c(!0),d(j,null,z(t.sortedPages,(o,l)=>(c(),d("li",{key:l},[Q(m(l)+": ",1),s("strong",null,m(o),1),e[4]||(e[4]=Q(" –ø–æ—Å–µ—â–µ–Ω–∏–π ",-1))]))),128))])])):M("",!0)]))])}const jt=J(Yr,[["render",di],["__scopeId","data-v-5b235ed4"]]),ui={name:"MetricCard",props:{metric:{type:Object,required:!0,validator:n=>n.id&&n.title&&typeof n.value<"u"},interactive:{type:Boolean,default:!0},showTrend:{type:Boolean,default:!0},showComparison:{type:Boolean,default:!1},drillDown:{type:Boolean,default:!1}},emits:["click","drill-down"],computed:{title(){return this.metric.title||""},value(){return this.metric.value||0},previousValue(){return this.metric.previousValue},change(){return this.metric.change||0},changePercent(){return this.metric.changePercent||0},trend(){return this.metric.trend||"neutral"},icon(){return this.metric.icon||"üìä"},color(){return this.metric.color||"#2196F3"},drillDownRoute(){return this.metric.drillDownRoute},subtitle(){return this.metric.subtitle},formattedValue(){return this.formatValue(this.value)},formattedPreviousValue(){return this.formatValue(this.previousValue)},formattedChange(){const n=Math.abs(this.change),e=Math.abs(this.changePercent);return e!==0?`${this.change>=0?"+":"-"}${e.toFixed(1)}%`:n!==0?this.formatValue(n,!0):""},formattedChangePercent(){return`${this.changePercent>=0?"+":""}${this.changePercent.toFixed(1)}%`},trendClass(){return{"trend-up":this.trend==="up","trend-down":this.trend==="down","trend-neutral":this.trend==="neutral",interactive:this.interactive,"has-drill-down":this.drillDown}},trendIcon(){switch(this.trend){case"up":return"üìà";case"down":return"üìâ";default:return"‚û°Ô∏è"}}},methods:{formatValue(n,e=!1){return n==null?"0":typeof n=="string"&&(n.includes("–º")||n.includes("—Å")||n.includes("—á"))?n:typeof n=="number"?n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":Number.isInteger(n)?n.toLocaleString("ru-RU"):n.toFixed(1):String(n)},handleClick(){this.interactive&&this.$emit("click",this.metric)},handleDrillDown(){this.$emit("drill-down",this.metric)}}},mi={class:"metric-header"},gi={class:"metric-icon"},hi={key:0,class:"metric-trend"},fi={class:"trend-icon"},vi={class:"trend-value"},pi={class:"metric-content"},yi={class:"metric-title"},_i={key:0,class:"metric-subtitle"},bi={key:1,class:"metric-comparison"},wi={class:"comparison-value"},Ci={key:0,class:"metric-actions"},ki={key:1,class:"metric-hover-overlay"},Si={class:"hover-content"},Di={key:0,class:"hover-subtitle"};function Ai(n,e,a,t,r,i){return c(),d("div",{class:N(["metric-card",i.trendClass]),onClick:e[1]||(e[1]=(...o)=>i.handleClick&&i.handleClick(...o))},[s("div",mi,[s("div",gi,[s("span",null,m(i.icon),1)]),a.showTrend&&(i.change!==0||i.changePercent!==0)?(c(),d("div",hi,[s("span",fi,m(i.trendIcon),1),s("span",vi,m(i.formattedChange),1)])):M("",!0)]),s("div",pi,[s("div",{class:"metric-value",style:Ee({color:i.color})},m(i.formattedValue),5),s("div",yi,m(i.title),1),i.subtitle?(c(),d("div",_i,m(i.subtitle),1)):M("",!0),a.showComparison&&i.previousValue!==void 0?(c(),d("div",bi,[e[2]||(e[2]=s("span",{class:"comparison-label"},"vs –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–µ—Ä–∏–æ–¥:",-1)),s("span",wi,m(i.formattedPreviousValue),1)])):M("",!0)]),a.drillDown?(c(),d("div",Ci,[s("button",{class:"drill-down-btn",onClick:e[0]||(e[0]=pe((...o)=>i.handleDrillDown&&i.handleDrillDown(...o),["stop"]))}," –ü–æ–¥—Ä–æ–±–Ω–µ–µ ")])):M("",!0),a.interactive?(c(),d("div",ki,[s("div",Si,[e[3]||(e[3]=s("div",{class:"hover-title"},"–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π",-1)),i.changePercent!==0?(c(),d("div",Di," –ò–∑–º–µ–Ω–µ–Ω–∏–µ: "+m(i.formattedChangePercent),1)):M("",!0)])])):M("",!0)],2)}const Ti=J(ui,[["render",Ai],["__scopeId","data-v-0e808c5a"]]),Ei={name:"AdvancedFilters",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(n,{emit:e}){const a=p(!1),t=p(!1),r=p(""),i=p("all"),o=p("all"),l=p({timeRange:{type:"preset",preset:"week",custom:{from:null,to:null}},activityTypes:[],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"day",sortBy:"timestamp",sortOrder:"desc"}),u=[{key:"today",name:"–°–µ–≥–æ–¥–Ω—è",description:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ —Å–µ–≥–æ–¥–Ω—è",icon:"üìÖ",filters:{timeRange:{type:"preset",preset:"today"},activityTypes:[],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"hour",sortBy:"timestamp",sortOrder:"desc"}},{key:"active_users",name:"–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",description:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –≤—ã—Å–æ–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é",icon:"üöÄ",filters:{timeRange:{type:"preset",preset:"week"},activityTypes:["app_entry","page_visit"],departments:[],userActivity:"active",devices:[],browsers:[],groupBy:"user",sortBy:"timestamp",sortOrder:"desc"}},{key:"problem_sessions",name:"–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–µ—Å—Å–∏–∏",description:"–ö–æ—Ä–æ—Ç–∫–∏–µ —Å–µ—Å—Å–∏–∏ –∏ —á–∞—Å—Ç—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã",icon:"‚ö†Ô∏è",filters:{timeRange:{type:"preset",preset:"3days"},activityTypes:["app_entry"],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"session",sortBy:"timestamp",sortOrder:"desc"}},{key:"new_traffic",name:"–ù–æ–≤—ã–π —Ç—Ä–∞—Ñ–∏–∫",description:"–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ",icon:"üÜï",filters:{timeRange:{type:"preset",preset:"month"},activityTypes:[],departments:[],userActivity:"new",devices:[],browsers:[],groupBy:"day",sortBy:"timestamp",sortOrder:"desc"}}],h=[{value:"app_entry",label:"–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",icon:"üö™"},{value:"page_visit",label:"–ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",icon:"üìÑ"}],y=[{value:"desktop",label:"–ö–æ–º–ø—å—é—Ç–µ—Ä",icon:"üñ•Ô∏è"},{value:"mobile",label:"–¢–µ–ª–µ—Ñ–æ–Ω",icon:"üì±"},{value:"tablet",label:"–ü–ª–∞–Ω—à–µ—Ç",icon:"üì±"}],g=[{value:"chrome",label:"Chrome",icon:"üåê"},{value:"firefox",label:"Firefox",icon:"ü¶ä"},{value:"safari",label:"Safari",icon:"üß≠"},{value:"edge",label:"Edge",icon:"‚ö°"},{value:"opera",label:"Opera",icon:"üé≠"}],k=[{id:369,name:"–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª"},{id:366,name:"–°–µ–∫—Ç–æ—Ä 1–°"}],A=p([]);ee(()=>n.modelValue,L=>{L&&Object.keys(L).length>0&&(l.value={...L})},{deep:!0,immediate:!0});const E=()=>{try{const L=localStorage.getItem("activity_filter_presets");L&&(A.value=JSON.parse(L))}catch(L){console.error("[AdvancedFilters] Error loading saved filters:",L)}},S=()=>{try{localStorage.setItem("activity_filter_presets",JSON.stringify(A.value))}catch(L){console.error("[AdvancedFilters] Error saving filters:",L)}},I=()=>{l.value.timeRange.type==="preset"&&(l.value.timeRange.preset="week",f())},f=()=>{const L=l.value.timeRange.preset,V=new Date;let O,D;switch(L){case"today":O=new Date(V.getFullYear(),V.getMonth(),V.getDate()),D=new Date(V.getFullYear(),V.getMonth(),V.getDate(),23,59,59);break;case"yesterday":const H=new Date(V);H.setDate(H.getDate()-1),O=new Date(H.getFullYear(),H.getMonth(),H.getDate()),D=new Date(H.getFullYear(),H.getMonth(),H.getDate(),23,59,59);break;case"3days":O=new Date(V),O.setDate(O.getDate()-3),D=V;break;case"week":O=new Date(V),O.setDate(O.getDate()-7),D=V;break;case"month":O=new Date(V),O.setMonth(O.getMonth()-1),D=V;break;case"quarter":O=new Date(V),O.setMonth(O.getMonth()-3),D=V;break;case"year":O=new Date(V),O.setFullYear(O.getFullYear()-1),D=V;break}l.value.timeRange.custom.from=O.toISOString().split("T")[0],l.value.timeRange.custom.to=D.toISOString().split("T")[0]},v=L=>{l.value={...L.filters},a.value=!1,w()},w=()=>{const L={dateFrom:null,dateTo:null,userId:null,type:l.value.activityTypes.length>0?l.value.activityTypes:null,departments:l.value.departments,userActivity:l.value.userActivity,devices:l.value.devices,browsers:l.value.browsers,groupBy:l.value.groupBy,sortBy:l.value.sortBy,sortOrder:l.value.sortOrder};l.value.timeRange.type,l.value.timeRange.custom.from&&(L.dateFrom=l.value.timeRange.custom.from),l.value.timeRange.custom.to&&(L.dateTo=l.value.timeRange.custom.to),e("update:modelValue",L),e("change",L)},F=()=>{l.value={timeRange:{type:"preset",preset:"week",custom:{from:null,to:null}},activityTypes:[],departments:[],userActivity:"all",devices:[],browsers:[],groupBy:"day",sortBy:"timestamp",sortOrder:"desc"},i.value="all",o.value="all",w()},U=()=>{if(!r.value.trim())return;const L={id:Date.now().toString(),name:r.value.trim(),filters:{...l.value},createdAt:new Date().toISOString()};A.value.push(L),S(),r.value="",t.value=!1},C=L=>{l.value={...L.filters},w()},_=L=>{A.value=A.value.filter(V=>V.id!==L),S()},b=L=>{try{return new Date(L).toLocaleDateString("ru-RU")}catch{return L}};return E(),{showPresets:a,showSaveDialog:t,saveFilterName:r,localFilters:l,selectedDepartmentMode:i,selectedBrowserMode:o,filterPresets:u,activityTypeOptions:h,deviceOptions:y,browserOptions:g,availableDepartments:k,savedFilters:A,handleTimeRangeTypeChange:I,applyTimePreset:f,applyPreset:v,applyFilters:w,resetFilters:F,saveCurrentFilter:U,loadSavedFilter:C,deleteSavedFilter:_,formatDate:b}}},Mi={class:"advanced-filters"},xi={class:"filters-header"},Ii={class:"filters-actions"},Li={key:0,class:"presets-panel"},Pi={class:"presets-grid"},Fi=["onClick"],Ui={class:"preset-icon"},Ri={class:"preset-content"},Oi={class:"preset-name"},Ni={class:"preset-description"},Bi={class:"filters-content"},Vi={class:"filter-group time-range"},ji={class:"time-range-controls"},zi={key:0,class:"preset-options"},$i={key:1,class:"custom-range"},Wi={class:"filter-group activity-types"},Hi={class:"checkbox-group"},qi=["value"],Ji={class:"checkbox-label"},Xi={class:"type-icon"},Yi={class:"filter-group departments"},Ki={class:"departments-controls"},Gi={key:0,class:"departments-list"},Qi={class:"department-checkbox"},Zi=["value"],el={class:"checkbox-label"},tl={class:"filter-group usage-frequency"},sl={class:"filter-group devices"},al={class:"checkbox-group"},ol=["value"],nl={class:"checkbox-label"},rl={class:"device-icon"},il={class:"filter-group browsers"},ll={class:"browsers-controls"},cl={key:0,class:"browsers-list"},dl={class:"browser-checkbox"},ul=["value"],ml={class:"checkbox-label"},gl={class:"browser-icon"},hl={class:"filter-group grouping"},fl={class:"grouping-controls"},vl={class:"group-by-control"},pl={class:"sort-control"},yl={class:"saved-filters"},_l={class:"saved-filters-header"},bl={key:0,class:"saved-filters-list"},wl={class:"filter-info"},Cl={class:"filter-name"},kl={class:"filter-date"},Sl={class:"filter-actions"},Dl=["onClick"],Al=["onClick"],Tl={key:1,class:"no-saved-filters"},El={class:"dialog-content"},Ml={class:"dialog-actions"},xl=["disabled"];function Il(n,e,a,t,r,i){return c(),d("div",Mi,[s("div",xi,[e[26]||(e[26]=s("h4",{class:"filters-title"},"üîç –§–∏–ª—å—Ç—Ä—ã –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞",-1)),s("div",Ii,[s("button",{onClick:e[0]||(e[0]=o=>t.showPresets=!t.showPresets),class:"presets-btn"}," üìã –®–∞–±–ª–æ–Ω—ã "),s("button",{onClick:e[1]||(e[1]=(...o)=>t.resetFilters&&t.resetFilters(...o)),class:"reset-btn"}," üîÑ –°–±—Ä–æ—Å "),s("button",{onClick:e[2]||(e[2]=(...o)=>t.applyFilters&&t.applyFilters(...o)),class:"apply-btn"}," ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å ")])]),t.showPresets?(c(),d("div",Li,[s("div",Pi,[(c(!0),d(j,null,z(t.filterPresets,o=>(c(),d("button",{key:o.key,onClick:l=>t.applyPreset(o),class:"preset-btn"},[s("div",Ui,m(o.icon),1),s("div",Ri,[s("div",Oi,m(o.name),1),s("div",Ni,m(o.description),1)])],8,Fi))),128))])])):M("",!0),s("div",Bi,[s("div",Vi,[e[30]||(e[30]=s("label",{class:"filter-label"},"üìÖ –í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω",-1)),s("div",ji,[$(s("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.localFilters.timeRange.type=o),onChange:e[4]||(e[4]=(...o)=>t.handleTimeRangeTypeChange&&t.handleTimeRangeTypeChange(...o)),class:"range-type-select"},[...e[27]||(e[27]=[s("option",{value:"preset"},"–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞",-1),s("option",{value:"custom"},"–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π",-1)])],544),[[re,t.localFilters.timeRange.type]]),t.localFilters.timeRange.type==="preset"?(c(),d("div",zi,[$(s("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>t.localFilters.timeRange.preset=o),onChange:e[6]||(e[6]=(...o)=>t.applyTimePreset&&t.applyTimePreset(...o)),class:"time-preset-select"},[...e[28]||(e[28]=[tt('<option value="today" data-v-22b9cf1c>–°–µ–≥–æ–¥–Ω—è</option><option value="yesterday" data-v-22b9cf1c>–í—á–µ—Ä–∞</option><option value="3days" data-v-22b9cf1c>3 –¥–Ω—è</option><option value="week" data-v-22b9cf1c>–ù–µ–¥–µ–ª—è</option><option value="month" data-v-22b9cf1c>–ú–µ—Å—è—Ü</option><option value="quarter" data-v-22b9cf1c>–ö–≤–∞—Ä—Ç–∞–ª</option><option value="year" data-v-22b9cf1c>–ì–æ–¥</option>',7)])],544),[[re,t.localFilters.timeRange.preset]])])):(c(),d("div",$i,[$(s("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=o=>t.localFilters.timeRange.custom.from=o),class:"date-input",placeholder:"–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞"},null,512),[[be,t.localFilters.timeRange.custom.from]]),e[29]||(e[29]=s("span",{class:"date-separator"},"‚Äî",-1)),$(s("input",{type:"date","onUpdate:modelValue":e[8]||(e[8]=o=>t.localFilters.timeRange.custom.to=o),class:"date-input",placeholder:"–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è"},null,512),[[be,t.localFilters.timeRange.custom.to]])]))])]),s("div",Wi,[e[31]||(e[31]=s("label",{class:"filter-label"},"üéØ –¢–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),s("div",Hi,[(c(!0),d(j,null,z(t.activityTypeOptions,o=>(c(),d("label",{key:o.value,class:"checkbox-item"},[$(s("input",{type:"checkbox",value:o.value,"onUpdate:modelValue":e[9]||(e[9]=l=>t.localFilters.activityTypes=l),class:"checkbox-input"},null,8,qi),[[Be,t.localFilters.activityTypes]]),s("span",Ji,[s("span",Xi,m(o.icon),1),Q(" "+m(o.label),1)])]))),128))])]),s("div",Yi,[e[33]||(e[33]=s("label",{class:"filter-label"},"üè¢ –û—Ç–¥–µ–ª—ã",-1)),s("div",Ki,[$(s("select",{"onUpdate:modelValue":e[10]||(e[10]=o=>t.selectedDepartmentMode=o),class:"mode-select"},[...e[32]||(e[32]=[s("option",{value:"all"},"–í—Å–µ –æ—Ç–¥–µ–ª—ã",-1),s("option",{value:"specific"},"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –æ—Ç–¥–µ–ª—ã",-1)])],512),[[re,t.selectedDepartmentMode]]),t.selectedDepartmentMode==="specific"?(c(),d("div",Gi,[(c(!0),d(j,null,z(t.availableDepartments,o=>(c(),d("div",{class:"department-item",key:o.id},[s("label",Qi,[$(s("input",{type:"checkbox",value:o.id,"onUpdate:modelValue":e[11]||(e[11]=l=>t.localFilters.departments=l),class:"checkbox-input"},null,8,Zi),[[Be,t.localFilters.departments]]),s("span",el,m(o.name),1)])]))),128))])):M("",!0)])]),s("div",tl,[e[35]||(e[35]=s("label",{class:"filter-label"},"üìä –ß–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",-1)),$(s("select",{"onUpdate:modelValue":e[12]||(e[12]=o=>t.localFilters.userActivity=o),class:"frequency-select"},[...e[34]||(e[34]=[s("option",{value:"all"},"–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",-1),s("option",{value:"new"},"–ù–æ–≤—ã–µ (–ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –∑–∞ –ø–µ—Ä–∏–æ–¥)",-1),s("option",{value:"active"},"–ê–∫—Ç–∏–≤–Ω—ã–µ (‚â•5 –¥–µ–π—Å—Ç–≤–∏–π)",-1),s("option",{value:"inactive"},"–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ (<5 –¥–µ–π—Å—Ç–≤–∏–π)",-1)])],512),[[re,t.localFilters.userActivity]])]),s("div",sl,[e[36]||(e[36]=s("label",{class:"filter-label"},"üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞",-1)),s("div",al,[(c(!0),d(j,null,z(t.deviceOptions,o=>(c(),d("label",{key:o.value,class:"checkbox-item"},[$(s("input",{type:"checkbox",value:o.value,"onUpdate:modelValue":e[13]||(e[13]=l=>t.localFilters.devices=l),class:"checkbox-input"},null,8,ol),[[Be,t.localFilters.devices]]),s("span",nl,[s("span",rl,m(o.icon),1),Q(" "+m(o.label),1)])]))),128))])]),s("div",il,[e[38]||(e[38]=s("label",{class:"filter-label"},"üåê –ë—Ä–∞—É–∑–µ—Ä—ã",-1)),s("div",ll,[$(s("select",{"onUpdate:modelValue":e[14]||(e[14]=o=>t.selectedBrowserMode=o),class:"mode-select"},[...e[37]||(e[37]=[s("option",{value:"all"},"–í—Å–µ –±—Ä–∞—É–∑–µ—Ä—ã",-1),s("option",{value:"specific"},"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã",-1)])],512),[[re,t.selectedBrowserMode]]),t.selectedBrowserMode==="specific"?(c(),d("div",cl,[(c(!0),d(j,null,z(t.browserOptions,o=>(c(),d("div",{class:"browser-item",key:o.value},[s("label",dl,[$(s("input",{type:"checkbox",value:o.value,"onUpdate:modelValue":e[15]||(e[15]=l=>t.localFilters.browsers=l),class:"checkbox-input"},null,8,ul),[[Be,t.localFilters.browsers]]),s("span",ml,[s("span",gl,m(o.icon),1),Q(" "+m(o.label),1)])])]))),128))])):M("",!0)])]),s("div",hl,[e[44]||(e[44]=s("label",{class:"filter-label"},"üìã –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞",-1)),s("div",fl,[s("div",vl,[e[40]||(e[40]=s("label",{class:"sub-label"},"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ:",-1)),$(s("select",{"onUpdate:modelValue":e[16]||(e[16]=o=>t.localFilters.groupBy=o),class:"group-by-select"},[...e[39]||(e[39]=[tt('<option value="day" data-v-22b9cf1c>–î–Ω—è–º</option><option value="week" data-v-22b9cf1c>–ù–µ–¥–µ–ª—è–º</option><option value="month" data-v-22b9cf1c>–ú–µ—Å—è—Ü–∞–º</option><option value="user" data-v-22b9cf1c>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</option><option value="page" data-v-22b9cf1c>–°—Ç—Ä–∞–Ω–∏—Ü–∞–º</option><option value="session" data-v-22b9cf1c>–°–µ—Å—Å–∏—è–º</option>',6)])],512),[[re,t.localFilters.groupBy]])]),s("div",pl,[e[43]||(e[43]=s("label",{class:"sub-label"},"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:",-1)),$(s("select",{"onUpdate:modelValue":e[17]||(e[17]=o=>t.localFilters.sortBy=o),class:"sort-by-select"},[...e[41]||(e[41]=[s("option",{value:"timestamp"},"–ü–æ –≤—Ä–µ–º–µ–Ω–∏",-1),s("option",{value:"user"},"–ü–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é",-1),s("option",{value:"type"},"–ü–æ —Ç–∏–ø—É",-1),s("option",{value:"page"},"–ü–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ",-1)])],512),[[re,t.localFilters.sortBy]]),$(s("select",{"onUpdate:modelValue":e[18]||(e[18]=o=>t.localFilters.sortOrder=o),class:"sort-order-select"},[...e[42]||(e[42]=[s("option",{value:"desc"},"–£–±—ã–≤–∞–Ω–∏–µ",-1),s("option",{value:"asc"},"–í–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ",-1)])],512),[[re,t.localFilters.sortOrder]])])])])]),s("div",yl,[s("div",_l,[e[45]||(e[45]=s("h5",{class:"saved-title"},"üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã",-1)),s("button",{onClick:e[19]||(e[19]=o=>t.showSaveDialog=!0),class:"save-current-btn"}," –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π ")]),t.savedFilters.length>0?(c(),d("div",bl,[(c(!0),d(j,null,z(t.savedFilters,o=>(c(),d("div",{key:o.id,class:"saved-filter-item"},[s("div",wl,[s("div",Cl,m(o.name),1),s("div",kl,"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: "+m(t.formatDate(o.createdAt)),1)]),s("div",Sl,[s("button",{onClick:l=>t.loadSavedFilter(o),class:"load-btn"},"–ó–∞–≥—Ä—É–∑–∏—Ç—å",8,Dl),s("button",{onClick:l=>t.deleteSavedFilter(o.id),class:"delete-btn"},"–£–¥–∞–ª–∏—Ç—å",8,Al)])]))),128))])):(c(),d("div",Tl," –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ "))]),t.showSaveDialog?(c(),d("div",{key:1,class:"save-dialog-overlay",onClick:e[25]||(e[25]=o=>t.showSaveDialog=!1)},[s("div",{class:"save-dialog",onClick:e[24]||(e[24]=pe(()=>{},["stop"]))},[e[47]||(e[47]=s("h4",null,"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä",-1)),s("div",El,[e[46]||(e[46]=s("label",{class:"dialog-label"},"–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞:",-1)),$(s("input",{"onUpdate:modelValue":e[20]||(e[20]=o=>t.saveFilterName=o),type:"text",class:"save-name-input",placeholder:"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ...",onKeyup:e[21]||(e[21]=De((...o)=>t.saveCurrentFilter&&t.saveCurrentFilter(...o),["enter"]))},null,544),[[be,t.saveFilterName]])]),s("div",Ml,[s("button",{onClick:e[22]||(e[22]=o=>t.showSaveDialog=!1),class:"cancel-btn"},"–û—Ç–º–µ–Ω–∞"),s("button",{onClick:e[23]||(e[23]=(...o)=>t.saveCurrentFilter&&t.saveCurrentFilter(...o)),disabled:!t.saveFilterName.trim(),class:"save-btn"},"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",8,xl)])])])):M("",!0)])}const Ll=J(Ei,[["render",Il],["__scopeId","data-v-22b9cf1c"]]);class ue{static prepareTimeChartData(e,a="day",t={}){if(!Array.isArray(e))return this.getEmptyTimeChartData();const{ActivityAnalyticsService:r}=t,i=r?r.groupActivity(e,a):this.fallbackGroupByTime(e,a);return{labels:i.map(o=>this.formatGroupLabel(o.key,a)),datasets:[{label:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",data:i.map(o=>o.count),borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"#2196F3",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]}}static prepareDistributionChartData(e,a,t="doughnut"){try{if(!Array.isArray(e))return console.warn("[VisualizationHelpers] prepareDistributionChartData: activity is not an array"),this.getEmptyDistributionData();if(e.length===0)return this.getEmptyDistributionData();if(!e.every(l=>typeof l=="object"&&l!==null))return console.warn("[VisualizationHelpers] prepareDistributionChartData: some items are not objects"),this.getEmptyDistributionData();const r=this.calculateDistribution(e,a),i=this.generateColors(Object.keys(r).length),o={labels:Object.keys(r),datasets:[{data:Object.values(r),backgroundColor:i,borderColor:i.map(l=>this.adjustColorBrightness(l,-20)),borderWidth:t==="doughnut"?2:1,hoverBorderWidth:t==="doughnut"?3:2}]};return t==="bar"&&(o.datasets[0].borderRadius=4,o.datasets[0].borderSkipped=!1),o}catch(r){return console.error("[VisualizationHelpers] prepareDistributionChartData error:",r),this.getEmptyDistributionData()}}static prepareUserRankingData(e,a=10){if(!Array.isArray(e))return[];const t=new Map;return e.forEach(r=>{if(!r||typeof r!="object")return;const i=r.user_id;if(!i)return;t.has(i)||t.set(i,{id:i,name:r.user_name||`User #${i}`,count:0,app_entries:0,page_visits:0,last_activity:r.timestamp});const o=t.get(i);o.count++,r.type==="app_entry"?o.app_entries++:r.type==="page_visit"&&o.page_visits++,r.timestamp&&(!o.last_activity||r.timestamp>o.last_activity)&&(o.last_activity=r.timestamp)}),Array.from(t.values()).sort((r,i)=>i.count-r.count).slice(0,a).map((r,i)=>({...r,rank:i+1,lastActivityFormatted:this.formatTimestamp(r.last_activity)}))}static prepareSessionTimelineData(e){return Array.isArray(e)?e.map(a=>({id:a.id,startTime:a.startTime,endTime:a.endTime,duration:a.duration,pageCount:a.pageCount,entriesCount:a.entriesCount,actions:a.actions,device:a.device,formattedStartTime:this.formatTimestamp(new Date(a.startTime)),formattedDuration:this.formatDuration(a.duration),color:this.getSessionColor(a)})):[]}static formatActivityData(e){return Array.isArray(e)?e.map(a=>({...a,formattedTimestamp:this.formatTimestamp(a.timestamp),formattedDuration:a.duration?this.formatDuration(a.duration):null,userDisplayName:a.user_name||`User #${a.user_id}`,pageDisplayName:this.formatPageName(a),deviceInfo:this.parseUserAgent(a.user_agent),actionIcon:this.getActionIcon(a.type),actionColor:this.getActionColor(a.type)})):[]}static prepareComparisonChartData(e,a,t="day"){const r=this.prepareTimeChartData(e,t),i=this.prepareTimeChartData(a,t),o=new Set([...r.labels,...i.labels]),l=Array.from(o).sort(),u=new Map(r.labels.map((y,g)=>[y,r.datasets[0].data[g]])),h=new Map(i.labels.map((y,g)=>[y,i.datasets[0].data[g]]));return{labels:l,datasets:[{label:"–¢–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥",data:l.map(y=>u.get(y)||0),borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",fill:!0,tension:.4},{label:"–ü—Ä–µ–¥—ã–¥—É—â–∏–π –ø–µ—Ä–∏–æ–¥",data:l.map(y=>h.get(y)||0),borderColor:"#FF9800",backgroundColor:"rgba(255, 152, 0, 0.1)",fill:!0,tension:.4}]}}static calculateDistribution(e,a){if(!Array.isArray(e))return console.warn("[VisualizationHelpers] calculateDistribution: activity is not an array",e),{};const t={};return e.forEach(r=>{if(!r||typeof r!="object"){console.warn("[VisualizationHelpers] calculateDistribution: invalid entry",r);return}let i;switch(a){case"activity_types":i=r.type||"unknown";break;case"devices":i=this.detectDevice(r.user_agent);break;case"browsers":i=this.detectBrowser(r.user_agent);break;case"departments":i=r.user_department||"–ù–µ —É–∫–∞–∑–∞–Ω";break;case"pages":i=r.route_path||r.route_title||r.route_name||"unknown";break;default:i="–î—Ä—É–≥–æ–µ"}t[i]=(t[i]||0)+1}),t}static fallbackGroupByTime(e,a){if(!Array.isArray(e))return[];const t=new Map;return e.forEach(r=>{if(!r||!r.timestamp)return;let i;const o=new Date(r.timestamp);switch(a){case"hour":i=o.getHours();break;case"day":i=o.toISOString().split("T")[0];break;case"week":i=new Date(o.setDate(o.getDate()-o.getDay())).toISOString().split("T")[0];break;case"month":i=o.toISOString().substring(0,7);break;default:i="all"}t.has(i)||t.set(i,{key:i,entries:[],count:0}),t.get(i).entries.push(r),t.get(i).count++}),Array.from(t.values()).sort((r,i)=>["day","week","month"].includes(a)?new Date(i.key)-new Date(r.key):i.count-r.count)}static formatGroupLabel(e,a){switch(a){case"hour":return`${e}:00`;case"day":return this.formatDate(e);case"week":return`–ù–µ–¥–µ–ª—è ${e}`;case"month":return this.formatMonth(e);default:return e}}static detectDevice(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const a=e.toLowerCase();return a.includes("mobile")||a.includes("android")||a.includes("iphone")?"Mobile":a.includes("tablet")||a.includes("ipad")?"Tablet":"Desktop"}static detectBrowser(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const a=e.toLowerCase();return a.includes("chrome")&&!a.includes("edg")?"Chrome":a.includes("firefox")?"Firefox":a.includes("safari")&&!a.includes("chrome")?"Safari":a.includes("edg")?"Edge":a.includes("opera")?"Opera":"–î—Ä—É–≥–æ–µ"}static parseUserAgent(e){return e?{device:this.detectDevice(e),browser:this.detectBrowser(e),os:this.detectOS(e)}:{device:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",browser:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",os:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}}static detectOS(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";const a=e.toLowerCase();return a.includes("windows")?"Windows":a.includes("macintosh")||a.includes("mac os x")?"macOS":a.includes("linux")?"Linux":a.includes("android")?"Android":a.includes("ios")||a.includes("iphone")||a.includes("ipad")?"iOS":"–î—Ä—É–≥–æ–µ"}static generateColors(e){const a=["#2196F3","#4CAF50","#FF9800","#F44336","#9C27B0","#00BCD4","#8BC34A","#FFC107","#795548","#607D8B"];if(e<=a.length)return a.slice(0,e);const t=[];for(let r=a.length;r<e;r++)t.push(this.generateRandomColor());return[...a,...t]}static generateRandomColor(){return`hsl(${Math.floor(Math.random()*360)}, 70%, 50%)`}static adjustColorBrightness(e,a){if(e.startsWith("#")){const t=e[0]==="#",r=t?e.slice(1):e,i=parseInt(r,16);let o=(i>>16)+a,l=(i>>8&255)+a,u=(i&255)+a;return o=o>255?255:o<0?0:o,l=l>255?255:l<0?0:l,u=u>255?255:u<0?0:u,(t?"#":"")+(o<<16|l<<8|u).toString(16)}return e}static formatDate(e){try{return new Date(e).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return e}}static formatMonth(e){try{const[a,t]=e.split("-");return new Date(a,t-1,1).toLocaleDateString("ru-RU",{year:"numeric",month:"long"})}catch{return e}}static formatTimestamp(e){if(!e)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{return new Date(e).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return e}}static formatDuration(e){if(!e||e<0)return"0—Å";const a=Math.floor(e/1e3),t=Math.floor(a/60),r=Math.floor(t/60);return r>0?`${r}—á ${t%60}–º`:t>0?`${t}–º ${a%60}—Å`:`${a}—Å`}static formatPageName(e){return e&&(e.route_title||e.route_path||e.route_name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}static getActionIcon(e){switch(e){case"app_entry":return"üö™";case"page_visit":return"üìÑ";default:return"‚ùì"}}static getActionColor(e){switch(e){case"app_entry":return"#4CAF50";case"page_visit":return"#2196F3";default:return"#9E9E9E"}}static getSessionColor(e){const a=e.duration||0;return a<5*60*1e3?"#4CAF50":a<15*60*1e3?"#FF9800":"#F44336"}static getEmptyTimeChartData(){return{labels:[],datasets:[{label:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",data:[],borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",fill:!0,tension:.4}]}}static getEmptyDistributionData(){return{labels:[],datasets:[{data:[],backgroundColor:[],borderColor:[],borderWidth:2}]}}}Ue.register(ct,dt,St,Dt,ut,mt,gt,At);const Pl={name:"TimeChart",props:{data:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},title:{type:String,default:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏"},height:{type:Number,default:300},interactive:{type:Boolean,default:!0},showStats:{type:Boolean,default:!0},groupBy:{type:String,default:"day",validator:n=>["hour","day","week","month"].includes(n)}},emits:["time-range-change","data-point-click"],setup(n,{emit:e}){const a=p(null),t=p(null),r=p(!1),i=p(null),o=p(n.groupBy),l=T(()=>{try{if(!Array.isArray(n.data)||n.data.length===0)return ue.getEmptyTimeChartData();if(!n.data.every(w=>typeof w=="object"&&w!==null))return console.warn("[TimeChart] Invalid data format, some items are not objects"),ue.getEmptyTimeChartData();const f=n.data.filter(w=>w&&typeof w=="object"&&w!==null&&w.timestamp&&typeof w.type=="string");if(f.length===0)return ue.getEmptyTimeChartData();const v=ue.prepareTimeChartData(f,o.value,{ActivityAnalyticsService:Ne});return!v||!v.labels||!v.datasets?(console.warn("[TimeChart] Prepared data is invalid"),ue.getEmptyTimeChartData()):v}catch(f){return console.error("[TimeChart] Error preparing chart data:",f),i.value="–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞",ue.getEmptyTimeChartData()}}),u=T(()=>!l.value.datasets||l.value.datasets.length===0?0:Math.max(...l.value.datasets[0].data)),h=T(()=>{if(!l.value.datasets||l.value.datasets.length===0)return 0;const f=l.value.datasets[0].data;return f.length>0?f.reduce((v,w)=>v+w,0)/f.length:0}),y=()=>{if(!a.value||!l.value)return;I();const f=a.value.getContext("2d");if(!f){console.error("[TimeChart] Canvas context not available"),i.value="–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞";return}try{t.value=new Ue(f,{type:"line",data:l.value,options:{responsive:!0,maintainAspectRatio:!1,devicePixelRatio:1,animation:{duration:0},plugins:{legend:{display:!0,position:"top"},tooltip:{enabled:n.interactive,mode:"index",intersect:!1,callbacks:{label:v=>{const w=v.dataset.label||"",F=v.parsed.y;return`${w}: ${F}`},title:v=>v.length===0?"":v[0].label}}},scales:{x:{display:!0,title:{display:!0,text:A()}},y:{display:!0,beginAtZero:!0,title:{display:!0,text:"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π"},ticks:{precision:0}}},interaction:{intersect:!1,mode:"index"},onClick:n.interactive?g:null,onHover:n.interactive?k:null}})}catch(v){console.error("[TimeChart] Error creating chart:",v),i.value="–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞",t.value=null}},g=(f,v)=>{if(v.length>0){const w=v[0].index,F=l.value.labels[w],U=l.value.datasets[0].data[w];e("data-point-click",{label:F,value:U,groupBy:o.value,index:w})}},k=(f,v)=>{f.native.target.style.cursor=v.length>0?"pointer":"default"},A=()=>{switch(o.value){case"hour":return"–ß–∞—Å—ã";case"day":return"–î–Ω–∏";case"week":return"–ù–µ–¥–µ–ª–∏";case"month":return"–ú–µ—Å—è—Ü—ã";default:return"–í—Ä–µ–º—è"}},E=async()=>{if(t.value&&l.value){r.value=!0,i.value=null;try{const f=t.value.data,v=l.value;JSON.stringify(f)!==JSON.stringify(v)&&(t.value.data=v,t.value.options.scales.x.title.text=A(),t.value.update("none"))}catch(f){console.error("[TimeChart] Error updating chart:",f),i.value="–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞"}finally{r.value=!1}}},S=async()=>{t.value&&I(),await Tt(),y()},I=()=>{t.value&&(t.value.destroy(),t.value=null)};return ee(()=>n.data,(f,v)=>{JSON.stringify(f)!==JSON.stringify(v)&&S()},{deep:!0}),ee(()=>o.value,(f,v)=>{f!==v&&S()}),ee(()=>n.groupBy,f=>{o.value=f}),de(()=>{y()}),He(()=>{I()}),{chartCanvas:a,chartData:l,loading:r,error:i,selectedGroupBy:o,maxValue:u,averageValue:h,updateChart:E}}},Fl={class:"time-chart-container"},Ul={class:"chart-header"},Rl={class:"chart-title"},Ol={class:"chart-controls"},Nl={key:0,class:"chart-loading"},Bl={key:1,class:"chart-error"},Vl={key:2,class:"chart-canvas-container"},jl={ref:"chartCanvas"},zl={key:0,class:"chart-stats"},$l={class:"stat-item"},Wl={class:"stat-value"},Hl={class:"stat-item"},ql={class:"stat-value"},Jl={class:"stat-item"},Xl={class:"stat-value"};function Yl(n,e,a,t,r,i){return c(),d("div",Fl,[s("div",Ul,[s("h3",Rl,m(a.title),1),s("div",Ol,[$(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.selectedGroupBy=o),onChange:e[1]||(e[1]=(...o)=>t.updateChart&&t.updateChart(...o)),class:"group-by-select"},[...e[2]||(e[2]=[s("option",{value:"hour"},"–ü–æ —á–∞—Å–∞–º",-1),s("option",{value:"day"},"–ü–æ –¥–Ω—è–º",-1),s("option",{value:"week"},"–ü–æ –Ω–µ–¥–µ–ª—è–º",-1),s("option",{value:"month"},"–ü–æ –º–µ—Å—è—Ü–∞–º",-1)])],544),[[re,t.selectedGroupBy]])])]),s("div",{class:N(["chart-wrapper",{loading:t.loading}])},[t.loading?(c(),d("div",Nl," –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞... ")):t.error?(c(),d("div",Bl,m(t.error),1)):(c(),d("div",Vl,[s("canvas",jl,null,512)]))],2),a.showStats&&t.chartData.labels.length>0?(c(),d("div",zl,[s("div",$l,[e[3]||(e[3]=s("span",{class:"stat-label"},"–í—Å–µ–≥–æ —Ç–æ—á–µ–∫:",-1)),s("span",Wl,m(t.chartData.labels.length),1)]),s("div",Hl,[e[4]||(e[4]=s("span",{class:"stat-label"},"–ú–∞–∫—Å–∏–º—É–º:",-1)),s("span",ql,m(t.maxValue),1)]),s("div",Jl,[e[5]||(e[5]=s("span",{class:"stat-label"},"–°—Ä–µ–¥–Ω–µ–µ:",-1)),s("span",Xl,m(t.averageValue.toFixed(1)),1)])])):M("",!0)])}const zt=J(Pl,[["render",Yl],["__scopeId","data-v-f4245347"]]);Ue.register(ct,dt,Et,Mt,ut,mt,gt);const Kl={name:"DistributionChart",props:{data:{type:Array,default:()=>[]},type:{type:String,default:"activity_types",validator:n=>["activity_types","devices","browsers","departments","pages"].includes(n)},chartType:{type:String,default:"doughnut",validator:n=>["doughnut","bar","pie"].includes(n)},title:{type:String,default:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ"},height:{type:Number,default:300},showLegend:{type:Boolean,default:!0},maxItems:{type:Number,default:10}},emits:["segment-click","type-change"],setup(n,{emit:e}){const a=p(null),t=p(null),r=p(!1),i=p(null),o=p(n.type),l=p(n.chartType),u=T(()=>{try{if(!Array.isArray(n.data)||n.data.length===0)return ue.getEmptyDistributionData();const f=n.data.filter(v=>v&&typeof v=="object"&&v!==null&&typeof v.type=="string");return f.length===0?ue.getEmptyDistributionData():ue.prepareDistributionChartData(f,o.value,l.value)}catch(f){return console.error("[DistributionChart] Error preparing chart data:",f),i.value="–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º—ã",ue.getEmptyDistributionData()}}),h=T(()=>u.value.datasets&&u.value.datasets.length>0&&u.value.datasets[0].data&&u.value.datasets[0].data.length>0&&u.value.datasets[0].data.some(f=>f>0)),y=T(()=>{if(!h.value||!u.value.labels)return[];const f=u.value.labels,v=u.value.datasets[0].data,w=u.value.datasets[0].backgroundColor,F=v.reduce((U,C)=>U+C,0);return f.map((U,C)=>({label:U.length>20?U.substring(0,20)+"...":U,fullLabel:U,value:v[C],percentage:F>0?v[C]/F*100:0,color:w[C]})).sort((U,C)=>C.value-U.value)}),g=()=>{if(!a.value||!h.value)return;I();const f=a.value.getContext("2d");if(!f){console.error("[DistributionChart] Canvas context not available"),i.value="–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã";return}try{const v=k(l.value);t.value=new v({ctx:f,data:u.value,options:A()})}catch(v){console.error("[DistributionChart] Error creating chart:",v),i.value="–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã",t.value=null}},k=f=>{switch(f){case"bar":return Gt;case"pie":return Kt;case"doughnut":default:return Yt}},A=()=>{const f={responsive:!1,devicePixelRatio:1,maintainAspectRatio:!1,animation:{duration:0},maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:v=>{const w=v.label||"",F=v.parsed,U=v.dataset.data.reduce((_,b)=>_+b,0),C=U>0?(F/U*100).toFixed(1):0;return`${w}: ${F} (${C}%)`}}}},onClick:E};return l.value==="bar"&&(f.scales={y:{beginAtZero:!0,ticks:{precision:0}}}),(l.value==="doughnut"||l.value==="pie")&&(f.plugins.tooltip.callbacks.title=v=>v[0]?.label||""),f},E=(f,v)=>{if(v.length>0){const w=v[0].index,F=u.value.labels[w],U=u.value.datasets[0].data[w];e("segment-click",{type:o.value,label:F,value:U,index:w})}},S=async()=>{r.value=!0,i.value=null;try{await Tt(),I(),g()}catch(f){console.error("[DistributionChart] Error updating chart:",f),i.value="–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã"}finally{r.value=!1}},I=()=>{t.value&&(t.value.destroy(),t.value=null)};return ee(()=>n.data,()=>{S()},{deep:!0}),ee(()=>n.type,f=>{o.value=f}),ee(()=>n.chartType,f=>{l.value=f}),de(()=>{g()}),He(()=>{I()}),{chartCanvas:a,chartData:u,loading:r,error:i,selectedType:o,selectedChartType:l,hasData:h,legendItems:y,updateChart:S}}},Gl={class:"distribution-chart-container"},Ql={class:"chart-header"},Zl={class:"chart-title"},ec={class:"chart-controls"},tc={key:0,class:"chart-loading"},sc={key:1,class:"chart-error"},ac={key:2,class:"chart-empty"},oc={key:3,class:"chart-canvas-container"},nc={ref:"chartCanvas"},rc={key:0,class:"chart-legend"},ic={class:"legend-label"},lc={class:"legend-value"};function cc(n,e,a,t,r,i){return c(),d("div",Gl,[s("div",Ql,[s("h3",Zl,m(a.title),1),s("div",ec,[$(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.selectedType=o),onChange:e[1]||(e[1]=(...o)=>t.updateChart&&t.updateChart(...o)),class:"chart-type-select"},[...e[4]||(e[4]=[tt('<option value="activity_types" data-v-9185ae08>–¢–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</option><option value="devices" data-v-9185ae08>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</option><option value="browsers" data-v-9185ae08>–ë—Ä–∞—É–∑–µ—Ä—ã</option><option value="departments" data-v-9185ae08>–û—Ç–¥–µ–ª—ã</option><option value="pages" data-v-9185ae08>–°—Ç—Ä–∞–Ω–∏—Ü—ã</option>',5)])],544),[[re,t.selectedType]]),$(s("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.selectedChartType=o),onChange:e[3]||(e[3]=(...o)=>t.updateChart&&t.updateChart(...o)),class:"chart-style-select"},[...e[5]||(e[5]=[s("option",{value:"doughnut"},"–ö—Ä—É–≥–æ–≤–∞—è",-1),s("option",{value:"bar"},"–°—Ç–æ–ª–±—á–∞—Ç–∞—è",-1),s("option",{value:"pie"},"–°–µ–∫—Ç–æ—Ä–Ω–∞—è",-1)])],544),[[re,t.selectedChartType]])])]),s("div",{class:N(["chart-wrapper",{loading:t.loading}])},[t.loading?(c(),d("div",tc," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã... ")):t.error?(c(),d("div",sc,m(t.error),1)):t.hasData?(c(),d("div",oc,[s("canvas",nc,null,512)])):(c(),d("div",ac," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "))],2),a.showLegend&&t.legendItems.length>0?(c(),d("div",rc,[(c(!0),d(j,null,z(t.legendItems,o=>(c(),d("div",{class:"legend-item",key:o.label},[s("div",{class:"legend-color",style:Ee({backgroundColor:o.color})},null,4),s("span",ic,m(o.label),1),s("span",lc,m(o.value)+" ("+m(o.percentage.toFixed(1))+"%)",1)]))),128))])):M("",!0)])}const dc=J(Kl,[["render",cc],["__scopeId","data-v-9185ae08"]]),uc={name:"UserRanking",props:{data:{type:Array,default:()=>[]},limit:{type:Number,default:10},title:{type:String,default:"–¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},showPagination:{type:Boolean,default:!1},itemsPerPage:{type:Number,default:10}},emits:["user-select"],setup(n,{emit:e}){const a=p("count"),t=p(!0),r=p(!1),i=p(null),o=p(1),l=T(()=>{try{if(!Array.isArray(n.data)||n.data.length===0)return[];const v=n.data.filter(F=>!(!F||typeof F!="object"||F===null||!F.user_id||!F.timestamp||typeof F.type!="string"||!F.type.trim()));if(v.length===0)return[];let w=ue.prepareUserRankingData(v,n.limit*3);return w.sort((F,U)=>{switch(a.value){case"sessions":return(U.sessions||0)-(F.sessions||0);case"recent":return new Date(U.lastActivityFormatted)-new Date(F.lastActivityFormatted);case"count":default:return U.count-F.count}}),w.slice(0,n.limit)}catch(v){return console.error("[UserRanking] Error preparing ranking data:",v),i.value="–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–π—Ç–∏–Ω–≥–∞",[]}}),u=T(()=>Math.ceil(l.value.length/n.itemsPerPage)),h=T(()=>{if(!n.showPagination)return l.value;const v=(o.value-1)*n.itemsPerPage,w=v+n.itemsPerPage;return l.value.slice(v,w)}),y=v=>{v>=1&&v<=u.value&&(o.value=v)},g=()=>{t.value=!t.value},k=()=>{o.value=1},A=v=>{e("user-select",v)},E=v=>v===1?"rank-gold":v===2?"rank-silver":v===3?"rank-bronze":"rank-normal",S=v=>{const w=["#2196F3","#4CAF50","#FF9800","#F44336","#9C27B0","#00BCD4","#8BC34A","#FFC107","#795548","#607D8B"],F=Math.abs(v)%w.length;return w[F]},I=v=>{if(!v)return"?";const w=v.split(" ");return w.length>=2?(w[0][0]+w[1][0]).toUpperCase():v.substring(0,2).toUpperCase()},f=v=>{if(!v||v==="–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{const w=new Date(v),U=new Date-w,C=Math.floor(U/(1e3*60*60*24));return C===0?"–°–µ–≥–æ–¥–Ω—è":C===1?"–í—á–µ—Ä–∞":C<7?`${C} –¥–Ω–µ–π –Ω–∞–∑–∞–¥`:w.toLocaleDateString("ru-RU")}catch{return v}};return ee(()=>n.data,()=>{o.value=1},{deep:!0}),{sortBy:a,showAsList:t,loading:r,error:i,currentPage:o,users:l,displayedUsers:h,totalPages:u,goToPage:y,toggleView:g,updateRanking:k,viewUserProfile:A,getRankClass:E,getAvatarColor:S,getUserInitials:I,formatLastActivity:f}}},mc={class:"user-ranking-container"},gc={class:"ranking-header"},hc={class:"ranking-title"},fc={class:"ranking-controls"},vc={key:0,class:"ranking-loading"},pc={key:1,class:"ranking-error"},yc={key:2,class:"ranking-empty"},_c={key:3,class:"ranking-list"},bc={class:"user-info"},wc={class:"user-name"},Cc={class:"user-stats"},kc={class:"stat-item"},Sc={class:"stat-item"},Dc={class:"user-actions"},Ac=["onClick"],Tc={key:4,class:"ranking-cards"},Ec={class:"card-header"},Mc={class:"card-content"},xc={class:"user-name-large"},Ic={class:"user-stats-large"},Lc={class:"stat-large"},Pc={class:"stat-value"},Fc={class:"stat-large"},Uc={class:"stat-value"},Rc={class:"last-activity"},Oc={class:"card-actions"},Nc=["onClick"],Bc={key:0,class:"ranking-pagination"},Vc=["disabled"],jc={class:"page-info"},zc=["disabled"];function $c(n,e,a,t,r,i){return c(),d("div",mc,[s("div",gc,[s("h3",hc,m(a.title),1),s("div",fc,[$(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.sortBy=o),onChange:e[1]||(e[1]=(...o)=>t.updateRanking&&t.updateRanking(...o)),class:"sort-select"},[...e[5]||(e[5]=[s("option",{value:"count"},"–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–µ–π—Å—Ç–≤–∏–π",-1),s("option",{value:"sessions"},"–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–µ—Å—Å–∏–π",-1),s("option",{value:"recent"},"–ü–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)])],544),[[re,t.sortBy]]),s("button",{onClick:e[2]||(e[2]=(...o)=>t.toggleView&&t.toggleView(...o)),class:"view-toggle-btn"},m(t.showAsList?"–ö–∞—Ä—Ç–æ—á–∫–∏":"–°–ø–∏—Å–æ–∫"),1)])]),s("div",{class:N(["ranking-content",{loading:t.loading}])},[t.loading?(c(),d("div",vc," –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞... ")):t.error?(c(),d("div",pc,m(t.error),1)):t.users.length===0?(c(),d("div",yc," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö ")):t.showAsList?(c(),d("div",_c,[(c(!0),d(j,null,z(t.displayedUsers,o=>(c(),d("div",{class:"ranking-item",key:o.id},[s("div",{class:N(["rank-badge",t.getRankClass(o.rank)])},m(o.rank),3),s("div",{class:"user-avatar",style:Ee({backgroundColor:t.getAvatarColor(o.id)})},m(t.getUserInitials(o.name)),5),s("div",bc,[s("div",wc,m(o.name),1),s("div",Cc,[s("span",kc,[e[6]||(e[6]=s("i",{class:"stat-icon"},"üìä",-1)),Q(" "+m(o.count)+" –¥–µ–π—Å—Ç–≤–∏–π ",1)]),s("span",Sc,[e[7]||(e[7]=s("i",{class:"stat-icon"},"‚è∞",-1)),Q(" "+m(t.formatLastActivity(o.lastActivityFormatted)),1)])])]),s("div",Dc,[s("button",{onClick:l=>t.viewUserProfile(o),class:"profile-btn",title:"–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"}," üë§ ",8,Ac)])]))),128))])):(c(),d("div",Tc,[(c(!0),d(j,null,z(t.displayedUsers,o=>(c(),d("div",{class:"ranking-card",key:o.id},[s("div",Ec,[s("div",{class:N(["rank-badge-large",t.getRankClass(o.rank)])}," #"+m(o.rank),3),s("div",{class:"user-avatar-large",style:Ee({backgroundColor:t.getAvatarColor(o.id)})},m(t.getUserInitials(o.name)),5)]),s("div",Mc,[s("h4",xc,m(o.name),1),s("div",Ic,[s("div",Lc,[s("div",Pc,m(o.count),1),e[8]||(e[8]=s("div",{class:"stat-label"},"–¥–µ–π—Å—Ç–≤–∏–π",-1))]),s("div",Fc,[s("div",Uc,m(o.sessions||0),1),e[9]||(e[9]=s("div",{class:"stat-label"},"—Å–µ—Å—Å–∏–π",-1))])]),s("div",Rc," –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: "+m(t.formatLastActivity(o.lastActivityFormatted)),1)]),s("div",Oc,[s("button",{onClick:l=>t.viewUserProfile(o),class:"profile-btn-large"}," –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ",8,Nc)])]))),128))]))],2),a.showPagination&&t.totalPages>1?(c(),d("div",Bc,[s("button",{onClick:e[3]||(e[3]=o=>t.goToPage(t.currentPage-1)),disabled:t.currentPage===1,class:"page-btn"}," ‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,Vc),s("span",jc," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+m(t.currentPage)+" –∏–∑ "+m(t.totalPages),1),s("button",{onClick:e[4]||(e[4]=o=>t.goToPage(t.currentPage+1)),disabled:t.currentPage===t.totalPages,class:"page-btn"}," –°–ª–µ–¥—É—é—â–∞—è ‚Ä∫ ",8,zc)])):M("",!0)])}const Wc=J(uc,[["render",$c],["__scopeId","data-v-66e695d4"]]),Hc={name:"ActivityDataTable",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},filters:{type:Object,default:()=>({})},pageSize:{type:Number,default:25},maxPagesShown:{type:Number,default:7}},emits:["sort-change","row-click","export","filter-change"],setup(n,{emit:e}){const a=p(""),t=p(""),r=p("table"),i=p("timestamp"),o=p("desc"),l=p(1),u=[{key:"timestamp",label:"–í—Ä–µ–º—è",sortable:!0,width:"150px",component:"span"},{key:"user_name",label:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",sortable:!0,width:"200px",component:"span"},{key:"type",label:"–î–µ–π—Å—Ç–≤–∏–µ",sortable:!0,width:"120px",component:"span"},{key:"route_title",label:"–°—Ç—Ä–∞–Ω–∏—Ü–∞",sortable:!0,width:"250px",component:"span"},{key:"device",label:"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ",sortable:!1,width:"100px",component:"span"}],h=T(()=>u),y=Rt(P=>{a.value=P},300),g=T(()=>{try{if(!Array.isArray(n.data))return[];let P=[...n.data];if(P=P.filter(Y=>Y&&typeof Y=="object"&&Y!==null&&Y.user_id&&Y.timestamp&&typeof Y.type=="string"),a.value.trim()){const Y=a.value.toLowerCase();P=P.filter(te=>te?(te.user_name||"").toLowerCase().includes(Y)||(te.route_title||"").toLowerCase().includes(Y)||(te.route_path||"").toLowerCase().includes(Y)||(te.type||"").toLowerCase().includes(Y):!1)}return P.sort((Y,te)=>{if(!Y||!te)return 0;let ie=Y[i.value],Z=te[i.value];return i.value==="timestamp"&&(ie=new Date(ie).getTime(),Z=new Date(Z).getTime()),typeof ie=="string"&&(ie=ie.toLowerCase()),typeof Z=="string"&&(Z=Z.toLowerCase()),ie<Z?o.value==="asc"?-1:1:ie>Z?o.value==="asc"?1:-1:0}),P}catch(P){return console.warn("[ActivityDataTable] Error filtering data:",P),[]}}),k=T(()=>g.value.length),A=T(()=>Math.ceil(k.value/n.pageSize)),E=T(()=>{try{if(!Array.isArray(g.value))return[];const P=(l.value-1)*n.pageSize,Y=P+n.pageSize;return g.value.slice(P,Y)}catch(P){return console.warn("[ActivityDataTable] Error paginating data:",P),[]}}),S=T(()=>E.value),I=T(()=>{const P=A.value,Y=l.value,te=n.maxPagesShown;if(P<=te)return Array.from({length:P},(B,se)=>se+1);const ie=Math.floor(te/2);let Z=Math.max(1,Y-ie),le=Math.min(P,Z+te-1);return le-Z+1<te&&(Z=Math.max(1,le-te+1)),Array.from({length:le-Z+1},(B,se)=>Z+se)}),f=T(()=>Object.values(n.filters).some(P=>P!=null&&P!=="")||a.value.trim()),v=T(()=>{const P=[];return n.filters.dateFrom&&P.push({key:"dateFrom",label:"–î–∞—Ç–∞ –æ—Ç",value:n.filters.dateFrom}),n.filters.dateTo&&P.push({key:"dateTo",label:"–î–∞—Ç–∞ –¥–æ",value:n.filters.dateTo}),n.filters.userId&&P.push({key:"userId",label:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",value:`ID ${n.filters.userId}`}),n.filters.type&&P.push({key:"type",label:"–¢–∏–ø",value:n.filters.type}),a.value.trim()&&P.push({key:"search",label:"–ü–æ–∏—Å–∫",value:a.value}),P}),w=P=>{i.value===P?o.value=o.value==="asc"?"desc":"asc":(i.value=P,o.value="asc"),e("sort-change",{sortBy:i.value,sortOrder:o.value})},F=P=>{e("row-click",P)},U=()=>{e("export",{data:g.value,filters:n.filters,searchQuery:a.value})},C=P=>{y(P.target.value)},_=P=>{P==="search"?(a.value="",t.value=""):e("filter-change",{...n.filters,[P]:null})},b=P=>{P>=1&&P<=A.value&&(l.value=P)},L=P=>P?`${P.timestamp||"no-timestamp"}-${P.user_id||"no-user"}-${P.type||"no-type"}-${P.route_path||""}`:"undefined-entry",V=P=>P?{"row-app-entry":P.type==="app_entry","row-page-visit":P.type==="page_visit"}:{},O=(P,Y)=>{switch(P.key){case"timestamp":return R(Y.timestamp);case"user_name":return Y.user_name||`User #${Y.user_id}`;case"type":return ge(Y);case"route_title":return Y.route_title||Y.route_path||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞";case"device":return X(Y.user_agent).device;default:return Y[P.key]||""}},D=(P,Y)=>({}),H=P=>P?ue.getActionIcon(P):"‚ùì",ge=P=>{if(!P)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ";switch(P.type){case"app_entry":return"–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è";case"page_visit":return"–ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º";default:return P.type||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ"}},R=P=>ue.formatTimestamp(P),X=P=>ue.parseUserAgent(P);return ee(()=>n.data,()=>{l.value=1}),ee(a,()=>{l.value=1}),{searchQuery:a,searchInput:t,viewMode:r,sortBy:i,sortOrder:o,currentPage:l,visibleColumns:h,filteredData:g,totalCount:k,totalPages:A,paginatedData:E,displayedData:S,visiblePages:I,filtersApplied:f,activeFilters:v,handleSort:w,handleRowClick:F,handleExport:U,handleSearchInput:C,removeFilter:_,goToPage:b,getEntryKey:L,getRowClass:V,getCellValue:O,getCellProps:D,getActionIcon:H,getActionDescription:ge,formatTimestamp:R,parseUserAgent:X}}},qc={class:"activity-data-table"},Jc={class:"table-header"},Xc={class:"table-info"},Yc={class:"table-subtitle"},Kc={key:0,class:"filters-indicator"},Gc={class:"table-actions"},Qc={class:"view-options"},Zc={class:"table-filters"},ed={class:"search-container"},td={class:"filter-badges"},sd=["onClick"],ad={key:0,class:"table-loading"},od={key:1,class:"table-empty"},nd={key:2,class:"data-table"},rd=["onClick"],id={class:"column-header"},ld={key:0,class:"sort-icon"},cd={key:0},dd={key:1},ud={key:2},md=["onClick"],gd={key:1,class:"cards-container"},hd=["onClick"],fd={class:"card-header"},vd={class:"card-icon"},pd={class:"card-timestamp"},yd={class:"card-content"},_d={class:"card-user"},bd={class:"card-action"},wd={key:0,class:"card-page"},Cd={key:1,class:"card-device"},kd={key:2,class:"table-pagination"},Sd={class:"pagination-info"},Dd={class:"pagination-controls"},Ad=["disabled"],Td=["disabled"],Ed={class:"page-numbers"},Md=["onClick"],xd=["disabled"],Id=["disabled"];function Ld(n,e,a,t,r,i){return c(),d("div",qc,[s("div",Jc,[s("div",Xc,[e[9]||(e[9]=s("h3",{class:"table-title"},"–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1)),s("p",Yc,[Q(" –ü–æ–∫–∞–∑–∞–Ω–æ "+m(t.displayedData.length)+" –∏–∑ "+m(t.totalCount)+" –∑–∞–ø–∏—Å–µ–π ",1),t.filtersApplied?(c(),d("span",Kc,"‚Ä¢ –§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")):M("",!0)])]),s("div",Gc,[s("div",Qc,[s("button",{onClick:e[0]||(e[0]=o=>t.viewMode="table"),class:N([{active:t.viewMode==="table"},"view-btn"])}," üìã –¢–∞–±–ª–∏—Ü–∞ ",2),s("button",{onClick:e[1]||(e[1]=o=>t.viewMode="cards"),class:N([{active:t.viewMode==="cards"},"view-btn"])}," üÉè –ö–∞—Ä—Ç–æ—á–∫–∏ ",2)]),s("button",{onClick:e[2]||(e[2]=(...o)=>t.handleExport&&t.handleExport(...o)),class:"export-btn"}," üì• –≠–∫—Å–ø–æ—Ä—Ç ")])]),s("div",Zc,[s("div",ed,[$(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.searchInput=o),onInput:e[4]||(e[4]=(...o)=>t.handleSearchInput&&t.handleSearchInput(...o)),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏—é...",class:"search-input"},null,544),[[be,t.searchInput]]),e[10]||(e[10]=s("span",{class:"search-icon"},"üîç",-1))]),s("div",td,[(c(!0),d(j,null,z(t.activeFilters,o=>(c(),d("span",{key:o.key,class:"filter-badge"},[Q(m(o.label)+": "+m(o.value)+" ",1),s("button",{onClick:l=>t.removeFilter(o.key),class:"remove-filter"},"√ó",8,sd)]))),128))])]),t.viewMode==="table"?(c(),d("div",{key:0,class:N(["table-container",{loading:a.loading}])},[a.loading?(c(),d("div",ad," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):t.displayedData.length===0?(c(),d("div",od," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ")):(c(),d("table",nd,[s("thead",null,[s("tr",null,[(c(!0),d(j,null,z(t.visibleColumns,o=>(c(),d("th",{key:o.key,class:N({sortable:o.sortable}),onClick:l=>o.sortable&&t.handleSort(o.key)},[s("div",id,[s("span",null,m(o.label),1),o.sortable?(c(),d("span",ld,[t.sortBy===o.key&&t.sortOrder==="asc"?(c(),d("span",cd,"‚Üë")):t.sortBy===o.key&&t.sortOrder==="desc"?(c(),d("span",dd,"‚Üì")):(c(),d("span",ud,"‚Üï"))])):M("",!0)])],10,rd))),128))])]),s("tbody",null,[(c(!0),d(j,null,z(t.paginatedData,o=>(c(),d("tr",{key:t.getEntryKey(o),class:N(t.getRowClass(o)),onClick:l=>t.handleRowClick(o)},[(c(!0),d(j,null,z(t.visibleColumns,l=>(c(),d("td",{key:l.key},[s("div",{class:N(["cell-content",`cell-${l.key}`])},[(c(),ne(Zt(l.component||"span"),Qt({ref_for:!0},t.getCellProps(l,o)),{default:_e(()=>[Q(m(t.getCellValue(l,o)),1)]),_:2},1040))],2)]))),128))],10,md))),128))])]))],2)):t.viewMode==="cards"?(c(),d("div",gd,[n.entry&&typeof n.entry=="object"&&n.entry.user_id&&n.entry.timestamp&&typeof n.entry.type=="string"?(c(!0),d(j,{key:0},z(t.paginatedData,o=>(c(),d("div",{key:t.getEntryKey(o),class:N(["activity-card",t.getRowClass(o)]),onClick:l=>t.handleRowClick(o)},[s("div",fd,[s("div",vd,m(t.getActionIcon(o.type)),1),s("div",pd,m(t.formatTimestamp(o.timestamp)),1)]),s("div",yd,[s("div",_d,[s("strong",null,m(o.user_name||`User #${o.user_id}`),1)]),s("div",bd,m(t.getActionDescription(o)),1),o.route_path?(c(),d("div",wd," –°—Ç—Ä–∞–Ω–∏—Ü–∞: "+m(o.route_title||o.route_path),1)):M("",!0),o.user_agent?(c(),d("div",Cd," –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: "+m(t.parseUserAgent(o.user_agent).device),1)):M("",!0)])],10,hd))),128)):M("",!0)])):M("",!0),t.totalPages>1?(c(),d("div",kd,[s("div",Sd," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+m(t.currentPage)+" –∏–∑ "+m(t.totalPages)+" ("+m(t.totalCount)+" –∑–∞–ø–∏—Å–µ–π) ",1),s("div",Dd,[s("button",{onClick:e[5]||(e[5]=o=>t.goToPage(1)),disabled:t.currentPage===1,class:"page-btn"}," ¬´¬´ –ü–µ—Ä–≤–∞—è ",8,Ad),s("button",{onClick:e[6]||(e[6]=o=>t.goToPage(t.currentPage-1)),disabled:t.currentPage===1,class:"page-btn"}," ‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,Td),s("div",Ed,[(c(!0),d(j,null,z(t.visiblePages,o=>(c(),d("button",{key:o,onClick:l=>t.goToPage(o),class:N([{active:o===t.currentPage},"page-number"])},m(o),11,Md))),128))]),s("button",{onClick:e[7]||(e[7]=o=>t.goToPage(t.currentPage+1)),disabled:t.currentPage===t.totalPages,class:"page-btn"}," –°–ª–µ–¥—É—é—â–∞—è ‚Ä∫ ",8,xd),s("button",{onClick:e[8]||(e[8]=o=>t.goToPage(t.totalPages)),disabled:t.currentPage===t.totalPages,class:"page-btn"}," –ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª¬ª ",8,Id)])])):M("",!0)])}const $t=J(Hc,[["render",Ld],["__scopeId","data-v-79b44005"]]),Pd={name:"ActivityDashboard",components:{MetricCard:Ti,AdvancedFilters:Ll,TimeChart:zt,DistributionChart:dc,UserRanking:Wc,ActivityDataTable:$t},props:{initialFilters:{type:Object,default:()=>({dateFrom:null,dateTo:null,userId:null,type:null})},refreshInterval:{type:Number,default:3e5}},emits:["user-profile-request","filters-changed"],setup(n,{emit:e}){const a=p([]),t=p([]),r=()=>[{id:"total_entries",title:"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",value:0,previousValue:0,change:0,changePercent:0,trend:"neutral",icon:"üìä",color:"#2196F3",drillDownRoute:"activity-details"},{id:"unique_users",title:"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",value:0,previousValue:0,change:0,changePercent:0,trend:"neutral",icon:"üë•",color:"#4CAF50",drillDownRoute:"user-list"},{id:"total_sessions",title:"–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π",value:0,previousValue:0,change:0,changePercent:0,trend:"neutral",icon:"üéØ",color:"#FF9800",drillDownRoute:"session-analysis"},{id:"avg_session_duration",title:"–°—Ä. –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏",value:"0—Å",previousValue:"0—Å",change:0,changePercent:0,trend:"neutral",icon:"‚è±Ô∏è",color:"#9C27B0",drillDownRoute:"session-details"}],i=p(r()),o=p(!1),l=p(null),u=p({...n.initialFilters}),h=p("day"),y=p("activity_types"),g=p(!1),k=p(""),A=p(null);let E=null;const S=T(()=>{const R=u.value.dateFrom||"–Ω–∞—á–∞–ª–∞",X=u.value.dateTo||"—Å–µ–π—á–∞—Å";return`${R} –ø–æ ${X}`});T(()=>{try{return(Array.isArray(a.value)?a.value:[]).filter(X=>{if(!X||typeof X!="object"||X===null||!X.user_id||typeof X.user_id!="number"||!X.timestamp||typeof X.type!="string"||!X.type.trim())return!1;try{const P=new Date(X.timestamp);if(isNaN(P.getTime()))return!1}catch{return!1}return!0})}catch(R){return console.error("[ActivityDashboard] Error in safeActivityData:",R),[]}});const I=async()=>{o.value=!0,l.value=null;try{a.value=await Fe.getActivity({...u.value,limit:1e4}),t.value=a.value;const R=Ne.calculateDashboardMetrics(t.value),X=f(R);i.value=X}catch(R){l.value=R.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞",console.error("[ActivityDashboard] Error loading dashboard data:",R),i.value=r()}finally{o.value=!1}},f=R=>{if(!R||typeof R!="object")return console.warn("[ActivityDashboard] Invalid metrics format, using defaults"),r();try{return[{id:"total_entries",title:"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",value:R.total_entries?.value||0,previousValue:R.total_entries?.previousValue||0,change:R.total_entries?.change||0,changePercent:R.total_entries?.changePercent||0,trend:R.total_entries?.trend||"neutral",icon:"üìä",color:"#2196F3",drillDownRoute:"activity-details"},{id:"unique_users",title:"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",value:R.unique_users?.value||0,previousValue:R.unique_users?.previousValue||0,change:R.unique_users?.change||0,changePercent:R.unique_users?.changePercent||0,trend:R.unique_users?.trend||"neutral",icon:"üë•",color:"#4CAF50",drillDownRoute:"user-list"},{id:"total_sessions",title:"–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π",value:R.total_sessions?.value||0,previousValue:R.total_sessions?.previousValue||0,change:R.total_sessions?.change||0,changePercent:R.total_sessions?.changePercent||0,trend:R.total_sessions?.trend||"neutral",icon:"üéØ",color:"#FF9800",drillDownRoute:"session-analysis"},{id:"avg_session_duration",title:"–°—Ä. –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏",value:v(R.total_sessions?.value||0),previousValue:v(R.total_sessions?.previousValue||0),change:0,changePercent:0,trend:"neutral",icon:"‚è±Ô∏è",color:"#9C27B0",drillDownRoute:"session-details"}]}catch(X){return console.error("[ActivityDashboard] Error formatting metrics:",X),r()}},v=R=>{if(!R)return"0—Å";const X=Math.floor(R/60),P=R%60;return X>0?`${X}–º ${P}—Å`:`${P}—Å`},w=R=>{u.value={...R},e("filters-changed",u.value),I()},F=R=>{g.value=!0,k.value=`–î–µ—Ç–∞–ª–∏: ${R.title}`,A.value={metric:R,filters:u.value,timestamp:new Date().toISOString()}},U=R=>{console.log("Time range changed:",R)},C=R=>{g.value=!0,k.value=`–î–µ—Ç–∞–ª–∏ —Å–µ–≥–º–µ–Ω—Ç–∞: ${R.label}`,A.value=R},_=R=>{e("user-profile-request",R)},b=R=>{console.log("Sort changed:",R)},L=R=>{console.log("Table export:",R)},V=()=>{g.value=!1,k.value="",A.value=null},O=()=>{I()},D=()=>{const R={filters:u.value,metrics:i.value,activityCount:t.value.length,timestamp:new Date().toISOString()},X=JSON.stringify(R,null,2),P=new Blob([X],{type:"application/json"}),Y=URL.createObjectURL(P),te=document.createElement("a");te.href=Y,te.download=`activity-dashboard-${new Date().toISOString().split("T")[0]}.json`,te.click()},H=()=>{E&&clearInterval(E),n.refreshInterval>0&&(E=setInterval(()=>{o.value||I()},n.refreshInterval))};return de(()=>{I(),H()}),ee(()=>n.initialFilters,R=>{u.value={...R},I()},{deep:!0}),{activityData:a,filteredActivityData:t,dashboardMetrics:i,loading:o,error:l,filters:u,timeGroupBy:h,distributionType:y,showDetailsModal:g,detailsModalTitle:k,detailsModalData:A,formatDateRange:S,handleFiltersChange:w,handleMetricDrillDown:F,handleTimeRangeChange:U,handleSegmentClick:C,handleUserSelect:_,handleSortChange:b,handleTableExport:L,closeDetailsModal:V,refresh:O,exportData:D,cleanup:()=>{E&&clearInterval(E)}}},beforeUnmount(){this.cleanup()}},Fd={class:"activity-dashboard"},Ud={class:"dashboard-header"},Rd={class:"header-content"},Od={class:"dashboard-subtitle"},Nd={class:"header-actions"},Bd=["disabled"],Vd={key:0},jd={key:1},zd={class:"metrics-section"},$d={class:"metrics-grid"},Wd={class:"filters-section"},Hd={class:"charts-section"},qd={class:"chart-row"},Jd={class:"chart-container time-chart"},Xd={class:"chart-row"},Yd={class:"chart-container distribution-chart"},Kd={class:"chart-container user-ranking"},Gd={class:"data-table-section"},Qd={class:"modal-header"},Zd={class:"modal-content"};function eu(n,e,a,t,r,i){const o=W("MetricCard"),l=W("AdvancedFilters"),u=W("TimeChart"),h=W("DistributionChart"),y=W("UserRanking"),g=W("ActivityDataTable");return c(),d("div",Fd,[s("div",Ud,[s("div",Rd,[e[6]||(e[6]=s("h1",{class:"dashboard-title"},"üìä –î–∞—à–±–æ—Ä–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),s("p",Od," –ê–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å "+m(t.formatDateRange),1)]),s("div",Nd,[s("button",{onClick:e[0]||(e[0]=(...k)=>t.refresh&&t.refresh(...k)),disabled:t.loading,class:"refresh-btn"},[t.loading?(c(),d("span",Vd,"‚è≥")):(c(),d("span",jd,"üîÑ")),Q(" "+m(t.loading?"–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...":"–û–±–Ω–æ–≤–∏—Ç—å"),1)],8,Bd),s("button",{onClick:e[1]||(e[1]=(...k)=>t.exportData&&t.exportData(...k)),class:"export-btn"}," üì• –≠–∫—Å–ø–æ—Ä—Ç ")])]),s("div",zd,[s("div",$d,[(c(!0),d(j,null,z(t.dashboardMetrics,k=>(c(),ne(o,{key:k.id,metric:k,onDrillDown:t.handleMetricDrillDown},null,8,["metric","onDrillDown"]))),128))])]),s("div",Wd,[K(l,{modelValue:t.filters,"onUpdate:modelValue":e[2]||(e[2]=k=>t.filters=k),onChange:t.handleFiltersChange},null,8,["modelValue","onChange"])]),s("div",Hd,[s("div",qd,[s("div",Jd,[K(u,{data:n.safeActivityData,"group-by":t.timeGroupBy,filters:t.filters,title:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏",onTimeRangeChange:t.handleTimeRangeChange},null,8,["data","group-by","filters","onTimeRangeChange"])])]),s("div",Xd,[s("div",Yd,[K(h,{data:n.safeActivityData,type:t.distributionType,title:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",onSegmentClick:t.handleSegmentClick},null,8,["data","type","onSegmentClick"])]),s("div",Kd,[K(y,{data:n.safeActivityData,limit:10,title:"–¢–æ–ø –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",onUserSelect:t.handleUserSelect},null,8,["data","onUserSelect"])])])]),s("div",Gd,[K(g,{data:n.safeActivityData,loading:t.loading,filters:t.filters,onSortChange:t.handleSortChange,onExport:t.handleTableExport},null,8,["data","loading","filters","onSortChange","onExport"])]),t.showDetailsModal?(c(),d("div",{key:0,class:"details-modal-overlay",onClick:e[5]||(e[5]=(...k)=>t.closeDetailsModal&&t.closeDetailsModal(...k))},[s("div",{class:"details-modal",onClick:e[4]||(e[4]=pe(()=>{},["stop"]))},[s("div",Qd,[s("h3",null,m(t.detailsModalTitle),1),s("button",{onClick:e[3]||(e[3]=(...k)=>t.closeDetailsModal&&t.closeDetailsModal(...k)),class:"close-btn"},"‚úï")]),s("div",Zd,[s("pre",null,m(JSON.stringify(t.detailsModalData,null,2)),1)])])])):M("",!0)])}const tu=J(Pd,[["render",eu],["__scopeId","data-v-2711895c"]]),su={name:"UserProfileAnalysis",components:{TimeChart:zt,ActivityDataTable:$t},props:{userId:{type:Number,required:!0},filters:{type:Object,default:()=>({})}},emits:["back","export"],setup(n,{emit:e}){const a=p(null),t=p([]),r=p(!1),i=p(null),o=p("day"),l=p("timeline"),u=p("week"),h=p(null),y=T(()=>a.value?.sessions?[...a.value.sessions].sort((D,H)=>new Date(H.startTime)-new Date(D.startTime)):[]),g=T(()=>a.value?.sessions?.length?a.value.sessions.reduce((H,ge)=>H+ge.duration,0)/a.value.sessions.length:0),k=async()=>{r.value=!0,i.value=null;try{const D=await Fe.getUserProfileAnalytics(n.userId,n.filters);a.value=D,t.value=D.activity,await A()}catch(D){i.value=D.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",console.error("[UserProfileAnalysis] Error loading user profile:",D),a.value={user:{name:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",id:n.userId},analytics:{total_actions:0,total_sessions:0,avg_session_duration:0,favorite_page:null,peak_hour:0,device_preference:"unknown",first_visit:null,last_visit:null},sessions:[]},t.value=[]}finally{r.value=!1}},A=async()=>{try{const D=new Date;let H,ge,R,X;switch(u.value){case"week":H=new Date(D.getTime()-7*24*60*60*1e3),ge=D,R=new Date(D.getTime()-14*24*60*60*1e3),X=new Date(D.getTime()-7*24*60*60*1e3);break;case"month":H=new Date(D.getFullYear(),D.getMonth(),1),ge=D,R=new Date(D.getFullYear(),D.getMonth()-1,1),X=new Date(D.getFullYear(),D.getMonth(),0);break;case"quarter":const B=Math.floor(D.getMonth()/3);H=new Date(D.getFullYear(),B*3,1),ge=D,R=new Date(D.getFullYear(),(B-1)*3,1),X=new Date(D.getFullYear(),B*3,0);break}const P={...n.filters,dateFrom:H.toISOString().split("T")[0],dateTo:ge.toISOString().split("T")[0]},Y={...n.filters,dateFrom:R.toISOString().split("T")[0],dateTo:X.toISOString().split("T")[0]},[te,ie]=await Promise.all([Fe.getUserActivity(n.userId,P),Fe.getUserActivity(n.userId,Y)]),Z=Ne.analyzeUserSessions(te),le=Ne.analyzeUserSessions(ie);h.value={current:{actions:te.length,sessions:Z.length,avgDuration:Z.length>0?Z.reduce((B,se)=>B+se.duration,0)/Z.length:0},previous:{actions:ie.length,sessions:le.length,avgDuration:le.length>0?le.reduce((B,se)=>B+se.duration,0)/le.length:0},change:{actions:te.length-ie.length,sessions:Z.length-le.length,avgDuration:(Z.length>0?Z.reduce((B,se)=>B+se.duration,0)/Z.length:0)-(le.length>0?le.reduce((B,se)=>B+se.duration,0)/le.length:0)},changePercent:{actions:ie.length>0?(te.length-ie.length)/ie.length*100:0,sessions:le.length>0?(Z.length-le.length)/le.length*100:0,avgDuration:0}}}catch(D){console.error("[UserProfileAnalysis] Error loading comparison data:",D)}},E=()=>{const D={userId:n.userId,profile:a.value,activity:t.value,filters:n.filters,timestamp:new Date().toISOString()};e("export",D)},S=D=>{console.log("Time range changed:",D)},I=D=>{console.log("Sort changed:",D)},f=D=>{console.log("Export data:",D)},v=D=>{if(!D)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{return new Date(D).toLocaleDateString("ru-RU")}catch{return D}},w=D=>ue.formatTimestamp(D),F=D=>ue.formatDuration(D),U=D=>({desktop:"–ö–æ–º–ø—å—é—Ç–µ—Ä",mobile:"–ú–æ–±–∏–ª—å–Ω—ã–π",tablet:"–ü–ª–∞–Ω—à–µ—Ç",unknown:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"})[D]||D||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",C=D=>D==null?"–ù–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω":`${D}:00`,_=D=>{const H=D.duration||0;return H<5*60*1e3?"session-short":H<15*60*1e3?"session-medium":"session-long"},b=D=>ue.getSessionColor(D),L=D=>{switch(D){case"app_entry":return"–í—Ö–æ–¥";case"page_visit":return"–ü–µ—Ä–µ—Ö–æ–¥";default:return D}},V=D=>D>0?"positive":D<0?"negative":"neutral",O=D=>D===0?"0%":`${D>0?"+":""}${D.toFixed(1)}%`;return ee(()=>n.userId,()=>{k()}),ee(()=>n.filters,()=>{k()},{deep:!0}),ee(u,()=>{A()}),de(()=>{k()}),{userProfile:a,userActivity:t,loading:r,error:i,chartGroupBy:o,sessionViewMode:l,comparisonPeriod:u,comparisonData:h,sortedSessions:y,avgSessionDuration:g,loadUserProfile:k,exportProfile:E,handleTimeRangeChange:S,handleSortChange:I,handleExport:f,formatDate:v,formatTimestamp:w,formatDuration:F,formatDevice:U,formatHour:C,getSessionClass:_,getSessionColor:b,getActionLabel:L,getChangeClass:V,formatChange:O}}},au={class:"user-profile-analysis"},ou={class:"profile-header"},nu={class:"header-content"},ru={class:"user-info"},iu={class:"user-name"},lu={class:"user-details"},cu={key:0},du={class:"header-actions"},uu={key:0,class:"profile-summary"},mu={class:"summary-cards"},gu={class:"summary-card"},hu={class:"card-content"},fu={class:"card-value"},vu={class:"summary-card"},pu={class:"card-content"},yu={class:"card-value"},_u={class:"summary-card"},bu={class:"card-content"},wu={class:"card-value"},Cu={class:"summary-card"},ku={class:"card-content"},Su={class:"card-value"},Du={key:1,class:"profile-stats"},Au={class:"stats-grid"},Tu={class:"stat-item"},Eu={class:"stat-value"},Mu={class:"stat-item"},xu={class:"stat-value"},Iu={class:"stat-item"},Lu={class:"stat-value"},Pu={class:"stat-item"},Fu={class:"stat-value"},Uu={class:"stat-item"},Ru={class:"stat-value"},Ou={class:"stat-item"},Nu={class:"stat-value"},Bu={class:"activity-chart-section"},Vu={class:"chart-container"},ju={key:1,class:"no-data"},zu={key:2,class:"sessions-section"},$u={class:"sessions-controls"},Wu={class:"session-stats"},Hu={class:"stat"},qu={class:"stat"},Ju={key:0,class:"sessions-timeline"},Xu={class:"timeline-container"},Yu={class:"timeline-content"},Ku={class:"session-header"},Gu={class:"session-time"},Qu={class:"session-duration"},Zu={class:"session-details"},em={class:"session-stats"},tm={key:0,class:"session-actions"},sm={key:1,class:"sessions-list"},am={class:"session-info"},om={class:"session-time-range"},nm={class:"session-meta"},rm={class:"session-device"},im={class:"detailed-activity-section"},lm={class:"comparison-section"},cm={class:"comparison-controls"},dm={key:0,class:"comparison-results"},um={class:"comparison-metrics"},mm={class:"metric-comparison"},gm={class:"metric-values"},hm={class:"current"},fm={class:"previous"},vm={class:"metric-comparison"},pm={class:"metric-values"},ym={class:"current"},_m={class:"previous"},bm={class:"metric-comparison"},wm={class:"metric-values"},Cm={class:"current"},km={class:"previous"},Sm={key:3,class:"loading-overlay"},Dm={key:4,class:"error-message"};function Am(n,e,a,t,r,i){const o=W("TimeChart"),l=W("ActivityDataTable");return c(),d("div",au,[s("div",ou,[s("div",nu,[s("button",{onClick:e[0]||(e[0]=u=>n.$emit("back")),class:"back-btn"},"‚Üê –ù–∞–∑–∞–¥"),s("div",ru,[s("h1",iu,m(t.userProfile?.user?.name||"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"),1),s("p",lu,[Q(" ID: "+m(a.userId)+" ",1),t.userProfile?.user?.email?(c(),d("span",cu,"‚Ä¢ "+m(t.userProfile.user.email),1)):M("",!0)])])]),s("div",du,[s("button",{onClick:e[1]||(e[1]=(...u)=>t.exportProfile&&t.exportProfile(...u)),class:"export-btn"}," üì• –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ—Ñ–∏–ª—è ")])]),t.userProfile&&t.userProfile.analytics?(c(),d("div",uu,[s("div",mu,[s("div",gu,[e[6]||(e[6]=s("div",{class:"card-icon"},"üìÖ",-1)),s("div",hu,[s("div",fu,m(t.userProfile.analytics.first_visit?t.formatDate(t.userProfile.analytics.first_visit):"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e[5]||(e[5]=s("div",{class:"card-label"},"–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥",-1))])]),s("div",vu,[e[8]||(e[8]=s("div",{class:"card-icon"},"‚è∞",-1)),s("div",pu,[s("div",yu,m(t.userProfile.analytics.last_visit?t.formatDate(t.userProfile.analytics.last_visit):"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e[7]||(e[7]=s("div",{class:"card-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥",-1))])]),s("div",_u,[e[10]||(e[10]=s("div",{class:"card-icon"},"üéØ",-1)),s("div",bu,[s("div",wu,m(t.userProfile.analytics.total_sessions||0),1),e[9]||(e[9]=s("div",{class:"card-label"},"–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π",-1))])]),s("div",Cu,[e[12]||(e[12]=s("div",{class:"card-icon"},"üìä",-1)),s("div",ku,[s("div",Su,m(t.userProfile.analytics.total_actions||0),1),e[11]||(e[11]=s("div",{class:"card-label"},"–í—Å–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–π",-1))])])])])):M("",!0),t.userProfile&&t.userProfile.analytics?(c(),d("div",Du,[e[19]||(e[19]=s("h2",{class:"section-title"},"üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),s("div",Au,[s("div",Tu,[e[13]||(e[13]=s("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–∏",-1)),s("div",Eu,m(t.formatDuration(t.userProfile.analytics.avg_session_duration||0)),1)]),s("div",Mu,[e[14]||(e[14]=s("div",{class:"stat-label"},"–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ",-1)),s("div",xu,m(t.formatDevice(t.userProfile.analytics.device_preference||"unknown")),1)]),s("div",Iu,[e[15]||(e[15]=s("div",{class:"stat-label"},"–õ—é–±–∏–º–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",-1)),s("div",Lu,m(t.userProfile.analytics.favorite_page||"–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞"),1)]),s("div",Pu,[e[16]||(e[16]=s("div",{class:"stat-label"},"–ü–∏–∫–æ–≤—ã–π —á–∞—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),s("div",Fu,m(t.formatHour(t.userProfile.analytics.peak_hour||0)),1)]),s("div",Uu,[e[17]||(e[17]=s("div",{class:"stat-label"},"–û–±—â–µ–µ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",-1)),s("div",Ru,m(t.formatDuration(t.userProfile.analytics.total_duration||0)),1)]),s("div",Ou,[e[18]||(e[18]=s("div",{class:"stat-label"},"Retention (–¥–Ω–∏)",-1)),s("div",Nu,m(t.userProfile.analytics.retention_days||0)+" –¥–Ω–µ–π",1)])])])):M("",!0),s("div",Bu,[e[20]||(e[20]=s("h2",{class:"section-title"},"üìà –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),s("div",Vu,[t.userActivity.length>0?(c(),ne(o,{key:0,data:t.userActivity,"group-by":t.chartGroupBy,title:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏",onTimeRangeChange:t.handleTimeRangeChange},null,8,["data","group-by","onTimeRangeChange"])):(c(),d("div",ju," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ "))])]),t.userProfile&&t.userProfile.sessions&&t.userProfile.sessions.length>0?(c(),d("div",zu,[e[22]||(e[22]=s("h2",{class:"section-title"},"üé≠ –°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",-1)),s("div",$u,[$(s("select",{"onUpdate:modelValue":e[2]||(e[2]=u=>t.sessionViewMode=u),class:"view-mode-select"},[...e[21]||(e[21]=[s("option",{value:"timeline"},"–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è",-1),s("option",{value:"list"},"–°–ø–∏—Å–æ–∫",-1)])],512),[[re,t.sessionViewMode]]),s("div",Wu,[s("span",Hu,"–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π: "+m(t.userProfile.sessions.length),1),s("span",qu,"–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: "+m(t.formatDuration(t.avgSessionDuration)),1)])]),t.sessionViewMode==="timeline"?(c(),d("div",Ju,[s("div",Xu,[(c(!0),d(j,null,z(t.sortedSessions,u=>(c(),d("div",{key:u.id,class:N(["timeline-item",t.getSessionClass(u)])},[s("div",{class:"timeline-marker",style:Ee({backgroundColor:t.getSessionColor(u)})},null,4),s("div",Yu,[s("div",Ku,[s("div",Gu,m(t.formatTimestamp(u.startTime)),1),s("div",Qu,m(t.formatDuration(u.duration)),1)]),s("div",Zu,[s("div",em,[s("span",null,m(u.entriesCount)+" –¥–µ–π—Å—Ç–≤–∏–π",1),s("span",null,m(u.pageCount)+" —Å—Ç—Ä–∞–Ω–∏—Ü",1),s("span",null,m(u.device||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),u.actions?(c(),d("div",tm,[(c(!0),d(j,null,z(Object.entries(u.actions),([h,y],g)=>(c(),d("span",{key:h,class:"action-badge"},m(t.getActionLabel(h))+": "+m(y),1))),128))])):M("",!0)])])],2))),128))])])):(c(),d("div",sm,[(c(!0),d(j,null,z(t.sortedSessions,u=>(c(),d("div",{class:"session-item",key:u.id},[s("div",am,[s("div",om,m(t.formatTimestamp(u.startTime))+" ‚Äî "+m(t.formatTimestamp(u.endTime)),1),s("div",nm," –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: "+m(t.formatDuration(u.duration))+" | –î–µ–π—Å—Ç–≤–∏–π: "+m(u.entriesCount)+" | –°—Ç—Ä–∞–Ω–∏—Ü: "+m(u.pageCount),1)]),s("div",rm,m(u.device||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]))),128))]))])):M("",!0),s("div",im,[e[23]||(e[23]=s("h2",{class:"section-title"},"üìã –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1)),K(l,{data:t.userActivity,loading:t.loading,onSortChange:t.handleSortChange,onExport:t.handleExport},null,8,["data","loading","onSortChange","onExport"])]),s("div",lm,[e[31]||(e[31]=s("h2",{class:"section-title"},"‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤",-1)),s("div",cm,[$(s("select",{"onUpdate:modelValue":e[3]||(e[3]=u=>t.comparisonPeriod=u),class:"period-select"},[...e[24]||(e[24]=[s("option",{value:"week"},"–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è vs –ø—Ä–µ–¥—ã–¥—É—â–∞—è",-1),s("option",{value:"month"},"–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü vs –ø—Ä–µ–¥—ã–¥—É—â–∏–π",-1),s("option",{value:"quarter"},"–¢–µ–∫—É—â–∏–π –∫–≤–∞—Ä—Ç–∞–ª vs –ø—Ä–µ–¥—ã–¥—É—â–∏–π",-1)])],512),[[re,t.comparisonPeriod]])]),t.comparisonData?(c(),d("div",dm,[s("div",um,[s("div",mm,[e[26]||(e[26]=s("div",{class:"metric-name"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π",-1)),s("div",gm,[s("span",hm,m(t.comparisonData.current?.actions||0),1),e[25]||(e[25]=s("span",{class:"vs"},"vs",-1)),s("span",fm,m(t.comparisonData.previous?.actions||0),1),s("span",{class:N(["change",t.getChangeClass(t.comparisonData.change?.actions||0)])},m(t.formatChange(t.comparisonData.changePercent?.actions||0)),3)])]),s("div",vm,[e[28]||(e[28]=s("div",{class:"metric-name"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π",-1)),s("div",pm,[s("span",ym,m(t.comparisonData.current?.sessions||0),1),e[27]||(e[27]=s("span",{class:"vs"},"vs",-1)),s("span",_m,m(t.comparisonData.previous?.sessions||0),1),s("span",{class:N(["change",t.getChangeClass(t.comparisonData.change?.sessions||0)])},m(t.formatChange(t.comparisonData.changePercent?.sessions||0)),3)])]),s("div",bm,[e[30]||(e[30]=s("div",{class:"metric-name"},"–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏",-1)),s("div",wm,[s("span",Cm,m(t.formatDuration(t.comparisonData.current?.avgDuration||0)),1),e[29]||(e[29]=s("span",{class:"vs"},"vs",-1)),s("span",km,m(t.formatDuration(t.comparisonData.previous?.avgDuration||0)),1),s("span",{class:N(["change",t.getChangeClass(t.comparisonData.change?.avgDuration||0)])},m(t.formatChange(t.comparisonData.changePercent?.avgDuration||0)),3)])])])])):M("",!0)]),t.loading?(c(),d("div",Sm,[...e[32]||(e[32]=[s("div",{class:"loading-content"},[s("div",{class:"loading-spinner"}),s("div",{class:"loading-text"},"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...")],-1)])])):M("",!0),t.error?(c(),d("div",Dm,[Q(m(t.error)+" ",1),s("button",{onClick:e[4]||(e[4]=(...u)=>t.loadUserProfile&&t.loadUserProfile(...u)),class:"retry-btn"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):M("",!0)])}const Tm=J(su,[["render",Am],["__scopeId","data-v-e987c9ec"]]),Em={name:"UserActivityList",components:{UserActivityCard:Tr,HiddenUsersManager:Bt,UserActivityFilters:Vt,UserActivityStats:jt,ActivityDashboard:tu,UserProfileAnalysis:Tm},props:{userId:{type:Number,default:null},dateFrom:{type:String,default:null},dateTo:{type:String,default:null},type:{type:String,default:null}},emits:["view-details"],setup(n,{emit:e}){const a=p("list"),t=p(null),r=p([]),i=p(!1),o=p(null),l=p({userId:n.userId,dateFrom:n.dateFrom,dateTo:n.dateTo,type:n.type}),u=p([]),h=T(()=>{try{if(!Array.isArray(r.value))return[];const w=r.value.filter(F=>F&&typeof F=="object"&&F!==null&&F.user_id&&F.timestamp&&typeof F.type=="string");return Nt(w)}catch(w){return console.warn("[UserActivityList] Error filtering activity:",w),[]}}),y=async()=>{i.value=!0,o.value=null;try{r.value=await Fe.getActivity(l.value);const w=new Map;r.value.forEach(F=>{F.user_id&&!w.has(F.user_id)&&w.set(F.user_id,{ID:F.user_id,NAME:F.user_name||"",LAST_NAME:"",EMAIL:F.user_email||""})}),u.value=Array.from(w.values())}catch(w){o.value=w.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",console.error("[UserActivityList] Error:",w)}finally{i.value=!1}},g=()=>{a.value="dashboard"},k=w=>{t.value=w.id,a.value="profile"},A=()=>{a.value="list"},E=w=>{e("view-details",w)},S=w=>{l.value={...w},y()},I=w=>{console.log("Export profile:",w)},f=w=>w?`${w.timestamp||"no-timestamp"}-${w.user_id||"no-user"}-${w.type||"no-type"}-${w.route_path||""}`:"undefined-entry",v=()=>{y()};return de(()=>{y(),window.addEventListener("hidden-users-changed",v)}),He(()=>{window.removeEventListener("hidden-users-changed",v)}),ee(()=>[n.userId,n.dateFrom,n.dateTo,n.type],()=>{l.value={userId:n.userId,dateFrom:n.dateFrom,dateTo:n.dateTo,type:n.type},y()},{deep:!0}),{viewMode:a,selectedUserId:t,activity:h,loading:i,error:o,filters:l,availableUsers:u,switchToDashboard:g,switchToUserProfile:k,switchToList:A,handleViewDetails:E,handleFiltersUpdate:S,handleProfileExport:I,getEntryKey:f}}},Mm={class:"user-activity-container"},xm={key:0,class:"user-activity-list"},Im={class:"list-header"},Lm={class:"header-actions"},Pm={class:"filters-section"},Fm={key:0,class:"loading"},Um={key:1,class:"error"},Rm={key:2,class:"empty"},Om={key:3,class:"activity-items"},Nm={key:1,class:"analysis-dashboard"},Bm={key:1,class:"loading-state"},Vm={key:2,class:"user-profile"},jm={key:1,class:"loading-state"};function zm(n,e,a,t,r,i){const o=W("HiddenUsersManager"),l=W("UserActivityFilters"),u=W("UserActivityStats"),h=W("UserActivityCard"),y=W("ActivityDashboard"),g=W("UserProfileAnalysis");return c(),d("div",Mm,[t.viewMode==="list"?(c(),d("div",xm,[s("div",Im,[e[1]||(e[1]=s("div",{class:"header-info"},[s("h2",{class:"list-title"},"üìã –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),s("p",{class:"list-subtitle"}," –ê–Ω–∞–ª–∏–∑ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ ")],-1)),s("div",Lm,[s("button",{onClick:e[0]||(e[0]=(...k)=>t.switchToDashboard&&t.switchToDashboard(...k)),class:"dashboard-btn"}," üìä –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏–∑–∞ ")])]),s("div",Pm,[K(o,{filters:t.filters},null,8,["filters"]),K(l,{filters:t.filters,users:t.availableUsers,onUpdateFilters:t.handleFiltersUpdate},null,8,["filters","users","onUpdateFilters"])]),K(u,{filters:t.filters},null,8,["filters"]),t.loading?(c(),d("div",Fm," –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏... ")):t.error?(c(),d("div",Um,m(t.error),1)):t.activity.length===0?(c(),d("div",Rm," –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ")):(c(),d("div",Om,[n.entry&&typeof n.entry=="object"&&n.entry.user_id&&n.entry.timestamp&&typeof n.entry.type=="string"?(c(!0),d(j,{key:0},z(t.activity,k=>(c(),ne(h,{key:t.getEntryKey(k),entry:k,onClick:A=>t.handleViewDetails(k)},null,8,["entry","onClick"]))),128)):M("",!0)]))])):t.viewMode==="dashboard"?(c(),d("div",Nm,[t.loading?(c(),d("div",Bm," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞ –∞–Ω–∞–ª–∏–∑–∞... ")):(c(),ne(y,{key:0,"initial-filters":t.filters,onUserProfileRequest:t.switchToUserProfile},null,8,["initial-filters","onUserProfileRequest"]))])):t.viewMode==="profile"?(c(),d("div",Vm,[t.selectedUserId&&!t.loading?(c(),ne(g,{key:0,"user-id":t.selectedUserId,filters:t.filters,onBack:t.switchToDashboard,onExport:t.handleProfileExport},null,8,["user-id","filters","onBack","onExport"])):(c(),d("div",jm," –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è... "))])):M("",!0)])}const $m=J(Em,[["render",zm],["__scopeId","data-v-7bae796b"]]),Wm={name:"UsersManagementPage",components:{UserActivityList:$m,UserActivityFilters:Vt,UserActivityStats:jt,HiddenUsersManager:Bt},setup(){const n=Ye(),e=p([]),a=p({userId:null,type:null,dateFrom:null,dateTo:null}),t=async()=>{try{const h=await new as().getUsersList();e.value=h}catch(u){console.error("[UsersManagementPage] Error loading users:",u)}},r=u=>{a.value={...u}},i=u=>{console.log("View activity details:",u)},o=()=>{window.dispatchEvent(new CustomEvent("hidden-users-changed"))},l=()=>{n.push("/")};return de(async()=>{try{if(!(await Oe.checkAccess()).allowed){n.push("/");return}if(!await Oe.getCurrentUser()){n.push("/");return}await t()}catch(u){console.error("[UsersManagementPage] Error:",u),n.push("/")}}),{users:e,activityFilters:a,handleFiltersUpdate:r,handleViewActivityDetails:i,handleHiddenUsersChanged:o,goBack:l}}},Hm={class:"users-management-page"},qm={class:"page-header"},Jm={class:"page-header-top"},Xm={class:"page-content"},Ym={class:"activity-section"};function Km(n,e,a,t,r,i){const o=W("UserActivityFilters"),l=W("HiddenUsersManager"),u=W("UserActivityStats"),h=W("UserActivityList");return c(),d("div",Hm,[s("div",qm,[s("div",Jm,[s("button",{onClick:e[0]||(e[0]=(...y)=>t.goBack&&t.goBack(...y)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[s("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),s("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=s("h1",null,"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",-1))]),s("div",Xm,[s("div",Ym,[e[3]||(e[3]=s("h2",null,"üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),K(o,{filters:t.activityFilters,users:t.users,onUpdateFilters:t.handleFiltersUpdate},null,8,["filters","users","onUpdateFilters"]),K(l,{filters:t.activityFilters,onHiddenUsersChanged:t.handleHiddenUsersChanged},null,8,["filters","onHiddenUsersChanged"]),K(u,{filters:t.activityFilters},null,8,["filters"]),K(h,{userId:t.activityFilters.userId,dateFrom:t.activityFilters.dateFrom,dateTo:t.activityFilters.dateTo,type:t.activityFilters.type,onViewDetails:t.handleViewActivityDetails},null,8,["userId","dateFrom","dateTo","type","onViewDetails"])])])])}const Gm=J(Wm,[["render",Km],["__scopeId","data-v-d7aa0377"]]);class ae{static async getCacheStatus(){try{const e=Te("/api/admin/cache-status.php"),a=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!a.ok){const r=await a.text();throw new Error(`HTTP error! status: ${a.status}, message: ${r}`)}const t=await a.json();if(t.success){const r=t.modules||[];return r.length===0?{primaryModules:[],secondaryModules:[],metadata:{totalModules:0,primaryCount:0,secondaryCount:0}}:this.categorizeAndSortModules(r)}else throw new Error(t.error||"Failed to get cache status")}catch(e){throw console.error("[CacheManagementService] Error getting cache status:",e),e}}static async clearCache(e){try{const a=Te("/api/admin/cache-clear.php"),t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,confirm:!0})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return!0;throw new Error(r.error||"Failed to clear cache")}catch(a){throw console.error("[CacheManagementService] Error clearing cache:",a),a}}static async getCacheStats(){try{const e=Te("/api/admin/cache-stats.php"),a=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const t=await a.json();if(t.success)return t.stats||{};throw new Error(t.error||"Failed to get cache stats")}catch(e){throw console.error("[CacheManagementService] Error getting cache stats:",e),e}}static formatCacheSize(e){if(e===0)return"0 B";const a=1024,t=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(a));return Math.round(e/Math.pow(a,r)*100)/100+" "+t[r]}static categorizeAndSortModules(e,a={}){const t=this.generateCacheKey(e),r=this.getCachedResult(t);if(r&&!a.forceRefresh)return r;const i=performance.now(),o=this.performCategorization(e),l=performance.now();return o.metadata={processingTime:l-i,totalModules:e.length,primaryCount:o.primaryModules.length,secondaryCount:o.secondaryModules.length,cached:!1},this.setCachedResult(t,o),o}static performCategorization(e){const a=[],t=[];return e.forEach(r=>{this.validateModule(r),this.PRIMARY_MODULE_IDS.includes(r.id)?a.push({...r,category:"primary",priority:this.PRIMARY_MODULE_PRIORITIES[r.id]||999}):t.push({...r,category:"secondary",groupType:this.getModuleType(r.id)})}),{primaryModules:this.sortPrimaryModules(a),secondaryModules:this.sortSecondaryModules(t)}}static sortPrimaryModules(e){return e.sort((a,t)=>{const r=this.PRIMARY_MODULE_PRIORITIES[a.id]||999,i=this.PRIMARY_MODULE_PRIORITIES[t.id]||999;return r-i})}static sortSecondaryModules(e){return e.sort((a,t)=>{const r=this.getModuleType(a.id),i=this.getModuleType(t.id);return r!==i?this.compareModuleTypes(r,i):a.name.localeCompare(t.name)})}static compareModuleTypes(e,a){const t=["users","activity","webhooks","other"],r=t.indexOf(e),i=t.indexOf(a);return(r===-1?999:r)-(i===-1?999:i)}static getModuleType(e){for(const[a,t]of Object.entries(this.SECONDARY_MODULE_TYPES))if(e.startsWith(t.prefix))return a;return e.includes("time-tracking")?"time-tracking":e.includes("graph")?"graphs":e.includes("dashboard")?"dashboards":"other"}static getModuleTypeConfig(e){return this.SECONDARY_MODULE_TYPES[e]||{title:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏",description:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã"}}static validateModule(e){if(!e||typeof e!="object")throw new Error("Module must be an object");if(!e.id||typeof e.id!="string")throw new Error("Module must have a valid id");if(!e.name||typeof e.name!="string")throw new Error("Module must have a valid name");return!0}static generateCacheKey(e){const a=e.map(t=>t.id).sort().join(",");return btoa(a).substring(0,16)}static getCachedResult(e){const a=this.categorizationCache.get(e);return a?Date.now()-a.timestamp>this.CACHE_TTL?(this.categorizationCache.delete(e),null):{...a.data,metadata:{...a.data.metadata,cached:!0}}:null}static setCachedResult(e,a){if(this.categorizationCache.set(e,{data:{...a,metadata:{...a.metadata,cached:!1}},timestamp:Date.now()}),this.categorizationCache.size>10){const t=this.categorizationCache.keys().next().value;this.categorizationCache.delete(t)}}static clearCategorizationCache(){this.categorizationCache.clear()}static getCategorizationStats(){return{cacheSize:this.categorizationCache.size,cacheEntries:Array.from(this.categorizationCache.entries()).map(([e,a])=>({key:e,age:Date.now()-a.timestamp,modulesCount:a.data.primaryModules.length+a.data.secondaryModules.length}))}}static formatTTL(e){return e<60?`${e} —Å–µ–∫`:e<3600?`${Math.floor(e/60)} –º–∏–Ω`:`${Math.floor(e/3600)} —á`}static formatCreationTime(e){return e<1e3?`${Math.round(e)}–º—Å`:e<6e4?`${Math.round(e/1e3*10)/10}—Å–µ–∫`:`${Math.round(e/6e4*10)/10}–º–∏–Ω`}static formatCacheHitRatio(e){return`${Math.round(e*100)}%`}static formatDataFreshness(e){return`${Math.round(e*100)}%`}static getExpiryColor(e){if(!e)return"gray";const a=Date.now()/1e3,t=(e-a)/3600;return t>2?"green":t>.5?"yellow":"red"}static getEfficiencyColor(e){return e>=.85?"green":e>=.7?"yellow":"red"}static getCreationTimeColor(e){return e<=2e3?"green":e<=1e4?"yellow":"red"}static getFreshnessColor(e){return e>=.9?"green":e>=.7?"yellow":"red"}static generateModuleMetadata(e){const a=Math.floor(Date.now()/1e3),t=e.metadata||{},r=this.PRIMARY_MODULE_IDS.includes(e.id);return{version:t.version||"1.0",module_id:e.id,module_name:e.name,created_at:t.created_at||a-Math.random()*86400*7,created_by:t.created_by||(Math.random()>.5?"system":"cron"),creation_time_ms:t.creation_time_ms||500+Math.random()*9500,last_accessed_at:t.last_accessed_at||a-Math.random()*3600,access_count:t.access_count||Math.floor(Math.random()*100)+1,expires_at:t.expires_at||a+(e.ttl||3600),ttl_seconds:e.ttl||3600,file_size_bytes:e.total_size||Math.floor(Math.random()*1e7)+1e6,compression_ratio:t.compression_ratio||.7+Math.random()*.3,data_version:t.data_version||`2026.01.12.v${Math.floor(Math.random()*10)+1}`,source_params:t.source_params||{period:r?Math.random()>.5?"weeks":"months":"default",sector_id:e.id.includes("sector-1c")?"1c":"all",filters:Math.random()>.5?["active_only"]:[],limit:Math.floor(Math.random()*1e3)+500},performance_metrics:t.performance_metrics||{avg_response_time_ms:20+Math.random()*80,cache_hit_ratio:.7+Math.random()*.3,data_freshness_score:.8+Math.random()*.2}}}static enrichModulesWithMetadata(e){return e.map(a=>({...a,metadata:this.generateModuleMetadata(a)}))}}Re(ae,"PRIMARY_MODULE_IDS",["dashboard-sector-1c","graph-state","graph-admission-closure-weeks","graph-admission-closure-months","time-tracking-default","time-tracking-detailed","time-tracking-summary"]),Re(ae,"PRIMARY_MODULE_PRIORITIES",{"dashboard-sector-1c":1,"graph-state":2,"graph-admission-closure-weeks":3,"graph-admission-closure-months":4,"time-tracking-default":5,"time-tracking-detailed":6,"time-tracking-summary":7}),Re(ae,"SECONDARY_MODULE_TYPES",{users:{prefix:"users-management",title:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –æ—Ç–¥–µ–ª–∞–º–∏"},activity:{prefix:"user-activity",title:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",description:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},webhooks:{prefix:"webhook-logs",title:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",description:"–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±—Ö—É–∫–æ–≤"}}),Re(ae,"categorizationCache",new Map),Re(ae,"CACHE_TTL",3e4);function Qm(n){const e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),a=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-a);const t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}class it{static async createCache(e,a=null,t={}){try{const r=Te("/api/admin/cache-create.php"),i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,mode:a,params:t})});if(!i.ok){const l=await i.json().catch(()=>({}));throw new Error(l.error||`HTTP error! status: ${i.status}`)}const o=await i.json();if(o.success)return o;throw new Error(o.error||"Failed to create cache")}catch(r){throw console.error("[CacheCreationService] Error creating cache:",r),r}}static async getCreationStatus(e){try{const a=Te(`/api/admin/cache-create-status.php?task_id=${e}`),t=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return r;throw new Error(r.error||"Failed to get creation status")}catch(a){throw console.error("[CacheCreationService] Error getting creation status:",a),a}}static getDefaultParams(e){if(e.includes("graph-admission-closure"))if((e.includes("weeks")?"weeks":"months")==="weeks"){const t=new Date,r=t.getUTCFullYear(),i=Qm(t),o=new Date(r,0,1+(i-1)*7),l=o.getUTCDay(),u=o.getUTCDate()-l+(l===0?-6:1);o.setUTCDate(u),o.setUTCHours(0,0,0,0);const h=new Date(o);return h.setUTCDate(o.getUTCDate()+6),h.setUTCHours(23,59,59,999),{product:"1C",periodMode:"weeks",weekStartUtc:o.toISOString(),weekEndUtc:h.toISOString(),includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,useCache:!0,forceRefresh:!0}}else return{product:"1C",periodMode:"months",includeTickets:!0,includeNewTicketsByStages:!1,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!1};if(e.includes("dashboard-sector-1c"))return{forceRefresh:!0,ttl:600};if(e.includes("graph-state"))return{type:"current",forceRefresh:!0,ttl:3600};if(e.includes("time-tracking")){const a=e.includes("detailed")?"detailed":e.includes("summary")?"summary":"default";return{product:"1C",includeTaskDetails:a==="detailed",summary:a==="summary"}}return{}}}class Ze{static notifyCacheCreationStarted(e){this.showNotification({content:`–ù–∞—á–∞—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}"...`,type:"info",autoHideDelay:3e3})}static notifyCacheCreationSuccess(e){this.showNotification({content:`‚úÖ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,type:"success",autoHideDelay:5e3})}static notifyCacheCreationError(e,a){this.showNotification({content:`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}": ${a}`,type:"error",autoHideDelay:7e3})}static notifyCacheUpdated(e,a="auto"){const t=a==="manual"?"–≤—Ä—É—á–Ω—É—é":"–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏";this.showNotification({content:`üîÑ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" –æ–±–Ω–æ–≤–ª—ë–Ω ${t}`,type:"info",autoHideDelay:4e3})}static notifyCacheUsed(e){this.showNotification({content:`‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}"`,type:"success",autoHideDelay:3e3})}static showNotification(e){typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:e.content,autoHideDelay:e.autoHideDelay||3e3}):console.log("[CacheNotification]",e.content)}}const Qf=Object.freeze(Object.defineProperty({__proto__:null,CacheNotificationService:Ze},Symbol.toStringTag,{value:"Module"})),Zm={name:"CacheCreateProgress",props:{progress:{type:Number,required:!0,validator:n=>n>=0&&n<=100},message:{type:String,default:"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞..."}}},eg={class:"cache-create-progress"},tg={class:"progress-bar"},sg={class:"progress-text"};function ag(n,e,a,t,r,i){return c(),d("div",eg,[s("div",tg,[s("div",{class:"progress-fill",style:Ee({width:a.progress+"%"})},null,4)]),s("div",sg,m(a.progress)+"% - "+m(a.message),1)])}const og=J(Zm,[["render",ag],["__scopeId","data-v-7071de3b"]]),ng={name:"CacheCreateModal",components:{CacheCreateProgress:og},props:{module:{type:Object,required:!0}},emits:["close","create"],setup(n,{emit:e}){const a=p(!1),t=p(0),r=p(""),i=p(null),o=p(""),l=T(()=>n.module.id.includes("graph-admission-closure")||n.module.id.includes("time-tracking")),u=T(()=>n.module.id.includes("graph-admission-closure")?["months","weeks"]:n.module.id.includes("time-tracking")?["default","detailed","summary"]:[]),h=()=>{e("close")},y=k=>{k.target===k.currentTarget&&h()},g=async()=>{a.value=!0,t.value=0,r.value="–ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞...";try{let k={};if(o.value.trim())try{k=JSON.parse(o.value)}catch{throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")}else k=it.getDefaultParams(n.module.id);Ze.notifyCacheCreationStarted(n.module.name),t.value=25,r.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24...";const A=await it.createCache(n.module.id,i.value,k);t.value=75,r.value="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∞...",await new Promise(E=>setTimeout(E,500)),t.value=100,r.value="–ö–µ—à —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",Ze.notifyCacheCreationSuccess(n.module.name),setTimeout(()=>{e("create",A),h()},1e3)}catch(k){console.error("[CacheCreateModal] Error creating cache:",k),Ze.notifyCacheCreationError(n.module.name,k.message),a.value=!1}};return de(()=>{u.value.length>0&&(i.value=u.value[0]);const k=it.getDefaultParams(n.module.id);o.value=JSON.stringify(k,null,2)}),{creating:a,progress:t,progressMessage:r,selectedMode:i,paramsJson:o,supportsModes:l,availableModes:u,close:h,handleOverlayClick:y,handleCreate:g}}},rg={class:"modal-header"},ig={class:"modal-body"},lg={key:1,class:"create-form"},cg={key:0,class:"form-group"},dg=["value"],ug={class:"form-group"},mg={class:"modal-footer"},gg=["disabled"],hg=["disabled"],fg={key:0},vg={key:1};function pg(n,e,a,t,r,i){const o=W("CacheCreateProgress");return c(),d("div",{class:"modal-overlay",onClick:e[6]||(e[6]=(...l)=>t.handleOverlayClick&&t.handleOverlayClick(...l))},[s("div",{class:"modal-content",onClick:e[5]||(e[5]=pe(()=>{},["stop"]))},[s("div",rg,[s("h2",null,"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞: "+m(a.module.name),1),s("button",{onClick:e[0]||(e[0]=(...l)=>t.close&&t.close(...l)),class:"btn-close"},"√ó")]),s("div",ig,[t.creating?(c(),ne(o,{key:0,progress:t.progress,message:t.progressMessage},null,8,["progress","message"])):(c(),d("div",lg,[t.supportsModes?(c(),d("div",cg,[e[7]||(e[7]=s("label",null,"–†–µ–∂–∏–º –∫–µ—à–∞:",-1)),$(s("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.selectedMode=l),class:"form-control"},[(c(!0),d(j,null,z(t.availableModes,l=>(c(),d("option",{key:l,value:l},m(l),9,dg))),128))],512),[[re,t.selectedMode]])])):M("",!0),s("div",ug,[e[8]||(e[8]=s("label",null,"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):",-1)),$(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.paramsJson=l),placeholder:'{"product": "1C", ...}',rows:"5",class:"form-control"},null,512),[[be,t.paramsJson]]),e[9]||(e[9]=s("small",{class:"form-text"},"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",-1))])]))]),s("div",mg,[s("button",{onClick:e[3]||(e[3]=(...l)=>t.close&&t.close(...l)),class:"btn-cancel",disabled:t.creating},"–û—Ç–º–µ–Ω–∞",8,gg),s("button",{onClick:e[4]||(e[4]=(...l)=>t.handleCreate&&t.handleCreate(...l)),disabled:t.creating,class:"btn-create"},[t.creating?(c(),d("span",fg,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",vg,"–°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],8,hg)])])])}const yg=J(ng,[["render",pg],["__scopeId","data-v-da24811e"]]),_g={name:"CacheCreateButton",components:{CacheCreateModal:yg},props:{module:{type:Object,required:!0}},emits:["created"],setup(n,{emit:e}){const a=p(!1),t=p(!1);return{showModal:a,creating:t,openModal:()=>{a.value=!0},closeModal:()=>{a.value=!1},handleCreate:async l=>{t.value=!0;try{e("created",l)}finally{t.value=!1}}}}},bg={class:"cache-create-button"},wg=["disabled"],Cg={key:0},kg={key:1};function Sg(n,e,a,t,r,i){const o=W("CacheCreateModal");return c(),d("div",bg,[s("button",{onClick:e[0]||(e[0]=(...l)=>t.openModal&&t.openModal(...l)),disabled:t.creating,class:N(["btn-create",{"btn-disabled":t.creating}])},[t.creating?(c(),d("span",Cg,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",kg,"‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],10,wg),t.showModal?(c(),ne(o,{key:0,module:a.module,onClose:t.closeModal,onCreate:t.handleCreate},null,8,["module","onClose","onCreate"])):M("",!0)])}const Dg=J(_g,[["render",Sg],["__scopeId","data-v-177605d5"]]),Ag={name:"CacheModuleCard",components:{CacheCreateButton:Dg},props:{module:{type:Object,required:!0,validator:n=>n&&typeof n.id=="string"&&typeof n.name=="string"},isPrimary:{type:Boolean,default:!1},priority:{type:Number,default:999},groupType:{type:String,default:null}},emits:["clear","refresh","details"],setup(n,{emit:e}){const a=p(!1),t=p(!1),r=p(!1),i=p(!1);de(()=>{const B=()=>{i.value=window.innerWidth<768};B(),window.addEventListener("resize",B)});const o=T(()=>({"cache-module-card":!0,"primary-module":n.isPrimary,"secondary-module":!n.isPrimary,"high-priority":n.priority<=3,"expiring-soon":A.value,"empty-cache":k.value,loading:a.value||t.value})),l=T(()=>n.isPrimary?"üèÜ":{users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"}[n.groupType]||"üîß"),u=T(()=>({"primary-icon":n.isPrimary,"secondary-icon":!n.isPrimary})),h=T(()=>n.isPrimary?"–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å":n.groupType?ae.getModuleTypeConfig(n.groupType).title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞":""),y=T(()=>n.priority?`priority-${n.priority}`:""),g=T(()=>`status-${n.module.status||"empty"}`),k=T(()=>(n.module.file_count||0)===0),A=T(()=>{if(!n.module.expires_at)return!1;const ce=(new Date(n.module.expires_at*1e3)-new Date)/(1e3*60*60);return ce>0&&ce<=2}),E=T(()=>{const B=n.module.status;return B==="active"?"–ê–∫—Ç–∏–≤–µ–Ω":B==="expired"?"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω":B==="empty"?"–ü—É—Å—Ç":"–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}),S=T(()=>ae.formatCacheSize(n.module.total_size||0)),I=T(()=>ae.formatTTL(n.module.ttl||0)),f=T(()=>{if(!n.module.cache_dir)return"";const B=n.module.cache_dir.split("/");return B.length>2?"..."+B.slice(-2).join("/"):n.module.cache_dir}),v=T(()=>n.module.metadata?.creation_time_ms?ae.formatCreationTime(n.module.metadata.creation_time_ms):"‚Äî"),w=T(()=>{if(!n.module.metadata?.last_accessed_at)return"‚Äî";const B=new Date(n.module.metadata.last_accessed_at*1e3),ce=new Date-B;return ce<6e4?"–¢–æ–ª—å–∫–æ —á—Ç–æ":ce<36e5?`${Math.floor(ce/6e4)} –º–∏–Ω –Ω–∞–∑–∞–¥`:B.toLocaleString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),F=T(()=>n.module.metadata?.access_count||0),U=T(()=>n.module.metadata?.performance_metrics?.cache_hit_ratio?ae.formatCacheHitRatio(n.module.metadata.performance_metrics.cache_hit_ratio):"‚Äî"),C=T(()=>n.module.metadata?.performance_metrics?.data_freshness_score?ae.formatDataFreshness(n.module.metadata.performance_metrics.data_freshness_score):"‚Äî"),_=T(()=>n.module.expires_at?`metric-${ae.getExpiryColor(n.module.expires_at)}`:""),b=T(()=>n.module.metadata?.creation_time_ms?`metric-${ae.getCreationTimeColor(n.module.metadata.creation_time_ms)}`:""),L=T(()=>n.module.metadata?.performance_metrics?.cache_hit_ratio?`metric-${ae.getEfficiencyColor(n.module.metadata.performance_metrics.cache_hit_ratio)}`:""),V=T(()=>n.module.metadata?.performance_metrics?.data_freshness_score?`metric-${ae.getFreshnessColor(n.module.metadata.performance_metrics.data_freshness_score)}`:""),O=T(()=>!k.value&&!a.value),D=T(()=>n.isPrimary&&!k.value),H=T(()=>k.value?"–ö–µ—à –º–æ–¥—É–ª—è –ø—É—Å—Ç":`–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è ${n.module.name}`),ge=T(()=>{if(!n.module.created_at)return"‚Äî";const B=new Date(n.module.created_at*1e3),se=new Date,ce=se-B;if(ce<6e4)return"–¢–æ–ª—å–∫–æ —á—Ç–æ";if(ce<36e5){const we=Math.floor(ce/6e4);return`${we} ${we===1?"–º–∏–Ω—É—Ç—É":we<5?"–º–∏–Ω—É—Ç—ã":"–º–∏–Ω—É—Ç"} –Ω–∞–∑–∞–¥`}if(B.toDateString()===se.toDateString())return`–°–µ–≥–æ–¥–Ω—è –≤ ${B.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`;const fe=new Date(se);return fe.setDate(fe.getDate()-1),B.toDateString()===fe.toDateString()?`–í—á–µ—Ä–∞ –≤ ${B.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:B.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),R=T(()=>{if(!n.module.expires_at)return"‚Äî";const B=new Date(n.module.expires_at*1e3),ce=B-new Date;if(ce<0)return`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω (${B.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})`;const fe=Math.floor(ce/6e4),we=Math.floor(fe/60);return we>0?`${we} —á ${fe%60} –º–∏–Ω`:fe>0?`${fe} –º–∏–Ω`:"–ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã"}),X=async()=>{if(!(!O.value||!await le({title:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏",message:`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${n.module.name}"?`,type:"danger",confirmText:"–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à",cancelText:"–û—Ç–º–µ–Ω–∞"}))){a.value=!0;try{await ae.clearCache(n.module.id),e("clear",n.module.id),Z({type:"success",title:"–ö–µ—à –æ—á–∏—â–µ–Ω",message:`–ö–µ—à –º–æ–¥—É–ª—è "${n.module.name}" —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω`})}catch(se){Z({type:"error",title:"–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏",message:se.message})}finally{a.value=!1}}},P=()=>{e("refresh")},Y=B=>{t.value=B},te=()=>{r.value=!0,e("details",n.module)},ie=()=>{r.value=!1},Z=({type:B,title:se,message:ce})=>{typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:`${se}: ${ce}`,autoHideDelay:B==="error"?5e3:3e3}):alert(`${se}: ${ce}`)},le=async({title:B,message:se,type:ce,confirmText:fe,cancelText:we})=>new Promise(qe=>{const Ce=document.createElement("div");Ce.className="confirmation-modal-overlay",Ce.innerHTML=`
          <div class="confirmation-modal" role="dialog" aria-modal="true">
            <div class="modal-header">
              <h3>${B}</h3>
            </div>
            <div class="modal-body">
              <p>${se}</p>
              <div class="warning-info">
                <p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ:</p>
                <ul>
                  <li>–£–¥–∞–ª–∏—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∫–µ—à–∞</li>
                  <li>–ü—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É —Å–æ–∑–¥–∞–Ω–∏—é –∫–µ—à–∞ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ</li>
                  <li>–ú–æ–∂–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–µ–¥–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É –º–æ–¥—É–ª—è</li>
                </ul>
              </div>
            </div>
            <div class="modal-actions">
              <button class="btn-cancel">${we}</button>
              <button class="btn-confirm">${fe}</button>
            </div>
          </div>
        `;const ot=Ce.querySelector(".btn-cancel"),x=Ce.querySelector(".btn-confirm");ot.addEventListener("click",()=>{Ce.remove(),qe(!1)}),x.addEventListener("click",()=>{Ce.remove(),qe(!0)}),document.addEventListener("keydown",function q(oe){oe.key==="Escape"&&(Ce.remove(),qe(!1),document.removeEventListener("keydown",q))}),document.body.appendChild(Ce)});return{clearing:a,creating:t,showDetailModal:r,isMobile:i,moduleClasses:o,moduleIcon:l,iconClass:u,moduleTypeText:h,priorityClass:y,statusClass:g,isEmpty:k,isExpiringSoon:A,statusText:E,formattedSize:S,formattedTTL:I,shortCacheDir:f,formattedCreationTime:v,formattedLastAccess:w,accessCount:F,cacheEfficiency:U,dataFreshness:C,expiresClass:_,creationTimeClass:b,cacheEfficiencyClass:L,dataFreshnessClass:V,canClear:O,canShowDetails:D,clearButtonLabel:H,formattedCreatedAt:ge,formattedExpiresAt:R,handleClear:X,handleCacheCreated:P,handleCreatingState:Y,showDetails:te,closeDetails:ie}}},Tg=["aria-labelledby","aria-describedby"],Eg={class:"card-header"},Mg={class:"module-identity"},xg={class:"module-info"},Ig=["id"],Lg={class:"module-type"},Pg={class:"header-meta"},Fg=["id"],Ug={class:"card-content"},Rg={class:"data-grid"},Og={class:"data-section statistics"},Ng={class:"data-items"},Bg={class:"data-item"},Vg={class:"data-value"},jg={class:"data-item"},zg={class:"data-value"},$g={key:0,class:"data-item full-width"},Wg=["title"],Hg={class:"data-section lifetime"},qg={class:"data-items"},Jg={class:"data-item"},Xg={class:"data-value"},Yg={key:0,class:"data-item"},Kg={class:"data-value"},Gg={key:1,class:"data-item"},Qg={key:0,class:"data-section performance"},Zg={class:"data-items"},eh={class:"data-item"},th={class:"data-item"},sh={class:"data-value"},ah={class:"data-item"},oh={class:"data-value"},nh={class:"data-item"},rh={class:"data-item"},ih={class:"primary-actions"},lh={class:"secondary-actions"},ch=["disabled","aria-label"],dh={key:0,class:"button-content"},uh={key:1,class:"button-content"},mh={key:2,class:"button-content"},gh=["aria-label"],hh={class:"detail-modal",role:"dialog","aria-modal":"true"},fh={class:"modal-header"},vh={class:"modal-content"},ph={class:"json-data"};function yh(n,e,a,t,r,i){const o=W("CacheCreateButton");return c(),d("article",{class:N(["cache-module-card",t.moduleClasses]),role:"article","aria-labelledby":`module-${a.module.id}-title`,"aria-describedby":`module-${a.module.id}-status`},[s("div",Eg,[s("div",Mg,[s("div",{class:N(["module-icon",t.iconClass])},m(t.moduleIcon),3),s("div",xg,[s("h3",{class:"module-name",id:`module-${a.module.id}-title`},m(a.module.name),9,Ig),s("span",Lg,m(t.moduleTypeText),1)])]),s("div",Pg,[a.isPrimary&&a.priority?(c(),d("span",{key:0,class:N(["priority-badge",t.priorityClass])},m(a.priority),3)):M("",!0),s("span",{class:N(["status-badge",t.statusClass]),id:`module-${a.module.id}-status`,role:"status"},m(t.statusText),11,Fg)])]),s("div",Ug,[s("div",Rg,[s("div",Og,[e[14]||(e[14]=s("div",{class:"section-header"},[s("span",{class:"section-icon"},"üìä"),s("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],-1)),s("div",Ng,[s("div",Bg,[e[11]||(e[11]=s("span",{class:"data-label"},"–§–∞–π–ª–æ–≤:",-1)),s("span",Vg,m(a.module.file_count||0),1)]),s("div",jg,[e[12]||(e[12]=s("span",{class:"data-label"},"–†–∞–∑–º–µ—Ä:",-1)),s("span",zg,m(t.formattedSize),1)]),a.module.cache_dir?(c(),d("div",$g,[e[13]||(e[13]=s("span",{class:"data-label"},"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:",-1)),s("span",{class:"data-value cache-dir",title:a.module.cache_dir},m(t.shortCacheDir),9,Wg)])):M("",!0)])]),s("div",Hg,[e[18]||(e[18]=s("div",{class:"section-header"},[s("span",{class:"section-icon"},"‚è∞"),s("h4",{class:"section-title"},"–í—Ä–µ–º—è –∂–∏–∑–Ω–∏")],-1)),s("div",qg,[s("div",Jg,[e[15]||(e[15]=s("span",{class:"data-label"},"TTL:",-1)),s("span",Xg,m(t.formattedTTL),1)]),a.module.created_at?(c(),d("div",Yg,[e[16]||(e[16]=s("span",{class:"data-label"},"–°–æ–∑–¥–∞–Ω:",-1)),s("span",Kg,m(t.formattedCreatedAt),1)])):M("",!0),a.module.expires_at?(c(),d("div",Gg,[e[17]||(e[17]=s("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç:",-1)),s("span",{class:N(["data-value",t.expiresClass])},m(t.formattedExpiresAt),3)])):M("",!0)])]),a.isPrimary&&a.module.metadata?(c(),d("div",Qg,[e[24]||(e[24]=s("div",{class:"section-header"},[s("span",{class:"section-icon"},"‚ö°"),s("h4",{class:"section-title"},"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")],-1)),s("div",Zg,[s("div",eh,[e[19]||(e[19]=s("span",{class:"data-label"},"–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:",-1)),s("span",{class:N(["data-value",t.creationTimeClass])},m(t.formattedCreationTime),3)]),s("div",th,[e[20]||(e[20]=s("span",{class:"data-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—Å—Ç—É–ø:",-1)),s("span",sh,m(t.formattedLastAccess),1)]),s("div",ah,[e[21]||(e[21]=s("span",{class:"data-label"},"–û–±—Ä–∞—â–µ–Ω–∏–π:",-1)),s("span",oh,m(t.accessCount),1)]),s("div",nh,[e[22]||(e[22]=s("span",{class:"data-label"},"–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),s("span",{class:N(["data-value",t.cacheEfficiencyClass])},m(t.cacheEfficiency),3)]),s("div",rh,[e[23]||(e[23]=s("span",{class:"data-label"},"–°–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:",-1)),s("span",{class:N(["data-value",t.dataFreshnessClass])},m(t.dataFreshness),3)])])])):M("",!0)])]),s("div",{class:N(["card-actions",{"mobile-layout":t.isMobile}])},[s("div",ih,[K(o,{module:a.module,disabled:t.creating,onCreated:t.handleCacheCreated,onCreating:t.handleCreatingState,class:N(["action-button create-button",{loading:t.creating}])},null,8,["module","disabled","onCreated","onCreating","class"])]),s("div",lh,[s("button",{onClick:e[0]||(e[0]=(...l)=>t.handleClear&&t.handleClear(...l)),onKeydown:[e[1]||(e[1]=De((...l)=>t.handleClear&&t.handleClear(...l),["enter"])),e[2]||(e[2]=De(pe((...l)=>t.handleClear&&t.handleClear(...l),["prevent"]),["space"]))],disabled:!t.canClear,class:N(["action-button clear-button",{disabled:!t.canClear,loading:t.clearing}]),"aria-label":t.clearButtonLabel,tabindex:"0"},[t.clearing?(c(),d("span",dh,[...e[25]||(e[25]=[s("span",{class:"spinner"},null,-1),Q(" –û—á–∏—Å—Ç–∫–∞... ",-1)])])):t.isEmpty?(c(),d("span",uh," üìÅ –ö–µ—à –ø—É—Å—Ç ")):(c(),d("span",mh," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å "))],42,ch),t.canShowDetails?(c(),d("button",{key:0,onClick:e[3]||(e[3]=(...l)=>t.showDetails&&t.showDetails(...l)),onKeydown:[e[4]||(e[4]=De((...l)=>t.showDetails&&t.showDetails(...l),["enter"])),e[5]||(e[5]=De(pe((...l)=>t.showDetails&&t.showDetails(...l),["prevent"]),["space"]))],class:"action-button details-button","aria-label":`–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞ ${a.module.name}`,title:"–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞",tabindex:"0"}," üìä ",40,gh)):M("",!0)])],2),(c(),ne(Ct,{to:"body"},[t.showDetailModal?(c(),d("div",{key:0,class:"detail-modal-overlay",onClick:e[9]||(e[9]=pe((...l)=>t.closeDetails&&t.closeDetails(...l),["self"])),onKeydown:e[10]||(e[10]=De((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))},[s("div",hh,[s("div",fh,[s("h3",null,"–î–µ—Ç–∞–ª–∏ –∫–µ—à–∞: "+m(a.module.name),1),s("button",{onClick:e[6]||(e[6]=(...l)=>t.closeDetails&&t.closeDetails(...l)),onKeydown:[e[7]||(e[7]=De((...l)=>t.closeDetails&&t.closeDetails(...l),["enter"])),e[8]||(e[8]=De((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))],class:"close-button","aria-label":"–ó–∞–∫—Ä—ã—Ç—å",tabindex:"0"}," ‚úï ",32)]),s("div",vh,[s("pre",ph,m(JSON.stringify(a.module,null,2)),1)])])],32)):M("",!0)]))],10,Tg)}const _h=J(Ag,[["render",yh],["__scopeId","data-v-c700185b"]]),bh={name:"CacheStats",props:{modules:{type:Array,required:!1,default:()=>[]}},setup(n){console.log("[CacheStats] setup called with modules:",n.modules);const e=T(()=>n.modules||[]),a=T(()=>{console.log("[CacheStats] Computing primaryModules, total modules:",e.value?.length||0);const E=e.value.filter(S=>ae.PRIMARY_MODULE_IDS.includes(S.id));return console.log("[CacheStats] Primary modules count:",E.length),E}),t=T(()=>{console.log("[CacheStats] Computing secondaryModules, total modules:",e.value?.length||0);const E=e.value.filter(S=>!ae.PRIMARY_MODULE_IDS.includes(S.id));return console.log("[CacheStats] Secondary modules count:",E.length),E}),r=T(()=>a.value?.length||0),i=T(()=>t.value?.length||0),o=T(()=>e.value?.length||0),l=T(()=>e.value.reduce((E,S)=>E+(S.file_count||0),0)),u=T(()=>(n.modules||[]).reduce((E,S)=>E+(S.total_size||0),0)),h=T(()=>ae.formatCacheSize(u.value)),y=T(()=>{const E=n.modules||[];if(E.length===0)return"0 –º–∏–Ω";const S=E.reduce((f,v)=>f+(v.ttl||0),0),I=Math.round(S/E.length);return ae.formatTTL(I)}),g=T(()=>(e.value||[]).filter(E=>E.status==="active").length),k=T(()=>{if((i.value||0)===0)return[];const E={};(t.value||[]).forEach(I=>{const f=ae.getModuleType(I.id);if(!E[f]){const v=ae.getModuleTypeConfig(f);E[f]={type:f,title:v.title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞",icon:A(f),count:0}}E[f].count++});const S=i.value||0;return Object.values(E).map(I=>({...I,percentage:S>0?Math.round(I.count/S*100):0})).sort((I,f)=>f.count-I.count)}),A=E=>{const S={users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"};return S[E]||S.other};return{modules:e,primaryModulesCount:r,secondaryModulesCount:i,totalModules:o,totalFiles:l,totalSizeFormatted:h,avgTTL:y,activeModules:g,groupStats:k}}},wh={key:0,class:"cache-stats"},Ch={class:"stats-overview"},kh={class:"overview-grid"},Sh={class:"overview-card primary"},Dh={class:"overview-content"},Ah={class:"overview-value"},Th={class:"overview-card secondary"},Eh={class:"overview-content"},Mh={class:"overview-value"},xh={class:"overview-card total"},Ih={class:"overview-content"},Lh={class:"overview-value"},Ph={class:"detailed-stats"},Fh={class:"stats-grid"},Uh={class:"stat-card"},Rh={class:"stat-content"},Oh={class:"stat-value"},Nh={class:"stat-card"},Bh={class:"stat-content"},Vh={class:"stat-value"},jh={class:"stat-card"},zh={class:"stat-content"},$h={class:"stat-value"},Wh={class:"stat-card"},Hh={class:"stat-content"},qh={class:"stat-value"},Jh={key:0,class:"group-distribution"},Xh={class:"distribution-grid"},Yh={class:"group-icon"},Kh={class:"group-info"},Gh={class:"group-name"},Qh={class:"group-count"},Zh={class:"group-percentage"},ef={key:1,class:"cache-stats-loading"};function tf(n,e,a,t,r,i){return(t.modules||[]).length>0?(c(),d("div",wh,[e[18]||(e[18]=s("h2",{class:"stats-title"},"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",-1)),s("div",Ch,[s("div",kh,[s("div",Sh,[e[2]||(e[2]=s("div",{class:"overview-icon"},"üèÜ",-1)),s("div",Dh,[s("div",Ah,m(t.primaryModulesCount),1),e[0]||(e[0]=s("div",{class:"overview-label"},"–û—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[1]||(e[1]=s("div",{class:"overview-desc"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ",-1))])]),s("div",Th,[e[5]||(e[5]=s("div",{class:"overview-icon"},"üîß",-1)),s("div",Eh,[s("div",Mh,m(t.secondaryModulesCount),1),e[3]||(e[3]=s("div",{class:"overview-label"},"–ü–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[4]||(e[4]=s("div",{class:"overview-desc"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),s("div",xh,[e[8]||(e[8]=s("div",{class:"overview-icon"},"üì¶",-1)),s("div",Ih,[s("div",Lh,m(t.totalModules),1),e[6]||(e[6]=s("div",{class:"overview-label"},"–í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π",-1)),e[7]||(e[7]=s("div",{class:"overview-desc"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö",-1))])])])]),s("div",Ph,[s("div",Fh,[s("div",Uh,[e[10]||(e[10]=s("div",{class:"stat-icon"},"üìÑ",-1)),s("div",Rh,[s("div",Oh,m(t.totalFiles),1),e[9]||(e[9]=s("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤",-1))])]),s("div",Nh,[e[12]||(e[12]=s("div",{class:"stat-icon"},"üíæ",-1)),s("div",Bh,[s("div",Vh,m(t.totalSizeFormatted),1),e[11]||(e[11]=s("div",{class:"stat-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä",-1))])]),s("div",jh,[e[14]||(e[14]=s("div",{class:"stat-icon"},"‚è±Ô∏è",-1)),s("div",zh,[s("div",$h,m(t.avgTTL),1),e[13]||(e[13]=s("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–∏–π TTL",-1))])]),s("div",Wh,[e[16]||(e[16]=s("div",{class:"stat-icon"},"‚ö°",-1)),s("div",Hh,[s("div",qh,m(t.activeModules),1),e[15]||(e[15]=s("div",{class:"stat-label"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–µ—à–µ–π",-1))])])])]),t.secondaryModulesCount>0?(c(),d("div",Jh,[e[17]||(e[17]=s("h3",{class:"distribution-title"},"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),s("div",Xh,[(c(!0),d(j,null,z(t.groupStats,o=>(c(),d("div",{key:o.type,class:"distribution-item"},[s("div",Yh,m(o.icon),1),s("div",Kh,[s("div",Gh,m(o.title),1),s("div",Qh,m(o.count)+" –º–æ–¥—É–ª–µ–π",1)]),s("div",Zh,m(o.percentage)+"%",1)]))),128))])])):M("",!0)])):(c(),d("div",ef,[...e[19]||(e[19]=[s("p",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])]))}const sf=J(bh,[["render",tf],["__scopeId","data-v-9fa190bb"]]),af={name:"CacheManagement",components:{CacheModuleCard:_h,CacheStats:sf},setup(){const n=p([]),e=p([]),a=p(!0),t=p(null),r=T(()=>(n.value?.length||0)+(e.value?.length||0)),i=T(()=>{const S=o.value?.length||0,I=(l.value?.length||0)>0?1:0;return S+I}),o=T(()=>{const S=(n.value||[]).filter(I=>!I.id.includes("time-tracking"));return console.log("[CacheManagement] individualPrimaryModules:",S.length,S.map(I=>I.id)),S}),l=T(()=>{const S=(n.value||[]).filter(I=>I.id.includes("time-tracking")).sort((I,f)=>{const v=["time-tracking-default","time-tracking-detailed","time-tracking-summary"];return v.indexOf(I.id)-v.indexOf(f.id)});return console.log("[CacheManagement] timeTrackingModules:",S.length,S.map(I=>I.id)),S}),u=T(()=>{const S={};return(e.value||[]).forEach(f=>{const v=ae.getModuleType(f.id);S[v]||(S[v]={type:v,title:y(v),modules:[]}),S[v].modules.push(f)}),Object.values(S).sort((f,v)=>{const w=["users","activity","webhooks","other"],F=w.indexOf(f.type),U=w.indexOf(v.type);return(F===-1?999:F)-(U===-1?999:U)})}),h=async()=>{a.value=!0,t.value=null;try{const S=[{id:"dashboard-sector-1c",name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",status:"active",file_count:5,total_size:1024e3,ttl:600,created_at:Math.floor(Date.now()/1e3)-7200,expires_at:Math.floor(Date.now()/1e3)+1800,cache_dir:"/var/cache/dashboard/sector-1c",metadata:{version:"1.0",module_id:"dashboard-sector-1c",module_name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",created_at:Math.floor(Date.now()/1e3)-7200,created_by:"system",creation_time_ms:1250,last_accessed_at:Math.floor(Date.now()/1e3)-300,access_count:45,expires_at:Math.floor(Date.now()/1e3)+1800,ttl_seconds:600,file_size_bytes:1024e3,compression_ratio:.75,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only"],limit:1e3},performance_metrics:{avg_response_time_ms:45,cache_hit_ratio:.92,data_freshness_score:.95}}},{id:"graph-state",name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",status:"active",file_count:3,total_size:512e3,ttl:3600,created_at:Math.floor(Date.now()/1e3)-10800,expires_at:Math.floor(Date.now()/1e3)+7200,cache_dir:"/var/cache/graphs/state",metadata:{version:"1.0",module_id:"graph-state",module_name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",created_at:Math.floor(Date.now()/1e3)-10800,created_by:"cron",creation_time_ms:890,last_accessed_at:Math.floor(Date.now()/1e3)-600,access_count:23,expires_at:Math.floor(Date.now()/1e3)+7200,ttl_seconds:3600,file_size_bytes:512e3,compression_ratio:.82,data_version:"2026.01.12.v2",source_params:{period:"months",sector_id:"all",filters:[],limit:500},performance_metrics:{avg_response_time_ms:32,cache_hit_ratio:.88,data_freshness_score:.91}}},{id:"graph-admission-closure-weeks",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",status:"active",file_count:8,total_size:2048e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-1800,expires_at:Math.floor(Date.now()/1e3)+120,cache_dir:"/var/cache/graphs/admission-closure/weeks",metadata:{version:"1.0",module_id:"graph-admission-closure-weeks",module_name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",created_at:Math.floor(Date.now()/1e3)-1800,created_by:"system",creation_time_ms:2100,last_accessed_at:Math.floor(Date.now()/1e3)-60,access_count:67,expires_at:Math.floor(Date.now()/1e3)+120,ttl_seconds:300,file_size_bytes:2048e3,compression_ratio:.68,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only","resolved_only"],limit:2e3},performance_metrics:{avg_response_time_ms:78,cache_hit_ratio:.95,data_freshness_score:.98}}},{id:"graph-admission-closure-months",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",status:"active",file_count:12,total_size:3072e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-3600,expires_at:Math.floor(Date.now()/1e3)+240,cache_dir:"/var/cache/graphs/admission-closure/months",metadata:{version:"1.0",module_id:"graph-admission-closure-months",module_name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",created_at:Math.floor(Date.now()/1e3)-3600,created_by:"cron",creation_time_ms:3400,last_accessed_at:Math.floor(Date.now()/1e3)-120,access_count:34,expires_at:Math.floor(Date.now()/1e3)+240,ttl_seconds:300,file_size_bytes:3072e3,compression_ratio:.71,data_version:"2026.01.12.v3",source_params:{period:"months",sector_id:"1c",filters:["active_only"],limit:3e3},performance_metrics:{avg_response_time_ms:92,cache_hit_ratio:.89,data_freshness_score:.93}}},{id:"time-tracking-default",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",status:"active",file_count:4,total_size:768e3,ttl:300,created_at:Math.floor(Date.now()/1e3)-900,expires_at:Math.floor(Date.now()/1e3)+2100,cache_dir:"/var/cache/time-tracking/default",metadata:{version:"1.0",module_id:"time-tracking-default",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",created_at:Math.floor(Date.now()/1e3)-900,created_by:"system",creation_time_ms:560,last_accessed_at:Math.floor(Date.now()/1e3)-180,access_count:12,expires_at:Math.floor(Date.now()/1e3)+2100,ttl_seconds:300,file_size_bytes:768e3,compression_ratio:.79,data_version:"2026.01.12.v2",source_params:{period:"weeks",sector_id:"1c",filters:["active_only"],limit:800},performance_metrics:{avg_response_time_ms:28,cache_hit_ratio:.96,data_freshness_score:.97}}},{id:"time-tracking-detailed",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:6,total_size:1536e3,ttl:120,created_at:Math.floor(Date.now()/1e3)-600,expires_at:Math.floor(Date.now()/1e3)+3540,cache_dir:"/var/cache/time-tracking/detailed",metadata:{version:"1.0",module_id:"time-tracking-detailed",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",created_at:Math.floor(Date.now()/1e3)-600,created_by:"user",creation_time_ms:890,last_accessed_at:Math.floor(Date.now()/1e3)-90,access_count:8,expires_at:Math.floor(Date.now()/1e3)+3540,ttl_seconds:120,file_size_bytes:1536e3,compression_ratio:.74,data_version:"2026.01.12.v1",source_params:{period:"weeks",sector_id:"1c",filters:["active_only","detailed_view"],limit:1500},performance_metrics:{avg_response_time_ms:45,cache_hit_ratio:.91,data_freshness_score:.94}}},{id:"time-tracking-summary",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:2,total_size:384e3,ttl:600,created_at:Math.floor(Date.now()/1e3)-1800,expires_at:Math.floor(Date.now()/1e3)+4200,cache_dir:"/var/cache/time-tracking/summary",metadata:{version:"1.0",module_id:"time-tracking-summary",module_name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",created_at:Math.floor(Date.now()/1e3)-1800,created_by:"cron",creation_time_ms:340,last_accessed_at:Math.floor(Date.now()/1e3)-240,access_count:19,expires_at:Math.floor(Date.now()/1e3)+4200,ttl_seconds:600,file_size_bytes:384e3,compression_ratio:.85,data_version:"2026.01.12.v3",source_params:{period:"months",sector_id:"1c",filters:["summary_view"],limit:300},performance_metrics:{avg_response_time_ms:18,cache_hit_ratio:.98,data_freshness_score:.99}}},{id:"users-management-departments",name:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–æ—Ç–¥–µ–ª—ã)",status:"active",file_count:2,total_size:256e3,ttl:3600,created_at:Math.floor(Date.now()/1e3)-7200,expires_at:Math.floor(Date.now()/1e3)+28800,cache_dir:"/var/cache/users/departments"},{id:"webhook-logs-api",name:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ (API –∑–∞–ø—Ä–æ—Å—ã)",status:"active",file_count:15,total_size:512e4,ttl:300,created_at:Math.floor(Date.now()/1e3)-3600,expires_at:Math.floor(Date.now()/1e3)+2400,cache_dir:"/var/cache/webhooks/api"}],I=ae.enrichModulesWithMetadata(S),f=ae.categorizeAndSortModules(I);n.value=f.primaryModules||[],e.value=f.secondaryModules||[],console.log("[CacheManagement] Primary modules:",n.value.length,n.value.map(v=>({id:v.id,name:v.name}))),console.log("[CacheManagement] Secondary modules:",e.value.length,e.value.map(v=>({id:v.id,name:v.name})))}catch(S){console.error("[CacheManagement] Error loading modules:",S),t.value=S.message}finally{a.value=!1}},y=S=>{const I={users:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",activity:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",webhooks:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",other:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏"};return I[S]||I.other},g=async S=>{console.log(`[CacheManagement] Clearing module: ${S}`),await h()},k=async S=>{console.log(`[CacheManagement] Creating cache for: ${S.name} (${S.id})`),alert(`–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${S.name}
ID: ${S.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},A=async S=>{console.log(`[CacheManagement] Clearing cache for: ${S.name} (${S.id})`),alert(`–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${S.name}
ID: ${S.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},E=()=>{h()};return de(()=>{h()}),{primaryModules:n,secondaryModules:e,loading:a,error:t,totalModules:r,groupedSecondaryModules:u,individualPrimaryModules:o,timeTrackingModules:l,logicalPrimaryCount:i,handleModuleClear:g,handleCreateMock:k,handleClearMock:A,refreshModules:E}}},of={class:"cache-management"},nf={key:0,class:"header-section"},rf={class:"stats-bar"},lf={class:"stat-item"},cf={class:"stat-item"},df={class:"stat-item"},uf={class:"section-header"},mf={class:"section-meta"},gf={class:"module-count","aria-label":"{{ logicalPrimaryCount }} –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},hf={key:0,class:"modules-container"},ff={style:{background:"#f0f8ff",padding:"10px",margin:"10px 0",border:"1px solid #007bff","border-radius":"4px"}},vf={key:0,class:"modules-grid"},pf={key:1,class:"time-tracking-group"},yf={class:"modules-grid"},_f={key:1,class:"empty-state"},bf={key:2,class:"section-divider"},wf={key:3,class:"cache-section secondary-modules","aria-labelledby":"secondary-modules-heading"},Cf={class:"section-header"},kf={class:"section-meta"},Sf={class:"module-count","aria-label":"{{ (secondaryModules || []).length }} –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},Df={class:"grouped-modules"},Af={class:"group-header"},Tf={class:"group-title"},Ef={class:"group-badge secondary"},Mf={class:"modules-grid"},xf={key:4,class:"error-message",role:"alert","aria-live":"assertive"},If={key:5,class:"loading-overlay",role:"status","aria-live":"polite","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"};function Lf(n,e,a,t,r,i){const o=W("CacheModuleCard");return c(),d("div",of,[!t.loading&&!t.error?(c(),d("div",nf,[e[5]||(e[5]=s("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1)),e[6]||(e[6]=s("p",{class:"description"}," –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º —Å–∏—Å—Ç–µ–º—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è ",-1)),s("div",rf,[s("span",lf,[s("strong",null,m(t.totalModules),1),e[2]||(e[2]=Q(" –≤—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π ",-1))]),s("span",cf,[s("strong",null,m(t.logicalPrimaryCount),1),e[3]||(e[3]=Q(" –æ—Å–Ω–æ–≤–Ω—ã—Ö ",-1))]),s("span",df,[s("strong",null,m((t.secondaryModules||[]).length),1),e[4]||(e[4]=Q(" –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ",-1))])])])):M("",!0),!t.loading&&!t.error?(c(),d("section",{key:1,class:N(["cache-section primary-modules",{empty:(t.primaryModules||[]).length===0}]),"aria-labelledby":"primary-modules-heading"},[s("div",uf,[e[8]||(e[8]=s("h2",{id:"primary-modules-heading"},"üèÜ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),s("div",mf,[s("span",gf,m(t.logicalPrimaryCount),1),e[7]||(e[7]=s("span",{class:"section-badge primary",role:"status","aria-label":"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",-1))])]),e[16]||(e[16]=s("p",{class:"section-description"}," 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã: –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°, –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏–µ–º–∞-–∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°. ",-1)),(t.primaryModules||[]).length>0?(c(),d("div",hf,[s("div",ff,[s("strong",null,"DEBUG: Primary modules loaded: "+m(t.primaryModules.length),1),e[9]||(e[9]=s("br",null,null,-1)),s("strong",null,"Individual modules: "+m(t.individualPrimaryModules.length),1),e[10]||(e[10]=s("br",null,null,-1)),s("strong",null,"Time tracking modules: "+m(t.timeTrackingModules.length),1),e[11]||(e[11]=s("br",null,null,-1)),e[12]||(e[12]=s("strong",null,"IDs:",-1)),Q(" "+m(t.primaryModules.map(l=>l.id).join(", ")),1)]),t.individualPrimaryModules.length>0?(c(),d("div",vf,[(c(!0),d(j,null,z(t.individualPrimaryModules,l=>(c(),d("div",{key:l.id,class:"module-wrapper"},[K(o,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])):M("",!0),(t.timeTrackingModules||[]).length>0?(c(),d("div",pf,[e[13]||(e[13]=s("div",{class:"group-header"},[s("h3",{class:"group-title"},"‚è±Ô∏è –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"),s("span",{class:"group-badge"},"–û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞")],-1)),e[14]||(e[14]=s("p",{class:"group-description"},"–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),s("div",yf,[(c(!0),d(j,null,z(t.timeTrackingModules,l=>(c(),d("div",{key:l.id,class:"module-wrapper"},[K(o,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])])):M("",!0)])):(c(),d("div",_f,[e[15]||(e[15]=s("p",null,"‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)),s("button",{onClick:e[0]||(e[0]=(...l)=>t.refreshModules&&t.refreshModules(...l)),class:"refresh-btn"},"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫")]))],2)):M("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("div",bf,[...e[17]||(e[17]=[tt('<div class="divider-line" data-v-02719b2e></div><div class="divider-content" data-v-02719b2e><span class="divider-icon" data-v-02719b2e>üîß</span><span class="divider-text" data-v-02719b2e>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏</span><span class="divider-subtitle" data-v-02719b2e>–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</span></div><div class="divider-line" data-v-02719b2e></div>',3)])])):M("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("section",wf,[s("div",Cf,[e[19]||(e[19]=s("h2",{id:"secondary-modules-heading"},"üîß –ü–æ–±–æ—á–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),s("div",kf,[s("span",Sf,m((t.secondaryModules||[]).length),1),e[18]||(e[18]=s("span",{class:"section-badge secondary",role:"status","aria-label":"–°–ª—É–∂–µ–±–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),e[20]||(e[20]=s("p",{class:"section-description"}," –ú–æ–¥—É–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã. ",-1)),s("div",Df,[(c(!0),d(j,null,z(t.groupedSecondaryModules,l=>(c(),d("div",{key:l.type,class:N(["module-group",`group-${l.type}`])},[s("div",Af,[s("h3",Tf,m(l.title),1),s("span",Ef,m(l.modules.length),1)]),s("div",Mf,[(c(!0),d(j,null,z(l.modules,u=>(c(),d("div",{key:u.id,class:"module-wrapper"},[K(o,{module:u,"is-primary":!1,"group-type":l.type,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","group-type","onClear","onRefresh"])]))),128))])],2))),128))])])):M("",!0),t.error?(c(),d("div",xf,[e[21]||(e[21]=s("h3",null,"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞",-1)),s("p",null,m(t.error),1),s("button",{onClick:e[1]||(e[1]=(...l)=>n.loadModules&&n.loadModules(...l)),class:"retry-btn","aria-label":"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):M("",!0),t.loading?(c(),d("div",If,[...e[22]||(e[22]=[s("div",{class:"loading-spinner","aria-hidden":"true"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞...",-1)])])):M("",!0)])}const Pf=J(af,[["render",Lf],["__scopeId","data-v-02719b2e"]]),Ff={name:"CacheManagementPage",components:{CacheManagement:Pf},beforeCreate(){console.log("[CacheManagementPage] beforeCreate() called")},created(){console.log("[CacheManagementPage] created() called")},beforeMount(){console.log("[CacheManagementPage] beforeMount() called")},setup(){console.log("[CacheManagementPage] setup() called with new hierarchical UI");const n=Ye(),e=p(!1),a=p(null),t=()=>{n.push({name:"index"})};return de(()=>{console.log("[CacheManagementPage] onMounted() called - hierarchical cache management ready")}),{loading:e,error:a,goBack:t}}},Uf={class:"cache-management-page"},Rf={class:"page-header"},Of={class:"page-header-top"},Nf={key:0,class:"loading"},Bf={key:1,class:"error"},Vf={key:2,class:"cache-content"};function jf(n,e,a,t,r,i){const o=W("CacheManagement");return c(),d("div",Uf,[s("div",Rf,[s("div",Of,[s("button",{onClick:e[0]||(e[0]=(...l)=>t.goBack&&t.goBack(...l)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[s("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),s("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=s("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1))]),t.loading?(c(),d("div",Nf," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–µ—à–∞... ")):t.error?(c(),d("div",Bf,m(t.error),1)):(c(),d("div",Vf,[K(o)]))])}const zf=J(Ff,[["render",jf],["__scopeId","data-v-a20ded38"]]),$f=[{path:"/install",name:"install",component:Cs},{path:"/",name:"index",component:Zs},{path:"/webhook-logs",name:"webhook-logs",redirect:"/admin/webhook-logs"},{path:"/admin/webhook-logs",name:"admin-webhook-logs",component:nr,meta:{requiresAuth:!0,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",adminOnly:!0}},{path:"/admin/users",name:"admin-users",component:Gm,meta:{requiresAuth:!0,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",adminOnly:!0}},{path:"/admin/cache",name:"admin-cache",component:zf,meta:{requiresAuth:!0,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",adminOnly:!0}},{path:"/dashboard/sector-1c",name:"dashboard-sector-1c",component:()=>ve(()=>import("./DashboardSector1C.vue-CrFGBEcl.js"),__vite__mapDeps([9,4,10,11,12,6,2,1,13,5]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector1c"}},{path:"/dashboard/graph-admission-closure",name:"dashboard-graph-admission-closure",component:()=>ve(()=>import("./GraphAdmissionClosureDashboard.vue-DIrWkbeF.js"),__vite__mapDeps([14,4,15,12,6,2,1,11,16,10,5]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–æ–≤—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",requiresAuth:!0,chunk:"admission-dashboard"}},{path:"/dashboard/graph-state",name:"dashboard-graph-state",component:()=>ve(()=>import("./GraphStateDashboard.vue-DQL3JiAL.js"),__vite__mapDeps([17,4,1,13,12,6,2,11,10,15,5]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏",requiresAuth:!0,chunk:"graph-state"}},{path:"/dashboard/tickets-time-tracking",name:"dashboard-tickets-time-tracking",component:()=>ve(()=>import("./TicketsTimeTrackingDashboard.vue-DrJxAyoq.js"),__vite__mapDeps([18,4,1,5,6,2]),import.meta.url),meta:{title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",requiresAuth:!0,chunk:"tickets-tracking"}}],st=es({history:ts(),routes:$f});st.beforeEach(async(n,e,a)=>{if(console.log("[Router] beforeEach:",{to:n.path,from:e.path,name:n.name}),n.meta.title&&(document.title=`${n.meta.title} - Bitrix24 Dashboard`),n.meta.requiresAuth){console.log("[Router] requiresAuth check for:",n.path);try{const t=await Oe.checkAccess();if(!t.allowed){console.warn("Unauthorized access attempt to:",n.path,t.errorMessage),a({name:"index"});return}}catch(t){console.error("Error checking access in navigation guard:",t),a();return}}if(n.meta.adminOnly)try{const t=await Oe.getCurrentUser();if(!t||!Ft(t)){console.warn("Admin access required for:",n.path),a({name:"index"});return}}catch(t){console.error("Error checking admin access in navigation guard:",t),a({name:"index"});return}if(e.name!==null&&n.path!==e.path)try{if((await Oe.checkAccess()).allowed){const r=await Oe.getCurrentUser();r&&Qe.logPageVisit(n,r,e).catch(i=>{console.error("[Router] Error logging page visit:",i)})}}catch(t){console.error("[Router] Error in activity logging:",t)}if(n.name==="index"&&!e.name&&setTimeout(()=>{ve(()=>import("./DashboardSector1C.vue-CrFGBEcl.js"),__vite__mapDeps([9,4,10,11,12,6,2,1,13,5]),import.meta.url)},1e3),n.meta.chunk)switch(n.meta.chunk){case"dashboard-sector1c":setTimeout(()=>{ve(()=>import("./dashboard-sector-1c-service-DF2NHvT_.js"),__vite__mapDeps([16,12,6,2,1,11]),import.meta.url)},500);break;case"admission-dashboard":setTimeout(()=>{ve(()=>import("./chunk-BhH35ey2.js").then(t=>t.l),__vite__mapDeps([2,1]),import.meta.url)},500);break}console.log("[Router] Allowing navigation to:",n.path),a()});setTimeout(()=>{const n=window.location.pathname,e=window.location.hash;e&&e!=="#/"||(n.includes("install.php")?st.replace("/install"):st.replace("/"))},0);Ue.register(ct,dt,St,Dt,Mt,Et,ut,mt,gt,At);Ue.defaults.responsive=!0;Ue.defaults.maintainAspectRatio=!1;Ue.defaults.plugins.legend.display=!0;Ue.defaults.plugins.legend.position="top";const Zf={primary:"#007bff",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8",carryover:"#ff9800",successLight:"#6cbf47",carryoverLight:"#ffb74d",carryoverDark:"#f57c00"};class et{static startBundleLoad(){this.metrics.bundleLoadTime=performance.now()}static endBundleLoad(e){const a=performance.now()-this.metrics.bundleLoadTime;this.metrics.chunkLoadTimes.set(e,a),console.log(`üì¶ Chunk "${e}" loaded in ${a.toFixed(2)}ms`),window.gtag&&window.gtag("event","bundle_load",{chunk_name:e,load_time:a}),a>1e3&&console.warn(`üêå Slow chunk load: ${e} took ${a.toFixed(2)}ms`)}static trackComponentLoad(e,a){const t=performance.now()-a;this.metrics.componentLoadTime.set(e,t),console.log(`üß© Component "${e}" loaded in ${t.toFixed(2)}ms`),t>500&&console.warn(`üêå Slow component load: ${e} took ${t.toFixed(2)}ms`)}static trackApiCall(e,a){this.metrics.apiResponseTime.set(e,a),a>1e3&&console.warn(`üêå Slow API call to ${e}: ${a}ms`)}static getReport(){const e=Array.from(this.metrics.componentLoadTime.values()),a=Array.from(this.metrics.apiResponseTime.values()),t=Array.from(this.metrics.chunkLoadTimes.values());return{totalChunks:this.metrics.chunkLoadTimes.size,totalComponents:this.metrics.componentLoadTime.size,totalApiCalls:this.metrics.apiResponseTime.size,averageComponentLoadTime:e.length>0?e.reduce((r,i)=>r+i,0)/e.length:0,averageApiResponseTime:a.length>0?a.reduce((r,i)=>r+i,0)/a.length:0,averageChunkLoadTime:t.length>0?t.reduce((r,i)=>r+i,0)/t.length:0,slowestComponents:Array.from(this.metrics.componentLoadTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i})),slowestApiCalls:Array.from(this.metrics.apiResponseTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({endpoint:r,time:i})),slowestChunks:Array.from(this.metrics.chunkLoadTimes.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i}))}}static clearMetrics(){this.metrics.bundleLoadTime=0,this.metrics.componentLoadTime.clear(),this.metrics.apiResponseTime.clear(),this.metrics.chunkLoadTimes.clear()}}Re(et,"metrics",{bundleLoadTime:0,componentLoadTime:new Map,apiResponseTime:new Map,chunkLoadTimes:new Map});class Wf{static init(){this.initChunkLoadErrorHandling(),this.initUnhandledErrorHandling(),this.initNetworkErrorHandling()}static initChunkLoadErrorHandling(){if(window.addEventListener("error",e=>{e.target.tagName==="SCRIPT"&&(console.error("‚ùå Chunk loading error:",e.target.src),this.reportError("chunk_load_error",{url:e.target.src,message:e.message||"Script load failed"}))}),"PerformanceObserver"in window)try{new PerformanceObserver(a=>{for(const t of a.getEntries())if(t.entryType==="resource"&&t.name.includes(".js")){const r=t.responseEnd-t.requestStart;et.trackApiCall(t.name,r)}}).observe({entryTypes:["resource"]})}catch{console.warn("PerformanceObserver not supported")}}static initUnhandledErrorHandling(){window.addEventListener("unhandledrejection",e=>{console.error("‚ùå Unhandled promise rejection:",e.reason),this.reportError("unhandled_rejection",{reason:e.reason?.message||String(e.reason),stack:e.reason?.stack})}),window.addEventListener("error",e=>{e.error&&e.filename&&(console.error("‚ùå Unhandled error:",e.error),this.reportError("unhandled_error",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error.stack}))})}static initNetworkErrorHandling(){const e=window.fetch;window.fetch=function(...a){const t=performance.now();return e.apply(this,a).then(r=>{const i=performance.now()-t;return et.trackApiCall(a[0],i),r.ok||console.warn(`üö® API error: ${r.status} ${r.statusText} for ${a[0]}`),r}).catch(r=>{const i=performance.now()-t;throw console.error(`‚ùå Network error for ${a[0]}:`,r),et.trackApiCall(a[0],i),this.reportError("network_error",{url:a[0],message:r.message,loadTime:i}),r})}}static reportError(e,a){const t={type:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...a};if(console.error("üìä Error report:",t),window.Sentry&&window.Sentry.captureException(new Error(`${e}: ${JSON.stringify(a)}`)),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:"/api/log-error.php",method:"POST",data:t})}catch(r){console.error("Failed to send error report to Bitrix24:",r)}window.gtag&&window.gtag("event","exception",{description:`${e}: ${a.message||"Unknown error"}`,fatal:!1})}static getErrorStats(){return{chunkLoadErrors:0,networkErrors:0,unhandledErrors:0,totalErrors:0}}}const pt=ss(is);pt.use(st);const Hf=n=>{try{const e=new WeakSet;return JSON.stringify(n,(a,t)=>{if(typeof t=="object"&&t!==null){if(e.has(t))return"[Circular]";e.add(t)}return typeof t=="function"||t===void 0?null:t})}catch{return String(n)}};pt.config.errorHandler=(n,e,a)=>{if(n instanceof TypeError&&n.message.includes("Cannot read properties of undefined (reading 'type')")){console.warn("Caught undefined.type error:",{error:n.message,component:e?.$options?.name||"Unknown",info:a,stack:n.stack});return}if(console.error("Vue error:",n,a),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:Te("/api/log-error.php"),method:"POST",data:{error:n?.message||String(n),info:typeof a=="string"?a:Hf(a),component:e?.$options?.name||"Unknown"}})}catch(t){console.error("Failed to log error:",t)}};pt.mount("#app");Wf.init();export{Oe as A,Ze as C,Lt as L,It as S,J as _,Ve as a,Pe as b,Zf as c,xe as d,ta as e,We as f,ft as g,Qf as h,Ft as i,$e as n,Ot as u};
