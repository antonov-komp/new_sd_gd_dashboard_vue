const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ticketListUtils-BDQyVj4-.js","assets/priority-config-TTAss2ev.js","assets/main-B-c1IQQf.js","assets/main-hkNOQW78.css","assets/priority-config-Bxxce_5E.css","assets/ticket-mapper-DuFI07ws.js"])))=>i.map(i=>d[i]);
var Pe=Object.defineProperty;var Fe=(T,s,t)=>s in T?Pe(T,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):T[s]=t;var ye=(T,s,t)=>Fe(T,typeof s!="symbol"?s+"":s,t);import{_ as ee,g as A,G as te,m as pe,H as Oe,f as X,o as l,j as O,k as q,a as u,d as j,b as e,y as ae,n as Q,B as K,I as Ve,c as F,J as U,K as He,t as C,F as Z,e as J,L as ve,M as Ye,x as xe,l as se,z as Re,r as Ne,S as Le,T as he,N as ke,O as Be}from"./main-B-c1IQQf.js";import{F as Ge}from"./FiltersPanel-CIetaAl2.js";import{L as ie,D as je,B as ze}from"./index-DJ8ntH2m.js";import{B as ne,g as Ue,a as qe,b as Me,D as Ze,T as me,c as _e}from"./priority-config-TTAss2ev.js";const Je={key:0,class:"modal-overlay"},Ke={class:"modal-container",role:"dialog","aria-labelledby":"modal-title","aria-modal":"true"},Qe={class:"modal-body"},Xe={class:"mode-description"},et={__name:"PeriodModeInfoModal",props:{isVisible:{type:Boolean,required:!0},currentMode:{type:String,default:"weeks",validator:T=>["weeks","months"].includes(T)}},emits:["close","start-loading","select-mode"],setup(T,{emit:s}){const t=T,d=s,k=A(t.currentMode);function m(c){if(!["weeks","months"].includes(c)){console.warn("[PeriodModeInfoModal] Invalid mode:",c);return}k.value=c,console.log("[DEBUG Modal] handleModeSelect: mode =",c),console.log("[DEBUG Modal] Emitting select-mode event"),d("select-mode",c),console.log("[DEBUG Modal] Emitting close event"),d("close"),console.log("[DEBUG Modal] Scheduling start-loading event in 100ms"),setTimeout(()=>{console.log("[DEBUG Modal] Emitting start-loading event"),d("start-loading")},100)}function W(){console.log("[DEBUG Modal] handleClose called, selectedMode =",k.value),console.log("[DEBUG Modal] Emitting select-mode event with",k.value),d("select-mode",k.value),console.log("[DEBUG Modal] Emitting close event"),d("close")}function y(c){c.key==="Escape"&&t.isVisible&&W()}return te(()=>t.currentMode,c=>{["weeks","months"].includes(c)&&(k.value=c)}),pe(()=>{t.isVisible&&document.addEventListener("keydown",y)}),Oe(()=>{document.removeEventListener("keydown",y)}),te(()=>t.isVisible,c=>{c?(document.addEventListener("keydown",y),k.value=t.currentMode):document.removeEventListener("keydown",y)}),(c,h)=>(l(),X(Ve,{to:"body"},[O(K,{name:"modal-fade"},{default:q(()=>[T.isVisible?(l(),u("div",Je,[e("div",Ke,[e("div",{class:"modal-header"},[h[2]||(h[2]=e("h2",{id:"modal-title",class:"modal-title"},[e("span",{class:"modal-icon"},"‚ÑπÔ∏è"),ae(" –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ")],-1)),e("button",{class:"modal-close-btn",onClick:W,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å",type:"button"}," √ó ")]),e("div",Qe,[h[5]||(h[5]=e("p",{class:"modal-description"}," –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π: ",-1)),e("div",Xe,[e("button",{class:Q(["mode-item mode-item--clickable",{"mode-item--selected":k.value==="weeks"}]),onClick:h[0]||(h[0]=p=>m("weeks")),type:"button"},[...h[3]||(h[3]=[e("div",{class:"mode-header"},[e("span",{class:"mode-icon"},"üìÖ"),e("h3",{class:"mode-title"},"4 –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ–¥–µ–ª–∏")],-1),e("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 –Ω–µ–¥–µ–ª–∏ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –Ω–µ–¥–µ–ª—è–º. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç–∏–∫–µ—Ç–æ–≤. ",-1)])],2),e("button",{class:Q(["mode-item mode-item--clickable",{"mode-item--selected":k.value==="months"}]),onClick:h[1]||(h[1]=p=>m("months")),type:"button"},[...h[4]||(h[4]=[e("div",{class:"mode-header"},[e("span",{class:"mode-icon"},"üìä"),e("h3",{class:"mode-title"},"3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—Ü–∞")],-1),e("p",{class:"mode-text"}," –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—Ü–µ–≤. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤. ",-1)])],2)])])])])):j("",!0)]),_:1})]))}},tt=ee(et,[["__scopeId","data-v-4a42a9a6"]]),st={class:"ac-chart"},at={class:"ac-chart__header"},rt={class:"ac-chart__subtitle"},ot={class:"ac-chart__controls"},lt={class:"chart-type-selector"},nt=["onClick"],it={class:"chart-type-icon"},dt={class:"chart-type-label"},ct={class:"ac-chart__summary"},ut={class:"summary-card__value"},kt={class:"summary-card__value-main"},vt={class:"summary-card__breakdown"},ht={class:"breakdown-item breakdown-item--this-week"},mt={class:"breakdown-item__value"},yt={class:"breakdown-item breakdown-item--other-week"},gt={class:"breakdown-item__value"},pt={class:"summary-card__value-main"},_t={class:"summary-card__breakdown"},ft={class:"breakdown-item breakdown-item--this-week"},bt={class:"breakdown-item__value"},wt={class:"breakdown-item breakdown-item--other-week"},Tt={class:"breakdown-item__value"},Ct={class:"summary-card summary-card--stages"},Dt={class:"summary-card__tags"},$t={key:0,class:"stage-tag stage-tag--empty"},Wt={class:"ac-chart__body"},Et={key:0,class:"split-charts-container"},It={class:"chart-wrapper chart-wrapper--left"},At={class:"chart-canvas-wrapper"},St={class:"chart-wrapper chart-wrapper--right"},Bt={class:"chart-canvas-wrapper"},Ut={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(T,{emit:s}){const t=T,d=s,k=[{value:"line",label:"–õ–∏–Ω–µ–π–Ω—ã–π",icon:"üìà"},{value:"bar",label:"–°—Ç–æ–ª–±—á–∞—Ç—ã–π",icon:"üìä"},{value:"doughnut",label:"–ö—Ä—É–≥–æ–≤–∞—è",icon:"üç©"}],m=A("line");F(()=>{var n;return((n=t.meta)==null?void 0:n.weekNumber)??"‚Äî"});const W=()=>{var i,b;const n=((i=t.meta)==null?void 0:i.weeks)||[];return n.length>0?n.map(S=>`–ù–µ–¥–µ–ª—è ${S.weekNumber}`):[(b=t.meta)!=null&&b.weekNumber?`–ù–µ–¥–µ–ª—è ${t.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"]};function y(n,i,b,S=.3,r=0){if(!i)return((G,V)=>{const v=parseInt(G.slice(1,3),16),a=parseInt(G.slice(3,5),16),o=parseInt(G.slice(5,7),16);return`rgba(${v}, ${a}, ${o}, ${V})`})(b,S);const g=(L,G)=>{const V=parseInt(L.slice(1,3),16),v=parseInt(L.slice(3,5),16),a=parseInt(L.slice(5,7),16);return`rgba(${V}, ${v}, ${a}, ${G})`},B=n.createLinearGradient(0,i.bottom,0,i.top);return B.addColorStop(0,g(b,S)),B.addColorStop(1,g(b,r)),B}const c=F(()=>{var g,B,L,G;const n=W(),i=Array.isArray((g=t.data.series)==null?void 0:g.new)&&t.data.series.new.length>0?t.data.series.new:[t.data.newTickets??0],b=Array.isArray((B=t.data.series)==null?void 0:B.closed)&&t.data.series.closed.length>0?t.data.series.closed:[t.data.closedTickets??0],S=Array.isArray((L=t.data.series)==null?void 0:L.closedCreatedThisWeek)&&t.data.series.closedCreatedThisWeek.length>0?t.data.series.closedCreatedThisWeek:[t.data.closedTicketsCreatedThisWeek??0],r=Array.isArray((G=t.data.series)==null?void 0:G.closedCreatedOtherWeek)&&t.data.series.closedCreatedOtherWeek.length>0?t.data.series.closedCreatedOtherWeek:[t.data.closedTicketsCreatedOtherWeek??0];return{labels:n,datasets:[{label:"–ù–æ–≤—ã–µ",data:i,backgroundColor:V=>{const v=V.chart,{ctx:a,chartArea:o}=v;return y(a,o,U.primary)},borderColor:U.primary,borderWidth:3,tension:.4,fill:!0,pointRadius:0,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointBackgroundColor:U.primary},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:b,backgroundColor:V=>{const v=V.chart,{ctx:a,chartArea:o}=v;return y(a,o,U.success)},borderColor:U.success,borderWidth:3,tension:.4,fill:!0,pointRadius:0,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointBackgroundColor:U.success},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:S,backgroundColor:U.successLight,borderColor:U.successLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:0,pointHoverRadius:4,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointBackgroundColor:U.successLight},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:r,backgroundColor:U.warning,borderColor:U.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:0,pointHoverRadius:4,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointBackgroundColor:U.warning}]}}),h=F(()=>{var r,g,B;const n=W(),i=Array.isArray((r=t.data.series)==null?void 0:r.carryover)&&t.data.series.carryover.length>0?t.data.series.carryover:[t.data.carryoverTickets??0],b=Array.isArray((g=t.data.series)==null?void 0:g.carryoverCreatedThisWeek)&&t.data.series.carryoverCreatedThisWeek.length>0?t.data.series.carryoverCreatedThisWeek:[t.data.carryoverTicketsCreatedThisWeek??0],S=Array.isArray((B=t.data.series)==null?void 0:B.carryoverCreatedOtherWeek)&&t.data.series.carryoverCreatedOtherWeek.length>0?t.data.series.carryoverCreatedOtherWeek:[t.data.carryoverTicketsCreatedOtherWeek??0];return{labels:n,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:i,backgroundColor:L=>{const G=L.chart,{ctx:V,chartArea:v}=G;return y(V,v,U.carryover)},borderColor:U.carryover,borderWidth:3,tension:.4,fill:!0,pointRadius:0,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointBackgroundColor:U.carryover},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:b,backgroundColor:U.carryoverLight,borderColor:U.carryoverLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:0,pointHoverRadius:4,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointBackgroundColor:U.carryoverLight},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:S,backgroundColor:U.carryoverDark,borderColor:U.carryoverDark,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:0,pointHoverRadius:4,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointBackgroundColor:U.carryoverDark}]}}),p=F(()=>{var V,v,a,o,E,M,P,f,Y;const n=((V=t.meta)==null?void 0:V.weeks)||[],i=n.length>0?n.map(x=>`–ù–µ–¥–µ–ª—è ${x.weekNumber}`):[(v=t.meta)!=null&&v.weekNumber?`–ù–µ–¥–µ–ª—è ${t.meta.weekNumber}`:"–ù–µ–¥–µ–ª—è"],b=Array.isArray((a=t.data.series)==null?void 0:a.new)&&t.data.series.new.length>0?t.data.series.new:[t.data.newTickets??0],S=Array.isArray((o=t.data.series)==null?void 0:o.closed)&&t.data.series.closed.length>0?t.data.series.closed:[t.data.closedTickets??0],r=Array.isArray((E=t.data.series)==null?void 0:E.closedCreatedThisWeek)&&t.data.series.closedCreatedThisWeek.length>0?t.data.series.closedCreatedThisWeek:[t.data.closedTicketsCreatedThisWeek??0],g=Array.isArray((M=t.data.series)==null?void 0:M.closedCreatedOtherWeek)&&t.data.series.closedCreatedOtherWeek.length>0?t.data.series.closedCreatedOtherWeek:[t.data.closedTicketsCreatedOtherWeek??0],B=Array.isArray((P=t.data.series)==null?void 0:P.carryover)&&t.data.series.carryover.length>0?t.data.series.carryover:[t.data.carryoverTickets??0],L=Array.isArray((f=t.data.series)==null?void 0:f.carryoverCreatedThisWeek)&&t.data.series.carryoverCreatedThisWeek.length>0?t.data.series.carryoverCreatedThisWeek:[t.data.carryoverTicketsCreatedThisWeek??0],G=Array.isArray((Y=t.data.series)==null?void 0:Y.carryoverCreatedOtherWeek)&&t.data.series.carryoverCreatedOtherWeek.length>0?t.data.series.carryoverCreatedOtherWeek:[t.data.carryoverTicketsCreatedOtherWeek??0];return{labels:i,datasets:[{label:"–ù–æ–≤—ã–µ",data:b,backgroundColor:U.primary,borderColor:U.primary,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (–≤—Å–µ)",data:S,backgroundColor:U.success,borderColor:U.success,tension:.3,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:r,backgroundColor:U.successLight,borderColor:U.successLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:g,backgroundColor:U.warning,borderColor:U.warning,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (–≤—Å–µ)",data:B,backgroundColor:U.carryover,borderColor:U.carryover,tension:.3,fill:!1},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:L,backgroundColor:U.carryoverLight,borderColor:U.carryoverLight,tension:.3,fill:!1,borderDash:[5,5]},{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ (—Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π)",data:G,backgroundColor:U.carryoverDark,borderColor:U.carryoverDark,tension:.3,fill:!1,borderDash:[5,5]}]}}),D=F(()=>({labels:["–ù–æ–≤—ã–µ","–ó–∞–∫—Ä—ã—Ç—ã–µ","–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ"],datasets:[{data:[t.data.newTickets??0,t.data.closedTickets??0,t.data.carryoverTickets??0],backgroundColor:[U.primary,U.success,U.carryover],borderWidth:1}]})),w=F(()=>{switch(m.value){case"line":return ie;case"bar":return ze;case"doughnut":return je;default:return ie}}),I=F(()=>m.value==="doughnut"?D.value:p.value),z=n=>{if(!n)return"‚Äî";try{return new Date(n).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return n}};function R(n){return n==null||isNaN(n)?"0":n>=1e3?n.toLocaleString("ru-RU"):n.toString()}function N(n){const i=n%10,b=n%100;return b>=11&&b<=14?"—Ç–∏–∫–µ—Ç–æ–≤":i===1?"—Ç–∏–∫–µ—Ç":i>=2&&i<=4?"—Ç–∏–∫–µ—Ç–∞":"—Ç–∏–∫–µ—Ç–æ–≤"}const $=F(()=>({responsive:!0,maintainAspectRatio:!1,resizeDelay:0,animation:{duration:800,easing:"easeOutQuart"},interaction:{intersect:!1,mode:"index"},plugins:{tooltip:{enabled:!0,backgroundColor:"rgba(255, 255, 255, 0.98)",titleColor:"#111827",bodyColor:"#374151",borderColor:"#e5e7eb",borderWidth:1,cornerRadius:8,padding:16,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},displayColors:!0,boxPadding:6,usePointStyle:!0,animation:{duration:300,easing:"easeOutQuart"},callbacks:{title:n=>{var B,L,G,V,v,a;if(!n||n.length===0)return"";const i=(B=n[0])==null?void 0:B.dataIndex,b=((L=t.meta)==null?void 0:L.weeks)||[];if(b.length>0&&i!==void 0&&b[i]){const o=b[i];return`–ù–µ–¥–µ–ª—è ${o.weekNumber} (${z(o.weekStartUtc)} ‚Äî ${z(o.weekEndUtc)})`}const S=(G=t.meta)==null?void 0:G.weekNumber,r=(V=t.meta)==null?void 0:V.weekStartUtc,g=(v=t.meta)==null?void 0:v.weekEndUtc;return S&&r&&g?`–ù–µ–¥–µ–ª—è ${S} (${z(r)} ‚Äî ${z(g)})`:((a=n[0])==null?void 0:a.label)||""},label:n=>{const i=n.parsed.y,b=n.dataset.label||"";if(i==null||isNaN(i))return`${b}: 0 —Ç–∏–∫–µ—Ç–æ–≤`;const S=R(i),r=N(i);return`${b}: ${S} ${r}`}}},legend:{position:"bottom",labels:{font:{size:13,weight:"500"},padding:12,boxWidth:18,boxHeight:12,usePointStyle:!0,pointStyle:"circle",generateLabels:n=>He.defaults.plugins.legend.labels.generateLabels(n).map((b,S)=>{const r=n.data.datasets[S],g=n.getDatasetMeta(S),B=r.borderDash&&Array.isArray(r.borderDash)&&r.borderDash.length>0||r.borderWidth===2||r.fill===!1;return g.hidden?(b.fontColor="#9ca3af",b.textDecoration="line-through",b.opacity=.5):B?b.fontColor="#6b7280":b.fontColor="#111827",b})},onClick:(n,i)=>{const b=i.datasetIndex;if(b==null){console.warn("[Legend] Invalid datasetIndex:",b);return}const S=n.chart;if(!S){console.warn("[Legend] Chart not found");return}const r=S.getDatasetMeta(b);if(!r){console.warn("[Legend] Dataset meta not found for index:",b);return}r.hidden=!r.hidden,S.update("active")},onHover:(n,i)=>{n.native&&n.native.target&&(n.native.target.style.cursor="pointer")},onLeave:(n,i)=>{n.native&&n.native.target&&(n.native.target.style.cursor="default")}}},scales:m.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10,color:"#374151",callback:n=>n==null||isNaN(n)?"0":R(n)},title:{display:!1},grid:{color:n=>{if(!n||!n.tick||n.tick.value===void 0)return"#e5e7eb";const i=n.tick.value;return isNaN(i)||!isFinite(i)?"#e5e7eb":i===0||i%5===0?"#d1d5db":"#e5e7eb"},lineWidth:n=>{if(!n||!n.tick||n.tick.value===void 0)return 1;const i=n.tick.value;return isNaN(i)||!isFinite(i)?1:i===0||i%5===0?1.5:1}}},x:{ticks:{maxRotation:45,minRotation:45,font:{size:14},padding:10,color:"#374151"},title:{display:!1},grid:{color:"#e5e7eb",lineWidth:1}}}})),_=F(()=>{var n,i,b,S;if((n=t.data)!=null&&n.series){const r=t.data.series,g=Math.max((Array.isArray(r.new)?r.new.length:0)-1,(Array.isArray(r.closed)?r.closed.length:0)-1,(Array.isArray(r.carryover)?r.carryover.length:0)-1,-1);if(g>=0){const B={newTickets:Array.isArray(r.new)&&r.new[g]!==void 0?r.new[g]:0,closedTickets:Array.isArray(r.closed)&&r.closed[g]!==void 0?r.closed[g]:0,closedTicketsCreatedThisWeek:Array.isArray(r.closedCreatedThisWeek)&&r.closedCreatedThisWeek[g]!==void 0?r.closedCreatedThisWeek[g]:0,closedTicketsCreatedOtherWeek:Array.isArray(r.closedCreatedOtherWeek)&&r.closedCreatedOtherWeek[g]!==void 0?r.closedCreatedOtherWeek[g]:0,carryoverTickets:Array.isArray(r.carryover)&&r.carryover[g]!==void 0?r.carryover[g]:0,carryoverTicketsCreatedThisWeek:Array.isArray(r.carryoverCreatedThisWeek)&&r.carryoverCreatedThisWeek[g]!==void 0?r.carryoverCreatedThisWeek[g]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(r.carryoverCreatedOtherWeek)&&r.carryoverCreatedOtherWeek[g]!==void 0?r.carryoverCreatedOtherWeek[g]:0};if(B.newTickets>0||B.closedTickets>0||B.carryoverTickets>0)return B}}if((i=t.data)!=null&&i.currentWeek&&typeof t.data.currentWeek=="object"){const r=t.data.currentWeek;if((r.newTickets??0)>0||(r.closedTickets??0)>0||(r.carryoverTickets??0)>0)return r}if((b=t.data)!=null&&b.weeksData&&Array.isArray(t.data.weeksData)&&t.data.weeksData.length>0){const r=t.data.weeksData[t.data.weeksData.length-1];if((r.newTickets??0)>0||(r.closedTickets??0)>0||(r.carryoverTickets??0)>0)return r}if((S=t.data)!=null&&S.series){const r=t.data.series,g=Math.max((Array.isArray(r.new)?r.new.length:0)-1,(Array.isArray(r.closed)?r.closed.length:0)-1,(Array.isArray(r.carryover)?r.carryover.length:0)-1,-1);if(g>=0)return{newTickets:Array.isArray(r.new)&&r.new[g]!==void 0?r.new[g]:0,closedTickets:Array.isArray(r.closed)&&r.closed[g]!==void 0?r.closed[g]:0,closedTicketsCreatedThisWeek:Array.isArray(r.closedCreatedThisWeek)&&r.closedCreatedThisWeek[g]!==void 0?r.closedCreatedThisWeek[g]:0,closedTicketsCreatedOtherWeek:Array.isArray(r.closedCreatedOtherWeek)&&r.closedCreatedOtherWeek[g]!==void 0?r.closedCreatedOtherWeek[g]:0,carryoverTickets:Array.isArray(r.carryover)&&r.carryover[g]!==void 0?r.carryover[g]:0,carryoverTicketsCreatedThisWeek:Array.isArray(r.carryoverCreatedThisWeek)&&r.carryoverCreatedThisWeek[g]!==void 0?r.carryoverCreatedThisWeek[g]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(r.carryoverCreatedOtherWeek)&&r.carryoverCreatedOtherWeek[g]!==void 0?r.carryoverCreatedOtherWeek[g]:0}}return t.data||{}}),H=n=>{var g;const i=_.value,b=(i==null?void 0:i.newTickets)??0,S=(i==null?void 0:i.closedTickets)??0,r=(i==null?void 0:i.carryoverTickets)??0;n==="new"&&b>0?d("open-stages"):n==="closed"&&S>0?(((g=t.data)==null?void 0:g.responsible)||[]).length>0&&d("open-responsible"):n==="carryover"&&r>0&&d("open-carryover")};return(n,i)=>{var b,S,r,g,B,L,G,V,v,a,o,E,M,P,f,Y;return l(),u("div",st,[e("header",at,[e("div",null,[i[3]||(i[3]=e("h2",{class:"ac-chart__title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),e("p",rt," –ù–µ–¥–µ–ª—è "+C(((S=(b=T.meta)==null?void 0:b.currentWeek)==null?void 0:S.weekNumber)??((r=T.meta)==null?void 0:r.weekNumber)??"‚Äî")+" ¬∑ "+C((((B=(g=T.meta)==null?void 0:g.currentWeek)==null?void 0:B.weekStartUtc)??((L=T.meta)==null?void 0:L.weekStartUtc))||"‚Äî")+" ‚Äî "+C((((V=(G=T.meta)==null?void 0:G.currentWeek)==null?void 0:V.weekEndUtc)??((v=T.meta)==null?void 0:v.weekEndUtc))||"‚Äî")+" (UTC) ",1)]),e("div",ot,[e("div",lt,[(l(),u(Z,null,J(k,x=>e("button",{key:x.value,class:Q(["chart-type-btn",{active:m.value===x.value}]),onClick:le=>m.value=x.value},[e("span",it,C(x.icon),1),e("span",dt,C(x.label),1)],10,nt)),64))])])]),e("section",ct,[e("div",{class:"summary-card summary-card--new",onClick:i[0]||(i[0]=x=>H("new"))},[i[4]||(i[4]=e("div",{class:"summary-card__label"},"–ù–æ–≤—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),e("div",ut,C(((a=_.value)==null?void 0:a.newTickets)??0),1)]),e("div",{class:"summary-card summary-card--closed-breakdown",onClick:i[1]||(i[1]=x=>H("closed"))},[i[9]||(i[9]=e("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),e("div",kt,C(((o=_.value)==null?void 0:o.closedTickets)??0),1),e("div",vt,[e("div",ht,[i[5]||(i[5]=e("span",{class:"breakdown-item__icon"},"‚úì",-1)),e("span",mt,C(((E=_.value)==null?void 0:E.closedTicketsCreatedThisWeek)??0),1),i[6]||(i[6]=e("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))]),e("div",yt,[i[7]||(i[7]=e("span",{class:"breakdown-item__icon"},"‚Üª",-1)),e("span",gt,C(((M=_.value)==null?void 0:M.closedTicketsCreatedOtherWeek)??0),1),i[8]||(i[8]=e("span",{class:"breakdown-item__label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π",-1))])])]),e("div",{class:"summary-card summary-card--carryover-breakdown",onClick:i[2]||(i[2]=x=>H("carryover"))},[i[14]||(i[14]=e("div",{class:"summary-card__label"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),e("div",pt,C(((P=_.value)==null?void 0:P.carryoverTickets)??0),1),e("div",_t,[e("div",ft,[i[10]||(i[10]=e("span",{class:"breakdown-item__icon"},"‚úì",-1)),e("span",bt,C(((f=_.value)==null?void 0:f.carryoverTicketsCreatedThisWeek)??0),1),i[11]||(i[11]=e("span",{class:"breakdown-item__label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏",-1))]),e("div",wt,[i[12]||(i[12]=e("span",{class:"breakdown-item__icon"},"‚Üª",-1)),e("span",Tt,C(((Y=_.value)==null?void 0:Y.carryoverTicketsCreatedOtherWeek)??0),1),i[13]||(i[13]=e("span",{class:"breakdown-item__label"},"–ø—Ä–µ–¥—ã–¥—É—â–∏—Ö",-1))])])]),e("div",Ct,[i[15]||(i[15]=e("div",{class:"summary-card__label"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),e("div",Dt,[(l(!0),u(Z,null,J(T.data.stages||[],x=>(l(),u("span",{key:x.stageId,class:"stage-tag"},C(x.stageName||x.stageId)+" ‚Äî "+C(x.count),1))),128)),!T.data.stages||T.data.stages.length===0?(l(),u("span",$t," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):j("",!0)])])]),e("div",Wt,[m.value==="line"?(l(),u("div",Et,[e("div",It,[i[16]||(i[16]=e("h3",{class:"chart-subtitle"},"–ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",At,[O(ve(ie),{data:c.value,options:$.value},null,8,["data","options"])])]),e("div",St,[i[17]||(i[17]=e("h3",{class:"chart-subtitle"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",Bt,[O(ve(ie),{data:h.value,options:$.value},null,8,["data","options"])])])])):(l(),X(Ye(w.value),{key:1,data:I.value,options:$.value},null,8,["data","options"]))])])}}},Mt=ee(Ut,[["__scopeId","data-v-b9d17a07"]]),Ot={class:"summary-cards-months"},Rt={class:"summary-card summary-card--new"},Nt={class:"card-content"},Lt={class:"card-main-value"},Gt={class:"card-month-breakdown"},Pt={class:"month-name"},Ft={class:"month-value"},Vt={key:0,class:"month-item month-item--empty"},Ht={class:"summary-card summary-card--closed"},Yt={class:"card-content"},xt={class:"card-main-value"},jt={class:"card-month-breakdown-hierarchical"},zt={class:"month-header"},qt={class:"month-name"},Zt={class:"month-value"},Jt={class:"month-breakdown"},Kt={class:"breakdown-item breakdown-this-week"},Qt={class:"breakdown-value"},Xt={class:"breakdown-item breakdown-other-week"},es={class:"breakdown-value"},ts={key:0,class:"month-item-hierarchical month-item--empty"},ss={class:"summary-card summary-card--carryover"},as={class:"card-content"},rs={class:"card-main-value"},os={class:"card-month-breakdown"},ls={class:"month-name"},ns={class:"month-value"},is={key:0,class:"month-item month-item--empty"},ds={class:"summary-card summary-card--stages"},cs={class:"card-content"},us={class:"stages-list"},ks={class:"stage-icon"},vs={class:"stage-name"},hs={class:"stage-value"},ms={key:0,class:"stage-item stage-item--empty"},ys={__name:"SummaryCardsMonths",props:{data:{type:Object,required:!0,default:()=>({newTickets:0,newTicketsByMonth:[],closedTickets:0,closedTicketsByMonth:[],carryoverTickets:0,carryoverTicketsByMonth:[],stages:[]})}},setup(T){const s=T;function t(p){return p==null||isNaN(p)?"0":p>=1e6?(p/1e6).toFixed(1)+"M":p>=1e3?p.toLocaleString("ru-RU"):p.toString()}const d=F(()=>{var p;return((p=s.data)==null?void 0:p.newTickets)||0}),k=F(()=>t(d.value)),m=F(()=>{var p;return((p=s.data)==null?void 0:p.newTicketsByMonth)||[]}),W=F(()=>{var p;return((p=s.data)==null?void 0:p.closedTicketsByMonth)||[]}),y=F(()=>{var p;return((p=s.data)==null?void 0:p.carryoverTicketsByMonth)||[]});function c(p){return{"DT140_12:SUCCESS":"stage-success","DT140_12:FAIL":"stage-fail","DT140_12:UC_0GBU8Z":"stage-other"}[p]||""}function h(p){return{"DT140_12:SUCCESS":"‚úì","DT140_12:FAIL":"‚úó","DT140_12:UC_0GBU8Z":"‚ö†"}[p]||"‚Ä¢"}return(p,D)=>(l(),u("div",Ot,[e("div",Rt,[D[0]||(D[0]=e("h3",{class:"card-title"},"–ù–æ–≤—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥",-1)),e("div",Nt,[e("div",Lt,C(k.value),1),e("div",Gt,[(l(!0),u(Z,null,J(m.value,w=>(l(),u("div",{key:`new-${w.month}`,class:"month-item"},[e("span",Pt,C(w.monthName)+":",1),e("span",Ft,C(t(w.count)),1)]))),128)),m.value.length===0?(l(),u("div",Vt," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):j("",!0)])])]),e("div",Ht,[D[5]||(D[5]=e("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç—ã–µ –≤—Å–µ–≥–æ",-1)),e("div",Yt,[e("div",xt,C(t(T.data.closedTickets||0)),1),e("div",jt,[(l(!0),u(Z,null,J(W.value,w=>(l(),u("div",{key:`closed-${w.month}`,class:"month-item-hierarchical"},[e("div",zt,[e("span",qt,C(w.monthName)+":",1),e("span",Zt,C(t(w.count||0)),1)]),e("div",Jt,[e("div",Kt,[D[1]||(D[1]=e("span",{class:"breakdown-icon"},"‚úì",-1)),D[2]||(D[2]=e("span",{class:"breakdown-label"},"—ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π:",-1)),e("span",Qt,C(t(w.closedCreatedThisWeek||0)),1)]),e("div",Xt,[D[3]||(D[3]=e("span",{class:"breakdown-icon"},"‚Üª",-1)),D[4]||(D[4]=e("span",{class:"breakdown-label"},"–¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ–π:",-1)),e("span",es,C(t(w.closedCreatedOtherWeek||0)),1)])])]))),128)),W.value.length===0?(l(),u("div",ts," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):j("",!0)])])]),e("div",ss,[D[6]||(D[6]=e("h3",{class:"card-title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ –≤—Å–µ–≥–æ",-1)),e("div",as,[e("div",rs,C(t(T.data.carryoverTickets||0)),1),e("div",os,[(l(!0),u(Z,null,J(y.value,w=>(l(),u("div",{key:`carryover-${w.month}`,class:"month-item"},[e("span",ls,C(w.monthName)+":",1),e("span",ns,C(t(w.count||0)),1)]))),128)),y.value.length===0?(l(),u("div",is," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ")):j("",!0)])])]),e("div",ds,[D[8]||(D[8]=e("h3",{class:"card-title"},"–ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),e("div",cs,[e("div",us,[(l(!0),u(Z,null,J(T.data.stages||[],w=>(l(),u("div",{key:w.stageId,class:Q(["stage-item",c(w.stageId)])},[e("span",ks,C(h(w.stageId)),1),e("span",vs,C(w.stageName||w.stageId)+":",1),e("span",hs,C(t(w.count||0)),1)],2))),128)),!T.data.stages||T.data.stages.length===0?(l(),u("div",ms,[...D[7]||(D[7]=[e("span",{class:"stage-name"},"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö",-1)])])):j("",!0)])])])]))}},gs=ee(ys,[["__scopeId","data-v-7325e15b"]]),ps={class:"line-chart-months"},_s={class:"chart-section"},fs={class:"chart-container"},bs={class:"chart-section"},ws={class:"chart-container"},Ts={class:"chart-table-section"},Cs={class:"chart-table-wrapper"},Ds={class:"data-table"},$s={class:"data-row data-row--new"},Ws={class:"data-row data-row--closed"},Es={class:"data-row data-row--carryover"},Is={__name:"LineChartMonths",props:{data:{type:Object,required:!0,default:()=>({newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]})},meta:{type:Object,default:()=>({months:[]})}},setup(T){const s=T;function t(c){return c==null||isNaN(c)?"0":c>=1e3?c.toLocaleString("ru-RU"):c.toString()}const d=F(()=>{var h,p,D;const c=new Set;return(h=s.data.newTicketsByMonth)==null||h.forEach(w=>{w.weeks&&Array.isArray(w.weeks)&&w.weeks.forEach(I=>{I&&I.weekNumber&&c.add(I.weekNumber)})}),(p=s.data.closedTicketsByMonth)==null||p.forEach(w=>{w.weeks&&Array.isArray(w.weeks)&&w.weeks.forEach(I=>{I&&I.weekNumber&&c.add(I.weekNumber)})}),(D=s.data.carryoverTicketsByMonth)==null||D.forEach(w=>{w.weeks&&Array.isArray(w.weeks)&&w.weeks.forEach(I=>{I&&I.weekNumber&&c.add(I.weekNumber)})}),Array.from(c).sort((w,I)=>w-I)}),k=F(()=>{const c=s.data.newTicketsByMonth||[],h=c.map(w=>w.monthName||`–ú–µ—Å—è—Ü ${w.month}`),p=c.map(w=>w.count||0),D=(s.data.closedTicketsByMonth||[]).map(w=>w.count||0);return{labels:h,datasets:[{label:"–ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã",data:p,borderColor:U.primary,backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4,fill:!1},{label:"–ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",data:D,borderColor:U.success,backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4,fill:!1}]}}),m=F(()=>{const c=s.data.carryoverTicketsByMonth||[],h=c.map(D=>D.monthName||`–ú–µ—Å—è—Ü ${D.month}`),p=c.map(D=>D.count||0);return{labels:h,datasets:[{label:"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",data:p,borderColor:U.carryover,backgroundColor:"rgba(255, 152, 0, 0.1)",tension:.4,fill:!1}]}}),W={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{font:{size:14,weight:"500"},padding:16,boxWidth:20,boxHeight:12}},tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12}},scales:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:0,minRotation:0,font:{size:14},padding:10},grid:{lineWidth:1.5}}}};function y(c,h){let p=[];switch(c){case"new":p=s.data.newTicketsByMonth||[];break;case"closed":p=s.data.closedTicketsByMonth||[];break;case"carryover":p=s.data.carryoverTicketsByMonth||[];break;default:return"-"}for(const D of p){if(!D.weeks||!Array.isArray(D.weeks))continue;const w=D.weeks.find(I=>I&&I.weekNumber===h);if(w){const I=w.count||0;return I>0?t(I):"-"}}return"-"}return(c,h)=>(l(),u("div",ps,[e("div",_s,[h[0]||(h[0]=e("h3",{class:"chart-title"},"–ù–æ–≤—ã–µ –∏ –ó–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",fs,[O(ve(ie),{data:k.value,options:W},null,8,["data"])])]),e("div",bs,[h[1]||(h[1]=e("h3",{class:"chart-title"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã",-1)),e("div",ws,[O(ve(ie),{data:m.value,options:W},null,8,["data"])])]),e("div",Ts,[h[6]||(h[6]=e("h3",{class:"chart-title"},"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –Ω–µ–¥–µ–ª—è–º",-1)),e("div",Cs,[e("table",Ds,[e("thead",null,[e("tr",null,[h[2]||(h[2]=e("th",{class:"month-header-cell"},"–ú–µ—Å—è—Ü",-1)),(l(!0),u(Z,null,J(d.value,p=>(l(),u("th",{key:`week-${p}`,class:"week-header-cell"}," –ù–µ–¥–µ–ª—è "+C(p),1))),128))])]),e("tbody",null,[e("tr",$s,[h[3]||(h[3]=e("td",{class:"data-type-cell"},"–ù–æ–≤—ã–µ",-1)),(l(!0),u(Z,null,J(d.value,p=>(l(),u("td",{key:`new-${p}`,class:"week-data-cell"},C(y("new",p)),1))),128))]),e("tr",Ws,[h[4]||(h[4]=e("td",{class:"data-type-cell"},"–ó–∞–∫—Ä—ã—Ç—ã–µ",-1)),(l(!0),u(Z,null,J(d.value,p=>(l(),u("td",{key:`closed-${p}`,class:"week-data-cell"},C(y("closed",p)),1))),128))]),e("tr",Es,[h[5]||(h[5]=e("td",{class:"data-type-cell"},"–ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ",-1)),(l(!0),u(Z,null,J(d.value,p=>(l(),u("td",{key:`carryover-${p}`,class:"week-data-cell"},C(y("carryover",p)),1))),128))])])])])])]))}},As=ee(Is,[["__scopeId","data-v-f048a2de"]]),Ss={class:"months-preloader"},Bs={class:"preloader-content"},Us={class:"progress-container"},Ms={class:"progress-bar"},Os={class:"progress-text"},Rs={class:"preloader-message"},Ns={class:"stages-list"},Ls={class:"stage-icon"},Gs={class:"stage-text"},Ps={__name:"MonthsModePreloader",props:{progress:{type:Number,required:!0,validator:T=>T>=0&&T<=100},currentStage:{type:String,default:""}},setup(T){const s=T,t=[{label:"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",threshold:10},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –æ–∫—Ç—è–±—Ä—å...",threshold:40},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –Ω–æ—è–±—Ä—å...",threshold:70},{label:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –¥–µ–∫–∞–±—Ä—å...",threshold:90},{label:"–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...",threshold:95},{label:"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",threshold:100}];function d(m){return s.progress>=t[m].threshold}function k(m){const W=t[m].threshold,y=m>0?t[m-1].threshold:0;return s.progress>=y&&s.progress<W}return(m,W)=>(l(),u("div",Ss,[e("div",Bs,[W[0]||(W[0]=xe('<div class="preloader-spinner" data-v-23ab71eb><div class="spinner-ring" data-v-23ab71eb></div><div class="spinner-ring" data-v-23ab71eb></div><div class="spinner-ring" data-v-23ab71eb></div></div><h3 class="preloader-title" data-v-23ab71eb>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 3 –º–µ—Å—è—Ü–∞</h3>',2)),e("div",Us,[e("div",Ms,[e("div",{class:"progress-fill",style:se({width:`${T.progress}%`})},null,4)]),e("div",Os,C(Math.round(T.progress))+"%",1)]),e("p",Rs,C(T.currentStage),1),e("div",Ns,[(l(),u(Z,null,J(t,(y,c)=>e("div",{key:c,class:Q(["stage-item",{"stage-completed":d(c),"stage-current":k(c)}])},[e("span",Ls,C(d(c)?"‚úì":k(c)?"‚Üí":"‚óã"),1),e("span",Gs,C(y.label),1)],2)),64))])])]))}},Fs=ee(Ps,[["__scopeId","data-v-23ab71eb"]]),Vs="/api/graph-1c-admission-closure.php";function Hs(T){var d,k,m,W,y,c,h,p,D,w,I,z,R,N,$,_,H,n,i,b,S,r,g,B,L,G,V,v,a,o,E,M,P,f,Y,x,le,de,ce,ue,re,fe,be,we,Te,Ce,De,$e,We,Ee,Ie,Ae,Se;if(!T)return{meta:null,data:{currentWeek:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0},newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedOtherWeek:[0]},weeksData:[],stages:[],responsible:[],responsibleCreatedThisWeek:[],responsibleCreatedOtherWeek:[]}};const s=T.data||T.result||T,t=s.meta||T.meta||null;return{meta:{...t,currentWeek:(t==null?void 0:t.currentWeek)||(t?{weekNumber:t.weekNumber,weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc}:null),weeks:(t==null?void 0:t.weeks)||[]},data:{currentWeek:((d=s.data)==null?void 0:d.currentWeek)||(s.data?{newTickets:s.data.newTickets??0,closedTickets:s.data.closedTickets??0,closedTicketsCreatedThisWeek:s.data.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:s.data.closedTicketsCreatedOtherWeek??0,carryoverTickets:s.data.carryoverTickets??0,carryoverTicketsCreatedThisWeek:s.data.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:s.data.carryoverTicketsCreatedOtherWeek??0}:{newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedOtherWeek:0}),newTickets:((m=(k=s.data)==null?void 0:k.currentWeek)==null?void 0:m.newTickets)??((W=s.data)==null?void 0:W.newTickets)??s.newTickets??0,closedTickets:((c=(y=s.data)==null?void 0:y.currentWeek)==null?void 0:c.closedTickets)??((h=s.data)==null?void 0:h.closedTickets)??s.closedTickets??0,closedTicketsCreatedThisWeek:((D=(p=s.data)==null?void 0:p.currentWeek)==null?void 0:D.closedTicketsCreatedThisWeek)??((w=s.data)==null?void 0:w.closedTicketsCreatedThisWeek)??s.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:((z=(I=s.data)==null?void 0:I.currentWeek)==null?void 0:z.closedTicketsCreatedOtherWeek)??((R=s.data)==null?void 0:R.closedTicketsCreatedOtherWeek)??s.closedTicketsCreatedOtherWeek??0,carryoverTickets:(($=(N=s.data)==null?void 0:N.currentWeek)==null?void 0:$.carryoverTickets)??((_=s.data)==null?void 0:_.carryoverTickets)??s.carryoverTickets??0,carryoverTicketsCreatedThisWeek:((n=(H=s.data)==null?void 0:H.currentWeek)==null?void 0:n.carryoverTicketsCreatedThisWeek)??((i=s.data)==null?void 0:i.carryoverTicketsCreatedThisWeek)??s.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:((S=(b=s.data)==null?void 0:b.currentWeek)==null?void 0:S.carryoverTicketsCreatedOtherWeek)??((r=s.data)==null?void 0:r.carryoverTicketsCreatedOtherWeek)??s.carryoverTicketsCreatedOtherWeek??0,series:{new:((B=(g=s.data)==null?void 0:g.series)==null?void 0:B.new)??((L=s.series)==null?void 0:L.new)??[0],closed:((V=(G=s.data)==null?void 0:G.series)==null?void 0:V.closed)??((v=s.series)==null?void 0:v.closed)??[0],closedCreatedThisWeek:((o=(a=s.data)==null?void 0:a.series)==null?void 0:o.closedCreatedThisWeek)??((E=s.series)==null?void 0:E.closedCreatedThisWeek)??[0],closedCreatedOtherWeek:((P=(M=s.data)==null?void 0:M.series)==null?void 0:P.closedCreatedOtherWeek)??((f=s.series)==null?void 0:f.closedCreatedOtherWeek)??[0],carryover:((x=(Y=s.data)==null?void 0:Y.series)==null?void 0:x.carryover)??((le=s.series)==null?void 0:le.carryover)??[0],carryoverCreatedThisWeek:((ce=(de=s.data)==null?void 0:de.series)==null?void 0:ce.carryoverCreatedThisWeek)??((ue=s.series)==null?void 0:ue.carryoverCreatedThisWeek)??[0],carryoverCreatedOtherWeek:((fe=(re=s.data)==null?void 0:re.series)==null?void 0:fe.carryoverCreatedOtherWeek)??((be=s.series)==null?void 0:be.carryoverCreatedOtherWeek)??[0]},weeksData:((we=s.data)==null?void 0:we.weeksData)??s.weeksData??[],stages:((Te=s.data)==null?void 0:Te.stages)??s.stages??[],responsible:((Ce=s.data)==null?void 0:Ce.responsible)??s.responsible??[],responsibleCreatedThisWeek:((De=s.data)==null?void 0:De.responsibleCreatedThisWeek)??s.responsibleCreatedThisWeek??[],responsibleCreatedOtherWeek:(($e=s.data)==null?void 0:$e.responsibleCreatedOtherWeek)??s.responsibleCreatedOtherWeek??[],newTicketsByStages:((We=s.data)==null?void 0:We.newTicketsByStages)??s.newTicketsByStages??null,carryoverTicketsByDuration:((Ee=s.data)==null?void 0:Ee.carryoverTicketsByDuration)??s.carryoverTicketsByDuration??null,newTicketsByMonth:((Ie=s.data)==null?void 0:Ie.newTicketsByMonth)??s.newTicketsByMonth??[],closedTicketsByMonth:((Ae=s.data)==null?void 0:Ae.closedTicketsByMonth)??s.closedTicketsByMonth??[],carryoverTicketsByMonth:((Se=s.data)==null?void 0:Se.carryoverTicketsByMonth)??s.carryoverTicketsByMonth??[]}}}async function oe(T={}){const{endpoint:s=Vs,product:t="1C",weekStartUtc:d=null,weekEndUtc:k=null,periodMode:m="weeks",useCache:W=!0,forceRefresh:y=!1,includeTickets:c=!1,includeNewTicketsByStages:h=!1,includeCarryoverTickets:p=!0,includeCarryoverTicketsByDuration:D=!1}=T,I=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({product:t,weekStartUtc:d,weekEndUtc:k,periodMode:m,useCache:W,forceRefresh:y,includeTickets:c,includeNewTicketsByStages:h,includeCarryoverTickets:p,includeCarryoverTicketsByDuration:D})});if(!I.ok)throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (${I.status})`);const z=await I.json();if((z==null?void 0:z.success)===!1)throw new Error(z.message||"–ë—ç–∫–µ–Ω–¥ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É");return Hs(z)}const Ys={class:"ac-dashboard-months"},xs={key:"content"},js={class:"dashboard-header"},zs={class:"header-content"},qs={class:"breadcrumbs-row"},Zs=["aria-label","aria-disabled","data-fallback","disabled"],Js={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Ks={class:"dashboard-layout"},Qs={class:"filters-container"},Xs={class:"chart-container"},ea={__name:"GraphAdmissionClosureMonthsDashboard",setup(T){const s=Re(),t=A(!0),d=A(0),k=A("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."),m=A(null),W=A(null),y=A({newTickets:0,closedTickets:0,carryoverTickets:0,newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]}),c=A(!1),h=F(()=>typeof window>"u"?!1:window.history.length>1),p=F(()=>h.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),D={name:"dashboard-sector-1c"};function w(r){var g;if((g=r==null?void 0:r.preventDefault)==null||g.call(r),!c.value){c.value=!0;try{if(h.value){s.back();return}console.warn("GraphAdmissionClosureMonthsDashboard: fallback navigation to dashboard-sector-1c"),s.push(D)}finally{c.value=!1}}}const I=A({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),z=F(()=>{const r=I.value.customDateRange.startDate||I.value.customDateRange.endDate,g=I.value.employees.length===1&&I.value.employees.includes("all");return r||!g});async function R(r,g,B=500){const L=d.value,G=10,V=(r-L)/G,v=B/G;for(let a=0;a<G;a++)await new Promise(o=>setTimeout(o,v)),d.value=Math.min(L+V*(a+1),r);d.value=r,k.value=g}async function N(){console.log("[DEBUG MonthsDashboard] loadData called"),console.log("[DEBUG MonthsDashboard] isLoading before:",t.value),t.value=!0,m.value=null,d.value=0,k.value="–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",console.log("[DEBUG MonthsDashboard] isLoading set to true");try{console.log("[DEBUG MonthsDashboard] Starting API call"),await R(10,"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",300),await R(40,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –æ–∫—Ç—è–±—Ä—å...",800),await R(70,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –Ω–æ—è–±—Ä—å...",800),await R(90,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –¥–µ–∫–∞–±—Ä—å...",800),await R(95,"–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...",400);const r=await oe({product:"1C",periodMode:"months",includeTickets:!0});await R(100,"–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...",300),console.log("[DEBUG MonthsDashboard] API call successful, result:",r);const{meta:g,data:B}=r;W.value=g,y.value=B,console.log("[DEBUG MonthsDashboard] Data set, meta:",g,"data keys:",Object.keys(B)),await new Promise(L=>setTimeout(L,200))}catch(r){console.error("[DEBUG MonthsDashboard] API call failed:",r),m.value=r instanceof Error?r:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureMonthsDashboard] loadData error:",r),d.value=100}finally{console.log("[DEBUG MonthsDashboard] Finally block: setting isLoading to false"),t.value=!1,console.log("[DEBUG MonthsDashboard] isLoading after:",t.value)}}function $(r){I.value.stages=r}function _(r){I.value.employees=r}function H(r){I.value.dateRange=r}function n(r){I.value.customDateRange=r}function i(){I.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},b()}function b(){N()}function S(r){if(!["weeks","months"].includes(r)){console.warn("[GraphAdmissionClosureMonthsDashboard] Invalid periodMode:",r);return}r==="weeks"&&window.dispatchEvent(new CustomEvent("period-mode-change",{detail:{mode:r}}))}return pe(()=>{console.log("[DEBUG MonthsDashboard] onMounted called"),console.log("[DEBUG MonthsDashboard] isLoading before loadData:",t.value),N()}),(r,g)=>{const B=Ne("router-link");return l(),u("div",Ys,[O(K,{name:"fade",mode:"out-in"},{default:q(()=>[t.value?(l(),X(Fs,{key:"preloader",progress:d.value,"current-stage":k.value},null,8,["progress","current-stage"])):(l(),u("div",xs,[e("div",js,[e("div",zs,[e("div",qs,[e("button",{class:"btn-back-link",type:"button",onClick:w,"aria-label":p.value,"aria-disabled":!h.value,"data-fallback":!h.value,disabled:c.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,Zs),e("nav",Js,[O(B,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:q(()=>[...g[0]||(g[0]=[ae(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),g[2]||(g[2]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),O(B,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:q(()=>[...g[1]||(g[1]=[ae(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),g[3]||(g[3]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),g[4]||(g[4]=e("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),g[5]||(g[5]=e("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),g[6]||(g[6]=e("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),e("div",Ks,[e("div",Qs,[O(Ge,{stages:I.value.stages,employees:I.value.employees,dateRange:I.value.dateRange,customDateRange:I.value.customDateRange,hasActiveFilters:z.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":"months","onUpdate:stages":$,"onUpdate:employees":_,"onUpdate:dateRange":H,"onUpdate:customDateRange":n,"onUpdate:periodMode":S,onReset:i,onApply:b},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])]),e("div",Xs,[m.value?(l(),X(Le,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:m.value.message},null,8,["message"])):(l(),u(Z,{key:1},[O(gs,{data:y.value},null,8,["data"]),O(As,{data:y.value,meta:W.value},null,8,["data","meta"])],64))])])]))]),_:1})])}}},ta=ee(ea,[["__scopeId","data-v-e7421cc0"]]);class ge{static async getSectorData(){try{const s=await this.getAllTickets();console.log("Total tickets loaded:",s.length);const t=this.extractUniqueEmployeeIds(s);console.log("Unique employee IDs:",t);const d=await this.getEmployeesByIds(t);return console.log("Loaded employees:",d.length),{stages:this.groupTicketsByStages(s,d),employees:d,zeroPointTickets:this.getZeroPointTickets(s)}}catch(s){throw console.error("Error getting sector data:",s),s}}static async getAllTickets(){const s=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],t=[];for(const d of s){console.log(`Loading tickets for stage: ${d}`);const k=await this.getTicketsByStage(d);t.push(...k),console.log(`Loaded ${k.length} tickets for stage ${d}`)}return t}static async getTicketsByStage(s){const t=[];let d=0;const k=50;let m=!0;for(;m;)try{const y=await ne.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:s},select:["*"],order:{id:"DESC"},start:d,useOriginalUfNames:"Y"});let c=[];y&&y.result&&(Array.isArray(y.result)?c=y.result:y.result.items&&Array.isArray(y.result.items)?c=y.result.items:y.result.data&&Array.isArray(y.result.data)&&(c=y.result.data)),c.length>0?(t.push(...c),d+=c.length,m=c.length===k):m=!1}catch(y){console.error(`Error loading tickets batch for stage ${s} (start: ${d}):`,y),m=!1}t.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(t[0],null,2)),console.log("Sample ticket keys:",Object.keys(t[0])),console.log("Sample ticket assignedById variants:",{assignedById:t[0].assignedById,assignedByIdId:t[0].assignedByIdId,ASSIGNED_BY_ID:t[0].ASSIGNED_BY_ID}));const W=t.filter(y=>{const c=y.UF_CRM_7_TYPE_PRODUCT||y.uf_crm_7_type_product||y.ufCrm7TypeProduct||y.UF_CRM_7_TYPE_PRODUCT||y.uf_crm_7_type_product;return Array.isArray(c)?c.includes(this.SECTOR_TAG):typeof c=="object"&&c!==null?c.value===this.SECTOR_TAG||c===this.SECTOR_TAG:c===this.SECTOR_TAG});return console.log(`Filtered ${W.length} tickets from ${t.length} for stage ${s} (sector tag: ${this.SECTOR_TAG})`),W}static extractUniqueEmployeeIds(s){if(!Array.isArray(s))return[];const t=new Set;return s.forEach(d=>{const k=d.assignedById||d.assignedByIdId||d.ASSIGNED_BY_ID||d.assignedById||d.assignedById&&typeof d.assignedById=="object"&&(d.assignedById.id||d.assignedById.ID)||d.assignedById&&typeof d.assignedById=="object"&&d.assignedById.value;if(k){const m=parseInt(k);m&&!isNaN(m)&&m>0&&t.add(m)}}),s.length>0&&(console.log("Sample ticket for employee extraction:",s[0]),console.log("Sample ticket assignedById variants:",{assignedById:s[0].assignedById,assignedByIdId:s[0].assignedByIdId,ASSIGNED_BY_ID:s[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(t))),Array.from(t)}static async getEmployeesByIds(s){if(!Array.isArray(s)||s.length===0)return[];try{const t=await ne.call("user.get",{filter:{ID:s}});let d=[];return t&&t.result&&(Array.isArray(t.result)?d=t.result:console.warn("Unexpected user.get result format:",t)),d.map(k=>({id:parseInt(k.ID||k.id||0),name:`${k.NAME||k.name||""} ${k.LAST_NAME||k.lastName||""}`.trim()||k.EMAIL||k.email||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π",position:k.WORK_POSITION||k.workPosition||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",email:k.EMAIL||k.email||"",tickets:[]}))}catch(t){return console.error("Error getting employees by IDs:",t),[]}}static groupTicketsByStages(s,t){Array.isArray(s)||(console.warn("Tickets is not an array:",s),s=[]),Array.isArray(t)||(console.warn("Employees is not an array:",t),t=[]);const d=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:t.map(k=>({...k,tickets:[]}))},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:t.map(k=>({...k,tickets:[]}))},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:t.map(k=>({...k,tickets:[]}))}];return s.forEach(k=>{const m=this.mapStageId(k.stageId||k.STAGE_ID||""),W=d.find(y=>y.id===m);if(W){const y=k.assignedById||k.ASSIGNED_BY_ID||null,c=y?parseInt(y):null;if(c){let h=W.employees.find(p=>p.id===c);h||(h={id:c,name:`–°–æ—Ç—Ä—É–¥–Ω–∏–∫ #${c}`,position:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",email:"",tickets:[]},W.employees.push(h)),h.tickets.push(this.mapTicket(k))}}}),d}static mapStageId(s){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[s]||"formed"}static mapStageIdToBitrix(s){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[s]||"DT140_12:UC_0VHWE2"}static mapTicket(s){const t=parseInt(s.id||s.ID||0),d=s.title||s.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",k=s.stageId||s.STAGE_ID||"",m=s.assignedById||s.ASSIGNED_BY_ID||null,W=s.createdTime||s.CREATED_DATE||s.CREATED_TIME||"",y=s.updatedTime||s.MODIFY_DATE||s.UPDATED_TIME||"",c=s.UF_CRM_7_UF_PRIORITY||s.uf_crm_7_uf_priority||s.ufCrm7UfPriority||s.UF_CRM_7_UF_PRIORITY||s.uf_crm_7_uf_priority||s.priority||s.PRIORITY||null,h=Ue(c),p=qe(h);return{id:t,title:d,priorityId:h.id,priorityLabel:h.label,priorityColors:p,priority:h.id,priorityBitrixValue:h.bitrixValue||null,status:this.mapStatus(k),assigneeId:m?parseInt(m):null,stageId:this.mapStageId(k),createdAt:W,modifiedAt:y,amount:s.opportunity||s.OPPORTUNITY||0,currency:s.currencyId||s.CURRENCY_ID||"RUB",description:s.comments||s.COMMENTS||""}}static mapPriority(s){return Ue(s).id}static mapPriorityToBitrix(s){if(s&&typeof s=="object")return s.bitrixValue||null;const t=Me(s);if(t&&t.bitrixValue)return t.bitrixValue;const d={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return d[s]?d[s]:Me(Ze).bitrixValue}static mapStatus(s){return"in_progress"}static getZeroPointTickets(s){const t={formed:[],review:[],execution:[]};return Array.isArray(s)?(s.filter(d=>!(d.assignedById||d.ASSIGNED_BY_ID)).forEach(d=>{const k=this.mapStageId(d.stageId||d.STAGE_ID||"");t[k]&&t[k].push(this.mapTicket(d))}),t):(console.warn("Tickets is not an array in getZeroPointTickets:",s),t)}static async assignTicket(s,t,d){try{const k=this.mapStageIdToBitrix(d);return(await ne.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:s,fields:{assignedById:t,stageId:k}})).result===!0}catch(k){throw console.error("Error assigning ticket:",k),k}}static async createTicket(s){try{const t=await ne.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:s.title,assignedById:s.employeeId,stageId:this.mapStageIdToBitrix(s.stageId)}});return t.result?parseInt(t.result):0}catch(t){throw console.error("Error creating ticket:",t),t}}static async getTicket(s){try{const t=await ne.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:s});return this.mapTicket(t.result)}catch(t){throw console.error("Error getting ticket:",t),t}}static async addComment(s,t){try{return(await ne.call("crm.timeline.comment.add",{fields:{entityId:s,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:t}})).result!==void 0}catch(d){throw console.error("Error adding comment:",d),d}}}ye(ge,"ENTITY_TYPE_ID",140),ye(ge,"SECTOR_TAG","1C");const sa={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},aa={class:"modal"},ra={key:0,class:"modal__tabs"},oa={key:"level-0-categories",class:"level-0"},la={class:"modal__header"},na={class:"modal__title"},ia={key:0},da={class:"modal__body"},ca={class:"categories-list"},ua=["onClick"],ka={class:"category-item"},va={class:"category-item__icon"},ha={key:0},ma={key:1},ya={class:"category-item__content"},ga={class:"category-item__label"},pa={class:"category-item__count"},_a={key:0,class:"category-item__arrow"},fa={class:"modal__footer"},ba={key:"level-1-categories",class:"level-1"},wa={class:"modal__header"},Ta={class:"modal__body"},Ca={key:"loading",class:"loading-names"},Da={key:"empty",class:"modal__empty"},$a={key:"list",class:"responsible-list"},Wa=["onClick"],Ea={class:"responsible-list__name"},Ia={class:"responsible-list__count"},Aa={key:0,class:"responsible-list__arrow"},Sa={class:"modal__footer"},Ba={key:"level-2-categories",class:"level-2"},Ua={class:"modal__header"},Ma={class:"modal__title"},Oa={class:"modal__body"},Ra={key:"loading",class:"loading-state"},Na={key:"error",class:"error-state"},La={class:"error-message"},Ga={key:"empty",class:"empty-state"},Pa={key:"tickets",class:"tickets-list-container"},Fa={key:"level-0-employees",class:"level-0"},Va={class:"modal__header"},Ha={class:"modal__title"},Ya={key:0},xa={class:"modal__body"},ja={key:"loading",class:"loading-names"},za={key:"empty",class:"modal__empty"},qa={key:"list",class:"responsible-list"},Za=["onClick"],Ja={class:"responsible-list__name"},Ka={class:"responsible-list__count"},Qa={key:0,class:"responsible-list__arrow"},Xa={class:"modal__footer"},er={key:"level-1-employees",class:"level-1"},tr={class:"modal__header"},sr={class:"modal__title"},ar={class:"modal__body"},rr={class:"categories-list"},or=["onClick"],lr={class:"category-item"},nr={class:"category-item__icon"},ir={key:0},dr={key:1},cr={class:"category-item__content"},ur={class:"category-item__label"},kr={class:"category-item__count"},vr={key:0,class:"category-item__arrow"},hr={class:"modal__footer"},mr={key:"level-2-employees",class:"level-2"},yr={class:"modal__header"},gr={class:"modal__title"},pr={class:"modal__body"},_r={key:"loading",class:"loading-state"},fr={key:"error",class:"error-state"},br={class:"error-message"},wr={key:"empty",class:"empty-state"},Tr={class:"empty-state-message"},Cr={key:"tickets",class:"tickets-list-container"},Dr={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(T){const s=T,t=A(0),d=A("categories"),k=A(null),m=A(null),W=A(null),y=A([]),c=A(!1),h=A(null),p=A([]),D=A([]),w=A(!1),I=F(()=>[{id:"created-this-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é",count:s.closedTicketsCreatedThisWeek??0,responsible:s.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"–¢–∏–∫–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–µ —ç—Ç–æ–π –Ω–µ–¥–µ–ª—å—é –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ",count:s.closedTicketsCreatedOtherWeek??0,responsible:s.responsibleCreatedOtherWeek??[]}]),z=F(()=>{const v=new Map;return(s.responsibleCreatedThisWeek||[]).forEach(a=>{const o=a.id??"unassigned";v.has(o)||v.set(o,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const E=v.get(o);E.thisWeekCount=a.count??0,E.thisWeekTickets=a.tickets||[],E.totalCount+=E.thisWeekCount}),(s.responsibleCreatedOtherWeek||[]).forEach(a=>{const o=a.id??"unassigned";v.has(o)||v.set(o,{id:a.id,name:a.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const E=v.get(o);E.otherWeekCount=a.count??0,E.otherWeekTickets=a.tickets||[],E.totalCount+=E.otherWeekCount}),Array.from(v.values())}),R=F(()=>{if(!m.value)return[];const v=m.value.thisWeekTickets||[],a=m.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:m.value.id,name:m.value.name,thisWeekCount:m.value.thisWeekCount,otherWeekCount:m.value.otherWeekCount,thisWeekTickets:v.length,otherWeekTickets:a.length,employee:m.value}),[{id:"this-week",label:"–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ",count:m.value.thisWeekCount??0,tickets:v,employeeId:m.value.id},{id:"other-week",label:"–ù–∞ –¥—Ä—É–≥–æ–π –Ω–µ–¥–µ–ª–µ",count:m.value.otherWeekCount??0,tickets:a,employeeId:m.value.id}]}),N=F(()=>(D.value||[]).length>0);async function $(v){const a=v.filter(o=>o.id!==null&&o.id!==void 0).map(o=>o.id);if(a.length===0)return v;try{const o=await ge.getEmployeesByIds(a),E=new Map;return o.forEach(M=>{E.set(M.id,M.name)}),v.map(M=>M.id&&E.has(M.id)?{...M,name:E.get(M.id)}:M)}catch(o){return console.error("[ResponsibleModal] Error enriching names:",o),v}}te([()=>d.value,()=>z.value],async([v,a])=>{if(!(v!=="employees"||t.value!==0)){if(!a||a.length===0){D.value=[];return}w.value=!0;try{D.value=await $(a)}catch(o){console.error("[ResponsibleModal] Error loading employee names:",o),D.value=a}finally{w.value=!1}}},{immediate:!0}),te(()=>s.responsible,async v=>{if(!(t.value!==0||k.value||d.value!=="categories")){if(!v||v.length===0){p.value=[];return}w.value=!0;try{p.value=await $(v)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),p.value=v}finally{w.value=!1}}},{immediate:!1});const _=F(()=>(p.value||[]).length>0);function H(v){d.value!==v&&(d.value=v,t.value=0,k.value=null,m.value=null,W.value=null,y.value=[],h.value=null,p.value=[],D.value=[])}async function n(v){if(!(!v||v.count===0)){k.value=v,t.value=1,w.value=!0;try{p.value=await $(v.responsible)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),p.value=v.responsible}finally{w.value=!1}}}async function i(v,a=null){var o,E;!v||!v.id||v.totalCount===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:v.id,name:v.name,thisWeekCount:v.thisWeekCount,otherWeekCount:v.otherWeekCount,thisWeekTickets:((o=v.thisWeekTickets)==null?void 0:o.length)||0,otherWeekTickets:((E=v.otherWeekTickets)==null?void 0:E.length)||0,employee:v}),m.value={...v,thisWeekTickets:v.thisWeekTickets||[],otherWeekTickets:v.otherWeekTickets||[]},t.value=1)}async function b(v){var o;if(!v||v.count===0)return;W.value=v,t.value=2;const a=v.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:v.id,label:v.label,count:v.count,ticketsInGradation:a.length,selectedEmployee:(o=m.value)==null?void 0:o.id}),a.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",a.length),await S(a)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await r(v))}async function S(v){c.value=!0,h.value=null;try{try{const{prepareTicketsForDisplay:a}=await ke(async()=>{const{prepareTicketsForDisplay:o}=await import("./ticketListUtils-BDQyVj4-.js").then(E=>E.t);return{prepareTicketsForDisplay:o}},__vite__mapDeps([0,1,2,3,4,5]));y.value=await a(v,null,null)}catch(a){console.error("[ResponsibleModal] Error preparing tickets:",a),y.value=v}y.value.length===0&&(h.value=null)}catch(a){h.value=a.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",a),y.value=[]}finally{c.value=!1}}async function r(v){c.value=!0,h.value=null;try{if(!s.weekStartUtc||!s.weekEndUtc||!m.value)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫");const a=await oe({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeTickets:!0}),o=v.id==="this-week"?a.data.responsibleCreatedThisWeek:a.data.responsibleCreatedOtherWeek,E=o==null?void 0:o.find(P=>P.id===m.value.id),M=(E==null?void 0:E.tickets)||[];try{const{prepareTicketsForDisplay:P}=await ke(async()=>{const{prepareTicketsForDisplay:f}=await import("./ticketListUtils-BDQyVj4-.js").then(Y=>Y.t);return{prepareTicketsForDisplay:f}},__vite__mapDeps([0,1,2,3,4,5]));y.value=await P(M,null,null)}catch(P){console.error("[ResponsibleModal] Error preparing tickets:",P),y.value=M}y.value.length===0&&(h.value=null)}catch(a){h.value=a.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets from API:",a),y.value=[]}finally{c.value=!1}}async function g(v,a=null){!v||!v.id||v.count===0||(a&&a.currentTarget&&(a.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{a.currentTarget&&(a.currentTarget.style.transform="")},150)),m.value=v,t.value=2,await B(v.id))}async function B(v){var a;c.value=!0,h.value=null;try{let o=[];if(k.value&&k.value.responsible){const E=k.value.responsible.find(M=>M.id===v);o=(E==null?void 0:E.tickets)||[]}if(o.length===0&&s.weekStartUtc&&s.weekEndUtc){const E=await oe({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeTickets:!0}),M=((a=k.value)==null?void 0:a.id)==="created-this-week"?E.data.responsibleCreatedThisWeek:E.data.responsibleCreatedOtherWeek,P=M==null?void 0:M.find(f=>f.id===v);o=(P==null?void 0:P.tickets)||[]}try{const{prepareTicketsForDisplay:E}=await ke(async()=>{const{prepareTicketsForDisplay:M}=await import("./ticketListUtils-BDQyVj4-.js").then(P=>P.t);return{prepareTicketsForDisplay:M}},__vite__mapDeps([0,1,2,3,4,5]));y.value=await E(o,null,null)}catch(E){console.error("[ResponsibleModal] Error preparing tickets:",E),y.value=o}y.value.length===0&&(h.value=null)}catch(o){h.value=o.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[ResponsibleModal] Error loading tickets:",o),y.value=[]}finally{c.value=!1}}function L(){t.value===2?(t.value=1,d.value==="categories"?m.value=null:W.value=null,y.value=[],h.value=null):t.value===1&&(t.value=0,d.value==="categories"?(k.value=null,p.value=[]):m.value=null)}function G(v){const a=_e(v.id);window.open(a,"_blank")}function V(){d.value==="employees"&&W.value?S(W.value.tickets):d.value==="categories"&&m.value&&B(m.value.id)}return te(()=>s.isVisible,v=>{v||(t.value=0,d.value="categories",k.value=null,m.value=null,W.value=null,y.value=[],h.value=null,p.value=[],D.value=[])}),(v,a)=>T.isVisible?(l(),u("div",sa,[e("div",aa,[t.value===0?(l(),u("div",ra,[e("button",{class:Q(["modal__tab",{"modal__tab--active":d.value==="categories"}]),onClick:a[0]||(a[0]=o=>H("categories"))}," –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º ",2),e("button",{class:Q(["modal__tab",{"modal__tab--active":d.value==="employees"}]),onClick:a[1]||(a[1]=o=>H("employees"))}," –ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º ",2)])):j("",!0),O(K,{name:"level",mode:"out-in"},{default:q(()=>{var o,E,M,P;return[d.value==="categories"&&t.value===0?(l(),u("div",oa,[e("header",la,[e("h3",na,[a[12]||(a[12]=ae(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),T.weekNumber?(l(),u("span",ia," ¬∑ –ù–µ–¥–µ–ª—è "+C(T.weekNumber),1)):j("",!0)]),e("button",{class:"modal__close",onClick:a[2]||(a[2]=f=>v.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",da,[e("ul",ca,[(l(!0),u(Z,null,J(I.value,f=>(l(),u("li",{key:f.id,class:Q(["categories-list__item",{"categories-list__item--clickable":f.count>0}]),onClick:Y=>n(f)},[e("div",ka,[e("div",va,[f.id==="created-this-week"?(l(),u("span",ha,"‚úì")):(l(),u("span",ma,"‚Üª"))]),e("div",ya,[e("div",ga,C(f.label),1),e("div",pa,C(f.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),f.count>0?(l(),u("span",_a,"‚Üí")):j("",!0)])],10,ua))),128))])]),e("footer",fa,[e("button",{class:"btn",onClick:a[3]||(a[3]=f=>v.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):d.value==="categories"&&t.value===1?(l(),u("div",ba,[e("header",wa,[e("button",{class:"btn-back",onClick:L,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),a[13]||(a[13]=e("h3",{class:"modal__title"},"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),e("button",{class:"modal__close",onClick:a[4]||(a[4]=f=>v.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",Ta,[O(K,{name:"loading",mode:"out-in"},{default:q(()=>[w.value?(l(),u("div",Ca,[...a[14]||(a[14]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):_.value?(l(),u("ul",$a,[(l(!0),u(Z,null,J(p.value,f=>(l(),u("li",{key:f.id||f.name,class:Q(["responsible-list__item",{"responsible-list__item--clickable":f.id&&f.count>0}]),onClick:Y=>g(f,Y),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[e("span",Ea,C(f.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),e("span",Ia,C(f.count??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),f.id&&f.count>0?(l(),u("span",Aa,"‚Üí")):j("",!0)],10,Wa))),128))])):(l(),u("p",Da,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º"))]),_:1})]),e("footer",Sa,[e("button",{class:"btn",onClick:a[5]||(a[5]=f=>v.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):d.value==="categories"&&t.value===2?(l(),u("div",Ba,[e("header",Ua,[e("button",{class:"btn-back",onClick:L,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",Ma,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+C(((o=m.value)==null?void 0:o.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:a[6]||(a[6]=f=>v.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",Oa,[O(K,{name:"loading",mode:"out-in"},{default:q(()=>[c.value?(l(),u("div",Ra,[...a[15]||(a[15]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):h.value?(l(),u("div",Na,[a[16]||(a[16]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),a[17]||(a[17]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",La,C(h.value),1),e("button",{class:"btn btn-retry",onClick:V},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):y.value.length===0?(l(),u("div",Ga,[...a[18]||(a[18]=[e("div",{class:"empty-state-icon"},"üìã",-1),e("p",{class:"empty-state-message"},"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é",-1)])])):(l(),u("div",Pa,[O(he,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(l(!0),u(Z,null,J(y.value,(f,Y)=>(l(),X(me,{key:f.id,ticket:f,draggable:!1,style:se({"--ticket-index":Y}),onClick:G},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):d.value==="employees"&&t.value===0?(l(),u("div",Fa,[e("header",Va,[e("h3",Ha,[a[19]||(a[19]=ae(" –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é",-1)),T.weekNumber?(l(),u("span",Ya," ¬∑ –ù–µ–¥–µ–ª—è "+C(T.weekNumber),1)):j("",!0)]),e("button",{class:"modal__close",onClick:a[7]||(a[7]=f=>v.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",xa,[O(K,{name:"loading",mode:"out-in"},{default:q(()=>[w.value?(l(),u("div",ja,[...a[20]||(a[20]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–º—ë–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...",-1)])])):N.value?(l(),u("ul",qa,[(l(!0),u(Z,null,J(D.value,f=>(l(),u("li",{key:f.id||f.name,class:Q(["responsible-list__item",{"responsible-list__item--clickable":f.id&&f.totalCount>0}]),onClick:Y=>i(f,Y),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞–¥–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"},[e("span",Ja,C(f.name||"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω"),1),e("span",Ka,C(f.totalCount??0)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),f.id&&f.totalCount>0?(l(),u("span",Qa,"‚Üí")):j("",!0)],10,Za))),128))])):(l(),u("p",za,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º"))]),_:1})]),e("footer",Xa,[e("button",{class:"btn",onClick:a[8]||(a[8]=f=>v.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):d.value==="employees"&&t.value===1?(l(),u("div",er,[e("header",tr,[e("button",{class:"btn-back",onClick:L,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",sr,"–¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+C(((E=m.value)==null?void 0:E.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:a[9]||(a[9]=f=>v.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",ar,[e("ul",rr,[(l(!0),u(Z,null,J(R.value,f=>(l(),u("li",{key:f.id,class:Q(["categories-list__item",{"categories-list__item--clickable":f.count>0}]),onClick:Y=>b(f)},[e("div",lr,[e("div",nr,[f.id==="this-week"?(l(),u("span",ir,"‚úì")):(l(),u("span",dr,"‚Üª"))]),e("div",cr,[e("div",ur,C(f.label),1),e("div",kr,C(f.count)+" —Ç–∏–∫–µ—Ç–æ–≤",1)]),f.count>0?(l(),u("span",vr,"‚Üí")):j("",!0)])],10,or))),128))])]),e("footer",hr,[e("button",{class:"btn",onClick:a[10]||(a[10]=f=>v.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):d.value==="employees"&&t.value===2?(l(),u("div",mr,[e("header",yr,[e("button",{class:"btn-back",onClick:L,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",gr," –¢–∏–∫–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: "+C(((M=m.value)==null?void 0:M.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")+" ("+C(((P=W.value)==null?void 0:P.label)||"")+") ",1),e("button",{class:"modal__close",onClick:a[11]||(a[11]=f=>v.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",pr,[O(K,{name:"loading",mode:"out-in"},{default:q(()=>{var f;return[c.value?(l(),u("div",_r,[...a[21]||(a[21]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):h.value?(l(),u("div",fr,[a[22]||(a[22]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),a[23]||(a[23]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",br,C(h.value),1),e("button",{class:"btn btn-retry",onClick:V},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):y.value.length===0?(l(),u("div",wr,[a[24]||(a[24]=e("div",{class:"empty-state-icon"},"üìã",-1)),e("p",Tr,C(d.value==="employees"?`–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${((f=W.value)==null?void 0:f.label)||""}"`:"–£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é"),1)])):(l(),u("div",Cr,[O(he,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(l(!0),u(Z,null,J(y.value,(Y,x)=>(l(),X(me,{key:Y.id,ticket:Y,draggable:!1,style:se({"--ticket-index":x}),onClick:G},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):j("",!0)]}),_:1})])])):j("",!0)}},$r=ee(Dr,[["__scopeId","data-v-3b229bb4"]]),Wr={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Er={class:"modal"},Ir={key:"level-1",class:"level-1"},Ar={class:"modal__header"},Sr={class:"modal__title"},Br={key:0},Ur={class:"modal__body"},Mr={key:"loading",class:"loading-names"},Or={key:"empty",class:"modal__empty"},Rr={key:"list",class:"stages-list"},Nr=["onClick"],Lr={class:"stages-list__name"},Gr={class:"stages-list__count"},Pr={key:0,class:"stages-list__arrow"},Fr={class:"modal__footer"},Vr={key:"level-2",class:"level-2"},Hr={class:"modal__header"},Yr={class:"modal__title"},xr={class:"modal__body"},jr={key:"loading",class:"loading-state"},zr={key:"error",class:"error-state"},qr={class:"error-message"},Zr={key:"empty",class:"empty-state"},Jr={class:"empty-state-message"},Kr={key:"tickets",class:"tickets-list-container"},Qr={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(T,{emit:s}){const t=T,d=A(1),k=A(null),m=A([]),W=A(!1),y=A(!1),c=A(null),h=A([]),p=F(()=>h.value.length>0&&h.value.some($=>$.count>0));async function D(){if(!t.weekStartUtc||!t.weekEndUtc){h.value=[];return}y.value=!0,c.value=null;try{const $=await oe({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0});h.value=$.data.newTicketsByStages||[]}catch($){c.value=$.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–¥–∏–π",console.error("[StagesModal] Error loading stages:",$),h.value=[]}finally{y.value=!1}}async function w($,_=null){!$||$.count===0||(_&&_.currentTarget&&(_.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{_.currentTarget&&(_.currentTarget.style.transform="")},150)),k.value=$,d.value=2,await I($.stageId))}async function I($){var _;W.value=!0,c.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const n=(_=(await oe({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:_.find(b=>b.stageId===$),i=(n==null?void 0:n.tickets)||[];try{const{prepareTicketsForDisplay:b}=await ke(async()=>{const{prepareTicketsForDisplay:S}=await import("./ticketListUtils-BDQyVj4-.js").then(r=>r.t);return{prepareTicketsForDisplay:S}},__vite__mapDeps([0,1,2,3,4,5]));m.value=await b(i,null,null)}catch(b){console.error("[StagesModal] Error preparing tickets:",b),m.value=i}m.value.length===0&&(c.value=null)}catch(H){c.value=H.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[StagesModal] Error loading tickets:",H),m.value=[]}finally{W.value=!1}}function z(){d.value=1,k.value=null,m.value=[],c.value=null}function R($){const _=_e($.id);window.open(_,"_blank")}function N(){k.value&&I(k.value.stageId)}return te(()=>t.isVisible,$=>{$?D():(d.value=1,k.value=null,m.value=[],c.value=null,h.value=[])}),te([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&D()}),($,_)=>T.isVisible?(l(),u("div",Wr,[e("div",Er,[O(K,{name:"level",mode:"out-in"},{default:q(()=>{var H;return[d.value===1?(l(),u("div",Ir,[e("header",Ar,[e("h3",Sr,[_[3]||(_[3]=ae(" –ù–æ–≤—ã–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),T.weekNumber?(l(),u("span",Br," ¬∑ –ù–µ–¥–µ–ª—è "+C(T.weekNumber),1)):j("",!0)]),e("button",{class:"modal__close",onClick:_[0]||(_[0]=n=>$.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",Ur,[O(K,{name:"loading",mode:"out-in"},{default:q(()=>[y.value?(l(),u("div",Mr,[..._[4]||(_[4]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–¥–∏–π...",-1)])])):p.value?(l(),u("ul",Rr,[(l(!0),u(Z,null,J(h.value,n=>(l(),u("li",{key:n.stageId,class:Q(["stages-list__item",{"stages-list__item--clickable":n.count>0}]),style:se({"--stage-color":n.color}),onClick:i=>w(n,i),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å—Ç–∞–¥–∏–∏"},[e("span",{class:"stages-list__color",style:se({backgroundColor:n.color})},null,4),e("span",Lr,C(n.stageName),1),e("span",Gr,C(n.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),n.count>0?(l(),u("span",Pr,"‚Üí")):j("",!0)],14,Nr))),128))])):(l(),u("p",Or," –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),e("footer",Fr,[e("button",{class:"btn",onClick:_[1]||(_[1]=n=>$.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):d.value===2?(l(),u("div",Vr,[e("header",Hr,[e("button",{class:"btn-back",onClick:z,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",Yr," –¢–∏–∫–µ—Ç—ã —Å—Ç–∞–¥–∏–∏: "+C(((H=k.value)==null?void 0:H.stageName)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:_[2]||(_[2]=n=>$.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",xr,[O(K,{name:"loading",mode:"out-in"},{default:q(()=>{var n;return[W.value?(l(),u("div",jr,[..._[5]||(_[5]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):c.value?(l(),u("div",zr,[_[6]||(_[6]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),_[7]||(_[7]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",qr,C(c.value),1),e("button",{class:"btn btn-retry",onClick:N},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):m.value.length===0?(l(),u("div",Zr,[_[8]||(_[8]=e("div",{class:"empty-state-icon"},"üìã",-1)),e("p",Jr," –ù–∞ —Å—Ç–∞–¥–∏–∏ ¬´"+C((n=k.value)==null?void 0:n.stageName)+"¬ª –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é ",1)])):(l(),u("div",Kr,[O(he,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(l(!0),u(Z,null,J(m.value,(i,b)=>(l(),X(me,{key:i.id,ticket:i,draggable:!1,style:se({"--ticket-index":b}),onClick:R},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):j("",!0)]}),_:1})])])):j("",!0)}},Xr=ee(Qr,[["__scopeId","data-v-4af0cfce"]]),eo={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},to={class:"modal"},so={key:"level-1",class:"level-1"},ao={class:"modal__header"},ro={class:"modal__title"},oo={key:0},lo={class:"modal__body"},no={key:"loading",class:"loading-names"},io={key:"empty",class:"modal__empty"},co={key:"list",class:"duration-list"},uo=["onClick"],ko={class:"duration-list__name"},vo={class:"duration-list__count"},ho={key:0,class:"duration-list__arrow"},mo={class:"modal__footer"},yo={key:"level-2",class:"level-2"},go={class:"modal__header"},po={class:"modal__title"},_o={class:"modal__body"},fo={key:"loading",class:"loading-state"},bo={key:"error",class:"error-state"},wo={class:"error-message"},To={key:"empty",class:"empty-state"},Co={class:"empty-state-message"},Do={key:"tickets",class:"tickets-list-container"},$o={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(T,{emit:s}){const t=T,d=A(1),k=A(null),m=A([]),W=A(!1),y=A(!1),c=A(null),h=A([]),p=F(()=>h.value.length>0&&h.value.some($=>$.count>0));async function D(){if(!t.weekStartUtc||!t.weekEndUtc){h.value=[];return}y.value=!0,c.value=null;try{const $=await oe({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});h.value=$.data.carryoverTicketsByDuration||[]}catch($){c.value=$.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π",console.error("[CarryoverDurationModal] Error loading categories:",$),h.value=[]}finally{y.value=!1}}async function w($,_=null){!$||$.count===0||(_&&_.currentTarget&&(_.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{_.currentTarget&&(_.currentTarget.style.transform="")},150)),k.value=$,d.value=2,await I($.durationCategory))}async function I($){var _;W.value=!0,c.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("–ù–µ —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏");const n=(_=(await oe({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})).data.carryoverTicketsByDuration)==null?void 0:_.find(b=>b.durationCategory===$),i=(n==null?void 0:n.tickets)||[];try{const{prepareTicketsForDisplay:b}=await ke(async()=>{const{prepareTicketsForDisplay:S}=await import("./ticketListUtils-BDQyVj4-.js").then(r=>r.t);return{prepareTicketsForDisplay:S}},__vite__mapDeps([0,1,2,3,4,5]));m.value=await b(i,null,null)}catch(b){console.error("[CarryoverDurationModal] Error preparing tickets:",b),m.value=i}m.value.length===0&&(c.value=null)}catch(H){c.value=H.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤",console.error("[CarryoverDurationModal] Error loading tickets:",H),m.value=[]}finally{W.value=!1}}function z(){d.value=1,k.value=null,m.value=[],c.value=null}function R($){const _=_e($.id);window.open(_,"_blank")}function N(){k.value&&I(k.value.durationCategory)}return te(()=>t.isVisible,$=>{$?D():(d.value=1,k.value=null,m.value=[],c.value=null,h.value=[])}),te([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&D()}),($,_)=>T.isVisible?(l(),u("div",eo,[e("div",to,[O(K,{name:"level",mode:"out-in"},{default:q(()=>{var H;return[d.value===1?(l(),u("div",so,[e("header",ao,[e("h3",ro,[_[3]||(_[3]=ae(" –ü–µ—Ä–µ—Ö–æ–¥—è—â–∏–µ —Ç–∏–∫–µ—Ç—ã –ø–æ —Å—Ä–æ–∫–∞–º",-1)),T.weekNumber?(l(),u("span",oo," ¬∑ –ù–µ–¥–µ–ª—è "+C(T.weekNumber),1)):j("",!0)]),e("button",{class:"modal__close",onClick:_[0]||(_[0]=n=>$.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",lo,[O(K,{name:"loading",mode:"out-in"},{default:q(()=>[y.value?(l(),u("div",no,[..._[4]||(_[4]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...",-1)])])):p.value?(l(),u("ul",co,[(l(!0),u(Z,null,J(h.value,n=>(l(),u("li",{key:n.durationCategory,class:Q(["duration-list__item",{"duration-list__item--clickable":n.count>0}]),style:se({"--duration-color":n.color}),onClick:i=>w(n,i),title:"–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},[e("span",{class:"duration-list__color",style:se({backgroundColor:n.color})},null,4),e("span",ko,C(n.durationLabel),1),e("span",vo,C(n.count)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1),n.count>0?(l(),u("span",ho,"‚Üí")):j("",!0)],14,uo))),128))])):(l(),u("p",io," –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é "))]),_:1})]),e("footer",mo,[e("button",{class:"btn",onClick:_[1]||(_[1]=n=>$.$emit("close"))},"–ó–∞–∫—Ä—ã—Ç—å")])])):d.value===2?(l(),u("div",yo,[e("header",go,[e("button",{class:"btn-back",onClick:z,"aria-label":"–ù–∞–∑–∞–¥"},"‚Üê –ù–∞–∑–∞–¥"),e("h3",po," –¢–∏–∫–µ—Ç—ã: "+C(((H=k.value)==null?void 0:H.durationLabel)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1),e("button",{class:"modal__close",onClick:_[2]||(_[2]=n=>$.$emit("close")),"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"}," ‚úï ")]),e("section",_o,[O(K,{name:"loading",mode:"out-in"},{default:q(()=>{var n;return[W.value?(l(),u("div",fo,[..._[5]||(_[5]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):c.value?(l(),u("div",bo,[_[6]||(_[6]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),_[7]||(_[7]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",wo,C(c.value),1),e("button",{class:"btn btn-retry",onClick:N},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):m.value.length===0?(l(),u("div",To,[_[8]||(_[8]=e("div",{class:"empty-state-icon"},"üìã",-1)),e("p",Co," –í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´"+C((n=k.value)==null?void 0:n.durationLabel)+"¬ª –Ω–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—è—â–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ ",1)])):(l(),u("div",Do,[O(he,{name:"ticket",tag:"div",class:"tickets-list"},{default:q(()=>[(l(!0),u(Z,null,J(m.value,(i,b)=>(l(),X(me,{key:i.id,ticket:i,draggable:!1,style:se({"--ticket-index":b}),onClick:R},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):j("",!0)]}),_:1})])])):j("",!0)}},Wo=ee($o,[["__scopeId","data-v-c26f06c2"]]),Eo={class:"ac-dashboard"},Io={key:"preloader",class:"chart-preloader"},Ao={class:"preloader-content"},So={class:"preloader-message"},Bo={key:"content"},Uo={key:1,class:"weeks-dashboard"},Mo={class:"dashboard-header"},Oo={class:"header-content"},Ro={class:"breadcrumbs-row"},No=["aria-label","aria-disabled","data-fallback","disabled"],Lo={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Go={class:"dashboard-layout"},Po={class:"filters-container"},Fo={class:"chart-container"},Vo={__name:"GraphAdmissionClosureDashboard",setup(T){const s=Re(),t=A(!1),d=A(null),k=A(null),m=A({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),W=A(!1),y=A(!1),c=A(!1),h=A(!0),p=A(!1),D=F(()=>typeof window>"u"?!1:window.history.length>1),w=F(()=>D.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"),I={name:"dashboard-sector-1c"};function z(a){var o;if((o=a==null?void 0:a.preventDefault)==null||o.call(a),!p.value){p.value=!0;try{if(D.value){s.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),s.push(I)}finally{p.value=!1}}}const R=A({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),N=A("weeks"),$=F(()=>{const a=R.value.customDateRange.startDate||R.value.customDateRange.endDate,o=R.value.employees.length===1&&R.value.employees.includes("all");return a||!o});async function _(){if(console.log("[DEBUG] loadData called"),console.log("[DEBUG] periodMode:",N.value),console.log("[DEBUG] isLoading before:",t.value),N.value!=="weeks"){console.log("[DEBUG] loadData: periodMode is not weeks, returning and resetting isLoading"),t.value=!1;return}console.log("[DEBUG] Setting isLoading to true"),t.value=!0,d.value=null;const a=new Promise(o=>setTimeout(o,300));try{console.log("[DEBUG] Starting API call");const o=v(),E=o.weekStartUtc,M=o.weekEndUtc;console.log("[DEBUG] Week bounds:",{weekStartUtc:E,weekEndUtc:M});const[P,f]=await Promise.all([a,oe({product:"1C",periodMode:"weeks",weekStartUtc:E,weekEndUtc:M,includeTickets:!0})]);console.log("[DEBUG] API call successful, result:",f);const{meta:Y,data:x}=f;k.value=Y,m.value=x,console.log("[DEBUG] Data set, meta:",Y,"data keys:",Object.keys(x))}catch(o){console.error("[DEBUG] API call failed:",o),d.value=o instanceof Error?o:new Error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"),console.error("[GraphAdmissionClosureDashboard] loadData error:",o)}finally{console.log("[DEBUG] Finally block: setting isLoading to false"),t.value=!1,console.log("[DEBUG] isLoading after:",t.value)}}function H(a){R.value.stages=a}function n(a){R.value.employees=a}function i(a){R.value.dateRange=a}function b(a){R.value.customDateRange=a}function S(a){if(!["weeks","months"].includes(a)){console.warn("[GraphAdmissionClosureDashboard] Invalid periodMode:",a);return}a!==N.value&&(N.value=a,_())}function r(a){const{mode:o}=a.detail;["weeks","months"].includes(o)&&S(o)}function g(){R.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},B()}function B(){_()}function L(a){["weeks","months"].includes(a)&&(N.value=a)}function G(){console.log("[DEBUG] handleCloseModal called"),console.log("[DEBUG] showPeriodModeInfo before:",h.value),console.log("[DEBUG] isLoading before:",t.value),console.log("[DEBUG] periodMode:",N.value),h.value=!1,t.value=!0,console.log("[DEBUG] showPeriodModeInfo after:",h.value),console.log("[DEBUG] isLoading after:",t.value),Be(()=>{console.log("[DEBUG] handleCloseModal: calling handleStartLoading in nextTick"),V()})}function V(){console.log("[DEBUG] handleStartLoading called"),console.log("[DEBUG] periodMode before check:",N.value),console.log("[DEBUG] showPeriodModeInfo:",h.value),console.log("[DEBUG] isLoading:",t.value),(!N.value||!["weeks","months"].includes(N.value))&&(console.warn('[GraphAdmissionClosureDashboard] Period mode not set, using default "weeks"'),N.value="weeks"),console.log("[GraphAdmissionClosureDashboard] Starting loading, periodMode:",N.value),Be(()=>{console.log("[DEBUG] nextTick callback, periodMode:",N.value),console.log("[DEBUG] isLoading in nextTick:",t.value),N.value==="weeks"?(console.log("[GraphAdmissionClosureDashboard] Loading data for weeks mode"),_()):N.value==="months"&&(console.log("[GraphAdmissionClosureDashboard] Months mode - data will be loaded by GraphAdmissionClosureMonthsDashboard"),t.value=!1,console.log("[DEBUG] Reset parent isLoading to false for months mode"))})}pe(()=>{try{const a="graph-admission-closure-period-mode-info-shown";localStorage.getItem(a)&&localStorage.removeItem(a);const o="graph-admission-closure-period-mode";localStorage.getItem(o)&&localStorage.removeItem(o)}catch(a){console.warn("[GraphAdmissionClosureDashboard] Failed to clean localStorage:",a)}window.addEventListener("period-mode-change",r)}),Oe(()=>{window.removeEventListener("period-mode-change",r)});function v(){const a=new Date,o=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())),E=o.getUTCDay(),M=o.getUTCDate()-E+(E===0?-6:1),P=new Date(Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),M,0,0,0)),f=new Date(P);return f.setUTCDate(f.getUTCDate()+6),f.setUTCHours(23,59,59,999),{weekStartUtc:P.toISOString(),weekEndUtc:f.toISOString()}}return(a,o)=>{var M,P,f,Y,x,le,de,ce,ue;const E=Ne("router-link");return l(),u("div",Eo,[O(K,{name:"fade",mode:"out-in"},{default:q(()=>[t.value?(l(),u("div",Io,[e("div",Ao,[o[6]||(o[6]=e("div",{class:"preloader-spinner"},[e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"})],-1)),o[7]||(o[7]=e("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞",-1)),e("p",So," –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ "+C(N.value==="weeks"?"4 –Ω–µ–¥–µ–ª–∏":"3 –º–µ—Å—è—Ü–∞")+"... ",1),o[8]||(o[8]=e("div",{class:"preloader-dots"},[e("span",{class:"dot"}),e("span",{class:"dot"}),e("span",{class:"dot"})],-1))])])):!h.value&&!t.value?(l(),u("div",Bo,[N.value==="months"?(l(),X(ta,{key:0})):(l(),u("div",Uo,[e("div",Mo,[e("div",Oo,[e("div",Ro,[e("button",{class:"btn-back-link",type:"button",onClick:z,"aria-label":w.value,"aria-disabled":!D.value,"data-fallback":!D.value,disabled:p.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,No),e("nav",Lo,[O(E,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:q(()=>[...o[9]||(o[9]=[ae(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),o[11]||(o[11]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),O(E,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:q(()=>[...o[10]||(o[10]=[ae(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),o[12]||(o[12]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),o[13]||(o[13]=e("span",{class:"breadcrumb-current"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1))])]),o[14]||(o[14]=e("h1",{class:"dashboard-title"},"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),o[15]||(o[15]=e("p",{class:"dashboard-subtitle"}," –î–æ—Å—Ç—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã ¬´–ì—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, —Å–µ–ª–µ–∫—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤ —Å–∫—Ä—ã—Ç. ",-1))])]),e("div",Go,[e("div",Po,[O(Ge,{stages:R.value.stages,employees:R.value.employees,dateRange:R.value.dateRange,customDateRange:R.value.customDateRange,hasActiveFilters:$.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":N.value,"onUpdate:stages":H,"onUpdate:employees":n,"onUpdate:dateRange":i,"onUpdate:customDateRange":b,"onUpdate:periodMode":S,onReset:g,onApply:B},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","period-mode"])]),e("div",Fo,[d.value?(l(),X(Le,{key:0,type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:d.value.message},null,8,["message"])):(l(),X(Mt,{key:1,meta:k.value,data:m.value,onOpenResponsible:o[0]||(o[0]=re=>W.value=!0),onOpenStages:o[1]||(o[1]=re=>y.value=!0),onOpenCarryover:o[2]||(o[2]=re=>c.value=!0)},null,8,["meta","data"]))])])]))])):j("",!0)]),_:1}),O($r,{"is-visible":W.value,responsible:m.value.responsible||[],"closed-tickets-created-this-week":m.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":m.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":m.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":m.value.responsibleCreatedOtherWeek||[],"week-number":((M=k.value)==null?void 0:M.weekNumber)||null,"week-start-utc":((P=k.value)==null?void 0:P.weekStartUtc)||null,"week-end-utc":((f=k.value)==null?void 0:f.weekEndUtc)||null,onClose:o[3]||(o[3]=re=>W.value=!1)},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),O(Xr,{"is-visible":y.value,"week-number":((Y=k.value)==null?void 0:Y.weekNumber)||null,"week-start-utc":((x=k.value)==null?void 0:x.weekStartUtc)||null,"week-end-utc":((le=k.value)==null?void 0:le.weekEndUtc)||null,onClose:o[4]||(o[4]=re=>y.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"]),O(Wo,{"is-visible":c.value,"week-number":((de=k.value)==null?void 0:de.weekNumber)||null,"week-start-utc":((ce=k.value)==null?void 0:ce.weekStartUtc)||null,"week-end-utc":((ue=k.value)==null?void 0:ue.weekEndUtc)||null,onClose:o[5]||(o[5]=re=>c.value=!1)},null,8,["is-visible","week-number","week-start-utc","week-end-utc"]),h.value?(l(),X(tt,{key:0,"is-visible":h.value,"current-mode":N.value,onClose:G,onSelectMode:L},null,8,["is-visible","current-mode"])):j("",!0)])}}},qo=ee(Vo,[["__scopeId","data-v-6c4434cd"]]);export{qo as default};
