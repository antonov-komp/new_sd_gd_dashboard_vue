const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./chunk-DDkaCoCd.js","./chunk-B5D7QuKi.js","./chunk-DvnTAM4m.js","./chunk-BeqOLNMR.js","./chunk-SN5klnRu.js"])))=>i.map(i=>d[i]);
import{g as L,m as _e,h as He,B as je,f as me,o,a as J,w as ne,c as l,b as z,e as t,i as ve,n as oe,T as he,D as Je,H as Fe,a4 as ze,l as I,a5 as We,U as Xe,W as et,t as d,F as te,j as ae,a6 as De,Y as tt,G as at,x as we,u as Ye,r as Ze,C as Ue,a7 as Le,Q as Ke}from"./chunk-J8T_k_VI.js";import{_ as fe,c,S as qe}from"./main-BFroMdBL.js";import{F as Qe}from"./chunk-g5F8XVHr.js";import{f as Se,_ as Ce}from"./chunk-SN5klnRu.js";import{DashboardSector1CService as st}from"./dashboard-sector-1c-service-e577qKlQ.js";import{g as Ge}from"./chunk-DDkaCoCd.js";import{T as Re}from"./chunk-LHRoIqC4.js";import{L as rt}from"./chunk-BeqOLNMR.js";import"./chunk-DdeY5zWL.js";import"./chunk-DvnTAM4m.js";import"./chunk-B5D7QuKi.js";const ot={key:0,class:"modal-overlay"},nt={class:"modal-container",role:"dialog","aria-labelledby":"modal-title","aria-modal":"true"},lt={class:"modal-body"},it={class:"mode-description"},ct={__name:"PeriodModeInfoModal",props:{isVisible:{type:Boolean,required:!0},currentMode:{type:String,default:"weeks",validator:T=>["weeks","months"].includes(T)}},emits:["close","start-loading","select-mode"],setup(T,{emit:u}){const s=T,$=u,w=L(s.currentMode);function f(M){if(!["weeks","months"].includes(M)){console.warn("[PeriodModeInfoModal] Invalid mode:",M);return}w.value=M,console.log("[DEBUG Modal] handleModeSelect: mode =",M),console.log("[DEBUG Modal] Emitting select-mode event"),$("select-mode",M),console.log("[DEBUG Modal] Emitting close event"),$("close"),console.log("[DEBUG Modal] Scheduling start-loading event in 100ms"),setTimeout(()=>{console.log("[DEBUG Modal] Emitting start-loading event"),$("start-loading")},100)}function g(){console.log("[DEBUG Modal] handleClose called, selectedMode =",w.value),console.log("[DEBUG Modal] Emitting select-mode event with",w.value),$("select-mode",w.value),console.log("[DEBUG Modal] Emitting close event"),$("close")}function p(M){M.key==="Escape"&&s.isVisible&&g()}return _e(()=>s.currentMode,M=>{["weeks","months"].includes(M)&&(w.value=M)}),He(()=>{s.isVisible&&document.addEventListener("keydown",p)}),je(()=>{document.removeEventListener("keydown",p)}),_e(()=>s.isVisible,M=>{M?(document.addEventListener("keydown",p),w.value=s.currentMode):document.removeEventListener("keydown",p)}),(M,O)=>(o(),me(Je,{to:"body"},[J(he,{name:"modal-fade"},{default:ne(()=>[T.isVisible?(o(),l("div",ot,[t("div",nt,[t("div",{class:"modal-header"},[O[2]||(O[2]=t("h2",{id:"modal-title",class:"modal-title"},[t("span",{class:"modal-icon"},"â„¹ï¸"),ve(" Ð’Ñ‹Ð±Ð¾Ñ€ Ñ€ÐµÐ¶Ð¸Ð¼Ð° Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ ")],-1)),t("button",{class:"modal-close-btn",onClick:g,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",type:"button"}," Ã— ")]),t("div",lt,[O[5]||(O[5]=t("p",{class:"modal-description"}," Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ° Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹: ",-1)),t("div",it,[t("button",{class:oe(["mode-item mode-item--clickable",{"mode-item--selected":w.value==="weeks"}]),onClick:O[0]||(O[0]=q=>f("weeks")),type:"button"},[...O[3]||(O[3]=[t("div",{class:"mode-header"},[t("span",{class:"mode-icon"},"ðŸ“…"),t("h3",{class:"mode-title"},"4 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð½ÐµÐ´ÐµÐ»Ð¸")],-1),t("p",{class:"mode-text"}," ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 4 Ð½ÐµÐ´ÐµÐ»Ð¸ Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹ Ð¿Ð¾ Ð½ÐµÐ´ÐµÐ»ÑÐ¼. ÐŸÐ¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ ÐºÑ€Ð°Ñ‚ÐºÐ¾ÑÑ€Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ð´Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ¸ Ð¿Ð¾ÑÑ‚ÑƒÐ¿Ð»ÐµÐ½Ð¸Ñ Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð². ",-1)])],2),t("button",{class:oe(["mode-item mode-item--clickable",{"mode-item--selected":w.value==="months"}]),onClick:O[1]||(O[1]=q=>f("months")),type:"button"},[...O[4]||(O[4]=[t("div",{class:"mode-header"},[t("span",{class:"mode-icon"},"ðŸ“Š"),t("h3",{class:"mode-title"},"3 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… Ð¼ÐµÑÑÑ†Ð°")],-1),t("p",{class:"mode-text"}," ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 3 Ð¼ÐµÑÑÑ†Ð° Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹ Ð¿Ð¾ Ð¼ÐµÑÑÑ†Ð°Ð¼ Ð¸ Ð½ÐµÐ´ÐµÐ»ÑÐ¼ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¼ÐµÑÑÑ†ÐµÐ². ÐŸÐ¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ Ð´Ð¾Ð»Ð³Ð¾ÑÑ€Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ð¸ Ð²Ñ‹ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ñ‚Ñ€ÐµÐ½Ð´Ð¾Ð². ",-1)])],2)])])])])):z("",!0)]),_:1})]))}},dt=fe(ct,[["__scopeId","data-v-4a42a9a6"]]),ut={class:"ac-chart"},kt={class:"ac-chart__header"},vt={class:"ac-chart__subtitle"},ht={class:"ac-chart__controls"},mt={class:"chart-type-selector"},yt=["onClick"],pt={class:"chart-type-icon"},gt={class:"chart-type-label"},bt={class:"ac-chart__summary"},ft={class:"summary-week-block summary-week-block--current"},_t={class:"summary-week-block__title"},wt={class:"summary-week-block__title-week"},Ct={key:0,class:"summary-week-block__title-dates"},Tt={class:"summary-week-block__cards"},Wt={class:"summary-card__value-wrapper"},$t={class:"summary-card__value"},At=["title"],Dt={class:"percentage-indicator__arrow"},St={class:"percentage-indicator__value"},Nt={class:"percentage-indicator__label"},Et={class:"summary-card__value-wrapper"},Ot={class:"summary-card__value-main"},Bt=["title"],Mt={class:"percentage-indicator__arrow"},Ut={class:"percentage-indicator__value"},Rt={class:"percentage-indicator__label"},Pt={class:"summary-card__breakdown"},It={class:"breakdown-item breakdown-item--this-week"},Lt={class:"breakdown-item__value"},Ft={class:"breakdown-item breakdown-item--other-week"},Ht={class:"breakdown-item__value"},Gt={class:"summary-card__value-wrapper"},Kt={class:"summary-card__value-main"},Vt=["title"],xt={class:"percentage-indicator__arrow"},jt={class:"percentage-indicator__value"},zt={class:"percentage-indicator__label"},Yt={class:"summary-card__breakdown"},Zt={class:"breakdown-item breakdown-item--this-week"},qt={class:"breakdown-item__value"},Qt={class:"breakdown-item breakdown-item--previous-week"},Jt={class:"breakdown-item__value"},Xt={class:"breakdown-item breakdown-item--older"},ea={class:"breakdown-item__value"},ta={class:"summary-card summary-card--stages"},aa={class:"summary-card__tags"},sa={key:0,class:"stage-tag stage-tag--empty"},ra={key:0,class:"summary-week-divider"},oa={key:1,class:"summary-week-block summary-week-block--previous"},na={class:"summary-week-block__title"},la={class:"summary-week-block__title-week"},ia={key:0,class:"summary-week-block__title-dates"},ca={class:"summary-week-block__cards"},da={class:"summary-card__value-wrapper"},ua={class:"summary-card__values-comparison"},ka={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},va={class:"summary-card__value"},ha={class:"value-label"},ma={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},ya={class:"summary-card__value summary-card__value--current-week"},pa={class:"value-label"},ga=["title"],ba={class:"percentage-indicator__arrow"},fa={class:"percentage-indicator__value"},_a={class:"percentage-indicator__label"},wa={class:"summary-card__value-wrapper"},Ca={class:"summary-card__values-comparison"},Ta={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},Wa={class:"summary-card__value-main"},$a={class:"value-label"},Aa={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},Da={class:"summary-card__value-main summary-card__value-main--current-week"},Sa={class:"value-label"},Na=["title"],Ea={class:"percentage-indicator__arrow"},Oa={class:"percentage-indicator__value"},Ba={class:"percentage-indicator__label"},Ma={class:"summary-card__breakdown"},Ua={class:"breakdown-item breakdown-item--this-week"},Ra={class:"breakdown-item__value"},Pa={class:"breakdown-item breakdown-item--other-week"},Ia={class:"breakdown-item__value"},La={class:"summary-card__value-wrapper"},Fa={class:"summary-card__values-comparison"},Ha={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},Ga={class:"summary-card__value-main"},Ka={class:"value-label"},Va={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},xa={class:"summary-card__value-main summary-card__value-main--current-week"},ja={class:"value-label"},za=["title"],Ya={class:"percentage-indicator__arrow"},Za={class:"percentage-indicator__value"},qa={class:"percentage-indicator__label"},Qa={class:"summary-card__breakdown"},Ja={class:"breakdown-item breakdown-item--this-week"},Xa={class:"breakdown-item__value"},es={class:"breakdown-item breakdown-item--previous-week"},ts={class:"breakdown-item__value"},as={class:"breakdown-item breakdown-item--older"},ss={class:"breakdown-item__value"},rs={class:"summary-card summary-card--stages summary-card--previous"},os={class:"summary-card__tags"},ns={key:0,class:"stage-tag stage-tag--empty"},ls={class:"ac-chart__body"},is={key:0,class:"split-charts-container"},cs={class:"chart-wrapper chart-wrapper--left"},ds={class:"chart-canvas-wrapper"},us={class:"chart-wrapper chart-wrapper--right"},ks={class:"chart-canvas-wrapper"},vs={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedPreviousWeek:0,carryoverTicketsCreatedOlder:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedPreviousWeek:[0],carryoverCreatedOlder:[0],carryoverCreatedOtherWeek:[0]},stagesByWeek:[],stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(T,{emit:u}){Fe.register(ze);const s=T,$=u,w=I(()=>{const e=s.meta?.weeks||[];return e.length>=2?e[e.length-2]:null}),f=[{value:"line",label:"Ð›Ð¸Ð½ÐµÐ¹Ð½Ñ‹Ð¹",icon:"ðŸ“ˆ"},{value:"bar",label:"Ð¡Ñ‚Ð¾Ð»Ð±Ñ‡Ð°Ñ‚Ñ‹Ð¹",icon:"ðŸ“Š"},{value:"doughnut",label:"ÐšÑ€ÑƒÐ³Ð¾Ð²Ð°Ñ",icon:"ðŸ©"}],g=L("line"),p={color:"#111827",font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:e=>e?.dataset?.borderColor||"#111827",borderWidth:1,borderRadius:4,padding:4,offset:8,formatter:e=>e==null||isNaN(e)?"":v(e),display:e=>{if(e?.chart?.config?.type!=="line")return!1;const r=e?.dataset?.data?.[e.dataIndex];return r!=null&&!isNaN(r)&&isFinite(r)}};I(()=>s.meta?.weekNumber??"â€”");const M=()=>{const e=s.meta?.weeks||[];return e.length>0?e.map(a=>`ÐÐµÐ´ÐµÐ»Ñ ${a.weekNumber}`):[s.meta?.weekNumber?`ÐÐµÐ´ÐµÐ»Ñ ${s.meta.weekNumber}`:"ÐÐµÐ´ÐµÐ»Ñ"]};function O(e,a,r,U=.3,R=0){if(!a)return((le,ye)=>{const Te=parseInt(le.slice(1,3),16),Ne=parseInt(le.slice(3,5),16),Ie=parseInt(le.slice(5,7),16);return`rgba(${Te}, ${Ne}, ${Ie}, ${ye})`})(r,U);const G=(ce,le)=>{const ye=parseInt(ce.slice(1,3),16),Te=parseInt(ce.slice(3,5),16),Ne=parseInt(ce.slice(5,7),16);return`rgba(${ye}, ${Te}, ${Ne}, ${le})`},se=e.createLinearGradient(0,a.bottom,0,a.top);return se.addColorStop(0,G(r,U)),se.addColorStop(1,G(r,R)),se}const q=I(()=>{const e=M(),a=Array.isArray(s.data.series?.new)&&s.data.series.new.length>0?s.data.series.new:[s.data.newTickets??0],r=Array.isArray(s.data.series?.closed)&&s.data.series.closed.length>0?s.data.series.closed:[s.data.closedTickets??0],U=Array.isArray(s.data.series?.closedCreatedThisWeek)&&s.data.series.closedCreatedThisWeek.length>0?s.data.series.closedCreatedThisWeek:[s.data.closedTicketsCreatedThisWeek??0],R=Array.isArray(s.data.series?.closedCreatedOtherWeek)&&s.data.series.closedCreatedOtherWeek.length>0?s.data.series.closedCreatedOtherWeek:[s.data.closedTicketsCreatedOtherWeek??0];return{labels:e,datasets:[{label:"ÐÐ¾Ð²Ñ‹Ðµ",data:a,backgroundColor:G=>{const se=G.chart,{ctx:ce,chartArea:le}=se;return O(ce,le,c.primary)},borderColor:c.primary,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.primary,pointBackgroundColor:c.primary,datalabels:{...p,anchor:"end",align:"top",offset:10,color:c.primary,borderColor:c.primary}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (Ð²ÑÐµ)",data:r,backgroundColor:G=>{const se=G.chart,{ctx:ce,chartArea:le}=se;return O(ce,le,c.success)},borderColor:c.success,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.success,pointBackgroundColor:c.success,datalabels:{...p,anchor:"start",align:"bottom",offset:10,color:c.success,borderColor:c.success}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:U,backgroundColor:c.successLight,borderColor:c.successLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:c.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.successLight,pointBackgroundColor:c.successLight,datalabels:{...p,anchor:"end",align:"bottom",offset:8,color:c.successLight,borderColor:c.successLight}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:R,backgroundColor:c.warning,borderColor:c.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:c.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.warning,pointBackgroundColor:c.warning,datalabels:{...p,anchor:"end",align:"bottom",offset:8,color:c.warning,borderColor:c.warning}}]}}),Q=I(()=>{const e=M(),a=Array.isArray(s.data.series?.carryover)&&s.data.series.carryover.length>0?s.data.series.carryover:[s.data.carryoverTickets??0],r=Array.isArray(s.data.series?.carryoverCreatedThisWeek)&&s.data.series.carryoverCreatedThisWeek.length>0?s.data.series.carryoverCreatedThisWeek:[s.data.carryoverTicketsCreatedThisWeek??0],U=Array.isArray(s.data.series?.carryoverCreatedPreviousWeek)&&s.data.series.carryoverCreatedPreviousWeek.length>0?s.data.series.carryoverCreatedPreviousWeek:[s.data.carryoverTicketsCreatedPreviousWeek??0],R=Array.isArray(s.data.series?.carryoverCreatedOlder)&&s.data.series.carryoverCreatedOlder.length>0?s.data.series.carryoverCreatedOlder:[s.data.carryoverTicketsCreatedOlder??0];return Array.isArray(s.data.series?.carryoverCreatedOtherWeek)&&s.data.series.carryoverCreatedOtherWeek.length>0?s.data.series.carryoverCreatedOtherWeek:s.data.carryoverTicketsCreatedOtherWeek,{labels:e,datasets:[{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (Ð²ÑÐµ)",data:a,backgroundColor:G=>{const se=G.chart,{ctx:ce,chartArea:le}=se;return O(ce,le,c.carryover)},borderColor:c.carryover,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryover,pointBackgroundColor:c.carryover,datalabels:{...p,anchor:"end",align:"top",offset:4,color:c.carryover,borderColor:c.carryover}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:r,backgroundColor:c.carryoverLight,borderColor:c.carryoverLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:c.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryoverLight,pointBackgroundColor:c.carryoverLight,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.carryoverLight,borderColor:c.carryoverLight}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:U,backgroundColor:c.warning,borderColor:c.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:c.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.warning,pointBackgroundColor:c.warning,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.warning,borderColor:c.warning}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð½ÐµÐ´ÐµÐ»ÑÐ¼Ð¸)",data:R,backgroundColor:c.carryoverDark,borderColor:c.carryoverDark,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:c.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryoverDark,pointBackgroundColor:c.carryoverDark,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.carryoverDark,borderColor:c.carryoverDark}}]}}),F=I(()=>{const e=s.meta?.weeks||[],a=e.length>0?e.map(Te=>`ÐÐµÐ´ÐµÐ»Ñ ${Te.weekNumber}`):[s.meta?.weekNumber?`ÐÐµÐ´ÐµÐ»Ñ ${s.meta.weekNumber}`:"ÐÐµÐ´ÐµÐ»Ñ"],r=Array.isArray(s.data.series?.new)&&s.data.series.new.length>0?s.data.series.new:[s.data.newTickets??0],U=Array.isArray(s.data.series?.closed)&&s.data.series.closed.length>0?s.data.series.closed:[s.data.closedTickets??0],R=Array.isArray(s.data.series?.closedCreatedThisWeek)&&s.data.series.closedCreatedThisWeek.length>0?s.data.series.closedCreatedThisWeek:[s.data.closedTicketsCreatedThisWeek??0],G=Array.isArray(s.data.series?.closedCreatedOtherWeek)&&s.data.series.closedCreatedOtherWeek.length>0?s.data.series.closedCreatedOtherWeek:[s.data.closedTicketsCreatedOtherWeek??0],se=Array.isArray(s.data.series?.carryover)&&s.data.series.carryover.length>0?s.data.series.carryover:[s.data.carryoverTickets??0],ce=Array.isArray(s.data.series?.carryoverCreatedThisWeek)&&s.data.series.carryoverCreatedThisWeek.length>0?s.data.series.carryoverCreatedThisWeek:[s.data.carryoverTicketsCreatedThisWeek??0],le=Array.isArray(s.data.series?.carryoverCreatedPreviousWeek)&&s.data.series.carryoverCreatedPreviousWeek.length>0?s.data.series.carryoverCreatedPreviousWeek:[s.data.carryoverTicketsCreatedPreviousWeek??0],ye=Array.isArray(s.data.series?.carryoverCreatedOlder)&&s.data.series.carryoverCreatedOlder.length>0?s.data.series.carryoverCreatedOlder:[s.data.carryoverTicketsCreatedOlder??0];return Array.isArray(s.data.series?.carryoverCreatedOtherWeek)&&s.data.series.carryoverCreatedOtherWeek.length>0?s.data.series.carryoverCreatedOtherWeek:s.data.carryoverTicketsCreatedOtherWeek,{labels:a,datasets:[{label:"ÐÐ¾Ð²Ñ‹Ðµ",data:r,backgroundColor:c.primary,borderColor:c.primary,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.primary,pointBackgroundColor:c.primary,datalabels:{...p,anchor:"end",align:"top",offset:10,color:c.primary,borderColor:c.primary}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (Ð²ÑÐµ)",data:U,backgroundColor:c.success,borderColor:c.success,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.success,pointBackgroundColor:c.success,datalabels:{...p,anchor:"start",align:"bottom",offset:10,color:c.success,borderColor:c.success}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:R,backgroundColor:c.successLight,borderColor:c.successLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:c.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.successLight,pointBackgroundColor:c.successLight,datalabels:{...p,anchor:"end",align:"bottom",offset:8,color:c.successLight,borderColor:c.successLight}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:G,backgroundColor:c.warning,borderColor:c.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:c.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.warning,pointBackgroundColor:c.warning,datalabels:{...p,anchor:"end",align:"bottom",offset:8,color:c.warning,borderColor:c.warning}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (Ð²ÑÐµ)",data:se,backgroundColor:c.carryover,borderColor:c.carryover,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryover,pointBackgroundColor:c.carryover,datalabels:{...p,anchor:"end",align:"top",offset:4,color:c.carryover,borderColor:c.carryover}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:ce,backgroundColor:c.carryoverLight,borderColor:c.carryoverLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:c.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryoverLight,pointBackgroundColor:c.carryoverLight,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.carryoverLight,borderColor:c.carryoverLight}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:le,backgroundColor:c.warning,borderColor:c.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:c.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.warning,pointBackgroundColor:c.warning,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.warning,borderColor:c.warning}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð½ÐµÐ´ÐµÐ»ÑÐ¼Ð¸)",data:ye,backgroundColor:c.carryoverDark,borderColor:c.carryoverDark,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:c.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryoverDark,pointBackgroundColor:c.carryoverDark,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.carryoverDark,borderColor:c.carryoverDark}}]}}),P=I(()=>({labels:["ÐÐ¾Ð²Ñ‹Ðµ","Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ","ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ"],datasets:[{data:[s.data.newTickets??0,s.data.closedTickets??0,s.data.carryoverTickets??0],backgroundColor:[c.primary,c.success,c.carryover],borderWidth:1}]})),N=I(()=>{switch(g.value){case"line":return We;case"bar":return et;case"doughnut":return Xe;default:return We}}),b=I(()=>g.value==="doughnut"?P.value:F.value),k=e=>{if(!e)return"â€”";try{return new Date(e).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return e}};function v(e){return e==null||isNaN(e)?"0":e>=1e3?e.toLocaleString("ru-RU"):e.toString()}function i(e){const a=e%10,r=e%100;return r>=11&&r<=14?"Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²":a===1?"Ñ‚Ð¸ÐºÐµÑ‚":a>=2&&a<=4?"Ñ‚Ð¸ÐºÐµÑ‚Ð°":"Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²"}const C=I(()=>({responsive:!0,maintainAspectRatio:!1,resizeDelay:0,animation:{duration:800,easing:"easeOutQuart"},interaction:{intersect:!1,mode:"index"},plugins:{datalabels:{...p,anchor:"end",align:"top"},tooltip:{enabled:!0,backgroundColor:"rgba(255, 255, 255, 0.98)",titleColor:"#111827",bodyColor:"#374151",borderColor:"#e5e7eb",borderWidth:1,cornerRadius:8,padding:16,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},displayColors:!0,boxPadding:6,usePointStyle:!0,animation:{duration:300,easing:"easeOutQuart"},callbacks:{title:e=>{if(!e||e.length===0)return"";const a=e[0]?.dataIndex,r=s.meta?.weeks||[];if(r.length>0&&a!==void 0&&r[a]){const se=r[a];return`ÐÐµÐ´ÐµÐ»Ñ ${se.weekNumber} (${k(se.weekStartUtc)} â€” ${k(se.weekEndUtc)})`}const U=s.meta?.weekNumber,R=s.meta?.weekStartUtc,G=s.meta?.weekEndUtc;return U&&R&&G?`ÐÐµÐ´ÐµÐ»Ñ ${U} (${k(R)} â€” ${k(G)})`:e[0]?.label||""},label:e=>{const a=e.parsed.y,r=e.dataset.label||"";if(a==null||isNaN(a))return`${r}: 0 Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`;const U=v(a),R=i(a);return`${r}: ${U} ${R}`}}},legend:{position:"bottom",labels:{font:{size:13,weight:"500"},padding:12,boxWidth:18,boxHeight:12,usePointStyle:!0,pointStyle:"circle",generateLabels:e=>Fe.defaults.plugins.legend.labels.generateLabels(e).map((r,U)=>{const R=e.data.datasets[U],G=e.getDatasetMeta(U),se=R.borderDash&&Array.isArray(R.borderDash)&&R.borderDash.length>0||R.borderWidth===2||R.fill===!1;return G.hidden?(r.fontColor="#9ca3af",r.textDecoration="line-through",r.opacity=.5):se?r.fontColor="#6b7280":r.fontColor="#111827",r})},onClick:(e,a)=>{const r=a.datasetIndex;if(r==null){console.warn("[Legend] Invalid datasetIndex:",r);return}const U=e.chart;if(!U){console.warn("[Legend] Chart not found");return}const R=U.getDatasetMeta(r);if(!R){console.warn("[Legend] Dataset meta not found for index:",r);return}R.hidden=!R.hidden,U.update("active")},onHover:(e,a)=>{e.native&&e.native.target&&(e.native.target.style.cursor="pointer")},onLeave:(e,a)=>{e.native&&e.native.target&&(e.native.target.style.cursor="default")}}},scales:g.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10,color:"#374151",callback:e=>e==null||isNaN(e)?"0":v(e)},title:{display:!1},grid:{color:e=>{if(!e||!e.tick||e.tick.value===void 0)return"#e5e7eb";const a=e.tick.value;return isNaN(a)||!isFinite(a)?"#e5e7eb":a===0||a%5===0?"#d1d5db":"#e5e7eb"},lineWidth:e=>{if(!e||!e.tick||e.tick.value===void 0)return 1;const a=e.tick.value;return isNaN(a)||!isFinite(a)?1:a===0||a%5===0?1.5:1}}},x:{ticks:{maxRotation:45,minRotation:45,font:{size:14},padding:10,color:"#374151"},title:{display:!1},grid:{color:"#e5e7eb",lineWidth:1}}}})),A=I(()=>{if(s.data?.series){const e=s.data.series,a=Math.max((Array.isArray(e.new)?e.new.length:0)-1,(Array.isArray(e.closed)?e.closed.length:0)-1,(Array.isArray(e.closedCreatedThisWeek)?e.closedCreatedThisWeek.length:0)-1,(Array.isArray(e.closedCreatedOtherWeek)?e.closedCreatedOtherWeek.length:0)-1,(Array.isArray(e.carryover)?e.carryover.length:0)-1,(Array.isArray(e.carryoverCreatedThisWeek)?e.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(e.carryoverCreatedPreviousWeek)?e.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(e.carryoverCreatedOlder)?e.carryoverCreatedOlder.length:0)-1,(Array.isArray(e.carryoverCreatedOtherWeek)?e.carryoverCreatedOtherWeek.length:0)-1,-1);if(a>=0){const r={newTickets:Array.isArray(e.new)&&e.new[a]!==void 0?e.new[a]:0,closedTickets:Array.isArray(e.closed)&&e.closed[a]!==void 0?e.closed[a]:0,closedTicketsCreatedThisWeek:Array.isArray(e.closedCreatedThisWeek)&&e.closedCreatedThisWeek[a]!==void 0?e.closedCreatedThisWeek[a]:0,closedTicketsCreatedOtherWeek:Array.isArray(e.closedCreatedOtherWeek)&&e.closedCreatedOtherWeek[a]!==void 0?e.closedCreatedOtherWeek[a]:0,carryoverTickets:Array.isArray(e.carryover)&&e.carryover[a]!==void 0?e.carryover[a]:0,carryoverTicketsCreatedThisWeek:Array.isArray(e.carryoverCreatedThisWeek)&&e.carryoverCreatedThisWeek[a]!==void 0?e.carryoverCreatedThisWeek[a]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(e.carryoverCreatedPreviousWeek)&&e.carryoverCreatedPreviousWeek[a]!==void 0?e.carryoverCreatedPreviousWeek[a]:0,carryoverTicketsCreatedOlder:Array.isArray(e.carryoverCreatedOlder)&&e.carryoverCreatedOlder[a]!==void 0?e.carryoverCreatedOlder[a]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(e.carryoverCreatedOtherWeek)&&e.carryoverCreatedOtherWeek[a]!==void 0?e.carryoverCreatedOtherWeek[a]:0};if(r.carryoverTickets>0&&console.log("[DEBUG currentWeekData]",{total:r.carryoverTickets,thisWeek:r.carryoverTicketsCreatedThisWeek,previousWeek:r.carryoverTicketsCreatedPreviousWeek,older:r.carryoverTicketsCreatedOlder,otherWeek:r.carryoverTicketsCreatedOtherWeek,sum:r.carryoverTicketsCreatedThisWeek+r.carryoverTicketsCreatedPreviousWeek+r.carryoverTicketsCreatedOlder,lastIndex:a,series:{carryoverCreatedPreviousWeek:e.carryoverCreatedPreviousWeek,carryoverCreatedOlder:e.carryoverCreatedOlder,carryoverCreatedPreviousWeekLength:e.carryoverCreatedPreviousWeek?.length,carryoverCreatedOlderLength:e.carryoverCreatedOlder?.length,carryoverCreatedPreviousWeekLast:e.carryoverCreatedPreviousWeek?.[a],carryoverCreatedOlderLast:e.carryoverCreatedOlder?.[a]},currentWeek:s.data.currentWeek,data:{carryoverTicketsCreatedPreviousWeek:s.data.carryoverTicketsCreatedPreviousWeek,carryoverTicketsCreatedOlder:s.data.carryoverTicketsCreatedOlder}}),r.newTickets>0||r.closedTickets>0||r.carryoverTickets>0)return r}}if(s.data?.currentWeek&&typeof s.data.currentWeek=="object"){const e=s.data.currentWeek;if((e.newTickets??0)>0||(e.closedTickets??0)>0||(e.carryoverTickets??0)>0)return e}if(s.data?.weeksData&&Array.isArray(s.data.weeksData)&&s.data.weeksData.length>0){const e=s.data.weeksData[s.data.weeksData.length-1];if((e.newTickets??0)>0||(e.closedTickets??0)>0||(e.carryoverTickets??0)>0)return e}if(s.data?.series){const e=s.data.series,a=Math.max((Array.isArray(e.new)?e.new.length:0)-1,(Array.isArray(e.closed)?e.closed.length:0)-1,(Array.isArray(e.carryover)?e.carryover.length:0)-1,-1);if(a>=0)return{newTickets:Array.isArray(e.new)&&e.new[a]!==void 0?e.new[a]:0,closedTickets:Array.isArray(e.closed)&&e.closed[a]!==void 0?e.closed[a]:0,closedTicketsCreatedThisWeek:Array.isArray(e.closedCreatedThisWeek)&&e.closedCreatedThisWeek[a]!==void 0?e.closedCreatedThisWeek[a]:0,closedTicketsCreatedOtherWeek:Array.isArray(e.closedCreatedOtherWeek)&&e.closedCreatedOtherWeek[a]!==void 0?e.closedCreatedOtherWeek[a]:0,carryoverTickets:Array.isArray(e.carryover)&&e.carryover[a]!==void 0?e.carryover[a]:0,carryoverTicketsCreatedThisWeek:Array.isArray(e.carryoverCreatedThisWeek)&&e.carryoverCreatedThisWeek[a]!==void 0?e.carryoverCreatedThisWeek[a]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(e.carryoverCreatedPreviousWeek)&&e.carryoverCreatedPreviousWeek[a]!==void 0?e.carryoverCreatedPreviousWeek[a]:0,carryoverTicketsCreatedOlder:Array.isArray(e.carryoverCreatedOlder)&&e.carryoverCreatedOlder[a]!==void 0?e.carryoverCreatedOlder[a]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(e.carryoverCreatedOtherWeek)&&e.carryoverCreatedOtherWeek[a]!==void 0?e.carryoverCreatedOtherWeek[a]:0}}return s.data||{}}),y=I(()=>{const e=s.meta?.weeks||[];return e.length>0?e[e.length-1]:{weekNumber:s.meta?.currentWeek?.weekNumber??s.meta?.weekNumber??null,weekStartUtc:s.meta?.currentWeek?.weekStartUtc??s.meta?.weekStartUtc??null,weekEndUtc:s.meta?.currentWeek?.weekEndUtc??s.meta?.weekEndUtc??null}}),n=I(()=>{if(s.data?.series){const e=s.data.series,a=Math.max((Array.isArray(e.new)?e.new.length:0)-1,(Array.isArray(e.closed)?e.closed.length:0)-1,(Array.isArray(e.closedCreatedThisWeek)?e.closedCreatedThisWeek.length:0)-1,(Array.isArray(e.closedCreatedOtherWeek)?e.closedCreatedOtherWeek.length:0)-1,(Array.isArray(e.carryover)?e.carryover.length:0)-1,(Array.isArray(e.carryoverCreatedThisWeek)?e.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(e.carryoverCreatedPreviousWeek)?e.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(e.carryoverCreatedOlder)?e.carryoverCreatedOlder.length:0)-1,(Array.isArray(e.carryoverCreatedOtherWeek)?e.carryoverCreatedOtherWeek.length:0)-1,-1);if(a>=1){const r=a-1,U=s.meta?.weeks?.[r],R={weekNumber:U?.weekNumber??null,weekStartUtc:U?.weekStartUtc??null,weekEndUtc:U?.weekEndUtc??null,newTickets:Array.isArray(e.new)&&e.new[r]!==void 0?e.new[r]:0,closedTickets:Array.isArray(e.closed)&&e.closed[r]!==void 0?e.closed[r]:0,closedTicketsCreatedThisWeek:Array.isArray(e.closedCreatedThisWeek)&&e.closedCreatedThisWeek[r]!==void 0?e.closedCreatedThisWeek[r]:0,closedTicketsCreatedOtherWeek:Array.isArray(e.closedCreatedOtherWeek)&&e.closedCreatedOtherWeek[r]!==void 0?e.closedCreatedOtherWeek[r]:0,carryoverTickets:Array.isArray(e.carryover)&&e.carryover[r]!==void 0?e.carryover[r]:0,carryoverTicketsCreatedThisWeek:Array.isArray(e.carryoverCreatedThisWeek)&&e.carryoverCreatedThisWeek[r]!==void 0?e.carryoverCreatedThisWeek[r]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(e.carryoverCreatedPreviousWeek)&&e.carryoverCreatedPreviousWeek[r]!==void 0?e.carryoverCreatedPreviousWeek[r]:0,carryoverTicketsCreatedOlder:Array.isArray(e.carryoverCreatedOlder)&&e.carryoverCreatedOlder[r]!==void 0?e.carryoverCreatedOlder[r]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(e.carryoverCreatedOtherWeek)&&e.carryoverCreatedOtherWeek[r]!==void 0?e.carryoverCreatedOtherWeek[r]:0};if(R.newTickets>0||R.closedTickets>0||R.carryoverTickets>0)return R}}if(s.data?.weeksData&&Array.isArray(s.data.weeksData)&&s.data.weeksData.length>=2){const e=s.data.weeksData.length-2,a=s.data.weeksData[e],r=s.meta?.weeks?.[e];if((a.newTickets??0)>0||(a.closedTickets??0)>0||(a.carryoverTickets??0)>0)return{weekNumber:a.weekNumber??r?.weekNumber??null,weekStartUtc:r?.weekStartUtc??null,weekEndUtc:r?.weekEndUtc??null,newTickets:a.newTickets??0,closedTickets:a.closedTickets??0,closedTicketsCreatedThisWeek:a.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:a.closedTicketsCreatedOtherWeek??0,carryoverTickets:a.carryoverTickets??0,carryoverTicketsCreatedThisWeek:a.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:a.carryoverTicketsCreatedOtherWeek??0}}if(s.data?.series){const e=s.data.series,a=Math.max((Array.isArray(e.new)?e.new.length:0)-1,(Array.isArray(e.closed)?e.closed.length:0)-1,(Array.isArray(e.carryover)?e.carryover.length:0)-1,-1);if(a>=1){const r=a-1,U=s.meta?.weeks?.[r];return{weekNumber:U?.weekNumber??null,weekStartUtc:U?.weekStartUtc??null,weekEndUtc:U?.weekEndUtc??null,newTickets:Array.isArray(e.new)&&e.new[r]!==void 0?e.new[r]:0,closedTickets:Array.isArray(e.closed)&&e.closed[r]!==void 0?e.closed[r]:0,closedTicketsCreatedThisWeek:Array.isArray(e.closedCreatedThisWeek)&&e.closedCreatedThisWeek[r]!==void 0?e.closedCreatedThisWeek[r]:0,closedTicketsCreatedOtherWeek:Array.isArray(e.closedCreatedOtherWeek)&&e.closedCreatedOtherWeek[r]!==void 0?e.closedCreatedOtherWeek[r]:0,carryoverTickets:Array.isArray(e.carryover)&&e.carryover[r]!==void 0?e.carryover[r]:0,carryoverTicketsCreatedThisWeek:Array.isArray(e.carryoverCreatedThisWeek)&&e.carryoverCreatedThisWeek[r]!==void 0?e.carryoverCreatedThisWeek[r]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(e.carryoverCreatedPreviousWeek)&&e.carryoverCreatedPreviousWeek[r]!==void 0?e.carryoverCreatedPreviousWeek[r]:0,carryoverTicketsCreatedOlder:Array.isArray(e.carryoverCreatedOlder)&&e.carryoverCreatedOlder[r]!==void 0?e.carryoverCreatedOlder[r]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(e.carryoverCreatedOtherWeek)&&e.carryoverCreatedOtherWeek[r]!==void 0?e.carryoverCreatedOtherWeek[r]:0}}}return null}),E=I(()=>{const e=s.data?.stagesByWeek;return Array.isArray(e)?e:null}),W=I(()=>{const e=E.value;if(e&&e.length>0){const a=e.length-1,r=e[a];if(Array.isArray(r))return r}return s.data?.stages??[]}),S=I(()=>{const e=E.value;if(e&&e.length>=2){const a=e.length-2,r=e[a];if(Array.isArray(r))return r}return[]}),D=I(()=>n.value?.weekNumber?`ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð½ÐµÐ´ÐµÐ»Ð¸ ${n.value.weekNumber}`:"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…");function K(e,a){if(typeof e!="number"||isNaN(e)||a==null||typeof a!="number"||isNaN(a)||a===0)return null;if(e===a)return 0;const r=(e-a)/a*100;return!isFinite(r)||isNaN(r)?null:r}function H(e){return e==null||isNaN(e)?"":`${e>=0?"+":""}${e.toFixed(1)}%`}const x=I(()=>{if(s.data?.series){const e=s.data.series,a=Math.max((Array.isArray(e.new)?e.new.length:0)-1,(Array.isArray(e.closed)?e.closed.length:0)-1,(Array.isArray(e.carryover)?e.carryover.length:0)-1,-1);if(a>=2){const r=a-2;return{weekNumber:s.meta?.weeks?.[r]?.weekNumber??null,newTickets:Array.isArray(e.new)&&e.new[r]!==void 0?e.new[r]:0,closedTickets:Array.isArray(e.closed)&&e.closed[r]!==void 0?e.closed[r]:0,carryoverTickets:Array.isArray(e.carryover)&&e.carryover[r]!==void 0?e.carryover[r]:0}}}return null}),V=I(()=>{const e=A.value,a=n.value;return!e||!a?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:K(e.newTickets??0,a.newTickets??0),closedTickets:K(e.closedTickets??0,a.closedTickets??0),carryoverTickets:K(e.carryoverTickets??0,a.carryoverTickets??0)}}),Z=I(()=>{const e=n.value,a=x.value;return!e||!a?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:K(e.newTickets??0,a.newTickets??0),closedTickets:K(e.closedTickets??0,a.closedTickets??0),carryoverTickets:K(e.carryoverTickets??0,a.carryoverTickets??0)}});function ue(e,a){if(!e||!a)return"";try{const r=new Date(e),U=new Date(a),R=r.getUTCDate(),G=r.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),se=r.getUTCFullYear(),ce=U.getUTCDate(),le=U.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),ye=U.getUTCFullYear();return se===ye&&G===le?`${R} â€” ${ce} ${G}`:se===ye?`${R} ${G} â€” ${ce} ${le}`:`${R} ${G} ${se} â€” ${ce} ${le} ${ye}`}catch(r){return console.error("[formatWeekDates] Error:",r),""}}const ge=e=>{const a=A.value,r=a?.newTickets??0,U=a?.closedTickets??0,R=a?.carryoverTickets??0,G=y.value;e==="new"&&r>0?$("open-stages",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc}):e==="closed"&&U>0?$("open-responsible",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc}):e==="carryover"&&R>0&&$("open-carryover",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc})},h=e=>{const a=n.value;if(!a)return;const r=a?.newTickets??0,U=a?.closedTickets??0,R=a?.carryoverTickets??0,G=w.value;G&&(e==="new"&&r>0?$("open-stages",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc}):e==="closed"&&U>0?$("open-responsible",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc}):e==="carryover"&&R>0&&$("open-carryover",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc}))};return(e,a)=>(o(),l("div",ut,[t("header",kt,[t("div",null,[a[6]||(a[6]=t("h2",{class:"ac-chart__title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),t("p",vt," ÐÐµÐ´ÐµÐ»Ñ "+d(T.meta?.currentWeek?.weekNumber??T.meta?.weekNumber??"â€”")+" Â· "+d((T.meta?.currentWeek?.weekStartUtc??T.meta?.weekStartUtc)||"â€”")+" â€” "+d((T.meta?.currentWeek?.weekEndUtc??T.meta?.weekEndUtc)||"â€”")+" (UTC) ",1)]),t("div",ht,[t("div",mt,[(o(),l(te,null,ae(f,r=>t("button",{key:r.value,class:oe(["chart-type-btn",{active:g.value===r.value}]),onClick:U=>g.value=r.value},[t("span",pt,d(r.icon),1),t("span",gt,d(r.label),1)],10,yt)),64))])])]),t("section",bt,[t("div",ft,[t("h3",_t,[a[7]||(a[7]=t("span",{class:"summary-week-block__title-text"},"Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð½ÐµÐ´ÐµÐ»Ñ",-1)),t("span",wt," ÐÐµÐ´ÐµÐ»Ñ "+d(y.value.weekNumber??"â€”"),1),y.value.weekStartUtc?(o(),l("span",Ct,d(ue(y.value.weekStartUtc,y.value.weekEndUtc)),1)):z("",!0)]),t("div",Tt,[t("div",{class:"summary-card summary-card--new",onClick:a[0]||(a[0]=r=>ge("new"))},[a[8]||(a[8]=t("div",{class:"summary-card__label"},"ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),t("div",Wt,[t("div",$t,d(A.value?.newTickets??0),1),V.value.newTickets!==null?(o(),l("div",{key:0,class:oe(["percentage-indicator",V.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${n.value?.weekNumber??"â€”"}): ${H(V.value.newTickets)}`},[t("span",Dt,d(V.value.newTickets>=0?"â†‘":"â†“"),1),t("span",St,d(H(V.value.newTickets)),1),t("span",Nt,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(n.value?.weekNumber??"â€”"),1)],10,At)):z("",!0)])]),t("div",{class:"summary-card summary-card--closed-breakdown",onClick:a[1]||(a[1]=r=>ge("closed"))},[a[13]||(a[13]=t("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),t("div",Et,[t("div",Ot,d(A.value?.closedTickets??0),1),V.value.closedTickets!==null?(o(),l("div",{key:0,class:oe(["percentage-indicator",V.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${n.value?.weekNumber??"â€”"}): ${H(V.value.closedTickets)}`},[t("span",Mt,d(V.value.closedTickets>=0?"â†‘":"â†“"),1),t("span",Ut,d(H(V.value.closedTickets)),1),t("span",Rt,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(n.value?.weekNumber??"â€”"),1)],10,Bt)):z("",!0)]),t("div",Pt,[t("div",It,[a[9]||(a[9]=t("span",{class:"breakdown-item__icon"},"âœ“",-1)),t("span",Lt,d(A.value?.closedTicketsCreatedThisWeek??0),1),a[10]||(a[10]=t("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))]),t("div",Ft,[a[11]||(a[11]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",Ht,d(A.value?.closedTicketsCreatedOtherWeek??0),1),a[12]||(a[12]=t("span",{class:"breakdown-item__label"},"Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))])])]),t("div",{class:"summary-card summary-card--carryover-breakdown",onClick:a[2]||(a[2]=r=>ge("carryover"))},[a[20]||(a[20]=t("div",{class:"summary-card__label"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",-1)),t("div",Gt,[t("div",Kt,d(A.value?.carryoverTickets??0),1),V.value.carryoverTickets!==null?(o(),l("div",{key:0,class:oe(["percentage-indicator",V.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${n.value?.weekNumber??"â€”"}): ${H(V.value.carryoverTickets)}`},[t("span",xt,d(V.value.carryoverTickets>=0?"â†‘":"â†“"),1),t("span",jt,d(H(V.value.carryoverTickets)),1),t("span",zt,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(n.value?.weekNumber??"â€”"),1)],10,Vt)):z("",!0)]),t("div",Yt,[t("div",Zt,[a[14]||(a[14]=t("span",{class:"breakdown-item__icon"},"âœ“",-1)),t("span",qt,d(A.value?.carryoverTicketsCreatedThisWeek??0),1),a[15]||(a[15]=t("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),t("div",Qt,[a[16]||(a[16]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",Jt,d(A.value?.carryoverTicketsCreatedPreviousWeek??0),1),a[17]||(a[17]=t("span",{class:"breakdown-item__label"},"Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),t("div",Xt,[a[18]||(a[18]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",ea,d(A.value?.carryoverTicketsCreatedOlder??0),1),a[19]||(a[19]=t("span",{class:"breakdown-item__label"},"Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ",-1))])])]),t("div",ta,[a[21]||(a[21]=t("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),t("div",aa,[(o(!0),l(te,null,ae(W.value,r=>(o(),l("span",{key:r.stageId,class:"stage-tag"},d(r.stageName||r.stageId)+" â€” "+d(r.count),1))),128)),!W.value||W.value.length===0?(o(),l("span",sa," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):z("",!0)])])])]),n.value?(o(),l("div",ra,[...a[22]||(a[22]=[t("div",{class:"summary-week-divider__line"},null,-1),t("div",{class:"summary-week-divider__label"},"ÐŸÑ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð°Ñ Ð½ÐµÐ´ÐµÐ»Ñ",-1)])])):z("",!0),n.value?(o(),l("div",oa,[t("h3",na,[a[23]||(a[23]=t("span",{class:"summary-week-block__title-text"},"ÐŸÑ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð°Ñ Ð½ÐµÐ´ÐµÐ»Ñ",-1)),t("span",la," ÐÐµÐ´ÐµÐ»Ñ "+d(n.value.weekNumber??"â€”"),1),n.value.weekStartUtc?(o(),l("span",ia,d(ue(n.value.weekStartUtc,n.value.weekEndUtc)),1)):z("",!0)]),t("div",ca,[t("div",{class:"summary-card summary-card--new summary-card--previous summary-card--clickable",onClick:a[3]||(a[3]=r=>h("new"))},[a[24]||(a[24]=t("div",{class:"summary-card__label"},"ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),t("div",da,[t("div",ua,[t("div",ka,[t("div",va,d(n.value?.newTickets??0),1),t("span",ha,"ÐÐµÐ´ÐµÐ»Ñ "+d(n.value?.weekNumber??"â€”"),1)]),t("div",ma,[t("div",ya,d(x.value?.newTickets??0),1),t("span",pa,"ÐÐµÐ´ÐµÐ»Ñ "+d(x.value?.weekNumber??"â€”"),1)])]),Z.value.newTickets!==null?(o(),l("div",{key:0,class:oe(["percentage-indicator",Z.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${x.value?.weekNumber??"â€”"}): ${H(Z.value.newTickets)}`},[t("span",ba,d(Z.value.newTickets>=0?"â†‘":"â†“"),1),t("span",fa,d(H(Z.value.newTickets)),1),t("span",_a,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(x.value?.weekNumber??"â€”"),1)],10,ga)):z("",!0)])]),t("div",{class:"summary-card summary-card--closed-breakdown summary-card--previous summary-card--clickable",onClick:a[4]||(a[4]=r=>h("closed"))},[a[29]||(a[29]=t("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),t("div",wa,[t("div",Ca,[t("div",Ta,[t("div",Wa,d(n.value?.closedTickets??0),1),t("span",$a,"ÐÐµÐ´ÐµÐ»Ñ "+d(n.value?.weekNumber??"â€”"),1)]),t("div",Aa,[t("div",Da,d(x.value?.closedTickets??0),1),t("span",Sa,"ÐÐµÐ´ÐµÐ»Ñ "+d(x.value?.weekNumber??"â€”"),1)])]),Z.value.closedTickets!==null?(o(),l("div",{key:0,class:oe(["percentage-indicator",Z.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${x.value?.weekNumber??"â€”"}): ${H(Z.value.closedTickets)}`},[t("span",Ea,d(Z.value.closedTickets>=0?"â†‘":"â†“"),1),t("span",Oa,d(H(Z.value.closedTickets)),1),t("span",Ba,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(x.value?.weekNumber??"â€”"),1)],10,Na)):z("",!0)]),t("div",Ma,[t("div",Ua,[a[25]||(a[25]=t("span",{class:"breakdown-item__icon"},"âœ“",-1)),t("span",Ra,d(n.value?.closedTicketsCreatedThisWeek??0),1),a[26]||(a[26]=t("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))]),t("div",Pa,[a[27]||(a[27]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",Ia,d(n.value?.closedTicketsCreatedOtherWeek??0),1),a[28]||(a[28]=t("span",{class:"breakdown-item__label"},"Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))])])]),t("div",{class:"summary-card summary-card--carryover-breakdown summary-card--previous summary-card--clickable",onClick:a[5]||(a[5]=r=>h("carryover"))},[a[36]||(a[36]=t("div",{class:"summary-card__label"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",-1)),t("div",La,[t("div",Fa,[t("div",Ha,[t("div",Ga,d(n.value?.carryoverTickets??0),1),t("span",Ka,"ÐÐµÐ´ÐµÐ»Ñ "+d(n.value?.weekNumber??"â€”"),1)]),t("div",Va,[t("div",xa,d(x.value?.carryoverTickets??0),1),t("span",ja,"ÐÐµÐ´ÐµÐ»Ñ "+d(x.value?.weekNumber??"â€”"),1)])]),Z.value.carryoverTickets!==null?(o(),l("div",{key:0,class:oe(["percentage-indicator",Z.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${x.value?.weekNumber??"â€”"}): ${H(Z.value.carryoverTickets)}`},[t("span",Ya,d(Z.value.carryoverTickets>=0?"â†‘":"â†“"),1),t("span",Za,d(H(Z.value.carryoverTickets)),1),t("span",qa,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(x.value?.weekNumber??"â€”"),1)],10,za)):z("",!0)]),t("div",Qa,[t("div",Ja,[a[30]||(a[30]=t("span",{class:"breakdown-item__icon"},"âœ“",-1)),t("span",Xa,d(n.value?.carryoverTicketsCreatedThisWeek??0),1),a[31]||(a[31]=t("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),t("div",es,[a[32]||(a[32]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",ts,d(n.value?.carryoverTicketsCreatedPreviousWeek??0),1),a[33]||(a[33]=t("span",{class:"breakdown-item__label"},"Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),t("div",as,[a[34]||(a[34]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",ss,d(n.value?.carryoverTicketsCreatedOlder??0),1),a[35]||(a[35]=t("span",{class:"breakdown-item__label"},"Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ",-1))])])]),t("div",rs,[a[37]||(a[37]=t("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),t("div",os,[(o(!0),l(te,null,ae(S.value,r=>(o(),l("span",{key:r.stageId,class:"stage-tag"},d(r.stageName||r.stageId)+" â€” "+d(r.count),1))),128)),!S.value||S.value.length===0?(o(),l("span",ns,d(D.value),1)):z("",!0)])])])])):z("",!0)]),t("div",ls,[g.value==="line"?(o(),l("div",is,[t("div",cs,[a[38]||(a[38]=t("h3",{class:"chart-subtitle"},"ÐÐ¾Ð²Ñ‹Ðµ Ð¸ Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹",-1)),t("div",ds,[J(De(We),{data:q.value,options:C.value},null,8,["data","options"])])]),t("div",us,[a[39]||(a[39]=t("h3",{class:"chart-subtitle"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹",-1)),t("div",ks,[J(De(We),{data:Q.value,options:C.value},null,8,["data","options"])])])])):(o(),me(tt(N.value),{key:1,data:b.value,options:C.value},null,8,["data","options"]))])]))}},hs=fe(vs,[["__scopeId","data-v-3666e13a"]]),ms={class:"summary-cards-months"},ys={class:"summary-card summary-card--new"},ps={class:"card-content"},gs={class:"card-main-value"},bs=["title"],fs={class:"card-month-breakdown"},_s={class:"month-name"},ws={class:"month-value"},Cs={key:0,class:"month-item month-item--empty"},Ts={class:"summary-card summary-card--closed"},Ws={class:"card-content"},$s={class:"card-main-value"},As=["title"],Ds={class:"card-month-breakdown-hierarchical"},Ss={class:"month-header"},Ns={class:"month-name"},Es={class:"month-value"},Os={class:"month-breakdown"},Bs={class:"breakdown-item breakdown-this-week"},Ms={class:"breakdown-value"},Us={class:"breakdown-item breakdown-other-week"},Rs={class:"breakdown-value"},Ps={key:0,class:"month-item-hierarchical month-item--empty"},Is={class:"summary-card summary-card--carryover"},Ls={class:"card-content"},Fs={class:"card-current-value"},Hs={class:"current-value"},Gs=["title"],Ks={class:"card-month-breakdown"},Vs={class:"month-name"},xs={class:"month-value"},js={key:0,class:"month-item month-item--empty"},zs={class:"summary-card summary-card--stages"},Ys={class:"card-content"},Zs={class:"stages-list"},qs={class:"stage-icon"},Qs={class:"stage-name"},Js={class:"stage-value"},Xs={key:0,class:"stage-item stage-item--empty"},er={__name:"SummaryCardsMonths",props:{data:{type:Object,required:!0,default:()=>({newTickets:0,newTicketsByMonth:[],closedTickets:0,closedTicketsByMonth:[],carryoverTickets:0,carryoverTicketsByMonth:[],stages:[]})}},setup(T){const u=T;function s(k){return k==null||isNaN(k)?"0":k>=1e6?(k/1e6).toFixed(1)+"M":k>=1e3?k.toLocaleString("ru-RU"):k.toString()}function $(k){return k==null||isNaN(k)?"":`${k>=0?"+":""}${k.toFixed(1)}%`}function w(k,v){if(typeof k!="number"||isNaN(k)||v==null||typeof v!="number"||isNaN(v)||v===0)return null;if(k===v)return 0;const i=(k-v)/v*100;return!isFinite(i)||isNaN(i)?null:i}const f=I(()=>u.data?.newTickets||0),g=I(()=>s(f.value)),p=I(()=>u.data?.newTicketsByMonth||[]),M=I(()=>u.data?.closedTicketsByMonth||[]),O=I(()=>u.data?.carryoverTicketsByMonth||[]),q=I(()=>{const k=O.value;return k.length===0?0:k[k.length-1]?.count||0}),Q=I(()=>{const k=typeof u.data?.newTickets=="number"?u.data.newTickets:parseInt(u.data?.newTickets)||0,v=u.data?.previousPeriodData?.newTickets;return w(k,v)}),F=I(()=>{const k=typeof u.data?.closedTickets=="number"?u.data.closedTickets:parseInt(u.data?.closedTickets)||0,v=u.data?.previousPeriodData?.closedTickets;return w(k,v)}),P=I(()=>{const k=q.value,v=O.value,i=v.length>0?v[0]?.count||0:null;return w(k,i)});function N(k){return{"DT140_12:SUCCESS":"stage-success","DT140_12:FAIL":"stage-fail","DT140_12:UC_0GBU8Z":"stage-other"}[k]||""}function b(k){return{"DT140_12:SUCCESS":"âœ“","DT140_12:FAIL":"âœ—","DT140_12:UC_0GBU8Z":"âš "}[k]||"â€¢"}return(k,v)=>(o(),l("div",ms,[t("div",ys,[v[0]||(v[0]=t("h3",{class:"card-title"},"ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´",-1)),t("div",ps,[t("div",gs,[ve(d(g.value)+" ",1),Q.value!==null?(o(),l("span",{key:0,class:oe(["percentage-badge",Q.value>=0?"positive":"negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð°: ${$(Q.value)}`},d($(Q.value)),11,bs)):z("",!0)]),t("div",fs,[(o(!0),l(te,null,ae(p.value,i=>(o(),l("div",{key:`new-${i.month}`,class:"month-item"},[t("span",_s,d(i.monthName)+":",1),t("span",ws,d(s(i.count)),1)]))),128)),p.value.length===0?(o(),l("div",Cs," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):z("",!0)])])]),t("div",Ts,[v[5]||(v[5]=t("h3",{class:"card-title"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð²ÑÐµÐ³Ð¾",-1)),t("div",Ws,[t("div",$s,[ve(d(s(T.data.closedTickets||0))+" ",1),F.value!==null?(o(),l("span",{key:0,class:oe(["percentage-badge",F.value>=0?"positive":"negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð°: ${$(F.value)}`},d($(F.value)),11,As)):z("",!0)]),t("div",Ds,[(o(!0),l(te,null,ae(M.value,i=>(o(),l("div",{key:`closed-${i.month}`,class:"month-item-hierarchical"},[t("div",Ss,[t("span",Ns,d(i.monthName)+":",1),t("span",Es,d(s(i.count||0)),1)]),t("div",Os,[t("div",Bs,[v[1]||(v[1]=t("span",{class:"breakdown-icon"},"âœ“",-1)),v[2]||(v[2]=t("span",{class:"breakdown-label"},"ÑÑ‚Ð¾Ð³Ð¾ Ð¼ÐµÑÑÑ†Ð°:",-1)),t("span",Ms,d(s(i.closedCreatedThisWeek||0)),1)]),t("div",Us,[v[3]||(v[3]=t("span",{class:"breakdown-icon"},"â†»",-1)),v[4]||(v[4]=t("span",{class:"breakdown-label"},"Ð´Ñ€ÑƒÐ³Ð¾Ð³Ð¾ Ð¼ÐµÑÑÑ†Ð°:",-1)),t("span",Rs,d(s(i.closedCreatedOtherWeek||0)),1)])])]))),128)),M.value.length===0?(o(),l("div",Ps," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):z("",!0)])])]),t("div",Is,[v[7]||(v[7]=t("h3",{class:"card-title"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ð²ÑÐµÐ³Ð¾",-1)),v[8]||(v[8]=t("p",{class:"card-hint"},"ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° Ð² Ñ‚Ñ€ÐµÑ… Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ… Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… ÑÑ‚Ð°Ð´Ð¸ÑÑ… (Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ)",-1)),t("div",Ls,[t("div",Fs,[v[6]||(v[6]=t("span",{class:"current-label"},"Ð¢ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ:",-1)),t("span",Hs,[ve(d(s(q.value))+" ",1),P.value!==null?(o(),l("span",{key:0,class:oe(["percentage-badge",P.value>=0?"positive":"negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð°: ${$(P.value)}`},d($(P.value)),11,Gs)):z("",!0)])]),t("div",Ks,[(o(!0),l(te,null,ae(O.value,i=>(o(),l("div",{key:`carryover-${i.month}`,class:"month-item"},[t("span",Vs,d(i.monthName)+":",1),t("span",xs,d(s(i.count||0)),1)]))),128)),O.value.length===0?(o(),l("div",js," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):z("",!0)])])]),t("div",zs,[v[10]||(v[10]=t("h3",{class:"card-title"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),t("div",Ys,[t("div",Zs,[(o(!0),l(te,null,ae(T.data.stages||[],i=>(o(),l("div",{key:i.stageId,class:oe(["stage-item",N(i.stageId)])},[t("span",qs,d(b(i.stageId)),1),t("span",Qs,d(i.stageName||i.stageId)+":",1),t("span",Js,d(s(i.count||0)),1)],2))),128)),!T.data.stages||T.data.stages.length===0?(o(),l("div",Xs,[...v[9]||(v[9]=[t("span",{class:"stage-name"},"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…",-1)])])):z("",!0)])])])]))}},tr=fe(er,[["__scopeId","data-v-15d88b90"]]),ar={class:"line-chart-months"},sr={class:"chart-section"},rr={class:"chart-title"},or={key:0,class:"chart-period"},nr={class:"chart-wrapper"},lr={class:"chart-container"},ir={class:"chart-summary"},cr={class:"summary-numbers"},dr={class:"summary-row"},ur={class:"summary-values"},kr={class:"summary-row"},vr={class:"summary-values"},hr={class:"summary-analysis"},mr=["innerHTML"],yr={class:"chart-section"},pr={class:"chart-title"},gr={key:0,class:"chart-period"},br={class:"chart-wrapper"},fr={class:"chart-container"},_r={class:"chart-analysis"},wr={class:"analysis-content"},Cr=["innerHTML"],Tr={class:"chart-table-section"},Wr={class:"chart-table-wrapper"},$r={class:"data-table"},Ar={class:"data-row data-row--new"},Dr={class:"data-row data-row--closed"},Sr={class:"data-row data-row--carryover"},Nr={__name:"LineChartMonths",props:{data:{type:Object,required:!0,default:()=>({newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]})},meta:{type:Object,default:()=>({months:[]})}},setup(T){Fe.register(ze);const u=T;function s(N){return N==null||isNaN(N)?"0":N>=1e3?N.toLocaleString("ru-RU"):N.toString()}const $=I(()=>{const N=new Set;return u.data.newTicketsByMonth?.forEach(b=>{b.weeks&&Array.isArray(b.weeks)&&b.weeks.forEach(k=>{k&&k.weekNumber&&N.add(k.weekNumber)})}),u.data.closedTicketsByMonth?.forEach(b=>{b.weeks&&Array.isArray(b.weeks)&&b.weeks.forEach(k=>{k&&k.weekNumber&&N.add(k.weekNumber)})}),u.data.carryoverTicketsByMonth?.forEach(b=>{b.weeks&&Array.isArray(b.weeks)&&b.weeks.forEach(k=>{k&&k.weekNumber&&N.add(k.weekNumber)})}),Array.from(N).sort((b,k)=>b-k)}),w=I(()=>{const N=u.data.newTicketsByMonth||[],b=N.map(i=>i.monthName||`ÐœÐµÑÑÑ† ${i.month}`),k=N.map(i=>i.count||0),v=(u.data.closedTicketsByMonth||[]).map(i=>i.count||0);return{labels:b,datasets:[{label:"ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹",data:k,borderColor:c.primary,backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:10,color:c.primary,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:c.primary,borderWidth:1,borderRadius:4,padding:4}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹",data:v,borderColor:c.success,backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"start",align:"bottom",offset:10,color:c.success,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:c.success,borderWidth:1,borderRadius:4,padding:4}}]}}),f=I(()=>{const N=u.data.carryoverTicketsByMonth||[],b=N.map(v=>v.monthName||`ÐœÐµÑÑÑ† ${v.month}`),k=N.map(v=>v.count||0);return{labels:b,datasets:[{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹",data:k,borderColor:c.carryover,backgroundColor:"rgba(255, 152, 0, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:4,color:c.carryover}}]}}),g={responsive:!0,maintainAspectRatio:!1,layout:{padding:{left:16,right:0,top:56,bottom:0}},plugins:{legend:{position:"left",labels:{font:{size:14,weight:"500"},padding:16,boxWidth:20,boxHeight:12}},tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12},datalabels:{anchor:"end",align:"top",formatter:(N,b)=>N==null||isNaN(N)?"":N.toString(),color:"#333",font:{size:12,weight:"bold"},padding:{top:4,bottom:4},display:function(N){const b=N.dataset.data[N.dataIndex];return b!=null&&!isNaN(b)&&isFinite(b)},backgroundColor:"rgba(255, 255, 255, 0.8)",borderColor:"#333",borderWidth:1,borderRadius:4,padding:4}},scales:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:0,minRotation:0,font:{size:14},padding:10},grid:{lineWidth:1.5}}}};function p(N){if(!N||N.length===0)return null;const b=N[0],k=N[N.length-1];if(!b||!k)return null;const v=b.monthName||`ÐœÐµÑÑÑ† ${b.month}`,i=k.monthName||`ÐœÐµÑÑÑ† ${k.month}`,C=b.year||new Date().getFullYear();return`${v} â€” ${i} ${C}`}const M=I(()=>p(u.data?.newTicketsByMonth||[])),O=I(()=>p(u.data?.carryoverTicketsByMonth||[])),q=I(()=>{const N=u.data?.newTicketsByMonth||[],b=u.data?.closedTicketsByMonth||[];if(N.length===0)return{new:"â€”",closed:"â€”"};const k=N.map(i=>`${s(i.count||0)} (${i.monthName||i.month})`).join(" â†’ "),v=b.map(i=>`${s(i.count||0)} (${i.monthName||i.month})`).join(" â†’ ");return{new:k,closed:v}}),Q=I(()=>{const N=u.data?.newTicketsByMonth||[],b=u.data?.closedTicketsByMonth||[];if(N.length<2)return["ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°"];const k=[],v=[],i=[];if(N.length>=2){const C=N[0],A=N[1],y=N[2];if(A&&C&&typeof C.count=="number"&&typeof A.count=="number"){const n=C.monthName||C.month,E=A.monthName||A.month,W=s(C.count||0),S=s(A.count||0);if(C.count>0){const D=(A.count-C.count)/C.count*100;if(isFinite(D)&&!isNaN(D)){const K=D>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",H=Math.abs(D),x=D>=0?"+":"-",V=D>=0?"#28a745":"#dc3545",Z=D>=0?"#28a745":"#dc3545";v.push(`  â€¢ <span style="color: ${V}; font-weight: 600;">${K}</span> Ñ ${W} (${n}) Ð´Ð¾ ${S} (${E}) â€” <span style="color: ${Z}; font-weight: 600;">${x}${H.toFixed(1)}%</span>`)}}else C.count===0&&A.count>0&&v.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ 0 (${n}) Ð´Ð¾ ${S} (${E})`)}if(y&&A&&typeof A.count=="number"&&typeof y.count=="number"){const n=A.monthName||A.month,E=y.monthName||y.month,W=s(A.count||0),S=s(y.count||0);if(A.count>0){const D=(y.count-A.count)/A.count*100;if(isFinite(D)&&!isNaN(D))if(Math.abs(D)<.1)v.push(`  â€¢ Ð‘ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: ${W} (${n}) â†’ ${S} (${E}) â€” 0.0%`);else{const K=D>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",H=Math.abs(D),x=D>=0?"+":"-",V=D>=0?"#28a745":"#dc3545",Z=D>=0?"#28a745":"#dc3545";v.push(`  â€¢ <span style="color: ${V}; font-weight: 600;">${K}</span> Ñ ${W} (${n}) Ð´Ð¾ ${S} (${E}) â€” <span style="color: ${Z}; font-weight: 600;">${x}${H.toFixed(1)}%</span>`)}}else A.count===0&&y.count>0&&v.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ 0 (${n}) Ð´Ð¾ ${S} (${E})`)}}if(b.length>=2){const C=b[0],A=b[1],y=b[2];if(A&&C&&typeof C.count=="number"&&typeof A.count=="number"){const n=C.monthName||C.month,E=A.monthName||A.month,W=s(C.count||0),S=s(A.count||0);if(C.count>0){const D=(A.count-C.count)/C.count*100;if(isFinite(D)&&!isNaN(D))if(Math.abs(D)<.1)i.push(`  â€¢ Ð‘ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: ${W} (${n}) â†’ ${S} (${E}) â€” 0.0%`);else{const K=D>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",H=Math.abs(D),x=D>=0?"+":"-",V=D>=0?"#28a745":"#dc3545",Z=D>=0?"#28a745":"#dc3545";i.push(`  â€¢ <span style="color: ${V}; font-weight: 600;">${K}</span> Ñ ${W} (${n}) Ð´Ð¾ ${S} (${E}) â€” <span style="color: ${Z}; font-weight: 600;">${x}${H.toFixed(1)}%</span>`)}}else C.count===0&&A.count>0&&i.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹: Ñ 0 (${n}) Ð´Ð¾ ${S} (${E})`)}if(y&&A&&typeof A.count=="number"&&typeof y.count=="number"){const n=A.monthName||A.month,E=y.monthName||y.month,W=s(A.count||0),S=s(y.count||0);if(A.count>0){const D=(y.count-A.count)/A.count*100;if(isFinite(D)&&!isNaN(D))if(Math.abs(D)<.1)i.push(`  â€¢ Ð‘ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: ${W} (${n}) â†’ ${S} (${E}) â€” 0.0%`);else{const K=D>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",H=Math.abs(D),x=D>=0?"+":"-",V=D>=0?"#28a745":"#dc3545",Z=D>=0?"#28a745":"#dc3545";i.push(`  â€¢ <span style="color: ${V}; font-weight: 600;">${K}</span> Ñ ${W} (${n}) Ð´Ð¾ ${S} (${E}) â€” <span style="color: ${Z}; font-weight: 600;">${x}${H.toFixed(1)}%</span>`)}}else A.count===0&&y.count>0&&i.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹: Ñ 0 (${n}) Ð´Ð¾ ${S} (${E})`)}}if(v.length>0&&(k.push("ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹:"),k.push(...v)),i.length>0&&(k.push("Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹:"),k.push(...i)),N.length>=3&&b.length>=3){const C=N[0],A=N[N.length-1],y=b[0],n=b[b.length-1],E=C.count||0,W=A.count||0,S=y.count||0,D=n.count||0;if(E>0&&S>0){const K=(W-E)/E*100,H=(D-S)/S*100;if(isFinite(K)&&isFinite(H)){const x=C.monthName||C.month,V=A.monthName||A.month,Z=y.monthName||y.month,ue=n.monthName||n.month,ge=K>=0?"#28a745":"#dc3545",h=K>=0?"#28a745":"#dc3545",e=H>=0?"#28a745":"#dc3545",a=H>=0?"#28a745":"#dc3545";k.push("ÐžÐ±Ñ‰Ð°Ñ Ð´Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ° Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´:"),k.push(`  â€¢ ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹: <span style="color: ${ge}; font-weight: 600;">${K>=0?"Ñ€Ð¾ÑÑ‚":"ÑÐ½Ð¸Ð¶ÐµÐ½Ð¸Ðµ"}</span> Ñ ${s(E)} (${x}) Ð´Ð¾ ${s(W)} (${V}) â€” <span style="color: ${h}; font-weight: 600;">${K>=0?"+":"-"}${Math.abs(K).toFixed(1)}%</span>`),k.push(`  â€¢ Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹: <span style="color: ${e}; font-weight: 600;">${H>=0?"Ñ€Ð¾ÑÑ‚":"ÑÐ½Ð¸Ð¶ÐµÐ½Ð¸Ðµ"}</span> Ñ ${s(S)} (${Z}) Ð´Ð¾ ${s(D)} (${ue}) â€” <span style="color: ${a}; font-weight: 600;">${H>=0?"+":"-"}${Math.abs(H).toFixed(1)}%</span>`)}}}return k.length>0?k:["ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°"]}),F=I(()=>{const N=u.data?.carryoverTicketsByMonth||[];if(N.length===0)return["ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°"];const b=[],k=[],v=N.filter(i=>i&&typeof i.count=="number").map(i=>`${s(i.count||0)} (${i.monthName||i.month||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"})`).join(" â†’ ");if(v&&b.push(`ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹: ${v}`),N.length>=2){const i=N[0],C=N[1],A=N[2];if(C&&i&&typeof i.count=="number"&&typeof C.count=="number"){const y=i.monthName||i.month,n=C.monthName||C.month,E=s(i.count||0),W=s(C.count||0);if(i.count>0){const S=(C.count-i.count)/i.count*100;if(isFinite(S)&&!isNaN(S))if(Math.abs(S)<.1)k.push(`  â€¢ Ð‘ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: ${E} (${y}) â†’ ${W} (${n}) â€” 0.0%`);else{const D=S>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",K=Math.abs(S),H=S>=0?"+":"-",x=S>=0?"#28a745":"#dc3545",V=S>=0?"#28a745":"#dc3545";k.push(`  â€¢ <span style="color: ${x}; font-weight: 600;">${D}</span> Ñ ${E} (${y}) Ð´Ð¾ ${W} (${n}) â€” <span style="color: ${V}; font-weight: 600;">${H}${K.toFixed(1)}%</span>`)}}else i.count===0&&C.count>0&&k.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ 0 (${y}) Ð´Ð¾ ${W} (${n})`)}if(A&&C&&typeof C.count=="number"&&typeof A.count=="number"){const y=C.monthName||C.month,n=A.monthName||A.month,E=s(C.count||0),W=s(A.count||0);if(C.count>0){const S=(A.count-C.count)/C.count*100;if(isFinite(S)&&!isNaN(S))if(Math.abs(S)<.1)k.push(`  â€¢ Ð‘ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: ${E} (${y}) â†’ ${W} (${n}) â€” 0.0%`);else{const D=S>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",K=Math.abs(S),H=S>=0?"+":"-",x=S>=0?"#28a745":"#dc3545",V=S>=0?"#28a745":"#dc3545";k.push(`  â€¢ <span style="color: ${x}; font-weight: 600;">${D}</span> Ñ ${E} (${y}) Ð´Ð¾ ${W} (${n}) â€” <span style="color: ${V}; font-weight: 600;">${H}${K.toFixed(1)}%</span>`)}}else C.count===0&&A.count>0&&k.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ 0 (${y}) Ð´Ð¾ ${W} (${n})`)}}if(k.length>0&&(b.push("Ð”Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ° Ð¿Ð¾ Ð¼ÐµÑÑÑ†Ð°Ð¼:"),b.push(...k)),N.length>=3){const i=N[0],C=N[N.length-1];if(i&&C&&typeof i.count=="number"&&typeof C.count=="number"){const A=i.count||0,y=C.count||0,n=i.monthName||i.month,E=C.monthName||C.month,W=s(A),S=s(y);if(A>0){const D=(y-A)/A*100;if(isFinite(D)&&!isNaN(D))if(Math.abs(D)<1)b.push("Ð¢ÐµÐ½Ð´ÐµÐ½Ñ†Ð¸Ñ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´:"),b.push(`  â€¢ Ð¡Ñ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾: ${W} (${n}) â†’ ${S} (${E}) â€” Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¼ÐµÐ½ÐµÐµ 1%`);else{const K=D>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",H=Math.abs(D),x=D>=0?"+":"-",V=D>=0?"#28a745":"#dc3545",Z=D>=0?"#28a745":"#dc3545";b.push("Ð¢ÐµÐ½Ð´ÐµÐ½Ñ†Ð¸Ñ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´:"),b.push(`  â€¢ <span style="color: ${V}; font-weight: 600;">${K}</span> Ñ ${W} (${n}) Ð´Ð¾ ${S} (${E}) â€” <span style="color: ${Z}; font-weight: 600;">${x}${H.toFixed(1)}%</span>`)}}else A===0&&y>0?(b.push("Ð¢ÐµÐ½Ð´ÐµÐ½Ñ†Ð¸Ñ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´:"),b.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ 0 (${n}) Ð´Ð¾ ${S} (${E})`)):A>0&&y===0&&(b.push("Ð¢ÐµÐ½Ð´ÐµÐ½Ñ†Ð¸Ñ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´:"),b.push(`  â€¢ ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ ${W} (${n}) Ð´Ð¾ 0 (${E})`))}}return b.length>0?b:["ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°"]});function P(N,b){let k=[];switch(N){case"new":k=u.data.newTicketsByMonth||[];break;case"closed":k=u.data.closedTicketsByMonth||[];break;case"carryover":k=u.data.carryoverTicketsByMonth||[];break;default:return"-"}for(const v of k){if(!v.weeks||!Array.isArray(v.weeks))continue;const i=v.weeks.find(C=>C&&C.weekNumber===b);if(i){const C=i.count||0;return C>0?s(C):"-"}}return"-"}return(N,b)=>(o(),l("div",ar,[t("div",sr,[t("h3",rr,[b[0]||(b[0]=ve(" ÐÐ¾Ð²Ñ‹Ðµ Ð¸ Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ ",-1)),M.value?(o(),l("span",or,"("+d(M.value)+")",1)):z("",!0)]),t("div",nr,[t("div",lr,[J(De(We),{data:w.value,options:g},null,8,["data"])]),t("div",ir,[b[3]||(b[3]=t("h4",{class:"summary-title"},"Ð¡Ð²Ð¾Ð´Ð½Ñ‹Ð¹ Ð¸Ñ‚Ð¾Ð³",-1)),t("div",cr,[t("div",dr,[b[1]||(b[1]=t("span",{class:"summary-label"},"ÐÐ¾Ð²Ñ‹Ðµ:",-1)),t("span",ur,d(q.value.new),1)]),t("div",kr,[b[2]||(b[2]=t("span",{class:"summary-label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ:",-1)),t("span",vr,d(q.value.closed),1)])]),t("div",hr,[(o(!0),l(te,null,ae(Q.value,(k,v)=>(o(),l("p",{key:v,innerHTML:k},null,8,mr))),128))])])])]),t("div",yr,[t("h3",pr,[b[4]||(b[4]=ve(" ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ ",-1)),O.value?(o(),l("span",gr,"("+d(O.value)+")",1)):z("",!0)]),t("div",br,[t("div",fr,[J(De(We),{data:f.value,options:g},null,8,["data"])]),t("div",_r,[b[5]||(b[5]=t("h4",{class:"analysis-title"},"ÐÐ½Ð°Ð»Ð¸Ð·",-1)),t("div",wr,[(o(!0),l(te,null,ae(F.value,(k,v)=>(o(),l("p",{key:v,innerHTML:k},null,8,Cr))),128))])])])]),t("div",Tr,[b[10]||(b[10]=t("h3",{class:"chart-title"},"Ð”ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ð¼ÐµÑÑÑ†Ð°Ð¼ Ð¸ Ð½ÐµÐ´ÐµÐ»ÑÐ¼",-1)),t("div",Wr,[t("table",$r,[t("thead",null,[t("tr",null,[b[6]||(b[6]=t("th",{class:"month-header-cell"},"ÐœÐµÑÑÑ†",-1)),(o(!0),l(te,null,ae($.value,k=>(o(),l("th",{key:`week-${k}`,class:"week-header-cell"}," ÐÐµÐ´ÐµÐ»Ñ "+d(k),1))),128))])]),t("tbody",null,[t("tr",Ar,[b[7]||(b[7]=t("td",{class:"data-type-cell"},"ÐÐ¾Ð²Ñ‹Ðµ",-1)),(o(!0),l(te,null,ae($.value,k=>(o(),l("td",{key:`new-${k}`,class:"week-data-cell"},d(P("new",k)),1))),128))]),t("tr",Dr,[b[8]||(b[8]=t("td",{class:"data-type-cell"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ",-1)),(o(!0),l(te,null,ae($.value,k=>(o(),l("td",{key:`closed-${k}`,class:"week-data-cell"},d(P("closed",k)),1))),128))]),t("tr",Sr,[b[9]||(b[9]=t("td",{class:"data-type-cell"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",-1)),(o(!0),l(te,null,ae($.value,k=>(o(),l("td",{key:`carryover-${k}`,class:"week-data-cell"},d(P("carryover",k)),1))),128))])])])])])]))}},Er=fe(Nr,[["__scopeId","data-v-31a3d565"]]),Or={class:"months-preloader"},Br={class:"preloader-content"},Mr={class:"progress-container"},Ur={class:"progress-bar"},Rr={class:"progress-text"},Pr={class:"preloader-message"},Ir={class:"stages-list"},Lr={class:"stage-icon"},Fr={class:"stage-text"},Hr={__name:"MonthsModePreloader",props:{progress:{type:Number,required:!0,validator:T=>T>=0&&T<=100},currentStage:{type:String,default:""}},setup(T){const u=T,s=[{label:"ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…...",threshold:5},{label:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 1)...",threshold:35},{label:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 2)...",threshold:65},{label:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 3)...",threshold:85},{label:"ÐÐ³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…...",threshold:90},{label:"Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð²...",threshold:100}];function $(f){return u.progress>=s[f].threshold}function w(f){const g=s[f].threshold,p=f>0?s[f-1].threshold:0;return u.progress>=p&&u.progress<g}return(f,g)=>(o(),l("div",Or,[t("div",Br,[g[0]||(g[0]=at('<div class="preloader-spinner" data-v-b571fe67><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div></div><h3 class="preloader-title" data-v-b571fe67>Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° 3 Ð¼ÐµÑÑÑ†Ð°</h3>',2)),t("div",Mr,[t("div",Ur,[t("div",{class:"progress-fill",style:we({width:`${T.progress}%`})},null,4)]),t("div",Rr,d(Math.round(T.progress))+"%",1)]),t("p",Pr,d(T.currentStage),1),t("div",Ir,[(o(),l(te,null,ae(s,(p,M)=>t("div",{key:M,class:oe(["stage-item",{"stage-completed":$(M),"stage-current":w(M)}])},[t("span",Lr,d($(M)?"âœ“":w(M)?"â†’":"â—‹"),1),t("span",Fr,d(p.label),1)],2)),64))])])]))}},Gr=fe(Hr,[["__scopeId","data-v-b571fe67"]]),Kr={class:"ac-dashboard-months"},Vr={key:"content"},xr={class:"dashboard-header"},jr={class:"header-content"},zr={class:"breadcrumbs-row"},Yr=["aria-label","aria-disabled","data-fallback","disabled"],Zr={class:"breadcrumbs","aria-label":"ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ"},qr={class:"dashboard-layout"},Qr={class:"filters-container"},Jr={class:"chart-container"},Xr={__name:"GraphAdmissionClosureMonthsDashboard",setup(T){const u=Ye(),s=L(!0),$=L(0),w=L("ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…..."),f=L(null),g=L(null),p=L({newTickets:0,closedTickets:0,carryoverTickets:0,newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[],previousPeriodData:{newTickets:null,closedTickets:null,carryoverTickets:null}}),M=L(!1),O=I(()=>typeof window>"u"?!1:window.history.length>1),q=I(()=>O.value?"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ":"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"),Q={name:"dashboard-sector-1c"};function F(W){if(W?.preventDefault?.(),!M.value){M.value=!0;try{if(O.value){u.back();return}console.warn("GraphAdmissionClosureMonthsDashboard: fallback navigation to dashboard-sector-1c"),u.push(Q)}finally{M.value=!1}}}const P=L({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),N=I(()=>{const W=P.value.customDateRange.startDate||P.value.customDateRange.endDate,S=P.value.employees.length===1&&P.value.employees.includes("all");return W||!S});async function b(W,S,D=500){const K=$.value,H=10,x=(W-K)/H,V=D/H;for(let Z=0;Z<H;Z++)await new Promise(ue=>setTimeout(ue,V)),$.value=Math.min(K+x*(Z+1),W);$.value=W,w.value=S}async function k(){console.log("[DEBUG MonthsDashboard] loadData called"),console.log("[DEBUG MonthsDashboard] isLoading before:",s.value),s.value=!0,f.value=null,$.value=0,w.value="ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…...",console.log("[DEBUG MonthsDashboard] isLoading set to true");let W=null,S=null;try{console.log("[DEBUG MonthsDashboard] Starting API call"),await b(5,"ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…...",200);const D=Date.now(),K=2e4;W=setInterval(()=>{const Z=Date.now()-D,ue=Math.min(5+Z/K*85,90);$.value=ue,ue<35?w.value="Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 1)...":ue<65?w.value="Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 2)...":ue<85?w.value="Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 3)...":w.value="ÐÐ³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…..."},500),S=setTimeout(()=>{W&&(clearInterval(W),W=null)},K+1e4);const H=await Se({product:"1C",periodMode:"months",includeTickets:!0});clearTimeout(S),W&&(clearInterval(W),W=null),$.value=90,w.value="ÐÐ³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°",await b(100,"Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð²...",300),console.log("[DEBUG MonthsDashboard] API call successful, result:",H);const{meta:x,data:V}=H;g.value=x,p.value=V,console.log("[DEBUG MonthsDashboard] Data set, meta:",x,"data keys:",Object.keys(V)),await new Promise(Z=>setTimeout(Z,200))}catch(D){W&&(clearInterval(W),W=null),S&&(clearTimeout(S),S=null),console.error("[DEBUG MonthsDashboard] API call failed:",D),f.value=D instanceof Error?D:new Error("ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸"),console.error("[GraphAdmissionClosureMonthsDashboard] loadData error:",D),$.value=100,w.value="ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…"}finally{console.log("[DEBUG MonthsDashboard] Finally block: setting isLoading to false"),s.value=!1,console.log("[DEBUG MonthsDashboard] isLoading after:",s.value)}}function v(W){P.value.stages=W}function i(W){P.value.employees=W}function C(W){P.value.dateRange=W}function A(W){P.value.customDateRange=W}function y(){P.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},n()}function n(){k()}function E(W){if(!["weeks","months"].includes(W)){console.warn("[GraphAdmissionClosureMonthsDashboard] Invalid periodMode:",W);return}W==="weeks"&&window.dispatchEvent(new CustomEvent("period-mode-change",{detail:{mode:W}}))}return He(()=>{console.log("[DEBUG MonthsDashboard] onMounted called"),console.log("[DEBUG MonthsDashboard] isLoading before loadData:",s.value),k()}),(W,S)=>{const D=Ze("router-link");return o(),l("div",Kr,[J(he,{name:"fade",mode:"out-in"},{default:ne(()=>[s.value?(o(),me(Gr,{key:"preloader",progress:$.value,"current-stage":w.value},null,8,["progress","current-stage"])):(o(),l("div",Vr,[t("div",xr,[t("div",jr,[t("div",zr,[t("button",{class:"btn-back-link",type:"button",onClick:F,"aria-label":q.value,"aria-disabled":!O.value,"data-fallback":!O.value,disabled:M.value,title:"ÐÐ°Ð·Ð°Ð´"}," â† ",8,Yr),t("nav",Zr,[J(D,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ne(()=>[...S[0]||(S[0]=[ve(" Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡ ",-1)])]),_:1}),S[2]||(S[2]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),J(D,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:ne(()=>[...S[1]||(S[1]=[ve(" Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ",-1)])]),_:1}),S[3]||(S[3]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),S[4]||(S[4]=t("span",{class:"breadcrumb-current"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹",-1))])]),S[5]||(S[5]=t("h1",{class:"dashboard-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),S[6]||(S[6]=t("p",{class:"dashboard-subtitle"}," Ð”Ð¾ÑÑ‚ÑƒÐ¿Ñ‹ Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ñ‹ Â«Ð“Ñ€Ð°Ñ„Ð¸ÐºÑƒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑÂ», ÑÐµÐ»ÐµÐºÑ‚Ð¾Ñ€ ÑÑ‚Ð°Ð¿Ð¾Ð² ÑÐºÑ€Ñ‹Ñ‚. ",-1))])]),t("div",qr,[t("div",Qr,[J(Qe,{stages:P.value.stages,employees:P.value.employees,dateRange:P.value.dateRange,customDateRange:P.value.customDateRange,hasActiveFilters:N.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":"months","onUpdate:stages":v,"onUpdate:employees":i,"onUpdate:dateRange":C,"onUpdate:customDateRange":A,"onUpdate:periodMode":E,onReset:y,onApply:n},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])]),t("div",Jr,[f.value?(o(),me(qe,{key:0,type:"error",title:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",message:f.value.message},null,8,["message"])):(o(),l(te,{key:1},[J(tr,{data:p.value},null,8,["data"]),J(Er,{data:p.value,meta:g.value},null,8,["data","meta"])],64))])])]))]),_:1})])}}},eo=fe(Xr,[["__scopeId","data-v-fe3ca7ed"]]);function to(T){if(!T)return null;try{const u=new Date(T);return isNaN(u.getTime())?null:u}catch{return console.warn("Invalid date format:",T),null}}function ao(T,u){return Math.floor((T-u)/864e5)}function so(T){return!T||isNaN(T.getTime())?!1:T<=new Date}const be={ONE_MONTH:"one_month",TWO_MONTHS:"two_months",MORE_THAN_HALF_YEAR:"more_than_half_year",MORE_THAN_YEAR:"more_than_year"},Ae={[be.ONE_MONTH]:"ÐžÐ´Ð¸Ð½ Ð¼ÐµÑÑÑ†",[be.TWO_MONTHS]:"Ð”Ð²Ð° Ð¼ÐµÑÑÑ†Ð°",[be.MORE_THAN_HALF_YEAR]:"Ð‘Ð¾Ð»ÐµÐµ Ð¿Ð¾Ð»ÑƒÐ³Ð¾Ð´Ð°",[be.MORE_THAN_YEAR]:"Ð‘Ð¾Ð»ÐµÐµ Ð³Ð¾Ð´Ð°"},Ve={[be.ONE_MONTH]:30,[be.TWO_MONTHS]:60,[be.MORE_THAN_HALF_YEAR]:180,[be.MORE_THAN_YEAR]:365};function Pe(T,u,s=new Date){if(!Array.isArray(T))return console.warn("filterTicketsByTimePeriod: tickets must be an array"),[];if(!Ve[u])return console.warn(`filterTicketsByTimePeriod: Unknown period "${u}"`),T;const $=Ve[u],w=u.includes("more_than");return T.filter(f=>{try{if(!f||!f.id||!f.created_at)return console.warn("Ticket missing required fields:",f),!1;const g=to(f.created_at);if(!g)return console.warn(`Invalid date for ticket ${f.id}: ${f.created_at}`),!1;if(!so(g))return console.warn(`Future or invalid date for ticket ${f.id}: ${f.created_at}`),!1;const p=ao(s,g);return w?p>$:p<=$}catch(g){return console.error(`Error filtering ticket ${f?.id||"unknown"}:`,g),!1}})}const ro={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},oo={class:"modal"},no={key:0,class:"modal__tabs"},lo={key:"level-0-categories",class:"level-0"},io={class:"modal__header"},co={class:"modal__title"},uo={key:0},ko={class:"modal__body"},vo={class:"categories-list"},ho=["onClick"],mo={class:"category-item"},yo={class:"category-item__icon"},po={key:0},go={key:1},bo={class:"category-item__content"},fo={class:"category-item__label"},_o={class:"category-item__count"},wo={key:0,class:"category-item__arrow"},Co={class:"modal__footer"},To={key:"level-1-categories",class:"level-1"},Wo={class:"modal__header"},$o={class:"modal__body"},Ao={key:"loading",class:"loading-names"},Do={key:"empty",class:"modal__empty"},So={key:"list",class:"responsible-list"},No=["onClick"],Eo={class:"responsible-list__name"},Oo={class:"responsible-list__count"},Bo={key:0,class:"responsible-list__arrow"},Mo={class:"modal__footer"},Uo={key:"level-2-categories",class:"level-2"},Ro={class:"modal__header"},Po={class:"modal__title"},Io={class:"modal__body"},Lo={class:"time-sort-controls"},Fo={class:"time-sort-buttons"},Ho=["onClick"],Go={class:"count"},Ko={key:"loading",class:"loading-state"},Vo={key:"error",class:"error-state"},xo={class:"error-message"},jo={key:"empty",class:"empty-state"},zo={class:"empty-state-message"},Yo={key:"tickets",class:"tickets-list-container"},Zo={key:"level-0-employees",class:"level-0"},qo={class:"modal__header"},Qo={class:"modal__title"},Jo={key:0},Xo={class:"modal__body"},en={key:"loading",class:"loading-names"},tn={key:"empty",class:"modal__empty"},an={key:"list",class:"responsible-list"},sn=["onClick"],rn={class:"responsible-list__name"},on={class:"responsible-list__count"},nn={key:0,class:"responsible-list__arrow"},ln={class:"modal__footer"},cn={key:"level-1-employees",class:"level-1"},dn={class:"modal__header"},un={class:"modal__title"},kn={class:"modal__body"},vn={class:"categories-list"},hn=["onClick"],mn={class:"category-item"},yn={class:"category-item__icon"},pn={key:0},gn={key:1},bn={class:"category-item__content"},fn={class:"category-item__label"},_n={class:"category-item__count"},wn={key:0,class:"category-item__arrow"},Cn={class:"modal__footer"},Tn={key:"level-2-employees",class:"level-2"},Wn={class:"modal__header"},$n={class:"modal__title"},An={class:"modal__body"},Dn={key:"loading",class:"loading-state"},Sn={key:"error",class:"error-state"},Nn={class:"error-message"},En={key:"empty",class:"empty-state"},On={class:"empty-state-message"},Bn={key:"tickets",class:"tickets-list-container"},Mn={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(T){const u=T,s=L(0),$=L("categories"),w=L(null),f=L(null),g=L(null),p=L([]),M=L(!1),O=L(null),q=L([]),Q=L([]),F=L(!1),P=L(be.ONE_MONTH),N=I(()=>[{id:"created-this-week",label:"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ",count:u.closedTicketsCreatedThisWeek??0,responsible:u.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ€Ð°Ð½ÐµÐµ",count:u.closedTicketsCreatedOtherWeek??0,responsible:u.responsibleCreatedOtherWeek??[]}]),b=I(()=>{const h=new Map;return(u.responsibleCreatedThisWeek||[]).forEach(e=>{const a=e.id??"unassigned";h.has(a)||h.set(a,{id:e.id,name:e.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const r=h.get(a);r.thisWeekCount=e.count??0,r.thisWeekTickets=e.tickets||[],r.totalCount+=r.thisWeekCount}),(u.responsibleCreatedOtherWeek||[]).forEach(e=>{const a=e.id??"unassigned";h.has(a)||h.set(a,{id:e.id,name:e.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const r=h.get(a);r.otherWeekCount=e.count??0,r.otherWeekTickets=e.tickets||[],r.totalCount+=r.otherWeekCount}),Array.from(h.values())}),k=I(()=>{if(!f.value)return[];const h=f.value.thisWeekTickets||[],e=f.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:f.value.id,name:f.value.name,thisWeekCount:f.value.thisWeekCount,otherWeekCount:f.value.otherWeekCount,thisWeekTickets:h.length,otherWeekTickets:e.length,employee:f.value}),[{id:"this-week",label:"ÐÐ° ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ðµ",count:f.value.thisWeekCount??0,tickets:h,employeeId:f.value.id},{id:"other-week",label:"ÐÐ° Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ðµ",count:f.value.otherWeekCount??0,tickets:e,employeeId:f.value.id}]}),v=I(()=>(Q.value||[]).length>0),i=I(()=>{if(!p.value||p.value.length===0)return[];try{const h=performance.now(),e=Pe(p.value,P.value),a=performance.now();return console.log(`[ResponsibleModal] Filtering took ${(a-h).toFixed(2)}ms, results: ${e.length}`),e}catch(h){return console.error("[ResponsibleModal] Error filtering tickets:",h),[]}}),C=I(()=>Object.keys(Ae).map(h=>({key:h,label:Ae[h],count:Pe(p.value,h).length})));async function A(h){const e=h.filter(a=>a.id!==null&&a.id!==void 0).map(a=>a.id);if(e.length===0)return h;try{const a=await st.getEmployeesByIds(e),r=new Map;return a.forEach(U=>{r.set(U.id,U.name)}),h.map(U=>U.id&&r.has(U.id)?{...U,name:r.get(U.id)}:U)}catch(a){return console.error("[ResponsibleModal] Error enriching names:",a),h}}_e([()=>$.value,()=>b.value],async([h,e])=>{if(!(h!=="employees"||s.value!==0)){if(!e||e.length===0){Q.value=[];return}F.value=!0;try{Q.value=await A(e)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),Q.value=e}finally{F.value=!1}}},{immediate:!0}),_e(()=>u.responsible,async h=>{if(!(s.value!==0||w.value||$.value!=="categories")){if(!h||h.length===0){q.value=[];return}F.value=!0;try{q.value=await A(h)}catch(e){console.error("[ResponsibleModal] Error loading employee names:",e),q.value=h}finally{F.value=!1}}},{immediate:!1});const y=I(()=>(q.value||[]).length>0);function n(h){$.value!==h&&($.value=h,s.value=0,w.value=null,f.value=null,g.value=null,p.value=[],O.value=null,q.value=[],Q.value=[])}async function E(h){if(!h||h.count===0){console.warn("[ResponsibleModal] handleCategoryClick: Invalid category or count is 0",{category:h,count:h?.count});return}console.log("[ResponsibleModal] handleCategoryClick called:",{categoryId:h.id,categoryLabel:h.label,categoryCount:h.count,responsibleCount:h.responsible?.length||0,responsibleWithTickets:h.responsible?.filter(e=>e.tickets&&e.tickets.length>0).length||0,responsibleSample:h.responsible?.slice(0,2).map(e=>({id:e.id,name:e.name,count:e.count,hasTickets:!!e.tickets,ticketsCount:e.tickets?.length||0}))}),w.value=h,s.value=1,F.value=!0;try{q.value=await A(h.responsible),console.log("[ResponsibleModal] After enrichResponsibleWithNames:",{enrichedCount:q.value.length,enrichedSample:q.value.slice(0,2).map(e=>({id:e.id,name:e.name,count:e.count,hasTickets:!!e.tickets,ticketsCount:e.tickets?.length||0}))})}catch(e){console.error("[ResponsibleModal] Error loading employee names:",e),q.value=h.responsible}finally{F.value=!1}}async function W(h,e=null){!h||!h.id||h.totalCount===0||(e&&e.currentTarget&&(e.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{e.currentTarget&&(e.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:h.id,name:h.name,thisWeekCount:h.thisWeekCount,otherWeekCount:h.otherWeekCount,thisWeekTickets:h.thisWeekTickets?.length||0,otherWeekTickets:h.otherWeekTickets?.length||0,employee:h}),f.value={...h,thisWeekTickets:h.thisWeekTickets||[],otherWeekTickets:h.otherWeekTickets||[]},s.value=1)}async function S(h){if(!h||h.count===0)return;g.value=h,s.value=2;const e=h.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:h.id,label:h.label,count:h.count,ticketsInGradation:e.length,selectedEmployee:f.value?.id}),e.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",e.length),await D(e)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await K(h))}async function D(h){M.value=!0,O.value=null;try{try{const{prepareTicketsForDisplay:e}=await Ce(async()=>{const{prepareTicketsForDisplay:a}=await import("./chunk-DDkaCoCd.js").then(r=>r.t);return{prepareTicketsForDisplay:a}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);p.value=await e(h,null,null)}catch(e){console.error("[ResponsibleModal] Error preparing tickets:",e),p.value=h}p.value.length===0&&(O.value=null)}catch(e){O.value=e.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets:",e),p.value=[]}finally{M.value=!1}}async function K(h){M.value=!0,O.value=null;try{if(!u.weekStartUtc||!u.weekEndUtc||!f.value)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸ Ð¸Ð»Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº");const e=await Se({product:"1C",weekStartUtc:u.weekStartUtc,weekEndUtc:u.weekEndUtc,includeTickets:!0}),U=(h.id==="this-week"?e.data.responsibleCreatedThisWeek:e.data.responsibleCreatedOtherWeek)?.find(R=>R.id===f.value.id)?.tickets||[];try{const{prepareTicketsForDisplay:R}=await Ce(async()=>{const{prepareTicketsForDisplay:G}=await import("./chunk-DDkaCoCd.js").then(se=>se.t);return{prepareTicketsForDisplay:G}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);p.value=await R(U,null,null)}catch(R){console.error("[ResponsibleModal] Error preparing tickets:",R),p.value=U}p.value.length===0&&(O.value=null)}catch(e){O.value=e.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets from API:",e),p.value=[]}finally{M.value=!1}}async function H(h,e=null){!h||!h.id||h.count===0||(e&&e.currentTarget&&(e.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{e.currentTarget&&(e.currentTarget.style.transform="")},150)),f.value=h,s.value=2,await x(h.id))}async function x(h){M.value=!0,O.value=null;try{let e=[];if(console.log("[ResponsibleModal] loadEmployeeTickets called:",{employeeId:h,selectedCategory:w.value?.id,hasSelectedCategory:!!w.value,hasResponsible:!!w.value?.responsible,responsibleCount:w.value?.responsible?.length||0,categoryData:w.value?{id:w.value.id,label:w.value.label,count:w.value.count,responsibleSample:w.value.responsible?.slice(0,2).map(a=>({id:a.id,name:a.name,count:a.count,hasTickets:!!a.tickets,ticketsCount:a.tickets?.length||0}))}:null}),w.value&&w.value.responsible){const a=w.value.responsible.find(r=>r.id===h);console.log("[ResponsibleModal] Employee found in category:",{employee:a,hasTickets:!!a?.tickets,ticketsCount:a?.tickets?.length||0,tickets:a?.tickets?a.tickets.slice(0,2):null}),e=a?.tickets||[]}if(e.length===0&&u.weekStartUtc&&u.weekEndUtc){console.log("[ResponsibleModal] Tickets not found in category, loading from API",{weekStartUtc:u.weekStartUtc,weekEndUtc:u.weekEndUtc,categoryId:w.value?.id});const a=await Se({product:"1C",weekStartUtc:u.weekStartUtc,weekEndUtc:u.weekEndUtc,includeTickets:!0});console.log("[ResponsibleModal] API response:",{hasResponsibleCreatedThisWeek:!!a.data.responsibleCreatedThisWeek,hasResponsibleCreatedOtherWeek:!!a.data.responsibleCreatedOtherWeek,thisWeekCount:a.data.responsibleCreatedThisWeek?.length||0,otherWeekCount:a.data.responsibleCreatedOtherWeek?.length||0,thisWeekSample:a.data.responsibleCreatedThisWeek?.slice(0,1).map(R=>({id:R.id,name:R.name,count:R.count,hasTickets:!!R.tickets,ticketsCount:R.tickets?.length||0})),otherWeekSample:a.data.responsibleCreatedOtherWeek?.slice(0,1).map(R=>({id:R.id,name:R.name,count:R.count,hasTickets:!!R.tickets,ticketsCount:R.tickets?.length||0}))});const r=w.value?.id==="created-this-week"?a.data.responsibleCreatedThisWeek:a.data.responsibleCreatedOtherWeek;console.log("[ResponsibleModal] Category data:",{categoryId:w.value?.id,categoryDataCount:r?.length||0,categoryDataSample:r?.slice(0,2).map(R=>({id:R.id,name:R.name,count:R.count,hasTickets:!!R.tickets,ticketsCount:R.tickets?.length||0}))});const U=r?.find(R=>R.id===h);console.log("[ResponsibleModal] Employee found in API response:",{employee:U?{id:U.id,name:U.name,count:U.count,hasTickets:!!U.tickets,ticketsCount:U.tickets?.length||0,ticketsSample:U.tickets?.slice(0,2)}:null}),e=U?.tickets||[]}console.log("[ResponsibleModal] Final employeeTickets before prepareTicketsForDisplay:",{ticketsCount:e.length,ticketsSample:e.slice(0,2).map(a=>({id:a.id,title:a.title||a.ufSubject||"No title",stageId:a.stageId}))});try{const{prepareTicketsForDisplay:a}=await Ce(async()=>{const{prepareTicketsForDisplay:r}=await import("./chunk-DDkaCoCd.js").then(U=>U.t);return{prepareTicketsForDisplay:r}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);p.value=await a(e,null,null),console.log("[ResponsibleModal] Tickets after prepareTicketsForDisplay:",{ticketsCount:p.value.length,ticketsSample:p.value.slice(0,2).map(r=>({id:r.id,title:r.title||r.ufSubject||"No title",stageId:r.stageId}))})}catch(a){console.error("[ResponsibleModal] Error preparing tickets:",a),console.error("[ResponsibleModal] prepareError details:",{message:a.message,stack:a.stack,employeeTicketsCount:e.length}),p.value=e,console.log("[ResponsibleModal] Using fallback tickets (without enrichment):",p.value.length)}p.value.length===0?(console.warn("[ResponsibleModal] No tickets after loading and preparation",{employeeId:h,categoryId:w.value?.id,employeeTicketsCount:e.length,finalTicketsCount:p.value.length}),O.value=null):console.log("[ResponsibleModal] Successfully loaded tickets:",p.value.length)}catch(e){O.value=e.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets:",e),console.error("[ResponsibleModal] Error details:",{message:e.message,stack:e.stack,employeeId:h,categoryId:w.value?.id}),p.value=[]}finally{M.value=!1}}function V(){s.value===2?(s.value=1,$.value==="categories"?f.value=null:g.value=null,p.value=[],O.value=null):s.value===1&&(s.value=0,$.value==="categories"?(w.value=null,q.value=[]):f.value=null)}function Z(h){console.log(`[ResponsibleModal] Sort mode changed: ${P.value} -> ${h}`);const e=performance.now();P.value=h,setTimeout(()=>{const a=i.value,r=performance.now();console.log(`[ResponsibleModal] Filtering completed in ${(r-e).toFixed(2)}ms, ${a.length} tickets shown`)},0)}function ue(h){const e=Ge(h.id);window.open(e,"_blank")}function ge(){$.value==="employees"&&g.value?D(g.value.tickets):$.value==="categories"&&f.value&&x(f.value.id)}return _e(()=>u.isVisible,h=>{if(h){console.log("[TASK-070] ResponsibleModal opened for week",u.weekNumber),console.log("[TASK-070] ResponsibleModal props types:",{responsibleCreatedThisWeekType:typeof u.responsibleCreatedThisWeek,responsibleCreatedThisWeekIsArray:Array.isArray(u.responsibleCreatedThisWeek),responsibleCreatedThisWeekLength:Array.isArray(u.responsibleCreatedThisWeek)?u.responsibleCreatedThisWeek.length:"not array",responsibleCreatedOtherWeekType:typeof u.responsibleCreatedOtherWeek,responsibleCreatedOtherWeekIsArray:Array.isArray(u.responsibleCreatedOtherWeek),responsibleCreatedOtherWeekLength:Array.isArray(u.responsibleCreatedOtherWeek)?u.responsibleCreatedOtherWeek.length:"not array"}),console.log("[TASK-070] ResponsibleModal data:",{weekStartUtc:u.weekStartUtc,weekEndUtc:u.weekEndUtc,responsibleCreatedThisWeek:Array.isArray(u.responsibleCreatedThisWeek)?u.responsibleCreatedThisWeek.length:u.responsibleCreatedThisWeek?"not array":"null/undefined",responsibleCreatedOtherWeek:Array.isArray(u.responsibleCreatedOtherWeek)?u.responsibleCreatedOtherWeek.length:u.responsibleCreatedOtherWeek?"not array":"null/undefined",closedTicketsCreatedThisWeek:u.closedTicketsCreatedThisWeek,closedTicketsCreatedOtherWeek:u.closedTicketsCreatedOtherWeek}),console.log("[TASK-070] ResponsibleModal detailed data:",{responsibleCreatedThisWeek:u.responsibleCreatedThisWeek,responsibleCreatedOtherWeek:u.responsibleCreatedOtherWeek,responsibleCreatedThisWeekWithTickets:Array.isArray(u.responsibleCreatedThisWeek)?u.responsibleCreatedThisWeek.map(a=>({id:a.id,name:a.name,count:a.count,hasTickets:!!a.tickets,ticketsCount:a.tickets?.length||0})):"not array or null",responsibleCreatedOtherWeekWithTickets:Array.isArray(u.responsibleCreatedOtherWeek)?u.responsibleCreatedOtherWeek.map(a=>({id:a.id,name:a.name,count:a.count,hasTickets:!!a.tickets,ticketsCount:a.tickets?.length||0})):"not array or null"});const e=u.weekNumber;e&&console.log("[TASK-070] ResponsibleModal: Week number",e)}else s.value=0,$.value="categories",w.value=null,f.value=null,g.value=null,p.value=[],O.value=null,q.value=[],Q.value=[]}),(h,e)=>T.isVisible?(o(),l("div",ro,[t("div",oo,[s.value===0?(o(),l("div",no,[t("button",{class:oe(["modal__tab",{"modal__tab--active":$.value==="categories"}]),onClick:e[0]||(e[0]=a=>n("categories"))}," ÐŸÐ¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼ ",2),t("button",{class:oe(["modal__tab",{"modal__tab--active":$.value==="employees"}]),onClick:e[1]||(e[1]=a=>n("employees"))}," ÐŸÐ¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼ ",2)])):z("",!0),J(he,{name:"level",mode:"out-in"},{default:ne(()=>[$.value==="categories"&&s.value===0?(o(),l("div",lo,[t("header",io,[t("h3",co,[e[12]||(e[12]=ve(" Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),T.weekNumber?(o(),l("span",uo," Â· ÐÐµÐ´ÐµÐ»Ñ "+d(T.weekNumber),1)):z("",!0)]),t("button",{class:"modal__close",onClick:e[2]||(e[2]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",ko,[t("ul",vo,[(o(!0),l(te,null,ae(N.value,a=>(o(),l("li",{key:a.id,class:oe(["categories-list__item",{"categories-list__item--clickable":a.count>0}]),onClick:r=>E(a)},[t("div",mo,[t("div",yo,[a.id==="created-this-week"?(o(),l("span",po,"âœ“")):(o(),l("span",go,"â†»"))]),t("div",bo,[t("div",fo,d(a.label),1),t("div",_o,d(a.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1)]),a.count>0?(o(),l("span",wo,"â†’")):z("",!0)])],10,ho))),128))])]),t("footer",Co,[t("button",{class:"btn",onClick:e[3]||(e[3]=a=>h.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):$.value==="categories"&&s.value===1?(o(),l("div",To,[t("header",Wo,[t("button",{class:"btn-back",onClick:V,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),e[13]||(e[13]=t("h3",{class:"modal__title"},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),t("button",{class:"modal__close",onClick:e[4]||(e[4]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",$o,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[F.value?(o(),l("div",Ao,[...e[14]||(e[14]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð¼Ñ‘Ð½ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²...",-1)])])):y.value?(o(),l("ul",So,[(o(!0),l(te,null,ae(q.value,a=>(o(),l("li",{key:a.id||a.name,class:oe(["responsible-list__item",{"responsible-list__item--clickable":a.id&&a.count>0}]),onClick:r=>H(a,r),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°"},[t("span",Eo,d(a.name||"ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½"),1),t("span",Oo,d(a.count??0)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),a.id&&a.count>0?(o(),l("span",Bo,"â†’")):z("",!0)],10,No))),128))])):(o(),l("p",Do,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¼"))]),_:1})]),t("footer",Mo,[t("button",{class:"btn",onClick:e[5]||(e[5]=a=>h.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):$.value==="categories"&&s.value===2?(o(),l("div",Uo,[t("header",Ro,[t("button",{class:"btn-back",onClick:V,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),t("h3",Po,"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+d(f.value?.name||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),t("button",{class:"modal__close",onClick:e[6]||(e[6]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Io,[t("div",Lo,[e[15]||(e[15]=t("h4",{class:"time-sort-title"},"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹:",-1)),t("div",Fo,[(o(!0),l(te,null,ae(C.value,a=>(o(),l("button",{key:a.key,class:oe(["time-sort-btn",{active:P.value===a.key}]),onClick:r=>Z(a.key)},[ve(d(a.label)+" ",1),t("span",Go,"("+d(a.count)+")",1)],10,Ho))),128))])]),J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[M.value?(o(),l("div",Ko,[...e[16]||(e[16]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):O.value?(o(),l("div",Vo,[e[17]||(e[17]=t("div",{class:"error-icon"},"âš ï¸",-1)),e[18]||(e[18]=t("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),t("p",xo,d(O.value),1),t("button",{class:"btn btn-retry",onClick:ge},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):i.value.length===0?(o(),l("div",jo,[e[19]||(e[19]=t("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),t("p",zo," Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´ ("+d(De(Ae)[P.value])+") ",1)])):(o(),l("div",Yo,[J(Ue,{name:"ticket",tag:"div",class:"tickets-list"},{default:ne(()=>[(o(!0),l(te,null,ae(i.value,(a,r)=>(o(),me(Re,{key:a.id,ticket:a,draggable:!1,style:we({"--ticket-index":r}),onClick:ue},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):$.value==="employees"&&s.value===0?(o(),l("div",Zo,[t("header",qo,[t("h3",Qo,[e[20]||(e[20]=ve(" Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),T.weekNumber?(o(),l("span",Jo," Â· ÐÐµÐ´ÐµÐ»Ñ "+d(T.weekNumber),1)):z("",!0)]),t("button",{class:"modal__close",onClick:e[7]||(e[7]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Xo,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[F.value?(o(),l("div",en,[...e[21]||(e[21]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð¼Ñ‘Ð½ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²...",-1)])])):v.value?(o(),l("ul",an,[(o(!0),l(te,null,ae(Q.value,a=>(o(),l("li",{key:a.id||a.name,class:oe(["responsible-list__item",{"responsible-list__item--clickable":a.id&&a.totalCount>0}]),onClick:r=>W(a,r),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð³Ñ€Ð°Ð´Ð°Ñ†Ð¸Ð¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°"},[t("span",rn,d(a.name||"ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½"),1),t("span",on,d(a.totalCount??0)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),a.id&&a.totalCount>0?(o(),l("span",nn,"â†’")):z("",!0)],10,sn))),128))])):(o(),l("p",tn,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼"))]),_:1})]),t("footer",ln,[t("button",{class:"btn",onClick:e[8]||(e[8]=a=>h.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):$.value==="employees"&&s.value===1?(o(),l("div",cn,[t("header",dn,[t("button",{class:"btn-back",onClick:V,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),t("h3",un,"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+d(f.value?.name||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),t("button",{class:"modal__close",onClick:e[9]||(e[9]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",kn,[t("ul",vn,[(o(!0),l(te,null,ae(k.value,a=>(o(),l("li",{key:a.id,class:oe(["categories-list__item",{"categories-list__item--clickable":a.count>0}]),onClick:r=>S(a)},[t("div",mn,[t("div",yn,[a.id==="this-week"?(o(),l("span",pn,"âœ“")):(o(),l("span",gn,"â†»"))]),t("div",bn,[t("div",fn,d(a.label),1),t("div",_n,d(a.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1)]),a.count>0?(o(),l("span",wn,"â†’")):z("",!0)])],10,hn))),128))])]),t("footer",Cn,[t("button",{class:"btn",onClick:e[10]||(e[10]=a=>h.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):$.value==="employees"&&s.value===2?(o(),l("div",Tn,[t("header",Wn,[t("button",{class:"btn-back",onClick:V,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),t("h3",$n," Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+d(f.value?.name||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾")+" ("+d(g.value?.label||"")+") ",1),t("button",{class:"modal__close",onClick:e[11]||(e[11]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",An,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[M.value?(o(),l("div",Dn,[...e[22]||(e[22]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):O.value?(o(),l("div",Sn,[e[23]||(e[23]=t("div",{class:"error-icon"},"âš ï¸",-1)),e[24]||(e[24]=t("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),t("p",Nn,d(O.value),1),t("button",{class:"btn btn-retry",onClick:ge},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):p.value.length===0?(o(),l("div",En,[e[25]||(e[25]=t("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),t("p",On,d($.value==="employees"?`Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${g.value?.label||""}"`:"Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ"),1)])):(o(),l("div",Bn,[J(Ue,{name:"ticket",tag:"div",class:"tickets-list"},{default:ne(()=>[(o(!0),l(te,null,ae(i.value,(a,r)=>(o(),me(Re,{key:a.id,ticket:a,draggable:!1,style:we({"--ticket-index":r}),onClick:ue},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):z("",!0)]),_:1})])])):z("",!0)}},Un=fe(Mn,[["__scopeId","data-v-6f43202a"]]),Rn={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Pn={class:"modal"},In={key:"level-1",class:"level-1"},Ln={class:"modal__header"},Fn={class:"modal__title"},Hn={key:0},Gn={class:"modal__body"},Kn={key:"loading",class:"loading-names"},Vn={key:"empty",class:"modal__empty"},xn={key:"list",class:"stages-list"},jn=["onClick"],zn={class:"stages-list__name"},Yn={class:"stages-list__count"},Zn={key:0,class:"stages-list__arrow"},qn={class:"modal__footer"},Qn={key:"level-2",class:"level-2"},Jn={class:"modal__header"},Xn={class:"modal__title"},el={class:"modal__body"},tl={class:"time-sort-controls"},al={class:"time-sort-buttons"},sl=["onClick"],rl={class:"count"},ol={key:"loading",class:"loading-state"},nl={key:"error",class:"error-state"},ll={class:"error-message"},il={key:"empty",class:"empty-state"},cl={class:"empty-state-message"},dl={key:"tickets",class:"tickets-list-container"},ul={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(T,{emit:u}){const s=T,$=L(1),w=L(null),f=L([]),g=L(!1),p=L(!1),M=L(null),O=L([]),q=L(be.ONE_MONTH),Q=I(()=>O.value.length>0&&O.value.some(y=>y.count>0)),F=I(()=>{if(!f.value||f.value.length===0)return[];try{const y=performance.now(),n=Pe(f.value,q.value),E=performance.now();return console.log(`[StagesModal] Filtering took ${(E-y).toFixed(2)}ms, results: ${n.length}`),n}catch(y){return console.error("[StagesModal] Error filtering tickets:",y),[]}}),P=I(()=>Object.keys(Ae).map(y=>({key:y,label:Ae[y],count:Pe(f.value,y).length})));async function N(){if(console.log("[TASK-070] StagesModal: loadStages called",{weekNumber:s.weekNumber,weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc}),!s.weekStartUtc||!s.weekEndUtc){console.warn("[TASK-070] StagesModal: Missing week boundaries, cannot load stages"),O.value=[];return}p.value=!0,M.value=null;try{console.log("[TASK-070] StagesModal: Fetching stages from API...");const y=await Se({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeNewTicketsByStages:!0});console.log("[TASK-070] StagesModal: API response received",{hasNewTicketsByStages:!!y.data.newTicketsByStages,stagesCount:y.data.newTicketsByStages?.length||0}),O.value=y.data.newTicketsByStages||[],O.value.length===0?console.warn("[TASK-070] StagesModal: API returned empty stages array for week",s.weekNumber):console.log("[TASK-070] StagesModal: Stages loaded successfully",O.value.length,"stages")}catch(y){M.value=y.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÑ‚Ð°Ð´Ð¸Ð¹",console.error("[TASK-070] StagesModal: Error loading stages:",y),O.value=[]}finally{p.value=!1}}async function b(y,n=null){!y||y.count===0||(n&&n.currentTarget&&(n.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{n.currentTarget&&(n.currentTarget.style.transform="")},150)),w.value=y,$.value=2,await k(y.stageId))}async function k(y){g.value=!0,M.value=null;try{const n=O.value.find(D=>D.stageId===y);if(n&&Array.isArray(n.tickets)&&n.tickets.length>0){console.log("[TASK-070] StagesModal: Using preloaded tickets for stage",y,"count:",n.tickets.length);const D=n.tickets;try{const{prepareTicketsForDisplay:K}=await Ce(async()=>{const{prepareTicketsForDisplay:H}=await import("./chunk-DDkaCoCd.js").then(x=>x.t);return{prepareTicketsForDisplay:H}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);f.value=await K(D,null,null)}catch(K){console.error("[TASK-070] StagesModal: Error preparing tickets:",K),f.value=D}g.value=!1;return}if(console.log("[TASK-070] StagesModal: Tickets not preloaded, loading from API for stage",y),!s.weekStartUtc||!s.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const S=(await Se({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages?.find(D=>D.stageId===y)?.tickets||[];try{const{prepareTicketsForDisplay:D}=await Ce(async()=>{const{prepareTicketsForDisplay:K}=await import("./chunk-DDkaCoCd.js").then(H=>H.t);return{prepareTicketsForDisplay:K}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);f.value=await D(S,null,null)}catch(D){console.error("[StagesModal] Error preparing tickets:",D),f.value=S}f.value.length===0&&(M.value=null)}catch(n){M.value=n.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[StagesModal] Error loading tickets:",n),f.value=[]}finally{g.value=!1}}function v(){$.value=1,w.value=null,f.value=[],M.value=null}function i(y){const n=Ge(y.id);window.open(n,"_blank")}function C(){w.value&&k(w.value.stageId)}function A(y){console.log(`[StagesModal] Sort mode changed: ${q.value} -> ${y}`);const n=performance.now();q.value=y,setTimeout(()=>{const E=F.value,W=performance.now();console.log(`[StagesModal] Filtering completed in ${(W-n).toFixed(2)}ms, ${E.length} tickets shown`)},0)}return _e(()=>s.isVisible,async y=>{y?($.value=1,w.value=null,f.value=[],M.value=null,console.log("[TASK-070] StagesModal opened:",{weekNumber:s.weekNumber,weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,preloadedData:s.preloadedData?Array.isArray(s.preloadedData)?`Array(${s.preloadedData.length})`:typeof s.preloadedData:"null"}),s.preloadedData&&Array.isArray(s.preloadedData)&&s.preloadedData.length>0?(console.log("[TASK-070] StagesModal: Using preloaded data, stages count:",s.preloadedData.length),s.preloadedData.every(E=>E.stageId&&E.stageName&&typeof E.count=="number")?(O.value=s.preloadedData,p.value=!1,console.log("[TASK-070] StagesModal: Preloaded data set, stages:",O.value.length)):(console.warn("[TASK-070] StagesModal: Invalid preloaded data structure, falling back to API"),await N())):(console.log("[TASK-070] StagesModal: No preloaded data, loading from API",{weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc}),await N())):($.value=1,w.value=null,f.value=[],M.value=null,O.value=[])},{immediate:!1}),_e([()=>s.weekNumber,()=>s.preloadedData],async([y,n])=>{s.isVisible&&y&&(n&&Array.isArray(n)&&n.length>0?n.every(W=>W.stageId&&W.stageName&&typeof W.count=="number")?(console.log("[TASK-070] StagesModal: Week changed, updating with preloaded data for week",y),O.value=n,p.value=!1):(console.log("[TASK-070] StagesModal: Week changed, invalid preloaded data, loading from API for week",y),await N()):(console.log("[TASK-070] StagesModal: Week changed, loading from API for week",y),await N()))}),(y,n)=>T.isVisible?(o(),l("div",Rn,[t("div",Pn,[J(he,{name:"level",mode:"out-in"},{default:ne(()=>[$.value===1?(o(),l("div",In,[t("header",Ln,[t("h3",Fn,[n[3]||(n[3]=ve(" ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),T.weekNumber?(o(),l("span",Hn," Â· ÐÐµÐ´ÐµÐ»Ñ "+d(T.weekNumber),1)):z("",!0)]),t("button",{class:"modal__close",onClick:n[0]||(n[0]=E=>y.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Gn,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[p.value?(o(),l("div",Kn,[...n[4]||(n[4]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÑ‚Ð°Ð´Ð¸Ð¹...",-1)])])):Q.value?(o(),l("ul",xn,[(o(!0),l(te,null,ae(O.value,E=>(o(),l("li",{key:E.stageId,class:oe(["stages-list__item",{"stages-list__item--clickable":E.count>0}]),style:we({"--stage-color":E.color}),onClick:W=>b(E,W),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÑ‚Ð°Ð´Ð¸Ð¸"},[t("span",{class:"stages-list__color",style:we({backgroundColor:E.color})},null,4),t("span",zn,d(E.stageName),1),t("span",Yn,d(E.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),E.count>0?(o(),l("span",Zn,"â†’")):z("",!0)],14,jn))),128))])):(o(),l("p",Vn," ÐÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),t("footer",qn,[t("button",{class:"btn",onClick:n[1]||(n[1]=E=>y.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):$.value===2?(o(),l("div",Qn,[t("header",Jn,[t("button",{class:"btn-back",onClick:v,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),t("h3",Xn," Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÑ‚Ð°Ð´Ð¸Ð¸: "+d(w.value?.stageName||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),t("button",{class:"modal__close",onClick:n[2]||(n[2]=E=>y.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",el,[t("div",tl,[n[5]||(n[5]=t("h4",{class:"time-sort-title"},"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹:",-1)),t("div",al,[(o(!0),l(te,null,ae(P.value,E=>(o(),l("button",{key:E.key,class:oe(["time-sort-btn",{active:q.value===E.key}]),onClick:W=>A(E.key)},[ve(d(E.label)+" ",1),t("span",rl,"("+d(E.count)+")",1)],10,sl))),128))])]),J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[g.value?(o(),l("div",ol,[...n[6]||(n[6]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÑ‚Ð°Ð´Ð¸Ð¸...",-1),t("p",{class:"loading-subtitle"},"Ð­Ñ‚Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐµÐºÑƒÐ½Ð´ Ð´Ð»Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ñ… Ð¾Ð±ÑŠÐµÐ¼Ð¾Ð² Ð´Ð°Ð½Ð½Ñ‹Ñ…",-1)])])):M.value?(o(),l("div",nl,[n[7]||(n[7]=t("div",{class:"error-icon"},"âš ï¸",-1)),n[8]||(n[8]=t("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),t("p",ll,d(M.value),1),t("button",{class:"btn btn-retry",onClick:C},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):F.value.length===0?(o(),l("div",il,[n[9]||(n[9]=t("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),t("p",cl," ÐÐ° ÑÑ‚Ð°Ð´Ð¸Ð¸ Â«"+d(w.value?.stageName)+"Â» Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´ ("+d(De(Ae)[q.value])+") ",1)])):(o(),l("div",dl,[J(Ue,{name:"ticket",tag:"div",class:"tickets-list"},{default:ne(()=>[(o(!0),l(te,null,ae(F.value,(E,W)=>(o(),me(Re,{key:E.id,ticket:E,draggable:!1,style:we({"--ticket-index":W}),onClick:i},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):z("",!0)]),_:1})])])):z("",!0)}},kl=fe(ul,[["__scopeId","data-v-0dacaef9"]]),$e=new Map,vl=5*60*1e3;function hl(T,u){return`${T}:${JSON.stringify(u)}`}function xe(T){return Date.now()-T.timestamp<vl}function ml(T,u){if($e.set(T,{data:u,timestamp:Date.now()}),$e.size>20){const s=$e.keys().next().value;$e.delete(s)}}function yl(T){const u=$e.get(T);return u&&xe(u)?(console.log("[API-CACHE] Cache hit for key:",T),u.data):(u&&!xe(u)&&(console.log("[API-CACHE] Cache expired for key:",T),$e.delete(T)),null)}async function pl(T={}){const u="/api/graph-1c-admission-closure.php",s=hl(u,T),$=yl(u);if($)return $;console.log("[API-CACHE] Cache miss, making API request for:",s);const{LazyServiceLoader:w}=await Ce(async()=>{const{LazyServiceLoader:p}=await import("./chunk-BeqOLNMR.js").then(M=>M.l);return{LazyServiceLoader:p}},__vite__mapDeps([3,4]),import.meta.url),{fetchAdmissionClosureStats:f}=await w.loadAdmissionClosureService(),g=await f(T);return ml(s,g),g}async function gl(T,u){return pl({product:"1C",weekStartUtc:T,weekEndUtc:u,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})}const bl={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},fl={class:"modal"},_l={key:"level-1",class:"level-1"},wl={class:"modal__header"},Cl={class:"modal__title"},Tl={key:0},Wl={class:"modal__body"},$l={key:"loading",class:"loading-names"},Al={key:"empty",class:"modal__empty"},Dl={key:"list",class:"duration-list"},Sl=["onClick"],Nl={class:"duration-list__name"},El={class:"duration-list__count"},Ol={key:0,class:"duration-list__arrow"},Bl={class:"modal__footer"},Ml={key:"level-2",class:"level-2"},Ul={class:"modal__header"},Rl={class:"modal__title"},Pl={class:"modal__body"},Il={key:"loading",class:"loading-state"},Ll={key:"error",class:"error-state"},Fl={class:"error-message"},Hl={key:"empty",class:"empty-state"},Gl={class:"empty-state-message"},Kl={key:"tickets",class:"tickets-list-container"},Vl={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(T,{emit:u}){const s=T,$=L(1),w=L(null),f=L([]),g=L(!1),p=L(!1),M=L(null),O=L([]),q=I(()=>O.value.length>0&&O.value.some(v=>v.count>0));async function Q(){if(!s.weekStartUtc||!s.weekEndUtc){O.value=[];return}p.value=!0,M.value=null;try{const v=await Se({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});O.value=v.data.carryoverTicketsByDuration||[]}catch(v){M.value=v.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹",console.error("[CarryoverDurationModal] Error loading categories:",v),O.value=[]}finally{p.value=!1}}async function F(v,i=null){!v||v.count===0||(i&&i.currentTarget&&(i.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{i.currentTarget&&(i.currentTarget.style.transform="")},150)),w.value=v,$.value=2,await P(v.durationCategory))}async function P(v){g.value=!0,M.value=null;try{const i=O.value.find(n=>n.durationCategory===v);if(i&&Array.isArray(i.tickets)&&i.tickets.length>0){console.log("[TASK-070] CarryoverDurationModal: Using preloaded tickets for category",v,"count:",i.tickets.length);const n=i.tickets;try{const{prepareTicketsForDisplay:E}=await Ce(async()=>{const{prepareTicketsForDisplay:W}=await import("./chunk-DDkaCoCd.js").then(S=>S.t);return{prepareTicketsForDisplay:W}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);f.value=await E(n,null,null)}catch(E){console.error("[TASK-070] CarryoverDurationModal: Error preparing tickets:",E),f.value=n}g.value=!1;return}if(console.log("[TASK-070] CarryoverDurationModal: Tickets not preloaded, loading from API for category",v),!s.weekStartUtc||!s.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const y=(await gl(s.weekStartUtc,s.weekEndUtc)).data.carryoverTicketsByDuration?.find(n=>n.durationCategory===v)?.tickets||[];try{const{prepareTicketsForDisplay:n}=await Ce(async()=>{const{prepareTicketsForDisplay:E}=await import("./chunk-DDkaCoCd.js").then(W=>W.t);return{prepareTicketsForDisplay:E}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);f.value=await n(y,null,null)}catch(n){console.error("[CarryoverDurationModal] Error preparing tickets:",n),f.value=y}f.value.length===0&&(M.value=null)}catch(i){M.value=i.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[CarryoverDurationModal] Error loading tickets:",i),f.value=[]}finally{g.value=!1}}function N(){$.value=1,w.value=null,f.value=[],M.value=null}function b(v){const i=Ge(v.id);window.open(i,"_blank")}function k(){w.value&&P(w.value.durationCategory)}return _e(()=>s.isVisible,async v=>{v?($.value=1,w.value=null,f.value=[],M.value=null,s.preloadedData&&Array.isArray(s.preloadedData)&&s.preloadedData.length>0?(console.log("[TASK-070] CarryoverDurationModal: Using preloaded data, categories count:",s.preloadedData.length),s.preloadedData.every(C=>C.durationCategory&&C.durationLabel&&typeof C.count=="number")?(O.value=s.preloadedData,p.value=!1):(console.warn("[TASK-070] CarryoverDurationModal: Invalid preloaded data structure, falling back to API"),await Q())):(console.log("[TASK-070] CarryoverDurationModal: No preloaded data, loading from API"),await Q())):($.value=1,w.value=null,f.value=[],M.value=null,O.value=[])},{immediate:!1}),_e([()=>s.weekNumber,()=>s.preloadedData],async([v,i])=>{s.isVisible&&v&&(i&&Array.isArray(i)&&i.length>0?i.every(A=>A.durationCategory&&A.durationLabel&&typeof A.count=="number")?(console.log("[TASK-070] CarryoverDurationModal: Week changed, updating with preloaded data for week",v),O.value=i,p.value=!1):(console.log("[TASK-070] CarryoverDurationModal: Week changed, invalid preloaded data, loading from API for week",v),await Q()):(console.log("[TASK-070] CarryoverDurationModal: Week changed, loading from API for week",v),await Q()))}),(v,i)=>T.isVisible?(o(),l("div",bl,[t("div",fl,[J(he,{name:"level",mode:"out-in"},{default:ne(()=>[$.value===1?(o(),l("div",_l,[t("header",wl,[t("h3",Cl,[i[3]||(i[3]=ve(" ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ€Ð¾ÐºÐ°Ð¼",-1)),T.weekNumber?(o(),l("span",Tl," Â· ÐÐµÐ´ÐµÐ»Ñ "+d(T.weekNumber),1)):z("",!0)]),t("button",{class:"modal__close",onClick:i[0]||(i[0]=C=>v.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Wl,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[p.value?(o(),l("div",$l,[...i[4]||(i[4]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹...",-1)])])):q.value?(o(),l("ul",Dl,[(o(!0),l(te,null,ae(O.value,C=>(o(),l("li",{key:C.durationCategory,class:oe(["duration-list__item",{"duration-list__item--clickable":C.count>0}]),style:we({"--duration-color":C.color}),onClick:A=>F(C,A),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"},[t("span",{class:"duration-list__color",style:we({backgroundColor:C.color})},null,4),t("span",Nl,d(C.durationLabel),1),t("span",El,d(C.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),C.count>0?(o(),l("span",Ol,"â†’")):z("",!0)],14,Sl))),128))])):(o(),l("p",Al," ÐÐµÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),t("footer",Bl,[t("button",{class:"btn",onClick:i[1]||(i[1]=C=>v.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):$.value===2?(o(),l("div",Ml,[t("header",Ul,[t("button",{class:"btn-back",onClick:N,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),t("h3",Rl," Ð¢Ð¸ÐºÐµÑ‚Ñ‹: "+d(w.value?.durationLabel||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),t("button",{class:"modal__close",onClick:i[2]||(i[2]=C=>v.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Pl,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[g.value?(o(),l("div",Il,[...i[5]||(i[5]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸...",-1),t("p",{class:"loading-subtitle"},"Ð­Ñ‚Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐµÐºÑƒÐ½Ð´ Ð´Ð»Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ñ… Ð¾Ð±ÑŠÐµÐ¼Ð¾Ð² Ð´Ð°Ð½Ð½Ñ‹Ñ…",-1)])])):M.value?(o(),l("div",Ll,[i[6]||(i[6]=t("div",{class:"error-icon"},"âš ï¸",-1)),i[7]||(i[7]=t("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),t("p",Fl,d(M.value),1),t("button",{class:"btn btn-retry",onClick:k},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):f.value.length===0?(o(),l("div",Hl,[i[8]||(i[8]=t("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),t("p",Gl," Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Â«"+d(w.value?.durationLabel)+"Â» Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1)])):(o(),l("div",Kl,[J(Ue,{name:"ticket",tag:"div",class:"tickets-list"},{default:ne(()=>[(o(!0),l(te,null,ae(f.value,(C,A)=>(o(),me(Re,{key:C.id,ticket:C,draggable:!1,style:we({"--ticket-index":A}),onClick:b},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):z("",!0)]),_:1})])])):z("",!0)}},xl=fe(Vl,[["__scopeId","data-v-f199806c"]]);function jl(){const T=L(null),u=L(!1),s=L(null),$=async()=>{if(T.value)return T.value;try{u.value=!0,s.value=null;const{fetchAdmissionClosureStats:g,...p}=await rt.loadAdmissionClosureService();T.value={fetchAdmissionClosureStats:g,...p}}catch(g){throw s.value=g,console.error("Failed to load admission service:",g),g}finally{u.value=!1}return T.value},w=async(g={})=>(await $()).fetchAdmissionClosureStats(g),f=()=>{T.value=null,s.value=null};return{service:Le(T),loading:Le(u),error:Le(s),loadService:$,fetchStats:w,clearService:f}}const zl={class:"ac-dashboard"},Yl={key:"preloader",class:"chart-preloader"},Zl={class:"preloader-content"},ql={class:"preloader-message"},Ql={key:"content"},Jl={key:1,class:"weeks-dashboard"},Xl={class:"dashboard-header"},ei={class:"header-content"},ti={class:"breadcrumbs-row"},ai=["aria-label","aria-disabled","data-fallback","disabled"],si={class:"breadcrumbs","aria-label":"ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ"},ri={class:"dashboard-layout"},oi={class:"filters-container"},ni={class:"chart-container"},li={__name:"GraphAdmissionClosureDashboard",setup(T){const u=Ye(),{fetchStats:s}=jl(),$=async _=>await s(_),w=L(!1),f=L(null),g=L(null),p=L({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),M=L(!1),O=L(!1),q=L(!1),Q=L(!0),F=L(null),P=L({weeks:new Map,currentWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null},previousWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null}}),N=I(()=>{const _=g.value?.weeks||[];return _.length>=2?_[_.length-2]:null}),b=L(!1),k=I(()=>typeof window>"u"?!1:window.history.length>1),v=I(()=>k.value?"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ":"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"),i={name:"dashboard-sector-1c"};function C(_){if(_?.preventDefault?.(),!b.value){b.value=!0;try{if(k.value){u.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),u.push(i)}finally{b.value=!1}}}function A(){u.push("/")}const y=L({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),n=L("weeks"),E=I(()=>{const _=y.value.customDateRange.startDate||y.value.customDateRange.endDate,m=y.value.employees.length===1&&y.value.employees.includes("all");return _||!m});async function W(){if(console.log("[DEBUG] loadData called"),console.log("[DEBUG] periodMode:",n.value),console.log("[DEBUG] isLoading before:",w.value),n.value!=="weeks"){console.log("[DEBUG] loadData: periodMode is not weeks, returning and resetting isLoading"),w.value=!1;return}console.log("[DEBUG] Setting isLoading to true"),w.value=!0,f.value=null;const _=new Promise(m=>setTimeout(m,300));try{console.log("[DEBUG] Starting API call");const m=Ie(),X=m.weekStartUtc,ee=m.weekEndUtc;console.log("[DEBUG] Week bounds:",{weekStartUtc:X,weekEndUtc:ee});const[de,re]=await Promise.all([_,$({product:"1C",periodMode:"weeks",weekStartUtc:X,weekEndUtc:ee,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0})]);console.log("[DEBUG] API call successful, result:",re);const{meta:B,data:Y,carryoverDebug:pe}=re;g.value=B;const Be=Array.isArray(Y.responsibleCreatedThisWeek)?Y.responsibleCreatedThisWeek:Y.responsibleCreatedThisWeek?Object.values(Y.responsibleCreatedThisWeek):[],Me=Array.isArray(Y.responsibleCreatedOtherWeek)?Y.responsibleCreatedOtherWeek:Y.responsibleCreatedOtherWeek?Object.values(Y.responsibleCreatedOtherWeek):[];p.value={...Y,responsibleCreatedThisWeek:Be,responsibleCreatedOtherWeek:Me},console.log("[DEBUG] Data set, meta:",B,"data keys:",Object.keys(Y)),console.log("[TASK-070] chartData.value.responsibleCreatedThisWeek after normalization:",{isArray:Array.isArray(Be),length:Be.length,sample:Be.slice(0,2).map(j=>({id:j.id,name:j.name,count:j.count,hasTickets:!!j.tickets,ticketsCount:j.tickets?.length||0}))}),console.log("[TASK-070] chartData.value.responsibleCreatedOtherWeek after normalization:",{isArray:Array.isArray(Me),length:Me.length,sample:Me.slice(0,2).map(j=>({id:j.id,name:j.name,count:j.count,hasTickets:!!j.tickets,ticketsCount:j.tickets?.length||0}))}),console.log("[TASK-070] responsibleCreatedThisWeek from API:",{count:Y.responsibleCreatedThisWeek?.length||0,data:Y.responsibleCreatedThisWeek,details:Y.responsibleCreatedThisWeek?.map(j=>({id:j.id,name:j.name,count:j.count,hasTickets:!!j.tickets,ticketsCount:j.tickets?.length||0}))}),console.log("[TASK-070] responsibleCreatedOtherWeek from API:",{count:Y.responsibleCreatedOtherWeek?.length||0,data:Y.responsibleCreatedOtherWeek,details:Y.responsibleCreatedOtherWeek?.map(j=>({id:j.id,name:j.name,count:j.count,hasTickets:!!j.tickets,ticketsCount:j.tickets?.length||0}))}),console.log("[TASK-070] closedTicketsCreatedThisWeek:",Y.closedTicketsCreatedThisWeek),console.log("[TASK-070] closedTicketsCreatedOtherWeek:",Y.closedTicketsCreatedOtherWeek);const Ee=B?.weeks||[];if(console.log("[PERF-OPTIMIZATION] Preloading popup data for",Ee.length,"weeks"),Ee.forEach((j,ke)=>{P.value.weeks.has(j.weekNumber)||P.value.weeks.set(j.weekNumber,{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:j});const ie=P.value.weeks.get(j.weekNumber);ke===Ee.length-1&&(Y.newTicketsByStages&&(ie.newTicketsByStages=Y.newTicketsByStages,console.log("[PERF-OPTIMIZATION] Preloaded newTicketsByStages for week",j.weekNumber,":",Y.newTicketsByStages.length,"stages")),Y.carryoverTicketsByDuration&&(ie.carryoverTicketsByDuration=Y.carryoverTicketsByDuration,console.log("[PERF-OPTIMIZATION] Preloaded carryoverTicketsByDuration for week",j.weekNumber,":",Y.carryoverTicketsByDuration.length,"categories")))}),Y.newTicketsByStages&&(P.value.currentWeek.newTicketsByStages=Y.newTicketsByStages),Y.carryoverTicketsByDuration&&(P.value.currentWeek.carryoverTicketsByDuration=Y.carryoverTicketsByDuration),Ee.length>1&&K(Ee.slice(0,-1)),Y.responsibleCreatedThisWeek){const j=Array.isArray(Y.responsibleCreatedThisWeek)?Y.responsibleCreatedThisWeek:Object.values(Y.responsibleCreatedThisWeek);P.value.currentWeek.responsibleCreatedThisWeek=j,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for current week:",j.length,"employees"),console.log("[TASK-070] responsibleCreatedThisWeek details:",j.map(ke=>({id:ke.id,name:ke.name,count:ke.count,hasTickets:!!ke.tickets,ticketsCount:ke.tickets?.length||0})))}if(Y.responsibleCreatedOtherWeek){const j=Array.isArray(Y.responsibleCreatedOtherWeek)?Y.responsibleCreatedOtherWeek:Object.values(Y.responsibleCreatedOtherWeek);P.value.currentWeek.responsibleCreatedOtherWeek=j,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for current week:",j.length,"employees"),console.log("[TASK-070] responsibleCreatedOtherWeek details:",j.map(ke=>({id:ke.id,name:ke.name,count:ke.count,hasTickets:!!ke.tickets,ticketsCount:ke.tickets?.length||0})))}if(pe&&(console.log("[CARRYOVER-DEBUG] ========================================"),console.log("[CARRYOVER-DEBUG] Total:",pe.total),console.log("[CARRYOVER-DEBUG] ThisWeek:",pe.thisWeek),console.log("[CARRYOVER-DEBUG] PreviousWeek:",pe.previousWeek),console.log("[CARRYOVER-DEBUG] Older:",pe.older),console.log("[CARRYOVER-DEBUG] Sum:",pe.sum,"(expected:",pe.total,")"),console.log("[CARRYOVER-DEBUG] Series:",pe.series),console.log("[CARRYOVER-DEBUG] CurrentWeekData:",pe.currentWeekData),console.log("[CARRYOVER-DEBUG] WeeksData:",pe.weeksData),console.log("[CARRYOVER-DEBUG] Full object:",pe),console.log("[CARRYOVER-DEBUG] ========================================")),N.value){const j=N.value.weekStartUtc,ke=N.value.weekEndUtc;console.log("[TASK-070] Starting preload for previous week:",{weekNumber:N.value.weekNumber,weekStartUtc:j,weekEndUtc:ke}),$({product:"1C",periodMode:"weeks",weekStartUtc:j,weekEndUtc:ke,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0}).then(ie=>{if(console.log("[TASK-070] Preload successful for previous week"),ie.data.newTicketsByStages&&(P.value.previousWeek.newTicketsByStages=ie.data.newTicketsByStages,console.log("[TASK-070] Preloaded newTicketsByStages for previous week:",ie.data.newTicketsByStages.length,"stages")),ie.data.carryoverTicketsByDuration&&(P.value.previousWeek.carryoverTicketsByDuration=ie.data.carryoverTicketsByDuration,console.log("[TASK-070] Preloaded carryoverTicketsByDuration for previous week:",ie.data.carryoverTicketsByDuration.length,"categories")),ie.data.responsibleCreatedThisWeek){const Oe=Array.isArray(ie.data.responsibleCreatedThisWeek)?ie.data.responsibleCreatedThisWeek:Object.values(ie.data.responsibleCreatedThisWeek);P.value.previousWeek.responsibleCreatedThisWeek=Oe,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for previous week:",Oe.length,"employees")}if(ie.data.responsibleCreatedOtherWeek){const Oe=Array.isArray(ie.data.responsibleCreatedOtherWeek)?ie.data.responsibleCreatedOtherWeek:Object.values(ie.data.responsibleCreatedOtherWeek);P.value.previousWeek.responsibleCreatedOtherWeek=Oe,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for previous week:",Oe.length,"employees")}}).catch(ie=>{console.warn("[TASK-070] Failed to preload previous week data (non-critical):",ie)})}}catch(m){console.error("[DEBUG] API call failed:",m),f.value=m instanceof Error?m:new Error("ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸"),console.error("[GraphAdmissionClosureDashboard] loadData error:",m)}finally{console.log("[DEBUG] Finally block: setting isLoading to false"),w.value=!1,console.log("[DEBUG] isLoading after:",w.value)}}function S(_){if(!_||!g.value)return console.log("[TASK-070] getPreloadedStagesData: Missing weekMeta or chartMeta"),null;const m=g.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:g.value.weekNumber,ee=m.length>=2?m[m.length-2].weekNumber:null;console.log("[TASK-070] getPreloadedStagesData:",{requestedWeek:_.weekNumber,currentWeekNumber:X,previousWeekNumber:ee,weeksInMeta:m.length});const de=_.weekNumber===X,re=_.weekNumber===ee;let B=null;if(de)B=P.value.currentWeek.newTicketsByStages,console.log("[TASK-070] Requested week is current week, checking currentWeek data:",B?`Array(${B.length})`:"null");else if(re)B=P.value.previousWeek.newTicketsByStages,console.log("[TASK-070] Requested week is previous week, checking previousWeek data:",B?`Array(${B.length})`:"null");else return console.log("[TASK-070] Requested week",_.weekNumber,"is neither current nor previous, no preloaded data available"),null;return Array.isArray(B)&&B.length>0?(console.log("[TASK-070] Using preloaded stages data for week",_.weekNumber,":",B.length,"stages"),B):(console.log("[TASK-070] No preloaded stages data for week",_.weekNumber,", will use API fallback"),null)}function D(_){if(!_)return null;const m=P.value.weeks.get(_.weekNumber);if(m?.carryoverTicketsByDuration&&Array.isArray(m.carryoverTicketsByDuration))return console.log("[PERF-OPTIMIZATION] Using preloaded carryover data for week",_.weekNumber,":",m.carryoverTicketsByDuration.length,"categories"),m.carryoverTicketsByDuration;const X=g.value?.weeks||[],ee=X.length>0?X[X.length-1].weekNumber:g.value.weekNumber,re=_.weekNumber===ee?P.value.currentWeek.carryoverTicketsByDuration:P.value.previousWeek.carryoverTicketsByDuration;return Array.isArray(re)&&re.length>0?(console.log("[TASK-070] Using fallback preloaded carryover data for week",_.weekNumber,":",re.length,"categories"),re):(console.log("[PERF-ISSUE] No preloaded carryover data for week",_.weekNumber,", will use slow API fallback"),null)}async function K(_){if(!(!_||_.length===0)){console.log("[PERF-OPTIMIZATION] Starting background preload for",_.length,"weeks");for(const m of _)try{await new Promise(de=>setTimeout(de,500)),console.log("[PERF-OPTIMIZATION] Preloading data for week",m.weekNumber);const X=await $({product:"1C",periodMode:"weeks",weekStartUtc:m.weekStartUtc,weekEndUtc:m.weekEndUtc,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!1}),ee={newTicketsByStages:X.data.newTicketsByStages||null,carryoverTicketsByDuration:X.data.carryoverTicketsByDuration||null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:m};P.value.weeks.set(m.weekNumber,ee),console.log("[PERF-OPTIMIZATION] Successfully preloaded data for week",m.weekNumber)}catch(X){console.warn("[PERF-OPTIMIZATION] Failed to preload data for week",m.weekNumber,":",X)}console.log("[PERF-OPTIMIZATION] Background preload completed")}}function H(_){if(!_||!g.value)return null;const m=g.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:g.value.weekNumber;return _.weekNumber===X&&p.value.responsible||null}function x(_){if(!_){const B=p.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: weekMeta is null, using chartData:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:B?Object.keys(B).length:0}),B?Array.isArray(B)?B:Object.values(B):null}if(!g.value)return console.log("[TASK-070] getResponsibleCreatedThisWeek: chartMeta is null"),null;const m=g.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:g.value.weekNumber,ee=m.length>=2?m[m.length-2].weekNumber:null,de=_.weekNumber===X,re=_.weekNumber===ee;if(console.log("[TASK-070] getResponsibleCreatedThisWeek:",{requestedWeek:_.weekNumber,currentWeekNumber:X,previousWeekNumber:ee,isCurrentWeek:de,isPreviousWeek:re}),de){const B=p.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: current week data:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:B?Object.keys(B).length:0}),B?Array.isArray(B)?B:Object.values(B):null}if(re){const B=P.value.previousWeek.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: previous week data:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:0,data:B}),B||null}return console.log("[TASK-070] getResponsibleCreatedThisWeek: week",_.weekNumber,"is neither current nor previous, no preloaded data"),null}function V(_){if(!_){const B=p.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: weekMeta is null, using chartData:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:B?Object.keys(B).length:0}),B?Array.isArray(B)?B:Object.values(B):null}if(!g.value)return console.log("[TASK-070] getResponsibleCreatedOtherWeek: chartMeta is null"),null;const m=g.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:g.value.weekNumber,ee=m.length>=2?m[m.length-2].weekNumber:null,de=_.weekNumber===X,re=_.weekNumber===ee;if(console.log("[TASK-070] getResponsibleCreatedOtherWeek:",{requestedWeek:_.weekNumber,currentWeekNumber:X,previousWeekNumber:ee,isCurrentWeek:de,isPreviousWeek:re}),de){const B=p.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: current week data:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:B?Object.keys(B).length:0}),B?Array.isArray(B)?B:Object.values(B):null}if(re){const B=P.value.previousWeek.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: previous week data:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:0,data:B}),B||null}return console.log("[TASK-070] getResponsibleCreatedOtherWeek: week",_.weekNumber,"is neither current nor previous, no preloaded data"),null}function Z(_){if(!_||!g.value)return null;const m=g.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:g.value.weekNumber,ee=m.length>=2?m[m.length-2].weekNumber:null,de=_.weekNumber===X,re=_.weekNumber===ee;return de?p.value.closedTicketsCreatedThisWeek??null:re&&p.value.weeksData?p.value.weeksData.find(Y=>Y.weekNumber===ee)?.closedTicketsCreatedThisWeek??null:null}function ue(_){if(!_||!g.value)return null;const m=g.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:g.value.weekNumber,ee=m.length>=2?m[m.length-2].weekNumber:null,de=_.weekNumber===X,re=_.weekNumber===ee;return de?p.value.closedTicketsCreatedOtherWeek??null:re&&p.value.weeksData?p.value.weeksData.find(Y=>Y.weekNumber===ee)?.closedTicketsCreatedOtherWeek??null:null}function ge(_){y.value.stages=_}function h(_){y.value.employees=_}function e(_){y.value.dateRange=_}function a(_){y.value.customDateRange=_}function r(_){if(!["weeks","months"].includes(_)){console.warn("[GraphAdmissionClosureDashboard] Invalid periodMode:",_);return}_!==n.value&&(n.value=_,_==="weeks"?W():_==="months"&&(w.value=!1))}function U(_){const{mode:m}=_.detail;["weeks","months"].includes(m)&&r(m)}function R(){y.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},G()}function G(){n.value==="weeks"&&W()}function se(_){["weeks","months"].includes(_)&&(n.value=_)}function ce(){console.log("[DEBUG] handleCloseModal called"),console.log("[DEBUG] showPeriodModeInfo before:",Q.value),console.log("[DEBUG] isLoading before:",w.value),console.log("[DEBUG] periodMode:",n.value),Q.value=!1,w.value=!0,console.log("[DEBUG] showPeriodModeInfo after:",Q.value),console.log("[DEBUG] isLoading after:",w.value),Ke(()=>{console.log("[DEBUG] handleCloseModal: calling handleStartLoading in nextTick"),le()})}function le(){console.log("[DEBUG] handleStartLoading called"),console.log("[DEBUG] periodMode before check:",n.value),console.log("[DEBUG] showPeriodModeInfo:",Q.value),console.log("[DEBUG] isLoading:",w.value),(!n.value||!["weeks","months"].includes(n.value))&&(console.warn('[GraphAdmissionClosureDashboard] Period mode not set, using default "weeks"'),n.value="weeks"),console.log("[GraphAdmissionClosureDashboard] Starting loading, periodMode:",n.value),Ke(()=>{console.log("[DEBUG] nextTick callback, periodMode:",n.value),console.log("[DEBUG] isLoading in nextTick:",w.value),n.value==="weeks"?(console.log("[GraphAdmissionClosureDashboard] Loading data for weeks mode"),W()):n.value==="months"&&(console.log("[GraphAdmissionClosureDashboard] Months mode - data will be loaded by GraphAdmissionClosureMonthsDashboard"),w.value=!1,console.log("[DEBUG] Reset parent isLoading to false for months mode"))})}function ye(_=null){_?F.value=_:F.value={weekNumber:g.value?.weekNumber||null,weekStartUtc:g.value?.weekStartUtc||null,weekEndUtc:g.value?.weekEndUtc||null},O.value=!0}function Te(_=null){_?F.value=_:F.value={weekNumber:g.value?.weekNumber||null,weekStartUtc:g.value?.weekStartUtc||null,weekEndUtc:g.value?.weekEndUtc||null},M.value=!0}function Ne(_=null){_?F.value=_:F.value={weekNumber:g.value?.weekNumber||null,weekStartUtc:g.value?.weekStartUtc||null,weekEndUtc:g.value?.weekEndUtc||null},q.value=!0}He(()=>{try{const _="graph-admission-closure-period-mode-info-shown";localStorage.getItem(_)&&localStorage.removeItem(_);const m="graph-admission-closure-period-mode";localStorage.getItem(m)&&localStorage.removeItem(m)}catch(_){console.warn("[GraphAdmissionClosureDashboard] Failed to clean localStorage:",_)}window.addEventListener("period-mode-change",U)}),je(()=>{window.removeEventListener("period-mode-change",U)});function Ie(){const _=new Date,m=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),_.getUTCDate())),X=m.getUTCDay(),ee=m.getUTCDate()-X+(X===0?-6:1),de=new Date(Date.UTC(m.getUTCFullYear(),m.getUTCMonth(),ee,0,0,0)),re=new Date(de);return re.setUTCDate(re.getUTCDate()+6),re.setUTCHours(23,59,59,999),{weekStartUtc:de.toISOString(),weekEndUtc:re.toISOString()}}return(_,m)=>{const X=Ze("router-link");return o(),l("div",zl,[J(he,{name:"fade",mode:"out-in"},{default:ne(()=>[w.value?(o(),l("div",Yl,[t("div",Zl,[m[3]||(m[3]=t("div",{class:"preloader-spinner"},[t("div",{class:"spinner-ring"}),t("div",{class:"spinner-ring"}),t("div",{class:"spinner-ring"})],-1)),m[4]||(m[4]=t("h3",{class:"preloader-title"},"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°",-1)),t("p",ql," ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° "+d(n.value==="weeks"?"4 Ð½ÐµÐ´ÐµÐ»Ð¸":"3 Ð¼ÐµÑÑÑ†Ð°")+"... ",1),m[5]||(m[5]=t("div",{class:"preloader-dots"},[t("span",{class:"dot"}),t("span",{class:"dot"}),t("span",{class:"dot"})],-1))])])):!Q.value&&!w.value?(o(),l("div",Ql,[n.value==="months"?(o(),me(eo,{key:0})):(o(),l("div",Jl,[t("div",Xl,[t("div",ei,[t("div",ti,[t("button",{class:"btn-home-link",type:"button",onClick:A,title:"ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ","aria-label":"ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"}," Ð“Ð»Ð°Ð²Ð½Ð°Ñ "),m[11]||(m[11]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),t("button",{class:"btn-back-link",type:"button",onClick:C,"aria-label":v.value,"aria-disabled":!k.value,"data-fallback":!k.value,disabled:b.value,title:"ÐÐ°Ð·Ð°Ð´"}," â† ",8,ai),t("nav",si,[J(X,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ne(()=>[...m[6]||(m[6]=[ve(" Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡ ",-1)])]),_:1}),m[8]||(m[8]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),J(X,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:ne(()=>[...m[7]||(m[7]=[ve(" Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ",-1)])]),_:1}),m[9]||(m[9]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),m[10]||(m[10]=t("span",{class:"breadcrumb-current"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹",-1))])]),m[12]||(m[12]=t("h1",{class:"dashboard-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),m[13]||(m[13]=t("p",{class:"dashboard-subtitle"}," Ð”Ð¾ÑÑ‚ÑƒÐ¿Ñ‹ Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ñ‹ Â«Ð“Ñ€Ð°Ñ„Ð¸ÐºÑƒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑÂ», ÑÐµÐ»ÐµÐºÑ‚Ð¾Ñ€ ÑÑ‚Ð°Ð¿Ð¾Ð² ÑÐºÑ€Ñ‹Ñ‚. ",-1))])]),t("div",ri,[t("div",oi,[J(Qe,{stages:y.value.stages,employees:y.value.employees,dateRange:y.value.dateRange,customDateRange:y.value.customDateRange,hasActiveFilters:E.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":n.value,"onUpdate:stages":ge,"onUpdate:employees":h,"onUpdate:dateRange":e,"onUpdate:customDateRange":a,"onUpdate:periodMode":r,onReset:R,onApply:G},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","period-mode"])]),t("div",ni,[f.value?(o(),me(qe,{key:0,type:"error",title:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",message:f.value.message},null,8,["message"])):(o(),me(hs,{key:1,meta:g.value,data:p.value,onOpenResponsible:Te,onOpenStages:ye,onOpenCarryover:Ne},null,8,["meta","data"]))])])]))])):z("",!0)]),_:1}),J(Un,{"is-visible":M.value,responsible:H(F.value)||p.value.responsible||[],"closed-tickets-created-this-week":Z(F.value)??p.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":ue(F.value)??p.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":x(F.value)||p.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":V(F.value)||p.value.responsibleCreatedOtherWeek||[],"week-number":F.value?.weekNumber||g.value?.weekNumber||null,"week-start-utc":F.value?.weekStartUtc||g.value?.weekStartUtc||null,"week-end-utc":F.value?.weekEndUtc||g.value?.weekEndUtc||null,onClose:m[0]||(m[0]=ee=>{M.value=!1,F.value.value=null})},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),J(kl,{"is-visible":O.value,"week-number":F.value?.weekNumber||g.value?.weekNumber||null,"week-start-utc":F.value?.weekStartUtc||g.value?.weekStartUtc||null,"week-end-utc":F.value?.weekEndUtc||g.value?.weekEndUtc||null,"preloaded-data":S(F.value),onClose:m[1]||(m[1]=ee=>{O.value=!1,F.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),J(xl,{"is-visible":q.value,"week-number":F.value?.weekNumber||g.value?.weekNumber||null,"week-start-utc":F.value?.weekStartUtc||g.value?.weekStartUtc||null,"week-end-utc":F.value?.weekEndUtc||g.value?.weekEndUtc||null,"preloaded-data":D(F.value),onClose:m[2]||(m[2]=ee=>{q.value=!1,F.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),Q.value?(o(),me(dt,{key:0,"is-visible":Q.value,"current-mode":n.value,onClose:ce,onSelectMode:se},null,8,["is-visible","current-mode"])):z("",!0)])}}},bi=fe(li,[["__scopeId","data-v-2fa9296d"]]);export{bi as default};
