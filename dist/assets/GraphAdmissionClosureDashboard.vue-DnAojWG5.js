const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ticketListUtils-CpKfsjsI.js","./chunk-rKmNpCr3.js","./chunk-IDUYkvJI.js","./chunk-BTnG7_Rn.js","./chunk-Bwkg0lDb.js","./chunk-B5yqeUNo.js","./chunk-DVSMqPZp.js","./chunk-DLgBCjTL.js","./chunk-UTsEWqhV.js","./graph-state-components-q2unGHzB.css","./dashboard-components-cU3ZvHcC.css"])))=>i.map(i=>d[i]);
import{r as F,M as _e,l as Fe,N as xe,g as me,o,j as J,k as ne,a as l,b as j,d as t,u as ve,i as re,x as he,S as Qe,C as Le,a5 as je,c as I,W as We,X as Je,Y as Xe,t as d,F as te,f as ae,Z as De,V as et,q as tt,n as we,y as ze,e as Ye,T as Ue,Q as Ge}from"./chunk-IDUYkvJI.js";import{S as Ze}from"./main--Pw2KvND.js";import{c,F as qe}from"./chunk-DVSMqPZp.js";import{_ as fe,T as Re,e as He}from"./chunk-rKmNpCr3.js";import{f as Se,_ as Ce}from"./chunk-B5yqeUNo.js";import{DashboardSector1CService as at}from"./dashboard-sector-1c-service-DzGLFJL1.js";import{m as st}from"./chunk-BTnG7_Rn.js";import"./chunk-DLgBCjTL.js";import"./chunk-Ch9Gh45J.js";import"./chunk-UTsEWqhV.js";import"./chunk-Bwkg0lDb.js";const rt={key:0,class:"modal-overlay"},ot={class:"modal-container",role:"dialog","aria-labelledby":"modal-title","aria-modal":"true"},nt={class:"modal-body"},lt={class:"mode-description"},it={__name:"PeriodModeInfoModal",props:{isVisible:{type:Boolean,required:!0},currentMode:{type:String,default:"weeks",validator:S=>["weeks","months"].includes(S)}},emits:["close","start-loading","select-mode"],setup(S,{emit:k}){const s=S,A=k,w=F(s.currentMode);function _(M){if(!["weeks","months"].includes(M)){console.warn("[PeriodModeInfoModal] Invalid mode:",M);return}w.value=M,console.log("[DEBUG Modal] handleModeSelect: mode =",M),console.log("[DEBUG Modal] Emitting select-mode event"),A("select-mode",M),console.log("[DEBUG Modal] Emitting close event"),A("close"),console.log("[DEBUG Modal] Scheduling start-loading event in 100ms"),setTimeout(()=>{console.log("[DEBUG Modal] Emitting start-loading event"),A("start-loading")},100)}function f(){console.log("[DEBUG Modal] handleClose called, selectedMode =",w.value),console.log("[DEBUG Modal] Emitting select-mode event with",w.value),A("select-mode",w.value),console.log("[DEBUG Modal] Emitting close event"),A("close")}function p(M){M.key==="Escape"&&s.isVisible&&f()}return _e(()=>s.currentMode,M=>{["weeks","months"].includes(M)&&(w.value=M)}),Fe(()=>{s.isVisible&&document.addEventListener("keydown",p)}),xe(()=>{document.removeEventListener("keydown",p)}),_e(()=>s.isVisible,M=>{M?(document.addEventListener("keydown",p),w.value=s.currentMode):document.removeEventListener("keydown",p)}),(M,O)=>(o(),me(Qe,{to:"body"},[J(he,{name:"modal-fade"},{default:ne(()=>[S.isVisible?(o(),l("div",rt,[t("div",ot,[t("div",{class:"modal-header"},[O[2]||(O[2]=t("h2",{id:"modal-title",class:"modal-title"},[t("span",{class:"modal-icon"},"â„¹ï¸"),ve(" Ð’Ñ‹Ð±Ð¾Ñ€ Ñ€ÐµÐ¶Ð¸Ð¼Ð° Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ ")],-1)),t("button",{class:"modal-close-btn",onClick:f,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",type:"button"}," Ã— ")]),t("div",nt,[O[5]||(O[5]=t("p",{class:"modal-description"}," Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ° Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹: ",-1)),t("div",lt,[t("button",{class:re(["mode-item mode-item--clickable",{"mode-item--selected":w.value==="weeks"}]),onClick:O[0]||(O[0]=q=>_("weeks")),type:"button"},[...O[3]||(O[3]=[t("div",{class:"mode-header"},[t("span",{class:"mode-icon"},"ðŸ“…"),t("h3",{class:"mode-title"},"4 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð½ÐµÐ´ÐµÐ»Ð¸")],-1),t("p",{class:"mode-text"}," ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 4 Ð½ÐµÐ´ÐµÐ»Ð¸ Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹ Ð¿Ð¾ Ð½ÐµÐ´ÐµÐ»ÑÐ¼. ÐŸÐ¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ ÐºÑ€Ð°Ñ‚ÐºÐ¾ÑÑ€Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ð´Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ¸ Ð¿Ð¾ÑÑ‚ÑƒÐ¿Ð»ÐµÐ½Ð¸Ñ Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð². ",-1)])],2),t("button",{class:re(["mode-item mode-item--clickable",{"mode-item--selected":w.value==="months"}]),onClick:O[1]||(O[1]=q=>_("months")),type:"button"},[...O[4]||(O[4]=[t("div",{class:"mode-header"},[t("span",{class:"mode-icon"},"ðŸ“Š"),t("h3",{class:"mode-title"},"3 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… Ð¼ÐµÑÑÑ†Ð°")],-1),t("p",{class:"mode-text"}," ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 3 Ð¼ÐµÑÑÑ†Ð° Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹ Ð¿Ð¾ Ð¼ÐµÑÑÑ†Ð°Ð¼ Ð¸ Ð½ÐµÐ´ÐµÐ»ÑÐ¼ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¼ÐµÑÑÑ†ÐµÐ². ÐŸÐ¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ Ð´Ð¾Ð»Ð³Ð¾ÑÑ€Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ð¸ Ð²Ñ‹ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ñ‚Ñ€ÐµÐ½Ð´Ð¾Ð². ",-1)])],2)])])])])):j("",!0)]),_:1})]))}},ct=fe(it,[["__scopeId","data-v-4a42a9a6"]]),dt={class:"ac-chart"},ut={class:"ac-chart__header"},kt={class:"ac-chart__subtitle"},vt={class:"ac-chart__controls"},ht={class:"chart-type-selector"},mt=["onClick"],yt={class:"chart-type-icon"},pt={class:"chart-type-label"},gt={class:"ac-chart__summary"},bt={class:"summary-week-block summary-week-block--current"},ft={class:"summary-week-block__title"},_t={class:"summary-week-block__title-week"},wt={key:0,class:"summary-week-block__title-dates"},Ct={class:"summary-week-block__cards"},Tt={class:"summary-card__value-wrapper"},Wt={class:"summary-card__value"},$t=["title"],At={class:"percentage-indicator__arrow"},Dt={class:"percentage-indicator__value"},St={class:"percentage-indicator__label"},Nt={class:"summary-card__value-wrapper"},Et={class:"summary-card__value-main"},Ot=["title"],Bt={class:"percentage-indicator__arrow"},Mt={class:"percentage-indicator__value"},Ut={class:"percentage-indicator__label"},Rt={class:"summary-card__breakdown"},Pt={class:"breakdown-item breakdown-item--this-week"},It={class:"breakdown-item__value"},Lt={class:"breakdown-item breakdown-item--other-week"},Ft={class:"breakdown-item__value"},Ht={class:"summary-card__value-wrapper"},Gt={class:"summary-card__value-main"},Kt=["title"],Vt={class:"percentage-indicator__arrow"},xt={class:"percentage-indicator__value"},jt={class:"percentage-indicator__label"},zt={class:"summary-card__breakdown"},Yt={class:"breakdown-item breakdown-item--this-week"},Zt={class:"breakdown-item__value"},qt={class:"breakdown-item breakdown-item--previous-week"},Qt={class:"breakdown-item__value"},Jt={class:"breakdown-item breakdown-item--older"},Xt={class:"breakdown-item__value"},ea={class:"summary-card summary-card--stages"},ta={class:"summary-card__tags"},aa={key:0,class:"stage-tag stage-tag--empty"},sa={key:0,class:"summary-week-divider"},ra={key:1,class:"summary-week-block summary-week-block--previous"},oa={class:"summary-week-block__title"},na={class:"summary-week-block__title-week"},la={key:0,class:"summary-week-block__title-dates"},ia={class:"summary-week-block__cards"},ca={class:"summary-card__value-wrapper"},da={class:"summary-card__values-comparison"},ua={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},ka={class:"summary-card__value"},va={class:"value-label"},ha={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},ma={class:"summary-card__value summary-card__value--current-week"},ya={class:"value-label"},pa=["title"],ga={class:"percentage-indicator__arrow"},ba={class:"percentage-indicator__value"},fa={class:"percentage-indicator__label"},_a={class:"summary-card__value-wrapper"},wa={class:"summary-card__values-comparison"},Ca={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},Ta={class:"summary-card__value-main"},Wa={class:"value-label"},$a={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},Aa={class:"summary-card__value-main summary-card__value-main--current-week"},Da={class:"value-label"},Sa=["title"],Na={class:"percentage-indicator__arrow"},Ea={class:"percentage-indicator__value"},Oa={class:"percentage-indicator__label"},Ba={class:"summary-card__breakdown"},Ma={class:"breakdown-item breakdown-item--this-week"},Ua={class:"breakdown-item__value"},Ra={class:"breakdown-item breakdown-item--other-week"},Pa={class:"breakdown-item__value"},Ia={class:"summary-card__value-wrapper"},La={class:"summary-card__values-comparison"},Fa={class:"summary-card__value-comparison-item summary-card__value-comparison-item--previous"},Ha={class:"summary-card__value-main"},Ga={class:"value-label"},Ka={class:"summary-card__value-comparison-item summary-card__value-comparison-item--current"},Va={class:"summary-card__value-main summary-card__value-main--current-week"},xa={class:"value-label"},ja=["title"],za={class:"percentage-indicator__arrow"},Ya={class:"percentage-indicator__value"},Za={class:"percentage-indicator__label"},qa={class:"summary-card__breakdown"},Qa={class:"breakdown-item breakdown-item--this-week"},Ja={class:"breakdown-item__value"},Xa={class:"breakdown-item breakdown-item--previous-week"},es={class:"breakdown-item__value"},ts={class:"breakdown-item breakdown-item--older"},as={class:"breakdown-item__value"},ss={class:"summary-card summary-card--stages summary-card--previous"},rs={class:"summary-card__tags"},os={key:0,class:"stage-tag stage-tag--empty"},ns={class:"ac-chart__body"},ls={key:0,class:"split-charts-container"},is={class:"chart-wrapper chart-wrapper--left"},cs={class:"chart-canvas-wrapper"},ds={class:"chart-wrapper chart-wrapper--right"},us={class:"chart-canvas-wrapper"},ks={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:()=>({weekNumber:null,weekStartUtc:null,weekEndUtc:null})},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,closedTicketsCreatedThisWeek:0,closedTicketsCreatedOtherWeek:0,carryoverTickets:0,carryoverTicketsCreatedThisWeek:0,carryoverTicketsCreatedPreviousWeek:0,carryoverTicketsCreatedOlder:0,carryoverTicketsCreatedOtherWeek:0,series:{new:[0],closed:[0],closedCreatedThisWeek:[0],closedCreatedOtherWeek:[0],carryover:[0],carryoverCreatedThisWeek:[0],carryoverCreatedPreviousWeek:[0],carryoverCreatedOlder:[0],carryoverCreatedOtherWeek:[0]},stagesByWeek:[],stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(S,{emit:k}){Le.register(je);const s=S,A=k,w=I(()=>{const e=s.meta?.weeks||[];return e.length>=2?e[e.length-2]:null}),_=[{value:"line",label:"Ð›Ð¸Ð½ÐµÐ¹Ð½Ñ‹Ð¹",icon:"ðŸ“ˆ"},{value:"bar",label:"Ð¡Ñ‚Ð¾Ð»Ð±Ñ‡Ð°Ñ‚Ñ‹Ð¹",icon:"ðŸ“Š"},{value:"doughnut",label:"ÐšÑ€ÑƒÐ³Ð¾Ð²Ð°Ñ",icon:"ðŸ©"}],f=F("line"),p={color:"#111827",font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:e=>e?.dataset?.borderColor||"#111827",borderWidth:1,borderRadius:4,padding:4,offset:8,formatter:e=>e==null||isNaN(e)?"":v(e),display:e=>{if(e?.chart?.config?.type!=="line")return!1;const r=e?.dataset?.data?.[e.dataIndex];return r!=null&&!isNaN(r)&&isFinite(r)}};I(()=>s.meta?.weekNumber??"â€”");const M=()=>{const e=s.meta?.weeks||[];return e.length>0?e.map(a=>`ÐÐµÐ´ÐµÐ»Ñ ${a.weekNumber}`):[s.meta?.weekNumber?`ÐÐµÐ´ÐµÐ»Ñ ${s.meta.weekNumber}`:"ÐÐµÐ´ÐµÐ»Ñ"]};function O(e,a,r,R=.3,U=0){if(!a)return((le,ye)=>{const Te=parseInt(le.slice(1,3),16),Ne=parseInt(le.slice(3,5),16),Ie=parseInt(le.slice(5,7),16);return`rgba(${Te}, ${Ne}, ${Ie}, ${ye})`})(r,R);const G=(ce,le)=>{const ye=parseInt(ce.slice(1,3),16),Te=parseInt(ce.slice(3,5),16),Ne=parseInt(ce.slice(5,7),16);return`rgba(${ye}, ${Te}, ${Ne}, ${le})`},oe=e.createLinearGradient(0,a.bottom,0,a.top);return oe.addColorStop(0,G(r,R)),oe.addColorStop(1,G(r,U)),oe}const q=I(()=>{const e=M(),a=Array.isArray(s.data.series?.new)&&s.data.series.new.length>0?s.data.series.new:[s.data.newTickets??0],r=Array.isArray(s.data.series?.closed)&&s.data.series.closed.length>0?s.data.series.closed:[s.data.closedTickets??0],R=Array.isArray(s.data.series?.closedCreatedThisWeek)&&s.data.series.closedCreatedThisWeek.length>0?s.data.series.closedCreatedThisWeek:[s.data.closedTicketsCreatedThisWeek??0],U=Array.isArray(s.data.series?.closedCreatedOtherWeek)&&s.data.series.closedCreatedOtherWeek.length>0?s.data.series.closedCreatedOtherWeek:[s.data.closedTicketsCreatedOtherWeek??0];return{labels:e,datasets:[{label:"ÐÐ¾Ð²Ñ‹Ðµ",data:a,backgroundColor:G=>{const oe=G.chart,{ctx:ce,chartArea:le}=oe;return O(ce,le,c.primary)},borderColor:c.primary,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.primary,pointBackgroundColor:c.primary,datalabels:{...p,anchor:"end",align:"top",offset:10,color:c.primary,borderColor:c.primary}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (Ð²ÑÐµ)",data:r,backgroundColor:G=>{const oe=G.chart,{ctx:ce,chartArea:le}=oe;return O(ce,le,c.success)},borderColor:c.success,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.success,pointBackgroundColor:c.success,datalabels:{...p,anchor:"start",align:"bottom",offset:10,color:c.success,borderColor:c.success}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:R,backgroundColor:c.successLight,borderColor:c.successLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:c.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.successLight,pointBackgroundColor:c.successLight,datalabels:{...p,anchor:"end",align:"bottom",offset:8,color:c.successLight,borderColor:c.successLight}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:U,backgroundColor:c.warning,borderColor:c.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:c.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.warning,pointBackgroundColor:c.warning,datalabels:{...p,anchor:"end",align:"bottom",offset:8,color:c.warning,borderColor:c.warning}}]}}),Q=I(()=>{const e=M(),a=Array.isArray(s.data.series?.carryover)&&s.data.series.carryover.length>0?s.data.series.carryover:[s.data.carryoverTickets??0],r=Array.isArray(s.data.series?.carryoverCreatedThisWeek)&&s.data.series.carryoverCreatedThisWeek.length>0?s.data.series.carryoverCreatedThisWeek:[s.data.carryoverTicketsCreatedThisWeek??0],R=Array.isArray(s.data.series?.carryoverCreatedPreviousWeek)&&s.data.series.carryoverCreatedPreviousWeek.length>0?s.data.series.carryoverCreatedPreviousWeek:[s.data.carryoverTicketsCreatedPreviousWeek??0],U=Array.isArray(s.data.series?.carryoverCreatedOlder)&&s.data.series.carryoverCreatedOlder.length>0?s.data.series.carryoverCreatedOlder:[s.data.carryoverTicketsCreatedOlder??0];return Array.isArray(s.data.series?.carryoverCreatedOtherWeek)&&s.data.series.carryoverCreatedOtherWeek.length>0?s.data.series.carryoverCreatedOtherWeek:s.data.carryoverTicketsCreatedOtherWeek,{labels:e,datasets:[{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (Ð²ÑÐµ)",data:a,backgroundColor:G=>{const oe=G.chart,{ctx:ce,chartArea:le}=oe;return O(ce,le,c.carryover)},borderColor:c.carryover,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryover,pointBackgroundColor:c.carryover,datalabels:{...p,anchor:"end",align:"top",offset:4,color:c.carryover,borderColor:c.carryover}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:r,backgroundColor:c.carryoverLight,borderColor:c.carryoverLight,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:c.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryoverLight,pointBackgroundColor:c.carryoverLight,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.carryoverLight,borderColor:c.carryoverLight}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:R,backgroundColor:c.warning,borderColor:c.warning,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:c.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.warning,pointBackgroundColor:c.warning,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.warning,borderColor:c.warning}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð½ÐµÐ´ÐµÐ»ÑÐ¼Ð¸)",data:U,backgroundColor:c.carryoverDark,borderColor:c.carryoverDark,borderWidth:2,tension:.4,borderDash:[8,4],fill:!1,pointRadius:3,pointBorderWidth:1,pointBorderColor:c.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryoverDark,pointBackgroundColor:c.carryoverDark,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.carryoverDark,borderColor:c.carryoverDark}}]}}),L=I(()=>{const e=s.meta?.weeks||[],a=e.length>0?e.map(Te=>`ÐÐµÐ´ÐµÐ»Ñ ${Te.weekNumber}`):[s.meta?.weekNumber?`ÐÐµÐ´ÐµÐ»Ñ ${s.meta.weekNumber}`:"ÐÐµÐ´ÐµÐ»Ñ"],r=Array.isArray(s.data.series?.new)&&s.data.series.new.length>0?s.data.series.new:[s.data.newTickets??0],R=Array.isArray(s.data.series?.closed)&&s.data.series.closed.length>0?s.data.series.closed:[s.data.closedTickets??0],U=Array.isArray(s.data.series?.closedCreatedThisWeek)&&s.data.series.closedCreatedThisWeek.length>0?s.data.series.closedCreatedThisWeek:[s.data.closedTicketsCreatedThisWeek??0],G=Array.isArray(s.data.series?.closedCreatedOtherWeek)&&s.data.series.closedCreatedOtherWeek.length>0?s.data.series.closedCreatedOtherWeek:[s.data.closedTicketsCreatedOtherWeek??0],oe=Array.isArray(s.data.series?.carryover)&&s.data.series.carryover.length>0?s.data.series.carryover:[s.data.carryoverTickets??0],ce=Array.isArray(s.data.series?.carryoverCreatedThisWeek)&&s.data.series.carryoverCreatedThisWeek.length>0?s.data.series.carryoverCreatedThisWeek:[s.data.carryoverTicketsCreatedThisWeek??0],le=Array.isArray(s.data.series?.carryoverCreatedPreviousWeek)&&s.data.series.carryoverCreatedPreviousWeek.length>0?s.data.series.carryoverCreatedPreviousWeek:[s.data.carryoverTicketsCreatedPreviousWeek??0],ye=Array.isArray(s.data.series?.carryoverCreatedOlder)&&s.data.series.carryoverCreatedOlder.length>0?s.data.series.carryoverCreatedOlder:[s.data.carryoverTicketsCreatedOlder??0];return Array.isArray(s.data.series?.carryoverCreatedOtherWeek)&&s.data.series.carryoverCreatedOtherWeek.length>0?s.data.series.carryoverCreatedOtherWeek:s.data.carryoverTicketsCreatedOtherWeek,{labels:a,datasets:[{label:"ÐÐ¾Ð²Ñ‹Ðµ",data:r,backgroundColor:c.primary,borderColor:c.primary,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.primary,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.primary,pointBackgroundColor:c.primary,datalabels:{...p,anchor:"end",align:"top",offset:10,color:c.primary,borderColor:c.primary}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (Ð²ÑÐµ)",data:R,backgroundColor:c.success,borderColor:c.success,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.success,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.success,pointBackgroundColor:c.success,datalabels:{...p,anchor:"start",align:"bottom",offset:10,color:c.success,borderColor:c.success}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:U,backgroundColor:c.successLight,borderColor:c.successLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:c.successLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.successLight,pointBackgroundColor:c.successLight,datalabels:{...p,anchor:"end",align:"bottom",offset:8,color:c.successLight,borderColor:c.successLight}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:G,backgroundColor:c.warning,borderColor:c.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:c.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.warning,pointBackgroundColor:c.warning,datalabels:{...p,anchor:"end",align:"bottom",offset:8,color:c.warning,borderColor:c.warning}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (Ð²ÑÐµ)",data:oe,backgroundColor:c.carryover,borderColor:c.carryover,tension:.3,fill:!1,pointRadius:4,pointBorderWidth:1,pointBorderColor:c.carryover,pointHoverRadius:6,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryover,pointBackgroundColor:c.carryover,datalabels:{...p,anchor:"end",align:"top",offset:4,color:c.carryover,borderColor:c.carryover}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:ce,backgroundColor:c.carryoverLight,borderColor:c.carryoverLight,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:c.carryoverLight,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryoverLight,pointBackgroundColor:c.carryoverLight,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.carryoverLight,borderColor:c.carryoverLight}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹)",data:le,backgroundColor:c.warning,borderColor:c.warning,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:c.warning,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.warning,pointBackgroundColor:c.warning,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.warning,borderColor:c.warning}},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ (ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð½ÐµÐ´ÐµÐ»ÑÐ¼Ð¸)",data:ye,backgroundColor:c.carryoverDark,borderColor:c.carryoverDark,tension:.3,fill:!1,borderDash:[5,5],pointRadius:3,pointBorderWidth:1,pointBorderColor:c.carryoverDark,pointHoverRadius:5,pointHoverBorderWidth:2,pointHoverBorderColor:"#ffffff",pointHoverBackgroundColor:c.carryoverDark,pointBackgroundColor:c.carryoverDark,datalabels:{...p,anchor:"end",align:"top",offset:6,color:c.carryoverDark,borderColor:c.carryoverDark}}]}}),P=I(()=>({labels:["ÐÐ¾Ð²Ñ‹Ðµ","Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ","ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ"],datasets:[{data:[s.data.newTickets??0,s.data.closedTickets??0,s.data.carryoverTickets??0],backgroundColor:[c.primary,c.success,c.carryover],borderWidth:1}]})),D=I(()=>{switch(f.value){case"line":return We;case"bar":return Xe;case"doughnut":return Je;default:return We}}),g=I(()=>f.value==="doughnut"?P.value:L.value),u=e=>{if(!e)return"â€”";try{return new Date(e).toLocaleDateString("ru-RU",{day:"2-digit",month:"short"})}catch{return e}};function v(e){return e==null||isNaN(e)?"0":e>=1e3?e.toLocaleString("ru-RU"):e.toString()}function i(e){const a=e%10,r=e%100;return r>=11&&r<=14?"Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²":a===1?"Ñ‚Ð¸ÐºÐµÑ‚":a>=2&&a<=4?"Ñ‚Ð¸ÐºÐµÑ‚Ð°":"Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²"}const C=I(()=>({responsive:!0,maintainAspectRatio:!1,resizeDelay:0,animation:{duration:800,easing:"easeOutQuart"},interaction:{intersect:!1,mode:"index"},plugins:{datalabels:{...p,anchor:"end",align:"top"},tooltip:{enabled:!0,backgroundColor:"rgba(255, 255, 255, 0.98)",titleColor:"#111827",bodyColor:"#374151",borderColor:"#e5e7eb",borderWidth:1,cornerRadius:8,padding:16,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},displayColors:!0,boxPadding:6,usePointStyle:!0,animation:{duration:300,easing:"easeOutQuart"},callbacks:{title:e=>{if(!e||e.length===0)return"";const a=e[0]?.dataIndex,r=s.meta?.weeks||[];if(r.length>0&&a!==void 0&&r[a]){const oe=r[a];return`ÐÐµÐ´ÐµÐ»Ñ ${oe.weekNumber} (${u(oe.weekStartUtc)} â€” ${u(oe.weekEndUtc)})`}const R=s.meta?.weekNumber,U=s.meta?.weekStartUtc,G=s.meta?.weekEndUtc;return R&&U&&G?`ÐÐµÐ´ÐµÐ»Ñ ${R} (${u(U)} â€” ${u(G)})`:e[0]?.label||""},label:e=>{const a=e.parsed.y,r=e.dataset.label||"";if(a==null||isNaN(a))return`${r}: 0 Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²`;const R=v(a),U=i(a);return`${r}: ${R} ${U}`}}},legend:{position:"bottom",labels:{font:{size:13,weight:"500"},padding:12,boxWidth:18,boxHeight:12,usePointStyle:!0,pointStyle:"circle",generateLabels:e=>Le.defaults.plugins.legend.labels.generateLabels(e).map((r,R)=>{const U=e.data.datasets[R],G=e.getDatasetMeta(R),oe=U.borderDash&&Array.isArray(U.borderDash)&&U.borderDash.length>0||U.borderWidth===2||U.fill===!1;return G.hidden?(r.fontColor="#9ca3af",r.textDecoration="line-through",r.opacity=.5):oe?r.fontColor="#6b7280":r.fontColor="#111827",r})},onClick:(e,a)=>{const r=a.datasetIndex;if(r==null){console.warn("[Legend] Invalid datasetIndex:",r);return}const R=e.chart;if(!R){console.warn("[Legend] Chart not found");return}const U=R.getDatasetMeta(r);if(!U){console.warn("[Legend] Dataset meta not found for index:",r);return}U.hidden=!U.hidden,R.update("active")},onHover:(e,a)=>{e.native&&e.native.target&&(e.native.target.style.cursor="pointer")},onLeave:(e,a)=>{e.native&&e.native.target&&(e.native.target.style.cursor="default")}}},scales:f.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10,color:"#374151",callback:e=>e==null||isNaN(e)?"0":v(e)},title:{display:!1},grid:{color:e=>{if(!e||!e.tick||e.tick.value===void 0)return"#e5e7eb";const a=e.tick.value;return isNaN(a)||!isFinite(a)?"#e5e7eb":a===0||a%5===0?"#d1d5db":"#e5e7eb"},lineWidth:e=>{if(!e||!e.tick||e.tick.value===void 0)return 1;const a=e.tick.value;return isNaN(a)||!isFinite(a)?1:a===0||a%5===0?1.5:1}}},x:{ticks:{maxRotation:45,minRotation:45,font:{size:14},padding:10,color:"#374151"},title:{display:!1},grid:{color:"#e5e7eb",lineWidth:1}}}})),T=I(()=>{if(s.data?.series){const e=s.data.series,a=Math.max((Array.isArray(e.new)?e.new.length:0)-1,(Array.isArray(e.closed)?e.closed.length:0)-1,(Array.isArray(e.closedCreatedThisWeek)?e.closedCreatedThisWeek.length:0)-1,(Array.isArray(e.closedCreatedOtherWeek)?e.closedCreatedOtherWeek.length:0)-1,(Array.isArray(e.carryover)?e.carryover.length:0)-1,(Array.isArray(e.carryoverCreatedThisWeek)?e.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(e.carryoverCreatedPreviousWeek)?e.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(e.carryoverCreatedOlder)?e.carryoverCreatedOlder.length:0)-1,(Array.isArray(e.carryoverCreatedOtherWeek)?e.carryoverCreatedOtherWeek.length:0)-1,-1);if(a>=0){const r={newTickets:Array.isArray(e.new)&&e.new[a]!==void 0?e.new[a]:0,closedTickets:Array.isArray(e.closed)&&e.closed[a]!==void 0?e.closed[a]:0,closedTicketsCreatedThisWeek:Array.isArray(e.closedCreatedThisWeek)&&e.closedCreatedThisWeek[a]!==void 0?e.closedCreatedThisWeek[a]:0,closedTicketsCreatedOtherWeek:Array.isArray(e.closedCreatedOtherWeek)&&e.closedCreatedOtherWeek[a]!==void 0?e.closedCreatedOtherWeek[a]:0,carryoverTickets:Array.isArray(e.carryover)&&e.carryover[a]!==void 0?e.carryover[a]:0,carryoverTicketsCreatedThisWeek:Array.isArray(e.carryoverCreatedThisWeek)&&e.carryoverCreatedThisWeek[a]!==void 0?e.carryoverCreatedThisWeek[a]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(e.carryoverCreatedPreviousWeek)&&e.carryoverCreatedPreviousWeek[a]!==void 0?e.carryoverCreatedPreviousWeek[a]:0,carryoverTicketsCreatedOlder:Array.isArray(e.carryoverCreatedOlder)&&e.carryoverCreatedOlder[a]!==void 0?e.carryoverCreatedOlder[a]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(e.carryoverCreatedOtherWeek)&&e.carryoverCreatedOtherWeek[a]!==void 0?e.carryoverCreatedOtherWeek[a]:0};if(r.carryoverTickets>0&&console.log("[DEBUG currentWeekData]",{total:r.carryoverTickets,thisWeek:r.carryoverTicketsCreatedThisWeek,previousWeek:r.carryoverTicketsCreatedPreviousWeek,older:r.carryoverTicketsCreatedOlder,otherWeek:r.carryoverTicketsCreatedOtherWeek,sum:r.carryoverTicketsCreatedThisWeek+r.carryoverTicketsCreatedPreviousWeek+r.carryoverTicketsCreatedOlder,lastIndex:a,series:{carryoverCreatedPreviousWeek:e.carryoverCreatedPreviousWeek,carryoverCreatedOlder:e.carryoverCreatedOlder,carryoverCreatedPreviousWeekLength:e.carryoverCreatedPreviousWeek?.length,carryoverCreatedOlderLength:e.carryoverCreatedOlder?.length,carryoverCreatedPreviousWeekLast:e.carryoverCreatedPreviousWeek?.[a],carryoverCreatedOlderLast:e.carryoverCreatedOlder?.[a]},currentWeek:s.data.currentWeek,data:{carryoverTicketsCreatedPreviousWeek:s.data.carryoverTicketsCreatedPreviousWeek,carryoverTicketsCreatedOlder:s.data.carryoverTicketsCreatedOlder}}),r.newTickets>0||r.closedTickets>0||r.carryoverTickets>0)return r}}if(s.data?.currentWeek&&typeof s.data.currentWeek=="object"){const e=s.data.currentWeek;if((e.newTickets??0)>0||(e.closedTickets??0)>0||(e.carryoverTickets??0)>0)return e}if(s.data?.weeksData&&Array.isArray(s.data.weeksData)&&s.data.weeksData.length>0){const e=s.data.weeksData[s.data.weeksData.length-1];if((e.newTickets??0)>0||(e.closedTickets??0)>0||(e.carryoverTickets??0)>0)return e}if(s.data?.series){const e=s.data.series,a=Math.max((Array.isArray(e.new)?e.new.length:0)-1,(Array.isArray(e.closed)?e.closed.length:0)-1,(Array.isArray(e.carryover)?e.carryover.length:0)-1,-1);if(a>=0)return{newTickets:Array.isArray(e.new)&&e.new[a]!==void 0?e.new[a]:0,closedTickets:Array.isArray(e.closed)&&e.closed[a]!==void 0?e.closed[a]:0,closedTicketsCreatedThisWeek:Array.isArray(e.closedCreatedThisWeek)&&e.closedCreatedThisWeek[a]!==void 0?e.closedCreatedThisWeek[a]:0,closedTicketsCreatedOtherWeek:Array.isArray(e.closedCreatedOtherWeek)&&e.closedCreatedOtherWeek[a]!==void 0?e.closedCreatedOtherWeek[a]:0,carryoverTickets:Array.isArray(e.carryover)&&e.carryover[a]!==void 0?e.carryover[a]:0,carryoverTicketsCreatedThisWeek:Array.isArray(e.carryoverCreatedThisWeek)&&e.carryoverCreatedThisWeek[a]!==void 0?e.carryoverCreatedThisWeek[a]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(e.carryoverCreatedPreviousWeek)&&e.carryoverCreatedPreviousWeek[a]!==void 0?e.carryoverCreatedPreviousWeek[a]:0,carryoverTicketsCreatedOlder:Array.isArray(e.carryoverCreatedOlder)&&e.carryoverCreatedOlder[a]!==void 0?e.carryoverCreatedOlder[a]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(e.carryoverCreatedOtherWeek)&&e.carryoverCreatedOtherWeek[a]!==void 0?e.carryoverCreatedOtherWeek[a]:0}}return s.data||{}}),y=I(()=>{const e=s.meta?.weeks||[];return e.length>0?e[e.length-1]:{weekNumber:s.meta?.currentWeek?.weekNumber??s.meta?.weekNumber??null,weekStartUtc:s.meta?.currentWeek?.weekStartUtc??s.meta?.weekStartUtc??null,weekEndUtc:s.meta?.currentWeek?.weekEndUtc??s.meta?.weekEndUtc??null}}),n=I(()=>{if(s.data?.series){const e=s.data.series,a=Math.max((Array.isArray(e.new)?e.new.length:0)-1,(Array.isArray(e.closed)?e.closed.length:0)-1,(Array.isArray(e.closedCreatedThisWeek)?e.closedCreatedThisWeek.length:0)-1,(Array.isArray(e.closedCreatedOtherWeek)?e.closedCreatedOtherWeek.length:0)-1,(Array.isArray(e.carryover)?e.carryover.length:0)-1,(Array.isArray(e.carryoverCreatedThisWeek)?e.carryoverCreatedThisWeek.length:0)-1,(Array.isArray(e.carryoverCreatedPreviousWeek)?e.carryoverCreatedPreviousWeek.length:0)-1,(Array.isArray(e.carryoverCreatedOlder)?e.carryoverCreatedOlder.length:0)-1,(Array.isArray(e.carryoverCreatedOtherWeek)?e.carryoverCreatedOtherWeek.length:0)-1,-1);if(a>=1){const r=a-1,R=s.meta?.weeks?.[r],U={weekNumber:R?.weekNumber??null,weekStartUtc:R?.weekStartUtc??null,weekEndUtc:R?.weekEndUtc??null,newTickets:Array.isArray(e.new)&&e.new[r]!==void 0?e.new[r]:0,closedTickets:Array.isArray(e.closed)&&e.closed[r]!==void 0?e.closed[r]:0,closedTicketsCreatedThisWeek:Array.isArray(e.closedCreatedThisWeek)&&e.closedCreatedThisWeek[r]!==void 0?e.closedCreatedThisWeek[r]:0,closedTicketsCreatedOtherWeek:Array.isArray(e.closedCreatedOtherWeek)&&e.closedCreatedOtherWeek[r]!==void 0?e.closedCreatedOtherWeek[r]:0,carryoverTickets:Array.isArray(e.carryover)&&e.carryover[r]!==void 0?e.carryover[r]:0,carryoverTicketsCreatedThisWeek:Array.isArray(e.carryoverCreatedThisWeek)&&e.carryoverCreatedThisWeek[r]!==void 0?e.carryoverCreatedThisWeek[r]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(e.carryoverCreatedPreviousWeek)&&e.carryoverCreatedPreviousWeek[r]!==void 0?e.carryoverCreatedPreviousWeek[r]:0,carryoverTicketsCreatedOlder:Array.isArray(e.carryoverCreatedOlder)&&e.carryoverCreatedOlder[r]!==void 0?e.carryoverCreatedOlder[r]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(e.carryoverCreatedOtherWeek)&&e.carryoverCreatedOtherWeek[r]!==void 0?e.carryoverCreatedOtherWeek[r]:0};if(U.newTickets>0||U.closedTickets>0||U.carryoverTickets>0)return U}}if(s.data?.weeksData&&Array.isArray(s.data.weeksData)&&s.data.weeksData.length>=2){const e=s.data.weeksData.length-2,a=s.data.weeksData[e],r=s.meta?.weeks?.[e];if((a.newTickets??0)>0||(a.closedTickets??0)>0||(a.carryoverTickets??0)>0)return{weekNumber:a.weekNumber??r?.weekNumber??null,weekStartUtc:r?.weekStartUtc??null,weekEndUtc:r?.weekEndUtc??null,newTickets:a.newTickets??0,closedTickets:a.closedTickets??0,closedTicketsCreatedThisWeek:a.closedTicketsCreatedThisWeek??0,closedTicketsCreatedOtherWeek:a.closedTicketsCreatedOtherWeek??0,carryoverTickets:a.carryoverTickets??0,carryoverTicketsCreatedThisWeek:a.carryoverTicketsCreatedThisWeek??0,carryoverTicketsCreatedOtherWeek:a.carryoverTicketsCreatedOtherWeek??0}}if(s.data?.series){const e=s.data.series,a=Math.max((Array.isArray(e.new)?e.new.length:0)-1,(Array.isArray(e.closed)?e.closed.length:0)-1,(Array.isArray(e.carryover)?e.carryover.length:0)-1,-1);if(a>=1){const r=a-1,R=s.meta?.weeks?.[r];return{weekNumber:R?.weekNumber??null,weekStartUtc:R?.weekStartUtc??null,weekEndUtc:R?.weekEndUtc??null,newTickets:Array.isArray(e.new)&&e.new[r]!==void 0?e.new[r]:0,closedTickets:Array.isArray(e.closed)&&e.closed[r]!==void 0?e.closed[r]:0,closedTicketsCreatedThisWeek:Array.isArray(e.closedCreatedThisWeek)&&e.closedCreatedThisWeek[r]!==void 0?e.closedCreatedThisWeek[r]:0,closedTicketsCreatedOtherWeek:Array.isArray(e.closedCreatedOtherWeek)&&e.closedCreatedOtherWeek[r]!==void 0?e.closedCreatedOtherWeek[r]:0,carryoverTickets:Array.isArray(e.carryover)&&e.carryover[r]!==void 0?e.carryover[r]:0,carryoverTicketsCreatedThisWeek:Array.isArray(e.carryoverCreatedThisWeek)&&e.carryoverCreatedThisWeek[r]!==void 0?e.carryoverCreatedThisWeek[r]:0,carryoverTicketsCreatedPreviousWeek:Array.isArray(e.carryoverCreatedPreviousWeek)&&e.carryoverCreatedPreviousWeek[r]!==void 0?e.carryoverCreatedPreviousWeek[r]:0,carryoverTicketsCreatedOlder:Array.isArray(e.carryoverCreatedOlder)&&e.carryoverCreatedOlder[r]!==void 0?e.carryoverCreatedOlder[r]:0,carryoverTicketsCreatedOtherWeek:Array.isArray(e.carryoverCreatedOtherWeek)&&e.carryoverCreatedOtherWeek[r]!==void 0?e.carryoverCreatedOtherWeek[r]:0}}}return null}),E=I(()=>{const e=s.data?.stagesByWeek;return Array.isArray(e)?e:null}),W=I(()=>{const e=E.value;if(e&&e.length>0){const a=e.length-1,r=e[a];if(Array.isArray(r))return r}return s.data?.stages??[]}),N=I(()=>{const e=E.value;if(e&&e.length>=2){const a=e.length-2,r=e[a];if(Array.isArray(r))return r}return[]}),$=I(()=>n.value?.weekNumber?`ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð½ÐµÐ´ÐµÐ»Ð¸ ${n.value.weekNumber}`:"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…");function K(e,a){if(typeof e!="number"||isNaN(e)||a==null||typeof a!="number"||isNaN(a)||a===0)return null;if(e===a)return 0;const r=(e-a)/a*100;return!isFinite(r)||isNaN(r)?null:r}function H(e){return e==null||isNaN(e)?"":`${e>=0?"+":""}${e.toFixed(1)}%`}const Y=I(()=>{if(s.data?.series){const e=s.data.series,a=Math.max((Array.isArray(e.new)?e.new.length:0)-1,(Array.isArray(e.closed)?e.closed.length:0)-1,(Array.isArray(e.carryover)?e.carryover.length:0)-1,-1);if(a>=2){const r=a-2;return{weekNumber:s.meta?.weeks?.[r]?.weekNumber??null,newTickets:Array.isArray(e.new)&&e.new[r]!==void 0?e.new[r]:0,closedTickets:Array.isArray(e.closed)&&e.closed[r]!==void 0?e.closed[r]:0,carryoverTickets:Array.isArray(e.carryover)&&e.carryover[r]!==void 0?e.carryover[r]:0}}}return null}),V=I(()=>{const e=T.value,a=n.value;return!e||!a?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:K(e.newTickets??0,a.newTickets??0),closedTickets:K(e.closedTickets??0,a.closedTickets??0),carryoverTickets:K(e.carryoverTickets??0,a.carryoverTickets??0)}}),Z=I(()=>{const e=n.value,a=Y.value;return!e||!a?{newTickets:null,closedTickets:null,carryoverTickets:null}:{newTickets:K(e.newTickets??0,a.newTickets??0),closedTickets:K(e.closedTickets??0,a.closedTickets??0),carryoverTickets:K(e.carryoverTickets??0,a.carryoverTickets??0)}});function ue(e,a){if(!e||!a)return"";try{const r=new Date(e),R=new Date(a),U=r.getUTCDate(),G=r.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),oe=r.getUTCFullYear(),ce=R.getUTCDate(),le=R.toLocaleDateString("ru-RU",{month:"short",timeZone:"UTC"}),ye=R.getUTCFullYear();return oe===ye&&G===le?`${U} â€” ${ce} ${G}`:oe===ye?`${U} ${G} â€” ${ce} ${le}`:`${U} ${G} ${oe} â€” ${ce} ${le} ${ye}`}catch(r){return console.error("[formatWeekDates] Error:",r),""}}const ge=e=>{const a=T.value,r=a?.newTickets??0,R=a?.closedTickets??0,U=a?.carryoverTickets??0,G=y.value;e==="new"&&r>0?A("open-stages",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc}):e==="closed"&&R>0?A("open-responsible",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc}):e==="carryover"&&U>0&&A("open-carryover",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc})},h=e=>{const a=n.value;if(!a)return;const r=a?.newTickets??0,R=a?.closedTickets??0,U=a?.carryoverTickets??0,G=w.value;G&&(e==="new"&&r>0?A("open-stages",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc}):e==="closed"&&R>0?A("open-responsible",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc}):e==="carryover"&&U>0&&A("open-carryover",{weekNumber:G.weekNumber,weekStartUtc:G.weekStartUtc,weekEndUtc:G.weekEndUtc}))};return(e,a)=>(o(),l("div",dt,[t("header",ut,[t("div",null,[a[6]||(a[6]=t("h2",{class:"ac-chart__title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),t("p",kt," ÐÐµÐ´ÐµÐ»Ñ "+d(S.meta?.currentWeek?.weekNumber??S.meta?.weekNumber??"â€”")+" Â· "+d((S.meta?.currentWeek?.weekStartUtc??S.meta?.weekStartUtc)||"â€”")+" â€” "+d((S.meta?.currentWeek?.weekEndUtc??S.meta?.weekEndUtc)||"â€”")+" (UTC) ",1)]),t("div",vt,[t("div",ht,[(o(),l(te,null,ae(_,r=>t("button",{key:r.value,class:re(["chart-type-btn",{active:f.value===r.value}]),onClick:R=>f.value=r.value},[t("span",yt,d(r.icon),1),t("span",pt,d(r.label),1)],10,mt)),64))])])]),t("section",gt,[t("div",bt,[t("h3",ft,[a[7]||(a[7]=t("span",{class:"summary-week-block__title-text"},"Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð½ÐµÐ´ÐµÐ»Ñ",-1)),t("span",_t," ÐÐµÐ´ÐµÐ»Ñ "+d(y.value.weekNumber??"â€”"),1),y.value.weekStartUtc?(o(),l("span",wt,d(ue(y.value.weekStartUtc,y.value.weekEndUtc)),1)):j("",!0)]),t("div",Ct,[t("div",{class:"summary-card summary-card--new",onClick:a[0]||(a[0]=r=>ge("new"))},[a[8]||(a[8]=t("div",{class:"summary-card__label"},"ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),t("div",Tt,[t("div",Wt,d(T.value?.newTickets??0),1),V.value.newTickets!==null?(o(),l("div",{key:0,class:re(["percentage-indicator",V.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${n.value?.weekNumber??"â€”"}): ${H(V.value.newTickets)}`},[t("span",At,d(V.value.newTickets>=0?"â†‘":"â†“"),1),t("span",Dt,d(H(V.value.newTickets)),1),t("span",St,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(n.value?.weekNumber??"â€”"),1)],10,$t)):j("",!0)])]),t("div",{class:"summary-card summary-card--closed-breakdown",onClick:a[1]||(a[1]=r=>ge("closed"))},[a[13]||(a[13]=t("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),t("div",Nt,[t("div",Et,d(T.value?.closedTickets??0),1),V.value.closedTickets!==null?(o(),l("div",{key:0,class:re(["percentage-indicator",V.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${n.value?.weekNumber??"â€”"}): ${H(V.value.closedTickets)}`},[t("span",Bt,d(V.value.closedTickets>=0?"â†‘":"â†“"),1),t("span",Mt,d(H(V.value.closedTickets)),1),t("span",Ut,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(n.value?.weekNumber??"â€”"),1)],10,Ot)):j("",!0)]),t("div",Rt,[t("div",Pt,[a[9]||(a[9]=t("span",{class:"breakdown-item__icon"},"âœ“",-1)),t("span",It,d(T.value?.closedTicketsCreatedThisWeek??0),1),a[10]||(a[10]=t("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))]),t("div",Lt,[a[11]||(a[11]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",Ft,d(T.value?.closedTicketsCreatedOtherWeek??0),1),a[12]||(a[12]=t("span",{class:"breakdown-item__label"},"Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))])])]),t("div",{class:"summary-card summary-card--carryover-breakdown",onClick:a[2]||(a[2]=r=>ge("carryover"))},[a[20]||(a[20]=t("div",{class:"summary-card__label"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",-1)),t("div",Ht,[t("div",Gt,d(T.value?.carryoverTickets??0),1),V.value.carryoverTickets!==null?(o(),l("div",{key:0,class:re(["percentage-indicator",V.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${n.value?.weekNumber??"â€”"}): ${H(V.value.carryoverTickets)}`},[t("span",Vt,d(V.value.carryoverTickets>=0?"â†‘":"â†“"),1),t("span",xt,d(H(V.value.carryoverTickets)),1),t("span",jt,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(n.value?.weekNumber??"â€”"),1)],10,Kt)):j("",!0)]),t("div",zt,[t("div",Yt,[a[14]||(a[14]=t("span",{class:"breakdown-item__icon"},"âœ“",-1)),t("span",Zt,d(T.value?.carryoverTicketsCreatedThisWeek??0),1),a[15]||(a[15]=t("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),t("div",qt,[a[16]||(a[16]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",Qt,d(T.value?.carryoverTicketsCreatedPreviousWeek??0),1),a[17]||(a[17]=t("span",{class:"breakdown-item__label"},"Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),t("div",Jt,[a[18]||(a[18]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",Xt,d(T.value?.carryoverTicketsCreatedOlder??0),1),a[19]||(a[19]=t("span",{class:"breakdown-item__label"},"Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ",-1))])])]),t("div",ea,[a[21]||(a[21]=t("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),t("div",ta,[(o(!0),l(te,null,ae(W.value,r=>(o(),l("span",{key:r.stageId,class:"stage-tag"},d(r.stageName||r.stageId)+" â€” "+d(r.count),1))),128)),!W.value||W.value.length===0?(o(),l("span",aa," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):j("",!0)])])])]),n.value?(o(),l("div",sa,[...a[22]||(a[22]=[t("div",{class:"summary-week-divider__line"},null,-1),t("div",{class:"summary-week-divider__label"},"ÐŸÑ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð°Ñ Ð½ÐµÐ´ÐµÐ»Ñ",-1)])])):j("",!0),n.value?(o(),l("div",ra,[t("h3",oa,[a[23]||(a[23]=t("span",{class:"summary-week-block__title-text"},"ÐŸÑ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð°Ñ Ð½ÐµÐ´ÐµÐ»Ñ",-1)),t("span",na," ÐÐµÐ´ÐµÐ»Ñ "+d(n.value.weekNumber??"â€”"),1),n.value.weekStartUtc?(o(),l("span",la,d(ue(n.value.weekStartUtc,n.value.weekEndUtc)),1)):j("",!0)]),t("div",ia,[t("div",{class:"summary-card summary-card--new summary-card--previous summary-card--clickable",onClick:a[3]||(a[3]=r=>h("new"))},[a[24]||(a[24]=t("div",{class:"summary-card__label"},"ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),t("div",ca,[t("div",da,[t("div",ua,[t("div",ka,d(n.value?.newTickets??0),1),t("span",va,"ÐÐµÐ´ÐµÐ»Ñ "+d(n.value?.weekNumber??"â€”"),1)]),t("div",ha,[t("div",ma,d(Y.value?.newTickets??0),1),t("span",ya,"ÐÐµÐ´ÐµÐ»Ñ "+d(Y.value?.weekNumber??"â€”"),1)])]),Z.value.newTickets!==null?(o(),l("div",{key:0,class:re(["percentage-indicator",Z.value.newTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${Y.value?.weekNumber??"â€”"}): ${H(Z.value.newTickets)}`},[t("span",ga,d(Z.value.newTickets>=0?"â†‘":"â†“"),1),t("span",ba,d(H(Z.value.newTickets)),1),t("span",fa,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(Y.value?.weekNumber??"â€”"),1)],10,pa)):j("",!0)])]),t("div",{class:"summary-card summary-card--closed-breakdown summary-card--previous summary-card--clickable",onClick:a[4]||(a[4]=r=>h("closed"))},[a[29]||(a[29]=t("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),t("div",_a,[t("div",wa,[t("div",Ca,[t("div",Ta,d(n.value?.closedTickets??0),1),t("span",Wa,"ÐÐµÐ´ÐµÐ»Ñ "+d(n.value?.weekNumber??"â€”"),1)]),t("div",$a,[t("div",Aa,d(Y.value?.closedTickets??0),1),t("span",Da,"ÐÐµÐ´ÐµÐ»Ñ "+d(Y.value?.weekNumber??"â€”"),1)])]),Z.value.closedTickets!==null?(o(),l("div",{key:0,class:re(["percentage-indicator",Z.value.closedTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${Y.value?.weekNumber??"â€”"}): ${H(Z.value.closedTickets)}`},[t("span",Na,d(Z.value.closedTickets>=0?"â†‘":"â†“"),1),t("span",Ea,d(H(Z.value.closedTickets)),1),t("span",Oa,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(Y.value?.weekNumber??"â€”"),1)],10,Sa)):j("",!0)]),t("div",Ba,[t("div",Ma,[a[25]||(a[25]=t("span",{class:"breakdown-item__icon"},"âœ“",-1)),t("span",Ua,d(n.value?.closedTicketsCreatedThisWeek??0),1),a[26]||(a[26]=t("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))]),t("div",Ra,[a[27]||(a[27]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",Pa,d(n.value?.closedTicketsCreatedOtherWeek??0),1),a[28]||(a[28]=t("span",{class:"breakdown-item__label"},"Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÐµÐ¹",-1))])])]),t("div",{class:"summary-card summary-card--carryover-breakdown summary-card--previous summary-card--clickable",onClick:a[5]||(a[5]=r=>h("carryover"))},[a[36]||(a[36]=t("div",{class:"summary-card__label"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",-1)),t("div",Ia,[t("div",La,[t("div",Fa,[t("div",Ha,d(n.value?.carryoverTickets??0),1),t("span",Ga,"ÐÐµÐ´ÐµÐ»Ñ "+d(n.value?.weekNumber??"â€”"),1)]),t("div",Ka,[t("div",Va,d(Y.value?.carryoverTickets??0),1),t("span",xa,"ÐÐµÐ´ÐµÐ»Ñ "+d(Y.value?.weekNumber??"â€”"),1)])]),Z.value.carryoverTickets!==null?(o(),l("div",{key:0,class:re(["percentage-indicator",Z.value.carryoverTickets>=0?"percentage-indicator--positive":"percentage-indicator--negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐÐµÐ´ÐµÐ»Ñ ${Y.value?.weekNumber??"â€”"}): ${H(Z.value.carryoverTickets)}`},[t("span",za,d(Z.value.carryoverTickets>=0?"â†‘":"â†“"),1),t("span",Ya,d(H(Z.value.carryoverTickets)),1),t("span",Za,"Ðº Ð½ÐµÐ´ÐµÐ»Ðµ "+d(Y.value?.weekNumber??"â€”"),1)],10,ja)):j("",!0)]),t("div",qa,[t("div",Qa,[a[30]||(a[30]=t("span",{class:"breakdown-item__icon"},"âœ“",-1)),t("span",Ja,d(n.value?.carryoverTicketsCreatedThisWeek??0),1),a[31]||(a[31]=t("span",{class:"breakdown-item__label"},"ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),t("div",Xa,[a[32]||(a[32]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",es,d(n.value?.carryoverTicketsCreatedPreviousWeek??0),1),a[33]||(a[33]=t("span",{class:"breakdown-item__label"},"Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸",-1))]),t("div",ts,[a[34]||(a[34]=t("span",{class:"breakdown-item__icon"},"â†»",-1)),t("span",as,d(n.value?.carryoverTicketsCreatedOlder??0),1),a[35]||(a[35]=t("span",{class:"breakdown-item__label"},"Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ",-1))])])]),t("div",ss,[a[37]||(a[37]=t("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),t("div",rs,[(o(!0),l(te,null,ae(N.value,r=>(o(),l("span",{key:r.stageId,class:"stage-tag"},d(r.stageName||r.stageId)+" â€” "+d(r.count),1))),128)),!N.value||N.value.length===0?(o(),l("span",os,d($.value),1)):j("",!0)])])])])):j("",!0)]),t("div",ns,[f.value==="line"?(o(),l("div",ls,[t("div",is,[a[38]||(a[38]=t("h3",{class:"chart-subtitle"},"ÐÐ¾Ð²Ñ‹Ðµ Ð¸ Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹",-1)),t("div",cs,[J(De(We),{data:q.value,options:C.value},null,8,["data","options"])])]),t("div",ds,[a[39]||(a[39]=t("h3",{class:"chart-subtitle"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹",-1)),t("div",us,[J(De(We),{data:Q.value,options:C.value},null,8,["data","options"])])])])):(o(),me(et(D.value),{key:1,data:g.value,options:C.value},null,8,["data","options"]))])]))}},vs=fe(ks,[["__scopeId","data-v-3666e13a"]]),hs={class:"summary-cards-months"},ms={class:"summary-card summary-card--new"},ys={class:"card-content"},ps={class:"card-main-value"},gs=["title"],bs={class:"card-month-breakdown"},fs={class:"month-name"},_s={class:"month-value"},ws={key:0,class:"month-item month-item--empty"},Cs={class:"summary-card summary-card--closed"},Ts={class:"card-content"},Ws={class:"card-main-value"},$s=["title"],As={class:"card-month-breakdown-hierarchical"},Ds={class:"month-header"},Ss={class:"month-name"},Ns={class:"month-value"},Es={class:"month-breakdown"},Os={class:"breakdown-item breakdown-this-week"},Bs={class:"breakdown-value"},Ms={class:"breakdown-item breakdown-other-week"},Us={class:"breakdown-value"},Rs={key:0,class:"month-item-hierarchical month-item--empty"},Ps={class:"summary-card summary-card--carryover"},Is={class:"card-content"},Ls={class:"card-current-value"},Fs={class:"current-value"},Hs=["title"],Gs={class:"card-month-breakdown"},Ks={class:"month-name"},Vs={class:"month-value"},xs={key:0,class:"month-item month-item--empty"},js={class:"summary-card summary-card--stages"},zs={class:"card-content"},Ys={class:"stages-list"},Zs={class:"stage-icon"},qs={class:"stage-name"},Qs={class:"stage-value"},Js={key:0,class:"stage-item stage-item--empty"},Xs={__name:"SummaryCardsMonths",props:{data:{type:Object,required:!0,default:()=>({newTickets:0,newTicketsByMonth:[],closedTickets:0,closedTicketsByMonth:[],carryoverTickets:0,carryoverTicketsByMonth:[],stages:[]})}},setup(S){const k=S;function s(u){return u==null||isNaN(u)?"0":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e3?u.toLocaleString("ru-RU"):u.toString()}function A(u){return u==null||isNaN(u)?"":`${u>=0?"+":""}${u.toFixed(1)}%`}function w(u,v){if(typeof u!="number"||isNaN(u)||v==null||typeof v!="number"||isNaN(v)||v===0)return null;if(u===v)return 0;const i=(u-v)/v*100;return!isFinite(i)||isNaN(i)?null:i}const _=I(()=>k.data?.newTickets||0),f=I(()=>s(_.value)),p=I(()=>k.data?.newTicketsByMonth||[]),M=I(()=>k.data?.closedTicketsByMonth||[]),O=I(()=>k.data?.carryoverTicketsByMonth||[]),q=I(()=>{const u=O.value;return u.length===0?0:u[u.length-1]?.count||0}),Q=I(()=>{const u=typeof k.data?.newTickets=="number"?k.data.newTickets:parseInt(k.data?.newTickets)||0,v=k.data?.previousPeriodData?.newTickets;return w(u,v)}),L=I(()=>{const u=typeof k.data?.closedTickets=="number"?k.data.closedTickets:parseInt(k.data?.closedTickets)||0,v=k.data?.previousPeriodData?.closedTickets;return w(u,v)}),P=I(()=>{const u=q.value,v=O.value,i=v.length>0?v[0]?.count||0:null;return w(u,i)});function D(u){return{"DT140_12:SUCCESS":"stage-success","DT140_12:FAIL":"stage-fail","DT140_12:UC_0GBU8Z":"stage-other"}[u]||""}function g(u){return{"DT140_12:SUCCESS":"âœ“","DT140_12:FAIL":"âœ—","DT140_12:UC_0GBU8Z":"âš "}[u]||"â€¢"}return(u,v)=>(o(),l("div",hs,[t("div",ms,[v[0]||(v[0]=t("h3",{class:"card-title"},"ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´",-1)),t("div",ys,[t("div",ps,[ve(d(f.value)+" ",1),Q.value!==null?(o(),l("span",{key:0,class:re(["percentage-badge",Q.value>=0?"positive":"negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð°: ${A(Q.value)}`},d(A(Q.value)),11,gs)):j("",!0)]),t("div",bs,[(o(!0),l(te,null,ae(p.value,i=>(o(),l("div",{key:`new-${i.month}`,class:"month-item"},[t("span",fs,d(i.monthName)+":",1),t("span",_s,d(s(i.count)),1)]))),128)),p.value.length===0?(o(),l("div",ws," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):j("",!0)])])]),t("div",Cs,[v[5]||(v[5]=t("h3",{class:"card-title"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð²ÑÐµÐ³Ð¾",-1)),t("div",Ts,[t("div",Ws,[ve(d(s(S.data.closedTickets||0))+" ",1),L.value!==null?(o(),l("span",{key:0,class:re(["percentage-badge",L.value>=0?"positive":"negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð°: ${A(L.value)}`},d(A(L.value)),11,$s)):j("",!0)]),t("div",As,[(o(!0),l(te,null,ae(M.value,i=>(o(),l("div",{key:`closed-${i.month}`,class:"month-item-hierarchical"},[t("div",Ds,[t("span",Ss,d(i.monthName)+":",1),t("span",Ns,d(s(i.count||0)),1)]),t("div",Es,[t("div",Os,[v[1]||(v[1]=t("span",{class:"breakdown-icon"},"âœ“",-1)),v[2]||(v[2]=t("span",{class:"breakdown-label"},"ÑÑ‚Ð¾Ð³Ð¾ Ð¼ÐµÑÑÑ†Ð°:",-1)),t("span",Bs,d(s(i.closedCreatedThisWeek||0)),1)]),t("div",Ms,[v[3]||(v[3]=t("span",{class:"breakdown-icon"},"â†»",-1)),v[4]||(v[4]=t("span",{class:"breakdown-label"},"Ð´Ñ€ÑƒÐ³Ð¾Ð³Ð¾ Ð¼ÐµÑÑÑ†Ð°:",-1)),t("span",Us,d(s(i.closedCreatedOtherWeek||0)),1)])])]))),128)),M.value.length===0?(o(),l("div",Rs," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):j("",!0)])])]),t("div",Ps,[v[7]||(v[7]=t("h3",{class:"card-title"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ð²ÑÐµÐ³Ð¾",-1)),v[8]||(v[8]=t("p",{class:"card-hint"},"ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° Ð² Ñ‚Ñ€ÐµÑ… Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ… Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… ÑÑ‚Ð°Ð´Ð¸ÑÑ… (Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ)",-1)),t("div",Is,[t("div",Ls,[v[6]||(v[6]=t("span",{class:"current-label"},"Ð¢ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ:",-1)),t("span",Fs,[ve(d(s(q.value))+" ",1),P.value!==null?(o(),l("span",{key:0,class:re(["percentage-badge",P.value>=0?"positive":"negative"]),title:`Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð°: ${A(P.value)}`},d(A(P.value)),11,Hs)):j("",!0)])]),t("div",Gs,[(o(!0),l(te,null,ae(O.value,i=>(o(),l("div",{key:`carryover-${i.month}`,class:"month-item"},[t("span",Ks,d(i.monthName)+":",1),t("span",Vs,d(s(i.count||0)),1)]))),128)),O.value.length===0?(o(),l("div",xs," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):j("",!0)])])]),t("div",js,[v[10]||(v[10]=t("h3",{class:"card-title"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),t("div",zs,[t("div",Ys,[(o(!0),l(te,null,ae(S.data.stages||[],i=>(o(),l("div",{key:i.stageId,class:re(["stage-item",D(i.stageId)])},[t("span",Zs,d(g(i.stageId)),1),t("span",qs,d(i.stageName||i.stageId)+":",1),t("span",Qs,d(s(i.count||0)),1)],2))),128)),!S.data.stages||S.data.stages.length===0?(o(),l("div",Js,[...v[9]||(v[9]=[t("span",{class:"stage-name"},"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…",-1)])])):j("",!0)])])])]))}},er=fe(Xs,[["__scopeId","data-v-15d88b90"]]),tr={class:"line-chart-months"},ar={class:"chart-section"},sr={class:"chart-title"},rr={key:0,class:"chart-period"},or={class:"chart-wrapper"},nr={class:"chart-container"},lr={class:"chart-summary"},ir={class:"summary-numbers"},cr={class:"summary-row"},dr={class:"summary-values"},ur={class:"summary-row"},kr={class:"summary-values"},vr={class:"summary-analysis"},hr=["innerHTML"],mr={class:"chart-section"},yr={class:"chart-title"},pr={key:0,class:"chart-period"},gr={class:"chart-wrapper"},br={class:"chart-container"},fr={class:"chart-analysis"},_r={class:"analysis-content"},wr=["innerHTML"],Cr={class:"chart-table-section"},Tr={class:"chart-table-wrapper"},Wr={class:"data-table"},$r={class:"data-row data-row--new"},Ar={class:"data-row data-row--closed"},Dr={class:"data-row data-row--carryover"},Sr={__name:"LineChartMonths",props:{data:{type:Object,required:!0,default:()=>({newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[]})},meta:{type:Object,default:()=>({months:[]})}},setup(S){Le.register(je);const k=S;function s(D){return D==null||isNaN(D)?"0":D>=1e3?D.toLocaleString("ru-RU"):D.toString()}const A=I(()=>{const D=new Set;return k.data.newTicketsByMonth?.forEach(g=>{g.weeks&&Array.isArray(g.weeks)&&g.weeks.forEach(u=>{u&&u.weekNumber&&D.add(u.weekNumber)})}),k.data.closedTicketsByMonth?.forEach(g=>{g.weeks&&Array.isArray(g.weeks)&&g.weeks.forEach(u=>{u&&u.weekNumber&&D.add(u.weekNumber)})}),k.data.carryoverTicketsByMonth?.forEach(g=>{g.weeks&&Array.isArray(g.weeks)&&g.weeks.forEach(u=>{u&&u.weekNumber&&D.add(u.weekNumber)})}),Array.from(D).sort((g,u)=>g-u)}),w=I(()=>{const D=k.data.newTicketsByMonth||[],g=D.map(i=>i.monthName||`ÐœÐµÑÑÑ† ${i.month}`),u=D.map(i=>i.count||0),v=(k.data.closedTicketsByMonth||[]).map(i=>i.count||0);return{labels:g,datasets:[{label:"ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹",data:u,borderColor:c.primary,backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:10,color:c.primary,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:c.primary,borderWidth:1,borderRadius:4,padding:4}},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹",data:v,borderColor:c.success,backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"start",align:"bottom",offset:10,color:c.success,font:{size:12,weight:"bold"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:c.success,borderWidth:1,borderRadius:4,padding:4}}]}}),_=I(()=>{const D=k.data.carryoverTicketsByMonth||[],g=D.map(v=>v.monthName||`ÐœÐµÑÑÑ† ${v.month}`),u=D.map(v=>v.count||0);return{labels:g,datasets:[{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹",data:u,borderColor:c.carryover,backgroundColor:"rgba(255, 152, 0, 0.1)",tension:.4,fill:!1,datalabels:{anchor:"end",align:"top",offset:4,color:c.carryover}}]}}),f={responsive:!0,maintainAspectRatio:!1,layout:{padding:{left:16,right:0,top:56,bottom:0}},plugins:{legend:{position:"left",labels:{font:{size:14,weight:"500"},padding:16,boxWidth:20,boxHeight:12}},tooltip:{enabled:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12},datalabels:{anchor:"end",align:"top",formatter:(D,g)=>D==null||isNaN(D)?"":D.toString(),color:"#333",font:{size:12,weight:"bold"},padding:{top:4,bottom:4},display:function(D){const g=D.dataset.data[D.dataIndex];return g!=null&&!isNaN(g)&&isFinite(g)},backgroundColor:"rgba(255, 255, 255, 0.8)",borderColor:"#333",borderWidth:1,borderRadius:4,padding:4}},scales:{y:{beginAtZero:!0,ticks:{precision:0,font:{size:14},padding:10},grid:{lineWidth:1.5}},x:{ticks:{maxRotation:0,minRotation:0,font:{size:14},padding:10},grid:{lineWidth:1.5}}}};function p(D){if(!D||D.length===0)return null;const g=D[0],u=D[D.length-1];if(!g||!u)return null;const v=g.monthName||`ÐœÐµÑÑÑ† ${g.month}`,i=u.monthName||`ÐœÐµÑÑÑ† ${u.month}`,C=g.year||new Date().getFullYear();return`${v} â€” ${i} ${C}`}const M=I(()=>p(k.data?.newTicketsByMonth||[])),O=I(()=>p(k.data?.carryoverTicketsByMonth||[])),q=I(()=>{const D=k.data?.newTicketsByMonth||[],g=k.data?.closedTicketsByMonth||[];if(D.length===0)return{new:"â€”",closed:"â€”"};const u=D.map(i=>`${s(i.count||0)} (${i.monthName||i.month})`).join(" â†’ "),v=g.map(i=>`${s(i.count||0)} (${i.monthName||i.month})`).join(" â†’ ");return{new:u,closed:v}}),Q=I(()=>{const D=k.data?.newTicketsByMonth||[],g=k.data?.closedTicketsByMonth||[];if(D.length<2)return["ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°"];const u=[],v=[],i=[];if(D.length>=2){const C=D[0],T=D[1],y=D[2];if(T&&C&&typeof C.count=="number"&&typeof T.count=="number"){const n=C.monthName||C.month,E=T.monthName||T.month,W=s(C.count||0),N=s(T.count||0);if(C.count>0){const $=(T.count-C.count)/C.count*100;if(isFinite($)&&!isNaN($)){const K=$>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",H=Math.abs($),Y=$>=0?"+":"-",V=$>=0?"#28a745":"#dc3545",Z=$>=0?"#28a745":"#dc3545";v.push(`  â€¢ <span style="color: ${V}; font-weight: 600;">${K}</span> Ñ ${W} (${n}) Ð´Ð¾ ${N} (${E}) â€” <span style="color: ${Z}; font-weight: 600;">${Y}${H.toFixed(1)}%</span>`)}}else C.count===0&&T.count>0&&v.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ 0 (${n}) Ð´Ð¾ ${N} (${E})`)}if(y&&T&&typeof T.count=="number"&&typeof y.count=="number"){const n=T.monthName||T.month,E=y.monthName||y.month,W=s(T.count||0),N=s(y.count||0);if(T.count>0){const $=(y.count-T.count)/T.count*100;if(isFinite($)&&!isNaN($))if(Math.abs($)<.1)v.push(`  â€¢ Ð‘ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: ${W} (${n}) â†’ ${N} (${E}) â€” 0.0%`);else{const K=$>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",H=Math.abs($),Y=$>=0?"+":"-",V=$>=0?"#28a745":"#dc3545",Z=$>=0?"#28a745":"#dc3545";v.push(`  â€¢ <span style="color: ${V}; font-weight: 600;">${K}</span> Ñ ${W} (${n}) Ð´Ð¾ ${N} (${E}) â€” <span style="color: ${Z}; font-weight: 600;">${Y}${H.toFixed(1)}%</span>`)}}else T.count===0&&y.count>0&&v.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ 0 (${n}) Ð´Ð¾ ${N} (${E})`)}}if(g.length>=2){const C=g[0],T=g[1],y=g[2];if(T&&C&&typeof C.count=="number"&&typeof T.count=="number"){const n=C.monthName||C.month,E=T.monthName||T.month,W=s(C.count||0),N=s(T.count||0);if(C.count>0){const $=(T.count-C.count)/C.count*100;if(isFinite($)&&!isNaN($))if(Math.abs($)<.1)i.push(`  â€¢ Ð‘ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: ${W} (${n}) â†’ ${N} (${E}) â€” 0.0%`);else{const K=$>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",H=Math.abs($),Y=$>=0?"+":"-",V=$>=0?"#28a745":"#dc3545",Z=$>=0?"#28a745":"#dc3545";i.push(`  â€¢ <span style="color: ${V}; font-weight: 600;">${K}</span> Ñ ${W} (${n}) Ð´Ð¾ ${N} (${E}) â€” <span style="color: ${Z}; font-weight: 600;">${Y}${H.toFixed(1)}%</span>`)}}else C.count===0&&T.count>0&&i.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹: Ñ 0 (${n}) Ð´Ð¾ ${N} (${E})`)}if(y&&T&&typeof T.count=="number"&&typeof y.count=="number"){const n=T.monthName||T.month,E=y.monthName||y.month,W=s(T.count||0),N=s(y.count||0);if(T.count>0){const $=(y.count-T.count)/T.count*100;if(isFinite($)&&!isNaN($))if(Math.abs($)<.1)i.push(`  â€¢ Ð‘ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: ${W} (${n}) â†’ ${N} (${E}) â€” 0.0%`);else{const K=$>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",H=Math.abs($),Y=$>=0?"+":"-",V=$>=0?"#28a745":"#dc3545",Z=$>=0?"#28a745":"#dc3545";i.push(`  â€¢ <span style="color: ${V}; font-weight: 600;">${K}</span> Ñ ${W} (${n}) Ð´Ð¾ ${N} (${E}) â€” <span style="color: ${Z}; font-weight: 600;">${Y}${H.toFixed(1)}%</span>`)}}else T.count===0&&y.count>0&&i.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹: Ñ 0 (${n}) Ð´Ð¾ ${N} (${E})`)}}if(v.length>0&&(u.push("ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹:"),u.push(...v)),i.length>0&&(u.push("Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹:"),u.push(...i)),D.length>=3&&g.length>=3){const C=D[0],T=D[D.length-1],y=g[0],n=g[g.length-1],E=C.count||0,W=T.count||0,N=y.count||0,$=n.count||0;if(E>0&&N>0){const K=(W-E)/E*100,H=($-N)/N*100;if(isFinite(K)&&isFinite(H)){const Y=C.monthName||C.month,V=T.monthName||T.month,Z=y.monthName||y.month,ue=n.monthName||n.month,ge=K>=0?"#28a745":"#dc3545",h=K>=0?"#28a745":"#dc3545",e=H>=0?"#28a745":"#dc3545",a=H>=0?"#28a745":"#dc3545";u.push("ÐžÐ±Ñ‰Ð°Ñ Ð´Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ° Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´:"),u.push(`  â€¢ ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹: <span style="color: ${ge}; font-weight: 600;">${K>=0?"Ñ€Ð¾ÑÑ‚":"ÑÐ½Ð¸Ð¶ÐµÐ½Ð¸Ðµ"}</span> Ñ ${s(E)} (${Y}) Ð´Ð¾ ${s(W)} (${V}) â€” <span style="color: ${h}; font-weight: 600;">${K>=0?"+":"-"}${Math.abs(K).toFixed(1)}%</span>`),u.push(`  â€¢ Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹: <span style="color: ${e}; font-weight: 600;">${H>=0?"Ñ€Ð¾ÑÑ‚":"ÑÐ½Ð¸Ð¶ÐµÐ½Ð¸Ðµ"}</span> Ñ ${s(N)} (${Z}) Ð´Ð¾ ${s($)} (${ue}) â€” <span style="color: ${a}; font-weight: 600;">${H>=0?"+":"-"}${Math.abs(H).toFixed(1)}%</span>`)}}}return u.length>0?u:["ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°"]}),L=I(()=>{const D=k.data?.carryoverTicketsByMonth||[];if(D.length===0)return["ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°"];const g=[],u=[],v=D.filter(i=>i&&typeof i.count=="number").map(i=>`${s(i.count||0)} (${i.monthName||i.month||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"})`).join(" â†’ ");if(v&&g.push(`ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹: ${v}`),D.length>=2){const i=D[0],C=D[1],T=D[2];if(C&&i&&typeof i.count=="number"&&typeof C.count=="number"){const y=i.monthName||i.month,n=C.monthName||C.month,E=s(i.count||0),W=s(C.count||0);if(i.count>0){const N=(C.count-i.count)/i.count*100;if(isFinite(N)&&!isNaN(N))if(Math.abs(N)<.1)u.push(`  â€¢ Ð‘ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: ${E} (${y}) â†’ ${W} (${n}) â€” 0.0%`);else{const $=N>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",K=Math.abs(N),H=N>=0?"+":"-",Y=N>=0?"#28a745":"#dc3545",V=N>=0?"#28a745":"#dc3545";u.push(`  â€¢ <span style="color: ${Y}; font-weight: 600;">${$}</span> Ñ ${E} (${y}) Ð´Ð¾ ${W} (${n}) â€” <span style="color: ${V}; font-weight: 600;">${H}${K.toFixed(1)}%</span>`)}}else i.count===0&&C.count>0&&u.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ 0 (${y}) Ð´Ð¾ ${W} (${n})`)}if(T&&C&&typeof C.count=="number"&&typeof T.count=="number"){const y=C.monthName||C.month,n=T.monthName||T.month,E=s(C.count||0),W=s(T.count||0);if(C.count>0){const N=(T.count-C.count)/C.count*100;if(isFinite(N)&&!isNaN(N))if(Math.abs(N)<.1)u.push(`  â€¢ Ð‘ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: ${E} (${y}) â†’ ${W} (${n}) â€” 0.0%`);else{const $=N>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",K=Math.abs(N),H=N>=0?"+":"-",Y=N>=0?"#28a745":"#dc3545",V=N>=0?"#28a745":"#dc3545";u.push(`  â€¢ <span style="color: ${Y}; font-weight: 600;">${$}</span> Ñ ${E} (${y}) Ð´Ð¾ ${W} (${n}) â€” <span style="color: ${V}; font-weight: 600;">${H}${K.toFixed(1)}%</span>`)}}else C.count===0&&T.count>0&&u.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ 0 (${y}) Ð´Ð¾ ${W} (${n})`)}}if(u.length>0&&(g.push("Ð”Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ° Ð¿Ð¾ Ð¼ÐµÑÑÑ†Ð°Ð¼:"),g.push(...u)),D.length>=3){const i=D[0],C=D[D.length-1];if(i&&C&&typeof i.count=="number"&&typeof C.count=="number"){const T=i.count||0,y=C.count||0,n=i.monthName||i.month,E=C.monthName||C.month,W=s(T),N=s(y);if(T>0){const $=(y-T)/T*100;if(isFinite($)&&!isNaN($))if(Math.abs($)<1)g.push("Ð¢ÐµÐ½Ð´ÐµÐ½Ñ†Ð¸Ñ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´:"),g.push(`  â€¢ Ð¡Ñ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾: ${W} (${n}) â†’ ${N} (${E}) â€” Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¼ÐµÐ½ÐµÐµ 1%`);else{const K=$>=0?"Ð Ð¾ÑÑ‚":"Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ",H=Math.abs($),Y=$>=0?"+":"-",V=$>=0?"#28a745":"#dc3545",Z=$>=0?"#28a745":"#dc3545";g.push("Ð¢ÐµÐ½Ð´ÐµÐ½Ñ†Ð¸Ñ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´:"),g.push(`  â€¢ <span style="color: ${V}; font-weight: 600;">${K}</span> Ñ ${W} (${n}) Ð´Ð¾ ${N} (${E}) â€” <span style="color: ${Z}; font-weight: 600;">${Y}${H.toFixed(1)}%</span>`)}}else T===0&&y>0?(g.push("Ð¢ÐµÐ½Ð´ÐµÐ½Ñ†Ð¸Ñ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´:"),g.push(`  â€¢ ÐŸÐ¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ 0 (${n}) Ð´Ð¾ ${N} (${E})`)):T>0&&y===0&&(g.push("Ð¢ÐµÐ½Ð´ÐµÐ½Ñ†Ð¸Ñ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´:"),g.push(`  â€¢ ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²: Ñ ${W} (${n}) Ð´Ð¾ 0 (${E})`))}}return g.length>0?g:["ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°"]});function P(D,g){let u=[];switch(D){case"new":u=k.data.newTicketsByMonth||[];break;case"closed":u=k.data.closedTicketsByMonth||[];break;case"carryover":u=k.data.carryoverTicketsByMonth||[];break;default:return"-"}for(const v of u){if(!v.weeks||!Array.isArray(v.weeks))continue;const i=v.weeks.find(C=>C&&C.weekNumber===g);if(i){const C=i.count||0;return C>0?s(C):"-"}}return"-"}return(D,g)=>(o(),l("div",tr,[t("div",ar,[t("h3",sr,[g[0]||(g[0]=ve(" ÐÐ¾Ð²Ñ‹Ðµ Ð¸ Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ ",-1)),M.value?(o(),l("span",rr,"("+d(M.value)+")",1)):j("",!0)]),t("div",or,[t("div",nr,[J(De(We),{data:w.value,options:f},null,8,["data"])]),t("div",lr,[g[3]||(g[3]=t("h4",{class:"summary-title"},"Ð¡Ð²Ð¾Ð´Ð½Ñ‹Ð¹ Ð¸Ñ‚Ð¾Ð³",-1)),t("div",ir,[t("div",cr,[g[1]||(g[1]=t("span",{class:"summary-label"},"ÐÐ¾Ð²Ñ‹Ðµ:",-1)),t("span",dr,d(q.value.new),1)]),t("div",ur,[g[2]||(g[2]=t("span",{class:"summary-label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ:",-1)),t("span",kr,d(q.value.closed),1)])]),t("div",vr,[(o(!0),l(te,null,ae(Q.value,(u,v)=>(o(),l("p",{key:v,innerHTML:u},null,8,hr))),128))])])])]),t("div",mr,[t("h3",yr,[g[4]||(g[4]=ve(" ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ ",-1)),O.value?(o(),l("span",pr,"("+d(O.value)+")",1)):j("",!0)]),t("div",gr,[t("div",br,[J(De(We),{data:_.value,options:f},null,8,["data"])]),t("div",fr,[g[5]||(g[5]=t("h4",{class:"analysis-title"},"ÐÐ½Ð°Ð»Ð¸Ð·",-1)),t("div",_r,[(o(!0),l(te,null,ae(L.value,(u,v)=>(o(),l("p",{key:v,innerHTML:u},null,8,wr))),128))])])])]),t("div",Cr,[g[10]||(g[10]=t("h3",{class:"chart-title"},"Ð”ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ð¼ÐµÑÑÑ†Ð°Ð¼ Ð¸ Ð½ÐµÐ´ÐµÐ»ÑÐ¼",-1)),t("div",Tr,[t("table",Wr,[t("thead",null,[t("tr",null,[g[6]||(g[6]=t("th",{class:"month-header-cell"},"ÐœÐµÑÑÑ†",-1)),(o(!0),l(te,null,ae(A.value,u=>(o(),l("th",{key:`week-${u}`,class:"week-header-cell"}," ÐÐµÐ´ÐµÐ»Ñ "+d(u),1))),128))])]),t("tbody",null,[t("tr",$r,[g[7]||(g[7]=t("td",{class:"data-type-cell"},"ÐÐ¾Ð²Ñ‹Ðµ",-1)),(o(!0),l(te,null,ae(A.value,u=>(o(),l("td",{key:`new-${u}`,class:"week-data-cell"},d(P("new",u)),1))),128))]),t("tr",Ar,[g[8]||(g[8]=t("td",{class:"data-type-cell"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ",-1)),(o(!0),l(te,null,ae(A.value,u=>(o(),l("td",{key:`closed-${u}`,class:"week-data-cell"},d(P("closed",u)),1))),128))]),t("tr",Dr,[g[9]||(g[9]=t("td",{class:"data-type-cell"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",-1)),(o(!0),l(te,null,ae(A.value,u=>(o(),l("td",{key:`carryover-${u}`,class:"week-data-cell"},d(P("carryover",u)),1))),128))])])])])])]))}},Nr=fe(Sr,[["__scopeId","data-v-31a3d565"]]),Er={class:"months-preloader"},Or={class:"preloader-content"},Br={class:"progress-container"},Mr={class:"progress-bar"},Ur={class:"progress-text"},Rr={class:"preloader-message"},Pr={class:"stages-list"},Ir={class:"stage-icon"},Lr={class:"stage-text"},Fr={__name:"MonthsModePreloader",props:{progress:{type:Number,required:!0,validator:S=>S>=0&&S<=100},currentStage:{type:String,default:""}},setup(S){const k=S,s=[{label:"ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…...",threshold:5},{label:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 1)...",threshold:35},{label:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 2)...",threshold:65},{label:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 3)...",threshold:85},{label:"ÐÐ³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…...",threshold:90},{label:"Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð²...",threshold:100}];function A(_){return k.progress>=s[_].threshold}function w(_){const f=s[_].threshold,p=_>0?s[_-1].threshold:0;return k.progress>=p&&k.progress<f}return(_,f)=>(o(),l("div",Er,[t("div",Or,[f[0]||(f[0]=tt('<div class="preloader-spinner" data-v-b571fe67><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div><div class="spinner-ring" data-v-b571fe67></div></div><h3 class="preloader-title" data-v-b571fe67>Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° 3 Ð¼ÐµÑÑÑ†Ð°</h3>',2)),t("div",Br,[t("div",Mr,[t("div",{class:"progress-fill",style:we({width:`${S.progress}%`})},null,4)]),t("div",Ur,d(Math.round(S.progress))+"%",1)]),t("p",Rr,d(S.currentStage),1),t("div",Pr,[(o(),l(te,null,ae(s,(p,M)=>t("div",{key:M,class:re(["stage-item",{"stage-completed":A(M),"stage-current":w(M)}])},[t("span",Ir,d(A(M)?"âœ“":w(M)?"â†’":"â—‹"),1),t("span",Lr,d(p.label),1)],2)),64))])])]))}},Hr=fe(Fr,[["__scopeId","data-v-b571fe67"]]),Gr={class:"ac-dashboard-months"},Kr={key:"content"},Vr={class:"dashboard-header"},xr={class:"header-content"},jr={class:"breadcrumbs-row"},zr=["aria-label","aria-disabled","data-fallback","disabled"],Yr={class:"breadcrumbs","aria-label":"ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ"},Zr={class:"dashboard-layout"},qr={class:"filters-container"},Qr={class:"chart-container"},Jr={__name:"GraphAdmissionClosureMonthsDashboard",setup(S){const k=ze(),s=F(!0),A=F(0),w=F("ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…..."),_=F(null),f=F(null),p=F({newTickets:0,closedTickets:0,carryoverTickets:0,newTicketsByMonth:[],closedTicketsByMonth:[],carryoverTicketsByMonth:[],previousPeriodData:{newTickets:null,closedTickets:null,carryoverTickets:null}}),M=F(!1),O=I(()=>typeof window>"u"?!1:window.history.length>1),q=I(()=>O.value?"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ":"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"),Q={name:"dashboard-sector-1c"};function L(W){if(W?.preventDefault?.(),!M.value){M.value=!0;try{if(O.value){k.back();return}console.warn("GraphAdmissionClosureMonthsDashboard: fallback navigation to dashboard-sector-1c"),k.push(Q)}finally{M.value=!1}}}const P=F({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),D=I(()=>{const W=P.value.customDateRange.startDate||P.value.customDateRange.endDate,N=P.value.employees.length===1&&P.value.employees.includes("all");return W||!N});async function g(W,N,$=500){const K=A.value,H=10,Y=(W-K)/H,V=$/H;for(let Z=0;Z<H;Z++)await new Promise(ue=>setTimeout(ue,V)),A.value=Math.min(K+Y*(Z+1),W);A.value=W,w.value=N}async function u(){console.log("[DEBUG MonthsDashboard] loadData called"),console.log("[DEBUG MonthsDashboard] isLoading before:",s.value),s.value=!0,_.value=null,A.value=0,w.value="ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…...",console.log("[DEBUG MonthsDashboard] isLoading set to true");let W=null,N=null;try{console.log("[DEBUG MonthsDashboard] Starting API call"),await g(5,"ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…...",200);const $=Date.now(),K=2e4;W=setInterval(()=>{const Z=Date.now()-$,ue=Math.min(5+Z/K*85,90);A.value=ue,ue<35?w.value="Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 1)...":ue<65?w.value="Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 2)...":ue<85?w.value="Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´ (Ð·Ð°Ð¿Ñ€Ð¾Ñ 3)...":w.value="ÐÐ³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…..."},500),N=setTimeout(()=>{W&&(clearInterval(W),W=null)},K+1e4);const H=await Se({product:"1C",periodMode:"months",includeTickets:!0});clearTimeout(N),W&&(clearInterval(W),W=null),A.value=90,w.value="ÐÐ³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°",await g(100,"Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð²...",300),console.log("[DEBUG MonthsDashboard] API call successful, result:",H);const{meta:Y,data:V}=H;f.value=Y,p.value=V,console.log("[DEBUG MonthsDashboard] Data set, meta:",Y,"data keys:",Object.keys(V)),await new Promise(Z=>setTimeout(Z,200))}catch($){W&&(clearInterval(W),W=null),N&&(clearTimeout(N),N=null),console.error("[DEBUG MonthsDashboard] API call failed:",$),_.value=$ instanceof Error?$:new Error("ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸"),console.error("[GraphAdmissionClosureMonthsDashboard] loadData error:",$),A.value=100,w.value="ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…"}finally{console.log("[DEBUG MonthsDashboard] Finally block: setting isLoading to false"),s.value=!1,console.log("[DEBUG MonthsDashboard] isLoading after:",s.value)}}function v(W){P.value.stages=W}function i(W){P.value.employees=W}function C(W){P.value.dateRange=W}function T(W){P.value.customDateRange=W}function y(){P.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},n()}function n(){u()}function E(W){if(!["weeks","months"].includes(W)){console.warn("[GraphAdmissionClosureMonthsDashboard] Invalid periodMode:",W);return}W==="weeks"&&window.dispatchEvent(new CustomEvent("period-mode-change",{detail:{mode:W}}))}return Fe(()=>{console.log("[DEBUG MonthsDashboard] onMounted called"),console.log("[DEBUG MonthsDashboard] isLoading before loadData:",s.value),u()}),(W,N)=>{const $=Ye("router-link");return o(),l("div",Gr,[J(he,{name:"fade",mode:"out-in"},{default:ne(()=>[s.value?(o(),me(Hr,{key:"preloader",progress:A.value,"current-stage":w.value},null,8,["progress","current-stage"])):(o(),l("div",Kr,[t("div",Vr,[t("div",xr,[t("div",jr,[t("button",{class:"btn-back-link",type:"button",onClick:L,"aria-label":q.value,"aria-disabled":!O.value,"data-fallback":!O.value,disabled:M.value,title:"ÐÐ°Ð·Ð°Ð´"}," â† ",8,zr),t("nav",Yr,[J($,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ne(()=>[...N[0]||(N[0]=[ve(" Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡ ",-1)])]),_:1}),N[2]||(N[2]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),J($,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:ne(()=>[...N[1]||(N[1]=[ve(" Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ",-1)])]),_:1}),N[3]||(N[3]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),N[4]||(N[4]=t("span",{class:"breadcrumb-current"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹",-1))])]),N[5]||(N[5]=t("h1",{class:"dashboard-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),N[6]||(N[6]=t("p",{class:"dashboard-subtitle"}," Ð”Ð¾ÑÑ‚ÑƒÐ¿Ñ‹ Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ñ‹ Â«Ð“Ñ€Ð°Ñ„Ð¸ÐºÑƒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑÂ», ÑÐµÐ»ÐµÐºÑ‚Ð¾Ñ€ ÑÑ‚Ð°Ð¿Ð¾Ð² ÑÐºÑ€Ñ‹Ñ‚. ",-1))])]),t("div",Zr,[t("div",qr,[J(qe,{stages:P.value.stages,employees:P.value.employees,dateRange:P.value.dateRange,customDateRange:P.value.customDateRange,hasActiveFilters:D.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":"months","onUpdate:stages":v,"onUpdate:employees":i,"onUpdate:dateRange":C,"onUpdate:customDateRange":T,"onUpdate:periodMode":E,onReset:y,onApply:n},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters"])]),t("div",Qr,[_.value?(o(),me(Ze,{key:0,type:"error",title:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",message:_.value.message},null,8,["message"])):(o(),l(te,{key:1},[J(er,{data:p.value},null,8,["data"]),J(Nr,{data:p.value,meta:f.value},null,8,["data","meta"])],64))])])]))]),_:1})])}}},Xr=fe(Jr,[["__scopeId","data-v-fe3ca7ed"]]);function eo(S){if(!S)return null;try{const k=new Date(S);return isNaN(k.getTime())?null:k}catch{return console.warn("Invalid date format:",S),null}}function to(S,k){return Math.floor((S-k)/864e5)}function ao(S){return!S||isNaN(S.getTime())?!1:S<=new Date}const be={ONE_MONTH:"one_month",TWO_MONTHS:"two_months",MORE_THAN_HALF_YEAR:"more_than_half_year",MORE_THAN_YEAR:"more_than_year"},Ae={[be.ONE_MONTH]:"ÐžÐ´Ð¸Ð½ Ð¼ÐµÑÑÑ†",[be.TWO_MONTHS]:"Ð”Ð²Ð° Ð¼ÐµÑÑÑ†Ð°",[be.MORE_THAN_HALF_YEAR]:"Ð‘Ð¾Ð»ÐµÐµ Ð¿Ð¾Ð»ÑƒÐ³Ð¾Ð´Ð°",[be.MORE_THAN_YEAR]:"Ð‘Ð¾Ð»ÐµÐµ Ð³Ð¾Ð´Ð°"},Ke={[be.ONE_MONTH]:30,[be.TWO_MONTHS]:60,[be.MORE_THAN_HALF_YEAR]:180,[be.MORE_THAN_YEAR]:365};function Pe(S,k,s=new Date){if(!Array.isArray(S))return console.warn("filterTicketsByTimePeriod: tickets must be an array"),[];if(!Ke[k])return console.warn(`filterTicketsByTimePeriod: Unknown period "${k}"`),S;const A=Ke[k],w=k.includes("more_than");return S.filter(_=>{try{if(!_||!_.id||!_.created_at)return console.warn("Ticket missing required fields:",_),!1;const f=eo(_.created_at);if(!f)return console.warn(`Invalid date for ticket ${_.id}: ${_.created_at}`),!1;if(!ao(f))return console.warn(`Future or invalid date for ticket ${_.id}: ${_.created_at}`),!1;const p=to(s,f);return w?p>A:p<=A}catch(f){return console.error(`Error filtering ticket ${_?.id||"unknown"}:`,f),!1}})}const so={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},ro={class:"modal"},oo={key:0,class:"modal__tabs"},no={key:"level-0-categories",class:"level-0"},lo={class:"modal__header"},io={class:"modal__title"},co={key:0},uo={class:"modal__body"},ko={class:"categories-list"},vo=["onClick"],ho={class:"category-item"},mo={class:"category-item__icon"},yo={key:0},po={key:1},go={class:"category-item__content"},bo={class:"category-item__label"},fo={class:"category-item__count"},_o={key:0,class:"category-item__arrow"},wo={class:"modal__footer"},Co={key:"level-1-categories",class:"level-1"},To={class:"modal__header"},Wo={class:"modal__body"},$o={key:"loading",class:"loading-names"},Ao={key:"empty",class:"modal__empty"},Do={key:"list",class:"responsible-list"},So=["onClick"],No={class:"responsible-list__name"},Eo={class:"responsible-list__count"},Oo={key:0,class:"responsible-list__arrow"},Bo={class:"modal__footer"},Mo={key:"level-2-categories",class:"level-2"},Uo={class:"modal__header"},Ro={class:"modal__title"},Po={class:"modal__body"},Io={class:"time-sort-controls"},Lo={class:"time-sort-buttons"},Fo=["onClick"],Ho={class:"count"},Go={key:"loading",class:"loading-state"},Ko={key:"error",class:"error-state"},Vo={class:"error-message"},xo={key:"empty",class:"empty-state"},jo={class:"empty-state-message"},zo={key:"tickets",class:"tickets-list-container"},Yo={key:"level-0-employees",class:"level-0"},Zo={class:"modal__header"},qo={class:"modal__title"},Qo={key:0},Jo={class:"modal__body"},Xo={key:"loading",class:"loading-names"},en={key:"empty",class:"modal__empty"},tn={key:"list",class:"responsible-list"},an=["onClick"],sn={class:"responsible-list__name"},rn={class:"responsible-list__count"},on={key:0,class:"responsible-list__arrow"},nn={class:"modal__footer"},ln={key:"level-1-employees",class:"level-1"},cn={class:"modal__header"},dn={class:"modal__title"},un={class:"modal__body"},kn={class:"categories-list"},vn=["onClick"],hn={class:"category-item"},mn={class:"category-item__icon"},yn={key:0},pn={key:1},gn={class:"category-item__content"},bn={class:"category-item__label"},fn={class:"category-item__count"},_n={key:0,class:"category-item__arrow"},wn={class:"modal__footer"},Cn={key:"level-2-employees",class:"level-2"},Tn={class:"modal__header"},Wn={class:"modal__title"},$n={class:"modal__body"},An={key:"loading",class:"loading-state"},Dn={key:"error",class:"error-state"},Sn={class:"error-message"},Nn={key:"empty",class:"empty-state"},En={class:"empty-state-message"},On={key:"tickets",class:"tickets-list-container"},Bn={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},closedTicketsCreatedThisWeek:{type:Number,default:0},closedTicketsCreatedOtherWeek:{type:Number,default:0},responsibleCreatedThisWeek:{type:Array,default:()=>[]},responsibleCreatedOtherWeek:{type:Array,default:()=>[]},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(S){const k=S,s=F(0),A=F("categories"),w=F(null),_=F(null),f=F(null),p=F([]),M=F(!1),O=F(null),q=F([]),Q=F([]),L=F(!1),P=F(be.ONE_MONTH),D=I(()=>[{id:"created-this-week",label:"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ",count:k.closedTicketsCreatedThisWeek??0,responsible:k.responsibleCreatedThisWeek??[]},{id:"created-other-week",label:"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»ÑŒÑŽ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ€Ð°Ð½ÐµÐµ",count:k.closedTicketsCreatedOtherWeek??0,responsible:k.responsibleCreatedOtherWeek??[]}]),g=I(()=>{const h=new Map;return(k.responsibleCreatedThisWeek||[]).forEach(e=>{const a=e.id??"unassigned";h.has(a)||h.set(a,{id:e.id,name:e.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const r=h.get(a);r.thisWeekCount=e.count??0,r.thisWeekTickets=e.tickets||[],r.totalCount+=r.thisWeekCount}),(k.responsibleCreatedOtherWeek||[]).forEach(e=>{const a=e.id??"unassigned";h.has(a)||h.set(a,{id:e.id,name:e.name,thisWeekCount:0,otherWeekCount:0,totalCount:0,thisWeekTickets:[],otherWeekTickets:[]});const r=h.get(a);r.otherWeekCount=e.count??0,r.otherWeekTickets=e.tickets||[],r.totalCount+=r.otherWeekCount}),Array.from(h.values())}),u=I(()=>{if(!_.value)return[];const h=_.value.thisWeekTickets||[],e=_.value.otherWeekTickets||[];return console.log("[ResponsibleModal] Computing gradations for employee:",{id:_.value.id,name:_.value.name,thisWeekCount:_.value.thisWeekCount,otherWeekCount:_.value.otherWeekCount,thisWeekTickets:h.length,otherWeekTickets:e.length,employee:_.value}),[{id:"this-week",label:"ÐÐ° ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ðµ",count:_.value.thisWeekCount??0,tickets:h,employeeId:_.value.id},{id:"other-week",label:"ÐÐ° Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ðµ",count:_.value.otherWeekCount??0,tickets:e,employeeId:_.value.id}]}),v=I(()=>(Q.value||[]).length>0),i=I(()=>{if(!p.value||p.value.length===0)return[];try{const h=performance.now(),e=Pe(p.value,P.value),a=performance.now();return console.log(`[ResponsibleModal] Filtering took ${(a-h).toFixed(2)}ms, results: ${e.length}`),e}catch(h){return console.error("[ResponsibleModal] Error filtering tickets:",h),[]}}),C=I(()=>Object.keys(Ae).map(h=>({key:h,label:Ae[h],count:Pe(p.value,h).length})));async function T(h){const e=h.filter(a=>a.id!==null&&a.id!==void 0).map(a=>a.id);if(e.length===0)return h;try{const a=await at.getEmployeesByIds(e),r=new Map;return a.forEach(R=>{r.set(R.id,R.name)}),h.map(R=>R.id&&r.has(R.id)?{...R,name:r.get(R.id)}:R)}catch(a){return console.error("[ResponsibleModal] Error enriching names:",a),h}}_e([()=>A.value,()=>g.value],async([h,e])=>{if(!(h!=="employees"||s.value!==0)){if(!e||e.length===0){Q.value=[];return}L.value=!0;try{Q.value=await T(e)}catch(a){console.error("[ResponsibleModal] Error loading employee names:",a),Q.value=e}finally{L.value=!1}}},{immediate:!0}),_e(()=>k.responsible,async h=>{if(!(s.value!==0||w.value||A.value!=="categories")){if(!h||h.length===0){q.value=[];return}L.value=!0;try{q.value=await T(h)}catch(e){console.error("[ResponsibleModal] Error loading employee names:",e),q.value=h}finally{L.value=!1}}},{immediate:!1});const y=I(()=>(q.value||[]).length>0);function n(h){A.value!==h&&(A.value=h,s.value=0,w.value=null,_.value=null,f.value=null,p.value=[],O.value=null,q.value=[],Q.value=[])}async function E(h){if(!h||h.count===0){console.warn("[ResponsibleModal] handleCategoryClick: Invalid category or count is 0",{category:h,count:h?.count});return}console.log("[ResponsibleModal] handleCategoryClick called:",{categoryId:h.id,categoryLabel:h.label,categoryCount:h.count,responsibleCount:h.responsible?.length||0,responsibleWithTickets:h.responsible?.filter(e=>e.tickets&&e.tickets.length>0).length||0,responsibleSample:h.responsible?.slice(0,2).map(e=>({id:e.id,name:e.name,count:e.count,hasTickets:!!e.tickets,ticketsCount:e.tickets?.length||0}))}),w.value=h,s.value=1,L.value=!0;try{q.value=await T(h.responsible),console.log("[ResponsibleModal] After enrichResponsibleWithNames:",{enrichedCount:q.value.length,enrichedSample:q.value.slice(0,2).map(e=>({id:e.id,name:e.name,count:e.count,hasTickets:!!e.tickets,ticketsCount:e.tickets?.length||0}))})}catch(e){console.error("[ResponsibleModal] Error loading employee names:",e),q.value=h.responsible}finally{L.value=!1}}async function W(h,e=null){!h||!h.id||h.totalCount===0||(e&&e.currentTarget&&(e.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{e.currentTarget&&(e.currentTarget.style.transform="")},150)),console.log("[ResponsibleModal] Employee selected from list:",{id:h.id,name:h.name,thisWeekCount:h.thisWeekCount,otherWeekCount:h.otherWeekCount,thisWeekTickets:h.thisWeekTickets?.length||0,otherWeekTickets:h.otherWeekTickets?.length||0,employee:h}),_.value={...h,thisWeekTickets:h.thisWeekTickets||[],otherWeekTickets:h.otherWeekTickets||[]},s.value=1)}async function N(h){if(!h||h.count===0)return;f.value=h,s.value=2;const e=h.tickets||[];console.log("[ResponsibleModal] Gradation clicked:",{id:h.id,label:h.label,count:h.count,ticketsInGradation:e.length,selectedEmployee:_.value?.id}),e.length>0?(console.log("[ResponsibleModal] Loading tickets from gradation:",e.length),await $(e)):(console.log("[ResponsibleModal] Tickets not in gradation, loading from API"),await K(h))}async function $(h){M.value=!0,O.value=null;try{try{const{prepareTicketsForDisplay:e}=await Ce(async()=>{const{prepareTicketsForDisplay:a}=await import("./ticketListUtils-CpKfsjsI.js");return{prepareTicketsForDisplay:a}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url);p.value=await e(h,null,null)}catch(e){console.error("[ResponsibleModal] Error preparing tickets:",e),p.value=h}p.value.length===0&&(O.value=null)}catch(e){O.value=e.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets:",e),p.value=[]}finally{M.value=!1}}async function K(h){M.value=!0,O.value=null;try{if(!k.weekStartUtc||!k.weekEndUtc||!_.value)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸ Ð¸Ð»Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº");const e=await Se({product:"1C",weekStartUtc:k.weekStartUtc,weekEndUtc:k.weekEndUtc,includeTickets:!0}),R=(h.id==="this-week"?e.data.responsibleCreatedThisWeek:e.data.responsibleCreatedOtherWeek)?.find(U=>U.id===_.value.id)?.tickets||[];try{const{prepareTicketsForDisplay:U}=await Ce(async()=>{const{prepareTicketsForDisplay:G}=await import("./ticketListUtils-CpKfsjsI.js");return{prepareTicketsForDisplay:G}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url);p.value=await U(R,null,null)}catch(U){console.error("[ResponsibleModal] Error preparing tickets:",U),p.value=R}p.value.length===0&&(O.value=null)}catch(e){O.value=e.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets from API:",e),p.value=[]}finally{M.value=!1}}async function H(h,e=null){!h||!h.id||h.count===0||(e&&e.currentTarget&&(e.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{e.currentTarget&&(e.currentTarget.style.transform="")},150)),_.value=h,s.value=2,await Y(h.id))}async function Y(h){M.value=!0,O.value=null;try{let e=[];if(console.log("[ResponsibleModal] loadEmployeeTickets called:",{employeeId:h,selectedCategory:w.value?.id,hasSelectedCategory:!!w.value,hasResponsible:!!w.value?.responsible,responsibleCount:w.value?.responsible?.length||0,categoryData:w.value?{id:w.value.id,label:w.value.label,count:w.value.count,responsibleSample:w.value.responsible?.slice(0,2).map(a=>({id:a.id,name:a.name,count:a.count,hasTickets:!!a.tickets,ticketsCount:a.tickets?.length||0}))}:null}),w.value&&w.value.responsible){const a=w.value.responsible.find(r=>r.id===h);console.log("[ResponsibleModal] Employee found in category:",{employee:a,hasTickets:!!a?.tickets,ticketsCount:a?.tickets?.length||0,tickets:a?.tickets?a.tickets.slice(0,2):null}),e=a?.tickets||[]}if(e.length===0&&k.weekStartUtc&&k.weekEndUtc){console.log("[ResponsibleModal] Tickets not found in category, loading from API",{weekStartUtc:k.weekStartUtc,weekEndUtc:k.weekEndUtc,categoryId:w.value?.id});const a=await Se({product:"1C",weekStartUtc:k.weekStartUtc,weekEndUtc:k.weekEndUtc,includeTickets:!0});console.log("[ResponsibleModal] API response:",{hasResponsibleCreatedThisWeek:!!a.data.responsibleCreatedThisWeek,hasResponsibleCreatedOtherWeek:!!a.data.responsibleCreatedOtherWeek,thisWeekCount:a.data.responsibleCreatedThisWeek?.length||0,otherWeekCount:a.data.responsibleCreatedOtherWeek?.length||0,thisWeekSample:a.data.responsibleCreatedThisWeek?.slice(0,1).map(U=>({id:U.id,name:U.name,count:U.count,hasTickets:!!U.tickets,ticketsCount:U.tickets?.length||0})),otherWeekSample:a.data.responsibleCreatedOtherWeek?.slice(0,1).map(U=>({id:U.id,name:U.name,count:U.count,hasTickets:!!U.tickets,ticketsCount:U.tickets?.length||0}))});const r=w.value?.id==="created-this-week"?a.data.responsibleCreatedThisWeek:a.data.responsibleCreatedOtherWeek;console.log("[ResponsibleModal] Category data:",{categoryId:w.value?.id,categoryDataCount:r?.length||0,categoryDataSample:r?.slice(0,2).map(U=>({id:U.id,name:U.name,count:U.count,hasTickets:!!U.tickets,ticketsCount:U.tickets?.length||0}))});const R=r?.find(U=>U.id===h);console.log("[ResponsibleModal] Employee found in API response:",{employee:R?{id:R.id,name:R.name,count:R.count,hasTickets:!!R.tickets,ticketsCount:R.tickets?.length||0,ticketsSample:R.tickets?.slice(0,2)}:null}),e=R?.tickets||[]}console.log("[ResponsibleModal] Final employeeTickets before prepareTicketsForDisplay:",{ticketsCount:e.length,ticketsSample:e.slice(0,2).map(a=>({id:a.id,title:a.title||a.ufSubject||"No title",stageId:a.stageId}))});try{const{prepareTicketsForDisplay:a}=await Ce(async()=>{const{prepareTicketsForDisplay:r}=await import("./ticketListUtils-CpKfsjsI.js");return{prepareTicketsForDisplay:r}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url);p.value=await a(e,null,null),console.log("[ResponsibleModal] Tickets after prepareTicketsForDisplay:",{ticketsCount:p.value.length,ticketsSample:p.value.slice(0,2).map(r=>({id:r.id,title:r.title||r.ufSubject||"No title",stageId:r.stageId}))})}catch(a){console.error("[ResponsibleModal] Error preparing tickets:",a),console.error("[ResponsibleModal] prepareError details:",{message:a.message,stack:a.stack,employeeTicketsCount:e.length}),p.value=e,console.log("[ResponsibleModal] Using fallback tickets (without enrichment):",p.value.length)}p.value.length===0?(console.warn("[ResponsibleModal] No tickets after loading and preparation",{employeeId:h,categoryId:w.value?.id,employeeTicketsCount:e.length,finalTicketsCount:p.value.length}),O.value=null):console.log("[ResponsibleModal] Successfully loaded tickets:",p.value.length)}catch(e){O.value=e.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets:",e),console.error("[ResponsibleModal] Error details:",{message:e.message,stack:e.stack,employeeId:h,categoryId:w.value?.id}),p.value=[]}finally{M.value=!1}}function V(){s.value===2?(s.value=1,A.value==="categories"?_.value=null:f.value=null,p.value=[],O.value=null):s.value===1&&(s.value=0,A.value==="categories"?(w.value=null,q.value=[]):_.value=null)}function Z(h){console.log(`[ResponsibleModal] Sort mode changed: ${P.value} -> ${h}`);const e=performance.now();P.value=h,setTimeout(()=>{const a=i.value,r=performance.now();console.log(`[ResponsibleModal] Filtering completed in ${(r-e).toFixed(2)}ms, ${a.length} tickets shown`)},0)}function ue(h){const e=He(h.id);window.open(e,"_blank")}function ge(){A.value==="employees"&&f.value?$(f.value.tickets):A.value==="categories"&&_.value&&Y(_.value.id)}return _e(()=>k.isVisible,h=>{if(h){console.log("[TASK-070] ResponsibleModal opened for week",k.weekNumber),console.log("[TASK-070] ResponsibleModal props types:",{responsibleCreatedThisWeekType:typeof k.responsibleCreatedThisWeek,responsibleCreatedThisWeekIsArray:Array.isArray(k.responsibleCreatedThisWeek),responsibleCreatedThisWeekLength:Array.isArray(k.responsibleCreatedThisWeek)?k.responsibleCreatedThisWeek.length:"not array",responsibleCreatedOtherWeekType:typeof k.responsibleCreatedOtherWeek,responsibleCreatedOtherWeekIsArray:Array.isArray(k.responsibleCreatedOtherWeek),responsibleCreatedOtherWeekLength:Array.isArray(k.responsibleCreatedOtherWeek)?k.responsibleCreatedOtherWeek.length:"not array"}),console.log("[TASK-070] ResponsibleModal data:",{weekStartUtc:k.weekStartUtc,weekEndUtc:k.weekEndUtc,responsibleCreatedThisWeek:Array.isArray(k.responsibleCreatedThisWeek)?k.responsibleCreatedThisWeek.length:k.responsibleCreatedThisWeek?"not array":"null/undefined",responsibleCreatedOtherWeek:Array.isArray(k.responsibleCreatedOtherWeek)?k.responsibleCreatedOtherWeek.length:k.responsibleCreatedOtherWeek?"not array":"null/undefined",closedTicketsCreatedThisWeek:k.closedTicketsCreatedThisWeek,closedTicketsCreatedOtherWeek:k.closedTicketsCreatedOtherWeek}),console.log("[TASK-070] ResponsibleModal detailed data:",{responsibleCreatedThisWeek:k.responsibleCreatedThisWeek,responsibleCreatedOtherWeek:k.responsibleCreatedOtherWeek,responsibleCreatedThisWeekWithTickets:Array.isArray(k.responsibleCreatedThisWeek)?k.responsibleCreatedThisWeek.map(a=>({id:a.id,name:a.name,count:a.count,hasTickets:!!a.tickets,ticketsCount:a.tickets?.length||0})):"not array or null",responsibleCreatedOtherWeekWithTickets:Array.isArray(k.responsibleCreatedOtherWeek)?k.responsibleCreatedOtherWeek.map(a=>({id:a.id,name:a.name,count:a.count,hasTickets:!!a.tickets,ticketsCount:a.tickets?.length||0})):"not array or null"});const e=k.weekNumber;e&&console.log("[TASK-070] ResponsibleModal: Week number",e)}else s.value=0,A.value="categories",w.value=null,_.value=null,f.value=null,p.value=[],O.value=null,q.value=[],Q.value=[]}),(h,e)=>S.isVisible?(o(),l("div",so,[t("div",ro,[s.value===0?(o(),l("div",oo,[t("button",{class:re(["modal__tab",{"modal__tab--active":A.value==="categories"}]),onClick:e[0]||(e[0]=a=>n("categories"))}," ÐŸÐ¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼ ",2),t("button",{class:re(["modal__tab",{"modal__tab--active":A.value==="employees"}]),onClick:e[1]||(e[1]=a=>n("employees"))}," ÐŸÐ¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼ ",2)])):j("",!0),J(he,{name:"level",mode:"out-in"},{default:ne(()=>[A.value==="categories"&&s.value===0?(o(),l("div",no,[t("header",lo,[t("h3",io,[e[12]||(e[12]=ve(" Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),S.weekNumber?(o(),l("span",co," Â· ÐÐµÐ´ÐµÐ»Ñ "+d(S.weekNumber),1)):j("",!0)]),t("button",{class:"modal__close",onClick:e[2]||(e[2]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",uo,[t("ul",ko,[(o(!0),l(te,null,ae(D.value,a=>(o(),l("li",{key:a.id,class:re(["categories-list__item",{"categories-list__item--clickable":a.count>0}]),onClick:r=>E(a)},[t("div",ho,[t("div",mo,[a.id==="created-this-week"?(o(),l("span",yo,"âœ“")):(o(),l("span",po,"â†»"))]),t("div",go,[t("div",bo,d(a.label),1),t("div",fo,d(a.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1)]),a.count>0?(o(),l("span",_o,"â†’")):j("",!0)])],10,vo))),128))])]),t("footer",wo,[t("button",{class:"btn",onClick:e[3]||(e[3]=a=>h.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):A.value==="categories"&&s.value===1?(o(),l("div",Co,[t("header",To,[t("button",{class:"btn-back",onClick:V,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),e[13]||(e[13]=t("h3",{class:"modal__title"},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),t("button",{class:"modal__close",onClick:e[4]||(e[4]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Wo,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[L.value?(o(),l("div",$o,[...e[14]||(e[14]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð¼Ñ‘Ð½ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²...",-1)])])):y.value?(o(),l("ul",Do,[(o(!0),l(te,null,ae(q.value,a=>(o(),l("li",{key:a.id||a.name,class:re(["responsible-list__item",{"responsible-list__item--clickable":a.id&&a.count>0}]),onClick:r=>H(a,r),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°"},[t("span",No,d(a.name||"ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½"),1),t("span",Eo,d(a.count??0)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),a.id&&a.count>0?(o(),l("span",Oo,"â†’")):j("",!0)],10,So))),128))])):(o(),l("p",Ao,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¼"))]),_:1})]),t("footer",Bo,[t("button",{class:"btn",onClick:e[5]||(e[5]=a=>h.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):A.value==="categories"&&s.value===2?(o(),l("div",Mo,[t("header",Uo,[t("button",{class:"btn-back",onClick:V,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),t("h3",Ro,"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+d(_.value?.name||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),t("button",{class:"modal__close",onClick:e[6]||(e[6]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Po,[t("div",Io,[e[15]||(e[15]=t("h4",{class:"time-sort-title"},"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹:",-1)),t("div",Lo,[(o(!0),l(te,null,ae(C.value,a=>(o(),l("button",{key:a.key,class:re(["time-sort-btn",{active:P.value===a.key}]),onClick:r=>Z(a.key)},[ve(d(a.label)+" ",1),t("span",Ho,"("+d(a.count)+")",1)],10,Fo))),128))])]),J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[M.value?(o(),l("div",Go,[...e[16]||(e[16]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):O.value?(o(),l("div",Ko,[e[17]||(e[17]=t("div",{class:"error-icon"},"âš ï¸",-1)),e[18]||(e[18]=t("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),t("p",Vo,d(O.value),1),t("button",{class:"btn btn-retry",onClick:ge},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):i.value.length===0?(o(),l("div",xo,[e[19]||(e[19]=t("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),t("p",jo," Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´ ("+d(De(Ae)[P.value])+") ",1)])):(o(),l("div",zo,[J(Ue,{name:"ticket",tag:"div",class:"tickets-list"},{default:ne(()=>[(o(!0),l(te,null,ae(i.value,(a,r)=>(o(),me(Re,{key:a.id,ticket:a,draggable:!1,style:we({"--ticket-index":r}),onClick:ue},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):A.value==="employees"&&s.value===0?(o(),l("div",Yo,[t("header",Zo,[t("h3",qo,[e[20]||(e[20]=ve(" Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),S.weekNumber?(o(),l("span",Qo," Â· ÐÐµÐ´ÐµÐ»Ñ "+d(S.weekNumber),1)):j("",!0)]),t("button",{class:"modal__close",onClick:e[7]||(e[7]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Jo,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[L.value?(o(),l("div",Xo,[...e[21]||(e[21]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð¼Ñ‘Ð½ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²...",-1)])])):v.value?(o(),l("ul",tn,[(o(!0),l(te,null,ae(Q.value,a=>(o(),l("li",{key:a.id||a.name,class:re(["responsible-list__item",{"responsible-list__item--clickable":a.id&&a.totalCount>0}]),onClick:r=>W(a,r),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð³Ñ€Ð°Ð´Ð°Ñ†Ð¸Ð¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°"},[t("span",sn,d(a.name||"ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½"),1),t("span",rn,d(a.totalCount??0)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),a.id&&a.totalCount>0?(o(),l("span",on,"â†’")):j("",!0)],10,an))),128))])):(o(),l("p",en,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°Ð¼"))]),_:1})]),t("footer",nn,[t("button",{class:"btn",onClick:e[8]||(e[8]=a=>h.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):A.value==="employees"&&s.value===1?(o(),l("div",ln,[t("header",cn,[t("button",{class:"btn-back",onClick:V,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),t("h3",dn,"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+d(_.value?.name||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),t("button",{class:"modal__close",onClick:e[9]||(e[9]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",un,[t("ul",kn,[(o(!0),l(te,null,ae(u.value,a=>(o(),l("li",{key:a.id,class:re(["categories-list__item",{"categories-list__item--clickable":a.count>0}]),onClick:r=>N(a)},[t("div",hn,[t("div",mn,[a.id==="this-week"?(o(),l("span",yn,"âœ“")):(o(),l("span",pn,"â†»"))]),t("div",gn,[t("div",bn,d(a.label),1),t("div",fn,d(a.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",1)]),a.count>0?(o(),l("span",_n,"â†’")):j("",!0)])],10,vn))),128))])]),t("footer",wn,[t("button",{class:"btn",onClick:e[10]||(e[10]=a=>h.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):A.value==="employees"&&s.value===2?(o(),l("div",Cn,[t("header",Tn,[t("button",{class:"btn-back",onClick:V,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),t("h3",Wn," Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+d(_.value?.name||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾")+" ("+d(f.value?.label||"")+") ",1),t("button",{class:"modal__close",onClick:e[11]||(e[11]=a=>h.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",$n,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[M.value?(o(),l("div",An,[...e[22]||(e[22]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):O.value?(o(),l("div",Dn,[e[23]||(e[23]=t("div",{class:"error-icon"},"âš ï¸",-1)),e[24]||(e[24]=t("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),t("p",Sn,d(O.value),1),t("button",{class:"btn btn-retry",onClick:ge},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):p.value.length===0?(o(),l("div",Nn,[e[25]||(e[25]=t("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),t("p",En,d(A.value==="employees"?`Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ "${f.value?.label||""}"`:"Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ"),1)])):(o(),l("div",On,[J(Ue,{name:"ticket",tag:"div",class:"tickets-list"},{default:ne(()=>[(o(!0),l(te,null,ae(i.value,(a,r)=>(o(),me(Re,{key:a.id,ticket:a,draggable:!1,style:we({"--ticket-index":r}),onClick:ue},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):j("",!0)]),_:1})])])):j("",!0)}},Mn=fe(Bn,[["__scopeId","data-v-6f43202a"]]),Un={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Rn={class:"modal"},Pn={key:"level-1",class:"level-1"},In={class:"modal__header"},Ln={class:"modal__title"},Fn={key:0},Hn={class:"modal__body"},Gn={key:"loading",class:"loading-names"},Kn={key:"empty",class:"modal__empty"},Vn={key:"list",class:"stages-list"},xn=["onClick"],jn={class:"stages-list__name"},zn={class:"stages-list__count"},Yn={key:0,class:"stages-list__arrow"},Zn={class:"modal__footer"},qn={key:"level-2",class:"level-2"},Qn={class:"modal__header"},Jn={class:"modal__title"},Xn={class:"modal__body"},el={class:"time-sort-controls"},tl={class:"time-sort-buttons"},al=["onClick"],sl={class:"count"},rl={key:"loading",class:"loading-state"},ol={key:"error",class:"error-state"},nl={class:"error-message"},ll={key:"empty",class:"empty-state"},il={class:"empty-state-message"},cl={key:"tickets",class:"tickets-list-container"},dl={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(S,{emit:k}){const s=S,A=F(1),w=F(null),_=F([]),f=F(!1),p=F(!1),M=F(null),O=F([]),q=F(be.ONE_MONTH),Q=I(()=>O.value.length>0&&O.value.some(y=>y.count>0)),L=I(()=>{if(!_.value||_.value.length===0)return[];try{const y=performance.now(),n=Pe(_.value,q.value),E=performance.now();return console.log(`[StagesModal] Filtering took ${(E-y).toFixed(2)}ms, results: ${n.length}`),n}catch(y){return console.error("[StagesModal] Error filtering tickets:",y),[]}}),P=I(()=>Object.keys(Ae).map(y=>({key:y,label:Ae[y],count:Pe(_.value,y).length})));async function D(){if(console.log("[TASK-070] StagesModal: loadStages called",{weekNumber:s.weekNumber,weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc}),!s.weekStartUtc||!s.weekEndUtc){console.warn("[TASK-070] StagesModal: Missing week boundaries, cannot load stages"),O.value=[];return}p.value=!0,M.value=null;try{console.log("[TASK-070] StagesModal: Fetching stages from API...");const y=await Se({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeNewTicketsByStages:!0});console.log("[TASK-070] StagesModal: API response received",{hasNewTicketsByStages:!!y.data.newTicketsByStages,stagesCount:y.data.newTicketsByStages?.length||0}),O.value=y.data.newTicketsByStages||[],O.value.length===0?console.warn("[TASK-070] StagesModal: API returned empty stages array for week",s.weekNumber):console.log("[TASK-070] StagesModal: Stages loaded successfully",O.value.length,"stages")}catch(y){M.value=y.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÑ‚Ð°Ð´Ð¸Ð¹",console.error("[TASK-070] StagesModal: Error loading stages:",y),O.value=[]}finally{p.value=!1}}async function g(y,n=null){!y||y.count===0||(n&&n.currentTarget&&(n.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{n.currentTarget&&(n.currentTarget.style.transform="")},150)),w.value=y,A.value=2,await u(y.stageId))}async function u(y){f.value=!0,M.value=null;try{const n=O.value.find($=>$.stageId===y);if(n&&Array.isArray(n.tickets)&&n.tickets.length>0){console.log("[TASK-070] StagesModal: Using preloaded tickets for stage",y,"count:",n.tickets.length);const $=n.tickets;try{const{prepareTicketsForDisplay:K}=await Ce(async()=>{const{prepareTicketsForDisplay:H}=await import("./ticketListUtils-CpKfsjsI.js");return{prepareTicketsForDisplay:H}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url);_.value=await K($,null,null)}catch(K){console.error("[TASK-070] StagesModal: Error preparing tickets:",K),_.value=$}f.value=!1;return}if(console.log("[TASK-070] StagesModal: Tickets not preloaded, loading from API for stage",y),!s.weekStartUtc||!s.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const N=(await Se({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages?.find($=>$.stageId===y)?.tickets||[];try{const{prepareTicketsForDisplay:$}=await Ce(async()=>{const{prepareTicketsForDisplay:K}=await import("./ticketListUtils-CpKfsjsI.js");return{prepareTicketsForDisplay:K}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url);_.value=await $(N,null,null)}catch($){console.error("[StagesModal] Error preparing tickets:",$),_.value=N}_.value.length===0&&(M.value=null)}catch(n){M.value=n.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[StagesModal] Error loading tickets:",n),_.value=[]}finally{f.value=!1}}function v(){A.value=1,w.value=null,_.value=[],M.value=null}function i(y){const n=He(y.id);window.open(n,"_blank")}function C(){w.value&&u(w.value.stageId)}function T(y){console.log(`[StagesModal] Sort mode changed: ${q.value} -> ${y}`);const n=performance.now();q.value=y,setTimeout(()=>{const E=L.value,W=performance.now();console.log(`[StagesModal] Filtering completed in ${(W-n).toFixed(2)}ms, ${E.length} tickets shown`)},0)}return _e(()=>s.isVisible,async y=>{y?(A.value=1,w.value=null,_.value=[],M.value=null,console.log("[TASK-070] StagesModal opened:",{weekNumber:s.weekNumber,weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,preloadedData:s.preloadedData?Array.isArray(s.preloadedData)?`Array(${s.preloadedData.length})`:typeof s.preloadedData:"null"}),s.preloadedData&&Array.isArray(s.preloadedData)&&s.preloadedData.length>0?(console.log("[TASK-070] StagesModal: Using preloaded data, stages count:",s.preloadedData.length),s.preloadedData.every(E=>E.stageId&&E.stageName&&typeof E.count=="number")?(O.value=s.preloadedData,p.value=!1,console.log("[TASK-070] StagesModal: Preloaded data set, stages:",O.value.length)):(console.warn("[TASK-070] StagesModal: Invalid preloaded data structure, falling back to API"),await D())):(console.log("[TASK-070] StagesModal: No preloaded data, loading from API",{weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc}),await D())):(A.value=1,w.value=null,_.value=[],M.value=null,O.value=[])},{immediate:!1}),_e([()=>s.weekNumber,()=>s.preloadedData],async([y,n])=>{s.isVisible&&y&&(n&&Array.isArray(n)&&n.length>0?n.every(W=>W.stageId&&W.stageName&&typeof W.count=="number")?(console.log("[TASK-070] StagesModal: Week changed, updating with preloaded data for week",y),O.value=n,p.value=!1):(console.log("[TASK-070] StagesModal: Week changed, invalid preloaded data, loading from API for week",y),await D()):(console.log("[TASK-070] StagesModal: Week changed, loading from API for week",y),await D()))}),(y,n)=>S.isVisible?(o(),l("div",Un,[t("div",Rn,[J(he,{name:"level",mode:"out-in"},{default:ne(()=>[A.value===1?(o(),l("div",Pn,[t("header",In,[t("h3",Ln,[n[3]||(n[3]=ve(" ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),S.weekNumber?(o(),l("span",Fn," Â· ÐÐµÐ´ÐµÐ»Ñ "+d(S.weekNumber),1)):j("",!0)]),t("button",{class:"modal__close",onClick:n[0]||(n[0]=E=>y.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Hn,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[p.value?(o(),l("div",Gn,[...n[4]||(n[4]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÑ‚Ð°Ð´Ð¸Ð¹...",-1)])])):Q.value?(o(),l("ul",Vn,[(o(!0),l(te,null,ae(O.value,E=>(o(),l("li",{key:E.stageId,class:re(["stages-list__item",{"stages-list__item--clickable":E.count>0}]),style:we({"--stage-color":E.color}),onClick:W=>g(E,W),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÑ‚Ð°Ð´Ð¸Ð¸"},[t("span",{class:"stages-list__color",style:we({backgroundColor:E.color})},null,4),t("span",jn,d(E.stageName),1),t("span",zn,d(E.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),E.count>0?(o(),l("span",Yn,"â†’")):j("",!0)],14,xn))),128))])):(o(),l("p",Kn," ÐÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),t("footer",Zn,[t("button",{class:"btn",onClick:n[1]||(n[1]=E=>y.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):A.value===2?(o(),l("div",qn,[t("header",Qn,[t("button",{class:"btn-back",onClick:v,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),t("h3",Jn," Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÑ‚Ð°Ð´Ð¸Ð¸: "+d(w.value?.stageName||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),t("button",{class:"modal__close",onClick:n[2]||(n[2]=E=>y.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Xn,[t("div",el,[n[5]||(n[5]=t("h4",{class:"time-sort-title"},"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹:",-1)),t("div",tl,[(o(!0),l(te,null,ae(P.value,E=>(o(),l("button",{key:E.key,class:re(["time-sort-btn",{active:q.value===E.key}]),onClick:W=>T(E.key)},[ve(d(E.label)+" ",1),t("span",sl,"("+d(E.count)+")",1)],10,al))),128))])]),J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[f.value?(o(),l("div",rl,[...n[6]||(n[6]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÑ‚Ð°Ð´Ð¸Ð¸...",-1),t("p",{class:"loading-subtitle"},"Ð­Ñ‚Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐµÐºÑƒÐ½Ð´ Ð´Ð»Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ñ… Ð¾Ð±ÑŠÐµÐ¼Ð¾Ð² Ð´Ð°Ð½Ð½Ñ‹Ñ…",-1)])])):M.value?(o(),l("div",ol,[n[7]||(n[7]=t("div",{class:"error-icon"},"âš ï¸",-1)),n[8]||(n[8]=t("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),t("p",nl,d(M.value),1),t("button",{class:"btn btn-retry",onClick:C},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):L.value.length===0?(o(),l("div",ll,[n[9]||(n[9]=t("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),t("p",il," ÐÐ° ÑÑ‚Ð°Ð´Ð¸Ð¸ Â«"+d(w.value?.stageName)+"Â» Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´ ("+d(De(Ae)[q.value])+") ",1)])):(o(),l("div",cl,[J(Ue,{name:"ticket",tag:"div",class:"tickets-list"},{default:ne(()=>[(o(!0),l(te,null,ae(L.value,(E,W)=>(o(),me(Re,{key:E.id,ticket:E,draggable:!1,style:we({"--ticket-index":W}),onClick:i},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):j("",!0)]),_:1})])])):j("",!0)}},ul=fe(dl,[["__scopeId","data-v-0dacaef9"]]),$e=new Map,kl=5*60*1e3;function vl(S,k){return`${S}:${JSON.stringify(k)}`}function Ve(S){return Date.now()-S.timestamp<kl}function hl(S,k){if($e.set(S,{data:k,timestamp:Date.now()}),$e.size>20){const s=$e.keys().next().value;$e.delete(s)}}function ml(S){const k=$e.get(S);return k&&Ve(k)?(console.log("[API-CACHE] Cache hit for key:",S),k.data):(k&&!Ve(k)&&(console.log("[API-CACHE] Cache expired for key:",S),$e.delete(S)),null)}async function yl(S={}){const k="/api/graph-1c-admission-closure.php",s=vl(k,S),A=ml(k);if(A)return A;console.log("[API-CACHE] Cache miss, making API request for:",s);const{LazyServiceLoader:w}=await Ce(async()=>{const{LazyServiceLoader:p}=await import("./chunk-BTnG7_Rn.js").then(M=>M.p);return{LazyServiceLoader:p}},__vite__mapDeps([3,2,1,7,8,5,10,4,6,9]),import.meta.url),{fetchAdmissionClosureStats:_}=await w.loadAdmissionClosureService(),f=await _(S);return hl(s,f),f}async function pl(S,k){return yl({product:"1C",weekStartUtc:S,weekEndUtc:k,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})}const gl={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},bl={class:"modal"},fl={key:"level-1",class:"level-1"},_l={class:"modal__header"},wl={class:"modal__title"},Cl={key:0},Tl={class:"modal__body"},Wl={key:"loading",class:"loading-names"},$l={key:"empty",class:"modal__empty"},Al={key:"list",class:"duration-list"},Dl=["onClick"],Sl={class:"duration-list__name"},Nl={class:"duration-list__count"},El={key:0,class:"duration-list__arrow"},Ol={class:"modal__footer"},Bl={key:"level-2",class:"level-2"},Ml={class:"modal__header"},Ul={class:"modal__title"},Rl={class:"modal__body"},Pl={key:"loading",class:"loading-state"},Il={key:"error",class:"error-state"},Ll={class:"error-message"},Fl={key:"empty",class:"empty-state"},Hl={class:"empty-state-message"},Gl={key:"tickets",class:"tickets-list-container"},Kl={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekNumber:{type:Number,default:null},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null},preloadedData:{type:Array,default:null}},emits:["close"],setup(S,{emit:k}){const s=S,A=F(1),w=F(null),_=F([]),f=F(!1),p=F(!1),M=F(null),O=F([]),q=I(()=>O.value.length>0&&O.value.some(v=>v.count>0));async function Q(){if(!s.weekStartUtc||!s.weekEndUtc){O.value=[];return}p.value=!0,M.value=null;try{const v=await Se({product:"1C",weekStartUtc:s.weekStartUtc,weekEndUtc:s.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});O.value=v.data.carryoverTicketsByDuration||[]}catch(v){M.value=v.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹",console.error("[CarryoverDurationModal] Error loading categories:",v),O.value=[]}finally{p.value=!1}}async function L(v,i=null){!v||v.count===0||(i&&i.currentTarget&&(i.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{i.currentTarget&&(i.currentTarget.style.transform="")},150)),w.value=v,A.value=2,await P(v.durationCategory))}async function P(v){f.value=!0,M.value=null;try{const i=O.value.find(n=>n.durationCategory===v);if(i&&Array.isArray(i.tickets)&&i.tickets.length>0){console.log("[TASK-070] CarryoverDurationModal: Using preloaded tickets for category",v,"count:",i.tickets.length);const n=i.tickets;try{const{prepareTicketsForDisplay:E}=await Ce(async()=>{const{prepareTicketsForDisplay:W}=await import("./ticketListUtils-CpKfsjsI.js");return{prepareTicketsForDisplay:W}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url);_.value=await E(n,null,null)}catch(E){console.error("[TASK-070] CarryoverDurationModal: Error preparing tickets:",E),_.value=n}f.value=!1;return}if(console.log("[TASK-070] CarryoverDurationModal: Tickets not preloaded, loading from API for category",v),!s.weekStartUtc||!s.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const y=(await pl(s.weekStartUtc,s.weekEndUtc)).data.carryoverTicketsByDuration?.find(n=>n.durationCategory===v)?.tickets||[];try{const{prepareTicketsForDisplay:n}=await Ce(async()=>{const{prepareTicketsForDisplay:E}=await import("./ticketListUtils-CpKfsjsI.js");return{prepareTicketsForDisplay:E}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url);_.value=await n(y,null,null)}catch(n){console.error("[CarryoverDurationModal] Error preparing tickets:",n),_.value=y}_.value.length===0&&(M.value=null)}catch(i){M.value=i.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[CarryoverDurationModal] Error loading tickets:",i),_.value=[]}finally{f.value=!1}}function D(){A.value=1,w.value=null,_.value=[],M.value=null}function g(v){const i=He(v.id);window.open(i,"_blank")}function u(){w.value&&P(w.value.durationCategory)}return _e(()=>s.isVisible,async v=>{v?(A.value=1,w.value=null,_.value=[],M.value=null,s.preloadedData&&Array.isArray(s.preloadedData)&&s.preloadedData.length>0?(console.log("[TASK-070] CarryoverDurationModal: Using preloaded data, categories count:",s.preloadedData.length),s.preloadedData.every(C=>C.durationCategory&&C.durationLabel&&typeof C.count=="number")?(O.value=s.preloadedData,p.value=!1):(console.warn("[TASK-070] CarryoverDurationModal: Invalid preloaded data structure, falling back to API"),await Q())):(console.log("[TASK-070] CarryoverDurationModal: No preloaded data, loading from API"),await Q())):(A.value=1,w.value=null,_.value=[],M.value=null,O.value=[])},{immediate:!1}),_e([()=>s.weekNumber,()=>s.preloadedData],async([v,i])=>{s.isVisible&&v&&(i&&Array.isArray(i)&&i.length>0?i.every(T=>T.durationCategory&&T.durationLabel&&typeof T.count=="number")?(console.log("[TASK-070] CarryoverDurationModal: Week changed, updating with preloaded data for week",v),O.value=i,p.value=!1):(console.log("[TASK-070] CarryoverDurationModal: Week changed, invalid preloaded data, loading from API for week",v),await Q()):(console.log("[TASK-070] CarryoverDurationModal: Week changed, loading from API for week",v),await Q()))}),(v,i)=>S.isVisible?(o(),l("div",gl,[t("div",bl,[J(he,{name:"level",mode:"out-in"},{default:ne(()=>[A.value===1?(o(),l("div",fl,[t("header",_l,[t("h3",wl,[i[3]||(i[3]=ve(" ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ€Ð¾ÐºÐ°Ð¼",-1)),S.weekNumber?(o(),l("span",Cl," Â· ÐÐµÐ´ÐµÐ»Ñ "+d(S.weekNumber),1)):j("",!0)]),t("button",{class:"modal__close",onClick:i[0]||(i[0]=C=>v.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Tl,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[p.value?(o(),l("div",Wl,[...i[4]||(i[4]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹...",-1)])])):q.value?(o(),l("ul",Al,[(o(!0),l(te,null,ae(O.value,C=>(o(),l("li",{key:C.durationCategory,class:re(["duration-list__item",{"duration-list__item--clickable":C.count>0}]),style:we({"--duration-color":C.color}),onClick:T=>L(C,T),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"},[t("span",{class:"duration-list__color",style:we({backgroundColor:C.color})},null,4),t("span",Sl,d(C.durationLabel),1),t("span",Nl,d(C.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),C.count>0?(o(),l("span",El,"â†’")):j("",!0)],14,Dl))),128))])):(o(),l("p",$l," ÐÐµÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),t("footer",Ol,[t("button",{class:"btn",onClick:i[1]||(i[1]=C=>v.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):A.value===2?(o(),l("div",Bl,[t("header",Ml,[t("button",{class:"btn-back",onClick:D,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),t("h3",Ul," Ð¢Ð¸ÐºÐµÑ‚Ñ‹: "+d(w.value?.durationLabel||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),t("button",{class:"modal__close",onClick:i[2]||(i[2]=C=>v.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),t("section",Rl,[J(he,{name:"loading",mode:"out-in"},{default:ne(()=>[f.value?(o(),l("div",Pl,[...i[5]||(i[5]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸...",-1),t("p",{class:"loading-subtitle"},"Ð­Ñ‚Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐµÐºÑƒÐ½Ð´ Ð´Ð»Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ñ… Ð¾Ð±ÑŠÐµÐ¼Ð¾Ð² Ð´Ð°Ð½Ð½Ñ‹Ñ…",-1)])])):M.value?(o(),l("div",Il,[i[6]||(i[6]=t("div",{class:"error-icon"},"âš ï¸",-1)),i[7]||(i[7]=t("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),t("p",Ll,d(M.value),1),t("button",{class:"btn btn-retry",onClick:u},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):_.value.length===0?(o(),l("div",Fl,[i[8]||(i[8]=t("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),t("p",Hl," Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Â«"+d(w.value?.durationLabel)+"Â» Ð½ÐµÑ‚ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1)])):(o(),l("div",Gl,[J(Ue,{name:"ticket",tag:"div",class:"tickets-list"},{default:ne(()=>[(o(!0),l(te,null,ae(_.value,(C,T)=>(o(),me(Re,{key:C.id,ticket:C,draggable:!1,style:we({"--ticket-index":T}),onClick:g},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):j("",!0)]),_:1})])])):j("",!0)}},Vl=fe(Kl,[["__scopeId","data-v-f199806c"]]),xl={class:"ac-dashboard"},jl={key:"preloader",class:"chart-preloader"},zl={class:"preloader-content"},Yl={class:"preloader-message"},Zl={key:"content"},ql={key:1,class:"weeks-dashboard"},Ql={class:"dashboard-header"},Jl={class:"header-content"},Xl={class:"breadcrumbs-row"},ei=["aria-label","aria-disabled","data-fallback","disabled"],ti={class:"breadcrumbs","aria-label":"ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ"},ai={class:"dashboard-layout"},si={class:"filters-container"},ri={class:"chart-container"},oi={__name:"GraphAdmissionClosureDashboard",setup(S){const k=ze(),{fetchStats:s}=st(),A=async b=>await s(b),w=F(!1),_=F(null),f=F(null),p=F({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),M=F(!1),O=F(!1),q=F(!1),Q=F(!0),L=F(null),P=F({weeks:new Map,currentWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null},previousWeek:{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null}}),D=I(()=>{const b=f.value?.weeks||[];return b.length>=2?b[b.length-2]:null}),g=F(!1),u=I(()=>typeof window>"u"?!1:window.history.length>1),v=I(()=>u.value?"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ":"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"),i={name:"dashboard-sector-1c"};function C(b){if(b?.preventDefault?.(),!g.value){g.value=!0;try{if(u.value){k.back();return}console.warn("GraphAdmissionClosureDashboard: fallback navigation to dashboard-sector-1c"),k.push(i)}finally{g.value=!1}}}function T(){k.push("/")}const y=F({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),n=F("weeks"),E=I(()=>{const b=y.value.customDateRange.startDate||y.value.customDateRange.endDate,m=y.value.employees.length===1&&y.value.employees.includes("all");return b||!m});async function W(){if(console.log("[DEBUG] loadData called"),console.log("[DEBUG] periodMode:",n.value),console.log("[DEBUG] isLoading before:",w.value),n.value!=="weeks"){console.log("[DEBUG] loadData: periodMode is not weeks, returning and resetting isLoading"),w.value=!1;return}console.log("[DEBUG] Setting isLoading to true"),w.value=!0,_.value=null;const b=new Promise(m=>setTimeout(m,300));try{console.log("[DEBUG] Starting API call");const m=Ie(),X=m.weekStartUtc,ee=m.weekEndUtc;console.log("[DEBUG] Week bounds:",{weekStartUtc:X,weekEndUtc:ee});const[de,se]=await Promise.all([b,A({product:"1C",periodMode:"weeks",weekStartUtc:X,weekEndUtc:ee,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0})]);console.log("[DEBUG] API call successful, result:",se);const{meta:B,data:z,carryoverDebug:pe}=se;f.value=B;const Be=Array.isArray(z.responsibleCreatedThisWeek)?z.responsibleCreatedThisWeek:z.responsibleCreatedThisWeek?Object.values(z.responsibleCreatedThisWeek):[],Me=Array.isArray(z.responsibleCreatedOtherWeek)?z.responsibleCreatedOtherWeek:z.responsibleCreatedOtherWeek?Object.values(z.responsibleCreatedOtherWeek):[];p.value={...z,responsibleCreatedThisWeek:Be,responsibleCreatedOtherWeek:Me},console.log("[DEBUG] Data set, meta:",B,"data keys:",Object.keys(z)),console.log("[TASK-070] chartData.value.responsibleCreatedThisWeek after normalization:",{isArray:Array.isArray(Be),length:Be.length,sample:Be.slice(0,2).map(x=>({id:x.id,name:x.name,count:x.count,hasTickets:!!x.tickets,ticketsCount:x.tickets?.length||0}))}),console.log("[TASK-070] chartData.value.responsibleCreatedOtherWeek after normalization:",{isArray:Array.isArray(Me),length:Me.length,sample:Me.slice(0,2).map(x=>({id:x.id,name:x.name,count:x.count,hasTickets:!!x.tickets,ticketsCount:x.tickets?.length||0}))}),console.log("[TASK-070] responsibleCreatedThisWeek from API:",{count:z.responsibleCreatedThisWeek?.length||0,data:z.responsibleCreatedThisWeek,details:z.responsibleCreatedThisWeek?.map(x=>({id:x.id,name:x.name,count:x.count,hasTickets:!!x.tickets,ticketsCount:x.tickets?.length||0}))}),console.log("[TASK-070] responsibleCreatedOtherWeek from API:",{count:z.responsibleCreatedOtherWeek?.length||0,data:z.responsibleCreatedOtherWeek,details:z.responsibleCreatedOtherWeek?.map(x=>({id:x.id,name:x.name,count:x.count,hasTickets:!!x.tickets,ticketsCount:x.tickets?.length||0}))}),console.log("[TASK-070] closedTicketsCreatedThisWeek:",z.closedTicketsCreatedThisWeek),console.log("[TASK-070] closedTicketsCreatedOtherWeek:",z.closedTicketsCreatedOtherWeek);const Ee=B?.weeks||[];if(console.log("[PERF-OPTIMIZATION] Preloading popup data for",Ee.length,"weeks"),Ee.forEach((x,ke)=>{P.value.weeks.has(x.weekNumber)||P.value.weeks.set(x.weekNumber,{newTicketsByStages:null,carryoverTicketsByDuration:null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:x});const ie=P.value.weeks.get(x.weekNumber);ke===Ee.length-1&&(z.newTicketsByStages&&(ie.newTicketsByStages=z.newTicketsByStages,console.log("[PERF-OPTIMIZATION] Preloaded newTicketsByStages for week",x.weekNumber,":",z.newTicketsByStages.length,"stages")),z.carryoverTicketsByDuration&&(ie.carryoverTicketsByDuration=z.carryoverTicketsByDuration,console.log("[PERF-OPTIMIZATION] Preloaded carryoverTicketsByDuration for week",x.weekNumber,":",z.carryoverTicketsByDuration.length,"categories")))}),z.newTicketsByStages&&(P.value.currentWeek.newTicketsByStages=z.newTicketsByStages),z.carryoverTicketsByDuration&&(P.value.currentWeek.carryoverTicketsByDuration=z.carryoverTicketsByDuration),Ee.length>1&&K(Ee.slice(0,-1)),z.responsibleCreatedThisWeek){const x=Array.isArray(z.responsibleCreatedThisWeek)?z.responsibleCreatedThisWeek:Object.values(z.responsibleCreatedThisWeek);P.value.currentWeek.responsibleCreatedThisWeek=x,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for current week:",x.length,"employees"),console.log("[TASK-070] responsibleCreatedThisWeek details:",x.map(ke=>({id:ke.id,name:ke.name,count:ke.count,hasTickets:!!ke.tickets,ticketsCount:ke.tickets?.length||0})))}if(z.responsibleCreatedOtherWeek){const x=Array.isArray(z.responsibleCreatedOtherWeek)?z.responsibleCreatedOtherWeek:Object.values(z.responsibleCreatedOtherWeek);P.value.currentWeek.responsibleCreatedOtherWeek=x,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for current week:",x.length,"employees"),console.log("[TASK-070] responsibleCreatedOtherWeek details:",x.map(ke=>({id:ke.id,name:ke.name,count:ke.count,hasTickets:!!ke.tickets,ticketsCount:ke.tickets?.length||0})))}if(pe&&(console.log("[CARRYOVER-DEBUG] ========================================"),console.log("[CARRYOVER-DEBUG] Total:",pe.total),console.log("[CARRYOVER-DEBUG] ThisWeek:",pe.thisWeek),console.log("[CARRYOVER-DEBUG] PreviousWeek:",pe.previousWeek),console.log("[CARRYOVER-DEBUG] Older:",pe.older),console.log("[CARRYOVER-DEBUG] Sum:",pe.sum,"(expected:",pe.total,")"),console.log("[CARRYOVER-DEBUG] Series:",pe.series),console.log("[CARRYOVER-DEBUG] CurrentWeekData:",pe.currentWeekData),console.log("[CARRYOVER-DEBUG] WeeksData:",pe.weeksData),console.log("[CARRYOVER-DEBUG] Full object:",pe),console.log("[CARRYOVER-DEBUG] ========================================")),D.value){const x=D.value.weekStartUtc,ke=D.value.weekEndUtc;console.log("[TASK-070] Starting preload for previous week:",{weekNumber:D.value.weekNumber,weekStartUtc:x,weekEndUtc:ke}),A({product:"1C",periodMode:"weeks",weekStartUtc:x,weekEndUtc:ke,includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0}).then(ie=>{if(console.log("[TASK-070] Preload successful for previous week"),ie.data.newTicketsByStages&&(P.value.previousWeek.newTicketsByStages=ie.data.newTicketsByStages,console.log("[TASK-070] Preloaded newTicketsByStages for previous week:",ie.data.newTicketsByStages.length,"stages")),ie.data.carryoverTicketsByDuration&&(P.value.previousWeek.carryoverTicketsByDuration=ie.data.carryoverTicketsByDuration,console.log("[TASK-070] Preloaded carryoverTicketsByDuration for previous week:",ie.data.carryoverTicketsByDuration.length,"categories")),ie.data.responsibleCreatedThisWeek){const Oe=Array.isArray(ie.data.responsibleCreatedThisWeek)?ie.data.responsibleCreatedThisWeek:Object.values(ie.data.responsibleCreatedThisWeek);P.value.previousWeek.responsibleCreatedThisWeek=Oe,console.log("[TASK-070] Preloaded responsibleCreatedThisWeek for previous week:",Oe.length,"employees")}if(ie.data.responsibleCreatedOtherWeek){const Oe=Array.isArray(ie.data.responsibleCreatedOtherWeek)?ie.data.responsibleCreatedOtherWeek:Object.values(ie.data.responsibleCreatedOtherWeek);P.value.previousWeek.responsibleCreatedOtherWeek=Oe,console.log("[TASK-070] Preloaded responsibleCreatedOtherWeek for previous week:",Oe.length,"employees")}}).catch(ie=>{console.warn("[TASK-070] Failed to preload previous week data (non-critical):",ie)})}}catch(m){console.error("[DEBUG] API call failed:",m),_.value=m instanceof Error?m:new Error("ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸"),console.error("[GraphAdmissionClosureDashboard] loadData error:",m)}finally{console.log("[DEBUG] Finally block: setting isLoading to false"),w.value=!1,console.log("[DEBUG] isLoading after:",w.value)}}function N(b){if(!b||!f.value)return console.log("[TASK-070] getPreloadedStagesData: Missing weekMeta or chartMeta"),null;const m=f.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:f.value.weekNumber,ee=m.length>=2?m[m.length-2].weekNumber:null;console.log("[TASK-070] getPreloadedStagesData:",{requestedWeek:b.weekNumber,currentWeekNumber:X,previousWeekNumber:ee,weeksInMeta:m.length});const de=b.weekNumber===X,se=b.weekNumber===ee;let B=null;if(de)B=P.value.currentWeek.newTicketsByStages,console.log("[TASK-070] Requested week is current week, checking currentWeek data:",B?`Array(${B.length})`:"null");else if(se)B=P.value.previousWeek.newTicketsByStages,console.log("[TASK-070] Requested week is previous week, checking previousWeek data:",B?`Array(${B.length})`:"null");else return console.log("[TASK-070] Requested week",b.weekNumber,"is neither current nor previous, no preloaded data available"),null;return Array.isArray(B)&&B.length>0?(console.log("[TASK-070] Using preloaded stages data for week",b.weekNumber,":",B.length,"stages"),B):(console.log("[TASK-070] No preloaded stages data for week",b.weekNumber,", will use API fallback"),null)}function $(b){if(!b)return null;const m=P.value.weeks.get(b.weekNumber);if(m?.carryoverTicketsByDuration&&Array.isArray(m.carryoverTicketsByDuration))return console.log("[PERF-OPTIMIZATION] Using preloaded carryover data for week",b.weekNumber,":",m.carryoverTicketsByDuration.length,"categories"),m.carryoverTicketsByDuration;const X=f.value?.weeks||[],ee=X.length>0?X[X.length-1].weekNumber:f.value.weekNumber,se=b.weekNumber===ee?P.value.currentWeek.carryoverTicketsByDuration:P.value.previousWeek.carryoverTicketsByDuration;return Array.isArray(se)&&se.length>0?(console.log("[TASK-070] Using fallback preloaded carryover data for week",b.weekNumber,":",se.length,"categories"),se):(console.log("[PERF-ISSUE] No preloaded carryover data for week",b.weekNumber,", will use slow API fallback"),null)}async function K(b){if(!(!b||b.length===0)){console.log("[PERF-OPTIMIZATION] Starting background preload for",b.length,"weeks");for(const m of b)try{await new Promise(de=>setTimeout(de,500)),console.log("[PERF-OPTIMIZATION] Preloading data for week",m.weekNumber);const X=await A({product:"1C",periodMode:"weeks",weekStartUtc:m.weekStartUtc,weekEndUtc:m.weekEndUtc,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!1}),ee={newTicketsByStages:X.data.newTicketsByStages||null,carryoverTicketsByDuration:X.data.carryoverTicketsByDuration||null,responsibleCreatedThisWeek:null,responsibleCreatedOtherWeek:null,weekMeta:m};P.value.weeks.set(m.weekNumber,ee),console.log("[PERF-OPTIMIZATION] Successfully preloaded data for week",m.weekNumber)}catch(X){console.warn("[PERF-OPTIMIZATION] Failed to preload data for week",m.weekNumber,":",X)}console.log("[PERF-OPTIMIZATION] Background preload completed")}}function H(b){if(!b||!f.value)return null;const m=f.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:f.value.weekNumber;return b.weekNumber===X&&p.value.responsible||null}function Y(b){if(!b){const B=p.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: weekMeta is null, using chartData:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:B?Object.keys(B).length:0}),B?Array.isArray(B)?B:Object.values(B):null}if(!f.value)return console.log("[TASK-070] getResponsibleCreatedThisWeek: chartMeta is null"),null;const m=f.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:f.value.weekNumber,ee=m.length>=2?m[m.length-2].weekNumber:null,de=b.weekNumber===X,se=b.weekNumber===ee;if(console.log("[TASK-070] getResponsibleCreatedThisWeek:",{requestedWeek:b.weekNumber,currentWeekNumber:X,previousWeekNumber:ee,isCurrentWeek:de,isPreviousWeek:se}),de){const B=p.value.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: current week data:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:B?Object.keys(B).length:0}),B?Array.isArray(B)?B:Object.values(B):null}if(se){const B=P.value.previousWeek.responsibleCreatedThisWeek;return console.log("[TASK-070] getResponsibleCreatedThisWeek: previous week data:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:0,data:B}),B||null}return console.log("[TASK-070] getResponsibleCreatedThisWeek: week",b.weekNumber,"is neither current nor previous, no preloaded data"),null}function V(b){if(!b){const B=p.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: weekMeta is null, using chartData:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:B?Object.keys(B).length:0}),B?Array.isArray(B)?B:Object.values(B):null}if(!f.value)return console.log("[TASK-070] getResponsibleCreatedOtherWeek: chartMeta is null"),null;const m=f.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:f.value.weekNumber,ee=m.length>=2?m[m.length-2].weekNumber:null,de=b.weekNumber===X,se=b.weekNumber===ee;if(console.log("[TASK-070] getResponsibleCreatedOtherWeek:",{requestedWeek:b.weekNumber,currentWeekNumber:X,previousWeekNumber:ee,isCurrentWeek:de,isPreviousWeek:se}),de){const B=p.value.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: current week data:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:B?Object.keys(B).length:0}),B?Array.isArray(B)?B:Object.values(B):null}if(se){const B=P.value.previousWeek.responsibleCreatedOtherWeek;return console.log("[TASK-070] getResponsibleCreatedOtherWeek: previous week data:",{hasData:!!B,isArray:Array.isArray(B),dataLength:Array.isArray(B)?B.length:0,data:B}),B||null}return console.log("[TASK-070] getResponsibleCreatedOtherWeek: week",b.weekNumber,"is neither current nor previous, no preloaded data"),null}function Z(b){if(!b||!f.value)return null;const m=f.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:f.value.weekNumber,ee=m.length>=2?m[m.length-2].weekNumber:null,de=b.weekNumber===X,se=b.weekNumber===ee;return de?p.value.closedTicketsCreatedThisWeek??null:se&&p.value.weeksData?p.value.weeksData.find(z=>z.weekNumber===ee)?.closedTicketsCreatedThisWeek??null:null}function ue(b){if(!b||!f.value)return null;const m=f.value?.weeks||[],X=m.length>0?m[m.length-1].weekNumber:f.value.weekNumber,ee=m.length>=2?m[m.length-2].weekNumber:null,de=b.weekNumber===X,se=b.weekNumber===ee;return de?p.value.closedTicketsCreatedOtherWeek??null:se&&p.value.weeksData?p.value.weeksData.find(z=>z.weekNumber===ee)?.closedTicketsCreatedOtherWeek??null:null}function ge(b){y.value.stages=b}function h(b){y.value.employees=b}function e(b){y.value.dateRange=b}function a(b){y.value.customDateRange=b}function r(b){if(!["weeks","months"].includes(b)){console.warn("[GraphAdmissionClosureDashboard] Invalid periodMode:",b);return}b!==n.value&&(n.value=b,b==="weeks"?W():b==="months"&&(w.value=!1))}function R(b){const{mode:m}=b.detail;["weeks","months"].includes(m)&&r(m)}function U(){y.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},G()}function G(){n.value==="weeks"&&W()}function oe(b){["weeks","months"].includes(b)&&(n.value=b)}function ce(){console.log("[DEBUG] handleCloseModal called"),console.log("[DEBUG] showPeriodModeInfo before:",Q.value),console.log("[DEBUG] isLoading before:",w.value),console.log("[DEBUG] periodMode:",n.value),Q.value=!1,w.value=!0,console.log("[DEBUG] showPeriodModeInfo after:",Q.value),console.log("[DEBUG] isLoading after:",w.value),Ge(()=>{console.log("[DEBUG] handleCloseModal: calling handleStartLoading in nextTick"),le()})}function le(){console.log("[DEBUG] handleStartLoading called"),console.log("[DEBUG] periodMode before check:",n.value),console.log("[DEBUG] showPeriodModeInfo:",Q.value),console.log("[DEBUG] isLoading:",w.value),(!n.value||!["weeks","months"].includes(n.value))&&(console.warn('[GraphAdmissionClosureDashboard] Period mode not set, using default "weeks"'),n.value="weeks"),console.log("[GraphAdmissionClosureDashboard] Starting loading, periodMode:",n.value),Ge(()=>{console.log("[DEBUG] nextTick callback, periodMode:",n.value),console.log("[DEBUG] isLoading in nextTick:",w.value),n.value==="weeks"?(console.log("[GraphAdmissionClosureDashboard] Loading data for weeks mode"),W()):n.value==="months"&&(console.log("[GraphAdmissionClosureDashboard] Months mode - data will be loaded by GraphAdmissionClosureMonthsDashboard"),w.value=!1,console.log("[DEBUG] Reset parent isLoading to false for months mode"))})}function ye(b=null){b?L.value=b:L.value={weekNumber:f.value?.weekNumber||null,weekStartUtc:f.value?.weekStartUtc||null,weekEndUtc:f.value?.weekEndUtc||null},O.value=!0}function Te(b=null){b?L.value=b:L.value={weekNumber:f.value?.weekNumber||null,weekStartUtc:f.value?.weekStartUtc||null,weekEndUtc:f.value?.weekEndUtc||null},M.value=!0}function Ne(b=null){b?L.value=b:L.value={weekNumber:f.value?.weekNumber||null,weekStartUtc:f.value?.weekStartUtc||null,weekEndUtc:f.value?.weekEndUtc||null},q.value=!0}Fe(()=>{try{const b="graph-admission-closure-period-mode-info-shown";localStorage.getItem(b)&&localStorage.removeItem(b);const m="graph-admission-closure-period-mode";localStorage.getItem(m)&&localStorage.removeItem(m)}catch(b){console.warn("[GraphAdmissionClosureDashboard] Failed to clean localStorage:",b)}window.addEventListener("period-mode-change",R)}),xe(()=>{window.removeEventListener("period-mode-change",R)});function Ie(){const b=new Date,m=new Date(Date.UTC(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate())),X=m.getUTCDay(),ee=m.getUTCDate()-X+(X===0?-6:1),de=new Date(Date.UTC(m.getUTCFullYear(),m.getUTCMonth(),ee,0,0,0)),se=new Date(de);return se.setUTCDate(se.getUTCDate()+6),se.setUTCHours(23,59,59,999),{weekStartUtc:de.toISOString(),weekEndUtc:se.toISOString()}}return(b,m)=>{const X=Ye("router-link");return o(),l("div",xl,[J(he,{name:"fade",mode:"out-in"},{default:ne(()=>[w.value?(o(),l("div",jl,[t("div",zl,[m[3]||(m[3]=t("div",{class:"preloader-spinner"},[t("div",{class:"spinner-ring"}),t("div",{class:"spinner-ring"}),t("div",{class:"spinner-ring"})],-1)),m[4]||(m[4]=t("h3",{class:"preloader-title"},"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°",-1)),t("p",Yl," ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð° "+d(n.value==="weeks"?"4 Ð½ÐµÐ´ÐµÐ»Ð¸":"3 Ð¼ÐµÑÑÑ†Ð°")+"... ",1),m[5]||(m[5]=t("div",{class:"preloader-dots"},[t("span",{class:"dot"}),t("span",{class:"dot"}),t("span",{class:"dot"})],-1))])])):!Q.value&&!w.value?(o(),l("div",Zl,[n.value==="months"?(o(),me(Xr,{key:0})):(o(),l("div",ql,[t("div",Ql,[t("div",Jl,[t("div",Xl,[t("button",{class:"btn-home-link",type:"button",onClick:T,title:"ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ","aria-label":"ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"}," Ð“Ð»Ð°Ð²Ð½Ð°Ñ "),m[11]||(m[11]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),t("button",{class:"btn-back-link",type:"button",onClick:C,"aria-label":v.value,"aria-disabled":!u.value,"data-fallback":!u.value,disabled:g.value,title:"ÐÐ°Ð·Ð°Ð´"}," â† ",8,ei),t("nav",ti,[J(X,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:ne(()=>[...m[6]||(m[6]=[ve(" Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡ ",-1)])]),_:1}),m[8]||(m[8]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),J(X,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:ne(()=>[...m[7]||(m[7]=[ve(" Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ",-1)])]),_:1}),m[9]||(m[9]=t("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),m[10]||(m[10]=t("span",{class:"breadcrumb-current"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹",-1))])]),m[12]||(m[12]=t("h1",{class:"dashboard-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),m[13]||(m[13]=t("p",{class:"dashboard-subtitle"}," Ð”Ð¾ÑÑ‚ÑƒÐ¿Ñ‹ Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ñ‹ Â«Ð“Ñ€Ð°Ñ„Ð¸ÐºÑƒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑÂ», ÑÐµÐ»ÐµÐºÑ‚Ð¾Ñ€ ÑÑ‚Ð°Ð¿Ð¾Ð² ÑÐºÑ€Ñ‹Ñ‚. ",-1))])]),t("div",ai,[t("div",si,[J(qe,{stages:y.value.stages,employees:y.value.employees,dateRange:y.value.dateRange,customDateRange:y.value.customDateRange,hasActiveFilters:E.value,hideStages:!0,weekPickerMode:!1,showPeriodMode:!0,"period-mode":n.value,"onUpdate:stages":ge,"onUpdate:employees":h,"onUpdate:dateRange":e,"onUpdate:customDateRange":a,"onUpdate:periodMode":r,onReset:U,onApply:G},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","period-mode"])]),t("div",ri,[_.value?(o(),me(Ze,{key:0,type:"error",title:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",message:_.value.message},null,8,["message"])):(o(),me(vs,{key:1,meta:f.value,data:p.value,onOpenResponsible:Te,onOpenStages:ye,onOpenCarryover:Ne},null,8,["meta","data"]))])])]))])):j("",!0)]),_:1}),J(Mn,{"is-visible":M.value,responsible:H(L.value)||p.value.responsible||[],"closed-tickets-created-this-week":Z(L.value)??p.value.closedTicketsCreatedThisWeek??0,"closed-tickets-created-other-week":ue(L.value)??p.value.closedTicketsCreatedOtherWeek??0,"responsible-created-this-week":Y(L.value)||p.value.responsibleCreatedThisWeek||[],"responsible-created-other-week":V(L.value)||p.value.responsibleCreatedOtherWeek||[],"week-number":L.value?.weekNumber||f.value?.weekNumber||null,"week-start-utc":L.value?.weekStartUtc||f.value?.weekStartUtc||null,"week-end-utc":L.value?.weekEndUtc||f.value?.weekEndUtc||null,onClose:m[0]||(m[0]=ee=>{M.value=!1,L.value.value=null})},null,8,["is-visible","responsible","closed-tickets-created-this-week","closed-tickets-created-other-week","responsible-created-this-week","responsible-created-other-week","week-number","week-start-utc","week-end-utc"]),J(ul,{"is-visible":O.value,"week-number":L.value?.weekNumber||f.value?.weekNumber||null,"week-start-utc":L.value?.weekStartUtc||f.value?.weekStartUtc||null,"week-end-utc":L.value?.weekEndUtc||f.value?.weekEndUtc||null,"preloaded-data":N(L.value),onClose:m[1]||(m[1]=ee=>{O.value=!1,L.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),J(Vl,{"is-visible":q.value,"week-number":L.value?.weekNumber||f.value?.weekNumber||null,"week-start-utc":L.value?.weekStartUtc||f.value?.weekStartUtc||null,"week-end-utc":L.value?.weekEndUtc||f.value?.weekEndUtc||null,"preloaded-data":$(L.value),onClose:m[2]||(m[2]=ee=>{q.value=!1,L.value.value=null})},null,8,["is-visible","week-number","week-start-utc","week-end-utc","preloaded-data"]),Q.value?(o(),me(ct,{key:0,"is-visible":Q.value,"current-mode":n.value,onClose:ce,onSelectMode:oe},null,8,["is-visible","current-mode"])):j("",!0)])}}},pi=fe(oi,[["__scopeId","data-v-2fa9296d"]]);export{pi as default};
