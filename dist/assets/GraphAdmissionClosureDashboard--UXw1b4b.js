const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ticketListUtils-BndyXWfB.js","assets/priority-config-T1ufaL6w.js","assets/main-BXzVRje6.js","assets/main-hkNOQW78.css","assets/priority-config-Bxxce_5E.css","assets/ticket-mapper-CXblEeTr.js"])))=>i.map(i=>d[i]);
var le=Object.defineProperty;var oe=(f,e,t)=>e in f?le(f,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[e]=t;var z=(f,e,t)=>oe(f,typeof e!="symbol"?e+"":e,t);import{_ as H,g as h,c as B,a as y,o as c,b as a,t as I,F as M,e as O,n as q,d as R,f as Y,G as re,H as N,I as G,j as D,k as U,B as P,T as Z,l as V,J as x,m as ne,S as ie,L as ce}from"./main-BXzVRje6.js";import{F as de}from"./FiltersPanel-LpDStSpS.js";import{L as te,D as ue,B as ye}from"./index-BGBtrHTJ.js";import{B as F,g as se,a as me,b as ae,D as _e,T as X,c as K}from"./priority-config-T1ufaL6w.js";const ve={class:"ac-chart"},ge={class:"ac-chart__header"},pe={class:"ac-chart__subtitle"},ke={class:"ac-chart__controls"},fe={class:"chart-type-selector"},he=["onClick"],Te={class:"chart-type-icon"},we={class:"chart-type-label"},Ie={class:"ac-chart__summary"},be={class:"summary-card__value"},Ce={class:"summary-card__value"},Ee={class:"summary-card__value"},Se={class:"summary-card summary-card--stages"},De={class:"summary-card__tags"},$e={key:0,class:"stage-tag stage-tag--empty"},Ue={class:"ac-chart__body"},Ae={__name:"GraphAdmissionClosureChart",props:{meta:{type:Object,default:null},data:{type:Object,default:()=>({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]})}},emits:["open-responsible","open-stages","open-carryover"],setup(f,{emit:e}){const t=f,o=e,n=[{value:"line",label:"Ð›Ð¸Ð½ÐµÐ¹Ð½Ñ‹Ð¹",icon:"ðŸ“ˆ"},{value:"bar",label:"Ð¡Ñ‚Ð¾Ð»Ð±Ñ‡Ð°Ñ‚Ñ‹Ð¹",icon:"ðŸ“Š"},{value:"doughnut",label:"ÐšÑ€ÑƒÐ³Ð¾Ð²Ð°Ñ",icon:"ðŸ©"}],d=h("line"),p=B(()=>{var T;return((T=t.meta)==null?void 0:T.weekNumber)??"â€”"}),u=B(()=>{var s,l,_;const T=["Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð½ÐµÐ´ÐµÐ»Ñ"],k=Array.isArray((s=t.data.series)==null?void 0:s.new)?t.data.series.new:[t.data.newTickets||0],b=Array.isArray((l=t.data.series)==null?void 0:l.closed)?t.data.series.closed:[t.data.closedTickets||0],g=Array.isArray((_=t.data.series)==null?void 0:_.carryover)?t.data.series.carryover:[t.data.carryoverTickets||0];return{labels:T,datasets:[{label:"ÐÐ¾Ð²Ñ‹Ðµ",data:k,backgroundColor:N.primary,borderColor:N.primary,tension:.3,fill:!1},{label:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ",data:b,backgroundColor:N.success,borderColor:N.success,tension:.3,fill:!1},{label:"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",data:g,backgroundColor:N.carryover,borderColor:N.carryover,tension:.3,fill:!1}]}}),i=B(()=>({labels:["ÐÐ¾Ð²Ñ‹Ðµ","Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ","ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ"],datasets:[{data:[t.data.newTickets||0,t.data.closedTickets||0,t.data.carryoverTickets||0],backgroundColor:[N.primary,N.success,N.carryover],borderWidth:1}]})),v=B(()=>{switch(d.value){case"line":return te;case"bar":return ye;case"doughnut":return ue;default:return te}}),E=B(()=>d.value==="doughnut"?i.value:u.value),S=B(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{enabled:!0},legend:{position:"top"}},onClick:(T,k,b)=>{var _,r,m;if(k.length===0)return;const s=k[0].datasetIndex,l=b.data.datasets[s];!l||!l.label||(l.label==="Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ"?(((_=t.data)==null?void 0:_.responsible)||[]).length>0&&o("open-responsible"):l.label==="ÐÐ¾Ð²Ñ‹Ðµ"?(((r=t.data)==null?void 0:r.newTickets)||0)>0&&o("open-stages"):l.label==="ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ"&&(((m=t.data)==null?void 0:m.carryoverTickets)||0)>0&&o("open-carryover"))},scales:d.value==="doughnut"?{}:{y:{beginAtZero:!0,ticks:{precision:0}}}})),C=T=>{var k,b,g,s;T==="new"&&(((k=t.data)==null?void 0:k.newTickets)||0)>0?o("open-stages"):T==="closed"&&(((b=t.data)==null?void 0:b.closedTickets)||0)>0?(((g=t.data)==null?void 0:g.responsible)||[]).length>0&&o("open-responsible"):T==="carryover"&&(((s=t.data)==null?void 0:s.carryoverTickets)||0)>0&&o("open-carryover")};return(T,k)=>{var b,g;return c(),y("div",ve,[a("header",ge,[a("div",null,[k[3]||(k[3]=a("h2",{class:"ac-chart__title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡",-1)),a("p",pe," ÐÐµÐ´ÐµÐ»Ñ "+I(p.value)+" Â· "+I(((b=f.meta)==null?void 0:b.weekStartUtc)||"â€”")+" â€” "+I(((g=f.meta)==null?void 0:g.weekEndUtc)||"â€”")+" (UTC) ",1)]),a("div",ke,[a("div",fe,[(c(),y(M,null,O(n,s=>a("button",{key:s.value,class:q(["chart-type-btn",{active:d.value===s.value}]),onClick:l=>d.value=s.value},[a("span",Te,I(s.icon),1),a("span",we,I(s.label),1)],10,he)),64))])])]),a("section",Ie,[a("div",{class:"summary-card summary-card--new",onClick:k[0]||(k[0]=s=>C("new"))},[k[4]||(k[4]=a("div",{class:"summary-card__label"},"ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),a("div",be,I(f.data.newTickets??0),1)]),a("div",{class:"summary-card summary-card--closed",onClick:k[1]||(k[1]=s=>C("closed"))},[k[5]||(k[5]=a("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),a("div",Ce,I(f.data.closedTickets??0),1)]),a("div",{class:"summary-card summary-card--carryover",onClick:k[2]||(k[2]=s=>C("carryover"))},[k[6]||(k[6]=a("div",{class:"summary-card__label"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ",-1)),a("div",Ee,I(f.data.carryoverTickets??0),1)]),a("div",Se,[k[7]||(k[7]=a("div",{class:"summary-card__label"},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),a("div",De,[(c(!0),y(M,null,O(f.data.stages||[],s=>(c(),y("span",{key:s.stageId,class:"stage-tag"},I(s.stageName||s.stageId)+" â€” "+I(s.count),1))),128)),!f.data.stages||f.data.stages.length===0?(c(),y("span",$e," ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ")):R("",!0)])])]),a("div",Ue,[(c(),Y(re(v.value),{data:E.value,options:S.value},null,8,["data","options"]))])])}}},Be=H(Ae,[["__scopeId","data-v-6690166f"]]);class J{static async getSectorData(){try{const e=await this.getAllTickets();console.log("Total tickets loaded:",e.length);const t=this.extractUniqueEmployeeIds(e);console.log("Unique employee IDs:",t);const o=await this.getEmployeesByIds(t);return console.log("Loaded employees:",o.length),{stages:this.groupTicketsByStages(e,o),employees:o,zeroPointTickets:this.getZeroPointTickets(e)}}catch(e){throw console.error("Error getting sector data:",e),e}}static async getAllTickets(){const e=["DT140_12:UC_0VHWE2","DT140_12:PREPARATION","DT140_12:CLIENT"],t=[];for(const o of e){console.log(`Loading tickets for stage: ${o}`);const n=await this.getTicketsByStage(o);t.push(...n),console.log(`Loaded ${n.length} tickets for stage ${o}`)}return t}static async getTicketsByStage(e){const t=[];let o=0;const n=50;let d=!0;for(;d;)try{const u=await F.call("crm.item.list",{entityTypeId:this.ENTITY_TYPE_ID,filter:{stageId:e},select:["*"],order:{id:"DESC"},start:o,useOriginalUfNames:"Y"});let i=[];u&&u.result&&(Array.isArray(u.result)?i=u.result:u.result.items&&Array.isArray(u.result.items)?i=u.result.items:u.result.data&&Array.isArray(u.result.data)&&(i=u.result.data)),i.length>0?(t.push(...i),o+=i.length,d=i.length===n):d=!1}catch(u){console.error(`Error loading tickets batch for stage ${e} (start: ${o}):`,u),d=!1}t.length>0&&(console.log("Sample ticket structure (full JSON):",JSON.stringify(t[0],null,2)),console.log("Sample ticket keys:",Object.keys(t[0])),console.log("Sample ticket assignedById variants:",{assignedById:t[0].assignedById,assignedByIdId:t[0].assignedByIdId,ASSIGNED_BY_ID:t[0].ASSIGNED_BY_ID}));const p=t.filter(u=>{const i=u.UF_CRM_7_TYPE_PRODUCT||u.uf_crm_7_type_product||u.ufCrm7TypeProduct||u.UF_CRM_7_TYPE_PRODUCT||u.uf_crm_7_type_product;return Array.isArray(i)?i.includes(this.SECTOR_TAG):typeof i=="object"&&i!==null?i.value===this.SECTOR_TAG||i===this.SECTOR_TAG:i===this.SECTOR_TAG});return console.log(`Filtered ${p.length} tickets from ${t.length} for stage ${e} (sector tag: ${this.SECTOR_TAG})`),p}static extractUniqueEmployeeIds(e){if(!Array.isArray(e))return[];const t=new Set;return e.forEach(o=>{const n=o.assignedById||o.assignedByIdId||o.ASSIGNED_BY_ID||o.assignedById||o.assignedById&&typeof o.assignedById=="object"&&(o.assignedById.id||o.assignedById.ID)||o.assignedById&&typeof o.assignedById=="object"&&o.assignedById.value;if(n){const d=parseInt(n);d&&!isNaN(d)&&d>0&&t.add(d)}}),e.length>0&&(console.log("Sample ticket for employee extraction:",e[0]),console.log("Sample ticket assignedById variants:",{assignedById:e[0].assignedById,assignedByIdId:e[0].assignedByIdId,ASSIGNED_BY_ID:e[0].ASSIGNED_BY_ID}),console.log("Extracted employee IDs:",Array.from(t))),Array.from(t)}static async getEmployeesByIds(e){if(!Array.isArray(e)||e.length===0)return[];try{const t=await F.call("user.get",{filter:{ID:e}});let o=[];return t&&t.result&&(Array.isArray(t.result)?o=t.result:console.warn("Unexpected user.get result format:",t)),o.map(n=>({id:parseInt(n.ID||n.id||0),name:`${n.NAME||n.name||""} ${n.LAST_NAME||n.lastName||""}`.trim()||n.EMAIL||n.email||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹",position:n.WORK_POSITION||n.workPosition||"Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº",email:n.EMAIL||n.email||"",tickets:[]}))}catch(t){return console.error("Error getting employees by IDs:",t),[]}}static groupTicketsByStages(e,t){Array.isArray(e)||(console.warn("Tickets is not an array:",e),e=[]),Array.isArray(t)||(console.warn("Employees is not an array:",t),t=[]);const o=[{id:"formed",name:"Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ",color:"#007bff",employees:t.map(n=>({...n,tickets:[]}))},{id:"review",name:"Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¢Ð—",color:"#ffc107",employees:t.map(n=>({...n,tickets:[]}))},{id:"execution",name:"Ð˜ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ",color:"#28a745",employees:t.map(n=>({...n,tickets:[]}))}];return e.forEach(n=>{const d=this.mapStageId(n.stageId||n.STAGE_ID||""),p=o.find(u=>u.id===d);if(p){const u=n.assignedById||n.ASSIGNED_BY_ID||null,i=u?parseInt(u):null;if(i){let v=p.employees.find(E=>E.id===i);v||(v={id:i,name:`Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ðº #${i}`,position:"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾",email:"",tickets:[]},p.employees.push(v)),v.tickets.push(this.mapTicket(n))}}}),o}static mapStageId(e){return{"DT140_12:UC_0VHWE2":"formed","DT140_12:PREPARATION":"review","DT140_12:CLIENT":"execution"}[e]||"formed"}static mapStageIdToBitrix(e){return{formed:"DT140_12:UC_0VHWE2",review:"DT140_12:PREPARATION",execution:"DT140_12:CLIENT"}[e]||"DT140_12:UC_0VHWE2"}static mapTicket(e){const t=parseInt(e.id||e.ID||0),o=e.title||e.TITLE||"Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ",n=e.stageId||e.STAGE_ID||"",d=e.assignedById||e.ASSIGNED_BY_ID||null,p=e.createdTime||e.CREATED_DATE||e.CREATED_TIME||"",u=e.updatedTime||e.MODIFY_DATE||e.UPDATED_TIME||"",i=e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.ufCrm7UfPriority||e.UF_CRM_7_UF_PRIORITY||e.uf_crm_7_uf_priority||e.priority||e.PRIORITY||null,v=se(i),E=me(v);return{id:t,title:o,priorityId:v.id,priorityLabel:v.label,priorityColors:E,priority:v.id,priorityBitrixValue:v.bitrixValue||null,status:this.mapStatus(n),assigneeId:d?parseInt(d):null,stageId:this.mapStageId(n),createdAt:p,modifiedAt:u,amount:e.opportunity||e.OPPORTUNITY||0,currency:e.currencyId||e.CURRENCY_ID||"RUB",description:e.comments||e.COMMENTS||""}}static mapPriority(e){return se(e).id}static mapPriorityToBitrix(e){if(e&&typeof e=="object")return e.bitrixValue||null;const t=ae(e);if(t&&t.bitrixValue)return t.bitrixValue;const o={3:"3",2:"2",1:"1",high:"3",medium:"2",low:"1"};return o[e]?o[e]:ae(_e).bitrixValue}static mapStatus(e){return"in_progress"}static getZeroPointTickets(e){const t={formed:[],review:[],execution:[]};return Array.isArray(e)?(e.filter(o=>!(o.assignedById||o.ASSIGNED_BY_ID)).forEach(o=>{const n=this.mapStageId(o.stageId||o.STAGE_ID||"");t[n]&&t[n].push(this.mapTicket(o))}),t):(console.warn("Tickets is not an array in getZeroPointTickets:",e),t)}static async assignTicket(e,t,o){try{const n=this.mapStageIdToBitrix(o);return(await F.call("crm.item.update",{entityTypeId:this.ENTITY_TYPE_ID,id:e,fields:{assignedById:t,stageId:n}})).result===!0}catch(n){throw console.error("Error assigning ticket:",n),n}}static async createTicket(e){try{const t=await F.call("crm.item.add",{entityTypeId:this.ENTITY_TYPE_ID,fields:{title:e.title,assignedById:e.employeeId,stageId:this.mapStageIdToBitrix(e.stageId)}});return t.result?parseInt(t.result):0}catch(t){throw console.error("Error creating ticket:",t),t}}static async getTicket(e){try{const t=await F.call("crm.item.get",{entityTypeId:this.ENTITY_TYPE_ID,id:e});return this.mapTicket(t.result)}catch(t){throw console.error("Error getting ticket:",t),t}}static async addComment(e,t){try{return(await F.call("crm.timeline.comment.add",{fields:{entityId:e,entityType:"DYNAMIC_"+this.ENTITY_TYPE_ID,comment:t}})).result!==void 0}catch(o){throw console.error("Error adding comment:",o),o}}}z(J,"ENTITY_TYPE_ID",140),z(J,"SECTOR_TAG","1C");const Re="/api/graph-1c-admission-closure.php";function Ne(f){var t,o,n,d,p,u,i,v,E,S,C,T,k,b,g,s;if(!f)return{meta:null,data:{newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}};const e=f.data||f.result||f;return{meta:e.meta||f.meta||null,data:{newTickets:((t=e.data)==null?void 0:t.newTickets)??e.newTickets??0,closedTickets:((o=e.data)==null?void 0:o.closedTickets)??e.closedTickets??0,carryoverTickets:((n=e.data)==null?void 0:n.carryoverTickets)??e.carryoverTickets??0,series:{new:((p=(d=e.data)==null?void 0:d.series)==null?void 0:p.new)??((u=e.series)==null?void 0:u.new)??[0],closed:((v=(i=e.data)==null?void 0:i.series)==null?void 0:v.closed)??((E=e.series)==null?void 0:E.closed)??[0],carryover:((C=(S=e.data)==null?void 0:S.series)==null?void 0:C.carryover)??((T=e.series)==null?void 0:T.carryover)??[0]},stages:((k=e.data)==null?void 0:k.stages)??e.stages??[],responsible:((b=e.data)==null?void 0:b.responsible)??e.responsible??[],newTicketsByStages:((g=e.data)==null?void 0:g.newTicketsByStages)??e.newTicketsByStages??null,carryoverTicketsByDuration:((s=e.data)==null?void 0:s.carryoverTicketsByDuration)??e.carryoverTicketsByDuration??null}}}async function W(f={}){const{endpoint:e=Re,product:t="1C",weekStartUtc:o=null,weekEndUtc:n=null,useCache:d=!0,forceRefresh:p=!1,includeTickets:u=!1,includeNewTicketsByStages:i=!1,includeCarryoverTickets:v=!0,includeCarryoverTicketsByDuration:E=!1}=f,C=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({product:t,weekStartUtc:o,weekEndUtc:n,useCache:d,forceRefresh:p,includeTickets:u,includeNewTicketsByStages:i,includeCarryoverTickets:v,includeCarryoverTicketsByDuration:E})});if(!C.ok)throw new Error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° (${C.status})`);const T=await C.json();if((T==null?void 0:T.success)===!1)throw new Error(T.message||"Ð‘ÑÐºÐµÐ½Ð´ Ð²ÐµÑ€Ð½ÑƒÐ» Ð¾ÑˆÐ¸Ð±ÐºÑƒ");return Ne(T)}const Pe={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},Me={class:"modal"},Oe={key:"level-1",class:"level-1"},Le={class:"modal__header"},Ye={class:"modal__body"},Ve={key:"loading",class:"loading-names"},Fe={key:"empty",class:"modal__empty"},Ge={key:"list",class:"responsible-list"},We=["onClick"],je={class:"responsible-list__name"},He={class:"responsible-list__count"},qe={key:0,class:"responsible-list__arrow"},ze={class:"modal__footer"},Je={key:"level-2",class:"level-2"},Ze={class:"modal__header"},xe={class:"modal__title"},Xe={class:"modal__body"},Ke={key:"loading",class:"loading-state"},Qe={key:"error",class:"error-state"},et={class:"error-message"},tt={key:"empty",class:"empty-state"},st={key:"tickets",class:"tickets-list-container"},at={__name:"ResponsibleModal",props:{isVisible:{type:Boolean,default:!1},responsible:{type:Array,default:()=>[]},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},setup(f){const e=f,t=h(1),o=h(null),n=h([]),d=h(!1),p=h(null),u=h([]),i=h(!1);async function v(g){const s=g.filter(l=>l.id!==null&&l.id!==void 0).map(l=>l.id);if(s.length===0)return g;try{const l=await J.getEmployeesByIds(s),_=new Map;return l.forEach(r=>{_.set(r.id,r.name)}),g.map(r=>r.id&&_.has(r.id)?{...r,name:_.get(r.id)}:r)}catch(l){return console.error("[ResponsibleModal] Error enriching names:",l),g}}G(()=>e.responsible,async g=>{if(!g||g.length===0){u.value=[];return}i.value=!0;try{u.value=await v(g)}catch(s){console.error("[ResponsibleModal] Error loading employee names:",s),u.value=g}finally{i.value=!1}},{immediate:!0});const E=B(()=>(u.value||[]).length>0);async function S(g,s=null){!g||!g.id||g.count===0||(s&&s.currentTarget&&(s.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{s.currentTarget&&(s.currentTarget.style.transform="")},150)),o.value=g,t.value=2,await C(g.id))}async function C(g){d.value=!0,p.value=null;try{if(!e.weekStartUtc||!e.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const l=(await W({product:"1C",weekStartUtc:e.weekStartUtc,weekEndUtc:e.weekEndUtc,includeTickets:!0})).data.responsible.find(r=>r.id===g),_=(l==null?void 0:l.tickets)||[];try{const{prepareTicketsForDisplay:r}=await x(async()=>{const{prepareTicketsForDisplay:m}=await import("./ticketListUtils-BndyXWfB.js").then(w=>w.t);return{prepareTicketsForDisplay:m}},__vite__mapDeps([0,1,2,3,4,5]));n.value=await r(_,null,null)}catch(r){console.error("[ResponsibleModal] Error preparing tickets:",r),n.value=_}n.value.length===0&&(p.value=null)}catch(s){p.value=s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[ResponsibleModal] Error loading tickets:",s),n.value=[]}finally{d.value=!1}}function T(){t.value=1,o.value=null,n.value=[],p.value=null}function k(g){const s=K(g.id);window.open(s,"_blank")}function b(){o.value&&C(o.value.id)}return G(()=>e.isVisible,g=>{g||(t.value=1,o.value=null,n.value=[],p.value=null)}),(g,s)=>f.isVisible?(c(),y("div",Pe,[a("div",Me,[D(P,{name:"level",mode:"out-in"},{default:U(()=>{var l;return[t.value===1?(c(),y("div",Oe,[a("header",Le,[s[3]||(s[3]=a("h3",{class:"modal__title"},"ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)),a("button",{class:"modal__close",onClick:s[0]||(s[0]=_=>g.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),a("section",Ye,[D(P,{name:"loading",mode:"out-in"},{default:U(()=>[i.value?(c(),y("div",Ve,[...s[4]||(s[4]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð¼Ñ‘Ð½ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²...",-1)])])):E.value?(c(),y("ul",Ge,[(c(!0),y(M,null,O(u.value,_=>(c(),y("li",{key:_.id||_.name,class:q(["responsible-list__item",{"responsible-list__item--clickable":_.id&&_.count>0}]),onClick:r=>S(_,r),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°"},[a("span",je,I(_.name||"ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½"),1),a("span",He,I(_.count??0)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),_.id&&_.count>0?(c(),y("span",qe,"â†’")):R("",!0)],10,We))),128))])):(c(),y("p",Fe,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¼"))]),_:1})]),a("footer",ze,[a("button",{class:"btn",onClick:s[1]||(s[1]=_=>g.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):t.value===2?(c(),y("div",Je,[a("header",Ze,[a("button",{class:"btn-back",onClick:T,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),a("h3",xe,"Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°: "+I(((l=o.value)==null?void 0:l.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),a("button",{class:"modal__close",onClick:s[2]||(s[2]=_=>g.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),a("section",Xe,[D(P,{name:"loading",mode:"out-in"},{default:U(()=>[d.value?(c(),y("div",Ke,[...s[5]||(s[5]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):p.value?(c(),y("div",Qe,[s[6]||(s[6]=a("div",{class:"error-icon"},"âš ï¸",-1)),s[7]||(s[7]=a("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),a("p",et,I(p.value),1),a("button",{class:"btn btn-retry",onClick:b},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):n.value.length===0?(c(),y("div",tt,[...s[8]||(s[8]=[a("div",{class:"empty-state-icon"},"ðŸ“‹",-1),a("p",{class:"empty-state-message"},"Ð£ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° Ð½ÐµÑ‚ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ",-1)])])):(c(),y("div",st,[D(Z,{name:"ticket",tag:"div",class:"tickets-list"},{default:U(()=>[(c(!0),y(M,null,O(n.value,(_,r)=>(c(),Y(X,{key:_.id,ticket:_,draggable:!1,style:V({"--ticket-index":r}),onClick:k},null,8,["ticket","style"]))),128))]),_:1})]))]),_:1})])])):R("",!0)]}),_:1})])])):R("",!0)}},lt=H(at,[["__scopeId","data-v-595c147a"]]),ot={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},rt={class:"modal"},nt={key:"level-1",class:"level-1"},it={class:"modal__header"},ct={class:"modal__body"},dt={key:"loading",class:"loading-names"},ut={key:"empty",class:"modal__empty"},yt={key:"list",class:"stages-list"},mt=["onClick"],_t={class:"stages-list__name"},vt={class:"stages-list__count"},gt={key:0,class:"stages-list__arrow"},pt={class:"modal__footer"},kt={key:"level-2",class:"level-2"},ft={class:"modal__header"},ht={class:"modal__title"},Tt={class:"modal__body"},wt={key:"loading",class:"loading-state"},It={key:"error",class:"error-state"},bt={class:"error-message"},Ct={key:"empty",class:"empty-state"},Et={class:"empty-state-message"},St={key:"tickets",class:"tickets-list-container"},Dt={__name:"StagesModal",props:{isVisible:{type:Boolean,default:!1},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:e}){const t=f,o=h(1),n=h(null),d=h([]),p=h(!1),u=h(!1),i=h(null),v=h([]),E=B(()=>v.value.length>0&&v.value.some(s=>s.count>0));async function S(){if(!t.weekStartUtc||!t.weekEndUtc){v.value=[];return}u.value=!0,i.value=null;try{const s=await W({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0});v.value=s.data.newTicketsByStages||[]}catch(s){i.value=s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÑ‚Ð°Ð´Ð¸Ð¹",console.error("[StagesModal] Error loading stages:",s),v.value=[]}finally{u.value=!1}}async function C(s,l=null){!s||s.count===0||(l&&l.currentTarget&&(l.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{l.currentTarget&&(l.currentTarget.style.transform="")},150)),n.value=s,o.value=2,await T(s.stageId))}async function T(s){var l;p.value=!0,i.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const r=(l=(await W({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeNewTicketsByStages:!0,includeTickets:!0})).data.newTicketsByStages)==null?void 0:l.find(w=>w.stageId===s),m=(r==null?void 0:r.tickets)||[];try{const{prepareTicketsForDisplay:w}=await x(async()=>{const{prepareTicketsForDisplay:A}=await import("./ticketListUtils-BndyXWfB.js").then($=>$.t);return{prepareTicketsForDisplay:A}},__vite__mapDeps([0,1,2,3,4,5]));d.value=await w(m,null,null)}catch(w){console.error("[StagesModal] Error preparing tickets:",w),d.value=m}d.value.length===0&&(i.value=null)}catch(_){i.value=_.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[StagesModal] Error loading tickets:",_),d.value=[]}finally{p.value=!1}}function k(){o.value=1,n.value=null,d.value=[],i.value=null}function b(s){const l=K(s.id);window.open(l,"_blank")}function g(){n.value&&T(n.value.stageId)}return G(()=>t.isVisible,s=>{s?S():(o.value=1,n.value=null,d.value=[],i.value=null,v.value=[])}),G([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&S()}),(s,l)=>f.isVisible?(c(),y("div",ot,[a("div",rt,[D(P,{name:"level",mode:"out-in"},{default:U(()=>{var _;return[o.value===1?(c(),y("div",nt,[a("header",it,[l[3]||(l[3]=a("h3",{class:"modal__title"},"ÐÐ¾Ð²Ñ‹Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ‚Ð°Ð´Ð¸ÑÐ¼",-1)),a("button",{class:"modal__close",onClick:l[0]||(l[0]=r=>s.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),a("section",ct,[D(P,{name:"loading",mode:"out-in"},{default:U(()=>[u.value?(c(),y("div",dt,[...l[4]||(l[4]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÑ‚Ð°Ð´Ð¸Ð¹...",-1)])])):E.value?(c(),y("ul",yt,[(c(!0),y(M,null,O(v.value,r=>(c(),y("li",{key:r.stageId,class:q(["stages-list__item",{"stages-list__item--clickable":r.count>0}]),style:V({"--stage-color":r.color}),onClick:m=>C(r,m),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÑÑ‚Ð°Ð´Ð¸Ð¸"},[a("span",{class:"stages-list__color",style:V({backgroundColor:r.color})},null,4),a("span",_t,I(r.stageName),1),a("span",vt,I(r.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),r.count>0?(c(),y("span",gt,"â†’")):R("",!0)],14,mt))),128))])):(c(),y("p",ut," ÐÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),a("footer",pt,[a("button",{class:"btn",onClick:l[1]||(l[1]=r=>s.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):o.value===2?(c(),y("div",kt,[a("header",ft,[a("button",{class:"btn-back",onClick:k,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),a("h3",ht," Ð¢Ð¸ÐºÐµÑ‚Ñ‹ ÑÑ‚Ð°Ð´Ð¸Ð¸: "+I(((_=n.value)==null?void 0:_.stageName)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),a("button",{class:"modal__close",onClick:l[2]||(l[2]=r=>s.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),a("section",Tt,[D(P,{name:"loading",mode:"out-in"},{default:U(()=>{var r;return[p.value?(c(),y("div",wt,[...l[5]||(l[5]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):i.value?(c(),y("div",It,[l[6]||(l[6]=a("div",{class:"error-icon"},"âš ï¸",-1)),l[7]||(l[7]=a("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),a("p",bt,I(i.value),1),a("button",{class:"btn btn-retry",onClick:g},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):d.value.length===0?(c(),y("div",Ct,[l[8]||(l[8]=a("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),a("p",Et," ÐÐ° ÑÑ‚Ð°Ð´Ð¸Ð¸ Â«"+I((r=n.value)==null?void 0:r.stageName)+"Â» Ð½ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ ",1)])):(c(),y("div",St,[D(Z,{name:"ticket",tag:"div",class:"tickets-list"},{default:U(()=>[(c(!0),y(M,null,O(d.value,(m,w)=>(c(),Y(X,{key:m.id,ticket:m,draggable:!1,style:V({"--ticket-index":w}),onClick:b},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):R("",!0)]}),_:1})])])):R("",!0)}},$t=H(Dt,[["__scopeId","data-v-d15a3c66"]]),Ut={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},At={class:"modal"},Bt={key:"level-1",class:"level-1"},Rt={class:"modal__header"},Nt={class:"modal__body"},Pt={key:"loading",class:"loading-names"},Mt={key:"empty",class:"modal__empty"},Ot={key:"list",class:"duration-list"},Lt=["onClick"],Yt={class:"duration-list__name"},Vt={class:"duration-list__count"},Ft={key:0,class:"duration-list__arrow"},Gt={class:"modal__footer"},Wt={key:"level-2",class:"level-2"},jt={class:"modal__header"},Ht={class:"modal__title"},qt={class:"modal__body"},zt={key:"loading",class:"loading-state"},Jt={key:"error",class:"error-state"},Zt={class:"error-message"},xt={key:"empty",class:"empty-state"},Xt={class:"empty-state-message"},Kt={key:"tickets",class:"tickets-list-container"},Qt={__name:"CarryoverDurationModal",props:{isVisible:{type:Boolean,default:!1},weekStartUtc:{type:String,default:null},weekEndUtc:{type:String,default:null}},emits:["close"],setup(f,{emit:e}){const t=f,o=h(1),n=h(null),d=h([]),p=h(!1),u=h(!1),i=h(null),v=h([]),E=B(()=>v.value.length>0&&v.value.some(s=>s.count>0));async function S(){if(!t.weekStartUtc||!t.weekEndUtc){v.value=[];return}u.value=!0,i.value=null;try{const s=await W({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0});v.value=s.data.carryoverTicketsByDuration||[]}catch(s){i.value=s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹",console.error("[CarryoverDurationModal] Error loading categories:",s),v.value=[]}finally{u.value=!1}}async function C(s,l=null){!s||s.count===0||(l&&l.currentTarget&&(l.currentTarget.style.transform="scale(0.98)",setTimeout(()=>{l.currentTarget&&(l.currentTarget.style.transform="")},150)),n.value=s,o.value=2,await T(s.durationCategory))}async function T(s){var l;p.value=!0,i.value=null;try{if(!t.weekStartUtc||!t.weekEndUtc)throw new Error("ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð½ÐµÐ´ÐµÐ»Ð¸");const r=(l=(await W({product:"1C",weekStartUtc:t.weekStartUtc,weekEndUtc:t.weekEndUtc,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,includeTickets:!0})).data.carryoverTicketsByDuration)==null?void 0:l.find(w=>w.durationCategory===s),m=(r==null?void 0:r.tickets)||[];try{const{prepareTicketsForDisplay:w}=await x(async()=>{const{prepareTicketsForDisplay:A}=await import("./ticketListUtils-BndyXWfB.js").then($=>$.t);return{prepareTicketsForDisplay:A}},__vite__mapDeps([0,1,2,3,4,5]));d.value=await w(m,null,null)}catch(w){console.error("[CarryoverDurationModal] Error preparing tickets:",w),d.value=m}d.value.length===0&&(i.value=null)}catch(_){i.value=_.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²",console.error("[CarryoverDurationModal] Error loading tickets:",_),d.value=[]}finally{p.value=!1}}function k(){o.value=1,n.value=null,d.value=[],i.value=null}function b(s){const l=K(s.id);window.open(l,"_blank")}function g(){n.value&&T(n.value.durationCategory)}return G(()=>t.isVisible,s=>{s?S():(o.value=1,n.value=null,d.value=[],i.value=null,v.value=[])}),G([()=>t.weekStartUtc,()=>t.weekEndUtc],()=>{t.isVisible&&S()}),(s,l)=>f.isVisible?(c(),y("div",Ut,[a("div",At,[D(P,{name:"level",mode:"out-in"},{default:U(()=>{var _;return[o.value===1?(c(),y("div",Bt,[a("header",Rt,[l[3]||(l[3]=a("h3",{class:"modal__title"},"ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ñ‚Ð¸ÐºÐµÑ‚Ñ‹ Ð¿Ð¾ ÑÑ€Ð¾ÐºÐ°Ð¼",-1)),a("button",{class:"modal__close",onClick:l[0]||(l[0]=r=>s.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),a("section",Nt,[D(P,{name:"loading",mode:"out-in"},{default:U(()=>[u.value?(c(),y("div",Pt,[...l[4]||(l[4]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹...",-1)])])):E.value?(c(),y("ul",Ot,[(c(!0),y(M,null,O(v.value,r=>(c(),y("li",{key:r.durationCategory,class:q(["duration-list__item",{"duration-list__item--clickable":r.count>0}]),style:V({"--duration-color":r.color}),onClick:m=>C(r,m),title:"ÐšÐ»Ð¸ÐºÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"},[a("span",{class:"duration-list__color",style:V({backgroundColor:r.color})},null,4),a("span",Yt,I(r.durationLabel),1),a("span",Vt,I(r.count)+" Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1),r.count>0?(c(),y("span",Ft,"â†’")):R("",!0)],14,Lt))),128))])):(c(),y("p",Mt," ÐÐµÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ "))]),_:1})]),a("footer",Gt,[a("button",{class:"btn",onClick:l[1]||(l[1]=r=>s.$emit("close"))},"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ")])])):o.value===2?(c(),y("div",Wt,[a("header",jt,[a("button",{class:"btn-back",onClick:k,"aria-label":"ÐÐ°Ð·Ð°Ð´"},"â† ÐÐ°Ð·Ð°Ð´"),a("h3",Ht," Ð¢Ð¸ÐºÐµÑ‚Ñ‹: "+I(((_=n.value)==null?void 0:_.durationLabel)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾"),1),a("button",{class:"modal__close",onClick:l[2]||(l[2]=r=>s.$emit("close")),"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ"}," âœ• ")]),a("section",qt,[D(P,{name:"loading",mode:"out-in"},{default:U(()=>{var r;return[p.value?(c(),y("div",zt,[...l[5]||(l[5]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð²...",-1)])])):i.value?(c(),y("div",Jt,[l[6]||(l[6]=a("div",{class:"error-icon"},"âš ï¸",-1)),l[7]||(l[7]=a("p",{class:"error-title"},"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",-1)),a("p",Zt,I(i.value),1),a("button",{class:"btn btn-retry",onClick:g},"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ")])):d.value.length===0?(c(),y("div",xt,[l[8]||(l[8]=a("div",{class:"empty-state-icon"},"ðŸ“‹",-1)),a("p",Xt," Ð’ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Â«"+I((r=n.value)==null?void 0:r.durationLabel)+"Â» Ð½ÐµÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ñ‚Ð¸ÐºÐµÑ‚Ð¾Ð² ",1)])):(c(),y("div",Kt,[D(Z,{name:"ticket",tag:"div",class:"tickets-list"},{default:U(()=>[(c(!0),y(M,null,O(d.value,(m,w)=>(c(),Y(X,{key:m.id,ticket:m,draggable:!1,style:V({"--ticket-index":w}),onClick:b},null,8,["ticket","style"]))),128))]),_:1})]))]}),_:1})])])):R("",!0)]}),_:1})])])):R("",!0)}},es=H(Qt,[["__scopeId","data-v-83a6f8c8"]]),ts={class:"ac-dashboard"},ss={key:1},as={class:"dashboard-layout"},ls={class:"filters-container"},os={class:"chart-container"},rs={__name:"GraphAdmissionClosureDashboard",setup(f){const e=h(!0),t=h(null),o=h(null),n=h({newTickets:0,closedTickets:0,series:{new:[0],closed:[0]},stages:[],responsible:[]}),d=h(!1),p=h(!1),u=h(!1),i=h({stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}}),v=h(null),E=B(()=>{const r=i.value.customDateRange.startDate||i.value.customDateRange.endDate,m=i.value.employees.length===1&&i.value.employees.includes("all");return r||!m});async function S(){e.value=!0,t.value=null;try{let r,m;if(v.value)r=v.value.startUtc,m=v.value.endUtc;else{const $=_();r=$.weekStartUtc,m=$.weekEndUtc}const{meta:w,data:A}=await W({product:"1C",weekStartUtc:r,weekEndUtc:m});o.value=w,n.value=A,!v.value&&w&&(v.value={weekNumber:w.weekNumber,startUtc:w.weekStartUtc,endUtc:w.weekEndUtc})}catch(r){t.value=r instanceof Error?r:new Error("ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸"),console.error("[GraphAdmissionClosureDashboard] loadData error:",r)}finally{e.value=!1}}function C(r){i.value.stages=r}function T(r){i.value.employees=r}function k(r){i.value.dateRange=r}function b(r){i.value.customDateRange=r}function g(r){v.value=r}function s(){i.value={stages:{formed:!0,review:!0,execution:!0},employees:["all"],dateRange:"last-week",customDateRange:{startDate:null,endDate:null}},l()}function l(){S()}ne(()=>{S()});function _(){const r=new Date,m=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate())),w=m.getUTCDay(),A=m.getUTCDate()-w+(w===0?-6:1),$=new Date(Date.UTC(m.getUTCFullYear(),m.getUTCMonth(),A,0,0,0)),L=new Date($);return L.setUTCDate(L.getUTCDate()+6),L.setUTCHours(23,59,59,999),{weekStartUtc:$.toISOString(),weekEndUtc:L.toISOString()}}return(r,m)=>{var w,A,$,L,Q,ee;return c(),y("div",ts,[e.value?(c(),Y(ce,{key:0,message:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…..."})):(c(),y("div",ss,[m[6]||(m[6]=a("div",{class:"dashboard-header"},[a("div",null,[a("h1",{class:"dashboard-title"},"Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¹ ÑÐµÐºÑ‚Ð¾Ñ€Ð° 1Ð¡"),a("p",{class:"dashboard-subtitle"}," Ð”Ð¾ÑÑ‚ÑƒÐ¿Ñ‹ Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ñ‹ Â«Ð“Ñ€Ð°Ñ„Ð¸ÐºÑƒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑÂ», ÑÐµÐ»ÐµÐºÑ‚Ð¾Ñ€ ÑÑ‚Ð°Ð¿Ð¾Ð² ÑÐºÑ€Ñ‹Ñ‚. ")])],-1)),a("div",as,[a("div",ls,[D(de,{stages:i.value.stages,employees:i.value.employees,dateRange:i.value.dateRange,customDateRange:i.value.customDateRange,hasActiveFilters:E.value,hideStages:!0,weekPickerMode:!0,selectedWeek:v.value,weeksCount:52,"onUpdate:stages":C,"onUpdate:employees":T,"onUpdate:dateRange":k,"onUpdate:customDateRange":b,"onUpdate:selectedWeek":g,onReset:s,onApply:l},null,8,["stages","employees","dateRange","customDateRange","hasActiveFilters","selectedWeek"])]),a("div",os,[t.value?(c(),Y(ie,{key:0,type:"error",title:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",message:t.value.message},null,8,["message"])):(c(),Y(Be,{key:1,meta:o.value,data:n.value,onOpenResponsible:m[0]||(m[0]=j=>d.value=!0),onOpenStages:m[1]||(m[1]=j=>p.value=!0),onOpenCarryover:m[2]||(m[2]=j=>u.value=!0)},null,8,["meta","data"]))])])])),D(lt,{"is-visible":d.value,responsible:n.value.responsible||[],"week-start-utc":((w=o.value)==null?void 0:w.weekStartUtc)||null,"week-end-utc":((A=o.value)==null?void 0:A.weekEndUtc)||null,onClose:m[3]||(m[3]=j=>d.value=!1)},null,8,["is-visible","responsible","week-start-utc","week-end-utc"]),D($t,{"is-visible":p.value,"week-start-utc":(($=o.value)==null?void 0:$.weekStartUtc)||null,"week-end-utc":((L=o.value)==null?void 0:L.weekEndUtc)||null,onClose:m[4]||(m[4]=j=>p.value=!1)},null,8,["is-visible","week-start-utc","week-end-utc"]),D(es,{"is-visible":u.value,"week-start-utc":((Q=o.value)==null?void 0:Q.weekStartUtc)||null,"week-end-utc":((ee=o.value)==null?void 0:ee.weekEndUtc)||null,onClose:m[5]||(m[5]=j=>u.value=!1)},null,8,["is-visible","week-start-utc","week-end-utc"])])}}},ys=H(rs,[["__scopeId","data-v-ba76c7b4"]]);export{ys as default};
