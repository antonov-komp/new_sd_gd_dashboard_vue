import{a0 as ce,_ as ae,c as N,a as r,o,b as e,t as i,F as I,e as j,n as q,y as S,i as oe,Z as M,g as W,G as re,f as te,d as U,j as z,k as H,B as ie,T as ve,a6 as pe,I as ye,m as _e,z as be,r as ge}from"./main-BakJJ3UO.js";const de="/api/tickets-time-tracking-sector-1c.php";function fe(s){var T,v,d,f,u;if(!s)return{meta:null,data:{totalElapsedTime:0,totalElapsedTimeUnit:"hours",totalRecordsCount:0,weeks:[],employeesSummary:[]}};const b=s.data||s.result||s,a=b.meta||s.meta||null;return{meta:{weekNumber:(a==null?void 0:a.weekNumber)??null,weekStartUtc:(a==null?void 0:a.weekStartUtc)??null,weekEndUtc:(a==null?void 0:a.weekEndUtc)??null,totalWeeks:(a==null?void 0:a.totalWeeks)??0,sector1CEmployeesCount:(a==null?void 0:a.sector1CEmployeesCount)??0},data:{totalElapsedTime:((T=b.data)==null?void 0:T.totalElapsedTime)??b.totalElapsedTime??0,totalElapsedTimeUnit:((v=b.data)==null?void 0:v.totalElapsedTimeUnit)??b.totalElapsedTimeUnit??"hours",totalRecordsCount:((d=b.data)==null?void 0:d.totalRecordsCount)??b.totalRecordsCount??0,weeks:((f=b.data)==null?void 0:f.weeks)??b.weeks??[],employeesSummary:((u=b.data)==null?void 0:u.employeesSummary)??b.employeesSummary??[]}}}async function we(s={}){const{product:b="1C",weekStartUtc:a=null,weekEndUtc:T=null,weeksCount:v=4}=s;try{const d=ce(de),f=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:b,weekStartUtc:a,weekEndUtc:T,weeksCount:v})});if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);const u=await f.json();if(u.error)throw new Error(u.error_description||u.error||"Unknown error");return fe(u)}catch(d){throw console.error("[TimeTrackingService] Error fetching time tracking data:",d),d}}async function Te({taskIds:s,employeeId:b,weekNumber:a,page:T=1,perPage:v=10}){if(!s||!Array.isArray(s)||s.length===0)return{tasks:[],pagination:{totalTasks:0,currentPage:1,perPage:v,totalPages:0}};try{const d=ce(de),f=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:"1C",includeTaskDetails:!0,taskIds:s,employeeId:b||void 0,weekNumber:a||void 0,page:T,perPage:v})});if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);const u=await f.json();if(!u.success)throw new Error(u.error||u.error_description||"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–¥–∞—á–∞—Ö");return{tasks:u.data.tasks||[],pagination:u.data.pagination||{totalTasks:0,currentPage:1,perPage:v,totalPages:0}}}catch(d){throw console.error("[timeTrackingService] Error loading tasks details:",d),d}}const ue={getTimeTrackingData:we,getTasksDetails:Te};function P(s,b=1){return typeof s!="number"||isNaN(s)?"0 —á":`${s.toFixed(b)} —á`}function ee(s,b){if(!s||!b)return`–ù–µ–¥–µ–ª—è ${s||"?"}`;try{const a=new Date(b),T=new Date(a);T.setDate(T.getDate()+6);const v=a.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}),d=T.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"});return`–ù–µ–¥–µ–ª—è ${s} (${v} - ${d})`}catch(a){return console.error("[TimeTrackingUtils] Error formatting week label:",a),`–ù–µ–¥–µ–ª—è ${s}`}}function he(s){return!s||!s.data?!1:s.data.totalRecordsCount>0||s.data.weeks&&s.data.weeks.length>0}const De={class:"ttt-summary"},$e={class:"summary-cards"},Ce={class:"summary-card summary-card--total"},Ne={class:"summary-card__content"},Pe={class:"summary-card__value"},Ee={class:"summary-card summary-card--employees"},Se={class:"summary-card__content"},Ue={class:"summary-card__value"},We={class:"summary-card summary-card--average"},Me={class:"summary-card__content"},xe={class:"summary-card__value"},Le={__name:"TicketsTimeTrackingSummary",props:{data:{type:Object,required:!0}},setup(s){const b=s,a=N(()=>{var u,p;return((p=(u=b.data)==null?void 0:u.data)==null?void 0:p.totalElapsedTime)||0}),T=N(()=>{var u,p;return((p=(u=b.data)==null?void 0:u.meta)==null?void 0:p.sector1CEmployeesCount)||0}),v=N(()=>{const u=a.value,p=T.value;return p>0?u/p:0}),d=N(()=>a.value===0?"0.0 —á":P(a.value,1)),f=N(()=>v.value===0?"0.00 —á":P(v.value,2));return(u,p)=>(o(),r("div",De,[e("div",$e,[e("div",Ce,[p[1]||(p[1]=e("div",{class:"summary-card__icon"},"‚è±",-1)),e("div",Ne,[p[0]||(p[0]=e("div",{class:"summary-card__label"},"–û–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç",-1)),e("div",Pe,i(d.value),1)])]),e("div",Ee,[p[3]||(p[3]=e("div",{class:"summary-card__icon"},"üë•",-1)),e("div",Se,[p[2]||(p[2]=e("div",{class:"summary-card__label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ —Å–µ–∫—Ç–æ—Ä–µ",-1)),e("div",Ue,i(T.value),1)])]),e("div",We,[p[5]||(p[5]=e("div",{class:"summary-card__icon"},"üìä",-1)),e("div",Me,[p[4]||(p[4]=e("div",{class:"summary-card__label"},"–°—Ä–µ–¥–Ω—è—è –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞",-1)),e("div",xe,i(f.value),1)])])])]))}},Ie=ae(Le,[["__scopeId","data-v-51b124c7"]]),je={class:"ttt-table-container"},Ae={key:0,class:"ttt-table-loading"},Oe={key:1,class:"ttt-table-error"},Re={key:2,class:"ttt-table-empty"},Be={key:3,class:"ttt-table-wrapper"},Ve={class:"ttt-table"},Fe=["onClick"],qe={class:"ttt-table__header-week-date"},ze=["onClick"],He={class:"ttt-table__cell-employee"},Ge=["onClick"],Je={class:"ttt-table__cell-total"},Ke={class:"ttt-table__row-total"},Ze=["onClick"],Qe={class:"ttt-table__cell-total"},Xe={__name:"TicketsTimeTrackingTable",props:{data:{type:Object,required:!0},loading:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["cell-click","employee-click","week-click"],setup(s,{emit:b}){const a=s,T=b,v=N(()=>{var w,c;return((c=(w=a.data)==null?void 0:w.data)==null?void 0:c.weeks)||[]}),d=N(()=>{if(!a.data||!a.data.data||!a.data.data.weeks)return null;const w=a.data.data.weeks||[],k=(a.data.data.employeesSummary||[]).map(m=>{const E={};let x=0;return w.forEach(A=>{var Q;const K=(Q=A.employees)==null?void 0:Q.find(X=>X.id===m.id),Z=(K==null?void 0:K.elapsedTime)||0;E[A.weekNumber]=Z,x+=Z}),{id:m.id,name:m.name,weeks:E,total:x}}),_={};let D=0;return w.forEach(m=>{_[m.weekNumber]=m.totalElapsedTime||0,D+=m.totalElapsedTime||0}),{employees:k,weekTotals:_,grandTotal:D}}),f=(w,c)=>{var _;const k=(_=d.value)==null?void 0:_.employees.find(D=>D.id===w);return(k==null?void 0:k.weeks[c])||0},u=w=>{var c;return((c=d.value)==null?void 0:c.weekTotals[w])||0},p=w=>{if(!w)return"";try{return new Date(w).toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}catch{return""}},G=(w,c)=>{var D,m,E,x;const k=(D=d.value)==null?void 0:D.employees.find(A=>A.id===w),_=(x=(E=(m=a.data)==null?void 0:m.data)==null?void 0:E.weeks)==null?void 0:x.find(A=>A.weekNumber===c);k&&_&&T("cell-click",{employee:k,week:_,elapsedTime:f(w,c)})},J=w=>{var k;const c=(k=d.value)==null?void 0:k.employees.find(_=>_.id===w);c&&T("employee-click",{employee:c,weeks:v.value.map(_=>({week:_,elapsedTime:f(w,_.weekNumber)}))})},F=w=>{var k;const c=v.value.find(_=>_.weekNumber===w);c&&T("week-click",{week:c,employees:(k=d.value)==null?void 0:k.employees.map(_=>({employee:_,elapsedTime:f(_.id,w)})).filter(_=>_.elapsedTime>0)})};return(w,c)=>(o(),r("div",je,[s.loading?(o(),r("div",Ae," –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... ")):s.error?(o(),r("div",Oe,i(s.error),1)):!d.value||d.value.employees.length===0?(o(),r("div",Re," –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ")):(o(),r("div",Be,[e("table",Ve,[e("thead",null,[e("tr",null,[c[1]||(c[1]=e("th",{class:"ttt-table__header-employee"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",-1)),(o(!0),r(I,null,j(v.value,k=>(o(),r("th",{key:k.weekNumber,class:q(["ttt-table__header-week",{"ttt-table__header--clickable":!0}]),onClick:_=>F(k.weekNumber)},[S(" –ù–µ–¥–µ–ª—è "+i(k.weekNumber),1),c[0]||(c[0]=e("br",null,null,-1)),e("span",qe,i(p(k.weekStartUtc)),1)],8,Fe))),128)),c[2]||(c[2]=e("th",{class:"ttt-table__header-total"},"–ò—Ç–æ–≥–æ",-1))])]),e("tbody",null,[(o(!0),r(I,null,j(d.value.employees,k=>(o(),r("tr",{key:k.id,class:q(["ttt-table__row",{"ttt-table__row--clickable":!0}]),onClick:_=>J(k.id)},[e("td",He,i(k.name),1),(o(!0),r(I,null,j(v.value,_=>(o(),r("td",{key:`${k.id}-${_.weekNumber}`,class:q(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:oe(D=>G(k.id,_.weekNumber),["stop"])},i(M(P)(f(k.id,_.weekNumber))),9,Ge))),128)),e("td",Je,[e("strong",null,i(M(P)(k.total)),1)])],8,ze))),128)),e("tr",Ke,[c[3]||(c[3]=e("td",{class:"ttt-table__cell-employee"},[e("strong",null,"–í–°–ï–ì–û")],-1)),(o(!0),r(I,null,j(v.value,k=>(o(),r("td",{key:`total-${k.weekNumber}`,class:q(["ttt-table__cell-week",{"ttt-table__cell--clickable":!0}]),onClick:_=>F(k.weekNumber)},[e("strong",null,i(M(P)(u(k.weekNumber))),1)],8,Ze))),128)),e("td",Qe,[e("strong",null,i(M(P)(d.value.grandTotal)),1)])])])])]))]))}},Ye=ae(Xe,[["__scopeId","data-v-8021e5e4"]]),et={class:"modal-header"},tt={class:"modal-body"},at={key:"level-1",class:"detail-cell"},st={class:"detail-info"},lt={key:0,class:"tasks-list"},nt={class:"task-header"},ot={class:"task-label"},it={class:"task-time"},rt={key:0,class:"ticket-info"},ct={class:"ticket-label"},dt=["title"],ut={key:1,class:"ticket-title"},mt={key:1,class:"ticket-info ticket-info--no-ticket"},kt={class:"detail-total"},vt={key:0,class:"detail-actions"},pt={key:"level-2",class:"tasks-list-level"},yt={class:"tasks-list-header"},_t={class:"tasks-list-title"},bt={class:"tasks-list-content"},gt={key:"loading",class:"loading-state"},ft={key:"error",class:"error-state"},wt={class:"error-message"},Tt={key:"empty",class:"empty-state"},ht={key:"tasks",class:"tasks-cards-container"},Dt=["onClick"],$t={class:"task-card__header"},Ct={class:"task-card__number"},Nt={key:0,class:"task-card__time"},Pt={class:"task-card__title"},Et={class:"task-card__dates"},St={class:"task-card__date-item"},Ut={class:"date-value"},Wt={class:"task-card__date-item"},Mt={class:"task-card__date-item"},xt={class:"date-value"},Lt={key:0,class:"task-card__ticket"},It={class:"ticket-header"},jt={class:"ticket-header__left"},At={class:"ticket-id"},Ot=["title"],Rt={class:"ticket-title"},Bt={class:"ticket-meta"},Vt={class:"ticket-meta__row"},Ft={class:"ticket-meta__item"},qt={class:"meta-value"},zt={class:"ticket-meta__item"},Ht={class:"meta-value"},Gt={class:"ticket-meta__row"},Jt={class:"ticket-meta__item"},Kt={class:"meta-value"},Zt={class:"ticket-meta__item"},Qt={class:"meta-value"},Xt={class:"ticket-dates"},Yt={class:"ticket-date-item"},ea={class:"date-value"},ta={key:1,class:"task-card__no-ticket"},aa={key:0,class:"tasks-pagination"},sa=["disabled"],la={class:"pagination-pages"},na=["onClick"],oa=["disabled"],ia={key:"employee",class:"detail-employee"},ra={class:"detail-info"},ca={class:"weeks-list"},da={class:"week-header"},ua={class:"week-label"},ma={class:"week-time"},ka={key:"week",class:"detail-week"},va={class:"detail-info"},pa={class:"employees-list"},ya={class:"employee-header"},_a={class:"employee-label"},ba={class:"employee-time"},ga={__name:"TimeTrackingDetailModal",props:{cellData:{type:Object,default:null}},emits:["close"],setup(s,{emit:b}){const a=s,T=b,v=W(1),d=W([]),f=W(!1),u=W(null),p=W(1),G=W(10),J=N(()=>{var C,$,O,R,B,V;if(!a.cellData)return"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç";if(v.value===2)return`–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: ${((C=a.cellData.employee)==null?void 0:C.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}, –ù–µ–¥–µ–ª—è ${(($=a.cellData.week)==null?void 0:$.weekNumber)||"?"}`;if(a.cellData.type==="employee")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${((O=a.cellData.employee)==null?void 0:O.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫"}`;if(a.cellData.type==="week")return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: –ù–µ–¥–µ–ª—è ${((R=a.cellData.week)==null?void 0:R.weekNumber)||"?"}`;const l=((B=a.cellData.employee)==null?void 0:B.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫",t=((V=a.cellData.week)==null?void 0:V.weekNumber)||"?",y=P(a.cellData.elapsedTime||0);return`–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è: ${l}, –ù–µ–¥–µ–ª—è ${t} (${y})`}),F=N(()=>{var t,y;if(!((y=(t=a.cellData)==null?void 0:t.week)!=null&&y.employees))return 0;const l=a.cellData.week.employees.find(C=>{var $;return C.id===(($=a.cellData.employee)==null?void 0:$.id)});return(l==null?void 0:l.tasksCount)||0}),w=N(()=>{var t,y;if(!((y=(t=a.cellData)==null?void 0:t.week)!=null&&y.employees))return 0;const l=a.cellData.week.employees.find(C=>{var $;return C.id===(($=a.cellData.employee)==null?void 0:$.id)});return(l==null?void 0:l.ticketsCount)||0});N(()=>{var l,t;return((t=(l=a.cellData)==null?void 0:l.week)==null?void 0:t.weekNumber)||null});const c=W({totalTasks:0,currentPage:1,perPage:10,totalPages:0}),k=N(()=>c.value.totalPages),_=N(()=>d.value),D=N(()=>{const l=[];let y=Math.max(1,c.value.currentPage-Math.floor(2.5)),C=Math.min(k.value,y+5-1);C-y<4&&(y=Math.max(1,C-5+1));for(let $=y;$<=C;$++)l.push($);return l}),m=l=>{if(!l||l.length===0)return"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω";if(l.length===1)return ee(l[0].week.weekNumber,l[0].week.weekStartUtc);const t=l[0].week,y=l[l.length-1].week;return`${ee(t.weekNumber,t.weekStartUtc)} - ${ee(y.weekNumber,y.weekStartUtc)}`},E=l=>l?ee(l.weekNumber,l.weekStartUtc):"–ü–µ—Ä–∏–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω",x=l=>{if(!l)return"-";try{const t=new Date(l);return isNaN(t.getTime())?"-":t.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return console.warn("[TimeTrackingDetailModal] Error formatting date:",l,t),"-"}},A=(l,t)=>{if(t)try{const y=new Date(t);if(!isNaN(y.getTime()))return!1}catch{}if(!l)return!1;try{const y=new Date(l);return isNaN(y.getTime())?!1:new Date>y}catch(y){return console.warn("[TimeTrackingDetailModal] Error checking overdue:",l,y),!1}},K=l=>{const t=l.closedDate?new Date(l.closedDate):null,y=A(l.deadline,l.closedDate);return{"task-card--completed":!!t,"task-card--overdue":y,"task-card--in-progress":!t&&!y}},Z=async()=>{v.value=2,await se()},Q=()=>{v.value=1,d.value=[],u.value=null,p.value=1,c.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0}},X=l=>!l||typeof l!="object"?!1:!l.id||typeof l.id!="number"?(console.warn("[TimeTrackingDetailModal] Invalid task (no ID):",l),!1):!0,se=async()=>{var l,t,y,C,$,O,R,B,V;if(!((t=(l=a.cellData)==null?void 0:l.week)!=null&&t.employees)||!a.cellData.employee){u.value="–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á";return}f.value=!0,u.value=null;try{const L=a.cellData.week.employees.find(h=>{var ne;return h.id===((ne=a.cellData.employee)==null?void 0:ne.id)});if(!L){d.value=[];return}let n=[];if(Array.isArray(L.tasks)&&L.tasks.length>0&&(n=L.tasks.map(h=>typeof h=="object"&&h!==null&&h.id?h.id:typeof h=="number"?h:null).filter(h=>h!==null&&h>0)),n.length===0){d.value=[];return}const g=await ue.getTasksDetails({taskIds:n,employeeId:a.cellData.employee.id,weekNumber:a.cellData.week.weekNumber,page:p.value,perPage:G.value});if(!g||!Array.isArray(g.tasks)){console.error("[TimeTrackingDetailModal] Invalid response format:",g),u.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞",d.value=[];return}d.value=g.tasks.filter(X),c.value=g.pagination||{totalTasks:0,currentPage:1,perPage:G.value,totalPages:0},p.value=c.value.currentPage}catch(L){console.error("[TimeTrackingDetailModal] Error loading tasks details:",{error:L,taskIds:((R=(O=($=(C=(y=a.cellData)==null?void 0:y.week)==null?void 0:C.employees)==null?void 0:$.find(g=>{var h;return g.id===((h=a.cellData.employee)==null?void 0:h.id)}))==null?void 0:O.tasks)==null?void 0:R.map(g=>g.id))||[],employeeId:(B=a.cellData.employee)==null?void 0:B.id,weekNumber:(V=a.cellData.week)==null?void 0:V.weekNumber,timestamp:new Date().toISOString()});const n=L.message||"";n.includes("network")||n.includes("fetch")||n.includes("Failed to fetch")?u.value="–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.":n.includes("timeout")?u.value="–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":n.includes("403")||n.includes("401")?u.value="–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.":n.includes("404")?u.value="–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.":n.includes("500")?u.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":u.value=n||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á",d.value=[]}finally{f.value=!1}},me=()=>{p.value=1,se()};re(p,()=>{v.value===2&&se()});const le=l=>{if(l>=1&&l<=k.value&&l!==p.value){p.value=l;const t=document.querySelector(".tasks-cards-container");t&&(t.scrollTop=0)}},ke=l=>{console.log("[TimeTrackingDetailModal] Task clicked:",l.id)},Y=()=>{T("close")};return re(()=>a.cellData,l=>{l||(v.value=1,d.value=[],u.value=null,p.value=1,c.value={totalTasks:0,currentPage:1,perPage:10,totalPages:0})}),(l,t)=>(o(),te(ye,{to:"body"},[s.cellData?(o(),r("div",{key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:oe(Y,["self"]),onKeydown:pe(Y,["esc"])},[e("div",{class:"modal-content",onClick:t[2]||(t[2]=oe(()=>{},["stop"]))},[e("div",et,[e("h2",null,i(J.value),1),e("button",{class:"close-button",onClick:Y,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å"},"√ó")]),e("div",tt,[z(ie,{name:"level",mode:"out-in"},{default:H(()=>{var y,C,$,O,R,B,V,L;return[v.value===1&&(s.cellData.type==="cell"||!s.cellData.type&&s.cellData.employee&&s.cellData.week)?(o(),r("div",at,[e("div",st,[e("p",null,[t[3]||(t[3]=e("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),S(" "+i(((y=s.cellData.employee)==null?void 0:y.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),S(" "+i(((C=s.cellData.week)==null?void 0:C.weekNumber)||"?"),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),S(" "+i(M(P)(s.cellData.elapsedTime||0)),1)])]),($=s.cellData.week)!=null&&$.employees?(o(),r("div",lt,[t[8]||(t[8]=e("h3",null,"–ó–∞–¥–∞—á–∏ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã:",-1)),(o(!0),r(I,null,j(s.cellData.week.employees.filter(n=>{var g;return n.id===((g=s.cellData.employee)==null?void 0:g.id)}),n=>(o(),r("div",{key:n.id,class:"employee-tasks"},[(o(!0),r(I,null,j(n.tasks,(g,h)=>(o(),r("div",{class:"task-item",key:h},[e("div",nt,[e("span",ot,"–ó–∞–¥–∞—á–∞ #"+i(g.id||h+1),1),e("span",it,i(M(P)(g.elapsedTime||0)),1)]),g.ticket?(o(),r("div",rt,[e("span",ct,"–¢–∏–∫–µ—Ç #"+i(g.ticket.id),1),g.ticket.createdWeek&&g.ticket.createdWeek!==s.cellData.week.weekNumber?(o(),r("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${g.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${s.cellData.week.weekNumber}`}," (—Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ "+i(g.ticket.createdWeek)+") ",9,dt)):U("",!0),g.ticket.title?(o(),r("div",ut,i(g.ticket.title),1)):U("",!0)])):(o(),r("div",mt,[...t[6]||(t[6]=[e("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])]))]))),128))]))),128)),e("div",kt,[e("p",null,[t[7]||(t[7]=e("strong",null,"–ò—Ç–æ–≥–æ:",-1)),S(" "+i(M(P)(s.cellData.elapsedTime||0))+" ("+i(F.value)+" –∑–∞–¥–∞—á, "+i(w.value)+" —Ç–∏–∫–µ—Ç–æ–≤) ",1)])]),F.value>0?(o(),r("div",vt,[e("button",{class:"btn btn-primary btn-tasks-list",onClick:Z}," üìã –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á ")])):U("",!0)])):U("",!0)])):v.value===2?(o(),r("div",pt,[e("div",yt,[e("button",{class:"btn-back",onClick:Q,"aria-label":"–ù–∞–∑–∞–¥"}," ‚Üê –ù–∞–∑–∞–¥ "),e("h3",_t," –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á: "+i(((O=s.cellData.employee)==null?void 0:O.name)||"–°–æ—Ç—Ä—É–¥–Ω–∏–∫")+", –ù–µ–¥–µ–ª—è "+i(((R=s.cellData.week)==null?void 0:R.weekNumber)||"?"),1)]),e("div",bt,[z(ie,{name:"loading",mode:"out-in"},{default:H(()=>[f.value?(o(),r("div",gt,[...t[9]||(t[9]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...",-1)])])):u.value?(o(),r("div",ft,[t[10]||(t[10]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),t[11]||(t[11]=e("p",{class:"error-title"},"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",wt,i(u.value),1),e("button",{class:"btn btn-retry",onClick:me},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):d.value.length===0?(o(),r("div",Tt,[...t[12]||(t[12]=[e("div",{class:"empty-state-icon"},"üìã",-1),e("p",{class:"empty-state-message"},"–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)])])):(o(),r("div",ht,[z(ve,{name:"task-card",tag:"div",class:"tasks-cards-list"},{default:H(()=>[(o(!0),r(I,null,j(_.value.filter(X),n=>{var g,h;return o(),r("div",{key:n.id,class:q(["task-card",K(n)]),onClick:ne=>ke(n)},[e("div",$t,[e("span",Ct,"–ó–∞–¥–∞—á–∞ #"+i(n.id),1),n.elapsedTime?(o(),r("span",Nt,i(M(P)(n.elapsedTime)),1)):U("",!0)]),e("div",Pt,i(n.title||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),e("div",Et,[e("div",St,[t[13]||(t[13]=e("span",{class:"date-icon"},"üìÖ",-1)),t[14]||(t[14]=e("span",{class:"date-label"},"–ù–∞—á–∞–ª–æ:",-1)),e("span",Ut,i(x(n.startDate)),1)]),e("div",Wt,[t[15]||(t[15]=e("span",{class:"date-icon"},"‚è∞",-1)),t[16]||(t[16]=e("span",{class:"date-label"},"–î–µ–¥–ª–∞–π–Ω:",-1)),e("span",{class:q(["date-value",{"date-value--overdue":A(n.deadline,n.closedDate)}])},i(x(n.deadline)||"-"),3)]),e("div",Mt,[t[17]||(t[17]=e("span",{class:"date-icon"},"‚úì",-1)),t[18]||(t[18]=e("span",{class:"date-label"},"–ó–∞–≤–µ—Ä—à–µ–Ω–æ:",-1)),e("span",xt,i(x(n.closedDate)||"-"),1)])]),n.ticket?(o(),r("div",Lt,[e("div",It,[e("div",jt,[e("span",At,"–¢–∏–∫–µ—Ç #"+i(n.ticket.id),1),n.ticket.createdWeek&&n.ticket.createdWeek!==((g=s.cellData.week)==null?void 0:g.weekNumber)?(o(),r("span",{key:0,class:"ticket-week-badge",title:`–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥–µ–ª–µ ${n.ticket.createdWeek}, —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –Ω–µ–¥–µ–ª–µ ${(h=s.cellData.week)==null?void 0:h.weekNumber}`}," –°–æ–∑–¥–∞–Ω –≤ –Ω–µ–¥. "+i(n.ticket.createdWeek),9,Ot)):U("",!0)])]),e("div",Rt,i(n.ticket.title||n.ticket.ufSubject||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),e("div",Bt,[e("div",Vt,[e("div",Ft,[t[19]||(t[19]=e("span",{class:"meta-label"},"–°–µ–∫—Ç–æ—Ä:",-1)),e("span",qt,i(n.ticket.ufSlaBlockStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)]),e("div",zt,[t[20]||(t[20]=e("span",{class:"meta-label"},"–°–µ—Ä–≤–∏—Å:",-1)),e("span",Ht,i(n.ticket.ufSlaServiceStr||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])]),e("div",Gt,[e("div",Jt,[t[21]||(t[21]=e("span",{class:"meta-label"},"–î–µ–π—Å—Ç–≤–∏–µ:",-1)),e("span",Kt,i(n.ticket.ufActionStr||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"),1)]),e("div",Zt,[t[22]||(t[22]=e("span",{class:"meta-label"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:",-1)),e("span",Qt,i(n.ticket.ufCrm7UfPriority||"–ù–µ —É–∫–∞–∑–∞–Ω"),1)])])]),e("div",Xt,[e("div",Yt,[t[23]||(t[23]=e("span",{class:"date-icon"},"üìÖ",-1)),t[24]||(t[24]=e("span",{class:"date-label"},"–°–æ–∑–¥–∞–Ω:",-1)),e("span",ea,i(x(n.ticket.createdTime)),1)])])])):(o(),r("div",ta,[...t[25]||(t[25]=[e("span",{class:"no-ticket-label"},"–¢–∏–∫–µ—Ç –Ω–µ —Å–≤—è–∑–∞–Ω",-1)])])),t[26]||(t[26]=e("div",{class:"task-card__status-placeholder"},null,-1))],10,Dt)}),128))]),_:1}),k.value>1?(o(),r("div",aa,[e("button",{class:"pagination-btn",disabled:c.value.currentPage===1,onClick:t[0]||(t[0]=n=>le(c.value.currentPage-1))}," ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è ",8,sa),e("div",la,[(o(!0),r(I,null,j(D.value,n=>(o(),r("button",{key:n,class:q(["pagination-page",{"pagination-page--active":n===c.value.currentPage}]),onClick:g=>le(n)},i(n),11,na))),128))]),e("button",{class:"pagination-btn",disabled:c.value.currentPage===k.value,onClick:t[1]||(t[1]=n=>le(c.value.currentPage+1))}," –°–ª–µ–¥—É—é—â–∞—è ‚Üí ",8,oa)])):U("",!0)]))]),_:1})])])):v.value===1&&s.cellData.type==="employee"?(o(),r("div",ia,[e("div",ra,[e("p",null,[t[27]||(t[27]=e("strong",null,"–°–æ—Ç—Ä—É–¥–Ω–∏–∫:",-1)),S(" "+i(((B=s.cellData.employee)==null?void 0:B.name)||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"),1)]),e("p",null,[t[28]||(t[28]=e("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),S(" "+i(m(s.cellData.weeks)),1)])]),e("div",ca,[t[29]||(t[29]=e("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –Ω–µ–¥–µ–ª—è–º:",-1)),(o(!0),r(I,null,j(s.cellData.weeks,n=>(o(),r("div",{key:n.week.weekNumber,class:"week-item"},[e("div",da,[e("span",ua,"–ù–µ–¥–µ–ª—è "+i(n.week.weekNumber),1),e("span",ma,i(M(P)(n.elapsedTime||0)),1)])]))),128))])])):v.value===1&&s.cellData.type==="week"?(o(),r("div",ka,[e("div",va,[e("p",null,[t[30]||(t[30]=e("strong",null,"–ù–µ–¥–µ–ª—è:",-1)),S(" "+i(((V=s.cellData.week)==null?void 0:V.weekNumber)||"?"),1)]),e("p",null,[t[31]||(t[31]=e("strong",null,"–ü–µ—Ä–∏–æ–¥:",-1)),S(" "+i(E(s.cellData.week)),1)]),e("p",null,[t[32]||(t[32]=e("strong",null,"–û–±—â–∏–µ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:",-1)),S(" "+i(M(P)(((L=s.cellData.week)==null?void 0:L.totalElapsedTime)||0)),1)])]),e("div",pa,[t[33]||(t[33]=e("h3",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:",-1)),(o(!0),r(I,null,j(s.cellData.employees,n=>(o(),r("div",{key:n.employee.id,class:"employee-item"},[e("div",ya,[e("span",_a,i(n.employee.name),1),e("span",ba,i(M(P)(n.elapsedTime||0)),1)])]))),128))])])):U("",!0)]}),_:1})]),e("div",{class:"modal-footer"},[e("button",{class:"close-btn",onClick:Y},"–ó–∞–∫—Ä—ã—Ç—å")])])],32)):U("",!0)]))}},fa=ae(ga,[["__scopeId","data-v-fc33390b"]]),wa={class:"tickets-time-tracking-dashboard"},Ta={class:"dashboard-header"},ha={class:"breadcrumbs-row"},Da=["aria-label","aria-disabled","data-fallback","disabled"],$a={class:"breadcrumbs","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è"},Ca={key:"preloader",class:"time-tracking-preloader"},Na={key:"error",class:"error-state"},Pa={key:"empty",class:"empty-state"},Ea={key:"content",class:"dashboard-content"},Sa={__name:"TicketsTimeTrackingDashboard",setup(s){const b=be(),a=W(!0),T=W(null),v=W(null),d=W(null),f=W(!1),u=N(()=>he(v.value)),p=async()=>{a.value=!0,T.value=null;const D=new Promise(m=>setTimeout(m,300));try{const[m,E]=await Promise.all([D,ue.getTimeTrackingData({product:"1C",weeksCount:4})]);v.value=E}catch(m){console.error("[TicketsTimeTrackingDashboard] Error loading data:",m),T.value=m.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}finally{a.value=!1}},G=D=>{d.value=D},J=D=>{d.value={type:"employee",...D}},F=D=>{d.value={type:"week",...D}},w=()=>{d.value=null},c=N(()=>typeof window>"u"?!1:window.history.length>1),k=N(()=>c.value?"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"),_=()=>{f.value||(f.value=!0,c.value?b.go(-1):b.push({name:"dashboard-sector-1c"}),setTimeout(()=>{f.value=!1},300))};return _e(()=>{p()}),(D,m)=>{const E=ge("router-link");return o(),r("div",wa,[e("div",Ta,[e("div",ha,[e("button",{class:"btn-back-link",type:"button",onClick:_,"aria-label":k.value,"aria-disabled":!c.value,"data-fallback":!c.value,disabled:f.value,title:"–ù–∞–∑–∞–¥"}," ‚Üê ",8,Da),e("nav",$a,[z(E,{to:{name:"dashboard-sector-1c"},class:"breadcrumb-link"},{default:H(()=>[...m[0]||(m[0]=[S(" –î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ",-1)])]),_:1}),m[3]||(m[3]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),z(E,{to:{name:"dashboard-graph-state"},class:"breadcrumb-link"},{default:H(()=>[...m[1]||(m[1]=[S(" –ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è ",-1)])]),_:1}),m[4]||(m[4]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),z(E,{to:{name:"dashboard-graph-admission-closure"},class:"breadcrumb-link"},{default:H(()=>[...m[2]||(m[2]=[S(" –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π ",-1)])]),_:1}),m[5]||(m[5]=e("span",{class:"breadcrumb-separator","aria-hidden":"true"},"/",-1)),m[6]||(m[6]=e("span",{class:"breadcrumb-current"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã",-1))])])]),m[9]||(m[9]=e("h1",{class:"dashboard-title"},"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),U("",!0),z(ie,{name:"fade",mode:"out-in"},{default:H(()=>[a.value?(o(),r("div",Ca,[...m[7]||(m[7]=[e("div",{class:"preloader-content"},[e("div",{class:"preloader-spinner"},[e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"})]),e("h3",{class:"preloader-title"},"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"),e("p",{class:"preloader-message"},"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö..."),e("div",{class:"preloader-dots"},[e("span",{class:"dot"}),e("span",{class:"dot"}),e("span",{class:"dot"})])],-1)])])):T.value?(o(),r("div",Na,[e("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: "+i(T.value),1),e("button",{onClick:p,class:"retry-button"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):u.value?(o(),r("div",Ea,[v.value?(o(),te(Ie,{key:0,data:v.value},null,8,["data"])):U("",!0),v.value?(o(),te(Ye,{key:1,data:v.value,loading:a.value,error:T.value,onCellClick:G,onEmployeeClick:J,onWeekClick:F},null,8,["data","loading","error"])):U("",!0)])):(o(),r("div",Pa,[...m[8]||(m[8]=[e("p",null,"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])]))]),_:1}),d.value?(o(),te(fa,{key:1,"cell-data":d.value,onClose:w},null,8,["cell-data"])):U("",!0)])}}},Wa=ae(Sa,[["__scopeId","data-v-f9084975"]]);export{Wa as default};
