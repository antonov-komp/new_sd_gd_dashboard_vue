import{l as T,c as r,e as i,W as R,X as q,b as k,r as E,o as a,F as D,j as C,f as O,g as b,Y as ue,t as l,k as me,n as U,a as A,w as P,C as z,x as K,h as Q,q as G,s as ke,A as ve,G as he,i as $,u as ee,p as te,T as H,Z as fe}from"./chunk-q4E_n_Zn.js";import{T as se}from"./chunk-CrmXC1Fv.js";import{_ as N,u as ie,A as ye,i as pe}from"./main-Dt-DWH8u.js";import{L as ne,a as B,g as j,T as _e,D as F,n as Te,C as J,c as be,i as Se}from"./chunk-D8irmMFq.js";import"./chunk-C-QDJ0Zs.js";import"./chunk-D15Haoqg.js";import"./chunk-yzaUG9vQ.js";import"./chunk-D85qNiqy.js";import"./chunk-CVoFfQ50.js";import"./chunk-D7at5FQX.js";const De={name:"ZeroPoint",components:{TicketCard:se},props:{tickets:{type:Array,required:!0,default:()=>[]},stageId:{type:String,required:!0}},emits:{"ticket-dragged":s=>typeof s=="object"&&s!==null,"ticket-assigned":s=>typeof s=="object"&&s!==null,"ticket-clicked":s=>typeof s=="object"&&s!==null},setup(s,{emit:t}){return{hasTickets:T(()=>Array.isArray(s.tickets)&&s.tickets.length>0),handleTicketDragStart:u=>{t("ticket-dragged",u)}}}},Ce={class:"zero-point"},Ie={key:0,class:"empty-state"};function Ae(s,t,o,e,u,_){const n=E("TicketCard");return a(),r("div",Ce,[t[3]||(t[3]=i("div",{class:"zero-point-header"},[i("h3",null,"–ù—É–ª–µ–≤–∞—è —Ç–æ—á–∫–∞")],-1)),R([o.tickets.length,o.tickets.map(c=>c.id).join(",")],()=>(a(),r("div",{class:"zero-point-tickets"},[(a(!0),r(D,null,C(o.tickets,c=>(a(),O(n,{key:c.id,ticket:c,draggable:!0,onDragStart:g=>e.handleTicketDragStart(c),onClick:g=>s.$emit("ticket-clicked",c)},null,8,["ticket","onDragStart","onClick"]))),128))])),t,0),t[1]||(q(-1,!0),(t[1]=e.hasTickets?k("",!0):(a(),r("div",Ie,[...t[2]||(t[2]=[i("p",null,"–ù–µ—Ç –Ω–µ—Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –≤ —Å—Ç–∞–¥–∏–∏",-1)])]))).cacheIndex=1,q(1),t[1])])}const Ee=N(De,[["render",Ae],["__scopeId","data-v-c5370e55"]]);function we(s){return typeof s=="number"&&s>0&&!isNaN(s)}function oe(s){return typeof s=="number"&&s>0&&!isNaN(s)}function ae(s){return typeof s=="string"&&["formed","review","execution"].includes(s)}function Ne(s){return!s||typeof s!="object"?!1:we(s.id)&&typeof s.title=="string"&&s.title.trim().length>0}function re(s,t,o){return!(!Ne(s)||!oe(t)||!ae(o)||s.assigneeId===t&&s.stageId===o)}function Oe(s){const t=[];return!s||typeof s!="object"?(t.push("–î–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º"),{valid:!1,errors:t}):((!s.title||typeof s.title!="string"||s.title.trim().length===0)&&t.push("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"),s.stageId&&!ae(s.stageId)&&t.push("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Å—Ç–∞–¥–∏–∏"),s.employeeId&&!oe(s.employeeId)&&t.push("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"),{valid:t.length===0,errors:t})}function Le(s){const t=ie(),o=b(!1);return{isDropZoneActive:o,handleDragStart:(g,d)=>{g.dataTransfer.effectAllowed="move",g.dataTransfer.setData("application/json",JSON.stringify(d)),g.dataTransfer.setDragImage(g.target,0,0)},handleDragOver:g=>{g.preventDefault(),g.dataTransfer.dropEffect="move",o.value=!0},handleDragLeave:g=>{const d=g.currentTarget.getBoundingClientRect(),m=g.clientX,p=g.clientY;(m<d.left||m>d.right||p<d.top||p>d.bottom)&&(o.value=!1)},handleDrop:async(g,d,m)=>{g.preventDefault(),o.value=!1;const p=g.dataTransfer.getData("application/json");if(p)try{const v=JSON.parse(p);if(!re(v,d,m)){t.warning("–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–∫–µ—Ç —Å—é–¥–∞");return}s&&typeof s=="function"&&await s(v,d,m)}catch(v){ne.error("Error parsing ticket data","useDragAndDrop",v),t.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ç–∞")}},handleDragEnd:g=>{o.value=!1}}}function le(s=null){const t=ue(),o=t?.type?.name||t?.type?.__name||null,e=s||o||"Unknown",u=(d,m,p=null)=>{ne.log(d,m,e,p)};return{error:(d,m=null)=>{u("ERROR",d,m)},warn:(d,m=null)=>{u("WARN",d,m)},info:(d,m=null)=>{u("INFO",d,m)},debug:(d,m=null)=>{u("DEBUG",d,m)},log:u,context:e}}const Be={name:"EmployeeColumn",components:{TicketCard:se},props:{employee:{type:Object,required:!0},stageId:{type:String,required:!0}},emits:["ticket-clicked","ticket-dropped"],setup(s,{emit:t}){le("EmployeeColumn");const e=Le(async(m,p,v)=>{t("ticket-dropped",m,p)}),u=T(()=>s.employee.isFromSector1C?Array.isArray(s.employee.tickets)?s.employee.tickets:[]:Array.isArray(s.employee.ticketsInsideSector)?s.employee.ticketsInsideSector:[]),_=T(()=>s.employee.isFromSector1C?[]:Array.isArray(s.employee.ticketsOutsideSector)?s.employee.ticketsOutsideSector:Array.isArray(s.employee.tickets)?s.employee.tickets:[]),n=T(()=>s.employee.isFromSector1C?Array.isArray(s.employee.tickets)?s.employee.tickets:[]:[]),c=T(()=>u.value.length+_.value.length),g=m=>{e.handleDrop(m,s.employee.id,s.stageId)},d=m=>{};return{isDropZoneActive:e.isDropZoneActive,handleDragOver:e.handleDragOver,handleDragLeave:e.handleDragLeave,handleDrop:g,ticketsInsideSector:u,ticketsOutsideSector:_,ticketsToDisplay:n,totalTicketsCount:c,handleTicketDragStart:d}}},Pe={class:"employee-header"},xe={class:"employee-info"},Re={class:"employee-details"},je={class:"employee-name"},Ue={key:0,class:"employee-position"},ze={class:"tickets-count"},Fe={class:"tickets-list"},Me={class:"section-header"},Ve={class:"section-count"},We={key:2,class:"empty-state"};function qe(s,t,o,e,u,_){const n=E("TicketCard");return a(),r("div",{class:U(["employee-column",{"drop-zone-active":e.isDropZoneActive}]),onDragover:t[3]||(t[3]=me((...c)=>e.handleDragOver&&e.handleDragOver(...c),["prevent"])),onDragleave:t[4]||(t[4]=(...c)=>e.handleDragLeave&&e.handleDragLeave(...c)),onDrop:t[5]||(t[5]=(...c)=>e.handleDrop&&e.handleDrop(...c))},[i("div",Pe,[i("div",xe,[t[6]||(t[6]=i("span",{class:"employee-icon"},"üë§",-1)),i("div",Re,[i("div",je,l(o.employee.name),1),o.employee.position?(a(),r("div",Ue,l(o.employee.position),1)):k("",!0)])]),i("div",ze," üìä –¢–∏–∫–µ—Ç–æ–≤: "+l(e.totalTicketsCount),1)]),i("div",Fe,[o.employee.isFromSector1C?R([e.ticketsToDisplay.length,e.ticketsToDisplay.map(c=>c.id).join(",")],()=>(a(),r("div",{key:0},[A(z,{name:"ticket",tag:"div"},{default:P(()=>[(a(!0),r(D,null,C(e.ticketsToDisplay,c=>(a(),O(n,{key:c.id,ticket:c,draggable:!0,onClick:g=>s.$emit("ticket-clicked",c),onDragStart:e.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),t,0):(a(),r(D,{key:1},[e.ticketsInsideSector.length>0?R([e.ticketsInsideSector.length,e.ticketsInsideSector.map(c=>c.id).join(",")],()=>(a(),r("div",{key:0,class:"tickets-section tickets-inside-sector"},[A(z,{name:"ticket",tag:"div"},{default:P(()=>[(a(!0),r(D,null,C(e.ticketsInsideSector,c=>(a(),O(n,{key:c.id,ticket:c,draggable:!0,onClick:g=>s.$emit("ticket-clicked",c),onDragStart:e.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),t,1):k("",!0),e.ticketsOutsideSector.length>0?R([e.ticketsOutsideSector.length,e.ticketsOutsideSector.map(c=>c.id).join(",")],()=>(a(),r("div",{key:1,class:"tickets-section tickets-outside-sector"},[i("div",Me,[t[7]||(t[7]=i("span",{class:"section-badge"},"–í–Ω–µ —Å–µ–∫—Ç–æ—Ä–∞",-1)),i("span",Ve,l(e.ticketsOutsideSector.length),1)]),A(z,{name:"ticket",tag:"div"},{default:P(()=>[(a(!0),r(D,null,C(e.ticketsOutsideSector,c=>(a(),O(n,{key:c.id,ticket:c,draggable:!0,class:"ticket-outside-sector",onClick:g=>s.$emit("ticket-clicked",c),onDragStart:e.handleTicketDragStart},null,8,["ticket","onClick","onDragStart"]))),128))]),_:1})])),t,2):k("",!0)],64)),e.totalTicketsCount===0?(a(),r("div",We,[...t[8]||(t[8]=[i("p",null,"–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤",-1)])])):k("",!0)])],34)}const Ge=N(Be,[["render",qe],["__scopeId","data-v-cdec5b5c"]]),He={name:"DashboardStage",components:{ZeroPoint:Ee,EmployeeColumn:Ge},props:{stage:{type:Object,required:!0},zeroPointTickets:{type:Array,default:()=>[]}},emits:["ticket-moved","ticket-assigned","ticket-clicked"],setup(s,{emit:t}){const o=le("DashboardStage"),e=b(!1),u=T(()=>{const v=Array.isArray(s.zeroPointTickets)?s.zeroPointTickets.length:0,h=Array.isArray(s.stage.employees)?s.stage.employees.reduce((y,f)=>Array.isArray(f.ticketsInsideSector)?y+f.ticketsInsideSector.length:f.isFromSector1C&&Array.isArray(f.tickets)?y+f.tickets.length:y,0):0;return v+h}),_=T(()=>Array.isArray(s.stage.employees)?s.stage.employees.reduce((v,h)=>Array.isArray(h.ticketsOutsideSector)?v+h.ticketsOutsideSector.length:!h.isFromSector1C&&Array.isArray(h.tickets)?v+h.tickets.length:v,0):0),n=T(()=>u.value+_.value),c=T(()=>{const v=s.stage?.name||"–°—Ç–∞–¥–∏—è",h=u.value,y=_.value;return y===0?`${v} (${h})`:`${v} (${h} / ${y})`});return{isDragging:e,ticketsCountInsideSector:u,ticketsCountOutsideSector:_,totalTicketsCount:n,stageNameWithCount:c,handleTicketDragged:v=>{e.value=!0},handleTicketAssigned:(v,h)=>{t("ticket-assigned",v,h)},handleTicketDropped:(v,h)=>{t("ticket-moved",v,h,s.stage.id),e.value=!1},handleTicketClicked:v=>{o.debug("Ticket clicked",v),t("ticket-clicked",v)}}}},Je={class:"stage-header"},Ze={class:"stage-content"},Xe={class:"employees-container"};function Ye(s,t,o,e,u,_){const n=E("ZeroPoint"),c=E("EmployeeColumn");return a(),r("div",{class:"dashboard-stage",style:K({borderLeftColor:o.stage.color})},[i("div",Je,[i("h2",null,l(e.stageNameWithCount),1)]),i("div",Ze,[A(n,{tickets:o.zeroPointTickets,"stage-id":o.stage.id,onTicketDragged:e.handleTicketDragged,onTicketAssigned:e.handleTicketAssigned,onTicketClicked:e.handleTicketClicked},null,8,["tickets","stage-id","onTicketDragged","onTicketAssigned","onTicketClicked"]),i("div",Xe,[(a(!0),r(D,null,C(o.stage.employees,g=>(a(),O(c,{key:g.id,employee:g,"stage-id":o.stage.id,onTicketClicked:e.handleTicketClicked,onTicketDropped:e.handleTicketDropped},null,8,["employee","stage-id","onTicketClicked","onTicketDropped"]))),128))])])],4)}const Ke=N(He,[["render",Ye],["__scopeId","data-v-c6fbde76"]]),M={cache_check:{title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞",description:"–ü–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."},cache_hit:{title:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",description:"–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞..."},loading_tickets:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24..."},filtering:{title:"–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤",description:"–û—Ç–±–æ—Ä —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°..."},extracting_employees:{title:"–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ê–Ω–∞–ª–∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."},loading_employees:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö..."},grouping:{title:"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",description:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º..."},caching:{title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à",description:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."},complete:{title:"–ì–æ—Ç–æ–≤–æ!",description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"},error:{title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}},Qe={loading_tickets:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24..."},filtering:{title:"–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤",description:"–û—Ç–±–æ—Ä —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°..."},extracting_employees:{title:"–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ê–Ω–∞–ª–∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤..."},loading_employees:{title:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",description:"–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö..."},grouping:{title:"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",description:"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —ç—Ç–∞–ø–∞–º..."},caching:{title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à",description:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫..."},cache_check:{title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞",description:"–ü–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."},cache_hit:{title:"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",description:"–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞..."},complete:{title:"–ì–æ—Ç–æ–≤–æ!",description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"},error:{title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",description:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}},$e={name:"LoadingPreloader",props:{currentStep:{type:String,default:null},progress:{type:Number,default:0},stepDetails:{type:Object,default:()=>({})},error:{type:String,default:null}},emits:["retry"],setup(s,{emit:t}){const o=T(()=>{const{currentStep:d,stepDetails:m}=s;return m?.description?{title:d?M[d]?.title||d:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:m.description}:d?M[d]?M[d]:Qe[d]||{title:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ..."}:{title:"–ó–∞–≥—Ä—É–∑–∫–∞...",description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è..."}}),e=T(()=>o.value.title),u=T(()=>o.value.description),_=T(()=>s.stepDetails),n=T(()=>{const d=s.progress;return d==null||isNaN(d)?0:Math.round(Math.max(0,Math.min(100,d)))});return{stepTitle:e,stepDescription:u,details:_,displayProgress:n,getStageDisplayName:d=>d?{"DT140_12:UC_0VHWE2":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","DT140_12:PREPARATION":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó","DT140_12:CLIENT":"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ","–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ":"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ","–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó":"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ"}[d]||d:"",handleRetry:()=>{t("retry")}}}},et={class:"preloader-backdrop"},tt={class:"preloader-container"},st={class:"preloader-content-scrollable"},it={key:0,class:"spinner-container"},nt={class:"preloader-content"},ot={class:"step-title"},at={key:0,class:"step-description"},rt={key:1,class:"progress-container"},lt={class:"progress-bar"},ct={class:"progress-text"},dt={key:2,class:"step-details"},gt={key:0,class:"detail-description"},ut={key:1,class:"detail-item"},mt={class:"detail-value"},kt={key:0,class:"detail-total"},vt={key:2,class:"detail-item"},ht={class:"detail-value"},ft={key:0,class:"detail-total"},yt={key:3,class:"detail-item"},pt={class:"detail-value"},_t={key:0,class:"detail-total"},Tt={key:4,class:"detail-item"},bt={class:"detail-value"},St={key:5,class:"detail-warning"},Dt={key:0,class:"error-container"},Ct={class:"error-content"},It={class:"error-message"};function At(s,t,o,e,u,_){return a(),r("div",{class:U(["loading-preloader",{"has-error":o.error}])},[i("div",et,[i("div",tt,[i("div",st,[o.error?k("",!0):(a(),r("div",it,[...t[1]||(t[1]=[i("div",{class:"spinner"},null,-1)])])),i("div",nt,[i("h3",ot,l(e.stepTitle),1),e.stepDescription?(a(),r("p",at,l(e.stepDescription),1)):k("",!0),o.error?k("",!0):(a(),r("div",rt,[i("div",lt,[i("div",{class:"progress-fill",style:K({width:e.displayProgress+"%"})},null,4)]),i("span",ct,l(e.displayProgress)+"%",1)])),o.error?k("",!0):(a(),r("div",dt,[e.details.description?(a(),r("div",gt,l(e.details.description),1)):k("",!0),e.details.count!==void 0?(a(),r("div",ut,[t[2]||(t[2]=i("span",{class:"detail-label"},"–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–∏–∫–µ—Ç–æ–≤:",-1)),i("span",mt,l(e.details.count),1),e.details.total!==void 0?(a(),r("span",kt," –∏–∑ "+l(e.details.total),1)):k("",!0)])):k("",!0),e.details.filteredTickets!==void 0?(a(),r("div",vt,[t[3]||(t[3]=i("span",{class:"detail-label"},"–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Ç–∏–∫–µ—Ç–æ–≤:",-1)),i("span",ht,l(e.details.filteredTickets),1),e.details.totalTickets!==void 0?(a(),r("span",ft," –∏–∑ "+l(e.details.totalTickets),1)):k("",!0)])):k("",!0),e.details.stage?(a(),r("div",yt,[t[4]||(t[4]=i("span",{class:"detail-label"},"–°—Ç–∞–¥–∏—è:",-1)),i("span",pt,l(e.getStageDisplayName(e.details.stage)),1),e.details.stageIndex&&e.details.totalStages?(a(),r("span",_t," ("+l(e.details.stageIndex)+"/"+l(e.details.totalStages)+") ",1)):k("",!0)])):k("",!0),e.details.employeeCount!==void 0?(a(),r("div",Tt,[t[5]||(t[5]=i("span",{class:"detail-label"},"–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",-1)),i("span",bt,l(e.details.employeeCount),1)])):k("",!0),e.details.warning?(a(),r("div",St,[i("span",null,"‚ö†Ô∏è "+l(e.details.warning),1)])):k("",!0)]))])])])]),o.error?(a(),r("div",Dt,[i("div",Ct,[t[6]||(t[6]=i("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),i("p",It,l(o.error),1),i("button",{onClick:t[0]||(t[0]=(...n)=>e.handleRetry&&e.handleRetry(...n)),class:"retry-button"}," –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É ")])])):k("",!0)],2)}const Et=N($e,[["render",At],["__scopeId","data-v-d129ff19"]]),wt={name:"LoggerControl",props:{showControl:{type:Boolean,default:!1}},setup(){const s=b(!1),t=b("ERROR"),o=b(!0),e=g=>({NONE:"–û—Ç–∫–ª—é—á–µ–Ω–æ",ERROR:"–¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏",WARN:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏",INFO:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏",DEBUG:"–í—Å–µ –ª–æ–≥–∏ (–æ—Ç–ª–∞–¥–∫–∞)"})[g]||g;return Q(()=>{const g=B.getLevel();t.value=g,s.value=g!=="NONE"}),{enabled:s,level:t,isExpanded:o,getLevelDescription:e,handleToggle:()=>{s.value?(t.value==="NONE"&&(t.value="ERROR"),B.setLevel(t.value)):(B.setLevel("NONE"),t.value="NONE")},handleLevelChange:()=>{s.value&&B.setLevel(t.value)},resetToDefault:()=>{const g="ERROR";t.value=g,s.value=!0,B.setLevel(g)},toggleVisibility:()=>{o.value=!o.value}}}},Nt={key:0,class:"logger-control"},Ot={class:"logger-control-header"},Lt=["aria-label"],Bt={key:0,class:"logger-control-content"},Pt={class:"logger-control-section"},xt={class:"logger-control-label"},Rt={key:0,class:"logger-control-section"},jt={class:"logger-control-label"},Ut={key:1,class:"logger-control-info"},zt={class:"logger-control-info-text"},Ft={key:2,class:"logger-control-section"};function Mt(s,t,o,e,u,_){return o.showControl?(a(),r("div",Nt,[i("div",Ot,[t[6]||(t[6]=i("h3",{class:"logger-control-title"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º",-1)),i("button",{class:"logger-control-toggle",onClick:t[0]||(t[0]=(...n)=>e.toggleVisibility&&e.toggleVisibility(...n)),"aria-label":e.isExpanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"},l(e.isExpanded?"‚ñº":"‚ñ∂"),9,Lt)]),e.isExpanded?(a(),r("div",Bt,[i("div",Pt,[i("label",xt,[G(i("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=n=>e.enabled=n),onChange:t[2]||(t[2]=(...n)=>e.handleToggle&&e.handleToggle(...n)),class:"logger-control-checkbox"},null,544),[[ke,e.enabled]]),t[7]||(t[7]=i("span",{class:"logger-control-label-text"},"–í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ",-1))])]),e.enabled?(a(),r("div",Rt,[i("label",jt,[t[9]||(t[9]=i("span",{class:"logger-control-label-text"},"–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:",-1)),G(i("select",{"onUpdate:modelValue":t[3]||(t[3]=n=>e.level=n),onChange:t[4]||(t[4]=(...n)=>e.handleLevelChange&&e.handleLevelChange(...n)),class:"logger-control-select"},[...t[8]||(t[8]=[he('<option value="NONE" data-v-ed57067c>–û—Ç–∫–ª—é—á–µ–Ω–æ</option><option value="ERROR" data-v-ed57067c>–¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏</option><option value="WARN" data-v-ed57067c>–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏</option><option value="INFO" data-v-ed57067c>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏</option><option value="DEBUG" data-v-ed57067c>–í—Å–µ –ª–æ–≥–∏ (–æ—Ç–ª–∞–¥–∫–∞)</option>',5)])],544),[[ve,e.level]])])])):k("",!0),e.enabled?(a(),r("div",Ut,[i("span",zt,[t[10]||(t[10]=$(" –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: ",-1)),i("strong",null,l(e.getLevelDescription(e.level)),1)])])):k("",!0),e.enabled?(a(),r("div",Ft,[i("button",{onClick:t[5]||(t[5]=(...n)=>e.resetToDefault&&e.resetToDefault(...n)),class:"logger-control-reset-btn",title:"–°–±—Ä–æ—Å–∏—Ç—å –∫ –∑–Ω–∞—á–µ–Ω–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"}," –°–±—Ä–æ—Å–∏—Ç—å –∫ —É–º–æ–ª—á–∞–Ω–∏—é ")])):k("",!0)])):k("",!0)])):k("",!0)}const Vt=N(wt,[["render",Mt],["__scopeId","data-v-ed57067c"]]);function Wt(){const s=ee(),t=te();return{goBack:(n="/")=>{window.history.length>1?s.back():s.push(n)},goTo:(n,c={})=>{s.push({path:n,...c})},goHome:(n={})=>{s.push({path:"/",...n})},isCurrentRoute:n=>t.path===n,router:s,route:t}}const qt={name:"BackButton",props:{variant:{type:String,default:"header",validator:s=>["header","floating"].includes(s)},text:{type:String,default:"–ù–ê–ó–ê–î"},to:{type:String,default:null},showIcon:{type:Boolean,default:!0},ariaLabel:{type:String,default:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"},title:{type:String,default:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"}},setup(s){const{goBack:t,goHome:o}=Wt();return{buttonClasses:T(()=>[s.variant==="header"?"back-button":"floating-back-button"]),handleClick:()=>{s.to?o({path:s.to}):t()}}}},Gt=["aria-label","title"],Ht={key:0,class:"back-button-icon"},Jt={key:1,class:"back-button-text"};function Zt(s,t,o,e,u,_){return a(),r("button",{class:U(e.buttonClasses),onClick:t[0]||(t[0]=(...n)=>e.handleClick&&e.handleClick(...n)),"aria-label":o.ariaLabel,title:o.title},[o.showIcon?(a(),r("span",Ht,"‚Üê")):k("",!0),o.variant==="header"?(a(),r("span",Jt,l(o.text),1)):k("",!0)],10,Gt)}const Xt=N(qt,[["render",Zt],["__scopeId","data-v-d605b6a0"]]),Yt={name:"DiagnosticsPanel",props:{isEnabled:{type:Boolean,default:!1},isUserAdmin:{type:Boolean,default:!1}},setup(s){const t=b(!0),o=j(),e=T(()=>!s.isEnabled||!s.isUserAdmin?{ticketsLoading:{stages:{},totalLoaded:0},filtering:{total:0,filtered:0,rejected:[],tagValueExamples:[]},employees:{uniqueIds:[],totalUnique:0,ticketsWithoutAssignedById:[],ticketsWithAssignedById1051:[]},grouping:{distributionByStages:{},ticketsNotInColumn:[],unknownStages:[]},zeroPoint:{byStage:{}}}:o?o.getMetrics():(console.warn("[DiagnosticsPanel] Diagnostics service not available"),{ticketsLoading:{stages:{},totalLoaded:0},filtering:{total:0,filtered:0,rejected:[],tagValueExamples:[]},employees:{uniqueIds:[],totalUnique:0,ticketsWithoutAssignedById:[],ticketsWithAssignedById1051:[]},grouping:{distributionByStages:{},ticketsNotInColumn:[],unknownStages:[]},zeroPoint:{byStage:{}}})),u=T(()=>!s.isEnabled||!s.isUserAdmin||!o?{withoutAssignedById:[],withAssignedById1051:[],withoutSectorTag:[],notInColumn:[],unknownStage:[]}:o.getProblematicTickets()),_=T(()=>{const d=u.value;return d.withoutAssignedById.length===0&&d.withAssignedById1051.length===0&&d.withoutSectorTag.length===0&&d.notInColumn.length===0&&d.unknownStage.length===0});return{isExpanded:t,metrics:e,problematicTickets:u,hasNoProblems:_,toggleExpanded:()=>{t.value=!t.value},downloadJSON:()=>{if(!o)return;const d=o.exportToJSON(),m=new Blob([d],{type:"application/json"}),p=URL.createObjectURL(m),v=document.createElement("a");v.href=p,v.download=`dashboard-diagnostics-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(p)},getStageName:d=>_e.getStageName(d)||d}}},Kt={key:0,class:"diagnostics-panel"},Qt={class:"diagnostics-header"},$t={class:"header-actions"},es=["title"],ts={key:0,class:"diagnostics-content"},ss={class:"diagnostics-section"},is={class:"metrics-grid"},ns={class:"metric-card"},os={class:"metric-value"},as={class:"metric-label"},rs={class:"metric-value"},ls={class:"metric-detail"},cs={class:"diagnostics-section"},ds={class:"metrics-grid"},gs={class:"metric-card"},us={class:"metric-value"},ms={class:"metric-card",style:{"border-left-color":"#28a745"}},ks={class:"metric-value"},vs={class:"metric-card",style:{"border-left-color":"#dc3545"}},hs={class:"metric-value"},fs={key:0,class:"metric-detail"},ys={key:0,class:"warning-box"},ps={key:1,class:"examples-box"},_s={class:"example-type"},Ts={key:0,class:"normalized"},bs={class:"diagnostics-section"},Ss={class:"metrics-grid"},Ds={class:"metric-card"},Cs={class:"metric-value"},Is={class:"metric-card"},As={class:"metric-value"},Es={class:"metric-card"},ws={class:"metric-value"},Ns={class:"diagnostics-section"},Os={class:"metrics-grid"},Ls={class:"metric-card"},Bs={class:"metric-value"},Ps={class:"metric-card",style:{"border-left-color":"#28a745"}},xs={class:"metric-value"},Rs={class:"metric-card",style:{"border-left-color":"#ffc107"}},js={class:"metric-value"},Us={key:0,class:"employees-list"},zs={class:"diagnostics-section"},Fs={class:"metrics-grid"},Ms={class:"metric-label"},Vs={class:"metric-value"},Ws={class:"diagnostics-section problematic-tickets"},qs={key:0,class:"problem-group"},Gs={class:"tickets-list"},Hs={class:"ticket-id"},Js={class:"ticket-title"},Zs={class:"ticket-stage"},Xs={key:0,class:"more-items"},Ys={key:1,class:"problem-group"},Ks={class:"tickets-list"},Qs={class:"ticket-id"},$s={class:"ticket-title"},ei={class:"ticket-stage"},ti={key:0,class:"more-items"},si={key:2,class:"problem-group"},ii={class:"tickets-list"},ni={class:"ticket-id"},oi={class:"ticket-title"},ai={class:"ticket-stage"},ri={key:0,class:"more-items"},li={key:3,class:"problem-group"},ci={class:"tickets-list"},di={class:"ticket-id"},gi={class:"ticket-title"},ui={class:"ticket-stage"},mi={key:0,class:"more-items"},ki={key:4,class:"problem-group"},vi={class:"tickets-list"},hi={class:"ticket-id"},fi={class:"ticket-title"},yi={class:"ticket-stage"},pi={key:0,class:"more-items"},_i={key:5,class:"no-problems"};function Ti(s,t,o,e,u,_){return o.isEnabled&&o.isUserAdmin?(a(),r("div",Kt,[i("div",Qt,[t[2]||(t[2]=i("h2",null,"üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞",-1)),i("div",$t,[i("button",{onClick:t[0]||(t[0]=(...n)=>e.downloadJSON&&e.downloadJSON(...n)),class:"btn-download",title:"–°–∫–∞—á–∞—Ç—å JSON"}," üì• –°–∫–∞—á–∞—Ç—å JSON "),i("button",{onClick:t[1]||(t[1]=(...n)=>e.toggleExpanded&&e.toggleExpanded(...n)),class:"btn-toggle",title:e.isExpanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"},l(e.isExpanded?"‚ñº":"‚ñ∂"),9,es)])]),e.isExpanded?(a(),r("div",ts,[i("section",ss,[t[4]||(t[4]=i("h3",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤",-1)),i("div",is,[i("div",ns,[t[3]||(t[3]=i("div",{class:"metric-label"},"–í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ",-1)),i("div",os,l(e.metrics.ticketsLoading.totalLoaded),1)]),(a(!0),r(D,null,C(e.metrics.ticketsLoading.stages,(n,c)=>(a(),r("div",{key:c,class:"metric-card"},[i("div",as,l(e.getStageName(c)),1),i("div",rs,l(n.total),1),i("div",ls,"–ë–∞—Ç—á–µ–π: "+l(n.batches.length),1)]))),128))])]),i("section",cs,[t[10]||(t[10]=i("h3",null,"üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ç–æ—Ä—É 1–°",-1)),i("div",ds,[i("div",gs,[t[5]||(t[5]=i("div",{class:"metric-label"},"–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ",-1)),i("div",us,l(e.metrics.filtering.total),1)]),i("div",ms,[t[6]||(t[6]=i("div",{class:"metric-label"},"–ü—Ä–æ—à–ª–æ —Ñ–∏–ª—å—Ç—Ä (—Ç–µ–≥ 1–°)",-1)),i("div",ks,l(e.metrics.filtering.filtered),1)]),i("div",vs,[t[7]||(t[7]=i("div",{class:"metric-label"},"–û—Ç–∫–ª–æ–Ω–µ–Ω–æ (–Ω–µ—Ç —Ç–µ–≥–∞ 1–°)",-1)),i("div",hs,l(e.metrics.filtering.rejected.length),1),e.metrics.filtering.total>0?(a(),r("div",fs,l(Math.round(e.metrics.filtering.rejected.length/e.metrics.filtering.total*100))+"% –æ—Ç –≤—Å–µ—Ö ",1)):k("",!0)])]),e.metrics.filtering.rejected.length>0?(a(),r("div",ys,[t[8]||(t[8]=i("strong",null,"‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:",-1)),$(" "+l(e.metrics.filtering.rejected.length)+" —Ç–∏–∫–µ—Ç–æ–≤ –Ω–µ –∏–º–µ—é—Ç —Ç–µ–≥–∞ —Å–µ–∫—Ç–æ—Ä–∞ 1–° (UF_CRM_7_TYPE_PRODUCT = '1C') –∏ –ø–æ—ç—Ç–æ–º—É –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –¥–∞—à–±–æ—Ä–¥–µ. –≠—Ç–∏ —Ç–∏–∫–µ—Ç—ã –µ—Å—Ç—å –≤ Bitrix24, –Ω–æ –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. ",1)])):k("",!0),e.metrics.filtering.tagValueExamples.length>0?(a(),r("div",ps,[t[9]||(t[9]=i("h4",null,"–ü—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π UF_CRM_7_TYPE_PRODUCT:",-1)),i("ul",null,[(a(!0),r(D,null,C(e.metrics.filtering.tagValueExamples.slice(0,10),(n,c)=>(a(),r("li",{key:c},[i("code",null,l(JSON.stringify(n.value)),1),i("span",_s,"("+l(n.type)+l(n.isArray?", –º–∞—Å—Å–∏–≤":"")+")",1),n.normalized&&n.normalized.length?(a(),r("span",Ts," ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ: "+l(n.normalized.join(", ")),1)):k("",!0)]))),128))])])):k("",!0)]),i("section",bs,[t[14]||(t[14]=i("h3",null,"üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏",-1)),i("div",Ss,[i("div",Ds,[t[11]||(t[11]=i("div",{class:"metric-label"},"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID",-1)),i("div",Cs,l(e.metrics.employees.totalUnique),1)]),i("div",Is,[t[12]||(t[12]=i("div",{class:"metric-label"},"–ë–µ–∑ assignedById",-1)),i("div",As,l(e.metrics.employees.ticketsWithoutAssignedById.length),1)]),i("div",Es,[t[13]||(t[13]=i("div",{class:"metric-label"},"–° assignedById=1051",-1)),i("div",ws,l(e.metrics.employees.ticketsWithAssignedById1051.length),1)])])]),i("section",Ns,[t[18]||(t[18]=i("h3",null,"üì¶ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–∞–¥–∏—è–º",-1)),(a(!0),r(D,null,C(e.metrics.grouping.distributionByStages,(n,c)=>(a(),r("div",{key:c,class:"stage-distribution"},[i("h4",null,l(e.getStageName(c)),1),i("div",Os,[i("div",Ls,[t[15]||(t[15]=i("div",{class:"metric-label"},"–í—Å–µ–≥–æ —Ç–∏–∫–µ—Ç–æ–≤ –≤ —Å—Ç–∞–¥–∏–∏",-1)),i("div",Bs,l(n.total||0),1)]),i("div",Ps,[t[16]||(t[16]=i("div",{class:"metric-label"},"–í–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),i("div",xs,l(n.insideSector||0),1)]),i("div",Rs,[t[17]||(t[17]=i("div",{class:"metric-label"},"–í–Ω–µ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),i("div",js,l(n.outsideSector||0),1)])]),Object.keys(n.employees||{}).length>0?(a(),r("div",Us,[(a(!0),r(D,null,C(n.employees,(g,d)=>(a(),r("div",{key:d,class:"employee-item"}," –°–æ—Ç—Ä—É–¥–Ω–∏–∫ #"+l(d)+": "+l(g)+" —Ç–∏–∫–µ—Ç–æ–≤ ",1))),128))])):k("",!0)]))),128))]),i("section",zs,[t[19]||(t[19]=i("h3",null,"üéØ –ù—É–ª–µ–≤–∞—è —Ç–æ—á–∫–∞",-1)),i("div",Fs,[(a(!0),r(D,null,C(e.metrics.zeroPoint.byStage,(n,c)=>(a(),r("div",{key:c,class:"metric-card"},[i("div",Ms,l(e.getStageName(c)),1),i("div",Vs,l(n),1)]))),128))])]),i("section",Ws,[t[20]||(t[20]=i("h3",null,"‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã",-1)),e.problematicTickets.withoutAssignedById.length>0?(a(),r("div",qs,[i("h4",null,"–ë–µ–∑ assignedById ("+l(e.problematicTickets.withoutAssignedById.length)+")",1),i("div",Gs,[(a(!0),r(D,null,C(e.problematicTickets.withoutAssignedById.slice(0,10),n=>(a(),r("div",{key:n.id,class:"ticket-item"},[i("span",Hs,"#"+l(n.id),1),i("span",Js,l(n.title),1),i("span",Zs,l(e.getStageName(n.stageId)),1)]))),128)),e.problematicTickets.withoutAssignedById.length>10?(a(),r("div",Xs," ... –∏ –µ—â—ë "+l(e.problematicTickets.withoutAssignedById.length-10),1)):k("",!0)])])):k("",!0),e.problematicTickets.withAssignedById1051.length>0?(a(),r("div",Ys,[i("h4",null,"–° assignedById=1051 ("+l(e.problematicTickets.withAssignedById1051.length)+")",1),i("div",Ks,[(a(!0),r(D,null,C(e.problematicTickets.withAssignedById1051.slice(0,10),n=>(a(),r("div",{key:n.id,class:"ticket-item"},[i("span",Qs,"#"+l(n.id),1),i("span",$s,l(n.title),1),i("span",ei,l(e.getStageName(n.stageId)),1)]))),128)),e.problematicTickets.withAssignedById1051.length>10?(a(),r("div",ti," ... –∏ –µ—â—ë "+l(e.problematicTickets.withAssignedById1051.length-10),1)):k("",!0)])])):k("",!0),e.problematicTickets.withoutSectorTag.length>0?(a(),r("div",si,[i("h4",null,"–ë–µ–∑/–Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–≥ —Å–µ–∫—Ç–æ—Ä–∞ ("+l(e.problematicTickets.withoutSectorTag.length)+")",1),i("div",ii,[(a(!0),r(D,null,C(e.problematicTickets.withoutSectorTag.slice(0,10),n=>(a(),r("div",{key:n.id||n.ID,class:"ticket-item"},[i("span",ni,"#"+l(n.id||n.ID),1),i("span",oi,l(n.title||n.TITLE||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"),1),i("span",ai,l(e.getStageName(n.stageId||n.STAGE_ID)),1)]))),128)),e.problematicTickets.withoutSectorTag.length>10?(a(),r("div",ri," ... –∏ –µ—â—ë "+l(e.problematicTickets.withoutSectorTag.length-10),1)):k("",!0)])])):k("",!0),e.problematicTickets.notInColumn.length>0?(a(),r("div",li,[i("h4",null,"–ù–µ –ø–æ–ø–∞–ª–∏ –≤ –∫–æ–ª–æ–Ω–∫—É ("+l(e.problematicTickets.notInColumn.length)+")",1),i("div",ci,[(a(!0),r(D,null,C(e.problematicTickets.notInColumn.slice(0,10),n=>(a(),r("div",{key:n.id,class:"ticket-item"},[i("span",di,"#"+l(n.id),1),i("span",gi,l(n.title),1),i("span",ui,l(e.getStageName(n.stageId)),1)]))),128)),e.problematicTickets.notInColumn.length>10?(a(),r("div",mi," ... –∏ –µ—â—ë "+l(e.problematicTickets.notInColumn.length-10),1)):k("",!0)])])):k("",!0),e.problematicTickets.unknownStage.length>0?(a(),r("div",ki,[i("h4",null,"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç–∞–¥–∏—è ("+l(e.problematicTickets.unknownStage.length)+")",1),i("div",vi,[(a(!0),r(D,null,C(e.problematicTickets.unknownStage.slice(0,10),n=>(a(),r("div",{key:n.id,class:"ticket-item"},[i("span",hi,"#"+l(n.id),1),i("span",fi,l(n.title),1),i("span",yi,"–°—Ç–∞–¥–∏—è: "+l(n.stageId),1)]))),128)),e.problematicTickets.unknownStage.length>10?(a(),r("div",pi," ... –∏ –µ—â—ë "+l(e.problematicTickets.unknownStage.length-10),1)):k("",!0)])])):k("",!0),e.hasNoProblems?(a(),r("div",_i," ‚úÖ –ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ ")):k("",!0)])])):k("",!0)])):k("",!0)}const bi=N(Yt,[["render",Ti],["__scopeId","data-v-74a5e138"]]);function Si(){const s=b(!1),t=b(null),o=b([{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:[]},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:[]},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:[]}]),e=b({formed:[],review:[],execution:[]}),u=b([]),_=b(null);return{isLoading:s,error:t,stages:o,zeroPointTickets:e,employees:u,draggedTicket:_,updateState:m=>{m.stages&&(o.value=m.stages),m.employees&&(u.value=m.employees),m.zeroPointTickets&&(e.value=m.zeroPointTickets)},resetState:()=>{s.value=!1,t.value=null,o.value=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff",employees:[]},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107",employees:[]},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745",employees:[]}],e.value={formed:[],review:[],execution:[]},u.value=[],_.value=null},updateLocalStateAfterMove:(m,p,v)=>{const h=o.value.find(f=>f.employees.some(S=>S.tickets.some(L=>L.id===m.id)));if(h){const f=h.employees.find(S=>S.tickets.some(L=>L.id===m.id));f&&(f.tickets=f.tickets.filter(S=>S.id!==m.id))}const y=o.value.find(f=>f.id===v);if(y){const f=y.employees.find(S=>S.id===p);if(f){const S={...m,assigneeId:p,stageId:v};f.tickets.push(S)}}Object.keys(e.value).forEach(f=>{e.value[f]=e.value[f].filter(S=>S.id!==m.id)})},getEmployeeTickets:(m,p)=>{const v=o.value.find(y=>y.id===p);if(!v)return[];const h=v.employees.find(y=>y.id===m);return h?h.tickets||[]:[]}}}function Di(){const s=b(null),t=b(0),o=b(null),e=b(null),u=b({}),_=(v,h={})=>{s.value=v,u.value=h},n=v=>{const h=typeof v=="number"&&!isNaN(v)?v:0;t.value=Math.min(100,Math.max(0,h))},c=v=>{o.value=v,e.value=null},g=v=>{e.value=v},d=()=>{e.value=null},m=()=>{s.value=null,t.value=0,o.value=null,e.value=null,u.value={}},p=T(()=>o.value||e.value);return{currentStep:s,progress:t,error:o,temporaryError:e,displayError:p,stepDetails:u,updateStep:_,updateProgress:n,setError:c,setTemporaryError:g,clearTemporaryError:d,reset:m}}const w={fadeOutDuration:400,fadeInDuration:400,delayBetween:150,readyDisplayTime:800,fadeOutEasing:"ease-out",fadeInEasing:"ease-in",fadeOutTransform:"scale(0.95)",fadeInTransform:"translateY(10px)"},Z={fadeInDuration:400,fadeInEasing:"ease-in"};function ce(s,t,o="opacity, transform"){return`${o} ${s}ms ${t}`}function Ci(){return ce(w.fadeOutDuration,w.fadeOutEasing)}function Ii(){return ce(Z.fadeInDuration,Z.fadeInEasing)}function Ai(){const s=b(!1),t=b(null),o=n=>{s.value=!0,t.value=Date.now(),n&&n()},e=n=>{s.value=!1,t.value=null,n&&n()},u=(n,c,g=w)=>{o(()=>{n&&n(),setTimeout(()=>{c&&c()},g.delayBetween),setTimeout(()=>{e()},g.fadeOutDuration)})},_=T(()=>t.value?Date.now()-t.value:0);return{isTransitioning:T(()=>s.value),startTransition:o,endTransition:e,executeTransition:u,transitionDuration:_}}function Ei(s,t=""){if(Logger.error(`API Error ${t?`(${t})`:""}`,"ErrorHandler",s),s.message){if(s.message.includes("HTTP error"))return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.";if(s.message.includes("timeout"))return"–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";if(s.message.includes("403")||s.message.includes("401"))return"–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.";if(s.message.includes("500"))return"–û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."}return s.message||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}function wi(s,t="",o={}){const e={message:s.message,stack:s.stack,context:t,...o,timestamp:new Date().toISOString()};Logger.error("Error logged","ErrorHandler",e)}function V(s,t="",o=null){const e=Ei(s,t);wi(s,t),o&&typeof o=="function"?o(e,"error"):typeof BX<"u"&&BX.UI&&BX.UI.Notification&&BX.UI.Notification.Center.notify({content:e,autoHideDelay:5e3})}function Ni(s){const t=ie(),o=Di(),{isTransitioning:e,executeTransition:u}=Ai();function _(h,y){const f=Te(h);f.step&&y.updateStep(f.step,f.details||{}),f.progress!==void 0&&f.progress!==null&&(y.updateProgress(f.progress),y.clearTemporaryError())}const n=async(h=!0)=>{s.isLoading.value=!0,s.error.value=null,o.reset(),o.updateStep("cache_check",{description:"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö..."}),o.updateProgress(0);try{const y=await F.getSectorData(h,f=>{_(f,o)});s.updateState(y)}catch(y){s.error.value=y.message,o.setError(y.message),V(y,"loading sector data",t.error)}finally{if(s.error.value)s.isLoading.value=!1;else{o.updateStep("complete",{description:"–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω"}),o.updateProgress(100);const y=w.readyDisplayTime||800;setTimeout(()=>{u(()=>{},()=>{s.isLoading.value=!1},w),setTimeout(()=>{o.reset()},w.fadeOutDuration)},y)}}},c=async(h,y,f)=>{if(!re(h,y,f))return t.warning("–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–∏–∫–µ—Ç —Å—é–¥–∞"),!1;try{const S=await F.assignTicket(h.id,y,f);return S&&(s.updateLocalStateAfterMove(h,y,f),t.success("–¢–∏–∫–µ—Ç –ø–µ—Ä–µ–º–µ—â—ë–Ω")),S}catch(S){return V(S,"assigning ticket",t.error),!1}finally{s.draggedTicket.value=null}};return{loadSectorData:n,assignTicket:c,moveTicketToStage:async(h,y)=>await c(h,h.assigneeId,y),assignTicketToEmployee:async(h,y)=>await c(h,y,h.stageId),createTicket:async h=>{const y=Oe(h);if(!y.valid){const f=y.errors.join(", ");return t.error(f),0}try{const f=await F.createTicket(h);return f>0&&(await n(!1),t.success("–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω")),f}catch(f){return V(f,"creating ticket",t.error),0}},handleTicketDragStart:h=>{s.draggedTicket.value=h},handleTicketDrop:async(h,y,f)=>{await c(h,y,f)},loadingProgress:o,isTransitioning:e}}const W={name:"DashboardSector1C",components:{DashboardStage:Ke,LoadingPreloader:Et,LoggerControl:Vt,BackButton:Xt,DiagnosticsPanel:bi},setup(){const s=ee(),t=te(),o=Si(),e=Ni(o),u=b(null),_=T(()=>u.value?pe(u.value):!1),n=T(()=>Se(t,u.value)),c=()=>{s.push({name:"dashboard-sector-1c",query:{...t.query,diagnostics:"true"}}),typeof localStorage<"u"&&localStorage.setItem("dashboard-sector-1c-diagnostics","true");const I=j();I&&I.reset(),e.loadSectorData(!1)},g=()=>{J.invalidateTicketsCache(),J.invalidateEmployeesCache(),be();const I=j();I&&I.reset(),e.loadSectorData(!1)};Q(async()=>{try{u.value=await ye.getCurrentUser()}catch(I){console.error("Error getting current user:",I),u.value=null}if(n.value){const I=j();I&&I.reset()}e.loadSectorData()});const d=Ci(),m=Ii(),p=`${w.delayBetween}ms`,v=w.fadeOutTransform,h=w.fadeInTransform,y=()=>{e.loadSectorData(!1)},f=()=>{s.push({name:"dashboard-graph-state"})},S=()=>{s.push({name:"dashboard-graph-admission-closure"})},L=()=>{s.push({name:"dashboard-tickets-time-tracking"})},de=()=>{s.push("/")},x=e.loadingProgress,ge=T(()=>typeof localStorage<"u"?localStorage.getItem("dashboard-sector-1c-show-logger-control")==="true":!1);return{isLoading:o.isLoading,error:o.error,stages:o.stages,zeroPointTickets:o.zeroPointTickets,employees:o.employees,draggedTicket:o.draggedTicket,currentStep:x.currentStep,progress:x.progress,stepDetails:x.stepDetails,loadingProgress:x,loadSectorData:e.loadSectorData,handleTicketDragStart:e.handleTicketDragStart,handleTicketDrop:e.handleTicketDrop,assignTicketToEmployee:e.assignTicketToEmployee,moveTicketToStage:e.moveTicketToStage,createTicket:e.createTicket,getEmployeeTickets:o.getEmployeeTickets,showLoggerControl:ge,handleRetry:y,isTransitioning:e.isTransitioning,preloaderFadeOutTransition:d,dashboardFadeInTransition:m,transitionDelay:p,preloaderFadeOutTransform:v,dashboardFadeInTransform:h,navigateToGraphState:f,navigateToAdmissionClosure:S,navigateToTimeTracking:L,handleGoHome:de,isDiagnosticsEnabled:n,enableDiagnostics:c,clearCache:g,isUserAdmin:_}}},X=()=>{fe(s=>({e25fa6d4:s.preloaderFadeOutTransition,v2de4400b:s.preloaderFadeOutTransform,v66f66a76:s.dashboardFadeInTransition,e224f3ee:s.transitionDelay,v171b9ffc:s.dashboardFadeInTransform}))},Y=W.setup;W.setup=Y?(s,t)=>(X(),Y(s,t)):X;const Oi={class:"dashboard-header"},Li={class:"breadcrumbs-row"},Bi={class:"header-actions"},Pi={key:0,class:"dashboard-content"},xi={class:"stages-container"};function Ri(s,t,o,e,u,_){const n=E("BackButton"),c=E("LoadingPreloader"),g=E("DashboardStage"),d=E("LoggerControl"),m=E("DiagnosticsPanel");return a(),r("div",{class:U(["dashboard-sector-1c",{"is-dragging":e.draggedTicket}])},[i("div",Oi,[i("div",Li,[i("button",{class:"btn-home-link",type:"button",onClick:t[0]||(t[0]=(...p)=>e.handleGoHome&&e.handleGoHome(...p)),title:"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"}," –ì–ª–∞–≤–Ω–∞—è "),t[6]||(t[6]=i("span",{class:"breadcrumb-separator"},"/",-1)),t[7]||(t[7]=i("span",{class:"breadcrumb-current"},"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1))]),A(n,{variant:"header"}),t[13]||(t[13]=i("h1",null,"–î–∞—à–±–æ—Ä–¥ - –°–µ–∫—Ç–æ—Ä 1–°",-1)),i("div",Bi,[e.isDiagnosticsEnabled&&e.isUserAdmin?(a(),r("button",{key:0,onClick:t[1]||(t[1]=(...p)=>e.clearCache&&e.clearCache(...p)),class:"btn-clear-cache",title:"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à —Å–µ–∫—Ç–æ—Ä–∞ –∏ —Ç–∏–∫–µ—Ç–æ–≤"},[...t[8]||(t[8]=[i("span",{class:"icon"},"‚ôªÔ∏è",-1),i("span",null,"–°–±—Ä–æ—Å–∏—Ç—å –∫–µ—à",-1)])])):k("",!0),!e.isDiagnosticsEnabled&&e.isUserAdmin?(a(),r("button",{key:1,onClick:t[2]||(t[2]=(...p)=>e.enableDiagnostics&&e.enableDiagnostics(...p)),class:"btn-enable-diagnostics",title:"–í–∫–ª—é—á–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º"},[...t[9]||(t[9]=[i("span",{class:"icon"},"üîç",-1),i("span",null,"–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",-1)])])):k("",!0),i("button",{onClick:t[3]||(t[3]=(...p)=>e.navigateToGraphState&&e.navigateToGraphState(...p)),class:"btn-navigate-graph-state",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞"},[...t[10]||(t[10]=[i("span",{class:"icon"},"üìä",-1),i("span",null,"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",-1)])]),i("button",{onClick:t[4]||(t[4]=(...p)=>e.navigateToAdmissionClosure&&e.navigateToAdmissionClosure(...p)),class:"btn-navigate-admission-closure",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞"},[...t[11]||(t[11]=[i("span",{class:"icon"},"üìà",-1),i("span",null,"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π",-1)])]),i("button",{onClick:t[5]||(t[5]=(...p)=>e.navigateToTimeTracking&&e.navigateToTimeTracking(...p)),class:"btn-navigate-time-tracking",title:"–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç–∞–º –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞"},[...t[12]||(t[12]=[i("span",{class:"icon"},"‚è±",-1),i("span",null,"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã",-1)])])])]),A(H,{name:"preloader-fade"},{default:P(()=>[e.isLoading||e.error||e.currentStep?(a(),O(c,{key:0,"current-step":e.currentStep,progress:e.progress,"step-details":e.stepDetails,error:e.error||null,onRetry:e.handleRetry},null,8,["current-step","progress","step-details","error","onRetry"])):k("",!0)]),_:1}),A(H,{name:"dashboard-fade"},{default:P(()=>[!e.isLoading&&!e.error&&!e.currentStep?(a(),r("div",Pi,[i("div",xi,[(a(!0),r(D,null,C(e.stages,p=>(a(),O(g,{key:p.id,stage:p,"zero-point-tickets":e.zeroPointTickets[p.id]||[],onTicketMoved:e.handleTicketDrop,onTicketAssigned:e.assignTicketToEmployee},null,8,["stage","zero-point-tickets","onTicketMoved","onTicketAssigned"]))),128))])])):k("",!0)]),_:1}),A(n,{variant:"floating"}),A(d,{"show-control":e.showLoggerControl},null,8,["show-control"]),A(m,{"is-enabled":e.isDiagnosticsEnabled,"is-user-admin":e.isUserAdmin},null,8,["is-enabled","is-user-admin"])],2)}const Ji=N(W,[["render",Ri],["__scopeId","data-v-11e84363"]]);export{Ji as default};
