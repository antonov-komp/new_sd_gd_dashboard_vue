const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./direct-access-config-rNsqLKKF.js","./chunk-CNxVt5Js.js","./chunk-D-aTIMKk.js","./access-config-async-BSwYkgbP.js","./chunk-B18qXr3N.js","./chunk-C8Ia5wc2.js","./WebhookLogsDashboard.vue-B8qTMgTE.js","./WebhookLogDetails.vue-BPwqeHRz.js","./UnifiedUserManagement.vue-JAZJlF9w.js","./DashboardSector1C.vue-BpZ3ysb7.js","./chunk-DXto_vdK.js","./chunk-DB8knvNz.js","./chunk-CkjSx-Pz.js","./chunk-CBhMWSGZ.js","./GraphAdmissionClosureDashboard.vue-DQq2wFpc.js","./chunk-DF0bzbS8.js","./dashboard-sector-1c-service-BjTk5SI3.js","./GraphStateDashboard.vue-CJsvE2ym.js","./TicketsTimeTrackingDashboard.vue-DDJDXg_b.js"])))=>i.map(i=>d[i]);
var xt=Object.defineProperty;var Et=(n,e,o)=>e in n?xt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o;var ve=(n,e,o)=>Et(n,typeof e!="symbol"?e+"":e,o);import{r as V,c as d,o as c,a as q,b as k,d as Mt,t as g,n as B,e as s,f as K,g as w,h as ne,i as b,F as H,j as J,k as Y,u as Ae,m as Tt,l as At,w as ae,p as ce,q as fe,s as Lt,T as pe,v as ee,x as Fe,y as vt,z as Pe,A as Ie,B as ge,C as Be,D as ot,E as Dt,G as nt,H as pt,I as It,J as Pt,K as Nt,L as Ne,M as Rt,N as Ot,P as Ut,O as Ft,Q as Bt,R as zt,S as jt,U as Wt,V as $t,W as Vt,X as Xt}from"./chunk-B18qXr3N.js";import{a as yt,_ as te,g as me}from"./chunk-CNxVt5Js.js";import{C as gt}from"./chunk-C8Ia5wc2.js";import"./chunk-D-aTIMKk.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();const $=(n,e)=>{const o=n.__vccOpts||n;for(const[t,r]of e)o[t]=r;return o},qt={name:"App"},Ht={id:"app"};function Jt(n,e,o,t,r,i){const a=V("router-view");return c(),d("div",Ht,[q(a)])}const Kt=$(qt,[["render",Jt]]),Yt={name:"StatusMessage",props:{type:{type:String,required:!0,validator:n=>["success","error","info","warning"].includes(n)},title:{type:String,default:null},message:{type:String,default:null}}},Gt={key:0},Qt={key:1};function Zt(n,e,o,t,r,i){return c(),d("div",{class:B(["status-message",`status-message--${o.type}`])},[o.title?(c(),d("strong",Gt,g(o.title),1)):k("",!0),o.message?(c(),d("p",Qt,g(o.message),1)):k("",!0),Mt(n.$slots,"default",{},void 0)],2)}const _t=$(Yt,[["render",Zt],["__scopeId","data-v-7f15d2d7"]]),eo={name:"LoadingSpinner",props:{message:{type:String,default:"–ó–∞–≥—Ä—É–∑–∫–∞..."}}},to={class:"loading-spinner"},oo={key:0,class:"message"};function no(n,e,o,t,r,i){return c(),d("div",to,[e[0]||(e[0]=s("div",{class:"spinner"},null,-1)),o.message?(c(),d("p",oo,g(o.message),1)):k("",!0)])}const bt=$(eo,[["render",no],["__scopeId","data-v-375eac16"]]);function Ee(){try{if(window.self===window.top)return!1;if(typeof BX24<"u")return!0;try{const n=window.parent.location.origin;return n.includes("bitrix24")||n.includes("kompo.by")}catch{return!1}}catch(n){return console.warn("Error checking Bitrix24 context:",n),!1}}function so(){return typeof BX24<"u"}class ye{static init(e){return new Promise((o,t)=>{if(!Ee()){console.log("Not inside Bitrix24, skipping BX24.init()"),e&&e(),o();return}if(typeof BX24>"u"){t(new Error("Bitrix24 API not loaded. Make sure script is included: //api.bitrix24.com/api/v1/"));return}const r=setTimeout(()=>{t(new Error("BX24.init() timeout: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥"))},5e3);try{BX24.init(()=>{clearTimeout(r),e&&e(),o()})}catch(i){clearTimeout(r),t(i)}})}static installFinish(){return new Promise((e,o)=>{if(typeof BX24>"u"){o(new Error("Bitrix24 API not loaded"));return}try{BX24.installFinish(),e()}catch(t){o(t)}})}static callMethod(e,o={}){return new Promise((t,r)=>{if(typeof BX24>"u"){r(new Error("Bitrix24 API not loaded"));return}const i=setTimeout(()=>{r(new Error(`BX24.callMethod(${e}) timeout: –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—ã—Å–∏–ª 10 —Å–µ–∫—É–Ω–¥`))},1e4);try{BX24.callMethod(e,o,a=>{if(clearTimeout(i),a.error()){const l=a.error();r(new Error(l.error_description||l.error||"Unknown error"))}else t(a.data())})}catch(a){clearTimeout(i),r(a)}})}static async getCurrentUser(){if(Ee()&&so())try{const e=await Promise.race([this.callMethod("user.current",{}),new Promise((o,t)=>setTimeout(()=>t(new Error("Timeout")),5e3))]);return console.log("Got user from BX24.callMethod() (interface user):",e?.ID||"unknown"),e}catch(e){console.warn("BX24.callMethod() failed, using proxy API as fallback:",e);try{const t=await new gt().getCurrentUser();return console.log("Got user from proxy API (token owner, fallback):",t),t}catch(o){throw console.error("Both BX24 API and proxy API failed:",o),e.message&&e.message.includes("timeout")?new Error("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Bitrix24 API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç."):new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}else return console.warn("Not inside Bitrix24, using proxy API (will return token owner, not interface user)"),await new gt().getCurrentUser()}static getUser(){return new Promise((e,o)=>{if(typeof BX24>"u"){o(new Error("Bitrix24 API not loaded"));return}if(typeof BX24.getUser!="function"){o(new Error("BX24.getUser is not available"));return}BX24.getUser(t=>{e(t)})})}static getAuth(){return new Promise((e,o)=>{if(typeof BX24>"u"){o(new Error("Bitrix24 API not loaded"));return}BX24.getAuth(t=>{e(t)})})}}const ao={name:"InstallPage",components:{StatusMessage:_t,LoadingSpinner:bt},setup(){const n=w(!0),e=w(null),o=w(null);return ne(async()=>{try{let t=null;if(window.INSTALL_RESULT)t=window.INSTALL_RESULT;else{const r=yt("/install.php"),i=await fetch(`${r}?get_result=1`);i.ok&&(t=await i.json())}if(!t)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏");if(o.value=t,t.rest_only===!1)if(t.install===!0){e.value={type:"success",title:"‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!",message:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24."};try{await ye.init(()=>{ye.installFinish()})}catch(r){console.error("Error finishing installation:",r)}}else e.value={type:"error",title:"‚úó –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."};else e.value={type:"info",title:"REST-only —Ä–µ–∂–∏–º",message:"–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ REST API, –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."}}catch(t){console.error("Error loading install result:",t),e.value={type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ."}}finally{n.value=!1}}),{loading:n,installStatus:e,installInfo:o}}},ro={class:"install-page"},io={class:"container"},lo={key:1,class:"info"};function co(n,e,o,t,r,i){const a=V("StatusMessage"),l=V("LoadingSpinner");return c(),d("div",ro,[s("div",io,[e[1]||(e[1]=s("h1",null,"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1)),t.installStatus?(c(),K(a,{key:0,type:t.installStatus.type,title:t.installStatus.title,message:t.installStatus.message},null,8,["type","title","message"])):k("",!0),t.installInfo?(c(),d("div",lo,[e[0]||(e[0]=s("h3",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:",-1)),s("pre",null,g(JSON.stringify(t.installInfo,null,2)),1)])):k("",!0),t.loading?(c(),K(l,{key:2,message:"–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."})):k("",!0)])])}const uo=$(ao,[["render",co],["__scopeId","data-v-d082ec9e"]]),go={name:"SectorContainer",props:{sectorConfig:{type:Object,required:!0,validator:n=>n.id&&n.name&&n.icon}},emits:["module-ready","module-error","sector-expanded","sector-collapsed"],setup(n,{emit:e}){Ae();const o=w(!1),t=w(!1),r=w([]),i=b(()=>n.sectorConfig.modules&&n.sectorConfig.modules.length>0),a=b(()=>!1);ne(async()=>{i.value&&await l()});const l=async()=>{t.value=!0;try{r.value=n.sectorConfig.modules.map(S=>({id:S.toLowerCase().replace(/[^a-zA-Z0-9]/g,"-"),componentId:S,title:E(S),description:x(S),icon:A(S)})),e("module-ready",{sectorId:n.sectorConfig.id,modulesCount:r.value.length})}catch(S){console.error(`Failed to load modules for sector ${n.sectorConfig.id}:`,S),e("module-error",{sectorId:n.sectorConfig.id,error:S.message})}finally{t.value=!1}},m=()=>{o.value=!o.value,o.value?e("sector-expanded",{sectorId:n.sectorConfig.id}):e("sector-collapsed",{sectorId:n.sectorConfig.id})},f=S=>"div",C=S=>({moduleConfig:S,sectorId:n.sectorConfig.id,sectorConfig:n.sectorConfig}),p=S=>{e("module-event",{sectorId:n.sectorConfig.id,moduleId:S.moduleId,event:S})},L=()=>{console.log(`Navigate to dashboard for sector: ${n.sectorConfig.id}`)},E=S=>({DashboardSector1C:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",TicketsManagementSector1C:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",StateChart:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",ChangesVisualization:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π"})[S]||S,x=S=>({DashboardSector1C:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–æ–º 1–° —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏",TicketsManagementSector1C:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏ –∏ –∑–∞–¥–∞—á–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",StateChart:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º —Å–µ–∫—Ç–æ—Ä–∞ 1–°",ChangesVisualization:"–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Å–µ–∫—Ç–æ—Ä–µ 1–°"})[S]||"–û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è",A=S=>({DashboardSector1C:"‚öôÔ∏è",TicketsManagementSector1C:"üìã",StateChart:"üìä",ChangesVisualization:"üìà"})[S]||"üîß";return{expanded:o,loading:t,sectorModules:r,hasModules:i,canNavigateToDashboard:a,toggleExpanded:m,getModuleComponent:f,getModuleProps:C,handleModuleEvent:p,navigateToSectorDashboard:L}}},mo={class:"sector-header"},fo={class:"sector-header-left"},ho={class:"sector-icon"},vo={class:"sector-title"},po={class:"sector-actions"},yo={key:0,class:"sector-content"},_o={key:0,class:"sector-loading"},bo={key:1,class:"sector-modules-grid"},wo={key:2,class:"no-modules"},Co={key:3,class:"sector-dashboard-link"};function So(n,e,o,t,r,i){return c(),d("div",{class:B(["sector-container",`sector-${o.sectorConfig.id}`])},[s("div",mo,[s("div",fo,[s("div",ho,g(o.sectorConfig.icon),1),s("div",vo,[s("h2",null,g(o.sectorConfig.name),1),s("p",null,g(o.sectorConfig.description),1)])]),s("div",po,[s("button",{onClick:e[0]||(e[0]=(...a)=>t.toggleExpanded&&t.toggleExpanded(...a)),class:"btn-toggle-sector"},g(t.expanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"),1)])]),t.expanded?(c(),d("div",yo,[t.loading?(c(),d("div",_o,[e[3]||(e[3]=s("div",{class:"loading-spinner"},null,-1)),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∫—Ç–æ—Ä–∞ "+g(o.sectorConfig.name)+"...",1)])):t.sectorModules.length>0?(c(),d("div",bo,[(c(!0),d(H,null,J(t.sectorModules,a=>(c(),K(At(t.getModuleComponent(a)),Tt({key:a.id,class:"module-tile"},{ref_for:!0},t.getModuleProps(a),{onModuleEvent:t.handleModuleEvent}),null,16,["onModuleEvent"]))),128))])):(c(),d("div",wo,[s("p",null,'–ú–æ–¥—É–ª–∏ –¥–ª—è —Å–µ–∫—Ç–æ—Ä–∞ "'+g(o.sectorConfig.name)+'" –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ',1),t.canNavigateToDashboard?(c(),d("button",{key:0,onClick:e[1]||(e[1]=(...a)=>t.navigateToSectorDashboard&&t.navigateToSectorDashboard(...a)),class:"btn-sector-dashboard"},[...e[4]||(e[4]=[s("span",{class:"icon"},"üìä",-1),Y(" –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ ",-1)])])):k("",!0)])),t.sectorModules.length>0&&t.canNavigateToDashboard?(c(),d("div",Co,[s("button",{onClick:e[2]||(e[2]=(...a)=>t.navigateToSectorDashboard&&t.navigateToSectorDashboard(...a)),class:"btn-sector-dashboard"},[...e[5]||(e[5]=[s("span",{class:"icon"},"üìä",-1),Y(" –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ ",-1)])])])):k("",!0)])):k("",!0)],2)}const ko=$(go,[["render",So],["__scopeId","data-v-9b470072"]]),ke={allowedDepartmentIds:[369,366,7],adminDepartmentIds:[369]};function wt(n){return!n||typeof n!="number"?!1:ke.allowedDepartmentIds.includes(n)}function Ct(n){if(!n||!n.UF_DEPARTMENT)return!1;const e=Array.isArray(n.UF_DEPARTMENT)?n.UF_DEPARTMENT:[];return e.length===0?!1:e.some(o=>ke.adminDepartmentIds.includes(o))}const le={USER_NOT_DETERMINED:"USER_NOT_DETERMINED",ACCESS_DENIED:"ACCESS_DENIED",API_ERROR:"API_ERROR"};class ue{constructor(e,o=null,t=null,r=null){this.allowed=e,this.errorCode=o,this.errorMessage=t,this.user=r}}class Ce{static async checkAccess(){try{const e=Ee();if(console.log("AccessControlService.checkAccess - isInsideBitrix24:",e),console.log("AccessControlService.checkAccess - window.self === window.top:",window.self===window.top),console.log("AccessControlService.checkAccess - typeof BX24:",typeof BX24),e)console.log("AccessControlService.checkAccess - Inside Bitrix24, skipping direct access check");else{console.log("AccessControlService.checkAccess - Not inside Bitrix24, checking direct access config...");const{isDirectAccessAllowed:i,getDenyMessage:a}=await te(async()=>{const{isDirectAccessAllowed:m,getDenyMessage:f}=await import("./direct-access-config-rNsqLKKF.js");return{isDirectAccessAllowed:m,getDenyMessage:f}},__vite__mapDeps([0,1]),import.meta.url),l=await i();if(console.log("AccessControlService.checkAccess - allowDirectAccess:",l),!l){const m=await a();return console.warn("Direct access denied: Application opened directly in browser, but direct access is disabled in config"),console.warn("Deny message:",m),new ue(!1,le.ACCESS_DENIED,m,null)}console.log("Direct access allowed: Using primary administrator token from settings.php")}if(e)try{await Promise.race([ye.init(),new Promise((i,a)=>setTimeout(()=>a(new Error("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥")),5e3))])}catch(i){console.warn("BX24.init() failed, will try proxy API:",i)}let o;try{o=await Promise.race([ye.getCurrentUser(),new Promise((i,a)=>setTimeout(()=>a(new Error("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø—Ä–µ–≤—ã—Å–∏–ª–æ 10 —Å–µ–∫—É–Ω–¥")),1e4))])}catch(i){console.warn("Bitrix24BxApi.getCurrentUser() failed, trying proxy API:",i);const{Bitrix24ApiProvider:a}=await te(async()=>{const{Bitrix24ApiProvider:l}=await import("./chunk-D-aTIMKk.js").then(m=>m.b);return{Bitrix24ApiProvider:l}},__vite__mapDeps([2,1]),import.meta.url);try{const l=await a.getInstance();o=await Promise.race([l.getCurrentUser(),new Promise((m,f)=>setTimeout(()=>f(new Error("–ü—Ä–æ–∫—Å–∏ API –ø—Ä–µ–≤—ã—Å–∏–ª–æ 5 —Å–µ–∫—É–Ω–¥")),5e3))]),console.log("Got user from proxy API:",o?.ID||"unknown")}catch(l){throw console.error("Both BX24 API and proxy API failed:",l),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}if(!o||!o.ID)return console.warn("AccessControlService.checkAccess - user not determined:",o),new ue(!1,le.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.");console.log("AccessControlService.checkAccess - user determined:",{id:o.ID,name:o.NAME,departments:o.UF_DEPARTMENT});const t=o.UF_DEPARTMENT||[];if(console.log("AccessControlService.checkAccess - departmentIds:",t),!Array.isArray(t)||t.length===0){if(console.log("AccessControlService.checkAccess - user has no departments"),!e){const{isDirectAccessAllowed:i}=await te(async()=>{const{isDirectAccessAllowed:l}=await import("./direct-access-config-rNsqLKKF.js");return{isDirectAccessAllowed:l}},__vite__mapDeps([0,1]),import.meta.url);if(await i())return console.log("AccessControlService.checkAccess - Direct access allowed, granting access despite no departments"),new ue(!0,null,null,o)}return console.warn("AccessControlService.checkAccess - Access denied: user has no departments"),new ue(!1,le.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ—Ç–¥–µ–ª—É.")}const r=t.some(i=>wt(i));return console.log("AccessControlService.checkAccess - hasAccess:",r),r?(console.log("AccessControlService.checkAccess - Access granted"),new ue(!0,null,null,o)):(console.warn("AccessControlService.checkAccess - Access denied: no allowed departments"),new ue(!1,le.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"))}catch(e){return console.error("AccessControlService.checkAccess error:",e),e.message&&(e.message.includes("CORS")||e.message.includes("blocked")||e.message.includes("ERR_FAILED")||e.message.includes("unknown address space"))&&Ee()?(console.error("CORS error inside Bitrix24: Cannot determine interface user."),new ue(!1,le.API_ERROR,"–û—à–∏–±–∫–∞ CORS: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")):e.message&&e.message.includes("not loaded")?new ue(!1,le.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."):new ue(!1,le.API_ERROR,"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}static async getCurrentUser(){try{return Ee()&&await ye.init(),await ye.getCurrentUser()}catch(e){return console.error("AccessControlService.getCurrentUser error:",e),null}}}class ze{static async logAppEntry(e,o=null){if(!e||!e.ID)return console.warn("[ActivityLoggingService] Invalid user object for app entry logging"),!1;const t={timestamp:new Date().toISOString(),type:"app_entry",user_id:e.ID,user_name:this.getUserName(e),user_email:e.EMAIL||null,ip:o||this.getClientIp(),user_agent:navigator.userAgent,session_id:this.getSessionId()};return await this.saveLog(t)}static async logPageVisit(e,o,t=null){if(!o||!o.ID)return console.warn("[ActivityLoggingService] Invalid user object for page visit logging"),!1;if(!e||!e.path)return console.warn("[ActivityLoggingService] Invalid route object for page visit logging"),!1;const r={timestamp:new Date().toISOString(),type:"page_visit",user_id:o.ID,user_name:this.getUserName(o),route_path:e.path,route_name:e.name||null,route_title:e.meta?.title||null,from_path:t?.path||null,from_name:t?.name||null,session_id:this.getSessionId()};return await this.saveLog(r)}static async saveLog(e){try{const o=me("/api/user-activity-log.php"),t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)});if(!t.ok){const i=await t.text();return console.error("[ActivityLoggingService] Failed to save log:",{status:t.status,statusText:t.statusText,error:i}),!1}const r=await t.json();return r.success?!0:(console.error("[ActivityLoggingService] API returned error:",r.error),!1)}catch(o){return o.name==="AbortError"?console.warn("[ActivityLoggingService] Request timeout (activity logging skipped)"):console.error("[ActivityLoggingService] Error saving log:",o),!1}}static getSessionId(){const e="activity_session_id";if(sessionStorage.getItem(e))return sessionStorage.getItem(e);const o=this.generateSessionId();return sessionStorage.setItem(e,o),o}static generateSessionId(){const e=Date.now(),o=Math.random().toString(36).substring(2,11);return`${e}-${o}`}static getUserName(e){const o=e.NAME||"",t=e.LAST_NAME||"";return`${o} ${t}`.trim()||e.EMAIL||`User #${e.ID}`}static getClientIp(){return null}static isAppEntryLogged(){return sessionStorage.getItem("app_entry_logged")==="true"}static markAppEntryLogged(){sessionStorage.setItem("app_entry_logged","true")}}const xo={reports:[{id:1,title:"–û—Ç—á—ë—Ç –ø–æ —Ç–∏–∫–µ—Ç–∞–º",icon:"üìä",route:"/reports/tickets",description:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º",active:!1},{id:2,title:"–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",icon:"üìà",route:"/reports/performance",description:"–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞",active:!1},{id:3,title:"–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º",icon:"üìâ",route:"/reports/deadlines",description:"–ê–Ω–∞–ª–∏–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á",active:!1},{id:4,title:"–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç",icon:"üìã",route:"/reports/summary",description:"–û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",active:!1},{id:5,title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",route:"/dashboard/sector-1c",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0},{id:6,title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",icon:"üìä",route:"/dashboard/graph-state",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–° –≤–æ –≤—Ä–µ–º–µ–Ω–∏",active:!0,category:"analytics",order:6},{id:7,title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–°",icon:"üìà",route:"/dashboard/graph-admission-closure",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0,category:"analytics",order:7},{id:8,title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"‚è±",route:"/dashboard/tickets-time-tracking",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",active:!0,category:"analytics",order:8}]};function Eo(){return xo.reports.filter(n=>n.active===!0)}const Mo={adminInterfaces:[{id:1,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"üë•",route:"/admin/users",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"},{id:2,title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã",icon:"‚öôÔ∏è",route:"/admin/settings",description:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:3,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",icon:"üìã",route:"/admin/webhook-logs",description:"–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤"},{id:4,title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",icon:"üìä",route:"/admin/usage-stats",description:"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:5,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",icon:"üóëÔ∏è",route:"/admin/cache",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –º–æ–¥—É–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"}]};function To(){return[...Mo.adminInterfaces]}const Le={sector1c:{id:"1c",name:"–°–µ–∫—Ç–æ—Ä 1–°",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ",icon:"‚öôÔ∏è",color:"#007bff",borderColor:"#0056b3",backgroundColor:"#f8f9fa",filterValue:"1C",modules:["DashboardSector1C","TicketsManagementSector1C","StateChart","ChangesVisualization"],features:["smart-process-140","1c-integration"],order:1},sectorPdm:{id:"pdm",name:"–°–µ–∫—Ç–æ—Ä PDM",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–∞–º–∏ PDM (Product Data Management)",icon:"üîß",color:"#28a745",borderColor:"#1e7e34",backgroundColor:"#f8fff8",filterValue:"PDM",modules:[],features:["pdm-integration"],order:2},sectorBitrix24:{id:"bitrix24",name:"–°–µ–∫—Ç–æ—Ä –ë–∏—Ç—Ä–∏–∫—Å24",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ë–∏—Ç—Ä–∏–∫—Å24",icon:"üåê",color:"#ffc107",borderColor:"#d39e00",backgroundColor:"#fffef8",filterValue:"Bitrix24",modules:[],features:["bitrix24-integration"],order:3},sectorInfrastructure:{id:"infrastructure",name:"–°–µ–∫—Ç–æ—Ä –ñ–µ–ª–µ–∑–æ/–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –∏ –ø—Ä–æ—á–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏",icon:"üñ•Ô∏è",color:"#dc3545",borderColor:"#bd2130",backgroundColor:"#fff8f8",filterValues:["–ñ–µ–ª–µ–∑–æ","–ü—Ä–æ—á–µ–µ"],modules:[],features:["infrastructure-management"],order:4}};class Ao{static getAllSectors(){return Object.values(Le).sort((e,o)=>(e.order||0)-(o.order||0))}static getSectorById(e){return Le[e]||null}static getSectorsWithModules(){return this.getAllSectors().filter(e=>e.modules&&e.modules.length>0)}static getSectorColors(){const e={};return Object.values(Le).forEach(o=>{e[o.id]=o.color}),e}static sectorExists(e){return!!Le[e]}static getNextOrder(){return Math.max(...Object.values(Le).map(o=>o.order||0))+1}}const Lo={name:"IndexPage",components:{StatusMessage:_t,LoadingSpinner:bt,SectorContainer:ko},beforeCreate(){console.log("[IndexPage] beforeCreate() called")},created(){console.log("[IndexPage] created() called")},beforeMount(){console.log("[IndexPage] beforeMount() called")},setup(){console.log("[IndexPage] setup() called");const n=Ae(),e=w(!0),o=w(null),t=w(!1),r=w(!1),i=w(""),a=w(null),l=w(null),m=w(!1);console.log("[IndexPage] Initial state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value});const f=w(Eo()),C=w(Ao.getAllSectors()),p=w(!1),L=w(To()),E=b(()=>a.value?Ct(a.value):!1),x=b(()=>{if(!a.value)return"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";const T=a.value.FIRST_NAME?a.value.FIRST_NAME.trim():"",P=a.value.LAST_NAME?a.value.LAST_NAME.trim():"",O=a.value.NAME?a.value.NAME.trim():"";return T&&P?`${T} ${P}`:O&&P&&O!==P?`${O} ${P}`:T&&O&&T!==O?`${T} ${O}`:O&&O.includes(" ")?O:T||P||O||`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${a.value.ID}`}),A=b(()=>o.value?o.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ":"–û—à–∏–±–∫–∞ API":null),S=b(()=>o.value?o.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É.":o.value:null),u=b(()=>o.value&&o.value.includes("no_install_app")),M=b(()=>yt("/install.php"));ne(async()=>{console.log("[IndexPage] onMounted() called");try{console.log("[IndexPage] Calling AccessControlService.checkAccess()...");const T=await Ce.checkAccess();if(console.log("[IndexPage] Access result:",{allowed:T.allowed,hasUser:!!T.user,user:T.user,errorCode:T.errorCode,errorMessage:T.errorMessage}),T.allowed){if(console.log("[IndexPage] Setting accessAllowed to true"),t.value=!0,a.value=T.user,console.log("[IndexPage] Access allowed, setting state:",{accessAllowed:t.value,hasUser:!!a.value,loading:e.value,accessDenied:r.value}),!ze.isAppEntryLogged())try{T.user&&await ze.logAppEntry(T.user)&&ze.markAppEntryLogged()}catch(P){console.error("[IndexPage] Error logging app entry:",P)}}else{r.value=!0;const P=Ee(),O=!P&&T.errorCode===le.ACCESS_DENIED&&T.errorMessage&&T.errorMessage.includes("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø");if(console.log("IndexPage - accessResult:",{errorCode:T.errorCode,errorMessage:T.errorMessage,isInsideB24:P,isDirectAccessDeniedCheck:O}),m.value=O,O&&(i.value=T.errorMessage,console.log("IndexPage - Set direct access denied message:",T.errorMessage)),console.log("IndexPage - State after check:",{accessDenied:r.value,isDirectAccessDenied:m.value,accessErrorMessage:i.value}),!O){if(T.user){const{getAllowedDepartmentIds:X}=await te(async()=>{const{getAllowedDepartmentIds:be}=await import("./access-config-async-BSwYkgbP.js");return{getAllowedDepartmentIds:be}},__vite__mapDeps([3,4,1,5,2]),import.meta.url);l.value={userId:T.user.ID,departmentIds:T.user.UF_DEPARTMENT||[],allowedIds:X()}}T.errorCode===le.USER_NOT_DETERMINED?i.value="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.":T.errorCode===le.ACCESS_DENIED?i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω":i.value=T.errorMessage||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."}}}catch(T){o.value=T.message,console.error("Error checking access:",T)}finally{e.value=!1,console.log("[IndexPage] Final state:",{loading:e.value,accessAllowed:t.value,accessDenied:r.value,hasUser:!!a.value,error:o.value})}});const R=T=>{if(!T){console.error("Route is not defined for report");return}n.push(T)},z=()=>{p.value=!0},F=()=>{p.value=!1};return{loading:e,error:o,accessAllowed:t,accessDenied:r,accessErrorMessage:i,currentUser:a,userName:x,debugInfo:l,isDirectAccessDenied:m,errorTitle:A,errorMessage:S,showInstallLink:u,installPageUrl:M,reportsButtons:f,navigateToReport:R,sectors:C,handleModuleEvent:T=>{console.log("Module event:",T)},handleSectorExpanded:T=>{console.log("Sector expanded:",T.sectorId)},handleSectorCollapsed:T=>{console.log("Sector collapsed:",T.sectorId)},isAdmin:E,showAdminPopup:p,adminButtons:L,openAdminPopup:z,closeAdminPopup:F,navigateToAdmin:T=>{if(!T){console.error("Route is not defined for admin interface");return}n.push(T),F()}}}},Do={class:"index-page"},Io={class:"container"},Po={key:0,class:"install-link"},No=["href"],Ro={key:0,class:"direct-access-denied-info",style:{"margin-top":"15px",padding:"15px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px"}},Oo={key:1,class:"debug-info",style:{"margin-top":"15px",padding:"10px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px","font-size":"12px"}},Uo={key:3,class:"main-content"},Fo={class:"greeting-section"},Bo={class:"greeting-header"},zo={class:"greeting-header-content"},jo={class:"greeting-text"},Wo={class:"sectors-section"},$o={class:"admin-popup-header"},Vo={class:"admin-popup-content"},Xo={class:"admin-buttons-grid"},qo=["onClick"],Ho={class:"admin-icon"},Jo={class:"admin-title"},Ko={key:0,class:"admin-description"};function Yo(n,e,o,t,r,i){const a=V("StatusMessage"),l=V("LoadingSpinner"),m=V("SectorContainer");return c(),d("div",Do,[s("div",Io,[t.error?(c(),K(a,{key:0,type:"error",title:t.errorTitle,message:t.errorMessage},{default:ae(()=>[t.showInstallLink?(c(),d("div",Po,[s("a",{href:t.installPageUrl},"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",8,No)])):k("",!0)]),_:1},8,["title","message"])):k("",!0),t.loading?(c(),K(l,{key:1,message:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞..."})):k("",!0),!t.loading&&t.accessDenied?(c(),K(a,{key:2,type:"error",title:"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",message:t.accessErrorMessage},{default:ae(()=>[t.isDirectAccessDenied?(c(),d("div",Ro,[...e[4]||(e[4]=[s("p",{style:{margin:"0 0 10px 0","font-weight":"600",color:"#856404"}},[s("strong",null,"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")],-1),s("ol",{style:{margin:"0","padding-left":"20px",color:"#856404"}},[s("li",null,"–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24"),s("li",null,"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Bitrix24 (placement, –≤–∏–¥–∂–µ—Ç –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É)")],-1)])])):t.debugInfo?(c(),d("div",Oo,[e[5]||(e[5]=s("strong",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e[6]||(e[6]=s("br",null,null,-1)),Y(" ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+g(t.debugInfo.userId),1),e[7]||(e[7]=s("br",null,null,-1)),Y(" ID –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+g(t.debugInfo.departmentIds),1),e[8]||(e[8]=s("br",null,null,-1)),Y(" –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ID –æ—Ç–¥–µ–ª–æ–≤: "+g(t.debugInfo.allowedIds),1),e[9]||(e[9]=s("br",null,null,-1)),e[10]||(e[10]=s("small",{style:{color:"#856404"}},"–î–æ–±–∞–≤—å—Ç–µ ID –æ—Ç–¥–µ–ª–∞ –≤ —Ñ–∞–π–ª vue-app/src/config/access-config.js",-1))])):k("",!0)]),_:1},8,["message"])):k("",!0),!t.loading&&!t.accessDenied&&t.accessAllowed?(c(),d("div",Uo,[s("div",Fo,[s("div",Bo,[s("div",zo,[e[13]||(e[13]=s("h2",{class:"greeting-title"},"–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ò–¢ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –ü–ª–∞–Ω–µ—Ä–∫–∏ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ü–∏–∏",-1)),s("p",jo,[e[11]||(e[11]=Y(" –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",-1)),s("strong",null,g(t.userName),1),e[12]||(e[12]=Y("! ",-1))])]),t.isAdmin?(c(),d("button",{key:0,class:"admin-button-header",onClick:e[0]||(e[0]=(...f)=>t.openAdminPopup&&t.openAdminPopup(...f)),title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"}," ‚öôÔ∏è ")):k("",!0)])]),s("div",Wo,[(c(!0),d(H,null,J(t.sectors,f=>(c(),K(m,{key:f.id,"sector-config":f,onModuleEvent:t.handleModuleEvent,onSectorExpanded:t.handleSectorExpanded,onSectorCollapsed:t.handleSectorCollapsed},null,8,["sector-config","onModuleEvent","onSectorExpanded","onSectorCollapsed"]))),128))]),t.showAdminPopup&&t.isAdmin?(c(),d("div",{key:0,class:"admin-popup-overlay",onClick:e[3]||(e[3]=(...f)=>t.closeAdminPopup&&t.closeAdminPopup(...f))},[s("div",{class:"admin-popup",onClick:e[2]||(e[2]=ce(()=>{},["stop"]))},[s("div",$o,[e[14]||(e[14]=s("h3",{class:"admin-popup-title"},"‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",-1)),s("button",{class:"admin-popup-close",onClick:e[1]||(e[1]=(...f)=>t.closeAdminPopup&&t.closeAdminPopup(...f))}," ‚úï ")]),s("div",Vo,[s("div",Xo,[(c(!0),d(H,null,J(t.adminButtons,f=>(c(),d("div",{key:f.id,class:"admin-interface-button",onClick:C=>t.navigateToAdmin(f.route)},[s("div",Ho,g(f.icon),1),s("div",Jo,g(f.title),1),f.description?(c(),d("div",Ko,g(f.description),1)):k("",!0)],8,qo))),128))])])])])):k("",!0)])):k("",!0)])])}const Go=$(Lo,[["render",Yo],["__scopeId","data-v-12137466"]]),se=w(new Map),re=w({hits:0,misses:0,sets:0,invalidations:0}),Qe={defaultTTL:5*60*1e3,maxSize:100,enableStats:!0};function Qo(n={}){const{ttl:e=Qe.defaultTTL,maxSize:o=Qe.maxSize,enableStats:t=Qe.enableStats}=n,r=S=>{const u=new WeakSet;return JSON.stringify(S,(M,R)=>{if(typeof R=="object"&&R!==null){if(u.has(R))return"[Circular]";u.add(R)}return typeof R=="function"||R===void 0?null:R})},i=(S,u={})=>{const M=Object.keys(u).sort().reduce((R,z)=>{const F=u[z];if(F==null)R[z]=null;else if(typeof F=="object")try{R[z]=r(F)}catch{R[z]=String(F)}else R[z]=F;return R},{});try{return`${S}_${r(M)}`}catch{const z=Object.keys(M).sort().map(F=>`${F}=${M[F]}`).join("&");return`${S}_${z}`}},a=S=>{const u=se.value.get(S);return u?Date.now()-u.timestamp>u.ttl?(se.value.delete(S),t&&re.value.misses++,null):(u.lastAccessed=Date.now(),t&&re.value.hits++,u.data):(t&&re.value.misses++,null)},l=(S,u,M=null)=>{se.value.size>=o&&m(),se.value.set(S,{data:u,timestamp:Date.now(),lastAccessed:Date.now(),ttl:M||e}),t&&re.value.sets++},m=()=>{let S=null,u=1/0;for(const[M,R]of se.value.entries())R.lastAccessed<u&&(u=R.lastAccessed,S=M);S&&se.value.delete(S)},f=()=>{se.value.clear(),t&&(re.value={hits:0,misses:0,sets:0,invalidations:0})},C=S=>{const u=typeof S=="string"?new RegExp(S):S;let M=0;for(const R of se.value.keys())u.test(R)&&(se.value.delete(R),M++);return t&&(re.value.invalidations+=M),M},p=()=>{const S=Date.now();let u=0;for(const[M,R]of se.value.entries())S-R.timestamp>R.ttl&&(se.value.delete(M),u++);return u},L=()=>{const S=re.value.hits+re.value.misses,u=S>0?(re.value.hits/S*100).toFixed(2):0;return{...re.value,size:se.value.size,hitRate:`${u}%`}};let E=null;const x=(S=5*60*1e3)=>{E&&clearInterval(E),E=setInterval(()=>{p()},S)},A=()=>{E&&(clearInterval(E),E=null)};return x(),{get:a,set:l,clear:f,invalidate:C,cleanup:p,getCacheKey:i,getStats:L,startAutoCleanup:x,stopAutoCleanup:A}}function he(n){if(!n||typeof n!="object"||!n.timestamp||typeof n.timestamp!="string"||!n.event||typeof n.event!="string"||!n.category||typeof n.category!="string"||!["tasks","smart-processes","errors"].includes(n.category))return!1;try{new Date(n.timestamp)}catch{return!1}return!0}function Zo(n){if(!n||typeof n!="object")return!1;for(const[e,o]of Object.entries(n))if(typeof o=="function")return!1;return!0}function Me(n){if(!he(n))return null;const e={timestamp:n.timestamp,event:n.event,category:n.category};return n.ip&&typeof n.ip=="string"&&(e.ip=n.ip),n.payload&&typeof n.payload=="object"&&(e.payload=n.payload),n.details&&Zo(n.details)&&(e.details=n.details),e}function st(n){return Array.isArray(n)?n.map(e=>Me(e)).filter(e=>e!==null):[]}const{get:en,set:tn,getCacheKey:on,invalidate:mt}=Qo({ttl:2*60*1e3,maxSize:50});class ft{static getBaseUrl(){return me("/api/webhook-logs.php")}static get BASE_URL(){return this.getBaseUrl()}static async getLogs(e={},o=1,t=50,r=!1){if(o<1)throw new Error("Page must be greater than 0");if(t<1||t>1e3)throw new Error("Limit must be between 1 and 1000");const i={category:e.category||null,event:e.event||null,date:e.date||null,hour:e.hour!==void 0?e.hour:null,dateFrom:e.dateFrom||null,dateTo:e.dateTo||null,ip:e.ip||null,status:e.status||null},a=this.getBaseUrl(),l=on(a,{filters:i,page:o,limit:t});if(!r){const f=en(l);if(f)return console.log("[WebhookLogsApiService] Cache hit:",l.substring(0,50)+"..."),f}console.log("[WebhookLogsApiService] Cache miss:",l.substring(0,50)+"...");const m=new URLSearchParams({page:o.toString(),limit:t.toString()});i.category&&m.append("category",i.category),i.event&&m.append("event",i.event),i.date&&m.append("date",i.date),i.hour!==null&&m.append("hour",i.hour.toString()),i.dateFrom&&m.append("dateFrom",i.dateFrom),i.dateTo&&m.append("dateTo",i.dateTo),i.ip&&m.append("ip",i.ip),i.status&&m.append("status",i.status);try{const f=this.getBaseUrl(),C=await fetch(`${f}?${m.toString()}`);if(!C.ok){const x=await C.text();let A;try{A=JSON.parse(x)}catch{A={error:x}}throw new Error(A.error_description||A.error||`HTTP error! status: ${C.status}`)}const p=await C.json();if(console.log("[WebhookLogsApiService] API response:",{success:p.success,logsCount:p.logs?.length||0,pagination:p.pagination,hasError:!!p.error}),p.error)throw new Error(p.error_description||p.error);if(!p.success)throw console.warn("[WebhookLogsApiService] API returned success=false:",p),new Error("API request failed");if(!Array.isArray(p.logs))throw console.error("[WebhookLogsApiService] Invalid logs format:",p.logs),new Error("Invalid logs format: expected array");const L=st(p.logs);(!p.pagination||typeof p.pagination!="object")&&(console.warn("[WebhookLogsApiService] Invalid pagination format:",p.pagination),p.pagination={page:o,limit:t,total:L.length,pages:Math.ceil(L.length/t)});const E={success:!0,logs:L,pagination:{page:p.pagination.page||o,limit:p.pagination.limit||t,total:p.pagination.total||L.length,pages:p.pagination.pages||Math.ceil((p.pagination.total||L.length)/t)}};return tn(l,E),E}catch(f){throw console.error("[WebhookLogsApiService] Error:",f),f}}static invalidateCacheOnFilterChange(e={},o={}){const t=mt(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Invalidated ${t} entries on filter change`)}static clearCache(){const e=mt(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Cleared ${e} entries`)}static async getLogDetails(e,o=null){const t={};return o&&(t.date=o),(await this.getLogs(t,1,1e3)).logs.find(a=>`${a.timestamp}_${a.event}`===e)||null}static async getErrors(e={},o=1,t=50){return this.getLogs({...e,category:"errors"},o,t)}static async getStats(e={}){const o=await this.getLogs(e,1,1e3),t={total:o.pagination.total||o.logs.length,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}};return o.logs.forEach(r=>{r.category==="tasks"?t.tasks++:r.category==="smart-processes"?t.smartProcesses++:r.category==="errors"&&t.errors++,t.byEvent[r.event]||(t.byEvent[r.event]=0),t.byEvent[r.event]++;const i=r.timestamp.split("T")[0];t.byDate[i]||(t.byDate[i]=0),t.byDate[i]++}),t}}function nn(){const n=Lt(),e=Ae(),o=new Date().toISOString().split("T")[0],t=w({category:null,event:null,dateFrom:o,dateTo:null,hour:null,ip:null,search:null,status:null}),r=()=>{const f=n.query;t.value={category:f.category||null,event:f.event||null,dateFrom:f.dateFrom||f.date||o,dateTo:f.dateTo||null,hour:f.hour?parseInt(f.hour):null,ip:f.ip||null,search:f.search||null,status:f.status||null}},i=f=>{if(m)return;const C={...n.query};Object.keys(f).forEach(L=>{const E=f[L];E!==null&&E!==""&&E!==void 0?C[L]=E.toString():delete C[L]}),JSON.stringify(C)!==JSON.stringify(n.query)&&(m=!0,e.replace({path:n.path,query:C}).finally(()=>{setTimeout(()=>{m=!1},100)}))},a=f=>{const C={...t.value,...f};JSON.stringify(t.value)!==JSON.stringify(C)&&(t.value=C,i(t.value))},l=()=>{t.value={category:null,event:null,dateFrom:o,dateTo:null,hour:null,ip:null,search:null,status:null},i(t.value)};ne(()=>{r()});let m=!1;return fe(()=>n.query,(f,C)=>{if(m)return;JSON.stringify(f)!==JSON.stringify(C)&&r()},{deep:!0}),{filters:t,updateFilters:a,clearFilters:l,loadFiltersFromUrl:r}}function sn(n,e,o={}){if(!e||!e.trim())return n;const{caseSensitive:t=!1,searchInEvent:r=!0,searchInPayload:i=!0,searchInDetails:a=!0,searchInIp:l=!0,searchInTimestamp:m=!1}=o,f=t?e.trim():e.trim().toLowerCase();return n.filter(C=>{if(r&&C.event&&(t?C.event:C.event.toLowerCase()).includes(f))return!0;if(i&&C.payload)try{const p=JSON.stringify(C.payload);if((t?p:p.toLowerCase()).includes(f))return!0}catch(p){console.warn("Error searching in payload:",p)}if(a&&C.details)try{const p=JSON.stringify(C.details);if((t?p:p.toLowerCase()).includes(f))return!0}catch(p){console.warn("Error searching in details:",p)}return!!(l&&C.ip&&(t?C.ip:C.ip.toLowerCase()).includes(f)||m&&C.timestamp&&(t?C.timestamp:C.timestamp.toLowerCase()).includes(f))})}function tt(n){if(!n||typeof n!="object"||n.category!==void 0&&n.category!==null&&!["tasks","smart-processes","errors"].includes(n.category)||n.date!==void 0&&n.date!==null&&!/^\d{4}-\d{2}-\d{2}$/.test(n.date))return!1;if(n.hour!==void 0&&n.hour!==null){const e=parseInt(n.hour,10);if(isNaN(e)||e<0||e>23)return!1}return!(n.ip!==void 0&&n.ip!==null&&(typeof n.ip!="string"||n.ip.length===0))}function an(n){if(!n||typeof n!="object")return!1;const e=parseInt(n.page,10),o=parseInt(n.limit,10),t=parseInt(n.total,10),r=parseInt(n.pages,10);return!(isNaN(e)||e<1||isNaN(o)||o<1||o>1e3||isNaN(t)||t<0||isNaN(r)||r<0)}function ht(n){if(n==null)return"";const e=String(n),o=e.replace(/"/g,'""');return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${o}"`:o}function rn(n){return n==null?"":typeof n=="object"?JSON.stringify(n):String(n)}function ln(n,e="webhook-logs.csv",o={}){return new Promise((t,r)=>{try{if(!Array.isArray(n)||n.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{columns:i=null,onProgress:a=null}=o,l=i||Object.keys(n[0]),f=[l.map(x=>ht(x)).join(",")],C=n.length,p=1e3;for(let x=0;x<C;x+=p){const A=n.slice(x,x+p);if(A.forEach(S=>{const u=l.map(M=>{const R=S[M];return ht(rn(R))});f.push(u.join(","))}),a){const S=Math.min(100,Math.round((x+A.length)/C*100));a(S)}}const L="\uFEFF"+f.join(`
`),E=new Blob([L],{type:"text/csv;charset=utf-8;"});St(E,e),a&&a(100),t()}catch(i){r(i)}})}function cn(n,e="webhook-logs.json",o={}){return new Promise((t,r)=>{try{if(!Array.isArray(n)||n.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{pretty:i=!0,onProgress:a=null}=o,l=i?JSON.stringify(n,null,2):JSON.stringify(n);a&&a(50);const m=new Blob([l],{type:"application/json;charset=utf-8;"});St(m,e),a&&a(100),t()}catch(i){r(i)}})}function St(n,e){const o=URL.createObjectURL(n),t=document.createElement("a");t.href=o,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(o)},100)}function dn(n,e={},o=0){const t=new Date().toISOString().split("T")[0],r=new Date().toTimeString().split(" ")[0].replace(/:/g,"-");let i=`webhook-logs_${t}_${r}`;const a=[];return e.category&&a.push(`cat-${e.category}`),e.event&&a.push(`evt-${e.event.substring(0,10)}`),e.dateFrom&&a.push(`from-${e.dateFrom}`),e.dateTo&&a.push(`to-${e.dateTo}`),a.length>0&&(i+=`_${a.join("-")}`),o>0&&(i+=`_${o}records`),`${i}.${n}`}function un(n){const e=[];if(!Array.isArray(n))return e.push("–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),{valid:!1,errors:e,estimatedSize:0};if(n.length===0)return e.push("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"),{valid:!1,errors:e,estimatedSize:0};const o=JSON.stringify(n).length,t=50*1024*1024;return o>t&&e.push(`–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö (${Math.round(o/1024/1024)} MB). –≠–∫—Å–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è.`),{valid:e.length===0,errors:e,estimatedSize:o}}function at(n,e="short"){if(!n)return"‚Äî";try{const o=new Date(n);if(isNaN(o.getTime()))return"Invalid date";switch(e){case"short":return o.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});case"long":return o.toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});case"relative":return gn(o);default:return o.toLocaleString("ru-RU")}}catch{return"Invalid date"}}function gn(n){const o=new Date-n,t=Math.floor(o/1e3),r=Math.floor(t/60),i=Math.floor(r/60),a=Math.floor(i/24);return t<60?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":r<60?`${r} ${Ze(r,"–º–∏–Ω—É—Ç—É","–º–∏–Ω—É—Ç—ã","–º–∏–Ω—É—Ç")} –Ω–∞–∑–∞–¥`:i<24?`${i} ${Ze(i,"—á–∞—Å","—á–∞—Å–∞","—á–∞—Å–æ–≤")} –Ω–∞–∑–∞–¥`:a<7?`${a} ${Ze(a,"–¥–µ–Ω—å","–¥–Ω—è","–¥–Ω–µ–π")} –Ω–∞–∑–∞–¥`:at(n.toISOString(),"short")}function Ze(n,e,o,t){const r=n%10,i=n%100;return r===1&&i!==11?e:r>=2&&r<=4&&(i<10||i>=20)?o:t}function Te(n){return n?n.replace(/^ON/,"").split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):"‚Äî"}function _e(n){return{tasks:"–ó–∞–¥–∞—á–∏","smart-processes":"–°–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å—ã",errors:"–û—à–∏–±–∫–∏"}[n]||n}function rt(n){if(!n||typeof n!="object")return"‚Äî";const e=[];if(n.task_id&&e.push(`–ó–∞–¥–∞—á–∞ #${n.task_id}`),n.entity_id&&e.push(`–°—É—â–Ω–æ—Å—Ç—å #${n.entity_id}`),n.task_title&&e.push(`"${n.task_title}"`),n.title&&e.push(`"${n.title}"`),n.comment_text){const o=n.comment_text.length>50?n.comment_text.substring(0,50)+"...":n.comment_text;e.push(`–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${o}`)}return e.length>0?e.join(" ‚Ä¢ "):"‚Äî"}const mn={name:"WebhookLogsExport",props:{logs:{type:Array,default:()=>[]},selectedLogs:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},totalCount:{type:Number,default:0}},emits:["export-start","export-complete","export-error"],setup(n,{emit:e}){const o=w(!1),t=w("csv"),r=w("all"),i=w(!0),a=w(!1),l=w(0),m=w([]),f=w(null),C=b(()=>n.selectedLogs.length),p=b(()=>n.logs.length>0||n.totalCount>0),L=b(()=>n.filters.category||n.filters.event||n.filters.dateFrom||n.filters.dateTo),E=b(()=>r.value==="selected"?C.value:n.logs.length||n.totalCount),x=b(()=>r.value==="selected"?C.value>0:p.value),A=()=>{l.value=0,m.value=[],f.value=null,C.value>0?r.value="selected":r.value="all",o.value=!0,u()},S=()=>{a.value||(o.value=!1)},u=()=>{const F=M(),D=un(F);m.value=D.errors,f.value=D.estimatedSize},M=()=>(r.value==="selected"?n.selectedLogs:n.logs).map(v=>Me(v)).filter(v=>he(v)?!0:(console.warn("[WebhookLogsExport] Skipping invalid log:",v),!1)),R=async()=>{try{a.value=!0,l.value=0;let F=M();if(F.length===0)throw new Error("–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const D=F.map(I=>({timestamp:I.timestamp,event:I.event,category:I.category,ip:I.ip||null,details:I.details||null,payload:I.payload||null,formatted:{timestamp:at(I.timestamp),event:Te(I.event),category:_e(I.category),details:rt(I.details)}}));e("export-start",{format:t.value,scope:r.value,count:D.length});const v=dn(t.value,n.filters,D.length),y=I=>{l.value=I};t.value==="csv"?await ln(D,v,{onProgress:y}):await cn(D,v,{pretty:i.value,onProgress:y}),e("export-complete",{format:t.value,filename:v,count:D.length}),setTimeout(()=>{a.value=!1,o.value=!1,l.value=0},500)}catch(F){console.error("[WebhookLogsExport] Export error:",F),e("export-error",F),a.value=!1,l.value=0,alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${F.message}`)}},z=F=>F<1024?`${F} B`:F<1024*1024?`${(F/1024).toFixed(2)} KB`:`${(F/1024/1024).toFixed(2)} MB`;return fe([r,()=>n.logs,()=>n.selectedLogs],()=>{o.value&&u()}),{showExportModal:o,exportFormat:t,exportScope:r,jsonPretty:i,exporting:a,exportProgress:l,exportWarnings:m,estimatedSize:f,selectedCount:C,hasAllLogs:p,hasFilters:L,exportCount:E,canExport:x,openExportModal:A,closeExportModal:S,handleExport:R,formatSize:z}}},fn={class:"webhook-logs-export"},hn=["disabled","title"],vn={key:0,class:"selected-badge"},pn={class:"export-modal-header"},yn={class:"export-modal-body"},_n={class:"export-section"},bn={class:"radio-group"},wn={class:"export-section"},Cn={class:"radio-group"},Sn=["disabled"],kn={class:"radio-label"},xn={key:0},En={key:1},Mn=["disabled"],Tn={class:"radio-label"},An={key:0,class:"export-section"},Ln={class:"checkbox-option"},Dn={class:"export-info"},In={class:"info-item"},Pn={class:"info-value"},Nn={key:0,class:"info-item"},Rn={class:"info-value"},On={key:1,class:"export-warnings"},Un={key:0,class:"export-progress"},Fn={class:"progress-bar"},Bn={class:"progress-text"},zn={class:"export-modal-footer"},jn=["disabled"],Wn={key:0},$n={key:1},Vn=["disabled"];function Xn(n,e,o,t,r,i){return c(),d("div",fn,[s("button",{onClick:e[0]||(e[0]=(...a)=>t.openExportModal&&t.openExportModal(...a)),class:"btn-export",disabled:!t.canExport,title:t.canExport?"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"},[e[11]||(e[11]=s("span",{class:"btn-icon"},"üì•",-1)),e[12]||(e[12]=s("span",{class:"btn-text"},"–≠–∫—Å–ø–æ—Ä—Ç",-1)),t.selectedCount>0?(c(),d("span",vn,g(t.selectedCount),1)):k("",!0)],8,hn),q(pe,{name:"modal"},{default:ae(()=>[t.showExportModal?(c(),d("div",{key:0,class:"export-modal-overlay",onClick:e[10]||(e[10]=(...a)=>t.closeExportModal&&t.closeExportModal(...a))},[s("div",{class:"export-modal",onClick:e[9]||(e[9]=ce(()=>{},["stop"]))},[s("div",pn,[e[13]||(e[13]=s("h3",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",-1)),s("button",{onClick:e[1]||(e[1]=(...a)=>t.closeExportModal&&t.closeExportModal(...a)),class:"btn-close"},"‚úï")]),s("div",yn,[s("div",_n,[e[16]||(e[16]=s("h4",null,"–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞",-1)),s("div",bn,[s("label",{class:B(["radio-option",{active:t.exportFormat==="csv"}])},[ee(s("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=a=>t.exportFormat=a),value:"csv",class:"radio-input"},null,512),[[Fe,t.exportFormat]]),e[14]||(e[14]=s("span",{class:"radio-label"},[s("strong",null,"CSV"),s("small",null,"–î–ª—è Excel, LibreOffice")],-1))],2),s("label",{class:B(["radio-option",{active:t.exportFormat==="json"}])},[ee(s("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=a=>t.exportFormat=a),value:"json",class:"radio-input"},null,512),[[Fe,t.exportFormat]]),e[15]||(e[15]=s("span",{class:"radio-label"},[s("strong",null,"JSON"),s("small",null,"–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, API")],-1))],2)])]),s("div",wn,[e[19]||(e[19]=s("h4",null,"–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",-1)),s("div",Cn,[s("label",{class:B(["radio-option",{active:t.exportScope==="all",disabled:!t.hasAllLogs}])},[ee(s("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=a=>t.exportScope=a),value:"all",disabled:!t.hasAllLogs,class:"radio-input"},null,8,Sn),[[Fe,t.exportScope]]),s("span",kn,[e[17]||(e[17]=s("strong",null,"–í—Å–µ –∑–∞–ø–∏—Å–∏",-1)),t.hasFilters?(c(),d("small",xn,"–° –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ ("+g(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π)",1)):(c(),d("small",En,"–í—Å–µ–≥–æ: "+g(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π",1))])],2),s("label",{class:B(["radio-option",{active:t.exportScope==="selected",disabled:t.selectedCount===0}])},[ee(s("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=a=>t.exportScope=a),value:"selected",disabled:t.selectedCount===0,class:"radio-input"},null,8,Mn),[[Fe,t.exportScope]]),s("span",Tn,[e[18]||(e[18]=s("strong",null,"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏",-1)),s("small",null,g(t.selectedCount)+" –∑–∞–ø–∏—Å–µ–π –≤—ã–±—Ä–∞–Ω–æ",1)])],2)])]),t.exportFormat==="json"?(c(),d("div",An,[e[21]||(e[21]=s("h4",null,"–û–ø—Ü–∏–∏ JSON",-1)),s("label",Ln,[ee(s("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=a=>t.jsonPretty=a),class:"checkbox-input"},null,512),[[vt,t.jsonPretty]]),e[20]||(e[20]=s("span",{class:"checkbox-label"},"–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)",-1))])])):k("",!0),s("div",Dn,[s("div",In,[e[22]||(e[22]=s("span",{class:"info-label"},"–ó–∞–ø–∏—Å–µ–π –∫ —ç–∫—Å–ø–æ—Ä—Ç—É:",-1)),s("span",Pn,g(t.exportCount),1)]),t.estimatedSize?(c(),d("div",Nn,[e[23]||(e[23]=s("span",{class:"info-label"},"–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä:",-1)),s("span",Rn,g(t.formatSize(t.estimatedSize)),1)])):k("",!0)]),t.exportWarnings.length>0?(c(),d("div",On,[(c(!0),d(H,null,J(t.exportWarnings,(a,l)=>(c(),d("div",{key:l,class:"warning-item"}," ‚ö†Ô∏è "+g(a),1))),128))])):k("",!0)]),t.exporting?(c(),d("div",Un,[s("div",Fn,[s("div",{class:"progress-fill",style:Pe({width:`${t.exportProgress}%`})},null,4)]),s("div",Bn," –≠–∫—Å–ø–æ—Ä—Ç: "+g(t.exportProgress)+"% ",1)])):k("",!0),s("div",zn,[s("button",{onClick:e[7]||(e[7]=(...a)=>t.handleExport&&t.handleExport(...a)),disabled:t.exporting||!t.canExport,class:"btn-primary"},[t.exporting?(c(),d("span",Wn,"–≠–∫—Å–ø–æ—Ä—Ç...")):(c(),d("span",$n,"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"))],8,jn),s("button",{onClick:e[8]||(e[8]=(...a)=>t.closeExportModal&&t.closeExportModal(...a)),disabled:t.exporting,class:"btn-secondary"}," –û—Ç–º–µ–Ω–∞ ",8,Vn)])])])):k("",!0)]),_:1})])}const qn=$(mn,[["render",Xn],["__scopeId","data-v-7ae66f8c"]]);function Hn(n,e=300){let o;return function(...r){const i=()=>{clearTimeout(o),n(...r)};clearTimeout(o),o=setTimeout(i,e)}}const Jn={name:"WebhookLogSearch",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","search"],setup(n,{emit:e}){const o=w(n.modelValue||""),t=w(!1),r=w(null),i=Hn(E=>{t.value=!1,e("search",E)},400),a=()=>{t.value=!0,e("update:modelValue",o.value),i(o.value)},l=()=>{t.value=!1,e("search",o.value)},m=()=>{o.value="",t.value=!1,r.value=null,e("update:modelValue",""),e("search","")};return fe(()=>n.modelValue,E=>{E!==o.value&&(o.value=E)}),{searchQuery:o,isSearching:t,searchResultsCount:r,handleSearchInput:a,handleSearch:l,clearSearch:m,setResultsCount:E=>{r.value=E},getResultsText:E=>{const x=E%10,A=E%100;return A>=11&&A<=19?"–∑–∞–ø–∏—Å–µ–π":x===1?"–∑–∞–ø–∏—Å—å":x>=2&&x<=4?"–∑–∞–ø–∏—Å–∏":"–∑–∞–ø–∏—Å–µ–π"},performSearch:(E,x)=>{if(!E||!x||!Array.isArray(x))return[];const A=E.toLowerCase().trim();return A.length===0?x:x.map(u=>Me(u)).filter(u=>he(u)).filter(u=>{if(u.event&&u.event.toLowerCase().includes(A)||u.category&&u.category.toLowerCase().includes(A)||u.ip&&u.ip.toLowerCase().includes(A)||u.details&&typeof u.details=="object"&&(u.details.task_id&&String(u.details.task_id).includes(A)||u.details.task_title&&u.details.task_title.toLowerCase().includes(A)||u.details.entity_id&&String(u.details.entity_id).includes(A)||u.details.title&&u.details.title.toLowerCase().includes(A)||u.details.comment_text&&u.details.comment_text.toLowerCase().includes(A)))return!0;if(u.payload&&typeof u.payload=="object")try{if(JSON.stringify(u.payload).toLowerCase().includes(A))return!0}catch{}return!1})},formatSearchResult:E=>{const x=[];if(E.event&&x.push(Te(E.event)),E.category&&x.push(_e(E.category)),E.details){const A=rt(E.details);A!=="‚Äî"&&x.push(A)}return x.join(" ‚Ä¢ ")}}}},Kn={class:"webhook-search"},Yn={class:"search-wrapper"},Gn={key:0,class:"search-indicator"},Qn={key:1,class:"search-results"};function Zn(n,e,o,t,r,i){return c(),d("div",Kn,[s("div",Yn,[e[5]||(e[5]=s("span",{class:"search-icon"},"üîç",-1)),ee(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.searchQuery=a),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ª–æ–≥–æ–≤ (—Å–æ–±—ã—Ç–∏–µ, payload, IP, –¥–µ—Ç–∞–ª–∏)...",class:"search-input",onInput:e[1]||(e[1]=(...a)=>t.handleSearchInput&&t.handleSearchInput(...a)),onKeyup:[e[2]||(e[2]=ge((...a)=>t.handleSearch&&t.handleSearch(...a),["enter"])),e[3]||(e[3]=ge((...a)=>t.clearSearch&&t.clearSearch(...a),["esc"]))]},null,544),[[Ie,t.searchQuery]]),t.searchQuery?(c(),d("button",{key:0,onClick:e[4]||(e[4]=(...a)=>t.clearSearch&&t.clearSearch(...a)),class:"clear-button",title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ (Esc)","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):k("",!0)]),t.isSearching?(c(),d("div",Gn,[...e[6]||(e[6]=[s("span",{class:"spinner"},null,-1),Y(" –ü–æ–∏—Å–∫... ",-1)])])):k("",!0),t.searchQuery&&t.searchResultsCount!==null?(c(),d("div",Qn," –ù–∞–π–¥–µ–Ω–æ: "+g(t.searchResultsCount)+" "+g(t.getResultsText(t.searchResultsCount)),1)):k("",!0)])}const es=$(Jn,[["render",Zn],["__scopeId","data-v-db228863"]]);function ts(n,e=null){const o=()=>{try{const a=localStorage.getItem(n);return a?JSON.parse(a):e}catch(a){return console.error(`Error loading ${n} from localStorage:`,a),e}},t=a=>{try{localStorage.setItem(n,JSON.stringify(a))}catch(l){console.error(`Error saving ${n} to localStorage:`,l)}},r=()=>{try{localStorage.removeItem(n)}catch(a){console.error(`Error clearing ${n} from localStorage:`,a)}},i=w(o());return fe(i,a=>{t(a)},{deep:!0}),{value:i,save:t,load:o,clear:r}}const os={name:"WebhookLogFilters",props:{filters:{type:Object,required:!0}},emits:["update:filters","reset"],setup(n,{emit:e}){const o=w(null),t=ts("webhook-filters",{category:null,event:null,dateFrom:null,dateTo:null,hour:null,ip:null,status:null}),r=v=>(o.value=null,tt(v)?(e("update:filters",v),!0):(o.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",console.error("[WebhookLogFilters] Validation error:",o.value),!1)),i=new Date().toISOString().split("T")[0],a=w({category:t.value.category||n.filters.category||null,event:t.value.event||n.filters.event||null,dateFrom:t.value.dateFrom||n.filters.dateFrom||n.filters.date||i,dateTo:t.value.dateTo||n.filters.dateTo||null,hour:t.value.hour!==void 0?t.value.hour:n.filters.hour!==void 0?n.filters.hour:null,ip:t.value.ip||n.filters.ip||null,status:t.value.status||n.filters.status||null}),l=w(null),m=[{id:"today",label:"–°–µ–≥–æ–¥–Ω—è",getDates:()=>({from:i,to:i})},{id:"yesterday",label:"–í—á–µ—Ä–∞",getDates:()=>{const v=new Date;v.setDate(v.getDate()-1);const y=v.toISOString().split("T")[0];return{from:y,to:y}}},{id:"last7days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",getDates:()=>{const v=new Date;return v.setDate(v.getDate()-7),{from:v.toISOString().split("T")[0],to:i}}},{id:"last30days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π",getDates:()=>{const v=new Date;return v.setDate(v.getDate()-30),{from:v.toISOString().split("T")[0],to:i}}}],f=v=>{const y=m.find(I=>I.id===v);if(y){const I=y.getDates();a.value.dateFrom=I.from,a.value.dateTo=I.to,l.value=v,F()}};fe(()=>n.filters,v=>{a.value={category:v.category||null,event:v.event||null,dateFrom:v.dateFrom||v.date||i,dateTo:v.dateTo||null,hour:v.hour!==void 0?v.hour:null,ip:v.ip||null,status:v.status||null}},{deep:!0}),fe(a,v=>{t.value={...v},e("update:filters",{...v})},{deep:!0});const C=b(()=>{const v={};return a.value.category&&(v.category=a.value.category),a.value.event&&(v.event=a.value.event),a.value.hour!==null&&(v.hour=a.value.hour),a.value.ip&&(v.ip=a.value.ip),a.value.status&&(v.status=a.value.status),a.value.dateFrom&&a.value.dateFrom!==i&&(v.dateFrom=a.value.dateFrom),a.value.dateTo&&(v.dateTo=a.value.dateTo),v}),p=b(()=>Object.keys(C.value).length>0),L=v=>({category:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è",event:"–°–æ–±—ã—Ç–∏–µ",hour:"–ß–∞—Å",ip:"IP –∞–¥—Ä–µ—Å",status:"–°—Ç–∞—Ç—É—Å",dateFrom:"–î–∞—Ç–∞ –æ—Ç",dateTo:"–î–∞—Ç–∞ –¥–æ"})[v]||v,E=(v,y)=>v==="category"?_e(y)||y:v==="hour"?`${String(y).padStart(2,"0")}:00`:v==="event"?Te(y)||y:v==="status"&&{success:"–£—Å–ø–µ—à–Ω–æ",error:"–û—à–∏–±–∫–∞",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"}[y]||y,x=b(()=>[{value:null,label:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},{value:"tasks",label:_e("tasks")},{value:"smart-processes",label:_e("smart-processes")},{value:"errors",label:_e("errors")}]),A=b(()=>[{value:null,label:"–í—Å–µ —Å–æ–±—ã—Ç–∏—è"},...["ONTASKADD","ONTASKUPDATE","ONTASKDELETE","ONTASKCOMMENTADD","ONTASKCOMMENTUPDATE","ONTASKCOMMENTDELETE","ONCRMDYNAMICITEMADD","ONCRMDYNAMICITEMUPDATE","ONCRMDYNAMICITEMDELETE"].map(y=>({value:y,label:Te(y)}))]),S=v=>{v==="hour"?a.value[v]=null:v==="dateFrom"?a.value[v]=i:a.value[v]=null,l.value=null},u=v=>{const y={...a.value,category:v||null};r(y)&&(a.value.category=v)},M=v=>{const y={...a.value,event:v||null};r(y)&&(a.value.event=v)},R=(v,y)=>{if(v&&!/^\d{4}-\d{2}-\d{2}$/.test(v)){console.error("[WebhookLogFilters] Invalid date format:",v),o.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã";return}const I={...a.value,[y]:v||null};r(I)&&(a.value[y]=v)},z=v=>{if(v!=null){const I=parseInt(v,10);if(isNaN(I)||I<0||I>23){console.error("[WebhookLogFilters] Invalid hour:",v),o.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∞—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23)";return}}const y={...a.value,hour:v!=null?parseInt(v,10):null};r(y)&&(a.value.hour=v!=null?parseInt(v,10):null)},F=()=>{r({...a.value})},D=()=>{a.value={category:null,event:null,dateFrom:i,dateTo:null,hour:null,ip:null,status:null},l.value=null,t.clear(),e("reset")};return ne(()=>{t.value&&Object.keys(t.value).length>0&&e("update:filters",{...t.value})}),{localFilters:a,activeFilters:C,hasActiveFilters:p,getFilterLabel:L,getFilterValue:E,clearFilter:S,handleFilterChange:F,handleCategoryChange:u,handleEventChange:M,handleDateChange:R,handleHourChange:z,handleReset:D,quickFilters:m,activeQuickFilter:l,applyQuickFilter:f,categoryOptions:x,eventOptions:A,validationError:o}}},ns={class:"webhook-log-filters"},ss={key:0,class:"active-filters-indicator"},as=["onClick"],rs={key:1,class:"validation-error"},is={class:"quick-filters"},ls=["onClick"],cs={class:"filters-row"},ds={class:"filter-group"},us=["value"],gs={class:"filter-group"},ms=["value"],fs={class:"filter-group"},hs={class:"filter-group"},vs={class:"filter-group"},ps={class:"filter-group"},ys={class:"filter-group"};function _s(n,e,o,t,r,i){return c(),d("div",ns,[t.hasActiveFilters?(c(),d("div",ss,[e[14]||(e[14]=s("span",{class:"indicator-text"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(H,null,J(t.activeFilters,(a,l)=>(c(),d("span",{key:l,class:"filter-badge"},[Y(g(t.getFilterLabel(l))+": "+g(t.getFilterValue(l,a))+" ",1),s("button",{onClick:m=>t.clearFilter(l),class:"filter-badge-remove",title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"}," √ó ",8,as)]))),128)),s("button",{onClick:e[0]||(e[0]=(...a)=>t.handleReset&&t.handleReset(...a)),class:"btn-clear-all"}," –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ ")])):k("",!0),t.validationError?(c(),d("div",rs," ‚ö†Ô∏è "+g(t.validationError),1)):k("",!0),s("div",is,[e[15]||(e[15]=s("span",{class:"quick-filters-label"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(H,null,J(t.quickFilters,a=>(c(),d("button",{key:a.id,onClick:l=>t.applyQuickFilter(a.id),class:B(["quick-filter-btn",{active:t.activeQuickFilter===a.id}])},g(a.label),11,ls))),128))]),s("div",cs,[s("div",ds,[e[16]||(e[16]=s("label",{for:"category-filter"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è:",-1)),ee(s("select",{id:"category-filter","onUpdate:modelValue":e[1]||(e[1]=a=>t.localFilters.category=a),onChange:e[2]||(e[2]=a=>t.handleCategoryChange(t.localFilters.category)),class:"filter-select"},[(c(!0),d(H,null,J(t.categoryOptions,a=>(c(),d("option",{key:a.value,value:a.value},g(a.label),9,us))),128))],544),[[Be,t.localFilters.category]])]),s("div",gs,[e[17]||(e[17]=s("label",{for:"event-filter"},"–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:",-1)),ee(s("select",{id:"event-filter","onUpdate:modelValue":e[3]||(e[3]=a=>t.localFilters.event=a),onChange:e[4]||(e[4]=a=>t.handleEventChange(t.localFilters.event)),class:"filter-select"},[(c(!0),d(H,null,J(t.eventOptions,a=>(c(),d("option",{key:a.value,value:a.value},g(a.label),9,ms))),128))],544),[[Be,t.localFilters.event]])]),s("div",fs,[e[18]||(e[18]=s("label",{for:"date-from-filter"},"–î–∞—Ç–∞ –æ—Ç:",-1)),ee(s("input",{id:"date-from-filter","onUpdate:modelValue":e[5]||(e[5]=a=>t.localFilters.dateFrom=a),type:"date",onChange:e[6]||(e[6]=a=>t.handleDateChange(t.localFilters.dateFrom,"dateFrom")),class:"filter-input"},null,544),[[Ie,t.localFilters.dateFrom]])]),s("div",hs,[e[19]||(e[19]=s("label",{for:"date-to-filter"},"–î–∞—Ç–∞ –¥–æ:",-1)),ee(s("input",{id:"date-to-filter","onUpdate:modelValue":e[7]||(e[7]=a=>t.localFilters.dateTo=a),type:"date",onChange:e[8]||(e[8]=a=>t.handleDateChange(t.localFilters.dateTo,"dateTo")),class:"filter-input"},null,544),[[Ie,t.localFilters.dateTo]])]),s("div",vs,[e[20]||(e[20]=s("label",{for:"ip-filter"},"IP –∞–¥—Ä–µ—Å:",-1)),ee(s("input",{id:"ip-filter","onUpdate:modelValue":e[9]||(e[9]=a=>t.localFilters.ip=a),type:"text",placeholder:"192.168.1.1",onInput:e[10]||(e[10]=(...a)=>t.handleFilterChange&&t.handleFilterChange(...a)),class:"filter-input"},null,544),[[Ie,t.localFilters.ip]])]),s("div",ps,[e[22]||(e[22]=s("label",{for:"status-filter"},"–°—Ç–∞—Ç—É—Å:",-1)),ee(s("select",{id:"status-filter","onUpdate:modelValue":e[11]||(e[11]=a=>t.localFilters.status=a),onChange:e[12]||(e[12]=(...a)=>t.handleFilterChange&&t.handleFilterChange(...a)),class:"filter-select"},[...e[21]||(e[21]=[s("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),s("option",{value:"success"},"–£—Å–ø–µ—à–Ω–æ",-1),s("option",{value:"error"},"–û—à–∏–±–∫–∞",-1),s("option",{value:"warning"},"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",-1)])],544),[[Be,t.localFilters.status]])]),s("div",ys,[s("button",{onClick:e[13]||(e[13]=(...a)=>t.handleReset&&t.handleReset(...a)),class:"btn-reset"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])])}const bs=$(os,[["render",_s],["__scopeId","data-v-2a150a46"]]),ws={name:"WebhookLogList",props:{logs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null},pagination:{type:Object,default:null},selectedLogs:{type:Array,default:()=>[]}},emits:["select-log","page-change","update:selectedLogs"],setup(n,{emit:e}){const o=b(()=>!n.logs||!Array.isArray(n.logs)?(console.warn("[WebhookLogList] Invalid logs prop:",n.logs),[]):n.logs.map(y=>Me(y)).filter(y=>he(y)?!0:(console.warn("[WebhookLogList] Invalid log entry:",y),!1))),t=w("timestamp"),r=w("desc"),i=y=>{t.value===y?r.value=r.value==="asc"?"desc":"asc":(t.value=y,r.value="desc")},a=b(()=>!o.value||o.value.length===0?[]:[...o.value].sort((I,T)=>{let P,O;switch(t.value){case"timestamp":P=new Date(I.timestamp||0).getTime(),O=new Date(T.timestamp||0).getTime();break;case"event":P=(I.event||"").toLowerCase(),O=(T.event||"").toLowerCase();break;case"category":P=(I.category||"").toLowerCase(),O=(T.category||"").toLowerCase();break;case"ip":P=(I.ip||"").toLowerCase(),O=(T.ip||"").toLowerCase();break;default:return 0}return P<O?r.value==="asc"?-1:1:P>O?r.value==="asc"?1:-1:0})),l=y=>t.value!==y?"‚ÜïÔ∏è":r.value==="asc"?"‚Üë":"‚Üì",m=y=>y.category==="errors"?"status-error":"status-success",f=y=>y.category==="errors"?"‚ùå":"‚úÖ",C=y=>y.category==="errors"?"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏":"–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ",p=y=>`${y.timestamp}_${y.event}_${y.ip||"unknown"}`,L=y=>y?at(y,"short"):"‚Äî",E=y=>y?Te(y):"‚Äî",x=y=>y?_e(y):"‚Äî",A=y=>!y||typeof y!="object"?"‚Äî":rt(y),S=y=>`category-${y}`,u=y=>y?.startsWith("ONTASK")?"event-task":y?.startsWith("ONCRMDYNAMIC")?"event-smart-process":"event-other",M=y=>{e("select-log",y)},R=y=>{y>=1&&y<=n.pagination.pages&&e("page-change",y)},z=y=>n.selectedLogs.some(I=>p(I)===p(y)),F=(y,I)=>{I.stopPropagation();const T=[...n.selectedLogs],P=p(y),O=T.findIndex(X=>p(X)===P);I.target.checked?O===-1&&T.push(y):O!==-1&&T.splice(O,1),e("update:selectedLogs",T)},D=y=>{y.target.checked?e("update:selectedLogs",[...n.logs]):e("update:selectedLogs",[])},v=b(()=>o.value.length>0&&o.value.every(y=>z(y)));return fe(()=>n.logs,y=>{if(y&&Array.isArray(y)){const I=y.filter(T=>!he(T)).length;I>0&&console.warn(`[WebhookLogList] Received ${I} invalid log entries out of ${y.length}`)}},{immediate:!0}),{validatedLogs:o,sortBy:t,sortOrder:r,sortedLogs:a,handleSort:i,getSortIcon:l,getStatusClass:m,getStatusIcon:f,getStatusTitle:C,getLogId:p,formatTimestamp:L,formatEvent:E,formatCategoryLabel:x,formatDetailsPreview:A,getCategoryClass:S,getEventClass:u,handleLogClick:M,handlePageChange:R,isSelected:z,handleSelectLog:F,handleSelectAll:D,allSelected:v}}},Cs={class:"webhook-log-list"},Ss={key:0,class:"logs-table-container"},ks={class:"logs-table"},xs={class:"checkbox-header"},Es=["checked"],Ms={class:"sort-icon"},Ts={class:"sort-icon"},As={class:"sort-icon"},Ls={class:"sort-icon"},Ds=["onClick"],Is=["checked","onChange"],Ps=["title"],Ns={class:"details-preview"},Rs=["onClick"],Os={key:0,class:"pagination"},Us=["disabled"],Fs={class:"pagination-info"},Bs=["disabled"];function zs(n,e,o,t,r,i){return c(),d("div",Cs,[o.logs.length>0?(c(),d("div",Ss,[s("table",ks,[s("thead",null,[s("tr",null,[s("th",xs,[s("input",{type:"checkbox",checked:t.allSelected,onChange:e[0]||(e[0]=(...a)=>t.handleSelectAll&&t.handleSelectAll(...a)),onClick:e[1]||(e[1]=ce(()=>{},["stop"])),class:"checkbox-input",title:"–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"},null,40,Es)]),s("th",{onClick:e[2]||(e[2]=a=>t.handleSort("timestamp")),class:B(["sortable",{"sort-asc":t.sortBy==="timestamp"&&t.sortOrder==="asc","sort-desc":t.sortBy==="timestamp"&&t.sortOrder==="desc"}])},[e[9]||(e[9]=Y(" –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è ",-1)),s("span",Ms,g(t.getSortIcon("timestamp")),1)],2),s("th",{onClick:e[3]||(e[3]=a=>t.handleSort("event")),class:B(["sortable",{"sort-asc":t.sortBy==="event"&&t.sortOrder==="asc","sort-desc":t.sortBy==="event"&&t.sortOrder==="desc"}])},[e[10]||(e[10]=Y(" –¢–∏–ø —Å–æ–±—ã—Ç–∏—è ",-1)),s("span",Ts,g(t.getSortIcon("event")),1)],2),s("th",{onClick:e[4]||(e[4]=a=>t.handleSort("category")),class:B(["sortable",{"sort-asc":t.sortBy==="category"&&t.sortOrder==="asc","sort-desc":t.sortBy==="category"&&t.sortOrder==="desc"}])},[e[11]||(e[11]=Y(" –ö–∞—Ç–µ–≥–æ—Ä–∏—è ",-1)),s("span",As,g(t.getSortIcon("category")),1)],2),s("th",{onClick:e[5]||(e[5]=a=>t.handleSort("ip")),class:B(["sortable",{"sort-asc":t.sortBy==="ip"&&t.sortOrder==="asc","sort-desc":t.sortBy==="ip"&&t.sortOrder==="desc"}])},[e[12]||(e[12]=Y(" IP ",-1)),s("span",Ls,g(t.getSortIcon("ip")),1)],2),e[13]||(e[13]=s("th",null,"–î–µ—Ç–∞–ª–∏",-1)),e[14]||(e[14]=s("th",null,"–î–µ–π—Å—Ç–≤–∏—è",-1))])]),s("tbody",null,[(c(!0),d(H,null,J(t.sortedLogs,a=>(c(),d("tr",{key:t.getLogId(a),onClick:l=>t.handleLogClick(a),class:B(["log-row",{"row-selected":t.isSelected(a)}])},[s("td",{onClick:e[6]||(e[6]=ce(()=>{},["stop"]))},[s("input",{type:"checkbox",checked:t.isSelected(a),onChange:l=>t.handleSelectLog(a,l),class:"checkbox-input"},null,40,Is)]),s("td",null,g(t.formatTimestamp(a.timestamp)),1),s("td",null,[s("span",{class:B(["status-indicator",t.getStatusClass(a)]),title:t.getStatusTitle(a)},g(t.getStatusIcon(a)),11,Ps),s("span",{class:B(["event-badge",t.getEventClass(a.event)])},g(t.formatEvent(a.event)),3)]),s("td",null,[s("span",{class:B(["category-badge",t.getCategoryClass(a.category)])},g(t.formatCategoryLabel(a.category)),3)]),s("td",null,g(a.ip||"N/A"),1),s("td",null,[s("div",Ns,g(t.formatDetailsPreview(a.details)),1)]),s("td",null,[s("button",{onClick:ce(l=>t.handleLogClick(a),["stop"]),class:"btn-view"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,Rs)])],10,Ds))),128))])]),o.pagination&&o.pagination.pages>1?(c(),d("div",Os,[s("button",{onClick:e[7]||(e[7]=a=>t.handlePageChange(o.pagination.page-1)),disabled:o.pagination.page<=1,class:"btn-pagination"}," –ù–∞–∑–∞–¥ ",8,Us),s("span",Fs," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+g(o.pagination.page)+" –∏–∑ "+g(o.pagination.pages)+" (–≤—Å–µ–≥–æ: "+g(o.pagination.total)+") ",1),s("button",{onClick:e[8]||(e[8]=a=>t.handlePageChange(o.pagination.page+1)),disabled:o.pagination.page>=o.pagination.pages,class:"btn-pagination"}," –í–ø–µ—Ä—ë–¥ ",8,Bs)])):k("",!0)])):k("",!0)])}const js=$(ws,[["render",zs],["__scopeId","data-v-fddd3018"]]),Ws={name:"LoadingSkeleton",props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"20px"},variant:{type:String,default:"rect",validator:n=>["rect","circle","text","table-row"].includes(n)},animated:{type:Boolean,default:!0},borderRadius:{type:String,default:null}},setup(n){return{skeletonStyle:b(()=>{const o={width:typeof n.width=="number"?`${n.width}px`:n.width,height:typeof n.height=="number"?`${n.height}px`:n.height};return n.borderRadius&&(o.borderRadius=n.borderRadius),o})}}},$s={key:0,class:"skeleton-shimmer"};function Vs(n,e,o,t,r,i){return c(),d("div",{class:B(["skeleton",[`skeleton-${o.variant}`,{"skeleton-animated":o.animated}]]),style:Pe(t.skeletonStyle)},[o.animated?(c(),d("div",$s)):k("",!0)],6)}const Xs=$(Ws,[["render",Vs],["__scopeId","data-v-014f86e6"]]),qs={name:"SkeletonLogList",components:{LoadingSkeleton:Xs},props:{rows:{type:Number,default:5}},setup(){return{getColumnWidth:e=>["40px","15%","20%","15%","15%","20%","15%"][e-1]||"100%"}}},Hs={class:"skeleton-log-list"},Js={class:"skeleton-table-header"};function Ks(n,e,o,t,r,i){const a=V("LoadingSkeleton");return c(),d("div",Hs,[s("div",Js,[(c(),d(H,null,J(7,l=>q(a,{key:l,width:"120px",height:"16px",variant:"text"})),64))]),(c(!0),d(H,null,J(o.rows,l=>(c(),d("div",{key:l,class:"skeleton-table-row"},[(c(),d(H,null,J(7,m=>q(a,{key:m,width:"100%",height:"20px",variant:"text",style:Pe({width:t.getColumnWidth(m)})},null,8,["style"])),64))]))),128))])}const Ys=$(qs,[["render",Ks],["__scopeId","data-v-475c4e73"]]),Gs={name:"EmptyState",props:{icon:{type:String,default:"üì≠"},title:{type:String,required:!0},description:{type:String,required:!0},actionLabel:{type:String,default:null},actions:{type:Array,default:null},hints:{type:Array,default:()=>[]},variant:{type:String,default:"default",validator:n=>["default","error","warning","info"].includes(n)}},emits:["action","action-click"]},Qs={class:"empty-icon"},Zs={class:"empty-title"},ea={class:"empty-description"},ta={key:0,class:"empty-hints"},oa={key:1,class:"empty-actions"},na=["onClick"];function sa(n,e,o,t,r,i){return c(),d("div",{class:B(["empty-state",`empty-state-${o.variant}`])},[s("div",Qs,g(o.icon),1),s("h3",Zs,g(o.title),1),s("p",ea,g(o.description),1),o.hints&&o.hints.length>0?(c(),d("div",ta,[(c(!0),d(H,null,J(o.hints,(a,l)=>(c(),d("div",{key:l,class:"hint-item"}," üí° "+g(a),1))),128))])):k("",!0),o.actionLabel||o.actions?(c(),d("div",oa,[o.actionLabel?(c(),d("button",{key:0,onClick:e[0]||(e[0]=a=>n.$emit("action")),class:"btn-primary"},g(o.actionLabel),1)):k("",!0),(c(!0),d(H,null,J(o.actions,(a,l)=>(c(),d("button",{key:l,onClick:m=>n.$emit("action-click",a.id),class:B(["btn",`btn-${a.variant||"secondary"}`])},g(a.label),11,na))),128))])):k("",!0)],2)}const aa=$(Gs,[["render",sa],["__scopeId","data-v-081c13b9"]]),ra={name:"ErrorDisplay",props:{title:{type:String,default:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"},message:{type:String,required:!0},details:{type:String,default:null},severity:{type:String,default:"error",validator:n=>["error","warning","critical"].includes(n)},retryable:{type:Boolean,default:!1}},emits:["retry"],setup(){return{showDetails:w(!1)}}},ia={class:"error-icon"},la={class:"error-content"},ca={class:"error-title"},da={class:"error-message"},ua={key:0,class:"error-details"},ga={class:"error-actions"};function ma(n,e,o,t,r,i){return c(),d("div",{class:B(["error-display",`error-${o.severity}`])},[s("div",ia,g(o.severity==="critical"?"üö®":"‚ö†Ô∏è"),1),s("div",la,[s("h4",ca,g(o.title),1),s("p",da,g(o.message),1),o.details&&t.showDetails?(c(),d("div",ua,[s("pre",null,g(o.details),1)])):k("",!0),s("div",ga,[o.retryable?(c(),d("button",{key:0,onClick:e[0]||(e[0]=a=>n.$emit("retry")),class:"btn-retry"}," üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")):k("",!0),o.details?(c(),d("button",{key:1,onClick:e[1]||(e[1]=a=>t.showDetails=!t.showDetails),class:"btn-details"},g(t.showDetails?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å")+" –¥–µ—Ç–∞–ª–∏ ",1)):k("",!0)])])],2)}const fa=$(ra,[["render",ma],["__scopeId","data-v-3f2f4c14"]]),De=w([]);let ha=0;function kt(){const n=(l,m="info",f=3e3)=>{const C=++ha,p={id:C,message:l,type:m,duration:f,timestamp:Date.now()};return De.value.push(p),f>0&&setTimeout(()=>{e(C)},f),C},e=l=>{const m=De.value.findIndex(f=>f.id===l);m>-1&&De.value.splice(m,1)};return{notifications:De,showNotification:n,removeNotification:e,clearNotifications:()=>{De.value=[]},success:(l,m=3e3)=>n(l,"success",m),error:(l,m=5e3)=>n(l,"error",m),warning:(l,m=4e3)=>n(l,"warning",m),info:(l,m=3e3)=>n(l,"info",m)}}const va={name:"Notification",props:{notification:{type:Object,required:!0}},emits:["close"],setup(n,{emit:e}){const o=w(100),t=b(()=>n.notification.duration>0);let r=null;const i={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},a=b(()=>i[n.notification.type]||"‚ÑπÔ∏è"),l=()=>{e("close")},m=()=>{n.notification.onClick&&n.notification.onClick()};return ne(()=>{if(t.value&&n.notification.duration>0){const f=Date.now(),C=n.notification.duration;r=setInterval(()=>{const p=Date.now()-f;o.value=Math.max(0,100-p/C*100),o.value<=0&&(clearInterval(r),l())},50)}}),ot(()=>{r&&clearInterval(r)}),{icon:a,progress:o,showProgress:t,close:l,handleClick:m}}},pa={class:"notification-content"},ya={class:"notification-icon"},_a={class:"notification-message"},ba={key:0,class:"notification-progress"};function wa(n,e,o,t,r,i){return c(),d("div",{class:B(["notification",`notification-${o.notification.type}`]),onClick:e[1]||(e[1]=(...a)=>t.handleClick&&t.handleClick(...a))},[s("div",pa,[s("span",ya,g(t.icon),1),s("span",_a,g(o.notification.message),1)]),s("button",{onClick:e[0]||(e[0]=ce((...a)=>t.close&&t.close(...a),["stop"])),class:"notification-close"},"‚úï"),t.showProgress?(c(),d("div",ba,[s("div",{class:"progress-bar",style:Pe({width:`${t.progress}%`})},null,4)])):k("",!0)],2)}const Ca=$(va,[["render",wa],["__scopeId","data-v-1b602bdf"]]),Sa={name:"NotificationContainer",components:{Notification:Ca},setup(){const{notifications:n,removeNotification:e}=kt();return{notifications:n,removeNotification:e}}},ka={class:"notification-container"};function xa(n,e,o,t,r,i){const a=V("Notification");return c(),K(nt,{to:"body"},[s("div",ka,[q(Dt,{name:"notification",tag:"div"},{default:ae(()=>[(c(!0),d(H,null,J(t.notifications,l=>(c(),K(a,{key:l.id,notification:l,onClose:m=>t.removeNotification(l.id)},null,8,["notification","onClose"]))),128))]),_:1})])])}const Ea=$(Sa,[["render",xa],["__scopeId","data-v-dd8772c8"]]),Ma={name:"RealtimeControls",props:{enabled:{type:Boolean,default:!1},connectionState:{type:String,default:"disconnected"},error:{type:String,default:null}},emits:["toggle"],setup(n,{emit:e}){const o=w(n.enabled);fe(()=>n.enabled,p=>{o.value=p});const t=b(()=>n.connectionState==="connecting"),r=b(()=>!!n.error),i=b(()=>({"status-connected":n.connectionState==="connected","status-connecting":n.connectionState==="connecting","status-disconnected":n.connectionState==="disconnected","status-error":n.connectionState==="error"})),a=b(()=>{switch(n.connectionState){case"connected":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";case"connecting":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...";case"disconnected":return"–û—Ç–∫–ª—é—á–µ–Ω–æ";case"error":return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}}),l=b(()=>a.value),m=b(()=>({"status-connected":n.connectionState==="connected","status-connecting":n.connectionState==="connecting","status-disconnected":n.connectionState==="disconnected","status-error":n.connectionState==="error"})),f=b(()=>n.error?typeof n.error=="string"?n.error:n.error.message?n.error.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞":null);return{localEnabled:o,isConnecting:t,hasError:r,statusClass:i,statusText:a,connectionStatusText:l,connectionStatusClass:m,displayError:f,handleToggle:()=>{e("toggle",o.value)}}}},Ta={class:"realtime-controls"},Aa={class:"control-toggle"},La=["disabled"],Da={class:"status-text"},Ia={key:0,class:"error-message"};function Pa(n,e,o,t,r,i){return c(),d("div",Ta,[s("label",Aa,[ee(s("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=a=>t.localEnabled=a),onChange:e[1]||(e[1]=(...a)=>t.handleToggle&&t.handleToggle(...a)),disabled:t.isConnecting},null,40,La),[[vt,t.localEnabled]]),e[2]||(e[2]=s("span",{class:"toggle-label"},"–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",-1))]),s("div",{class:B(["status-indicator",t.statusClass])},[e[3]||(e[3]=s("span",{class:"status-dot"},null,-1)),s("span",Da,g(t.statusText),1)],2),t.hasError&&t.displayError?(c(),d("div",Ia," ‚ö†Ô∏è "+g(t.displayError),1)):k("",!0)])}const Na=$(Ma,[["render",Pa],["__scopeId","data-v-af36f073"]]),Ra={name:"NewLogsIndicator",props:{count:{type:Number,default:0},newLogs:{type:Array,default:()=>[]}},emits:["apply","dismiss"],setup(n,{emit:e}){const o=(a,l,m,f)=>{const C=a%10,p=a%100;return p>=11&&p<=19?f:C===1?l:C>=2&&C<=4?m:f},t=b(()=>!n.newLogs||!Array.isArray(n.newLogs)||n.newLogs.length===0?[]:n.newLogs.map(l=>Me(l)).filter(l=>he(l)).slice(0,5).map(l=>({...l,formatted:{event:Te(l.event),category:_e(l.category)}})));return{pluralize:o,newLogsPreview:t,handleApply:()=>{if(!n.newLogs||n.newLogs.length===0)return;const a=n.newLogs.map(l=>Me(l)).filter(l=>he(l));if(a.length===0){console.warn("[NewLogsIndicator] No valid logs to apply");return}e("apply",a)},handleDismiss:()=>{e("dismiss")}}}},Oa={key:0,class:"new-logs-indicator"},Ua={class:"indicator-content"},Fa={class:"indicator-text"},Ba={class:"indicator-actions"};function za(n,e,o,t,r,i){return c(),K(pe,{name:"slide-down"},{default:ae(()=>[o.count>0?(c(),d("div",Oa,[s("div",Ua,[e[2]||(e[2]=s("span",{class:"indicator-icon"},"üîî",-1)),s("span",Fa,g(o.count)+" "+g(t.pluralize(o.count,"–Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π")),1),s("div",Ba,[s("button",{onClick:e[0]||(e[0]=(...a)=>t.handleApply&&t.handleApply(...a)),class:"btn-apply"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å "),s("button",{onClick:e[1]||(e[1]=(...a)=>t.handleDismiss&&t.handleDismiss(...a)),class:"btn-dismiss"}," ‚úï ")])])])):k("",!0)]),_:1})}const ja=$(Ra,[["render",za],["__scopeId","data-v-19791dbc"]]);class Wa{constructor(e,o={}){this.url=e,this.options={reconnectInterval:3e3,maxReconnectAttempts:10,reconnectDelay:1e3,lastTimestamp:null,...o},this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.reconnectTimer=null,this.isManualDisconnect=!1,this.connectionState="disconnected"}updateOptions(e){this.options={...this.options,...e}}connect(){if(this.connectionState==="connected"||this.connectionState==="connecting"){console.warn("[RealtimeService] Already connected or connecting");return}this.isManualDisconnect=!1,this.connectionState="connecting",this.notifyListeners("state-change",{state:this.connectionState});try{let e=this.url;if(!e.startsWith("http://")&&!e.startsWith("https://")){const o=new URL(e,window.location.origin);this.options.lastTimestamp&&o.searchParams.set("last_timestamp",this.options.lastTimestamp),e=o.toString()}else{const o=new URL(e);this.options.lastTimestamp&&o.searchParams.set("last_timestamp",this.options.lastTimestamp),e=o.toString()}console.log("[RealtimeService] Connecting to:",e),this.eventSource=new EventSource(e),this.eventSource.onopen=()=>{console.log("[RealtimeService] EventSource opened"),this.notifyListeners("open",{timestamp:new Date().toISOString()})},this.eventSource.onmessage=o=>{try{const t=JSON.parse(o.data);this.notifyListeners("message",t)}catch(t){console.error("[RealtimeService] Error parsing message:",t)}},this.eventSource.addEventListener("connected",o=>{try{const t=JSON.parse(o.data);console.log("[RealtimeService] Connected event received:",t),this.connectionState="connected",this.reconnectAttempts=0,this.notifyListeners("connected",t),this.notifyListeners("state-change",{state:this.connectionState})}catch(t){console.error("[RealtimeService] Error parsing connected event:",t)}}),this.eventSource.addEventListener("new_logs",o=>{const t=JSON.parse(o.data);if(t.logs&&t.logs.length>0){const r=t.logs[t.logs.length-1];r.timestamp&&(this.options.lastTimestamp=r.timestamp)}this.notifyListeners("new_logs",t)}),this.eventSource.addEventListener("error",o=>{try{const t=JSON.parse(o.data);this.notifyListeners("error",t)}catch{this.notifyListeners("error",{message:"Server error"})}}),this.eventSource.addEventListener("timeout",o=>{try{const t=JSON.parse(o.data);this.notifyListeners("timeout",t)}catch{this.notifyListeners("timeout",{message:"Connection timeout"})}this.reconnect()}),this.eventSource.addEventListener("closed",o=>{try{const t=JSON.parse(o.data);this.notifyListeners("closed",t)}catch{this.notifyListeners("closed",{message:"Connection closed"})}this.isManualDisconnect||this.reconnect()}),this.eventSource.onerror=o=>{console.error("[RealtimeService] Connection error:",o),console.error("[RealtimeService] EventSource readyState:",this.eventSource?.readyState),this.eventSource?.readyState===EventSource.CLOSED?(console.log("[RealtimeService] EventSource closed by server"),this.connectionState="disconnected",this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()):this.eventSource?.readyState===EventSource.CONNECTING?console.log("[RealtimeService] Still connecting..."):(this.connectionState="error",this.notifyListeners("error",{error:o,type:"connection",message:"Failed to connect to realtime stream",readyState:this.eventSource?.readyState}),this.notifyListeners("state-change",{state:this.connectionState}),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isManualDisconnect||this.reconnect())}}catch(e){console.error("[RealtimeService] Error creating EventSource:",e),this.connectionState="error",this.notifyListeners("error",{error:e,type:"initialization"}),this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()}}reconnect(){if(this.isManualDisconnect)return;if(this.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("[RealtimeService] Max reconnect attempts reached"),this.notifyListeners("max-reconnect-attempts",{attempts:this.reconnectAttempts});return}this.reconnectAttempts++;const e=Math.min(this.options.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.options.reconnectInterval);console.log(`[RealtimeService] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},e)}disconnect(){this.isManualDisconnect=!0,this.connectionState="disconnected",this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.notifyListeners("disconnected",{timestamp:new Date().toISOString()}),this.notifyListeners("state-change",{state:this.connectionState})}on(e,o){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(o)}off(e,o){if(this.listeners.has(e)){const t=this.listeners.get(e),r=t.indexOf(o);r>-1&&t.splice(r,1)}}notifyListeners(e,o){this.listeners.has(e)&&this.listeners.get(e).forEach(t=>{try{t(o)}catch(r){console.error(`[RealtimeService] Error in listener for ${e}:`,r)}})}getState(){return this.connectionState}isConnected(){return this.connectionState==="connected"}}function $a(n,e={}){const{autoConnect:o=!1,enableSound:t=!1,onNewLogs:r=null,validateLogs:i=!0}=e,a=new Wa(n,e),l=w("disconnected"),m=w([]),f=w(0),C=w(null),p=w(null),L=w(0),E=b(()=>l.value==="connected"),x=b(()=>l.value==="connecting"),A=b(()=>l.value==="error"),S=b(()=>f.value>0),u=P=>{l.value=P.state,P.state==="connected"&&(L.value=0,p.value=null)},M=P=>{let O=P.logs||[];if(i){O=st(O);const X=O.filter(be=>he(be));X.length!==O.length&&console.warn("[useRealtime] Filtered out invalid logs:",O.length-X.length),O=X}O.length!==0&&(m.value.push(...O),f.value+=O.length,C.value=new Date().toISOString(),t&&O.length>0&&T(),r&&r(O))},R=P=>{const O=P.message||P.error?.message||"Connection error";p.value=O,l.value="error",console.error("[useRealtime] Error:",P)},z=P=>{console.warn("[useRealtime] Connection timeout:",P)},F=P=>{p.value=`Max reconnect attempts reached (${P.attempts})`,console.error("[useRealtime] Max reconnect attempts:",P)},D=(P={})=>{p.value=null,P.lastTimestamp!==void 0&&a.updateOptions({lastTimestamp:P.lastTimestamp}),a.on("state-change",u),a.on("new_logs",M),a.on("error",R),a.on("timeout",z),a.on("max-reconnect-attempts",F),a.connect()},v=()=>{a.off("state-change",u),a.off("new_logs",M),a.off("error",R),a.off("timeout",z),a.off("max-reconnect-attempts",F),a.disconnect()},y=()=>{m.value=[],f.value=0},I=P=>{P&&Array.isArray(P)&&(P.unshift(...m.value),y())},T=()=>{try{const P=new Audio("/sounds/notification.mp3");P.volume=.3,P.play().catch(O=>{console.warn("[useRealtime] Failed to play sound:",O)})}catch(P){console.warn("[useRealtime] Sound not available:",P)}};return o&&ne(()=>{D()}),ot(()=>{v()}),{connectionState:l,isConnected:E,isConnecting:x,hasError:A,newLogs:m,newLogsCount:f,hasNewLogs:S,lastUpdateTime:C,error:p,reconnectAttempts:L,connect:D,disconnect:v,clearNewLogs:y,applyNewLogs:I}}const Va=pt(()=>te(()=>import("./WebhookLogsDashboard.vue-B8qTMgTE.js"),__vite__mapDeps([6,4,1,5,2]),import.meta.url)),Xa=pt(()=>te(()=>import("./WebhookLogDetails.vue-BPwqeHRz.js"),__vite__mapDeps([7,4,1,5,2]),import.meta.url)),qa={name:"WebhookLogsPage",components:{WebhookLogsDashboard:Va,WebhookLogsExport:qn,WebhookLogSearch:es,WebhookLogFilters:bs,WebhookLogList:js,WebhookLogDetails:Xa,SkeletonLogList:Ys,EmptyState:aa,ErrorDisplay:fa,NotificationContainer:Ea,RealtimeControls:Na,NewLogsIndicator:ja},setup(){const n=Ae(),{success:e,error:o}=kt(),t=w(!1),r=w(!1),i=w(null),a=w(null),l=w([]),m=(_,h=2)=>{if(_==null)return String(_);if(typeof _=="string")return _;const U=(N,j=0)=>{if(j>10)return"[Max Depth]";if(N==null||typeof N!="object")return N;if(Array.isArray(N))return N.map(Q=>U(Q,j+1));const G={};try{for(const Q in N)if(Object.prototype.hasOwnProperty.call(N,Q))try{const Ue=N[Q];if(typeof Ue=="function"||Ue===void 0)continue;G[Q]=U(Ue,j+1)}catch{G[Q]="[Error reading property]"}}catch{return"[Error reading object]"}return G};try{const N=U(_),j=new WeakSet;return JSON.stringify(N,(G,Q)=>{if(typeof Q=="object"&&Q!==null){if(j.has(Q))return"[Circular]";j.add(Q)}return Q},h)}catch(N){return console.error("[WebhookLogsPage] Error in safeStringify:",N),`[Error: ${N.message}]`}},f=w(null),C=w([]),p=w(""),L=w(null),E=w(null),x=w(!1),{connectionState:A,newLogsCount:S,error:u,connect:M,disconnect:R,applyNewLogs:z,clearNewLogs:F}=$a(me("/api/webhook-realtime.php"),{autoConnect:!1,enableSound:!0,validateLogs:!0,onNewLogs:_=>{console.log("[WebhookLogsPage] New logs received:",_.length),_.length>0&&(l.value.unshift(..._),I.value.total+=_.length,e(`–ü–æ–ª—É—á–µ–Ω–æ ${_.length} –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π`))}}),{filters:D,updateFilters:v,clearFilters:y}=nn(),I=w({page:1,limit:50,total:0,pages:0}),T=b(()=>{let _=[...l.value];return p.value&&p.value.trim()&&(_=sn(_,p.value,{caseSensitive:!1,searchInEvent:!0,searchInPayload:!0,searchInDetails:!0,searchInIp:!0})),D.value.category&&(_=_.filter(h=>h.category===D.value.category)),D.value.event&&(_=_.filter(h=>h.event===D.value.event)),D.value.ip&&(_=_.filter(h=>h.ip&&h.ip.includes(D.value.ip))),D.value.status&&(_=_.filter(h=>D.value.status==="error"?h.category==="errors":D.value.status==="success"?h.category!=="errors":!0)),D.value.dateFrom&&(_=_.filter(h=>h.timestamp?new Date(h.timestamp).toISOString().split("T")[0]>=D.value.dateFrom:!1)),D.value.dateTo&&(_=_.filter(h=>h.timestamp?new Date(h.timestamp).toISOString().split("T")[0]<=D.value.dateTo:!1)),D.value.hour!==null&&(_=_.filter(h=>h.timestamp?new Date(h.timestamp).getHours()===D.value.hour:!1)),_});fe(T,_=>{L.value&&p.value&&L.value.setResultsCount(_.length)});const P=async()=>{try{await ye.init();const _=await ye.getCurrentUser();if(console.log("[WebhookLogsPage] User data:",_),!_||!_.ID){console.warn("[WebhookLogsPage] User not determined"),a.value=m({error:"User not determined",userId:_?.ID||null,userName:_?`${_.NAME||""} ${_.LAST_NAME||""}`.trim():null}),t.value=!1;return}const h=_?.UF_DEPARTMENT||[];if(console.log("[WebhookLogsPage] User departments:",h),console.log("[WebhookLogsPage] Allowed departments:",ke.allowedDepartmentIds),h.length>0){const U=h.some(N=>wt(N));console.log("[WebhookLogsPage] Has access:",U),t.value=U,U||(a.value=m({userId:_.ID,userName:`${_.NAME||""} ${_.LAST_NAME||""}`.trim(),userDepartments:h,allowedDepartments:ke.allowedDepartmentIds,message:"User departments do not match allowed departments"}))}else console.warn("[WebhookLogsPage] User has no departments"),a.value=m({userId:_.ID,userName:`${_.NAME||""} ${_.LAST_NAME||""}`.trim(),userDepartments:[],allowedDepartments:ke.allowedDepartmentIds,message:"User has no departments assigned"}),t.value=!1}catch(_){console.error("[WebhookLogsPage] Error checking access:",_),a.value=m({error:_.message,stack:_.stack}),t.value=!1}},O=b(()=>ke.allowedDepartmentIds.join(", ")),X=async(_=!1)=>{if(t.value&&!(de&&!_)){de=!0,r.value=!0,i.value=null;try{const h=new Date().toISOString().split("T")[0],U={category:D.value.category||null,event:D.value.event||null,date:D.value.dateFrom||h,hour:D.value.hour!==null&&D.value.hour!==void 0?D.value.hour:null,ip:D.value.ip||null,status:D.value.status||null,dateFrom:D.value.dateFrom||h,dateTo:D.value.dateTo||null};if(!tt(U))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");console.log("[WebhookLogsPage] Loading logs with filters:",U);const N=await ft.getLogs(U,I.value.page,I.value.limit,_);if(console.log("[WebhookLogsPage] API result:",N),console.log("[WebhookLogsPage] Logs count:",N?.logs?.length||0),console.log("[WebhookLogsPage] Pagination:",N?.pagination),!N.success)throw new Error(N.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤");an(N.pagination)?I.value=N.pagination:(console.warn("[WebhookLogsPage] Invalid pagination format, using defaults"),I.value={page:I.value.page,limit:I.value.limit,total:N.logs.length,pages:Math.ceil(N.logs.length/I.value.limit)});const j=st(N.logs),G=j.filter(Q=>he(Q));G.length!==j.length&&console.warn("[WebhookLogsPage] Filtered out invalid logs:",j.length-G.length),l.value=G,_&&e("–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")}catch(h){be(h)}finally{r.value=!1,de=!1}}},be=_=>{console.error("[WebhookLogsPage] API Error:",_),_.status===403?(i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",o("–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º –≤–µ–±—Ö—É–∫–æ–≤")):_.status===404?(i.value="–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",o("–õ–æ–≥–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")):_.status>=500?(i.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",o("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")):(i.value=_.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",o(i.value)),_.status>=500&&(l.value=[])},Ve=_=>{p.value=_,v({search:_||null})};let de=!1;const Xe=_=>{if(!tt(_)){o("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");return}const h={category:D.value.category,event:D.value.event,dateFrom:D.value.dateFrom,dateTo:D.value.dateTo,hour:D.value.hour,ip:D.value.ip,status:D.value.status},U={category:_?.category||null,event:_?.event||null,dateFrom:_?.dateFrom||null,dateTo:_?.dateTo||null,hour:_?.hour!==void 0?_.hour:null,ip:_?.ip||null,status:_?.status||null},N=Object.keys(U).some(j=>{const G=h[j],Q=U[j];return G!==Q});if(!(!N&&!de)){if(v(U),I.value.page=1,N)try{ft.invalidateCacheOnFilterChange(h,U)}catch(j){console.error("[WebhookLogsPage] Error invalidating cache:",j)}de||(de=!0,X(!0).finally(()=>{de=!1}))}},we=()=>{y(),p.value="",I.value.page=1,X()},qe=_=>{f.value=_},Re=()=>{f.value=null},He=_=>{I.value.page=_,X()},Oe=()=>{try{n.push("/")}catch(_){console.error("Navigation error:",_),window.location.hash="#/"}},Je=_=>{C.value=_},Ke=_=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—á–∞—Ç:",_)},Ye=_=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω:",_),e(`–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω: ${_.count} –∑–∞–ø–∏—Å–µ–π –≤ —Ñ–∞–π–ª–µ ${_.filename}`)},Ge=_=>{console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:",_),o(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${_.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`)},lt=()=>{p.value="",we()},ct=_=>{if(console.log("[WebhookLogsPage] Toggle auto-update:",_),x.value=_,_){let h=null;if(l.value.length>0){const U=l.value[0];U.timestamp&&(h=U.timestamp,console.log("[WebhookLogsPage] Using lastTimestamp:",h))}M({lastTimestamp:h})}else R()},dt=()=>{z(l.value),e("–ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")},ut=()=>{F()};return ne(async()=>{await P(),t.value&&(D.value.search&&(p.value=D.value.search),await X())}),{hasAccess:t,loading:r,error:i,logs:l,filteredLogs:T,selectedLog:f,selectedLogs:C,filters:D,searchQuery:p,searchComponent:L,pagination:I,previousPeriodStats:E,handleFiltersUpdate:Xe,handleFiltersReset:we,handleSearch:Ve,handleLogSelect:qe,handleLogClose:Re,handlePageChange:He,handleSelectedLogsUpdate:Je,handleExportStart:Ke,handleExportComplete:Ye,handleExportError:Ge,handleClearSearch:lt,autoUpdateEnabled:x,connectionState:A,newLogsCount:S,realtimeError:u,handleToggleAutoUpdate:ct,handleApplyNewLogs:dt,handleDismissNewLogs:ut,allowedDepartmentsText:O,accessDebugInfo:a,goBack:Oe}}},Ha={class:"webhook-logs-page"},Ja={class:"page-header"},Ka={class:"page-header-top"},Ya={key:0,class:"access-denied"},Ga={class:"access-denied-content"},Qa={class:"access-hint"},Za={key:0,class:"access-debug"},er={key:1,class:"page-content"},tr={class:"actions-bar"};function or(n,e,o,t,r,i){const a=V("WebhookLogsDashboard"),l=V("WebhookLogsExport"),m=V("WebhookLogSearch"),f=V("RealtimeControls"),C=V("NewLogsIndicator"),p=V("WebhookLogFilters"),L=V("SkeletonLogList"),E=V("WebhookLogList"),x=V("EmptyState"),A=V("ErrorDisplay"),S=V("WebhookLogDetails"),u=V("NotificationContainer");return c(),d("div",Ha,[s("div",Ja,[s("div",Ka,[s("button",{onClick:e[0]||(e[0]=(...M)=>t.goBack&&t.goBack(...M)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[3]||(e[3]=[s("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),s("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[4]||(e[4]=s("h1",null,"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ Bitrix24",-1))]),t.hasAccess?(c(),d("div",er,[q(a,{logs:t.logs,pagination:t.pagination,"previous-period-stats":t.previousPeriodStats},null,8,["logs","pagination","previous-period-stats"]),s("div",tr,[q(l,{logs:t.filteredLogs,"selected-logs":t.selectedLogs,filters:t.filters,"total-count":t.filteredLogs.length,onExportStart:t.handleExportStart,onExportComplete:t.handleExportComplete,onExportError:t.handleExportError},null,8,["logs","selected-logs","filters","total-count","onExportStart","onExportComplete","onExportError"]),q(m,{modelValue:t.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=M=>t.searchQuery=M),onSearch:t.handleSearch,ref:"searchComponent"},null,8,["modelValue","onSearch"])]),q(f,{enabled:t.autoUpdateEnabled,"connection-state":t.connectionState,error:t.realtimeError,onToggle:t.handleToggleAutoUpdate},null,8,["enabled","connection-state","error","onToggle"]),q(C,{count:t.newLogsCount,onApply:t.handleApplyNewLogs,onDismiss:t.handleDismissNewLogs},null,8,["count","onApply","onDismiss"]),q(p,{filters:t.filters,"onUpdate:filters":t.handleFiltersUpdate,onReset:t.handleFiltersReset},null,8,["filters","onUpdate:filters","onReset"]),q(pe,{name:"fade"},{default:ae(()=>[t.loading&&t.logs.length===0?(c(),K(L,{key:0,rows:5})):k("",!0)]),_:1}),q(pe,{name:"fade"},{default:ae(()=>[!t.loading&&t.filteredLogs.length>0?(c(),K(E,{key:0,logs:t.filteredLogs,loading:!1,error:null,pagination:t.pagination,"selected-logs":t.selectedLogs,onSelectLog:t.handleLogSelect,onPageChange:t.handlePageChange,"onUpdate:selectedLogs":t.handleSelectedLogsUpdate},null,8,["logs","pagination","selected-logs","onSelectLog","onPageChange","onUpdate:selectedLogs"])):k("",!0)]),_:1}),q(pe,{name:"fade"},{default:ae(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length===0?(c(),K(x,{key:0,icon:"üì≠",title:"–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",description:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Bitrix24.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è","–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",onAction:t.handleFiltersReset},null,8,["onAction"])):k("",!0)]),_:1}),q(pe,{name:"fade"},{default:ae(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length>0?(c(),K(x,{key:0,icon:"üîç",title:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",description:"–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã","–û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",onAction:t.handleClearSearch},null,8,["onAction"])):k("",!0)]),_:1}),q(pe,{name:"fade"},{default:ae(()=>[t.error?(c(),K(A,{key:0,title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤",message:t.error,retryable:!0,onRetry:n.loadLogs},null,8,["message","onRetry"])):k("",!0)]),_:1}),t.selectedLog?(c(),d("div",{key:0,class:"modal-overlay",onClick:e[2]||(e[2]=(...M)=>t.handleLogClose&&t.handleLogClose(...M))})):k("",!0),q(pe,{name:"modal"},{default:ae(()=>[t.selectedLog?(c(),K(S,{key:0,log:t.selectedLog,onClose:t.handleLogClose},null,8,["log","onClose"])):k("",!0)]),_:1})])):(c(),d("div",Ya,[s("div",Ga,[e[7]||(e[7]=s("h2",null,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",-1)),e[8]||(e[8]=s("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤.",-1)),s("p",Qa,[e[5]||(e[5]=Y(" –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ –æ—Ç–¥–µ–ª–æ–≤: ",-1)),s("strong",null,g(t.allowedDepartmentsText),1)]),e[9]||(e[9]=s("p",{class:"access-hint"}," –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã. ",-1)),t.accessDebugInfo?(c(),d("details",Za,[e[6]||(e[6]=s("summary",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",-1)),s("pre",null,g(t.accessDebugInfo),1)])):k("",!0)])])),q(u)])}const nr=$(qa,[["render",or],["__scopeId","data-v-628bf174"]]),sr={name:"UsersManagementPage",setup(){const n=Ae(),e=w(!0),o=w(0),t=w(!1),r=w(null),i=async()=>{o.value++,console.log(`[UsersManagementPage] Retry attempt ${o.value}`);try{const{default:l}=await te(async()=>{const{default:m}=await import("./UnifiedUserManagement.vue-JAZJlF9w.js");return{default:m}},__vite__mapDeps([8,4,1,5,2]),import.meta.url);e.value=!1,r.value=null,console.log("[UsersManagementPage] UnifiedUserManagement imported successfully")}catch(l){console.error("[UsersManagementPage] Failed to import UnifiedUserManagement:",l),r.value=l,e.value=!0}},a=()=>{t.value=!t.value};return ne(async()=>{try{if(!(await Ce.checkAccess()).allowed){n.push("/");return}if(!await Ce.getCurrentUser()){n.push("/");return}console.log("[UsersManagementPage] Access granted - attempting to load unified interface"),await i()}catch(l){console.error("[UsersManagementPage] Access check failed:",l),n.push("/")}}),{showFallback:e,loadAttempts:o,showErrorDetailsFlag:t,lastError:r,retryLoad:i,showErrorDetails:a}}},ar={class:"users-management-page"},rr={key:0,class:"fallback-interface"},ir={class:"fallback-content"},lr={class:"status-card"},cr={class:"debug-info"},dr={class:"debug-actions"},ur={key:0,class:"error-details"},gr={class:"error-stack"};function mr(n,e,o,t,r,i){return c(),d("div",ar,[t.showFallback?(c(),d("div",rr,[e[11]||(e[11]=s("div",{class:"fallback-header"},[s("h1",null,"üöß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"),s("p",null,"–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ")],-1)),s("div",ir,[s("div",lr,[e[5]||(e[5]=s("h3",null,"üìã –°—Ç–∞—Ç—É—Å TASK-089",-1)),s("ul",null,[e[2]||(e[2]=s("li",null,"‚úÖ –°—Ç–∞—Ä—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–¥–∞–ª–µ–Ω",-1)),e[3]||(e[3]=s("li",null,"‚úÖ –ù–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–∑–¥–∞–Ω",-1)),e[4]||(e[4]=s("li",null,"‚ö†Ô∏è –ò–¥–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º",-1)),s("li",null,"üîÑ –ü–æ–ø—ã—Ç–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏: "+g(t.loadAttempts),1)])]),s("div",cr,[e[7]||(e[7]=s("h3",null,"üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",-1)),e[8]||(e[8]=s("p",null,"–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ—Ç —ç–∫—Ä–∞–Ω, –∑–Ω–∞—á–∏—Ç –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è.",-1)),e[9]||(e[9]=s("p",null,"–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:",-1)),e[10]||(e[10]=s("ul",null,[s("li",null,"‚Ä¢ –û—à–∏–±–∫–∞ JavaScript –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö"),s("li",null,"‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏"),s("li",null,"‚Ä¢ –û—à–∏–±–∫–∏ –≤ setup —Ñ—É–Ω–∫—Ü–∏—è—Ö"),s("li",null,"‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏")],-1)),s("div",dr,[s("button",{onClick:e[0]||(e[0]=(...a)=>t.retryLoad&&t.retryLoad(...a)),class:"retry-btn"}," üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å "),s("button",{onClick:e[1]||(e[1]=(...a)=>t.showErrorDetails&&t.showErrorDetails(...a)),class:"debug-btn"}," üêõ "+g(t.showErrorDetailsFlag?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å")+" –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ ",1),t.showErrorDetailsFlag&&t.lastError?(c(),d("div",ur,[e[6]||(e[6]=s("h4",null,"üìÑ –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",-1)),s("pre",gr,g(t.lastError.stack||t.lastError.message),1)])):k("",!0)])])])])):k("",!0)])}const fr=$(sr,[["render",mr],["__scopeId","data-v-83136f08"]]);class W{static async getCacheStatus(){try{const e=me("/api/admin/cache-status.php");console.log("[CacheManagementService] Fetching cache status from:",e);const o=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("[CacheManagementService] Response status:",o.status),!o.ok){const r=await o.text();throw console.error("[CacheManagementService] HTTP error:",r),new Error(`HTTP error! status: ${o.status}, message: ${r}`)}const t=await o.json();if(console.log("[CacheManagementService] API result:",t),t.success){let r=t.modules||[];console.log("[CacheManagementService] Modules from API:",r.length,r),r.length===0&&(console.log("[CacheManagementService] Using mock data for UI demonstration"),r=this.getMockModules(),console.log("[CacheManagementService] Mock modules:",r.length));const i=this.categorizeAndSortModules(r);return console.log("[CacheManagementService] Categorized result:",i),i}else throw new Error(t.error||"Failed to get cache status")}catch(e){console.error("[CacheManagementService] Error getting cache status:",e),console.log("[CacheManagementService] Using mock data due to API error");const o=this.getMockModules(),t=this.categorizeAndSortModules(o);return console.log("[CacheManagementService] Mock categorized result:",t),t}}static async clearCache(e){try{const o=me("/api/admin/cache-clear.php"),t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,confirm:!0})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return!0;throw new Error(r.error||"Failed to clear cache")}catch(o){throw console.error("[CacheManagementService] Error clearing cache:",o),o}}static async getCacheStats(){try{const e=me("/api/admin/cache-stats.php"),o=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const t=await o.json();if(t.success)return t.stats||{};throw new Error(t.error||"Failed to get cache stats")}catch(e){throw console.error("[CacheManagementService] Error getting cache stats:",e),e}}static formatCacheSize(e){if(e===0)return"0 B";const o=1024,t=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(o));return Math.round(e/Math.pow(o,r)*100)/100+" "+t[r]}static categorizeAndSortModules(e,o={}){const t=this.generateCacheKey(e),r=this.getCachedResult(t);if(r&&!o.forceRefresh)return r;const i=performance.now(),a=this.performCategorization(e),l=performance.now();return a.metadata={processingTime:l-i,totalModules:e.length,primaryCount:a.primaryModules.length,secondaryCount:a.secondaryModules.length,cached:!1},this.setCachedResult(t,a),a}static performCategorization(e){const o=[],t=[];return e.forEach(r=>{this.validateModule(r),this.PRIMARY_MODULE_IDS.includes(r.id)?o.push({...r,category:"primary",priority:this.PRIMARY_MODULE_PRIORITIES[r.id]||999}):t.push({...r,category:"secondary",groupType:this.getModuleType(r.id)})}),{primaryModules:this.sortPrimaryModules(o),secondaryModules:this.sortSecondaryModules(t)}}static sortPrimaryModules(e){return e.sort((o,t)=>{const r=this.PRIMARY_MODULE_PRIORITIES[o.id]||999,i=this.PRIMARY_MODULE_PRIORITIES[t.id]||999;return r-i})}static sortSecondaryModules(e){return e.sort((o,t)=>{const r=this.getModuleType(o.id),i=this.getModuleType(t.id);return r!==i?this.compareModuleTypes(r,i):o.name.localeCompare(t.name)})}static compareModuleTypes(e,o){const t=["users","activity","webhooks","other"],r=t.indexOf(e),i=t.indexOf(o);return(r===-1?999:r)-(i===-1?999:i)}static getModuleType(e){for(const[o,t]of Object.entries(this.SECONDARY_MODULE_TYPES))if(e.startsWith(t.prefix))return o;return e.includes("time-tracking")?"time-tracking":e.includes("graph")?"graphs":e.includes("dashboard")?"dashboards":"other"}static getModuleTypeConfig(e){return this.SECONDARY_MODULE_TYPES[e]||{title:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏",description:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã"}}static validateModule(e){if(!e||typeof e!="object")throw new Error("Module must be an object");if(!e.id||typeof e.id!="string")throw new Error("Module must have a valid id");if(!e.name||typeof e.name!="string")throw new Error("Module must have a valid name");return!0}static generateCacheKey(e){const o=e.map(t=>t.id).sort().join(",");return btoa(o).substring(0,16)}static getCachedResult(e){const o=this.categorizationCache.get(e);return o?Date.now()-o.timestamp>this.CACHE_TTL?(this.categorizationCache.delete(e),null):{...o.data,metadata:{...o.data.metadata,cached:!0}}:null}static setCachedResult(e,o){if(this.categorizationCache.set(e,{data:{...o,metadata:{...o.metadata,cached:!1}},timestamp:Date.now()}),this.categorizationCache.size>10){const t=this.categorizationCache.keys().next().value;this.categorizationCache.delete(t)}}static clearCategorizationCache(){this.categorizationCache.clear()}static invalidateCacheAfterModuleOperation(){this.clearCategorizationCache()}static getCategorizationStats(){return{cacheSize:this.categorizationCache.size,cacheEntries:Array.from(this.categorizationCache.entries()).map(([e,o])=>({key:e,age:Date.now()-o.timestamp,modulesCount:o.data.primaryModules.length+o.data.secondaryModules.length}))}}static formatTTL(e){return e<60?`${e} —Å–µ–∫`:e<3600?`${Math.floor(e/60)} –º–∏–Ω`:`${Math.floor(e/3600)} —á`}static formatCreationTime(e){return e<1e3?`${Math.round(e)}–º—Å`:e<6e4?`${Math.round(e/1e3*10)/10}—Å–µ–∫`:`${Math.round(e/6e4*10)/10}–º–∏–Ω`}static formatCacheHitRatio(e){return`${Math.round(e*100)}%`}static formatDataFreshness(e){return`${Math.round(e*100)}%`}static getExpiryColor(e){if(!e)return"gray";const o=Date.now()/1e3,t=(e-o)/3600;return t>2?"green":t>.5?"yellow":"red"}static getEfficiencyColor(e){return e>=.85?"green":e>=.7?"yellow":"red"}static getCreationTimeColor(e){return e<=2e3?"green":e<=1e4?"yellow":"red"}static getFreshnessColor(e){return e>=.9?"green":e>=.7?"yellow":"red"}static generateModuleMetadata(e){const o=Math.floor(Date.now()/1e3),t=e.metadata||{},r=this.PRIMARY_MODULE_IDS.includes(e.id);return{version:t.version||"1.0",module_id:e.id,module_name:e.name,created_at:t.created_at||o-Math.random()*86400*7,created_by:t.created_by||(Math.random()>.5?"system":"cron"),creation_time_ms:t.creation_time_ms||500+Math.random()*9500,last_accessed_at:t.last_accessed_at||o-Math.random()*3600,access_count:t.access_count||Math.floor(Math.random()*100)+1,expires_at:t.expires_at||o+(e.ttl||3600),ttl_seconds:e.ttl||3600,file_size_bytes:e.total_size||Math.floor(Math.random()*1e7)+1e6,compression_ratio:t.compression_ratio||.7+Math.random()*.3,data_version:t.data_version||`2026.01.12.v${Math.floor(Math.random()*10)+1}`,source_params:t.source_params||{period:r?Math.random()>.5?"weeks":"months":"default",sector_id:e.id.includes("sector-1c")?"1c":"all",filters:Math.random()>.5?["active_only"]:[],limit:Math.floor(Math.random()*1e3)+500},performance_metrics:t.performance_metrics||{avg_response_time_ms:20+Math.random()*80,cache_hit_ratio:.7+Math.random()*.3,data_freshness_score:.8+Math.random()*.2}}}static getMockModules(){const e=Math.floor(Date.now()/1e3);return[{id:"dashboard-sector-1c",name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",status:"active",file_count:5,total_size:1024e3,ttl:600,created_at:e-7200,expires_at:e+1800,cache_dir:"api/cache/dashboard-sector-1c"},{id:"graph-state",name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",status:"active",file_count:3,total_size:512e3,ttl:3600,created_at:e-3600,expires_at:e+7200,cache_dir:"api/cache/graph-state"},{id:"graph-admission-closure-weeks",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–µ–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",status:"active",file_count:8,total_size:2048e3,ttl:300,created_at:e-1800,expires_at:e+120,cache_dir:"api/cache/graph-admission-closure/weeks"},{id:"graph-admission-closure-months",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–µ–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",status:"active",file_count:12,total_size:3072e3,ttl:300,created_at:e-3600,expires_at:e+240,cache_dir:"api/cache/graph-admission-closure/months"},{id:"time-tracking-default",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",status:"active",file_count:4,total_size:768e3,ttl:300,created_at:e-900,expires_at:e+2100,cache_dir:"api/cache/time-tracking-sector-1c/default"},{id:"time-tracking-detailed",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:6,total_size:1536e3,ttl:120,created_at:e-600,expires_at:e+3540,cache_dir:"api/cache/time-tracking-sector-1c/detailed"},{id:"time-tracking-summary",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:2,total_size:384e3,ttl:600,created_at:e-1800,expires_at:e+4200,cache_dir:"api/cache/time-tracking-sector-1c/summary"},{id:"users-management-departments",name:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–æ—Ç–¥–µ–ª—ã)",status:"active",file_count:2,total_size:256e3,ttl:3600,created_at:e-7200,expires_at:e+28800,cache_dir:"api/cache/users-management/departments"},{id:"webhook-logs-api",name:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ (API –∑–∞–ø—Ä–æ—Å—ã)",status:"active",file_count:15,total_size:512e4,ttl:300,created_at:e-3600,expires_at:e+2400,cache_dir:"api/cache/webhook-logs/api"}]}static enrichModulesWithMetadata(e){return e.map(o=>({...o,metadata:this.generateModuleMetadata(o)}))}}ve(W,"PRIMARY_MODULE_IDS",["dashboard-sector-1c","graph-state","graph-admission-closure-weeks","graph-admission-closure-months","time-tracking-default","time-tracking-detailed","time-tracking-summary"]),ve(W,"PRIMARY_MODULE_PRIORITIES",{"dashboard-sector-1c":1,"graph-state":2,"graph-admission-closure-weeks":3,"graph-admission-closure-months":4,"time-tracking-default":5,"time-tracking-detailed":6,"time-tracking-summary":7}),ve(W,"SECONDARY_MODULE_TYPES",{users:{prefix:"users-management",title:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –æ—Ç–¥–µ–ª–∞–º–∏"},activity:{prefix:"user-activity",title:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",description:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},webhooks:{prefix:"webhook-logs",title:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",description:"–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±—Ö—É–∫–æ–≤"}}),ve(W,"categorizationCache",new Map),ve(W,"CACHE_TTL",3e4);function hr(n){const e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),o=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-o);const t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}class et{static async createCache(e,o=null,t={}){try{const r=me("/api/admin/cache-create.php"),i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,mode:o,params:t})});if(!i.ok){const l=await i.json().catch(()=>({}));throw new Error(l.error||`HTTP error! status: ${i.status}`)}const a=await i.json();if(a.success)return a;throw new Error(a.error||"Failed to create cache")}catch(r){throw console.error("[CacheCreationService] Error creating cache:",r),r}}static async getCreationStatus(e){try{const o=me(`/api/admin/cache-create-status.php?task_id=${e}`),t=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.success)return r;throw new Error(r.error||"Failed to get creation status")}catch(o){throw console.error("[CacheCreationService] Error getting creation status:",o),o}}static getDefaultParams(e){if(e.includes("graph-admission-closure"))if((e.includes("weeks")?"weeks":"months")==="weeks"){const t=new Date,r=t.getUTCFullYear(),i=hr(t),a=new Date(r,0,1+(i-1)*7),l=a.getUTCDay(),m=a.getUTCDate()-l+(l===0?-6:1);a.setUTCDate(m),a.setUTCHours(0,0,0,0);const f=new Date(a);return f.setUTCDate(a.getUTCDate()+6),f.setUTCHours(23,59,59,999),{product:"1C",periodMode:"weeks",weekStartUtc:a.toISOString(),weekEndUtc:f.toISOString(),includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,useCache:!0,forceRefresh:!0}}else return{product:"1C",periodMode:"months",includeTickets:!0,includeNewTicketsByStages:!1,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!1};if(e.includes("dashboard-sector-1c"))return{forceRefresh:!0,ttl:600};if(e.includes("graph-state"))return{type:"current",forceRefresh:!0,ttl:3600};if(e.includes("time-tracking")){const o=e.includes("detailed")?"detailed":e.includes("summary")?"summary":"default";return{product:"1C",includeTaskDetails:o==="detailed",summary:o==="summary"}}return{}}}class je{static notifyCacheCreationStarted(e){this.showNotification({content:`–ù–∞—á–∞—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}"...`,type:"info",autoHideDelay:3e3})}static notifyCacheCreationSuccess(e){this.showNotification({content:`‚úÖ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,type:"success",autoHideDelay:5e3})}static notifyCacheCreationError(e,o){this.showNotification({content:`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}": ${o}`,type:"error",autoHideDelay:7e3})}static notifyCacheUpdated(e,o="auto"){const t=o==="manual"?"–≤—Ä—É—á–Ω—É—é":"–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏";this.showNotification({content:`üîÑ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" –æ–±–Ω–æ–≤–ª—ë–Ω ${t}`,type:"info",autoHideDelay:4e3})}static notifyCacheUsed(e){this.showNotification({content:`‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}"`,type:"success",autoHideDelay:3e3})}static showNotification(e){typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:e.content,autoHideDelay:e.autoHideDelay||3e3}):console.log("[CacheNotification]",e.content)}}const Mc=Object.freeze(Object.defineProperty({__proto__:null,CacheNotificationService:je},Symbol.toStringTag,{value:"Module"})),vr={name:"CacheCreateProgress",props:{progress:{type:Number,required:!0,validator:n=>n>=0&&n<=100},message:{type:String,default:"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞..."}}},pr={class:"cache-create-progress"},yr={class:"progress-bar"},_r={class:"progress-text"};function br(n,e,o,t,r,i){return c(),d("div",pr,[s("div",yr,[s("div",{class:"progress-fill",style:Pe({width:o.progress+"%"})},null,4)]),s("div",_r,g(o.progress)+"% - "+g(o.message),1)])}const wr=$(vr,[["render",br],["__scopeId","data-v-7071de3b"]]),Cr={name:"CacheCreateModal",components:{CacheCreateProgress:wr},props:{module:{type:Object,required:!0}},emits:["close","create"],setup(n,{emit:e}){const o=w(!1),t=w(0),r=w(""),i=w(null),a=w(""),l=b(()=>n.module.id.includes("graph-admission-closure")||n.module.id.includes("time-tracking")),m=b(()=>n.module.id.includes("graph-admission-closure")?["months","weeks"]:n.module.id.includes("time-tracking")?["default","detailed","summary"]:[]),f=()=>{e("close")},C=L=>{L.preventDefault(),L.stopPropagation(),L.target===L.currentTarget&&f()},p=async()=>{o.value=!0,t.value=0,r.value="–ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞...";try{let L={};if(a.value.trim())try{L=JSON.parse(a.value)}catch{throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")}else L=et.getDefaultParams(n.module.id);je.notifyCacheCreationStarted(n.module.name),t.value=25,r.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24...";const E=await et.createCache(n.module.id,i.value,L);t.value=75,r.value="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∞...",await new Promise(x=>setTimeout(x,500)),t.value=100,r.value="–ö–µ—à —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",je.notifyCacheCreationSuccess(n.module.name),setTimeout(()=>{e("create",E),f()},1e3)}catch(L){console.error("[CacheCreateModal] Error creating cache:",L),je.notifyCacheCreationError(n.module.name,L.message),o.value=!1}};return ne(()=>{m.value.length>0&&(i.value=m.value[0]);const L=et.getDefaultParams(n.module.id);a.value=JSON.stringify(L,null,2)}),{creating:o,progress:t,progressMessage:r,selectedMode:i,paramsJson:a,supportsModes:l,availableModes:m,close:f,handleOverlayClick:C,handleCreate:p}}},Sr={class:"modal-header"},kr={class:"modal-body"},xr={key:1,class:"create-form"},Er={key:0,class:"form-group"},Mr=["value"],Tr={class:"form-group"},Ar={class:"modal-footer"},Lr=["disabled"],Dr=["disabled"],Ir={key:0},Pr={key:1};function Nr(n,e,o,t,r,i){const a=V("CacheCreateProgress");return c(),K(nt,{to:"body"},[s("div",{class:"modal-overlay",onClick:e[6]||(e[6]=(...l)=>t.handleOverlayClick&&t.handleOverlayClick(...l))},[s("div",{class:"modal-content",onClick:e[5]||(e[5]=ce(()=>{},["stop"])),style:{"pointer-events":"auto"}},[s("div",Sr,[s("h2",null,"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞: "+g(o.module.name),1),s("button",{onClick:e[0]||(e[0]=(...l)=>t.close&&t.close(...l)),class:"btn-close"},"√ó")]),s("div",kr,[t.creating?(c(),K(a,{key:0,progress:t.progress,message:t.progressMessage},null,8,["progress","message"])):(c(),d("div",xr,[t.supportsModes?(c(),d("div",Er,[e[7]||(e[7]=s("label",null,"–†–µ–∂–∏–º –∫–µ—à–∞:",-1)),ee(s("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.selectedMode=l),class:"form-control"},[(c(!0),d(H,null,J(t.availableModes,l=>(c(),d("option",{key:l,value:l},g(l),9,Mr))),128))],512),[[Be,t.selectedMode]])])):k("",!0),s("div",Tr,[e[8]||(e[8]=s("label",null,"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):",-1)),ee(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.paramsJson=l),placeholder:'{"product": "1C", ...}',rows:"5",class:"form-control"},null,512),[[Ie,t.paramsJson]]),e[9]||(e[9]=s("small",{class:"form-text"},"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",-1))])]))]),s("div",Ar,[s("button",{onClick:e[3]||(e[3]=(...l)=>t.close&&t.close(...l)),class:"btn-cancel",disabled:t.creating},"–û—Ç–º–µ–Ω–∞",8,Lr),s("button",{onClick:e[4]||(e[4]=(...l)=>t.handleCreate&&t.handleCreate(...l)),disabled:t.creating,class:"btn-create"},[t.creating?(c(),d("span",Ir,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",Pr,"–°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],8,Dr)])])])])}const Rr=$(Cr,[["render",Nr],["__scopeId","data-v-1fa7d83b"]]),Or={name:"CacheCreateButton",components:{CacheCreateModal:Rr},props:{module:{type:Object,required:!0}},emits:["created"],setup(n,{emit:e}){const o=w(!1),t=w(!1);return{showModal:o,creating:t,openModal:()=>{o.value=!0},closeModal:()=>{o.value=!1},handleCreate:async l=>{t.value=!0;try{e("created",l)}finally{t.value=!1}}}}},Ur={class:"cache-create-button"},Fr=["disabled"],Br={key:0},zr={key:1};function jr(n,e,o,t,r,i){const a=V("CacheCreateModal");return c(),d("div",Ur,[s("button",{onClick:e[0]||(e[0]=(...l)=>t.openModal&&t.openModal(...l)),disabled:t.creating,class:B(["btn-create",{"btn-disabled":t.creating}])},[t.creating?(c(),d("span",Br,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",zr,"‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],10,Fr),t.showModal?(c(),K(a,{key:0,module:o.module,onClose:t.closeModal,onCreate:t.handleCreate},null,8,["module","onClose","onCreate"])):k("",!0)])}const Wr=$(Or,[["render",jr],["__scopeId","data-v-45e7d308"]]);class oe{static success(e,o,t={}){this.show("success",e,o,t)}static error(e,o,t={}){this.show("error",e,o,t)}static warning(e,o,t={}){this.show("warning",e,o,t)}static info(e,o,t={}){this.show("info",e,o,t)}static show(e,o,t,r={}){const i={autoHideDelay:r.autoHideDelay||5e3,position:r.position||"top-right",...r};this.isBitrix24Available()?this.showBitrix24Notification(e,o,t,i):this.showFallbackNotification(e,o,t,i)}static isBitrix24Available(){return typeof window<"u"&&window.BX&&window.BX.UI&&window.BX.UI.Notification&&window.BX.UI.Notification.Center&&typeof window.BX.UI.Notification.Center.notify=="function"}static showBitrix24Notification(e,o,t,r){try{const a={success:"success",error:"error",warning:"warning",info:"info"}[e]||"info",l=o?`${o}: ${t}`:t;window.BX.UI.Notification.Center.notify({content:l,autoHideDelay:r.autoHideDelay,category:`cache-management-${e}`,position:r.position}),console.log(`[NotificationSystem] Bitrix24 notification shown: ${e}`,{title:o,message:t,config:r})}catch(i){console.error("[NotificationSystem] Error showing Bitrix24 notification:",i),this.showFallbackNotification(e,o,t,r)}}static showFallbackNotification(e,o,t,r){if("Notification"in window&&Notification.permission==="granted")try{const i=new Notification(o||"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",{body:t,icon:this.getIconForType(e),tag:`cache-management-${e}`});setTimeout(()=>{i.close()},r.autoHideDelay),console.log(`[NotificationSystem] Browser notification shown: ${e}`,{title:o,message:t});return}catch(i){console.warn("[NotificationSystem] Browser notification failed:",i)}this.showCustomNotification(e,o,t,r)}static showCustomNotification(e,o,t,r){let i=document.getElementById("notification-container");if(!i){i=document.createElement("div"),i.id="notification-container",i.className="notification-container",document.body.appendChild(i);const m=document.createElement("style");m.textContent=this.getNotificationStyles(),document.head.appendChild(m)}const a=document.createElement("div");a.className=`custom-notification notification-${e}`,a.innerHTML=`
      <div class="notification-content">
        <div class="notification-title">${o||""}</div>
        <div class="notification-message">${t}</div>
      </div>
      <button class="notification-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">√ó</button>
    `,a.querySelector(".notification-close").addEventListener("click",()=>{this.removeCustomNotification(a)}),i.appendChild(a),setTimeout(()=>{this.removeCustomNotification(a)},r.autoHideDelay),console.log(`[NotificationSystem] Custom notification shown: ${e}`,{title:o,message:t})}static removeCustomNotification(e){e&&e.parentNode&&(e.classList.add("notification-hiding"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}static getIconForType(e){const o={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};return o[e]||o.info}static getNotificationStyles(){return`
      .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        pointer-events: none;
      }

      .custom-notification {
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 10px;
        min-width: 300px;
        max-width: 500px;
        pointer-events: auto;
        opacity: 0;
        transform: translateX(100%);
        animation: notificationSlideIn 0.3s ease forwards;
        border-left: 4px solid;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        padding: 16px;
        gap: 12px;
      }

      .custom-notification.notification-success {
        border-left-color: #28a745;
      }

      .custom-notification.notification-error {
        border-left-color: #dc3545;
      }

      .custom-notification.notification-warning {
        border-left-color: #ffc107;
      }

      .custom-notification.notification-info {
        border-left-color: #17a2b8;
      }

      .notification-content {
        flex: 1;
      }

      .notification-title {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
        color: #333;
      }

      .notification-message {
        font-size: 13px;
        color: #666;
        line-height: 1.4;
      }

      .notification-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #999;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        flex-shrink: 0;
      }

      .notification-close:hover {
        color: #333;
      }

      .notification-hiding {
        animation: notificationSlideOut 0.3s ease forwards;
      }

      @keyframes notificationSlideIn {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes notificationSlideOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(100%);
        }
      }

      @media (max-width: 768px) {
        .notification-container {
          left: 10px;
          right: 10px;
          top: 10px;
        }

        .custom-notification {
          min-width: auto;
          max-width: none;
        }
      }
    `}static clearAll(){try{this.isBitrix24Available()&&window.BX.UI.Notification.Center.clearAll&&window.BX.UI.Notification.Center.clearAll()}catch(o){console.warn("[NotificationSystem] Error clearing Bitrix24 notifications:",o)}const e=document.getElementById("notification-container");if(e&&(e.innerHTML=""),"Notification"in window&&"getNotifications"in Notification)try{Notification.getNotifications().forEach(t=>{t.tag&&t.tag.startsWith("cache-management-")&&t.close()})}catch(o){console.warn("[NotificationSystem] Error clearing browser notifications:",o)}}}oe.show.bind(oe);oe.success.bind(oe);oe.error.bind(oe);oe.warning.bind(oe);oe.info.bind(oe);let Z=null,ie=null;const xe=class xe{static show(e={}){return new Promise((o,t)=>{ie=o,Z||(Z=this.createModal(),document.body.appendChild(Z)),this.configureModal(e),this.showModal()})}static hide(){Z&&(this.hideModal(),ie&&(ie(!1),ie=null))}static createModal(){const e=document.createElement("div");return e.className="cache-confirmation-modal",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","confirmation-title"),e.setAttribute("aria-describedby","confirmation-message"),e.innerHTML=`
      <div class="modal-backdrop" data-action="cancel"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="confirmation-title" class="modal-title"></h3>
          <button
            class="modal-close"
            data-action="cancel"
            aria-label="–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"
          >
            √ó
          </button>
        </div>

        <div class="modal-body">
          <div class="modal-icon">
            <span class="icon-symbol"></span>
          </div>
          <p id="confirmation-message" class="modal-message"></p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-cancel" data-action="cancel"></button>
          <button class="btn btn-confirm" data-action="confirm"></button>
        </div>
      </div>
    `,this.attachEventListeners(e),this.addStyles(),e}static configureModal(e){const{title:o="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",message:t="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ?",type:r="warning",confirmText:i="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",cancelText:a="–û—Ç–º–µ–Ω–∞",showCancel:l=!0}=e,m=Z.querySelector(".modal-title");m.textContent=o;const f=Z.querySelector(".modal-message");f.textContent=t;const C=Z.querySelector(".icon-symbol"),p={danger:"‚ö†Ô∏è",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è",success:"‚úÖ"};C.textContent=p[r]||p.warning;const L=Z.querySelector(".btn-cancel"),E=Z.querySelector(".btn-confirm");L.textContent=a,E.textContent=i,l?L.style.display="inline-block":L.style.display="none",Z.className=`cache-confirmation-modal modal-${r}`}static showModal(){document.body.style.overflow="hidden",Z.style.display="flex",Z.classList.add("modal-visible"),setTimeout(()=>{const e=Z.querySelector(".btn-confirm");e&&e.focus()},100),document.addEventListener("keydown",this.handleKeyDown)}static hideModal(){document.body.style.overflow="",Z.classList.remove("modal-visible"),document.removeEventListener("keydown",this.handleKeyDown),setTimeout(()=>{Z&&(Z.style.display="none")},300)}static attachEventListeners(e){e.addEventListener("click",o=>{const t=o.target.closest("[data-action]")?.getAttribute("data-action");t==="confirm"?this.handleConfirm():t==="cancel"&&this.handleCancel()})}static handleConfirm(){ie&&(ie(!0),ie=null),this.hideModal()}static handleCancel(){ie&&(ie(!1),ie=null),this.hideModal()}static handleTabNavigation(e){const t=Z.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),r=t[0],i=t[t.length-1];e.shiftKey?document.activeElement===r&&(e.preventDefault(),i.focus()):document.activeElement===i&&(e.preventDefault(),r.focus())}static addStyles(){if(document.getElementById("cache-confirmation-styles"))return;const e=document.createElement("style");e.id="cache-confirmation-styles",e.textContent=`
      .cache-confirmation-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        align-items: center;
        justify-content: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      .cache-confirmation-modal.modal-visible {
        display: flex;
      }

      .modal-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(2px);
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        z-index: 10001;
        animation: modalSlideIn 0.3s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px 16px;
        border-bottom: 1px solid #e0e0e0;
      }

      .modal-title {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: #333;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .modal-close:hover {
        background: #f0f0f0;
        color: #333;
      }

      .modal-body {
        padding: 24px;
        text-align: center;
      }

      .modal-icon {
        margin-bottom: 16px;
      }

      .icon-symbol {
        font-size: 48px;
        display: block;
      }

      .modal-message {
        margin: 0;
        font-size: 16px;
        color: #555;
        line-height: 1.5;
      }

      .modal-footer {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        padding: 16px 24px 24px;
        border-top: 1px solid #e0e0e0;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
        min-width: 80px;
      }

      .btn:focus {
        outline: 2px solid #007bff;
        outline-offset: 2px;
      }

      .btn-cancel {
        background: #f8f9fa;
        color: #6c757d;
        border: 1px solid #dee2e6;
      }

      .btn-cancel:hover {
        background: #e9ecef;
        border-color: #adb5bd;
      }

      .btn-confirm {
        background: #007bff;
        color: white;
      }

      .btn-confirm:hover {
        background: #0056b3;
      }

      /* –¢–∏–ø—ã –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
      .modal-danger .btn-confirm {
        background: #dc3545;
      }

      .modal-danger .btn-confirm:hover {
        background: #c82333;
      }

      .modal-warning .btn-confirm {
        background: #ffc107;
        color: #212529;
      }

      .modal-warning .btn-confirm:hover {
        background: #e0a800;
      }

      .modal-info .btn-confirm {
        background: #17a2b8;
      }

      .modal-info .btn-confirm:hover {
        background: #138496;
      }

      .modal-success .btn-confirm {
        background: #28a745;
      }

      .modal-success .btn-confirm:hover {
        background: #1e7e34;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
      @media (max-width: 480px) {
        .modal-content {
          margin: 20px;
          width: calc(100% - 40px);
        }

        .modal-header,
        .modal-body,
        .modal-footer {
          padding-left: 20px;
          padding-right: 20px;
        }

        .modal-footer {
          flex-direction: column-reverse;
        }

        .btn {
          width: 100%;
        }
      }

      /* –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å */
      @media (prefers-reduced-motion: reduce) {
        .modal-content,
        .modal-close,
        .btn {
          animation: none;
          transition: none;
        }
      }

      /* –í—ã—Å–æ–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç */
      @media (prefers-contrast: high) {
        .modal-content {
          border: 2px solid #000;
        }

        .btn-cancel {
          border: 2px solid #000;
        }

        .btn-confirm {
          border: 2px solid #000;
        }
      }
    `,document.head.appendChild(e)}};ve(xe,"handleKeyDown",e=>{switch(e.key){case"Enter":e.preventDefault(),xe.handleConfirm();break;case"Escape":e.preventDefault(),xe.handleCancel();break;case"Tab":xe.handleTabNavigation(e);break}});let Se=xe;Se.show.bind(Se);Se.hide.bind(Se);const $r={name:"CacheModuleCard",components:{CacheCreateButton:Wr},props:{module:{type:Object,required:!0,validator:n=>n&&typeof n.id=="string"&&typeof n.name=="string"},isPrimary:{type:Boolean,default:!1},priority:{type:Number,default:999},groupType:{type:String,default:null}},emits:["clear","refresh","details"],setup(n,{emit:e}){const o=w(!1),t=w(!1),r=w(!1),i=w(!1),a=h=>{if(!h.target.closest(".action-button"))switch(h.key){case"Enter":case" ":h.preventDefault();const U=h.currentTarget.querySelector(".action-button:not([disabled])");U&&U.focus();break}};ne(()=>{const h=()=>{i.value=window.innerWidth<768};h(),window.addEventListener("resize",h);const U=document.querySelector(`[data-module-id="${n.module.id}"]`);U&&U.addEventListener("keydown",a)}),ot(()=>{const h=document.querySelector(`[data-module-id="${n.module.id}"]`);h&&h.removeEventListener("keydown",a)});const l=b(()=>({"cache-module-card":!0,"primary-module":n.isPrimary,"secondary-module":!n.isPrimary,"high-priority":n.priority<=3,"expiring-soon":A.value,"empty-cache":E.value,loading:o.value||t.value,[Re.value]:!0})),m=b(()=>n.isPrimary?"üèÜ":{users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"}[n.groupType]||"üîß"),f=b(()=>({"primary-icon":n.isPrimary,"secondary-icon":!n.isPrimary})),C=b(()=>n.isPrimary?"–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å":n.groupType?W.getModuleTypeConfig(n.groupType).title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞":""),p=b(()=>n.priority?`priority-${n.priority}`:""),L=b(()=>`status-${n.module.status||"empty"}`),E=b(()=>(n.module.file_count||0)===0),x=b(()=>n.module.expires_at?new Date(n.module.expires_at*1e3)<=new Date:!1),A=b(()=>{if(!n.module.expires_at)return!1;const N=(new Date(n.module.expires_at*1e3)-new Date)/(1e3*60*60);return N>0&&N<=2}),S=b(()=>{const h=n.module.status;return h==="active"?"–ê–∫—Ç–∏–≤–µ–Ω":h==="expired"?"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω":h==="empty"?"–ü—É—Å—Ç":"–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}),u=b(()=>W.formatCacheSize(n.module.total_size||0)),M=b(()=>W.formatTTL(n.module.ttl||0)),R=b(()=>{if(!n.module.cache_dir)return"";const h=n.module.cache_dir.split("/");return h.length>2?"..."+h.slice(-2).join("/"):n.module.cache_dir}),z=b(()=>n.module.metadata?.creation_time_ms?W.formatCreationTime(n.module.metadata.creation_time_ms):"‚Äî"),F=b(()=>{if(!n.module.metadata?.last_accessed_at)return"‚Äî";const h=new Date(n.module.metadata.last_accessed_at*1e3),N=new Date-h;return N<6e4?"–¢–æ–ª—å–∫–æ —á—Ç–æ":N<36e5?`${Math.floor(N/6e4)} –º–∏–Ω –Ω–∞–∑–∞–¥`:h.toLocaleString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),D=b(()=>n.module.metadata?.access_count||0),v=b(()=>n.module.metadata?.performance_metrics?.cache_hit_ratio?W.formatCacheHitRatio(n.module.metadata.performance_metrics.cache_hit_ratio):"‚Äî"),y=b(()=>n.module.metadata?.performance_metrics?.data_freshness_score?W.formatDataFreshness(n.module.metadata.performance_metrics.data_freshness_score):"‚Äî"),I=b(()=>n.module.expires_at?`metric-${W.getExpiryColor(n.module.expires_at)}`:""),T=b(()=>n.module.metadata?.creation_time_ms?`metric-${W.getCreationTimeColor(n.module.metadata.creation_time_ms)}`:""),P=b(()=>n.module.metadata?.performance_metrics?.cache_hit_ratio?`metric-${W.getEfficiencyColor(n.module.metadata.performance_metrics.cache_hit_ratio)}`:""),O=b(()=>n.module.metadata?.performance_metrics?.data_freshness_score?`metric-${W.getFreshnessColor(n.module.metadata.performance_metrics.data_freshness_score)}`:""),X=b(()=>{if(!n.module.expires_at)return null;const h=new Date(n.module.expires_at*1e3);return Math.max(0,Math.floor((h-new Date)/1e3))}),be=b(()=>{if(X.value===null)return"‚Äî";if(X.value<=0)return"–ò—Å—Ç–µ–∫";const h=Math.floor(X.value/3600),U=Math.floor(X.value%3600/60),N=X.value%60;return h>0?`${h}—á ${U}–º`:U>0?`${U}–º ${N}—Å`:`${N}—Å`}),Ve=b(()=>X.value===null?"":X.value<=0||X.value<=1800?"metric-red":X.value<=7200?"metric-orange":"metric-green"),de=h=>{if(h===0)return"0 B";const U=1024,N=["B","KB","MB","GB","TB"],j=Math.floor(Math.log(h)/Math.log(U));return parseFloat((h/Math.pow(U,j)).toFixed(1))+" "+N[j]},Xe=h=>h<60?`${h}—Å`:h<3600?`${Math.floor(h/60)}–º`:h<86400?`${Math.floor(h/3600)}—á`:`${Math.floor(h/86400)}–¥`,we=b(()=>{if(E.value)return"empty";if(x.value)return"expired";const h=X.value;return h===null?"fresh":h<=0?"expired":h<=30*60*1e3?"critical":h<=2*60*60*1e3?"warning":"fresh"}),qe=b(()=>{const h=we.value;return{fresh:"–°–≤–µ–∂–∏–π –∫–µ—à",warning:"–ò—Å—Ç–µ–∫–∞–µ—Ç —Å–∫–æ—Ä–æ",critical:"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç",expired:"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω",empty:"–ö–µ—à –ø—É—Å—Ç"}[h]||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}),Re=b(()=>`cache-state-${we.value}`),He=b(()=>({fresh:"üü¢",warning:"üü°",critical:"üî¥",expired:"‚ö´",empty:"‚ö™"})[we.value]||"‚ùì"),Oe=b(()=>!E.value&&!o.value),Je=b(()=>n.isPrimary&&!E.value),Ke=b(()=>E.value?"–ö–µ—à –º–æ–¥—É–ª—è –ø—É—Å—Ç":`–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è ${n.module.name}`),Ye=b(()=>{if(!n.module.created_at)return"‚Äî";const h=new Date(n.module.created_at*1e3),U=new Date,N=U-h;if(N<6e4)return"–¢–æ–ª—å–∫–æ —á—Ç–æ";if(N<36e5){const G=Math.floor(N/6e4);return`${G} ${G===1?"–º–∏–Ω—É—Ç—É":G<5?"–º–∏–Ω—É—Ç—ã":"–º–∏–Ω—É—Ç"} –Ω–∞–∑–∞–¥`}if(h.toDateString()===U.toDateString())return`–°–µ–≥–æ–¥–Ω—è –≤ ${h.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`;const j=new Date(U);return j.setDate(j.getDate()-1),h.toDateString()===j.toDateString()?`–í—á–µ—Ä–∞ –≤ ${h.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:h.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),Ge=b(()=>{if(!n.module.expires_at)return"‚Äî";const h=new Date(n.module.expires_at*1e3),N=h-new Date;if(N<0)return`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω (${h.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})`;const j=Math.floor(N/6e4),G=Math.floor(j/60);return G>0?`${G} —á ${j%60} –º–∏–Ω`:j>0?`${j} –º–∏–Ω`:"–ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã"});return{clearing:o,creating:t,showDetailModal:r,isMobile:i,moduleClasses:l,moduleIcon:m,iconClass:f,moduleTypeText:C,priorityClass:p,statusClass:L,isEmpty:E,isExpired:x,isExpiringSoon:A,statusText:S,formattedSize:u,formattedTTL:M,shortCacheDir:R,formattedCreationTime:z,formattedLastAccess:F,accessCount:D,cacheEfficiency:v,dataFreshness:y,expiresClass:I,creationTimeClass:T,cacheEfficiencyClass:P,dataFreshnessClass:O,cacheState:we,cacheStateText:qe,cacheStateClass:Re,cacheStateIcon:He,timeToExpiry:X,formatTimeToExpiry:be,timeToExpiryClass:Ve,formatBytes:de,formatTTL:Xe,canClear:Oe,canShowDetails:Je,clearButtonLabel:Ke,formattedCreatedAt:Ye,formattedExpiresAt:Ge,handleClear:async()=>{if(Oe.value)try{if(!await Se.show({title:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",message:`–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${n.module.name}"?

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`,type:"danger",confirmText:"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à",cancelText:"–û—Ç–º–µ–Ω–∞"}))return;o.value=!0,await W.clearCache(n.module.id),e("clear",n.module.id),oe.success("–ö–µ—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω",`–ö–µ—à –º–æ–¥—É–ª—è "${n.module.name}" –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω`)}catch(h){console.error("[CacheModuleCard] Error clearing cache:",h),oe.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${n.module.name}": ${h.message}`)}finally{o.value=!1}},handleCacheCreated:()=>{W.invalidateCacheAfterModuleOperation(),e("refresh")},handleCreatingState:h=>{t.value=h},showDetails:()=>{r.value=!0,e("details",n.module)},closeDetails:()=>{r.value=!1}}}},Vr=["aria-labelledby","aria-describedby","data-module-id"],Xr={class:"card-header"},qr={class:"module-identity"},Hr={class:"module-info"},Jr=["id"],Kr={class:"module-type"},Yr={class:"header-meta"},Gr=["id"],Qr={class:"card-content"},Zr={class:"data-grid",role:"region","aria-label":"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–µ—à–µ"},ei={class:"data-section statistics"},ti={class:"data-items"},oi={class:"data-item"},ni={class:"data-value"},si={class:"data-item"},ai={class:"data-value"},ri={key:0,class:"data-item full-width"},ii=["title"],li={class:"data-section lifetime"},ci={class:"data-items"},di={class:"data-item"},ui={class:"data-value"},gi={key:0,class:"data-item"},mi={class:"data-value"},fi={key:1,class:"data-item"},hi={class:"data-section cache-state"},vi={class:"section-header"},pi=["aria-label"],yi={class:"data-items"},_i={class:"data-value cache-state-text"},bi={key:0,class:"data-section performance"},wi={class:"data-items"},Ci={key:0,class:"data-item"},Si={key:1,class:"data-item"},ki={class:"data-value"},xi={key:2,class:"data-item"},Ei={class:"data-value"},Mi={key:3,class:"data-item"},Ti={key:4,class:"data-item"},Ai={key:5,class:"data-item"},Li={class:"data-value"},Di={key:6,class:"data-item"},Ii={class:"data-value"},Pi={key:7,class:"data-item"},Ni=["aria-label"],Ri={class:"primary-actions"},Oi={class:"secondary-actions"},Ui=["disabled","aria-label"],Fi={key:0,class:"button-content"},Bi={key:1,class:"button-content"},zi={key:2,class:"button-content"},ji=["aria-label"],Wi={class:"detail-modal",role:"dialog","aria-modal":"true"},$i={class:"modal-header"},Vi={class:"modal-content"},Xi={class:"json-data"};function qi(n,e,o,t,r,i){const a=V("CacheCreateButton");return c(),d("article",{class:B(["cache-module-card",t.moduleClasses]),role:"article","aria-labelledby":`module-${o.module.id}-title`,"aria-describedby":`module-${o.module.id}-status`,"data-module-id":o.module.id,tabindex:"0"},[s("div",Xr,[s("div",qr,[s("div",{class:B(["module-icon",t.iconClass])},g(t.moduleIcon),3),s("div",Hr,[s("h3",{class:"module-name",id:`module-${o.module.id}-title`},g(o.module.name),9,Jr),s("span",Kr,g(t.moduleTypeText),1)])]),s("div",Yr,[o.isPrimary&&o.priority?(c(),d("span",{key:0,class:B(["priority-badge",t.priorityClass])},g(o.priority),3)):k("",!0),s("span",{class:B(["status-badge",t.statusClass]),id:`module-${o.module.id}-status`,role:"status"},g(t.statusText),11,Gr)])]),s("div",Qr,[s("div",Zr,[s("div",ei,[e[14]||(e[14]=s("div",{class:"section-header"},[s("span",{class:"section-icon","aria-hidden":"true"},"üìä"),s("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],-1)),s("div",ti,[s("div",oi,[e[11]||(e[11]=s("span",{class:"data-label"},"–§–∞–π–ª–æ–≤:",-1)),s("span",ni,g(o.module.file_count||0),1)]),s("div",si,[e[12]||(e[12]=s("span",{class:"data-label"},"–†–∞–∑–º–µ—Ä:",-1)),s("span",ai,g(t.formattedSize),1)]),o.module.cache_dir?(c(),d("div",ri,[e[13]||(e[13]=s("span",{class:"data-label"},"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:",-1)),s("span",{class:"data-value cache-dir",title:o.module.cache_dir},g(t.shortCacheDir),9,ii)])):k("",!0)])]),s("div",li,[e[18]||(e[18]=s("div",{class:"section-header"},[s("span",{class:"section-icon","aria-hidden":"true"},"‚è∞"),s("h4",{class:"section-title"},"–í—Ä–µ–º—è –∂–∏–∑–Ω–∏")],-1)),s("div",ci,[s("div",di,[e[15]||(e[15]=s("span",{class:"data-label"},"TTL:",-1)),s("span",ui,g(t.formattedTTL),1)]),o.module.created_at?(c(),d("div",gi,[e[16]||(e[16]=s("span",{class:"data-label"},"–°–æ–∑–¥–∞–Ω:",-1)),s("span",mi,g(t.formattedCreatedAt),1)])):k("",!0),o.module.expires_at?(c(),d("div",fi,[e[17]||(e[17]=s("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç:",-1)),s("span",{class:B(["data-value",t.expiresClass])},g(t.formattedExpiresAt),3)])):k("",!0)])]),s("div",hi,[s("div",vi,[s("span",{class:"section-icon","aria-label":t.cacheStateText,"aria-hidden":"false"},g(t.cacheStateIcon),9,pi),e[19]||(e[19]=s("h4",{class:"section-title"},"–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–µ—à–∞",-1))]),s("div",yi,[s("div",{class:B(["data-item cache-state-indicator",t.cacheStateClass])},[e[20]||(e[20]=s("span",{class:"data-label"},"–°—Ç–∞—Ç—É—Å:",-1)),s("span",_i,g(t.cacheStateText),1)],2)])]),o.module.metadata||o.module.created_at?(c(),d("div",bi,[e[29]||(e[29]=s("div",{class:"section-header"},[s("span",{class:"section-icon","aria-hidden":"true"},"‚ö°"),s("h4",{class:"section-title"},"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")],-1)),s("div",wi,[t.formattedCreationTime?(c(),d("div",Ci,[e[21]||(e[21]=s("span",{class:"data-label"},"–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:",-1)),s("span",{class:B(["data-value",t.creationTimeClass])},g(t.formattedCreationTime),3)])):k("",!0),t.formattedLastAccess?(c(),d("div",Si,[e[22]||(e[22]=s("span",{class:"data-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—Å—Ç—É–ø:",-1)),s("span",ki,g(t.formattedLastAccess),1)])):k("",!0),t.accessCount!==null?(c(),d("div",xi,[e[23]||(e[23]=s("span",{class:"data-label"},"–û–±—Ä–∞—â–µ–Ω–∏–π:",-1)),s("span",Ei,g(t.accessCount),1)])):k("",!0),t.cacheEfficiency?(c(),d("div",Mi,[e[24]||(e[24]=s("span",{class:"data-label"},"–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),s("span",{class:B(["data-value",t.cacheEfficiencyClass])},g(t.cacheEfficiency),3)])):k("",!0),t.dataFreshness?(c(),d("div",Ti,[e[25]||(e[25]=s("span",{class:"data-label"},"–°–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:",-1)),s("span",{class:B(["data-value",t.dataFreshnessClass])},g(t.dataFreshness),3)])):k("",!0),o.module.total_size?(c(),d("div",Ai,[e[26]||(e[26]=s("span",{class:"data-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:",-1)),s("span",Li,g(t.formatBytes(o.module.total_size)),1)])):k("",!0),o.module.ttl?(c(),d("div",Di,[e[27]||(e[27]=s("span",{class:"data-label"},"TTL:",-1)),s("span",Ii,g(t.formatTTL(o.module.ttl)),1)])):k("",!0),t.timeToExpiry!==null?(c(),d("div",Pi,[e[28]||(e[28]=s("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑:",-1)),s("span",{class:B(["data-value",t.timeToExpiryClass])},g(t.formatTimeToExpiry),3)])):k("",!0)])])):k("",!0)])]),s("div",{class:B(["card-actions",{"mobile-layout":t.isMobile}]),role:"group","aria-label":`–î–µ–π—Å—Ç–≤–∏—è —Å –∫–µ—à–µ–º ${o.module.name}`},[s("div",Ri,[q(a,{module:o.module,disabled:t.creating,onCreated:t.handleCacheCreated,onCreating:t.handleCreatingState,class:B({loading:t.creating})},null,8,["module","disabled","onCreated","onCreating","class"])]),s("div",Oi,[s("button",{onClick:e[0]||(e[0]=(...l)=>t.handleClear&&t.handleClear(...l)),onKeydown:[e[1]||(e[1]=ge((...l)=>t.handleClear&&t.handleClear(...l),["enter"])),e[2]||(e[2]=ge(ce((...l)=>t.handleClear&&t.handleClear(...l),["prevent"]),["space"]))],disabled:!t.canClear,class:B(["action-button clear-button",{disabled:!t.canClear,loading:t.clearing}]),"aria-label":t.clearButtonLabel,tabindex:"0"},[t.clearing?(c(),d("span",Fi,[...e[30]||(e[30]=[s("span",{class:"spinner"},null,-1),Y(" –û—á–∏—Å—Ç–∫–∞... ",-1)])])):t.isEmpty?(c(),d("span",Bi," üìÅ –ö–µ—à –ø—É—Å—Ç ")):(c(),d("span",zi," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å "))],42,Ui),t.canShowDetails?(c(),d("button",{key:0,onClick:e[3]||(e[3]=(...l)=>t.showDetails&&t.showDetails(...l)),onKeydown:[e[4]||(e[4]=ge((...l)=>t.showDetails&&t.showDetails(...l),["enter"])),e[5]||(e[5]=ge(ce((...l)=>t.showDetails&&t.showDetails(...l),["prevent"]),["space"]))],class:"action-button details-button","aria-label":`–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞ ${o.module.name}`,title:"–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞",tabindex:"0"}," üìä ",40,ji)):k("",!0)])],10,Ni),(c(),K(nt,{to:"body"},[t.showDetailModal?(c(),d("div",{key:0,class:"detail-modal-overlay",onClick:e[9]||(e[9]=ce((...l)=>t.closeDetails&&t.closeDetails(...l),["self"])),onKeydown:e[10]||(e[10]=ge((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))},[s("div",Wi,[s("div",$i,[s("h3",null,"–î–µ—Ç–∞–ª–∏ –∫–µ—à–∞: "+g(o.module.name),1),s("button",{onClick:e[6]||(e[6]=(...l)=>t.closeDetails&&t.closeDetails(...l)),onKeydown:[e[7]||(e[7]=ge((...l)=>t.closeDetails&&t.closeDetails(...l),["enter"])),e[8]||(e[8]=ge((...l)=>t.closeDetails&&t.closeDetails(...l),["escape"]))],class:"close-button","aria-label":"–ó–∞–∫—Ä—ã—Ç—å",tabindex:"0"}," ‚úï ",32)]),s("div",Vi,[s("pre",Xi,g(JSON.stringify(o.module,null,2)),1)])])],32)):k("",!0)]))],10,Vr)}const Hi=$($r,[["render",qi],["__scopeId","data-v-bc59cd77"]]),Ji={name:"CacheStats",props:{modules:{type:Array,required:!1,default:()=>[]}},setup(n){console.log("[CacheStats] setup called with modules:",n.modules);const e=b(()=>n.modules||[]),o=b(()=>{console.log("[CacheStats] Computing primaryModules, total modules:",e.value?.length||0);const x=e.value.filter(A=>W.PRIMARY_MODULE_IDS.includes(A.id));return console.log("[CacheStats] Primary modules count:",x.length),x}),t=b(()=>{console.log("[CacheStats] Computing secondaryModules, total modules:",e.value?.length||0);const x=e.value.filter(A=>!W.PRIMARY_MODULE_IDS.includes(A.id));return console.log("[CacheStats] Secondary modules count:",x.length),x}),r=b(()=>o.value?.length||0),i=b(()=>t.value?.length||0),a=b(()=>e.value?.length||0),l=b(()=>e.value.reduce((x,A)=>x+(A.file_count||0),0)),m=b(()=>(n.modules||[]).reduce((x,A)=>x+(A.total_size||0),0)),f=b(()=>W.formatCacheSize(m.value)),C=b(()=>{const x=n.modules||[];if(x.length===0)return"0 –º–∏–Ω";const A=x.reduce((u,M)=>u+(M.ttl||0),0),S=Math.round(A/x.length);return W.formatTTL(S)}),p=b(()=>(e.value||[]).filter(x=>x.status==="active").length),L=b(()=>{if((i.value||0)===0)return[];const x={};(t.value||[]).forEach(S=>{const u=W.getModuleType(S.id);if(!x[u]){const M=W.getModuleTypeConfig(u);x[u]={type:u,title:M.title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞",icon:E(u),count:0}}x[u].count++});const A=i.value||0;return Object.values(x).map(S=>({...S,percentage:A>0?Math.round(S.count/A*100):0})).sort((S,u)=>u.count-S.count)}),E=x=>{const A={users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"};return A[x]||A.other};return{modules:e,primaryModulesCount:r,secondaryModulesCount:i,totalModules:a,totalFiles:l,totalSizeFormatted:f,avgTTL:C,activeModules:p,groupStats:L}}},Ki={key:0,class:"cache-stats"},Yi={class:"stats-overview"},Gi={class:"overview-grid"},Qi={class:"overview-card primary"},Zi={class:"overview-content"},el={class:"overview-value"},tl={class:"overview-card secondary"},ol={class:"overview-content"},nl={class:"overview-value"},sl={class:"overview-card total"},al={class:"overview-content"},rl={class:"overview-value"},il={class:"detailed-stats"},ll={class:"stats-grid"},cl={class:"stat-card"},dl={class:"stat-content"},ul={class:"stat-value"},gl={class:"stat-card"},ml={class:"stat-content"},fl={class:"stat-value"},hl={class:"stat-card"},vl={class:"stat-content"},pl={class:"stat-value"},yl={class:"stat-card"},_l={class:"stat-content"},bl={class:"stat-value"},wl={key:0,class:"group-distribution"},Cl={class:"distribution-grid"},Sl={class:"group-icon"},kl={class:"group-info"},xl={class:"group-name"},El={class:"group-count"},Ml={class:"group-percentage"},Tl={key:1,class:"cache-stats-loading"};function Al(n,e,o,t,r,i){return(t.modules||[]).length>0?(c(),d("div",Ki,[e[18]||(e[18]=s("h2",{class:"stats-title"},"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",-1)),s("div",Yi,[s("div",Gi,[s("div",Qi,[e[2]||(e[2]=s("div",{class:"overview-icon"},"üèÜ",-1)),s("div",Zi,[s("div",el,g(t.primaryModulesCount),1),e[0]||(e[0]=s("div",{class:"overview-label"},"–û—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[1]||(e[1]=s("div",{class:"overview-desc"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ",-1))])]),s("div",tl,[e[5]||(e[5]=s("div",{class:"overview-icon"},"üîß",-1)),s("div",ol,[s("div",nl,g(t.secondaryModulesCount),1),e[3]||(e[3]=s("div",{class:"overview-label"},"–ü–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[4]||(e[4]=s("div",{class:"overview-desc"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),s("div",sl,[e[8]||(e[8]=s("div",{class:"overview-icon"},"üì¶",-1)),s("div",al,[s("div",rl,g(t.totalModules),1),e[6]||(e[6]=s("div",{class:"overview-label"},"–í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π",-1)),e[7]||(e[7]=s("div",{class:"overview-desc"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö",-1))])])])]),s("div",il,[s("div",ll,[s("div",cl,[e[10]||(e[10]=s("div",{class:"stat-icon"},"üìÑ",-1)),s("div",dl,[s("div",ul,g(t.totalFiles),1),e[9]||(e[9]=s("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤",-1))])]),s("div",gl,[e[12]||(e[12]=s("div",{class:"stat-icon"},"üíæ",-1)),s("div",ml,[s("div",fl,g(t.totalSizeFormatted),1),e[11]||(e[11]=s("div",{class:"stat-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä",-1))])]),s("div",hl,[e[14]||(e[14]=s("div",{class:"stat-icon"},"‚è±Ô∏è",-1)),s("div",vl,[s("div",pl,g(t.avgTTL),1),e[13]||(e[13]=s("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–∏–π TTL",-1))])]),s("div",yl,[e[16]||(e[16]=s("div",{class:"stat-icon"},"‚ö°",-1)),s("div",_l,[s("div",bl,g(t.activeModules),1),e[15]||(e[15]=s("div",{class:"stat-label"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–µ—à–µ–π",-1))])])])]),t.secondaryModulesCount>0?(c(),d("div",wl,[e[17]||(e[17]=s("h3",{class:"distribution-title"},"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),s("div",Cl,[(c(!0),d(H,null,J(t.groupStats,a=>(c(),d("div",{key:a.type,class:"distribution-item"},[s("div",Sl,g(a.icon),1),s("div",kl,[s("div",xl,g(a.title),1),s("div",El,g(a.count)+" –º–æ–¥—É–ª–µ–π",1)]),s("div",Ml,g(a.percentage)+"%",1)]))),128))])])):k("",!0)])):(c(),d("div",Tl,[...e[19]||(e[19]=[s("p",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])]))}const Ll=$(Ji,[["render",Al],["__scopeId","data-v-9fa190bb"]]),Dl={name:"CacheManagement",components:{CacheModuleCard:Hi,CacheStats:Ll},setup(){const n=w([]),e=w([]),o=w(!0),t=w(null),r=w(!1),i=b(()=>(n.value?.length||0)+(e.value?.length||0)),a=b(()=>{const u=l.value?.length||0,M=(m.value?.length||0)>0?1:0;return u+M}),l=b(()=>{const u=(n.value||[]).filter(M=>!M.id.includes("time-tracking"));return console.log("[CacheManagement] individualPrimaryModules:",u.length,u.map(M=>M.id)),u}),m=b(()=>{const u=(n.value||[]).filter(M=>M.id.includes("time-tracking")).sort((M,R)=>{const z=["time-tracking-default","time-tracking-detailed","time-tracking-summary"];return z.indexOf(M.id)-z.indexOf(R.id)});return console.log("[CacheManagement] timeTrackingModules:",u.length,u.map(M=>M.id)),u}),f=b(()=>{const u={};return(e.value||[]).forEach(R=>{const z=W.getModuleType(R.id);u[z]||(u[z]={type:z,title:p(z),modules:[]}),u[z].modules.push(R)}),Object.values(u).sort((R,z)=>{const F=["users","activity","webhooks","other"],D=F.indexOf(R.type),v=F.indexOf(z.type);return(D===-1?999:D)-(v===-1?999:v)})}),C=async()=>{o.value=!0,t.value=null;try{const u=await W.getCacheStatus();n.value=u.primaryModules||[],e.value=u.secondaryModules||[],console.log("[CacheManagement] Primary modules:",n.value.length,n.value.map(M=>({id:M.id,name:M.name}))),console.log("[CacheManagement] Secondary modules:",e.value.length,e.value.map(M=>({id:M.id,name:M.name})))}catch(u){console.error("[CacheManagement] Error loading modules:",u),t.value=u.message}finally{o.value=!1}},p=u=>{const M={users:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",activity:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",webhooks:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",other:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏"};return M[u]||M.other},L=async u=>{console.log(`[CacheManagement] Clearing module: ${u}`),W.invalidateCacheAfterModuleOperation(),await C()},E=async()=>{console.log("[CacheManagement] Clearing all cache"),r.value=!0;try{await W.clearCache("all"),W.invalidateCacheAfterModuleOperation(),oe.success("–ö–µ—à –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω","–í—Å–µ —Ñ–∞–π–ª—ã –∫–µ—à–∞ –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã"),await C()}catch(u){console.error("[CacheManagement] Error clearing all cache:",u),oe.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à: ${u.message}`)}finally{r.value=!1}},x=async u=>{console.log(`[CacheManagement] Creating cache for: ${u.name} (${u.id})`),alert(`–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${u.name}
ID: ${u.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},A=async u=>{console.log(`[CacheManagement] Clearing cache for: ${u.name} (${u.id})`),alert(`–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${u.name}
ID: ${u.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},S=()=>{C()};return ne(()=>{C()}),{primaryModules:n,secondaryModules:e,loading:o,error:t,totalModules:i,groupedSecondaryModules:f,individualPrimaryModules:l,timeTrackingModules:m,logicalPrimaryCount:a,clearingAll:r,handleModuleClear:L,handleClearAllCache:E,handleCreateMock:x,handleClearMock:A,refreshModules:S}}},Il={class:"cache-management"},Pl={key:0,class:"header-section"},Nl={class:"stats-bar"},Rl={class:"stat-item"},Ol={class:"stat-item"},Ul={class:"stat-item"},Fl={key:0,class:"global-actions"},Bl=["disabled"],zl={key:0},jl={key:1},Wl={class:"section-header"},$l={class:"section-meta"},Vl={class:"module-count","aria-label":"{{ logicalPrimaryCount }} –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},Xl={key:0,class:"modules-container"},ql={key:0,class:"modules-grid"},Hl={key:1,class:"time-tracking-group"},Jl={class:"modules-grid"},Kl={key:1,class:"empty-state"},Yl={key:2,class:"section-divider"},Gl={key:3,class:"cache-section secondary-modules","aria-labelledby":"secondary-modules-heading"},Ql={class:"section-header"},Zl={class:"section-meta"},ec={class:"module-count","aria-label":"{{ (secondaryModules || []).length }} –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},tc={class:"grouped-modules"},oc={class:"group-header"},nc={class:"group-title"},sc={class:"group-badge secondary"},ac={class:"modules-grid"},rc={key:4,class:"error-message",role:"alert","aria-live":"assertive"},ic={key:5,class:"loading-overlay",role:"status","aria-live":"polite","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"};function lc(n,e,o,t,r,i){const a=V("CacheModuleCard");return c(),d("div",Il,[!t.loading&&!t.error?(c(),d("div",Pl,[e[6]||(e[6]=s("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1)),e[7]||(e[7]=s("p",{class:"description"}," –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º —Å–∏—Å—Ç–µ–º—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è ",-1)),s("div",Nl,[s("span",Rl,[s("strong",null,g(t.totalModules),1),e[3]||(e[3]=Y(" –≤—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π ",-1))]),s("span",Ol,[s("strong",null,g(t.logicalPrimaryCount),1),e[4]||(e[4]=Y(" –æ—Å–Ω–æ–≤–Ω—ã—Ö ",-1))]),s("span",Ul,[s("strong",null,g((t.secondaryModules||[]).length),1),e[5]||(e[5]=Y(" –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ",-1))])]),!t.loading&&!t.error?(c(),d("div",Fl,[s("button",{onClick:e[0]||(e[0]=(...l)=>t.handleClearAllCache&&t.handleClearAllCache(...l)),disabled:t.clearingAll,class:B(["btn-clear-all",{"btn-disabled":t.clearingAll}])},[t.clearingAll?(c(),d("span",zl,"üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫–µ—à–∞...")):(c(),d("span",jl,"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à"))],10,Bl)])):k("",!0)])):k("",!0),!t.loading&&!t.error?(c(),d("section",{key:1,class:B(["cache-section primary-modules",{empty:(t.primaryModules||[]).length===0}]),"aria-labelledby":"primary-modules-heading"},[s("div",Wl,[e[9]||(e[9]=s("h2",{id:"primary-modules-heading"},"üèÜ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),s("div",$l,[s("span",Vl,g(t.logicalPrimaryCount),1),e[8]||(e[8]=s("span",{class:"section-badge primary",role:"status","aria-label":"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",-1))])]),e[13]||(e[13]=s("p",{class:"section-description"}," 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã: –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°, –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏–µ–º–∞-–∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°. ",-1)),(t.primaryModules||[]).length>0?(c(),d("div",Xl,[t.individualPrimaryModules.length>0?(c(),d("div",ql,[(c(!0),d(H,null,J(t.individualPrimaryModules,l=>(c(),d("div",{key:l.id,class:"module-wrapper"},[q(a,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])):k("",!0),(t.timeTrackingModules||[]).length>0?(c(),d("div",Hl,[e[10]||(e[10]=s("div",{class:"group-header"},[s("h3",{class:"group-title"},"‚è±Ô∏è –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"),s("span",{class:"group-badge"},"–û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞")],-1)),e[11]||(e[11]=s("p",{class:"group-description"},"–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),s("div",Jl,[(c(!0),d(H,null,J(t.timeTrackingModules,l=>(c(),d("div",{key:l.id,class:"module-wrapper"},[q(a,{module:l,"is-primary":!0,priority:l.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])])):k("",!0)])):(c(),d("div",Kl,[e[12]||(e[12]=s("p",null,"‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)),s("button",{onClick:e[1]||(e[1]=(...l)=>t.refreshModules&&t.refreshModules(...l)),class:"refresh-btn"},"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫")]))],2)):k("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("div",Yl,[...e[14]||(e[14]=[It('<div class="divider-line" data-v-6a4e8216></div><div class="divider-content" data-v-6a4e8216><span class="divider-icon" data-v-6a4e8216>üîß</span><span class="divider-text" data-v-6a4e8216>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏</span><span class="divider-subtitle" data-v-6a4e8216>–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</span></div><div class="divider-line" data-v-6a4e8216></div>',3)])])):k("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("section",Gl,[s("div",Ql,[e[16]||(e[16]=s("h2",{id:"secondary-modules-heading"},"üîß –ü–æ–±–æ—á–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),s("div",Zl,[s("span",ec,g((t.secondaryModules||[]).length),1),e[15]||(e[15]=s("span",{class:"section-badge secondary",role:"status","aria-label":"–°–ª—É–∂–µ–±–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),e[17]||(e[17]=s("p",{class:"section-description"}," –ú–æ–¥—É–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã. ",-1)),s("div",tc,[(c(!0),d(H,null,J(t.groupedSecondaryModules,l=>(c(),d("div",{key:l.type,class:B(["module-group",`group-${l.type}`])},[s("div",oc,[s("h3",nc,g(l.title),1),s("span",sc,g(l.modules.length),1)]),s("div",ac,[(c(!0),d(H,null,J(l.modules,m=>(c(),d("div",{key:m.id,class:"module-wrapper"},[q(a,{module:m,"is-primary":!1,"group-type":l.type,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","group-type","onClear","onRefresh"])]))),128))])],2))),128))])])):k("",!0),t.error?(c(),d("div",rc,[e[18]||(e[18]=s("h3",null,"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞",-1)),s("p",null,g(t.error),1),s("button",{onClick:e[2]||(e[2]=(...l)=>n.loadModules&&n.loadModules(...l)),class:"retry-btn","aria-label":"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):k("",!0),t.loading?(c(),d("div",ic,[...e[19]||(e[19]=[s("div",{class:"loading-spinner","aria-hidden":"true"},null,-1),s("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞...",-1)])])):k("",!0)])}const cc=$(Dl,[["render",lc],["__scopeId","data-v-6a4e8216"]]),dc={name:"CacheManagementPage",components:{CacheManagement:cc},beforeCreate(){console.log("[CacheManagementPage] beforeCreate() called")},created(){console.log("[CacheManagementPage] created() called")},beforeMount(){console.log("[CacheManagementPage] beforeMount() called")},setup(){console.log("[CacheManagementPage] setup() called with new hierarchical UI");const n=Ae(),e=w(!1),o=w(null),t=()=>{n.push({name:"index"})};return ne(()=>{console.log("[CacheManagementPage] onMounted() called - hierarchical cache management ready")}),{loading:e,error:o,goBack:t}}},uc={class:"cache-management-page"},gc={class:"page-header"},mc={class:"page-header-top"},fc={key:0,class:"loading"},hc={key:1,class:"error"},vc={key:2,class:"cache-content"};function pc(n,e,o,t,r,i){const a=V("CacheManagement");return c(),d("div",uc,[s("div",gc,[s("div",mc,[s("button",{onClick:e[0]||(e[0]=(...l)=>t.goBack&&t.goBack(...l)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[s("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),s("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=s("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1))]),t.loading?(c(),d("div",fc," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–µ—à–∞... ")):t.error?(c(),d("div",hc,g(t.error),1)):(c(),d("div",vc,[q(a)]))])}const yc=$(dc,[["render",pc],["__scopeId","data-v-a20ded38"]]),_c=[{path:"/install",name:"install",component:uo},{path:"/",name:"index",component:Go},{path:"/webhook-logs",name:"webhook-logs",redirect:"/admin/webhook-logs"},{path:"/admin/webhook-logs",name:"admin-webhook-logs",component:nr,meta:{requiresAuth:!0,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",adminOnly:!0}},{path:"/admin/users",name:"admin-users",component:fr,meta:{requiresAuth:!0,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",adminOnly:!0}},{path:"/admin/cache",name:"admin-cache",component:yc,meta:{requiresAuth:!0,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",adminOnly:!0}},{path:"/dashboard/sector-1c",name:"dashboard-sector-1c",component:()=>te(()=>import("./DashboardSector1C.vue-BpZ3ysb7.js"),__vite__mapDeps([9,4,10,11,12,5,2,1,13]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector1c"}},{path:"/dashboard/graph-admission-closure",name:"dashboard-graph-admission-closure",component:()=>te(()=>import("./GraphAdmissionClosureDashboard.vue-DQq2wFpc.js"),__vite__mapDeps([14,4,15,12,5,2,1,11,16,10]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–æ–≤—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",requiresAuth:!0,chunk:"admission-dashboard"}},{path:"/dashboard/graph-state",name:"dashboard-graph-state",component:()=>te(()=>import("./GraphStateDashboard.vue-CJsvE2ym.js"),__vite__mapDeps([17,4,1,13,12,5,2,11,10,15]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏",requiresAuth:!0,chunk:"graph-state"}},{path:"/dashboard/tickets-time-tracking",name:"dashboard-tickets-time-tracking",component:()=>te(()=>import("./TicketsTimeTrackingDashboard.vue-DDJDXg_b.js"),__vite__mapDeps([18,4,1,5,2]),import.meta.url),meta:{title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",requiresAuth:!0,chunk:"tickets-tracking"}}],$e=Pt({history:Nt(),routes:_c});$e.beforeEach(async(n,e,o)=>{if(console.log("[Router] beforeEach:",{to:n.path,from:e.path,name:n.name}),n.meta.title&&(document.title=`${n.meta.title} - Bitrix24 Dashboard`),n.meta.requiresAuth){console.log("[Router] requiresAuth check for:",n.path);try{const t=await Ce.checkAccess();if(!t.allowed){console.warn("Unauthorized access attempt to:",n.path,t.errorMessage),o({name:"index"});return}}catch(t){console.error("Error checking access in navigation guard:",t),o();return}}if(n.meta.adminOnly)try{const t=await Ce.getCurrentUser();if(!t||!Ct(t)){console.warn("Admin access required for:",n.path),o({name:"index"});return}}catch(t){console.error("Error checking admin access in navigation guard:",t),o({name:"index"});return}if(e.name!==null&&n.path!==e.path)try{if((await Ce.checkAccess()).allowed){const r=await Ce.getCurrentUser();r&&ze.logPageVisit(n,r,e).catch(i=>{console.error("[Router] Error logging page visit:",i)})}}catch(t){console.error("[Router] Error in activity logging:",t)}if(n.name==="index"&&!e.name&&setTimeout(()=>{te(()=>import("./DashboardSector1C.vue-BpZ3ysb7.js"),__vite__mapDeps([9,4,10,11,12,5,2,1,13]),import.meta.url)},1e3),n.meta.chunk)switch(n.meta.chunk){case"dashboard-sector1c":setTimeout(()=>{te(()=>import("./dashboard-sector-1c-service-BjTk5SI3.js"),__vite__mapDeps([16,12,5,2,1,11]),import.meta.url)},500);break;case"admission-dashboard":setTimeout(()=>{te(()=>import("./chunk-D-aTIMKk.js").then(t=>t.l),__vite__mapDeps([2,1]),import.meta.url)},500);break}console.log("[Router] Allowing navigation to:",n.path),o()});setTimeout(()=>{const n=window.location.pathname,e=window.location.hash;e&&e!=="#/"||(n.includes("install.php")?$e.replace("/install"):$e.replace("/"))},0);Ne.register(Rt,Ot,Ut,Ft,Bt,zt,jt,Wt,$t,Vt);Ne.defaults.responsive=!0;Ne.defaults.maintainAspectRatio=!1;Ne.defaults.plugins.legend.display=!0;Ne.defaults.plugins.legend.position="top";const Tc={primary:"#007bff",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8",carryover:"#ff9800",successLight:"#6cbf47",carryoverLight:"#ffb74d",carryoverDark:"#f57c00"};class We{static startBundleLoad(){this.metrics.bundleLoadTime=performance.now()}static endBundleLoad(e){const o=performance.now()-this.metrics.bundleLoadTime;this.metrics.chunkLoadTimes.set(e,o),console.log(`üì¶ Chunk "${e}" loaded in ${o.toFixed(2)}ms`),window.gtag&&window.gtag("event","bundle_load",{chunk_name:e,load_time:o}),o>1e3&&console.warn(`üêå Slow chunk load: ${e} took ${o.toFixed(2)}ms`)}static trackComponentLoad(e,o){const t=performance.now()-o;this.metrics.componentLoadTime.set(e,t),console.log(`üß© Component "${e}" loaded in ${t.toFixed(2)}ms`),t>500&&console.warn(`üêå Slow component load: ${e} took ${t.toFixed(2)}ms`)}static trackApiCall(e,o){this.metrics.apiResponseTime.set(e,o),o>1e3&&console.warn(`üêå Slow API call to ${e}: ${o}ms`)}static getReport(){const e=Array.from(this.metrics.componentLoadTime.values()),o=Array.from(this.metrics.apiResponseTime.values()),t=Array.from(this.metrics.chunkLoadTimes.values());return{totalChunks:this.metrics.chunkLoadTimes.size,totalComponents:this.metrics.componentLoadTime.size,totalApiCalls:this.metrics.apiResponseTime.size,averageComponentLoadTime:e.length>0?e.reduce((r,i)=>r+i,0)/e.length:0,averageApiResponseTime:o.length>0?o.reduce((r,i)=>r+i,0)/o.length:0,averageChunkLoadTime:t.length>0?t.reduce((r,i)=>r+i,0)/t.length:0,slowestComponents:Array.from(this.metrics.componentLoadTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i})),slowestApiCalls:Array.from(this.metrics.apiResponseTime.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({endpoint:r,time:i})),slowestChunks:Array.from(this.metrics.chunkLoadTimes.entries()).sort(([,r],[,i])=>i-r).slice(0,5).map(([r,i])=>({name:r,time:i}))}}static clearMetrics(){this.metrics.bundleLoadTime=0,this.metrics.componentLoadTime.clear(),this.metrics.apiResponseTime.clear(),this.metrics.chunkLoadTimes.clear()}}ve(We,"metrics",{bundleLoadTime:0,componentLoadTime:new Map,apiResponseTime:new Map,chunkLoadTimes:new Map});class bc{static init(){this.initChunkLoadErrorHandling(),this.initUnhandledErrorHandling(),this.initNetworkErrorHandling()}static initChunkLoadErrorHandling(){if(window.addEventListener("error",e=>{e.target.tagName==="SCRIPT"&&(console.error("‚ùå Chunk loading error:",e.target.src),this.reportError("chunk_load_error",{url:e.target.src,message:e.message||"Script load failed"}))}),"PerformanceObserver"in window)try{new PerformanceObserver(o=>{for(const t of o.getEntries())if(t.entryType==="resource"&&t.name.includes(".js")){const r=t.responseEnd-t.requestStart;We.trackApiCall(t.name,r)}}).observe({entryTypes:["resource"]})}catch{console.warn("PerformanceObserver not supported")}}static initUnhandledErrorHandling(){window.addEventListener("unhandledrejection",e=>{console.error("‚ùå Unhandled promise rejection:",e.reason),this.reportError("unhandled_rejection",{reason:e.reason?.message||String(e.reason),stack:e.reason?.stack})}),window.addEventListener("error",e=>{e.error&&e.filename&&(console.error("‚ùå Unhandled error:",e.error),this.reportError("unhandled_error",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error.stack}))})}static initNetworkErrorHandling(){const e=window.fetch;window.fetch=function(...o){const t=performance.now();return e.apply(this,o).then(r=>{const i=performance.now()-t;return We.trackApiCall(o[0],i),r.ok||console.warn(`üö® API error: ${r.status} ${r.statusText} for ${o[0]}`),r}).catch(r=>{const i=performance.now()-t;throw console.error(`‚ùå Network error for ${o[0]}:`,r),We.trackApiCall(o[0],i),this.reportError("network_error",{url:o[0],message:r.message,loadTime:i}),r})}}static reportError(e,o){const t={type:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...o};if(console.error("üìä Error report:",t),window.Sentry&&window.Sentry.captureException(new Error(`${e}: ${JSON.stringify(o)}`)),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:"/api/log-error.php",method:"POST",data:t})}catch(r){console.error("Failed to send error report to Bitrix24:",r)}window.gtag&&window.gtag("event","exception",{description:`${e}: ${o.message||"Unknown error"}`,fatal:!1})}static getErrorStats(){return{chunkLoadErrors:0,networkErrors:0,unhandledErrors:0,totalErrors:0}}}const it=Xt(Kt);it.use($e);const wc=n=>{try{const e=new WeakSet;return JSON.stringify(n,(o,t)=>{if(typeof t=="object"&&t!==null){if(e.has(t))return"[Circular]";e.add(t)}return typeof t=="function"||t===void 0?null:t})}catch{return String(n)}};it.config.errorHandler=(n,e,o)=>{if(n instanceof TypeError&&n.message.includes("Cannot read properties of undefined (reading 'type')")){console.warn("Caught undefined.type error:",{error:n.message,component:e?.$options?.name||"Unknown",info:o,stack:n.stack});return}if(console.error("Vue error:",n,o),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:me("/api/log-error.php"),method:"POST",data:{error:n?.message||String(n),info:typeof o=="string"?o:wc(o),component:e?.$options?.name||"Unknown"}})}catch(t){console.error("Failed to log error:",t)}};it.mount("#app");bc.init();export{Ce as A,je as C,bt as L,_t as S,$ as _,ke as a,_e as b,Tc as c,he as d,Zo as e,Te as f,at as g,Mc as h,Ct as i,Me as n,kt as u};
