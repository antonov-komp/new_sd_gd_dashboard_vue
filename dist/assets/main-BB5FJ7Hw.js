const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./direct-access-config-DhKxYe1L.js","./chunk-B8ocRDN3.js","./chunk-C5D5xwuQ.js","./access-config-async-ld3N8LW9.js","./chunk-q4E_n_Zn.js","./WebhookLogsDashboard.vue-C6UkRP7A.js","./WebhookLogDetails.vue-otR-m5BI.js","./DashboardSector1C.vue-C4Tidfp_.js","./chunk-CbrOiYsv.js","./chunk-CWOGIwxH.js","./chunk-CWtDQCGE.js","./GraphAdmissionClosureDashboard.vue-BxpL3HP_.js","./chunk-CAFW8TWe.js","./dashboard-sector-1c-service--7Y0mDSl.js","./GraphStateDashboard.vue-BC2P0S9w.js","./TicketsTimeTrackingDashboard.vue-DpPpUCPb.js"])))=>i.map(i=>d[i]);
var Ct=Object.defineProperty;var St=(o,e,s)=>e in o?Ct(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var he=(o,e,s)=>St(o,typeof e!="symbol"?e+"":e,s);import{r as B,c as d,o as c,a as W,b as k,d as kt,t as g,n as $,e as n,f as J,g as C,h as ee,w as oe,i as H,F as z,j as V,k as fe,l as A,u as Ee,m as Z,p as Et,T as de,q as X,v as xe,s as Qe,x as Ae,y as pe,z as Je,A as ye,B as Ne,C as At,D as Tt,E as Ze,G as Lt,H as xt,I as It,J as Te,K as Mt,L as Dt,P as Pt,M as Ut,N as Nt,O as Rt,Q as Ft,R as Ot,S as Bt,U as $t,V as jt}from"./chunk-q4E_n_Zn.js";import{a as et,_ as te,g as ie}from"./chunk-B8ocRDN3.js";import{B as je}from"./chunk-C5D5xwuQ.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();const F=(o,e)=>{const s=o.__vccOpts||o;for(const[t,a]of e)s[t]=a;return s},Wt={name:"App"},zt={id:"app"};function Vt(o,e,s,t,a,i){const r=B("router-view");return c(),d("div",zt,[W(r)])}const qt=F(Wt,[["render",Vt]]),Ht={name:"StatusMessage",props:{type:{type:String,required:!0,validator:o=>["success","error","info","warning"].includes(o)},title:{type:String,default:null},message:{type:String,default:null}}},Xt={key:0},Jt={key:1};function Kt(o,e,s,t,a,i){return c(),d("div",{class:$(["status-message",`status-message--${s.type}`])},[s.title?(c(),d("strong",Xt,g(s.title),1)):k("",!0),s.message?(c(),d("p",Jt,g(s.message),1)):k("",!0),kt(o.$slots,"default",{},void 0)],2)}const tt=F(Ht,[["render",Kt],["__scopeId","data-v-7f15d2d7"]]),Yt={name:"LoadingSpinner",props:{message:{type:String,default:"–ó–∞–≥—Ä—É–∑–∫–∞..."}}},Gt={class:"loading-spinner"},Qt={key:0,class:"message"};function Zt(o,e,s,t,a,i){return c(),d("div",Gt,[e[0]||(e[0]=n("div",{class:"spinner"},null,-1)),s.message?(c(),d("p",Qt,g(s.message),1)):k("",!0)])}const st=F(Yt,[["render",Zt],["__scopeId","data-v-375eac16"]]);function we(){try{if(window.self===window.top)return!1;if(typeof BX24<"u")return!0;try{const o=window.parent.location.origin;return o.includes("bitrix24")||o.includes("kompo.by")}catch{return!1}}catch(o){return console.warn("Error checking Bitrix24 context:",o),!1}}function es(){return typeof BX24<"u"}class ue{static init(e){return new Promise((s,t)=>{if(!we()){console.log("Not inside Bitrix24, skipping BX24.init()"),e&&e(),s();return}if(typeof BX24>"u"){t(new Error("Bitrix24 API not loaded. Make sure script is included: //api.bitrix24.com/api/v1/"));return}const a=setTimeout(()=>{t(new Error("BX24.init() timeout: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥"))},5e3);try{BX24.init(()=>{clearTimeout(a),e&&e(),s()})}catch(i){clearTimeout(a),t(i)}})}static installFinish(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}try{BX24.installFinish(),e()}catch(t){s(t)}})}static callMethod(e,s={}){return new Promise((t,a)=>{if(typeof BX24>"u"){a(new Error("Bitrix24 API not loaded"));return}const i=setTimeout(()=>{a(new Error(`BX24.callMethod(${e}) timeout: –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—ã—Å–∏–ª 10 —Å–µ–∫—É–Ω–¥`))},1e4);try{BX24.callMethod(e,s,r=>{if(clearTimeout(i),r.error()){const l=r.error();a(new Error(l.error_description||l.error||"Unknown error"))}else t(r.data())})}catch(r){clearTimeout(i),a(r)}})}static async getCurrentUser(){if(we()&&es())try{const e=await Promise.race([this.callMethod("user.current",{}),new Promise((s,t)=>setTimeout(()=>t(new Error("Timeout")),5e3))]);return console.log("Got user from BX24.callMethod() (interface user):",e?.ID||"unknown"),e}catch(e){console.warn("BX24.callMethod() failed, using proxy API as fallback:",e);try{const s=await je.getCurrentUser();return console.log("Got user from proxy API (token owner, fallback):",s),s}catch(s){throw console.error("Both BX24 API and proxy API failed:",s),e.message&&e.message.includes("timeout")?new Error("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Bitrix24 API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç."):new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}else return console.warn("Not inside Bitrix24, using proxy API (will return token owner, not interface user)"),await je.getCurrentUser()}static getUser(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}if(typeof BX24.getUser!="function"){s(new Error("BX24.getUser is not available"));return}BX24.getUser(t=>{e(t)})})}static getAuth(){return new Promise((e,s)=>{if(typeof BX24>"u"){s(new Error("Bitrix24 API not loaded"));return}BX24.getAuth(t=>{e(t)})})}}const ts={name:"InstallPage",components:{StatusMessage:tt,LoadingSpinner:st},setup(){const o=C(!0),e=C(null),s=C(null);return ee(async()=>{try{let t=null;if(window.INSTALL_RESULT)t=window.INSTALL_RESULT;else{const a=et("/install.php"),i=await fetch(`${a}?get_result=1`);i.ok&&(t=await i.json())}if(!t)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏");if(s.value=t,t.rest_only===!1)if(t.install===!0){e.value={type:"success",title:"‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!",message:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24."};try{await ue.init(()=>{ue.installFinish()})}catch(a){console.error("Error finishing installation:",a)}}else e.value={type:"error",title:"‚úó –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."};else e.value={type:"info",title:"REST-only —Ä–µ–∂–∏–º",message:"–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ REST API, –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."}}catch(t){console.error("Error loading install result:",t),e.value={type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ."}}finally{o.value=!1}}),{loading:o,installStatus:e,installInfo:s}}},ss={class:"install-page"},os={class:"container"},ns={key:1,class:"info"};function rs(o,e,s,t,a,i){const r=B("StatusMessage"),l=B("LoadingSpinner");return c(),d("div",ss,[n("div",os,[e[1]||(e[1]=n("h1",null,"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1)),t.installStatus?(c(),J(r,{key:0,type:t.installStatus.type,title:t.installStatus.title,message:t.installStatus.message},null,8,["type","title","message"])):k("",!0),t.installInfo?(c(),d("div",ns,[e[0]||(e[0]=n("h3",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:",-1)),n("pre",null,g(JSON.stringify(t.installInfo,null,2)),1)])):k("",!0),t.loading?(c(),J(l,{key:2,message:"–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."})):k("",!0)])])}const as=F(ts,[["render",rs],["__scopeId","data-v-d082ec9e"]]),_e={allowedDepartmentIds:[369,366,7],adminDepartmentIds:[369]};function ot(o){return!o||typeof o!="number"?!1:_e.allowedDepartmentIds.includes(o)}function nt(o){if(!o||!o.UF_DEPARTMENT)return!1;const e=Array.isArray(o.UF_DEPARTMENT)?o.UF_DEPARTMENT:[];return e.length===0?!1:e.some(s=>_e.adminDepartmentIds.includes(s))}const ae={USER_NOT_DETERMINED:"USER_NOT_DETERMINED",ACCESS_DENIED:"ACCESS_DENIED",API_ERROR:"API_ERROR"};class le{constructor(e,s=null,t=null,a=null){this.allowed=e,this.errorCode=s,this.errorMessage=t,this.user=a}}class ve{static async checkAccess(){try{const e=we();if(console.log("AccessControlService.checkAccess - isInsideBitrix24:",e),console.log("AccessControlService.checkAccess - window.self === window.top:",window.self===window.top),console.log("AccessControlService.checkAccess - typeof BX24:",typeof BX24),e)console.log("AccessControlService.checkAccess - Inside Bitrix24, skipping direct access check");else{console.log("AccessControlService.checkAccess - Not inside Bitrix24, checking direct access config...");const{isDirectAccessAllowed:i,getDenyMessage:r}=await te(async()=>{const{isDirectAccessAllowed:u,getDenyMessage:m}=await import("./direct-access-config-DhKxYe1L.js");return{isDirectAccessAllowed:u,getDenyMessage:m}},__vite__mapDeps([0,1]),import.meta.url),l=await i();if(console.log("AccessControlService.checkAccess - allowDirectAccess:",l),!l){const u=await r();return console.warn("Direct access denied: Application opened directly in browser, but direct access is disabled in config"),console.warn("Deny message:",u),new le(!1,ae.ACCESS_DENIED,u,null)}console.log("Direct access allowed: Using primary administrator token from settings.php")}if(e)try{await Promise.race([ue.init(),new Promise((i,r)=>setTimeout(()=>r(new Error("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥")),5e3))])}catch(i){console.warn("BX24.init() failed, will try proxy API:",i)}let s;try{s=await Promise.race([ue.getCurrentUser(),new Promise((i,r)=>setTimeout(()=>r(new Error("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø—Ä–µ–≤—ã—Å–∏–ª–æ 10 —Å–µ–∫—É–Ω–¥")),1e4))])}catch(i){console.warn("Bitrix24BxApi.getCurrentUser() failed, trying proxy API:",i);const{Bitrix24ApiProvider:r}=await te(async()=>{const{Bitrix24ApiProvider:l}=await import("./chunk-C5D5xwuQ.js").then(u=>u.b);return{Bitrix24ApiProvider:l}},__vite__mapDeps([2,1]),import.meta.url);try{const l=await r.getInstance();s=await Promise.race([l.getCurrentUser(),new Promise((u,m)=>setTimeout(()=>m(new Error("–ü—Ä–æ–∫—Å–∏ API –ø—Ä–µ–≤—ã—Å–∏–ª–æ 5 —Å–µ–∫—É–Ω–¥")),5e3))]),console.log("Got user from proxy API:",s?.ID||"unknown")}catch(l){throw console.error("Both BX24 API and proxy API failed:",l),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}if(!s||!s.ID)return console.warn("AccessControlService.checkAccess - user not determined:",s),new le(!1,ae.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.");console.log("AccessControlService.checkAccess - user determined:",{id:s.ID,name:s.NAME,departments:s.UF_DEPARTMENT});const t=s.UF_DEPARTMENT||[];if(console.log("AccessControlService.checkAccess - departmentIds:",t),!Array.isArray(t)||t.length===0){if(console.log("AccessControlService.checkAccess - user has no departments"),!e){const{isDirectAccessAllowed:i}=await te(async()=>{const{isDirectAccessAllowed:l}=await import("./direct-access-config-DhKxYe1L.js");return{isDirectAccessAllowed:l}},__vite__mapDeps([0,1]),import.meta.url);if(await i())return console.log("AccessControlService.checkAccess - Direct access allowed, granting access despite no departments"),new le(!0,null,null,s)}return console.warn("AccessControlService.checkAccess - Access denied: user has no departments"),new le(!1,ae.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ—Ç–¥–µ–ª—É.")}const a=t.some(i=>ot(i));return console.log("AccessControlService.checkAccess - hasAccess:",a),a?(console.log("AccessControlService.checkAccess - Access granted"),new le(!0,null,null,s)):(console.warn("AccessControlService.checkAccess - Access denied: no allowed departments"),new le(!1,ae.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"))}catch(e){return console.error("AccessControlService.checkAccess error:",e),e.message&&(e.message.includes("CORS")||e.message.includes("blocked")||e.message.includes("ERR_FAILED")||e.message.includes("unknown address space"))&&we()?(console.error("CORS error inside Bitrix24: Cannot determine interface user."),new le(!1,ae.API_ERROR,"–û—à–∏–±–∫–∞ CORS: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")):e.message&&e.message.includes("not loaded")?new le(!1,ae.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."):new le(!1,ae.API_ERROR,"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}static async getCurrentUser(){try{return we()&&await ue.init(),await ue.getCurrentUser()}catch(e){return console.error("AccessControlService.getCurrentUser error:",e),null}}}class Ie{static async logAppEntry(e,s=null){if(!e||!e.ID)return console.warn("[ActivityLoggingService] Invalid user object for app entry logging"),!1;const t={timestamp:new Date().toISOString(),type:"app_entry",user_id:e.ID,user_name:this.getUserName(e),user_email:e.EMAIL||null,ip:s||this.getClientIp(),user_agent:navigator.userAgent,session_id:this.getSessionId()};return await this.saveLog(t)}static async logPageVisit(e,s,t=null){if(!s||!s.ID)return console.warn("[ActivityLoggingService] Invalid user object for page visit logging"),!1;if(!e||!e.path)return console.warn("[ActivityLoggingService] Invalid route object for page visit logging"),!1;const a={timestamp:new Date().toISOString(),type:"page_visit",user_id:s.ID,user_name:this.getUserName(s),route_path:e.path,route_name:e.name||null,route_title:e.meta?.title||null,from_path:t?.path||null,from_name:t?.name||null,session_id:this.getSessionId()};return await this.saveLog(a)}static async saveLog(e){try{const s=ie("/api/user-activity-log.php"),t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)});if(!t.ok){const i=await t.text();return console.error("[ActivityLoggingService] Failed to save log:",{status:t.status,statusText:t.statusText,error:i}),!1}const a=await t.json();return a.success?!0:(console.error("[ActivityLoggingService] API returned error:",a.error),!1)}catch(s){return s.name==="AbortError"?console.warn("[ActivityLoggingService] Request timeout (activity logging skipped)"):console.error("[ActivityLoggingService] Error saving log:",s),!1}}static getSessionId(){const e="activity_session_id";if(sessionStorage.getItem(e))return sessionStorage.getItem(e);const s=this.generateSessionId();return sessionStorage.setItem(e,s),s}static generateSessionId(){const e=Date.now(),s=Math.random().toString(36).substring(2,11);return`${e}-${s}`}static getUserName(e){const s=e.NAME||"",t=e.LAST_NAME||"";return`${s} ${t}`.trim()||e.EMAIL||`User #${e.ID}`}static getClientIp(){return null}static isAppEntryLogged(){return sessionStorage.getItem("app_entry_logged")==="true"}static markAppEntryLogged(){sessionStorage.setItem("app_entry_logged","true")}}const is={reports:[{id:1,title:"–û—Ç—á—ë—Ç –ø–æ —Ç–∏–∫–µ—Ç–∞–º",icon:"üìä",route:"/reports/tickets",description:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º",active:!1},{id:2,title:"–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",icon:"üìà",route:"/reports/performance",description:"–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞",active:!1},{id:3,title:"–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º",icon:"üìâ",route:"/reports/deadlines",description:"–ê–Ω–∞–ª–∏–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á",active:!1},{id:4,title:"–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç",icon:"üìã",route:"/reports/summary",description:"–û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",active:!1},{id:5,title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",route:"/dashboard/sector-1c",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0},{id:6,title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",icon:"üìä",route:"/dashboard/graph-state",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–° –≤–æ –≤—Ä–µ–º–µ–Ω–∏",active:!0,category:"analytics",order:6},{id:7,title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–°",icon:"üìà",route:"/dashboard/graph-admission-closure",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0,category:"analytics",order:7},{id:8,title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"‚è±",route:"/dashboard/tickets-time-tracking",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",active:!0,category:"analytics",order:8}]};function ls(){return is.reports.filter(o=>o.active===!0)}const cs={adminInterfaces:[{id:1,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"üë•",route:"/admin/users",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"},{id:2,title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã",icon:"‚öôÔ∏è",route:"/admin/settings",description:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:3,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",icon:"üìã",route:"/admin/webhook-logs",description:"–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤"},{id:4,title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",icon:"üìä",route:"/admin/usage-stats",description:"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:5,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",icon:"üóëÔ∏è",route:"/admin/cache",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –º–æ–¥—É–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"}]};function ds(){return[...cs.adminInterfaces]}const us={name:"IndexPage",components:{StatusMessage:tt,LoadingSpinner:st},beforeCreate(){console.log("[IndexPage] beforeCreate() called")},created(){console.log("[IndexPage] created() called")},beforeMount(){console.log("[IndexPage] beforeMount() called")},setup(){console.log("[IndexPage] setup() called");const o=Ee(),e=C(!0),s=C(null),t=C(!1),a=C(!1),i=C(""),r=C(null),l=C(null),u=C(!1);console.log("[IndexPage] Initial state:",{loading:e.value,accessAllowed:t.value,accessDenied:a.value});const m=C(ls()),p=C(!1),f=C(ds()),x=A(()=>r.value?nt(r.value):!1),L=A(()=>{if(!r.value)return"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";const _=r.value.FIRST_NAME?r.value.FIRST_NAME.trim():"",h=r.value.LAST_NAME?r.value.LAST_NAME.trim():"",v=r.value.NAME?r.value.NAME.trim():"";return _&&h?`${_} ${h}`:v&&h&&v!==h?`${v} ${h}`:_&&v&&_!==v?`${_} ${v}`:v&&v.includes(" ")?v:_||h||v||`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${r.value.ID}`}),E=A(()=>s.value?s.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ":"–û—à–∏–±–∫–∞ API":null),b=A(()=>s.value?s.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É.":s.value:null),T=A(()=>s.value&&s.value.includes("no_install_app")),w=A(()=>et("/install.php"));ee(async()=>{console.log("[IndexPage] onMounted() called");try{console.log("[IndexPage] Calling AccessControlService.checkAccess()...");const _=await ve.checkAccess();if(console.log("[IndexPage] Access result:",{allowed:_.allowed,hasUser:!!_.user,user:_.user,errorCode:_.errorCode,errorMessage:_.errorMessage}),_.allowed){if(console.log("[IndexPage] Setting accessAllowed to true"),t.value=!0,r.value=_.user,console.log("[IndexPage] Access allowed, setting state:",{accessAllowed:t.value,hasUser:!!r.value,loading:e.value,accessDenied:a.value}),!Ie.isAppEntryLogged())try{_.user&&await Ie.logAppEntry(_.user)&&Ie.markAppEntryLogged()}catch(h){console.error("[IndexPage] Error logging app entry:",h)}}else{a.value=!0;const h=we(),v=!h&&_.errorCode===ae.ACCESS_DENIED&&_.errorMessage&&_.errorMessage.includes("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø");if(console.log("IndexPage - accessResult:",{errorCode:_.errorCode,errorMessage:_.errorMessage,isInsideB24:h,isDirectAccessDeniedCheck:v}),u.value=v,v&&(i.value=_.errorMessage,console.log("IndexPage - Set direct access denied message:",_.errorMessage)),console.log("IndexPage - State after check:",{accessDenied:a.value,isDirectAccessDenied:u.value,accessErrorMessage:i.value}),!v){if(_.user){const{getAllowedDepartmentIds:S}=await te(async()=>{const{getAllowedDepartmentIds:O}=await import("./access-config-async-ld3N8LW9.js");return{getAllowedDepartmentIds:O}},__vite__mapDeps([3,4,1,2]),import.meta.url);l.value={userId:_.user.ID,departmentIds:_.user.UF_DEPARTMENT||[],allowedIds:S()}}_.errorCode===ae.USER_NOT_DETERMINED?i.value="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.":_.errorCode===ae.ACCESS_DENIED?i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω":i.value=_.errorMessage||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."}}}catch(_){s.value=_.message,console.error("Error checking access:",_)}finally{e.value=!1,console.log("[IndexPage] Final state:",{loading:e.value,accessAllowed:t.value,accessDenied:a.value,hasUser:!!r.value,error:s.value})}});const I=_=>{if(!_){console.error("Route is not defined for report");return}o.push(_)},D=()=>{p.value=!0},j=()=>{p.value=!1};return{loading:e,error:s,accessAllowed:t,accessDenied:a,accessErrorMessage:i,currentUser:r,userName:L,debugInfo:l,isDirectAccessDenied:u,errorTitle:E,errorMessage:b,showInstallLink:T,installPageUrl:w,reportsButtons:m,navigateToReport:I,isAdmin:x,showAdminPopup:p,adminButtons:f,openAdminPopup:D,closeAdminPopup:j,navigateToAdmin:_=>{if(!_){console.error("Route is not defined for admin interface");return}o.push(_),j()}}}},gs={class:"index-page"},fs={class:"container"},ms={key:0,class:"install-link"},hs=["href"],vs={key:0,class:"direct-access-denied-info",style:{"margin-top":"15px",padding:"15px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px"}},ps={key:1,class:"debug-info",style:{"margin-top":"15px",padding:"10px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px","font-size":"12px"}},ys={key:3,class:"main-content"},_s={class:"greeting-section"},ws={class:"greeting-header"},bs={class:"greeting-header-content"},Cs={class:"greeting-text"},Ss={class:"reports-section"},ks={class:"reports-grid"},Es=["onClick"],As={class:"report-icon"},Ts={class:"report-title"},Ls={key:0,class:"report-description"},xs={class:"admin-popup-header"},Is={class:"admin-popup-content"},Ms={class:"admin-buttons-grid"},Ds=["onClick"],Ps={class:"admin-icon"},Us={class:"admin-title"},Ns={key:0,class:"admin-description"};function Rs(o,e,s,t,a,i){const r=B("StatusMessage"),l=B("LoadingSpinner");return c(),d("div",gs,[n("div",fs,[t.error?(c(),J(r,{key:0,type:"error",title:t.errorTitle,message:t.errorMessage},{default:oe(()=>[t.showInstallLink?(c(),d("div",ms,[n("a",{href:t.installPageUrl},"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",8,hs)])):k("",!0)]),_:1},8,["title","message"])):k("",!0),t.loading?(c(),J(l,{key:1,message:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞..."})):k("",!0),!t.loading&&t.accessDenied?(c(),J(r,{key:2,type:"error",title:"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",message:t.accessErrorMessage},{default:oe(()=>[t.isDirectAccessDenied?(c(),d("div",vs,[...e[4]||(e[4]=[n("p",{style:{margin:"0 0 10px 0","font-weight":"600",color:"#856404"}},[n("strong",null,"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")],-1),n("ol",{style:{margin:"0","padding-left":"20px",color:"#856404"}},[n("li",null,"–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24"),n("li",null,"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Bitrix24 (placement, –≤–∏–¥–∂–µ—Ç –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É)")],-1)])])):t.debugInfo?(c(),d("div",ps,[e[5]||(e[5]=n("strong",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e[6]||(e[6]=n("br",null,null,-1)),H(" ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+g(t.debugInfo.userId),1),e[7]||(e[7]=n("br",null,null,-1)),H(" ID –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+g(t.debugInfo.departmentIds),1),e[8]||(e[8]=n("br",null,null,-1)),H(" –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ID –æ—Ç–¥–µ–ª–æ–≤: "+g(t.debugInfo.allowedIds),1),e[9]||(e[9]=n("br",null,null,-1)),e[10]||(e[10]=n("small",{style:{color:"#856404"}},"–î–æ–±–∞–≤—å—Ç–µ ID –æ—Ç–¥–µ–ª–∞ –≤ —Ñ–∞–π–ª vue-app/src/config/access-config.js",-1))])):k("",!0)]),_:1},8,["message"])):k("",!0),!t.loading&&!t.accessDenied&&t.accessAllowed?(c(),d("div",ys,[n("div",_s,[n("div",ws,[n("div",bs,[e[13]||(e[13]=n("h2",{class:"greeting-title"},"–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ò–¢ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –ü–ª–∞–Ω–µ—Ä–∫–∏ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ü–∏–∏",-1)),n("p",Cs,[e[11]||(e[11]=H(" –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",-1)),n("strong",null,g(t.userName),1),e[12]||(e[12]=H("! ",-1))])]),t.isAdmin?(c(),d("button",{key:0,class:"admin-button-header",onClick:e[0]||(e[0]=(...u)=>t.openAdminPopup&&t.openAdminPopup(...u)),title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"}," ‚öôÔ∏è ")):k("",!0)])]),n("div",Ss,[n("div",ks,[(c(!0),d(z,null,V(t.reportsButtons,u=>(c(),d("div",{key:u.id,class:"report-button",onClick:m=>t.navigateToReport(u.route)},[n("div",As,g(u.icon),1),n("div",Ts,g(u.title),1),u.description?(c(),d("div",Ls,g(u.description),1)):k("",!0)],8,Es))),128))])]),t.showAdminPopup&&t.isAdmin?(c(),d("div",{key:0,class:"admin-popup-overlay",onClick:e[3]||(e[3]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))},[n("div",{class:"admin-popup",onClick:e[2]||(e[2]=fe(()=>{},["stop"]))},[n("div",xs,[e[14]||(e[14]=n("h3",{class:"admin-popup-title"},"‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",-1)),n("button",{class:"admin-popup-close",onClick:e[1]||(e[1]=(...u)=>t.closeAdminPopup&&t.closeAdminPopup(...u))}," ‚úï ")]),n("div",Is,[n("div",Ms,[(c(!0),d(z,null,V(t.adminButtons,u=>(c(),d("div",{key:u.id,class:"admin-interface-button",onClick:m=>t.navigateToAdmin(u.route)},[n("div",Ps,g(u.icon),1),n("div",Us,g(u.title),1),u.description?(c(),d("div",Ns,g(u.description),1)):k("",!0)],8,Ds))),128))])])])])):k("",!0)])):k("",!0)])])}const Fs=F(us,[["render",Rs],["__scopeId","data-v-6cc28966"]]),se=C(new Map),re=C({hits:0,misses:0,sets:0,invalidations:0}),Oe={defaultTTL:5*60*1e3,maxSize:100,enableStats:!0};function Os(o={}){const{ttl:e=Oe.defaultTTL,maxSize:s=Oe.maxSize,enableStats:t=Oe.enableStats}=o,a=T=>{const w=new WeakSet;return JSON.stringify(T,(I,D)=>{if(typeof D=="object"&&D!==null){if(w.has(D))return"[Circular]";w.add(D)}return typeof D=="function"||D===void 0?null:D})},i=(T,w={})=>{const I=Object.keys(w).sort().reduce((D,j)=>{const P=w[j];if(P==null)D[j]=null;else if(typeof P=="object")try{D[j]=a(P)}catch{D[j]=String(P)}else D[j]=P;return D},{});try{return`${T}_${a(I)}`}catch{const j=Object.keys(I).sort().map(P=>`${P}=${I[P]}`).join("&");return`${T}_${j}`}},r=T=>{const w=se.value.get(T);return w?Date.now()-w.timestamp>w.ttl?(se.value.delete(T),t&&re.value.misses++,null):(w.lastAccessed=Date.now(),t&&re.value.hits++,w.data):(t&&re.value.misses++,null)},l=(T,w,I=null)=>{se.value.size>=s&&u(),se.value.set(T,{data:w,timestamp:Date.now(),lastAccessed:Date.now(),ttl:I||e}),t&&re.value.sets++},u=()=>{let T=null,w=1/0;for(const[I,D]of se.value.entries())D.lastAccessed<w&&(w=D.lastAccessed,T=I);T&&se.value.delete(T)},m=()=>{se.value.clear(),t&&(re.value={hits:0,misses:0,sets:0,invalidations:0})},p=T=>{const w=typeof T=="string"?new RegExp(T):T;let I=0;for(const D of se.value.keys())w.test(D)&&(se.value.delete(D),I++);return t&&(re.value.invalidations+=I),I},f=()=>{const T=Date.now();let w=0;for(const[I,D]of se.value.entries())T-D.timestamp>D.ttl&&(se.value.delete(I),w++);return w},x=()=>{const T=re.value.hits+re.value.misses,w=T>0?(re.value.hits/T*100).toFixed(2):0;return{...re.value,size:se.value.size,hitRate:`${w}%`}};let L=null;const E=(T=5*60*1e3)=>{L&&clearInterval(L),L=setInterval(()=>{f()},T)},b=()=>{L&&(clearInterval(L),L=null)};return E(),{get:r,set:l,clear:m,invalidate:p,cleanup:f,getCacheKey:i,getStats:x,startAutoCleanup:E,stopAutoCleanup:b}}function ce(o){if(!o||typeof o!="object"||!o.timestamp||typeof o.timestamp!="string"||!o.event||typeof o.event!="string"||!o.category||typeof o.category!="string"||!["tasks","smart-processes","errors"].includes(o.category))return!1;try{new Date(o.timestamp)}catch{return!1}return!0}function Bs(o){if(!o||typeof o!="object")return!1;for(const[e,s]of Object.entries(o))if(typeof s=="function")return!1;return!0}function Ce(o){if(!ce(o))return null;const e={timestamp:o.timestamp,event:o.event,category:o.category};return o.ip&&typeof o.ip=="string"&&(e.ip=o.ip),o.payload&&typeof o.payload=="object"&&(e.payload=o.payload),o.details&&Bs(o.details)&&(e.details=o.details),e}function ze(o){return Array.isArray(o)?o.map(e=>Ce(e)).filter(e=>e!==null):[]}const{get:$s,set:js,getCacheKey:Ws,invalidate:Ke}=Os({ttl:2*60*1e3,maxSize:50});class Ye{static getBaseUrl(){return ie("/api/webhook-logs.php")}static get BASE_URL(){return this.getBaseUrl()}static async getLogs(e={},s=1,t=50,a=!1){if(s<1)throw new Error("Page must be greater than 0");if(t<1||t>1e3)throw new Error("Limit must be between 1 and 1000");const i={category:e.category||null,event:e.event||null,date:e.date||null,hour:e.hour!==void 0?e.hour:null,dateFrom:e.dateFrom||null,dateTo:e.dateTo||null,ip:e.ip||null,status:e.status||null},r=this.getBaseUrl(),l=Ws(r,{filters:i,page:s,limit:t});if(!a){const m=$s(l);if(m)return console.log("[WebhookLogsApiService] Cache hit:",l.substring(0,50)+"..."),m}console.log("[WebhookLogsApiService] Cache miss:",l.substring(0,50)+"...");const u=new URLSearchParams({page:s.toString(),limit:t.toString()});i.category&&u.append("category",i.category),i.event&&u.append("event",i.event),i.date&&u.append("date",i.date),i.hour!==null&&u.append("hour",i.hour.toString()),i.dateFrom&&u.append("dateFrom",i.dateFrom),i.dateTo&&u.append("dateTo",i.dateTo),i.ip&&u.append("ip",i.ip),i.status&&u.append("status",i.status);try{const m=this.getBaseUrl(),p=await fetch(`${m}?${u.toString()}`);if(!p.ok){const E=await p.text();let b;try{b=JSON.parse(E)}catch{b={error:E}}throw new Error(b.error_description||b.error||`HTTP error! status: ${p.status}`)}const f=await p.json();if(console.log("[WebhookLogsApiService] API response:",{success:f.success,logsCount:f.logs?.length||0,pagination:f.pagination,hasError:!!f.error}),f.error)throw new Error(f.error_description||f.error);if(!f.success)throw console.warn("[WebhookLogsApiService] API returned success=false:",f),new Error("API request failed");if(!Array.isArray(f.logs))throw console.error("[WebhookLogsApiService] Invalid logs format:",f.logs),new Error("Invalid logs format: expected array");const x=ze(f.logs);(!f.pagination||typeof f.pagination!="object")&&(console.warn("[WebhookLogsApiService] Invalid pagination format:",f.pagination),f.pagination={page:s,limit:t,total:x.length,pages:Math.ceil(x.length/t)});const L={success:!0,logs:x,pagination:{page:f.pagination.page||s,limit:f.pagination.limit||t,total:f.pagination.total||x.length,pages:f.pagination.pages||Math.ceil((f.pagination.total||x.length)/t)}};return js(l,L),L}catch(m){throw console.error("[WebhookLogsApiService] Error:",m),m}}static invalidateCacheOnFilterChange(e={},s={}){const t=Ke(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Invalidated ${t} entries on filter change`)}static clearCache(){const e=Ke(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Cleared ${e} entries`)}static async getLogDetails(e,s=null){const t={};return s&&(t.date=s),(await this.getLogs(t,1,1e3)).logs.find(r=>`${r.timestamp}_${r.event}`===e)||null}static async getErrors(e={},s=1,t=50){return this.getLogs({...e,category:"errors"},s,t)}static async getStats(e={}){const s=await this.getLogs(e,1,1e3),t={total:s.pagination.total||s.logs.length,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}};return s.logs.forEach(a=>{a.category==="tasks"?t.tasks++:a.category==="smart-processes"?t.smartProcesses++:a.category==="errors"&&t.errors++,t.byEvent[a.event]||(t.byEvent[a.event]=0),t.byEvent[a.event]++;const i=a.timestamp.split("T")[0];t.byDate[i]||(t.byDate[i]=0),t.byDate[i]++}),t}}function zs(){const o=Et(),e=Ee(),s=new Date().toISOString().split("T")[0],t=C({category:null,event:null,dateFrom:s,dateTo:null,hour:null,ip:null,search:null,status:null}),a=()=>{const m=o.query;t.value={category:m.category||null,event:m.event||null,dateFrom:m.dateFrom||m.date||s,dateTo:m.dateTo||null,hour:m.hour?parseInt(m.hour):null,ip:m.ip||null,search:m.search||null,status:m.status||null}},i=m=>{if(u)return;const p={...o.query};Object.keys(m).forEach(x=>{const L=m[x];L!==null&&L!==""&&L!==void 0?p[x]=L.toString():delete p[x]}),JSON.stringify(p)!==JSON.stringify(o.query)&&(u=!0,e.replace({path:o.path,query:p}).finally(()=>{setTimeout(()=>{u=!1},100)}))},r=m=>{const p={...t.value,...m};JSON.stringify(t.value)!==JSON.stringify(p)&&(t.value=p,i(t.value))},l=()=>{t.value={category:null,event:null,dateFrom:s,dateTo:null,hour:null,ip:null,search:null,status:null},i(t.value)};ee(()=>{a()});let u=!1;return Z(()=>o.query,(m,p)=>{if(u)return;JSON.stringify(m)!==JSON.stringify(p)&&a()},{deep:!0}),{filters:t,updateFilters:r,clearFilters:l,loadFiltersFromUrl:a}}function Vs(o,e,s={}){if(!e||!e.trim())return o;const{caseSensitive:t=!1,searchInEvent:a=!0,searchInPayload:i=!0,searchInDetails:r=!0,searchInIp:l=!0,searchInTimestamp:u=!1}=s,m=t?e.trim():e.trim().toLowerCase();return o.filter(p=>{if(a&&p.event&&(t?p.event:p.event.toLowerCase()).includes(m))return!0;if(i&&p.payload)try{const f=JSON.stringify(p.payload);if((t?f:f.toLowerCase()).includes(m))return!0}catch(f){console.warn("Error searching in payload:",f)}if(r&&p.details)try{const f=JSON.stringify(p.details);if((t?f:f.toLowerCase()).includes(m))return!0}catch(f){console.warn("Error searching in details:",f)}return!!(l&&p.ip&&(t?p.ip:p.ip.toLowerCase()).includes(m)||u&&p.timestamp&&(t?p.timestamp:p.timestamp.toLowerCase()).includes(m))})}function We(o){if(!o||typeof o!="object"||o.category!==void 0&&o.category!==null&&!["tasks","smart-processes","errors"].includes(o.category)||o.date!==void 0&&o.date!==null&&!/^\d{4}-\d{2}-\d{2}$/.test(o.date))return!1;if(o.hour!==void 0&&o.hour!==null){const e=parseInt(o.hour,10);if(isNaN(e)||e<0||e>23)return!1}return!(o.ip!==void 0&&o.ip!==null&&(typeof o.ip!="string"||o.ip.length===0))}function qs(o){if(!o||typeof o!="object")return!1;const e=parseInt(o.page,10),s=parseInt(o.limit,10),t=parseInt(o.total,10),a=parseInt(o.pages,10);return!(isNaN(e)||e<1||isNaN(s)||s<1||s>1e3||isNaN(t)||t<0||isNaN(a)||a<0)}function Ge(o){if(o==null)return"";const e=String(o),s=e.replace(/"/g,'""');return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${s}"`:s}function Hs(o){return o==null?"":typeof o=="object"?JSON.stringify(o):String(o)}function Xs(o,e="webhook-logs.csv",s={}){return new Promise((t,a)=>{try{if(!Array.isArray(o)||o.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{columns:i=null,onProgress:r=null}=s,l=i||Object.keys(o[0]),m=[l.map(E=>Ge(E)).join(",")],p=o.length,f=1e3;for(let E=0;E<p;E+=f){const b=o.slice(E,E+f);if(b.forEach(T=>{const w=l.map(I=>{const D=T[I];return Ge(Hs(D))});m.push(w.join(","))}),r){const T=Math.min(100,Math.round((E+b.length)/p*100));r(T)}}const x="\uFEFF"+m.join(`
`),L=new Blob([x],{type:"text/csv;charset=utf-8;"});rt(L,e),r&&r(100),t()}catch(i){a(i)}})}function Js(o,e="webhook-logs.json",s={}){return new Promise((t,a)=>{try{if(!Array.isArray(o)||o.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{pretty:i=!0,onProgress:r=null}=s,l=i?JSON.stringify(o,null,2):JSON.stringify(o);r&&r(50);const u=new Blob([l],{type:"application/json;charset=utf-8;"});rt(u,e),r&&r(100),t()}catch(i){a(i)}})}function rt(o,e){const s=URL.createObjectURL(o),t=document.createElement("a");t.href=s,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(s)},100)}function Ks(o,e={},s=0){const t=new Date().toISOString().split("T")[0],a=new Date().toTimeString().split(" ")[0].replace(/:/g,"-");let i=`webhook-logs_${t}_${a}`;const r=[];return e.category&&r.push(`cat-${e.category}`),e.event&&r.push(`evt-${e.event.substring(0,10)}`),e.dateFrom&&r.push(`from-${e.dateFrom}`),e.dateTo&&r.push(`to-${e.dateTo}`),r.length>0&&(i+=`_${r.join("-")}`),s>0&&(i+=`_${s}records`),`${i}.${o}`}function Ys(o){const e=[];if(!Array.isArray(o))return e.push("–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),{valid:!1,errors:e,estimatedSize:0};if(o.length===0)return e.push("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"),{valid:!1,errors:e,estimatedSize:0};const s=JSON.stringify(o).length,t=50*1024*1024;return s>t&&e.push(`–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö (${Math.round(s/1024/1024)} MB). –≠–∫—Å–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è.`),{valid:e.length===0,errors:e,estimatedSize:s}}function Ve(o,e="short"){if(!o)return"‚Äî";try{const s=new Date(o);if(isNaN(s.getTime()))return"Invalid date";switch(e){case"short":return s.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});case"long":return s.toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});case"relative":return Gs(s);default:return s.toLocaleString("ru-RU")}}catch{return"Invalid date"}}function Gs(o){const s=new Date-o,t=Math.floor(s/1e3),a=Math.floor(t/60),i=Math.floor(a/60),r=Math.floor(i/24);return t<60?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":a<60?`${a} ${Be(a,"–º–∏–Ω—É—Ç—É","–º–∏–Ω—É—Ç—ã","–º–∏–Ω—É—Ç")} –Ω–∞–∑–∞–¥`:i<24?`${i} ${Be(i,"—á–∞—Å","—á–∞—Å–∞","—á–∞—Å–æ–≤")} –Ω–∞–∑–∞–¥`:r<7?`${r} ${Be(r,"–¥–µ–Ω—å","–¥–Ω—è","–¥–Ω–µ–π")} –Ω–∞–∑–∞–¥`:Ve(o.toISOString(),"short")}function Be(o,e,s,t){const a=o%10,i=o%100;return a===1&&i!==11?e:a>=2&&a<=4&&(i<10||i>=20)?s:t}function Se(o){return o?o.replace(/^ON/,"").split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):"‚Äî"}function ge(o){return{tasks:"–ó–∞–¥–∞—á–∏","smart-processes":"–°–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å—ã",errors:"–û—à–∏–±–∫–∏"}[o]||o}function qe(o){if(!o||typeof o!="object")return"‚Äî";const e=[];if(o.task_id&&e.push(`–ó–∞–¥–∞—á–∞ #${o.task_id}`),o.entity_id&&e.push(`–°—É—â–Ω–æ—Å—Ç—å #${o.entity_id}`),o.task_title&&e.push(`"${o.task_title}"`),o.title&&e.push(`"${o.title}"`),o.comment_text){const s=o.comment_text.length>50?o.comment_text.substring(0,50)+"...":o.comment_text;e.push(`–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${s}`)}return e.length>0?e.join(" ‚Ä¢ "):"‚Äî"}const Qs={name:"WebhookLogsExport",props:{logs:{type:Array,default:()=>[]},selectedLogs:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},totalCount:{type:Number,default:0}},emits:["export-start","export-complete","export-error"],setup(o,{emit:e}){const s=C(!1),t=C("csv"),a=C("all"),i=C(!0),r=C(!1),l=C(0),u=C([]),m=C(null),p=A(()=>o.selectedLogs.length),f=A(()=>o.logs.length>0||o.totalCount>0),x=A(()=>o.filters.category||o.filters.event||o.filters.dateFrom||o.filters.dateTo),L=A(()=>a.value==="selected"?p.value:o.logs.length||o.totalCount),E=A(()=>a.value==="selected"?p.value>0:f.value),b=()=>{l.value=0,u.value=[],m.value=null,p.value>0?a.value="selected":a.value="all",s.value=!0,w()},T=()=>{r.value||(s.value=!1)},w=()=>{const P=I(),_=Ys(P);u.value=_.errors,m.value=_.estimatedSize},I=()=>(a.value==="selected"?o.selectedLogs:o.logs).map(h=>Ce(h)).filter(h=>ce(h)?!0:(console.warn("[WebhookLogsExport] Skipping invalid log:",h),!1)),D=async()=>{try{r.value=!0,l.value=0;let P=I();if(P.length===0)throw new Error("–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const _=P.map(S=>({timestamp:S.timestamp,event:S.event,category:S.category,ip:S.ip||null,details:S.details||null,payload:S.payload||null,formatted:{timestamp:Ve(S.timestamp),event:Se(S.event),category:ge(S.category),details:qe(S.details)}}));e("export-start",{format:t.value,scope:a.value,count:_.length});const h=Ks(t.value,o.filters,_.length),v=S=>{l.value=S};t.value==="csv"?await Xs(_,h,{onProgress:v}):await Js(_,h,{pretty:i.value,onProgress:v}),e("export-complete",{format:t.value,filename:h,count:_.length}),setTimeout(()=>{r.value=!1,s.value=!1,l.value=0},500)}catch(P){console.error("[WebhookLogsExport] Export error:",P),e("export-error",P),r.value=!1,l.value=0,alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${P.message}`)}},j=P=>P<1024?`${P} B`:P<1024*1024?`${(P/1024).toFixed(2)} KB`:`${(P/1024/1024).toFixed(2)} MB`;return Z([a,()=>o.logs,()=>o.selectedLogs],()=>{s.value&&w()}),{showExportModal:s,exportFormat:t,exportScope:a,jsonPretty:i,exporting:r,exportProgress:l,exportWarnings:u,estimatedSize:m,selectedCount:p,hasAllLogs:f,hasFilters:x,exportCount:L,canExport:E,openExportModal:b,closeExportModal:T,handleExport:D,formatSize:j}}},Zs={class:"webhook-logs-export"},eo=["disabled","title"],to={key:0,class:"selected-badge"},so={class:"export-modal-header"},oo={class:"export-modal-body"},no={class:"export-section"},ro={class:"radio-group"},ao={class:"export-section"},io={class:"radio-group"},lo=["disabled"],co={class:"radio-label"},uo={key:0},go={key:1},fo=["disabled"],mo={class:"radio-label"},ho={key:0,class:"export-section"},vo={class:"checkbox-option"},po={class:"export-info"},yo={class:"info-item"},_o={class:"info-value"},wo={key:0,class:"info-item"},bo={class:"info-value"},Co={key:1,class:"export-warnings"},So={key:0,class:"export-progress"},ko={class:"progress-bar"},Eo={class:"progress-text"},Ao={class:"export-modal-footer"},To=["disabled"],Lo={key:0},xo={key:1},Io=["disabled"];function Mo(o,e,s,t,a,i){return c(),d("div",Zs,[n("button",{onClick:e[0]||(e[0]=(...r)=>t.openExportModal&&t.openExportModal(...r)),class:"btn-export",disabled:!t.canExport,title:t.canExport?"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"},[e[11]||(e[11]=n("span",{class:"btn-icon"},"üì•",-1)),e[12]||(e[12]=n("span",{class:"btn-text"},"–≠–∫—Å–ø–æ—Ä—Ç",-1)),t.selectedCount>0?(c(),d("span",to,g(t.selectedCount),1)):k("",!0)],8,eo),W(de,{name:"modal"},{default:oe(()=>[t.showExportModal?(c(),d("div",{key:0,class:"export-modal-overlay",onClick:e[10]||(e[10]=(...r)=>t.closeExportModal&&t.closeExportModal(...r))},[n("div",{class:"export-modal",onClick:e[9]||(e[9]=fe(()=>{},["stop"]))},[n("div",so,[e[13]||(e[13]=n("h3",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",-1)),n("button",{onClick:e[1]||(e[1]=(...r)=>t.closeExportModal&&t.closeExportModal(...r)),class:"btn-close"},"‚úï")]),n("div",oo,[n("div",no,[e[16]||(e[16]=n("h4",null,"–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞",-1)),n("div",ro,[n("label",{class:$(["radio-option",{active:t.exportFormat==="csv"}])},[X(n("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=r=>t.exportFormat=r),value:"csv",class:"radio-input"},null,512),[[xe,t.exportFormat]]),e[14]||(e[14]=n("span",{class:"radio-label"},[n("strong",null,"CSV"),n("small",null,"–î–ª—è Excel, LibreOffice")],-1))],2),n("label",{class:$(["radio-option",{active:t.exportFormat==="json"}])},[X(n("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=r=>t.exportFormat=r),value:"json",class:"radio-input"},null,512),[[xe,t.exportFormat]]),e[15]||(e[15]=n("span",{class:"radio-label"},[n("strong",null,"JSON"),n("small",null,"–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, API")],-1))],2)])]),n("div",ao,[e[19]||(e[19]=n("h4",null,"–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",-1)),n("div",io,[n("label",{class:$(["radio-option",{active:t.exportScope==="all",disabled:!t.hasAllLogs}])},[X(n("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=r=>t.exportScope=r),value:"all",disabled:!t.hasAllLogs,class:"radio-input"},null,8,lo),[[xe,t.exportScope]]),n("span",co,[e[17]||(e[17]=n("strong",null,"–í—Å–µ –∑–∞–ø–∏—Å–∏",-1)),t.hasFilters?(c(),d("small",uo,"–° –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ ("+g(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π)",1)):(c(),d("small",go,"–í—Å–µ–≥–æ: "+g(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π",1))])],2),n("label",{class:$(["radio-option",{active:t.exportScope==="selected",disabled:t.selectedCount===0}])},[X(n("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=r=>t.exportScope=r),value:"selected",disabled:t.selectedCount===0,class:"radio-input"},null,8,fo),[[xe,t.exportScope]]),n("span",mo,[e[18]||(e[18]=n("strong",null,"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏",-1)),n("small",null,g(t.selectedCount)+" –∑–∞–ø–∏—Å–µ–π –≤—ã–±—Ä–∞–Ω–æ",1)])],2)])]),t.exportFormat==="json"?(c(),d("div",ho,[e[21]||(e[21]=n("h4",null,"–û–ø—Ü–∏–∏ JSON",-1)),n("label",vo,[X(n("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=r=>t.jsonPretty=r),class:"checkbox-input"},null,512),[[Qe,t.jsonPretty]]),e[20]||(e[20]=n("span",{class:"checkbox-label"},"–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)",-1))])])):k("",!0),n("div",po,[n("div",yo,[e[22]||(e[22]=n("span",{class:"info-label"},"–ó–∞–ø–∏—Å–µ–π –∫ —ç–∫—Å–ø–æ—Ä—Ç—É:",-1)),n("span",_o,g(t.exportCount),1)]),t.estimatedSize?(c(),d("div",wo,[e[23]||(e[23]=n("span",{class:"info-label"},"–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä:",-1)),n("span",bo,g(t.formatSize(t.estimatedSize)),1)])):k("",!0)]),t.exportWarnings.length>0?(c(),d("div",Co,[(c(!0),d(z,null,V(t.exportWarnings,(r,l)=>(c(),d("div",{key:l,class:"warning-item"}," ‚ö†Ô∏è "+g(r),1))),128))])):k("",!0)]),t.exporting?(c(),d("div",So,[n("div",ko,[n("div",{class:"progress-fill",style:Ae({width:`${t.exportProgress}%`})},null,4)]),n("div",Eo," –≠–∫—Å–ø–æ—Ä—Ç: "+g(t.exportProgress)+"% ",1)])):k("",!0),n("div",Ao,[n("button",{onClick:e[7]||(e[7]=(...r)=>t.handleExport&&t.handleExport(...r)),disabled:t.exporting||!t.canExport,class:"btn-primary"},[t.exporting?(c(),d("span",Lo,"–≠–∫—Å–ø–æ—Ä—Ç...")):(c(),d("span",xo,"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"))],8,To),n("button",{onClick:e[8]||(e[8]=(...r)=>t.closeExportModal&&t.closeExportModal(...r)),disabled:t.exporting,class:"btn-secondary"}," –û—Ç–º–µ–Ω–∞ ",8,Io)])])])):k("",!0)]),_:1})])}const Do=F(Qs,[["render",Mo],["__scopeId","data-v-7ae66f8c"]]);function Po(o,e=300){let s;return function(...a){const i=()=>{clearTimeout(s),o(...a)};clearTimeout(s),s=setTimeout(i,e)}}const Uo={name:"WebhookLogSearch",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","search"],setup(o,{emit:e}){const s=C(o.modelValue||""),t=C(!1),a=C(null),i=Po(L=>{t.value=!1,e("search",L)},400),r=()=>{t.value=!0,e("update:modelValue",s.value),i(s.value)},l=()=>{t.value=!1,e("search",s.value)},u=()=>{s.value="",t.value=!1,a.value=null,e("update:modelValue",""),e("search","")};return Z(()=>o.modelValue,L=>{L!==s.value&&(s.value=L)}),{searchQuery:s,isSearching:t,searchResultsCount:a,handleSearchInput:r,handleSearch:l,clearSearch:u,setResultsCount:L=>{a.value=L},getResultsText:L=>{const E=L%10,b=L%100;return b>=11&&b<=19?"–∑–∞–ø–∏—Å–µ–π":E===1?"–∑–∞–ø–∏—Å—å":E>=2&&E<=4?"–∑–∞–ø–∏—Å–∏":"–∑–∞–ø–∏—Å–µ–π"},performSearch:(L,E)=>{if(!L||!E||!Array.isArray(E))return[];const b=L.toLowerCase().trim();return b.length===0?E:E.map(w=>Ce(w)).filter(w=>ce(w)).filter(w=>{if(w.event&&w.event.toLowerCase().includes(b)||w.category&&w.category.toLowerCase().includes(b)||w.ip&&w.ip.toLowerCase().includes(b)||w.details&&typeof w.details=="object"&&(w.details.task_id&&String(w.details.task_id).includes(b)||w.details.task_title&&w.details.task_title.toLowerCase().includes(b)||w.details.entity_id&&String(w.details.entity_id).includes(b)||w.details.title&&w.details.title.toLowerCase().includes(b)||w.details.comment_text&&w.details.comment_text.toLowerCase().includes(b)))return!0;if(w.payload&&typeof w.payload=="object")try{if(JSON.stringify(w.payload).toLowerCase().includes(b))return!0}catch{}return!1})},formatSearchResult:L=>{const E=[];if(L.event&&E.push(Se(L.event)),L.category&&E.push(ge(L.category)),L.details){const b=qe(L.details);b!=="‚Äî"&&E.push(b)}return E.join(" ‚Ä¢ ")}}}},No={class:"webhook-search"},Ro={class:"search-wrapper"},Fo={key:0,class:"search-indicator"},Oo={key:1,class:"search-results"};function Bo(o,e,s,t,a,i){return c(),d("div",No,[n("div",Ro,[e[5]||(e[5]=n("span",{class:"search-icon"},"üîç",-1)),X(n("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>t.searchQuery=r),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ª–æ–≥–æ–≤ (—Å–æ–±—ã—Ç–∏–µ, payload, IP, –¥–µ—Ç–∞–ª–∏)...",class:"search-input",onInput:e[1]||(e[1]=(...r)=>t.handleSearchInput&&t.handleSearchInput(...r)),onKeyup:[e[2]||(e[2]=Je((...r)=>t.handleSearch&&t.handleSearch(...r),["enter"])),e[3]||(e[3]=Je((...r)=>t.clearSearch&&t.clearSearch(...r),["esc"]))]},null,544),[[pe,t.searchQuery]]),t.searchQuery?(c(),d("button",{key:0,onClick:e[4]||(e[4]=(...r)=>t.clearSearch&&t.clearSearch(...r)),class:"clear-button",title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ (Esc)","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):k("",!0)]),t.isSearching?(c(),d("div",Fo,[...e[6]||(e[6]=[n("span",{class:"spinner"},null,-1),H(" –ü–æ–∏—Å–∫... ",-1)])])):k("",!0),t.searchQuery&&t.searchResultsCount!==null?(c(),d("div",Oo," –ù–∞–π–¥–µ–Ω–æ: "+g(t.searchResultsCount)+" "+g(t.getResultsText(t.searchResultsCount)),1)):k("",!0)])}const $o=F(Uo,[["render",Bo],["__scopeId","data-v-db228863"]]);function jo(o,e=null){const s=()=>{try{const r=localStorage.getItem(o);return r?JSON.parse(r):e}catch(r){return console.error(`Error loading ${o} from localStorage:`,r),e}},t=r=>{try{localStorage.setItem(o,JSON.stringify(r))}catch(l){console.error(`Error saving ${o} to localStorage:`,l)}},a=()=>{try{localStorage.removeItem(o)}catch(r){console.error(`Error clearing ${o} from localStorage:`,r)}},i=C(s());return Z(i,r=>{t(r)},{deep:!0}),{value:i,save:t,load:s,clear:a}}const Wo={name:"WebhookLogFilters",props:{filters:{type:Object,required:!0}},emits:["update:filters","reset"],setup(o,{emit:e}){const s=C(null),t=jo("webhook-filters",{category:null,event:null,dateFrom:null,dateTo:null,hour:null,ip:null,status:null}),a=h=>(s.value=null,We(h)?(e("update:filters",h),!0):(s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",console.error("[WebhookLogFilters] Validation error:",s.value),!1)),i=new Date().toISOString().split("T")[0],r=C({category:t.value.category||o.filters.category||null,event:t.value.event||o.filters.event||null,dateFrom:t.value.dateFrom||o.filters.dateFrom||o.filters.date||i,dateTo:t.value.dateTo||o.filters.dateTo||null,hour:t.value.hour!==void 0?t.value.hour:o.filters.hour!==void 0?o.filters.hour:null,ip:t.value.ip||o.filters.ip||null,status:t.value.status||o.filters.status||null}),l=C(null),u=[{id:"today",label:"–°–µ–≥–æ–¥–Ω—è",getDates:()=>({from:i,to:i})},{id:"yesterday",label:"–í—á–µ—Ä–∞",getDates:()=>{const h=new Date;h.setDate(h.getDate()-1);const v=h.toISOString().split("T")[0];return{from:v,to:v}}},{id:"last7days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",getDates:()=>{const h=new Date;return h.setDate(h.getDate()-7),{from:h.toISOString().split("T")[0],to:i}}},{id:"last30days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π",getDates:()=>{const h=new Date;return h.setDate(h.getDate()-30),{from:h.toISOString().split("T")[0],to:i}}}],m=h=>{const v=u.find(S=>S.id===h);if(v){const S=v.getDates();r.value.dateFrom=S.from,r.value.dateTo=S.to,l.value=h,P()}};Z(()=>o.filters,h=>{r.value={category:h.category||null,event:h.event||null,dateFrom:h.dateFrom||h.date||i,dateTo:h.dateTo||null,hour:h.hour!==void 0?h.hour:null,ip:h.ip||null,status:h.status||null}},{deep:!0}),Z(r,h=>{t.value={...h},e("update:filters",{...h})},{deep:!0});const p=A(()=>{const h={};return r.value.category&&(h.category=r.value.category),r.value.event&&(h.event=r.value.event),r.value.hour!==null&&(h.hour=r.value.hour),r.value.ip&&(h.ip=r.value.ip),r.value.status&&(h.status=r.value.status),r.value.dateFrom&&r.value.dateFrom!==i&&(h.dateFrom=r.value.dateFrom),r.value.dateTo&&(h.dateTo=r.value.dateTo),h}),f=A(()=>Object.keys(p.value).length>0),x=h=>({category:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è",event:"–°–æ–±—ã—Ç–∏–µ",hour:"–ß–∞—Å",ip:"IP –∞–¥—Ä–µ—Å",status:"–°—Ç–∞—Ç—É—Å",dateFrom:"–î–∞—Ç–∞ –æ—Ç",dateTo:"–î–∞—Ç–∞ –¥–æ"})[h]||h,L=(h,v)=>h==="category"?ge(v)||v:h==="hour"?`${String(v).padStart(2,"0")}:00`:h==="event"?Se(v)||v:h==="status"&&{success:"–£—Å–ø–µ—à–Ω–æ",error:"–û—à–∏–±–∫–∞",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"}[v]||v,E=A(()=>[{value:null,label:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},{value:"tasks",label:ge("tasks")},{value:"smart-processes",label:ge("smart-processes")},{value:"errors",label:ge("errors")}]),b=A(()=>[{value:null,label:"–í—Å–µ —Å–æ–±—ã—Ç–∏—è"},...["ONTASKADD","ONTASKUPDATE","ONTASKDELETE","ONTASKCOMMENTADD","ONTASKCOMMENTUPDATE","ONTASKCOMMENTDELETE","ONCRMDYNAMICITEMADD","ONCRMDYNAMICITEMUPDATE","ONCRMDYNAMICITEMDELETE"].map(v=>({value:v,label:Se(v)}))]),T=h=>{h==="hour"?r.value[h]=null:h==="dateFrom"?r.value[h]=i:r.value[h]=null,l.value=null},w=h=>{const v={...r.value,category:h||null};a(v)&&(r.value.category=h)},I=h=>{const v={...r.value,event:h||null};a(v)&&(r.value.event=h)},D=(h,v)=>{if(h&&!/^\d{4}-\d{2}-\d{2}$/.test(h)){console.error("[WebhookLogFilters] Invalid date format:",h),s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã";return}const S={...r.value,[v]:h||null};a(S)&&(r.value[v]=h)},j=h=>{if(h!=null){const S=parseInt(h,10);if(isNaN(S)||S<0||S>23){console.error("[WebhookLogFilters] Invalid hour:",h),s.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∞—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23)";return}}const v={...r.value,hour:h!=null?parseInt(h,10):null};a(v)&&(r.value.hour=h!=null?parseInt(h,10):null)},P=()=>{a({...r.value})},_=()=>{r.value={category:null,event:null,dateFrom:i,dateTo:null,hour:null,ip:null,status:null},l.value=null,t.clear(),e("reset")};return ee(()=>{t.value&&Object.keys(t.value).length>0&&e("update:filters",{...t.value})}),{localFilters:r,activeFilters:p,hasActiveFilters:f,getFilterLabel:x,getFilterValue:L,clearFilter:T,handleFilterChange:P,handleCategoryChange:w,handleEventChange:I,handleDateChange:D,handleHourChange:j,handleReset:_,quickFilters:u,activeQuickFilter:l,applyQuickFilter:m,categoryOptions:E,eventOptions:b,validationError:s}}},zo={class:"webhook-log-filters"},Vo={key:0,class:"active-filters-indicator"},qo=["onClick"],Ho={key:1,class:"validation-error"},Xo={class:"quick-filters"},Jo=["onClick"],Ko={class:"filters-row"},Yo={class:"filter-group"},Go=["value"],Qo={class:"filter-group"},Zo=["value"],en={class:"filter-group"},tn={class:"filter-group"},sn={class:"filter-group"},on={class:"filter-group"},nn={class:"filter-group"};function rn(o,e,s,t,a,i){return c(),d("div",zo,[t.hasActiveFilters?(c(),d("div",Vo,[e[14]||(e[14]=n("span",{class:"indicator-text"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(z,null,V(t.activeFilters,(r,l)=>(c(),d("span",{key:l,class:"filter-badge"},[H(g(t.getFilterLabel(l))+": "+g(t.getFilterValue(l,r))+" ",1),n("button",{onClick:u=>t.clearFilter(l),class:"filter-badge-remove",title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"}," √ó ",8,qo)]))),128)),n("button",{onClick:e[0]||(e[0]=(...r)=>t.handleReset&&t.handleReset(...r)),class:"btn-clear-all"}," –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ ")])):k("",!0),t.validationError?(c(),d("div",Ho," ‚ö†Ô∏è "+g(t.validationError),1)):k("",!0),n("div",Xo,[e[15]||(e[15]=n("span",{class:"quick-filters-label"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(z,null,V(t.quickFilters,r=>(c(),d("button",{key:r.id,onClick:l=>t.applyQuickFilter(r.id),class:$(["quick-filter-btn",{active:t.activeQuickFilter===r.id}])},g(r.label),11,Jo))),128))]),n("div",Ko,[n("div",Yo,[e[16]||(e[16]=n("label",{for:"category-filter"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è:",-1)),X(n("select",{id:"category-filter","onUpdate:modelValue":e[1]||(e[1]=r=>t.localFilters.category=r),onChange:e[2]||(e[2]=r=>t.handleCategoryChange(t.localFilters.category)),class:"filter-select"},[(c(!0),d(z,null,V(t.categoryOptions,r=>(c(),d("option",{key:r.value,value:r.value},g(r.label),9,Go))),128))],544),[[ye,t.localFilters.category]])]),n("div",Qo,[e[17]||(e[17]=n("label",{for:"event-filter"},"–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:",-1)),X(n("select",{id:"event-filter","onUpdate:modelValue":e[3]||(e[3]=r=>t.localFilters.event=r),onChange:e[4]||(e[4]=r=>t.handleEventChange(t.localFilters.event)),class:"filter-select"},[(c(!0),d(z,null,V(t.eventOptions,r=>(c(),d("option",{key:r.value,value:r.value},g(r.label),9,Zo))),128))],544),[[ye,t.localFilters.event]])]),n("div",en,[e[18]||(e[18]=n("label",{for:"date-from-filter"},"–î–∞—Ç–∞ –æ—Ç:",-1)),X(n("input",{id:"date-from-filter","onUpdate:modelValue":e[5]||(e[5]=r=>t.localFilters.dateFrom=r),type:"date",onChange:e[6]||(e[6]=r=>t.handleDateChange(t.localFilters.dateFrom,"dateFrom")),class:"filter-input"},null,544),[[pe,t.localFilters.dateFrom]])]),n("div",tn,[e[19]||(e[19]=n("label",{for:"date-to-filter"},"–î–∞—Ç–∞ –¥–æ:",-1)),X(n("input",{id:"date-to-filter","onUpdate:modelValue":e[7]||(e[7]=r=>t.localFilters.dateTo=r),type:"date",onChange:e[8]||(e[8]=r=>t.handleDateChange(t.localFilters.dateTo,"dateTo")),class:"filter-input"},null,544),[[pe,t.localFilters.dateTo]])]),n("div",sn,[e[20]||(e[20]=n("label",{for:"ip-filter"},"IP –∞–¥—Ä–µ—Å:",-1)),X(n("input",{id:"ip-filter","onUpdate:modelValue":e[9]||(e[9]=r=>t.localFilters.ip=r),type:"text",placeholder:"192.168.1.1",onInput:e[10]||(e[10]=(...r)=>t.handleFilterChange&&t.handleFilterChange(...r)),class:"filter-input"},null,544),[[pe,t.localFilters.ip]])]),n("div",on,[e[22]||(e[22]=n("label",{for:"status-filter"},"–°—Ç–∞—Ç—É—Å:",-1)),X(n("select",{id:"status-filter","onUpdate:modelValue":e[11]||(e[11]=r=>t.localFilters.status=r),onChange:e[12]||(e[12]=(...r)=>t.handleFilterChange&&t.handleFilterChange(...r)),class:"filter-select"},[...e[21]||(e[21]=[n("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),n("option",{value:"success"},"–£—Å–ø–µ—à–Ω–æ",-1),n("option",{value:"error"},"–û—à–∏–±–∫–∞",-1),n("option",{value:"warning"},"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",-1)])],544),[[ye,t.localFilters.status]])]),n("div",nn,[n("button",{onClick:e[13]||(e[13]=(...r)=>t.handleReset&&t.handleReset(...r)),class:"btn-reset"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])])}const an=F(Wo,[["render",rn],["__scopeId","data-v-2a150a46"]]),ln={name:"WebhookLogList",props:{logs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null},pagination:{type:Object,default:null},selectedLogs:{type:Array,default:()=>[]}},emits:["select-log","page-change","update:selectedLogs"],setup(o,{emit:e}){const s=A(()=>!o.logs||!Array.isArray(o.logs)?(console.warn("[WebhookLogList] Invalid logs prop:",o.logs),[]):o.logs.map(v=>Ce(v)).filter(v=>ce(v)?!0:(console.warn("[WebhookLogList] Invalid log entry:",v),!1))),t=C("timestamp"),a=C("desc"),i=v=>{t.value===v?a.value=a.value==="asc"?"desc":"asc":(t.value=v,a.value="desc")},r=A(()=>!s.value||s.value.length===0?[]:[...s.value].sort((S,O)=>{let M,U;switch(t.value){case"timestamp":M=new Date(S.timestamp||0).getTime(),U=new Date(O.timestamp||0).getTime();break;case"event":M=(S.event||"").toLowerCase(),U=(O.event||"").toLowerCase();break;case"category":M=(S.category||"").toLowerCase(),U=(O.category||"").toLowerCase();break;case"ip":M=(S.ip||"").toLowerCase(),U=(O.ip||"").toLowerCase();break;default:return 0}return M<U?a.value==="asc"?-1:1:M>U?a.value==="asc"?1:-1:0})),l=v=>t.value!==v?"‚ÜïÔ∏è":a.value==="asc"?"‚Üë":"‚Üì",u=v=>v.category==="errors"?"status-error":"status-success",m=v=>v.category==="errors"?"‚ùå":"‚úÖ",p=v=>v.category==="errors"?"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏":"–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ",f=v=>`${v.timestamp}_${v.event}_${v.ip||"unknown"}`,x=v=>v?Ve(v,"short"):"‚Äî",L=v=>v?Se(v):"‚Äî",E=v=>v?ge(v):"‚Äî",b=v=>!v||typeof v!="object"?"‚Äî":qe(v),T=v=>`category-${v}`,w=v=>v?.startsWith("ONTASK")?"event-task":v?.startsWith("ONCRMDYNAMIC")?"event-smart-process":"event-other",I=v=>{e("select-log",v)},D=v=>{v>=1&&v<=o.pagination.pages&&e("page-change",v)},j=v=>o.selectedLogs.some(S=>f(S)===f(v)),P=(v,S)=>{S.stopPropagation();const O=[...o.selectedLogs],M=f(v),U=O.findIndex(K=>f(K)===M);S.target.checked?U===-1&&O.push(v):U!==-1&&O.splice(U,1),e("update:selectedLogs",O)},_=v=>{v.target.checked?e("update:selectedLogs",[...o.logs]):e("update:selectedLogs",[])},h=A(()=>s.value.length>0&&s.value.every(v=>j(v)));return Z(()=>o.logs,v=>{if(v&&Array.isArray(v)){const S=v.filter(O=>!ce(O)).length;S>0&&console.warn(`[WebhookLogList] Received ${S} invalid log entries out of ${v.length}`)}},{immediate:!0}),{validatedLogs:s,sortBy:t,sortOrder:a,sortedLogs:r,handleSort:i,getSortIcon:l,getStatusClass:u,getStatusIcon:m,getStatusTitle:p,getLogId:f,formatTimestamp:x,formatEvent:L,formatCategoryLabel:E,formatDetailsPreview:b,getCategoryClass:T,getEventClass:w,handleLogClick:I,handlePageChange:D,isSelected:j,handleSelectLog:P,handleSelectAll:_,allSelected:h}}},cn={class:"webhook-log-list"},dn={key:0,class:"logs-table-container"},un={class:"logs-table"},gn={class:"checkbox-header"},fn=["checked"],mn={class:"sort-icon"},hn={class:"sort-icon"},vn={class:"sort-icon"},pn={class:"sort-icon"},yn=["onClick"],_n=["checked","onChange"],wn=["title"],bn={class:"details-preview"},Cn=["onClick"],Sn={key:0,class:"pagination"},kn=["disabled"],En={class:"pagination-info"},An=["disabled"];function Tn(o,e,s,t,a,i){return c(),d("div",cn,[s.logs.length>0?(c(),d("div",dn,[n("table",un,[n("thead",null,[n("tr",null,[n("th",gn,[n("input",{type:"checkbox",checked:t.allSelected,onChange:e[0]||(e[0]=(...r)=>t.handleSelectAll&&t.handleSelectAll(...r)),onClick:e[1]||(e[1]=fe(()=>{},["stop"])),class:"checkbox-input",title:"–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"},null,40,fn)]),n("th",{onClick:e[2]||(e[2]=r=>t.handleSort("timestamp")),class:$(["sortable",{"sort-asc":t.sortBy==="timestamp"&&t.sortOrder==="asc","sort-desc":t.sortBy==="timestamp"&&t.sortOrder==="desc"}])},[e[9]||(e[9]=H(" –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è ",-1)),n("span",mn,g(t.getSortIcon("timestamp")),1)],2),n("th",{onClick:e[3]||(e[3]=r=>t.handleSort("event")),class:$(["sortable",{"sort-asc":t.sortBy==="event"&&t.sortOrder==="asc","sort-desc":t.sortBy==="event"&&t.sortOrder==="desc"}])},[e[10]||(e[10]=H(" –¢–∏–ø —Å–æ–±—ã—Ç–∏—è ",-1)),n("span",hn,g(t.getSortIcon("event")),1)],2),n("th",{onClick:e[4]||(e[4]=r=>t.handleSort("category")),class:$(["sortable",{"sort-asc":t.sortBy==="category"&&t.sortOrder==="asc","sort-desc":t.sortBy==="category"&&t.sortOrder==="desc"}])},[e[11]||(e[11]=H(" –ö–∞—Ç–µ–≥–æ—Ä–∏—è ",-1)),n("span",vn,g(t.getSortIcon("category")),1)],2),n("th",{onClick:e[5]||(e[5]=r=>t.handleSort("ip")),class:$(["sortable",{"sort-asc":t.sortBy==="ip"&&t.sortOrder==="asc","sort-desc":t.sortBy==="ip"&&t.sortOrder==="desc"}])},[e[12]||(e[12]=H(" IP ",-1)),n("span",pn,g(t.getSortIcon("ip")),1)],2),e[13]||(e[13]=n("th",null,"–î–µ—Ç–∞–ª–∏",-1)),e[14]||(e[14]=n("th",null,"–î–µ–π—Å—Ç–≤–∏—è",-1))])]),n("tbody",null,[(c(!0),d(z,null,V(t.sortedLogs,r=>(c(),d("tr",{key:t.getLogId(r),onClick:l=>t.handleLogClick(r),class:$(["log-row",{"row-selected":t.isSelected(r)}])},[n("td",{onClick:e[6]||(e[6]=fe(()=>{},["stop"]))},[n("input",{type:"checkbox",checked:t.isSelected(r),onChange:l=>t.handleSelectLog(r,l),class:"checkbox-input"},null,40,_n)]),n("td",null,g(t.formatTimestamp(r.timestamp)),1),n("td",null,[n("span",{class:$(["status-indicator",t.getStatusClass(r)]),title:t.getStatusTitle(r)},g(t.getStatusIcon(r)),11,wn),n("span",{class:$(["event-badge",t.getEventClass(r.event)])},g(t.formatEvent(r.event)),3)]),n("td",null,[n("span",{class:$(["category-badge",t.getCategoryClass(r.category)])},g(t.formatCategoryLabel(r.category)),3)]),n("td",null,g(r.ip||"N/A"),1),n("td",null,[n("div",bn,g(t.formatDetailsPreview(r.details)),1)]),n("td",null,[n("button",{onClick:fe(l=>t.handleLogClick(r),["stop"]),class:"btn-view"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,Cn)])],10,yn))),128))])]),s.pagination&&s.pagination.pages>1?(c(),d("div",Sn,[n("button",{onClick:e[7]||(e[7]=r=>t.handlePageChange(s.pagination.page-1)),disabled:s.pagination.page<=1,class:"btn-pagination"}," –ù–∞–∑–∞–¥ ",8,kn),n("span",En," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+g(s.pagination.page)+" –∏–∑ "+g(s.pagination.pages)+" (–≤—Å–µ–≥–æ: "+g(s.pagination.total)+") ",1),n("button",{onClick:e[8]||(e[8]=r=>t.handlePageChange(s.pagination.page+1)),disabled:s.pagination.page>=s.pagination.pages,class:"btn-pagination"}," –í–ø–µ—Ä—ë–¥ ",8,An)])):k("",!0)])):k("",!0)])}const Ln=F(ln,[["render",Tn],["__scopeId","data-v-fddd3018"]]),xn={name:"LoadingSkeleton",props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"20px"},variant:{type:String,default:"rect",validator:o=>["rect","circle","text","table-row"].includes(o)},animated:{type:Boolean,default:!0},borderRadius:{type:String,default:null}},setup(o){return{skeletonStyle:A(()=>{const s={width:typeof o.width=="number"?`${o.width}px`:o.width,height:typeof o.height=="number"?`${o.height}px`:o.height};return o.borderRadius&&(s.borderRadius=o.borderRadius),s})}}},In={key:0,class:"skeleton-shimmer"};function Mn(o,e,s,t,a,i){return c(),d("div",{class:$(["skeleton",[`skeleton-${s.variant}`,{"skeleton-animated":s.animated}]]),style:Ae(t.skeletonStyle)},[s.animated?(c(),d("div",In)):k("",!0)],6)}const Dn=F(xn,[["render",Mn],["__scopeId","data-v-014f86e6"]]),Pn={name:"SkeletonLogList",components:{LoadingSkeleton:Dn},props:{rows:{type:Number,default:5}},setup(){return{getColumnWidth:e=>["40px","15%","20%","15%","15%","20%","15%"][e-1]||"100%"}}},Un={class:"skeleton-log-list"},Nn={class:"skeleton-table-header"};function Rn(o,e,s,t,a,i){const r=B("LoadingSkeleton");return c(),d("div",Un,[n("div",Nn,[(c(),d(z,null,V(7,l=>W(r,{key:l,width:"120px",height:"16px",variant:"text"})),64))]),(c(!0),d(z,null,V(s.rows,l=>(c(),d("div",{key:l,class:"skeleton-table-row"},[(c(),d(z,null,V(7,u=>W(r,{key:u,width:"100%",height:"20px",variant:"text",style:Ae({width:t.getColumnWidth(u)})},null,8,["style"])),64))]))),128))])}const Fn=F(Pn,[["render",Rn],["__scopeId","data-v-475c4e73"]]),On={name:"EmptyState",props:{icon:{type:String,default:"üì≠"},title:{type:String,required:!0},description:{type:String,required:!0},actionLabel:{type:String,default:null},actions:{type:Array,default:null},hints:{type:Array,default:()=>[]},variant:{type:String,default:"default",validator:o=>["default","error","warning","info"].includes(o)}},emits:["action","action-click"]},Bn={class:"empty-icon"},$n={class:"empty-title"},jn={class:"empty-description"},Wn={key:0,class:"empty-hints"},zn={key:1,class:"empty-actions"},Vn=["onClick"];function qn(o,e,s,t,a,i){return c(),d("div",{class:$(["empty-state",`empty-state-${s.variant}`])},[n("div",Bn,g(s.icon),1),n("h3",$n,g(s.title),1),n("p",jn,g(s.description),1),s.hints&&s.hints.length>0?(c(),d("div",Wn,[(c(!0),d(z,null,V(s.hints,(r,l)=>(c(),d("div",{key:l,class:"hint-item"}," üí° "+g(r),1))),128))])):k("",!0),s.actionLabel||s.actions?(c(),d("div",zn,[s.actionLabel?(c(),d("button",{key:0,onClick:e[0]||(e[0]=r=>o.$emit("action")),class:"btn-primary"},g(s.actionLabel),1)):k("",!0),(c(!0),d(z,null,V(s.actions,(r,l)=>(c(),d("button",{key:l,onClick:u=>o.$emit("action-click",r.id),class:$(["btn",`btn-${r.variant||"secondary"}`])},g(r.label),11,Vn))),128))])):k("",!0)],2)}const Hn=F(On,[["render",qn],["__scopeId","data-v-081c13b9"]]),Xn={name:"ErrorDisplay",props:{title:{type:String,default:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"},message:{type:String,required:!0},details:{type:String,default:null},severity:{type:String,default:"error",validator:o=>["error","warning","critical"].includes(o)},retryable:{type:Boolean,default:!1}},emits:["retry"],setup(){return{showDetails:C(!1)}}},Jn={class:"error-icon"},Kn={class:"error-content"},Yn={class:"error-title"},Gn={class:"error-message"},Qn={key:0,class:"error-details"},Zn={class:"error-actions"};function er(o,e,s,t,a,i){return c(),d("div",{class:$(["error-display",`error-${s.severity}`])},[n("div",Jn,g(s.severity==="critical"?"üö®":"‚ö†Ô∏è"),1),n("div",Kn,[n("h4",Yn,g(s.title),1),n("p",Gn,g(s.message),1),s.details&&t.showDetails?(c(),d("div",Qn,[n("pre",null,g(s.details),1)])):k("",!0),n("div",Zn,[s.retryable?(c(),d("button",{key:0,onClick:e[0]||(e[0]=r=>o.$emit("retry")),class:"btn-retry"}," üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")):k("",!0),s.details?(c(),d("button",{key:1,onClick:e[1]||(e[1]=r=>t.showDetails=!t.showDetails),class:"btn-details"},g(t.showDetails?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å")+" –¥–µ—Ç–∞–ª–∏ ",1)):k("",!0)])])],2)}const tr=F(Xn,[["render",er],["__scopeId","data-v-3f2f4c14"]]),ke=C([]);let sr=0;function at(){const o=(l,u="info",m=3e3)=>{const p=++sr,f={id:p,message:l,type:u,duration:m,timestamp:Date.now()};return ke.value.push(f),m>0&&setTimeout(()=>{e(p)},m),p},e=l=>{const u=ke.value.findIndex(m=>m.id===l);u>-1&&ke.value.splice(u,1)};return{notifications:ke,showNotification:o,removeNotification:e,clearNotifications:()=>{ke.value=[]},success:(l,u=3e3)=>o(l,"success",u),error:(l,u=5e3)=>o(l,"error",u),warning:(l,u=4e3)=>o(l,"warning",u),info:(l,u=3e3)=>o(l,"info",u)}}const or={name:"Notification",props:{notification:{type:Object,required:!0}},emits:["close"],setup(o,{emit:e}){const s=C(100),t=A(()=>o.notification.duration>0);let a=null;const i={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},r=A(()=>i[o.notification.type]||"‚ÑπÔ∏è"),l=()=>{e("close")},u=()=>{o.notification.onClick&&o.notification.onClick()};return ee(()=>{if(t.value&&o.notification.duration>0){const m=Date.now(),p=o.notification.duration;a=setInterval(()=>{const f=Date.now()-m;s.value=Math.max(0,100-f/p*100),s.value<=0&&(clearInterval(a),l())},50)}}),Ne(()=>{a&&clearInterval(a)}),{icon:r,progress:s,showProgress:t,close:l,handleClick:u}}},nr={class:"notification-content"},rr={class:"notification-icon"},ar={class:"notification-message"},ir={key:0,class:"notification-progress"};function lr(o,e,s,t,a,i){return c(),d("div",{class:$(["notification",`notification-${s.notification.type}`]),onClick:e[1]||(e[1]=(...r)=>t.handleClick&&t.handleClick(...r))},[n("div",nr,[n("span",rr,g(t.icon),1),n("span",ar,g(s.notification.message),1)]),n("button",{onClick:e[0]||(e[0]=fe((...r)=>t.close&&t.close(...r),["stop"])),class:"notification-close"},"‚úï"),t.showProgress?(c(),d("div",ir,[n("div",{class:"progress-bar",style:Ae({width:`${t.progress}%`})},null,4)])):k("",!0)],2)}const cr=F(or,[["render",lr],["__scopeId","data-v-1b602bdf"]]),dr={name:"NotificationContainer",components:{Notification:cr},setup(){const{notifications:o,removeNotification:e}=at();return{notifications:o,removeNotification:e}}},ur={class:"notification-container"};function gr(o,e,s,t,a,i){const r=B("Notification");return c(),J(Tt,{to:"body"},[n("div",ur,[W(At,{name:"notification",tag:"div"},{default:oe(()=>[(c(!0),d(z,null,V(t.notifications,l=>(c(),J(r,{key:l.id,notification:l,onClose:u=>t.removeNotification(l.id)},null,8,["notification","onClose"]))),128))]),_:1})])])}const fr=F(dr,[["render",gr],["__scopeId","data-v-dd8772c8"]]),mr={name:"RealtimeControls",props:{enabled:{type:Boolean,default:!1},connectionState:{type:String,default:"disconnected"},error:{type:String,default:null}},emits:["toggle"],setup(o,{emit:e}){const s=C(o.enabled);Z(()=>o.enabled,f=>{s.value=f});const t=A(()=>o.connectionState==="connecting"),a=A(()=>!!o.error),i=A(()=>({"status-connected":o.connectionState==="connected","status-connecting":o.connectionState==="connecting","status-disconnected":o.connectionState==="disconnected","status-error":o.connectionState==="error"})),r=A(()=>{switch(o.connectionState){case"connected":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";case"connecting":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...";case"disconnected":return"–û—Ç–∫–ª—é—á–µ–Ω–æ";case"error":return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}}),l=A(()=>r.value),u=A(()=>({"status-connected":o.connectionState==="connected","status-connecting":o.connectionState==="connecting","status-disconnected":o.connectionState==="disconnected","status-error":o.connectionState==="error"})),m=A(()=>o.error?typeof o.error=="string"?o.error:o.error.message?o.error.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞":null);return{localEnabled:s,isConnecting:t,hasError:a,statusClass:i,statusText:r,connectionStatusText:l,connectionStatusClass:u,displayError:m,handleToggle:()=>{e("toggle",s.value)}}}},hr={class:"realtime-controls"},vr={class:"control-toggle"},pr=["disabled"],yr={class:"status-text"},_r={key:0,class:"error-message"};function wr(o,e,s,t,a,i){return c(),d("div",hr,[n("label",vr,[X(n("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=r=>t.localEnabled=r),onChange:e[1]||(e[1]=(...r)=>t.handleToggle&&t.handleToggle(...r)),disabled:t.isConnecting},null,40,pr),[[Qe,t.localEnabled]]),e[2]||(e[2]=n("span",{class:"toggle-label"},"–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",-1))]),n("div",{class:$(["status-indicator",t.statusClass])},[e[3]||(e[3]=n("span",{class:"status-dot"},null,-1)),n("span",yr,g(t.statusText),1)],2),t.hasError&&t.displayError?(c(),d("div",_r," ‚ö†Ô∏è "+g(t.displayError),1)):k("",!0)])}const br=F(mr,[["render",wr],["__scopeId","data-v-af36f073"]]),Cr={name:"NewLogsIndicator",props:{count:{type:Number,default:0},newLogs:{type:Array,default:()=>[]}},emits:["apply","dismiss"],setup(o,{emit:e}){const s=(r,l,u,m)=>{const p=r%10,f=r%100;return f>=11&&f<=19?m:p===1?l:p>=2&&p<=4?u:m},t=A(()=>!o.newLogs||!Array.isArray(o.newLogs)||o.newLogs.length===0?[]:o.newLogs.map(l=>Ce(l)).filter(l=>ce(l)).slice(0,5).map(l=>({...l,formatted:{event:Se(l.event),category:ge(l.category)}})));return{pluralize:s,newLogsPreview:t,handleApply:()=>{if(!o.newLogs||o.newLogs.length===0)return;const r=o.newLogs.map(l=>Ce(l)).filter(l=>ce(l));if(r.length===0){console.warn("[NewLogsIndicator] No valid logs to apply");return}e("apply",r)},handleDismiss:()=>{e("dismiss")}}}},Sr={key:0,class:"new-logs-indicator"},kr={class:"indicator-content"},Er={class:"indicator-text"},Ar={class:"indicator-actions"};function Tr(o,e,s,t,a,i){return c(),J(de,{name:"slide-down"},{default:oe(()=>[s.count>0?(c(),d("div",Sr,[n("div",kr,[e[2]||(e[2]=n("span",{class:"indicator-icon"},"üîî",-1)),n("span",Er,g(s.count)+" "+g(t.pluralize(s.count,"–Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π")),1),n("div",Ar,[n("button",{onClick:e[0]||(e[0]=(...r)=>t.handleApply&&t.handleApply(...r)),class:"btn-apply"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å "),n("button",{onClick:e[1]||(e[1]=(...r)=>t.handleDismiss&&t.handleDismiss(...r)),class:"btn-dismiss"}," ‚úï ")])])])):k("",!0)]),_:1})}const Lr=F(Cr,[["render",Tr],["__scopeId","data-v-19791dbc"]]);class xr{constructor(e,s={}){this.url=e,this.options={reconnectInterval:3e3,maxReconnectAttempts:10,reconnectDelay:1e3,lastTimestamp:null,...s},this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.reconnectTimer=null,this.isManualDisconnect=!1,this.connectionState="disconnected"}updateOptions(e){this.options={...this.options,...e}}connect(){if(this.connectionState==="connected"||this.connectionState==="connecting"){console.warn("[RealtimeService] Already connected or connecting");return}this.isManualDisconnect=!1,this.connectionState="connecting",this.notifyListeners("state-change",{state:this.connectionState});try{let e=this.url;if(!e.startsWith("http://")&&!e.startsWith("https://")){const s=new URL(e,window.location.origin);this.options.lastTimestamp&&s.searchParams.set("last_timestamp",this.options.lastTimestamp),e=s.toString()}else{const s=new URL(e);this.options.lastTimestamp&&s.searchParams.set("last_timestamp",this.options.lastTimestamp),e=s.toString()}console.log("[RealtimeService] Connecting to:",e),this.eventSource=new EventSource(e),this.eventSource.onopen=()=>{console.log("[RealtimeService] EventSource opened"),this.notifyListeners("open",{timestamp:new Date().toISOString()})},this.eventSource.onmessage=s=>{try{const t=JSON.parse(s.data);this.notifyListeners("message",t)}catch(t){console.error("[RealtimeService] Error parsing message:",t)}},this.eventSource.addEventListener("connected",s=>{try{const t=JSON.parse(s.data);console.log("[RealtimeService] Connected event received:",t),this.connectionState="connected",this.reconnectAttempts=0,this.notifyListeners("connected",t),this.notifyListeners("state-change",{state:this.connectionState})}catch(t){console.error("[RealtimeService] Error parsing connected event:",t)}}),this.eventSource.addEventListener("new_logs",s=>{const t=JSON.parse(s.data);if(t.logs&&t.logs.length>0){const a=t.logs[t.logs.length-1];a.timestamp&&(this.options.lastTimestamp=a.timestamp)}this.notifyListeners("new_logs",t)}),this.eventSource.addEventListener("error",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("error",t)}catch{this.notifyListeners("error",{message:"Server error"})}}),this.eventSource.addEventListener("timeout",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("timeout",t)}catch{this.notifyListeners("timeout",{message:"Connection timeout"})}this.reconnect()}),this.eventSource.addEventListener("closed",s=>{try{const t=JSON.parse(s.data);this.notifyListeners("closed",t)}catch{this.notifyListeners("closed",{message:"Connection closed"})}this.isManualDisconnect||this.reconnect()}),this.eventSource.onerror=s=>{console.error("[RealtimeService] Connection error:",s),console.error("[RealtimeService] EventSource readyState:",this.eventSource?.readyState),this.eventSource?.readyState===EventSource.CLOSED?(console.log("[RealtimeService] EventSource closed by server"),this.connectionState="disconnected",this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()):this.eventSource?.readyState===EventSource.CONNECTING?console.log("[RealtimeService] Still connecting..."):(this.connectionState="error",this.notifyListeners("error",{error:s,type:"connection",message:"Failed to connect to realtime stream",readyState:this.eventSource?.readyState}),this.notifyListeners("state-change",{state:this.connectionState}),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isManualDisconnect||this.reconnect())}}catch(e){console.error("[RealtimeService] Error creating EventSource:",e),this.connectionState="error",this.notifyListeners("error",{error:e,type:"initialization"}),this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()}}reconnect(){if(this.isManualDisconnect)return;if(this.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("[RealtimeService] Max reconnect attempts reached"),this.notifyListeners("max-reconnect-attempts",{attempts:this.reconnectAttempts});return}this.reconnectAttempts++;const e=Math.min(this.options.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.options.reconnectInterval);console.log(`[RealtimeService] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},e)}disconnect(){this.isManualDisconnect=!0,this.connectionState="disconnected",this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.notifyListeners("disconnected",{timestamp:new Date().toISOString()}),this.notifyListeners("state-change",{state:this.connectionState})}on(e,s){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(s)}off(e,s){if(this.listeners.has(e)){const t=this.listeners.get(e),a=t.indexOf(s);a>-1&&t.splice(a,1)}}notifyListeners(e,s){this.listeners.has(e)&&this.listeners.get(e).forEach(t=>{try{t(s)}catch(a){console.error(`[RealtimeService] Error in listener for ${e}:`,a)}})}getState(){return this.connectionState}isConnected(){return this.connectionState==="connected"}}function Ir(o,e={}){const{autoConnect:s=!1,enableSound:t=!1,onNewLogs:a=null,validateLogs:i=!0}=e,r=new xr(o,e),l=C("disconnected"),u=C([]),m=C(0),p=C(null),f=C(null),x=C(0),L=A(()=>l.value==="connected"),E=A(()=>l.value==="connecting"),b=A(()=>l.value==="error"),T=A(()=>m.value>0),w=M=>{l.value=M.state,M.state==="connected"&&(x.value=0,f.value=null)},I=M=>{let U=M.logs||[];if(i){U=ze(U);const K=U.filter(Fe=>ce(Fe));K.length!==U.length&&console.warn("[useRealtime] Filtered out invalid logs:",U.length-K.length),U=K}U.length!==0&&(u.value.push(...U),m.value+=U.length,p.value=new Date().toISOString(),t&&U.length>0&&O(),a&&a(U))},D=M=>{const U=M.message||M.error?.message||"Connection error";f.value=U,l.value="error",console.error("[useRealtime] Error:",M)},j=M=>{console.warn("[useRealtime] Connection timeout:",M)},P=M=>{f.value=`Max reconnect attempts reached (${M.attempts})`,console.error("[useRealtime] Max reconnect attempts:",M)},_=(M={})=>{f.value=null,M.lastTimestamp!==void 0&&r.updateOptions({lastTimestamp:M.lastTimestamp}),r.on("state-change",w),r.on("new_logs",I),r.on("error",D),r.on("timeout",j),r.on("max-reconnect-attempts",P),r.connect()},h=()=>{r.off("state-change",w),r.off("new_logs",I),r.off("error",D),r.off("timeout",j),r.off("max-reconnect-attempts",P),r.disconnect()},v=()=>{u.value=[],m.value=0},S=M=>{M&&Array.isArray(M)&&(M.unshift(...u.value),v())},O=()=>{try{const M=new Audio("/sounds/notification.mp3");M.volume=.3,M.play().catch(U=>{console.warn("[useRealtime] Failed to play sound:",U)})}catch(M){console.warn("[useRealtime] Sound not available:",M)}};return s&&ee(()=>{_()}),Ne(()=>{h()}),{connectionState:l,isConnected:L,isConnecting:E,hasError:b,newLogs:u,newLogsCount:m,hasNewLogs:T,lastUpdateTime:p,error:f,reconnectAttempts:x,connect:_,disconnect:h,clearNewLogs:v,applyNewLogs:S}}const Mr=Ze(()=>te(()=>import("./WebhookLogsDashboard.vue-C6UkRP7A.js"),__vite__mapDeps([5,4,1,2]),import.meta.url)),Dr=Ze(()=>te(()=>import("./WebhookLogDetails.vue-otR-m5BI.js"),__vite__mapDeps([6,4,1,2]),import.meta.url)),Pr={name:"WebhookLogsPage",components:{WebhookLogsDashboard:Mr,WebhookLogsExport:Do,WebhookLogSearch:$o,WebhookLogFilters:an,WebhookLogList:Ln,WebhookLogDetails:Dr,SkeletonLogList:Fn,EmptyState:Hn,ErrorDisplay:tr,NotificationContainer:fr,RealtimeControls:br,NewLogsIndicator:Lr},setup(){const o=Ee(),{success:e,error:s}=at(),t=C(!1),a=C(!1),i=C(null),r=C(null),l=C([]),u=(y,N=2)=>{if(y==null)return String(y);if(typeof y=="string")return y;const q=(R,Q=0)=>{if(Q>10)return"[Max Depth]";if(R==null||typeof R!="object")return R;if(Array.isArray(R))return R.map(Y=>q(Y,Q+1));const ne={};try{for(const Y in R)if(Object.prototype.hasOwnProperty.call(R,Y))try{const Le=R[Y];if(typeof Le=="function"||Le===void 0)continue;ne[Y]=q(Le,Q+1)}catch{ne[Y]="[Error reading property]"}}catch{return"[Error reading object]"}return ne};try{const R=q(y),Q=new WeakSet;return JSON.stringify(R,(ne,Y)=>{if(typeof Y=="object"&&Y!==null){if(Q.has(Y))return"[Circular]";Q.add(Y)}return Y},N)}catch(R){return console.error("[WebhookLogsPage] Error in safeStringify:",R),`[Error: ${R.message}]`}},m=C(null),p=C([]),f=C(""),x=C(null),L=C(null),E=C(!1),{connectionState:b,newLogsCount:T,error:w,connect:I,disconnect:D,applyNewLogs:j,clearNewLogs:P}=Ir(ie("/api/webhook-realtime.php"),{autoConnect:!1,enableSound:!0,validateLogs:!0,onNewLogs:y=>{console.log("[WebhookLogsPage] New logs received:",y.length),y.length>0&&(l.value.unshift(...y),S.value.total+=y.length,e(`–ü–æ–ª—É—á–µ–Ω–æ ${y.length} –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π`))}}),{filters:_,updateFilters:h,clearFilters:v}=zs(),S=C({page:1,limit:50,total:0,pages:0}),O=A(()=>{let y=[...l.value];return f.value&&f.value.trim()&&(y=Vs(y,f.value,{caseSensitive:!1,searchInEvent:!0,searchInPayload:!0,searchInDetails:!0,searchInIp:!0})),_.value.category&&(y=y.filter(N=>N.category===_.value.category)),_.value.event&&(y=y.filter(N=>N.event===_.value.event)),_.value.ip&&(y=y.filter(N=>N.ip&&N.ip.includes(_.value.ip))),_.value.status&&(y=y.filter(N=>_.value.status==="error"?N.category==="errors":_.value.status==="success"?N.category!=="errors":!0)),_.value.dateFrom&&(y=y.filter(N=>N.timestamp?new Date(N.timestamp).toISOString().split("T")[0]>=_.value.dateFrom:!1)),_.value.dateTo&&(y=y.filter(N=>N.timestamp?new Date(N.timestamp).toISOString().split("T")[0]<=_.value.dateTo:!1)),_.value.hour!==null&&(y=y.filter(N=>N.timestamp?new Date(N.timestamp).getHours()===_.value.hour:!1)),y});Z(O,y=>{x.value&&f.value&&x.value.setResultsCount(y.length)});const M=async()=>{try{await ue.init();const y=await ue.getCurrentUser();if(console.log("[WebhookLogsPage] User data:",y),!y||!y.ID){console.warn("[WebhookLogsPage] User not determined"),r.value=u({error:"User not determined",userId:y?.ID||null,userName:y?`${y.NAME||""} ${y.LAST_NAME||""}`.trim():null}),t.value=!1;return}const N=y?.UF_DEPARTMENT||[];if(console.log("[WebhookLogsPage] User departments:",N),console.log("[WebhookLogsPage] Allowed departments:",_e.allowedDepartmentIds),N.length>0){const q=N.some(R=>ot(R));console.log("[WebhookLogsPage] Has access:",q),t.value=q,q||(r.value=u({userId:y.ID,userName:`${y.NAME||""} ${y.LAST_NAME||""}`.trim(),userDepartments:N,allowedDepartments:_e.allowedDepartmentIds,message:"User departments do not match allowed departments"}))}else console.warn("[WebhookLogsPage] User has no departments"),r.value=u({userId:y.ID,userName:`${y.NAME||""} ${y.LAST_NAME||""}`.trim(),userDepartments:[],allowedDepartments:_e.allowedDepartmentIds,message:"User has no departments assigned"}),t.value=!1}catch(y){console.error("[WebhookLogsPage] Error checking access:",y),r.value=u({error:y.message,stack:y.stack}),t.value=!1}},U=A(()=>_e.allowedDepartmentIds.join(", ")),K=async(y=!1)=>{if(t.value&&!(me&&!y)){me=!0,a.value=!0,i.value=null;try{const N=new Date().toISOString().split("T")[0],q={category:_.value.category||null,event:_.value.event||null,date:_.value.dateFrom||N,hour:_.value.hour!==null&&_.value.hour!==void 0?_.value.hour:null,ip:_.value.ip||null,status:_.value.status||null,dateFrom:_.value.dateFrom||N,dateTo:_.value.dateTo||null};if(!We(q))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");console.log("[WebhookLogsPage] Loading logs with filters:",q);const R=await Ye.getLogs(q,S.value.page,S.value.limit,y);if(console.log("[WebhookLogsPage] API result:",R),console.log("[WebhookLogsPage] Logs count:",R?.logs?.length||0),console.log("[WebhookLogsPage] Pagination:",R?.pagination),!R.success)throw new Error(R.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤");qs(R.pagination)?S.value=R.pagination:(console.warn("[WebhookLogsPage] Invalid pagination format, using defaults"),S.value={page:S.value.page,limit:S.value.limit,total:R.logs.length,pages:Math.ceil(R.logs.length/S.value.limit)});const Q=ze(R.logs),ne=Q.filter(Y=>ce(Y));ne.length!==Q.length&&console.warn("[WebhookLogsPage] Filtered out invalid logs:",Q.length-ne.length),l.value=ne,y&&e("–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")}catch(N){Fe(N)}finally{a.value=!1,me=!1}}},Fe=y=>{console.error("[WebhookLogsPage] API Error:",y),y.status===403?(i.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",s("–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º –≤–µ–±—Ö—É–∫–æ–≤")):y.status===404?(i.value="–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",s("–õ–æ–≥–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")):y.status>=500?(i.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",s("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")):(i.value=y.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",s(i.value)),y.status>=500&&(l.value=[])},lt=y=>{f.value=y,h({search:y||null})};let me=!1;const ct=y=>{if(!We(y)){s("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");return}const N={category:_.value.category,event:_.value.event,dateFrom:_.value.dateFrom,dateTo:_.value.dateTo,hour:_.value.hour,ip:_.value.ip,status:_.value.status},q={category:y?.category||null,event:y?.event||null,dateFrom:y?.dateFrom||null,dateTo:y?.dateTo||null,hour:y?.hour!==void 0?y.hour:null,ip:y?.ip||null,status:y?.status||null},R=Object.keys(q).some(Q=>{const ne=N[Q],Y=q[Q];return ne!==Y});if(!(!R&&!me)){if(h(q),S.value.page=1,R)try{Ye.invalidateCacheOnFilterChange(N,q)}catch(Q){console.error("[WebhookLogsPage] Error invalidating cache:",Q)}me||(me=!0,K(!0).finally(()=>{me=!1}))}},Xe=()=>{v(),f.value="",S.value.page=1,K()},dt=y=>{m.value=y},ut=()=>{m.value=null},gt=y=>{S.value.page=y,K()},ft=()=>{try{o.push("/")}catch(y){console.error("Navigation error:",y),window.location.hash="#/"}},mt=y=>{p.value=y},ht=y=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—á–∞—Ç:",y)},vt=y=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω:",y),e(`–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω: ${y.count} –∑–∞–ø–∏—Å–µ–π –≤ —Ñ–∞–π–ª–µ ${y.filename}`)},pt=y=>{console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:",y),s(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${y.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`)},yt=()=>{f.value="",Xe()},_t=y=>{if(console.log("[WebhookLogsPage] Toggle auto-update:",y),E.value=y,y){let N=null;if(l.value.length>0){const q=l.value[0];q.timestamp&&(N=q.timestamp,console.log("[WebhookLogsPage] Using lastTimestamp:",N))}I({lastTimestamp:N})}else D()},wt=()=>{j(l.value),e("–ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")},bt=()=>{P()};return ee(async()=>{await M(),t.value&&(_.value.search&&(f.value=_.value.search),await K())}),{hasAccess:t,loading:a,error:i,logs:l,filteredLogs:O,selectedLog:m,selectedLogs:p,filters:_,searchQuery:f,searchComponent:x,pagination:S,previousPeriodStats:L,handleFiltersUpdate:ct,handleFiltersReset:Xe,handleSearch:lt,handleLogSelect:dt,handleLogClose:ut,handlePageChange:gt,handleSelectedLogsUpdate:mt,handleExportStart:ht,handleExportComplete:vt,handleExportError:pt,handleClearSearch:yt,autoUpdateEnabled:E,connectionState:b,newLogsCount:T,realtimeError:w,handleToggleAutoUpdate:_t,handleApplyNewLogs:wt,handleDismissNewLogs:bt,allowedDepartmentsText:U,accessDebugInfo:r,goBack:ft}}},Ur={class:"webhook-logs-page"},Nr={class:"page-header"},Rr={class:"page-header-top"},Fr={key:0,class:"access-denied"},Or={class:"access-denied-content"},Br={class:"access-hint"},$r={key:0,class:"access-debug"},jr={key:1,class:"page-content"},Wr={class:"actions-bar"};function zr(o,e,s,t,a,i){const r=B("WebhookLogsDashboard"),l=B("WebhookLogsExport"),u=B("WebhookLogSearch"),m=B("RealtimeControls"),p=B("NewLogsIndicator"),f=B("WebhookLogFilters"),x=B("SkeletonLogList"),L=B("WebhookLogList"),E=B("EmptyState"),b=B("ErrorDisplay"),T=B("WebhookLogDetails"),w=B("NotificationContainer");return c(),d("div",Ur,[n("div",Nr,[n("div",Rr,[n("button",{onClick:e[0]||(e[0]=(...I)=>t.goBack&&t.goBack(...I)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[3]||(e[3]=[n("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),n("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[4]||(e[4]=n("h1",null,"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ Bitrix24",-1))]),t.hasAccess?(c(),d("div",jr,[W(r,{logs:t.logs,pagination:t.pagination,"previous-period-stats":t.previousPeriodStats},null,8,["logs","pagination","previous-period-stats"]),n("div",Wr,[W(l,{logs:t.filteredLogs,"selected-logs":t.selectedLogs,filters:t.filters,"total-count":t.filteredLogs.length,onExportStart:t.handleExportStart,onExportComplete:t.handleExportComplete,onExportError:t.handleExportError},null,8,["logs","selected-logs","filters","total-count","onExportStart","onExportComplete","onExportError"]),W(u,{modelValue:t.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=I=>t.searchQuery=I),onSearch:t.handleSearch,ref:"searchComponent"},null,8,["modelValue","onSearch"])]),W(m,{enabled:t.autoUpdateEnabled,"connection-state":t.connectionState,error:t.realtimeError,onToggle:t.handleToggleAutoUpdate},null,8,["enabled","connection-state","error","onToggle"]),W(p,{count:t.newLogsCount,onApply:t.handleApplyNewLogs,onDismiss:t.handleDismissNewLogs},null,8,["count","onApply","onDismiss"]),W(f,{filters:t.filters,"onUpdate:filters":t.handleFiltersUpdate,onReset:t.handleFiltersReset},null,8,["filters","onUpdate:filters","onReset"]),W(de,{name:"fade"},{default:oe(()=>[t.loading&&t.logs.length===0?(c(),J(x,{key:0,rows:5})):k("",!0)]),_:1}),W(de,{name:"fade"},{default:oe(()=>[!t.loading&&t.filteredLogs.length>0?(c(),J(L,{key:0,logs:t.filteredLogs,loading:!1,error:null,pagination:t.pagination,"selected-logs":t.selectedLogs,onSelectLog:t.handleLogSelect,onPageChange:t.handlePageChange,"onUpdate:selectedLogs":t.handleSelectedLogsUpdate},null,8,["logs","pagination","selected-logs","onSelectLog","onPageChange","onUpdate:selectedLogs"])):k("",!0)]),_:1}),W(de,{name:"fade"},{default:oe(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length===0?(c(),J(E,{key:0,icon:"üì≠",title:"–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",description:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Bitrix24.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è","–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",onAction:t.handleFiltersReset},null,8,["onAction"])):k("",!0)]),_:1}),W(de,{name:"fade"},{default:oe(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length>0?(c(),J(E,{key:0,icon:"üîç",title:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",description:"–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã","–û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",onAction:t.handleClearSearch},null,8,["onAction"])):k("",!0)]),_:1}),W(de,{name:"fade"},{default:oe(()=>[t.error?(c(),J(b,{key:0,title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤",message:t.error,retryable:!0,onRetry:o.loadLogs},null,8,["message","onRetry"])):k("",!0)]),_:1}),t.selectedLog?(c(),d("div",{key:0,class:"modal-overlay",onClick:e[2]||(e[2]=(...I)=>t.handleLogClose&&t.handleLogClose(...I))})):k("",!0),W(de,{name:"modal"},{default:oe(()=>[t.selectedLog?(c(),J(T,{key:0,log:t.selectedLog,onClose:t.handleLogClose},null,8,["log","onClose"])):k("",!0)]),_:1})])):(c(),d("div",Fr,[n("div",Or,[e[7]||(e[7]=n("h2",null,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",-1)),e[8]||(e[8]=n("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤.",-1)),n("p",Br,[e[5]||(e[5]=H(" –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ –æ—Ç–¥–µ–ª–æ–≤: ",-1)),n("strong",null,g(t.allowedDepartmentsText),1)]),e[9]||(e[9]=n("p",{class:"access-hint"}," –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã. ",-1)),t.accessDebugInfo?(c(),d("details",$r,[e[6]||(e[6]=n("summary",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",-1)),n("pre",null,g(t.accessDebugInfo),1)])):k("",!0)])])),W(w)])}const Vr=F(Pr,[["render",zr],["__scopeId","data-v-628bf174"]]);class Pe{static async getActivity(e={}){const{userId:s=null,dateFrom:t=null,dateTo:a=null,type:i=null,limit:r=1e3}=e,l=new URLSearchParams;s&&l.append("user_id",s),t&&l.append("date_from",t),a&&l.append("date_to",a),i&&l.append("type",i),r&&l.append("limit",r);try{const u=ie("/api/user-activity-get.php"),m=await fetch(`${u}?${l.toString()}`);if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);const p=await m.json();if(p.success)return p.data||[];throw new Error(p.error||"Failed to get activity")}catch(u){throw console.error("[UserActivityService] Error getting activity:",u),u}}static async getActivityStats(e={}){const s=await this.getActivity(e),t={total_entries:s.length,total_app_entries:0,total_page_visits:0,unique_users:new Set,pages_visited:{},activity_by_date:{},activity_by_hour:{}};return s.forEach(a=>{if(a.type==="app_entry")t.total_app_entries++,t.unique_users.add(a.user_id);else if(a.type==="page_visit"){t.total_page_visits++;const i=a.route_title||a.route_path||a.route_name||"unknown";t.pages_visited[i]=(t.pages_visited[i]||0)+1}if(a.timestamp){const i=new Date(a.timestamp).toISOString().split("T")[0];t.activity_by_date[i]=(t.activity_by_date[i]||0)+1;const r=new Date(a.timestamp).getHours();t.activity_by_hour[r]=(t.activity_by_hour[r]||0)+1}}),t.unique_users_count=t.unique_users.size,t.unique_users=Array.from(t.unique_users),t}static async getUserActivity(e,s={}){return await this.getActivity({...s,userId:e})}}const Re="hidden_users_list";function be(){try{const o=localStorage.getItem(Re);if(!o)return[];const e=JSON.parse(o);return Array.isArray(e)?e.map(s=>Number(s)):[]}catch(o){return console.error("[HiddenUsersManager] Error reading hidden users:",o),[]}}function qr(o){const e=be(),s=Number(o);if(!e.includes(s)){e.push(s);try{localStorage.setItem(Re,JSON.stringify(e))}catch(t){console.error("[HiddenUsersManager] Error saving hidden users:",t)}}}function Hr(o){const e=be(),s=Number(o),t=e.filter(a=>a!==s);if(t.length!==e.length)try{localStorage.setItem(Re,JSON.stringify(t))}catch(a){console.error("[HiddenUsersManager] Error saving hidden users:",a)}}function Xr(){try{localStorage.removeItem(Re)}catch(o){console.error("[HiddenUsersManager] Error clearing hidden users:",o)}}function Jr(o){const e=new Map;return o.forEach(s=>{if(s.user_id){const t=Number(s.user_id);e.has(t)||e.set(t,{id:t,name:s.user_name||`User #${t}`,count:0}),e.get(t).count++}}),Array.from(e.values()).sort((s,t)=>t.count-s.count)}function it(o){const e=be();return e.length===0?o:o.filter(s=>s.user_id?!e.includes(Number(s.user_id)):!0)}const Kr={name:"UserActivityCard",props:{entry:{type:Object,required:!0}},computed:{cardClass(){return{"activity-entry":this.entry.type==="app_entry","activity-visit":this.entry.type==="page_visit"}}},methods:{formatTime(o){return o?new Date(o).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}}},Yr={class:"activity-icon"},Gr={key:0},Qr={key:1},Zr={class:"activity-content"},ea={class:"activity-header"},ta={class:"user-name"},sa={class:"activity-time"},oa={class:"activity-details"},na={key:0,class:"activity-type"},ra={key:1,class:"activity-type"},aa={key:0,class:"activity-from"};function ia(o,e,s,t,a,i){return c(),d("div",{class:$(["user-activity-card",i.cardClass])},[n("div",Yr,[s.entry.type==="app_entry"?(c(),d("span",Gr,"üö™")):s.entry.type==="page_visit"?(c(),d("span",Qr,"üìÑ")):k("",!0)]),n("div",Zr,[n("div",ea,[n("span",ta,g(s.entry.user_name||`User #${s.entry.user_id}`),1),n("span",sa,g(i.formatTime(s.entry.timestamp)),1)]),n("div",oa,[s.entry.type==="app_entry"?(c(),d("span",na," –û—Ç–∫—Ä—ã–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ")):s.entry.type==="page_visit"?(c(),d("span",ra," –û—Ç–∫—Ä—ã–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É: "+g(s.entry.route_title||s.entry.route_path||s.entry.route_name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"),1)):k("",!0)]),s.entry.type==="page_visit"&&s.entry.from_path?(c(),d("div",aa," –°: "+g(s.entry.from_name||s.entry.from_path),1)):k("",!0)])],2)}const la=F(Kr,[["render",ia],["__scopeId","data-v-fe61b287"]]),ca={name:"UserActivityList",components:{UserActivityCard:la},props:{userId:{type:Number,default:null},dateFrom:{type:String,default:null},dateTo:{type:String,default:null},type:{type:String,default:null}},emits:["view-details"],setup(o,{emit:e}){const s=C([]),t=C(!1),a=C(null),i=A(()=>it(s.value)),r=async()=>{t.value=!0,a.value=null;try{const p={userId:o.userId,dateFrom:o.dateFrom,dateTo:o.dateTo,type:o.type};s.value=await Pe.getActivity(p)}catch(p){a.value=p.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",console.error("[UserActivityList] Error:",p)}finally{t.value=!1}},l=p=>{e("view-details",p)},u=p=>`${p.timestamp}-${p.user_id}-${p.type}-${p.route_path||""}`,m=()=>{r()};return ee(()=>{r(),window.addEventListener("hidden-users-changed",m)}),Ne(()=>{window.removeEventListener("hidden-users-changed",m)}),Z(()=>[o.userId,o.dateFrom,o.dateTo,o.type],()=>{r()},{deep:!0}),{activity:i,loading:t,error:a,handleViewDetails:l,getEntryKey:u}}},da={class:"user-activity-list"},ua={key:0,class:"loading"},ga={key:1,class:"error"},fa={key:2,class:"empty"},ma={key:3,class:"activity-items"};function ha(o,e,s,t,a,i){const r=B("UserActivityCard");return c(),d("div",da,[t.loading?(c(),d("div",ua," –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏... ")):t.error?(c(),d("div",ga,g(t.error),1)):t.activity.length===0?(c(),d("div",fa," –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ")):(c(),d("div",ma,[(c(!0),d(z,null,V(t.activity,l=>(c(),J(r,{key:t.getEntryKey(l),entry:l,onClick:u=>t.handleViewDetails(l)},null,8,["entry","onClick"]))),128))]))])}const va=F(ca,[["render",ha],["__scopeId","data-v-a10310fc"]]),pa={name:"UserActivityFilters",props:{filters:{type:Object,default:()=>({})},users:{type:Array,default:()=>[]}},emits:["update-filters"],setup(o,{emit:e}){const s=C({userId:o.filters.userId||null,type:o.filters.type||null,dateFrom:o.filters.dateFrom||null,dateTo:o.filters.dateTo||null}),t=()=>{e("update-filters",{...s.value})},a=()=>{s.value={userId:null,type:null,dateFrom:null,dateTo:null},t()},i=r=>{const l=r.NAME||"",u=r.LAST_NAME||"";return`${l} ${u}`.trim()||r.EMAIL||`User #${r.ID}`};return Z(()=>o.filters,r=>{s.value={...r}},{deep:!0}),{localFilters:s,updateFilters:t,resetFilters:a,getUserName:i}}},ya={class:"user-activity-filters"},_a={class:"filter-group"},wa=["value"],ba={class:"filter-group"},Ca={class:"filter-group"},Sa={class:"filter-group"};function ka(o,e,s,t,a,i){return c(),d("div",ya,[n("div",_a,[e[10]||(e[10]=n("label",null,"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:",-1)),X(n("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>t.localFilters.userId=r),onChange:e[1]||(e[1]=(...r)=>t.updateFilters&&t.updateFilters(...r))},[e[9]||(e[9]=n("option",{value:null},"–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",-1)),(c(!0),d(z,null,V(s.users,r=>(c(),d("option",{key:r.ID,value:r.ID},g(t.getUserName(r)),9,wa))),128))],544),[[ye,t.localFilters.userId]])]),n("div",ba,[e[12]||(e[12]=n("label",null,"–¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:",-1)),X(n("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>t.localFilters.type=r),onChange:e[3]||(e[3]=(...r)=>t.updateFilters&&t.updateFilters(...r))},[...e[11]||(e[11]=[n("option",{value:null},"–í—Å–µ —Ç–∏–ø—ã",-1),n("option",{value:"app_entry"},"–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1),n("option",{value:"page_visit"},"–ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",-1)])],544),[[ye,t.localFilters.type]])]),n("div",Ca,[e[13]||(e[13]=n("label",null,"–î–∞—Ç–∞ –æ—Ç:",-1)),X(n("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=r=>t.localFilters.dateFrom=r),onChange:e[5]||(e[5]=(...r)=>t.updateFilters&&t.updateFilters(...r))},null,544),[[pe,t.localFilters.dateFrom]])]),n("div",Sa,[e[14]||(e[14]=n("label",null,"–î–∞—Ç–∞ –¥–æ:",-1)),X(n("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=r=>t.localFilters.dateTo=r),onChange:e[7]||(e[7]=(...r)=>t.updateFilters&&t.updateFilters(...r))},null,544),[[pe,t.localFilters.dateTo]])]),n("button",{onClick:e[8]||(e[8]=(...r)=>t.resetFilters&&t.resetFilters(...r)),class:"btn-reset"},"–°–±—Ä–æ—Å–∏—Ç—å")])}const Ea=F(pa,[["render",ka],["__scopeId","data-v-f4c5efa9"]]),Aa={name:"UserActivityStats",props:{filters:{type:Object,default:()=>({})}},setup(o){const e=C({total_entries:0,unique_users_count:0,total_app_entries:0,total_page_visits:0,pages_visited:{}}),s=C(!1),t=C(null),a=A(()=>e.value),i=async()=>{s.value=!0,t.value=null;try{const u=await Pe.getActivity({...o.filters,limit:1e4}),m=it(u);e.value=await Pe.getActivityStats({...o.filters});const p={total_entries:m.length,unique_users_count:new Set(m.map(f=>f.user_id)).size,total_app_entries:m.filter(f=>f.type==="app_entry").length,total_page_visits:m.filter(f=>f.type==="page_visit").length,pages_visited:{}};m.filter(f=>f.type==="page_visit"&&f.route_path).forEach(f=>{const x=f.route_title||f.route_path||f.route_name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞";p.pages_visited[x]=(p.pages_visited[x]||0)+1}),e.value=p}catch(u){t.value=u.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏",console.error("[UserActivityStats] Error loading stats:",u)}finally{s.value=!1}},r=A(()=>{const u=a.value.pages_visited||{};return Object.entries(u).sort((m,p)=>p[1]-m[1]).slice(0,10).reduce((m,[p,f])=>(m[p]=f,m),{})}),l=()=>{i()};return ee(()=>{i(),window.addEventListener("hidden-users-changed",l)}),Ne(()=>{window.removeEventListener("hidden-users-changed",l)}),Z(()=>o.filters,()=>{i()},{deep:!0}),{stats:a,loading:s,error:t,sortedPages:r}}},Ta={class:"user-activity-stats"},La={key:0,class:"loading"},xa={key:1,class:"error"},Ia={key:2},Ma={class:"stats-grid"},Da={class:"stat-card"},Pa={class:"stat-value"},Ua={class:"stat-card"},Na={class:"stat-value"},Ra={class:"stat-card"},Fa={class:"stat-value"},Oa={class:"stat-card"},Ba={class:"stat-value"},$a={key:0,class:"pages-stats"};function ja(o,e,s,t,a,i){return c(),d("div",Ta,[t.loading?(c(),d("div",La," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏... ")):t.error?(c(),d("div",xa,g(t.error),1)):(c(),d("div",Ia,[n("div",Ma,[n("div",Da,[n("div",Pa,g(t.stats.total_entries),1),e[0]||(e[0]=n("div",{class:"stat-label"},"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",-1))]),n("div",Ua,[n("div",Na,g(t.stats.unique_users_count),1),e[1]||(e[1]=n("div",{class:"stat-label"},"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1))]),n("div",Ra,[n("div",Fa,g(t.stats.total_app_entries),1),e[2]||(e[2]=n("div",{class:"stat-label"},"–û—Ç–∫—Ä—ã—Ç–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1))]),n("div",Oa,[n("div",Ba,g(t.stats.total_page_visits),1),e[3]||(e[3]=n("div",{class:"stat-label"},"–ü–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º",-1))])]),Object.keys(t.stats.pages_visited).length>0?(c(),d("div",$a,[e[5]||(e[5]=n("h3",null,"–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:",-1)),n("ul",null,[(c(!0),d(z,null,V(t.sortedPages,(r,l)=>(c(),d("li",{key:l},[H(g(l)+": ",1),n("strong",null,g(r),1),e[4]||(e[4]=H(" –ø–æ—Å–µ—â–µ–Ω–∏–π ",-1))]))),128))])])):k("",!0)]))])}const Wa=F(Aa,[["render",ja],["__scopeId","data-v-d896786e"]]),za={name:"HiddenUsersManager",props:{filters:{type:Object,default:()=>({})}},emits:["hidden-users-changed"],setup(o,{emit:e}){const s=C(!1),t=C(null),a=C([]),i=C([]),r=A(()=>Jr(a.value)),l=A(()=>{const f=be();return r.value.filter(x=>f.includes(x.id))}),u=async()=>{s.value=!0,t.value=null;try{const f={...o.filters,limit:1e3};a.value=await Pe.getActivity(f);const x=be();i.value=x.filter(L=>r.value.some(E=>E.id===L))}catch(f){t.value=f.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",console.error("[HiddenUsersManager] Error loading activity:",f)}finally{s.value=!1}},m=()=>{const f=be(),x=i.value.map(L=>Number(L));x.forEach(L=>{f.includes(L)||qr(L)}),f.forEach(L=>{x.includes(L)||Hr(L)}),e("hidden-users-changed"),window.dispatchEvent(new CustomEvent("hidden-users-changed"))},p=()=>{Xr(),i.value=[],e("hidden-users-changed"),window.dispatchEvent(new CustomEvent("hidden-users-changed"))};return ee(()=>{u()}),Z(()=>o.filters,()=>{u()},{deep:!0}),Z(()=>l.value,f=>{i.value=f.map(x=>x.id)},{deep:!0}),{loading:s,error:t,availableUsers:r,hiddenUsers:l,selectedUsers:i,applySelection:m,showAll:p}}},Va={class:"hidden-users-manager"},qa={class:"manager-controls"},Ha={class:"dropdown-wrapper"},Xa=["disabled"],Ja=["value"],Ka={key:0,class:"empty-hint"},Ya={class:"actions"},Ga=["disabled"],Qa=["disabled"],Za={key:0,class:"loading"},ei={key:1,class:"error"};function ti(o,e,s,t,a,i){return c(),d("div",Va,[n("div",qa,[n("div",Ha,[e[3]||(e[3]=n("label",{class:"dropdown-label"}," üëÅÔ∏è –°–∫—Ä—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ",-1)),X(n("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>t.selectedUsers=r),multiple:"",class:"users-dropdown",disabled:t.loading||t.availableUsers.length===0,size:"5"},[(c(!0),d(z,null,V(t.availableUsers,r=>(c(),d("option",{key:r.id,value:r.id},g(r.name)+" ("+g(r.count)+" "+g(r.count===1?"–∑–∞–ø–∏—Å—å":"–∑–∞–ø–∏—Å–µ–π")+") ",9,Ja))),128))],8,Xa),[[ye,t.selectedUsers]]),t.availableUsers.length===0&&!t.loading?(c(),d("div",Ka," –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∑–∞–ø–∏—Å—è—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ")):k("",!0)]),n("div",Ya,[n("button",{onClick:e[1]||(e[1]=(...r)=>t.applySelection&&t.applySelection(...r)),class:"apply-btn",disabled:t.loading,title:"–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å ",8,Ga),t.hiddenUsers.length>0?(c(),d("button",{key:0,onClick:e[2]||(e[2]=(...r)=>t.showAll&&t.showAll(...r)),class:"show-all-btn",disabled:t.loading,title:"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"}," –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö ("+g(t.hiddenUsers.length)+") ",9,Qa)):k("",!0)])]),t.loading?(c(),d("div",Za," –ó–∞–≥—Ä—É–∑–∫–∞... ")):k("",!0),t.error?(c(),d("div",ei,g(t.error),1)):k("",!0)])}const si=F(za,[["render",ti],["__scopeId","data-v-4fdc2eaa"]]),oi={name:"UsersManagementPage",components:{UserActivityList:va,UserActivityFilters:Ea,UserActivityStats:Wa,HiddenUsersManager:si},setup(){const o=Ee(),e=C([]),s=C({userId:null,type:null,dateFrom:null,dateTo:null}),t=async()=>{try{const u=await je.call("user.get",{});u&&u.result&&(e.value=u.result)}catch(u){console.error("[UsersManagementPage] Error loading users:",u)}},a=u=>{s.value={...u}},i=u=>{console.log("View activity details:",u)},r=()=>{window.dispatchEvent(new CustomEvent("hidden-users-changed"))},l=()=>{o.push("/")};return ee(async()=>{try{if(!(await ve.checkAccess()).allowed){o.push("/");return}if(!await ve.getCurrentUser()){o.push("/");return}await t()}catch(u){console.error("[UsersManagementPage] Error:",u),o.push("/")}}),{users:e,activityFilters:s,handleFiltersUpdate:a,handleViewActivityDetails:i,handleHiddenUsersChanged:r,goBack:l}}},ni={class:"users-management-page"},ri={class:"page-header"},ai={class:"page-header-top"},ii={class:"page-content"},li={class:"activity-section"};function ci(o,e,s,t,a,i){const r=B("UserActivityFilters"),l=B("HiddenUsersManager"),u=B("UserActivityStats"),m=B("UserActivityList");return c(),d("div",ni,[n("div",ri,[n("div",ai,[n("button",{onClick:e[0]||(e[0]=(...p)=>t.goBack&&t.goBack(...p)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[n("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),n("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=n("h1",null,"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",-1))]),n("div",ii,[n("div",li,[e[3]||(e[3]=n("h2",null,"üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),W(r,{filters:t.activityFilters,users:t.users,onUpdateFilters:t.handleFiltersUpdate},null,8,["filters","users","onUpdateFilters"]),W(l,{filters:t.activityFilters,onHiddenUsersChanged:t.handleHiddenUsersChanged},null,8,["filters","onHiddenUsersChanged"]),W(u,{filters:t.activityFilters},null,8,["filters"]),W(m,{userId:t.activityFilters.userId,dateFrom:t.activityFilters.dateFrom,dateTo:t.activityFilters.dateTo,type:t.activityFilters.type,onViewDetails:t.handleViewActivityDetails},null,8,["userId","dateFrom","dateTo","type","onViewDetails"])])])])}const di=F(oi,[["render",ci],["__scopeId","data-v-b1c991d2"]]);class G{static async getCacheStatus(){try{const e=ie("/api/admin/cache-status.php"),s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok){const a=await s.text();throw new Error(`HTTP error! status: ${s.status}, message: ${a}`)}const t=await s.json();if(t.success){const a=t.modules||[];return a.length===0?{primaryModules:[],secondaryModules:[],metadata:{totalModules:0,primaryCount:0,secondaryCount:0}}:this.categorizeAndSortModules(a)}else throw new Error(t.error||"Failed to get cache status")}catch(e){throw console.error("[CacheManagementService] Error getting cache status:",e),e}}static async clearCache(e){try{const s=ie("/api/admin/cache-clear.php"),t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,confirm:!0})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();if(a.success)return!0;throw new Error(a.error||"Failed to clear cache")}catch(s){throw console.error("[CacheManagementService] Error clearing cache:",s),s}}static async getCacheStats(){try{const e=ie("/api/admin/cache-stats.php"),s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();if(t.success)return t.stats||{};throw new Error(t.error||"Failed to get cache stats")}catch(e){throw console.error("[CacheManagementService] Error getting cache stats:",e),e}}static formatCacheSize(e){if(e===0)return"0 B";const s=1024,t=["B","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(s));return Math.round(e/Math.pow(s,a)*100)/100+" "+t[a]}static categorizeAndSortModules(e,s={}){const t=this.generateCacheKey(e),a=this.getCachedResult(t);if(a&&!s.forceRefresh)return a;const i=performance.now(),r=this.performCategorization(e),l=performance.now();return r.metadata={processingTime:l-i,totalModules:e.length,primaryCount:r.primaryModules.length,secondaryCount:r.secondaryModules.length,cached:!1},this.setCachedResult(t,r),r}static performCategorization(e){const s=[],t=[];return e.forEach(a=>{this.validateModule(a),this.PRIMARY_MODULE_IDS.includes(a.id)?s.push({...a,category:"primary",priority:this.PRIMARY_MODULE_PRIORITIES[a.id]||999}):t.push({...a,category:"secondary",groupType:this.getModuleType(a.id)})}),{primaryModules:this.sortPrimaryModules(s),secondaryModules:this.sortSecondaryModules(t)}}static sortPrimaryModules(e){return e.sort((s,t)=>{const a=this.PRIMARY_MODULE_PRIORITIES[s.id]||999,i=this.PRIMARY_MODULE_PRIORITIES[t.id]||999;return a-i})}static sortSecondaryModules(e){return e.sort((s,t)=>{const a=this.getModuleType(s.id),i=this.getModuleType(t.id);return a!==i?this.compareModuleTypes(a,i):s.name.localeCompare(t.name)})}static compareModuleTypes(e,s){const t=["users","activity","webhooks","other"],a=t.indexOf(e),i=t.indexOf(s);return(a===-1?999:a)-(i===-1?999:i)}static getModuleType(e){for(const[s,t]of Object.entries(this.SECONDARY_MODULE_TYPES))if(e.startsWith(t.prefix))return s;return e.includes("time-tracking")?"time-tracking":e.includes("graph")?"graphs":e.includes("dashboard")?"dashboards":"other"}static getModuleTypeConfig(e){return this.SECONDARY_MODULE_TYPES[e]||{title:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏",description:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã"}}static validateModule(e){if(!e||typeof e!="object")throw new Error("Module must be an object");if(!e.id||typeof e.id!="string")throw new Error("Module must have a valid id");if(!e.name||typeof e.name!="string")throw new Error("Module must have a valid name");return!0}static generateCacheKey(e){const s=e.map(t=>t.id).sort().join(",");return btoa(s).substring(0,16)}static getCachedResult(e){const s=this.categorizationCache.get(e);return s?Date.now()-s.timestamp>this.CACHE_TTL?(this.categorizationCache.delete(e),null):{...s.data,metadata:{...s.data.metadata,cached:!0}}:null}static setCachedResult(e,s){if(this.categorizationCache.set(e,{data:{...s,metadata:{...s.metadata,cached:!1}},timestamp:Date.now()}),this.categorizationCache.size>10){const t=this.categorizationCache.keys().next().value;this.categorizationCache.delete(t)}}static clearCategorizationCache(){this.categorizationCache.clear()}static getCategorizationStats(){return{cacheSize:this.categorizationCache.size,cacheEntries:Array.from(this.categorizationCache.entries()).map(([e,s])=>({key:e,age:Date.now()-s.timestamp,modulesCount:s.data.primaryModules.length+s.data.secondaryModules.length}))}}static formatTTL(e){return e<60?`${e} —Å–µ–∫`:e<3600?`${Math.floor(e/60)} –º–∏–Ω`:`${Math.floor(e/3600)} —á`}}he(G,"PRIMARY_MODULE_IDS",["dashboard-sector-1c","graph-state","graph-admission-closure-weeks","graph-admission-closure-months","time-tracking-default","time-tracking-detailed","time-tracking-summary"]),he(G,"PRIMARY_MODULE_PRIORITIES",{"dashboard-sector-1c":1,"graph-state":2,"graph-admission-closure-weeks":3,"graph-admission-closure-months":4,"time-tracking-default":5,"time-tracking-detailed":6,"time-tracking-summary":7}),he(G,"SECONDARY_MODULE_TYPES",{users:{prefix:"users-management",title:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –æ—Ç–¥–µ–ª–∞–º–∏"},activity:{prefix:"user-activity",title:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",description:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},webhooks:{prefix:"webhook-logs",title:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",description:"–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±—Ö—É–∫–æ–≤"}}),he(G,"categorizationCache",new Map),he(G,"CACHE_TTL",3e4);function ui(o){return{1:{text:"–û—á–µ–Ω—å —á–∞—Å—Ç–æ",description:"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞"},2:{text:"–ß–∞—Å—Ç–æ",description:"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å"},3:{text:"–†–µ–≥—É–ª—è—Ä–Ω–æ",description:"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"},4:{text:"–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏",description:"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é"},5:{text:"–ü–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",description:"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑–∞"},6:{text:"–†–µ–¥–∫–æ",description:"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞"},7:{text:"–û—á–µ–Ω—å —Ä–µ–¥–∫–æ",description:"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤"}}[o]||{text:"–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ",description:"–ß–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞"}}function gi(o){const e=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())),s=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-s);const t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}class $e{static async createCache(e,s=null,t={}){try{const a=ie("/api/admin/cache-create.php"),i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,mode:s,params:t})});if(!i.ok){const l=await i.json().catch(()=>({}));throw new Error(l.error||`HTTP error! status: ${i.status}`)}const r=await i.json();if(r.success)return r;throw new Error(r.error||"Failed to create cache")}catch(a){throw console.error("[CacheCreationService] Error creating cache:",a),a}}static async getCreationStatus(e){try{const s=ie(`/api/admin/cache-create-status.php?task_id=${e}`),t=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();if(a.success)return a;throw new Error(a.error||"Failed to get creation status")}catch(s){throw console.error("[CacheCreationService] Error getting creation status:",s),s}}static getDefaultParams(e){if(e.includes("graph-admission-closure"))if((e.includes("weeks")?"weeks":"months")==="weeks"){const t=new Date,a=t.getUTCFullYear(),i=gi(t),r=new Date(a,0,1+(i-1)*7),l=r.getUTCDay(),u=r.getUTCDate()-l+(l===0?-6:1);r.setUTCDate(u),r.setUTCHours(0,0,0,0);const m=new Date(r);return m.setUTCDate(r.getUTCDate()+6),m.setUTCHours(23,59,59,999),{product:"1C",periodMode:"weeks",weekStartUtc:r.toISOString(),weekEndUtc:m.toISOString(),includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,useCache:!0,forceRefresh:!0}}else return{product:"1C",periodMode:"months",includeTickets:!0,includeNewTicketsByStages:!1,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!1};if(e.includes("dashboard-sector-1c"))return{forceRefresh:!0,ttl:600};if(e.includes("graph-state"))return{type:"current",forceRefresh:!0,ttl:3600};if(e.includes("time-tracking")){const s=e.includes("detailed")?"detailed":e.includes("summary")?"summary":"default";return{product:"1C",includeTaskDetails:s==="detailed",summary:s==="summary"}}return{}}}class Me{static notifyCacheCreationStarted(e){this.showNotification({content:`–ù–∞—á–∞—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}"...`,type:"info",autoHideDelay:3e3})}static notifyCacheCreationSuccess(e){this.showNotification({content:`‚úÖ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,type:"success",autoHideDelay:5e3})}static notifyCacheCreationError(e,s){this.showNotification({content:`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}": ${s}`,type:"error",autoHideDelay:7e3})}static notifyCacheUpdated(e,s="auto"){const t=s==="manual"?"–≤—Ä—É—á–Ω—É—é":"–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏";this.showNotification({content:`üîÑ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" –æ–±–Ω–æ–≤–ª—ë–Ω ${t}`,type:"info",autoHideDelay:4e3})}static notifyCacheUsed(e){this.showNotification({content:`‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}"`,type:"success",autoHideDelay:3e3})}static showNotification(e){typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:e.content,autoHideDelay:e.autoHideDelay||3e3}):console.log("[CacheNotification]",e.content)}}const Gc=Object.freeze(Object.defineProperty({__proto__:null,CacheNotificationService:Me},Symbol.toStringTag,{value:"Module"})),fi={name:"CacheCreateProgress",props:{progress:{type:Number,required:!0,validator:o=>o>=0&&o<=100},message:{type:String,default:"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞..."}}},mi={class:"cache-create-progress"},hi={class:"progress-bar"},vi={class:"progress-text"};function pi(o,e,s,t,a,i){return c(),d("div",mi,[n("div",hi,[n("div",{class:"progress-fill",style:Ae({width:s.progress+"%"})},null,4)]),n("div",vi,g(s.progress)+"% - "+g(s.message),1)])}const yi=F(fi,[["render",pi],["__scopeId","data-v-7071de3b"]]),_i={name:"CacheCreateModal",components:{CacheCreateProgress:yi},props:{module:{type:Object,required:!0}},emits:["close","create"],setup(o,{emit:e}){const s=C(!1),t=C(0),a=C(""),i=C(null),r=C(""),l=A(()=>o.module.id.includes("graph-admission-closure")||o.module.id.includes("time-tracking")),u=A(()=>o.module.id.includes("graph-admission-closure")?["months","weeks"]:o.module.id.includes("time-tracking")?["default","detailed","summary"]:[]),m=()=>{e("close")},p=x=>{x.target===x.currentTarget&&m()},f=async()=>{s.value=!0,t.value=0,a.value="–ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞...";try{let x={};if(r.value.trim())try{x=JSON.parse(r.value)}catch{throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")}else x=$e.getDefaultParams(o.module.id);Me.notifyCacheCreationStarted(o.module.name),t.value=25,a.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24...";const L=await $e.createCache(o.module.id,i.value,x);t.value=75,a.value="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∞...",await new Promise(E=>setTimeout(E,500)),t.value=100,a.value="–ö–µ—à —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",Me.notifyCacheCreationSuccess(o.module.name),setTimeout(()=>{e("create",L),m()},1e3)}catch(x){console.error("[CacheCreateModal] Error creating cache:",x),Me.notifyCacheCreationError(o.module.name,x.message),s.value=!1}};return ee(()=>{u.value.length>0&&(i.value=u.value[0]);const x=$e.getDefaultParams(o.module.id);r.value=JSON.stringify(x,null,2)}),{creating:s,progress:t,progressMessage:a,selectedMode:i,paramsJson:r,supportsModes:l,availableModes:u,close:m,handleOverlayClick:p,handleCreate:f}}},wi={class:"modal-header"},bi={class:"modal-body"},Ci={key:1,class:"create-form"},Si={key:0,class:"form-group"},ki=["value"],Ei={class:"form-group"},Ai={class:"modal-footer"},Ti=["disabled"],Li=["disabled"],xi={key:0},Ii={key:1};function Mi(o,e,s,t,a,i){const r=B("CacheCreateProgress");return c(),d("div",{class:"modal-overlay",onClick:e[6]||(e[6]=(...l)=>t.handleOverlayClick&&t.handleOverlayClick(...l))},[n("div",{class:"modal-content",onClick:e[5]||(e[5]=fe(()=>{},["stop"]))},[n("div",wi,[n("h2",null,"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞: "+g(s.module.name),1),n("button",{onClick:e[0]||(e[0]=(...l)=>t.close&&t.close(...l)),class:"btn-close"},"√ó")]),n("div",bi,[t.creating?(c(),J(r,{key:0,progress:t.progress,message:t.progressMessage},null,8,["progress","message"])):(c(),d("div",Ci,[t.supportsModes?(c(),d("div",Si,[e[7]||(e[7]=n("label",null,"–†–µ–∂–∏–º –∫–µ—à–∞:",-1)),X(n("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.selectedMode=l),class:"form-control"},[(c(!0),d(z,null,V(t.availableModes,l=>(c(),d("option",{key:l,value:l},g(l),9,ki))),128))],512),[[ye,t.selectedMode]])])):k("",!0),n("div",Ei,[e[8]||(e[8]=n("label",null,"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):",-1)),X(n("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.paramsJson=l),placeholder:'{"product": "1C", ...}',rows:"5",class:"form-control"},null,512),[[pe,t.paramsJson]]),e[9]||(e[9]=n("small",{class:"form-text"},"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",-1))])]))]),n("div",Ai,[n("button",{onClick:e[3]||(e[3]=(...l)=>t.close&&t.close(...l)),class:"btn-cancel",disabled:t.creating},"–û—Ç–º–µ–Ω–∞",8,Ti),n("button",{onClick:e[4]||(e[4]=(...l)=>t.handleCreate&&t.handleCreate(...l)),disabled:t.creating,class:"btn-create"},[t.creating?(c(),d("span",xi,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",Ii,"–°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],8,Li)])])])}const Di=F(_i,[["render",Mi],["__scopeId","data-v-da24811e"]]),Pi={name:"CacheCreateButton",components:{CacheCreateModal:Di},props:{module:{type:Object,required:!0}},emits:["created"],setup(o,{emit:e}){const s=C(!1),t=C(!1);return{showModal:s,creating:t,openModal:()=>{s.value=!0},closeModal:()=>{s.value=!1},handleCreate:async l=>{t.value=!0;try{e("created",l)}finally{t.value=!1}}}}},Ui={class:"cache-create-button"},Ni=["disabled"],Ri={key:0},Fi={key:1};function Oi(o,e,s,t,a,i){const r=B("CacheCreateModal");return c(),d("div",Ui,[n("button",{onClick:e[0]||(e[0]=(...l)=>t.openModal&&t.openModal(...l)),disabled:t.creating,class:$(["btn-create",{"btn-disabled":t.creating}])},[t.creating?(c(),d("span",Ri,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",Fi,"‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],10,Ni),t.showModal?(c(),J(r,{key:0,module:s.module,onClose:t.closeModal,onCreate:t.handleCreate},null,8,["module","onClose","onCreate"])):k("",!0)])}const Bi=F(Pi,[["render",Oi],["__scopeId","data-v-177605d5"]]),$i={name:"CacheModuleCard",components:{CacheCreateButton:Bi},props:{module:{type:Object,required:!0,validator:o=>o&&typeof o.id=="string"&&typeof o.name=="string"},isPrimary:{type:Boolean,default:!1},priority:{type:Number,default:999},groupType:{type:String,default:null}},emits:["clear","refresh","details"],setup(o,{emit:e}){const s=C(!1),t=C(!1),a=C(!1),i=A(()=>o.priority<=3),r=A(()=>(o.module.file_count||0)===0),l=A(()=>{if(!o.module.expires_at)return!1;const M=(new Date(o.module.expires_at*1e3)-new Date)/(1e3*60*60);return M>0&&M<=24}),u=A(()=>o.module.status==="empty"||o.module.status==="expired"),m=A(()=>G.formatCacheSize(o.module.total_size||0)),p=A(()=>G.formatTTL(o.module.ttl||0)),f=A(()=>{if(!o.module.cache_dir)return"";const S=o.module.cache_dir.split("/");return S.length>2?"..."+S.slice(-2).join("/"):o.module.cache_dir}),x=A(()=>`priority-${o.priority}`),L=A(()=>`status-${o.module.status||"empty"}`),E=A(()=>`status-value-${o.module.status||"empty"}`),b=A(()=>o.module.status_text||(r.value?"–ü—É—Å—Ç":"–ê–∫—Ç–∏–≤–µ–Ω")),T=A(()=>o.groupType?G.getModuleTypeConfig(o.groupType).title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞":""),w=A(()=>{const S={users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"};return S[o.groupType]||S.other}),I=A(()=>{const S=o.priority||999;return ui(S).text}),D=A(()=>{if(!o.module.created_at)return"‚Äî";const S=new Date(o.module.created_at*1e3),O=new Date,M=O-S;if(M<6e4)return"–¢–æ–ª—å–∫–æ —á—Ç–æ";if(M<36e5){const K=Math.floor(M/6e4);return`${K} ${K===1?"–º–∏–Ω—É—Ç—É":K<5?"–º–∏–Ω—É—Ç—ã":"–º–∏–Ω—É—Ç"} –Ω–∞–∑–∞–¥`}if(S.toDateString()===O.toDateString())return`–°–µ–≥–æ–¥–Ω—è –≤ ${S.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`;const U=new Date(O);return U.setDate(U.getDate()-1),S.toDateString()===U.toDateString()?`–í—á–µ—Ä–∞ –≤ ${S.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:S.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),j=A(()=>{if(!o.module.expires_at)return"‚Äî";const S=new Date(o.module.expires_at*1e3),M=S-new Date;if(M<0)return`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω (${S.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})`;const U=Math.floor(M/6e4),K=Math.floor(U/60);return K>0?`${K} —á ${U%60} –º–∏–Ω`:U>0?`${U} –º–∏–Ω`:"–ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã"});return{clearing:s,creating:t,showDetailModal:a,isHighPriority:i,isEmpty:r,isExpiringSoon:l,canCreateCache:u,formattedSize:m,formattedTTL:p,shortCacheDir:f,priorityClass:x,statusClass:L,statusValueClass:E,statusText:b,groupTitle:T,groupIcon:w,usageFrequency:I,formattedCreatedAt:D,formattedExpiresAt:j,handleClear:async()=>{if(s.value||r.value)return;const S=o.isPrimary?`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è "${o.module.name}"? –≠—Ç–æ –º–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã.`:`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${o.module.name}"?`;if(confirm(S)){s.value=!0;try{await G.clearCache(o.module.id),e("clear",o.module.id),typeof BX<"u"&&BX.UI&&BX.UI.Notification&&BX.UI.Notification.Center.notify({content:`–ö–µ—à –º–æ–¥—É–ª—è "${o.module.name}" —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω`,autoHideDelay:3e3})}catch(O){console.error("[CacheModuleCard] Error clearing cache:",O),typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:`–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞: ${O.message}`,autoHideDelay:5e3}):alert(`–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞: ${O.message}`)}finally{s.value=!1}}},handleCacheCreated:()=>{e("refresh")},showDetails:()=>{a.value=!0,e("details",o.module)},closeDetails:()=>{a.value=!1}}}},ji={class:"module-indicator"},Wi={class:"card-header"},zi={class:"title-section"},Vi={class:"module-name"},qi={key:0,class:"primary-indicator"},Hi={key:0,class:"module-type"},Xi={key:1,class:"module-type"},Ji={class:"status-section"},Ki={class:"card-body"},Yi={class:"cache-info"},Gi={class:"info-row"},Qi={key:0,class:"info-row"},Zi={class:"info-value"},el={key:1,class:"info-row"},tl={class:"info-value"},sl={class:"info-row"},ol={class:"info-value"},nl={class:"info-row"},rl={class:"info-value"},al={class:"info-row"},il={class:"info-value"},ll={key:2,class:"info-row"},cl=["title"],dl={key:3,class:"info-row usage-hint"},ul={class:"info-value"},gl={class:"card-footer"},fl=["disabled"],ml={key:0},hl={key:1},vl={key:2},pl={class:"modal-content"};function yl(o,e,s,t,a,i){const r=B("CacheCreateButton");return c(),d("div",{class:$(["cache-module-card",{"primary-module":s.isPrimary,"secondary-module":!s.isPrimary,"high-priority":t.isHighPriority,"expiring-soon":t.isExpiringSoon,"empty-cache":t.isEmpty}])},[n("div",ji,[s.isPrimary?(c(),d("span",{key:0,class:$(["priority-badge",t.priorityClass])},g(s.priority),3)):k("",!0),s.groupType?(c(),d("span",{key:1,class:$(["group-indicator",s.groupType])},g(t.groupIcon),3)):k("",!0)]),n("div",Wi,[n("div",zi,[n("h3",Vi,[s.isPrimary?(c(),d("span",qi,"‚≠ê")):k("",!0),H(" "+g(s.module.name),1)]),s.isPrimary?(c(),d("span",Hi,"–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å")):s.groupType?(c(),d("span",Xi,g(t.groupTitle),1)):k("",!0)]),n("div",Ji,[n("span",{class:$(["module-status",t.statusClass])},g(t.statusText),3)])]),n("div",Ki,[n("div",Yi,[n("div",Gi,[e[4]||(e[4]=n("span",{class:"info-label"},"–°—Ç–∞—Ç—É—Å:",-1)),n("span",{class:$(["info-value",t.statusValueClass])},g(t.statusText),3)]),s.module.created_at?(c(),d("div",Qi,[e[5]||(e[5]=n("span",{class:"info-label"},"–°–æ–∑–¥–∞–Ω:",-1)),n("span",Zi,g(t.formattedCreatedAt),1)])):k("",!0),s.module.expires_at?(c(),d("div",el,[e[6]||(e[6]=n("span",{class:"info-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç:",-1)),n("span",tl,g(t.formattedExpiresAt),1)])):k("",!0),n("div",sl,[e[7]||(e[7]=n("span",{class:"info-label"},"–§–∞–π–ª–æ–≤:",-1)),n("span",ol,g(s.module.file_count||0),1)]),n("div",nl,[e[8]||(e[8]=n("span",{class:"info-label"},"–†–∞–∑–º–µ—Ä:",-1)),n("span",rl,g(t.formattedSize),1)]),n("div",al,[e[9]||(e[9]=n("span",{class:"info-label"},"TTL:",-1)),n("span",il,g(t.formattedTTL),1)]),s.module.cache_dir?(c(),d("div",ll,[e[10]||(e[10]=n("span",{class:"info-label"},"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:",-1)),n("span",{class:"info-value cache-dir",title:s.module.cache_dir},g(t.shortCacheDir),9,cl)])):k("",!0),s.isPrimary?(c(),d("div",dl,[e[11]||(e[11]=n("span",{class:"info-label"},"–ß–∞—Å—Ç–æ—Ç–∞:",-1)),n("span",ul,g(t.usageFrequency),1)])):k("",!0)])]),n("div",gl,[W(r,{module:s.module,onCreated:t.handleCacheCreated},null,8,["module","onCreated"]),n("button",{onClick:e[0]||(e[0]=(...l)=>t.handleClear&&t.handleClear(...l)),disabled:t.clearing||t.isEmpty,class:$(["btn-clear",{"btn-disabled":t.clearing||t.isEmpty,"btn-primary-action":s.isPrimary}])},[t.clearing?(c(),d("span",ml,"üßπ –û—á–∏—Å—Ç–∫–∞...")):t.isEmpty?(c(),d("span",hl,"üìÅ –ö–µ—à –ø—É—Å—Ç")):(c(),d("span",vl,"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à"))],10,fl),s.isPrimary&&!t.isEmpty?(c(),d("button",{key:0,onClick:e[1]||(e[1]=(...l)=>t.showDetails&&t.showDetails(...l)),class:"btn-details",title:"–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞"}," üìä ")):k("",!0)]),t.showDetailModal?(c(),d("div",{key:0,class:"detail-modal",onClick:e[3]||(e[3]=fe((...l)=>t.closeDetails&&t.closeDetails(...l),["self"]))},[n("div",pl,[n("h4",null,"–î–µ—Ç–∞–ª–∏ –∫–µ—à–∞: "+g(s.module.name),1),n("pre",null,g(JSON.stringify(s.module,null,2)),1),n("button",{onClick:e[2]||(e[2]=(...l)=>t.closeDetails&&t.closeDetails(...l)),class:"btn-close"},"–ó–∞–∫—Ä—ã—Ç—å")])])):k("",!0)],2)}const _l=F($i,[["render",yl],["__scopeId","data-v-f715c453"]]),wl={name:"CacheStats",props:{modules:{type:Array,required:!1,default:()=>[]}},setup(o){console.log("[CacheStats] setup called with modules:",o.modules);const e=A(()=>o.modules||[]),s=A(()=>{console.log("[CacheStats] Computing primaryModules, total modules:",e.value?.length||0);const E=e.value.filter(b=>G.PRIMARY_MODULE_IDS.includes(b.id));return console.log("[CacheStats] Primary modules count:",E.length),E}),t=A(()=>{console.log("[CacheStats] Computing secondaryModules, total modules:",e.value?.length||0);const E=e.value.filter(b=>!G.PRIMARY_MODULE_IDS.includes(b.id));return console.log("[CacheStats] Secondary modules count:",E.length),E}),a=A(()=>s.value?.length||0),i=A(()=>t.value?.length||0),r=A(()=>e.value?.length||0),l=A(()=>e.value.reduce((E,b)=>E+(b.file_count||0),0)),u=A(()=>(o.modules||[]).reduce((E,b)=>E+(b.total_size||0),0)),m=A(()=>G.formatCacheSize(u.value)),p=A(()=>{const E=o.modules||[];if(E.length===0)return"0 –º–∏–Ω";const b=E.reduce((w,I)=>w+(I.ttl||0),0),T=Math.round(b/E.length);return G.formatTTL(T)}),f=A(()=>(e.value||[]).filter(E=>E.status==="active").length),x=A(()=>{if((i.value||0)===0)return[];const E={};(t.value||[]).forEach(T=>{const w=G.getModuleType(T.id);if(!E[w]){const I=G.getModuleTypeConfig(w);E[w]={type:w,title:I.title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞",icon:L(w),count:0}}E[w].count++});const b=i.value||0;return Object.values(E).map(T=>({...T,percentage:b>0?Math.round(T.count/b*100):0})).sort((T,w)=>w.count-T.count)}),L=E=>{const b={users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"};return b[E]||b.other};return{modules:e,primaryModulesCount:a,secondaryModulesCount:i,totalModules:r,totalFiles:l,totalSizeFormatted:m,avgTTL:p,activeModules:f,groupStats:x}}},bl={key:0,class:"cache-stats"},Cl={class:"stats-overview"},Sl={class:"overview-grid"},kl={class:"overview-card primary"},El={class:"overview-content"},Al={class:"overview-value"},Tl={class:"overview-card secondary"},Ll={class:"overview-content"},xl={class:"overview-value"},Il={class:"overview-card total"},Ml={class:"overview-content"},Dl={class:"overview-value"},Pl={class:"detailed-stats"},Ul={class:"stats-grid"},Nl={class:"stat-card"},Rl={class:"stat-content"},Fl={class:"stat-value"},Ol={class:"stat-card"},Bl={class:"stat-content"},$l={class:"stat-value"},jl={class:"stat-card"},Wl={class:"stat-content"},zl={class:"stat-value"},Vl={class:"stat-card"},ql={class:"stat-content"},Hl={class:"stat-value"},Xl={key:0,class:"group-distribution"},Jl={class:"distribution-grid"},Kl={class:"group-icon"},Yl={class:"group-info"},Gl={class:"group-name"},Ql={class:"group-count"},Zl={class:"group-percentage"},ec={key:1,class:"cache-stats-loading"};function tc(o,e,s,t,a,i){return(t.modules||[]).length>0?(c(),d("div",bl,[e[18]||(e[18]=n("h2",{class:"stats-title"},"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",-1)),n("div",Cl,[n("div",Sl,[n("div",kl,[e[2]||(e[2]=n("div",{class:"overview-icon"},"üèÜ",-1)),n("div",El,[n("div",Al,g(t.primaryModulesCount),1),e[0]||(e[0]=n("div",{class:"overview-label"},"–û—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[1]||(e[1]=n("div",{class:"overview-desc"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ",-1))])]),n("div",Tl,[e[5]||(e[5]=n("div",{class:"overview-icon"},"üîß",-1)),n("div",Ll,[n("div",xl,g(t.secondaryModulesCount),1),e[3]||(e[3]=n("div",{class:"overview-label"},"–ü–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[4]||(e[4]=n("div",{class:"overview-desc"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),n("div",Il,[e[8]||(e[8]=n("div",{class:"overview-icon"},"üì¶",-1)),n("div",Ml,[n("div",Dl,g(t.totalModules),1),e[6]||(e[6]=n("div",{class:"overview-label"},"–í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π",-1)),e[7]||(e[7]=n("div",{class:"overview-desc"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö",-1))])])])]),n("div",Pl,[n("div",Ul,[n("div",Nl,[e[10]||(e[10]=n("div",{class:"stat-icon"},"üìÑ",-1)),n("div",Rl,[n("div",Fl,g(t.totalFiles),1),e[9]||(e[9]=n("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤",-1))])]),n("div",Ol,[e[12]||(e[12]=n("div",{class:"stat-icon"},"üíæ",-1)),n("div",Bl,[n("div",$l,g(t.totalSizeFormatted),1),e[11]||(e[11]=n("div",{class:"stat-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä",-1))])]),n("div",jl,[e[14]||(e[14]=n("div",{class:"stat-icon"},"‚è±Ô∏è",-1)),n("div",Wl,[n("div",zl,g(t.avgTTL),1),e[13]||(e[13]=n("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–∏–π TTL",-1))])]),n("div",Vl,[e[16]||(e[16]=n("div",{class:"stat-icon"},"‚ö°",-1)),n("div",ql,[n("div",Hl,g(t.activeModules),1),e[15]||(e[15]=n("div",{class:"stat-label"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–µ—à–µ–π",-1))])])])]),t.secondaryModulesCount>0?(c(),d("div",Xl,[e[17]||(e[17]=n("h3",{class:"distribution-title"},"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),n("div",Jl,[(c(!0),d(z,null,V(t.groupStats,r=>(c(),d("div",{key:r.type,class:"distribution-item"},[n("div",Kl,g(r.icon),1),n("div",Yl,[n("div",Gl,g(r.title),1),n("div",Ql,g(r.count)+" –º–æ–¥—É–ª–µ–π",1)]),n("div",Zl,g(r.percentage)+"%",1)]))),128))])])):k("",!0)])):(c(),d("div",ec,[...e[19]||(e[19]=[n("p",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])]))}const sc=F(wl,[["render",tc],["__scopeId","data-v-9fa190bb"]]),oc={name:"CacheManagement",components:{CacheModuleCard:_l,CacheStats:sc},setup(){const o=C([]),e=C([]),s=C(!0),t=C(null),a=A(()=>(o.value?.length||0)+(e.value?.length||0)),i=A(()=>{const b=r.value?.length||0,T=(l.value?.length||0)>0?1:0;return b+T}),r=A(()=>{const b=(o.value||[]).filter(T=>!T.id.includes("time-tracking"));return console.log("[CacheManagement] individualPrimaryModules:",b.length,b.map(T=>T.id)),b}),l=A(()=>{const b=(o.value||[]).filter(T=>T.id.includes("time-tracking")).sort((T,w)=>{const I=["time-tracking-default","time-tracking-detailed","time-tracking-summary"];return I.indexOf(T.id)-I.indexOf(w.id)});return console.log("[CacheManagement] timeTrackingModules:",b.length,b.map(T=>T.id)),b}),u=A(()=>{const b={};return(e.value||[]).forEach(w=>{const I=G.getModuleType(w.id);b[I]||(b[I]={type:I,title:p(I),modules:[]}),b[I].modules.push(w)}),Object.values(b).sort((w,I)=>{const D=["users","activity","webhooks","other"],j=D.indexOf(w.type),P=D.indexOf(I.type);return(j===-1?999:j)-(P===-1?999:P)})}),m=async()=>{s.value=!0,t.value=null;try{const b=[{id:"dashboard-sector-1c",name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",status:"active",file_count:5,total_size:1024e3,ttl:600},{id:"graph-state",name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",status:"active",file_count:3,total_size:512e3,ttl:3600},{id:"graph-admission-closure-weeks",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",status:"active",file_count:8,total_size:2048e3,ttl:300},{id:"graph-admission-closure-months",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",status:"active",file_count:12,total_size:3072e3,ttl:300},{id:"time-tracking-default",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",status:"active",file_count:4,total_size:768e3,ttl:300},{id:"time-tracking-detailed",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:6,total_size:1536e3,ttl:120},{id:"time-tracking-summary",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:2,total_size:384e3,ttl:600},{id:"users-management-departments",name:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–æ—Ç–¥–µ–ª—ã)",status:"active",file_count:2,total_size:256e3,ttl:3600},{id:"webhook-logs-api",name:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ (API –∑–∞–ø—Ä–æ—Å—ã)",status:"active",file_count:15,total_size:512e4,ttl:300}],T=G.categorizeAndSortModules(b);o.value=T.primaryModules||[],e.value=T.secondaryModules||[],console.log("[CacheManagement] Primary modules:",o.value.length,o.value.map(w=>({id:w.id,name:w.name}))),console.log("[CacheManagement] Secondary modules:",e.value.length,e.value.map(w=>({id:w.id,name:w.name})))}catch(b){console.error("[CacheManagement] Error loading modules:",b),t.value=b.message}finally{s.value=!1}},p=b=>{const T={users:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",activity:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",webhooks:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",other:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏"};return T[b]||T.other},f=async b=>{console.log(`[CacheManagement] Clearing module: ${b}`),await m()},x=async b=>{console.log(`[CacheManagement] Creating cache for: ${b.name} (${b.id})`),alert(`–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${b.name}
ID: ${b.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},L=async b=>{console.log(`[CacheManagement] Clearing cache for: ${b.name} (${b.id})`),alert(`–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${b.name}
ID: ${b.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},E=()=>{m()};return ee(()=>{m()}),{primaryModules:o,secondaryModules:e,loading:s,error:t,totalModules:a,groupedSecondaryModules:u,individualPrimaryModules:r,timeTrackingModules:l,logicalPrimaryCount:i,handleModuleClear:f,handleCreateMock:x,handleClearMock:L,refreshModules:E}}},nc={class:"cache-management"},rc={key:0,class:"header-section"},ac={class:"stats-bar"},ic={class:"stat-item"},lc={class:"stat-item"},cc={class:"stat-item"},dc={class:"section-header"},uc={class:"section-meta"},gc={class:"module-count"},fc={key:0,class:"modules-container"},mc={style:{background:"#f0f8ff",padding:"10px",margin:"10px 0",border:"1px solid #007bff","border-radius":"4px"}},hc={key:0,class:"modules-grid"},vc=["onClick"],pc=["onClick"],yc={key:1,class:"time-tracking-group"},_c={class:"modules-grid"},wc=["onClick"],bc=["onClick"],Cc={key:1,class:"empty-state"},Sc={key:2,class:"section-divider"},kc={key:3,class:"cache-section secondary-modules"},Ec={class:"section-header"},Ac={class:"section-meta"},Tc={class:"module-count"},Lc={class:"grouped-modules"},xc={class:"group-title"},Ic={class:"modules-grid"},Mc={key:4,class:"error-message"},Dc={key:5,class:"loading-overlay"};function Pc(o,e,s,t,a,i){const r=B("CacheModuleCard");return c(),d("div",nc,[!t.loading&&!t.error?(c(),d("div",rc,[e[5]||(e[5]=n("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1)),e[6]||(e[6]=n("p",{class:"description"}," –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º —Å–∏—Å—Ç–µ–º—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è ",-1)),n("div",ac,[n("span",ic,[n("strong",null,g(t.totalModules),1),e[2]||(e[2]=H(" –≤—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π ",-1))]),n("span",lc,[n("strong",null,g(t.logicalPrimaryCount),1),e[3]||(e[3]=H(" –æ—Å–Ω–æ–≤–Ω—ã—Ö ",-1))]),n("span",cc,[n("strong",null,g((t.secondaryModules||[]).length),1),e[4]||(e[4]=H(" –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ",-1))])])])):k("",!0),!t.loading&&!t.error?(c(),d("div",{key:1,class:$(["cache-section primary-modules",{empty:(t.primaryModules||[]).length===0}])},[n("div",dc,[e[8]||(e[8]=n("h2",null,"üèÜ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),n("div",uc,[n("span",gc,g(t.logicalPrimaryCount),1),e[7]||(e[7]=n("span",{class:"section-badge primary"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",-1))])]),e[16]||(e[16]=n("p",{class:"section-description"}," 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã: –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°, –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏–µ–º–∞-–∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°. ",-1)),(t.primaryModules||[]).length>0?(c(),d("div",fc,[n("div",mc,[n("strong",null,"DEBUG: Primary modules loaded: "+g(t.primaryModules.length),1),e[9]||(e[9]=n("br",null,null,-1)),n("strong",null,"Individual modules: "+g(t.individualPrimaryModules.length),1),e[10]||(e[10]=n("br",null,null,-1)),n("strong",null,"Time tracking modules: "+g(t.timeTrackingModules.length),1),e[11]||(e[11]=n("br",null,null,-1)),e[12]||(e[12]=n("strong",null,"IDs:",-1)),H(" "+g(t.primaryModules.map(l=>l.id).join(", ")),1)]),t.individualPrimaryModules.length>0?(c(),d("div",hc,[n("h4",null,"–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ ("+g(t.individualPrimaryModules.length)+")",1),(c(!0),d(z,null,V(t.individualPrimaryModules,l=>(c(),d("div",{key:l.id,style:{border:"2px solid #007bff",margin:"5px",padding:"10px"}},[n("strong",null,g(l.name),1),H(" ("+g(l.id)+") - Priority: "+g(l.priority)+" ",1),n("button",{onClick:u=>t.handleCreateMock(l),style:{background:"#28a745",color:"white",border:"none",padding:"8px 16px","border-radius":"4px",cursor:"pointer"}}," ‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à ("+g(l.name)+") ",9,vc),n("button",{onClick:u=>t.handleClearMock(l),style:{background:"#dc3545",color:"white",border:"none",padding:"8px 16px","border-radius":"4px",cursor:"pointer","margin-left":"10px"}}," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à ("+g(l.name)+") ",9,pc)]))),128))])):k("",!0),(t.timeTrackingModules||[]).length>0?(c(),d("div",yc,[e[13]||(e[13]=n("h3",{class:"group-title"},"‚è±Ô∏è –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",-1)),e[14]||(e[14]=n("p",{class:"group-description"},"–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),n("div",_c,[n("h4",null,"–ú–æ–¥—É–ª–∏ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç ("+g(t.timeTrackingModules.length)+")",1),(c(!0),d(z,null,V(t.timeTrackingModules,l=>(c(),d("div",{key:l.id,style:{border:"2px solid #28a745",margin:"5px",padding:"10px"}},[n("strong",null,g(l.name),1),H(" ("+g(l.id)+") - Priority: "+g(l.priority)+" ",1),n("button",{onClick:u=>t.handleCreateMock(l),style:{background:"#28a745",color:"white",border:"none",padding:"8px 16px","border-radius":"4px",cursor:"pointer"}}," ‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à ("+g(l.name)+") ",9,wc),n("button",{onClick:u=>t.handleClearMock(l),style:{background:"#dc3545",color:"white",border:"none",padding:"8px 16px","border-radius":"4px",cursor:"pointer","margin-left":"10px"}}," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à ("+g(l.name)+") ",9,bc)]))),128))])])):k("",!0)])):(c(),d("div",Cc,[e[15]||(e[15]=n("p",null,"‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)),n("button",{onClick:e[0]||(e[0]=(...l)=>t.refreshModules&&t.refreshModules(...l)),class:"refresh-btn"},"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫")]))],2)):k("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("div",Sc,[...e[17]||(e[17]=[Lt('<div class="divider-line" data-v-94ddd654></div><div class="divider-content" data-v-94ddd654><span class="divider-icon" data-v-94ddd654>üîß</span><span class="divider-text" data-v-94ddd654>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏</span><span class="divider-subtitle" data-v-94ddd654>–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</span></div><div class="divider-line" data-v-94ddd654></div>',3)])])):k("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("div",kc,[n("div",Ec,[e[19]||(e[19]=n("h2",null,"üîß –ü–æ–±–æ—á–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),n("div",Ac,[n("span",Tc,g((t.secondaryModules||[]).length),1),e[18]||(e[18]=n("span",{class:"section-badge secondary"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),e[20]||(e[20]=n("p",{class:"section-description"}," –ú–æ–¥—É–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã. ",-1)),n("div",Lc,[(c(!0),d(z,null,V(t.groupedSecondaryModules,l=>(c(),d("div",{key:l.type,class:"module-group"},[n("h3",xc,g(l.title),1),n("div",Ic,[(c(!0),d(z,null,V(l.modules,u=>(c(),J(r,{key:u.id,module:u,"is-primary":!1,"group-type":l.type,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","group-type","onClear","onRefresh"]))),128))])]))),128))])])):k("",!0),t.error?(c(),d("div",Mc,[e[21]||(e[21]=n("h3",null,"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞",-1)),n("p",null,g(t.error),1),n("button",{onClick:e[1]||(e[1]=(...l)=>o.loadModules&&o.loadModules(...l)),class:"retry-btn"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):k("",!0),t.loading?(c(),d("div",Dc,[...e[22]||(e[22]=[n("div",{class:"loading-spinner"},null,-1),n("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞...",-1)])])):k("",!0)])}const Uc=F(oc,[["render",Pc],["__scopeId","data-v-94ddd654"]]),Nc={name:"CacheManagementPage",components:{CacheManagement:Uc},beforeCreate(){console.log("[CacheManagementPage] beforeCreate() called")},created(){console.log("[CacheManagementPage] created() called")},beforeMount(){console.log("[CacheManagementPage] beforeMount() called")},setup(){console.log("[CacheManagementPage] setup() called with new hierarchical UI");const o=Ee(),e=C(!1),s=C(null),t=()=>{o.push({name:"index"})};return ee(()=>{console.log("[CacheManagementPage] onMounted() called - hierarchical cache management ready")}),{loading:e,error:s,goBack:t}}},Rc={class:"cache-management-page"},Fc={class:"page-header"},Oc={class:"page-header-top"},Bc={key:0,class:"loading"},$c={key:1,class:"error"},jc={key:2,class:"cache-content"};function Wc(o,e,s,t,a,i){const r=B("CacheManagement");return c(),d("div",Rc,[n("div",Fc,[n("div",Oc,[n("button",{onClick:e[0]||(e[0]=(...l)=>t.goBack&&t.goBack(...l)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[n("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),n("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=n("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1))]),t.loading?(c(),d("div",Bc," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–µ—à–∞... ")):t.error?(c(),d("div",$c,g(t.error),1)):(c(),d("div",jc,[W(r)]))])}const zc=F(Nc,[["render",Wc],["__scopeId","data-v-a20ded38"]]),Vc=[{path:"/install",name:"install",component:as},{path:"/",name:"index",component:Fs},{path:"/webhook-logs",name:"webhook-logs",redirect:"/admin/webhook-logs"},{path:"/admin/webhook-logs",name:"admin-webhook-logs",component:Vr,meta:{requiresAuth:!0,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",adminOnly:!0}},{path:"/admin/users",name:"admin-users",component:di,meta:{requiresAuth:!0,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",adminOnly:!0}},{path:"/admin/cache",name:"admin-cache",component:zc,meta:{requiresAuth:!0,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",adminOnly:!0}},{path:"/dashboard/sector-1c",name:"dashboard-sector-1c",component:()=>te(()=>import("./DashboardSector1C.vue-C4Tidfp_.js"),__vite__mapDeps([7,4,8,9,2,1,10]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector1c"}},{path:"/dashboard/graph-admission-closure",name:"dashboard-graph-admission-closure",component:()=>te(()=>import("./GraphAdmissionClosureDashboard.vue-BxpL3HP_.js"),__vite__mapDeps([11,4,12,2,1,9,13,8]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–æ–≤—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",requiresAuth:!0,chunk:"admission-dashboard"}},{path:"/dashboard/graph-state",name:"dashboard-graph-state",component:()=>te(()=>import("./GraphStateDashboard.vue-BC2P0S9w.js"),__vite__mapDeps([14,4,1,10,2,9,8,12]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏",requiresAuth:!0,chunk:"graph-state"}},{path:"/dashboard/tickets-time-tracking",name:"dashboard-tickets-time-tracking",component:()=>te(()=>import("./TicketsTimeTrackingDashboard.vue-DpPpUCPb.js"),__vite__mapDeps([15,4,1,2]),import.meta.url),meta:{title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",requiresAuth:!0,chunk:"tickets-tracking"}}],Ue=xt({history:It(),routes:Vc});Ue.beforeEach(async(o,e,s)=>{if(console.log("[Router] beforeEach:",{to:o.path,from:e.path,name:o.name}),o.meta.title&&(document.title=`${o.meta.title} - Bitrix24 Dashboard`),o.meta.requiresAuth){console.log("[Router] requiresAuth check for:",o.path);try{const t=await ve.checkAccess();if(!t.allowed){console.warn("Unauthorized access attempt to:",o.path,t.errorMessage),s({name:"index"});return}}catch(t){console.error("Error checking access in navigation guard:",t),s();return}}if(o.meta.adminOnly)try{const t=await ve.getCurrentUser();if(!t||!nt(t)){console.warn("Admin access required for:",o.path),s({name:"index"});return}}catch(t){console.error("Error checking admin access in navigation guard:",t),s({name:"index"});return}if(e.name!==null&&o.path!==e.path)try{if((await ve.checkAccess()).allowed){const a=await ve.getCurrentUser();a&&Ie.logPageVisit(o,a,e).catch(i=>{console.error("[Router] Error logging page visit:",i)})}}catch(t){console.error("[Router] Error in activity logging:",t)}if(o.name==="index"&&!e.name&&setTimeout(()=>{te(()=>import("./DashboardSector1C.vue-C4Tidfp_.js"),__vite__mapDeps([7,4,8,9,2,1,10]),import.meta.url)},1e3),o.meta.chunk)switch(o.meta.chunk){case"dashboard-sector1c":setTimeout(()=>{te(()=>import("./dashboard-sector-1c-service--7Y0mDSl.js"),__vite__mapDeps([13,2,1,9]),import.meta.url)},500);break;case"admission-dashboard":setTimeout(()=>{te(()=>import("./chunk-C5D5xwuQ.js").then(t=>t.l),__vite__mapDeps([2,1]),import.meta.url)},500);break}console.log("[Router] Allowing navigation to:",o.path),s()});setTimeout(()=>{const o=window.location.pathname,e=window.location.hash;e&&e!=="#/"||(o.includes("install.php")?Ue.replace("/install"):Ue.replace("/"))},0);Te.register(Mt,Dt,Pt,Ut,Nt,Rt,Ft,Ot,Bt,$t);Te.defaults.responsive=!0;Te.defaults.maintainAspectRatio=!1;Te.defaults.plugins.legend.display=!0;Te.defaults.plugins.legend.position="top";const Qc={primary:"#007bff",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8",carryover:"#ff9800",successLight:"#6cbf47",carryoverLight:"#ffb74d",carryoverDark:"#f57c00"};class De{static startBundleLoad(){this.metrics.bundleLoadTime=performance.now()}static endBundleLoad(e){const s=performance.now()-this.metrics.bundleLoadTime;this.metrics.chunkLoadTimes.set(e,s),console.log(`üì¶ Chunk "${e}" loaded in ${s.toFixed(2)}ms`),window.gtag&&window.gtag("event","bundle_load",{chunk_name:e,load_time:s}),s>1e3&&console.warn(`üêå Slow chunk load: ${e} took ${s.toFixed(2)}ms`)}static trackComponentLoad(e,s){const t=performance.now()-s;this.metrics.componentLoadTime.set(e,t),console.log(`üß© Component "${e}" loaded in ${t.toFixed(2)}ms`),t>500&&console.warn(`üêå Slow component load: ${e} took ${t.toFixed(2)}ms`)}static trackApiCall(e,s){this.metrics.apiResponseTime.set(e,s),s>1e3&&console.warn(`üêå Slow API call to ${e}: ${s}ms`)}static getReport(){const e=Array.from(this.metrics.componentLoadTime.values()),s=Array.from(this.metrics.apiResponseTime.values()),t=Array.from(this.metrics.chunkLoadTimes.values());return{totalChunks:this.metrics.chunkLoadTimes.size,totalComponents:this.metrics.componentLoadTime.size,totalApiCalls:this.metrics.apiResponseTime.size,averageComponentLoadTime:e.length>0?e.reduce((a,i)=>a+i,0)/e.length:0,averageApiResponseTime:s.length>0?s.reduce((a,i)=>a+i,0)/s.length:0,averageChunkLoadTime:t.length>0?t.reduce((a,i)=>a+i,0)/t.length:0,slowestComponents:Array.from(this.metrics.componentLoadTime.entries()).sort(([,a],[,i])=>i-a).slice(0,5).map(([a,i])=>({name:a,time:i})),slowestApiCalls:Array.from(this.metrics.apiResponseTime.entries()).sort(([,a],[,i])=>i-a).slice(0,5).map(([a,i])=>({endpoint:a,time:i})),slowestChunks:Array.from(this.metrics.chunkLoadTimes.entries()).sort(([,a],[,i])=>i-a).slice(0,5).map(([a,i])=>({name:a,time:i}))}}static clearMetrics(){this.metrics.bundleLoadTime=0,this.metrics.componentLoadTime.clear(),this.metrics.apiResponseTime.clear(),this.metrics.chunkLoadTimes.clear()}}he(De,"metrics",{bundleLoadTime:0,componentLoadTime:new Map,apiResponseTime:new Map,chunkLoadTimes:new Map});class qc{static init(){this.initChunkLoadErrorHandling(),this.initUnhandledErrorHandling(),this.initNetworkErrorHandling()}static initChunkLoadErrorHandling(){if(window.addEventListener("error",e=>{e.target.tagName==="SCRIPT"&&(console.error("‚ùå Chunk loading error:",e.target.src),this.reportError("chunk_load_error",{url:e.target.src,message:e.message||"Script load failed"}))}),"PerformanceObserver"in window)try{new PerformanceObserver(s=>{for(const t of s.getEntries())if(t.entryType==="resource"&&t.name.includes(".js")){const a=t.responseEnd-t.requestStart;De.trackApiCall(t.name,a)}}).observe({entryTypes:["resource"]})}catch{console.warn("PerformanceObserver not supported")}}static initUnhandledErrorHandling(){window.addEventListener("unhandledrejection",e=>{console.error("‚ùå Unhandled promise rejection:",e.reason),this.reportError("unhandled_rejection",{reason:e.reason?.message||String(e.reason),stack:e.reason?.stack})}),window.addEventListener("error",e=>{e.error&&e.filename&&(console.error("‚ùå Unhandled error:",e.error),this.reportError("unhandled_error",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error.stack}))})}static initNetworkErrorHandling(){const e=window.fetch;window.fetch=function(...s){const t=performance.now();return e.apply(this,s).then(a=>{const i=performance.now()-t;return De.trackApiCall(s[0],i),a.ok||console.warn(`üö® API error: ${a.status} ${a.statusText} for ${s[0]}`),a}).catch(a=>{const i=performance.now()-t;throw console.error(`‚ùå Network error for ${s[0]}:`,a),De.trackApiCall(s[0],i),this.reportError("network_error",{url:s[0],message:a.message,loadTime:i}),a})}}static reportError(e,s){const t={type:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...s};if(console.error("üìä Error report:",t),window.Sentry&&window.Sentry.captureException(new Error(`${e}: ${JSON.stringify(s)}`)),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:"/api/log-error.php",method:"POST",data:t})}catch(a){console.error("Failed to send error report to Bitrix24:",a)}window.gtag&&window.gtag("event","exception",{description:`${e}: ${s.message||"Unknown error"}`,fatal:!1})}static getErrorStats(){return{chunkLoadErrors:0,networkErrors:0,unhandledErrors:0,totalErrors:0}}}const He=jt(qt);He.use(Ue);const Hc=o=>{try{const e=new WeakSet;return JSON.stringify(o,(s,t)=>{if(typeof t=="object"&&t!==null){if(e.has(t))return"[Circular]";e.add(t)}return typeof t=="function"||t===void 0?null:t})}catch{return String(o)}};He.config.errorHandler=(o,e,s)=>{if(console.error("Vue error:",o,s),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:ie("/api/log-error.php"),method:"POST",data:{error:o?.message||String(o),info:typeof s=="string"?s:Hc(s),component:e?.$options?.name||"Unknown"}})}catch(t){console.error("Failed to log error:",t)}};He.mount("#app");qc.init();export{ve as A,Me as C,st as L,tt as S,F as _,_e as a,ge as b,Qc as c,ce as d,Bs as e,Se as f,Ve as g,Gc as h,nt as i,Ce as n,at as u};
