import{j as v,c as f,o as p,e as s,b as P,t as b,n as L,O as j,g as $,F as T,k as A,f as B,r as k,Q as F,l as M,R,a as D,s as z,T as x}from"./chunk-DgW6SZr3.js";import{_ as E,f as q,b as N,n as W,i as I,c as _}from"./main-DrPz_qB2.js";import"./chunk-DtofVZad.js";import"./chunk-BDCz7ema.js";import"./chunk-D-Yjiir1.js";import"./chunk-CWixr2GV.js";import"./chunk-m4THMsAL.js";const U={name:"WebhookLogsStats",props:{logs:{type:Array,required:!0,default:()=>[]},totalCount:{type:Number,default:null},previousPeriodStats:{type:Object,default:null}},setup(c){const t=v(()=>!c.logs||!Array.isArray(c.logs)?[]:c.logs.map(a=>W(a)).filter(a=>I(a))),y=v(()=>c.totalCount!==null&&c.totalCount!==void 0?c.totalCount:t.value.length),e=v(()=>t.value.filter(a=>a.category==="tasks").length),d=v(()=>t.value.filter(a=>a.category==="smart-processes").length),u=v(()=>t.value.filter(a=>a.category==="errors").length),g=v(()=>{if(t.value.length===0)return 0;const a=t.value.reduce((h,O)=>{try{const w=JSON.stringify(O.payload||{}).length;return h+w}catch{return h}},0);return Math.round(a/t.value.length)}),n=v(()=>{const a=new Set;return t.value.forEach(h=>{h.ip&&a.add(h.ip)}),a.size}),r=v(()=>{const a={total:t.value.length,byCategory:{},byEvent:{},byDate:{}};return t.value.forEach(h=>{if(h.category&&(a.byCategory[h.category]=(a.byCategory[h.category]||0)+1),h.event&&(a.byEvent[h.event]=(a.byEvent[h.event]||0)+1),h.timestamp)try{const w=new Date(h.timestamp).toISOString().split("T")[0];a.byDate[w]=(a.byDate[w]||0)+1}catch{console.warn("[WebhookLogsStats] Invalid timestamp:",h.timestamp)}}),a}),i=a=>N(a),l=a=>q(a),o=a=>{try{return new Date(a).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return a}},m=(a,h)=>h===0?0:Math.round(a/h*100),C=a=>a===0?"0":a<1024?a.toString():a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(1)+" MB",S=v(()=>{if(!c.previousPeriodStats)return null;const a=c.previousPeriodStats.totalEvents||0;return y.value-a});return{normalizedLogs:t,totalEvents:y,tasksCount:e,smartProcessesCount:d,errorsCount:u,averagePayloadSize:g,uniqueIpsCount:n,stats:r,getPercentage:m,formatBytes:C,totalEventsChange:S,getChangeClass:a=>a===null?"":a>0?"change-positive":a<0?"change-negative":"change-neutral",formatChange:a=>a===null?"":`${a>0?"+":""}${a}`,getCategoryLabel:i,getEventLabel:l,formatDate:o}}},Y={class:"webhook-stats"},V={class:"stats-grid"},K={class:"stat-card stat-card-primary"},H={class:"stat-content"},Z={class:"stat-value"},G={key:0,class:"stat-change"},J={class:"stat-card stat-card-info"},Q={class:"stat-content"},X={class:"stat-value"},tt={class:"stat-percentage"},et={class:"stat-card stat-card-success"},st={class:"stat-content"},at={class:"stat-value"},rt={class:"stat-percentage"},ot={class:"stat-card stat-card-danger"},nt={class:"stat-content"},lt={class:"stat-value"},it={key:0,class:"stat-percentage"},ct={key:1,class:"stat-percentage success"},dt={class:"stat-card stat-card-warning"},ut={class:"stat-content"},vt={class:"stat-value"},gt={class:"stat-card stat-card-secondary"},ht={class:"stat-content"},pt={class:"stat-value"};function yt(c,t,y,e,d,u){return p(),f("div",Y,[t[14]||(t[14]=s("h3",{class:"stats-title"},"Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°",-1)),s("div",V,[s("div",K,[t[2]||(t[2]=s("div",{class:"stat-icon"},"ðŸ“Š",-1)),s("div",H,[t[1]||(t[1]=s("div",{class:"stat-label"},"Ð’ÑÐµÐ³Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹",-1)),s("div",Z,b(e.totalEvents),1),y.previousPeriodStats?(p(),f("div",G,[s("span",{class:L(e.getChangeClass(e.totalEventsChange))},b(e.formatChange(e.totalEventsChange)),3),t[0]||(t[0]=s("span",{class:"stat-period"},"vs Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´",-1))])):P("",!0)])]),s("div",J,[t[4]||(t[4]=s("div",{class:"stat-icon"},"âœ…",-1)),s("div",Q,[t[3]||(t[3]=s("div",{class:"stat-label"},"Ð—Ð°Ð´Ð°Ñ‡Ð¸",-1)),s("div",X,b(e.tasksCount),1),s("div",tt,b(e.getPercentage(e.tasksCount,e.totalEvents))+"% Ð¾Ñ‚ Ð¾Ð±Ñ‰ÐµÐ³Ð¾ ",1)])]),s("div",et,[t[6]||(t[6]=s("div",{class:"stat-icon"},"âš™ï¸",-1)),s("div",st,[t[5]||(t[5]=s("div",{class:"stat-label"},"Ð¡Ð¼Ð°Ñ€Ñ‚-Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹",-1)),s("div",at,b(e.smartProcessesCount),1),s("div",rt,b(e.getPercentage(e.smartProcessesCount,e.totalEvents))+"% Ð¾Ñ‚ Ð¾Ð±Ñ‰ÐµÐ³Ð¾ ",1)])]),s("div",ot,[t[8]||(t[8]=s("div",{class:"stat-icon"},"âŒ",-1)),s("div",nt,[t[7]||(t[7]=s("div",{class:"stat-label"},"ÐžÑˆÐ¸Ð±ÐºÐ¸",-1)),s("div",lt,b(e.errorsCount),1),e.errorsCount>0?(p(),f("div",it,b(e.getPercentage(e.errorsCount,e.totalEvents))+"% Ð¾Ñ‚ Ð¾Ð±Ñ‰ÐµÐ³Ð¾ ",1)):(p(),f("div",ct," ÐžÑˆÐ¸Ð±Ð¾Ðº Ð½ÐµÑ‚ "))])]),s("div",dt,[t[11]||(t[11]=s("div",{class:"stat-icon"},"ðŸ“¦",-1)),s("div",ut,[t[9]||(t[9]=s("div",{class:"stat-label"},"Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€ payload",-1)),s("div",vt,b(e.formatBytes(e.averagePayloadSize)),1),t[10]||(t[10]=s("div",{class:"stat-unit"},"Ð±Ð°Ð¹Ñ‚",-1))])]),s("div",gt,[t[13]||(t[13]=s("div",{class:"stat-icon"},"ðŸŒ",-1)),s("div",ht,[t[12]||(t[12]=s("div",{class:"stat-label"},"Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… IP",-1)),s("div",pt,b(e.uniqueIpsCount),1)])])])])}const mt=E(U,[["render",yt],["__scopeId","data-v-4935c671"]]),ft={name:"EventsTimelineChart",components:{Line:j},props:{logs:{type:Array,required:!0,default:()=>[]}},setup(c){const t=$("hour"),y=[{value:"hour",label:"ÐŸÐ¾ Ñ‡Ð°ÑÐ°Ð¼"},{value:"day",label:"ÐŸÐ¾ Ð´Ð½ÑÐ¼"},{value:"week",label:"ÐŸÐ¾ Ð½ÐµÐ´ÐµÐ»ÑÐ¼"}],e=n=>{const r=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),i=r.getUTCDay()||7;r.setUTCDate(r.getUTCDate()+4-i);const l=new Date(Date.UTC(r.getUTCFullYear(),0,1));return Math.ceil(((r-l)/864e5+1)/7)},d=(n,r)=>{const i={};return n.forEach(l=>{if(!l.timestamp)return;const o=new Date(l.timestamp);let m;switch(r){case"hour":m=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")} ${String(o.getHours()).padStart(2,"0")}:00`;break;case"day":m=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`;break;case"week":const C=e(o);m=`${o.getFullYear()}-W${String(C).padStart(2,"0")}`;break;default:m=o.toISOString()}i[m]=(i[m]||0)+1}),i},u=v(()=>{if(!c.logs||c.logs.length===0)return null;const n=d(c.logs,t.value),r=Object.keys(n).sort(),i=r.map(l=>n[l]);return{labels:r,datasets:[{label:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹",data:i,borderColor:_.primary,backgroundColor:l=>{if(!l.chart)return _.primary;const o=l.chart.ctx.createLinearGradient(0,0,0,400);return o.addColorStop(0,"rgba(0, 123, 255, 0.3)"),o.addColorStop(1,"rgba(0, 123, 255, 0.05)"),o},fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6,pointBackgroundColor:_.primary,pointBorderColor:"#fff",pointBorderWidth:2}]}}),g=v(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},title:{display:!1},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},callbacks:{label:function(n){return`${n.dataset.label}: ${n.parsed.y}`}}}},scales:{x:{display:!0,title:{display:!0,text:"Ð’Ñ€ÐµÐ¼Ñ"},grid:{display:!1}},y:{display:!0,title:{display:!0,text:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹"},beginAtZero:!0,ticks:{stepSize:1}}},interaction:{mode:"nearest",axis:"x",intersect:!1}}));return{selectedPeriod:t,timePeriods:y,chartData:u,chartOptions:g}}},bt={class:"chart-container"},_t={class:"chart-header"},Ct={class:"chart-controls"},kt=["onClick"],St={class:"chart-wrapper"},Dt={key:1,class:"chart-empty"};function Et(c,t,y,e,d,u){const g=k("Line");return p(),f("div",bt,[s("div",_t,[t[0]||(t[0]=s("h4",null,"Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸",-1)),s("div",Ct,[(p(!0),f(T,null,A(e.timePeriods,n=>(p(),f("button",{key:n.value,onClick:r=>e.selectedPeriod=n.value,class:L(["period-btn",{active:e.selectedPeriod===n.value}])},b(n.label),11,kt))),128))])]),s("div",St,[e.chartData?(p(),B(g,{key:0,data:e.chartData,options:e.chartOptions,height:300},null,8,["data","options"])):(p(),f("div",Dt,[...t[1]||(t[1]=[s("p",null,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ",-1)])]))])])}const wt=E(ft,[["render",Et],["__scopeId","data-v-c9e42b61"]]),Pt={name:"CategoriesChart",components:{Doughnut:F},props:{logs:{type:Array,required:!0,default:()=>[]}},setup(c){const t={tasks:"Ð—Ð°Ð´Ð°Ñ‡Ð¸","smart-processes":"Ð¡Ð¼Ð°Ñ€Ñ‚-Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹",errors:"ÐžÑˆÐ¸Ð±ÐºÐ¸"},y={tasks:_.primary,"smart-processes":_.success,errors:_.danger},e=v(()=>{const r={tasks:0,"smart-processes":0,errors:0};return c.logs.forEach(i=>{i.category&&r.hasOwnProperty(i.category)&&r[i.category]++}),r}),d=v(()=>Object.values(e.value).reduce((r,i)=>r+i,0)),u=v(()=>{if(d.value===0)return null;const r=[],i=[],l=[];return Object.keys(e.value).forEach(o=>{e.value[o]>0&&(r.push(t[o]),i.push(e.value[o]),l.push(y[o]))}),{labels:r,datasets:[{data:i,backgroundColor:l,borderWidth:2,borderColor:"#fff",hoverOffset:4}]}}),g=v(()=>Object.keys(e.value).filter(r=>e.value[r]>0).map(r=>({label:t[r],value:e.value[r],percentage:d.value>0?Math.round(e.value[r]/d.value*100):0,color:y[r]}))),n=v(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,callbacks:{label:function(r){const i=r.label||"",l=r.parsed||0,o=r.dataset.data.reduce((C,S)=>C+S,0),m=o>0?Math.round(l/o*100):0;return`${i}: ${l} (${m}%)`}}}}}));return{chartData:u,chartOptions:n,legendData:g}}},Lt={class:"chart-container"},Ot={class:"chart-wrapper"},$t={key:1,class:"chart-empty"},Bt={key:0,class:"chart-legend"},zt={class:"legend-label"},xt={class:"legend-value"};function Tt(c,t,y,e,d,u){const g=k("Doughnut");return p(),f("div",Lt,[t[1]||(t[1]=s("div",{class:"chart-header"},[s("h4",null,"Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼")],-1)),s("div",Ot,[e.chartData?(p(),B(g,{key:0,data:e.chartData,options:e.chartOptions,height:300},null,8,["data","options"])):(p(),f("div",$t,[...t[0]||(t[0]=[s("p",null,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ",-1)])]))]),e.legendData.length>0?(p(),f("div",Bt,[(p(!0),f(T,null,A(e.legendData,(n,r)=>(p(),f("div",{key:r,class:"legend-item"},[s("span",{class:"legend-color",style:M({backgroundColor:n.color})},null,4),s("span",zt,b(n.label),1),s("span",xt,b(n.value)+" ("+b(n.percentage)+"%)",1)]))),128))])):P("",!0)])}const At=E(Pt,[["render",Tt],["__scopeId","data-v-99bf5a75"]]),Wt={name:"EventsBarChart",components:{Bar:R},props:{logs:{type:Array,required:!0,default:()=>[]}},setup(c){const t=v(()=>{const d={};return c.logs.forEach(u=>{u.event&&(d[u.event]=(d[u.event]||0)+1)}),Object.entries(d).sort((u,g)=>g[1]-u[1]).reduce((u,[g,n])=>(u[g]=n,u),{})}),y=v(()=>{if(Object.keys(t.value).length===0)return null;const d=Object.keys(t.value),u=Object.values(t.value),g=d.map((n,r)=>{const i=[_.primary,_.success,_.info,_.warning,_.danger];return i[r%i.length]});return{labels:d,datasets:[{label:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹",data:u,backgroundColor:g.map(n=>n+"80"),borderColor:g,borderWidth:2,borderRadius:4}]}}),e=v(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,callbacks:{label:function(d){return`${d.dataset.label}: ${d.parsed.y}`}}}},scales:{x:{display:!0,title:{display:!0,text:"Ð¢Ð¸Ð¿ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ"},grid:{display:!1},ticks:{maxRotation:45,minRotation:45}},y:{display:!0,title:{display:!0,text:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾"},beginAtZero:!0,ticks:{stepSize:1}}}}));return{chartData:y,chartOptions:e}}},It={class:"chart-container"},jt={class:"chart-wrapper"},Ft={key:1,class:"chart-empty"};function Mt(c,t,y,e,d,u){const g=k("Bar");return p(),f("div",It,[t[1]||(t[1]=s("div",{class:"chart-header"},[s("h4",null,"Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ð°Ð¼")],-1)),s("div",jt,[e.chartData?(p(),B(g,{key:0,data:e.chartData,options:e.chartOptions,height:300},null,8,["data","options"])):(p(),f("div",Ft,[...t[0]||(t[0]=[s("p",null,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ",-1)])]))])])}const Rt=E(Wt,[["render",Mt],["__scopeId","data-v-68f76fd3"]]),qt={name:"WebhookLogsDashboard",components:{WebhookLogsStats:mt,EventsTimelineChart:wt,CategoriesChart:At,EventsBarChart:Rt},props:{logs:{type:Array,required:!0,default:()=>[]},pagination:{type:Object,default:null},previousPeriodStats:{type:Object,default:null}},setup(c){const t=$(!0),y=$(!0),e=v(()=>!c.logs||!Array.isArray(c.logs)?[]:c.logs.map(l=>W(l)).filter(l=>I(l))),d=v(()=>!e.value||e.value.length===0?r():n(e.value)),u=v(()=>c.previousPeriodStats?c.previousPeriodStats:r()),g=v(()=>{const l=d.value,o=u.value;return{total:i(l.total,o.total),tasks:i(l.tasks,o.tasks),smartProcesses:i(l.smartProcesses,o.smartProcesses),errors:i(l.errors,o.errors)}}),n=l=>{const o={total:l.length,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}};return l.forEach(m=>{if(m.category==="tasks"?o.tasks++:m.category==="smart-processes"?o.smartProcesses++:m.category==="errors"&&o.errors++,m.event&&(o.byEvent[m.event]=(o.byEvent[m.event]||0)+1),m.timestamp)try{const S=new Date(m.timestamp).toISOString().split("T")[0];o.byDate[S]=(o.byDate[S]||0)+1}catch{}}),o},r=()=>({total:0,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}}),i=(l,o)=>o===0?l>0?100:0:Math.round((l-o)/o*100);return{showStats:t,showCharts:y,normalizedLogs:e,currentStats:d,previousStats:u,statsComparison:g}}},Nt={class:"webhook-dashboard"},Ut={class:"dashboard-header"},Yt={class:"dashboard-controls"},Vt={key:0,class:"dashboard-section"},Kt={key:0,class:"dashboard-section"},Ht={class:"charts-grid"},Zt={class:"chart-item"},Gt={class:"chart-item"},Jt={class:"chart-item chart-item-full"};function Qt(c,t,y,e,d,u){const g=k("WebhookLogsStats"),n=k("EventsTimelineChart"),r=k("CategoriesChart"),i=k("EventsBarChart");return p(),f("div",Nt,[s("div",Ut,[t[2]||(t[2]=s("h2",null,"Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ Ð»Ð¾Ð³Ð¾Ð² Ð²ÐµÐ±Ñ…ÑƒÐºÐ¾Ð²",-1)),s("div",Yt,[s("button",{onClick:t[0]||(t[0]=l=>e.showStats=!e.showStats),class:L(["toggle-btn",{active:e.showStats}])},b(e.showStats?"â–¼":"â–¶")+" Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° ",3),s("button",{onClick:t[1]||(t[1]=l=>e.showCharts=!e.showCharts),class:L(["toggle-btn",{active:e.showCharts}])},b(e.showCharts?"â–¼":"â–¶")+" Ð“Ñ€Ð°Ñ„Ð¸ÐºÐ¸ ",3)])]),D(x,{name:"slide-down"},{default:z(()=>[e.showStats?(p(),f("div",Vt,[D(g,{logs:e.normalizedLogs,"total-count":y.pagination?.total||null,"previous-period-stats":y.previousPeriodStats},null,8,["logs","total-count","previous-period-stats"])])):P("",!0)]),_:1}),D(x,{name:"slide-down"},{default:z(()=>[e.showCharts?(p(),f("div",Kt,[s("div",Ht,[s("div",Zt,[D(n,{logs:e.normalizedLogs},null,8,["logs"])]),s("div",Gt,[D(r,{logs:e.normalizedLogs},null,8,["logs"])]),s("div",Jt,[D(i,{logs:e.normalizedLogs},null,8,["logs"])])])])):P("",!0)]),_:1})])}const ie=E(qt,[["render",Qt],["__scopeId","data-v-b3b0d3ab"]]);export{ie as default};
