import{_ as I,g as S,c as x,I as Y,m as P,P as B,a as p,o as m,b as e,j as O,t as E,n as D,k as j,d as N,p as J,i as b,R as Q,l as V,F as q,e as H,B as K,U as G,y as M}from"./main-vjOnDlDe.js";import{S as U,B as X}from"./bitrix24-api-Irr5mCDD.js";const Z=20,ee=5*60*1e3;async function te({search:l="",limit:_=Z,sectorDepartmentId:a=U.SECTOR_1C}={}){const c=`sector1c_employees_${l}_${_}_${a||"all"}`,h=sessionStorage.getItem(c);if(h)try{const{data:s,timestamp:d}=JSON.parse(h);if(Date.now()-d<ee)return s}catch(s){console.warn("[sector1cEmployees] Cache parse error:",s)}try{const s={ACTIVE:"Y"};a?Array.isArray(a)?s.UF_DEPARTMENT=a:s.UF_DEPARTMENT=[a]:s.UF_DEPARTMENT=[U.SECTOR_1C],l&&l.length>=2&&(s["%NAME"]=l,s["%LAST_NAME"]=l,s["%WORK_POSITION"]=l);const y=((await X.call("user.get",{filter:s,select:["ID","NAME","LAST_NAME","SECOND_NAME","WORK_POSITION","UF_DEPARTMENT"],order:{LAST_NAME:"ASC",NAME:"ASC"},start:0})).result||[]).slice(0,_).map(f=>({id:parseInt(f.ID),name:se(f),position:f.WORK_POSITION||"",department:f.UF_DEPARTMENT||null}));try{sessionStorage.setItem(c,JSON.stringify({data:y,timestamp:Date.now()}))}catch(f){console.warn("[sector1cEmployees] Cache write error:",f)}return y}catch(s){throw console.error("[sector1cEmployees] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:",s),new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${s.message}`)}}function se(l){const _=[l.LAST_NAME,l.NAME,l.SECOND_NAME].filter(Boolean);return _.length>0?_.join(" "):l.NAME||"–ë–µ–∑ –∏–º–µ–Ω–∏"}const le={class:"employee-select-field-text"},ae={key:0,class:"employee-select-dropdown"},ne={class:"employee-select-dropdown-search"},oe={key:0,class:"employee-select-state"},ce={key:1,class:"employee-select-state employee-select-state--error"},ie={key:2,class:"employee-select-state"},de=["checked"],re=["checked","onChange"],ue={class:"employee-select-item-content"},pe={class:"employee-select-item-name"},me={key:0,class:"employee-select-item-position"},fe={__name:"EmployeeSelect",props:{selected:{type:Array,default:()=>["all"]},multiple:{type:Boolean,default:!0},placeholder:{type:String,default:"–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°"},maxHeight:{type:Number,default:300}},emits:["update:selected","search","error"],setup(l,{emit:_}){const a=l,c=_,h=S(null),s=S(null),d=S(""),k=S([]),y=S(!1),f=S(null),C=S(!1),T=x(()=>{if(!d.value)return k.value;const i=d.value.toLowerCase();return k.value.filter(t=>t.name.toLowerCase().includes(i)||t.position&&t.position.toLowerCase().includes(i))}),r=x(()=>{if(a.selected.includes("all")||a.selected.length===0)return a.placeholder;if(a.selected.length===1){const i=k.value.find(t=>t.id===a.selected[0]);return i?i.name:a.placeholder}return`–í—ã–±—Ä–∞–Ω–æ: ${a.selected.length} ${z(a.selected.length,"—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞","—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤","—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤")}`});async function u(i=""){y.value=!0,f.value=null;try{k.value=await te({search:i})}catch(t){f.value=t,c("error",t)}finally{y.value=!1}}function n(){c("search",d.value)}function o(){y.value||(C.value=!C.value,C.value?(k.value.length===0&&u(),G(()=>{s.value&&s.value.focus()})):d.value="")}function g(i){h.value&&!h.value.contains(i.target)&&(C.value=!1,d.value="")}function $(i){const t=[...a.selected],v=t.indexOf(i);if(i==="all")if(v>-1)t.splice(v,1);else return c("update:selected",["all"]);else if(v>-1)t.splice(v,1);else{const A=t.indexOf("all");A>-1&&t.splice(A,1),t.push(i)}c("update:selected",t)}function w(i){return i==="all"?a.selected.includes("all"):a.selected.includes(i)||a.selected.includes("all")}const F=x(()=>d.value?`–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É "${d.value}"`:"–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°");function z(i,t,v,A){const R=i%10,L=i%100;return L>=11&&L<=19?A:R===1?t:R>=2&&R<=4?v:A}function W(){u(d.value)}return Y(()=>a.selected,i=>{(!i||i.length===0)&&c("update:selected",["all"])},{immediate:!0}),P(()=>{document.addEventListener("click",g),(!a.selected||a.selected.length===0)&&c("update:selected",["all"])}),B(()=>{document.removeEventListener("click",g)}),(i,t)=>(m(),p("div",{class:"employee-select",ref_key:"selectContainer",ref:h},[e("div",{class:D(["employee-select-field",{"employee-select-field--open":C.value,"employee-select-field--disabled":y.value}]),onClick:o},[e("span",le,E(r.value),1),e("span",{class:D(["employee-select-field-icon",{open:C.value}])},"‚ñº",2)],2),O(K,{name:"dropdown-fade"},{default:j(()=>[C.value?(m(),p("div",ae,[e("div",ne,[J(e("input",{"onUpdate:modelValue":t[0]||(t[0]=v=>d.value=v),type:"text",placeholder:"üîç –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...",class:"employee-select-search-input",onInput:n,onClick:t[1]||(t[1]=b(()=>{},["stop"])),ref_key:"searchInput",ref:s},null,544),[[Q,d.value]])]),y.value?(m(),p("div",oe,[...t[6]||(t[6]=[e("span",{class:"spinner"},"‚è≥",-1),e("span",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°...",-1)])])):f.value?(m(),p("div",ce,[e("span",null,"‚ùå "+E(f.value.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤"),1),e("button",{onClick:[W,t[2]||(t[2]=b(()=>{},["stop"]))],class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):!y.value&&T.value.length===0&&!f.value?(m(),p("div",ie,[e("span",null,"üì≠ "+E(F.value),1)])):(m(),p("div",{key:3,class:"employee-select-list",style:V({maxHeight:`${l.maxHeight}px`})},[e("label",{class:D(["employee-select-item",{"employee-select-item--selected":w("all")}]),onClick:t[4]||(t[4]=b(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:w("all"),onChange:t[3]||(t[3]=v=>$("all"))},null,40,de),t[7]||(t[7]=e("div",{class:"employee-select-item-content"},[e("span",{class:"employee-select-item-name"},"–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏")],-1))],2),(m(!0),p(q,null,H(T.value,v=>(m(),p("label",{key:v.id,class:D(["employee-select-item",{"employee-select-item--selected":w(v.id)}]),onClick:t[5]||(t[5]=b(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:w(v.id),onChange:A=>$(v.id)},null,40,re),e("div",ue,[e("span",pe,E(v.name),1),v.position?(m(),p("span",me,E(v.position),1)):N("",!0)])],2))),128))],4))])):N("",!0)]),_:1})],512))}},ve=I(fe,[["__scopeId","data-v-6b8c949b"]]),ge={class:"stage-select-field-text"},ye={key:0,class:"stage-select-dropdown"},he={class:"stage-select-list"},_e=["checked"],ke=["checked","onChange"],Ce={class:"stage-select-item-content"},Se={class:"stage-select-item-name"},Ee={__name:"StageSelect",props:{selected:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},stages:{type:Array,required:!0,default:()=>[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"#007bff"},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"#ffc107"},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"#28a745"}]},placeholder:{type:String,default:"–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø—ã"}},emits:["update:selected","change"],setup(l,{emit:_}){const a=l,c=_,h=S(null),s=S(!1),d=x(()=>Object.values(a.selected).every(r=>r===!0)),k=x(()=>{if(d.value)return a.placeholder;const r=a.stages.filter(u=>a.selected[u.id]);return r.length===0?"–≠—Ç–∞–ø—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã":r.length===1?r[0].name:`–í—ã–±—Ä–∞–Ω–æ: ${r.length} —ç—Ç–∞–ø–∞(–æ–≤)`});function y(){s.value=!s.value,s.value}function f(r){h.value&&!h.value.contains(r.target)&&(s.value=!1)}function C(r,u){const n={...a.selected};n[r]=u,c("update:selected",n),c("change",r,u)}function T(){const r=d.value,u={};a.stages.forEach(n=>{u[n.id]=!r}),c("update:selected",u),c("change","all",!r)}return P(()=>{document.addEventListener("click",f)}),B(()=>{document.removeEventListener("click",f)}),(r,u)=>(m(),p("div",{class:"stage-select",ref_key:"selectContainer",ref:h},[e("div",{class:D(["stage-select-field",{"stage-select-field--open":s.value,"stage-select-field--disabled":!1}]),onClick:y},[e("span",ge,E(k.value),1),e("span",{class:D(["stage-select-field-icon",{open:s.value}])},"‚ñº",2)],2),O(K,{name:"dropdown-fade"},{default:j(()=>[s.value?(m(),p("div",ye,[e("div",he,[e("label",{class:D(["stage-select-item",{"stage-select-item--selected":d.value}]),onClick:u[0]||(u[0]=b(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:d.value,onChange:T},null,40,_e),u[2]||(u[2]=e("div",{class:"stage-select-item-content"},[e("span",{class:"stage-select-item-name"},"–í—Å–µ —ç—Ç–∞–ø—ã")],-1))],2),(m(!0),p(q,null,H(l.stages,n=>(m(),p("label",{key:n.id,class:D(["stage-select-item",{"stage-select-item--selected":l.selected[n.id]}]),onClick:u[1]||(u[1]=b(()=>{},["stop"]))},[e("input",{type:"checkbox",checked:l.selected[n.id],onChange:o=>C(n.id,o.target.checked)},null,40,ke),e("div",Ce,[e("span",{class:"stage-select-item-color",style:V({backgroundColor:n.color})},null,4),e("span",Se,E(n.name),1)])],2))),128))])])):N("",!0)]),_:1})],512))}},De=I(Ee,[["__scopeId","data-v-ce2229b2"]]),we={class:"filters-panel"},xe={class:"filters-header"},Te=["disabled"],Ae={class:"filters-content"},be={key:0,class:"filter-section"},$e={class:"section-content"},Ne={class:"filter-section"},Oe={class:"section-content"},Re={class:"filter-section"},Me={class:"section-content"},Ie=["value"],Fe={key:0,class:"custom-date-range"},Le={class:"date-range-inputs"},Ue={class:"date-input-group"},Pe=["value","max"],Be={class:"date-input-group"},je=["value","min","max"],Ve={key:0,class:"filter-error"},qe={key:1,class:"filter-hint"},He={__name:"FiltersPanel",props:{stages:{type:Object,required:!0,default:()=>({formed:!0,review:!0,execution:!0})},employees:{type:Array,default:()=>["all"]},dateRange:{type:String,default:"last-week"},customDateRange:{type:Object,default:()=>({startDate:null,endDate:null})},hasActiveFilters:{type:Boolean,default:!1},hideStages:{type:Boolean,default:!1}},emits:["update:stages","update:employees","update:dateRange","update:customDateRange","reset","apply"],setup(l,{emit:_}){const a=l,c=_,h=[{id:"formed",name:"–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ",color:"var(--b24-primary, #007bff)"},{id:"review",name:"–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¢–ó",color:"var(--b24-warning, #ffc107)"},{id:"execution",name:"–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ",color:"var(--b24-success, #28a745)"}],s=S(null),d=x(()=>{const n=new Date;return n.setFullYear(n.getFullYear()-1),n.toISOString().split("T")[0]}),k=x(()=>new Date().toISOString().split("T")[0]);function y(n){c("update:stages",n),c("apply")}function f(n,o){c("apply")}function C(n){c("update:employees",n),c("apply")}function T(n){c("update:dateRange",n),s.value=null,c("apply")}function r(n,o){const g={...a.customDateRange};if(g[n]=o,g.startDate&&g.endDate){const $=new Date(g.startDate),w=new Date(g.endDate);if($>w){s.value="–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω–µ—á–Ω–æ–π";return}if(Math.ceil((w-$)/(1e3*60*60*24))>365){s.value="–ü–µ—Ä–∏–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 365 –¥–Ω–µ–π";return}}s.value=null,c("update:customDateRange",g),c("apply")}function u(){s.value=null,c("reset")}return(n,o)=>(m(),p("div",we,[e("div",xe,[o[3]||(o[3]=e("h2",null,"–§–∏–ª—å—Ç—Ä—ã",-1)),e("button",{onClick:u,class:"btn-reset-filters",disabled:!l.hasActiveFilters}," –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã ",8,Te)]),e("div",Ae,[l.hideStages?N("",!0):(m(),p("div",be,[o[4]||(o[4]=e("h3",{class:"section-title"},[e("span",{class:"section-icon"},"üìä"),M(" –≠—Ç–∞–ø—ã ")],-1)),e("div",$e,[O(De,{selected:l.stages,stages:h,placeholder:"–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø—ã","onUpdate:selected":y,onChange:f},null,8,["selected"])])])),e("div",Ne,[o[5]||(o[5]=e("h3",{class:"section-title"},[e("span",{class:"section-icon"},"üë•"),M(" –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–° ")],-1)),e("div",Oe,[O(ve,{selected:l.employees,"onUpdate:selected":C},null,8,["selected"])])]),e("div",Re,[o[9]||(o[9]=e("h3",{class:"section-title"},[e("span",{class:"section-icon"},"üìÖ"),M(" –ü–µ—Ä–∏–æ–¥ ")],-1)),e("div",Me,[e("select",{value:l.dateRange,onChange:o[0]||(o[0]=g=>T(g.target.value)),class:"date-range-select"},[...o[6]||(o[6]=[e("option",{value:"last-week"},"–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–¥–µ–ª—è",-1),e("option",{value:"last-2-weeks"},"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏",-1),e("option",{value:"last-month"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü",-1),e("option",{value:"custom"},"–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥",-1)])],40,Ie),l.dateRange==="custom"?(m(),p("div",Fe,[e("div",Le,[e("div",Ue,[o[7]||(o[7]=e("label",null,"–°:",-1)),e("input",{type:"date",value:l.customDateRange.startDate,onChange:o[1]||(o[1]=g=>r("startDate",g.target.value)),max:l.customDateRange.endDate||k.value,class:"date-input"},null,40,Pe)]),e("div",Be,[o[8]||(o[8]=e("label",null,"–ü–æ:",-1)),e("input",{type:"date",value:l.customDateRange.endDate,onChange:o[2]||(o[2]=g=>r("endDate",g.target.value)),min:l.customDateRange.startDate||d.value,max:k.value,class:"date-input"},null,40,je)])]),s.value?(m(),p("small",Ve,E(s.value),1)):(m(),p("small",qe," –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –∏ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö "))])):N("",!0)])])])]))}},We=I(He,[["__scopeId","data-v-efa2d336"]]);export{We as F};
