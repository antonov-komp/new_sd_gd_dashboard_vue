const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./direct-access-config-Bipc-jg2.js","./chunk-BM_8TYaY.js","./chunk-DzhLK_gS.js","./access-config-async-C7fzWD0Z.js","./chunk-D4Gwf8nI.js","./chunk-B4wrfv0h.js","./WebhookLogsDashboard.vue-BMR5RJv3.js","./WebhookLogDetails.vue-CoeZXZLH.js","./DashboardSector1C.vue-D1wCkinn.js","./chunk-C3q6Wu7t.js","./chunk-DHGIvRuh.js","./chunk-CSvjH-bI.js","./chunk-DUBmBR48.js","./GraphAdmissionClosureDashboard.vue-BwVhDBl-.js","./chunk-DqItbh9y.js","./dashboard-sector-1c-service-BdJ0VI4i.js","./GraphStateDashboard.vue-B2xqtqiu.js","./TicketsTimeTrackingDashboard.vue-DUBrAqoH.js"])))=>i.map(i=>d[i]);
var Tt=Object.defineProperty;var Lt=(s,e,o)=>e in s?Tt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o;var ke=(s,e,o)=>Lt(s,typeof e!="symbol"?e+"":e,o);import{r as q,c as d,o as c,a as Q,b as h,d as wt,t as u,n as U,e as n,f as $,g as x,h as se,i as y,m as Dt,j as Ie,k as at,u as Ne,F as H,l as W,p as X,w as ue,q as ae,s as ge,v as It,T as Se,x as Z,y as Xe,z as it,A as ie,B as Re,C as ee,D as Ae,E as Qe,G as Pt,H as rt,I as We,J as Nt,K as Ut,L as Ft,M as qe,N as Bt,O as Rt,P as Ot,Q as Vt,R as zt,S as Ht,U as jt,V as Wt,W as qt,X as $t,Y as Xt}from"./chunk-D4Gwf8nI.js";import{a as Ct,_ as ce,g as be}from"./chunk-BM_8TYaY.js";import{C as vt}from"./chunk-B4wrfv0h.js";import"./chunk-DzhLK_gS.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function o(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function t(i){if(i.ep)return;i.ep=!0;const l=o(i);fetch(i.href,l)}})();const j=(s,e)=>{const o=s.__vccOpts||s;for(const[t,i]of e)o[t]=i;return o},Kt={name:"App"},Jt={id:"app"};function Gt(s,e,o,t,i,l){const a=q("router-view");return c(),d("div",Jt,[Q(a)])}const Yt=j(Kt,[["render",Gt]]),Qt={name:"StatusMessage",props:{type:{type:String,required:!0,validator:s=>["success","error","info","warning"].includes(s)},title:{type:String,default:null},message:{type:String,default:null}}},Zt={key:0},eo={key:1};function to(s,e,o,t,i,l){return c(),d("div",{class:U(["status-message",`status-message--${o.type}`])},[o.title?(c(),d("strong",Zt,u(o.title),1)):h("",!0),o.message?(c(),d("p",eo,u(o.message),1)):h("",!0),wt(s.$slots,"default",{},void 0)],2)}const kt=j(Qt,[["render",to],["__scopeId","data-v-7f15d2d7"]]),oo={name:"LoadingSpinner",props:{message:{type:String,default:"–ó–∞–≥—Ä—É–∑–∫–∞..."}}},no={class:"loading-spinner"},so={key:0,class:"message"};function ao(s,e,o,t,i,l){return c(),d("div",no,[e[0]||(e[0]=n("div",{class:"spinner"},null,-1)),o.message?(c(),d("p",so,u(o.message),1)):h("",!0)])}const St=j(oo,[["render",ao],["__scopeId","data-v-375eac16"]]);function Oe(){try{if(window.self===window.top)return!1;if(typeof BX24<"u")return!0;try{const s=window.parent.location.origin;return s.includes("bitrix24")||s.includes("kompo.by")}catch{return!1}}catch(s){return console.warn("Error checking Bitrix24 context:",s),!1}}function io(){return typeof BX24<"u"}class xe{static init(e){return new Promise((o,t)=>{if(!Oe()){console.log("Not inside Bitrix24, skipping BX24.init()"),e&&e(),o();return}if(typeof BX24>"u"){t(new Error("Bitrix24 API not loaded. Make sure script is included: //api.bitrix24.com/api/v1/"));return}const i=setTimeout(()=>{t(new Error("BX24.init() timeout: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥"))},5e3);try{BX24.init(()=>{clearTimeout(i),e&&e(),o()})}catch(l){clearTimeout(i),t(l)}})}static installFinish(){return new Promise((e,o)=>{if(typeof BX24>"u"){o(new Error("Bitrix24 API not loaded"));return}try{BX24.installFinish(),e()}catch(t){o(t)}})}static callMethod(e,o={}){return new Promise((t,i)=>{if(typeof BX24>"u"){i(new Error("Bitrix24 API not loaded"));return}const l=setTimeout(()=>{i(new Error(`BX24.callMethod(${e}) timeout: –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—ã—Å–∏–ª 10 —Å–µ–∫—É–Ω–¥`))},1e4);try{BX24.callMethod(e,o,a=>{if(clearTimeout(l),a.error()){const r=a.error();i(new Error(r.error_description||r.error||"Unknown error"))}else t(a.data())})}catch(a){clearTimeout(l),i(a)}})}static async getCurrentUser(){if(Oe()&&io())try{const e=await Promise.race([this.callMethod("user.current",{}),new Promise((o,t)=>setTimeout(()=>t(new Error("Timeout")),5e3))]);return console.log("Got user from BX24.callMethod() (interface user):",e?.ID||"unknown"),e}catch(e){console.warn("BX24.callMethod() failed, using proxy API as fallback:",e);try{const t=await new vt().getCurrentUser();return console.log("Got user from proxy API (token owner, fallback):",t),t}catch(o){throw console.error("Both BX24 API and proxy API failed:",o),e.message&&e.message.includes("timeout")?new Error("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Bitrix24 API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç."):new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}else return console.warn("Not inside Bitrix24, using proxy API (will return token owner, not interface user)"),await new vt().getCurrentUser()}static getUser(){return new Promise((e,o)=>{if(typeof BX24>"u"){o(new Error("Bitrix24 API not loaded"));return}if(typeof BX24.getUser!="function"){o(new Error("BX24.getUser is not available"));return}BX24.getUser(t=>{e(t)})})}static getAuth(){return new Promise((e,o)=>{if(typeof BX24>"u"){o(new Error("Bitrix24 API not loaded"));return}BX24.getAuth(t=>{e(t)})})}}const ro={name:"InstallPage",components:{StatusMessage:kt,LoadingSpinner:St},setup(){const s=x(!0),e=x(null),o=x(null);return se(async()=>{try{let t=null;if(window.INSTALL_RESULT)t=window.INSTALL_RESULT;else{const i=Ct("/install.php"),l=await fetch(`${i}?get_result=1`);l.ok&&(t=await l.json())}if(!t)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏");if(o.value=t,t.rest_only===!1)if(t.install===!0){e.value={type:"success",title:"‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!",message:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24."};try{await xe.init(()=>{xe.installFinish()})}catch(i){console.error("Error finishing installation:",i)}}else e.value={type:"error",title:"‚úó –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."};else e.value={type:"info",title:"REST-only —Ä–µ–∂–∏–º",message:"–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ REST API, –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."}}catch(t){console.error("Error loading install result:",t),e.value={type:"error",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",message:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ."}}finally{s.value=!1}}),{loading:s,installStatus:e,installInfo:o}}},lo={class:"install-page"},co={class:"container"},uo={key:1,class:"info"};function mo(s,e,o,t,i,l){const a=q("StatusMessage"),r=q("LoadingSpinner");return c(),d("div",lo,[n("div",co,[e[1]||(e[1]=n("h1",null,"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",-1)),t.installStatus?(c(),$(a,{key:0,type:t.installStatus.type,title:t.installStatus.title,message:t.installStatus.message},null,8,["type","title","message"])):h("",!0),t.installInfo?(c(),d("div",uo,[e[0]||(e[0]=n("h3",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:",-1)),n("pre",null,u(JSON.stringify(t.installInfo,null,2)),1)])):h("",!0),t.loading?(c(),$(r,{key:2,message:"–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."})):h("",!0)])])}const go=j(ro,[["render",mo],["__scopeId","data-v-d082ec9e"]]),fo={name:"ModuleAdapter",props:{moduleConfig:{type:Object,required:!0,validator:s=>s.id&&s.title&&s.component&&s.componentPath},sectorId:{type:String,required:!0},isCompact:{type:Boolean,default:!0}},emits:["module-ready","module-error","module-navigate"],setup(s,{emit:e}){const o=Ne(),t=x(!0),i=x(null),l=x(null),a=x(null),r=y(()=>!0),m=y(()=>{const A={isCompact:s.isCompact,sectorId:s.sectorId,moduleId:s.moduleConfig.id};switch(s.moduleConfig.component){case"DashboardSector1C":return{...A,showBreadcrumbs:!1,compactMode:!0};case"GraphStateDashboard":return{...A,showBreadcrumbs:!1,compactMode:!0,autoLoad:!1};case"TicketsTimeTrackingDashboard":return{...A,showBreadcrumbs:!1,compactMode:!0};case"GraphAdmissionClosureDashboard":return{...A,showBreadcrumbs:!1,compactMode:!0};default:return A}}),f=async()=>{try{if(t.value=!0,i.value=null,r.value)l.value=at(()=>import(s.moduleConfig.componentPath));else{const A=await import(s.moduleConfig.componentPath);l.value=A.default}e("module-ready",{moduleId:s.moduleConfig.id,sectorId:s.sectorId})}catch(A){console.error(`Failed to load module ${s.moduleConfig.id}:`,A),i.value=A.message,e("module-error",{moduleId:s.moduleConfig.id,sectorId:s.sectorId,error:A})}finally{t.value=!1}},g=()=>{s.moduleConfig.route?o.push(s.moduleConfig.route):console.warn(`No route defined for module ${s.moduleConfig.id}`)},b=()=>{f()},L=A=>{e("module-navigate",{type:"ready",moduleId:s.moduleConfig.id,sectorId:s.sectorId,data:A})},M=A=>{e("module-navigate",{type:"error",moduleId:s.moduleConfig.id,sectorId:s.sectorId,error:A})},C=A=>{e("module-navigate",{type:"navigate",moduleId:s.moduleConfig.id,sectorId:s.sectorId,navigation:A})};return se(()=>{f()}),{isLoading:t,error:i,moduleComponent:l,moduleInstance:a,moduleProps:m,openFullView:g,retryLoad:b,onModuleReady:L,onModuleError:M,onModuleNavigate:C}}},ho={class:"module-header"},vo={class:"module-icon"},yo={class:"module-info"},po={class:"module-actions"},bo=["aria-label"],_o={class:"module-content"},wo={key:0,class:"module-loading"},Co={key:1,class:"module-error"},ko={key:2,class:"module-body"};function So(s,e,o,t,i,l){return c(),d("div",{class:U(["sector-module-adapter",`module-${o.moduleConfig.id}`])},[n("div",ho,[n("div",vo,u(o.moduleConfig.icon),1),n("div",yo,[n("h3",null,u(o.moduleConfig.title),1),n("p",null,u(o.moduleConfig.description),1)]),n("div",po,[n("button",{onClick:e[0]||(e[0]=(...a)=>t.openFullView&&t.openFullView(...a)),class:"btn-module-fullscreen",title:"–û—Ç–∫—Ä—ã—Ç—å –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ","aria-label":`–û—Ç–∫—Ä—ã—Ç—å ${o.moduleConfig.title} –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ`}," ‚õ∂ ",8,bo)])]),n("div",_o,[t.isLoading?(c(),d("div",wo,[e[2]||(e[2]=n("div",{class:"loading-spinner"},null,-1)),n("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ "+u(o.moduleConfig.title)+"...",1)])):t.error?(c(),d("div",Co,[e[3]||(e[3]=n("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),e[4]||(e[4]=n("p",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è",-1)),n("button",{onClick:e[1]||(e[1]=(...a)=>t.retryLoad&&t.retryLoad(...a)),class:"btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):(c(),d("div",ko,[(c(),$(Ie(t.moduleComponent),Dt(t.moduleProps,{ref:"moduleInstance",onReady:t.onModuleReady,onError:t.onModuleError,onNavigate:t.onModuleNavigate}),null,16,["onReady","onError","onNavigate"]))]))])],2)}const xo=j(fo,[["render",So],["__scopeId","data-v-ced12dd3"]]),Mo={name:"SectorContainer",components:{ModuleAdapter:xo},props:{sectorConfig:{type:Object,required:!0,validator:s=>s.id&&s.name&&s.icon}},emits:["module-ready","module-error","module-event","sector-expanded","sector-collapsed"],setup(s,{emit:e}){Ne();const o=x(!1),t=x(!1),i=x([]),l=y(()=>s.sectorConfig.modules&&s.sectorConfig.modules.length>0),a=y(()=>!1);se(async()=>{l.value&&await r()});const r=async()=>{t.value=!0;try{i.value=s.sectorConfig.modules||[],e("module-ready",{sectorId:s.sectorConfig.id,modulesCount:i.value.length})}catch(M){console.error(`Failed to load modules for sector ${s.sectorConfig.id}:`,M),e("module-error",{sectorId:s.sectorConfig.id,error:M.message})}finally{t.value=!1}};return{expanded:o,loading:t,sectorModules:i,hasModules:l,canNavigateToDashboard:a,toggleExpanded:()=>{o.value=!o.value,o.value?e("sector-expanded",{sectorId:s.sectorConfig.id}):e("sector-collapsed",{sectorId:s.sectorConfig.id})},onModuleReady:M=>{e("module-ready",{sectorId:s.sectorConfig.id,moduleId:M.moduleId,data:M})},onModuleError:M=>{e("module-error",{sectorId:s.sectorConfig.id,moduleId:M.moduleId,error:M.error})},onModuleNavigate:M=>{e("module-event",{sectorId:s.sectorConfig.id,moduleId:M.moduleId,event:M})},navigateToSectorDashboard:()=>{console.log(`Navigate to dashboard for sector: ${s.sectorConfig.id}`)}}}},Ao={class:"sector-header"},Eo={class:"sector-header-left"},To={class:"sector-icon"},Lo={class:"sector-title"},Do={class:"sector-actions"},Io={key:0,class:"sector-content"},Po={key:0,class:"sector-loading"},No={key:1,class:"sector-modules-grid"},Uo={key:2,class:"no-modules"},Fo={key:3,class:"sector-dashboard-link"};function Bo(s,e,o,t,i,l){const a=q("ModuleAdapter");return c(),d("div",{class:U(["sector-container",`sector-${o.sectorConfig.id}`])},[n("div",Ao,[n("div",Eo,[n("div",To,u(o.sectorConfig.icon),1),n("div",Lo,[n("h2",null,u(o.sectorConfig.name),1),n("p",null,u(o.sectorConfig.description),1)])]),n("div",Do,[n("button",{onClick:e[0]||(e[0]=(...r)=>t.toggleExpanded&&t.toggleExpanded(...r)),class:"btn-toggle-sector"},u(t.expanded?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"),1)])]),t.expanded?(c(),d("div",Io,[t.loading?(c(),d("div",Po,[e[3]||(e[3]=n("div",{class:"loading-spinner"},null,-1)),n("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∫—Ç–æ—Ä–∞ "+u(o.sectorConfig.name)+"...",1)])):t.sectorModules.length>0?(c(),d("div",No,[(c(!0),d(H,null,W(t.sectorModules,r=>(c(),$(a,{key:r.id,"module-config":r,"sector-id":o.sectorConfig.id,"is-compact":!0,onModuleReady:t.onModuleReady,onModuleError:t.onModuleError,onModuleNavigate:t.onModuleNavigate},null,8,["module-config","sector-id","onModuleReady","onModuleError","onModuleNavigate"]))),128))])):(c(),d("div",Uo,[n("p",null,'–ú–æ–¥—É–ª–∏ –¥–ª—è —Å–µ–∫—Ç–æ—Ä–∞ "'+u(o.sectorConfig.name)+'" –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ',1),t.canNavigateToDashboard?(c(),d("button",{key:0,onClick:e[1]||(e[1]=(...r)=>t.navigateToSectorDashboard&&t.navigateToSectorDashboard(...r)),class:"btn-sector-dashboard"},[...e[4]||(e[4]=[n("span",{class:"icon"},"üìä",-1),X(" –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ ",-1)])])):h("",!0)])),t.sectorModules.length>0&&t.canNavigateToDashboard?(c(),d("div",Fo,[n("button",{onClick:e[2]||(e[2]=(...r)=>t.navigateToSectorDashboard&&t.navigateToSectorDashboard(...r)),class:"btn-sector-dashboard"},[...e[5]||(e[5]=[n("span",{class:"icon"},"üìä",-1),X(" –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ ",-1)])])])):h("",!0)])):h("",!0)],2)}const Ro=j(Mo,[["render",Bo],["__scopeId","data-v-0fa90bab"]]),Fe={allowedDepartmentIds:[369,366,7],adminDepartmentIds:[369]};function xt(s){return!s||typeof s!="number"?!1:Fe.allowedDepartmentIds.includes(s)}function Mt(s){if(!s||!s.UF_DEPARTMENT)return!1;const e=Array.isArray(s.UF_DEPARTMENT)?s.UF_DEPARTMENT:[];return e.length===0?!1:e.some(o=>Fe.adminDepartmentIds.includes(o))}const ve={USER_NOT_DETERMINED:"USER_NOT_DETERMINED",ACCESS_DENIED:"ACCESS_DENIED",API_ERROR:"API_ERROR"};class pe{constructor(e,o=null,t=null,i=null){this.allowed=e,this.errorCode=o,this.errorMessage=t,this.user=i}}class De{static async checkAccess(){try{const e=Oe();if(console.log("AccessControlService.checkAccess - isInsideBitrix24:",e),console.log("AccessControlService.checkAccess - window.self === window.top:",window.self===window.top),console.log("AccessControlService.checkAccess - typeof BX24:",typeof BX24),e)console.log("AccessControlService.checkAccess - Inside Bitrix24, skipping direct access check");else{console.log("AccessControlService.checkAccess - Not inside Bitrix24, checking direct access config...");const{isDirectAccessAllowed:l,getDenyMessage:a}=await ce(async()=>{const{isDirectAccessAllowed:m,getDenyMessage:f}=await import("./direct-access-config-Bipc-jg2.js");return{isDirectAccessAllowed:m,getDenyMessage:f}},__vite__mapDeps([0,1]),import.meta.url),r=await l();if(console.log("AccessControlService.checkAccess - allowDirectAccess:",r),!r){const m=await a();return console.warn("Direct access denied: Application opened directly in browser, but direct access is disabled in config"),console.warn("Deny message:",m),new pe(!1,ve.ACCESS_DENIED,m,null)}console.log("Direct access allowed: Using primary administrator token from settings.php")}if(e)try{await Promise.race([xe.init(),new Promise((l,a)=>setTimeout(()=>a(new Error("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bitrix24 API –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 5 —Å–µ–∫—É–Ω–¥")),5e3))])}catch(l){console.warn("BX24.init() failed, will try proxy API:",l)}let o;try{o=await Promise.race([xe.getCurrentUser(),new Promise((l,a)=>setTimeout(()=>a(new Error("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø—Ä–µ–≤—ã—Å–∏–ª–æ 10 —Å–µ–∫—É–Ω–¥")),1e4))])}catch(l){console.warn("Bitrix24BxApi.getCurrentUser() failed, trying proxy API:",l);const{Bitrix24ApiProvider:a}=await ce(async()=>{const{Bitrix24ApiProvider:r}=await import("./chunk-DzhLK_gS.js").then(m=>m.b);return{Bitrix24ApiProvider:r}},__vite__mapDeps([2,1]),import.meta.url);try{const r=await a.getInstance();o=await Promise.race([r.getCurrentUser(),new Promise((m,f)=>setTimeout(()=>f(new Error("–ü—Ä–æ–∫—Å–∏ API –ø—Ä–µ–≤—ã—Å–∏–ª–æ 5 —Å–µ–∫—É–Ω–¥")),5e3))]),console.log("Got user from proxy API:",o?.ID||"unknown")}catch(r){throw console.error("Both BX24 API and proxy API failed:",r),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}if(!o||!o.ID)return console.warn("AccessControlService.checkAccess - user not determined:",o),new pe(!1,ve.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.");console.log("AccessControlService.checkAccess - user determined:",{id:o.ID,name:o.NAME,departments:o.UF_DEPARTMENT});const t=o.UF_DEPARTMENT||[];if(console.log("AccessControlService.checkAccess - departmentIds:",t),!Array.isArray(t)||t.length===0){if(console.log("AccessControlService.checkAccess - user has no departments"),!e){const{isDirectAccessAllowed:l}=await ce(async()=>{const{isDirectAccessAllowed:r}=await import("./direct-access-config-Bipc-jg2.js");return{isDirectAccessAllowed:r}},__vite__mapDeps([0,1]),import.meta.url);if(await l())return console.log("AccessControlService.checkAccess - Direct access allowed, granting access despite no departments"),new pe(!0,null,null,o)}return console.warn("AccessControlService.checkAccess - Access denied: user has no departments"),new pe(!1,ve.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ—Ç–¥–µ–ª—É.")}const i=t.some(l=>xt(l));return console.log("AccessControlService.checkAccess - hasAccess:",i),i?(console.log("AccessControlService.checkAccess - Access granted"),new pe(!0,null,null,o)):(console.warn("AccessControlService.checkAccess - Access denied: no allowed departments"),new pe(!1,ve.ACCESS_DENIED,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"))}catch(e){return console.error("AccessControlService.checkAccess error:",e),e.message&&(e.message.includes("CORS")||e.message.includes("blocked")||e.message.includes("ERR_FAILED")||e.message.includes("unknown address space"))&&Oe()?(console.error("CORS error inside Bitrix24: Cannot determine interface user."),new pe(!1,ve.API_ERROR,"–û—à–∏–±–∫–∞ CORS: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")):e.message&&e.message.includes("not loaded")?new pe(!1,ve.USER_NOT_DETERMINED,"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."):new pe(!1,ve.API_ERROR,"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.")}}static async getCurrentUser(){try{return Oe()&&await xe.init(),await xe.getCurrentUser()}catch(e){return console.error("AccessControlService.getCurrentUser error:",e),null}}}class Ke{static async logAppEntry(e,o=null){if(!e||!e.ID)return console.warn("[ActivityLoggingService] Invalid user object for app entry logging"),!1;const t={timestamp:new Date().toISOString(),type:"app_entry",user_id:e.ID,user_name:this.getUserName(e),user_email:e.EMAIL||null,ip:o||this.getClientIp(),user_agent:navigator.userAgent,session_id:this.getSessionId()};return await this.saveLog(t)}static async logPageVisit(e,o,t=null){if(!o||!o.ID)return console.warn("[ActivityLoggingService] Invalid user object for page visit logging"),!1;if(!e||!e.path)return console.warn("[ActivityLoggingService] Invalid route object for page visit logging"),!1;const i={timestamp:new Date().toISOString(),type:"page_visit",user_id:o.ID,user_name:this.getUserName(o),route_path:e.path,route_name:e.name||null,route_title:e.meta?.title||null,from_path:t?.path||null,from_name:t?.name||null,session_id:this.getSessionId()};return await this.saveLog(i)}static async saveLog(e){try{const o=be("/api/user-activity-log.php"),t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)});if(!t.ok){const l=await t.text();return console.error("[ActivityLoggingService] Failed to save log:",{status:t.status,statusText:t.statusText,error:l}),!1}const i=await t.json();return i.success?!0:(console.error("[ActivityLoggingService] API returned error:",i.error),!1)}catch(o){return o.name==="AbortError"?console.warn("[ActivityLoggingService] Request timeout (activity logging skipped)"):console.error("[ActivityLoggingService] Error saving log:",o),!1}}static getSessionId(){const e="activity_session_id";if(sessionStorage.getItem(e))return sessionStorage.getItem(e);const o=this.generateSessionId();return sessionStorage.setItem(e,o),o}static generateSessionId(){const e=Date.now(),o=Math.random().toString(36).substring(2,11);return`${e}-${o}`}static getUserName(e){const o=e.NAME||"",t=e.LAST_NAME||"";return`${o} ${t}`.trim()||e.EMAIL||`User #${e.ID}`}static getClientIp(){return null}static isAppEntryLogged(){return sessionStorage.getItem("app_entry_logged")==="true"}static markAppEntryLogged(){sessionStorage.setItem("app_entry_logged","true")}}const Oo={reports:[{id:1,title:"–û—Ç—á—ë—Ç –ø–æ —Ç–∏–∫–µ—Ç–∞–º",icon:"üìä",route:"/reports/tickets",description:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º –∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º",active:!1},{id:2,title:"–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",icon:"üìà",route:"/reports/performance",description:"–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–∞",active:!1},{id:3,title:"–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º",icon:"üìâ",route:"/reports/deadlines",description:"–ê–Ω–∞–ª–∏–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á",active:!1},{id:4,title:"–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç",icon:"üìã",route:"/reports/summary",description:"–û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",active:!1},{id:5,title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",route:"/dashboard/sector-1c",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0},{id:6,title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",icon:"üìä",route:"/dashboard/graph-state",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–° –≤–æ –≤—Ä–µ–º–µ–Ω–∏",active:!0,category:"analytics",order:6},{id:7,title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–°",icon:"üìà",route:"/dashboard/graph-admission-closure",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",active:!0,category:"analytics",order:7},{id:8,title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"‚è±",route:"/dashboard/tickets-time-tracking",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",active:!0,category:"analytics",order:8}]};function Vo(){return Oo.reports.filter(s=>s.active===!0)}const zo={adminInterfaces:[{id:1,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"üë•",route:"/admin/users",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"},{id:2,title:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã",icon:"‚öôÔ∏è",route:"/admin/settings",description:"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:3,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",icon:"üìã",route:"/admin/webhook-logs",description:"–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤"},{id:4,title:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",icon:"üìä",route:"/admin/usage-stats",description:"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"},{id:5,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",icon:"üóëÔ∏è",route:"/admin/cache",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –º–æ–¥—É–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"}]};function Ho(){return[...zo.adminInterfaces]}const He={sector1c:{id:"1c",name:"–°–µ–∫—Ç–æ—Ä 1–°",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ",icon:"‚öôÔ∏è",color:"#007bff",borderColor:"#0056b3",backgroundColor:"#f8f9fa",filterValue:"1C",modules:[{id:"dashboard-sector-1c",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–æ–º 1–° —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏",icon:"‚öôÔ∏è",component:"SectorDashboard",componentPath:"@/components/SectorDashboard.vue",route:"/dashboard/sector-1c",category:"management",props:{sectorId:"1c"}},{id:"tickets-management-sector-1c",title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏ –∏ –∑–∞–¥–∞—á–∞–º–∏ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìã",component:"TicketsTimeTrackingDashboard",componentPath:"@/components/tickets-time-tracking/TicketsTimeTrackingDashboard.vue",route:"/tickets/time-tracking",category:"tickets"},{id:"state-chart",title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º —Å–µ–∫—Ç–æ—Ä–∞ 1–°",icon:"üìä",component:"GraphStateDashboard",componentPath:"@/components/graph-state/GraphStateDashboard.vue",route:"/graph/state",category:"analytics"},{id:"changes-visualization",title:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç",description:"–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Å–µ–∫—Ç–æ—Ä–µ 1–°",icon:"üìà",component:"GraphAdmissionClosureDashboard",componentPath:"@/components/graph-admission-closure/GraphAdmissionClosureDashboard.vue",route:"/graph/admission-closure",category:"analytics"}],features:["smart-process-140","1c-integration"],order:1},sectorPdm:{id:"pdm",name:"–°–µ–∫—Ç–æ—Ä PDM",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–∞–º–∏ PDM (Product Data Management)",icon:"üîß",color:"#28a745",borderColor:"#1e7e34",backgroundColor:"#f8fff8",filterValue:"PDM",modules:[{id:"dashboard-sector-pdm",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ PDM",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–æ–º PDM —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏",icon:"üîß",component:"SectorDashboard",componentPath:"@/components/SectorDashboard.vue",route:"/dashboard/sector-pdm",category:"management",props:{sectorId:"pdm"}}],features:["pdm-integration"],order:2},sectorBitrix24:{id:"bitrix24",name:"–°–µ–∫—Ç–æ—Ä –ë–∏—Ç—Ä–∏–∫—Å24",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ë–∏—Ç—Ä–∏–∫—Å24",icon:"üåê",color:"#ffc107",borderColor:"#d39e00",backgroundColor:"#fffef8",filterValue:"Bitrix24",modules:[{id:"dashboard-sector-bitrix24",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ –ë–∏—Ç—Ä–∏–∫—Å24",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–æ–º –ë–∏—Ç—Ä–∏–∫—Å24 —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏",icon:"üåê",component:"SectorDashboard",componentPath:"@/components/SectorDashboard.vue",route:"/dashboard/sector-bitrix24",category:"management",props:{sectorId:"bitrix24"}}],features:["bitrix24-integration"],order:3},sectorInfrastructure:{id:"infrastructure",name:"–°–µ–∫—Ç–æ—Ä –ñ–µ–ª–µ–∑–æ/–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞",description:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –∏ –ø—Ä–æ—á–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏",icon:"üñ•Ô∏è",color:"#dc3545",borderColor:"#bd2130",backgroundColor:"#fff8f8",filterValues:["–ñ–µ–ª–µ–∑–æ","–ü—Ä–æ—á–µ–µ"],modules:[{id:"dashboard-sector-infrastructure",title:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞",description:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–æ–º –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏",icon:"üñ•Ô∏è",component:"SectorDashboard",componentPath:"@/components/SectorDashboard.vue",route:"/dashboard/sector-infrastructure",category:"management",props:{sectorId:"infrastructure"}}],features:["infrastructure-management"],order:4}};class jo{static getAllSectors(){return Object.values(He).sort((e,o)=>(e.order||0)-(o.order||0))}static getSectorById(e){return He[e]||null}static getSectorsWithModules(){return this.getAllSectors().filter(e=>e.modules&&e.modules.length>0)}static getSectorColors(){const e={};return Object.values(He).forEach(o=>{e[o.id]=o.color}),e}static sectorExists(e){return!!He[e]}static getNextOrder(){return Math.max(...Object.values(He).map(o=>o.order||0))+1}}const Wo={name:"IndexPage",components:{StatusMessage:kt,LoadingSpinner:St,SectorContainer:Ro},beforeCreate(){console.log("[IndexPage] beforeCreate() called")},created(){console.log("[IndexPage] created() called")},beforeMount(){console.log("[IndexPage] beforeMount() called")},setup(){console.log("[IndexPage] setup() called");const s=Ne(),e=x(!0),o=x(null),t=x(!1),i=x(!1),l=x(""),a=x(null),r=x(null),m=x(!1);console.log("[IndexPage] Initial state:",{loading:e.value,accessAllowed:t.value,accessDenied:i.value});const f=x(Vo()),g=x(jo.getAllSectors()),b=x(!1),L=x(Ho()),M=y(()=>a.value?Mt(a.value):!1),C=y(()=>{if(!a.value)return"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";const I=a.value.FIRST_NAME?a.value.FIRST_NAME.trim():"",F=a.value.LAST_NAME?a.value.LAST_NAME.trim():"",R=a.value.NAME?a.value.NAME.trim():"";return I&&F?`${I} ${F}`:R&&F&&R!==F?`${R} ${F}`:I&&R&&I!==R?`${I} ${R}`:R&&R.includes(" ")?R:I||F||R||`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${a.value.ID}`}),A=y(()=>o.value?o.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ":"–û—à–∏–±–∫–∞ API":null),P=y(()=>o.value?o.value.includes("no_install_app")?"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Bitrix24. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É.":o.value:null),v=y(()=>o.value&&o.value.includes("no_install_app")),T=y(()=>Ct("/install.php"));se(async()=>{console.log("[IndexPage] onMounted() called");try{console.log("[IndexPage] Calling AccessControlService.checkAccess()...");const I=await De.checkAccess();if(console.log("[IndexPage] Access result:",{allowed:I.allowed,hasUser:!!I.user,user:I.user,errorCode:I.errorCode,errorMessage:I.errorMessage}),I.allowed){if(console.log("[IndexPage] Setting accessAllowed to true"),t.value=!0,a.value=I.user,console.log("[IndexPage] Access allowed, setting state:",{accessAllowed:t.value,hasUser:!!a.value,loading:e.value,accessDenied:i.value}),!Ke.isAppEntryLogged())try{I.user&&await Ke.logAppEntry(I.user)&&Ke.markAppEntryLogged()}catch(F){console.error("[IndexPage] Error logging app entry:",F)}}else{i.value=!0;const F=Oe(),R=!F&&I.errorCode===ve.ACCESS_DENIED&&I.errorMessage&&I.errorMessage.includes("–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø");if(console.log("IndexPage - accessResult:",{errorCode:I.errorCode,errorMessage:I.errorMessage,isInsideB24:F,isDirectAccessDeniedCheck:R}),m.value=R,R&&(l.value=I.errorMessage,console.log("IndexPage - Set direct access denied message:",I.errorMessage)),console.log("IndexPage - State after check:",{accessDenied:i.value,isDirectAccessDenied:m.value,accessErrorMessage:l.value}),!R){if(I.user){const{getAllowedDepartmentIds:K}=await ce(async()=>{const{getAllowedDepartmentIds:me}=await import("./access-config-async-C7fzWD0Z.js");return{getAllowedDepartmentIds:me}},__vite__mapDeps([3,4,1,5,2]),import.meta.url);r.value={userId:I.user.ID,departmentIds:I.user.UF_DEPARTMENT||[],allowedIds:K()}}I.errorCode===ve.USER_NOT_DETERMINED?l.value="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª.":I.errorCode===ve.ACCESS_DENIED?l.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω":l.value=I.errorMessage||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ò–¢ –æ—Ç–¥–µ–ª."}}}catch(I){o.value=I.message,console.error("Error checking access:",I)}finally{e.value=!1,console.log("[IndexPage] Final state:",{loading:e.value,accessAllowed:t.value,accessDenied:i.value,hasUser:!!a.value,error:o.value})}});const E=I=>{if(!I){console.error("Route is not defined for report");return}s.push(I)},V=()=>{b.value=!0},B=()=>{b.value=!1};return{loading:e,error:o,accessAllowed:t,accessDenied:i,accessErrorMessage:l,currentUser:a,userName:C,debugInfo:r,isDirectAccessDenied:m,errorTitle:A,errorMessage:P,showInstallLink:v,installPageUrl:T,reportsButtons:f,navigateToReport:E,sectors:g,handleModuleEvent:I=>{console.log("Module event:",I)},handleSectorExpanded:I=>{console.log("Sector expanded:",I.sectorId)},handleSectorCollapsed:I=>{console.log("Sector collapsed:",I.sectorId)},isAdmin:M,showAdminPopup:b,adminButtons:L,openAdminPopup:V,closeAdminPopup:B,navigateToAdmin:I=>{if(!I){console.error("Route is not defined for admin interface");return}s.push(I),B()}}}},qo={class:"index-page"},$o={class:"container"},Xo={key:0,class:"install-link"},Ko=["href"],Jo={key:0,class:"direct-access-denied-info",style:{"margin-top":"15px",padding:"15px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px"}},Go={key:1,class:"debug-info",style:{"margin-top":"15px",padding:"10px",background:"#fff3cd",border:"1px solid #ffc107","border-radius":"4px","font-size":"12px"}},Yo={key:3,class:"main-content"},Qo={class:"greeting-section"},Zo={class:"greeting-header"},en={class:"greeting-header-content"},tn={class:"greeting-text"},on={class:"sectors-section"},nn={class:"admin-popup-header"},sn={class:"admin-popup-content"},an={class:"admin-buttons-grid"},rn=["onClick"],ln={class:"admin-icon"},cn={class:"admin-title"},dn={key:0,class:"admin-description"};function un(s,e,o,t,i,l){const a=q("StatusMessage"),r=q("LoadingSpinner"),m=q("SectorContainer");return c(),d("div",qo,[n("div",$o,[t.error?(c(),$(a,{key:0,type:"error",title:t.errorTitle,message:t.errorMessage},{default:ue(()=>[t.showInstallLink?(c(),d("div",Xo,[n("a",{href:t.installPageUrl},"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",8,Ko)])):h("",!0)]),_:1},8,["title","message"])):h("",!0),t.loading?(c(),$(r,{key:1,message:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞..."})):h("",!0),!t.loading&&t.accessDenied?(c(),$(a,{key:2,type:"error",title:"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",message:t.accessErrorMessage},{default:ue(()=>[t.isDirectAccessDenied?(c(),d("div",Jo,[...e[4]||(e[4]=[n("p",{style:{margin:"0 0 10px 0","font-weight":"600",color:"#856404"}},[n("strong",null,"–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")],-1),n("ol",{style:{margin:"0","padding-left":"20px",color:"#856404"}},[n("li",null,"–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24"),n("li",null,"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Bitrix24 (placement, –≤–∏–¥–∂–µ—Ç –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É)")],-1)])])):t.debugInfo?(c(),d("div",Go,[e[5]||(e[5]=n("strong",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:",-1)),e[6]||(e[6]=n("br",null,null,-1)),X(" ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+u(t.debugInfo.userId),1),e[7]||(e[7]=n("br",null,null,-1)),X(" ID –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "+u(t.debugInfo.departmentIds),1),e[8]||(e[8]=n("br",null,null,-1)),X(" –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ ID –æ—Ç–¥–µ–ª–æ–≤: "+u(t.debugInfo.allowedIds),1),e[9]||(e[9]=n("br",null,null,-1)),e[10]||(e[10]=n("small",{style:{color:"#856404"}},"–î–æ–±–∞–≤—å—Ç–µ ID –æ—Ç–¥–µ–ª–∞ –≤ —Ñ–∞–π–ª vue-app/src/config/access-config.js",-1))])):h("",!0)]),_:1},8,["message"])):h("",!0),!t.loading&&!t.accessDenied&&t.accessAllowed?(c(),d("div",Yo,[n("div",Qo,[n("div",Zo,[n("div",en,[e[13]||(e[13]=n("h2",{class:"greeting-title"},"–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ò–¢ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –ü–ª–∞–Ω–µ—Ä–∫–∏ –ì–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ü–∏–∏",-1)),n("p",tn,[e[11]||(e[11]=X(" –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ",-1)),n("strong",null,u(t.userName),1),e[12]||(e[12]=X("! ",-1))])]),t.isAdmin?(c(),d("button",{key:0,class:"admin-button-header",onClick:e[0]||(e[0]=(...f)=>t.openAdminPopup&&t.openAdminPopup(...f)),title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"}," ‚öôÔ∏è ")):h("",!0)])]),n("div",on,[(c(!0),d(H,null,W(t.sectors,f=>(c(),$(m,{key:f.id,"sector-config":f,onModuleEvent:t.handleModuleEvent,onSectorExpanded:t.handleSectorExpanded,onSectorCollapsed:t.handleSectorCollapsed},null,8,["sector-config","onModuleEvent","onSectorExpanded","onSectorCollapsed"]))),128))]),t.showAdminPopup&&t.isAdmin?(c(),d("div",{key:0,class:"admin-popup-overlay",onClick:e[3]||(e[3]=(...f)=>t.closeAdminPopup&&t.closeAdminPopup(...f))},[n("div",{class:"admin-popup",onClick:e[2]||(e[2]=ae(()=>{},["stop"]))},[n("div",nn,[e[14]||(e[14]=n("h3",{class:"admin-popup-title"},"‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",-1)),n("button",{class:"admin-popup-close",onClick:e[1]||(e[1]=(...f)=>t.closeAdminPopup&&t.closeAdminPopup(...f))}," ‚úï ")]),n("div",sn,[n("div",an,[(c(!0),d(H,null,W(t.adminButtons,f=>(c(),d("div",{key:f.id,class:"admin-interface-button",onClick:g=>t.navigateToAdmin(f.route)},[n("div",ln,u(f.icon),1),n("div",cn,u(f.title),1),f.description?(c(),d("div",dn,u(f.description),1)):h("",!0)],8,rn))),128))])])])])):h("",!0)])):h("",!0)])])}const mn=j(Wo,[["render",un],["__scopeId","data-v-12137466"]]),de=x(new Map),fe=x({hits:0,misses:0,sets:0,invalidations:0}),tt={defaultTTL:5*60*1e3,maxSize:100,enableStats:!0};function gn(s={}){const{ttl:e=tt.defaultTTL,maxSize:o=tt.maxSize,enableStats:t=tt.enableStats}=s,i=P=>{const v=new WeakSet;return JSON.stringify(P,(T,E)=>{if(typeof E=="object"&&E!==null){if(v.has(E))return"[Circular]";v.add(E)}return typeof E=="function"||E===void 0?null:E})},l=(P,v={})=>{const T=Object.keys(v).sort().reduce((E,V)=>{const B=v[V];if(B==null)E[V]=null;else if(typeof B=="object")try{E[V]=i(B)}catch{E[V]=String(B)}else E[V]=B;return E},{});try{return`${P}_${i(T)}`}catch{const V=Object.keys(T).sort().map(B=>`${B}=${T[B]}`).join("&");return`${P}_${V}`}},a=P=>{const v=de.value.get(P);return v?Date.now()-v.timestamp>v.ttl?(de.value.delete(P),t&&fe.value.misses++,null):(v.lastAccessed=Date.now(),t&&fe.value.hits++,v.data):(t&&fe.value.misses++,null)},r=(P,v,T=null)=>{de.value.size>=o&&m(),de.value.set(P,{data:v,timestamp:Date.now(),lastAccessed:Date.now(),ttl:T||e}),t&&fe.value.sets++},m=()=>{let P=null,v=1/0;for(const[T,E]of de.value.entries())E.lastAccessed<v&&(v=E.lastAccessed,P=T);P&&de.value.delete(P)},f=()=>{de.value.clear(),t&&(fe.value={hits:0,misses:0,sets:0,invalidations:0})},g=P=>{const v=typeof P=="string"?new RegExp(P):P;let T=0;for(const E of de.value.keys())v.test(E)&&(de.value.delete(E),T++);return t&&(fe.value.invalidations+=T),T},b=()=>{const P=Date.now();let v=0;for(const[T,E]of de.value.entries())P-E.timestamp>E.ttl&&(de.value.delete(T),v++);return v},L=()=>{const P=fe.value.hits+fe.value.misses,v=P>0?(fe.value.hits/P*100).toFixed(2):0;return{...fe.value,size:de.value.size,hitRate:`${v}%`}};let M=null;const C=(P=5*60*1e3)=>{M&&clearInterval(M),M=setInterval(()=>{b()},P)},A=()=>{M&&(clearInterval(M),M=null)};return C(),{get:a,set:r,clear:f,invalidate:g,cleanup:b,getCacheKey:l,getStats:L,startAutoCleanup:C,stopAutoCleanup:A}}function _e(s){if(!s||typeof s!="object"||!s.timestamp||typeof s.timestamp!="string"||!s.event||typeof s.event!="string"||!s.category||typeof s.category!="string"||!["tasks","smart-processes","errors"].includes(s.category))return!1;try{new Date(s.timestamp)}catch{return!1}return!0}function fn(s){if(!s||typeof s!="object")return!1;for(const[e,o]of Object.entries(s))if(typeof o=="function")return!1;return!0}function Ve(s){if(!_e(s))return null;const e={timestamp:s.timestamp,event:s.event,category:s.category};return s.ip&&typeof s.ip=="string"&&(e.ip=s.ip),s.payload&&typeof s.payload=="object"&&(e.payload=s.payload),s.details&&fn(s.details)&&(e.details=s.details),e}function lt(s){return Array.isArray(s)?s.map(e=>Ve(e)).filter(e=>e!==null):[]}const{get:hn,set:vn,getCacheKey:yn,invalidate:yt}=gn({ttl:2*60*1e3,maxSize:50});class pt{static getBaseUrl(){return be("/api/webhook-logs.php")}static get BASE_URL(){return this.getBaseUrl()}static async getLogs(e={},o=1,t=50,i=!1){if(o<1)throw new Error("Page must be greater than 0");if(t<1||t>1e3)throw new Error("Limit must be between 1 and 1000");const l={category:e.category||null,event:e.event||null,date:e.date||null,hour:e.hour!==void 0?e.hour:null,dateFrom:e.dateFrom||null,dateTo:e.dateTo||null,ip:e.ip||null,status:e.status||null},a=this.getBaseUrl(),r=yn(a,{filters:l,page:o,limit:t});if(!i){const f=hn(r);if(f)return console.log("[WebhookLogsApiService] Cache hit:",r.substring(0,50)+"..."),f}console.log("[WebhookLogsApiService] Cache miss:",r.substring(0,50)+"...");const m=new URLSearchParams({page:o.toString(),limit:t.toString()});l.category&&m.append("category",l.category),l.event&&m.append("event",l.event),l.date&&m.append("date",l.date),l.hour!==null&&m.append("hour",l.hour.toString()),l.dateFrom&&m.append("dateFrom",l.dateFrom),l.dateTo&&m.append("dateTo",l.dateTo),l.ip&&m.append("ip",l.ip),l.status&&m.append("status",l.status);try{const f=this.getBaseUrl(),g=await fetch(`${f}?${m.toString()}`);if(!g.ok){const C=await g.text();let A;try{A=JSON.parse(C)}catch{A={error:C}}throw new Error(A.error_description||A.error||`HTTP error! status: ${g.status}`)}const b=await g.json();if(console.log("[WebhookLogsApiService] API response:",{success:b.success,logsCount:b.logs?.length||0,pagination:b.pagination,hasError:!!b.error}),b.error)throw new Error(b.error_description||b.error);if(!b.success)throw console.warn("[WebhookLogsApiService] API returned success=false:",b),new Error("API request failed");if(!Array.isArray(b.logs))throw console.error("[WebhookLogsApiService] Invalid logs format:",b.logs),new Error("Invalid logs format: expected array");const L=lt(b.logs);(!b.pagination||typeof b.pagination!="object")&&(console.warn("[WebhookLogsApiService] Invalid pagination format:",b.pagination),b.pagination={page:o,limit:t,total:L.length,pages:Math.ceil(L.length/t)});const M={success:!0,logs:L,pagination:{page:b.pagination.page||o,limit:b.pagination.limit||t,total:b.pagination.total||L.length,pages:b.pagination.pages||Math.ceil((b.pagination.total||L.length)/t)}};return vn(r,M),M}catch(f){throw console.error("[WebhookLogsApiService] Error:",f),f}}static invalidateCacheOnFilterChange(e={},o={}){const t=yt(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Invalidated ${t} entries on filter change`)}static clearCache(){const e=yt(/^\/api\/webhook-logs\.php/);console.log(`[WebhookLogsApiService] Cleared ${e} entries`)}static async getLogDetails(e,o=null){const t={};return o&&(t.date=o),(await this.getLogs(t,1,1e3)).logs.find(a=>`${a.timestamp}_${a.event}`===e)||null}static async getErrors(e={},o=1,t=50){return this.getLogs({...e,category:"errors"},o,t)}static async getStats(e={}){const o=await this.getLogs(e,1,1e3),t={total:o.pagination.total||o.logs.length,tasks:0,smartProcesses:0,errors:0,byEvent:{},byDate:{}};return o.logs.forEach(i=>{i.category==="tasks"?t.tasks++:i.category==="smart-processes"?t.smartProcesses++:i.category==="errors"&&t.errors++,t.byEvent[i.event]||(t.byEvent[i.event]=0),t.byEvent[i.event]++;const l=i.timestamp.split("T")[0];t.byDate[l]||(t.byDate[l]=0),t.byDate[l]++}),t}}function pn(){const s=It(),e=Ne(),o=new Date().toISOString().split("T")[0],t=x({category:null,event:null,dateFrom:o,dateTo:null,hour:null,ip:null,search:null,status:null}),i=()=>{const f=s.query;t.value={category:f.category||null,event:f.event||null,dateFrom:f.dateFrom||f.date||o,dateTo:f.dateTo||null,hour:f.hour?parseInt(f.hour):null,ip:f.ip||null,search:f.search||null,status:f.status||null}},l=f=>{if(m)return;const g={...s.query};Object.keys(f).forEach(L=>{const M=f[L];M!==null&&M!==""&&M!==void 0?g[L]=M.toString():delete g[L]}),JSON.stringify(g)!==JSON.stringify(s.query)&&(m=!0,e.replace({path:s.path,query:g}).finally(()=>{setTimeout(()=>{m=!1},100)}))},a=f=>{const g={...t.value,...f};JSON.stringify(t.value)!==JSON.stringify(g)&&(t.value=g,l(t.value))},r=()=>{t.value={category:null,event:null,dateFrom:o,dateTo:null,hour:null,ip:null,search:null,status:null},l(t.value)};se(()=>{i()});let m=!1;return ge(()=>s.query,(f,g)=>{if(m)return;JSON.stringify(f)!==JSON.stringify(g)&&i()},{deep:!0}),{filters:t,updateFilters:a,clearFilters:r,loadFiltersFromUrl:i}}function bn(s,e,o={}){if(!e||!e.trim())return s;const{caseSensitive:t=!1,searchInEvent:i=!0,searchInPayload:l=!0,searchInDetails:a=!0,searchInIp:r=!0,searchInTimestamp:m=!1}=o,f=t?e.trim():e.trim().toLowerCase();return s.filter(g=>{if(i&&g.event&&(t?g.event:g.event.toLowerCase()).includes(f))return!0;if(l&&g.payload)try{const b=JSON.stringify(g.payload);if((t?b:b.toLowerCase()).includes(f))return!0}catch(b){console.warn("Error searching in payload:",b)}if(a&&g.details)try{const b=JSON.stringify(g.details);if((t?b:b.toLowerCase()).includes(f))return!0}catch(b){console.warn("Error searching in details:",b)}return!!(r&&g.ip&&(t?g.ip:g.ip.toLowerCase()).includes(f)||m&&g.timestamp&&(t?g.timestamp:g.timestamp.toLowerCase()).includes(f))})}function st(s){if(!s||typeof s!="object"||s.category!==void 0&&s.category!==null&&!["tasks","smart-processes","errors"].includes(s.category)||s.date!==void 0&&s.date!==null&&!/^\d{4}-\d{2}-\d{2}$/.test(s.date))return!1;if(s.hour!==void 0&&s.hour!==null){const e=parseInt(s.hour,10);if(isNaN(e)||e<0||e>23)return!1}return!(s.ip!==void 0&&s.ip!==null&&(typeof s.ip!="string"||s.ip.length===0))}function _n(s){if(!s||typeof s!="object")return!1;const e=parseInt(s.page,10),o=parseInt(s.limit,10),t=parseInt(s.total,10),i=parseInt(s.pages,10);return!(isNaN(e)||e<1||isNaN(o)||o<1||o>1e3||isNaN(t)||t<0||isNaN(i)||i<0)}function bt(s){if(s==null)return"";const e=String(s),o=e.replace(/"/g,'""');return e.includes(",")||e.includes(`
`)||e.includes('"')?`"${o}"`:o}function wn(s){return s==null?"":typeof s=="object"?JSON.stringify(s):String(s)}function Cn(s,e="webhook-logs.csv",o={}){return new Promise((t,i)=>{try{if(!Array.isArray(s)||s.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{columns:l=null,onProgress:a=null}=o,r=l||Object.keys(s[0]),f=[r.map(C=>bt(C)).join(",")],g=s.length,b=1e3;for(let C=0;C<g;C+=b){const A=s.slice(C,C+b);if(A.forEach(P=>{const v=r.map(T=>{const E=P[T];return bt(wn(E))});f.push(v.join(","))}),a){const P=Math.min(100,Math.round((C+A.length)/g*100));a(P)}}const L="\uFEFF"+f.join(`
`),M=new Blob([L],{type:"text/csv;charset=utf-8;"});At(M,e),a&&a(100),t()}catch(l){i(l)}})}function kn(s,e="webhook-logs.json",o={}){return new Promise((t,i)=>{try{if(!Array.isArray(s)||s.length===0)throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const{pretty:l=!0,onProgress:a=null}=o,r=l?JSON.stringify(s,null,2):JSON.stringify(s);a&&a(50);const m=new Blob([r],{type:"application/json;charset=utf-8;"});At(m,e),a&&a(100),t()}catch(l){i(l)}})}function At(s,e){const o=URL.createObjectURL(s),t=document.createElement("a");t.href=o,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(o)},100)}function Sn(s,e={},o=0){const t=new Date().toISOString().split("T")[0],i=new Date().toTimeString().split(" ")[0].replace(/:/g,"-");let l=`webhook-logs_${t}_${i}`;const a=[];return e.category&&a.push(`cat-${e.category}`),e.event&&a.push(`evt-${e.event.substring(0,10)}`),e.dateFrom&&a.push(`from-${e.dateFrom}`),e.dateTo&&a.push(`to-${e.dateTo}`),a.length>0&&(l+=`_${a.join("-")}`),o>0&&(l+=`_${o}records`),`${l}.${s}`}function xn(s){const e=[];if(!Array.isArray(s))return e.push("–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"),{valid:!1,errors:e,estimatedSize:0};if(s.length===0)return e.push("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"),{valid:!1,errors:e,estimatedSize:0};const o=JSON.stringify(s).length,t=50*1024*1024;return o>t&&e.push(`–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö (${Math.round(o/1024/1024)} MB). –≠–∫—Å–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è.`),{valid:e.length===0,errors:e,estimatedSize:o}}function ct(s,e="short"){if(!s)return"‚Äî";try{const o=new Date(s);if(isNaN(o.getTime()))return"Invalid date";switch(e){case"short":return o.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});case"long":return o.toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});case"relative":return Mn(o);default:return o.toLocaleString("ru-RU")}}catch{return"Invalid date"}}function Mn(s){const o=new Date-s,t=Math.floor(o/1e3),i=Math.floor(t/60),l=Math.floor(i/60),a=Math.floor(l/24);return t<60?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":i<60?`${i} ${ot(i,"–º–∏–Ω—É—Ç—É","–º–∏–Ω—É—Ç—ã","–º–∏–Ω—É—Ç")} –Ω–∞–∑–∞–¥`:l<24?`${l} ${ot(l,"—á–∞—Å","—á–∞—Å–∞","—á–∞—Å–æ–≤")} –Ω–∞–∑–∞–¥`:a<7?`${a} ${ot(a,"–¥–µ–Ω—å","–¥–Ω—è","–¥–Ω–µ–π")} –Ω–∞–∑–∞–¥`:ct(s.toISOString(),"short")}function ot(s,e,o,t){const i=s%10,l=s%100;return i===1&&l!==11?e:i>=2&&i<=4&&(l<10||l>=20)?o:t}function ze(s){return s?s.replace(/^ON/,"").split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):"‚Äî"}function Me(s){return{tasks:"–ó–∞–¥–∞—á–∏","smart-processes":"–°–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å—ã",errors:"–û—à–∏–±–∫–∏"}[s]||s}function dt(s){if(!s||typeof s!="object")return"‚Äî";const e=[];if(s.task_id&&e.push(`–ó–∞–¥–∞—á–∞ #${s.task_id}`),s.entity_id&&e.push(`–°—É—â–Ω–æ—Å—Ç—å #${s.entity_id}`),s.task_title&&e.push(`"${s.task_title}"`),s.title&&e.push(`"${s.title}"`),s.comment_text){const o=s.comment_text.length>50?s.comment_text.substring(0,50)+"...":s.comment_text;e.push(`–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${o}`)}return e.length>0?e.join(" ‚Ä¢ "):"‚Äî"}const An={name:"WebhookLogsExport",props:{logs:{type:Array,default:()=>[]},selectedLogs:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},totalCount:{type:Number,default:0}},emits:["export-start","export-complete","export-error"],setup(s,{emit:e}){const o=x(!1),t=x("csv"),i=x("all"),l=x(!0),a=x(!1),r=x(0),m=x([]),f=x(null),g=y(()=>s.selectedLogs.length),b=y(()=>s.logs.length>0||s.totalCount>0),L=y(()=>s.filters.category||s.filters.event||s.filters.dateFrom||s.filters.dateTo),M=y(()=>i.value==="selected"?g.value:s.logs.length||s.totalCount),C=y(()=>i.value==="selected"?g.value>0:b.value),A=()=>{r.value=0,m.value=[],f.value=null,g.value>0?i.value="selected":i.value="all",o.value=!0,v()},P=()=>{a.value||(o.value=!1)},v=()=>{const B=T(),D=xn(B);m.value=D.errors,f.value=D.estimatedSize},T=()=>(i.value==="selected"?s.selectedLogs:s.logs).map(p=>Ve(p)).filter(p=>_e(p)?!0:(console.warn("[WebhookLogsExport] Skipping invalid log:",p),!1)),E=async()=>{try{a.value=!0,r.value=0;let B=T();if(B.length===0)throw new Error("–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");const D=B.map(N=>({timestamp:N.timestamp,event:N.event,category:N.category,ip:N.ip||null,details:N.details||null,payload:N.payload||null,formatted:{timestamp:ct(N.timestamp),event:ze(N.event),category:Me(N.category),details:dt(N.details)}}));e("export-start",{format:t.value,scope:i.value,count:D.length});const p=Sn(t.value,s.filters,D.length),w=N=>{r.value=N};t.value==="csv"?await Cn(D,p,{onProgress:w}):await kn(D,p,{pretty:l.value,onProgress:w}),e("export-complete",{format:t.value,filename:p,count:D.length}),setTimeout(()=>{a.value=!1,o.value=!1,r.value=0},500)}catch(B){console.error("[WebhookLogsExport] Export error:",B),e("export-error",B),a.value=!1,r.value=0,alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${B.message}`)}},V=B=>B<1024?`${B} B`:B<1024*1024?`${(B/1024).toFixed(2)} KB`:`${(B/1024/1024).toFixed(2)} MB`;return ge([i,()=>s.logs,()=>s.selectedLogs],()=>{o.value&&v()}),{showExportModal:o,exportFormat:t,exportScope:i,jsonPretty:l,exporting:a,exportProgress:r,exportWarnings:m,estimatedSize:f,selectedCount:g,hasAllLogs:b,hasFilters:L,exportCount:M,canExport:C,openExportModal:A,closeExportModal:P,handleExport:E,formatSize:V}}},En={class:"webhook-logs-export"},Tn=["disabled","title"],Ln={key:0,class:"selected-badge"},Dn={class:"export-modal-header"},In={class:"export-modal-body"},Pn={class:"export-section"},Nn={class:"radio-group"},Un={class:"export-section"},Fn={class:"radio-group"},Bn=["disabled"],Rn={class:"radio-label"},On={key:0},Vn={key:1},zn=["disabled"],Hn={class:"radio-label"},jn={key:0,class:"export-section"},Wn={class:"checkbox-option"},qn={class:"export-info"},$n={class:"info-item"},Xn={class:"info-value"},Kn={key:0,class:"info-item"},Jn={class:"info-value"},Gn={key:1,class:"export-warnings"},Yn={key:0,class:"export-progress"},Qn={class:"progress-bar"},Zn={class:"progress-text"},es={class:"export-modal-footer"},ts=["disabled"],os={key:0},ns={key:1},ss=["disabled"];function as(s,e,o,t,i,l){return c(),d("div",En,[n("button",{onClick:e[0]||(e[0]=(...a)=>t.openExportModal&&t.openExportModal(...a)),class:"btn-export",disabled:!t.canExport,title:t.canExport?"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞"},[e[11]||(e[11]=n("span",{class:"btn-icon"},"üì•",-1)),e[12]||(e[12]=n("span",{class:"btn-text"},"–≠–∫—Å–ø–æ—Ä—Ç",-1)),t.selectedCount>0?(c(),d("span",Ln,u(t.selectedCount),1)):h("",!0)],8,Tn),Q(Se,{name:"modal"},{default:ue(()=>[t.showExportModal?(c(),d("div",{key:0,class:"export-modal-overlay",onClick:e[10]||(e[10]=(...a)=>t.closeExportModal&&t.closeExportModal(...a))},[n("div",{class:"export-modal",onClick:e[9]||(e[9]=ae(()=>{},["stop"]))},[n("div",Dn,[e[13]||(e[13]=n("h3",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",-1)),n("button",{onClick:e[1]||(e[1]=(...a)=>t.closeExportModal&&t.closeExportModal(...a)),class:"btn-close"},"‚úï")]),n("div",In,[n("div",Pn,[e[16]||(e[16]=n("h4",null,"–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞",-1)),n("div",Nn,[n("label",{class:U(["radio-option",{active:t.exportFormat==="csv"}])},[Z(n("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=a=>t.exportFormat=a),value:"csv",class:"radio-input"},null,512),[[Xe,t.exportFormat]]),e[14]||(e[14]=n("span",{class:"radio-label"},[n("strong",null,"CSV"),n("small",null,"–î–ª—è Excel, LibreOffice")],-1))],2),n("label",{class:U(["radio-option",{active:t.exportFormat==="json"}])},[Z(n("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=a=>t.exportFormat=a),value:"json",class:"radio-input"},null,512),[[Xe,t.exportFormat]]),e[15]||(e[15]=n("span",{class:"radio-label"},[n("strong",null,"JSON"),n("small",null,"–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, API")],-1))],2)])]),n("div",Un,[e[19]||(e[19]=n("h4",null,"–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",-1)),n("div",Fn,[n("label",{class:U(["radio-option",{active:t.exportScope==="all",disabled:!t.hasAllLogs}])},[Z(n("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=a=>t.exportScope=a),value:"all",disabled:!t.hasAllLogs,class:"radio-input"},null,8,Bn),[[Xe,t.exportScope]]),n("span",Rn,[e[17]||(e[17]=n("strong",null,"–í—Å–µ –∑–∞–ø–∏—Å–∏",-1)),t.hasFilters?(c(),d("small",On,"–° –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ ("+u(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π)",1)):(c(),d("small",Vn,"–í—Å–µ–≥–æ: "+u(t.exportCount)+" –∑–∞–ø–∏—Å–µ–π",1))])],2),n("label",{class:U(["radio-option",{active:t.exportScope==="selected",disabled:t.selectedCount===0}])},[Z(n("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=a=>t.exportScope=a),value:"selected",disabled:t.selectedCount===0,class:"radio-input"},null,8,zn),[[Xe,t.exportScope]]),n("span",Hn,[e[18]||(e[18]=n("strong",null,"–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏",-1)),n("small",null,u(t.selectedCount)+" –∑–∞–ø–∏—Å–µ–π –≤—ã–±—Ä–∞–Ω–æ",1)])],2)])]),t.exportFormat==="json"?(c(),d("div",jn,[e[21]||(e[21]=n("h4",null,"–û–ø—Ü–∏–∏ JSON",-1)),n("label",Wn,[Z(n("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=a=>t.jsonPretty=a),class:"checkbox-input"},null,512),[[it,t.jsonPretty]]),e[20]||(e[20]=n("span",{class:"checkbox-label"},"–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)",-1))])])):h("",!0),n("div",qn,[n("div",$n,[e[22]||(e[22]=n("span",{class:"info-label"},"–ó–∞–ø–∏—Å–µ–π –∫ —ç–∫—Å–ø–æ—Ä—Ç—É:",-1)),n("span",Xn,u(t.exportCount),1)]),t.estimatedSize?(c(),d("div",Kn,[e[23]||(e[23]=n("span",{class:"info-label"},"–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä:",-1)),n("span",Jn,u(t.formatSize(t.estimatedSize)),1)])):h("",!0)]),t.exportWarnings.length>0?(c(),d("div",Gn,[(c(!0),d(H,null,W(t.exportWarnings,(a,r)=>(c(),d("div",{key:r,class:"warning-item"}," ‚ö†Ô∏è "+u(a),1))),128))])):h("",!0)]),t.exporting?(c(),d("div",Yn,[n("div",Qn,[n("div",{class:"progress-fill",style:ie({width:`${t.exportProgress}%`})},null,4)]),n("div",Zn," –≠–∫—Å–ø–æ—Ä—Ç: "+u(t.exportProgress)+"% ",1)])):h("",!0),n("div",es,[n("button",{onClick:e[7]||(e[7]=(...a)=>t.handleExport&&t.handleExport(...a)),disabled:t.exporting||!t.canExport,class:"btn-primary"},[t.exporting?(c(),d("span",os,"–≠–∫—Å–ø–æ—Ä—Ç...")):(c(),d("span",ns,"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"))],8,ts),n("button",{onClick:e[8]||(e[8]=(...a)=>t.closeExportModal&&t.closeExportModal(...a)),disabled:t.exporting,class:"btn-secondary"}," –û—Ç–º–µ–Ω–∞ ",8,ss)])])])):h("",!0)]),_:1})])}const is=j(An,[["render",as],["__scopeId","data-v-7ae66f8c"]]);function rs(s,e=300){let o;return function(...i){const l=()=>{clearTimeout(o),s(...i)};clearTimeout(o),o=setTimeout(l,e)}}const ls={name:"WebhookLogSearch",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","search"],setup(s,{emit:e}){const o=x(s.modelValue||""),t=x(!1),i=x(null),l=rs(M=>{t.value=!1,e("search",M)},400),a=()=>{t.value=!0,e("update:modelValue",o.value),l(o.value)},r=()=>{t.value=!1,e("search",o.value)},m=()=>{o.value="",t.value=!1,i.value=null,e("update:modelValue",""),e("search","")};return ge(()=>s.modelValue,M=>{M!==o.value&&(o.value=M)}),{searchQuery:o,isSearching:t,searchResultsCount:i,handleSearchInput:a,handleSearch:r,clearSearch:m,setResultsCount:M=>{i.value=M},getResultsText:M=>{const C=M%10,A=M%100;return A>=11&&A<=19?"–∑–∞–ø–∏—Å–µ–π":C===1?"–∑–∞–ø–∏—Å—å":C>=2&&C<=4?"–∑–∞–ø–∏—Å–∏":"–∑–∞–ø–∏—Å–µ–π"},performSearch:(M,C)=>{if(!M||!C||!Array.isArray(C))return[];const A=M.toLowerCase().trim();return A.length===0?C:C.map(v=>Ve(v)).filter(v=>_e(v)).filter(v=>{if(v.event&&v.event.toLowerCase().includes(A)||v.category&&v.category.toLowerCase().includes(A)||v.ip&&v.ip.toLowerCase().includes(A)||v.details&&typeof v.details=="object"&&(v.details.task_id&&String(v.details.task_id).includes(A)||v.details.task_title&&v.details.task_title.toLowerCase().includes(A)||v.details.entity_id&&String(v.details.entity_id).includes(A)||v.details.title&&v.details.title.toLowerCase().includes(A)||v.details.comment_text&&v.details.comment_text.toLowerCase().includes(A)))return!0;if(v.payload&&typeof v.payload=="object")try{if(JSON.stringify(v.payload).toLowerCase().includes(A))return!0}catch{}return!1})},formatSearchResult:M=>{const C=[];if(M.event&&C.push(ze(M.event)),M.category&&C.push(Me(M.category)),M.details){const A=dt(M.details);A!=="‚Äî"&&C.push(A)}return C.join(" ‚Ä¢ ")}}}},cs={class:"webhook-search"},ds={class:"search-wrapper"},us={key:0,class:"search-indicator"},ms={key:1,class:"search-results"};function gs(s,e,o,t,i,l){return c(),d("div",cs,[n("div",ds,[e[5]||(e[5]=n("span",{class:"search-icon"},"üîç",-1)),Z(n("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.searchQuery=a),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ª–æ–≥–æ–≤ (—Å–æ–±—ã—Ç–∏–µ, payload, IP, –¥–µ—Ç–∞–ª–∏)...",class:"search-input",onInput:e[1]||(e[1]=(...a)=>t.handleSearchInput&&t.handleSearchInput(...a)),onKeyup:[e[2]||(e[2]=ee((...a)=>t.handleSearch&&t.handleSearch(...a),["enter"])),e[3]||(e[3]=ee((...a)=>t.clearSearch&&t.clearSearch(...a),["esc"]))]},null,544),[[Re,t.searchQuery]]),t.searchQuery?(c(),d("button",{key:0,onClick:e[4]||(e[4]=(...a)=>t.clearSearch&&t.clearSearch(...a)),class:"clear-button",title:"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ (Esc)","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):h("",!0)]),t.isSearching?(c(),d("div",us,[...e[6]||(e[6]=[n("span",{class:"spinner"},null,-1),X(" –ü–æ–∏—Å–∫... ",-1)])])):h("",!0),t.searchQuery&&t.searchResultsCount!==null?(c(),d("div",ms," –ù–∞–π–¥–µ–Ω–æ: "+u(t.searchResultsCount)+" "+u(t.getResultsText(t.searchResultsCount)),1)):h("",!0)])}const fs=j(ls,[["render",gs],["__scopeId","data-v-db228863"]]);function hs(s,e=null){const o=()=>{try{const a=localStorage.getItem(s);return a?JSON.parse(a):e}catch(a){return console.error(`Error loading ${s} from localStorage:`,a),e}},t=a=>{try{localStorage.setItem(s,JSON.stringify(a))}catch(r){console.error(`Error saving ${s} to localStorage:`,r)}},i=()=>{try{localStorage.removeItem(s)}catch(a){console.error(`Error clearing ${s} from localStorage:`,a)}},l=x(o());return ge(l,a=>{t(a)},{deep:!0}),{value:l,save:t,load:o,clear:i}}const vs={name:"WebhookLogFilters",props:{filters:{type:Object,required:!0}},emits:["update:filters","reset"],setup(s,{emit:e}){const o=x(null),t=hs("webhook-filters",{category:null,event:null,dateFrom:null,dateTo:null,hour:null,ip:null,status:null}),i=p=>(o.value=null,st(p)?(e("update:filters",p),!0):(o.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",console.error("[WebhookLogFilters] Validation error:",o.value),!1)),l=new Date().toISOString().split("T")[0],a=x({category:t.value.category||s.filters.category||null,event:t.value.event||s.filters.event||null,dateFrom:t.value.dateFrom||s.filters.dateFrom||s.filters.date||l,dateTo:t.value.dateTo||s.filters.dateTo||null,hour:t.value.hour!==void 0?t.value.hour:s.filters.hour!==void 0?s.filters.hour:null,ip:t.value.ip||s.filters.ip||null,status:t.value.status||s.filters.status||null}),r=x(null),m=[{id:"today",label:"–°–µ–≥–æ–¥–Ω—è",getDates:()=>({from:l,to:l})},{id:"yesterday",label:"–í—á–µ—Ä–∞",getDates:()=>{const p=new Date;p.setDate(p.getDate()-1);const w=p.toISOString().split("T")[0];return{from:w,to:w}}},{id:"last7days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π",getDates:()=>{const p=new Date;return p.setDate(p.getDate()-7),{from:p.toISOString().split("T")[0],to:l}}},{id:"last30days",label:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π",getDates:()=>{const p=new Date;return p.setDate(p.getDate()-30),{from:p.toISOString().split("T")[0],to:l}}}],f=p=>{const w=m.find(N=>N.id===p);if(w){const N=w.getDates();a.value.dateFrom=N.from,a.value.dateTo=N.to,r.value=p,B()}};ge(()=>s.filters,p=>{a.value={category:p.category||null,event:p.event||null,dateFrom:p.dateFrom||p.date||l,dateTo:p.dateTo||null,hour:p.hour!==void 0?p.hour:null,ip:p.ip||null,status:p.status||null}},{deep:!0}),ge(a,p=>{t.value={...p},e("update:filters",{...p})},{deep:!0});const g=y(()=>{const p={};return a.value.category&&(p.category=a.value.category),a.value.event&&(p.event=a.value.event),a.value.hour!==null&&(p.hour=a.value.hour),a.value.ip&&(p.ip=a.value.ip),a.value.status&&(p.status=a.value.status),a.value.dateFrom&&a.value.dateFrom!==l&&(p.dateFrom=a.value.dateFrom),a.value.dateTo&&(p.dateTo=a.value.dateTo),p}),b=y(()=>Object.keys(g.value).length>0),L=p=>({category:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è",event:"–°–æ–±—ã—Ç–∏–µ",hour:"–ß–∞—Å",ip:"IP –∞–¥—Ä–µ—Å",status:"–°—Ç–∞—Ç—É—Å",dateFrom:"–î–∞—Ç–∞ –æ—Ç",dateTo:"–î–∞—Ç–∞ –¥–æ"})[p]||p,M=(p,w)=>p==="category"?Me(w)||w:p==="hour"?`${String(w).padStart(2,"0")}:00`:p==="event"?ze(w)||w:p==="status"&&{success:"–£—Å–ø–µ—à–Ω–æ",error:"–û—à–∏–±–∫–∞",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"}[w]||w,C=y(()=>[{value:null,label:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"},{value:"tasks",label:Me("tasks")},{value:"smart-processes",label:Me("smart-processes")},{value:"errors",label:Me("errors")}]),A=y(()=>[{value:null,label:"–í—Å–µ —Å–æ–±—ã—Ç–∏—è"},...["ONTASKADD","ONTASKUPDATE","ONTASKDELETE","ONTASKCOMMENTADD","ONTASKCOMMENTUPDATE","ONTASKCOMMENTDELETE","ONCRMDYNAMICITEMADD","ONCRMDYNAMICITEMUPDATE","ONCRMDYNAMICITEMDELETE"].map(w=>({value:w,label:ze(w)}))]),P=p=>{p==="hour"?a.value[p]=null:p==="dateFrom"?a.value[p]=l:a.value[p]=null,r.value=null},v=p=>{const w={...a.value,category:p||null};i(w)&&(a.value.category=p)},T=p=>{const w={...a.value,event:p||null};i(w)&&(a.value.event=p)},E=(p,w)=>{if(p&&!/^\d{4}-\d{2}-\d{2}$/.test(p)){console.error("[WebhookLogFilters] Invalid date format:",p),o.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã";return}const N={...a.value,[w]:p||null};i(N)&&(a.value[w]=p)},V=p=>{if(p!=null){const N=parseInt(p,10);if(isNaN(N)||N<0||N>23){console.error("[WebhookLogFilters] Invalid hour:",p),o.value="–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∞—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23)";return}}const w={...a.value,hour:p!=null?parseInt(p,10):null};i(w)&&(a.value.hour=p!=null?parseInt(p,10):null)},B=()=>{i({...a.value})},D=()=>{a.value={category:null,event:null,dateFrom:l,dateTo:null,hour:null,ip:null,status:null},r.value=null,t.clear(),e("reset")};return se(()=>{t.value&&Object.keys(t.value).length>0&&e("update:filters",{...t.value})}),{localFilters:a,activeFilters:g,hasActiveFilters:b,getFilterLabel:L,getFilterValue:M,clearFilter:P,handleFilterChange:B,handleCategoryChange:v,handleEventChange:T,handleDateChange:E,handleHourChange:V,handleReset:D,quickFilters:m,activeQuickFilter:r,applyQuickFilter:f,categoryOptions:C,eventOptions:A,validationError:o}}},ys={class:"webhook-log-filters"},ps={key:0,class:"active-filters-indicator"},bs=["onClick"],_s={key:1,class:"validation-error"},ws={class:"quick-filters"},Cs=["onClick"],ks={class:"filters-row"},Ss={class:"filter-group"},xs=["value"],Ms={class:"filter-group"},As=["value"],Es={class:"filter-group"},Ts={class:"filter-group"},Ls={class:"filter-group"},Ds={class:"filter-group"},Is={class:"filter-group"};function Ps(s,e,o,t,i,l){return c(),d("div",ys,[t.hasActiveFilters?(c(),d("div",ps,[e[14]||(e[14]=n("span",{class:"indicator-text"},"–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(H,null,W(t.activeFilters,(a,r)=>(c(),d("span",{key:r,class:"filter-badge"},[X(u(t.getFilterLabel(r))+": "+u(t.getFilterValue(r,a))+" ",1),n("button",{onClick:m=>t.clearFilter(r),class:"filter-badge-remove",title:"–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"}," √ó ",8,bs)]))),128)),n("button",{onClick:e[0]||(e[0]=(...a)=>t.handleReset&&t.handleReset(...a)),class:"btn-clear-all"}," –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ ")])):h("",!0),t.validationError?(c(),d("div",_s," ‚ö†Ô∏è "+u(t.validationError),1)):h("",!0),n("div",ws,[e[15]||(e[15]=n("span",{class:"quick-filters-label"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:",-1)),(c(!0),d(H,null,W(t.quickFilters,a=>(c(),d("button",{key:a.id,onClick:r=>t.applyQuickFilter(a.id),class:U(["quick-filter-btn",{active:t.activeQuickFilter===a.id}])},u(a.label),11,Cs))),128))]),n("div",ks,[n("div",Ss,[e[16]||(e[16]=n("label",{for:"category-filter"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è:",-1)),Z(n("select",{id:"category-filter","onUpdate:modelValue":e[1]||(e[1]=a=>t.localFilters.category=a),onChange:e[2]||(e[2]=a=>t.handleCategoryChange(t.localFilters.category)),class:"filter-select"},[(c(!0),d(H,null,W(t.categoryOptions,a=>(c(),d("option",{key:a.value,value:a.value},u(a.label),9,xs))),128))],544),[[Ae,t.localFilters.category]])]),n("div",Ms,[e[17]||(e[17]=n("label",{for:"event-filter"},"–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:",-1)),Z(n("select",{id:"event-filter","onUpdate:modelValue":e[3]||(e[3]=a=>t.localFilters.event=a),onChange:e[4]||(e[4]=a=>t.handleEventChange(t.localFilters.event)),class:"filter-select"},[(c(!0),d(H,null,W(t.eventOptions,a=>(c(),d("option",{key:a.value,value:a.value},u(a.label),9,As))),128))],544),[[Ae,t.localFilters.event]])]),n("div",Es,[e[18]||(e[18]=n("label",{for:"date-from-filter"},"–î–∞—Ç–∞ –æ—Ç:",-1)),Z(n("input",{id:"date-from-filter","onUpdate:modelValue":e[5]||(e[5]=a=>t.localFilters.dateFrom=a),type:"date",onChange:e[6]||(e[6]=a=>t.handleDateChange(t.localFilters.dateFrom,"dateFrom")),class:"filter-input"},null,544),[[Re,t.localFilters.dateFrom]])]),n("div",Ts,[e[19]||(e[19]=n("label",{for:"date-to-filter"},"–î–∞—Ç–∞ –¥–æ:",-1)),Z(n("input",{id:"date-to-filter","onUpdate:modelValue":e[7]||(e[7]=a=>t.localFilters.dateTo=a),type:"date",onChange:e[8]||(e[8]=a=>t.handleDateChange(t.localFilters.dateTo,"dateTo")),class:"filter-input"},null,544),[[Re,t.localFilters.dateTo]])]),n("div",Ls,[e[20]||(e[20]=n("label",{for:"ip-filter"},"IP –∞–¥—Ä–µ—Å:",-1)),Z(n("input",{id:"ip-filter","onUpdate:modelValue":e[9]||(e[9]=a=>t.localFilters.ip=a),type:"text",placeholder:"192.168.1.1",onInput:e[10]||(e[10]=(...a)=>t.handleFilterChange&&t.handleFilterChange(...a)),class:"filter-input"},null,544),[[Re,t.localFilters.ip]])]),n("div",Ds,[e[22]||(e[22]=n("label",{for:"status-filter"},"–°—Ç–∞—Ç—É—Å:",-1)),Z(n("select",{id:"status-filter","onUpdate:modelValue":e[11]||(e[11]=a=>t.localFilters.status=a),onChange:e[12]||(e[12]=(...a)=>t.handleFilterChange&&t.handleFilterChange(...a)),class:"filter-select"},[...e[21]||(e[21]=[n("option",{value:null},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),n("option",{value:"success"},"–£—Å–ø–µ—à–Ω–æ",-1),n("option",{value:"error"},"–û—à–∏–±–∫–∞",-1),n("option",{value:"warning"},"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",-1)])],544),[[Ae,t.localFilters.status]])]),n("div",Is,[n("button",{onClick:e[13]||(e[13]=(...a)=>t.handleReset&&t.handleReset(...a)),class:"btn-reset"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])])}const Ns=j(vs,[["render",Ps],["__scopeId","data-v-2a150a46"]]),Us={name:"WebhookLogList",props:{logs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null},pagination:{type:Object,default:null},selectedLogs:{type:Array,default:()=>[]}},emits:["select-log","page-change","update:selectedLogs"],setup(s,{emit:e}){const o=y(()=>!s.logs||!Array.isArray(s.logs)?(console.warn("[WebhookLogList] Invalid logs prop:",s.logs),[]):s.logs.map(w=>Ve(w)).filter(w=>_e(w)?!0:(console.warn("[WebhookLogList] Invalid log entry:",w),!1))),t=x("timestamp"),i=x("desc"),l=w=>{t.value===w?i.value=i.value==="asc"?"desc":"asc":(t.value=w,i.value="desc")},a=y(()=>!o.value||o.value.length===0?[]:[...o.value].sort((N,I)=>{let F,R;switch(t.value){case"timestamp":F=new Date(N.timestamp||0).getTime(),R=new Date(I.timestamp||0).getTime();break;case"event":F=(N.event||"").toLowerCase(),R=(I.event||"").toLowerCase();break;case"category":F=(N.category||"").toLowerCase(),R=(I.category||"").toLowerCase();break;case"ip":F=(N.ip||"").toLowerCase(),R=(I.ip||"").toLowerCase();break;default:return 0}return F<R?i.value==="asc"?-1:1:F>R?i.value==="asc"?1:-1:0})),r=w=>t.value!==w?"‚ÜïÔ∏è":i.value==="asc"?"‚Üë":"‚Üì",m=w=>w.category==="errors"?"status-error":"status-success",f=w=>w.category==="errors"?"‚ùå":"‚úÖ",g=w=>w.category==="errors"?"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏":"–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ",b=w=>`${w.timestamp}_${w.event}_${w.ip||"unknown"}`,L=w=>w?ct(w,"short"):"‚Äî",M=w=>w?ze(w):"‚Äî",C=w=>w?Me(w):"‚Äî",A=w=>!w||typeof w!="object"?"‚Äî":dt(w),P=w=>`category-${w}`,v=w=>w?.startsWith("ONTASK")?"event-task":w?.startsWith("ONCRMDYNAMIC")?"event-smart-process":"event-other",T=w=>{e("select-log",w)},E=w=>{w>=1&&w<=s.pagination.pages&&e("page-change",w)},V=w=>s.selectedLogs.some(N=>b(N)===b(w)),B=(w,N)=>{N.stopPropagation();const I=[...s.selectedLogs],F=b(w),R=I.findIndex(K=>b(K)===F);N.target.checked?R===-1&&I.push(w):R!==-1&&I.splice(R,1),e("update:selectedLogs",I)},D=w=>{w.target.checked?e("update:selectedLogs",[...s.logs]):e("update:selectedLogs",[])},p=y(()=>o.value.length>0&&o.value.every(w=>V(w)));return ge(()=>s.logs,w=>{if(w&&Array.isArray(w)){const N=w.filter(I=>!_e(I)).length;N>0&&console.warn(`[WebhookLogList] Received ${N} invalid log entries out of ${w.length}`)}},{immediate:!0}),{validatedLogs:o,sortBy:t,sortOrder:i,sortedLogs:a,handleSort:l,getSortIcon:r,getStatusClass:m,getStatusIcon:f,getStatusTitle:g,getLogId:b,formatTimestamp:L,formatEvent:M,formatCategoryLabel:C,formatDetailsPreview:A,getCategoryClass:P,getEventClass:v,handleLogClick:T,handlePageChange:E,isSelected:V,handleSelectLog:B,handleSelectAll:D,allSelected:p}}},Fs={class:"webhook-log-list"},Bs={key:0,class:"logs-table-container"},Rs={class:"logs-table"},Os={class:"checkbox-header"},Vs=["checked"],zs={class:"sort-icon"},Hs={class:"sort-icon"},js={class:"sort-icon"},Ws={class:"sort-icon"},qs=["onClick"],$s=["checked","onChange"],Xs=["title"],Ks={class:"details-preview"},Js=["onClick"],Gs={key:0,class:"pagination"},Ys=["disabled"],Qs={class:"pagination-info"},Zs=["disabled"];function ea(s,e,o,t,i,l){return c(),d("div",Fs,[o.logs.length>0?(c(),d("div",Bs,[n("table",Rs,[n("thead",null,[n("tr",null,[n("th",Os,[n("input",{type:"checkbox",checked:t.allSelected,onChange:e[0]||(e[0]=(...a)=>t.handleSelectAll&&t.handleSelectAll(...a)),onClick:e[1]||(e[1]=ae(()=>{},["stop"])),class:"checkbox-input",title:"–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"},null,40,Vs)]),n("th",{onClick:e[2]||(e[2]=a=>t.handleSort("timestamp")),class:U(["sortable",{"sort-asc":t.sortBy==="timestamp"&&t.sortOrder==="asc","sort-desc":t.sortBy==="timestamp"&&t.sortOrder==="desc"}])},[e[9]||(e[9]=X(" –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è ",-1)),n("span",zs,u(t.getSortIcon("timestamp")),1)],2),n("th",{onClick:e[3]||(e[3]=a=>t.handleSort("event")),class:U(["sortable",{"sort-asc":t.sortBy==="event"&&t.sortOrder==="asc","sort-desc":t.sortBy==="event"&&t.sortOrder==="desc"}])},[e[10]||(e[10]=X(" –¢–∏–ø —Å–æ–±—ã—Ç–∏—è ",-1)),n("span",Hs,u(t.getSortIcon("event")),1)],2),n("th",{onClick:e[4]||(e[4]=a=>t.handleSort("category")),class:U(["sortable",{"sort-asc":t.sortBy==="category"&&t.sortOrder==="asc","sort-desc":t.sortBy==="category"&&t.sortOrder==="desc"}])},[e[11]||(e[11]=X(" –ö–∞—Ç–µ–≥–æ—Ä–∏—è ",-1)),n("span",js,u(t.getSortIcon("category")),1)],2),n("th",{onClick:e[5]||(e[5]=a=>t.handleSort("ip")),class:U(["sortable",{"sort-asc":t.sortBy==="ip"&&t.sortOrder==="asc","sort-desc":t.sortBy==="ip"&&t.sortOrder==="desc"}])},[e[12]||(e[12]=X(" IP ",-1)),n("span",Ws,u(t.getSortIcon("ip")),1)],2),e[13]||(e[13]=n("th",null,"–î–µ—Ç–∞–ª–∏",-1)),e[14]||(e[14]=n("th",null,"–î–µ–π—Å—Ç–≤–∏—è",-1))])]),n("tbody",null,[(c(!0),d(H,null,W(t.sortedLogs,a=>(c(),d("tr",{key:t.getLogId(a),onClick:r=>t.handleLogClick(a),class:U(["log-row",{"row-selected":t.isSelected(a)}])},[n("td",{onClick:e[6]||(e[6]=ae(()=>{},["stop"]))},[n("input",{type:"checkbox",checked:t.isSelected(a),onChange:r=>t.handleSelectLog(a,r),class:"checkbox-input"},null,40,$s)]),n("td",null,u(t.formatTimestamp(a.timestamp)),1),n("td",null,[n("span",{class:U(["status-indicator",t.getStatusClass(a)]),title:t.getStatusTitle(a)},u(t.getStatusIcon(a)),11,Xs),n("span",{class:U(["event-badge",t.getEventClass(a.event)])},u(t.formatEvent(a.event)),3)]),n("td",null,[n("span",{class:U(["category-badge",t.getCategoryClass(a.category)])},u(t.formatCategoryLabel(a.category)),3)]),n("td",null,u(a.ip||"N/A"),1),n("td",null,[n("div",Ks,u(t.formatDetailsPreview(a.details)),1)]),n("td",null,[n("button",{onClick:ae(r=>t.handleLogClick(a),["stop"]),class:"btn-view"}," –ü—Ä–æ—Å–º–æ—Ç—Ä ",8,Js)])],10,qs))),128))])]),o.pagination&&o.pagination.pages>1?(c(),d("div",Gs,[n("button",{onClick:e[7]||(e[7]=a=>t.handlePageChange(o.pagination.page-1)),disabled:o.pagination.page<=1,class:"btn-pagination"}," –ù–∞–∑–∞–¥ ",8,Ys),n("span",Qs," –°—Ç—Ä–∞–Ω–∏—Ü–∞ "+u(o.pagination.page)+" –∏–∑ "+u(o.pagination.pages)+" (–≤—Å–µ–≥–æ: "+u(o.pagination.total)+") ",1),n("button",{onClick:e[8]||(e[8]=a=>t.handlePageChange(o.pagination.page+1)),disabled:o.pagination.page>=o.pagination.pages,class:"btn-pagination"}," –í–ø–µ—Ä—ë–¥ ",8,Zs)])):h("",!0)])):h("",!0)])}const ta=j(Us,[["render",ea],["__scopeId","data-v-fddd3018"]]),oa={name:"LoadingSkeleton",props:{width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"20px"},variant:{type:String,default:"rect",validator:s=>["rect","circle","text","table-row"].includes(s)},animated:{type:Boolean,default:!0},borderRadius:{type:String,default:null}},setup(s){return{skeletonStyle:y(()=>{const o={width:typeof s.width=="number"?`${s.width}px`:s.width,height:typeof s.height=="number"?`${s.height}px`:s.height};return s.borderRadius&&(o.borderRadius=s.borderRadius),o})}}},na={key:0,class:"skeleton-shimmer"};function sa(s,e,o,t,i,l){return c(),d("div",{class:U(["skeleton",[`skeleton-${o.variant}`,{"skeleton-animated":o.animated}]]),style:ie(t.skeletonStyle)},[o.animated?(c(),d("div",na)):h("",!0)],6)}const aa=j(oa,[["render",sa],["__scopeId","data-v-014f86e6"]]),ia={name:"SkeletonLogList",components:{LoadingSkeleton:aa},props:{rows:{type:Number,default:5}},setup(){return{getColumnWidth:e=>["40px","15%","20%","15%","15%","20%","15%"][e-1]||"100%"}}},ra={class:"skeleton-log-list"},la={class:"skeleton-table-header"};function ca(s,e,o,t,i,l){const a=q("LoadingSkeleton");return c(),d("div",ra,[n("div",la,[(c(),d(H,null,W(7,r=>Q(a,{key:r,width:"120px",height:"16px",variant:"text"})),64))]),(c(!0),d(H,null,W(o.rows,r=>(c(),d("div",{key:r,class:"skeleton-table-row"},[(c(),d(H,null,W(7,m=>Q(a,{key:m,width:"100%",height:"20px",variant:"text",style:ie({width:t.getColumnWidth(m)})},null,8,["style"])),64))]))),128))])}const da=j(ia,[["render",ca],["__scopeId","data-v-475c4e73"]]),ua={name:"EmptyState",props:{icon:{type:String,default:"üì≠"},title:{type:String,required:!0},description:{type:String,required:!0},actionLabel:{type:String,default:null},actions:{type:Array,default:null},hints:{type:Array,default:()=>[]},variant:{type:String,default:"default",validator:s=>["default","error","warning","info"].includes(s)}},emits:["action","action-click"]},ma={class:"empty-icon"},ga={class:"empty-title"},fa={class:"empty-description"},ha={key:0,class:"empty-hints"},va={key:1,class:"empty-actions"},ya=["onClick"];function pa(s,e,o,t,i,l){return c(),d("div",{class:U(["empty-state",`empty-state-${o.variant}`])},[n("div",ma,u(o.icon),1),n("h3",ga,u(o.title),1),n("p",fa,u(o.description),1),o.hints&&o.hints.length>0?(c(),d("div",ha,[(c(!0),d(H,null,W(o.hints,(a,r)=>(c(),d("div",{key:r,class:"hint-item"}," üí° "+u(a),1))),128))])):h("",!0),o.actionLabel||o.actions?(c(),d("div",va,[o.actionLabel?(c(),d("button",{key:0,onClick:e[0]||(e[0]=a=>s.$emit("action")),class:"btn-primary"},u(o.actionLabel),1)):h("",!0),(c(!0),d(H,null,W(o.actions,(a,r)=>(c(),d("button",{key:r,onClick:m=>s.$emit("action-click",a.id),class:U(["btn",`btn-${a.variant||"secondary"}`])},u(a.label),11,ya))),128))])):h("",!0)],2)}const ba=j(ua,[["render",pa],["__scopeId","data-v-081c13b9"]]),_a={name:"ErrorDisplay",props:{title:{type:String,default:"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"},message:{type:String,required:!0},details:{type:String,default:null},severity:{type:String,default:"error",validator:s=>["error","warning","critical"].includes(s)},retryable:{type:Boolean,default:!1}},emits:["retry"],setup(){return{showDetails:x(!1)}}},wa={class:"error-icon"},Ca={class:"error-content"},ka={class:"error-title"},Sa={class:"error-message"},xa={key:0,class:"error-details"},Ma={class:"error-actions"};function Aa(s,e,o,t,i,l){return c(),d("div",{class:U(["error-display",`error-${o.severity}`])},[n("div",wa,u(o.severity==="critical"?"üö®":"‚ö†Ô∏è"),1),n("div",Ca,[n("h4",ka,u(o.title),1),n("p",Sa,u(o.message),1),o.details&&t.showDetails?(c(),d("div",xa,[n("pre",null,u(o.details),1)])):h("",!0),n("div",Ma,[o.retryable?(c(),d("button",{key:0,onClick:e[0]||(e[0]=a=>s.$emit("retry")),class:"btn-retry"}," üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")):h("",!0),o.details?(c(),d("button",{key:1,onClick:e[1]||(e[1]=a=>t.showDetails=!t.showDetails),class:"btn-details"},u(t.showDetails?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å")+" –¥–µ—Ç–∞–ª–∏ ",1)):h("",!0)])])],2)}const Ea=j(_a,[["render",Aa],["__scopeId","data-v-3f2f4c14"]]),je=x([]);let Ta=0;function Et(){const s=(r,m="info",f=3e3)=>{const g=++Ta,b={id:g,message:r,type:m,duration:f,timestamp:Date.now()};return je.value.push(b),f>0&&setTimeout(()=>{e(g)},f),g},e=r=>{const m=je.value.findIndex(f=>f.id===r);m>-1&&je.value.splice(m,1)};return{notifications:je,showNotification:s,removeNotification:e,clearNotifications:()=>{je.value=[]},success:(r,m=3e3)=>s(r,"success",m),error:(r,m=5e3)=>s(r,"error",m),warning:(r,m=4e3)=>s(r,"warning",m),info:(r,m=3e3)=>s(r,"info",m)}}const La={name:"Notification",props:{notification:{type:Object,required:!0}},emits:["close"],setup(s,{emit:e}){const o=x(100),t=y(()=>s.notification.duration>0);let i=null;const l={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"},a=y(()=>l[s.notification.type]||"‚ÑπÔ∏è"),r=()=>{e("close")},m=()=>{s.notification.onClick&&s.notification.onClick()};return se(()=>{if(t.value&&s.notification.duration>0){const f=Date.now(),g=s.notification.duration;i=setInterval(()=>{const b=Date.now()-f;o.value=Math.max(0,100-b/g*100),o.value<=0&&(clearInterval(i),r())},50)}}),Qe(()=>{i&&clearInterval(i)}),{icon:a,progress:o,showProgress:t,close:r,handleClick:m}}},Da={class:"notification-content"},Ia={class:"notification-icon"},Pa={class:"notification-message"},Na={key:0,class:"notification-progress"};function Ua(s,e,o,t,i,l){return c(),d("div",{class:U(["notification",`notification-${o.notification.type}`]),onClick:e[1]||(e[1]=(...a)=>t.handleClick&&t.handleClick(...a))},[n("div",Da,[n("span",Ia,u(t.icon),1),n("span",Pa,u(o.notification.message),1)]),n("button",{onClick:e[0]||(e[0]=ae((...a)=>t.close&&t.close(...a),["stop"])),class:"notification-close"},"‚úï"),t.showProgress?(c(),d("div",Na,[n("div",{class:"progress-bar",style:ie({width:`${t.progress}%`})},null,4)])):h("",!0)],2)}const Fa=j(La,[["render",Ua],["__scopeId","data-v-1b602bdf"]]),Ba={name:"NotificationContainer",components:{Notification:Fa},setup(){const{notifications:s,removeNotification:e}=Et();return{notifications:s,removeNotification:e}}},Ra={class:"notification-container"};function Oa(s,e,o,t,i,l){const a=q("Notification");return c(),$(rt,{to:"body"},[n("div",Ra,[Q(Pt,{name:"notification",tag:"div"},{default:ue(()=>[(c(!0),d(H,null,W(t.notifications,r=>(c(),$(a,{key:r.id,notification:r,onClose:m=>t.removeNotification(r.id)},null,8,["notification","onClose"]))),128))]),_:1})])])}const Va=j(Ba,[["render",Oa],["__scopeId","data-v-dd8772c8"]]),za={name:"RealtimeControls",props:{enabled:{type:Boolean,default:!1},connectionState:{type:String,default:"disconnected"},error:{type:String,default:null}},emits:["toggle"],setup(s,{emit:e}){const o=x(s.enabled);ge(()=>s.enabled,b=>{o.value=b});const t=y(()=>s.connectionState==="connecting"),i=y(()=>!!s.error),l=y(()=>({"status-connected":s.connectionState==="connected","status-connecting":s.connectionState==="connecting","status-disconnected":s.connectionState==="disconnected","status-error":s.connectionState==="error"})),a=y(()=>{switch(s.connectionState){case"connected":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";case"connecting":return"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...";case"disconnected":return"–û—Ç–∫–ª—é—á–µ–Ω–æ";case"error":return"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}}),r=y(()=>a.value),m=y(()=>({"status-connected":s.connectionState==="connected","status-connecting":s.connectionState==="connecting","status-disconnected":s.connectionState==="disconnected","status-error":s.connectionState==="error"})),f=y(()=>s.error?typeof s.error=="string"?s.error:s.error.message?s.error.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞":null);return{localEnabled:o,isConnecting:t,hasError:i,statusClass:l,statusText:a,connectionStatusText:r,connectionStatusClass:m,displayError:f,handleToggle:()=>{e("toggle",o.value)}}}},Ha={class:"realtime-controls"},ja={class:"control-toggle"},Wa=["disabled"],qa={class:"status-text"},$a={key:0,class:"error-message"};function Xa(s,e,o,t,i,l){return c(),d("div",Ha,[n("label",ja,[Z(n("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=a=>t.localEnabled=a),onChange:e[1]||(e[1]=(...a)=>t.handleToggle&&t.handleToggle(...a)),disabled:t.isConnecting},null,40,Wa),[[it,t.localEnabled]]),e[2]||(e[2]=n("span",{class:"toggle-label"},"–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",-1))]),n("div",{class:U(["status-indicator",t.statusClass])},[e[3]||(e[3]=n("span",{class:"status-dot"},null,-1)),n("span",qa,u(t.statusText),1)],2),t.hasError&&t.displayError?(c(),d("div",$a," ‚ö†Ô∏è "+u(t.displayError),1)):h("",!0)])}const Ka=j(za,[["render",Xa],["__scopeId","data-v-af36f073"]]),Ja={name:"NewLogsIndicator",props:{count:{type:Number,default:0},newLogs:{type:Array,default:()=>[]}},emits:["apply","dismiss"],setup(s,{emit:e}){const o=(a,r,m,f)=>{const g=a%10,b=a%100;return b>=11&&b<=19?f:g===1?r:g>=2&&g<=4?m:f},t=y(()=>!s.newLogs||!Array.isArray(s.newLogs)||s.newLogs.length===0?[]:s.newLogs.map(r=>Ve(r)).filter(r=>_e(r)).slice(0,5).map(r=>({...r,formatted:{event:ze(r.event),category:Me(r.category)}})));return{pluralize:o,newLogsPreview:t,handleApply:()=>{if(!s.newLogs||s.newLogs.length===0)return;const a=s.newLogs.map(r=>Ve(r)).filter(r=>_e(r));if(a.length===0){console.warn("[NewLogsIndicator] No valid logs to apply");return}e("apply",a)},handleDismiss:()=>{e("dismiss")}}}},Ga={key:0,class:"new-logs-indicator"},Ya={class:"indicator-content"},Qa={class:"indicator-text"},Za={class:"indicator-actions"};function ei(s,e,o,t,i,l){return c(),$(Se,{name:"slide-down"},{default:ue(()=>[o.count>0?(c(),d("div",Ga,[n("div",Ya,[e[2]||(e[2]=n("span",{class:"indicator-icon"},"üîî",-1)),n("span",Qa,u(o.count)+" "+u(t.pluralize(o.count,"–Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è","–Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π")),1),n("div",Za,[n("button",{onClick:e[0]||(e[0]=(...a)=>t.handleApply&&t.handleApply(...a)),class:"btn-apply"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å "),n("button",{onClick:e[1]||(e[1]=(...a)=>t.handleDismiss&&t.handleDismiss(...a)),class:"btn-dismiss"}," ‚úï ")])])])):h("",!0)]),_:1})}const ti=j(Ja,[["render",ei],["__scopeId","data-v-19791dbc"]]);class oi{constructor(e,o={}){this.url=e,this.options={reconnectInterval:3e3,maxReconnectAttempts:10,reconnectDelay:1e3,lastTimestamp:null,...o},this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.reconnectTimer=null,this.isManualDisconnect=!1,this.connectionState="disconnected"}updateOptions(e){this.options={...this.options,...e}}connect(){if(this.connectionState==="connected"||this.connectionState==="connecting"){console.warn("[RealtimeService] Already connected or connecting");return}this.isManualDisconnect=!1,this.connectionState="connecting",this.notifyListeners("state-change",{state:this.connectionState});try{let e=this.url;if(!e.startsWith("http://")&&!e.startsWith("https://")){const o=new URL(e,window.location.origin);this.options.lastTimestamp&&o.searchParams.set("last_timestamp",this.options.lastTimestamp),e=o.toString()}else{const o=new URL(e);this.options.lastTimestamp&&o.searchParams.set("last_timestamp",this.options.lastTimestamp),e=o.toString()}console.log("[RealtimeService] Connecting to:",e),this.eventSource=new EventSource(e),this.eventSource.onopen=()=>{console.log("[RealtimeService] EventSource opened"),this.notifyListeners("open",{timestamp:new Date().toISOString()})},this.eventSource.onmessage=o=>{try{const t=JSON.parse(o.data);this.notifyListeners("message",t)}catch(t){console.error("[RealtimeService] Error parsing message:",t)}},this.eventSource.addEventListener("connected",o=>{try{const t=JSON.parse(o.data);console.log("[RealtimeService] Connected event received:",t),this.connectionState="connected",this.reconnectAttempts=0,this.notifyListeners("connected",t),this.notifyListeners("state-change",{state:this.connectionState})}catch(t){console.error("[RealtimeService] Error parsing connected event:",t)}}),this.eventSource.addEventListener("new_logs",o=>{const t=JSON.parse(o.data);if(t.logs&&t.logs.length>0){const i=t.logs[t.logs.length-1];i.timestamp&&(this.options.lastTimestamp=i.timestamp)}this.notifyListeners("new_logs",t)}),this.eventSource.addEventListener("error",o=>{try{const t=JSON.parse(o.data);this.notifyListeners("error",t)}catch{this.notifyListeners("error",{message:"Server error"})}}),this.eventSource.addEventListener("timeout",o=>{try{const t=JSON.parse(o.data);this.notifyListeners("timeout",t)}catch{this.notifyListeners("timeout",{message:"Connection timeout"})}this.reconnect()}),this.eventSource.addEventListener("closed",o=>{try{const t=JSON.parse(o.data);this.notifyListeners("closed",t)}catch{this.notifyListeners("closed",{message:"Connection closed"})}this.isManualDisconnect||this.reconnect()}),this.eventSource.onerror=o=>{console.error("[RealtimeService] Connection error:",o),console.error("[RealtimeService] EventSource readyState:",this.eventSource?.readyState),this.eventSource?.readyState===EventSource.CLOSED?(console.log("[RealtimeService] EventSource closed by server"),this.connectionState="disconnected",this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()):this.eventSource?.readyState===EventSource.CONNECTING?console.log("[RealtimeService] Still connecting..."):(this.connectionState="error",this.notifyListeners("error",{error:o,type:"connection",message:"Failed to connect to realtime stream",readyState:this.eventSource?.readyState}),this.notifyListeners("state-change",{state:this.connectionState}),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isManualDisconnect||this.reconnect())}}catch(e){console.error("[RealtimeService] Error creating EventSource:",e),this.connectionState="error",this.notifyListeners("error",{error:e,type:"initialization"}),this.notifyListeners("state-change",{state:this.connectionState}),this.isManualDisconnect||this.reconnect()}}reconnect(){if(this.isManualDisconnect)return;if(this.reconnectAttempts>=this.options.maxReconnectAttempts){console.error("[RealtimeService] Max reconnect attempts reached"),this.notifyListeners("max-reconnect-attempts",{attempts:this.reconnectAttempts});return}this.reconnectAttempts++;const e=Math.min(this.options.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.options.reconnectInterval);console.log(`[RealtimeService] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},e)}disconnect(){this.isManualDisconnect=!0,this.connectionState="disconnected",this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.notifyListeners("disconnected",{timestamp:new Date().toISOString()}),this.notifyListeners("state-change",{state:this.connectionState})}on(e,o){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(o)}off(e,o){if(this.listeners.has(e)){const t=this.listeners.get(e),i=t.indexOf(o);i>-1&&t.splice(i,1)}}notifyListeners(e,o){this.listeners.has(e)&&this.listeners.get(e).forEach(t=>{try{t(o)}catch(i){console.error(`[RealtimeService] Error in listener for ${e}:`,i)}})}getState(){return this.connectionState}isConnected(){return this.connectionState==="connected"}}function ni(s,e={}){const{autoConnect:o=!1,enableSound:t=!1,onNewLogs:i=null,validateLogs:l=!0}=e,a=new oi(s,e),r=x("disconnected"),m=x([]),f=x(0),g=x(null),b=x(null),L=x(0),M=y(()=>r.value==="connected"),C=y(()=>r.value==="connecting"),A=y(()=>r.value==="error"),P=y(()=>f.value>0),v=F=>{r.value=F.state,F.state==="connected"&&(L.value=0,b.value=null)},T=F=>{let R=F.logs||[];if(l){R=lt(R);const K=R.filter(me=>_e(me));K.length!==R.length&&console.warn("[useRealtime] Filtered out invalid logs:",R.length-K.length),R=K}R.length!==0&&(m.value.push(...R),f.value+=R.length,g.value=new Date().toISOString(),t&&R.length>0&&I(),i&&i(R))},E=F=>{const R=F.message||F.error?.message||"Connection error";b.value=R,r.value="error",console.error("[useRealtime] Error:",F)},V=F=>{console.warn("[useRealtime] Connection timeout:",F)},B=F=>{b.value=`Max reconnect attempts reached (${F.attempts})`,console.error("[useRealtime] Max reconnect attempts:",F)},D=(F={})=>{b.value=null,F.lastTimestamp!==void 0&&a.updateOptions({lastTimestamp:F.lastTimestamp}),a.on("state-change",v),a.on("new_logs",T),a.on("error",E),a.on("timeout",V),a.on("max-reconnect-attempts",B),a.connect()},p=()=>{a.off("state-change",v),a.off("new_logs",T),a.off("error",E),a.off("timeout",V),a.off("max-reconnect-attempts",B),a.disconnect()},w=()=>{m.value=[],f.value=0},N=F=>{F&&Array.isArray(F)&&(F.unshift(...m.value),w())},I=()=>{try{const F=new Audio("/sounds/notification.mp3");F.volume=.3,F.play().catch(R=>{console.warn("[useRealtime] Failed to play sound:",R)})}catch(F){console.warn("[useRealtime] Sound not available:",F)}};return o&&se(()=>{D()}),Qe(()=>{p()}),{connectionState:r,isConnected:M,isConnecting:C,hasError:A,newLogs:m,newLogsCount:f,hasNewLogs:P,lastUpdateTime:g,error:b,reconnectAttempts:L,connect:D,disconnect:p,clearNewLogs:w,applyNewLogs:N}}const si=at(()=>ce(()=>import("./WebhookLogsDashboard.vue-BMR5RJv3.js"),__vite__mapDeps([6,4,1,5,2]),import.meta.url)),ai=at(()=>ce(()=>import("./WebhookLogDetails.vue-CoeZXZLH.js"),__vite__mapDeps([7,4,1,5,2]),import.meta.url)),ii={name:"WebhookLogsPage",components:{WebhookLogsDashboard:si,WebhookLogsExport:is,WebhookLogSearch:fs,WebhookLogFilters:Ns,WebhookLogList:ta,WebhookLogDetails:ai,SkeletonLogList:da,EmptyState:ba,ErrorDisplay:Ea,NotificationContainer:Va,RealtimeControls:Ka,NewLogsIndicator:ti},setup(){const s=Ne(),{success:e,error:o}=Et(),t=x(!1),i=x(!1),l=x(null),a=x(null),r=x([]),m=(k,_=2)=>{if(k==null)return String(k);if(typeof k=="string")return k;const z=(O,G=0)=>{if(G>10)return"[Max Depth]";if(O==null||typeof O!="object")return O;if(Array.isArray(O))return O.map(oe=>z(oe,G+1));const te={};try{for(const oe in O)if(Object.prototype.hasOwnProperty.call(O,oe))try{const $e=O[oe];if(typeof $e=="function"||$e===void 0)continue;te[oe]=z($e,G+1)}catch{te[oe]="[Error reading property]"}}catch{return"[Error reading object]"}return te};try{const O=z(k),G=new WeakSet;return JSON.stringify(O,(te,oe)=>{if(typeof oe=="object"&&oe!==null){if(G.has(oe))return"[Circular]";G.add(oe)}return oe},_)}catch(O){return console.error("[WebhookLogsPage] Error in safeStringify:",O),`[Error: ${O.message}]`}},f=x(null),g=x([]),b=x(""),L=x(null),M=x(null),C=x(!1),{connectionState:A,newLogsCount:P,error:v,connect:T,disconnect:E,applyNewLogs:V,clearNewLogs:B}=ni(be("/api/webhook-realtime.php"),{autoConnect:!1,enableSound:!0,validateLogs:!0,onNewLogs:k=>{console.log("[WebhookLogsPage] New logs received:",k.length),k.length>0&&(r.value.unshift(...k),N.value.total+=k.length,e(`–ü–æ–ª—É—á–µ–Ω–æ ${k.length} –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π`))}}),{filters:D,updateFilters:p,clearFilters:w}=pn(),N=x({page:1,limit:50,total:0,pages:0}),I=y(()=>{let k=[...r.value];return b.value&&b.value.trim()&&(k=bn(k,b.value,{caseSensitive:!1,searchInEvent:!0,searchInPayload:!0,searchInDetails:!0,searchInIp:!0})),D.value.category&&(k=k.filter(_=>_.category===D.value.category)),D.value.event&&(k=k.filter(_=>_.event===D.value.event)),D.value.ip&&(k=k.filter(_=>_.ip&&_.ip.includes(D.value.ip))),D.value.status&&(k=k.filter(_=>D.value.status==="error"?_.category==="errors":D.value.status==="success"?_.category!=="errors":!0)),D.value.dateFrom&&(k=k.filter(_=>_.timestamp?new Date(_.timestamp).toISOString().split("T")[0]>=D.value.dateFrom:!1)),D.value.dateTo&&(k=k.filter(_=>_.timestamp?new Date(_.timestamp).toISOString().split("T")[0]<=D.value.dateTo:!1)),D.value.hour!==null&&(k=k.filter(_=>_.timestamp?new Date(_.timestamp).getHours()===D.value.hour:!1)),k});ge(I,k=>{L.value&&b.value&&L.value.setResultsCount(k.length)});const F=async()=>{try{await xe.init();const k=await xe.getCurrentUser();if(console.log("[WebhookLogsPage] User data:",k),!k||!k.ID){console.warn("[WebhookLogsPage] User not determined"),a.value=m({error:"User not determined",userId:k?.ID||null,userName:k?`${k.NAME||""} ${k.LAST_NAME||""}`.trim():null}),t.value=!1;return}const _=k?.UF_DEPARTMENT||[];if(console.log("[WebhookLogsPage] User departments:",_),console.log("[WebhookLogsPage] Allowed departments:",Fe.allowedDepartmentIds),_.length>0){const z=_.some(O=>xt(O));console.log("[WebhookLogsPage] Has access:",z),t.value=z,z||(a.value=m({userId:k.ID,userName:`${k.NAME||""} ${k.LAST_NAME||""}`.trim(),userDepartments:_,allowedDepartments:Fe.allowedDepartmentIds,message:"User departments do not match allowed departments"}))}else console.warn("[WebhookLogsPage] User has no departments"),a.value=m({userId:k.ID,userName:`${k.NAME||""} ${k.LAST_NAME||""}`.trim(),userDepartments:[],allowedDepartments:Fe.allowedDepartmentIds,message:"User has no departments assigned"}),t.value=!1}catch(k){console.error("[WebhookLogsPage] Error checking access:",k),a.value=m({error:k.message,stack:k.stack}),t.value=!1}},R=y(()=>Fe.allowedDepartmentIds.join(", ")),K=async(k=!1)=>{if(t.value&&!(le&&!k)){le=!0,i.value=!0,l.value=null;try{const _=new Date().toISOString().split("T")[0],z={category:D.value.category||null,event:D.value.event||null,date:D.value.dateFrom||_,hour:D.value.hour!==null&&D.value.hour!==void 0?D.value.hour:null,ip:D.value.ip||null,status:D.value.status||null,dateFrom:D.value.dateFrom||_,dateTo:D.value.dateTo||null};if(!st(z))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");console.log("[WebhookLogsPage] Loading logs with filters:",z);const O=await pt.getLogs(z,N.value.page,N.value.limit,k);if(console.log("[WebhookLogsPage] API result:",O),console.log("[WebhookLogsPage] Logs count:",O?.logs?.length||0),console.log("[WebhookLogsPage] Pagination:",O?.pagination),!O.success)throw new Error(O.error||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤");_n(O.pagination)?N.value=O.pagination:(console.warn("[WebhookLogsPage] Invalid pagination format, using defaults"),N.value={page:N.value.page,limit:N.value.limit,total:O.logs.length,pages:Math.ceil(O.logs.length/N.value.limit)});const G=lt(O.logs),te=G.filter(oe=>_e(oe));te.length!==G.length&&console.warn("[WebhookLogsPage] Filtered out invalid logs:",G.length-te.length),r.value=te,k&&e("–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")}catch(_){me(_)}finally{i.value=!1,le=!1}}},me=k=>{console.error("[WebhookLogsPage] API Error:",k),k.status===403?(l.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",o("–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º –≤–µ–±—Ö—É–∫–æ–≤")):k.status===404?(l.value="–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",o("–õ–æ–≥–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")):k.status>=500?(l.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",o("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")):(l.value=k.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",o(l.value)),k.status>=500&&(r.value=[])},Ee=k=>{b.value=k,p({search:k||null})};let le=!1;const we=k=>{if(!st(k)){o("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏");return}const _={category:D.value.category,event:D.value.event,dateFrom:D.value.dateFrom,dateTo:D.value.dateTo,hour:D.value.hour,ip:D.value.ip,status:D.value.status},z={category:k?.category||null,event:k?.event||null,dateFrom:k?.dateFrom||null,dateTo:k?.dateTo||null,hour:k?.hour!==void 0?k.hour:null,ip:k?.ip||null,status:k?.status||null},O=Object.keys(z).some(G=>{const te=_[G],oe=z[G];return te!==oe});if(!(!O&&!le)){if(p(z),N.value.page=1,O)try{pt.invalidateCacheOnFilterChange(_,z)}catch(G){console.error("[WebhookLogsPage] Error invalidating cache:",G)}le||(le=!0,K(!0).finally(()=>{le=!1}))}},S=()=>{w(),b.value="",N.value.page=1,K()},J=k=>{f.value=k},Ce=()=>{f.value=null},Te=k=>{N.value.page=k,K()},ye=()=>{try{s.push("/")}catch(k){console.error("Navigation error:",k),window.location.hash="#/"}},Ue=k=>{g.value=k},Le=k=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—á–∞—Ç:",k)},Ze=k=>{console.log("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω:",k),e(`–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω: ${k.count} –∑–∞–ø–∏—Å–µ–π –≤ —Ñ–∞–π–ª–µ ${k.filename}`)},et=k=>{console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:",k),o(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${k.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`)},mt=()=>{b.value="",S()},gt=k=>{if(console.log("[WebhookLogsPage] Toggle auto-update:",k),C.value=k,k){let _=null;if(r.value.length>0){const z=r.value[0];z.timestamp&&(_=z.timestamp,console.log("[WebhookLogsPage] Using lastTimestamp:",_))}T({lastTimestamp:_})}else E()},ft=()=>{V(r.value),e("–ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã")},ht=()=>{B()};return se(async()=>{await F(),t.value&&(D.value.search&&(b.value=D.value.search),await K())}),{hasAccess:t,loading:i,error:l,logs:r,filteredLogs:I,selectedLog:f,selectedLogs:g,filters:D,searchQuery:b,searchComponent:L,pagination:N,previousPeriodStats:M,handleFiltersUpdate:we,handleFiltersReset:S,handleSearch:Ee,handleLogSelect:J,handleLogClose:Ce,handlePageChange:Te,handleSelectedLogsUpdate:Ue,handleExportStart:Le,handleExportComplete:Ze,handleExportError:et,handleClearSearch:mt,autoUpdateEnabled:C,connectionState:A,newLogsCount:P,realtimeError:v,handleToggleAutoUpdate:gt,handleApplyNewLogs:ft,handleDismissNewLogs:ht,allowedDepartmentsText:R,accessDebugInfo:a,goBack:ye}}},ri={class:"webhook-logs-page"},li={class:"page-header"},ci={class:"page-header-top"},di={key:0,class:"access-denied"},ui={class:"access-denied-content"},mi={class:"access-hint"},gi={key:0,class:"access-debug"},fi={key:1,class:"page-content"},hi={class:"actions-bar"};function vi(s,e,o,t,i,l){const a=q("WebhookLogsDashboard"),r=q("WebhookLogsExport"),m=q("WebhookLogSearch"),f=q("RealtimeControls"),g=q("NewLogsIndicator"),b=q("WebhookLogFilters"),L=q("SkeletonLogList"),M=q("WebhookLogList"),C=q("EmptyState"),A=q("ErrorDisplay"),P=q("WebhookLogDetails"),v=q("NotificationContainer");return c(),d("div",ri,[n("div",li,[n("div",ci,[n("button",{onClick:e[0]||(e[0]=(...T)=>t.goBack&&t.goBack(...T)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[3]||(e[3]=[n("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),n("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[4]||(e[4]=n("h1",null,"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ Bitrix24",-1))]),t.hasAccess?(c(),d("div",fi,[Q(a,{logs:t.logs,pagination:t.pagination,"previous-period-stats":t.previousPeriodStats},null,8,["logs","pagination","previous-period-stats"]),n("div",hi,[Q(r,{logs:t.filteredLogs,"selected-logs":t.selectedLogs,filters:t.filters,"total-count":t.filteredLogs.length,onExportStart:t.handleExportStart,onExportComplete:t.handleExportComplete,onExportError:t.handleExportError},null,8,["logs","selected-logs","filters","total-count","onExportStart","onExportComplete","onExportError"]),Q(m,{modelValue:t.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=T=>t.searchQuery=T),onSearch:t.handleSearch,ref:"searchComponent"},null,8,["modelValue","onSearch"])]),Q(f,{enabled:t.autoUpdateEnabled,"connection-state":t.connectionState,error:t.realtimeError,onToggle:t.handleToggleAutoUpdate},null,8,["enabled","connection-state","error","onToggle"]),Q(g,{count:t.newLogsCount,onApply:t.handleApplyNewLogs,onDismiss:t.handleDismissNewLogs},null,8,["count","onApply","onDismiss"]),Q(b,{filters:t.filters,"onUpdate:filters":t.handleFiltersUpdate,onReset:t.handleFiltersReset},null,8,["filters","onUpdate:filters","onReset"]),Q(Se,{name:"fade"},{default:ue(()=>[t.loading&&t.logs.length===0?(c(),$(L,{key:0,rows:5})):h("",!0)]),_:1}),Q(Se,{name:"fade"},{default:ue(()=>[!t.loading&&t.filteredLogs.length>0?(c(),$(M,{key:0,logs:t.filteredLogs,loading:!1,error:null,pagination:t.pagination,"selected-logs":t.selectedLogs,onSelectLog:t.handleLogSelect,onPageChange:t.handlePageChange,"onUpdate:selectedLogs":t.handleSelectedLogsUpdate},null,8,["logs","pagination","selected-logs","onSelectLog","onPageChange","onUpdate:selectedLogs"])):h("",!0)]),_:1}),Q(Se,{name:"fade"},{default:ue(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length===0?(c(),$(C,{key:0,icon:"üì≠",title:"–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",description:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç Bitrix24.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è","–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã",onAction:t.handleFiltersReset},null,8,["onAction"])):h("",!0)]),_:1}),Q(Se,{name:"fade"},{default:ue(()=>[!t.loading&&t.filteredLogs.length===0&&!t.error&&t.logs.length>0?(c(),$(C,{key:0,icon:"üîç",title:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",description:"–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã.",hints:["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞","–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã","–û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"],"action-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫",onAction:t.handleClearSearch},null,8,["onAction"])):h("",!0)]),_:1}),Q(Se,{name:"fade"},{default:ue(()=>[t.error?(c(),$(A,{key:0,title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤",message:t.error,retryable:!0,onRetry:s.loadLogs},null,8,["message","onRetry"])):h("",!0)]),_:1}),t.selectedLog?(c(),d("div",{key:0,class:"modal-overlay",onClick:e[2]||(e[2]=(...T)=>t.handleLogClose&&t.handleLogClose(...T))})):h("",!0),Q(Se,{name:"modal"},{default:ue(()=>[t.selectedLog?(c(),$(P,{key:0,log:t.selectedLog,onClose:t.handleLogClose},null,8,["log","onClose"])):h("",!0)]),_:1})])):(c(),d("div",di,[n("div",ui,[e[7]||(e[7]=n("h2",null,"–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",-1)),e[8]||(e[8]=n("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤.",-1)),n("p",mi,[e[5]||(e[5]=X(" –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ –æ—Ç–¥–µ–ª–æ–≤: ",-1)),n("strong",null,u(t.allowedDepartmentsText),1)]),e[9]||(e[9]=n("p",{class:"access-hint"}," –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã. ",-1)),t.accessDebugInfo?(c(),d("details",gi,[e[6]||(e[6]=n("summary",null,"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",-1)),n("pre",null,u(t.accessDebugInfo),1)])):h("",!0)])])),Q(v)])}const yi=j(ii,[["render",vi],["__scopeId","data-v-628bf174"]]),pi={name:"DrillDownNavigation",props:{breadcrumbs:{type:Array,default:()=>[],validator:s=>Array.isArray(s)&&s.every(e=>typeof e=="object"&&typeof e.id=="string"&&typeof e.label=="string")},separator:{type:String,default:">"},showBackButton:{type:Boolean,default:!0},additionalActions:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},maxLabelLength:{type:Number,default:30}},emits:["navigate","back","action"],setup(s,{emit:e}){const o=y(()=>s.breadcrumbs.map(m=>({...m,label:i(m.label,s.maxLabelLength)}))),t=y(()=>{const m=o.value;return m.length<=5?m:[m[0],{id:"ellipsis-start",label:"...",isEllipsis:!0},...m.slice(-3)]}),i=(m,f)=>m.length<=f?m:m.substring(0,f-3)+"...";return{visibleBreadcrumbs:t,handleNavigate:m=>{m.action&&e("navigate",m)},handleBack:()=>{e("back")},handleAction:m=>{e("action",m)}}}},bi={class:"drilldown-navigation",role:"navigation","aria-label":"–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"},_i={class:"breadcrumb-list"},wi={key:0,class:"breadcrumb-separator","aria-hidden":"true"},Ci=["onClick","onKeydown","aria-label","title"],ki={class:"breadcrumb-text"},Si={key:2,class:"breadcrumb-current-text","aria-current":"page"},xi={class:"breadcrumb-text"},Mi={key:3,class:"breadcrumb-loading","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"},Ai=["aria-label","title"],Ei={key:1,class:"breadcrumb-actions"},Ti=["onClick","onKeydown","aria-label","title","disabled"],Li={key:1,class:"action-text"};function Di(s,e,o,t,i,l){return c(),d("nav",bi,[n("ol",_i,[(c(!0),d(H,null,W(o.breadcrumbs,(a,r)=>(c(),d("li",{key:a.id,class:U(["breadcrumb-item",{"breadcrumb-current":r===o.breadcrumbs.length-1,"breadcrumb-interactive":r<o.breadcrumbs.length-1}])},[r>0?(c(),d("span",wi,u(o.separator),1)):h("",!0),r<o.breadcrumbs.length-1&&a.action?(c(),d("button",{key:1,class:"breadcrumb-link",onClick:m=>t.handleNavigate(a),onKeydown:[ee(m=>t.handleNavigate(a),["enter"]),ee(m=>t.handleNavigate(a),["space"])],"aria-label":`–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–∞–∑–¥–µ–ª—É ${a.label}`,title:`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${a.label}`},[a.icon?(c(),$(Ie(a.icon),{key:0,class:"breadcrumb-icon","aria-hidden":"true"})):h("",!0),n("span",ki,u(a.label),1)],40,Ci)):(c(),d("span",Si,[a.icon?(c(),$(Ie(a.icon),{key:0,class:"breadcrumb-icon","aria-hidden":"true"})):h("",!0),n("span",xi,u(a.label),1)])),r===o.breadcrumbs.length-1&&o.isLoading?(c(),d("div",Mi,[...e[3]||(e[3]=[n("div",{class:"loading-spinner","aria-hidden":"true"},null,-1)])])):h("",!0)],2))),128))]),o.showBackButton&&o.breadcrumbs.length>1?(c(),d("button",{key:0,class:"back-button",onClick:e[0]||(e[0]=(...a)=>t.handleBack&&t.handleBack(...a)),onKeydown:[e[1]||(e[1]=ee((...a)=>t.handleBack&&t.handleBack(...a),["enter"])),e[2]||(e[2]=ee((...a)=>t.handleBack&&t.handleBack(...a),["space"]))],"aria-label":`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${o.breadcrumbs[o.breadcrumbs.length-2]?.label||"–ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Ä–∞–∑–¥–µ–ª—É"}`,title:`–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ ${o.breadcrumbs[o.breadcrumbs.length-2]?.label||"–ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Ä–∞–∑–¥–µ–ª—É"}`},[...e[4]||(e[4]=[n("svg",{class:"back-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[n("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})],-1),n("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])],40,Ai)):h("",!0),o.additionalActions.length>0?(c(),d("div",Ei,[(c(!0),d(H,null,W(o.additionalActions,a=>(c(),d("button",{key:a.id,class:U(["action-button",a.class]),onClick:r=>t.handleAction(a),onKeydown:[ee(r=>t.handleAction(a),["enter"]),ee(r=>t.handleAction(a),["space"])],"aria-label":a.label,title:a.title||a.label,disabled:a.disabled},[a.icon?(c(),$(Ie(a.icon),{key:0,class:"action-icon","aria-hidden":"true"})):h("",!0),a.text?(c(),d("span",Li,u(a.text),1)):h("",!0)],42,Ti))),128))])):h("",!0)])}const Ii=j(pi,[["render",Di],["__scopeId","data-v-e0da3deb"]]),Pi={name:"MetricCard",emits:["click"],props:{metric:{type:Object,default:()=>({})},title:{type:String,required:!0},value:{type:[Number,String],required:!0},unit:{type:String,default:""},subtitle:{type:String,default:""},icon:{type:String,default:""},trend:{type:Number,default:null},trendPeriod:{type:String,default:""},progress:{type:Number,default:null},size:{type:String,default:"medium",validator:s=>["small","medium","large","compact"].includes(s)},interactive:{type:Boolean,default:!1}},computed:{formattedValue(){return typeof this.value=="number"?this.value>=1e6?`${(this.value/1e6).toFixed(1)}M`:this.value>=1e3?`${(this.value/1e3).toFixed(1)}K`:this.value.toLocaleString():this.value}}},Ni={class:"metric-header"},Ui=["innerHTML"],Fi={class:"metric-title"},Bi={class:"metric-value-section"},Ri={class:"metric-value"},Oi={key:0,class:"metric-unit"},Vi={key:0,class:"metric-subtitle"},zi={key:1,class:"metric-trend"},Hi={class:"trend-indicator"},ji={key:0,viewBox:"0 0 24 24",width:"12",height:"12"},Wi={key:1,viewBox:"0 0 24 24",width:"12",height:"12"},qi={key:2,viewBox:"0 0 24 24",width:"12",height:"12"},$i={class:"trend-value"},Xi={class:"trend-period"},Ki={key:2,class:"metric-progress"},Ji={class:"progress-bar"},Gi={class:"progress-text"};function Yi(s,e,o,t,i,l){return c(),d("div",{class:U(["metric-card",{[`size-${o.size}`]:!0,"has-trend":o.trend!==null,"trend-up":o.trend>0,"trend-down":o.trend<0,"trend-neutral":o.trend===0,interactive:o.interactive}]),onClick:e[0]||(e[0]=a=>o.interactive?s.$emit("click",o.metric):null)},[n("div",Ni,[o.icon?(c(),d("div",{key:0,class:"metric-icon",innerHTML:o.icon},null,8,Ui)):h("",!0),n("div",Fi,u(o.title),1)]),n("div",Bi,[n("div",Ri,u(l.formattedValue),1),o.unit?(c(),d("div",Oi,u(o.unit),1)):h("",!0)]),o.subtitle?(c(),d("div",Vi,u(o.subtitle),1)):h("",!0),o.trend!==null?(c(),d("div",zi,[n("div",Hi,[o.trend>0?(c(),d("svg",ji,[...e[1]||(e[1]=[n("path",{d:"M7 14l5-5 5 5z",fill:"currentColor"},null,-1)])])):o.trend<0?(c(),d("svg",Wi,[...e[2]||(e[2]=[n("path",{d:"M7 10l5 5 5-5z",fill:"currentColor"},null,-1)])])):(c(),d("svg",qi,[...e[3]||(e[3]=[n("path",{d:"M7 12h10v-2H7z",fill:"currentColor"},null,-1)])]))]),n("span",$i,u(Math.abs(o.trend))+"%",1),n("span",Xi,u(o.trendPeriod||"vs prev"),1)])):h("",!0),o.progress!==null?(c(),d("div",Ki,[n("div",Ji,[n("div",{class:"progress-fill",style:ie({width:`${Math.min(o.progress,100)}%`})},null,4)]),n("span",Gi,u(o.progress)+"%",1)])):h("",!0)],2)}const Qi=j(Pi,[["render",Yi],["__scopeId","data-v-b8d66bef"]]),Zi={name:"ContextSidebar",components:{MetricCard:Qi},props:{context:{type:String,default:"global",validator:s=>["global","user","management"].includes(s)},selectedUser:{type:Object,default:null},selectedUsers:{type:Array,default:()=>[]},globalMetrics:{type:Array,default:()=>[]},userStats:{type:Object,default:()=>({})},userFilters:{type:Object,default:()=>({timeRange:"week",activity_types:[]})},filterPresets:{type:Array,default:()=>[]},activePreset:{type:String,default:null},recentActivity:{type:Array,default:()=>[]},auditLog:{type:Array,default:()=>[]},activityTypes:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},collapsed:{type:Boolean,default:!1},canEditPermissions:{type:Boolean,default:!1}},emits:["toggle-collapse","metric-click","filter-preset-apply","activity-click","filter-change","view-profile","export-data","edit-permissions","bulk-action","user-select"],setup(s,{emit:e}){const o=x(s.collapsed),t=y(()=>{if(!s.selectedUser?.name)return"";const[E,V]=s.selectedUser.name.split(" ");return`${E?.[0]||""}${V?.[0]||""}`.toUpperCase()}),i=()=>{o.value=!o.value,e("toggle-collapse",o.value)},l=()=>{switch(s.context){case"global":return"–û–±–∑–æ—Ä";case"user":return"–ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è";case"management":return"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ";default:return"–û–±–∑–æ—Ä"}},a=()=>`${l()} - –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π`,r=E=>{switch(E){case"online":return"–û–Ω–ª–∞–π–Ω";case"away":return"–û—Ç–æ—à—ë–ª";case"offline":return"–û—Ñ—Ñ–ª–∞–π–Ω";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}},m=E=>{if(!E)return"";const[V,B]=E.split(" ");return`${V?.[0]||""}${B?.[0]||""}`.toUpperCase()},f=E=>{const V=Math.floor(E/60),B=E%60;return`${V}:${B.toString().padStart(2,"0")}`},g=E=>{const V=new Date(E),D=new Date-V,p=Math.floor(D/(1e3*60)),w=Math.floor(D/(1e3*60*60)),N=Math.floor(D/(1e3*60*60*24));return p<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":p<60?`${p} –º–∏–Ω –Ω–∞–∑–∞–¥`:w<24?`${w} —á –Ω–∞–∑–∞–¥`:N<7?`${N} –¥ –Ω–∞–∑–∞–¥`:V.toLocaleDateString()},b=E=>{e("metric-click",E)},L=E=>{e("filter-preset-apply",E)},M=E=>{e("activity-click",E)},C=()=>{e("filter-change",s.userFilters)},A=()=>{e("view-profile",s.selectedUser)},P=()=>{e("export-data",s.selectedUser)},v=()=>{e("edit-permissions",s.selectedUser)},T=E=>{e("bulk-action",{action:E,users:s.selectedUsers})};return ge(()=>s.collapsed,E=>{o.value=E}),{isCollapsed:o,userInitials:t,toggleCollapse:i,getContextTitle:l,getAriaLabel:a,getStatusText:r,getUserInitials:m,formatDuration:f,formatTime:g,handleMetricClick:b,applyFilterPreset:L,handleActivityClick:M,handleFilterChange:C,viewDetailedProfile:A,exportUserData:P,editPermissions:v,performBulkAction:T}}},er=["aria-label"],tr=["aria-label","title"],or={class:"sidebar-header"},nr={class:"context-title"},sr={key:0,class:"user-indicator"},ar={class:"user-avatar"},ir=["src","alt"],rr={key:1,class:"avatar-placeholder"},lr={class:"user-info"},cr={class:"user-name"},dr={key:0,class:"global-context-content"},ur={class:"metrics-section"},mr={class:"metrics-grid"},gr={class:"filters-section"},fr={class:"filter-presets"},hr=["onClick","aria-label"],vr={class:"preset-label"},yr={key:0,class:"preset-count"},pr={class:"recent-activity-section"},br={class:"recent-activity-list"},_r=["onClick"],wr={class:"activity-content"},Cr={class:"activity-text"},kr={class:"activity-time"},Sr={key:1,class:"user-context-content"},xr={class:"user-stats-section"},Mr={class:"user-stats-grid"},Ar={class:"stat-item"},Er={class:"stat-value"},Tr={class:"stat-item"},Lr={class:"stat-value"},Dr={class:"stat-item"},Ir={class:"stat-value"},Pr={class:"stat-item"},Nr={class:"stat-value"},Ur={class:"analysis-filters-section"},Fr={class:"filter-controls"},Br={class:"filter-group"},Rr={class:"filter-group"},Or={class:"checkbox-group"},Vr=["value"],zr={class:"user-actions-section"},Hr={class:"action-buttons"},jr=["aria-label"],Wr=["aria-label"],qr=["aria-label"],$r={key:2,class:"management-context-content"},Xr={key:0,class:"selected-users-section"},Kr={class:"section-title"},Jr={class:"selected-users-list"},Gr={class:"user-avatar small"},Yr=["src","alt"],Qr={key:1,class:"avatar-placeholder small"},Zr={class:"user-name"},el={key:0,class:"more-users"},tl={class:"bulk-operations-section"},ol={class:"bulk-actions"},nl=["disabled"],sl=["disabled"],al=["disabled"],il={class:"audit-log-section"},rl={class:"audit-log-list"},ll={class:"audit-content"},cl={class:"audit-text"},dl={class:"audit-time"},ul={key:0,class:"sidebar-loading-overlay"};function ml(s,e,o,t,i,l){const a=q("MetricCard");return c(),d("aside",{class:U(["context-sidebar",{collapsed:t.isCollapsed,"context-global":o.context==="global","context-user":o.context==="user","context-management":o.context==="management"}]),role:"complementary","aria-label":t.getAriaLabel()},[n("button",{class:"collapse-toggle",onClick:e[0]||(e[0]=(...r)=>t.toggleCollapse&&t.toggleCollapse(...r)),onKeydown:[e[1]||(e[1]=ee((...r)=>t.toggleCollapse&&t.toggleCollapse(...r),["enter"])),e[2]||(e[2]=ee((...r)=>t.toggleCollapse&&t.toggleCollapse(...r),["space"]))],"aria-label":t.isCollapsed?"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å":"–°–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å",title:t.isCollapsed?"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å":"–°–≤–µ—Ä–Ω—É—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å"},[(c(),d("svg",{class:U(["collapse-icon",{rotated:t.isCollapsed}]),viewBox:"0 0 24 24","aria-hidden":"true"},[...e[13]||(e[13]=[n("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"},null,-1)])],2))],40,tr),n("header",or,[n("h3",nr,u(t.getContextTitle()),1),o.context==="user"&&o.selectedUser?(c(),d("div",sr,[n("div",ar,[o.selectedUser.avatar?(c(),d("img",{key:0,src:o.selectedUser.avatar,alt:`–ê–≤–∞—Ç–∞—Ä ${o.selectedUser.name}`},null,8,ir)):(c(),d("div",rr,u(t.userInitials),1))]),n("div",lr,[n("div",cr,u(o.selectedUser.name),1),n("div",{class:U(["user-status",o.selectedUser.status])},u(t.getStatusText(o.selectedUser.status)),3)])])):h("",!0)]),n("div",{class:U(["sidebar-content",{"content-collapsed":t.isCollapsed}])},[o.context==="global"?(c(),d("div",dr,[n("section",ur,[e[14]||(e[14]=n("h4",{class:"section-title"},"–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",-1)),n("div",mr,[(c(!0),d(H,null,W(o.globalMetrics,r=>(c(),$(a,{key:r.id,metric:r,size:"compact",onClick:t.handleMetricClick},null,8,["metric","onClick"]))),128))])]),n("section",gr,[e[15]||(e[15]=n("h4",{class:"section-title"},"–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã",-1)),n("div",fr,[(c(!0),d(H,null,W(o.filterPresets,r=>(c(),d("button",{key:r.id,class:U(["filter-preset",{active:o.activePreset===r.id}]),onClick:m=>t.applyFilterPreset(r),"aria-label":`–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä: ${r.label}`},[(c(),$(Ie(r.icon),{class:"preset-icon"})),n("span",vr,u(r.label),1),r.count!==void 0?(c(),d("span",yr,u(r.count),1)):h("",!0)],10,hr))),128))])]),n("section",pr,[e[16]||(e[16]=n("h4",{class:"section-title"},"–ù–µ–¥–∞–≤–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",-1)),n("div",br,[(c(!0),d(H,null,W(o.recentActivity,r=>(c(),d("div",{key:r.id,class:"activity-item",onClick:m=>t.handleActivityClick(r)},[n("div",{class:U(["activity-icon",r.type])},[(c(),$(Ie(r.icon)))],2),n("div",wr,[n("div",Cr,u(r.text),1),n("div",kr,u(t.formatTime(r.timestamp)),1)])],8,_r))),128))])])])):o.context==="user"?(c(),d("div",Sr,[n("section",xr,[e[21]||(e[21]=n("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",-1)),n("div",Mr,[n("div",Ar,[n("div",Er,u(o.userStats.total_actions||0),1),e[17]||(e[17]=n("div",{class:"stat-label"},"–¥–µ–π—Å—Ç–≤–∏–π",-1)),o.userStats.actions_change!==0?(c(),d("div",{key:0,class:U(["stat-change",{positive:o.userStats.actions_change>0,negative:o.userStats.actions_change<0}])},u(o.userStats.actions_change>0?"+":"")+u(o.userStats.actions_change)+"% ",3)):h("",!0)]),n("div",Tr,[n("div",Lr,u(t.formatDuration(o.userStats.avg_session_duration||0)),1),e[18]||(e[18]=n("div",{class:"stat-label"},"—Å—Ä–µ–¥–Ω—è—è —Å–µ—Å—Å–∏—è",-1))]),n("div",Dr,[n("div",Ir,u(o.userStats.total_sessions||0),1),e[19]||(e[19]=n("div",{class:"stat-label"},"—Å–µ—Å—Å–∏–π",-1))]),n("div",Pr,[n("div",Nr,u(o.userStats.activity_score||0)+"/100",1),e[20]||(e[20]=n("div",{class:"stat-label"},"–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1))])])]),n("section",Ur,[e[26]||(e[26]=n("h4",{class:"section-title"},"–§–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞",-1)),n("div",Fr,[n("div",Br,[e[23]||(e[23]=n("label",{class:"filter-label"},"–ü–µ—Ä–∏–æ–¥:",-1)),Z(n("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.userFilters.timeRange=r),class:"filter-select",onChange:e[4]||(e[4]=(...r)=>t.handleFilterChange&&t.handleFilterChange(...r))},[...e[22]||(e[22]=[We('<option value="today" data-v-abccaced>–°–µ–≥–æ–¥–Ω—è</option><option value="week" data-v-abccaced>–ù–µ–¥–µ–ª—è</option><option value="month" data-v-abccaced>–ú–µ—Å—è—Ü</option><option value="quarter" data-v-abccaced>–ö–≤–∞—Ä—Ç–∞–ª</option><option value="year" data-v-abccaced>–ì–æ–¥</option>',5)])],544),[[Ae,o.userFilters.timeRange]])]),n("div",Rr,[e[25]||(e[25]=n("label",{class:"filter-label"},"–¢–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π:",-1)),n("div",Or,[(c(!0),d(H,null,W(o.activityTypes,r=>(c(),d("label",{key:r.id,class:"checkbox-label"},[Z(n("input",{type:"checkbox",value:r.id,"onUpdate:modelValue":e[5]||(e[5]=m=>o.userFilters.activity_types=m),onChange:e[6]||(e[6]=(...m)=>t.handleFilterChange&&t.handleFilterChange(...m))},null,40,Vr),[[it,o.userFilters.activity_types]]),e[24]||(e[24]=n("span",{class:"checkmark"},null,-1)),X(" "+u(r.label),1)]))),128))])])])]),n("section",zr,[e[30]||(e[30]=n("h4",{class:"section-title"},"–î–µ–π—Å—Ç–≤–∏—è",-1)),n("div",Hr,[n("button",{class:"action-button primary",onClick:e[7]||(e[7]=(...r)=>t.viewDetailedProfile&&t.viewDetailedProfile(...r)),"aria-label":`–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å ${o.selectedUser?.name}`},[...e[27]||(e[27]=[n("svg",{class:"action-icon",viewBox:"0 0 24 24"},[n("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L19 6.6C18.8 6 18.5 5.4 18.1 4.9L19 3L17 1L15.4 1.9C14.9 1.5 14.3 1.2 13.7 1L13 0V2C12.4 2 11.8 2.2 11.3 2.6L10.6 1.9L8.6 3L9.5 4.9C9.1 5.4 8.8 6 8.6 6.6L7 7V9L8.6 8.4C8.8 9 9.1 9.6 9.5 10.1L8.6 12L10.6 13.9L11.3 13.2C11.8 13.6 12.4 13.8 13 14V16H11V18H13V20H11V22H13V20H15V18H13V16H15V14C15.6 14 16.2 13.6 16.7 13.2L17.4 13.9L19.4 12L18.5 10.1C18.9 9.6 19.2 9 19.4 8.4L21 9ZM12 8C10.9 8 10 7.1 10 6C10 4.9 10.9 4 12 4C13.1 4 14 4.9 14 6C14 7.1 13.1 8 12 8Z"})],-1),X(" –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å ",-1)])],8,jr),n("button",{class:"action-button secondary",onClick:e[8]||(e[8]=(...r)=>t.exportUserData&&t.exportUserData(...r)),"aria-label":`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ ${o.selectedUser?.name}`},[...e[28]||(e[28]=[n("svg",{class:"action-icon",viewBox:"0 0 24 24"},[n("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),X(" –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö ",-1)])],8,Wr),o.canEditPermissions?(c(),d("button",{key:0,class:"action-button warning",onClick:e[9]||(e[9]=(...r)=>t.editPermissions&&t.editPermissions(...r)),"aria-label":`–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ${o.selectedUser?.name}`},[...e[29]||(e[29]=[n("svg",{class:"action-icon",viewBox:"0 0 24 24"},[n("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),X(" –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ",-1)])],8,qr)):h("",!0)])])])):o.context==="management"?(c(),d("div",$r,[o.selectedUsers.length>0?(c(),d("section",Xr,[n("h4",Kr,"–í—ã–±—Ä–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: "+u(o.selectedUsers.length),1),n("div",Jr,[(c(!0),d(H,null,W(o.selectedUsers.slice(0,3),r=>(c(),d("div",{key:r.id,class:"selected-user-item"},[n("div",Gr,[r.avatar?(c(),d("img",{key:0,src:r.avatar,alt:r.name},null,8,Yr)):(c(),d("div",Qr,u(t.getUserInitials(r.name)),1))]),n("span",Zr,u(r.name),1)]))),128)),o.selectedUsers.length>3?(c(),d("div",el," +"+u(o.selectedUsers.length-3)+" –µ—â—ë ",1)):h("",!0)])])):h("",!0),n("section",tl,[e[34]||(e[34]=n("h4",{class:"section-title"},"–ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",-1)),n("div",ol,[n("button",{class:"bulk-action-button",onClick:e[10]||(e[10]=r=>t.performBulkAction("change_department")),disabled:o.selectedUsers.length===0},[...e[31]||(e[31]=[n("svg",{class:"action-icon",viewBox:"0 0 24 24"},[n("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),X(" –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–¥–µ–ª ",-1)])],8,nl),n("button",{class:"bulk-action-button",onClick:e[11]||(e[11]=r=>t.performBulkAction("toggle_admin")),disabled:o.selectedUsers.length===0},[...e[32]||(e[32]=[n("svg",{class:"action-icon",viewBox:"0 0 24 24"},[n("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1),X(" –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ",-1)])],8,sl),n("button",{class:"bulk-action-button",onClick:e[12]||(e[12]=r=>t.performBulkAction("export")),disabled:o.selectedUsers.length===0},[...e[33]||(e[33]=[n("svg",{class:"action-icon",viewBox:"0 0 24 24"},[n("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),X(" –≠–∫—Å–ø–æ—Ä—Ç ",-1)])],8,al)])]),n("section",il,[e[35]||(e[35]=n("h4",{class:"section-title"},"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è",-1)),n("div",rl,[(c(!0),d(H,null,W(o.auditLog.slice(0,5),r=>(c(),d("div",{key:r.id,class:"audit-entry"},[n("div",{class:U(["audit-icon",r.type])},[(c(),$(Ie(r.icon)))],2),n("div",ll,[n("div",cl,u(r.text),1),n("div",dl,u(t.formatTime(r.timestamp)),1)])]))),128))])])])):h("",!0)],2),o.isLoading?(c(),d("div",ul,[...e[36]||(e[36]=[n("div",{class:"loading-spinner","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"},null,-1)])])):h("",!0)],10,er)}const gl=j(Zi,[["render",ml],["__scopeId","data-v-abccaced"]]),_t=s=>new Date(s),fl=(s,e,o={})=>{const t=new Date(s),i=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return e.replace("yyyy",i).replace("MM",l).replace("dd",a)},hl={name:"UnifiedUserCard",props:{user:{type:Object,required:!0,validator:s=>s&&typeof s=="object"&&s.id&&s.name&&s.email},isSelected:{type:Boolean,default:!1},showExtendedMetrics:{type:Boolean,default:!1},compactView:{type:Boolean,default:!1},canEditPermissions:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},maxDepartments:{type:Number,default:2}},emits:["select","view-profile","edit-permissions","toggle-hidden","view-analytics","export-data","send-notification","view-audit","delete-user"],setup(s,{emit:e}){const o=x(!1),t=x(null),i=y(()=>{const[S,J]=s.user.name.split(" ");return`${S?.[0]||""}${J?.[0]||""}`.toUpperCase()}),l=y(()=>{const S=["#2196F3","#4CAF50","#FF9800","#F44336","#9C27B0","#00BCD4","#8BC34A","#FFC107","#E91E63","#3F51B5"];return S[Math.abs(s.user.id)%S.length]}),a=y(()=>(s.user.departments||[]).slice(0,s.maxDepartments).map(J=>({...J,shortName:J.name.length>10?J.name.substring(0,8)+"...":J.name}))),r=y(()=>{const S=s.user.departments||[];return Math.max(0,S.length-s.maxDepartments)}),m=y(()=>{const S=s.user.activity_stats?.total_actions||0;return S>=1e6?`${(S/1e6).toFixed(1)}M`:S>=1e3?`${(S/1e3).toFixed(1)}K`:S.toLocaleString()}),f=y(()=>{const S=s.user.activity_stats?.total_sessions||0;return S>=1e3?`${(S/1e3).toFixed(1)}K`:S.toString()}),g=y(()=>{const S=s.user.activity_stats?.avg_session_duration||0,J=Math.floor(S/60),Ce=Math.floor(S%60);return`${J}:${Ce.toString().padStart(2,"0")}`}),b=y(()=>{const S=s.user.activity_stats?.last_activity;if(!S)return"–ù–∏–∫–æ–≥–¥–∞";let J;try{J=typeof S=="string"?_t(S):new Date(S)}catch{return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}const Te=new Date-J,ye=Math.floor(Te/(1e3*60*60*24)),Ue=Math.floor(Te/(1e3*60*60)),Le=Math.floor(Te/(1e3*60));return Le<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":Le<60?`${Le} –º–∏–Ω`:Ue<24?`${Ue} —á`:ye<7?`${ye} –¥`:ye<30?`${Math.floor(ye/7)} –Ω–µ–¥`:fl(J,"dd.MM.yyyy")}),L=y(()=>Math.min(100,Math.max(0,s.user.activity_stats?.activity_score||0))),M=y(()=>s.user.activity_stats?.actions_change_percent||0),C=y(()=>s.user.status||"offline"),A=y(()=>!!s.user.is_admin),P=y(()=>{if(!s.user.created_at)return!1;try{const S=typeof s.user.created_at=="string"?_t(s.user.created_at):new Date(s.user.created_at);return Math.floor((new Date-S)/(1e3*60*60*24))<=7}catch{return!1}}),v=y(()=>!!s.user.is_hidden),T=y(()=>s.user.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"),E=y(()=>s.user.email||""),V=y(()=>s.user.avatar||null),B=()=>{e("select",s.user)},D=()=>{e("view-profile",s.user)},p=()=>{e("edit-permissions",s.user)},w=()=>{e("toggle-hidden",s.user)},N=()=>{o.value=!0;const S=J=>{t.value&&!t.value.contains(J.target)&&(o.value=!1,document.removeEventListener("click",S))};setTimeout(()=>{document.addEventListener("click",S)},0)},I=()=>{o.value=!1,e("view-analytics",s.user)},F=()=>{o.value=!1,e("export-data",s.user)},R=()=>{o.value=!1,e("send-notification",s.user)},K=()=>{o.value=!1,e("view-audit",s.user)},me=()=>{o.value=!1,confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${s.user.name}?`)&&e("delete-user",s.user)},Ee=()=>{console.warn(`Failed to load avatar for user ${s.user.id}`)},le=S=>{switch(S){case"online":return"–æ–Ω–ª–∞–π–Ω";case"away":return"–æ—Ç–æ—à—ë–ª";case"offline":return"–æ—Ñ—Ñ–ª–∞–π–Ω";default:return"–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}},we=S=>{if(S.key==="Enter"||S.key===" ")S.preventDefault(),B();else if(S.key==="ArrowDown"){S.preventDefault();const J=S.target.nextElementSibling;J&&J.focus()}else if(S.key==="ArrowUp"){S.preventDefault();const J=S.target.previousElementSibling;J&&J.focus()}};return se(()=>{const S=document.querySelector(`[data-user-id="${s.user.id}"]`);S&&S.addEventListener("keydown",we)}),Qe(()=>{const S=document.querySelector(`[data-user-id="${s.user.id}"]`);S&&S.removeEventListener("keydown",we)}),{showContextMenuFlag:o,contextMenuRef:t,userInitials:i,avatarColor:l,visibleDepartments:a,hiddenDepartmentsCount:r,totalActionsFormatted:m,totalSessionsFormatted:f,avgSessionDurationFormatted:g,lastActivityFormatted:b,activityScore:L,actionsChange:M,userStatus:C,isAdmin:A,isNew:P,isHidden:v,userName:T,userEmail:E,userAvatar:V,handleSelect:B,viewProfile:D,editPermissions:p,toggleHidden:w,showContextMenu:N,viewDetailedAnalytics:I,exportUserData:F,sendNotification:R,viewAuditLog:K,deleteUser:me,handleAvatarError:Ee,getStatusText:le}}},vl=["aria-label","aria-selected","aria-describedby"],yl={class:"user-avatar-section"},pl={class:"avatar-container"},bl=["src","alt"],_l=["title"],wl={key:2,class:"new-indicator",title:"–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"},Cl={class:"user-info-section"},kl={class:"user-header"},Sl={class:"user-name"},xl={class:"user-badges"},Ml={key:0,class:"badge admin",title:"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"},Al={key:1,class:"badge hidden",title:"–°–∫—Ä—ã—Ç—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"},El={class:"user-email"},Tl={key:0,class:"user-departments"},Ll=["title"],Dl=["title"],Il={class:"user-metrics-section"},Pl={class:"metric primary"},Nl={class:"metric-value"},Ul=["title"],Fl={class:"metric secondary"},Bl={class:"metric-value"},Rl={key:0,class:"activity-score"},Ol={class:"score-bar"},Vl=["title"],zl={key:1,class:"mini-metrics"},Hl={class:"mini-metric"},jl={class:"mini-metric"},Wl={class:"user-actions-section"},ql=["aria-label","title"],$l=["aria-label","title"],Xl=["aria-label","title"],Kl=["aria-label"],Jl=["aria-label"],Gl=["aria-label"],Yl=["aria-label"],Ql=["aria-label"],Zl=["aria-label"],ec=["aria-label"],tc=["id"],oc={key:1,class:"selection-indicator","aria-hidden":"true"};function nc(s,e,o,t,i,l){return c(),d("div",{class:U(["unified-user-card",{selected:o.isSelected,"activity-high":t.activityScore>=80,"activity-medium":t.activityScore>=50&&t.activityScore<80,"activity-low":t.activityScore<50,"status-online":t.userStatus==="online","status-away":t.userStatus==="away","status-offline":t.userStatus==="offline","has-departments":t.visibleDepartments.length>0,"is-admin":t.isAdmin,"is-new":t.isNew,"is-hidden":t.isHidden,"compact-view":o.compactView}]),onClick:e[10]||(e[10]=(...a)=>t.handleSelect&&t.handleSelect(...a)),onDblclick:e[11]||(e[11]=(...a)=>t.viewProfile&&t.viewProfile(...a)),onKeydown:[e[12]||(e[12]=ee((...a)=>t.handleSelect&&t.handleSelect(...a),["enter"])),e[13]||(e[13]=ee((...a)=>t.handleSelect&&t.handleSelect(...a),["space"]))],onContextmenu:e[14]||(e[14]=ae((...a)=>t.showContextMenu&&t.showContextMenu(...a),["prevent"])),tabindex:"0",role:"button","aria-label":`–í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`,"aria-selected":o.isSelected,"aria-describedby":`user-card-${o.user.id}-description`},[n("div",yl,[n("div",pl,[t.userAvatar?(c(),d("img",{key:0,src:t.userAvatar,alt:`–ê–≤–∞—Ç–∞—Ä ${t.userName}`,class:"user-avatar",onError:e[0]||(e[0]=(...a)=>t.handleAvatarError&&t.handleAvatarError(...a))},null,40,bl)):(c(),d("div",{key:1,class:"avatar-placeholder",style:ie({backgroundColor:t.avatarColor})},u(t.userInitials),5)),n("div",{class:U(["status-indicator",t.userStatus]),title:`–°—Ç–∞—Ç—É—Å: ${t.getStatusText(t.userStatus)}`},null,10,_l),t.isNew?(c(),d("div",wl," NEW ")):h("",!0)])]),n("div",Cl,[n("div",kl,[n("h4",Sl,u(t.userName),1),n("div",xl,[t.isAdmin?(c(),d("span",Ml," –ê–¥–º–∏–Ω ")):h("",!0),t.isHidden?(c(),d("span",Al," –°–∫—Ä—ã—Ç ")):h("",!0)])]),n("p",El,u(t.userEmail),1),t.visibleDepartments.length>0?(c(),d("div",Tl,[(c(!0),d(H,null,W(t.visibleDepartments,a=>(c(),d("span",{key:a.id,class:"dept-tag",style:ie({backgroundColor:a.color}),title:a.name},u(a.shortName||a.name),13,Ll))),128)),t.hiddenDepartmentsCount>0?(c(),d("span",{key:0,class:"dept-more",title:`–ï—â—ë ${t.hiddenDepartmentsCount} –æ—Ç–¥–µ–ª–æ–≤`}," +"+u(t.hiddenDepartmentsCount),9,Dl)):h("",!0)])):h("",!0)]),n("div",Il,[n("div",Pl,[n("div",Nl,u(t.totalActionsFormatted),1),e[15]||(e[15]=n("div",{class:"metric-label"},"–¥–µ–π—Å—Ç–≤–∏–π",-1)),t.actionsChange!==0?(c(),d("div",{key:0,class:U(["metric-change",{positive:t.actionsChange>0,negative:t.actionsChange<0}]),title:`–ò–∑–º–µ–Ω–µ–Ω–∏–µ: ${t.actionsChange>0?"+":""}${t.actionsChange}%`},u(t.actionsChange>0?"+":"")+u(t.actionsChange)+"% ",11,Ul)):h("",!0)]),n("div",Fl,[n("div",Bl,u(t.lastActivityFormatted),1),e[16]||(e[16]=n("div",{class:"metric-label"},"–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1))]),o.compactView?h("",!0):(c(),d("div",Rl,[n("div",Ol,[n("div",{class:U(["score-fill",{"high-score":t.activityScore>=80,"medium-score":t.activityScore>=50&&t.activityScore<80,"low-score":t.activityScore<50}]),style:ie({width:`${t.activityScore}%`})},null,6)]),n("div",{class:"score-label",title:`–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: ${t.activityScore}/100`},u(t.activityScore)+"/100 ",9,Vl)])),o.compactView?(c(),d("div",zl,[n("span",Hl,u(t.totalSessionsFormatted)+" —Å–µ—Å—Å–∏–π",1),n("span",jl,u(t.avgSessionDurationFormatted),1)])):h("",!0)]),n("div",Wl,[n("button",{onClick:e[1]||(e[1]=ae((...a)=>t.viewProfile&&t.viewProfile(...a),["stop"])),class:"action-btn primary","aria-label":`–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ${t.userName}`,title:`–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ${t.userName}`}," üëÅÔ∏è ",8,ql),o.canEditPermissions?(c(),d("button",{key:0,onClick:e[2]||(e[2]=ae((...a)=>t.editPermissions&&t.editPermissions(...a),["stop"])),class:"action-btn secondary","aria-label":`–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ${t.userName}`,title:`–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ${t.userName}`}," ‚öôÔ∏è ",8,$l)):h("",!0),n("button",{onClick:e[3]||(e[3]=ae((...a)=>t.toggleHidden&&t.toggleHidden(...a),["stop"])),class:U(["action-btn tertiary",{active:t.isHidden}]),"aria-label":`${t.isHidden?"–ü–æ–∫–∞–∑–∞—Ç—å":"–°–∫—Ä—ã—Ç—å"} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`,title:`${t.isHidden?"–ü–æ–∫–∞–∑–∞—Ç—å":"–°–∫—Ä—ã—Ç—å"} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`},u(t.isHidden?"üëÅÔ∏è‚Äçüó®Ô∏è":"üôà"),11,Xl),n("button",{onClick:e[4]||(e[4]=ae((...a)=>t.showContextMenu&&t.showContextMenu(...a),["stop"])),class:"action-btn menu","aria-label":`–ú–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è ${t.userName}`,title:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è"}," ‚ãÆ ",8,Kl)]),t.showContextMenuFlag?(c(),d("div",{key:0,class:"context-menu",ref:"contextMenu",role:"menu","aria-label":`–ú–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è ${t.userName}`},[n("button",{onClick:e[5]||(e[5]=(...a)=>t.viewDetailedAnalytics&&t.viewDetailedAnalytics(...a)),class:"menu-item",role:"menuitem","aria-label":`–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è ${t.userName}`}," üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ ",8,Gl),n("button",{onClick:e[6]||(e[6]=(...a)=>t.exportUserData&&t.exportUserData(...a)),class:"menu-item",role:"menuitem","aria-label":`–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö ${t.userName}`}," üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö ",8,Yl),n("button",{onClick:e[7]||(e[7]=(...a)=>t.sendNotification&&t.sendNotification(...a)),class:"menu-item",role:"menuitem","aria-label":`–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ${t.userName}`}," üìß –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ",8,Ql),n("button",{onClick:e[8]||(e[8]=(...a)=>t.viewAuditLog&&t.viewAuditLog(...a)),class:"menu-item",role:"menuitem","aria-label":`–ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ –¥–ª—è ${t.userName}`}," üìã –ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ ",8,Zl),e[17]||(e[17]=n("hr",{class:"menu-divider",role:"separator"},null,-1)),o.canDelete?(c(),d("button",{key:0,onClick:e[9]||(e[9]=(...a)=>t.deleteUser&&t.deleteUser(...a)),class:"menu-item danger",role:"menuitem","aria-label":`–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${t.userName}`}," üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ",8,ec)):h("",!0)],8,Jl)):h("",!0),n("div",{id:`user-card-${o.user.id}-description`,class:"sr-only"}," –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "+u(t.userName)+", email "+u(t.userEmail)+", —Å—Ç–∞—Ç—É—Å "+u(t.getStatusText(t.userStatus))+", "+u(t.totalActionsFormatted)+" –¥–µ–π—Å—Ç–≤–∏–π, –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å "+u(t.lastActivityFormatted)+", —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ "+u(t.activityScore)+" –∏–∑ 100. "+u(t.isAdmin?"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.":"")+" "+u(t.isHidden?"–°–∫—Ä—ã—Ç—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.":"")+" "+u(t.visibleDepartments.length>0?`–û—Ç–¥–µ–ª—ã: ${t.visibleDepartments.map(a=>a.name).join(", ")}.`:""),9,tc),o.isSelected?(c(),d("div",oc,[...e[18]||(e[18]=[n("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},[n("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})],-1)])])):h("",!0)],42,vl)}const sc=j(hl,[["render",nc],["__scopeId","data-v-5e790fbc"]]),ac={name:"BulkActionsBar",emits:["execute","clear-selection"],props:{selectedUsers:{type:Array,default:()=>[]},availableActions:{type:Array,default:()=>[]}}},ic={key:0,class:"bulk-actions-bar"},rc={class:"bar-content"},lc={class:"selection-info"},cc={class:"selection-count"},dc={class:"selection-text"},uc={class:"actions-list"},mc=["onClick","title"],gc={key:0,class:"action-icon"},fc={class:"action-text"};function hc(s,e,o,t,i,l){return o.selectedUsers.length>0?(c(),d("div",ic,[n("div",rc,[n("div",lc,[n("span",cc," –í—ã–±—Ä–∞–Ω–æ: "+u(o.selectedUsers.length),1),n("span",dc,u(o.selectedUsers.length===1?"–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å":"–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),1)]),n("div",uc,[(c(!0),d(H,null,W(o.availableActions,a=>(c(),d("button",{key:a.id,onClick:r=>s.$emit("execute",a),class:U(["action-btn",a.class]),title:a.description},[a.icon?(c(),d("span",gc,u(a.icon),1)):h("",!0),n("span",fc,u(a.label),1)],10,mc))),128))]),n("button",{onClick:e[0]||(e[0]=a=>s.$emit("clear-selection")),class:"clear-btn",title:"–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä"}," ‚úï ")])])):h("",!0)}const vc=j(ac,[["render",hc],["__scopeId","data-v-56b78081"]]),yc={name:"VirtualList",emits:["item-click"],props:{items:{type:Array,default:()=>[]},itemHeight:{type:Number,default:50},containerHeight:{type:Number,default:400},bufferSize:{type:Number,default:5}},data(){return{scrollTop:0}},computed:{totalItems(){return this.items.length},totalHeight(){return this.totalItems*this.itemHeight},visibleCount(){return Math.ceil(this.containerHeight/this.itemHeight)+this.bufferSize*2},startIndex(){const s=Math.floor(this.scrollTop/this.itemHeight)-this.bufferSize;return Math.max(0,s)},endIndex(){const s=this.startIndex+this.visibleCount;return Math.min(this.totalItems,s)},visibleItems(){return this.items.slice(this.startIndex,this.endIndex)},offsetTop(){return this.startIndex*this.itemHeight},offsetBottom(){return Math.max(0,this.totalHeight-this.offsetTop-this.visibleItems.length*this.itemHeight)},listHeight(){return Math.min(this.totalHeight,this.containerHeight)}},methods:{handleScroll(s){this.scrollTop=s.target.scrollTop},getItemKey(s,e){return s.id||s.key||e},scrollToIndex(s){const e=Math.max(0,s*this.itemHeight-this.containerHeight/2);this.$refs.container?.scrollTo({top:e,behavior:"smooth"})},scrollToTop(){this.$refs.container?.scrollTo({top:0,behavior:"smooth"})},scrollToBottom(){const s=this.totalHeight-this.containerHeight;this.$refs.container?.scrollTo({top:s,behavior:"smooth"})}}},pc={class:"virtual-list-container",ref:"container"};function bc(s,e,o,t,i,l){return c(),d("div",pc,[n("div",{class:"virtual-list",style:ie({height:`${l.listHeight}px`}),onScroll:e[0]||(e[0]=(...a)=>l.handleScroll&&l.handleScroll(...a))},[n("div",{class:"virtual-spacer top",style:ie({height:`${l.offsetTop}px`})},null,4),(c(!0),d(H,null,W(l.visibleItems,(a,r)=>(c(),d("div",{key:l.getItemKey(a,l.startIndex+r),class:"virtual-item"},[wt(s.$slots,"item",{item:a,index:l.startIndex+r},void 0)]))),128)),n("div",{class:"virtual-spacer bottom",style:ie({height:`${l.offsetBottom}px`})},null,4)],36)],512)}const _c=j(yc,[["render",bc],["__scopeId","data-v-302c06ef"]]),wc={name:"PaginationControls",emits:["page-change","per-page-change"],props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},totalItems:{type:Number,required:!0},perPage:{type:Number,default:50},showPerPageSelector:{type:Boolean,default:!0},perPageOptions:{type:Array,default:()=>[10,25,50,100]},maxVisiblePages:{type:Number,default:7}},computed:{startItem(){return(this.currentPage-1)*this.perPage+1},endItem(){return Math.min(this.currentPage*this.perPage,this.totalItems)},visiblePages(){const s=[],e=this.totalPages,o=this.currentPage,t=this.maxVisiblePages;if(e<=t)for(let i=1;i<=e;i++)s.push(i);else{const i=Math.max(1,o-Math.floor(t/2)),l=Math.min(e,i+t-1),a=Math.max(1,l-t+1);a>1&&(s.push(1),a>2&&s.push("..."));for(let r=a;r<=l;r++)s.push(r);l<e&&(l<e-1&&s.push("..."),s.push(e))}return s}}},Cc={key:0,class:"pagination-controls"},kc={class:"pagination-info"},Sc={class:"pagination-text"},xc={class:"pagination-nav"},Mc=["disabled"],Ac=["disabled"],Ec={key:0,class:"page-btn ellipsis",disabled:"","aria-hidden":"true"},Tc=["onClick","aria-label","aria-current"],Lc=["disabled"],Dc=["disabled"],Ic={key:0,class:"per-page-selector"},Pc=["value"],Nc=["value"];function Uc(s,e,o,t,i,l){return o.totalPages>1?(c(),d("div",Cc,[n("div",kc,[n("span",Sc,u(l.startItem)+"-"+u(l.endItem)+" –∏–∑ "+u(o.totalItems.toLocaleString()),1)]),n("div",xc,[n("button",{onClick:e[0]||(e[0]=a=>s.$emit("page-change",1)),disabled:o.currentPage===1,class:"page-btn first","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ¬´¬´ ",8,Mc),n("button",{onClick:e[1]||(e[1]=a=>s.$emit("page-change",o.currentPage-1)),disabled:o.currentPage===1,class:"page-btn prev","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ‚Äπ ",8,Ac),(c(!0),d(H,null,W(l.visiblePages,a=>(c(),d(H,{key:a},[a==="..."?(c(),d("button",Ec,u(a),1)):(c(),d("button",{key:1,onClick:r=>s.$emit("page-change",a),class:U({"page-btn":!0,current:a===o.currentPage}),"aria-label":`–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ${a}`,"aria-current":a===o.currentPage?"page":null},u(a),11,Tc))],64))),128)),n("button",{onClick:e[2]||(e[2]=a=>s.$emit("page-change",o.currentPage+1)),disabled:o.currentPage===o.totalPages,class:"page-btn next","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ‚Ä∫ ",8,Lc),n("button",{onClick:e[3]||(e[3]=a=>s.$emit("page-change",o.totalPages)),disabled:o.currentPage===o.totalPages,class:"page-btn last","aria-label":"–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",title:"–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"}," ¬ª¬ª ",8,Dc)]),o.showPerPageSelector?(c(),d("div",Ic,[e[5]||(e[5]=n("label",{for:"per-page-select",class:"per-page-label"},"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å:",-1)),n("select",{id:"per-page-select",value:o.perPage,onChange:e[4]||(e[4]=a=>s.$emit("per-page-change",parseInt(a.target.value))),class:"per-page-select","aria-label":"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ"},[(c(!0),d(H,null,W(o.perPageOptions,a=>(c(),d("option",{key:a,value:a},u(a),9,Nc))),128))],40,Pc)])):h("",!0)])):h("",!0)}const Fc=j(wc,[["render",Uc],["__scopeId","data-v-59d0e153"]]),Bc={name:"UserListPanel",components:{UnifiedUserCard:sc,BulkActionsBar:vc,VirtualList:_c,PaginationControls:Fc},props:{users:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},pagination:{type:Object,default:()=>({current_page:1,per_page:50,total:0,total_pages:0})},filters:{type:Object,default:()=>({search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc",time_range:"week"})},viewOptions:{type:Object,default:()=>({compactView:!1,showExtendedMetrics:!1,itemsPerPage:50})},canEditPermissions:{type:Boolean,default:!1},canDeleteUsers:{type:Boolean,default:!1}},emits:["user-select","user-select-multiple","filters-change","pagination-change","view-options-change","user-action"],setup(s,{emit:e}){const o=x(!1),t=x([]),i=x({...s.filters}),l=x(null),a=x(null),r=y(()=>s.users),m=y(()=>{let S=0;return i.value.search&&S++,i.value.department_ids.length>0&&S++,i.value.activity_filter!=="all"&&S++,i.value.time_range!=="week"&&S++,S}),f=y(()=>{if(!a.value)return 400;const S=a.value.getBoundingClientRect();return Math.max(400,window.innerHeight-S.top-200)}),g=y(()=>[{id:369,name:"–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª",color:"#2196F3"},{id:366,name:"–°–µ–∫—Ç–æ—Ä 1–°",color:"#4CAF50"},{id:370,name:"–û—Ç–¥–µ–ª –∞–Ω–∞–ª–∏—Ç–∏–∫–∏",color:"#FF9800"},{id:371,name:"–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",color:"#F44336"}]),b=y(()=>[{id:"change_department",label:"–ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–¥–µ–ª",icon:"BuildingIcon",description:"–ù–∞–∑–Ω–∞—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –¥—Ä—É–≥–æ–π –æ—Ç–¥–µ–ª"},{id:"toggle_admin",label:"–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",icon:"ShieldIcon",description:"–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ –æ—Ç–æ–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"},{id:"export",label:"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",icon:"DownloadIcon",description:"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},{id:"hide_users",label:"–°–∫—Ä—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",icon:"EyeOffIcon",description:"–°–∫—Ä—ã—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Å–ø–∏—Å–∫–∞"}]),L=()=>{o.value=!o.value},M=()=>{e("filters-change",{...i.value})},C=()=>{i.value={search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc",time_range:"week"},M()},A=S=>{const J=i.value.department_ids.indexOf(S);J>-1?i.value.department_ids.splice(J,1):i.value.department_ids.push(S),M()},P=()=>{i.value.sort_order=i.value.sort_order==="asc"?"desc":"asc",M()},v=()=>{const S={...s.viewOptions,compactView:!s.viewOptions.compactView};e("view-options-change",S)},T=()=>{l.value&&clearTimeout(l.value),l.value=setTimeout(E,300)},E=()=>{M()},V=()=>{i.value.search="",M()},B=S=>{D(S)},D=S=>{e("user-select",S)},p=S=>{t.value=S,e("user-select-multiple",S)},w=()=>{t.value=[]},N=S=>{e("user-action","view-profile",S)},I=S=>{e("user-action","edit-permissions",S)},F=S=>{e("user-action","toggle-visibility",S)},R=S=>{e("user-action","view-analytics",S)},K=S=>{e("user-action","export-data",S)},me=S=>{e("user-action","delete",S)},Ee=S=>{e("user-action","bulk-action",{action:S,users:t.value})},le=S=>{e("pagination-change",S)},we=S=>{e("pagination-change",1,S)};return ge(()=>s.filters,S=>{i.value={...S}},{deep:!0}),se(()=>{Nt(()=>{a.value&&(a.value.style.height=`${f.value}px`)})}),{showFilters:o,selectedUsers:t,localFilters:i,filteredUsers:r,activeFiltersCount:m,listHeight:f,departments:g,bulkActions:b,listContainer:a,toggleFilters:L,applyFilters:M,resetFilters:C,toggleDepartmentFilter:A,toggleSortOrder:P,toggleCompactView:v,debounceSearch:T,applySearch:E,clearSearch:V,handleUserClick:B,handleUserSelect:D,handleUserSelectMultiple:p,clearSelection:w,handleViewProfile:N,handleEditPermissions:I,handleToggleHidden:F,handleViewAnalytics:R,handleExportUserData:K,handleDeleteUser:me,handleBulkAction:Ee,handlePageChange:le,handlePerPageChange:we}}},Rc={class:"panel-header"},Oc={class:"header-content"},Vc={class:"panel-title"},zc={key:0,class:"users-count"},Hc={class:"header-actions"},jc={class:"search-container"},Wc=["aria-expanded"],qc={key:0,class:"filters-count"},$c={class:"view-options"},Xc={key:0,class:"filters-panel",role:"region","aria-label":"–ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤"},Kc={class:"filters-grid"},Jc={class:"filter-group"},Gc={class:"departments-filter"},Yc=["onClick","aria-label"],Qc={class:"filter-group"},Zc={class:"filter-group"},ed={class:"filter-group"},td={class:"sort-controls"},od=["aria-label"],nd={class:"filter-actions"},sd={class:"users-list-container",role:"list","aria-label":"–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},ad={key:0,class:"loading-state"},id={key:1,class:"empty-state"},rd={class:"empty-title"},ld={class:"empty-description"};function cd(s,e,o,t,i,l){const a=q("BulkActionsBar"),r=q("UnifiedUserCard"),m=q("VirtualList"),f=q("PaginationControls");return c(),d("div",{class:U(["user-list-panel",{loading:o.loading,empty:!o.loading&&t.filteredUsers.length===0,"compact-view":o.viewOptions.compactView}]),role:"region","aria-label":"–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},[n("div",Rc,[n("div",Oc,[n("h2",Vc,[e[16]||(e[16]=X(" –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ",-1)),o.loading?h("",!0):(c(),d("span",zc," ("+u(o.pagination.total.toLocaleString())+") ",1))]),n("div",Hc,[n("div",jc,[Z(n("input",{"onUpdate:modelValue":e[0]||(e[0]=g=>t.localFilters.search=g),type:"text",class:"search-input",placeholder:"–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ email...",onInput:e[1]||(e[1]=(...g)=>t.debounceSearch&&t.debounceSearch(...g)),onKeydown:e[2]||(e[2]=ee((...g)=>t.applySearch&&t.applySearch(...g),["enter"])),"aria-label":"–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},null,544),[[Re,t.localFilters.search]]),t.localFilters.search?(c(),d("button",{key:0,onClick:e[3]||(e[3]=(...g)=>t.clearSearch&&t.clearSearch(...g)),class:"search-clear","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫"}," ‚úï ")):h("",!0),e[17]||(e[17]=n("div",{class:"search-icon","aria-hidden":"true"},"üîç",-1))]),n("button",{onClick:e[4]||(e[4]=(...g)=>t.toggleFilters&&t.toggleFilters(...g)),class:U(["filters-toggle",{active:t.showFilters}]),"aria-label":"–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã","aria-expanded":t.showFilters},[e[18]||(e[18]=n("svg",{class:"filter-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[n("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})],-1)),e[19]||(e[19]=X(" –§–∏–ª—å—Ç—Ä—ã ",-1)),t.activeFiltersCount>0?(c(),d("span",qc,u(t.activeFiltersCount),1)):h("",!0)],10,Wc),n("div",$c,[n("button",{onClick:e[5]||(e[5]=(...g)=>t.toggleCompactView&&t.toggleCompactView(...g)),class:U(["view-toggle",{active:o.viewOptions.compactView}]),"aria-label":"–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥",title:"–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥"},[...e[20]||(e[20]=[n("svg",{viewBox:"0 0 24 24","aria-hidden":"true"},[n("path",{d:"M3 3h18v2H3V3zm0 16h18v2H3v16zm0-8h18v2H3v-2z"})],-1)])],2)])])])]),t.showFilters?(c(),d("div",Xc,[n("div",Kc,[n("div",Jc,[e[21]||(e[21]=n("label",{class:"filter-label"},"–û—Ç–¥–µ–ª—ã:",-1)),n("div",Gc,[(c(!0),d(H,null,W(t.departments,g=>(c(),d("button",{key:g.id,onClick:b=>t.toggleDepartmentFilter(g.id),class:U(["department-chip",{active:t.localFilters.department_ids.includes(g.id)}]),style:ie({borderColor:g.color}),"aria-label":`–§–∏–ª—å—Ç—Ä –ø–æ –æ—Ç–¥–µ–ª—É ${g.name}`},[n("span",{class:"dept-dot",style:ie({backgroundColor:g.color}),"aria-hidden":"true"},null,4),X(" "+u(g.name),1)],14,Yc))),128))])]),n("div",Qc,[e[23]||(e[23]=n("label",{class:"filter-label"},"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),Z(n("select",{"onUpdate:modelValue":e[6]||(e[6]=g=>t.localFilters.activity_filter=g),class:"filter-select",onChange:e[7]||(e[7]=(...g)=>t.applyFilters&&t.applyFilters(...g)),"aria-label":"–§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"},[...e[22]||(e[22]=[We('<option value="all" data-v-8c6ab554>–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option><option value="active" data-v-8c6ab554>–ê–∫—Ç–∏–≤–Ω—ã–µ (80%+)</option><option value="moderate" data-v-8c6ab554>–°—Ä–µ–¥–Ω–µ –∞–∫—Ç–∏–≤–Ω—ã–µ (50-80%)</option><option value="inactive" data-v-8c6ab554>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ (&lt;50%)</option><option value="new" data-v-8c6ab554>–ù–æ–≤—ã–µ (–∑–∞ –Ω–µ–¥–µ–ª—é)</option>',5)])],544),[[Ae,t.localFilters.activity_filter]])]),n("div",Zc,[e[25]||(e[25]=n("label",{class:"filter-label"},"–ü–µ—Ä–∏–æ–¥:",-1)),Z(n("select",{"onUpdate:modelValue":e[8]||(e[8]=g=>t.localFilters.time_range=g),class:"filter-select",onChange:e[9]||(e[9]=(...g)=>t.applyFilters&&t.applyFilters(...g)),"aria-label":"–í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏"},[...e[24]||(e[24]=[We('<option value="today" data-v-8c6ab554>–°–µ–≥–æ–¥–Ω—è</option><option value="week" data-v-8c6ab554>–≠—Ç–∞ –Ω–µ–¥–µ–ª—è</option><option value="month" data-v-8c6ab554>–≠—Ç–æ—Ç –º–µ—Å—è—Ü</option><option value="quarter" data-v-8c6ab554>–≠—Ç–æ—Ç –∫–≤–∞—Ä—Ç–∞–ª</option><option value="year" data-v-8c6ab554>–≠—Ç–æ—Ç –≥–æ–¥</option>',5)])],544),[[Ae,t.localFilters.time_range]])]),n("div",ed,[e[28]||(e[28]=n("label",{class:"filter-label"},"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:",-1)),n("div",td,[Z(n("select",{"onUpdate:modelValue":e[10]||(e[10]=g=>t.localFilters.sort_by=g),class:"filter-select sort-select",onChange:e[11]||(e[11]=(...g)=>t.applyFilters&&t.applyFilters(...g)),"aria-label":"–ü–æ–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏"},[...e[26]||(e[26]=[n("option",{value:"last_activity"},"–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1),n("option",{value:"name"},"–ò–º—è",-1),n("option",{value:"email"},"Email",-1),n("option",{value:"total_actions"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π",-1)])],544),[[Ae,t.localFilters.sort_by]]),n("button",{onClick:e[12]||(e[12]=(...g)=>t.toggleSortOrder&&t.toggleSortOrder(...g)),class:"sort-order-toggle","aria-label":`–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞ ${t.localFilters.sort_order==="asc"?"—É–±—ã–≤–∞—é—â–∏–π":"–≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–∏–π"}`},[(c(),d("svg",{class:U({rotated:t.localFilters.sort_order==="desc"}),viewBox:"0 0 24 24","aria-hidden":"true"},[...e[27]||(e[27]=[n("path",{d:"M7 14l5-5 5 5z"},null,-1)])],2))],8,od)])])]),n("div",nd,[n("button",{onClick:e[13]||(e[13]=(...g)=>t.resetFilters&&t.resetFilters(...g)),class:"filter-reset-btn"}," –°–±—Ä–æ—Å–∏—Ç—å "),n("button",{onClick:e[14]||(e[14]=(...g)=>t.applyFilters&&t.applyFilters(...g)),class:"filter-apply-btn"}," –ü—Ä–∏–º–µ–Ω–∏—Ç—å ")])])):h("",!0),t.selectedUsers.length>0?(c(),$(a,{key:1,"selected-users":t.selectedUsers,"available-actions":t.bulkActions,onExecute:t.handleBulkAction,onClearSelection:t.clearSelection},null,8,["selected-users","available-actions","onExecute","onClearSelection"])):h("",!0),n("div",sd,[o.loading?(c(),d("div",ad,[(c(!0),d(H,null,W(o.viewOptions.itemsPerPage,g=>(c(),d("div",{key:g,class:"user-skeleton","aria-hidden":"true"},[...e[29]||(e[29]=[We('<div class="skeleton-avatar" data-v-8c6ab554></div><div class="skeleton-content" data-v-8c6ab554><div class="skeleton-line" data-v-8c6ab554></div><div class="skeleton-line short" data-v-8c6ab554></div></div><div class="skeleton-actions" data-v-8c6ab554><div class="skeleton-button" data-v-8c6ab554></div><div class="skeleton-button" data-v-8c6ab554></div></div>',3)])]))),128))])):t.filteredUsers.length===0?(c(),d("div",id,[e[30]||(e[30]=n("div",{class:"empty-icon","aria-hidden":"true"},"üë•",-1)),n("h3",rd,u(t.localFilters.search?"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã":"–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),1),n("p",ld,u(t.localFilters.search?`–ü–æ –∑–∞–ø—Ä–æ—Å—É "${t.localFilters.search}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫ –∏–ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.`:"–í —Å–∏—Å—Ç–µ–º–µ –µ—â—ë –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π."),1),t.activeFiltersCount>0?(c(),d("button",{key:0,onClick:e[15]||(e[15]=(...g)=>t.resetFilters&&t.resetFilters(...g)),class:"empty-action-btn"}," –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã ")):h("",!0)])):(c(),$(m,{key:2,items:t.filteredUsers,"item-height":o.viewOptions.compactView?80:120,"container-height":t.listHeight,class:"virtual-users-list",onItemClick:t.handleUserClick},{item:ue(({item:g,index:b})=>[(c(),$(r,{key:g.id,user:g,"is-selected":t.selectedUsers.some(L=>L.id===g.id),"compact-view":o.viewOptions.compactView,"can-edit-permissions":o.canEditPermissions,"can-delete":o.canDeleteUsers,"show-extended-metrics":!o.viewOptions.compactView,onSelect:t.handleUserSelect,onViewProfile:t.handleViewProfile,onEditPermissions:t.handleEditPermissions,onToggleHidden:t.handleToggleHidden,onViewAnalytics:t.handleViewAnalytics,onExportData:t.handleExportUserData,onDeleteUser:t.handleDeleteUser},null,8,["user","is-selected","compact-view","can-edit-permissions","can-delete","show-extended-metrics","onSelect","onViewProfile","onEditPermissions","onToggleHidden","onViewAnalytics","onExportData","onDeleteUser"]))]),_:1},8,["items","item-height","container-height","onItemClick"]))]),!o.loading&&o.pagination.total_pages>1?(c(),$(f,{key:2,"current-page":o.pagination.current_page,"total-pages":o.pagination.total_pages,"total-items":o.pagination.total,"per-page":o.pagination.per_page,onPageChange:t.handlePageChange,onPerPageChange:t.handlePerPageChange},null,8,["current-page","total-pages","total-items","per-page","onPageChange","onPerPageChange"])):h("",!0)],2)}const dd=j(Bc,[["render",cd],["__scopeId","data-v-8c6ab554"]]),ud={name:"AnalysisPanel",emits:["back","filter-change","export"],props:{user:{type:Object,default:null},activityData:{type:Object,default:()=>({})},filters:{type:Object,default:()=>({})},timeRange:{type:String,default:"week"},isLoading:{type:Boolean,default:!1}},methods:{getStatusText(s){switch(s){case"online":return"–æ–Ω–ª–∞–π–Ω";case"away":return"–æ—Ç–æ—à—ë–ª";case"offline":return"–æ—Ñ—Ñ–ª–∞–π–Ω";default:return"–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}},formatDuration(s){const e=Math.floor(s/60),o=Math.floor(s%60);return`${e}:${o.toString().padStart(2,"0")}`},formatLastActivity(s){if(!s)return"–ù–∏–∫–æ–≥–¥–∞";const e=new Date(s),t=new Date-e,i=Math.floor(t/(1e3*60)),l=Math.floor(t/(1e3*60*60)),a=Math.floor(t/(1e3*60*60*24));return i<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":i<60?`${i} –º–∏–Ω –Ω–∞–∑–∞–¥`:l<24?`${l} —á –Ω–∞–∑–∞–¥`:a<7?`${a} –¥ –Ω–∞–∑–∞–¥`:e.toLocaleDateString("ru-RU")}}},md={class:"analysis-panel"},gd={class:"analysis-header"},fd={class:"user-summary"},hd={class:"user-avatar"},vd=["src","alt"],yd={key:1,class:"avatar-placeholder"},pd={class:"user-info"},bd={class:"user-email"},_d={class:"user-status"},wd={key:0,class:"admin-badge"},Cd={class:"header-actions"},kd={class:"analysis-content"},Sd={class:"stats-section"},xd={class:"stats-grid"},Md={class:"stat-card"},Ad={class:"stat-value"},Ed={class:"stat-card"},Td={class:"stat-value"},Ld={class:"stat-card"},Dd={class:"stat-value"},Id={class:"stat-card"},Pd={class:"stat-value"},Nd={class:"activity-section"},Ud={class:"last-activity"},Fd={key:0,class:"departments-section"},Bd={class:"departments-list"};function Rd(s,e,o,t,i,l){return c(),d("div",md,[n("div",gd,[n("div",fd,[n("div",hd,[o.user.avatar?(c(),d("img",{key:0,src:o.user.avatar,alt:`–ê–≤–∞—Ç–∞—Ä ${o.user.name}`},null,8,vd)):(c(),d("div",yd,u(o.user.name.charAt(0)),1))]),n("div",pd,[n("h2",null,u(o.user.name),1),n("p",bd,u(o.user.email),1),n("div",_d,[n("span",{class:U(`status-${o.user.status}`)},u(l.getStatusText(o.user.status)),3),o.user.is_admin?(c(),d("span",wd,"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä")):h("",!0)])])]),n("div",Cd,[n("button",{onClick:e[0]||(e[0]=a=>s.$emit("back")),class:"back-btn"},"‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É")])]),n("div",kd,[n("div",Sd,[e[5]||(e[5]=n("h3",null,"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1)),n("div",xd,[n("div",Md,[n("div",Ad,u(o.user.activity_stats?.total_actions||0),1),e[1]||(e[1]=n("div",{class:"stat-label"},"–í—Å–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–π",-1))]),n("div",Ed,[n("div",Td,u(o.user.activity_stats?.total_sessions||0),1),e[2]||(e[2]=n("div",{class:"stat-label"},"–°–µ—Å—Å–∏–π",-1))]),n("div",Ld,[n("div",Dd,u(l.formatDuration(o.user.activity_stats?.avg_session_duration||0)),1),e[3]||(e[3]=n("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω—è—è —Å–µ—Å—Å–∏—è",-1))]),n("div",Id,[n("div",Pd,u(o.user.activity_stats?.activity_score||0)+"/100",1),e[4]||(e[4]=n("div",{class:"stat-label"},"–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",-1))])])]),n("div",Nd,[e[6]||(e[6]=n("h3",null,"üïí –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",-1)),n("div",Ud,[n("p",null,u(l.formatLastActivity(o.user.activity_stats?.last_activity)),1)])]),o.user.departments&&o.user.departments.length>0?(c(),d("div",Fd,[e[7]||(e[7]=n("h3",null,"üè¢ –û—Ç–¥–µ–ª—ã",-1)),n("div",Bd,[(c(!0),d(H,null,W(o.user.departments,a=>(c(),d("span",{key:a.id,class:"department-tag",style:ie({backgroundColor:a.color})},u(a.name),5))),128))])])):h("",!0),e[8]||(e[8]=n("div",{class:"placeholder-note"},[n("strong",null,"üöß –°–ª–µ–¥—É—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:"),n("ul",null,[n("li",null,"–ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏"),n("li",null,"–ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"),n("li",null,"–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"),n("li",null,"–≠–∫—Å–ø–æ—Ä—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏")])],-1))])])}const Od=j(ud,[["render",Rd],["__scopeId","data-v-15fd9d64"]]),Vd={name:"ManagementPanel",emits:["back","permissions-change","bulk-update"],props:{selectedUsers:{type:Array,default:()=>[]},allUsers:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]},auditLog:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},canEditPermissions:{type:Boolean,default:!1}},methods:{handleBulkPermissions(){this.$emit("bulk-update","change_permissions",{is_admin:!1,department_id:369})}}},zd={class:"management-panel"},Hd={class:"panel-placeholder"},jd={key:0,class:"selected-info"},Wd={class:"selected-list"},qd={class:"user-name"},$d={class:"user-email"},Xd={class:"placeholder-actions"};function Kd(s,e,o,t,i,l){return c(),d("div",zd,[n("div",Hd,[e[2]||(e[2]=n("div",{class:"placeholder-icon"},"‚öôÔ∏è",-1)),e[3]||(e[3]=n("h3",null,"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏",-1)),e[4]||(e[4]=n("p",null,"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä–æ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),e[5]||(e[5]=n("div",{class:"placeholder-note"},[n("strong",null,"–°—Ç–∞—Ç—É—Å:"),X(" –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (TASK-089 - –≠—Ç–∞–ø 5) ")],-1)),o.selectedUsers.length>0?(c(),d("div",jd,[n("h4",null,"–í—ã–±—Ä–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: "+u(o.selectedUsers.length),1),n("div",Wd,[(c(!0),d(H,null,W(o.selectedUsers.slice(0,3),a=>(c(),d("div",{key:a.id,class:"selected-user"},[n("span",qd,u(a.name),1),n("span",$d,u(a.email),1)]))),128))])])):h("",!0),n("div",Xd,[n("button",{onClick:e[0]||(e[0]=a=>s.$emit("back")),class:"back-btn"},"‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É"),o.selectedUsers.length>0?(c(),d("button",{key:0,onClick:e[1]||(e[1]=(...a)=>l.handleBulkPermissions&&l.handleBulkPermissions(...a)),class:"permissions-btn"}," –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ ("+u(o.selectedUsers.length)+") ",1)):h("",!0)])])])}const Jd=j(Vd,[["render",Kd],["__scopeId","data-v-7dfddba5"]]),Gd={name:"UnifiedUserManagement",components:{DrillDownNavigation:Ii,ContextSidebar:gl,UserListPanel:dd,AnalysisPanel:Od,ManagementPanel:Jd},props:{config:{type:Object,default:()=>({enablePersistence:!0,enableKeyboardShortcuts:!0,defaultView:"global"})}},setup(s){console.log("[UnifiedUserManagement] Component loaded successfully",s.config);const e=x("global"),o=x(null),t=x(!1),i=x([{id:1,name:"–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",email:"ivan@example.com",departments:[{id:369,name:"–ë–∏—Ç—Ä–∏–∫—Å24 –æ—Ç–¥–µ–ª",color:"#2196F3"}],is_admin:!0,activity_stats:{total_actions:156,last_activity:new Date().toISOString(),activity_score:85},status:"online"},{id:2,name:"–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤",email:"petr@example.com",departments:[{id:366,name:"–°–µ–∫—Ç–æ—Ä 1–°",color:"#4CAF50"}],is_admin:!1,activity_stats:{total_actions:89,last_activity:new Date(Date.now()-864e5).toISOString(),activity_score:67},status:"away"},{id:3,name:"–ê–Ω–Ω–∞ –°–∏–¥–æ—Ä–æ–≤–∞",email:"anna@example.com",departments:[],is_admin:!1,activity_stats:{total_actions:23,last_activity:new Date(Date.now()-6048e5).toISOString(),activity_score:35},status:"offline"}]),l=x({search:"",department_ids:[],activity_filter:"all",sort_by:"last_activity",sort_order:"desc"}),a=x([{id:"total_users",label:"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",value:i.value.length,change:5.2},{id:"active_users",label:"–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è",value:i.value.filter(C=>C.status==="online").length,change:12.1},{id:"new_users",label:"–ù–æ–≤—ã—Ö —Å–µ–≥–æ–¥–Ω—è",value:1,change:-2.3}]),r=y(()=>{const C=[{id:"global",label:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",icon:"UsersIcon",action:()=>m("global")}];return e.value==="user"&&o.value&&C.push({id:`user-${o.value.id}`,label:o.value.name,icon:"UserIcon",action:()=>f(o.value)}),e.value==="management"&&C.push({id:"management",label:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏",icon:"SettingsIcon",action:()=>m("management")}),C}),m=(C,A={})=>{e.value=C,A.user&&(o.value=A.user),console.log(`[UnifiedUserManagement] Switched to context: ${C}`,A)},f=C=>{o.value=C,m("user",{user:C})};return{currentContext:e,selectedUser:o,loading:t,users:i,filters:l,globalMetrics:a,breadcrumbs:r,handleUserSelect:C=>{f(C)},handleBreadcrumbNavigate:C=>{C.action&&C.action()},handleGoBack:()=>{(e.value==="user"||e.value==="management")&&(m("global"),o.value=null),console.log("[UnifiedUserManagement] Returned to global context")},handleMetricClick:C=>{console.log("Metric clicked:",C)}}}},Yd={class:"unified-user-management"},Qd={class:"management-grid"},Zd={class:"main-content-area"};function eu(s,e,o,t,i,l){const a=q("DrillDownNavigation"),r=q("ContextSidebar"),m=q("UserListPanel"),f=q("AnalysisPanel"),g=q("ManagementPanel");return c(),d("div",Yd,[Q(a,{breadcrumbs:t.breadcrumbs,"is-loading":t.loading,onNavigate:t.handleBreadcrumbNavigate,onBack:t.handleGoBack},null,8,["breadcrumbs","is-loading","onNavigate","onBack"]),n("div",Qd,[Q(r,{context:t.currentContext,"global-metrics":t.globalMetrics,"selected-user":t.selectedUser,onMetricClick:t.handleMetricClick},null,8,["context","global-metrics","selected-user","onMetricClick"]),n("div",Zd,[t.currentContext==="global"?(c(),$(m,{key:0,users:t.users,loading:t.loading,pagination:{current_page:1,total:t.users.length,total_pages:1},filters:t.filters,"can-edit-permissions":!0,"can-delete":!1,onUserSelect:t.handleUserSelect},null,8,["users","loading","pagination","filters","onUserSelect"])):t.currentContext==="user"?(c(),$(f,{key:1,user:t.selectedUser,onBack:t.handleGoBack},null,8,["user","onBack"])):t.currentContext==="management"?(c(),$(g,{key:2,onBack:t.handleGoBack},null,8,["onBack"])):h("",!0)])])])}const tu=j(Gd,[["render",eu],["__scopeId","data-v-953cd27b"]]),ou={name:"UsersManagementPage",components:{UnifiedUserManagement:tu},setup(){const s=Ne();return se(async()=>{try{if(!(await De.checkAccess()).allowed){s.push("/");return}if(!await De.getCurrentUser()){s.push("/");return}console.log("[UsersManagementPage] Access granted - loading unified interface")}catch(e){console.error("[UsersManagementPage] Access check failed:",e),s.push("/")}}),{}}},nu={class:"users-management-page"};function su(s,e,o,t,i,l){const a=q("UnifiedUserManagement");return c(),d("div",nu,[Q(a,{config:{enablePersistence:!0,enableKeyboardShortcuts:!0,defaultView:"global"}})])}const au=j(ou,[["render",su],["__scopeId","data-v-3ef05244"]]);class Y{static async getCacheStatus(){try{const e=be("/api/admin/cache-status.php");console.log("[CacheManagementService] Fetching cache status from:",e);const o=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("[CacheManagementService] Response status:",o.status),!o.ok){const i=await o.text();throw console.error("[CacheManagementService] HTTP error:",i),new Error(`HTTP error! status: ${o.status}, message: ${i}`)}const t=await o.json();if(console.log("[CacheManagementService] API result:",t),t.success){let i=t.modules||[];console.log("[CacheManagementService] Modules from API:",i.length,i),i.length===0&&(console.log("[CacheManagementService] Using mock data for UI demonstration"),i=this.getMockModules(),console.log("[CacheManagementService] Mock modules:",i.length));const l=this.categorizeAndSortModules(i);return console.log("[CacheManagementService] Categorized result:",l),l}else throw new Error(t.error||"Failed to get cache status")}catch(e){console.error("[CacheManagementService] Error getting cache status:",e),console.log("[CacheManagementService] Using mock data due to API error");const o=this.getMockModules(),t=this.categorizeAndSortModules(o);return console.log("[CacheManagementService] Mock categorized result:",t),t}}static async clearCache(e){try{const o=be("/api/admin/cache-clear.php"),t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,confirm:!0})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();if(i.success)return!0;throw new Error(i.error||"Failed to clear cache")}catch(o){throw console.error("[CacheManagementService] Error clearing cache:",o),o}}static async getCacheStats(){try{const e=be("/api/admin/cache-stats.php"),o=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const t=await o.json();if(t.success)return t.stats||{};throw new Error(t.error||"Failed to get cache stats")}catch(e){throw console.error("[CacheManagementService] Error getting cache stats:",e),e}}static formatCacheSize(e){if(e===0)return"0 B";const o=1024,t=["B","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(o));return Math.round(e/Math.pow(o,i)*100)/100+" "+t[i]}static categorizeAndSortModules(e,o={}){const t=this.generateCacheKey(e),i=this.getCachedResult(t);if(i&&!o.forceRefresh)return i;const l=performance.now(),a=this.performCategorization(e),r=performance.now();return a.metadata={processingTime:r-l,totalModules:e.length,primaryCount:a.primaryModules.length,secondaryCount:a.secondaryModules.length,cached:!1},this.setCachedResult(t,a),a}static performCategorization(e){const o=[],t=[];return e.forEach(i=>{this.validateModule(i),this.PRIMARY_MODULE_IDS.includes(i.id)?o.push({...i,category:"primary",priority:this.PRIMARY_MODULE_PRIORITIES[i.id]||999}):t.push({...i,category:"secondary",groupType:this.getModuleType(i.id)})}),{primaryModules:this.sortPrimaryModules(o),secondaryModules:this.sortSecondaryModules(t)}}static sortPrimaryModules(e){return e.sort((o,t)=>{const i=this.PRIMARY_MODULE_PRIORITIES[o.id]||999,l=this.PRIMARY_MODULE_PRIORITIES[t.id]||999;return i-l})}static sortSecondaryModules(e){return e.sort((o,t)=>{const i=this.getModuleType(o.id),l=this.getModuleType(t.id);return i!==l?this.compareModuleTypes(i,l):o.name.localeCompare(t.name)})}static compareModuleTypes(e,o){const t=["users","activity","webhooks","other"],i=t.indexOf(e),l=t.indexOf(o);return(i===-1?999:i)-(l===-1?999:l)}static getModuleType(e){for(const[o,t]of Object.entries(this.SECONDARY_MODULE_TYPES))if(e.startsWith(t.prefix))return o;return e.includes("time-tracking")?"time-tracking":e.includes("graph")?"graphs":e.includes("dashboard")?"dashboards":"other"}static getModuleTypeConfig(e){return this.SECONDARY_MODULE_TYPES[e]||{title:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏",description:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã"}}static validateModule(e){if(!e||typeof e!="object")throw new Error("Module must be an object");if(!e.id||typeof e.id!="string")throw new Error("Module must have a valid id");if(!e.name||typeof e.name!="string")throw new Error("Module must have a valid name");return!0}static generateCacheKey(e){const o=e.map(t=>t.id).sort().join(",");return btoa(o).substring(0,16)}static getCachedResult(e){const o=this.categorizationCache.get(e);return o?Date.now()-o.timestamp>this.CACHE_TTL?(this.categorizationCache.delete(e),null):{...o.data,metadata:{...o.data.metadata,cached:!0}}:null}static setCachedResult(e,o){if(this.categorizationCache.set(e,{data:{...o,metadata:{...o.metadata,cached:!1}},timestamp:Date.now()}),this.categorizationCache.size>10){const t=this.categorizationCache.keys().next().value;this.categorizationCache.delete(t)}}static clearCategorizationCache(){this.categorizationCache.clear()}static invalidateCacheAfterModuleOperation(){this.clearCategorizationCache()}static getCategorizationStats(){return{cacheSize:this.categorizationCache.size,cacheEntries:Array.from(this.categorizationCache.entries()).map(([e,o])=>({key:e,age:Date.now()-o.timestamp,modulesCount:o.data.primaryModules.length+o.data.secondaryModules.length}))}}static formatTTL(e){return e<60?`${e} —Å–µ–∫`:e<3600?`${Math.floor(e/60)} –º–∏–Ω`:`${Math.floor(e/3600)} —á`}static formatCreationTime(e){return e<1e3?`${Math.round(e)}–º—Å`:e<6e4?`${Math.round(e/1e3*10)/10}—Å–µ–∫`:`${Math.round(e/6e4*10)/10}–º–∏–Ω`}static formatCacheHitRatio(e){return`${Math.round(e*100)}%`}static formatDataFreshness(e){return`${Math.round(e*100)}%`}static getExpiryColor(e){if(!e)return"gray";const o=Date.now()/1e3,t=(e-o)/3600;return t>2?"green":t>.5?"yellow":"red"}static getEfficiencyColor(e){return e>=.85?"green":e>=.7?"yellow":"red"}static getCreationTimeColor(e){return e<=2e3?"green":e<=1e4?"yellow":"red"}static getFreshnessColor(e){return e>=.9?"green":e>=.7?"yellow":"red"}static generateModuleMetadata(e){const o=Math.floor(Date.now()/1e3),t=e.metadata||{},i=this.PRIMARY_MODULE_IDS.includes(e.id);return{version:t.version||"1.0",module_id:e.id,module_name:e.name,created_at:t.created_at||o-Math.random()*86400*7,created_by:t.created_by||(Math.random()>.5?"system":"cron"),creation_time_ms:t.creation_time_ms||500+Math.random()*9500,last_accessed_at:t.last_accessed_at||o-Math.random()*3600,access_count:t.access_count||Math.floor(Math.random()*100)+1,expires_at:t.expires_at||o+(e.ttl||3600),ttl_seconds:e.ttl||3600,file_size_bytes:e.total_size||Math.floor(Math.random()*1e7)+1e6,compression_ratio:t.compression_ratio||.7+Math.random()*.3,data_version:t.data_version||`2026.01.12.v${Math.floor(Math.random()*10)+1}`,source_params:t.source_params||{period:i?Math.random()>.5?"weeks":"months":"default",sector_id:e.id.includes("sector-1c")?"1c":"all",filters:Math.random()>.5?["active_only"]:[],limit:Math.floor(Math.random()*1e3)+500},performance_metrics:t.performance_metrics||{avg_response_time_ms:20+Math.random()*80,cache_hit_ratio:.7+Math.random()*.3,data_freshness_score:.8+Math.random()*.2}}}static getMockModules(){const e=Math.floor(Date.now()/1e3);return[{id:"dashboard-sector-1c",name:"–î–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",status:"active",file_count:5,total_size:1024e3,ttl:600,created_at:e-7200,expires_at:e+1800,cache_dir:"api/cache/dashboard-sector-1c"},{id:"graph-state",name:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è",status:"active",file_count:3,total_size:512e3,ttl:3600,created_at:e-3600,expires_at:e+7200,cache_dir:"api/cache/graph-state"},{id:"graph-admission-closure-weeks",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–µ–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (4 –Ω–µ–¥–µ–ª–∏)",status:"active",file_count:8,total_size:2048e3,ttl:300,created_at:e-1800,expires_at:e+120,cache_dir:"api/cache/graph-admission-closure/weeks"},{id:"graph-admission-closure-months",name:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–µ–º–∞/–∑–∞–∫—Ä—ã—Ç–∏–π 1–° (3 –º–µ—Å—è—Ü–∞)",status:"active",file_count:12,total_size:3072e3,ttl:300,created_at:e-3600,expires_at:e+240,cache_dir:"api/cache/graph-admission-closure/months"},{id:"time-tracking-default",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)",status:"active",file_count:4,total_size:768e3,ttl:300,created_at:e-900,expires_at:e+2100,cache_dir:"api/cache/time-tracking-sector-1c/default"},{id:"time-tracking-detailed",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:6,total_size:1536e3,ttl:120,created_at:e-600,expires_at:e+3540,cache_dir:"api/cache/time-tracking-sector-1c/detailed"},{id:"time-tracking-summary",name:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (—Å–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º)",status:"active",file_count:2,total_size:384e3,ttl:600,created_at:e-1800,expires_at:e+4200,cache_dir:"api/cache/time-tracking-sector-1c/summary"},{id:"users-management-departments",name:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–æ—Ç–¥–µ–ª—ã)",status:"active",file_count:2,total_size:256e3,ttl:3600,created_at:e-7200,expires_at:e+28800,cache_dir:"api/cache/users-management/departments"},{id:"webhook-logs-api",name:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤ (API –∑–∞–ø—Ä–æ—Å—ã)",status:"active",file_count:15,total_size:512e4,ttl:300,created_at:e-3600,expires_at:e+2400,cache_dir:"api/cache/webhook-logs/api"}]}static enrichModulesWithMetadata(e){return e.map(o=>({...o,metadata:this.generateModuleMetadata(o)}))}}ke(Y,"PRIMARY_MODULE_IDS",["dashboard-sector-1c","graph-state","graph-admission-closure-weeks","graph-admission-closure-months","time-tracking-default","time-tracking-detailed","time-tracking-summary"]),ke(Y,"PRIMARY_MODULE_PRIORITIES",{"dashboard-sector-1c":1,"graph-state":2,"graph-admission-closure-weeks":3,"graph-admission-closure-months":4,"time-tracking-default":5,"time-tracking-detailed":6,"time-tracking-summary":7}),ke(Y,"SECONDARY_MODULE_TYPES",{users:{prefix:"users-management",title:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",description:"–ú–æ–¥—É–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –æ—Ç–¥–µ–ª–∞–º–∏"},activity:{prefix:"user-activity",title:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",description:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},webhooks:{prefix:"webhook-logs",title:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",description:"–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±—Ö—É–∫–æ–≤"}}),ke(Y,"categorizationCache",new Map),ke(Y,"CACHE_TTL",3e4);function iu(s){const e=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())),o=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-o);const t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}class nt{static async createCache(e,o=null,t={}){try{const i=be("/api/admin/cache-create.php"),l=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({module_id:e,mode:o,params:t})});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.error||`HTTP error! status: ${l.status}`)}const a=await l.json();if(a.success)return a;throw new Error(a.error||"Failed to create cache")}catch(i){throw console.error("[CacheCreationService] Error creating cache:",i),i}}static async getCreationStatus(e){try{const o=be(`/api/admin/cache-create-status.php?task_id=${e}`),t=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();if(i.success)return i;throw new Error(i.error||"Failed to get creation status")}catch(o){throw console.error("[CacheCreationService] Error getting creation status:",o),o}}static getDefaultParams(e){if(e.includes("graph-admission-closure"))if((e.includes("weeks")?"weeks":"months")==="weeks"){const t=new Date,i=t.getUTCFullYear(),l=iu(t),a=new Date(i,0,1+(l-1)*7),r=a.getUTCDay(),m=a.getUTCDate()-r+(r===0?-6:1);a.setUTCDate(m),a.setUTCHours(0,0,0,0);const f=new Date(a);return f.setUTCDate(a.getUTCDate()+6),f.setUTCHours(23,59,59,999),{product:"1C",periodMode:"weeks",weekStartUtc:a.toISOString(),weekEndUtc:f.toISOString(),includeTickets:!0,includeNewTicketsByStages:!0,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!0,useCache:!0,forceRefresh:!0}}else return{product:"1C",periodMode:"months",includeTickets:!0,includeNewTicketsByStages:!1,includeCarryoverTickets:!0,includeCarryoverTicketsByDuration:!1};if(e.includes("dashboard-sector-1c"))return{forceRefresh:!0,ttl:600};if(e.includes("graph-state"))return{type:"current",forceRefresh:!0,ttl:3600};if(e.includes("time-tracking")){const o=e.includes("detailed")?"detailed":e.includes("summary")?"summary":"default";return{product:"1C",includeTaskDetails:o==="detailed",summary:o==="summary"}}return{}}}class Je{static notifyCacheCreationStarted(e){this.showNotification({content:`–ù–∞—á–∞—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}"...`,type:"info",autoHideDelay:3e3})}static notifyCacheCreationSuccess(e){this.showNotification({content:`‚úÖ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`,type:"success",autoHideDelay:5e3})}static notifyCacheCreationError(e,o){this.showNotification({content:`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è "${e}": ${o}`,type:"error",autoHideDelay:7e3})}static notifyCacheUpdated(e,o="auto"){const t=o==="manual"?"–≤—Ä—É—á–Ω—É—é":"–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏";this.showNotification({content:`üîÑ –ö–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}" –æ–±–Ω–æ–≤–ª—ë–Ω ${t}`,type:"info",autoHideDelay:4e3})}static notifyCacheUsed(e){this.showNotification({content:`‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–µ—à –¥–ª—è –º–æ–¥—É–ª—è "${e}"`,type:"success",autoHideDelay:3e3})}static showNotification(e){typeof BX<"u"&&BX.UI&&BX.UI.Notification?BX.UI.Notification.Center.notify({content:e.content,autoHideDelay:e.autoHideDelay||3e3}):console.log("[CacheNotification]",e.content)}}const bf=Object.freeze(Object.defineProperty({__proto__:null,CacheNotificationService:Je},Symbol.toStringTag,{value:"Module"})),ru={name:"CacheCreateProgress",props:{progress:{type:Number,required:!0,validator:s=>s>=0&&s<=100},message:{type:String,default:"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞..."}}},lu={class:"cache-create-progress"},cu={class:"progress-bar"},du={class:"progress-text"};function uu(s,e,o,t,i,l){return c(),d("div",lu,[n("div",cu,[n("div",{class:"progress-fill",style:ie({width:o.progress+"%"})},null,4)]),n("div",du,u(o.progress)+"% - "+u(o.message),1)])}const mu=j(ru,[["render",uu],["__scopeId","data-v-7071de3b"]]),gu={name:"CacheCreateModal",components:{CacheCreateProgress:mu},props:{module:{type:Object,required:!0}},emits:["close","create"],setup(s,{emit:e}){const o=x(!1),t=x(0),i=x(""),l=x(null),a=x(""),r=y(()=>s.module.id.includes("graph-admission-closure")||s.module.id.includes("time-tracking")),m=y(()=>s.module.id.includes("graph-admission-closure")?["months","weeks"]:s.module.id.includes("time-tracking")?["default","detailed","summary"]:[]),f=()=>{e("close")},g=L=>{L.preventDefault(),L.stopPropagation(),L.target===L.currentTarget&&f()},b=async()=>{o.value=!0,t.value=0,i.value="–ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–µ—à–∞...";try{let L={};if(a.value.trim())try{L=JSON.parse(a.value)}catch{throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")}else L=nt.getDefaultParams(s.module.id);Je.notifyCacheCreationStarted(s.module.name),t.value=25,i.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Bitrix24...";const M=await nt.createCache(s.module.id,l.value,L);t.value=75,i.value="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∞...",await new Promise(C=>setTimeout(C,500)),t.value=100,i.value="–ö–µ—à —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",Je.notifyCacheCreationSuccess(s.module.name),setTimeout(()=>{e("create",M),f()},1e3)}catch(L){console.error("[CacheCreateModal] Error creating cache:",L),Je.notifyCacheCreationError(s.module.name,L.message),o.value=!1}};return se(()=>{m.value.length>0&&(l.value=m.value[0]);const L=nt.getDefaultParams(s.module.id);a.value=JSON.stringify(L,null,2)}),{creating:o,progress:t,progressMessage:i,selectedMode:l,paramsJson:a,supportsModes:r,availableModes:m,close:f,handleOverlayClick:g,handleCreate:b}}},fu={class:"modal-header"},hu={class:"modal-body"},vu={key:1,class:"create-form"},yu={key:0,class:"form-group"},pu=["value"],bu={class:"form-group"},_u={class:"modal-footer"},wu=["disabled"],Cu=["disabled"],ku={key:0},Su={key:1};function xu(s,e,o,t,i,l){const a=q("CacheCreateProgress");return c(),$(rt,{to:"body"},[n("div",{class:"modal-overlay",onClick:e[6]||(e[6]=(...r)=>t.handleOverlayClick&&t.handleOverlayClick(...r))},[n("div",{class:"modal-content",onClick:e[5]||(e[5]=ae(()=>{},["stop"])),style:{"pointer-events":"auto"}},[n("div",fu,[n("h2",null,"–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞: "+u(o.module.name),1),n("button",{onClick:e[0]||(e[0]=(...r)=>t.close&&t.close(...r)),class:"btn-close"},"√ó")]),n("div",hu,[t.creating?(c(),$(a,{key:0,progress:t.progress,message:t.progressMessage},null,8,["progress","message"])):(c(),d("div",vu,[t.supportsModes?(c(),d("div",yu,[e[7]||(e[7]=n("label",null,"–†–µ–∂–∏–º –∫–µ—à–∞:",-1)),Z(n("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>t.selectedMode=r),class:"form-control"},[(c(!0),d(H,null,W(t.availableModes,r=>(c(),d("option",{key:r,value:r},u(r),9,pu))),128))],512),[[Ae,t.selectedMode]])])):h("",!0),n("div",bu,[e[8]||(e[8]=n("label",null,"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):",-1)),Z(n("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>t.paramsJson=r),placeholder:'{"product": "1C", ...}',rows:"5",class:"form-control"},null,512),[[Re,t.paramsJson]]),e[9]||(e[9]=n("small",{class:"form-text"},"–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",-1))])]))]),n("div",_u,[n("button",{onClick:e[3]||(e[3]=(...r)=>t.close&&t.close(...r)),class:"btn-cancel",disabled:t.creating},"–û—Ç–º–µ–Ω–∞",8,wu),n("button",{onClick:e[4]||(e[4]=(...r)=>t.handleCreate&&t.handleCreate(...r)),disabled:t.creating,class:"btn-create"},[t.creating?(c(),d("span",ku,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",Su,"–°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],8,Cu)])])])])}const Mu=j(gu,[["render",xu],["__scopeId","data-v-1fa7d83b"]]),Au={name:"CacheCreateButton",components:{CacheCreateModal:Mu},props:{module:{type:Object,required:!0}},emits:["created"],setup(s,{emit:e}){const o=x(!1),t=x(!1);return{showModal:o,creating:t,openModal:()=>{o.value=!0},closeModal:()=>{o.value=!1},handleCreate:async r=>{t.value=!0;try{e("created",r)}finally{t.value=!1}}}}},Eu={class:"cache-create-button"},Tu=["disabled"],Lu={key:0},Du={key:1};function Iu(s,e,o,t,i,l){const a=q("CacheCreateModal");return c(),d("div",Eu,[n("button",{onClick:e[0]||(e[0]=(...r)=>t.openModal&&t.openModal(...r)),disabled:t.creating,class:U(["btn-create",{"btn-disabled":t.creating}])},[t.creating?(c(),d("span",Lu,"–°–æ–∑–¥–∞–Ω–∏–µ...")):(c(),d("span",Du,"‚ûï –°–æ–∑–¥–∞—Ç—å –∫–µ—à"))],10,Tu),t.showModal?(c(),$(a,{key:0,module:o.module,onClose:t.closeModal,onCreate:t.handleCreate},null,8,["module","onClose","onCreate"])):h("",!0)])}const Pu=j(Au,[["render",Iu],["__scopeId","data-v-45e7d308"]]);class re{static success(e,o,t={}){this.show("success",e,o,t)}static error(e,o,t={}){this.show("error",e,o,t)}static warning(e,o,t={}){this.show("warning",e,o,t)}static info(e,o,t={}){this.show("info",e,o,t)}static show(e,o,t,i={}){const l={autoHideDelay:i.autoHideDelay||5e3,position:i.position||"top-right",...i};this.isBitrix24Available()?this.showBitrix24Notification(e,o,t,l):this.showFallbackNotification(e,o,t,l)}static isBitrix24Available(){return typeof window<"u"&&window.BX&&window.BX.UI&&window.BX.UI.Notification&&window.BX.UI.Notification.Center&&typeof window.BX.UI.Notification.Center.notify=="function"}static showBitrix24Notification(e,o,t,i){try{const a={success:"success",error:"error",warning:"warning",info:"info"}[e]||"info",r=o?`${o}: ${t}`:t;window.BX.UI.Notification.Center.notify({content:r,autoHideDelay:i.autoHideDelay,category:`cache-management-${e}`,position:i.position}),console.log(`[NotificationSystem] Bitrix24 notification shown: ${e}`,{title:o,message:t,config:i})}catch(l){console.error("[NotificationSystem] Error showing Bitrix24 notification:",l),this.showFallbackNotification(e,o,t,i)}}static showFallbackNotification(e,o,t,i){if("Notification"in window&&Notification.permission==="granted")try{const l=new Notification(o||"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",{body:t,icon:this.getIconForType(e),tag:`cache-management-${e}`});setTimeout(()=>{l.close()},i.autoHideDelay),console.log(`[NotificationSystem] Browser notification shown: ${e}`,{title:o,message:t});return}catch(l){console.warn("[NotificationSystem] Browser notification failed:",l)}this.showCustomNotification(e,o,t,i)}static showCustomNotification(e,o,t,i){let l=document.getElementById("notification-container");if(!l){l=document.createElement("div"),l.id="notification-container",l.className="notification-container",document.body.appendChild(l);const m=document.createElement("style");m.textContent=this.getNotificationStyles(),document.head.appendChild(m)}const a=document.createElement("div");a.className=`custom-notification notification-${e}`,a.innerHTML=`
      <div class="notification-content">
        <div class="notification-title">${o||""}</div>
        <div class="notification-message">${t}</div>
      </div>
      <button class="notification-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">√ó</button>
    `,a.querySelector(".notification-close").addEventListener("click",()=>{this.removeCustomNotification(a)}),l.appendChild(a),setTimeout(()=>{this.removeCustomNotification(a)},i.autoHideDelay),console.log(`[NotificationSystem] Custom notification shown: ${e}`,{title:o,message:t})}static removeCustomNotification(e){e&&e.parentNode&&(e.classList.add("notification-hiding"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}static getIconForType(e){const o={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};return o[e]||o.info}static getNotificationStyles(){return`
      .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        pointer-events: none;
      }

      .custom-notification {
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 10px;
        min-width: 300px;
        max-width: 500px;
        pointer-events: auto;
        opacity: 0;
        transform: translateX(100%);
        animation: notificationSlideIn 0.3s ease forwards;
        border-left: 4px solid;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        padding: 16px;
        gap: 12px;
      }

      .custom-notification.notification-success {
        border-left-color: #28a745;
      }

      .custom-notification.notification-error {
        border-left-color: #dc3545;
      }

      .custom-notification.notification-warning {
        border-left-color: #ffc107;
      }

      .custom-notification.notification-info {
        border-left-color: #17a2b8;
      }

      .notification-content {
        flex: 1;
      }

      .notification-title {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
        color: #333;
      }

      .notification-message {
        font-size: 13px;
        color: #666;
        line-height: 1.4;
      }

      .notification-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #999;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        flex-shrink: 0;
      }

      .notification-close:hover {
        color: #333;
      }

      .notification-hiding {
        animation: notificationSlideOut 0.3s ease forwards;
      }

      @keyframes notificationSlideIn {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes notificationSlideOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(100%);
        }
      }

      @media (max-width: 768px) {
        .notification-container {
          left: 10px;
          right: 10px;
          top: 10px;
        }

        .custom-notification {
          min-width: auto;
          max-width: none;
        }
      }
    `}static clearAll(){try{this.isBitrix24Available()&&window.BX.UI.Notification.Center.clearAll&&window.BX.UI.Notification.Center.clearAll()}catch(o){console.warn("[NotificationSystem] Error clearing Bitrix24 notifications:",o)}const e=document.getElementById("notification-container");if(e&&(e.innerHTML=""),"Notification"in window&&"getNotifications"in Notification)try{Notification.getNotifications().forEach(t=>{t.tag&&t.tag.startsWith("cache-management-")&&t.close()})}catch(o){console.warn("[NotificationSystem] Error clearing browser notifications:",o)}}}re.show.bind(re);re.success.bind(re);re.error.bind(re);re.warning.bind(re);re.info.bind(re);let ne=null,he=null;const Be=class Be{static show(e={}){return new Promise((o,t)=>{he=o,ne||(ne=this.createModal(),document.body.appendChild(ne)),this.configureModal(e),this.showModal()})}static hide(){ne&&(this.hideModal(),he&&(he(!1),he=null))}static createModal(){const e=document.createElement("div");return e.className="cache-confirmation-modal",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","confirmation-title"),e.setAttribute("aria-describedby","confirmation-message"),e.innerHTML=`
      <div class="modal-backdrop" data-action="cancel"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="confirmation-title" class="modal-title"></h3>
          <button
            class="modal-close"
            data-action="cancel"
            aria-label="–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"
          >
            √ó
          </button>
        </div>

        <div class="modal-body">
          <div class="modal-icon">
            <span class="icon-symbol"></span>
          </div>
          <p id="confirmation-message" class="modal-message"></p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-cancel" data-action="cancel"></button>
          <button class="btn btn-confirm" data-action="confirm"></button>
        </div>
      </div>
    `,this.attachEventListeners(e),this.addStyles(),e}static configureModal(e){const{title:o="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",message:t="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ?",type:i="warning",confirmText:l="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",cancelText:a="–û—Ç–º–µ–Ω–∞",showCancel:r=!0}=e,m=ne.querySelector(".modal-title");m.textContent=o;const f=ne.querySelector(".modal-message");f.textContent=t;const g=ne.querySelector(".icon-symbol"),b={danger:"‚ö†Ô∏è",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è",success:"‚úÖ"};g.textContent=b[i]||b.warning;const L=ne.querySelector(".btn-cancel"),M=ne.querySelector(".btn-confirm");L.textContent=a,M.textContent=l,r?L.style.display="inline-block":L.style.display="none",ne.className=`cache-confirmation-modal modal-${i}`}static showModal(){document.body.style.overflow="hidden",ne.style.display="flex",ne.classList.add("modal-visible"),setTimeout(()=>{const e=ne.querySelector(".btn-confirm");e&&e.focus()},100),document.addEventListener("keydown",this.handleKeyDown)}static hideModal(){document.body.style.overflow="",ne.classList.remove("modal-visible"),document.removeEventListener("keydown",this.handleKeyDown),setTimeout(()=>{ne&&(ne.style.display="none")},300)}static attachEventListeners(e){e.addEventListener("click",o=>{const t=o.target.closest("[data-action]")?.getAttribute("data-action");t==="confirm"?this.handleConfirm():t==="cancel"&&this.handleCancel()})}static handleConfirm(){he&&(he(!0),he=null),this.hideModal()}static handleCancel(){he&&(he(!1),he=null),this.hideModal()}static handleTabNavigation(e){const t=ne.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),i=t[0],l=t[t.length-1];e.shiftKey?document.activeElement===i&&(e.preventDefault(),l.focus()):document.activeElement===l&&(e.preventDefault(),i.focus())}static addStyles(){if(document.getElementById("cache-confirmation-styles"))return;const e=document.createElement("style");e.id="cache-confirmation-styles",e.textContent=`
      .cache-confirmation-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        align-items: center;
        justify-content: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      .cache-confirmation-modal.modal-visible {
        display: flex;
      }

      .modal-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(2px);
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        z-index: 10001;
        animation: modalSlideIn 0.3s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px 16px;
        border-bottom: 1px solid #e0e0e0;
      }

      .modal-title {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: #333;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .modal-close:hover {
        background: #f0f0f0;
        color: #333;
      }

      .modal-body {
        padding: 24px;
        text-align: center;
      }

      .modal-icon {
        margin-bottom: 16px;
      }

      .icon-symbol {
        font-size: 48px;
        display: block;
      }

      .modal-message {
        margin: 0;
        font-size: 16px;
        color: #555;
        line-height: 1.5;
      }

      .modal-footer {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        padding: 16px 24px 24px;
        border-top: 1px solid #e0e0e0;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
        min-width: 80px;
      }

      .btn:focus {
        outline: 2px solid #007bff;
        outline-offset: 2px;
      }

      .btn-cancel {
        background: #f8f9fa;
        color: #6c757d;
        border: 1px solid #dee2e6;
      }

      .btn-cancel:hover {
        background: #e9ecef;
        border-color: #adb5bd;
      }

      .btn-confirm {
        background: #007bff;
        color: white;
      }

      .btn-confirm:hover {
        background: #0056b3;
      }

      /* –¢–∏–ø—ã –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
      .modal-danger .btn-confirm {
        background: #dc3545;
      }

      .modal-danger .btn-confirm:hover {
        background: #c82333;
      }

      .modal-warning .btn-confirm {
        background: #ffc107;
        color: #212529;
      }

      .modal-warning .btn-confirm:hover {
        background: #e0a800;
      }

      .modal-info .btn-confirm {
        background: #17a2b8;
      }

      .modal-info .btn-confirm:hover {
        background: #138496;
      }

      .modal-success .btn-confirm {
        background: #28a745;
      }

      .modal-success .btn-confirm:hover {
        background: #1e7e34;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
      @media (max-width: 480px) {
        .modal-content {
          margin: 20px;
          width: calc(100% - 40px);
        }

        .modal-header,
        .modal-body,
        .modal-footer {
          padding-left: 20px;
          padding-right: 20px;
        }

        .modal-footer {
          flex-direction: column-reverse;
        }

        .btn {
          width: 100%;
        }
      }

      /* –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å */
      @media (prefers-reduced-motion: reduce) {
        .modal-content,
        .modal-close,
        .btn {
          animation: none;
          transition: none;
        }
      }

      /* –í—ã—Å–æ–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç */
      @media (prefers-contrast: high) {
        .modal-content {
          border: 2px solid #000;
        }

        .btn-cancel {
          border: 2px solid #000;
        }

        .btn-confirm {
          border: 2px solid #000;
        }
      }
    `,document.head.appendChild(e)}};ke(Be,"handleKeyDown",e=>{switch(e.key){case"Enter":e.preventDefault(),Be.handleConfirm();break;case"Escape":e.preventDefault(),Be.handleCancel();break;case"Tab":Be.handleTabNavigation(e);break}});let Pe=Be;Pe.show.bind(Pe);Pe.hide.bind(Pe);const Nu={name:"CacheModuleCard",components:{CacheCreateButton:Pu},props:{module:{type:Object,required:!0,validator:s=>s&&typeof s.id=="string"&&typeof s.name=="string"},isPrimary:{type:Boolean,default:!1},priority:{type:Number,default:999},groupType:{type:String,default:null}},emits:["clear","refresh","details"],setup(s,{emit:e}){const o=x(!1),t=x(!1),i=x(!1),l=x(!1),a=_=>{if(!_.target.closest(".action-button"))switch(_.key){case"Enter":case" ":_.preventDefault();const z=_.currentTarget.querySelector(".action-button:not([disabled])");z&&z.focus();break}};se(()=>{const _=()=>{l.value=window.innerWidth<768};_(),window.addEventListener("resize",_);const z=document.querySelector(`[data-module-id="${s.module.id}"]`);z&&z.addEventListener("keydown",a)}),Qe(()=>{const _=document.querySelector(`[data-module-id="${s.module.id}"]`);_&&_.removeEventListener("keydown",a)});const r=y(()=>({"cache-module-card":!0,"primary-module":s.isPrimary,"secondary-module":!s.isPrimary,"high-priority":s.priority<=3,"expiring-soon":A.value,"empty-cache":M.value,loading:o.value||t.value,[Ce.value]:!0})),m=y(()=>s.isPrimary?"üèÜ":{users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"}[s.groupType]||"üîß"),f=y(()=>({"primary-icon":s.isPrimary,"secondary-icon":!s.isPrimary})),g=y(()=>s.isPrimary?"–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å":s.groupType?Y.getModuleTypeConfig(s.groupType).title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞":""),b=y(()=>s.priority?`priority-${s.priority}`:""),L=y(()=>`status-${s.module.status||"empty"}`),M=y(()=>(s.module.file_count||0)===0),C=y(()=>s.module.expires_at?new Date(s.module.expires_at*1e3)<=new Date:!1),A=y(()=>{if(!s.module.expires_at)return!1;const O=(new Date(s.module.expires_at*1e3)-new Date)/(1e3*60*60);return O>0&&O<=2}),P=y(()=>{const _=s.module.status;return _==="active"?"–ê–∫—Ç–∏–≤–µ–Ω":_==="expired"?"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω":_==="empty"?"–ü—É—Å—Ç":"–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"}),v=y(()=>Y.formatCacheSize(s.module.total_size||0)),T=y(()=>Y.formatTTL(s.module.ttl||0)),E=y(()=>{if(!s.module.cache_dir)return"";const _=s.module.cache_dir.split("/");return _.length>2?"..."+_.slice(-2).join("/"):s.module.cache_dir}),V=y(()=>s.module.metadata?.creation_time_ms?Y.formatCreationTime(s.module.metadata.creation_time_ms):"‚Äî"),B=y(()=>{if(!s.module.metadata?.last_accessed_at)return"‚Äî";const _=new Date(s.module.metadata.last_accessed_at*1e3),O=new Date-_;return O<6e4?"–¢–æ–ª—å–∫–æ —á—Ç–æ":O<36e5?`${Math.floor(O/6e4)} –º–∏–Ω –Ω–∞–∑–∞–¥`:_.toLocaleString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),D=y(()=>s.module.metadata?.access_count||0),p=y(()=>s.module.metadata?.performance_metrics?.cache_hit_ratio?Y.formatCacheHitRatio(s.module.metadata.performance_metrics.cache_hit_ratio):"‚Äî"),w=y(()=>s.module.metadata?.performance_metrics?.data_freshness_score?Y.formatDataFreshness(s.module.metadata.performance_metrics.data_freshness_score):"‚Äî"),N=y(()=>s.module.expires_at?`metric-${Y.getExpiryColor(s.module.expires_at)}`:""),I=y(()=>s.module.metadata?.creation_time_ms?`metric-${Y.getCreationTimeColor(s.module.metadata.creation_time_ms)}`:""),F=y(()=>s.module.metadata?.performance_metrics?.cache_hit_ratio?`metric-${Y.getEfficiencyColor(s.module.metadata.performance_metrics.cache_hit_ratio)}`:""),R=y(()=>s.module.metadata?.performance_metrics?.data_freshness_score?`metric-${Y.getFreshnessColor(s.module.metadata.performance_metrics.data_freshness_score)}`:""),K=y(()=>{if(!s.module.expires_at)return null;const _=new Date(s.module.expires_at*1e3);return Math.max(0,Math.floor((_-new Date)/1e3))}),me=y(()=>{if(K.value===null)return"‚Äî";if(K.value<=0)return"–ò—Å—Ç–µ–∫";const _=Math.floor(K.value/3600),z=Math.floor(K.value%3600/60),O=K.value%60;return _>0?`${_}—á ${z}–º`:z>0?`${z}–º ${O}—Å`:`${O}—Å`}),Ee=y(()=>K.value===null?"":K.value<=0||K.value<=1800?"metric-red":K.value<=7200?"metric-orange":"metric-green"),le=_=>{if(_===0)return"0 B";const z=1024,O=["B","KB","MB","GB","TB"],G=Math.floor(Math.log(_)/Math.log(z));return parseFloat((_/Math.pow(z,G)).toFixed(1))+" "+O[G]},we=_=>_<60?`${_}—Å`:_<3600?`${Math.floor(_/60)}–º`:_<86400?`${Math.floor(_/3600)}—á`:`${Math.floor(_/86400)}–¥`,S=y(()=>{if(M.value)return"empty";if(C.value)return"expired";const _=K.value;return _===null?"fresh":_<=0?"expired":_<=30*60*1e3?"critical":_<=2*60*60*1e3?"warning":"fresh"}),J=y(()=>{const _=S.value;return{fresh:"–°–≤–µ–∂–∏–π –∫–µ—à",warning:"–ò—Å—Ç–µ–∫–∞–µ—Ç —Å–∫–æ—Ä–æ",critical:"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç",expired:"–ü—Ä–æ—Å—Ä–æ—á–µ–Ω",empty:"–ö–µ—à –ø—É—Å—Ç"}[_]||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"}),Ce=y(()=>`cache-state-${S.value}`),Te=y(()=>({fresh:"üü¢",warning:"üü°",critical:"üî¥",expired:"‚ö´",empty:"‚ö™"})[S.value]||"‚ùì"),ye=y(()=>!M.value&&!o.value),Ue=y(()=>s.isPrimary&&!M.value),Le=y(()=>M.value?"–ö–µ—à –º–æ–¥—É–ª—è –ø—É—Å—Ç":`–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è ${s.module.name}`),Ze=y(()=>{if(!s.module.created_at)return"‚Äî";const _=new Date(s.module.created_at*1e3),z=new Date,O=z-_;if(O<6e4)return"–¢–æ–ª—å–∫–æ —á—Ç–æ";if(O<36e5){const te=Math.floor(O/6e4);return`${te} ${te===1?"–º–∏–Ω—É—Ç—É":te<5?"–º–∏–Ω—É—Ç—ã":"–º–∏–Ω—É—Ç"} –Ω–∞–∑–∞–¥`}if(_.toDateString()===z.toDateString())return`–°–µ–≥–æ–¥–Ω—è –≤ ${_.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`;const G=new Date(z);return G.setDate(G.getDate()-1),_.toDateString()===G.toDateString()?`–í—á–µ—Ä–∞ –≤ ${_.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:_.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),et=y(()=>{if(!s.module.expires_at)return"‚Äî";const _=new Date(s.module.expires_at*1e3),O=_-new Date;if(O<0)return`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω (${_.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})`;const G=Math.floor(O/6e4),te=Math.floor(G/60);return te>0?`${te} —á ${G%60} –º–∏–Ω`:G>0?`${G} –º–∏–Ω`:"–ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã"});return{clearing:o,creating:t,showDetailModal:i,isMobile:l,moduleClasses:r,moduleIcon:m,iconClass:f,moduleTypeText:g,priorityClass:b,statusClass:L,isEmpty:M,isExpired:C,isExpiringSoon:A,statusText:P,formattedSize:v,formattedTTL:T,shortCacheDir:E,formattedCreationTime:V,formattedLastAccess:B,accessCount:D,cacheEfficiency:p,dataFreshness:w,expiresClass:N,creationTimeClass:I,cacheEfficiencyClass:F,dataFreshnessClass:R,cacheState:S,cacheStateText:J,cacheStateClass:Ce,cacheStateIcon:Te,timeToExpiry:K,formatTimeToExpiry:me,timeToExpiryClass:Ee,formatBytes:le,formatTTL:we,canClear:ye,canShowDetails:Ue,clearButtonLabel:Le,formattedCreatedAt:Ze,formattedExpiresAt:et,handleClear:async()=>{if(ye.value)try{if(!await Pe.show({title:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",message:`–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${s.module.name}"?

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`,type:"danger",confirmText:"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à",cancelText:"–û—Ç–º–µ–Ω–∞"}))return;o.value=!0,await Y.clearCache(s.module.id),e("clear",s.module.id),re.success("–ö–µ—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω",`–ö–µ—à –º–æ–¥—É–ª—è "${s.module.name}" –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω`)}catch(_){console.error("[CacheModuleCard] Error clearing cache:",_),re.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–æ–¥—É–ª—è "${s.module.name}": ${_.message}`)}finally{o.value=!1}},handleCacheCreated:()=>{Y.invalidateCacheAfterModuleOperation(),e("refresh")},handleCreatingState:_=>{t.value=_},showDetails:()=>{i.value=!0,e("details",s.module)},closeDetails:()=>{i.value=!1}}}},Uu=["aria-labelledby","aria-describedby","data-module-id"],Fu={class:"card-header"},Bu={class:"module-identity"},Ru={class:"module-info"},Ou=["id"],Vu={class:"module-type"},zu={class:"header-meta"},Hu=["id"],ju={class:"card-content"},Wu={class:"data-grid",role:"region","aria-label":"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–µ—à–µ"},qu={class:"data-section statistics"},$u={class:"data-items"},Xu={class:"data-item"},Ku={class:"data-value"},Ju={class:"data-item"},Gu={class:"data-value"},Yu={key:0,class:"data-item full-width"},Qu=["title"],Zu={class:"data-section lifetime"},em={class:"data-items"},tm={class:"data-item"},om={class:"data-value"},nm={key:0,class:"data-item"},sm={class:"data-value"},am={key:1,class:"data-item"},im={class:"data-section cache-state"},rm={class:"section-header"},lm=["aria-label"],cm={class:"data-items"},dm={class:"data-value cache-state-text"},um={key:0,class:"data-section performance"},mm={class:"data-items"},gm={key:0,class:"data-item"},fm={key:1,class:"data-item"},hm={class:"data-value"},vm={key:2,class:"data-item"},ym={class:"data-value"},pm={key:3,class:"data-item"},bm={key:4,class:"data-item"},_m={key:5,class:"data-item"},wm={class:"data-value"},Cm={key:6,class:"data-item"},km={class:"data-value"},Sm={key:7,class:"data-item"},xm=["aria-label"],Mm={class:"primary-actions"},Am={class:"secondary-actions"},Em=["disabled","aria-label"],Tm={key:0,class:"button-content"},Lm={key:1,class:"button-content"},Dm={key:2,class:"button-content"},Im=["aria-label"],Pm={class:"detail-modal",role:"dialog","aria-modal":"true"},Nm={class:"modal-header"},Um={class:"modal-content"},Fm={class:"json-data"};function Bm(s,e,o,t,i,l){const a=q("CacheCreateButton");return c(),d("article",{class:U(["cache-module-card",t.moduleClasses]),role:"article","aria-labelledby":`module-${o.module.id}-title`,"aria-describedby":`module-${o.module.id}-status`,"data-module-id":o.module.id,tabindex:"0"},[n("div",Fu,[n("div",Bu,[n("div",{class:U(["module-icon",t.iconClass])},u(t.moduleIcon),3),n("div",Ru,[n("h3",{class:"module-name",id:`module-${o.module.id}-title`},u(o.module.name),9,Ou),n("span",Vu,u(t.moduleTypeText),1)])]),n("div",zu,[o.isPrimary&&o.priority?(c(),d("span",{key:0,class:U(["priority-badge",t.priorityClass])},u(o.priority),3)):h("",!0),n("span",{class:U(["status-badge",t.statusClass]),id:`module-${o.module.id}-status`,role:"status"},u(t.statusText),11,Hu)])]),n("div",ju,[n("div",Wu,[n("div",qu,[e[14]||(e[14]=n("div",{class:"section-header"},[n("span",{class:"section-icon","aria-hidden":"true"},"üìä"),n("h4",{class:"section-title"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],-1)),n("div",$u,[n("div",Xu,[e[11]||(e[11]=n("span",{class:"data-label"},"–§–∞–π–ª–æ–≤:",-1)),n("span",Ku,u(o.module.file_count||0),1)]),n("div",Ju,[e[12]||(e[12]=n("span",{class:"data-label"},"–†–∞–∑–º–µ—Ä:",-1)),n("span",Gu,u(t.formattedSize),1)]),o.module.cache_dir?(c(),d("div",Yu,[e[13]||(e[13]=n("span",{class:"data-label"},"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:",-1)),n("span",{class:"data-value cache-dir",title:o.module.cache_dir},u(t.shortCacheDir),9,Qu)])):h("",!0)])]),n("div",Zu,[e[18]||(e[18]=n("div",{class:"section-header"},[n("span",{class:"section-icon","aria-hidden":"true"},"‚è∞"),n("h4",{class:"section-title"},"–í—Ä–µ–º—è –∂–∏–∑–Ω–∏")],-1)),n("div",em,[n("div",tm,[e[15]||(e[15]=n("span",{class:"data-label"},"TTL:",-1)),n("span",om,u(t.formattedTTL),1)]),o.module.created_at?(c(),d("div",nm,[e[16]||(e[16]=n("span",{class:"data-label"},"–°–æ–∑–¥–∞–Ω:",-1)),n("span",sm,u(t.formattedCreatedAt),1)])):h("",!0),o.module.expires_at?(c(),d("div",am,[e[17]||(e[17]=n("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç:",-1)),n("span",{class:U(["data-value",t.expiresClass])},u(t.formattedExpiresAt),3)])):h("",!0)])]),n("div",im,[n("div",rm,[n("span",{class:"section-icon","aria-label":t.cacheStateText,"aria-hidden":"false"},u(t.cacheStateIcon),9,lm),e[19]||(e[19]=n("h4",{class:"section-title"},"–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–µ—à–∞",-1))]),n("div",cm,[n("div",{class:U(["data-item cache-state-indicator",t.cacheStateClass])},[e[20]||(e[20]=n("span",{class:"data-label"},"–°—Ç–∞—Ç—É—Å:",-1)),n("span",dm,u(t.cacheStateText),1)],2)])]),o.module.metadata||o.module.created_at?(c(),d("div",um,[e[29]||(e[29]=n("div",{class:"section-header"},[n("span",{class:"section-icon","aria-hidden":"true"},"‚ö°"),n("h4",{class:"section-title"},"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")],-1)),n("div",mm,[t.formattedCreationTime?(c(),d("div",gm,[e[21]||(e[21]=n("span",{class:"data-label"},"–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:",-1)),n("span",{class:U(["data-value",t.creationTimeClass])},u(t.formattedCreationTime),3)])):h("",!0),t.formattedLastAccess?(c(),d("div",fm,[e[22]||(e[22]=n("span",{class:"data-label"},"–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ—Å—Ç—É–ø:",-1)),n("span",hm,u(t.formattedLastAccess),1)])):h("",!0),t.accessCount!==null?(c(),d("div",vm,[e[23]||(e[23]=n("span",{class:"data-label"},"–û–±—Ä–∞—â–µ–Ω–∏–π:",-1)),n("span",ym,u(t.accessCount),1)])):h("",!0),t.cacheEfficiency?(c(),d("div",pm,[e[24]||(e[24]=n("span",{class:"data-label"},"–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:",-1)),n("span",{class:U(["data-value",t.cacheEfficiencyClass])},u(t.cacheEfficiency),3)])):h("",!0),t.dataFreshness?(c(),d("div",bm,[e[25]||(e[25]=n("span",{class:"data-label"},"–°–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:",-1)),n("span",{class:U(["data-value",t.dataFreshnessClass])},u(t.dataFreshness),3)])):h("",!0),o.module.total_size?(c(),d("div",_m,[e[26]||(e[26]=n("span",{class:"data-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:",-1)),n("span",wm,u(t.formatBytes(o.module.total_size)),1)])):h("",!0),o.module.ttl?(c(),d("div",Cm,[e[27]||(e[27]=n("span",{class:"data-label"},"TTL:",-1)),n("span",km,u(t.formatTTL(o.module.ttl)),1)])):h("",!0),t.timeToExpiry!==null?(c(),d("div",Sm,[e[28]||(e[28]=n("span",{class:"data-label"},"–ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑:",-1)),n("span",{class:U(["data-value",t.timeToExpiryClass])},u(t.formatTimeToExpiry),3)])):h("",!0)])])):h("",!0)])]),n("div",{class:U(["card-actions",{"mobile-layout":t.isMobile}]),role:"group","aria-label":`–î–µ–π—Å—Ç–≤–∏—è —Å –∫–µ—à–µ–º ${o.module.name}`},[n("div",Mm,[Q(a,{module:o.module,disabled:t.creating,onCreated:t.handleCacheCreated,onCreating:t.handleCreatingState,class:U({loading:t.creating})},null,8,["module","disabled","onCreated","onCreating","class"])]),n("div",Am,[n("button",{onClick:e[0]||(e[0]=(...r)=>t.handleClear&&t.handleClear(...r)),onKeydown:[e[1]||(e[1]=ee((...r)=>t.handleClear&&t.handleClear(...r),["enter"])),e[2]||(e[2]=ee(ae((...r)=>t.handleClear&&t.handleClear(...r),["prevent"]),["space"]))],disabled:!t.canClear,class:U(["action-button clear-button",{disabled:!t.canClear,loading:t.clearing}]),"aria-label":t.clearButtonLabel,tabindex:"0"},[t.clearing?(c(),d("span",Tm,[...e[30]||(e[30]=[n("span",{class:"spinner"},null,-1),X(" –û—á–∏—Å—Ç–∫–∞... ",-1)])])):t.isEmpty?(c(),d("span",Lm," üìÅ –ö–µ—à –ø—É—Å—Ç ")):(c(),d("span",Dm," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å "))],42,Em),t.canShowDetails?(c(),d("button",{key:0,onClick:e[3]||(e[3]=(...r)=>t.showDetails&&t.showDetails(...r)),onKeydown:[e[4]||(e[4]=ee((...r)=>t.showDetails&&t.showDetails(...r),["enter"])),e[5]||(e[5]=ee(ae((...r)=>t.showDetails&&t.showDetails(...r),["prevent"]),["space"]))],class:"action-button details-button","aria-label":`–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞ ${o.module.name}`,title:"–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–µ—à–∞",tabindex:"0"}," üìä ",40,Im)):h("",!0)])],10,xm),(c(),$(rt,{to:"body"},[t.showDetailModal?(c(),d("div",{key:0,class:"detail-modal-overlay",onClick:e[9]||(e[9]=ae((...r)=>t.closeDetails&&t.closeDetails(...r),["self"])),onKeydown:e[10]||(e[10]=ee((...r)=>t.closeDetails&&t.closeDetails(...r),["escape"]))},[n("div",Pm,[n("div",Nm,[n("h3",null,"–î–µ—Ç–∞–ª–∏ –∫–µ—à–∞: "+u(o.module.name),1),n("button",{onClick:e[6]||(e[6]=(...r)=>t.closeDetails&&t.closeDetails(...r)),onKeydown:[e[7]||(e[7]=ee((...r)=>t.closeDetails&&t.closeDetails(...r),["enter"])),e[8]||(e[8]=ee((...r)=>t.closeDetails&&t.closeDetails(...r),["escape"]))],class:"close-button","aria-label":"–ó–∞–∫—Ä—ã—Ç—å",tabindex:"0"}," ‚úï ",32)]),n("div",Um,[n("pre",Fm,u(JSON.stringify(o.module,null,2)),1)])])],32)):h("",!0)]))],10,Uu)}const Rm=j(Nu,[["render",Bm],["__scopeId","data-v-bc59cd77"]]),Om={name:"CacheStats",props:{modules:{type:Array,required:!1,default:()=>[]}},setup(s){console.log("[CacheStats] setup called with modules:",s.modules);const e=y(()=>s.modules||[]),o=y(()=>{console.log("[CacheStats] Computing primaryModules, total modules:",e.value?.length||0);const C=e.value.filter(A=>Y.PRIMARY_MODULE_IDS.includes(A.id));return console.log("[CacheStats] Primary modules count:",C.length),C}),t=y(()=>{console.log("[CacheStats] Computing secondaryModules, total modules:",e.value?.length||0);const C=e.value.filter(A=>!Y.PRIMARY_MODULE_IDS.includes(A.id));return console.log("[CacheStats] Secondary modules count:",C.length),C}),i=y(()=>o.value?.length||0),l=y(()=>t.value?.length||0),a=y(()=>e.value?.length||0),r=y(()=>e.value.reduce((C,A)=>C+(A.file_count||0),0)),m=y(()=>(s.modules||[]).reduce((C,A)=>C+(A.total_size||0),0)),f=y(()=>Y.formatCacheSize(m.value)),g=y(()=>{const C=s.modules||[];if(C.length===0)return"0 –º–∏–Ω";const A=C.reduce((v,T)=>v+(T.ttl||0),0),P=Math.round(A/C.length);return Y.formatTTL(P)}),b=y(()=>(e.value||[]).filter(C=>C.status==="active").length),L=y(()=>{if((l.value||0)===0)return[];const C={};(t.value||[]).forEach(P=>{const v=Y.getModuleType(P.id);if(!C[v]){const T=Y.getModuleTypeConfig(v);C[v]={type:v,title:T.title||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞",icon:M(v),count:0}}C[v].count++});const A=l.value||0;return Object.values(C).map(P=>({...P,percentage:A>0?Math.round(P.count/A*100):0})).sort((P,v)=>v.count-P.count)}),M=C=>{const A={users:"üë•",activity:"üìä",webhooks:"üîó",other:"üîß"};return A[C]||A.other};return{modules:e,primaryModulesCount:i,secondaryModulesCount:l,totalModules:a,totalFiles:r,totalSizeFormatted:f,avgTTL:g,activeModules:b,groupStats:L}}},Vm={key:0,class:"cache-stats"},zm={class:"stats-overview"},Hm={class:"overview-grid"},jm={class:"overview-card primary"},Wm={class:"overview-content"},qm={class:"overview-value"},$m={class:"overview-card secondary"},Xm={class:"overview-content"},Km={class:"overview-value"},Jm={class:"overview-card total"},Gm={class:"overview-content"},Ym={class:"overview-value"},Qm={class:"detailed-stats"},Zm={class:"stats-grid"},eg={class:"stat-card"},tg={class:"stat-content"},og={class:"stat-value"},ng={class:"stat-card"},sg={class:"stat-content"},ag={class:"stat-value"},ig={class:"stat-card"},rg={class:"stat-content"},lg={class:"stat-value"},cg={class:"stat-card"},dg={class:"stat-content"},ug={class:"stat-value"},mg={key:0,class:"group-distribution"},gg={class:"distribution-grid"},fg={class:"group-icon"},hg={class:"group-info"},vg={class:"group-name"},yg={class:"group-count"},pg={class:"group-percentage"},bg={key:1,class:"cache-stats-loading"};function _g(s,e,o,t,i,l){return(t.modules||[]).length>0?(c(),d("div",Vm,[e[18]||(e[18]=n("h2",{class:"stats-title"},"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",-1)),n("div",zm,[n("div",Hm,[n("div",jm,[e[2]||(e[2]=n("div",{class:"overview-icon"},"üèÜ",-1)),n("div",Wm,[n("div",qm,u(t.primaryModulesCount),1),e[0]||(e[0]=n("div",{class:"overview-label"},"–û—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[1]||(e[1]=n("div",{class:"overview-desc"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ",-1))])]),n("div",$m,[e[5]||(e[5]=n("div",{class:"overview-icon"},"üîß",-1)),n("div",Xm,[n("div",Km,u(t.secondaryModulesCount),1),e[3]||(e[3]=n("div",{class:"overview-label"},"–ü–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),e[4]||(e[4]=n("div",{class:"overview-desc"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),n("div",Jm,[e[8]||(e[8]=n("div",{class:"overview-icon"},"üì¶",-1)),n("div",Gm,[n("div",Ym,u(t.totalModules),1),e[6]||(e[6]=n("div",{class:"overview-label"},"–í—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π",-1)),e[7]||(e[7]=n("div",{class:"overview-desc"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö",-1))])])])]),n("div",Qm,[n("div",Zm,[n("div",eg,[e[10]||(e[10]=n("div",{class:"stat-icon"},"üìÑ",-1)),n("div",tg,[n("div",og,u(t.totalFiles),1),e[9]||(e[9]=n("div",{class:"stat-label"},"–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤",-1))])]),n("div",ng,[e[12]||(e[12]=n("div",{class:"stat-icon"},"üíæ",-1)),n("div",sg,[n("div",ag,u(t.totalSizeFormatted),1),e[11]||(e[11]=n("div",{class:"stat-label"},"–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä",-1))])]),n("div",ig,[e[14]||(e[14]=n("div",{class:"stat-icon"},"‚è±Ô∏è",-1)),n("div",rg,[n("div",lg,u(t.avgTTL),1),e[13]||(e[13]=n("div",{class:"stat-label"},"–°—Ä–µ–¥–Ω–∏–π TTL",-1))])]),n("div",cg,[e[16]||(e[16]=n("div",{class:"stat-icon"},"‚ö°",-1)),n("div",dg,[n("div",ug,u(t.activeModules),1),e[15]||(e[15]=n("div",{class:"stat-label"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–µ—à–µ–π",-1))])])])]),t.secondaryModulesCount>0?(c(),d("div",mg,[e[17]||(e[17]=n("h3",{class:"distribution-title"},"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π",-1)),n("div",gg,[(c(!0),d(H,null,W(t.groupStats,a=>(c(),d("div",{key:a.type,class:"distribution-item"},[n("div",fg,u(a.icon),1),n("div",hg,[n("div",vg,u(a.title),1),n("div",yg,u(a.count)+" –º–æ–¥—É–ª–µ–π",1)]),n("div",pg,u(a.percentage)+"%",1)]))),128))])])):h("",!0)])):(c(),d("div",bg,[...e[19]||(e[19]=[n("p",null,"üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])]))}const wg=j(Om,[["render",_g],["__scopeId","data-v-9fa190bb"]]),Cg={name:"CacheManagement",components:{CacheModuleCard:Rm,CacheStats:wg},setup(){const s=x([]),e=x([]),o=x(!0),t=x(null),i=x(!1),l=y(()=>(s.value?.length||0)+(e.value?.length||0)),a=y(()=>{const v=r.value?.length||0,T=(m.value?.length||0)>0?1:0;return v+T}),r=y(()=>{const v=(s.value||[]).filter(T=>!T.id.includes("time-tracking"));return console.log("[CacheManagement] individualPrimaryModules:",v.length,v.map(T=>T.id)),v}),m=y(()=>{const v=(s.value||[]).filter(T=>T.id.includes("time-tracking")).sort((T,E)=>{const V=["time-tracking-default","time-tracking-detailed","time-tracking-summary"];return V.indexOf(T.id)-V.indexOf(E.id)});return console.log("[CacheManagement] timeTrackingModules:",v.length,v.map(T=>T.id)),v}),f=y(()=>{const v={};return(e.value||[]).forEach(E=>{const V=Y.getModuleType(E.id);v[V]||(v[V]={type:V,title:b(V),modules:[]}),v[V].modules.push(E)}),Object.values(v).sort((E,V)=>{const B=["users","activity","webhooks","other"],D=B.indexOf(E.type),p=B.indexOf(V.type);return(D===-1?999:D)-(p===-1?999:p)})}),g=async()=>{o.value=!0,t.value=null;try{const v=await Y.getCacheStatus();s.value=v.primaryModules||[],e.value=v.secondaryModules||[],console.log("[CacheManagement] Primary modules:",s.value.length,s.value.map(T=>({id:T.id,name:T.name}))),console.log("[CacheManagement] Secondary modules:",e.value.length,e.value.map(T=>({id:T.id,name:T.name})))}catch(v){console.error("[CacheManagement] Error loading modules:",v),t.value=v.message}finally{o.value=!1}},b=v=>{const T={users:"üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",activity:"üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",webhooks:"üîó –õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",other:"üîß –ü—Ä–æ—á–∏–µ –º–æ–¥—É–ª–∏"};return T[v]||T.other},L=async v=>{console.log(`[CacheManagement] Clearing module: ${v}`),Y.invalidateCacheAfterModuleOperation(),await g()},M=async()=>{console.log("[CacheManagement] Clearing all cache"),i.value=!0;try{await Y.clearCache("all"),Y.invalidateCacheAfterModuleOperation(),re.success("–ö–µ—à –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω","–í—Å–µ —Ñ–∞–π–ª—ã –∫–µ—à–∞ –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã"),await g()}catch(v){console.error("[CacheManagement] Error clearing all cache:",v),re.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞",`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à: ${v.message}`)}finally{i.value=!1}},C=async v=>{console.log(`[CacheManagement] Creating cache for: ${v.name} (${v.id})`),alert(`–°–æ–∑–¥–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${v.name}
ID: ${v.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},A=async v=>{console.log(`[CacheManagement] Clearing cache for: ${v.name} (${v.id})`),alert(`–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –º–æ–¥—É–ª—è: ${v.name}
ID: ${v.id}
–≠—Ç–æ mock —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.`)},P=()=>{g()};return se(()=>{g()}),{primaryModules:s,secondaryModules:e,loading:o,error:t,totalModules:l,groupedSecondaryModules:f,individualPrimaryModules:r,timeTrackingModules:m,logicalPrimaryCount:a,clearingAll:i,handleModuleClear:L,handleClearAllCache:M,handleCreateMock:C,handleClearMock:A,refreshModules:P}}},kg={class:"cache-management"},Sg={key:0,class:"header-section"},xg={class:"stats-bar"},Mg={class:"stat-item"},Ag={class:"stat-item"},Eg={class:"stat-item"},Tg={key:0,class:"global-actions"},Lg=["disabled"],Dg={key:0},Ig={key:1},Pg={class:"section-header"},Ng={class:"section-meta"},Ug={class:"module-count","aria-label":"{{ logicalPrimaryCount }} –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},Fg={key:0,class:"modules-container"},Bg={key:0,class:"modules-grid"},Rg={key:1,class:"time-tracking-group"},Og={class:"modules-grid"},Vg={key:1,class:"empty-state"},zg={key:2,class:"section-divider"},Hg={key:3,class:"cache-section secondary-modules","aria-labelledby":"secondary-modules-heading"},jg={class:"section-header"},Wg={class:"section-meta"},qg={class:"module-count","aria-label":"{{ (secondaryModules || []).length }} –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π"},$g={class:"grouped-modules"},Xg={class:"group-header"},Kg={class:"group-title"},Jg={class:"group-badge secondary"},Gg={class:"modules-grid"},Yg={key:4,class:"error-message",role:"alert","aria-live":"assertive"},Qg={key:5,class:"loading-overlay",role:"status","aria-live":"polite","aria-label":"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"};function Zg(s,e,o,t,i,l){const a=q("CacheModuleCard");return c(),d("div",kg,[!t.loading&&!t.error?(c(),d("div",Sg,[e[6]||(e[6]=n("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1)),e[7]||(e[7]=n("p",{class:"description"}," –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º —Å–∏—Å—Ç–µ–º—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è ",-1)),n("div",xg,[n("span",Mg,[n("strong",null,u(t.totalModules),1),e[3]||(e[3]=X(" –≤—Å–µ–≥–æ –º–æ–¥—É–ª–µ–π ",-1))]),n("span",Ag,[n("strong",null,u(t.logicalPrimaryCount),1),e[4]||(e[4]=X(" –æ—Å–Ω–æ–≤–Ω—ã—Ö ",-1))]),n("span",Eg,[n("strong",null,u((t.secondaryModules||[]).length),1),e[5]||(e[5]=X(" –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ",-1))])]),!t.loading&&!t.error?(c(),d("div",Tg,[n("button",{onClick:e[0]||(e[0]=(...r)=>t.handleClearAllCache&&t.handleClearAllCache(...r)),disabled:t.clearingAll,class:U(["btn-clear-all",{"btn-disabled":t.clearingAll}])},[t.clearingAll?(c(),d("span",Dg,"üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫–µ—à–∞...")):(c(),d("span",Ig,"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à"))],10,Lg)])):h("",!0)])):h("",!0),!t.loading&&!t.error?(c(),d("section",{key:1,class:U(["cache-section primary-modules",{empty:(t.primaryModules||[]).length===0}]),"aria-labelledby":"primary-modules-heading"},[n("div",Pg,[e[9]||(e[9]=n("h2",{id:"primary-modules-heading"},"üèÜ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),n("div",Ng,[n("span",Ug,u(t.logicalPrimaryCount),1),e[8]||(e[8]=n("span",{class:"section-badge primary",role:"status","aria-label":"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",-1))])]),e[13]||(e[13]=n("p",{class:"section-description"}," 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã: –¥–∞—à–±–æ—Ä–¥ —Å–µ–∫—Ç–æ—Ä–∞ 1–°, –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏–µ–º–∞-–∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°. ",-1)),(t.primaryModules||[]).length>0?(c(),d("div",Fg,[t.individualPrimaryModules.length>0?(c(),d("div",Bg,[(c(!0),d(H,null,W(t.individualPrimaryModules,r=>(c(),d("div",{key:r.id,class:"module-wrapper"},[Q(a,{module:r,"is-primary":!0,priority:r.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])):h("",!0),(t.timeTrackingModules||[]).length>0?(c(),d("div",Rg,[e[10]||(e[10]=n("div",{class:"group-header"},[n("h3",{class:"group-title"},"‚è±Ô∏è –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°"),n("span",{class:"group-badge"},"–û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞")],-1)),e[11]||(e[11]=n("p",{class:"group-description"},"–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),n("div",Og,[(c(!0),d(H,null,W(t.timeTrackingModules,r=>(c(),d("div",{key:r.id,class:"module-wrapper"},[Q(a,{module:r,"is-primary":!0,priority:r.priority,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","priority","onClear","onRefresh"])]))),128))])])):h("",!0)])):(c(),d("div",Vg,[e[12]||(e[12]=n("p",null,"‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)),n("button",{onClick:e[1]||(e[1]=(...r)=>t.refreshModules&&t.refreshModules(...r)),class:"refresh-btn"},"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫")]))],2)):h("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("div",zg,[...e[14]||(e[14]=[We('<div class="divider-line" data-v-6a4e8216></div><div class="divider-content" data-v-6a4e8216><span class="divider-icon" data-v-6a4e8216>üîß</span><span class="divider-text" data-v-6a4e8216>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏</span><span class="divider-subtitle" data-v-6a4e8216>–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</span></div><div class="divider-line" data-v-6a4e8216></div>',3)])])):h("",!0),!t.loading&&!t.error&&(t.secondaryModules||[]).length>0?(c(),d("section",Hg,[n("div",jg,[e[16]||(e[16]=n("h2",{id:"secondary-modules-heading"},"üîß –ü–æ–±–æ—á–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–µ—à–∞",-1)),n("div",Wg,[n("span",qg,u((t.secondaryModules||[]).length),1),e[15]||(e[15]=n("span",{class:"section-badge secondary",role:"status","aria-label":"–°–ª—É–∂–µ–±–Ω—ã–µ –º–æ–¥—É–ª–∏"},"–°–ª—É–∂–µ–±–Ω—ã–µ",-1))])]),e[17]||(e[17]=n("p",{class:"section-description"}," –ú–æ–¥—É–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã. ",-1)),n("div",$g,[(c(!0),d(H,null,W(t.groupedSecondaryModules,r=>(c(),d("div",{key:r.type,class:U(["module-group",`group-${r.type}`])},[n("div",Xg,[n("h3",Kg,u(r.title),1),n("span",Jg,u(r.modules.length),1)]),n("div",Gg,[(c(!0),d(H,null,W(r.modules,m=>(c(),d("div",{key:m.id,class:"module-wrapper"},[Q(a,{module:m,"is-primary":!1,"group-type":r.type,onClear:t.handleModuleClear,onRefresh:t.refreshModules},null,8,["module","group-type","onClear","onRefresh"])]))),128))])],2))),128))])])):h("",!0),t.error?(c(),d("div",Yg,[e[18]||(e[18]=n("h3",null,"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞",-1)),n("p",null,u(t.error),1),n("button",{onClick:e[2]||(e[2]=(...r)=>s.loadModules&&s.loadModules(...r)),class:"retry-btn","aria-label":"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π –∫–µ—à–∞"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É")])):h("",!0),t.loading?(c(),d("div",Qg,[...e[19]||(e[19]=[n("div",{class:"loading-spinner","aria-hidden":"true"},null,-1),n("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∫–µ—à–∞...",-1)])])):h("",!0)])}const ef=j(Cg,[["render",Zg],["__scopeId","data-v-6a4e8216"]]),tf={name:"CacheManagementPage",components:{CacheManagement:ef},beforeCreate(){console.log("[CacheManagementPage] beforeCreate() called")},created(){console.log("[CacheManagementPage] created() called")},beforeMount(){console.log("[CacheManagementPage] beforeMount() called")},setup(){console.log("[CacheManagementPage] setup() called with new hierarchical UI");const s=Ne(),e=x(!1),o=x(null),t=()=>{s.push({name:"index"})};return se(()=>{console.log("[CacheManagementPage] onMounted() called - hierarchical cache management ready")}),{loading:e,error:o,goBack:t}}},of={class:"cache-management-page"},nf={class:"page-header"},sf={class:"page-header-top"},af={key:0,class:"loading"},rf={key:1,class:"error"},lf={key:2,class:"cache-content"};function cf(s,e,o,t,i,l){const a=q("CacheManagement");return c(),d("div",of,[n("div",nf,[n("div",sf,[n("button",{onClick:e[0]||(e[0]=(...r)=>t.goBack&&t.goBack(...r)),class:"back-button",title:"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É","aria-label":"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"},[...e[1]||(e[1]=[n("span",{class:"back-icon","aria-hidden":"true"},"‚Üê",-1),n("span",{class:"back-text"},"–ù–∞–∑–∞–¥",-1)])])]),e[2]||(e[2]=n("h1",null,"üóëÔ∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",-1))]),t.loading?(c(),d("div",af," –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–µ—à–∞... ")):t.error?(c(),d("div",rf,u(t.error),1)):(c(),d("div",lf,[Q(a)]))])}const df=j(tf,[["render",cf],["__scopeId","data-v-a20ded38"]]),uf=[{path:"/install",name:"install",component:go},{path:"/",name:"index",component:mn},{path:"/webhook-logs",name:"webhook-logs",redirect:"/admin/webhook-logs"},{path:"/admin/webhook-logs",name:"admin-webhook-logs",component:yi,meta:{requiresAuth:!0,title:"–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤",adminOnly:!0}},{path:"/admin/users",name:"admin-users",component:au,meta:{requiresAuth:!0,title:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",adminOnly:!0}},{path:"/admin/cache",name:"admin-cache",component:df,meta:{requiresAuth:!0,title:"–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º",adminOnly:!0}},{path:"/dashboard/sector-1c",name:"dashboard-sector-1c",component:()=>ce(()=>import("./DashboardSector1C.vue-D1wCkinn.js"),__vite__mapDeps([8,4,9,10,11,5,2,1,12]),import.meta.url),meta:{requiresAuth:!0,chunk:"dashboard-sector1c"}},{path:"/dashboard/graph-admission-closure",name:"dashboard-graph-admission-closure",component:()=>ce(()=>import("./GraphAdmissionClosureDashboard.vue-BwVhDBl-.js"),__vite__mapDeps([13,4,14,11,5,2,1,10,15,9]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—ë–º–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–π —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–ù–µ–¥–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–æ–≤—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–°",requiresAuth:!0,chunk:"admission-dashboard"}},{path:"/dashboard/graph-state",name:"dashboard-graph-state",component:()=>ce(()=>import("./GraphStateDashboard.vue-B2xqtqiu.js"),__vite__mapDeps([16,4,1,12,11,5,2,10,9,14]),import.meta.url),meta:{title:"–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏",requiresAuth:!0,chunk:"graph-state"}},{path:"/dashboard/tickets-time-tracking",name:"dashboard-tickets-time-tracking",component:()=>ce(()=>import("./TicketsTimeTrackingDashboard.vue-DUBrAqoH.js"),__vite__mapDeps([17,4,1,5,2]),import.meta.url),meta:{title:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –¢–∏–∫–µ—Ç—ã —Å–µ–∫—Ç–æ—Ä–∞ 1–°",description:"–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–µ–∫—Ç–æ—Ä–∞ 1–° –ø–æ –Ω–µ–¥–µ–ª—è–º",requiresAuth:!0,chunk:"tickets-tracking"}}],Ye=Ut({history:Ft(),routes:uf});Ye.beforeEach(async(s,e,o)=>{if(console.log("[Router] beforeEach:",{to:s.path,from:e.path,name:s.name}),s.meta.title&&(document.title=`${s.meta.title} - Bitrix24 Dashboard`),s.meta.requiresAuth){console.log("[Router] requiresAuth check for:",s.path);try{const t=await De.checkAccess();if(!t.allowed){console.warn("Unauthorized access attempt to:",s.path,t.errorMessage),o({name:"index"});return}}catch(t){console.error("Error checking access in navigation guard:",t),o();return}}if(s.meta.adminOnly)try{const t=await De.getCurrentUser();if(!t||!Mt(t)){console.warn("Admin access required for:",s.path),o({name:"index"});return}}catch(t){console.error("Error checking admin access in navigation guard:",t),o({name:"index"});return}if(e.name!==null&&s.path!==e.path)try{if((await De.checkAccess()).allowed){const i=await De.getCurrentUser();i&&Ke.logPageVisit(s,i,e).catch(l=>{console.error("[Router] Error logging page visit:",l)})}}catch(t){console.error("[Router] Error in activity logging:",t)}if(s.name==="index"&&!e.name&&setTimeout(()=>{ce(()=>import("./DashboardSector1C.vue-D1wCkinn.js"),__vite__mapDeps([8,4,9,10,11,5,2,1,12]),import.meta.url)},1e3),s.meta.chunk)switch(s.meta.chunk){case"dashboard-sector1c":setTimeout(()=>{ce(()=>import("./dashboard-sector-1c-service-BdJ0VI4i.js"),__vite__mapDeps([15,11,5,2,1,10]),import.meta.url)},500);break;case"admission-dashboard":setTimeout(()=>{ce(()=>import("./chunk-DzhLK_gS.js").then(t=>t.l),__vite__mapDeps([2,1]),import.meta.url)},500);break}console.log("[Router] Allowing navigation to:",s.path),o()});setTimeout(()=>{const s=window.location.pathname,e=window.location.hash;e&&e!=="#/"||(s.includes("install.php")?Ye.replace("/install"):Ye.replace("/"))},0);qe.register(Bt,Rt,Ot,Vt,zt,Ht,jt,Wt,qt,$t);qe.defaults.responsive=!0;qe.defaults.maintainAspectRatio=!1;qe.defaults.plugins.legend.display=!0;qe.defaults.plugins.legend.position="top";const _f={primary:"#007bff",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8",carryover:"#ff9800",successLight:"#6cbf47",carryoverLight:"#ffb74d",carryoverDark:"#f57c00"};class Ge{static startBundleLoad(){this.metrics.bundleLoadTime=performance.now()}static endBundleLoad(e){const o=performance.now()-this.metrics.bundleLoadTime;this.metrics.chunkLoadTimes.set(e,o),console.log(`üì¶ Chunk "${e}" loaded in ${o.toFixed(2)}ms`),window.gtag&&window.gtag("event","bundle_load",{chunk_name:e,load_time:o}),o>1e3&&console.warn(`üêå Slow chunk load: ${e} took ${o.toFixed(2)}ms`)}static trackComponentLoad(e,o){const t=performance.now()-o;this.metrics.componentLoadTime.set(e,t),console.log(`üß© Component "${e}" loaded in ${t.toFixed(2)}ms`),t>500&&console.warn(`üêå Slow component load: ${e} took ${t.toFixed(2)}ms`)}static trackApiCall(e,o){this.metrics.apiResponseTime.set(e,o),o>1e3&&console.warn(`üêå Slow API call to ${e}: ${o}ms`)}static getReport(){const e=Array.from(this.metrics.componentLoadTime.values()),o=Array.from(this.metrics.apiResponseTime.values()),t=Array.from(this.metrics.chunkLoadTimes.values());return{totalChunks:this.metrics.chunkLoadTimes.size,totalComponents:this.metrics.componentLoadTime.size,totalApiCalls:this.metrics.apiResponseTime.size,averageComponentLoadTime:e.length>0?e.reduce((i,l)=>i+l,0)/e.length:0,averageApiResponseTime:o.length>0?o.reduce((i,l)=>i+l,0)/o.length:0,averageChunkLoadTime:t.length>0?t.reduce((i,l)=>i+l,0)/t.length:0,slowestComponents:Array.from(this.metrics.componentLoadTime.entries()).sort(([,i],[,l])=>l-i).slice(0,5).map(([i,l])=>({name:i,time:l})),slowestApiCalls:Array.from(this.metrics.apiResponseTime.entries()).sort(([,i],[,l])=>l-i).slice(0,5).map(([i,l])=>({endpoint:i,time:l})),slowestChunks:Array.from(this.metrics.chunkLoadTimes.entries()).sort(([,i],[,l])=>l-i).slice(0,5).map(([i,l])=>({name:i,time:l}))}}static clearMetrics(){this.metrics.bundleLoadTime=0,this.metrics.componentLoadTime.clear(),this.metrics.apiResponseTime.clear(),this.metrics.chunkLoadTimes.clear()}}ke(Ge,"metrics",{bundleLoadTime:0,componentLoadTime:new Map,apiResponseTime:new Map,chunkLoadTimes:new Map});class mf{static init(){this.initChunkLoadErrorHandling(),this.initUnhandledErrorHandling(),this.initNetworkErrorHandling()}static initChunkLoadErrorHandling(){if(window.addEventListener("error",e=>{e.target.tagName==="SCRIPT"&&(console.error("‚ùå Chunk loading error:",e.target.src),this.reportError("chunk_load_error",{url:e.target.src,message:e.message||"Script load failed"}))}),"PerformanceObserver"in window)try{new PerformanceObserver(o=>{for(const t of o.getEntries())if(t.entryType==="resource"&&t.name.includes(".js")){const i=t.responseEnd-t.requestStart;Ge.trackApiCall(t.name,i)}}).observe({entryTypes:["resource"]})}catch{console.warn("PerformanceObserver not supported")}}static initUnhandledErrorHandling(){window.addEventListener("unhandledrejection",e=>{console.error("‚ùå Unhandled promise rejection:",e.reason),this.reportError("unhandled_rejection",{reason:e.reason?.message||String(e.reason),stack:e.reason?.stack})}),window.addEventListener("error",e=>{e.error&&e.filename&&(console.error("‚ùå Unhandled error:",e.error),this.reportError("unhandled_error",{message:e.error.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error.stack}))})}static initNetworkErrorHandling(){const e=window.fetch;window.fetch=function(...o){const t=performance.now();return e.apply(this,o).then(i=>{const l=performance.now()-t;return Ge.trackApiCall(o[0],l),i.ok||console.warn(`üö® API error: ${i.status} ${i.statusText} for ${o[0]}`),i}).catch(i=>{const l=performance.now()-t;throw console.error(`‚ùå Network error for ${o[0]}:`,i),Ge.trackApiCall(o[0],l),this.reportError("network_error",{url:o[0],message:i.message,loadTime:l}),i})}}static reportError(e,o){const t={type:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,...o};if(console.error("üìä Error report:",t),window.Sentry&&window.Sentry.captureException(new Error(`${e}: ${JSON.stringify(o)}`)),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:"/api/log-error.php",method:"POST",data:t})}catch(i){console.error("Failed to send error report to Bitrix24:",i)}window.gtag&&window.gtag("event","exception",{description:`${e}: ${o.message||"Unknown error"}`,fatal:!1})}static getErrorStats(){return{chunkLoadErrors:0,networkErrors:0,unhandledErrors:0,totalErrors:0}}}const ut=Xt(Yt);ut.use(Ye);const gf=s=>{try{const e=new WeakSet;return JSON.stringify(s,(o,t)=>{if(typeof t=="object"&&t!==null){if(e.has(t))return"[Circular]";e.add(t)}return typeof t=="function"||t===void 0?null:t})}catch{return String(s)}};ut.config.errorHandler=(s,e,o)=>{if(s instanceof TypeError&&s.message.includes("Cannot read properties of undefined (reading 'type')")){console.warn("Caught undefined.type error:",{error:s.message,component:e?.$options?.name||"Unknown",info:o,stack:s.stack});return}if(console.error("Vue error:",s,o),typeof BX<"u"&&BX.ajax)try{BX.ajax({url:be("/api/log-error.php"),method:"POST",data:{error:s?.message||String(s),info:typeof o=="string"?o:gf(o),component:e?.$options?.name||"Unknown"}})}catch(t){console.error("Failed to log error:",t)}};ut.mount("#app");mf.init();export{De as A,Je as C,St as L,kt as S,j as _,Fe as a,Me as b,_f as c,_e as d,fn as e,ze as f,ct as g,bf as h,Mt as i,Ve as n,Et as u};
