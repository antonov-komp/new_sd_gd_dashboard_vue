import{_ as P,d as y,c as f,o as v,a as s,b as x,t as _,n as E,D as F,E as R,G as W,H as T,I as G,L as J,J as Z,g as $,m as Q,K as X,M as tt,N as I,O as q,P as et,Q as st,F as N,e as U,f as M,R as b,r as k,l as at,j as D,k as A,B as z}from"./main-CSNaPKs2.js";const ot={name:"WebhookLogsStats",props:{logs:{type:Array,required:!0,default:()=>[]},previousPeriodStats:{type:Object,default:null}},setup(a){const t=y(()=>a.logs.length),c=y(()=>a.logs.filter(o=>o.category==="tasks").length),e=y(()=>a.logs.filter(o=>o.category==="smart-processes").length),d=y(()=>a.logs.filter(o=>o.category==="errors").length),l=y(()=>{if(a.logs.length===0)return 0;const o=a.logs.reduce((p,C)=>{try{const m=JSON.stringify(C.payload||{}).length;return p+m}catch{return p}},0);return Math.round(o/a.logs.length)}),g=y(()=>{const o=new Set;return a.logs.forEach(p=>{p.ip&&o.add(p.ip)}),o.size}),r=(o,p)=>p===0?0:Math.round(o/p*100),n=o=>o===0?"0":o<1024?o.toString():o<1024*1024?(o/1024).toFixed(1)+" KB":(o/(1024*1024)).toFixed(1)+" MB",i=y(()=>{if(!a.previousPeriodStats)return null;const o=a.previousPeriodStats.totalEvents||0;return t.value-o});return{totalEvents:t,tasksCount:c,smartProcessesCount:e,errorsCount:d,averagePayloadSize:l,uniqueIpsCount:g,getPercentage:r,formatBytes:n,totalEventsChange:i,getChangeClass:o=>o===null?"":o>0?"change-positive":o<0?"change-negative":"change-neutral",formatChange:o=>o===null?"":`${o>0?"+":""}${o}`}}},nt={class:"webhook-stats"},rt={class:"stats-grid"},lt={class:"stat-card stat-card-primary"},it={class:"stat-content"},ct={class:"stat-value"},dt={key:0,class:"stat-change"},ut={class:"stat-card stat-card-info"},gt={class:"stat-content"},ht={class:"stat-value"},vt={class:"stat-percentage"},pt={class:"stat-card stat-card-success"},ft={class:"stat-content"},yt={class:"stat-value"},_t={class:"stat-percentage"},bt={class:"stat-card stat-card-danger"},mt={class:"stat-content"},Ct={class:"stat-value"},kt={key:0,class:"stat-percentage"},St={key:1,class:"stat-percentage success"},Dt={class:"stat-card stat-card-warning"},wt={class:"stat-content"},Pt={class:"stat-value"},Ot={class:"stat-card stat-card-secondary"},xt={class:"stat-content"},Et={class:"stat-value"};function $t(a,t,c,e,d,l){return v(),f("div",nt,[t[14]||(t[14]=s("h3",{class:"stats-title"},"Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°",-1)),s("div",rt,[s("div",lt,[t[2]||(t[2]=s("div",{class:"stat-icon"},"ðŸ“Š",-1)),s("div",it,[t[1]||(t[1]=s("div",{class:"stat-label"},"Ð’ÑÐµÐ³Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹",-1)),s("div",ct,_(e.totalEvents),1),c.previousPeriodStats?(v(),f("div",dt,[s("span",{class:E(e.getChangeClass(e.totalEventsChange))},_(e.formatChange(e.totalEventsChange)),3),t[0]||(t[0]=s("span",{class:"stat-period"},"vs Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´",-1))])):x("",!0)])]),s("div",ut,[t[4]||(t[4]=s("div",{class:"stat-icon"},"âœ…",-1)),s("div",gt,[t[3]||(t[3]=s("div",{class:"stat-label"},"Ð—Ð°Ð´Ð°Ñ‡Ð¸",-1)),s("div",ht,_(e.tasksCount),1),s("div",vt,_(e.getPercentage(e.tasksCount,e.totalEvents))+"% Ð¾Ñ‚ Ð¾Ð±Ñ‰ÐµÐ³Ð¾ ",1)])]),s("div",pt,[t[6]||(t[6]=s("div",{class:"stat-icon"},"âš™ï¸",-1)),s("div",ft,[t[5]||(t[5]=s("div",{class:"stat-label"},"Ð¡Ð¼Ð°Ñ€Ñ‚-Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹",-1)),s("div",yt,_(e.smartProcessesCount),1),s("div",_t,_(e.getPercentage(e.smartProcessesCount,e.totalEvents))+"% Ð¾Ñ‚ Ð¾Ð±Ñ‰ÐµÐ³Ð¾ ",1)])]),s("div",bt,[t[8]||(t[8]=s("div",{class:"stat-icon"},"âŒ",-1)),s("div",mt,[t[7]||(t[7]=s("div",{class:"stat-label"},"ÐžÑˆÐ¸Ð±ÐºÐ¸",-1)),s("div",Ct,_(e.errorsCount),1),e.errorsCount>0?(v(),f("div",kt,_(e.getPercentage(e.errorsCount,e.totalEvents))+"% Ð¾Ñ‚ Ð¾Ð±Ñ‰ÐµÐ³Ð¾ ",1)):(v(),f("div",St," ÐžÑˆÐ¸Ð±Ð¾Ðº Ð½ÐµÑ‚ "))])]),s("div",Dt,[t[11]||(t[11]=s("div",{class:"stat-icon"},"ðŸ“¦",-1)),s("div",wt,[t[9]||(t[9]=s("div",{class:"stat-label"},"Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€ payload",-1)),s("div",Pt,_(e.formatBytes(e.averagePayloadSize)),1),t[10]||(t[10]=s("div",{class:"stat-unit"},"Ð±Ð°Ð¹Ñ‚",-1))])]),s("div",Ot,[t[13]||(t[13]=s("div",{class:"stat-icon"},"ðŸŒ",-1)),s("div",xt,[t[12]||(t[12]=s("div",{class:"stat-label"},"Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… IP",-1)),s("div",Et,_(e.uniqueIpsCount),1)])])])])}const Bt=P(ot,[["render",$t],["__scopeId","data-v-8f0b6374"]]),Y={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},Lt={ariaLabel:{type:String},ariaDescribedby:{type:String}},Tt={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...Y,...Lt},It=Z[0]==="2"?(a,t)=>Object.assign(a,{attrs:t}):(a,t)=>Object.assign(a,t);function w(a){return q(a)?I(a):a}function Mt(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a;return q(t)?new Proxy(a,{}):a}function jt(a,t){const c=a.options;c&&t&&Object.assign(c,t)}function K(a,t){a.labels=t}function H(a,t,c){const e=[];a.datasets=t.map(d=>{const l=a.datasets.find(g=>g[c]===d[c]);return!l||!d.data||e.includes(l)?{...d}:(e.push(l),Object.assign(l,d),l)})}function At(a,t){const c={labels:[],datasets:[]};return K(c,a.labels),H(c,a.datasets,t),c}const zt=R({props:Tt,setup(a,t){let{expose:c,slots:e}=t;const d=$(null),l=W(null);c({chart:l});const g=()=>{if(!d.value)return;const{type:i,data:h,options:u,plugins:o,datasetIdKey:p}=a,C=At(h,p),m=Mt(C,h);l.value=new F(d.value,{type:i,data:m,options:{...u},plugins:o})},r=()=>{const i=I(l.value);i&&(a.destroyDelay>0?setTimeout(()=>{i.destroy(),l.value=null},a.destroyDelay):(i.destroy(),l.value=null))},n=i=>{i.update(a.updateMode)};return Q(g),X(r),tt([()=>a.options,()=>a.data],(i,h)=>{let[u,o]=i,[p,C]=h;const m=I(l.value);if(!m)return;let O=!1;if(u){const S=w(u),B=w(p);S&&S!==B&&(jt(m,S),O=!0)}if(o){const S=w(o.labels),B=w(C.labels),L=w(o.datasets),V=w(C.datasets);S!==B&&(K(m.config.data,S),O=!0),L&&L!==V&&(H(m.config.data,L,a.datasetIdKey),O=!0)}O&&st(()=>{n(m)})},{deep:!0}),()=>T("canvas",{role:"img","aria-label":a.ariaLabel,"aria-describedby":a.ariaDescribedby,ref:d},[T("p",{},[e.default?e.default():""])])}});function j(a,t){return F.register(t),R({props:Y,setup(c,e){let{expose:d}=e;const l=W(null),g=r=>{l.value=r==null?void 0:r.chart};return d({chart:l}),()=>T(zt,It({ref:g},{type:a,...c}))}})}const Ft=j("bar",et),Rt=j("doughnut",G),Wt=j("line",J),qt={name:"EventsTimelineChart",components:{Line:Wt},props:{logs:{type:Array,required:!0,default:()=>[]}},setup(a){const t=$("hour"),c=[{value:"hour",label:"ÐŸÐ¾ Ñ‡Ð°ÑÐ°Ð¼"},{value:"day",label:"ÐŸÐ¾ Ð´Ð½ÑÐ¼"},{value:"week",label:"ÐŸÐ¾ Ð½ÐµÐ´ÐµÐ»ÑÐ¼"}],e=r=>{const n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())),i=n.getUTCDay()||7;n.setUTCDate(n.getUTCDate()+4-i);const h=new Date(Date.UTC(n.getUTCFullYear(),0,1));return Math.ceil(((n-h)/864e5+1)/7)},d=(r,n)=>{const i={};return r.forEach(h=>{if(!h.timestamp)return;const u=new Date(h.timestamp);let o;switch(n){case"hour":o=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")} ${String(u.getHours()).padStart(2,"0")}:00`;break;case"day":o=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`;break;case"week":const p=e(u);o=`${u.getFullYear()}-W${String(p).padStart(2,"0")}`;break;default:o=u.toISOString()}i[o]=(i[o]||0)+1}),i},l=y(()=>{if(!a.logs||a.logs.length===0)return null;const r=d(a.logs,t.value),n=Object.keys(r).sort(),i=n.map(h=>r[h]);return{labels:n,datasets:[{label:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹",data:i,borderColor:b.primary,backgroundColor:h=>{if(!h.chart)return b.primary;const u=h.chart.ctx.createLinearGradient(0,0,0,400);return u.addColorStop(0,"rgba(0, 123, 255, 0.3)"),u.addColorStop(1,"rgba(0, 123, 255, 0.05)"),u},fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6,pointBackgroundColor:b.primary,pointBorderColor:"#fff",pointBorderWidth:2}]}}),g=y(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},title:{display:!1},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,titleFont:{size:14,weight:"bold"},bodyFont:{size:13},callbacks:{label:function(r){return`${r.dataset.label}: ${r.parsed.y}`}}}},scales:{x:{display:!0,title:{display:!0,text:"Ð’Ñ€ÐµÐ¼Ñ"},grid:{display:!1}},y:{display:!0,title:{display:!0,text:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹"},beginAtZero:!0,ticks:{stepSize:1}}},interaction:{mode:"nearest",axis:"x",intersect:!1}}));return{selectedPeriod:t,timePeriods:c,chartData:l,chartOptions:g}}},Nt={class:"chart-container"},Ut={class:"chart-header"},Yt={class:"chart-controls"},Kt=["onClick"],Ht={class:"chart-wrapper"},Vt={key:1,class:"chart-empty"};function Gt(a,t,c,e,d,l){const g=k("Line");return v(),f("div",Nt,[s("div",Ut,[t[0]||(t[0]=s("h4",null,"Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸",-1)),s("div",Yt,[(v(!0),f(N,null,U(e.timePeriods,r=>(v(),f("button",{key:r.value,onClick:n=>e.selectedPeriod=r.value,class:E(["period-btn",{active:e.selectedPeriod===r.value}])},_(r.label),11,Kt))),128))])]),s("div",Ht,[e.chartData?(v(),M(g,{key:0,data:e.chartData,options:e.chartOptions,height:300},null,8,["data","options"])):(v(),f("div",Vt,[...t[1]||(t[1]=[s("p",null,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ",-1)])]))])])}const Jt=P(qt,[["render",Gt],["__scopeId","data-v-c9e42b61"]]),Zt={name:"CategoriesChart",components:{Doughnut:Rt},props:{logs:{type:Array,required:!0,default:()=>[]}},setup(a){const t={tasks:"Ð—Ð°Ð´Ð°Ñ‡Ð¸","smart-processes":"Ð¡Ð¼Ð°Ñ€Ñ‚-Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹",errors:"ÐžÑˆÐ¸Ð±ÐºÐ¸"},c={tasks:b.primary,"smart-processes":b.success,errors:b.danger},e=y(()=>{const n={tasks:0,"smart-processes":0,errors:0};return a.logs.forEach(i=>{i.category&&n.hasOwnProperty(i.category)&&n[i.category]++}),n}),d=y(()=>Object.values(e.value).reduce((n,i)=>n+i,0)),l=y(()=>{if(d.value===0)return null;const n=[],i=[],h=[];return Object.keys(e.value).forEach(u=>{e.value[u]>0&&(n.push(t[u]),i.push(e.value[u]),h.push(c[u]))}),{labels:n,datasets:[{data:i,backgroundColor:h,borderWidth:2,borderColor:"#fff",hoverOffset:4}]}}),g=y(()=>Object.keys(e.value).filter(n=>e.value[n]>0).map(n=>({label:t[n],value:e.value[n],percentage:d.value>0?Math.round(e.value[n]/d.value*100):0,color:c[n]}))),r=y(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,callbacks:{label:function(n){const i=n.label||"",h=n.parsed||0,u=n.dataset.data.reduce((p,C)=>p+C,0),o=u>0?Math.round(h/u*100):0;return`${i}: ${h} (${o}%)`}}}}}));return{chartData:l,chartOptions:r,legendData:g}}},Qt={class:"chart-container"},Xt={class:"chart-wrapper"},te={key:1,class:"chart-empty"},ee={key:0,class:"chart-legend"},se={class:"legend-label"},ae={class:"legend-value"};function oe(a,t,c,e,d,l){const g=k("Doughnut");return v(),f("div",Qt,[t[1]||(t[1]=s("div",{class:"chart-header"},[s("h4",null,"Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼")],-1)),s("div",Xt,[e.chartData?(v(),M(g,{key:0,data:e.chartData,options:e.chartOptions,height:300},null,8,["data","options"])):(v(),f("div",te,[...t[0]||(t[0]=[s("p",null,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ",-1)])]))]),e.legendData.length>0?(v(),f("div",ee,[(v(!0),f(N,null,U(e.legendData,(r,n)=>(v(),f("div",{key:n,class:"legend-item"},[s("span",{class:"legend-color",style:at({backgroundColor:r.color})},null,4),s("span",se,_(r.label),1),s("span",ae,_(r.value)+" ("+_(r.percentage)+"%)",1)]))),128))])):x("",!0)])}const ne=P(Zt,[["render",oe],["__scopeId","data-v-99bf5a75"]]),re={name:"EventsBarChart",components:{Bar:Ft},props:{logs:{type:Array,required:!0,default:()=>[]}},setup(a){const t=y(()=>{const d={};return a.logs.forEach(l=>{l.event&&(d[l.event]=(d[l.event]||0)+1)}),Object.entries(d).sort((l,g)=>g[1]-l[1]).reduce((l,[g,r])=>(l[g]=r,l),{})}),c=y(()=>{if(Object.keys(t.value).length===0)return null;const d=Object.keys(t.value),l=Object.values(t.value),g=d.map((r,n)=>{const i=[b.primary,b.success,b.info,b.warning,b.danger];return i[n%i.length]});return{labels:d,datasets:[{label:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹",data:l,backgroundColor:g.map(r=>r+"80"),borderColor:g,borderWidth:2,borderRadius:4}]}}),e=y(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,callbacks:{label:function(d){return`${d.dataset.label}: ${d.parsed.y}`}}}},scales:{x:{display:!0,title:{display:!0,text:"Ð¢Ð¸Ð¿ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ"},grid:{display:!1},ticks:{maxRotation:45,minRotation:45}},y:{display:!0,title:{display:!0,text:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾"},beginAtZero:!0,ticks:{stepSize:1}}}}));return{chartData:c,chartOptions:e}}},le={class:"chart-container"},ie={class:"chart-wrapper"},ce={key:1,class:"chart-empty"};function de(a,t,c,e,d,l){const g=k("Bar");return v(),f("div",le,[t[1]||(t[1]=s("div",{class:"chart-header"},[s("h4",null,"Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ð°Ð¼")],-1)),s("div",ie,[e.chartData?(v(),M(g,{key:0,data:e.chartData,options:e.chartOptions,height:300},null,8,["data","options"])):(v(),f("div",ce,[...t[0]||(t[0]=[s("p",null,"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ",-1)])]))])])}const ue=P(re,[["render",de],["__scopeId","data-v-68f76fd3"]]),ge={name:"WebhookLogsDashboard",components:{WebhookLogsStats:Bt,EventsTimelineChart:Jt,CategoriesChart:ne,EventsBarChart:ue},props:{logs:{type:Array,required:!0,default:()=>[]},previousPeriodStats:{type:Object,default:null}},setup(){const a=$(!0),t=$(!0);return{showStats:a,showCharts:t}}},he={class:"webhook-dashboard"},ve={class:"dashboard-header"},pe={class:"dashboard-controls"},fe={key:0,class:"dashboard-section"},ye={key:0,class:"dashboard-section"},_e={class:"charts-grid"},be={class:"chart-item"},me={class:"chart-item"},Ce={class:"chart-item chart-item-full"};function ke(a,t,c,e,d,l){const g=k("WebhookLogsStats"),r=k("EventsTimelineChart"),n=k("CategoriesChart"),i=k("EventsBarChart");return v(),f("div",he,[s("div",ve,[t[2]||(t[2]=s("h2",null,"Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ Ð»Ð¾Ð³Ð¾Ð² Ð²ÐµÐ±Ñ…ÑƒÐºÐ¾Ð²",-1)),s("div",pe,[s("button",{onClick:t[0]||(t[0]=h=>e.showStats=!e.showStats),class:E(["toggle-btn",{active:e.showStats}])},_(e.showStats?"â–¼":"â–¶")+" Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° ",3),s("button",{onClick:t[1]||(t[1]=h=>e.showCharts=!e.showCharts),class:E(["toggle-btn",{active:e.showCharts}])},_(e.showCharts?"â–¼":"â–¶")+" Ð“Ñ€Ð°Ñ„Ð¸ÐºÐ¸ ",3)])]),D(z,{name:"slide-down"},{default:A(()=>[e.showStats?(v(),f("div",fe,[D(g,{logs:c.logs,"previous-period-stats":c.previousPeriodStats},null,8,["logs","previous-period-stats"])])):x("",!0)]),_:1}),D(z,{name:"slide-down"},{default:A(()=>[e.showCharts?(v(),f("div",ye,[s("div",_e,[s("div",be,[D(r,{logs:c.logs},null,8,["logs"])]),s("div",me,[D(n,{logs:c.logs},null,8,["logs"])]),s("div",Ce,[D(i,{logs:c.logs},null,8,["logs"])])])])):x("",!0)]),_:1})])}const De=P(ge,[["render",ke],["__scopeId","data-v-9e512b34"]]);export{De as default};
